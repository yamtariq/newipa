2025-02-06 00:05:26.890 +03:00 [INF] Executed DbCommand (31ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT 1
2025-02-06 00:05:26.980 +03:00 [INF] Executed DbCommand (20ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT OBJECT_ID(N'[__EFMigrationsHistory]');
2025-02-06 00:05:26.987 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT 1
2025-02-06 00:05:26.993 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT OBJECT_ID(N'[__EFMigrationsHistory]');
2025-02-06 00:05:27.090 +03:00 [INF] Executed DbCommand (79ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT [MigrationId], [ProductVersion]
FROM [__EFMigrationsHistory]
ORDER BY [MigrationId];
2025-02-06 00:05:27.108 +03:00 [INF] Applying migration '20250205155207_AddNotificationImageUrls'.
2025-02-06 00:05:27.654 +03:00 [ERR] Failed executing DbCommand (15ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
ALTER TABLE [User_Notifications] DROP CONSTRAINT [FK_User_Notifications_Customers_NationalId];
2025-02-06 00:05:33.564 +03:00 [INF] Starting web application
2025-02-06 00:05:33.718 +03:00 [INF] Now listening on: http://localhost:5264
2025-02-06 00:05:33.723 +03:00 [INF] Application started. Press Ctrl+C to shut down.
2025-02-06 00:05:33.725 +03:00 [INF] Hosting environment: Development
2025-02-06 00:05:33.726 +03:00 [INF] Content root path: C:\Users\yamta\StudioProjects\nayifat_app_2025_new\NayifatAPI
2025-02-06 00:08:22.809 +03:00 [INF] Application is shutting down...
2025-02-06 00:11:11.645 +03:00 [INF] Executed DbCommand (12ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT 1
2025-02-06 00:11:11.722 +03:00 [INF] Executed DbCommand (17ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT OBJECT_ID(N'[__EFMigrationsHistory]');
2025-02-06 00:11:11.741 +03:00 [INF] Executed DbCommand (3ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT [MigrationId], [ProductVersion]
FROM [__EFMigrationsHistory]
ORDER BY [MigrationId];
2025-02-06 11:07:37.434 +03:00 [INF] Executed DbCommand (19ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT 1
2025-02-06 11:07:37.573 +03:00 [INF] Executed DbCommand (90ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT OBJECT_ID(N'[__EFMigrationsHistory]');
2025-02-06 11:07:37.577 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT 1
2025-02-06 11:07:37.579 +03:00 [INF] Executed DbCommand (0ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT OBJECT_ID(N'[__EFMigrationsHistory]');
2025-02-06 11:07:37.775 +03:00 [INF] Executed DbCommand (183ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT [MigrationId], [ProductVersion]
FROM [__EFMigrationsHistory]
ORDER BY [MigrationId];
2025-02-06 11:07:37.791 +03:00 [INF] Applying migration '20250205155207_AddNotificationImageUrls'.
2025-02-06 11:07:37.918 +03:00 [ERR] Failed executing DbCommand (13ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
ALTER TABLE [User_Notifications] DROP CONSTRAINT [FK_User_Notifications_Customers_NationalId];
2025-02-06 11:14:15.546 +03:00 [INF] Executed DbCommand (32ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT 1
2025-02-06 11:14:15.733 +03:00 [INF] Executed DbCommand (93ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT OBJECT_ID(N'[__EFMigrationsHistory]');
2025-02-06 11:14:15.740 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT 1
2025-02-06 11:14:15.742 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT OBJECT_ID(N'[__EFMigrationsHistory]');
2025-02-06 11:14:16.198 +03:00 [INF] Executed DbCommand (438ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT [MigrationId], [ProductVersion]
FROM [__EFMigrationsHistory]
ORDER BY [MigrationId];
2025-02-06 11:14:16.227 +03:00 [INF] Applying migration '20250205155207_AddNotificationImageUrls'.
2025-02-06 11:14:16.450 +03:00 [ERR] Failed executing DbCommand (15ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
ALTER TABLE [User_Notifications] DROP CONSTRAINT [FK_User_Notifications_Customers_NationalId];
2025-02-06 11:21:23.509 +03:00 [INF] Executed DbCommand (18ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT 1
2025-02-06 11:21:23.576 +03:00 [INF] Executed DbCommand (18ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT OBJECT_ID(N'[__EFMigrationsHistory]');
2025-02-06 11:21:23.598 +03:00 [INF] Executed DbCommand (13ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT [MigrationId], [ProductVersion]
FROM [__EFMigrationsHistory]
ORDER BY [MigrationId];
2025-02-06 11:22:09.042 +03:00 [INF] Executed DbCommand (17ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT 1
2025-02-06 11:22:09.134 +03:00 [INF] Executed DbCommand (16ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT OBJECT_ID(N'[__EFMigrationsHistory]');
2025-02-06 11:22:09.137 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT 1
2025-02-06 11:22:09.141 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT OBJECT_ID(N'[__EFMigrationsHistory]');
2025-02-06 11:22:09.154 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT [MigrationId], [ProductVersion]
FROM [__EFMigrationsHistory]
ORDER BY [MigrationId];
2025-02-06 11:22:09.174 +03:00 [INF] Applying migration '20250205155207_AddNotificationImageUrls'.
2025-02-06 11:22:09.378 +03:00 [ERR] Failed executing DbCommand (82ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
ALTER TABLE [User_Notifications] DROP CONSTRAINT [FK_User_Notifications_Customers_NationalId];
2025-02-06 11:22:29.261 +03:00 [INF] Executed DbCommand (18ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT 1
2025-02-06 11:22:29.374 +03:00 [INF] Executed DbCommand (24ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT OBJECT_ID(N'[__EFMigrationsHistory]');
2025-02-06 11:22:29.379 +03:00 [INF] Executed DbCommand (2ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT 1
2025-02-06 11:22:29.386 +03:00 [INF] Executed DbCommand (4ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT OBJECT_ID(N'[__EFMigrationsHistory]');
2025-02-06 11:22:29.415 +03:00 [INF] Executed DbCommand (2ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT [MigrationId], [ProductVersion]
FROM [__EFMigrationsHistory]
ORDER BY [MigrationId];
2025-02-06 11:22:29.438 +03:00 [INF] Reverting migration '20250130154447_AddYakeenCitizenAddress'.
2025-02-06 11:22:29.579 +03:00 [INF] Executed DbCommand (55ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
DROP TABLE [CitizenAddressListItem];
2025-02-06 11:22:29.588 +03:00 [INF] Executed DbCommand (7ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
DROP TABLE [YakeenCitizenAddress];
2025-02-06 11:22:29.598 +03:00 [INF] Executed DbCommand (9ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
DELETE FROM [__EFMigrationsHistory]
WHERE [MigrationId] = N'20250130154447_AddYakeenCitizenAddress';
2025-02-06 11:22:29.609 +03:00 [INF] Reverting migration '20250130123514_AddYakeenCitizenInfo'.
2025-02-06 11:22:29.671 +03:00 [INF] Executed DbCommand (28ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
DROP TABLE [YakeenCitizenInfo];
2025-02-06 11:22:29.675 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
DELETE FROM [__EFMigrationsHistory]
WHERE [MigrationId] = N'20250130123514_AddYakeenCitizenInfo';
2025-02-06 11:22:29.697 +03:00 [INF] Reverting migration '20250130114033_AddApiKeysTable'.
2025-02-06 11:22:29.745 +03:00 [INF] Executed DbCommand (19ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
DROP TABLE [ApiKeys];
2025-02-06 11:22:29.752 +03:00 [INF] Executed DbCommand (3ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
DELETE FROM [__EFMigrationsHistory]
WHERE [MigrationId] = N'20250130114033_AddApiKeysTable';
2025-02-06 11:22:29.759 +03:00 [INF] Reverting migration '20250129191919_CreateNayifatSchema'.
2025-02-06 11:22:29.878 +03:00 [INF] Executed DbCommand (25ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
ALTER TABLE [AuthLogs] DROP CONSTRAINT [FK_AuthLogs_Customers_NationalId];
2025-02-06 11:22:29.953 +03:00 [ERR] Failed executing DbCommand (20ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
DROP INDEX [IX_User_Notifications_NationalId_IsRead] ON [User_Notifications];
2025-02-06 12:06:04.294 +03:00 [INF] Starting web application
2025-02-06 12:06:04.391 +03:00 [INF] Now listening on: http://localhost:5264
2025-02-06 12:06:04.396 +03:00 [INF] Application started. Press Ctrl+C to shut down.
2025-02-06 12:06:04.397 +03:00 [INF] Hosting environment: Development
2025-02-06 12:06:04.397 +03:00 [INF] Content root path: C:\Users\yamta\StudioProjects\nayifat_app_2025_new\NayifatAPI
2025-02-06 12:20:57.524 +03:00 [INF] Application is shutting down...
2025-02-06 12:37:27.164 +03:00 [INF] Starting web application
2025-02-06 12:37:27.355 +03:00 [INF] Now listening on: http://localhost:5264
2025-02-06 12:37:27.362 +03:00 [INF] Application started. Press Ctrl+C to shut down.
2025-02-06 12:37:27.364 +03:00 [INF] Hosting environment: Development
2025-02-06 12:37:27.365 +03:00 [INF] Content root path: C:\Users\yamta\StudioProjects\nayifat_app_2025_new\NayifatAPI
2025-02-06 12:44:29.410 +03:00 [INF] Request starting HTTP/1.1 POST http://eb3c-46-152-255-232.ngrok-free.app/api/notifications/list - application/json 39
2025-02-06 12:44:29.520 +03:00 [WRN] Failed to determine the https port for redirect.
2025-02-06 12:44:29.530 +03:00 [INF] Executing endpoint 'NayifatAPI.Controllers.NotificationsController.GetNotifications (NayifatAPI)'
2025-02-06 12:44:29.626 +03:00 [INF] Route matched with {action = "GetNotifications", controller = "Notifications"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetNotifications(NayifatAPI.Controllers.GetNotificationsRequest) on controller NayifatAPI.Controllers.NotificationsController (NayifatAPI).
2025-02-06 12:44:33.630 +03:00 [INF] Executed DbCommand (143ms) [Parameters=[@__providedApiKey_0='?' (Size = 255)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [a].[api_Key], [a].[CreatedAt], [a].[Description], [a].[ExpiresAt], [a].[IsActive], [a].[LastUsedAt]
FROM [ApiKeys] AS [a]
WHERE [a].[api_Key] = @__providedApiKey_0 AND [a].[IsActive] = CAST(1 AS bit)
2025-02-06 12:44:33.976 +03:00 [INF] Executed DbCommand (84ms) [Parameters=[@__request_NationalId_0='?' (Size = 450)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [u].[national_id], [u].[last_updated], [u].[notifications]
FROM [user_notifications] AS [u]
WHERE [u].[national_id] = @__request_NationalId_0
2025-02-06 12:44:34.139 +03:00 [INF] Executed DbCommand (21ms) [Parameters=[@__Parse_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [n].[Id], [n].[additional_data], [n].[big_picture_url], [n].[Body], [n].[body_ar], [n].[body_en], [n].[created_at], [n].[expiry_at], [n].[large_icon_url], [n].[Route], [n].[target_criteria], [n].[Title], [n].[title_ar], [n].[title_en]
FROM [notification_templates] AS [n]
WHERE [n].[Id] = @__Parse_0
2025-02-06 12:44:34.241 +03:00 [INF] Executed DbCommand (8ms) [Parameters=[@__Parse_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [n].[Id], [n].[additional_data], [n].[big_picture_url], [n].[Body], [n].[body_ar], [n].[body_en], [n].[created_at], [n].[expiry_at], [n].[large_icon_url], [n].[Route], [n].[target_criteria], [n].[Title], [n].[title_ar], [n].[title_en]
FROM [notification_templates] AS [n]
WHERE [n].[Id] = @__Parse_0
2025-02-06 12:44:34.299 +03:00 [INF] Executed DbCommand (6ms) [Parameters=[@__Parse_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [n].[Id], [n].[additional_data], [n].[big_picture_url], [n].[Body], [n].[body_ar], [n].[body_en], [n].[created_at], [n].[expiry_at], [n].[large_icon_url], [n].[Route], [n].[target_criteria], [n].[Title], [n].[title_ar], [n].[title_en]
FROM [notification_templates] AS [n]
WHERE [n].[Id] = @__Parse_0
2025-02-06 12:44:34.341 +03:00 [INF] Executed DbCommand (2ms) [Parameters=[@__Parse_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [n].[Id], [n].[additional_data], [n].[big_picture_url], [n].[Body], [n].[body_ar], [n].[body_en], [n].[created_at], [n].[expiry_at], [n].[large_icon_url], [n].[Route], [n].[target_criteria], [n].[Title], [n].[title_ar], [n].[title_en]
FROM [notification_templates] AS [n]
WHERE [n].[Id] = @__Parse_0
2025-02-06 12:44:34.353 +03:00 [INF] Executed DbCommand (2ms) [Parameters=[@__Parse_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [n].[Id], [n].[additional_data], [n].[big_picture_url], [n].[Body], [n].[body_ar], [n].[body_en], [n].[created_at], [n].[expiry_at], [n].[large_icon_url], [n].[Route], [n].[target_criteria], [n].[Title], [n].[title_ar], [n].[title_en]
FROM [notification_templates] AS [n]
WHERE [n].[Id] = @__Parse_0
2025-02-06 12:44:34.369 +03:00 [INF] Executed DbCommand (4ms) [Parameters=[@__Parse_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [n].[Id], [n].[additional_data], [n].[big_picture_url], [n].[Body], [n].[body_ar], [n].[body_en], [n].[created_at], [n].[expiry_at], [n].[large_icon_url], [n].[Route], [n].[target_criteria], [n].[Title], [n].[title_ar], [n].[title_en]
FROM [notification_templates] AS [n]
WHERE [n].[Id] = @__Parse_0
2025-02-06 12:44:34.390 +03:00 [INF] Executed DbCommand (9ms) [Parameters=[@__Parse_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [n].[Id], [n].[additional_data], [n].[big_picture_url], [n].[Body], [n].[body_ar], [n].[body_en], [n].[created_at], [n].[expiry_at], [n].[large_icon_url], [n].[Route], [n].[target_criteria], [n].[Title], [n].[title_ar], [n].[title_en]
FROM [notification_templates] AS [n]
WHERE [n].[Id] = @__Parse_0
2025-02-06 12:44:34.442 +03:00 [INF] Executed DbCommand (5ms) [Parameters=[@__Parse_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [n].[Id], [n].[additional_data], [n].[big_picture_url], [n].[Body], [n].[body_ar], [n].[body_en], [n].[created_at], [n].[expiry_at], [n].[large_icon_url], [n].[Route], [n].[target_criteria], [n].[Title], [n].[title_ar], [n].[title_en]
FROM [notification_templates] AS [n]
WHERE [n].[Id] = @__Parse_0
2025-02-06 12:44:34.454 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@__Parse_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [n].[Id], [n].[additional_data], [n].[big_picture_url], [n].[Body], [n].[body_ar], [n].[body_en], [n].[created_at], [n].[expiry_at], [n].[large_icon_url], [n].[Route], [n].[target_criteria], [n].[Title], [n].[title_ar], [n].[title_en]
FROM [notification_templates] AS [n]
WHERE [n].[Id] = @__Parse_0
2025-02-06 12:44:34.479 +03:00 [INF] Executed DbCommand (12ms) [Parameters=[@__Parse_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [n].[Id], [n].[additional_data], [n].[big_picture_url], [n].[Body], [n].[body_ar], [n].[body_en], [n].[created_at], [n].[expiry_at], [n].[large_icon_url], [n].[Route], [n].[target_criteria], [n].[Title], [n].[title_ar], [n].[title_en]
FROM [notification_templates] AS [n]
WHERE [n].[Id] = @__Parse_0
2025-02-06 12:44:34.501 +03:00 [INF] Executed DbCommand (10ms) [Parameters=[@__Parse_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [n].[Id], [n].[additional_data], [n].[big_picture_url], [n].[Body], [n].[body_ar], [n].[body_en], [n].[created_at], [n].[expiry_at], [n].[large_icon_url], [n].[Route], [n].[target_criteria], [n].[Title], [n].[title_ar], [n].[title_en]
FROM [notification_templates] AS [n]
WHERE [n].[Id] = @__Parse_0
2025-02-06 12:44:34.557 +03:00 [INF] Executed DbCommand (12ms) [Parameters=[@__Parse_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [n].[Id], [n].[additional_data], [n].[big_picture_url], [n].[Body], [n].[body_ar], [n].[body_en], [n].[created_at], [n].[expiry_at], [n].[large_icon_url], [n].[Route], [n].[target_criteria], [n].[Title], [n].[title_ar], [n].[title_en]
FROM [notification_templates] AS [n]
WHERE [n].[Id] = @__Parse_0
2025-02-06 12:44:34.595 +03:00 [INF] Executed DbCommand (5ms) [Parameters=[@__Parse_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [n].[Id], [n].[additional_data], [n].[big_picture_url], [n].[Body], [n].[body_ar], [n].[body_en], [n].[created_at], [n].[expiry_at], [n].[large_icon_url], [n].[Route], [n].[target_criteria], [n].[Title], [n].[title_ar], [n].[title_en]
FROM [notification_templates] AS [n]
WHERE [n].[Id] = @__Parse_0
2025-02-06 12:44:35.814 +03:00 [INF] Executed DbCommand (1,131ms) [Parameters=[@__Parse_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [n].[Id], [n].[additional_data], [n].[big_picture_url], [n].[Body], [n].[body_ar], [n].[body_en], [n].[created_at], [n].[expiry_at], [n].[large_icon_url], [n].[Route], [n].[target_criteria], [n].[Title], [n].[title_ar], [n].[title_en]
FROM [notification_templates] AS [n]
WHERE [n].[Id] = @__Parse_0
2025-02-06 12:44:35.908 +03:00 [INF] Executed DbCommand (21ms) [Parameters=[@__Parse_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [n].[Id], [n].[additional_data], [n].[big_picture_url], [n].[Body], [n].[body_ar], [n].[body_en], [n].[created_at], [n].[expiry_at], [n].[large_icon_url], [n].[Route], [n].[target_criteria], [n].[Title], [n].[title_ar], [n].[title_en]
FROM [notification_templates] AS [n]
WHERE [n].[Id] = @__Parse_0
2025-02-06 12:44:35.950 +03:00 [INF] Executed DbCommand (20ms) [Parameters=[@__Parse_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [n].[Id], [n].[additional_data], [n].[big_picture_url], [n].[Body], [n].[body_ar], [n].[body_en], [n].[created_at], [n].[expiry_at], [n].[large_icon_url], [n].[Route], [n].[target_criteria], [n].[Title], [n].[title_ar], [n].[title_en]
FROM [notification_templates] AS [n]
WHERE [n].[Id] = @__Parse_0
2025-02-06 12:44:35.995 +03:00 [INF] Executed DbCommand (19ms) [Parameters=[@__Parse_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [n].[Id], [n].[additional_data], [n].[big_picture_url], [n].[Body], [n].[body_ar], [n].[body_en], [n].[created_at], [n].[expiry_at], [n].[large_icon_url], [n].[Route], [n].[target_criteria], [n].[Title], [n].[title_ar], [n].[title_en]
FROM [notification_templates] AS [n]
WHERE [n].[Id] = @__Parse_0
2025-02-06 12:44:36.007 +03:00 [INF] Executed DbCommand (4ms) [Parameters=[@__Parse_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [n].[Id], [n].[additional_data], [n].[big_picture_url], [n].[Body], [n].[body_ar], [n].[body_en], [n].[created_at], [n].[expiry_at], [n].[large_icon_url], [n].[Route], [n].[target_criteria], [n].[Title], [n].[title_ar], [n].[title_en]
FROM [notification_templates] AS [n]
WHERE [n].[Id] = @__Parse_0
2025-02-06 12:44:36.014 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@__Parse_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [n].[Id], [n].[additional_data], [n].[big_picture_url], [n].[Body], [n].[body_ar], [n].[body_en], [n].[created_at], [n].[expiry_at], [n].[large_icon_url], [n].[Route], [n].[target_criteria], [n].[Title], [n].[title_ar], [n].[title_en]
FROM [notification_templates] AS [n]
WHERE [n].[Id] = @__Parse_0
2025-02-06 12:44:36.020 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@__Parse_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [n].[Id], [n].[additional_data], [n].[big_picture_url], [n].[Body], [n].[body_ar], [n].[body_en], [n].[created_at], [n].[expiry_at], [n].[large_icon_url], [n].[Route], [n].[target_criteria], [n].[Title], [n].[title_ar], [n].[title_en]
FROM [notification_templates] AS [n]
WHERE [n].[Id] = @__Parse_0
2025-02-06 12:44:36.028 +03:00 [INF] Executed DbCommand (2ms) [Parameters=[@__Parse_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [n].[Id], [n].[additional_data], [n].[big_picture_url], [n].[Body], [n].[body_ar], [n].[body_en], [n].[created_at], [n].[expiry_at], [n].[large_icon_url], [n].[Route], [n].[target_criteria], [n].[Title], [n].[title_ar], [n].[title_en]
FROM [notification_templates] AS [n]
WHERE [n].[Id] = @__Parse_0
2025-02-06 12:44:36.523 +03:00 [INF] Executed DbCommand (29ms) [Parameters=[@p0='?' (Size = 4000), @p1='?' (DbType = DateTime2), @p2='?' (Size = 4000), @p3='?' (Size = 4000), @p4='?' (Size = 4000), @p5='?' (Size = 450), @p6='?' (Size = 4000), @p7='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SET IMPLICIT_TRANSACTIONS OFF;
SET NOCOUNT ON;
INSERT INTO [AuthLogs] ([AuthType], [CreatedAt], [DeviceId], [FailureReason], [IpAddress], [NationalId], [Status], [UserAgent])
OUTPUT INSERTED.[Id]
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7);
2025-02-06 12:44:36.590 +03:00 [ERR] An exception occurred in the database while saving changes for context type 'NayifatAPI.Data.ApplicationDbContext'.
Microsoft.EntityFrameworkCore.DbUpdateException: An error occurred while saving the entity changes. See the inner exception for details.
 ---> Microsoft.Data.SqlClient.SqlException (0x80131904): The INSERT statement conflicted with the FOREIGN KEY constraint "FK_AuthLogs_Customers_NationalId". The conflict occurred in database "NayifatApp", table "dbo.Customers", column 'NationalId'.
   at Microsoft.Data.SqlClient.SqlConnection.OnError(SqlException exception, Boolean breakConnection, Action`1 wrapCloseInAction)
   at Microsoft.Data.SqlClient.SqlInternalConnection.OnError(SqlException exception, Boolean breakConnection, Action`1 wrapCloseInAction)
   at Microsoft.Data.SqlClient.TdsParser.ThrowExceptionAndWarning(TdsParserStateObject stateObj, Boolean callerHasConnectionLock, Boolean asyncClose)
   at Microsoft.Data.SqlClient.TdsParser.TryRun(RunBehavior runBehavior, SqlCommand cmdHandler, SqlDataReader dataStream, BulkCopySimpleResultSet bulkCopyHandler, TdsParserStateObject stateObj, Boolean& dataReady)
   at Microsoft.Data.SqlClient.SqlDataReader.TryHasMoreRows(Boolean& moreRows)
   at Microsoft.Data.SqlClient.SqlDataReader.TryReadInternal(Boolean setTimeout, Boolean& more)
   at Microsoft.Data.SqlClient.SqlDataReader.ReadAsyncExecute(Task task, Object state)
   at Microsoft.Data.SqlClient.SqlDataReader.InvokeAsyncCall[T](SqlDataReaderBaseAsyncCallContext`1 context)
--- End of stack trace from previous location ---
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeResultSetAsync(Int32 startCommandIndex, RelationalDataReader reader, CancellationToken cancellationToken)
ClientConnectionId:ad47bb52-4abc-406d-a804-4dff56238c43
Error Number:547,State:0,Class:16
   --- End of inner exception stack trace ---
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeResultSetAsync(Int32 startCommandIndex, RelationalDataReader reader, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeAsync(RelationalDataReader reader, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Update.Internal.SqlServerModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(IList`1 entriesToSave, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(StateManager stateManager, Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Storage.Internal.SqlServerExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
Microsoft.EntityFrameworkCore.DbUpdateException: An error occurred while saving the entity changes. See the inner exception for details.
 ---> Microsoft.Data.SqlClient.SqlException (0x80131904): The INSERT statement conflicted with the FOREIGN KEY constraint "FK_AuthLogs_Customers_NationalId". The conflict occurred in database "NayifatApp", table "dbo.Customers", column 'NationalId'.
   at Microsoft.Data.SqlClient.SqlConnection.OnError(SqlException exception, Boolean breakConnection, Action`1 wrapCloseInAction)
   at Microsoft.Data.SqlClient.SqlInternalConnection.OnError(SqlException exception, Boolean breakConnection, Action`1 wrapCloseInAction)
   at Microsoft.Data.SqlClient.TdsParser.ThrowExceptionAndWarning(TdsParserStateObject stateObj, Boolean callerHasConnectionLock, Boolean asyncClose)
   at Microsoft.Data.SqlClient.TdsParser.TryRun(RunBehavior runBehavior, SqlCommand cmdHandler, SqlDataReader dataStream, BulkCopySimpleResultSet bulkCopyHandler, TdsParserStateObject stateObj, Boolean& dataReady)
   at Microsoft.Data.SqlClient.SqlDataReader.TryHasMoreRows(Boolean& moreRows)
   at Microsoft.Data.SqlClient.SqlDataReader.TryReadInternal(Boolean setTimeout, Boolean& more)
   at Microsoft.Data.SqlClient.SqlDataReader.ReadAsyncExecute(Task task, Object state)
   at Microsoft.Data.SqlClient.SqlDataReader.InvokeAsyncCall[T](SqlDataReaderBaseAsyncCallContext`1 context)
--- End of stack trace from previous location ---
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeResultSetAsync(Int32 startCommandIndex, RelationalDataReader reader, CancellationToken cancellationToken)
ClientConnectionId:ad47bb52-4abc-406d-a804-4dff56238c43
Error Number:547,State:0,Class:16
   --- End of inner exception stack trace ---
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeResultSetAsync(Int32 startCommandIndex, RelationalDataReader reader, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeAsync(RelationalDataReader reader, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Update.Internal.SqlServerModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(IList`1 entriesToSave, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(StateManager stateManager, Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Storage.Internal.SqlServerExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
2025-02-06 12:44:36.672 +03:00 [ERR] Error logging audit event. NationalId: all, Action: notification_delivered, Details: {"notification_count":21,"notification_ids":[38,37,36,35,34,33,32,31,30,29,28,27,26,25,24,23,23,20,19,18,12],"timestamp":"2025-02-06T12:44:34.0773404"}
Microsoft.EntityFrameworkCore.DbUpdateException: An error occurred while saving the entity changes. See the inner exception for details.
 ---> Microsoft.Data.SqlClient.SqlException (0x80131904): The INSERT statement conflicted with the FOREIGN KEY constraint "FK_AuthLogs_Customers_NationalId". The conflict occurred in database "NayifatApp", table "dbo.Customers", column 'NationalId'.
   at Microsoft.Data.SqlClient.SqlConnection.OnError(SqlException exception, Boolean breakConnection, Action`1 wrapCloseInAction)
   at Microsoft.Data.SqlClient.SqlInternalConnection.OnError(SqlException exception, Boolean breakConnection, Action`1 wrapCloseInAction)
   at Microsoft.Data.SqlClient.TdsParser.ThrowExceptionAndWarning(TdsParserStateObject stateObj, Boolean callerHasConnectionLock, Boolean asyncClose)
   at Microsoft.Data.SqlClient.TdsParser.TryRun(RunBehavior runBehavior, SqlCommand cmdHandler, SqlDataReader dataStream, BulkCopySimpleResultSet bulkCopyHandler, TdsParserStateObject stateObj, Boolean& dataReady)
   at Microsoft.Data.SqlClient.SqlDataReader.TryHasMoreRows(Boolean& moreRows)
   at Microsoft.Data.SqlClient.SqlDataReader.TryReadInternal(Boolean setTimeout, Boolean& more)
   at Microsoft.Data.SqlClient.SqlDataReader.ReadAsyncExecute(Task task, Object state)
   at Microsoft.Data.SqlClient.SqlDataReader.InvokeAsyncCall[T](SqlDataReaderBaseAsyncCallContext`1 context)
--- End of stack trace from previous location ---
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeResultSetAsync(Int32 startCommandIndex, RelationalDataReader reader, CancellationToken cancellationToken)
ClientConnectionId:ad47bb52-4abc-406d-a804-4dff56238c43
Error Number:547,State:0,Class:16
   --- End of inner exception stack trace ---
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeResultSetAsync(Int32 startCommandIndex, RelationalDataReader reader, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeAsync(RelationalDataReader reader, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Update.Internal.SqlServerModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(IList`1 entriesToSave, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(StateManager stateManager, Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Storage.Internal.SqlServerExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at NayifatAPI.Services.AuditLogService.LogAsync(String nationalId, String action, Object details) in C:\Users\yamta\StudioProjects\nayifat_app_2025_new\NayifatAPI\Services\AuditLogService.cs:line 36
2025-02-06 12:44:36.745 +03:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType11`2[[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Object, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-02-06 12:44:36.816 +03:00 [INF] Executed action NayifatAPI.Controllers.NotificationsController.GetNotifications (NayifatAPI) in 7177.3309ms
2025-02-06 12:44:36.823 +03:00 [INF] Executed endpoint 'NayifatAPI.Controllers.NotificationsController.GetNotifications (NayifatAPI)'
2025-02-06 12:44:36.852 +03:00 [INF] Request finished HTTP/1.1 POST http://eb3c-46-152-255-232.ngrok-free.app/api/notifications/list - 200 null application/json; charset=utf-8 7444.2702ms
2025-02-06 12:56:03.974 +03:00 [INF] Request starting HTTP/1.1 POST http://eb3c-46-152-255-232.ngrok-free.app/api/notifications/list - application/json 39
2025-02-06 12:56:04.029 +03:00 [INF] Request starting HTTP/1.1 POST http://eb3c-46-152-255-232.ngrok-free.app/api/notifications/list - application/json 39
2025-02-06 12:56:04.283 +03:00 [INF] Executing endpoint 'NayifatAPI.Controllers.NotificationsController.GetNotifications (NayifatAPI)'
2025-02-06 12:56:04.283 +03:00 [INF] Executing endpoint 'NayifatAPI.Controllers.NotificationsController.GetNotifications (NayifatAPI)'
2025-02-06 12:56:04.287 +03:00 [INF] Route matched with {action = "GetNotifications", controller = "Notifications"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetNotifications(NayifatAPI.Controllers.GetNotificationsRequest) on controller NayifatAPI.Controllers.NotificationsController (NayifatAPI).
2025-02-06 12:56:04.290 +03:00 [INF] Route matched with {action = "GetNotifications", controller = "Notifications"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetNotifications(NayifatAPI.Controllers.GetNotificationsRequest) on controller NayifatAPI.Controllers.NotificationsController (NayifatAPI).
2025-02-06 12:56:04.408 +03:00 [INF] Executed DbCommand (34ms) [Parameters=[@__providedApiKey_0='?' (Size = 255)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [a].[api_Key], [a].[CreatedAt], [a].[Description], [a].[ExpiresAt], [a].[IsActive], [a].[LastUsedAt]
FROM [ApiKeys] AS [a]
WHERE [a].[api_Key] = @__providedApiKey_0 AND [a].[IsActive] = CAST(1 AS bit)
2025-02-06 12:56:04.413 +03:00 [INF] Executed DbCommand (27ms) [Parameters=[@__providedApiKey_0='?' (Size = 255)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [a].[api_Key], [a].[CreatedAt], [a].[Description], [a].[ExpiresAt], [a].[IsActive], [a].[LastUsedAt]
FROM [ApiKeys] AS [a]
WHERE [a].[api_Key] = @__providedApiKey_0 AND [a].[IsActive] = CAST(1 AS bit)
2025-02-06 12:56:04.443 +03:00 [INF] Executed DbCommand (25ms) [Parameters=[@__request_NationalId_0='?' (Size = 450)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [u].[national_id], [u].[last_updated], [u].[notifications]
FROM [user_notifications] AS [u]
WHERE [u].[national_id] = @__request_NationalId_0
2025-02-06 12:56:04.445 +03:00 [INF] Executed DbCommand (25ms) [Parameters=[@__request_NationalId_0='?' (Size = 450)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [u].[national_id], [u].[last_updated], [u].[notifications]
FROM [user_notifications] AS [u]
WHERE [u].[national_id] = @__request_NationalId_0
2025-02-06 12:56:04.504 +03:00 [INF] Executed DbCommand (31ms) [Parameters=[@__Parse_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [n].[Id], [n].[additional_data], [n].[big_picture_url], [n].[Body], [n].[body_ar], [n].[body_en], [n].[created_at], [n].[expiry_at], [n].[large_icon_url], [n].[Route], [n].[target_criteria], [n].[Title], [n].[title_ar], [n].[title_en]
FROM [notification_templates] AS [n]
WHERE [n].[Id] = @__Parse_0
2025-02-06 12:56:04.551 +03:00 [INF] Executed DbCommand (33ms) [Parameters=[@__Parse_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [n].[Id], [n].[additional_data], [n].[big_picture_url], [n].[Body], [n].[body_ar], [n].[body_en], [n].[created_at], [n].[expiry_at], [n].[large_icon_url], [n].[Route], [n].[target_criteria], [n].[Title], [n].[title_ar], [n].[title_en]
FROM [notification_templates] AS [n]
WHERE [n].[Id] = @__Parse_0
2025-02-06 12:56:04.668 +03:00 [INF] Executed DbCommand (11ms) [Parameters=[@__Parse_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [n].[Id], [n].[additional_data], [n].[big_picture_url], [n].[Body], [n].[body_ar], [n].[body_en], [n].[created_at], [n].[expiry_at], [n].[large_icon_url], [n].[Route], [n].[target_criteria], [n].[Title], [n].[title_ar], [n].[title_en]
FROM [notification_templates] AS [n]
WHERE [n].[Id] = @__Parse_0
2025-02-06 12:56:04.675 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@__Parse_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [n].[Id], [n].[additional_data], [n].[big_picture_url], [n].[Body], [n].[body_ar], [n].[body_en], [n].[created_at], [n].[expiry_at], [n].[large_icon_url], [n].[Route], [n].[target_criteria], [n].[Title], [n].[title_ar], [n].[title_en]
FROM [notification_templates] AS [n]
WHERE [n].[Id] = @__Parse_0
2025-02-06 12:56:04.683 +03:00 [INF] Executed DbCommand (27ms) [Parameters=[@__Parse_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [n].[Id], [n].[additional_data], [n].[big_picture_url], [n].[Body], [n].[body_ar], [n].[body_en], [n].[created_at], [n].[expiry_at], [n].[large_icon_url], [n].[Route], [n].[target_criteria], [n].[Title], [n].[title_ar], [n].[title_en]
FROM [notification_templates] AS [n]
WHERE [n].[Id] = @__Parse_0
2025-02-06 12:56:04.700 +03:00 [INF] Executed DbCommand (4ms) [Parameters=[@__Parse_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [n].[Id], [n].[additional_data], [n].[big_picture_url], [n].[Body], [n].[body_ar], [n].[body_en], [n].[created_at], [n].[expiry_at], [n].[large_icon_url], [n].[Route], [n].[target_criteria], [n].[Title], [n].[title_ar], [n].[title_en]
FROM [notification_templates] AS [n]
WHERE [n].[Id] = @__Parse_0
2025-02-06 12:56:04.714 +03:00 [INF] Executed DbCommand (19ms) [Parameters=[@__Parse_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [n].[Id], [n].[additional_data], [n].[big_picture_url], [n].[Body], [n].[body_ar], [n].[body_en], [n].[created_at], [n].[expiry_at], [n].[large_icon_url], [n].[Route], [n].[target_criteria], [n].[Title], [n].[title_ar], [n].[title_en]
FROM [notification_templates] AS [n]
WHERE [n].[Id] = @__Parse_0
2025-02-06 12:56:04.718 +03:00 [INF] Executed DbCommand (5ms) [Parameters=[@__Parse_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [n].[Id], [n].[additional_data], [n].[big_picture_url], [n].[Body], [n].[body_ar], [n].[body_en], [n].[created_at], [n].[expiry_at], [n].[large_icon_url], [n].[Route], [n].[target_criteria], [n].[Title], [n].[title_ar], [n].[title_en]
FROM [notification_templates] AS [n]
WHERE [n].[Id] = @__Parse_0
2025-02-06 12:56:04.760 +03:00 [INF] Executed DbCommand (8ms) [Parameters=[@__Parse_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [n].[Id], [n].[additional_data], [n].[big_picture_url], [n].[Body], [n].[body_ar], [n].[body_en], [n].[created_at], [n].[expiry_at], [n].[large_icon_url], [n].[Route], [n].[target_criteria], [n].[Title], [n].[title_ar], [n].[title_en]
FROM [notification_templates] AS [n]
WHERE [n].[Id] = @__Parse_0
2025-02-06 12:56:04.772 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@__Parse_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [n].[Id], [n].[additional_data], [n].[big_picture_url], [n].[Body], [n].[body_ar], [n].[body_en], [n].[created_at], [n].[expiry_at], [n].[large_icon_url], [n].[Route], [n].[target_criteria], [n].[Title], [n].[title_ar], [n].[title_en]
FROM [notification_templates] AS [n]
WHERE [n].[Id] = @__Parse_0
2025-02-06 12:56:04.773 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@__Parse_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [n].[Id], [n].[additional_data], [n].[big_picture_url], [n].[Body], [n].[body_ar], [n].[body_en], [n].[created_at], [n].[expiry_at], [n].[large_icon_url], [n].[Route], [n].[target_criteria], [n].[Title], [n].[title_ar], [n].[title_en]
FROM [notification_templates] AS [n]
WHERE [n].[Id] = @__Parse_0
2025-02-06 12:56:04.832 +03:00 [INF] Executed DbCommand (2ms) [Parameters=[@__Parse_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [n].[Id], [n].[additional_data], [n].[big_picture_url], [n].[Body], [n].[body_ar], [n].[body_en], [n].[created_at], [n].[expiry_at], [n].[large_icon_url], [n].[Route], [n].[target_criteria], [n].[Title], [n].[title_ar], [n].[title_en]
FROM [notification_templates] AS [n]
WHERE [n].[Id] = @__Parse_0
2025-02-06 12:56:04.863 +03:00 [INF] Executed DbCommand (30ms) [Parameters=[@__Parse_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [n].[Id], [n].[additional_data], [n].[big_picture_url], [n].[Body], [n].[body_ar], [n].[body_en], [n].[created_at], [n].[expiry_at], [n].[large_icon_url], [n].[Route], [n].[target_criteria], [n].[Title], [n].[title_ar], [n].[title_en]
FROM [notification_templates] AS [n]
WHERE [n].[Id] = @__Parse_0
2025-02-06 12:56:04.929 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@__Parse_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [n].[Id], [n].[additional_data], [n].[big_picture_url], [n].[Body], [n].[body_ar], [n].[body_en], [n].[created_at], [n].[expiry_at], [n].[large_icon_url], [n].[Route], [n].[target_criteria], [n].[Title], [n].[title_ar], [n].[title_en]
FROM [notification_templates] AS [n]
WHERE [n].[Id] = @__Parse_0
2025-02-06 12:56:04.974 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@__Parse_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [n].[Id], [n].[additional_data], [n].[big_picture_url], [n].[Body], [n].[body_ar], [n].[body_en], [n].[created_at], [n].[expiry_at], [n].[large_icon_url], [n].[Route], [n].[target_criteria], [n].[Title], [n].[title_ar], [n].[title_en]
FROM [notification_templates] AS [n]
WHERE [n].[Id] = @__Parse_0
2025-02-06 12:56:04.980 +03:00 [INF] Executed DbCommand (2ms) [Parameters=[@__Parse_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [n].[Id], [n].[additional_data], [n].[big_picture_url], [n].[Body], [n].[body_ar], [n].[body_en], [n].[created_at], [n].[expiry_at], [n].[large_icon_url], [n].[Route], [n].[target_criteria], [n].[Title], [n].[title_ar], [n].[title_en]
FROM [notification_templates] AS [n]
WHERE [n].[Id] = @__Parse_0
2025-02-06 12:56:04.986 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@__Parse_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [n].[Id], [n].[additional_data], [n].[big_picture_url], [n].[Body], [n].[body_ar], [n].[body_en], [n].[created_at], [n].[expiry_at], [n].[large_icon_url], [n].[Route], [n].[target_criteria], [n].[Title], [n].[title_ar], [n].[title_en]
FROM [notification_templates] AS [n]
WHERE [n].[Id] = @__Parse_0
2025-02-06 12:56:04.987 +03:00 [INF] Executed DbCommand (12ms) [Parameters=[@__Parse_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [n].[Id], [n].[additional_data], [n].[big_picture_url], [n].[Body], [n].[body_ar], [n].[body_en], [n].[created_at], [n].[expiry_at], [n].[large_icon_url], [n].[Route], [n].[target_criteria], [n].[Title], [n].[title_ar], [n].[title_en]
FROM [notification_templates] AS [n]
WHERE [n].[Id] = @__Parse_0
2025-02-06 12:56:04.999 +03:00 [INF] Executed DbCommand (5ms) [Parameters=[@__Parse_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [n].[Id], [n].[additional_data], [n].[big_picture_url], [n].[Body], [n].[body_ar], [n].[body_en], [n].[created_at], [n].[expiry_at], [n].[large_icon_url], [n].[Route], [n].[target_criteria], [n].[Title], [n].[title_ar], [n].[title_en]
FROM [notification_templates] AS [n]
WHERE [n].[Id] = @__Parse_0
2025-02-06 12:56:05.025 +03:00 [INF] Executed DbCommand (19ms) [Parameters=[@__Parse_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [n].[Id], [n].[additional_data], [n].[big_picture_url], [n].[Body], [n].[body_ar], [n].[body_en], [n].[created_at], [n].[expiry_at], [n].[large_icon_url], [n].[Route], [n].[target_criteria], [n].[Title], [n].[title_ar], [n].[title_en]
FROM [notification_templates] AS [n]
WHERE [n].[Id] = @__Parse_0
2025-02-06 12:56:05.052 +03:00 [INF] Executed DbCommand (4ms) [Parameters=[@__Parse_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [n].[Id], [n].[additional_data], [n].[big_picture_url], [n].[Body], [n].[body_ar], [n].[body_en], [n].[created_at], [n].[expiry_at], [n].[large_icon_url], [n].[Route], [n].[target_criteria], [n].[Title], [n].[title_ar], [n].[title_en]
FROM [notification_templates] AS [n]
WHERE [n].[Id] = @__Parse_0
2025-02-06 12:56:05.055 +03:00 [INF] Executed DbCommand (20ms) [Parameters=[@__Parse_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [n].[Id], [n].[additional_data], [n].[big_picture_url], [n].[Body], [n].[body_ar], [n].[body_en], [n].[created_at], [n].[expiry_at], [n].[large_icon_url], [n].[Route], [n].[target_criteria], [n].[Title], [n].[title_ar], [n].[title_en]
FROM [notification_templates] AS [n]
WHERE [n].[Id] = @__Parse_0
2025-02-06 12:56:05.062 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@__Parse_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [n].[Id], [n].[additional_data], [n].[big_picture_url], [n].[Body], [n].[body_ar], [n].[body_en], [n].[created_at], [n].[expiry_at], [n].[large_icon_url], [n].[Route], [n].[target_criteria], [n].[Title], [n].[title_ar], [n].[title_en]
FROM [notification_templates] AS [n]
WHERE [n].[Id] = @__Parse_0
2025-02-06 12:56:05.063 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@__Parse_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [n].[Id], [n].[additional_data], [n].[big_picture_url], [n].[Body], [n].[body_ar], [n].[body_en], [n].[created_at], [n].[expiry_at], [n].[large_icon_url], [n].[Route], [n].[target_criteria], [n].[Title], [n].[title_ar], [n].[title_en]
FROM [notification_templates] AS [n]
WHERE [n].[Id] = @__Parse_0
2025-02-06 12:56:05.069 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@__Parse_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [n].[Id], [n].[additional_data], [n].[big_picture_url], [n].[Body], [n].[body_ar], [n].[body_en], [n].[created_at], [n].[expiry_at], [n].[large_icon_url], [n].[Route], [n].[target_criteria], [n].[Title], [n].[title_ar], [n].[title_en]
FROM [notification_templates] AS [n]
WHERE [n].[Id] = @__Parse_0
2025-02-06 12:56:05.082 +03:00 [INF] Executed DbCommand (3ms) [Parameters=[@__Parse_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [n].[Id], [n].[additional_data], [n].[big_picture_url], [n].[Body], [n].[body_ar], [n].[body_en], [n].[created_at], [n].[expiry_at], [n].[large_icon_url], [n].[Route], [n].[target_criteria], [n].[Title], [n].[title_ar], [n].[title_en]
FROM [notification_templates] AS [n]
WHERE [n].[Id] = @__Parse_0
2025-02-06 12:56:05.085 +03:00 [INF] Executed DbCommand (4ms) [Parameters=[@__Parse_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [n].[Id], [n].[additional_data], [n].[big_picture_url], [n].[Body], [n].[body_ar], [n].[body_en], [n].[created_at], [n].[expiry_at], [n].[large_icon_url], [n].[Route], [n].[target_criteria], [n].[Title], [n].[title_ar], [n].[title_en]
FROM [notification_templates] AS [n]
WHERE [n].[Id] = @__Parse_0
2025-02-06 12:56:05.101 +03:00 [INF] Executed DbCommand (2ms) [Parameters=[@__Parse_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [n].[Id], [n].[additional_data], [n].[big_picture_url], [n].[Body], [n].[body_ar], [n].[body_en], [n].[created_at], [n].[expiry_at], [n].[large_icon_url], [n].[Route], [n].[target_criteria], [n].[Title], [n].[title_ar], [n].[title_en]
FROM [notification_templates] AS [n]
WHERE [n].[Id] = @__Parse_0
2025-02-06 12:56:05.104 +03:00 [INF] Executed DbCommand (3ms) [Parameters=[@__Parse_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [n].[Id], [n].[additional_data], [n].[big_picture_url], [n].[Body], [n].[body_ar], [n].[body_en], [n].[created_at], [n].[expiry_at], [n].[large_icon_url], [n].[Route], [n].[target_criteria], [n].[Title], [n].[title_ar], [n].[title_en]
FROM [notification_templates] AS [n]
WHERE [n].[Id] = @__Parse_0
2025-02-06 12:56:05.111 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@__Parse_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [n].[Id], [n].[additional_data], [n].[big_picture_url], [n].[Body], [n].[body_ar], [n].[body_en], [n].[created_at], [n].[expiry_at], [n].[large_icon_url], [n].[Route], [n].[target_criteria], [n].[Title], [n].[title_ar], [n].[title_en]
FROM [notification_templates] AS [n]
WHERE [n].[Id] = @__Parse_0
2025-02-06 12:56:05.131 +03:00 [INF] Executed DbCommand (2ms) [Parameters=[@__Parse_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [n].[Id], [n].[additional_data], [n].[big_picture_url], [n].[Body], [n].[body_ar], [n].[body_en], [n].[created_at], [n].[expiry_at], [n].[large_icon_url], [n].[Route], [n].[target_criteria], [n].[Title], [n].[title_ar], [n].[title_en]
FROM [notification_templates] AS [n]
WHERE [n].[Id] = @__Parse_0
2025-02-06 12:56:05.132 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@__Parse_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [n].[Id], [n].[additional_data], [n].[big_picture_url], [n].[Body], [n].[body_ar], [n].[body_en], [n].[created_at], [n].[expiry_at], [n].[large_icon_url], [n].[Route], [n].[target_criteria], [n].[Title], [n].[title_ar], [n].[title_en]
FROM [notification_templates] AS [n]
WHERE [n].[Id] = @__Parse_0
2025-02-06 12:56:05.143 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@__Parse_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [n].[Id], [n].[additional_data], [n].[big_picture_url], [n].[Body], [n].[body_ar], [n].[body_en], [n].[created_at], [n].[expiry_at], [n].[large_icon_url], [n].[Route], [n].[target_criteria], [n].[Title], [n].[title_ar], [n].[title_en]
FROM [notification_templates] AS [n]
WHERE [n].[Id] = @__Parse_0
2025-02-06 12:56:05.152 +03:00 [INF] Executed DbCommand (10ms) [Parameters=[@__Parse_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [n].[Id], [n].[additional_data], [n].[big_picture_url], [n].[Body], [n].[body_ar], [n].[body_en], [n].[created_at], [n].[expiry_at], [n].[large_icon_url], [n].[Route], [n].[target_criteria], [n].[Title], [n].[title_ar], [n].[title_en]
FROM [notification_templates] AS [n]
WHERE [n].[Id] = @__Parse_0
2025-02-06 12:56:05.178 +03:00 [INF] Executed DbCommand (10ms) [Parameters=[@__Parse_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [n].[Id], [n].[additional_data], [n].[big_picture_url], [n].[Body], [n].[body_ar], [n].[body_en], [n].[created_at], [n].[expiry_at], [n].[large_icon_url], [n].[Route], [n].[target_criteria], [n].[Title], [n].[title_ar], [n].[title_en]
FROM [notification_templates] AS [n]
WHERE [n].[Id] = @__Parse_0
2025-02-06 12:56:05.178 +03:00 [INF] Executed DbCommand (3ms) [Parameters=[@__Parse_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [n].[Id], [n].[additional_data], [n].[big_picture_url], [n].[Body], [n].[body_ar], [n].[body_en], [n].[created_at], [n].[expiry_at], [n].[large_icon_url], [n].[Route], [n].[target_criteria], [n].[Title], [n].[title_ar], [n].[title_en]
FROM [notification_templates] AS [n]
WHERE [n].[Id] = @__Parse_0
2025-02-06 12:56:05.187 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@__Parse_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [n].[Id], [n].[additional_data], [n].[big_picture_url], [n].[Body], [n].[body_ar], [n].[body_en], [n].[created_at], [n].[expiry_at], [n].[large_icon_url], [n].[Route], [n].[target_criteria], [n].[Title], [n].[title_ar], [n].[title_en]
FROM [notification_templates] AS [n]
WHERE [n].[Id] = @__Parse_0
2025-02-06 12:56:05.190 +03:00 [INF] Executed DbCommand (2ms) [Parameters=[@__Parse_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [n].[Id], [n].[additional_data], [n].[big_picture_url], [n].[Body], [n].[body_ar], [n].[body_en], [n].[created_at], [n].[expiry_at], [n].[large_icon_url], [n].[Route], [n].[target_criteria], [n].[Title], [n].[title_ar], [n].[title_en]
FROM [notification_templates] AS [n]
WHERE [n].[Id] = @__Parse_0
2025-02-06 12:56:05.191 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@__Parse_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [n].[Id], [n].[additional_data], [n].[big_picture_url], [n].[Body], [n].[body_ar], [n].[body_en], [n].[created_at], [n].[expiry_at], [n].[large_icon_url], [n].[Route], [n].[target_criteria], [n].[Title], [n].[title_ar], [n].[title_en]
FROM [notification_templates] AS [n]
WHERE [n].[Id] = @__Parse_0
2025-02-06 12:56:05.198 +03:00 [INF] Executed DbCommand (3ms) [Parameters=[@__Parse_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [n].[Id], [n].[additional_data], [n].[big_picture_url], [n].[Body], [n].[body_ar], [n].[body_en], [n].[created_at], [n].[expiry_at], [n].[large_icon_url], [n].[Route], [n].[target_criteria], [n].[Title], [n].[title_ar], [n].[title_en]
FROM [notification_templates] AS [n]
WHERE [n].[Id] = @__Parse_0
2025-02-06 12:56:05.204 +03:00 [INF] Executed DbCommand (2ms) [Parameters=[@__Parse_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [n].[Id], [n].[additional_data], [n].[big_picture_url], [n].[Body], [n].[body_ar], [n].[body_en], [n].[created_at], [n].[expiry_at], [n].[large_icon_url], [n].[Route], [n].[target_criteria], [n].[Title], [n].[title_ar], [n].[title_en]
FROM [notification_templates] AS [n]
WHERE [n].[Id] = @__Parse_0
2025-02-06 12:56:05.210 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@__Parse_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [n].[Id], [n].[additional_data], [n].[big_picture_url], [n].[Body], [n].[body_ar], [n].[body_en], [n].[created_at], [n].[expiry_at], [n].[large_icon_url], [n].[Route], [n].[target_criteria], [n].[Title], [n].[title_ar], [n].[title_en]
FROM [notification_templates] AS [n]
WHERE [n].[Id] = @__Parse_0
2025-02-06 12:56:05.225 +03:00 [INF] Executed DbCommand (27ms) [Parameters=[@p0='?' (Size = 4000), @p1='?' (DbType = DateTime2), @p2='?' (Size = 4000), @p3='?' (Size = 4000), @p4='?' (Size = 4000), @p5='?' (Size = 450), @p6='?' (Size = 4000), @p7='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SET IMPLICIT_TRANSACTIONS OFF;
SET NOCOUNT ON;
INSERT INTO [AuthLogs] ([AuthType], [CreatedAt], [DeviceId], [FailureReason], [IpAddress], [NationalId], [Status], [UserAgent])
OUTPUT INSERTED.[Id]
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7);
2025-02-06 12:56:05.225 +03:00 [INF] Executed DbCommand (10ms) [Parameters=[@p0='?' (Size = 4000), @p1='?' (DbType = DateTime2), @p2='?' (Size = 4000), @p3='?' (Size = 4000), @p4='?' (Size = 4000), @p5='?' (Size = 450), @p6='?' (Size = 4000), @p7='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SET IMPLICIT_TRANSACTIONS OFF;
SET NOCOUNT ON;
INSERT INTO [AuthLogs] ([AuthType], [CreatedAt], [DeviceId], [FailureReason], [IpAddress], [NationalId], [Status], [UserAgent])
OUTPUT INSERTED.[Id]
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7);
2025-02-06 12:56:05.233 +03:00 [ERR] An exception occurred in the database while saving changes for context type 'NayifatAPI.Data.ApplicationDbContext'.
Microsoft.EntityFrameworkCore.DbUpdateException: An error occurred while saving the entity changes. See the inner exception for details.
 ---> Microsoft.Data.SqlClient.SqlException (0x80131904): The INSERT statement conflicted with the FOREIGN KEY constraint "FK_AuthLogs_Customers_NationalId". The conflict occurred in database "NayifatApp", table "dbo.Customers", column 'NationalId'.
   at Microsoft.Data.SqlClient.SqlConnection.OnError(SqlException exception, Boolean breakConnection, Action`1 wrapCloseInAction)
   at Microsoft.Data.SqlClient.SqlInternalConnection.OnError(SqlException exception, Boolean breakConnection, Action`1 wrapCloseInAction)
   at Microsoft.Data.SqlClient.TdsParser.ThrowExceptionAndWarning(TdsParserStateObject stateObj, Boolean callerHasConnectionLock, Boolean asyncClose)
   at Microsoft.Data.SqlClient.TdsParser.TryRun(RunBehavior runBehavior, SqlCommand cmdHandler, SqlDataReader dataStream, BulkCopySimpleResultSet bulkCopyHandler, TdsParserStateObject stateObj, Boolean& dataReady)
   at Microsoft.Data.SqlClient.SqlDataReader.TryHasMoreRows(Boolean& moreRows)
   at Microsoft.Data.SqlClient.SqlDataReader.TryReadInternal(Boolean setTimeout, Boolean& more)
   at Microsoft.Data.SqlClient.SqlDataReader.ReadAsyncExecute(Task task, Object state)
   at Microsoft.Data.SqlClient.SqlDataReader.InvokeAsyncCall[T](SqlDataReaderBaseAsyncCallContext`1 context)
--- End of stack trace from previous location ---
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeResultSetAsync(Int32 startCommandIndex, RelationalDataReader reader, CancellationToken cancellationToken)
ClientConnectionId:c5a415ff-f843-4f82-ba16-5685b2f74879
Error Number:547,State:0,Class:16
   --- End of inner exception stack trace ---
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeResultSetAsync(Int32 startCommandIndex, RelationalDataReader reader, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeAsync(RelationalDataReader reader, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Update.Internal.SqlServerModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(IList`1 entriesToSave, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(StateManager stateManager, Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Storage.Internal.SqlServerExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
Microsoft.EntityFrameworkCore.DbUpdateException: An error occurred while saving the entity changes. See the inner exception for details.
 ---> Microsoft.Data.SqlClient.SqlException (0x80131904): The INSERT statement conflicted with the FOREIGN KEY constraint "FK_AuthLogs_Customers_NationalId". The conflict occurred in database "NayifatApp", table "dbo.Customers", column 'NationalId'.
   at Microsoft.Data.SqlClient.SqlConnection.OnError(SqlException exception, Boolean breakConnection, Action`1 wrapCloseInAction)
   at Microsoft.Data.SqlClient.SqlInternalConnection.OnError(SqlException exception, Boolean breakConnection, Action`1 wrapCloseInAction)
   at Microsoft.Data.SqlClient.TdsParser.ThrowExceptionAndWarning(TdsParserStateObject stateObj, Boolean callerHasConnectionLock, Boolean asyncClose)
   at Microsoft.Data.SqlClient.TdsParser.TryRun(RunBehavior runBehavior, SqlCommand cmdHandler, SqlDataReader dataStream, BulkCopySimpleResultSet bulkCopyHandler, TdsParserStateObject stateObj, Boolean& dataReady)
   at Microsoft.Data.SqlClient.SqlDataReader.TryHasMoreRows(Boolean& moreRows)
   at Microsoft.Data.SqlClient.SqlDataReader.TryReadInternal(Boolean setTimeout, Boolean& more)
   at Microsoft.Data.SqlClient.SqlDataReader.ReadAsyncExecute(Task task, Object state)
   at Microsoft.Data.SqlClient.SqlDataReader.InvokeAsyncCall[T](SqlDataReaderBaseAsyncCallContext`1 context)
--- End of stack trace from previous location ---
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeResultSetAsync(Int32 startCommandIndex, RelationalDataReader reader, CancellationToken cancellationToken)
ClientConnectionId:c5a415ff-f843-4f82-ba16-5685b2f74879
Error Number:547,State:0,Class:16
   --- End of inner exception stack trace ---
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeResultSetAsync(Int32 startCommandIndex, RelationalDataReader reader, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeAsync(RelationalDataReader reader, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Update.Internal.SqlServerModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(IList`1 entriesToSave, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(StateManager stateManager, Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Storage.Internal.SqlServerExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
2025-02-06 12:56:05.234 +03:00 [ERR] An exception occurred in the database while saving changes for context type 'NayifatAPI.Data.ApplicationDbContext'.
Microsoft.EntityFrameworkCore.DbUpdateException: An error occurred while saving the entity changes. See the inner exception for details.
 ---> Microsoft.Data.SqlClient.SqlException (0x80131904): The INSERT statement conflicted with the FOREIGN KEY constraint "FK_AuthLogs_Customers_NationalId". The conflict occurred in database "NayifatApp", table "dbo.Customers", column 'NationalId'.
   at Microsoft.Data.SqlClient.SqlConnection.OnError(SqlException exception, Boolean breakConnection, Action`1 wrapCloseInAction)
   at Microsoft.Data.SqlClient.SqlInternalConnection.OnError(SqlException exception, Boolean breakConnection, Action`1 wrapCloseInAction)
   at Microsoft.Data.SqlClient.TdsParser.ThrowExceptionAndWarning(TdsParserStateObject stateObj, Boolean callerHasConnectionLock, Boolean asyncClose)
   at Microsoft.Data.SqlClient.TdsParser.TryRun(RunBehavior runBehavior, SqlCommand cmdHandler, SqlDataReader dataStream, BulkCopySimpleResultSet bulkCopyHandler, TdsParserStateObject stateObj, Boolean& dataReady)
   at Microsoft.Data.SqlClient.SqlDataReader.TryHasMoreRows(Boolean& moreRows)
   at Microsoft.Data.SqlClient.SqlDataReader.TryReadInternal(Boolean setTimeout, Boolean& more)
   at Microsoft.Data.SqlClient.SqlDataReader.ReadAsyncExecute(Task task, Object state)
   at Microsoft.Data.SqlClient.SqlDataReader.InvokeAsyncCall[T](SqlDataReaderBaseAsyncCallContext`1 context)
--- End of stack trace from previous location ---
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeResultSetAsync(Int32 startCommandIndex, RelationalDataReader reader, CancellationToken cancellationToken)
ClientConnectionId:32f3b366-b01c-4de0-91c1-7bae64dff2f4
Error Number:547,State:0,Class:16
   --- End of inner exception stack trace ---
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeResultSetAsync(Int32 startCommandIndex, RelationalDataReader reader, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeAsync(RelationalDataReader reader, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Update.Internal.SqlServerModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(IList`1 entriesToSave, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(StateManager stateManager, Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Storage.Internal.SqlServerExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
Microsoft.EntityFrameworkCore.DbUpdateException: An error occurred while saving the entity changes. See the inner exception for details.
 ---> Microsoft.Data.SqlClient.SqlException (0x80131904): The INSERT statement conflicted with the FOREIGN KEY constraint "FK_AuthLogs_Customers_NationalId". The conflict occurred in database "NayifatApp", table "dbo.Customers", column 'NationalId'.
   at Microsoft.Data.SqlClient.SqlConnection.OnError(SqlException exception, Boolean breakConnection, Action`1 wrapCloseInAction)
   at Microsoft.Data.SqlClient.SqlInternalConnection.OnError(SqlException exception, Boolean breakConnection, Action`1 wrapCloseInAction)
   at Microsoft.Data.SqlClient.TdsParser.ThrowExceptionAndWarning(TdsParserStateObject stateObj, Boolean callerHasConnectionLock, Boolean asyncClose)
   at Microsoft.Data.SqlClient.TdsParser.TryRun(RunBehavior runBehavior, SqlCommand cmdHandler, SqlDataReader dataStream, BulkCopySimpleResultSet bulkCopyHandler, TdsParserStateObject stateObj, Boolean& dataReady)
   at Microsoft.Data.SqlClient.SqlDataReader.TryHasMoreRows(Boolean& moreRows)
   at Microsoft.Data.SqlClient.SqlDataReader.TryReadInternal(Boolean setTimeout, Boolean& more)
   at Microsoft.Data.SqlClient.SqlDataReader.ReadAsyncExecute(Task task, Object state)
   at Microsoft.Data.SqlClient.SqlDataReader.InvokeAsyncCall[T](SqlDataReaderBaseAsyncCallContext`1 context)
--- End of stack trace from previous location ---
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeResultSetAsync(Int32 startCommandIndex, RelationalDataReader reader, CancellationToken cancellationToken)
ClientConnectionId:32f3b366-b01c-4de0-91c1-7bae64dff2f4
Error Number:547,State:0,Class:16
   --- End of inner exception stack trace ---
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeResultSetAsync(Int32 startCommandIndex, RelationalDataReader reader, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeAsync(RelationalDataReader reader, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Update.Internal.SqlServerModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(IList`1 entriesToSave, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(StateManager stateManager, Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Storage.Internal.SqlServerExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
2025-02-06 12:56:05.251 +03:00 [ERR] Error logging audit event. NationalId: all, Action: notification_delivered, Details: {"notification_count":21,"notification_ids":[38,37,36,35,34,33,32,31,30,29,28,27,26,25,24,23,23,20,19,18,12],"timestamp":"2025-02-06T12:56:04.4715695"}
Microsoft.EntityFrameworkCore.DbUpdateException: An error occurred while saving the entity changes. See the inner exception for details.
 ---> Microsoft.Data.SqlClient.SqlException (0x80131904): The INSERT statement conflicted with the FOREIGN KEY constraint "FK_AuthLogs_Customers_NationalId". The conflict occurred in database "NayifatApp", table "dbo.Customers", column 'NationalId'.
   at Microsoft.Data.SqlClient.SqlConnection.OnError(SqlException exception, Boolean breakConnection, Action`1 wrapCloseInAction)
   at Microsoft.Data.SqlClient.SqlInternalConnection.OnError(SqlException exception, Boolean breakConnection, Action`1 wrapCloseInAction)
   at Microsoft.Data.SqlClient.TdsParser.ThrowExceptionAndWarning(TdsParserStateObject stateObj, Boolean callerHasConnectionLock, Boolean asyncClose)
   at Microsoft.Data.SqlClient.TdsParser.TryRun(RunBehavior runBehavior, SqlCommand cmdHandler, SqlDataReader dataStream, BulkCopySimpleResultSet bulkCopyHandler, TdsParserStateObject stateObj, Boolean& dataReady)
   at Microsoft.Data.SqlClient.SqlDataReader.TryHasMoreRows(Boolean& moreRows)
   at Microsoft.Data.SqlClient.SqlDataReader.TryReadInternal(Boolean setTimeout, Boolean& more)
   at Microsoft.Data.SqlClient.SqlDataReader.ReadAsyncExecute(Task task, Object state)
   at Microsoft.Data.SqlClient.SqlDataReader.InvokeAsyncCall[T](SqlDataReaderBaseAsyncCallContext`1 context)
--- End of stack trace from previous location ---
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeResultSetAsync(Int32 startCommandIndex, RelationalDataReader reader, CancellationToken cancellationToken)
ClientConnectionId:c5a415ff-f843-4f82-ba16-5685b2f74879
Error Number:547,State:0,Class:16
   --- End of inner exception stack trace ---
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeResultSetAsync(Int32 startCommandIndex, RelationalDataReader reader, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeAsync(RelationalDataReader reader, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Update.Internal.SqlServerModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(IList`1 entriesToSave, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(StateManager stateManager, Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Storage.Internal.SqlServerExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at NayifatAPI.Services.AuditLogService.LogAsync(String nationalId, String action, Object details) in C:\Users\yamta\StudioProjects\nayifat_app_2025_new\NayifatAPI\Services\AuditLogService.cs:line 36
2025-02-06 12:56:05.266 +03:00 [ERR] Error logging audit event. NationalId: all, Action: notification_delivered, Details: {"notification_count":21,"notification_ids":[38,37,36,35,34,33,32,31,30,29,28,27,26,25,24,23,23,20,19,18,12],"timestamp":"2025-02-06T12:56:04.51671"}
Microsoft.EntityFrameworkCore.DbUpdateException: An error occurred while saving the entity changes. See the inner exception for details.
 ---> Microsoft.Data.SqlClient.SqlException (0x80131904): The INSERT statement conflicted with the FOREIGN KEY constraint "FK_AuthLogs_Customers_NationalId". The conflict occurred in database "NayifatApp", table "dbo.Customers", column 'NationalId'.
   at Microsoft.Data.SqlClient.SqlConnection.OnError(SqlException exception, Boolean breakConnection, Action`1 wrapCloseInAction)
   at Microsoft.Data.SqlClient.SqlInternalConnection.OnError(SqlException exception, Boolean breakConnection, Action`1 wrapCloseInAction)
   at Microsoft.Data.SqlClient.TdsParser.ThrowExceptionAndWarning(TdsParserStateObject stateObj, Boolean callerHasConnectionLock, Boolean asyncClose)
   at Microsoft.Data.SqlClient.TdsParser.TryRun(RunBehavior runBehavior, SqlCommand cmdHandler, SqlDataReader dataStream, BulkCopySimpleResultSet bulkCopyHandler, TdsParserStateObject stateObj, Boolean& dataReady)
   at Microsoft.Data.SqlClient.SqlDataReader.TryHasMoreRows(Boolean& moreRows)
   at Microsoft.Data.SqlClient.SqlDataReader.TryReadInternal(Boolean setTimeout, Boolean& more)
   at Microsoft.Data.SqlClient.SqlDataReader.ReadAsyncExecute(Task task, Object state)
   at Microsoft.Data.SqlClient.SqlDataReader.InvokeAsyncCall[T](SqlDataReaderBaseAsyncCallContext`1 context)
--- End of stack trace from previous location ---
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeResultSetAsync(Int32 startCommandIndex, RelationalDataReader reader, CancellationToken cancellationToken)
ClientConnectionId:32f3b366-b01c-4de0-91c1-7bae64dff2f4
Error Number:547,State:0,Class:16
   --- End of inner exception stack trace ---
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeResultSetAsync(Int32 startCommandIndex, RelationalDataReader reader, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeAsync(RelationalDataReader reader, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Update.Internal.SqlServerModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(IList`1 entriesToSave, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(StateManager stateManager, Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Storage.Internal.SqlServerExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at NayifatAPI.Services.AuditLogService.LogAsync(String nationalId, String action, Object details) in C:\Users\yamta\StudioProjects\nayifat_app_2025_new\NayifatAPI\Services\AuditLogService.cs:line 36
2025-02-06 12:56:05.280 +03:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType11`2[[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Object, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-02-06 12:56:05.309 +03:00 [INF] Executed action NayifatAPI.Controllers.NotificationsController.GetNotifications (NayifatAPI) in 1013.1087ms
2025-02-06 12:56:05.310 +03:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType11`2[[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Object, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-02-06 12:56:05.311 +03:00 [INF] Executed endpoint 'NayifatAPI.Controllers.NotificationsController.GetNotifications (NayifatAPI)'
2025-02-06 12:56:05.312 +03:00 [INF] Executed action NayifatAPI.Controllers.NotificationsController.GetNotifications (NayifatAPI) in 1018.7644ms
2025-02-06 12:56:05.314 +03:00 [INF] Request finished HTTP/1.1 POST http://eb3c-46-152-255-232.ngrok-free.app/api/notifications/list - 200 null application/json; charset=utf-8 1340.0127ms
2025-02-06 12:56:05.315 +03:00 [INF] Executed endpoint 'NayifatAPI.Controllers.NotificationsController.GetNotifications (NayifatAPI)'
2025-02-06 12:56:05.321 +03:00 [INF] Request finished HTTP/1.1 POST http://eb3c-46-152-255-232.ngrok-free.app/api/notifications/list - 200 null application/json; charset=utf-8 1292.2969ms
2025-02-06 13:25:28.652 +03:00 [INF] Request starting HTTP/1.1 POST http://eb3c-46-152-255-232.ngrok-free.app/api/notifications/list - application/json 39
2025-02-06 13:25:28.656 +03:00 [INF] Executing endpoint 'NayifatAPI.Controllers.NotificationsController.GetNotifications (NayifatAPI)'
2025-02-06 13:25:28.658 +03:00 [INF] Route matched with {action = "GetNotifications", controller = "Notifications"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetNotifications(NayifatAPI.Controllers.GetNotificationsRequest) on controller NayifatAPI.Controllers.NotificationsController (NayifatAPI).
2025-02-06 13:25:28.691 +03:00 [INF] Request starting HTTP/1.1 POST http://eb3c-46-152-255-232.ngrok-free.app/api/notifications/list - application/json 39
2025-02-06 13:25:28.694 +03:00 [INF] Executing endpoint 'NayifatAPI.Controllers.NotificationsController.GetNotifications (NayifatAPI)'
2025-02-06 13:25:28.695 +03:00 [INF] Route matched with {action = "GetNotifications", controller = "Notifications"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetNotifications(NayifatAPI.Controllers.GetNotificationsRequest) on controller NayifatAPI.Controllers.NotificationsController (NayifatAPI).
2025-02-06 13:25:28.821 +03:00 [INF] Executed DbCommand (77ms) [Parameters=[@__providedApiKey_0='?' (Size = 255)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [a].[api_Key], [a].[CreatedAt], [a].[Description], [a].[ExpiresAt], [a].[IsActive], [a].[LastUsedAt]
FROM [ApiKeys] AS [a]
WHERE [a].[api_Key] = @__providedApiKey_0 AND [a].[IsActive] = CAST(1 AS bit)
2025-02-06 13:25:28.821 +03:00 [INF] Executed DbCommand (84ms) [Parameters=[@__providedApiKey_0='?' (Size = 255)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [a].[api_Key], [a].[CreatedAt], [a].[Description], [a].[ExpiresAt], [a].[IsActive], [a].[LastUsedAt]
FROM [ApiKeys] AS [a]
WHERE [a].[api_Key] = @__providedApiKey_0 AND [a].[IsActive] = CAST(1 AS bit)
2025-02-06 13:25:29.109 +03:00 [INF] Executed DbCommand (284ms) [Parameters=[@__request_NationalId_0='?' (Size = 450)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [u].[national_id], [u].[last_updated], [u].[notifications]
FROM [user_notifications] AS [u]
WHERE [u].[national_id] = @__request_NationalId_0
2025-02-06 13:25:29.109 +03:00 [INF] Executed DbCommand (280ms) [Parameters=[@__request_NationalId_0='?' (Size = 450)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [u].[national_id], [u].[last_updated], [u].[notifications]
FROM [user_notifications] AS [u]
WHERE [u].[national_id] = @__request_NationalId_0
2025-02-06 13:25:29.119 +03:00 [INF] Executed DbCommand (6ms) [Parameters=[@__Parse_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [n].[Id], [n].[additional_data], [n].[big_picture_url], [n].[Body], [n].[body_ar], [n].[body_en], [n].[created_at], [n].[expiry_at], [n].[large_icon_url], [n].[Route], [n].[target_criteria], [n].[Title], [n].[title_ar], [n].[title_en]
FROM [notification_templates] AS [n]
WHERE [n].[Id] = @__Parse_0
2025-02-06 13:25:29.119 +03:00 [INF] Executed DbCommand (3ms) [Parameters=[@__Parse_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [n].[Id], [n].[additional_data], [n].[big_picture_url], [n].[Body], [n].[body_ar], [n].[body_en], [n].[created_at], [n].[expiry_at], [n].[large_icon_url], [n].[Route], [n].[target_criteria], [n].[Title], [n].[title_ar], [n].[title_en]
FROM [notification_templates] AS [n]
WHERE [n].[Id] = @__Parse_0
2025-02-06 13:25:29.123 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@__Parse_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [n].[Id], [n].[additional_data], [n].[big_picture_url], [n].[Body], [n].[body_ar], [n].[body_en], [n].[created_at], [n].[expiry_at], [n].[large_icon_url], [n].[Route], [n].[target_criteria], [n].[Title], [n].[title_ar], [n].[title_en]
FROM [notification_templates] AS [n]
WHERE [n].[Id] = @__Parse_0
2025-02-06 13:25:29.124 +03:00 [INF] Executed DbCommand (0ms) [Parameters=[@__Parse_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [n].[Id], [n].[additional_data], [n].[big_picture_url], [n].[Body], [n].[body_ar], [n].[body_en], [n].[created_at], [n].[expiry_at], [n].[large_icon_url], [n].[Route], [n].[target_criteria], [n].[Title], [n].[title_ar], [n].[title_en]
FROM [notification_templates] AS [n]
WHERE [n].[Id] = @__Parse_0
2025-02-06 13:25:29.127 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@__Parse_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [n].[Id], [n].[additional_data], [n].[big_picture_url], [n].[Body], [n].[body_ar], [n].[body_en], [n].[created_at], [n].[expiry_at], [n].[large_icon_url], [n].[Route], [n].[target_criteria], [n].[Title], [n].[title_ar], [n].[title_en]
FROM [notification_templates] AS [n]
WHERE [n].[Id] = @__Parse_0
2025-02-06 13:25:29.128 +03:00 [INF] Executed DbCommand (0ms) [Parameters=[@__Parse_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [n].[Id], [n].[additional_data], [n].[big_picture_url], [n].[Body], [n].[body_ar], [n].[body_en], [n].[created_at], [n].[expiry_at], [n].[large_icon_url], [n].[Route], [n].[target_criteria], [n].[Title], [n].[title_ar], [n].[title_en]
FROM [notification_templates] AS [n]
WHERE [n].[Id] = @__Parse_0
2025-02-06 13:25:29.129 +03:00 [INF] Executed DbCommand (0ms) [Parameters=[@__Parse_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [n].[Id], [n].[additional_data], [n].[big_picture_url], [n].[Body], [n].[body_ar], [n].[body_en], [n].[created_at], [n].[expiry_at], [n].[large_icon_url], [n].[Route], [n].[target_criteria], [n].[Title], [n].[title_ar], [n].[title_en]
FROM [notification_templates] AS [n]
WHERE [n].[Id] = @__Parse_0
2025-02-06 13:25:29.131 +03:00 [INF] Executed DbCommand (0ms) [Parameters=[@__Parse_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [n].[Id], [n].[additional_data], [n].[big_picture_url], [n].[Body], [n].[body_ar], [n].[body_en], [n].[created_at], [n].[expiry_at], [n].[large_icon_url], [n].[Route], [n].[target_criteria], [n].[Title], [n].[title_ar], [n].[title_en]
FROM [notification_templates] AS [n]
WHERE [n].[Id] = @__Parse_0
2025-02-06 13:25:29.134 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@__Parse_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [n].[Id], [n].[additional_data], [n].[big_picture_url], [n].[Body], [n].[body_ar], [n].[body_en], [n].[created_at], [n].[expiry_at], [n].[large_icon_url], [n].[Route], [n].[target_criteria], [n].[Title], [n].[title_ar], [n].[title_en]
FROM [notification_templates] AS [n]
WHERE [n].[Id] = @__Parse_0
2025-02-06 13:25:29.135 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@__Parse_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [n].[Id], [n].[additional_data], [n].[big_picture_url], [n].[Body], [n].[body_ar], [n].[body_en], [n].[created_at], [n].[expiry_at], [n].[large_icon_url], [n].[Route], [n].[target_criteria], [n].[Title], [n].[title_ar], [n].[title_en]
FROM [notification_templates] AS [n]
WHERE [n].[Id] = @__Parse_0
2025-02-06 13:25:29.138 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@__Parse_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [n].[Id], [n].[additional_data], [n].[big_picture_url], [n].[Body], [n].[body_ar], [n].[body_en], [n].[created_at], [n].[expiry_at], [n].[large_icon_url], [n].[Route], [n].[target_criteria], [n].[Title], [n].[title_ar], [n].[title_en]
FROM [notification_templates] AS [n]
WHERE [n].[Id] = @__Parse_0
2025-02-06 13:25:29.139 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@__Parse_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [n].[Id], [n].[additional_data], [n].[big_picture_url], [n].[Body], [n].[body_ar], [n].[body_en], [n].[created_at], [n].[expiry_at], [n].[large_icon_url], [n].[Route], [n].[target_criteria], [n].[Title], [n].[title_ar], [n].[title_en]
FROM [notification_templates] AS [n]
WHERE [n].[Id] = @__Parse_0
2025-02-06 13:25:29.142 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@__Parse_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [n].[Id], [n].[additional_data], [n].[big_picture_url], [n].[Body], [n].[body_ar], [n].[body_en], [n].[created_at], [n].[expiry_at], [n].[large_icon_url], [n].[Route], [n].[target_criteria], [n].[Title], [n].[title_ar], [n].[title_en]
FROM [notification_templates] AS [n]
WHERE [n].[Id] = @__Parse_0
2025-02-06 13:25:29.144 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@__Parse_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [n].[Id], [n].[additional_data], [n].[big_picture_url], [n].[Body], [n].[body_ar], [n].[body_en], [n].[created_at], [n].[expiry_at], [n].[large_icon_url], [n].[Route], [n].[target_criteria], [n].[Title], [n].[title_ar], [n].[title_en]
FROM [notification_templates] AS [n]
WHERE [n].[Id] = @__Parse_0
2025-02-06 13:25:29.147 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@__Parse_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [n].[Id], [n].[additional_data], [n].[big_picture_url], [n].[Body], [n].[body_ar], [n].[body_en], [n].[created_at], [n].[expiry_at], [n].[large_icon_url], [n].[Route], [n].[target_criteria], [n].[Title], [n].[title_ar], [n].[title_en]
FROM [notification_templates] AS [n]
WHERE [n].[Id] = @__Parse_0
2025-02-06 13:25:29.150 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@__Parse_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [n].[Id], [n].[additional_data], [n].[big_picture_url], [n].[Body], [n].[body_ar], [n].[body_en], [n].[created_at], [n].[expiry_at], [n].[large_icon_url], [n].[Route], [n].[target_criteria], [n].[Title], [n].[title_ar], [n].[title_en]
FROM [notification_templates] AS [n]
WHERE [n].[Id] = @__Parse_0
2025-02-06 13:25:29.152 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@__Parse_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [n].[Id], [n].[additional_data], [n].[big_picture_url], [n].[Body], [n].[body_ar], [n].[body_en], [n].[created_at], [n].[expiry_at], [n].[large_icon_url], [n].[Route], [n].[target_criteria], [n].[Title], [n].[title_ar], [n].[title_en]
FROM [notification_templates] AS [n]
WHERE [n].[Id] = @__Parse_0
2025-02-06 13:25:29.155 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@__Parse_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [n].[Id], [n].[additional_data], [n].[big_picture_url], [n].[Body], [n].[body_ar], [n].[body_en], [n].[created_at], [n].[expiry_at], [n].[large_icon_url], [n].[Route], [n].[target_criteria], [n].[Title], [n].[title_ar], [n].[title_en]
FROM [notification_templates] AS [n]
WHERE [n].[Id] = @__Parse_0
2025-02-06 13:25:29.157 +03:00 [INF] Executed DbCommand (0ms) [Parameters=[@__Parse_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [n].[Id], [n].[additional_data], [n].[big_picture_url], [n].[Body], [n].[body_ar], [n].[body_en], [n].[created_at], [n].[expiry_at], [n].[large_icon_url], [n].[Route], [n].[target_criteria], [n].[Title], [n].[title_ar], [n].[title_en]
FROM [notification_templates] AS [n]
WHERE [n].[Id] = @__Parse_0
2025-02-06 13:25:29.159 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@__Parse_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [n].[Id], [n].[additional_data], [n].[big_picture_url], [n].[Body], [n].[body_ar], [n].[body_en], [n].[created_at], [n].[expiry_at], [n].[large_icon_url], [n].[Route], [n].[target_criteria], [n].[Title], [n].[title_ar], [n].[title_en]
FROM [notification_templates] AS [n]
WHERE [n].[Id] = @__Parse_0
2025-02-06 13:25:29.162 +03:00 [INF] Executed DbCommand (0ms) [Parameters=[@__Parse_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [n].[Id], [n].[additional_data], [n].[big_picture_url], [n].[Body], [n].[body_ar], [n].[body_en], [n].[created_at], [n].[expiry_at], [n].[large_icon_url], [n].[Route], [n].[target_criteria], [n].[Title], [n].[title_ar], [n].[title_en]
FROM [notification_templates] AS [n]
WHERE [n].[Id] = @__Parse_0
2025-02-06 13:25:29.164 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@__Parse_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [n].[Id], [n].[additional_data], [n].[big_picture_url], [n].[Body], [n].[body_ar], [n].[body_en], [n].[created_at], [n].[expiry_at], [n].[large_icon_url], [n].[Route], [n].[target_criteria], [n].[Title], [n].[title_ar], [n].[title_en]
FROM [notification_templates] AS [n]
WHERE [n].[Id] = @__Parse_0
2025-02-06 13:25:29.166 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@__Parse_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [n].[Id], [n].[additional_data], [n].[big_picture_url], [n].[Body], [n].[body_ar], [n].[body_en], [n].[created_at], [n].[expiry_at], [n].[large_icon_url], [n].[Route], [n].[target_criteria], [n].[Title], [n].[title_ar], [n].[title_en]
FROM [notification_templates] AS [n]
WHERE [n].[Id] = @__Parse_0
2025-02-06 13:25:29.170 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@__Parse_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [n].[Id], [n].[additional_data], [n].[big_picture_url], [n].[Body], [n].[body_ar], [n].[body_en], [n].[created_at], [n].[expiry_at], [n].[large_icon_url], [n].[Route], [n].[target_criteria], [n].[Title], [n].[title_ar], [n].[title_en]
FROM [notification_templates] AS [n]
WHERE [n].[Id] = @__Parse_0
2025-02-06 13:25:29.172 +03:00 [INF] Executed DbCommand (0ms) [Parameters=[@__Parse_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [n].[Id], [n].[additional_data], [n].[big_picture_url], [n].[Body], [n].[body_ar], [n].[body_en], [n].[created_at], [n].[expiry_at], [n].[large_icon_url], [n].[Route], [n].[target_criteria], [n].[Title], [n].[title_ar], [n].[title_en]
FROM [notification_templates] AS [n]
WHERE [n].[Id] = @__Parse_0
2025-02-06 13:25:29.174 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@__Parse_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [n].[Id], [n].[additional_data], [n].[big_picture_url], [n].[Body], [n].[body_ar], [n].[body_en], [n].[created_at], [n].[expiry_at], [n].[large_icon_url], [n].[Route], [n].[target_criteria], [n].[Title], [n].[title_ar], [n].[title_en]
FROM [notification_templates] AS [n]
WHERE [n].[Id] = @__Parse_0
2025-02-06 13:25:29.176 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@__Parse_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [n].[Id], [n].[additional_data], [n].[big_picture_url], [n].[Body], [n].[body_ar], [n].[body_en], [n].[created_at], [n].[expiry_at], [n].[large_icon_url], [n].[Route], [n].[target_criteria], [n].[Title], [n].[title_ar], [n].[title_en]
FROM [notification_templates] AS [n]
WHERE [n].[Id] = @__Parse_0
2025-02-06 13:25:29.178 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@__Parse_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [n].[Id], [n].[additional_data], [n].[big_picture_url], [n].[Body], [n].[body_ar], [n].[body_en], [n].[created_at], [n].[expiry_at], [n].[large_icon_url], [n].[Route], [n].[target_criteria], [n].[Title], [n].[title_ar], [n].[title_en]
FROM [notification_templates] AS [n]
WHERE [n].[Id] = @__Parse_0
2025-02-06 13:25:29.181 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@__Parse_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [n].[Id], [n].[additional_data], [n].[big_picture_url], [n].[Body], [n].[body_ar], [n].[body_en], [n].[created_at], [n].[expiry_at], [n].[large_icon_url], [n].[Route], [n].[target_criteria], [n].[Title], [n].[title_ar], [n].[title_en]
FROM [notification_templates] AS [n]
WHERE [n].[Id] = @__Parse_0
2025-02-06 13:25:29.183 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@__Parse_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [n].[Id], [n].[additional_data], [n].[big_picture_url], [n].[Body], [n].[body_ar], [n].[body_en], [n].[created_at], [n].[expiry_at], [n].[large_icon_url], [n].[Route], [n].[target_criteria], [n].[Title], [n].[title_ar], [n].[title_en]
FROM [notification_templates] AS [n]
WHERE [n].[Id] = @__Parse_0
2025-02-06 13:25:29.185 +03:00 [INF] Executed DbCommand (0ms) [Parameters=[@__Parse_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [n].[Id], [n].[additional_data], [n].[big_picture_url], [n].[Body], [n].[body_ar], [n].[body_en], [n].[created_at], [n].[expiry_at], [n].[large_icon_url], [n].[Route], [n].[target_criteria], [n].[Title], [n].[title_ar], [n].[title_en]
FROM [notification_templates] AS [n]
WHERE [n].[Id] = @__Parse_0
2025-02-06 13:25:29.187 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@__Parse_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [n].[Id], [n].[additional_data], [n].[big_picture_url], [n].[Body], [n].[body_ar], [n].[body_en], [n].[created_at], [n].[expiry_at], [n].[large_icon_url], [n].[Route], [n].[target_criteria], [n].[Title], [n].[title_ar], [n].[title_en]
FROM [notification_templates] AS [n]
WHERE [n].[Id] = @__Parse_0
2025-02-06 13:25:29.190 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@__Parse_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [n].[Id], [n].[additional_data], [n].[big_picture_url], [n].[Body], [n].[body_ar], [n].[body_en], [n].[created_at], [n].[expiry_at], [n].[large_icon_url], [n].[Route], [n].[target_criteria], [n].[Title], [n].[title_ar], [n].[title_en]
FROM [notification_templates] AS [n]
WHERE [n].[Id] = @__Parse_0
2025-02-06 13:25:29.192 +03:00 [INF] Executed DbCommand (0ms) [Parameters=[@__Parse_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [n].[Id], [n].[additional_data], [n].[big_picture_url], [n].[Body], [n].[body_ar], [n].[body_en], [n].[created_at], [n].[expiry_at], [n].[large_icon_url], [n].[Route], [n].[target_criteria], [n].[Title], [n].[title_ar], [n].[title_en]
FROM [notification_templates] AS [n]
WHERE [n].[Id] = @__Parse_0
2025-02-06 13:25:29.194 +03:00 [INF] Executed DbCommand (0ms) [Parameters=[@__Parse_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [n].[Id], [n].[additional_data], [n].[big_picture_url], [n].[Body], [n].[body_ar], [n].[body_en], [n].[created_at], [n].[expiry_at], [n].[large_icon_url], [n].[Route], [n].[target_criteria], [n].[Title], [n].[title_ar], [n].[title_en]
FROM [notification_templates] AS [n]
WHERE [n].[Id] = @__Parse_0
2025-02-06 13:25:29.197 +03:00 [INF] Executed DbCommand (0ms) [Parameters=[@__Parse_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [n].[Id], [n].[additional_data], [n].[big_picture_url], [n].[Body], [n].[body_ar], [n].[body_en], [n].[created_at], [n].[expiry_at], [n].[large_icon_url], [n].[Route], [n].[target_criteria], [n].[Title], [n].[title_ar], [n].[title_en]
FROM [notification_templates] AS [n]
WHERE [n].[Id] = @__Parse_0
2025-02-06 13:25:29.199 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@__Parse_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [n].[Id], [n].[additional_data], [n].[big_picture_url], [n].[Body], [n].[body_ar], [n].[body_en], [n].[created_at], [n].[expiry_at], [n].[large_icon_url], [n].[Route], [n].[target_criteria], [n].[Title], [n].[title_ar], [n].[title_en]
FROM [notification_templates] AS [n]
WHERE [n].[Id] = @__Parse_0
2025-02-06 13:25:29.202 +03:00 [INF] Executed DbCommand (0ms) [Parameters=[@__Parse_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [n].[Id], [n].[additional_data], [n].[big_picture_url], [n].[Body], [n].[body_ar], [n].[body_en], [n].[created_at], [n].[expiry_at], [n].[large_icon_url], [n].[Route], [n].[target_criteria], [n].[Title], [n].[title_ar], [n].[title_en]
FROM [notification_templates] AS [n]
WHERE [n].[Id] = @__Parse_0
2025-02-06 13:25:29.204 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@__Parse_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [n].[Id], [n].[additional_data], [n].[big_picture_url], [n].[Body], [n].[body_ar], [n].[body_en], [n].[created_at], [n].[expiry_at], [n].[large_icon_url], [n].[Route], [n].[target_criteria], [n].[Title], [n].[title_ar], [n].[title_en]
FROM [notification_templates] AS [n]
WHERE [n].[Id] = @__Parse_0
2025-02-06 13:25:29.206 +03:00 [INF] Executed DbCommand (0ms) [Parameters=[@__Parse_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [n].[Id], [n].[additional_data], [n].[big_picture_url], [n].[Body], [n].[body_ar], [n].[body_en], [n].[created_at], [n].[expiry_at], [n].[large_icon_url], [n].[Route], [n].[target_criteria], [n].[Title], [n].[title_ar], [n].[title_en]
FROM [notification_templates] AS [n]
WHERE [n].[Id] = @__Parse_0
2025-02-06 13:25:29.212 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@__Parse_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [n].[Id], [n].[additional_data], [n].[big_picture_url], [n].[Body], [n].[body_ar], [n].[body_en], [n].[created_at], [n].[expiry_at], [n].[large_icon_url], [n].[Route], [n].[target_criteria], [n].[Title], [n].[title_ar], [n].[title_en]
FROM [notification_templates] AS [n]
WHERE [n].[Id] = @__Parse_0
2025-02-06 13:25:29.214 +03:00 [INF] Executed DbCommand (0ms) [Parameters=[@__Parse_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [n].[Id], [n].[additional_data], [n].[big_picture_url], [n].[Body], [n].[body_ar], [n].[body_en], [n].[created_at], [n].[expiry_at], [n].[large_icon_url], [n].[Route], [n].[target_criteria], [n].[Title], [n].[title_ar], [n].[title_en]
FROM [notification_templates] AS [n]
WHERE [n].[Id] = @__Parse_0
2025-02-06 13:25:29.225 +03:00 [INF] Executed DbCommand (5ms) [Parameters=[@p0='?' (Size = 4000), @p1='?' (DbType = DateTime2), @p2='?' (Size = 4000), @p3='?' (Size = 4000), @p4='?' (Size = 4000), @p5='?' (Size = 450), @p6='?' (Size = 4000), @p7='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SET IMPLICIT_TRANSACTIONS OFF;
SET NOCOUNT ON;
INSERT INTO [AuthLogs] ([AuthType], [CreatedAt], [DeviceId], [FailureReason], [IpAddress], [NationalId], [Status], [UserAgent])
OUTPUT INSERTED.[Id]
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7);
2025-02-06 13:25:29.226 +03:00 [INF] Executed DbCommand (8ms) [Parameters=[@p0='?' (Size = 4000), @p1='?' (DbType = DateTime2), @p2='?' (Size = 4000), @p3='?' (Size = 4000), @p4='?' (Size = 4000), @p5='?' (Size = 450), @p6='?' (Size = 4000), @p7='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SET IMPLICIT_TRANSACTIONS OFF;
SET NOCOUNT ON;
INSERT INTO [AuthLogs] ([AuthType], [CreatedAt], [DeviceId], [FailureReason], [IpAddress], [NationalId], [Status], [UserAgent])
OUTPUT INSERTED.[Id]
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7);
2025-02-06 13:25:29.231 +03:00 [ERR] An exception occurred in the database while saving changes for context type 'NayifatAPI.Data.ApplicationDbContext'.
Microsoft.EntityFrameworkCore.DbUpdateException: An error occurred while saving the entity changes. See the inner exception for details.
 ---> Microsoft.Data.SqlClient.SqlException (0x80131904): The INSERT statement conflicted with the FOREIGN KEY constraint "FK_AuthLogs_Customers_NationalId". The conflict occurred in database "NayifatApp", table "dbo.Customers", column 'NationalId'.
   at Microsoft.Data.SqlClient.SqlConnection.OnError(SqlException exception, Boolean breakConnection, Action`1 wrapCloseInAction)
   at Microsoft.Data.SqlClient.SqlInternalConnection.OnError(SqlException exception, Boolean breakConnection, Action`1 wrapCloseInAction)
   at Microsoft.Data.SqlClient.TdsParser.ThrowExceptionAndWarning(TdsParserStateObject stateObj, Boolean callerHasConnectionLock, Boolean asyncClose)
   at Microsoft.Data.SqlClient.TdsParser.TryRun(RunBehavior runBehavior, SqlCommand cmdHandler, SqlDataReader dataStream, BulkCopySimpleResultSet bulkCopyHandler, TdsParserStateObject stateObj, Boolean& dataReady)
   at Microsoft.Data.SqlClient.SqlDataReader.TryHasMoreRows(Boolean& moreRows)
   at Microsoft.Data.SqlClient.SqlDataReader.TryReadInternal(Boolean setTimeout, Boolean& more)
   at Microsoft.Data.SqlClient.SqlDataReader.ReadAsyncExecute(Task task, Object state)
   at Microsoft.Data.SqlClient.SqlDataReader.InvokeAsyncCall[T](SqlDataReaderBaseAsyncCallContext`1 context)
--- End of stack trace from previous location ---
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeResultSetAsync(Int32 startCommandIndex, RelationalDataReader reader, CancellationToken cancellationToken)
ClientConnectionId:e143ade7-3acf-49bb-98e8-41c37ca572f2
Error Number:547,State:0,Class:16
   --- End of inner exception stack trace ---
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeResultSetAsync(Int32 startCommandIndex, RelationalDataReader reader, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeAsync(RelationalDataReader reader, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Update.Internal.SqlServerModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(IList`1 entriesToSave, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(StateManager stateManager, Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Storage.Internal.SqlServerExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
Microsoft.EntityFrameworkCore.DbUpdateException: An error occurred while saving the entity changes. See the inner exception for details.
 ---> Microsoft.Data.SqlClient.SqlException (0x80131904): The INSERT statement conflicted with the FOREIGN KEY constraint "FK_AuthLogs_Customers_NationalId". The conflict occurred in database "NayifatApp", table "dbo.Customers", column 'NationalId'.
   at Microsoft.Data.SqlClient.SqlConnection.OnError(SqlException exception, Boolean breakConnection, Action`1 wrapCloseInAction)
   at Microsoft.Data.SqlClient.SqlInternalConnection.OnError(SqlException exception, Boolean breakConnection, Action`1 wrapCloseInAction)
   at Microsoft.Data.SqlClient.TdsParser.ThrowExceptionAndWarning(TdsParserStateObject stateObj, Boolean callerHasConnectionLock, Boolean asyncClose)
   at Microsoft.Data.SqlClient.TdsParser.TryRun(RunBehavior runBehavior, SqlCommand cmdHandler, SqlDataReader dataStream, BulkCopySimpleResultSet bulkCopyHandler, TdsParserStateObject stateObj, Boolean& dataReady)
   at Microsoft.Data.SqlClient.SqlDataReader.TryHasMoreRows(Boolean& moreRows)
   at Microsoft.Data.SqlClient.SqlDataReader.TryReadInternal(Boolean setTimeout, Boolean& more)
   at Microsoft.Data.SqlClient.SqlDataReader.ReadAsyncExecute(Task task, Object state)
   at Microsoft.Data.SqlClient.SqlDataReader.InvokeAsyncCall[T](SqlDataReaderBaseAsyncCallContext`1 context)
--- End of stack trace from previous location ---
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeResultSetAsync(Int32 startCommandIndex, RelationalDataReader reader, CancellationToken cancellationToken)
ClientConnectionId:e143ade7-3acf-49bb-98e8-41c37ca572f2
Error Number:547,State:0,Class:16
   --- End of inner exception stack trace ---
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeResultSetAsync(Int32 startCommandIndex, RelationalDataReader reader, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeAsync(RelationalDataReader reader, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Update.Internal.SqlServerModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(IList`1 entriesToSave, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(StateManager stateManager, Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Storage.Internal.SqlServerExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
2025-02-06 13:25:29.233 +03:00 [ERR] An exception occurred in the database while saving changes for context type 'NayifatAPI.Data.ApplicationDbContext'.
Microsoft.EntityFrameworkCore.DbUpdateException: An error occurred while saving the entity changes. See the inner exception for details.
 ---> Microsoft.Data.SqlClient.SqlException (0x80131904): The INSERT statement conflicted with the FOREIGN KEY constraint "FK_AuthLogs_Customers_NationalId". The conflict occurred in database "NayifatApp", table "dbo.Customers", column 'NationalId'.
   at Microsoft.Data.SqlClient.SqlConnection.OnError(SqlException exception, Boolean breakConnection, Action`1 wrapCloseInAction)
   at Microsoft.Data.SqlClient.SqlInternalConnection.OnError(SqlException exception, Boolean breakConnection, Action`1 wrapCloseInAction)
   at Microsoft.Data.SqlClient.TdsParser.ThrowExceptionAndWarning(TdsParserStateObject stateObj, Boolean callerHasConnectionLock, Boolean asyncClose)
   at Microsoft.Data.SqlClient.TdsParser.TryRun(RunBehavior runBehavior, SqlCommand cmdHandler, SqlDataReader dataStream, BulkCopySimpleResultSet bulkCopyHandler, TdsParserStateObject stateObj, Boolean& dataReady)
   at Microsoft.Data.SqlClient.SqlDataReader.TryHasMoreRows(Boolean& moreRows)
   at Microsoft.Data.SqlClient.SqlDataReader.TryReadInternal(Boolean setTimeout, Boolean& more)
   at Microsoft.Data.SqlClient.SqlDataReader.ReadAsyncExecute(Task task, Object state)
   at Microsoft.Data.SqlClient.SqlDataReader.InvokeAsyncCall[T](SqlDataReaderBaseAsyncCallContext`1 context)
--- End of stack trace from previous location ---
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeResultSetAsync(Int32 startCommandIndex, RelationalDataReader reader, CancellationToken cancellationToken)
ClientConnectionId:12c69588-4154-410c-9de9-159a75e111c8
Error Number:547,State:0,Class:16
   --- End of inner exception stack trace ---
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeResultSetAsync(Int32 startCommandIndex, RelationalDataReader reader, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeAsync(RelationalDataReader reader, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Update.Internal.SqlServerModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(IList`1 entriesToSave, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(StateManager stateManager, Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Storage.Internal.SqlServerExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
Microsoft.EntityFrameworkCore.DbUpdateException: An error occurred while saving the entity changes. See the inner exception for details.
 ---> Microsoft.Data.SqlClient.SqlException (0x80131904): The INSERT statement conflicted with the FOREIGN KEY constraint "FK_AuthLogs_Customers_NationalId". The conflict occurred in database "NayifatApp", table "dbo.Customers", column 'NationalId'.
   at Microsoft.Data.SqlClient.SqlConnection.OnError(SqlException exception, Boolean breakConnection, Action`1 wrapCloseInAction)
   at Microsoft.Data.SqlClient.SqlInternalConnection.OnError(SqlException exception, Boolean breakConnection, Action`1 wrapCloseInAction)
   at Microsoft.Data.SqlClient.TdsParser.ThrowExceptionAndWarning(TdsParserStateObject stateObj, Boolean callerHasConnectionLock, Boolean asyncClose)
   at Microsoft.Data.SqlClient.TdsParser.TryRun(RunBehavior runBehavior, SqlCommand cmdHandler, SqlDataReader dataStream, BulkCopySimpleResultSet bulkCopyHandler, TdsParserStateObject stateObj, Boolean& dataReady)
   at Microsoft.Data.SqlClient.SqlDataReader.TryHasMoreRows(Boolean& moreRows)
   at Microsoft.Data.SqlClient.SqlDataReader.TryReadInternal(Boolean setTimeout, Boolean& more)
   at Microsoft.Data.SqlClient.SqlDataReader.ReadAsyncExecute(Task task, Object state)
   at Microsoft.Data.SqlClient.SqlDataReader.InvokeAsyncCall[T](SqlDataReaderBaseAsyncCallContext`1 context)
--- End of stack trace from previous location ---
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeResultSetAsync(Int32 startCommandIndex, RelationalDataReader reader, CancellationToken cancellationToken)
ClientConnectionId:12c69588-4154-410c-9de9-159a75e111c8
Error Number:547,State:0,Class:16
   --- End of inner exception stack trace ---
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeResultSetAsync(Int32 startCommandIndex, RelationalDataReader reader, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeAsync(RelationalDataReader reader, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Update.Internal.SqlServerModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(IList`1 entriesToSave, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(StateManager stateManager, Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Storage.Internal.SqlServerExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
2025-02-06 13:25:29.246 +03:00 [ERR] Error logging audit event. NationalId: all, Action: notification_delivered, Details: {"notification_count":21,"notification_ids":[38,37,36,35,34,33,32,31,30,29,28,27,26,25,24,23,23,20,19,18,12],"timestamp":"2025-02-06T13:25:29.115268"}
Microsoft.EntityFrameworkCore.DbUpdateException: An error occurred while saving the entity changes. See the inner exception for details.
 ---> Microsoft.Data.SqlClient.SqlException (0x80131904): The INSERT statement conflicted with the FOREIGN KEY constraint "FK_AuthLogs_Customers_NationalId". The conflict occurred in database "NayifatApp", table "dbo.Customers", column 'NationalId'.
   at Microsoft.Data.SqlClient.SqlConnection.OnError(SqlException exception, Boolean breakConnection, Action`1 wrapCloseInAction)
   at Microsoft.Data.SqlClient.SqlInternalConnection.OnError(SqlException exception, Boolean breakConnection, Action`1 wrapCloseInAction)
   at Microsoft.Data.SqlClient.TdsParser.ThrowExceptionAndWarning(TdsParserStateObject stateObj, Boolean callerHasConnectionLock, Boolean asyncClose)
   at Microsoft.Data.SqlClient.TdsParser.TryRun(RunBehavior runBehavior, SqlCommand cmdHandler, SqlDataReader dataStream, BulkCopySimpleResultSet bulkCopyHandler, TdsParserStateObject stateObj, Boolean& dataReady)
   at Microsoft.Data.SqlClient.SqlDataReader.TryHasMoreRows(Boolean& moreRows)
   at Microsoft.Data.SqlClient.SqlDataReader.TryReadInternal(Boolean setTimeout, Boolean& more)
   at Microsoft.Data.SqlClient.SqlDataReader.ReadAsyncExecute(Task task, Object state)
   at Microsoft.Data.SqlClient.SqlDataReader.InvokeAsyncCall[T](SqlDataReaderBaseAsyncCallContext`1 context)
--- End of stack trace from previous location ---
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeResultSetAsync(Int32 startCommandIndex, RelationalDataReader reader, CancellationToken cancellationToken)
ClientConnectionId:e143ade7-3acf-49bb-98e8-41c37ca572f2
Error Number:547,State:0,Class:16
   --- End of inner exception stack trace ---
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeResultSetAsync(Int32 startCommandIndex, RelationalDataReader reader, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeAsync(RelationalDataReader reader, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Update.Internal.SqlServerModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(IList`1 entriesToSave, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(StateManager stateManager, Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Storage.Internal.SqlServerExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at NayifatAPI.Services.AuditLogService.LogAsync(String nationalId, String action, Object details) in C:\Users\yamta\StudioProjects\nayifat_app_2025_new\NayifatAPI\Services\AuditLogService.cs:line 36
2025-02-06 13:25:29.260 +03:00 [ERR] Error logging audit event. NationalId: all, Action: notification_delivered, Details: {"notification_count":21,"notification_ids":[38,37,36,35,34,33,32,31,30,29,28,27,26,25,24,23,23,20,19,18,12],"timestamp":"2025-02-06T13:25:29.1127021"}
Microsoft.EntityFrameworkCore.DbUpdateException: An error occurred while saving the entity changes. See the inner exception for details.
 ---> Microsoft.Data.SqlClient.SqlException (0x80131904): The INSERT statement conflicted with the FOREIGN KEY constraint "FK_AuthLogs_Customers_NationalId". The conflict occurred in database "NayifatApp", table "dbo.Customers", column 'NationalId'.
   at Microsoft.Data.SqlClient.SqlConnection.OnError(SqlException exception, Boolean breakConnection, Action`1 wrapCloseInAction)
   at Microsoft.Data.SqlClient.SqlInternalConnection.OnError(SqlException exception, Boolean breakConnection, Action`1 wrapCloseInAction)
   at Microsoft.Data.SqlClient.TdsParser.ThrowExceptionAndWarning(TdsParserStateObject stateObj, Boolean callerHasConnectionLock, Boolean asyncClose)
   at Microsoft.Data.SqlClient.TdsParser.TryRun(RunBehavior runBehavior, SqlCommand cmdHandler, SqlDataReader dataStream, BulkCopySimpleResultSet bulkCopyHandler, TdsParserStateObject stateObj, Boolean& dataReady)
   at Microsoft.Data.SqlClient.SqlDataReader.TryHasMoreRows(Boolean& moreRows)
   at Microsoft.Data.SqlClient.SqlDataReader.TryReadInternal(Boolean setTimeout, Boolean& more)
   at Microsoft.Data.SqlClient.SqlDataReader.ReadAsyncExecute(Task task, Object state)
   at Microsoft.Data.SqlClient.SqlDataReader.InvokeAsyncCall[T](SqlDataReaderBaseAsyncCallContext`1 context)
--- End of stack trace from previous location ---
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeResultSetAsync(Int32 startCommandIndex, RelationalDataReader reader, CancellationToken cancellationToken)
ClientConnectionId:12c69588-4154-410c-9de9-159a75e111c8
Error Number:547,State:0,Class:16
   --- End of inner exception stack trace ---
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeResultSetAsync(Int32 startCommandIndex, RelationalDataReader reader, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeAsync(RelationalDataReader reader, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Update.Internal.SqlServerModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(IList`1 entriesToSave, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(StateManager stateManager, Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Storage.Internal.SqlServerExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at NayifatAPI.Services.AuditLogService.LogAsync(String nationalId, String action, Object details) in C:\Users\yamta\StudioProjects\nayifat_app_2025_new\NayifatAPI\Services\AuditLogService.cs:line 36
2025-02-06 13:25:29.270 +03:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType11`2[[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Object, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-02-06 13:25:29.280 +03:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType11`2[[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Object, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-02-06 13:25:29.280 +03:00 [INF] Executed action NayifatAPI.Controllers.NotificationsController.GetNotifications (NayifatAPI) in 584.7427ms
2025-02-06 13:25:29.282 +03:00 [INF] Executed action NayifatAPI.Controllers.NotificationsController.GetNotifications (NayifatAPI) in 620.01ms
2025-02-06 13:25:29.283 +03:00 [INF] Executed endpoint 'NayifatAPI.Controllers.NotificationsController.GetNotifications (NayifatAPI)'
2025-02-06 13:25:29.285 +03:00 [INF] Executed endpoint 'NayifatAPI.Controllers.NotificationsController.GetNotifications (NayifatAPI)'
2025-02-06 13:25:29.286 +03:00 [INF] Request finished HTTP/1.1 POST http://eb3c-46-152-255-232.ngrok-free.app/api/notifications/list - 200 null application/json; charset=utf-8 594.2611ms
2025-02-06 13:25:29.286 +03:00 [INF] Request finished HTTP/1.1 POST http://eb3c-46-152-255-232.ngrok-free.app/api/notifications/list - 200 null application/json; charset=utf-8 634.4483ms
2025-02-06 13:36:28.107 +03:00 [INF] Request starting HTTP/1.1 POST http://eb3c-46-152-255-232.ngrok-free.app/api/content/timestamps - application/json; charset=utf-8 2
2025-02-06 13:36:28.131 +03:00 [INF] Executing endpoint 'NayifatAPI.Controllers.ContentController.GetTimestamps (NayifatAPI)'
2025-02-06 13:36:28.148 +03:00 [INF] Route matched with {action = "GetTimestamps", controller = "Content"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetTimestamps() on controller NayifatAPI.Controllers.ContentController (NayifatAPI).
2025-02-06 13:36:28.155 +03:00 [INF] TTT_
2025-02-06 13:36:28.156 +03:00 [INF] TTT_=== Getting Content Timestamps ===
2025-02-06 13:36:28.235 +03:00 [INF] Executed DbCommand (21ms) [Parameters=[@__providedApiKey_0='?' (Size = 255)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [a].[api_Key], [a].[CreatedAt], [a].[Description], [a].[ExpiresAt], [a].[IsActive], [a].[LastUsedAt]
FROM [ApiKeys] AS [a]
WHERE [a].[api_Key] = @__providedApiKey_0 AND [a].[IsActive] = CAST(1 AS bit)
2025-02-06 13:36:28.238 +03:00 [INF] TTT_Fetching timestamps from database
2025-02-06 13:36:28.397 +03:00 [INF] Executed DbCommand (133ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT [m].[page] AS [Page], [m].[key_name] AS [KeyName], [m].[last_updated] AS [LastUpdated]
FROM [master_config] AS [m]
2025-02-06 13:36:28.710 +03:00 [INF] TTT_Found 18 content items
2025-02-06 13:36:28.715 +03:00 [INF] TTT_Page: home
2025-02-06 13:36:28.719 +03:00 [INF] TTT_  - slideshow_content: "2025-02-05T13:56:06.9430000"
2025-02-06 13:36:28.721 +03:00 [INF] TTT_  - slideshow_content_ar: "2025-02-05T14:22:06.9430000"
2025-02-06 13:36:28.722 +03:00 [INF] TTT_  - contact_details: "2025-02-05T15:43:06.9430000"
2025-02-06 13:36:28.724 +03:00 [INF] TTT_  - contact_details_ar: "2025-02-05T14:06:06.9430000"
2025-02-06 13:36:28.725 +03:00 [INF] TTT_  - termsEN1: "2025-02-03T14:23:58.0000000"
2025-02-06 13:36:28.727 +03:00 [INF] TTT_  - termsEN2: "2025-02-03T14:25:20.1730000"
2025-02-06 13:36:28.728 +03:00 [INF] TTT_  - privacyEN1: "2025-02-03T14:26:08.6130000"
2025-02-06 13:36:28.730 +03:00 [INF] TTT_  - privacyEN2: "2025-02-03T14:25:20.1730000"
2025-02-06 13:36:28.732 +03:00 [INF] TTT_  - termsAR1: "2025-02-03T14:23:58.0000000"
2025-02-06 13:36:28.735 +03:00 [INF] TTT_  - termsAR2: "2025-02-03T14:25:20.1730000"
2025-02-06 13:36:28.737 +03:00 [INF] TTT_  - privacyAR1: "2025-02-03T14:26:08.6130000"
2025-02-06 13:36:28.740 +03:00 [INF] TTT_  - privacyAR2: "2025-02-03T14:25:20.1730000"
2025-02-06 13:36:28.743 +03:00 [INF] TTT_  - terms&conditionsCC_AR: "2025-02-03T17:06:57.7700000"
2025-02-06 13:36:28.744 +03:00 [INF] TTT_  - terms&conditionsCC_EN: "2025-02-03T17:07:47.4900000"
2025-02-06 13:36:28.748 +03:00 [INF] TTT_  - terms&conditionsPF_AR: "2025-02-03T17:06:57.7700000"
2025-02-06 13:36:28.751 +03:00 [INF] TTT_  - terms&conditionsPF_EN: "2025-02-03T17:06:57.7700000"
2025-02-06 13:36:28.753 +03:00 [INF] TTT_Page: loans
2025-02-06 13:36:28.754 +03:00 [INF] TTT_  - loan_ad: "2025-02-05T13:56:06.9430000"
2025-02-06 13:36:28.755 +03:00 [INF] TTT_Page: cards
2025-02-06 13:36:28.758 +03:00 [INF] TTT_  - card_ad: "2025-02-05T15:43:06.9430000"
2025-02-06 13:36:28.759 +03:00 [INF] TTT_Successfully retrieved all timestamps
2025-02-06 13:36:28.764 +03:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType11`2[[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Object, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-02-06 13:36:28.779 +03:00 [INF] Executed action NayifatAPI.Controllers.ContentController.GetTimestamps (NayifatAPI) in 628.9619ms
2025-02-06 13:36:28.782 +03:00 [INF] Executed endpoint 'NayifatAPI.Controllers.ContentController.GetTimestamps (NayifatAPI)'
2025-02-06 13:36:28.784 +03:00 [INF] Request finished HTTP/1.1 POST http://eb3c-46-152-255-232.ngrok-free.app/api/content/timestamps - 200 null application/json; charset=utf-8 676.8201ms
2025-02-06 13:36:36.218 +03:00 [INF] Request starting HTTP/1.1 POST http://eb3c-46-152-255-232.ngrok-free.app/api/content/timestamps - application/json; charset=utf-8 2
2025-02-06 13:36:36.223 +03:00 [INF] Executing endpoint 'NayifatAPI.Controllers.ContentController.GetTimestamps (NayifatAPI)'
2025-02-06 13:36:36.224 +03:00 [INF] Route matched with {action = "GetTimestamps", controller = "Content"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetTimestamps() on controller NayifatAPI.Controllers.ContentController (NayifatAPI).
2025-02-06 13:36:36.226 +03:00 [INF] TTT_
2025-02-06 13:36:36.226 +03:00 [INF] TTT_=== Getting Content Timestamps ===
2025-02-06 13:36:36.231 +03:00 [INF] Executed DbCommand (3ms) [Parameters=[@__providedApiKey_0='?' (Size = 255)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [a].[api_Key], [a].[CreatedAt], [a].[Description], [a].[ExpiresAt], [a].[IsActive], [a].[LastUsedAt]
FROM [ApiKeys] AS [a]
WHERE [a].[api_Key] = @__providedApiKey_0 AND [a].[IsActive] = CAST(1 AS bit)
2025-02-06 13:36:36.235 +03:00 [INF] TTT_Fetching timestamps from database
2025-02-06 13:36:36.239 +03:00 [INF] Executed DbCommand (2ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT [m].[page] AS [Page], [m].[key_name] AS [KeyName], [m].[last_updated] AS [LastUpdated]
FROM [master_config] AS [m]
2025-02-06 13:36:36.241 +03:00 [INF] TTT_Found 18 content items
2025-02-06 13:36:36.242 +03:00 [INF] TTT_Page: home
2025-02-06 13:36:36.242 +03:00 [INF] TTT_  - slideshow_content: "2025-02-05T13:56:06.9430000"
2025-02-06 13:36:36.243 +03:00 [INF] TTT_  - slideshow_content_ar: "2025-02-05T14:22:06.9430000"
2025-02-06 13:36:36.244 +03:00 [INF] TTT_  - contact_details: "2025-02-05T15:43:06.9430000"
2025-02-06 13:36:36.245 +03:00 [INF] TTT_  - contact_details_ar: "2025-02-05T14:06:06.9430000"
2025-02-06 13:36:36.246 +03:00 [INF] TTT_  - termsEN1: "2025-02-03T14:23:58.0000000"
2025-02-06 13:36:36.247 +03:00 [INF] TTT_  - termsEN2: "2025-02-03T14:25:20.1730000"
2025-02-06 13:36:36.247 +03:00 [INF] TTT_  - privacyEN1: "2025-02-03T14:26:08.6130000"
2025-02-06 13:36:36.248 +03:00 [INF] TTT_  - privacyEN2: "2025-02-03T14:25:20.1730000"
2025-02-06 13:36:36.250 +03:00 [INF] TTT_  - termsAR1: "2025-02-03T14:23:58.0000000"
2025-02-06 13:36:36.251 +03:00 [INF] TTT_  - termsAR2: "2025-02-03T14:25:20.1730000"
2025-02-06 13:36:36.252 +03:00 [INF] TTT_  - privacyAR1: "2025-02-03T14:26:08.6130000"
2025-02-06 13:36:36.253 +03:00 [INF] TTT_  - privacyAR2: "2025-02-03T14:25:20.1730000"
2025-02-06 13:36:36.253 +03:00 [INF] TTT_  - terms&conditionsCC_AR: "2025-02-03T17:06:57.7700000"
2025-02-06 13:36:36.254 +03:00 [INF] TTT_  - terms&conditionsCC_EN: "2025-02-03T17:07:47.4900000"
2025-02-06 13:36:36.255 +03:00 [INF] TTT_  - terms&conditionsPF_AR: "2025-02-03T17:06:57.7700000"
2025-02-06 13:36:36.256 +03:00 [INF] TTT_  - terms&conditionsPF_EN: "2025-02-03T17:06:57.7700000"
2025-02-06 13:36:36.256 +03:00 [INF] TTT_Page: loans
2025-02-06 13:36:36.257 +03:00 [INF] TTT_  - loan_ad: "2025-02-05T13:56:06.9430000"
2025-02-06 13:36:36.258 +03:00 [INF] TTT_Page: cards
2025-02-06 13:36:36.258 +03:00 [INF] TTT_  - card_ad: "2025-02-05T15:43:06.9430000"
2025-02-06 13:36:36.260 +03:00 [INF] TTT_Successfully retrieved all timestamps
2025-02-06 13:36:36.260 +03:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType11`2[[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Object, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-02-06 13:36:36.262 +03:00 [INF] Executed action NayifatAPI.Controllers.ContentController.GetTimestamps (NayifatAPI) in 36.6693ms
2025-02-06 13:36:36.263 +03:00 [INF] Executed endpoint 'NayifatAPI.Controllers.ContentController.GetTimestamps (NayifatAPI)'
2025-02-06 13:36:36.265 +03:00 [INF] Request finished HTTP/1.1 POST http://eb3c-46-152-255-232.ngrok-free.app/api/content/timestamps - 200 null application/json; charset=utf-8 46.5813ms
2025-02-06 13:47:40.736 +03:00 [INF] Request starting HTTP/1.1 POST http://eb3c-46-152-255-232.ngrok-free.app/api/content/timestamps - application/json; charset=utf-8 2
2025-02-06 13:47:40.738 +03:00 [INF] Executing endpoint 'NayifatAPI.Controllers.ContentController.GetTimestamps (NayifatAPI)'
2025-02-06 13:47:40.740 +03:00 [INF] Route matched with {action = "GetTimestamps", controller = "Content"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetTimestamps() on controller NayifatAPI.Controllers.ContentController (NayifatAPI).
2025-02-06 13:47:40.742 +03:00 [INF] TTT_
2025-02-06 13:47:40.744 +03:00 [INF] TTT_=== Getting Content Timestamps ===
2025-02-06 13:47:40.752 +03:00 [INF] Executed DbCommand (2ms) [Parameters=[@__providedApiKey_0='?' (Size = 255)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [a].[api_Key], [a].[CreatedAt], [a].[Description], [a].[ExpiresAt], [a].[IsActive], [a].[LastUsedAt]
FROM [ApiKeys] AS [a]
WHERE [a].[api_Key] = @__providedApiKey_0 AND [a].[IsActive] = CAST(1 AS bit)
2025-02-06 13:47:40.754 +03:00 [INF] TTT_Fetching timestamps from database
2025-02-06 13:47:40.756 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT [m].[page] AS [Page], [m].[key_name] AS [KeyName], [m].[last_updated] AS [LastUpdated]
FROM [master_config] AS [m]
2025-02-06 13:47:40.757 +03:00 [INF] TTT_Found 18 content items
2025-02-06 13:47:40.758 +03:00 [INF] TTT_Page: home
2025-02-06 13:47:40.759 +03:00 [INF] TTT_  - slideshow_content: "2025-02-05T13:56:06.9430000"
2025-02-06 13:47:40.760 +03:00 [INF] TTT_  - slideshow_content_ar: "2025-02-05T14:22:06.9430000"
2025-02-06 13:47:40.761 +03:00 [INF] TTT_  - contact_details: "2025-02-05T15:43:06.9430000"
2025-02-06 13:47:40.761 +03:00 [INF] TTT_  - contact_details_ar: "2025-02-05T14:06:06.9430000"
2025-02-06 13:47:40.762 +03:00 [INF] TTT_  - termsEN1: "2025-02-03T14:23:58.0000000"
2025-02-06 13:47:40.763 +03:00 [INF] TTT_  - termsEN2: "2025-02-03T14:25:20.1730000"
2025-02-06 13:47:40.763 +03:00 [INF] TTT_  - privacyEN1: "2025-02-03T14:26:08.6130000"
2025-02-06 13:47:40.765 +03:00 [INF] TTT_  - privacyEN2: "2025-02-03T14:25:20.1730000"
2025-02-06 13:47:40.765 +03:00 [INF] TTT_  - termsAR1: "2025-02-03T14:23:58.0000000"
2025-02-06 13:47:40.766 +03:00 [INF] TTT_  - termsAR2: "2025-02-03T14:25:20.1730000"
2025-02-06 13:47:40.767 +03:00 [INF] TTT_  - privacyAR1: "2025-02-03T14:26:08.6130000"
2025-02-06 13:47:40.768 +03:00 [INF] TTT_  - privacyAR2: "2025-02-03T14:25:20.1730000"
2025-02-06 13:47:40.768 +03:00 [INF] TTT_  - terms&conditionsCC_AR: "2025-02-03T17:06:57.7700000"
2025-02-06 13:47:40.769 +03:00 [INF] TTT_  - terms&conditionsCC_EN: "2025-02-03T17:07:47.4900000"
2025-02-06 13:47:40.770 +03:00 [INF] TTT_  - terms&conditionsPF_AR: "2025-02-03T17:06:57.7700000"
2025-02-06 13:47:40.770 +03:00 [INF] TTT_  - terms&conditionsPF_EN: "2025-02-03T17:06:57.7700000"
2025-02-06 13:47:40.771 +03:00 [INF] TTT_Page: loans
2025-02-06 13:47:40.771 +03:00 [INF] TTT_  - loan_ad: "2025-02-05T13:56:06.9430000"
2025-02-06 13:47:40.772 +03:00 [INF] TTT_Page: cards
2025-02-06 13:47:40.774 +03:00 [INF] TTT_  - card_ad: "2025-02-05T15:43:06.9430000"
2025-02-06 13:47:40.775 +03:00 [INF] TTT_Successfully retrieved all timestamps
2025-02-06 13:47:40.776 +03:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType11`2[[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Object, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-02-06 13:47:40.777 +03:00 [INF] Executed action NayifatAPI.Controllers.ContentController.GetTimestamps (NayifatAPI) in 35.496ms
2025-02-06 13:47:40.779 +03:00 [INF] Executed endpoint 'NayifatAPI.Controllers.ContentController.GetTimestamps (NayifatAPI)'
2025-02-06 13:47:40.781 +03:00 [INF] Request finished HTTP/1.1 POST http://eb3c-46-152-255-232.ngrok-free.app/api/content/timestamps - 200 null application/json; charset=utf-8 44.6397ms
2025-02-06 13:47:53.671 +03:00 [INF] Request starting HTTP/1.1 POST http://eb3c-46-152-255-232.ngrok-free.app/api/auth/signin - application/json; charset=utf-8 78
2025-02-06 13:47:53.673 +03:00 [INF] Executing endpoint 'NayifatAPI.Controllers.AuthController.SignIn (NayifatAPI)'
2025-02-06 13:47:53.677 +03:00 [INF] Route matched with {action = "SignIn", controller = "Auth"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] SignIn(NayifatAPI.Controllers.SignInRequest) on controller NayifatAPI.Controllers.AuthController (NayifatAPI).
2025-02-06 13:47:53.687 +03:00 [INF] Executed DbCommand (0ms) [Parameters=[@__providedApiKey_0='?' (Size = 255)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [a].[api_Key], [a].[CreatedAt], [a].[Description], [a].[ExpiresAt], [a].[IsActive], [a].[LastUsedAt]
FROM [ApiKeys] AS [a]
WHERE [a].[api_Key] = @__providedApiKey_0 AND [a].[IsActive] = CAST(1 AS bit)
2025-02-06 13:47:53.840 +03:00 [INF] Executed DbCommand (145ms) [Parameters=[@__request_NationalId_0='?' (Size = 450)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [c].[NationalId], [c].[AddNo], [c].[BuildingNo], [c].[City], [c].[Consent], [c].[ConsentDate], [c].[DateOfBirth], [c].[Dependents], [c].[District], [c].[Email], [c].[Employer], [c].[FamilyNameAr], [c].[FamilyNameEn], [c].[FirstNameAr], [c].[FirstNameEn], [c].[Iban], [c].[IdExpiryDate], [c].[Los], [c].[Mpin], [c].[MpinEnabled], [c].[NafathStatus], [c].[NafathTimestamp], [c].[Password], [c].[Phone], [c].[RegistrationDate], [c].[SalaryCustomer], [c].[SalaryDakhli], [c].[SecondNameAr], [c].[SecondNameEn], [c].[Sector], [c].[Street], [c].[ThirdNameAr], [c].[ThirdNameEn], [c].[Zipcode]
FROM [Customers] AS [c]
WHERE [c].[NationalId] = @__request_NationalId_0
2025-02-06 13:47:53.972 +03:00 [INF] Starting password verification for NationalId: 1064448614
2025-02-06 13:47:54.289 +03:00 [INF] Password verification result for NationalId 1064448614: Success
2025-02-06 13:47:54.344 +03:00 [INF] Executed DbCommand (15ms) [Parameters=[@p0='?' (Size = 4000), @p1='?' (DbType = DateTime2), @p2='?' (Size = 4000), @p3='?' (Size = 4000), @p4='?' (Size = 4000), @p5='?' (Size = 450), @p6='?' (Size = 4000), @p7='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SET IMPLICIT_TRANSACTIONS OFF;
SET NOCOUNT ON;
INSERT INTO [AuthLogs] ([AuthType], [CreatedAt], [DeviceId], [FailureReason], [IpAddress], [NationalId], [Status], [UserAgent])
OUTPUT INSERTED.[Id]
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7);
2025-02-06 13:47:54.364 +03:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType11`2[[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Object, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-02-06 13:47:54.370 +03:00 [INF] Executed action NayifatAPI.Controllers.AuthController.SignIn (NayifatAPI) in 691.6889ms
2025-02-06 13:47:54.373 +03:00 [INF] Executed endpoint 'NayifatAPI.Controllers.AuthController.SignIn (NayifatAPI)'
2025-02-06 13:47:54.374 +03:00 [INF] Request finished HTTP/1.1 POST http://eb3c-46-152-255-232.ngrok-free.app/api/auth/signin - 200 null application/json; charset=utf-8 702.8523ms
2025-02-06 13:47:55.342 +03:00 [INF] Request starting HTTP/1.1 POST http://eb3c-46-152-255-232.ngrok-free.app/api/proxy/forward?url=https://icreditdept.com/api/testasp/test_local_generate_otp.php - application/json; charset=utf-8 84
2025-02-06 13:47:55.345 +03:00 [INF] Executing endpoint 'NayifatAPI.Controllers.ProxyController.ForwardRequest (NayifatAPI)'
2025-02-06 13:47:55.348 +03:00 [INF] Route matched with {action = "ForwardRequest", controller = "Proxy"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] ForwardRequest() on controller NayifatAPI.Controllers.ProxyController (NayifatAPI).
2025-02-06 13:47:55.377 +03:00 [INF] Start processing HTTP request POST https://icreditdept.com/api/testasp/test_local_generate_otp.php
2025-02-06 13:47:55.379 +03:00 [INF] Sending HTTP request POST https://icreditdept.com/api/testasp/test_local_generate_otp.php
2025-02-06 13:47:56.225 +03:00 [INF] Received HTTP response headers after 843.9647ms - 200
2025-02-06 13:47:56.228 +03:00 [INF] End processing HTTP request after 852.1204ms - 200
2025-02-06 13:47:56.235 +03:00 [INF] Raw response length: 200
2025-02-06 13:47:56.236 +03:00 [INF] Response content: {"success":true,"errors":[],"result":{"nationalId":"1064448614","otp":695433,"expiryDate":"2025-02-06 13:52:57","successMsg":"Success","errCode":0,"errMsg":null},"type":"N","message":null,"code":null}
2025-02-06 13:47:56.237 +03:00 [INF] Executing ContentResult with HTTP Response ContentType of application/json
2025-02-06 13:47:56.239 +03:00 [INF] Executed action NayifatAPI.Controllers.ProxyController.ForwardRequest (NayifatAPI) in 889.4692ms
2025-02-06 13:47:56.240 +03:00 [INF] Executed endpoint 'NayifatAPI.Controllers.ProxyController.ForwardRequest (NayifatAPI)'
2025-02-06 13:47:56.242 +03:00 [INF] Request finished HTTP/1.1 POST http://eb3c-46-152-255-232.ngrok-free.app/api/proxy/forward?url=https://icreditdept.com/api/testasp/test_local_generate_otp.php - 200 200 application/json 899.34ms
2025-02-06 13:48:11.444 +03:00 [INF] Request starting HTTP/1.1 POST http://eb3c-46-152-255-232.ngrok-free.app/api/proxy/forward?url=https://icreditdept.com/api/testasp/test_local_verify_otp.php - application/json; charset=utf-8 53
2025-02-06 13:48:11.446 +03:00 [INF] Executing endpoint 'NayifatAPI.Controllers.ProxyController.ForwardRequest (NayifatAPI)'
2025-02-06 13:48:11.447 +03:00 [INF] Route matched with {action = "ForwardRequest", controller = "Proxy"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] ForwardRequest() on controller NayifatAPI.Controllers.ProxyController (NayifatAPI).
2025-02-06 13:48:11.450 +03:00 [INF] Start processing HTTP request POST https://icreditdept.com/api/testasp/test_local_verify_otp.php
2025-02-06 13:48:11.451 +03:00 [INF] Sending HTTP request POST https://icreditdept.com/api/testasp/test_local_verify_otp.php
2025-02-06 13:48:11.838 +03:00 [INF] Received HTTP response headers after 385.4567ms - 200
2025-02-06 13:48:11.840 +03:00 [INF] End processing HTTP request after 390.0306ms - 200
2025-02-06 13:48:11.840 +03:00 [INF] Raw response length: 202
2025-02-06 13:48:11.841 +03:00 [INF] Response content: {"success":true,"errors":[],"result":{"nationalId":"1064448614","otp":"695433","verifiedFlag":true,"successMsg":"Verified successfully.","errCode":0,"errMsg":null},"type":"N","message":null,"code":null}
2025-02-06 13:48:11.842 +03:00 [INF] Executing ContentResult with HTTP Response ContentType of application/json
2025-02-06 13:48:11.842 +03:00 [INF] Executed action NayifatAPI.Controllers.ProxyController.ForwardRequest (NayifatAPI) in 393.3344ms
2025-02-06 13:48:11.843 +03:00 [INF] Executed endpoint 'NayifatAPI.Controllers.ProxyController.ForwardRequest (NayifatAPI)'
2025-02-06 13:48:11.846 +03:00 [INF] Request finished HTTP/1.1 POST http://eb3c-46-152-255-232.ngrok-free.app/api/proxy/forward?url=https://icreditdept.com/api/testasp/test_local_verify_otp.php - 200 202 application/json 402.0519ms
2025-02-06 13:48:19.680 +03:00 [INF] Request starting HTTP/1.1 POST http://eb3c-46-152-255-232.ngrok-free.app/api/notifications/list - application/json; charset=utf-8 45
2025-02-06 13:48:19.925 +03:00 [INF] Executing endpoint 'NayifatAPI.Controllers.NotificationsController.GetNotifications (NayifatAPI)'
2025-02-06 13:48:19.927 +03:00 [INF] Route matched with {action = "GetNotifications", controller = "Notifications"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetNotifications(NayifatAPI.Controllers.GetNotificationsRequest) on controller NayifatAPI.Controllers.NotificationsController (NayifatAPI).
2025-02-06 13:48:19.950 +03:00 [INF] Executed DbCommand (18ms) [Parameters=[@__providedApiKey_0='?' (Size = 255)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [a].[api_Key], [a].[CreatedAt], [a].[Description], [a].[ExpiresAt], [a].[IsActive], [a].[LastUsedAt]
FROM [ApiKeys] AS [a]
WHERE [a].[api_Key] = @__providedApiKey_0 AND [a].[IsActive] = CAST(1 AS bit)
2025-02-06 13:48:20.057 +03:00 [INF] Executed DbCommand (104ms) [Parameters=[@__request_NationalId_0='?' (Size = 450)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [u].[national_id], [u].[last_updated], [u].[notifications]
FROM [user_notifications] AS [u]
WHERE [u].[national_id] = @__request_NationalId_0
2025-02-06 13:48:20.060 +03:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType11`2[[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Object, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-02-06 13:48:20.061 +03:00 [INF] Executed action NayifatAPI.Controllers.NotificationsController.GetNotifications (NayifatAPI) in 132.5441ms
2025-02-06 13:48:20.066 +03:00 [INF] Executed endpoint 'NayifatAPI.Controllers.NotificationsController.GetNotifications (NayifatAPI)'
2025-02-06 13:48:20.068 +03:00 [INF] Request finished HTTP/1.1 POST http://eb3c-46-152-255-232.ngrok-free.app/api/notifications/list - 200 null application/json; charset=utf-8 387.5405ms
2025-02-06 13:48:21.047 +03:00 [INF] Request starting HTTP/1.1 POST http://eb3c-46-152-255-232.ngrok-free.app/api/notifications/list - application/json; charset=utf-8 39
2025-02-06 13:48:21.051 +03:00 [INF] Executing endpoint 'NayifatAPI.Controllers.NotificationsController.GetNotifications (NayifatAPI)'
2025-02-06 13:48:21.052 +03:00 [INF] Route matched with {action = "GetNotifications", controller = "Notifications"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetNotifications(NayifatAPI.Controllers.GetNotificationsRequest) on controller NayifatAPI.Controllers.NotificationsController (NayifatAPI).
2025-02-06 13:48:21.056 +03:00 [INF] Executed DbCommand (0ms) [Parameters=[@__providedApiKey_0='?' (Size = 255)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [a].[api_Key], [a].[CreatedAt], [a].[Description], [a].[ExpiresAt], [a].[IsActive], [a].[LastUsedAt]
FROM [ApiKeys] AS [a]
WHERE [a].[api_Key] = @__providedApiKey_0 AND [a].[IsActive] = CAST(1 AS bit)
2025-02-06 13:48:21.059 +03:00 [INF] Executed DbCommand (0ms) [Parameters=[@__request_NationalId_0='?' (Size = 450)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [u].[national_id], [u].[last_updated], [u].[notifications]
FROM [user_notifications] AS [u]
WHERE [u].[national_id] = @__request_NationalId_0
2025-02-06 13:48:21.072 +03:00 [INF] Executed DbCommand (12ms) [Parameters=[@__Parse_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [n].[Id], [n].[additional_data], [n].[big_picture_url], [n].[Body], [n].[body_ar], [n].[body_en], [n].[created_at], [n].[expiry_at], [n].[large_icon_url], [n].[Route], [n].[target_criteria], [n].[Title], [n].[title_ar], [n].[title_en]
FROM [notification_templates] AS [n]
WHERE [n].[Id] = @__Parse_0
2025-02-06 13:48:21.074 +03:00 [INF] Executed DbCommand (0ms) [Parameters=[@__Parse_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [n].[Id], [n].[additional_data], [n].[big_picture_url], [n].[Body], [n].[body_ar], [n].[body_en], [n].[created_at], [n].[expiry_at], [n].[large_icon_url], [n].[Route], [n].[target_criteria], [n].[Title], [n].[title_ar], [n].[title_en]
FROM [notification_templates] AS [n]
WHERE [n].[Id] = @__Parse_0
2025-02-06 13:48:21.077 +03:00 [INF] Executed DbCommand (0ms) [Parameters=[@__Parse_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [n].[Id], [n].[additional_data], [n].[big_picture_url], [n].[Body], [n].[body_ar], [n].[body_en], [n].[created_at], [n].[expiry_at], [n].[large_icon_url], [n].[Route], [n].[target_criteria], [n].[Title], [n].[title_ar], [n].[title_en]
FROM [notification_templates] AS [n]
WHERE [n].[Id] = @__Parse_0
2025-02-06 13:48:21.079 +03:00 [INF] Executed DbCommand (0ms) [Parameters=[@__Parse_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [n].[Id], [n].[additional_data], [n].[big_picture_url], [n].[Body], [n].[body_ar], [n].[body_en], [n].[created_at], [n].[expiry_at], [n].[large_icon_url], [n].[Route], [n].[target_criteria], [n].[Title], [n].[title_ar], [n].[title_en]
FROM [notification_templates] AS [n]
WHERE [n].[Id] = @__Parse_0
2025-02-06 13:48:21.083 +03:00 [INF] Executed DbCommand (0ms) [Parameters=[@__Parse_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [n].[Id], [n].[additional_data], [n].[big_picture_url], [n].[Body], [n].[body_ar], [n].[body_en], [n].[created_at], [n].[expiry_at], [n].[large_icon_url], [n].[Route], [n].[target_criteria], [n].[Title], [n].[title_ar], [n].[title_en]
FROM [notification_templates] AS [n]
WHERE [n].[Id] = @__Parse_0
2025-02-06 13:48:21.086 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@__Parse_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [n].[Id], [n].[additional_data], [n].[big_picture_url], [n].[Body], [n].[body_ar], [n].[body_en], [n].[created_at], [n].[expiry_at], [n].[large_icon_url], [n].[Route], [n].[target_criteria], [n].[Title], [n].[title_ar], [n].[title_en]
FROM [notification_templates] AS [n]
WHERE [n].[Id] = @__Parse_0
2025-02-06 13:48:21.089 +03:00 [INF] Executed DbCommand (0ms) [Parameters=[@__Parse_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [n].[Id], [n].[additional_data], [n].[big_picture_url], [n].[Body], [n].[body_ar], [n].[body_en], [n].[created_at], [n].[expiry_at], [n].[large_icon_url], [n].[Route], [n].[target_criteria], [n].[Title], [n].[title_ar], [n].[title_en]
FROM [notification_templates] AS [n]
WHERE [n].[Id] = @__Parse_0
2025-02-06 13:48:21.092 +03:00 [INF] Executed DbCommand (0ms) [Parameters=[@__Parse_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [n].[Id], [n].[additional_data], [n].[big_picture_url], [n].[Body], [n].[body_ar], [n].[body_en], [n].[created_at], [n].[expiry_at], [n].[large_icon_url], [n].[Route], [n].[target_criteria], [n].[Title], [n].[title_ar], [n].[title_en]
FROM [notification_templates] AS [n]
WHERE [n].[Id] = @__Parse_0
2025-02-06 13:48:21.094 +03:00 [INF] Executed DbCommand (0ms) [Parameters=[@__Parse_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [n].[Id], [n].[additional_data], [n].[big_picture_url], [n].[Body], [n].[body_ar], [n].[body_en], [n].[created_at], [n].[expiry_at], [n].[large_icon_url], [n].[Route], [n].[target_criteria], [n].[Title], [n].[title_ar], [n].[title_en]
FROM [notification_templates] AS [n]
WHERE [n].[Id] = @__Parse_0
2025-02-06 13:48:21.097 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@__Parse_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [n].[Id], [n].[additional_data], [n].[big_picture_url], [n].[Body], [n].[body_ar], [n].[body_en], [n].[created_at], [n].[expiry_at], [n].[large_icon_url], [n].[Route], [n].[target_criteria], [n].[Title], [n].[title_ar], [n].[title_en]
FROM [notification_templates] AS [n]
WHERE [n].[Id] = @__Parse_0
2025-02-06 13:48:21.100 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@__Parse_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [n].[Id], [n].[additional_data], [n].[big_picture_url], [n].[Body], [n].[body_ar], [n].[body_en], [n].[created_at], [n].[expiry_at], [n].[large_icon_url], [n].[Route], [n].[target_criteria], [n].[Title], [n].[title_ar], [n].[title_en]
FROM [notification_templates] AS [n]
WHERE [n].[Id] = @__Parse_0
2025-02-06 13:48:21.103 +03:00 [INF] Executed DbCommand (0ms) [Parameters=[@__Parse_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [n].[Id], [n].[additional_data], [n].[big_picture_url], [n].[Body], [n].[body_ar], [n].[body_en], [n].[created_at], [n].[expiry_at], [n].[large_icon_url], [n].[Route], [n].[target_criteria], [n].[Title], [n].[title_ar], [n].[title_en]
FROM [notification_templates] AS [n]
WHERE [n].[Id] = @__Parse_0
2025-02-06 13:48:21.105 +03:00 [INF] Executed DbCommand (0ms) [Parameters=[@__Parse_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [n].[Id], [n].[additional_data], [n].[big_picture_url], [n].[Body], [n].[body_ar], [n].[body_en], [n].[created_at], [n].[expiry_at], [n].[large_icon_url], [n].[Route], [n].[target_criteria], [n].[Title], [n].[title_ar], [n].[title_en]
FROM [notification_templates] AS [n]
WHERE [n].[Id] = @__Parse_0
2025-02-06 13:48:21.107 +03:00 [INF] Executed DbCommand (0ms) [Parameters=[@__Parse_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [n].[Id], [n].[additional_data], [n].[big_picture_url], [n].[Body], [n].[body_ar], [n].[body_en], [n].[created_at], [n].[expiry_at], [n].[large_icon_url], [n].[Route], [n].[target_criteria], [n].[Title], [n].[title_ar], [n].[title_en]
FROM [notification_templates] AS [n]
WHERE [n].[Id] = @__Parse_0
2025-02-06 13:48:21.109 +03:00 [INF] Executed DbCommand (0ms) [Parameters=[@__Parse_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [n].[Id], [n].[additional_data], [n].[big_picture_url], [n].[Body], [n].[body_ar], [n].[body_en], [n].[created_at], [n].[expiry_at], [n].[large_icon_url], [n].[Route], [n].[target_criteria], [n].[Title], [n].[title_ar], [n].[title_en]
FROM [notification_templates] AS [n]
WHERE [n].[Id] = @__Parse_0
2025-02-06 13:48:21.111 +03:00 [INF] Executed DbCommand (0ms) [Parameters=[@__Parse_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [n].[Id], [n].[additional_data], [n].[big_picture_url], [n].[Body], [n].[body_ar], [n].[body_en], [n].[created_at], [n].[expiry_at], [n].[large_icon_url], [n].[Route], [n].[target_criteria], [n].[Title], [n].[title_ar], [n].[title_en]
FROM [notification_templates] AS [n]
WHERE [n].[Id] = @__Parse_0
2025-02-06 13:48:21.114 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@__Parse_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [n].[Id], [n].[additional_data], [n].[big_picture_url], [n].[Body], [n].[body_ar], [n].[body_en], [n].[created_at], [n].[expiry_at], [n].[large_icon_url], [n].[Route], [n].[target_criteria], [n].[Title], [n].[title_ar], [n].[title_en]
FROM [notification_templates] AS [n]
WHERE [n].[Id] = @__Parse_0
2025-02-06 13:48:21.118 +03:00 [INF] Executed DbCommand (0ms) [Parameters=[@__Parse_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [n].[Id], [n].[additional_data], [n].[big_picture_url], [n].[Body], [n].[body_ar], [n].[body_en], [n].[created_at], [n].[expiry_at], [n].[large_icon_url], [n].[Route], [n].[target_criteria], [n].[Title], [n].[title_ar], [n].[title_en]
FROM [notification_templates] AS [n]
WHERE [n].[Id] = @__Parse_0
2025-02-06 13:48:21.121 +03:00 [INF] Executed DbCommand (0ms) [Parameters=[@__Parse_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [n].[Id], [n].[additional_data], [n].[big_picture_url], [n].[Body], [n].[body_ar], [n].[body_en], [n].[created_at], [n].[expiry_at], [n].[large_icon_url], [n].[Route], [n].[target_criteria], [n].[Title], [n].[title_ar], [n].[title_en]
FROM [notification_templates] AS [n]
WHERE [n].[Id] = @__Parse_0
2025-02-06 13:48:21.123 +03:00 [INF] Executed DbCommand (0ms) [Parameters=[@__Parse_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [n].[Id], [n].[additional_data], [n].[big_picture_url], [n].[Body], [n].[body_ar], [n].[body_en], [n].[created_at], [n].[expiry_at], [n].[large_icon_url], [n].[Route], [n].[target_criteria], [n].[Title], [n].[title_ar], [n].[title_en]
FROM [notification_templates] AS [n]
WHERE [n].[Id] = @__Parse_0
2025-02-06 13:48:21.125 +03:00 [INF] Executed DbCommand (0ms) [Parameters=[@__Parse_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [n].[Id], [n].[additional_data], [n].[big_picture_url], [n].[Body], [n].[body_ar], [n].[body_en], [n].[created_at], [n].[expiry_at], [n].[large_icon_url], [n].[Route], [n].[target_criteria], [n].[Title], [n].[title_ar], [n].[title_en]
FROM [notification_templates] AS [n]
WHERE [n].[Id] = @__Parse_0
2025-02-06 13:48:21.154 +03:00 [INF] Executed DbCommand (27ms) [Parameters=[@p0='?' (Size = 4000), @p1='?' (DbType = DateTime2), @p2='?' (Size = 4000), @p3='?' (Size = 4000), @p4='?' (Size = 4000), @p5='?' (Size = 450), @p6='?' (Size = 4000), @p7='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SET IMPLICIT_TRANSACTIONS OFF;
SET NOCOUNT ON;
INSERT INTO [AuthLogs] ([AuthType], [CreatedAt], [DeviceId], [FailureReason], [IpAddress], [NationalId], [Status], [UserAgent])
OUTPUT INSERTED.[Id]
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7);
2025-02-06 13:48:21.157 +03:00 [ERR] An exception occurred in the database while saving changes for context type 'NayifatAPI.Data.ApplicationDbContext'.
Microsoft.EntityFrameworkCore.DbUpdateException: An error occurred while saving the entity changes. See the inner exception for details.
 ---> Microsoft.Data.SqlClient.SqlException (0x80131904): The INSERT statement conflicted with the FOREIGN KEY constraint "FK_AuthLogs_Customers_NationalId". The conflict occurred in database "NayifatApp", table "dbo.Customers", column 'NationalId'.
   at Microsoft.Data.SqlClient.SqlConnection.OnError(SqlException exception, Boolean breakConnection, Action`1 wrapCloseInAction)
   at Microsoft.Data.SqlClient.SqlInternalConnection.OnError(SqlException exception, Boolean breakConnection, Action`1 wrapCloseInAction)
   at Microsoft.Data.SqlClient.TdsParser.ThrowExceptionAndWarning(TdsParserStateObject stateObj, Boolean callerHasConnectionLock, Boolean asyncClose)
   at Microsoft.Data.SqlClient.TdsParser.TryRun(RunBehavior runBehavior, SqlCommand cmdHandler, SqlDataReader dataStream, BulkCopySimpleResultSet bulkCopyHandler, TdsParserStateObject stateObj, Boolean& dataReady)
   at Microsoft.Data.SqlClient.SqlDataReader.TryHasMoreRows(Boolean& moreRows)
   at Microsoft.Data.SqlClient.SqlDataReader.TryReadInternal(Boolean setTimeout, Boolean& more)
   at Microsoft.Data.SqlClient.SqlDataReader.ReadAsyncExecute(Task task, Object state)
   at Microsoft.Data.SqlClient.SqlDataReader.InvokeAsyncCall[T](SqlDataReaderBaseAsyncCallContext`1 context)
--- End of stack trace from previous location ---
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeResultSetAsync(Int32 startCommandIndex, RelationalDataReader reader, CancellationToken cancellationToken)
ClientConnectionId:ff3cda03-76a9-4657-9ef7-558d22f177b9
Error Number:547,State:0,Class:16
   --- End of inner exception stack trace ---
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeResultSetAsync(Int32 startCommandIndex, RelationalDataReader reader, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeAsync(RelationalDataReader reader, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Update.Internal.SqlServerModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(IList`1 entriesToSave, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(StateManager stateManager, Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Storage.Internal.SqlServerExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
Microsoft.EntityFrameworkCore.DbUpdateException: An error occurred while saving the entity changes. See the inner exception for details.
 ---> Microsoft.Data.SqlClient.SqlException (0x80131904): The INSERT statement conflicted with the FOREIGN KEY constraint "FK_AuthLogs_Customers_NationalId". The conflict occurred in database "NayifatApp", table "dbo.Customers", column 'NationalId'.
   at Microsoft.Data.SqlClient.SqlConnection.OnError(SqlException exception, Boolean breakConnection, Action`1 wrapCloseInAction)
   at Microsoft.Data.SqlClient.SqlInternalConnection.OnError(SqlException exception, Boolean breakConnection, Action`1 wrapCloseInAction)
   at Microsoft.Data.SqlClient.TdsParser.ThrowExceptionAndWarning(TdsParserStateObject stateObj, Boolean callerHasConnectionLock, Boolean asyncClose)
   at Microsoft.Data.SqlClient.TdsParser.TryRun(RunBehavior runBehavior, SqlCommand cmdHandler, SqlDataReader dataStream, BulkCopySimpleResultSet bulkCopyHandler, TdsParserStateObject stateObj, Boolean& dataReady)
   at Microsoft.Data.SqlClient.SqlDataReader.TryHasMoreRows(Boolean& moreRows)
   at Microsoft.Data.SqlClient.SqlDataReader.TryReadInternal(Boolean setTimeout, Boolean& more)
   at Microsoft.Data.SqlClient.SqlDataReader.ReadAsyncExecute(Task task, Object state)
   at Microsoft.Data.SqlClient.SqlDataReader.InvokeAsyncCall[T](SqlDataReaderBaseAsyncCallContext`1 context)
--- End of stack trace from previous location ---
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeResultSetAsync(Int32 startCommandIndex, RelationalDataReader reader, CancellationToken cancellationToken)
ClientConnectionId:ff3cda03-76a9-4657-9ef7-558d22f177b9
Error Number:547,State:0,Class:16
   --- End of inner exception stack trace ---
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeResultSetAsync(Int32 startCommandIndex, RelationalDataReader reader, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeAsync(RelationalDataReader reader, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Update.Internal.SqlServerModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(IList`1 entriesToSave, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(StateManager stateManager, Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Storage.Internal.SqlServerExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
2025-02-06 13:48:21.169 +03:00 [ERR] Error logging audit event. NationalId: all, Action: notification_delivered, Details: {"notification_count":21,"notification_ids":[38,37,36,35,34,33,32,31,30,29,28,27,26,25,24,23,23,20,19,18,12],"timestamp":"2025-02-06T13:48:21.0607841"}
Microsoft.EntityFrameworkCore.DbUpdateException: An error occurred while saving the entity changes. See the inner exception for details.
 ---> Microsoft.Data.SqlClient.SqlException (0x80131904): The INSERT statement conflicted with the FOREIGN KEY constraint "FK_AuthLogs_Customers_NationalId". The conflict occurred in database "NayifatApp", table "dbo.Customers", column 'NationalId'.
   at Microsoft.Data.SqlClient.SqlConnection.OnError(SqlException exception, Boolean breakConnection, Action`1 wrapCloseInAction)
   at Microsoft.Data.SqlClient.SqlInternalConnection.OnError(SqlException exception, Boolean breakConnection, Action`1 wrapCloseInAction)
   at Microsoft.Data.SqlClient.TdsParser.ThrowExceptionAndWarning(TdsParserStateObject stateObj, Boolean callerHasConnectionLock, Boolean asyncClose)
   at Microsoft.Data.SqlClient.TdsParser.TryRun(RunBehavior runBehavior, SqlCommand cmdHandler, SqlDataReader dataStream, BulkCopySimpleResultSet bulkCopyHandler, TdsParserStateObject stateObj, Boolean& dataReady)
   at Microsoft.Data.SqlClient.SqlDataReader.TryHasMoreRows(Boolean& moreRows)
   at Microsoft.Data.SqlClient.SqlDataReader.TryReadInternal(Boolean setTimeout, Boolean& more)
   at Microsoft.Data.SqlClient.SqlDataReader.ReadAsyncExecute(Task task, Object state)
   at Microsoft.Data.SqlClient.SqlDataReader.InvokeAsyncCall[T](SqlDataReaderBaseAsyncCallContext`1 context)
--- End of stack trace from previous location ---
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeResultSetAsync(Int32 startCommandIndex, RelationalDataReader reader, CancellationToken cancellationToken)
ClientConnectionId:ff3cda03-76a9-4657-9ef7-558d22f177b9
Error Number:547,State:0,Class:16
   --- End of inner exception stack trace ---
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeResultSetAsync(Int32 startCommandIndex, RelationalDataReader reader, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeAsync(RelationalDataReader reader, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Update.Internal.SqlServerModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(IList`1 entriesToSave, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(StateManager stateManager, Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Storage.Internal.SqlServerExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at NayifatAPI.Services.AuditLogService.LogAsync(String nationalId, String action, Object details) in C:\Users\yamta\StudioProjects\nayifat_app_2025_new\NayifatAPI\Services\AuditLogService.cs:line 36
2025-02-06 13:48:21.183 +03:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType11`2[[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Object, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-02-06 13:48:21.186 +03:00 [INF] Executed action NayifatAPI.Controllers.NotificationsController.GetNotifications (NayifatAPI) in 131.5366ms
2025-02-06 13:48:21.187 +03:00 [INF] Executed endpoint 'NayifatAPI.Controllers.NotificationsController.GetNotifications (NayifatAPI)'
2025-02-06 13:48:21.188 +03:00 [INF] Request finished HTTP/1.1 POST http://eb3c-46-152-255-232.ngrok-free.app/api/notifications/list - 200 null application/json; charset=utf-8 140.5582ms
2025-02-06 13:52:39.747 +03:00 [INF] Request starting HTTP/1.1 POST http://eb3c-46-152-255-232.ngrok-free.app/api/notifications/list - application/json; charset=utf-8 45
2025-02-06 13:52:39.750 +03:00 [INF] Executing endpoint 'NayifatAPI.Controllers.NotificationsController.GetNotifications (NayifatAPI)'
2025-02-06 13:52:39.751 +03:00 [INF] Route matched with {action = "GetNotifications", controller = "Notifications"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetNotifications(NayifatAPI.Controllers.GetNotificationsRequest) on controller NayifatAPI.Controllers.NotificationsController (NayifatAPI).
2025-02-06 13:52:39.772 +03:00 [INF] Executed DbCommand (10ms) [Parameters=[@__providedApiKey_0='?' (Size = 255)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [a].[api_Key], [a].[CreatedAt], [a].[Description], [a].[ExpiresAt], [a].[IsActive], [a].[LastUsedAt]
FROM [ApiKeys] AS [a]
WHERE [a].[api_Key] = @__providedApiKey_0 AND [a].[IsActive] = CAST(1 AS bit)
2025-02-06 13:52:39.779 +03:00 [INF] Executed DbCommand (4ms) [Parameters=[@__request_NationalId_0='?' (Size = 450)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [u].[national_id], [u].[last_updated], [u].[notifications]
FROM [user_notifications] AS [u]
WHERE [u].[national_id] = @__request_NationalId_0
2025-02-06 13:52:39.782 +03:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType11`2[[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Object, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-02-06 13:52:39.783 +03:00 [INF] Executed action NayifatAPI.Controllers.NotificationsController.GetNotifications (NayifatAPI) in 30.3048ms
2025-02-06 13:52:39.786 +03:00 [INF] Executed endpoint 'NayifatAPI.Controllers.NotificationsController.GetNotifications (NayifatAPI)'
2025-02-06 13:52:39.787 +03:00 [INF] Request finished HTTP/1.1 POST http://eb3c-46-152-255-232.ngrok-free.app/api/notifications/list - 200 null application/json; charset=utf-8 40.7561ms
2025-02-06 13:52:40.165 +03:00 [INF] Request starting HTTP/1.1 POST http://eb3c-46-152-255-232.ngrok-free.app/api/notifications/list - application/json; charset=utf-8 39
2025-02-06 13:52:40.169 +03:00 [INF] Executing endpoint 'NayifatAPI.Controllers.NotificationsController.GetNotifications (NayifatAPI)'
2025-02-06 13:52:40.172 +03:00 [INF] Route matched with {action = "GetNotifications", controller = "Notifications"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetNotifications(NayifatAPI.Controllers.GetNotificationsRequest) on controller NayifatAPI.Controllers.NotificationsController (NayifatAPI).
2025-02-06 13:52:40.186 +03:00 [INF] Executed DbCommand (7ms) [Parameters=[@__providedApiKey_0='?' (Size = 255)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [a].[api_Key], [a].[CreatedAt], [a].[Description], [a].[ExpiresAt], [a].[IsActive], [a].[LastUsedAt]
FROM [ApiKeys] AS [a]
WHERE [a].[api_Key] = @__providedApiKey_0 AND [a].[IsActive] = CAST(1 AS bit)
2025-02-06 13:52:40.197 +03:00 [INF] Executed DbCommand (8ms) [Parameters=[@__request_NationalId_0='?' (Size = 450)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [u].[national_id], [u].[last_updated], [u].[notifications]
FROM [user_notifications] AS [u]
WHERE [u].[national_id] = @__request_NationalId_0
2025-02-06 13:52:40.204 +03:00 [INF] Executed DbCommand (4ms) [Parameters=[@__Parse_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [n].[Id], [n].[additional_data], [n].[big_picture_url], [n].[Body], [n].[body_ar], [n].[body_en], [n].[created_at], [n].[expiry_at], [n].[large_icon_url], [n].[Route], [n].[target_criteria], [n].[Title], [n].[title_ar], [n].[title_en]
FROM [notification_templates] AS [n]
WHERE [n].[Id] = @__Parse_0
2025-02-06 13:52:40.209 +03:00 [INF] Executed DbCommand (2ms) [Parameters=[@__Parse_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [n].[Id], [n].[additional_data], [n].[big_picture_url], [n].[Body], [n].[body_ar], [n].[body_en], [n].[created_at], [n].[expiry_at], [n].[large_icon_url], [n].[Route], [n].[target_criteria], [n].[Title], [n].[title_ar], [n].[title_en]
FROM [notification_templates] AS [n]
WHERE [n].[Id] = @__Parse_0
2025-02-06 13:52:40.213 +03:00 [INF] Executed DbCommand (0ms) [Parameters=[@__Parse_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [n].[Id], [n].[additional_data], [n].[big_picture_url], [n].[Body], [n].[body_ar], [n].[body_en], [n].[created_at], [n].[expiry_at], [n].[large_icon_url], [n].[Route], [n].[target_criteria], [n].[Title], [n].[title_ar], [n].[title_en]
FROM [notification_templates] AS [n]
WHERE [n].[Id] = @__Parse_0
2025-02-06 13:52:40.216 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@__Parse_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [n].[Id], [n].[additional_data], [n].[big_picture_url], [n].[Body], [n].[body_ar], [n].[body_en], [n].[created_at], [n].[expiry_at], [n].[large_icon_url], [n].[Route], [n].[target_criteria], [n].[Title], [n].[title_ar], [n].[title_en]
FROM [notification_templates] AS [n]
WHERE [n].[Id] = @__Parse_0
2025-02-06 13:52:40.221 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@__Parse_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [n].[Id], [n].[additional_data], [n].[big_picture_url], [n].[Body], [n].[body_ar], [n].[body_en], [n].[created_at], [n].[expiry_at], [n].[large_icon_url], [n].[Route], [n].[target_criteria], [n].[Title], [n].[title_ar], [n].[title_en]
FROM [notification_templates] AS [n]
WHERE [n].[Id] = @__Parse_0
2025-02-06 13:52:40.224 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@__Parse_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [n].[Id], [n].[additional_data], [n].[big_picture_url], [n].[Body], [n].[body_ar], [n].[body_en], [n].[created_at], [n].[expiry_at], [n].[large_icon_url], [n].[Route], [n].[target_criteria], [n].[Title], [n].[title_ar], [n].[title_en]
FROM [notification_templates] AS [n]
WHERE [n].[Id] = @__Parse_0
2025-02-06 13:52:40.227 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@__Parse_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [n].[Id], [n].[additional_data], [n].[big_picture_url], [n].[Body], [n].[body_ar], [n].[body_en], [n].[created_at], [n].[expiry_at], [n].[large_icon_url], [n].[Route], [n].[target_criteria], [n].[Title], [n].[title_ar], [n].[title_en]
FROM [notification_templates] AS [n]
WHERE [n].[Id] = @__Parse_0
2025-02-06 13:52:40.231 +03:00 [INF] Executed DbCommand (0ms) [Parameters=[@__Parse_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [n].[Id], [n].[additional_data], [n].[big_picture_url], [n].[Body], [n].[body_ar], [n].[body_en], [n].[created_at], [n].[expiry_at], [n].[large_icon_url], [n].[Route], [n].[target_criteria], [n].[Title], [n].[title_ar], [n].[title_en]
FROM [notification_templates] AS [n]
WHERE [n].[Id] = @__Parse_0
2025-02-06 13:52:40.234 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@__Parse_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [n].[Id], [n].[additional_data], [n].[big_picture_url], [n].[Body], [n].[body_ar], [n].[body_en], [n].[created_at], [n].[expiry_at], [n].[large_icon_url], [n].[Route], [n].[target_criteria], [n].[Title], [n].[title_ar], [n].[title_en]
FROM [notification_templates] AS [n]
WHERE [n].[Id] = @__Parse_0
2025-02-06 13:52:40.237 +03:00 [INF] Executed DbCommand (0ms) [Parameters=[@__Parse_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [n].[Id], [n].[additional_data], [n].[big_picture_url], [n].[Body], [n].[body_ar], [n].[body_en], [n].[created_at], [n].[expiry_at], [n].[large_icon_url], [n].[Route], [n].[target_criteria], [n].[Title], [n].[title_ar], [n].[title_en]
FROM [notification_templates] AS [n]
WHERE [n].[Id] = @__Parse_0
2025-02-06 13:52:40.239 +03:00 [INF] Executed DbCommand (0ms) [Parameters=[@__Parse_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [n].[Id], [n].[additional_data], [n].[big_picture_url], [n].[Body], [n].[body_ar], [n].[body_en], [n].[created_at], [n].[expiry_at], [n].[large_icon_url], [n].[Route], [n].[target_criteria], [n].[Title], [n].[title_ar], [n].[title_en]
FROM [notification_templates] AS [n]
WHERE [n].[Id] = @__Parse_0
2025-02-06 13:52:40.242 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@__Parse_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [n].[Id], [n].[additional_data], [n].[big_picture_url], [n].[Body], [n].[body_ar], [n].[body_en], [n].[created_at], [n].[expiry_at], [n].[large_icon_url], [n].[Route], [n].[target_criteria], [n].[Title], [n].[title_ar], [n].[title_en]
FROM [notification_templates] AS [n]
WHERE [n].[Id] = @__Parse_0
2025-02-06 13:52:40.244 +03:00 [INF] Executed DbCommand (0ms) [Parameters=[@__Parse_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [n].[Id], [n].[additional_data], [n].[big_picture_url], [n].[Body], [n].[body_ar], [n].[body_en], [n].[created_at], [n].[expiry_at], [n].[large_icon_url], [n].[Route], [n].[target_criteria], [n].[Title], [n].[title_ar], [n].[title_en]
FROM [notification_templates] AS [n]
WHERE [n].[Id] = @__Parse_0
2025-02-06 13:52:40.247 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@__Parse_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [n].[Id], [n].[additional_data], [n].[big_picture_url], [n].[Body], [n].[body_ar], [n].[body_en], [n].[created_at], [n].[expiry_at], [n].[large_icon_url], [n].[Route], [n].[target_criteria], [n].[Title], [n].[title_ar], [n].[title_en]
FROM [notification_templates] AS [n]
WHERE [n].[Id] = @__Parse_0
2025-02-06 13:52:40.250 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@__Parse_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [n].[Id], [n].[additional_data], [n].[big_picture_url], [n].[Body], [n].[body_ar], [n].[body_en], [n].[created_at], [n].[expiry_at], [n].[large_icon_url], [n].[Route], [n].[target_criteria], [n].[Title], [n].[title_ar], [n].[title_en]
FROM [notification_templates] AS [n]
WHERE [n].[Id] = @__Parse_0
2025-02-06 13:52:40.253 +03:00 [INF] Executed DbCommand (0ms) [Parameters=[@__Parse_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [n].[Id], [n].[additional_data], [n].[big_picture_url], [n].[Body], [n].[body_ar], [n].[body_en], [n].[created_at], [n].[expiry_at], [n].[large_icon_url], [n].[Route], [n].[target_criteria], [n].[Title], [n].[title_ar], [n].[title_en]
FROM [notification_templates] AS [n]
WHERE [n].[Id] = @__Parse_0
2025-02-06 13:52:40.256 +03:00 [INF] Executed DbCommand (0ms) [Parameters=[@__Parse_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [n].[Id], [n].[additional_data], [n].[big_picture_url], [n].[Body], [n].[body_ar], [n].[body_en], [n].[created_at], [n].[expiry_at], [n].[large_icon_url], [n].[Route], [n].[target_criteria], [n].[Title], [n].[title_ar], [n].[title_en]
FROM [notification_templates] AS [n]
WHERE [n].[Id] = @__Parse_0
2025-02-06 13:52:40.259 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@__Parse_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [n].[Id], [n].[additional_data], [n].[big_picture_url], [n].[Body], [n].[body_ar], [n].[body_en], [n].[created_at], [n].[expiry_at], [n].[large_icon_url], [n].[Route], [n].[target_criteria], [n].[Title], [n].[title_ar], [n].[title_en]
FROM [notification_templates] AS [n]
WHERE [n].[Id] = @__Parse_0
2025-02-06 13:52:40.263 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@__Parse_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [n].[Id], [n].[additional_data], [n].[big_picture_url], [n].[Body], [n].[body_ar], [n].[body_en], [n].[created_at], [n].[expiry_at], [n].[large_icon_url], [n].[Route], [n].[target_criteria], [n].[Title], [n].[title_ar], [n].[title_en]
FROM [notification_templates] AS [n]
WHERE [n].[Id] = @__Parse_0
2025-02-06 13:52:40.266 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@__Parse_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [n].[Id], [n].[additional_data], [n].[big_picture_url], [n].[Body], [n].[body_ar], [n].[body_en], [n].[created_at], [n].[expiry_at], [n].[large_icon_url], [n].[Route], [n].[target_criteria], [n].[Title], [n].[title_ar], [n].[title_en]
FROM [notification_templates] AS [n]
WHERE [n].[Id] = @__Parse_0
2025-02-06 13:52:40.269 +03:00 [INF] Executed DbCommand (0ms) [Parameters=[@__Parse_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [n].[Id], [n].[additional_data], [n].[big_picture_url], [n].[Body], [n].[body_ar], [n].[body_en], [n].[created_at], [n].[expiry_at], [n].[large_icon_url], [n].[Route], [n].[target_criteria], [n].[Title], [n].[title_ar], [n].[title_en]
FROM [notification_templates] AS [n]
WHERE [n].[Id] = @__Parse_0
2025-02-06 13:52:40.278 +03:00 [INF] Executed DbCommand (6ms) [Parameters=[@p0='?' (Size = 4000), @p1='?' (DbType = DateTime2), @p2='?' (Size = 4000), @p3='?' (Size = 4000), @p4='?' (Size = 4000), @p5='?' (Size = 450), @p6='?' (Size = 4000), @p7='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SET IMPLICIT_TRANSACTIONS OFF;
SET NOCOUNT ON;
INSERT INTO [AuthLogs] ([AuthType], [CreatedAt], [DeviceId], [FailureReason], [IpAddress], [NationalId], [Status], [UserAgent])
OUTPUT INSERTED.[Id]
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7);
2025-02-06 13:52:40.283 +03:00 [ERR] An exception occurred in the database while saving changes for context type 'NayifatAPI.Data.ApplicationDbContext'.
Microsoft.EntityFrameworkCore.DbUpdateException: An error occurred while saving the entity changes. See the inner exception for details.
 ---> Microsoft.Data.SqlClient.SqlException (0x80131904): The INSERT statement conflicted with the FOREIGN KEY constraint "FK_AuthLogs_Customers_NationalId". The conflict occurred in database "NayifatApp", table "dbo.Customers", column 'NationalId'.
   at Microsoft.Data.SqlClient.SqlConnection.OnError(SqlException exception, Boolean breakConnection, Action`1 wrapCloseInAction)
   at Microsoft.Data.SqlClient.SqlInternalConnection.OnError(SqlException exception, Boolean breakConnection, Action`1 wrapCloseInAction)
   at Microsoft.Data.SqlClient.TdsParser.ThrowExceptionAndWarning(TdsParserStateObject stateObj, Boolean callerHasConnectionLock, Boolean asyncClose)
   at Microsoft.Data.SqlClient.TdsParser.TryRun(RunBehavior runBehavior, SqlCommand cmdHandler, SqlDataReader dataStream, BulkCopySimpleResultSet bulkCopyHandler, TdsParserStateObject stateObj, Boolean& dataReady)
   at Microsoft.Data.SqlClient.SqlDataReader.TryHasMoreRows(Boolean& moreRows)
   at Microsoft.Data.SqlClient.SqlDataReader.TryReadInternal(Boolean setTimeout, Boolean& more)
   at Microsoft.Data.SqlClient.SqlDataReader.ReadAsyncExecute(Task task, Object state)
   at Microsoft.Data.SqlClient.SqlDataReader.InvokeAsyncCall[T](SqlDataReaderBaseAsyncCallContext`1 context)
--- End of stack trace from previous location ---
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeResultSetAsync(Int32 startCommandIndex, RelationalDataReader reader, CancellationToken cancellationToken)
ClientConnectionId:c605579d-71fc-40a8-9bf3-9e2b47014ae1
Error Number:547,State:0,Class:16
   --- End of inner exception stack trace ---
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeResultSetAsync(Int32 startCommandIndex, RelationalDataReader reader, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeAsync(RelationalDataReader reader, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Update.Internal.SqlServerModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(IList`1 entriesToSave, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(StateManager stateManager, Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Storage.Internal.SqlServerExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
Microsoft.EntityFrameworkCore.DbUpdateException: An error occurred while saving the entity changes. See the inner exception for details.
 ---> Microsoft.Data.SqlClient.SqlException (0x80131904): The INSERT statement conflicted with the FOREIGN KEY constraint "FK_AuthLogs_Customers_NationalId". The conflict occurred in database "NayifatApp", table "dbo.Customers", column 'NationalId'.
   at Microsoft.Data.SqlClient.SqlConnection.OnError(SqlException exception, Boolean breakConnection, Action`1 wrapCloseInAction)
   at Microsoft.Data.SqlClient.SqlInternalConnection.OnError(SqlException exception, Boolean breakConnection, Action`1 wrapCloseInAction)
   at Microsoft.Data.SqlClient.TdsParser.ThrowExceptionAndWarning(TdsParserStateObject stateObj, Boolean callerHasConnectionLock, Boolean asyncClose)
   at Microsoft.Data.SqlClient.TdsParser.TryRun(RunBehavior runBehavior, SqlCommand cmdHandler, SqlDataReader dataStream, BulkCopySimpleResultSet bulkCopyHandler, TdsParserStateObject stateObj, Boolean& dataReady)
   at Microsoft.Data.SqlClient.SqlDataReader.TryHasMoreRows(Boolean& moreRows)
   at Microsoft.Data.SqlClient.SqlDataReader.TryReadInternal(Boolean setTimeout, Boolean& more)
   at Microsoft.Data.SqlClient.SqlDataReader.ReadAsyncExecute(Task task, Object state)
   at Microsoft.Data.SqlClient.SqlDataReader.InvokeAsyncCall[T](SqlDataReaderBaseAsyncCallContext`1 context)
--- End of stack trace from previous location ---
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeResultSetAsync(Int32 startCommandIndex, RelationalDataReader reader, CancellationToken cancellationToken)
ClientConnectionId:c605579d-71fc-40a8-9bf3-9e2b47014ae1
Error Number:547,State:0,Class:16
   --- End of inner exception stack trace ---
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeResultSetAsync(Int32 startCommandIndex, RelationalDataReader reader, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeAsync(RelationalDataReader reader, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Update.Internal.SqlServerModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(IList`1 entriesToSave, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(StateManager stateManager, Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Storage.Internal.SqlServerExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
2025-02-06 13:52:40.306 +03:00 [ERR] Error logging audit event. NationalId: all, Action: notification_delivered, Details: {"notification_count":21,"notification_ids":[38,37,36,35,34,33,32,31,30,29,28,27,26,25,24,23,23,20,19,18,12],"timestamp":"2025-02-06T13:52:40.2000869"}
Microsoft.EntityFrameworkCore.DbUpdateException: An error occurred while saving the entity changes. See the inner exception for details.
 ---> Microsoft.Data.SqlClient.SqlException (0x80131904): The INSERT statement conflicted with the FOREIGN KEY constraint "FK_AuthLogs_Customers_NationalId". The conflict occurred in database "NayifatApp", table "dbo.Customers", column 'NationalId'.
   at Microsoft.Data.SqlClient.SqlConnection.OnError(SqlException exception, Boolean breakConnection, Action`1 wrapCloseInAction)
   at Microsoft.Data.SqlClient.SqlInternalConnection.OnError(SqlException exception, Boolean breakConnection, Action`1 wrapCloseInAction)
   at Microsoft.Data.SqlClient.TdsParser.ThrowExceptionAndWarning(TdsParserStateObject stateObj, Boolean callerHasConnectionLock, Boolean asyncClose)
   at Microsoft.Data.SqlClient.TdsParser.TryRun(RunBehavior runBehavior, SqlCommand cmdHandler, SqlDataReader dataStream, BulkCopySimpleResultSet bulkCopyHandler, TdsParserStateObject stateObj, Boolean& dataReady)
   at Microsoft.Data.SqlClient.SqlDataReader.TryHasMoreRows(Boolean& moreRows)
   at Microsoft.Data.SqlClient.SqlDataReader.TryReadInternal(Boolean setTimeout, Boolean& more)
   at Microsoft.Data.SqlClient.SqlDataReader.ReadAsyncExecute(Task task, Object state)
   at Microsoft.Data.SqlClient.SqlDataReader.InvokeAsyncCall[T](SqlDataReaderBaseAsyncCallContext`1 context)
--- End of stack trace from previous location ---
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeResultSetAsync(Int32 startCommandIndex, RelationalDataReader reader, CancellationToken cancellationToken)
ClientConnectionId:c605579d-71fc-40a8-9bf3-9e2b47014ae1
Error Number:547,State:0,Class:16
   --- End of inner exception stack trace ---
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeResultSetAsync(Int32 startCommandIndex, RelationalDataReader reader, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeAsync(RelationalDataReader reader, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Update.Internal.SqlServerModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(IList`1 entriesToSave, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(StateManager stateManager, Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Storage.Internal.SqlServerExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at NayifatAPI.Services.AuditLogService.LogAsync(String nationalId, String action, Object details) in C:\Users\yamta\StudioProjects\nayifat_app_2025_new\NayifatAPI\Services\AuditLogService.cs:line 36
2025-02-06 13:52:40.319 +03:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType11`2[[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Object, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-02-06 13:52:40.321 +03:00 [INF] Executed action NayifatAPI.Controllers.NotificationsController.GetNotifications (NayifatAPI) in 143.466ms
2025-02-06 13:52:40.323 +03:00 [INF] Executed endpoint 'NayifatAPI.Controllers.NotificationsController.GetNotifications (NayifatAPI)'
2025-02-06 13:52:40.325 +03:00 [INF] Request finished HTTP/1.1 POST http://eb3c-46-152-255-232.ngrok-free.app/api/notifications/list - 200 null application/json; charset=utf-8 160.5415ms
2025-02-06 13:53:22.385 +03:00 [INF] Request starting HTTP/1.1 POST http://eb3c-46-152-255-232.ngrok-free.app/api/notifications/list - application/json; charset=utf-8 45
2025-02-06 13:53:22.837 +03:00 [INF] Executing endpoint 'NayifatAPI.Controllers.NotificationsController.GetNotifications (NayifatAPI)'
2025-02-06 13:53:22.898 +03:00 [INF] Route matched with {action = "GetNotifications", controller = "Notifications"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetNotifications(NayifatAPI.Controllers.GetNotificationsRequest) on controller NayifatAPI.Controllers.NotificationsController (NayifatAPI).
2025-02-06 13:53:22.947 +03:00 [INF] Executed DbCommand (39ms) [Parameters=[@__providedApiKey_0='?' (Size = 255)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [a].[api_Key], [a].[CreatedAt], [a].[Description], [a].[ExpiresAt], [a].[IsActive], [a].[LastUsedAt]
FROM [ApiKeys] AS [a]
WHERE [a].[api_Key] = @__providedApiKey_0 AND [a].[IsActive] = CAST(1 AS bit)
2025-02-06 13:53:23.167 +03:00 [INF] Executed DbCommand (217ms) [Parameters=[@__request_NationalId_0='?' (Size = 450)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [u].[national_id], [u].[last_updated], [u].[notifications]
FROM [user_notifications] AS [u]
WHERE [u].[national_id] = @__request_NationalId_0
2025-02-06 13:53:23.215 +03:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType11`2[[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Object, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-02-06 13:53:23.219 +03:00 [INF] Executed action NayifatAPI.Controllers.NotificationsController.GetNotifications (NayifatAPI) in 314.2174ms
2025-02-06 13:53:23.221 +03:00 [INF] Executed endpoint 'NayifatAPI.Controllers.NotificationsController.GetNotifications (NayifatAPI)'
2025-02-06 13:53:23.226 +03:00 [INF] Request finished HTTP/1.1 POST http://eb3c-46-152-255-232.ngrok-free.app/api/notifications/list - 200 null application/json; charset=utf-8 839.3861ms
2025-02-06 13:53:23.951 +03:00 [INF] Request starting HTTP/1.1 POST http://eb3c-46-152-255-232.ngrok-free.app/api/notifications/list - application/json; charset=utf-8 39
2025-02-06 13:53:24.061 +03:00 [INF] Executing endpoint 'NayifatAPI.Controllers.NotificationsController.GetNotifications (NayifatAPI)'
2025-02-06 13:53:24.066 +03:00 [INF] Route matched with {action = "GetNotifications", controller = "Notifications"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetNotifications(NayifatAPI.Controllers.GetNotificationsRequest) on controller NayifatAPI.Controllers.NotificationsController (NayifatAPI).
2025-02-06 13:53:24.222 +03:00 [INF] Executed DbCommand (148ms) [Parameters=[@__providedApiKey_0='?' (Size = 255)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [a].[api_Key], [a].[CreatedAt], [a].[Description], [a].[ExpiresAt], [a].[IsActive], [a].[LastUsedAt]
FROM [ApiKeys] AS [a]
WHERE [a].[api_Key] = @__providedApiKey_0 AND [a].[IsActive] = CAST(1 AS bit)
2025-02-06 13:53:24.342 +03:00 [INF] Executed DbCommand (118ms) [Parameters=[@__request_NationalId_0='?' (Size = 450)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [u].[national_id], [u].[last_updated], [u].[notifications]
FROM [user_notifications] AS [u]
WHERE [u].[national_id] = @__request_NationalId_0
2025-02-06 13:53:24.352 +03:00 [INF] Executed DbCommand (5ms) [Parameters=[@__Parse_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [n].[Id], [n].[additional_data], [n].[big_picture_url], [n].[Body], [n].[body_ar], [n].[body_en], [n].[created_at], [n].[expiry_at], [n].[large_icon_url], [n].[Route], [n].[target_criteria], [n].[Title], [n].[title_ar], [n].[title_en]
FROM [notification_templates] AS [n]
WHERE [n].[Id] = @__Parse_0
2025-02-06 13:53:24.357 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@__Parse_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [n].[Id], [n].[additional_data], [n].[big_picture_url], [n].[Body], [n].[body_ar], [n].[body_en], [n].[created_at], [n].[expiry_at], [n].[large_icon_url], [n].[Route], [n].[target_criteria], [n].[Title], [n].[title_ar], [n].[title_en]
FROM [notification_templates] AS [n]
WHERE [n].[Id] = @__Parse_0
2025-02-06 13:53:24.363 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@__Parse_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [n].[Id], [n].[additional_data], [n].[big_picture_url], [n].[Body], [n].[body_ar], [n].[body_en], [n].[created_at], [n].[expiry_at], [n].[large_icon_url], [n].[Route], [n].[target_criteria], [n].[Title], [n].[title_ar], [n].[title_en]
FROM [notification_templates] AS [n]
WHERE [n].[Id] = @__Parse_0
2025-02-06 13:53:24.371 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@__Parse_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [n].[Id], [n].[additional_data], [n].[big_picture_url], [n].[Body], [n].[body_ar], [n].[body_en], [n].[created_at], [n].[expiry_at], [n].[large_icon_url], [n].[Route], [n].[target_criteria], [n].[Title], [n].[title_ar], [n].[title_en]
FROM [notification_templates] AS [n]
WHERE [n].[Id] = @__Parse_0
2025-02-06 13:53:24.376 +03:00 [INF] Executed DbCommand (0ms) [Parameters=[@__Parse_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [n].[Id], [n].[additional_data], [n].[big_picture_url], [n].[Body], [n].[body_ar], [n].[body_en], [n].[created_at], [n].[expiry_at], [n].[large_icon_url], [n].[Route], [n].[target_criteria], [n].[Title], [n].[title_ar], [n].[title_en]
FROM [notification_templates] AS [n]
WHERE [n].[Id] = @__Parse_0
2025-02-06 13:53:24.379 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@__Parse_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [n].[Id], [n].[additional_data], [n].[big_picture_url], [n].[Body], [n].[body_ar], [n].[body_en], [n].[created_at], [n].[expiry_at], [n].[large_icon_url], [n].[Route], [n].[target_criteria], [n].[Title], [n].[title_ar], [n].[title_en]
FROM [notification_templates] AS [n]
WHERE [n].[Id] = @__Parse_0
2025-02-06 13:53:24.384 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@__Parse_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [n].[Id], [n].[additional_data], [n].[big_picture_url], [n].[Body], [n].[body_ar], [n].[body_en], [n].[created_at], [n].[expiry_at], [n].[large_icon_url], [n].[Route], [n].[target_criteria], [n].[Title], [n].[title_ar], [n].[title_en]
FROM [notification_templates] AS [n]
WHERE [n].[Id] = @__Parse_0
2025-02-06 13:53:24.387 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@__Parse_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [n].[Id], [n].[additional_data], [n].[big_picture_url], [n].[Body], [n].[body_ar], [n].[body_en], [n].[created_at], [n].[expiry_at], [n].[large_icon_url], [n].[Route], [n].[target_criteria], [n].[Title], [n].[title_ar], [n].[title_en]
FROM [notification_templates] AS [n]
WHERE [n].[Id] = @__Parse_0
2025-02-06 13:53:24.392 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@__Parse_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [n].[Id], [n].[additional_data], [n].[big_picture_url], [n].[Body], [n].[body_ar], [n].[body_en], [n].[created_at], [n].[expiry_at], [n].[large_icon_url], [n].[Route], [n].[target_criteria], [n].[Title], [n].[title_ar], [n].[title_en]
FROM [notification_templates] AS [n]
WHERE [n].[Id] = @__Parse_0
2025-02-06 13:53:24.395 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@__Parse_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [n].[Id], [n].[additional_data], [n].[big_picture_url], [n].[Body], [n].[body_ar], [n].[body_en], [n].[created_at], [n].[expiry_at], [n].[large_icon_url], [n].[Route], [n].[target_criteria], [n].[Title], [n].[title_ar], [n].[title_en]
FROM [notification_templates] AS [n]
WHERE [n].[Id] = @__Parse_0
2025-02-06 13:53:24.398 +03:00 [INF] Executed DbCommand (0ms) [Parameters=[@__Parse_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [n].[Id], [n].[additional_data], [n].[big_picture_url], [n].[Body], [n].[body_ar], [n].[body_en], [n].[created_at], [n].[expiry_at], [n].[large_icon_url], [n].[Route], [n].[target_criteria], [n].[Title], [n].[title_ar], [n].[title_en]
FROM [notification_templates] AS [n]
WHERE [n].[Id] = @__Parse_0
2025-02-06 13:53:24.402 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@__Parse_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [n].[Id], [n].[additional_data], [n].[big_picture_url], [n].[Body], [n].[body_ar], [n].[body_en], [n].[created_at], [n].[expiry_at], [n].[large_icon_url], [n].[Route], [n].[target_criteria], [n].[Title], [n].[title_ar], [n].[title_en]
FROM [notification_templates] AS [n]
WHERE [n].[Id] = @__Parse_0
2025-02-06 13:53:24.405 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@__Parse_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [n].[Id], [n].[additional_data], [n].[big_picture_url], [n].[Body], [n].[body_ar], [n].[body_en], [n].[created_at], [n].[expiry_at], [n].[large_icon_url], [n].[Route], [n].[target_criteria], [n].[Title], [n].[title_ar], [n].[title_en]
FROM [notification_templates] AS [n]
WHERE [n].[Id] = @__Parse_0
2025-02-06 13:53:24.409 +03:00 [INF] Executed DbCommand (0ms) [Parameters=[@__Parse_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [n].[Id], [n].[additional_data], [n].[big_picture_url], [n].[Body], [n].[body_ar], [n].[body_en], [n].[created_at], [n].[expiry_at], [n].[large_icon_url], [n].[Route], [n].[target_criteria], [n].[Title], [n].[title_ar], [n].[title_en]
FROM [notification_templates] AS [n]
WHERE [n].[Id] = @__Parse_0
2025-02-06 13:53:24.413 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@__Parse_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [n].[Id], [n].[additional_data], [n].[big_picture_url], [n].[Body], [n].[body_ar], [n].[body_en], [n].[created_at], [n].[expiry_at], [n].[large_icon_url], [n].[Route], [n].[target_criteria], [n].[Title], [n].[title_ar], [n].[title_en]
FROM [notification_templates] AS [n]
WHERE [n].[Id] = @__Parse_0
2025-02-06 13:53:24.417 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@__Parse_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [n].[Id], [n].[additional_data], [n].[big_picture_url], [n].[Body], [n].[body_ar], [n].[body_en], [n].[created_at], [n].[expiry_at], [n].[large_icon_url], [n].[Route], [n].[target_criteria], [n].[Title], [n].[title_ar], [n].[title_en]
FROM [notification_templates] AS [n]
WHERE [n].[Id] = @__Parse_0
2025-02-06 13:53:24.421 +03:00 [INF] Executed DbCommand (0ms) [Parameters=[@__Parse_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [n].[Id], [n].[additional_data], [n].[big_picture_url], [n].[Body], [n].[body_ar], [n].[body_en], [n].[created_at], [n].[expiry_at], [n].[large_icon_url], [n].[Route], [n].[target_criteria], [n].[Title], [n].[title_ar], [n].[title_en]
FROM [notification_templates] AS [n]
WHERE [n].[Id] = @__Parse_0
2025-02-06 13:53:24.424 +03:00 [INF] Executed DbCommand (0ms) [Parameters=[@__Parse_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [n].[Id], [n].[additional_data], [n].[big_picture_url], [n].[Body], [n].[body_ar], [n].[body_en], [n].[created_at], [n].[expiry_at], [n].[large_icon_url], [n].[Route], [n].[target_criteria], [n].[Title], [n].[title_ar], [n].[title_en]
FROM [notification_templates] AS [n]
WHERE [n].[Id] = @__Parse_0
2025-02-06 13:53:24.428 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@__Parse_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [n].[Id], [n].[additional_data], [n].[big_picture_url], [n].[Body], [n].[body_ar], [n].[body_en], [n].[created_at], [n].[expiry_at], [n].[large_icon_url], [n].[Route], [n].[target_criteria], [n].[Title], [n].[title_ar], [n].[title_en]
FROM [notification_templates] AS [n]
WHERE [n].[Id] = @__Parse_0
2025-02-06 13:53:24.431 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@__Parse_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [n].[Id], [n].[additional_data], [n].[big_picture_url], [n].[Body], [n].[body_ar], [n].[body_en], [n].[created_at], [n].[expiry_at], [n].[large_icon_url], [n].[Route], [n].[target_criteria], [n].[Title], [n].[title_ar], [n].[title_en]
FROM [notification_templates] AS [n]
WHERE [n].[Id] = @__Parse_0
2025-02-06 13:53:24.436 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@__Parse_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [n].[Id], [n].[additional_data], [n].[big_picture_url], [n].[Body], [n].[body_ar], [n].[body_en], [n].[created_at], [n].[expiry_at], [n].[large_icon_url], [n].[Route], [n].[target_criteria], [n].[Title], [n].[title_ar], [n].[title_en]
FROM [notification_templates] AS [n]
WHERE [n].[Id] = @__Parse_0
2025-02-06 13:53:24.445 +03:00 [INF] Executed DbCommand (6ms) [Parameters=[@p0='?' (Size = 4000), @p1='?' (DbType = DateTime2), @p2='?' (Size = 4000), @p3='?' (Size = 4000), @p4='?' (Size = 4000), @p5='?' (Size = 450), @p6='?' (Size = 4000), @p7='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SET IMPLICIT_TRANSACTIONS OFF;
SET NOCOUNT ON;
INSERT INTO [AuthLogs] ([AuthType], [CreatedAt], [DeviceId], [FailureReason], [IpAddress], [NationalId], [Status], [UserAgent])
OUTPUT INSERTED.[Id]
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7);
2025-02-06 13:53:24.448 +03:00 [ERR] An exception occurred in the database while saving changes for context type 'NayifatAPI.Data.ApplicationDbContext'.
Microsoft.EntityFrameworkCore.DbUpdateException: An error occurred while saving the entity changes. See the inner exception for details.
 ---> Microsoft.Data.SqlClient.SqlException (0x80131904): The INSERT statement conflicted with the FOREIGN KEY constraint "FK_AuthLogs_Customers_NationalId". The conflict occurred in database "NayifatApp", table "dbo.Customers", column 'NationalId'.
   at Microsoft.Data.SqlClient.SqlConnection.OnError(SqlException exception, Boolean breakConnection, Action`1 wrapCloseInAction)
   at Microsoft.Data.SqlClient.SqlInternalConnection.OnError(SqlException exception, Boolean breakConnection, Action`1 wrapCloseInAction)
   at Microsoft.Data.SqlClient.TdsParser.ThrowExceptionAndWarning(TdsParserStateObject stateObj, Boolean callerHasConnectionLock, Boolean asyncClose)
   at Microsoft.Data.SqlClient.TdsParser.TryRun(RunBehavior runBehavior, SqlCommand cmdHandler, SqlDataReader dataStream, BulkCopySimpleResultSet bulkCopyHandler, TdsParserStateObject stateObj, Boolean& dataReady)
   at Microsoft.Data.SqlClient.SqlDataReader.TryHasMoreRows(Boolean& moreRows)
   at Microsoft.Data.SqlClient.SqlDataReader.TryReadInternal(Boolean setTimeout, Boolean& more)
   at Microsoft.Data.SqlClient.SqlDataReader.ReadAsyncExecute(Task task, Object state)
   at Microsoft.Data.SqlClient.SqlDataReader.InvokeAsyncCall[T](SqlDataReaderBaseAsyncCallContext`1 context)
--- End of stack trace from previous location ---
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeResultSetAsync(Int32 startCommandIndex, RelationalDataReader reader, CancellationToken cancellationToken)
ClientConnectionId:c605579d-71fc-40a8-9bf3-9e2b47014ae1
Error Number:547,State:0,Class:16
   --- End of inner exception stack trace ---
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeResultSetAsync(Int32 startCommandIndex, RelationalDataReader reader, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeAsync(RelationalDataReader reader, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Update.Internal.SqlServerModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(IList`1 entriesToSave, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(StateManager stateManager, Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Storage.Internal.SqlServerExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
Microsoft.EntityFrameworkCore.DbUpdateException: An error occurred while saving the entity changes. See the inner exception for details.
 ---> Microsoft.Data.SqlClient.SqlException (0x80131904): The INSERT statement conflicted with the FOREIGN KEY constraint "FK_AuthLogs_Customers_NationalId". The conflict occurred in database "NayifatApp", table "dbo.Customers", column 'NationalId'.
   at Microsoft.Data.SqlClient.SqlConnection.OnError(SqlException exception, Boolean breakConnection, Action`1 wrapCloseInAction)
   at Microsoft.Data.SqlClient.SqlInternalConnection.OnError(SqlException exception, Boolean breakConnection, Action`1 wrapCloseInAction)
   at Microsoft.Data.SqlClient.TdsParser.ThrowExceptionAndWarning(TdsParserStateObject stateObj, Boolean callerHasConnectionLock, Boolean asyncClose)
   at Microsoft.Data.SqlClient.TdsParser.TryRun(RunBehavior runBehavior, SqlCommand cmdHandler, SqlDataReader dataStream, BulkCopySimpleResultSet bulkCopyHandler, TdsParserStateObject stateObj, Boolean& dataReady)
   at Microsoft.Data.SqlClient.SqlDataReader.TryHasMoreRows(Boolean& moreRows)
   at Microsoft.Data.SqlClient.SqlDataReader.TryReadInternal(Boolean setTimeout, Boolean& more)
   at Microsoft.Data.SqlClient.SqlDataReader.ReadAsyncExecute(Task task, Object state)
   at Microsoft.Data.SqlClient.SqlDataReader.InvokeAsyncCall[T](SqlDataReaderBaseAsyncCallContext`1 context)
--- End of stack trace from previous location ---
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeResultSetAsync(Int32 startCommandIndex, RelationalDataReader reader, CancellationToken cancellationToken)
ClientConnectionId:c605579d-71fc-40a8-9bf3-9e2b47014ae1
Error Number:547,State:0,Class:16
   --- End of inner exception stack trace ---
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeResultSetAsync(Int32 startCommandIndex, RelationalDataReader reader, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeAsync(RelationalDataReader reader, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Update.Internal.SqlServerModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(IList`1 entriesToSave, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(StateManager stateManager, Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Storage.Internal.SqlServerExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
2025-02-06 13:53:24.471 +03:00 [ERR] Error logging audit event. NationalId: all, Action: notification_delivered, Details: {"notification_count":21,"notification_ids":[38,37,36,35,34,33,32,31,30,29,28,27,26,25,24,23,23,20,19,18,12],"timestamp":"2025-02-06T13:53:24.3465664"}
Microsoft.EntityFrameworkCore.DbUpdateException: An error occurred while saving the entity changes. See the inner exception for details.
 ---> Microsoft.Data.SqlClient.SqlException (0x80131904): The INSERT statement conflicted with the FOREIGN KEY constraint "FK_AuthLogs_Customers_NationalId". The conflict occurred in database "NayifatApp", table "dbo.Customers", column 'NationalId'.
   at Microsoft.Data.SqlClient.SqlConnection.OnError(SqlException exception, Boolean breakConnection, Action`1 wrapCloseInAction)
   at Microsoft.Data.SqlClient.SqlInternalConnection.OnError(SqlException exception, Boolean breakConnection, Action`1 wrapCloseInAction)
   at Microsoft.Data.SqlClient.TdsParser.ThrowExceptionAndWarning(TdsParserStateObject stateObj, Boolean callerHasConnectionLock, Boolean asyncClose)
   at Microsoft.Data.SqlClient.TdsParser.TryRun(RunBehavior runBehavior, SqlCommand cmdHandler, SqlDataReader dataStream, BulkCopySimpleResultSet bulkCopyHandler, TdsParserStateObject stateObj, Boolean& dataReady)
   at Microsoft.Data.SqlClient.SqlDataReader.TryHasMoreRows(Boolean& moreRows)
   at Microsoft.Data.SqlClient.SqlDataReader.TryReadInternal(Boolean setTimeout, Boolean& more)
   at Microsoft.Data.SqlClient.SqlDataReader.ReadAsyncExecute(Task task, Object state)
   at Microsoft.Data.SqlClient.SqlDataReader.InvokeAsyncCall[T](SqlDataReaderBaseAsyncCallContext`1 context)
--- End of stack trace from previous location ---
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeResultSetAsync(Int32 startCommandIndex, RelationalDataReader reader, CancellationToken cancellationToken)
ClientConnectionId:c605579d-71fc-40a8-9bf3-9e2b47014ae1
Error Number:547,State:0,Class:16
   --- End of inner exception stack trace ---
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeResultSetAsync(Int32 startCommandIndex, RelationalDataReader reader, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeAsync(RelationalDataReader reader, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Update.Internal.SqlServerModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(IList`1 entriesToSave, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(StateManager stateManager, Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Storage.Internal.SqlServerExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at NayifatAPI.Services.AuditLogService.LogAsync(String nationalId, String action, Object details) in C:\Users\yamta\StudioProjects\nayifat_app_2025_new\NayifatAPI\Services\AuditLogService.cs:line 36
2025-02-06 13:53:24.487 +03:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType11`2[[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Object, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-02-06 13:53:24.489 +03:00 [INF] Executed action NayifatAPI.Controllers.NotificationsController.GetNotifications (NayifatAPI) in 419.0272ms
2025-02-06 13:53:24.491 +03:00 [INF] Executed endpoint 'NayifatAPI.Controllers.NotificationsController.GetNotifications (NayifatAPI)'
2025-02-06 13:53:24.493 +03:00 [INF] Request finished HTTP/1.1 POST http://eb3c-46-152-255-232.ngrok-free.app/api/notifications/list - 200 null application/json; charset=utf-8 541.9195ms
2025-02-06 13:53:43.340 +03:00 [INF] Request starting HTTP/1.1 POST http://eb3c-46-152-255-232.ngrok-free.app/api/notifications/list - application/json 39
2025-02-06 13:53:43.343 +03:00 [INF] Executing endpoint 'NayifatAPI.Controllers.NotificationsController.GetNotifications (NayifatAPI)'
2025-02-06 13:53:43.344 +03:00 [INF] Route matched with {action = "GetNotifications", controller = "Notifications"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetNotifications(NayifatAPI.Controllers.GetNotificationsRequest) on controller NayifatAPI.Controllers.NotificationsController (NayifatAPI).
2025-02-06 13:53:43.352 +03:00 [INF] Executed DbCommand (5ms) [Parameters=[@__providedApiKey_0='?' (Size = 255)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [a].[api_Key], [a].[CreatedAt], [a].[Description], [a].[ExpiresAt], [a].[IsActive], [a].[LastUsedAt]
FROM [ApiKeys] AS [a]
WHERE [a].[api_Key] = @__providedApiKey_0 AND [a].[IsActive] = CAST(1 AS bit)
2025-02-06 13:53:43.358 +03:00 [INF] Executed DbCommand (3ms) [Parameters=[@__request_NationalId_0='?' (Size = 450)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [u].[national_id], [u].[last_updated], [u].[notifications]
FROM [user_notifications] AS [u]
WHERE [u].[national_id] = @__request_NationalId_0
2025-02-06 13:53:43.367 +03:00 [INF] Executed DbCommand (7ms) [Parameters=[@__Parse_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [n].[Id], [n].[additional_data], [n].[big_picture_url], [n].[Body], [n].[body_ar], [n].[body_en], [n].[created_at], [n].[expiry_at], [n].[large_icon_url], [n].[Route], [n].[target_criteria], [n].[Title], [n].[title_ar], [n].[title_en]
FROM [notification_templates] AS [n]
WHERE [n].[Id] = @__Parse_0
2025-02-06 13:53:43.373 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@__Parse_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [n].[Id], [n].[additional_data], [n].[big_picture_url], [n].[Body], [n].[body_ar], [n].[body_en], [n].[created_at], [n].[expiry_at], [n].[large_icon_url], [n].[Route], [n].[target_criteria], [n].[Title], [n].[title_ar], [n].[title_en]
FROM [notification_templates] AS [n]
WHERE [n].[Id] = @__Parse_0
2025-02-06 13:53:43.375 +03:00 [INF] Request starting HTTP/1.1 POST http://eb3c-46-152-255-232.ngrok-free.app/api/notifications/list - application/json 39
2025-02-06 13:53:43.378 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@__Parse_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [n].[Id], [n].[additional_data], [n].[big_picture_url], [n].[Body], [n].[body_ar], [n].[body_en], [n].[created_at], [n].[expiry_at], [n].[large_icon_url], [n].[Route], [n].[target_criteria], [n].[Title], [n].[title_ar], [n].[title_en]
FROM [notification_templates] AS [n]
WHERE [n].[Id] = @__Parse_0
2025-02-06 13:53:43.379 +03:00 [INF] Executing endpoint 'NayifatAPI.Controllers.NotificationsController.GetNotifications (NayifatAPI)'
2025-02-06 13:53:43.382 +03:00 [INF] Route matched with {action = "GetNotifications", controller = "Notifications"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetNotifications(NayifatAPI.Controllers.GetNotificationsRequest) on controller NayifatAPI.Controllers.NotificationsController (NayifatAPI).
2025-02-06 13:53:43.382 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@__Parse_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [n].[Id], [n].[additional_data], [n].[big_picture_url], [n].[Body], [n].[body_ar], [n].[body_en], [n].[created_at], [n].[expiry_at], [n].[large_icon_url], [n].[Route], [n].[target_criteria], [n].[Title], [n].[title_ar], [n].[title_en]
FROM [notification_templates] AS [n]
WHERE [n].[Id] = @__Parse_0
2025-02-06 13:53:43.389 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@__Parse_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [n].[Id], [n].[additional_data], [n].[big_picture_url], [n].[Body], [n].[body_ar], [n].[body_en], [n].[created_at], [n].[expiry_at], [n].[large_icon_url], [n].[Route], [n].[target_criteria], [n].[Title], [n].[title_ar], [n].[title_en]
FROM [notification_templates] AS [n]
WHERE [n].[Id] = @__Parse_0
2025-02-06 13:53:43.392 +03:00 [INF] Executed DbCommand (0ms) [Parameters=[@__providedApiKey_0='?' (Size = 255)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [a].[api_Key], [a].[CreatedAt], [a].[Description], [a].[ExpiresAt], [a].[IsActive], [a].[LastUsedAt]
FROM [ApiKeys] AS [a]
WHERE [a].[api_Key] = @__providedApiKey_0 AND [a].[IsActive] = CAST(1 AS bit)
2025-02-06 13:53:43.392 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@__Parse_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [n].[Id], [n].[additional_data], [n].[big_picture_url], [n].[Body], [n].[body_ar], [n].[body_en], [n].[created_at], [n].[expiry_at], [n].[large_icon_url], [n].[Route], [n].[target_criteria], [n].[Title], [n].[title_ar], [n].[title_en]
FROM [notification_templates] AS [n]
WHERE [n].[Id] = @__Parse_0
2025-02-06 13:53:43.395 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@__request_NationalId_0='?' (Size = 450)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [u].[national_id], [u].[last_updated], [u].[notifications]
FROM [user_notifications] AS [u]
WHERE [u].[national_id] = @__request_NationalId_0
2025-02-06 13:53:43.397 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@__Parse_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [n].[Id], [n].[additional_data], [n].[big_picture_url], [n].[Body], [n].[body_ar], [n].[body_en], [n].[created_at], [n].[expiry_at], [n].[large_icon_url], [n].[Route], [n].[target_criteria], [n].[Title], [n].[title_ar], [n].[title_en]
FROM [notification_templates] AS [n]
WHERE [n].[Id] = @__Parse_0
2025-02-06 13:53:43.398 +03:00 [INF] Executed DbCommand (0ms) [Parameters=[@__Parse_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [n].[Id], [n].[additional_data], [n].[big_picture_url], [n].[Body], [n].[body_ar], [n].[body_en], [n].[created_at], [n].[expiry_at], [n].[large_icon_url], [n].[Route], [n].[target_criteria], [n].[Title], [n].[title_ar], [n].[title_en]
FROM [notification_templates] AS [n]
WHERE [n].[Id] = @__Parse_0
2025-02-06 13:53:43.400 +03:00 [INF] Executed DbCommand (0ms) [Parameters=[@__Parse_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [n].[Id], [n].[additional_data], [n].[big_picture_url], [n].[Body], [n].[body_ar], [n].[body_en], [n].[created_at], [n].[expiry_at], [n].[large_icon_url], [n].[Route], [n].[target_criteria], [n].[Title], [n].[title_ar], [n].[title_en]
FROM [notification_templates] AS [n]
WHERE [n].[Id] = @__Parse_0
2025-02-06 13:53:43.402 +03:00 [INF] Executed DbCommand (0ms) [Parameters=[@__Parse_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [n].[Id], [n].[additional_data], [n].[big_picture_url], [n].[Body], [n].[body_ar], [n].[body_en], [n].[created_at], [n].[expiry_at], [n].[large_icon_url], [n].[Route], [n].[target_criteria], [n].[Title], [n].[title_ar], [n].[title_en]
FROM [notification_templates] AS [n]
WHERE [n].[Id] = @__Parse_0
2025-02-06 13:53:43.404 +03:00 [INF] Executed DbCommand (0ms) [Parameters=[@__Parse_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [n].[Id], [n].[additional_data], [n].[big_picture_url], [n].[Body], [n].[body_ar], [n].[body_en], [n].[created_at], [n].[expiry_at], [n].[large_icon_url], [n].[Route], [n].[target_criteria], [n].[Title], [n].[title_ar], [n].[title_en]
FROM [notification_templates] AS [n]
WHERE [n].[Id] = @__Parse_0
2025-02-06 13:53:43.406 +03:00 [INF] Executed DbCommand (0ms) [Parameters=[@__Parse_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [n].[Id], [n].[additional_data], [n].[big_picture_url], [n].[Body], [n].[body_ar], [n].[body_en], [n].[created_at], [n].[expiry_at], [n].[large_icon_url], [n].[Route], [n].[target_criteria], [n].[Title], [n].[title_ar], [n].[title_en]
FROM [notification_templates] AS [n]
WHERE [n].[Id] = @__Parse_0
2025-02-06 13:53:43.407 +03:00 [INF] Executed DbCommand (0ms) [Parameters=[@__Parse_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [n].[Id], [n].[additional_data], [n].[big_picture_url], [n].[Body], [n].[body_ar], [n].[body_en], [n].[created_at], [n].[expiry_at], [n].[large_icon_url], [n].[Route], [n].[target_criteria], [n].[Title], [n].[title_ar], [n].[title_en]
FROM [notification_templates] AS [n]
WHERE [n].[Id] = @__Parse_0
2025-02-06 13:53:43.409 +03:00 [INF] Executed DbCommand (0ms) [Parameters=[@__Parse_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [n].[Id], [n].[additional_data], [n].[big_picture_url], [n].[Body], [n].[body_ar], [n].[body_en], [n].[created_at], [n].[expiry_at], [n].[large_icon_url], [n].[Route], [n].[target_criteria], [n].[Title], [n].[title_ar], [n].[title_en]
FROM [notification_templates] AS [n]
WHERE [n].[Id] = @__Parse_0
2025-02-06 13:53:43.411 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@__Parse_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [n].[Id], [n].[additional_data], [n].[big_picture_url], [n].[Body], [n].[body_ar], [n].[body_en], [n].[created_at], [n].[expiry_at], [n].[large_icon_url], [n].[Route], [n].[target_criteria], [n].[Title], [n].[title_ar], [n].[title_en]
FROM [notification_templates] AS [n]
WHERE [n].[Id] = @__Parse_0
2025-02-06 13:53:43.413 +03:00 [INF] Executed DbCommand (0ms) [Parameters=[@__Parse_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [n].[Id], [n].[additional_data], [n].[big_picture_url], [n].[Body], [n].[body_ar], [n].[body_en], [n].[created_at], [n].[expiry_at], [n].[large_icon_url], [n].[Route], [n].[target_criteria], [n].[Title], [n].[title_ar], [n].[title_en]
FROM [notification_templates] AS [n]
WHERE [n].[Id] = @__Parse_0
2025-02-06 13:53:43.414 +03:00 [INF] Executed DbCommand (0ms) [Parameters=[@__Parse_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [n].[Id], [n].[additional_data], [n].[big_picture_url], [n].[Body], [n].[body_ar], [n].[body_en], [n].[created_at], [n].[expiry_at], [n].[large_icon_url], [n].[Route], [n].[target_criteria], [n].[Title], [n].[title_ar], [n].[title_en]
FROM [notification_templates] AS [n]
WHERE [n].[Id] = @__Parse_0
2025-02-06 13:53:43.416 +03:00 [INF] Executed DbCommand (0ms) [Parameters=[@__Parse_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [n].[Id], [n].[additional_data], [n].[big_picture_url], [n].[Body], [n].[body_ar], [n].[body_en], [n].[created_at], [n].[expiry_at], [n].[large_icon_url], [n].[Route], [n].[target_criteria], [n].[Title], [n].[title_ar], [n].[title_en]
FROM [notification_templates] AS [n]
WHERE [n].[Id] = @__Parse_0
2025-02-06 13:53:43.418 +03:00 [INF] Executed DbCommand (0ms) [Parameters=[@__Parse_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [n].[Id], [n].[additional_data], [n].[big_picture_url], [n].[Body], [n].[body_ar], [n].[body_en], [n].[created_at], [n].[expiry_at], [n].[large_icon_url], [n].[Route], [n].[target_criteria], [n].[Title], [n].[title_ar], [n].[title_en]
FROM [notification_templates] AS [n]
WHERE [n].[Id] = @__Parse_0
2025-02-06 13:53:43.420 +03:00 [INF] Executed DbCommand (0ms) [Parameters=[@__Parse_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [n].[Id], [n].[additional_data], [n].[big_picture_url], [n].[Body], [n].[body_ar], [n].[body_en], [n].[created_at], [n].[expiry_at], [n].[large_icon_url], [n].[Route], [n].[target_criteria], [n].[Title], [n].[title_ar], [n].[title_en]
FROM [notification_templates] AS [n]
WHERE [n].[Id] = @__Parse_0
2025-02-06 13:53:43.422 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@__Parse_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [n].[Id], [n].[additional_data], [n].[big_picture_url], [n].[Body], [n].[body_ar], [n].[body_en], [n].[created_at], [n].[expiry_at], [n].[large_icon_url], [n].[Route], [n].[target_criteria], [n].[Title], [n].[title_ar], [n].[title_en]
FROM [notification_templates] AS [n]
WHERE [n].[Id] = @__Parse_0
2025-02-06 13:53:43.424 +03:00 [INF] Executed DbCommand (0ms) [Parameters=[@__Parse_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [n].[Id], [n].[additional_data], [n].[big_picture_url], [n].[Body], [n].[body_ar], [n].[body_en], [n].[created_at], [n].[expiry_at], [n].[large_icon_url], [n].[Route], [n].[target_criteria], [n].[Title], [n].[title_ar], [n].[title_en]
FROM [notification_templates] AS [n]
WHERE [n].[Id] = @__Parse_0
2025-02-06 13:53:43.426 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@__Parse_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [n].[Id], [n].[additional_data], [n].[big_picture_url], [n].[Body], [n].[body_ar], [n].[body_en], [n].[created_at], [n].[expiry_at], [n].[large_icon_url], [n].[Route], [n].[target_criteria], [n].[Title], [n].[title_ar], [n].[title_en]
FROM [notification_templates] AS [n]
WHERE [n].[Id] = @__Parse_0
2025-02-06 13:53:43.428 +03:00 [INF] Executed DbCommand (0ms) [Parameters=[@__Parse_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [n].[Id], [n].[additional_data], [n].[big_picture_url], [n].[Body], [n].[body_ar], [n].[body_en], [n].[created_at], [n].[expiry_at], [n].[large_icon_url], [n].[Route], [n].[target_criteria], [n].[Title], [n].[title_ar], [n].[title_en]
FROM [notification_templates] AS [n]
WHERE [n].[Id] = @__Parse_0
2025-02-06 13:53:43.430 +03:00 [INF] Executed DbCommand (0ms) [Parameters=[@__Parse_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [n].[Id], [n].[additional_data], [n].[big_picture_url], [n].[Body], [n].[body_ar], [n].[body_en], [n].[created_at], [n].[expiry_at], [n].[large_icon_url], [n].[Route], [n].[target_criteria], [n].[Title], [n].[title_ar], [n].[title_en]
FROM [notification_templates] AS [n]
WHERE [n].[Id] = @__Parse_0
2025-02-06 13:53:43.432 +03:00 [INF] Executed DbCommand (0ms) [Parameters=[@__Parse_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [n].[Id], [n].[additional_data], [n].[big_picture_url], [n].[Body], [n].[body_ar], [n].[body_en], [n].[created_at], [n].[expiry_at], [n].[large_icon_url], [n].[Route], [n].[target_criteria], [n].[Title], [n].[title_ar], [n].[title_en]
FROM [notification_templates] AS [n]
WHERE [n].[Id] = @__Parse_0
2025-02-06 13:53:43.434 +03:00 [INF] Executed DbCommand (0ms) [Parameters=[@__Parse_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [n].[Id], [n].[additional_data], [n].[big_picture_url], [n].[Body], [n].[body_ar], [n].[body_en], [n].[created_at], [n].[expiry_at], [n].[large_icon_url], [n].[Route], [n].[target_criteria], [n].[Title], [n].[title_ar], [n].[title_en]
FROM [notification_templates] AS [n]
WHERE [n].[Id] = @__Parse_0
2025-02-06 13:53:43.436 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@__Parse_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [n].[Id], [n].[additional_data], [n].[big_picture_url], [n].[Body], [n].[body_ar], [n].[body_en], [n].[created_at], [n].[expiry_at], [n].[large_icon_url], [n].[Route], [n].[target_criteria], [n].[Title], [n].[title_ar], [n].[title_en]
FROM [notification_templates] AS [n]
WHERE [n].[Id] = @__Parse_0
2025-02-06 13:53:43.438 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@__Parse_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [n].[Id], [n].[additional_data], [n].[big_picture_url], [n].[Body], [n].[body_ar], [n].[body_en], [n].[created_at], [n].[expiry_at], [n].[large_icon_url], [n].[Route], [n].[target_criteria], [n].[Title], [n].[title_ar], [n].[title_en]
FROM [notification_templates] AS [n]
WHERE [n].[Id] = @__Parse_0
2025-02-06 13:53:43.440 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@__Parse_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [n].[Id], [n].[additional_data], [n].[big_picture_url], [n].[Body], [n].[body_ar], [n].[body_en], [n].[created_at], [n].[expiry_at], [n].[large_icon_url], [n].[Route], [n].[target_criteria], [n].[Title], [n].[title_ar], [n].[title_en]
FROM [notification_templates] AS [n]
WHERE [n].[Id] = @__Parse_0
2025-02-06 13:53:43.443 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@__Parse_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [n].[Id], [n].[additional_data], [n].[big_picture_url], [n].[Body], [n].[body_ar], [n].[body_en], [n].[created_at], [n].[expiry_at], [n].[large_icon_url], [n].[Route], [n].[target_criteria], [n].[Title], [n].[title_ar], [n].[title_en]
FROM [notification_templates] AS [n]
WHERE [n].[Id] = @__Parse_0
2025-02-06 13:53:43.444 +03:00 [INF] Executed DbCommand (0ms) [Parameters=[@__Parse_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [n].[Id], [n].[additional_data], [n].[big_picture_url], [n].[Body], [n].[body_ar], [n].[body_en], [n].[created_at], [n].[expiry_at], [n].[large_icon_url], [n].[Route], [n].[target_criteria], [n].[Title], [n].[title_ar], [n].[title_en]
FROM [notification_templates] AS [n]
WHERE [n].[Id] = @__Parse_0
2025-02-06 13:53:43.446 +03:00 [INF] Executed DbCommand (0ms) [Parameters=[@__Parse_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [n].[Id], [n].[additional_data], [n].[big_picture_url], [n].[Body], [n].[body_ar], [n].[body_en], [n].[created_at], [n].[expiry_at], [n].[large_icon_url], [n].[Route], [n].[target_criteria], [n].[Title], [n].[title_ar], [n].[title_en]
FROM [notification_templates] AS [n]
WHERE [n].[Id] = @__Parse_0
2025-02-06 13:53:43.448 +03:00 [INF] Executed DbCommand (0ms) [Parameters=[@__Parse_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [n].[Id], [n].[additional_data], [n].[big_picture_url], [n].[Body], [n].[body_ar], [n].[body_en], [n].[created_at], [n].[expiry_at], [n].[large_icon_url], [n].[Route], [n].[target_criteria], [n].[Title], [n].[title_ar], [n].[title_en]
FROM [notification_templates] AS [n]
WHERE [n].[Id] = @__Parse_0
2025-02-06 13:53:43.450 +03:00 [INF] Executed DbCommand (0ms) [Parameters=[@__Parse_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [n].[Id], [n].[additional_data], [n].[big_picture_url], [n].[Body], [n].[body_ar], [n].[body_en], [n].[created_at], [n].[expiry_at], [n].[large_icon_url], [n].[Route], [n].[target_criteria], [n].[Title], [n].[title_ar], [n].[title_en]
FROM [notification_templates] AS [n]
WHERE [n].[Id] = @__Parse_0
2025-02-06 13:53:43.452 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@__Parse_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [n].[Id], [n].[additional_data], [n].[big_picture_url], [n].[Body], [n].[body_ar], [n].[body_en], [n].[created_at], [n].[expiry_at], [n].[large_icon_url], [n].[Route], [n].[target_criteria], [n].[Title], [n].[title_ar], [n].[title_en]
FROM [notification_templates] AS [n]
WHERE [n].[Id] = @__Parse_0
2025-02-06 13:53:43.456 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@__Parse_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [n].[Id], [n].[additional_data], [n].[big_picture_url], [n].[Body], [n].[body_ar], [n].[body_en], [n].[created_at], [n].[expiry_at], [n].[large_icon_url], [n].[Route], [n].[target_criteria], [n].[Title], [n].[title_ar], [n].[title_en]
FROM [notification_templates] AS [n]
WHERE [n].[Id] = @__Parse_0
2025-02-06 13:53:43.460 +03:00 [INF] Executed DbCommand (0ms) [Parameters=[@__Parse_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [n].[Id], [n].[additional_data], [n].[big_picture_url], [n].[Body], [n].[body_ar], [n].[body_en], [n].[created_at], [n].[expiry_at], [n].[large_icon_url], [n].[Route], [n].[target_criteria], [n].[Title], [n].[title_ar], [n].[title_en]
FROM [notification_templates] AS [n]
WHERE [n].[Id] = @__Parse_0
2025-02-06 13:53:43.461 +03:00 [INF] Executed DbCommand (7ms) [Parameters=[@p0='?' (Size = 4000), @p1='?' (DbType = DateTime2), @p2='?' (Size = 4000), @p3='?' (Size = 4000), @p4='?' (Size = 4000), @p5='?' (Size = 450), @p6='?' (Size = 4000), @p7='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SET IMPLICIT_TRANSACTIONS OFF;
SET NOCOUNT ON;
INSERT INTO [AuthLogs] ([AuthType], [CreatedAt], [DeviceId], [FailureReason], [IpAddress], [NationalId], [Status], [UserAgent])
OUTPUT INSERTED.[Id]
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7);
2025-02-06 13:53:43.462 +03:00 [INF] Executed DbCommand (0ms) [Parameters=[@__Parse_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [n].[Id], [n].[additional_data], [n].[big_picture_url], [n].[Body], [n].[body_ar], [n].[body_en], [n].[created_at], [n].[expiry_at], [n].[large_icon_url], [n].[Route], [n].[target_criteria], [n].[Title], [n].[title_ar], [n].[title_en]
FROM [notification_templates] AS [n]
WHERE [n].[Id] = @__Parse_0
2025-02-06 13:53:43.465 +03:00 [ERR] An exception occurred in the database while saving changes for context type 'NayifatAPI.Data.ApplicationDbContext'.
Microsoft.EntityFrameworkCore.DbUpdateException: An error occurred while saving the entity changes. See the inner exception for details.
 ---> Microsoft.Data.SqlClient.SqlException (0x80131904): The INSERT statement conflicted with the FOREIGN KEY constraint "FK_AuthLogs_Customers_NationalId". The conflict occurred in database "NayifatApp", table "dbo.Customers", column 'NationalId'.
   at Microsoft.Data.SqlClient.SqlConnection.OnError(SqlException exception, Boolean breakConnection, Action`1 wrapCloseInAction)
   at Microsoft.Data.SqlClient.SqlInternalConnection.OnError(SqlException exception, Boolean breakConnection, Action`1 wrapCloseInAction)
   at Microsoft.Data.SqlClient.TdsParser.ThrowExceptionAndWarning(TdsParserStateObject stateObj, Boolean callerHasConnectionLock, Boolean asyncClose)
   at Microsoft.Data.SqlClient.TdsParser.TryRun(RunBehavior runBehavior, SqlCommand cmdHandler, SqlDataReader dataStream, BulkCopySimpleResultSet bulkCopyHandler, TdsParserStateObject stateObj, Boolean& dataReady)
   at Microsoft.Data.SqlClient.SqlDataReader.TryHasMoreRows(Boolean& moreRows)
   at Microsoft.Data.SqlClient.SqlDataReader.TryReadInternal(Boolean setTimeout, Boolean& more)
   at Microsoft.Data.SqlClient.SqlDataReader.ReadAsyncExecute(Task task, Object state)
   at Microsoft.Data.SqlClient.SqlDataReader.InvokeAsyncCall[T](SqlDataReaderBaseAsyncCallContext`1 context)
--- End of stack trace from previous location ---
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeResultSetAsync(Int32 startCommandIndex, RelationalDataReader reader, CancellationToken cancellationToken)
ClientConnectionId:c605579d-71fc-40a8-9bf3-9e2b47014ae1
Error Number:547,State:0,Class:16
   --- End of inner exception stack trace ---
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeResultSetAsync(Int32 startCommandIndex, RelationalDataReader reader, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeAsync(RelationalDataReader reader, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Update.Internal.SqlServerModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(IList`1 entriesToSave, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(StateManager stateManager, Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Storage.Internal.SqlServerExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
Microsoft.EntityFrameworkCore.DbUpdateException: An error occurred while saving the entity changes. See the inner exception for details.
 ---> Microsoft.Data.SqlClient.SqlException (0x80131904): The INSERT statement conflicted with the FOREIGN KEY constraint "FK_AuthLogs_Customers_NationalId". The conflict occurred in database "NayifatApp", table "dbo.Customers", column 'NationalId'.
   at Microsoft.Data.SqlClient.SqlConnection.OnError(SqlException exception, Boolean breakConnection, Action`1 wrapCloseInAction)
   at Microsoft.Data.SqlClient.SqlInternalConnection.OnError(SqlException exception, Boolean breakConnection, Action`1 wrapCloseInAction)
   at Microsoft.Data.SqlClient.TdsParser.ThrowExceptionAndWarning(TdsParserStateObject stateObj, Boolean callerHasConnectionLock, Boolean asyncClose)
   at Microsoft.Data.SqlClient.TdsParser.TryRun(RunBehavior runBehavior, SqlCommand cmdHandler, SqlDataReader dataStream, BulkCopySimpleResultSet bulkCopyHandler, TdsParserStateObject stateObj, Boolean& dataReady)
   at Microsoft.Data.SqlClient.SqlDataReader.TryHasMoreRows(Boolean& moreRows)
   at Microsoft.Data.SqlClient.SqlDataReader.TryReadInternal(Boolean setTimeout, Boolean& more)
   at Microsoft.Data.SqlClient.SqlDataReader.ReadAsyncExecute(Task task, Object state)
   at Microsoft.Data.SqlClient.SqlDataReader.InvokeAsyncCall[T](SqlDataReaderBaseAsyncCallContext`1 context)
--- End of stack trace from previous location ---
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeResultSetAsync(Int32 startCommandIndex, RelationalDataReader reader, CancellationToken cancellationToken)
ClientConnectionId:c605579d-71fc-40a8-9bf3-9e2b47014ae1
Error Number:547,State:0,Class:16
   --- End of inner exception stack trace ---
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeResultSetAsync(Int32 startCommandIndex, RelationalDataReader reader, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeAsync(RelationalDataReader reader, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Update.Internal.SqlServerModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(IList`1 entriesToSave, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(StateManager stateManager, Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Storage.Internal.SqlServerExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
2025-02-06 13:53:43.466 +03:00 [INF] Executed DbCommand (0ms) [Parameters=[@__Parse_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [n].[Id], [n].[additional_data], [n].[big_picture_url], [n].[Body], [n].[body_ar], [n].[body_en], [n].[created_at], [n].[expiry_at], [n].[large_icon_url], [n].[Route], [n].[target_criteria], [n].[Title], [n].[title_ar], [n].[title_en]
FROM [notification_templates] AS [n]
WHERE [n].[Id] = @__Parse_0
2025-02-06 13:53:43.481 +03:00 [ERR] Error logging audit event. NationalId: all, Action: notification_delivered, Details: {"notification_count":21,"notification_ids":[38,37,36,35,34,33,32,31,30,29,28,27,26,25,24,23,23,20,19,18,12],"timestamp":"2025-02-06T13:53:43.3604459"}
Microsoft.EntityFrameworkCore.DbUpdateException: An error occurred while saving the entity changes. See the inner exception for details.
 ---> Microsoft.Data.SqlClient.SqlException (0x80131904): The INSERT statement conflicted with the FOREIGN KEY constraint "FK_AuthLogs_Customers_NationalId". The conflict occurred in database "NayifatApp", table "dbo.Customers", column 'NationalId'.
   at Microsoft.Data.SqlClient.SqlConnection.OnError(SqlException exception, Boolean breakConnection, Action`1 wrapCloseInAction)
   at Microsoft.Data.SqlClient.SqlInternalConnection.OnError(SqlException exception, Boolean breakConnection, Action`1 wrapCloseInAction)
   at Microsoft.Data.SqlClient.TdsParser.ThrowExceptionAndWarning(TdsParserStateObject stateObj, Boolean callerHasConnectionLock, Boolean asyncClose)
   at Microsoft.Data.SqlClient.TdsParser.TryRun(RunBehavior runBehavior, SqlCommand cmdHandler, SqlDataReader dataStream, BulkCopySimpleResultSet bulkCopyHandler, TdsParserStateObject stateObj, Boolean& dataReady)
   at Microsoft.Data.SqlClient.SqlDataReader.TryHasMoreRows(Boolean& moreRows)
   at Microsoft.Data.SqlClient.SqlDataReader.TryReadInternal(Boolean setTimeout, Boolean& more)
   at Microsoft.Data.SqlClient.SqlDataReader.ReadAsyncExecute(Task task, Object state)
   at Microsoft.Data.SqlClient.SqlDataReader.InvokeAsyncCall[T](SqlDataReaderBaseAsyncCallContext`1 context)
--- End of stack trace from previous location ---
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeResultSetAsync(Int32 startCommandIndex, RelationalDataReader reader, CancellationToken cancellationToken)
ClientConnectionId:c605579d-71fc-40a8-9bf3-9e2b47014ae1
Error Number:547,State:0,Class:16
   --- End of inner exception stack trace ---
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeResultSetAsync(Int32 startCommandIndex, RelationalDataReader reader, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeAsync(RelationalDataReader reader, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Update.Internal.SqlServerModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(IList`1 entriesToSave, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(StateManager stateManager, Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Storage.Internal.SqlServerExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at NayifatAPI.Services.AuditLogService.LogAsync(String nationalId, String action, Object details) in C:\Users\yamta\StudioProjects\nayifat_app_2025_new\NayifatAPI\Services\AuditLogService.cs:line 36
2025-02-06 13:53:43.482 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@__Parse_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [n].[Id], [n].[additional_data], [n].[big_picture_url], [n].[Body], [n].[body_ar], [n].[body_en], [n].[created_at], [n].[expiry_at], [n].[large_icon_url], [n].[Route], [n].[target_criteria], [n].[Title], [n].[title_ar], [n].[title_en]
FROM [notification_templates] AS [n]
WHERE [n].[Id] = @__Parse_0
2025-02-06 13:53:43.495 +03:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType11`2[[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Object, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-02-06 13:53:43.497 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@__Parse_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [n].[Id], [n].[additional_data], [n].[big_picture_url], [n].[Body], [n].[body_ar], [n].[body_en], [n].[created_at], [n].[expiry_at], [n].[large_icon_url], [n].[Route], [n].[target_criteria], [n].[Title], [n].[title_ar], [n].[title_en]
FROM [notification_templates] AS [n]
WHERE [n].[Id] = @__Parse_0
2025-02-06 13:53:43.498 +03:00 [INF] Executed action NayifatAPI.Controllers.NotificationsController.GetNotifications (NayifatAPI) in 152.4864ms
2025-02-06 13:53:43.510 +03:00 [INF] Executed DbCommand (5ms) [Parameters=[@p0='?' (Size = 4000), @p1='?' (DbType = DateTime2), @p2='?' (Size = 4000), @p3='?' (Size = 4000), @p4='?' (Size = 4000), @p5='?' (Size = 450), @p6='?' (Size = 4000), @p7='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SET IMPLICIT_TRANSACTIONS OFF;
SET NOCOUNT ON;
INSERT INTO [AuthLogs] ([AuthType], [CreatedAt], [DeviceId], [FailureReason], [IpAddress], [NationalId], [Status], [UserAgent])
OUTPUT INSERTED.[Id]
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7);
2025-02-06 13:53:43.511 +03:00 [INF] Executed endpoint 'NayifatAPI.Controllers.NotificationsController.GetNotifications (NayifatAPI)'
2025-02-06 13:53:43.515 +03:00 [INF] Request finished HTTP/1.1 POST http://eb3c-46-152-255-232.ngrok-free.app/api/notifications/list - 200 null application/json; charset=utf-8 174.7137ms
2025-02-06 13:53:43.515 +03:00 [ERR] An exception occurred in the database while saving changes for context type 'NayifatAPI.Data.ApplicationDbContext'.
Microsoft.EntityFrameworkCore.DbUpdateException: An error occurred while saving the entity changes. See the inner exception for details.
 ---> Microsoft.Data.SqlClient.SqlException (0x80131904): The INSERT statement conflicted with the FOREIGN KEY constraint "FK_AuthLogs_Customers_NationalId". The conflict occurred in database "NayifatApp", table "dbo.Customers", column 'NationalId'.
   at Microsoft.Data.SqlClient.SqlConnection.OnError(SqlException exception, Boolean breakConnection, Action`1 wrapCloseInAction)
   at Microsoft.Data.SqlClient.SqlInternalConnection.OnError(SqlException exception, Boolean breakConnection, Action`1 wrapCloseInAction)
   at Microsoft.Data.SqlClient.TdsParser.ThrowExceptionAndWarning(TdsParserStateObject stateObj, Boolean callerHasConnectionLock, Boolean asyncClose)
   at Microsoft.Data.SqlClient.TdsParser.TryRun(RunBehavior runBehavior, SqlCommand cmdHandler, SqlDataReader dataStream, BulkCopySimpleResultSet bulkCopyHandler, TdsParserStateObject stateObj, Boolean& dataReady)
   at Microsoft.Data.SqlClient.SqlDataReader.TryHasMoreRows(Boolean& moreRows)
   at Microsoft.Data.SqlClient.SqlDataReader.TryReadInternal(Boolean setTimeout, Boolean& more)
   at Microsoft.Data.SqlClient.SqlDataReader.ReadAsyncExecute(Task task, Object state)
   at Microsoft.Data.SqlClient.SqlDataReader.InvokeAsyncCall[T](SqlDataReaderBaseAsyncCallContext`1 context)
--- End of stack trace from previous location ---
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeResultSetAsync(Int32 startCommandIndex, RelationalDataReader reader, CancellationToken cancellationToken)
ClientConnectionId:db906d76-c4a9-470f-bb19-3b8b5c989052
Error Number:547,State:0,Class:16
   --- End of inner exception stack trace ---
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeResultSetAsync(Int32 startCommandIndex, RelationalDataReader reader, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeAsync(RelationalDataReader reader, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Update.Internal.SqlServerModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(IList`1 entriesToSave, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(StateManager stateManager, Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Storage.Internal.SqlServerExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
Microsoft.EntityFrameworkCore.DbUpdateException: An error occurred while saving the entity changes. See the inner exception for details.
 ---> Microsoft.Data.SqlClient.SqlException (0x80131904): The INSERT statement conflicted with the FOREIGN KEY constraint "FK_AuthLogs_Customers_NationalId". The conflict occurred in database "NayifatApp", table "dbo.Customers", column 'NationalId'.
   at Microsoft.Data.SqlClient.SqlConnection.OnError(SqlException exception, Boolean breakConnection, Action`1 wrapCloseInAction)
   at Microsoft.Data.SqlClient.SqlInternalConnection.OnError(SqlException exception, Boolean breakConnection, Action`1 wrapCloseInAction)
   at Microsoft.Data.SqlClient.TdsParser.ThrowExceptionAndWarning(TdsParserStateObject stateObj, Boolean callerHasConnectionLock, Boolean asyncClose)
   at Microsoft.Data.SqlClient.TdsParser.TryRun(RunBehavior runBehavior, SqlCommand cmdHandler, SqlDataReader dataStream, BulkCopySimpleResultSet bulkCopyHandler, TdsParserStateObject stateObj, Boolean& dataReady)
   at Microsoft.Data.SqlClient.SqlDataReader.TryHasMoreRows(Boolean& moreRows)
   at Microsoft.Data.SqlClient.SqlDataReader.TryReadInternal(Boolean setTimeout, Boolean& more)
   at Microsoft.Data.SqlClient.SqlDataReader.ReadAsyncExecute(Task task, Object state)
   at Microsoft.Data.SqlClient.SqlDataReader.InvokeAsyncCall[T](SqlDataReaderBaseAsyncCallContext`1 context)
--- End of stack trace from previous location ---
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeResultSetAsync(Int32 startCommandIndex, RelationalDataReader reader, CancellationToken cancellationToken)
ClientConnectionId:db906d76-c4a9-470f-bb19-3b8b5c989052
Error Number:547,State:0,Class:16
   --- End of inner exception stack trace ---
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeResultSetAsync(Int32 startCommandIndex, RelationalDataReader reader, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeAsync(RelationalDataReader reader, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Update.Internal.SqlServerModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(IList`1 entriesToSave, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(StateManager stateManager, Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Storage.Internal.SqlServerExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
2025-02-06 13:53:43.535 +03:00 [ERR] Error logging audit event. NationalId: all, Action: notification_delivered, Details: {"notification_count":21,"notification_ids":[38,37,36,35,34,33,32,31,30,29,28,27,26,25,24,23,23,20,19,18,12],"timestamp":"2025-02-06T13:53:43.3983925"}
Microsoft.EntityFrameworkCore.DbUpdateException: An error occurred while saving the entity changes. See the inner exception for details.
 ---> Microsoft.Data.SqlClient.SqlException (0x80131904): The INSERT statement conflicted with the FOREIGN KEY constraint "FK_AuthLogs_Customers_NationalId". The conflict occurred in database "NayifatApp", table "dbo.Customers", column 'NationalId'.
   at Microsoft.Data.SqlClient.SqlConnection.OnError(SqlException exception, Boolean breakConnection, Action`1 wrapCloseInAction)
   at Microsoft.Data.SqlClient.SqlInternalConnection.OnError(SqlException exception, Boolean breakConnection, Action`1 wrapCloseInAction)
   at Microsoft.Data.SqlClient.TdsParser.ThrowExceptionAndWarning(TdsParserStateObject stateObj, Boolean callerHasConnectionLock, Boolean asyncClose)
   at Microsoft.Data.SqlClient.TdsParser.TryRun(RunBehavior runBehavior, SqlCommand cmdHandler, SqlDataReader dataStream, BulkCopySimpleResultSet bulkCopyHandler, TdsParserStateObject stateObj, Boolean& dataReady)
   at Microsoft.Data.SqlClient.SqlDataReader.TryHasMoreRows(Boolean& moreRows)
   at Microsoft.Data.SqlClient.SqlDataReader.TryReadInternal(Boolean setTimeout, Boolean& more)
   at Microsoft.Data.SqlClient.SqlDataReader.ReadAsyncExecute(Task task, Object state)
   at Microsoft.Data.SqlClient.SqlDataReader.InvokeAsyncCall[T](SqlDataReaderBaseAsyncCallContext`1 context)
--- End of stack trace from previous location ---
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeResultSetAsync(Int32 startCommandIndex, RelationalDataReader reader, CancellationToken cancellationToken)
ClientConnectionId:db906d76-c4a9-470f-bb19-3b8b5c989052
Error Number:547,State:0,Class:16
   --- End of inner exception stack trace ---
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeResultSetAsync(Int32 startCommandIndex, RelationalDataReader reader, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeAsync(RelationalDataReader reader, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Update.Internal.SqlServerModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(IList`1 entriesToSave, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(StateManager stateManager, Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Storage.Internal.SqlServerExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at NayifatAPI.Services.AuditLogService.LogAsync(String nationalId, String action, Object details) in C:\Users\yamta\StudioProjects\nayifat_app_2025_new\NayifatAPI\Services\AuditLogService.cs:line 36
2025-02-06 13:53:43.551 +03:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType11`2[[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Object, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-02-06 13:53:43.554 +03:00 [INF] Executed action NayifatAPI.Controllers.NotificationsController.GetNotifications (NayifatAPI) in 170.2313ms
2025-02-06 13:53:43.557 +03:00 [INF] Executed endpoint 'NayifatAPI.Controllers.NotificationsController.GetNotifications (NayifatAPI)'
2025-02-06 13:53:43.559 +03:00 [INF] Request finished HTTP/1.1 POST http://eb3c-46-152-255-232.ngrok-free.app/api/notifications/list - 200 null application/json; charset=utf-8 183.3028ms
2025-02-06 13:53:43.694 +03:00 [INF] Request starting HTTP/1.1 POST http://eb3c-46-152-255-232.ngrok-free.app/api/notifications/list - application/json 45
2025-02-06 13:53:43.696 +03:00 [INF] Executing endpoint 'NayifatAPI.Controllers.NotificationsController.GetNotifications (NayifatAPI)'
2025-02-06 13:53:43.697 +03:00 [INF] Route matched with {action = "GetNotifications", controller = "Notifications"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetNotifications(NayifatAPI.Controllers.GetNotificationsRequest) on controller NayifatAPI.Controllers.NotificationsController (NayifatAPI).
2025-02-06 13:53:43.699 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@__providedApiKey_0='?' (Size = 255)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [a].[api_Key], [a].[CreatedAt], [a].[Description], [a].[ExpiresAt], [a].[IsActive], [a].[LastUsedAt]
FROM [ApiKeys] AS [a]
WHERE [a].[api_Key] = @__providedApiKey_0 AND [a].[IsActive] = CAST(1 AS bit)
2025-02-06 13:53:43.703 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@__request_NationalId_0='?' (Size = 450)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [u].[national_id], [u].[last_updated], [u].[notifications]
FROM [user_notifications] AS [u]
WHERE [u].[national_id] = @__request_NationalId_0
2025-02-06 13:53:43.705 +03:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType11`2[[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Object, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-02-06 13:53:43.707 +03:00 [INF] Executed action NayifatAPI.Controllers.NotificationsController.GetNotifications (NayifatAPI) in 8.8743ms
2025-02-06 13:53:43.708 +03:00 [INF] Executed endpoint 'NayifatAPI.Controllers.NotificationsController.GetNotifications (NayifatAPI)'
2025-02-06 13:53:43.709 +03:00 [INF] Request finished HTTP/1.1 POST http://eb3c-46-152-255-232.ngrok-free.app/api/notifications/list - 200 null application/json; charset=utf-8 14.9037ms
2025-02-06 13:53:43.763 +03:00 [INF] Request starting HTTP/1.1 POST http://eb3c-46-152-255-232.ngrok-free.app/api/notifications/list - application/json 45
2025-02-06 13:53:43.766 +03:00 [INF] Executing endpoint 'NayifatAPI.Controllers.NotificationsController.GetNotifications (NayifatAPI)'
2025-02-06 13:53:43.767 +03:00 [INF] Route matched with {action = "GetNotifications", controller = "Notifications"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetNotifications(NayifatAPI.Controllers.GetNotificationsRequest) on controller NayifatAPI.Controllers.NotificationsController (NayifatAPI).
2025-02-06 13:53:43.778 +03:00 [INF] Executed DbCommand (3ms) [Parameters=[@__providedApiKey_0='?' (Size = 255)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [a].[api_Key], [a].[CreatedAt], [a].[Description], [a].[ExpiresAt], [a].[IsActive], [a].[LastUsedAt]
FROM [ApiKeys] AS [a]
WHERE [a].[api_Key] = @__providedApiKey_0 AND [a].[IsActive] = CAST(1 AS bit)
2025-02-06 13:53:43.783 +03:00 [INF] Executed DbCommand (3ms) [Parameters=[@__request_NationalId_0='?' (Size = 450)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [u].[national_id], [u].[last_updated], [u].[notifications]
FROM [user_notifications] AS [u]
WHERE [u].[national_id] = @__request_NationalId_0
2025-02-06 13:53:43.788 +03:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType11`2[[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Object, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-02-06 13:53:43.790 +03:00 [INF] Executed action NayifatAPI.Controllers.NotificationsController.GetNotifications (NayifatAPI) in 19.8182ms
2025-02-06 13:53:43.792 +03:00 [INF] Executed endpoint 'NayifatAPI.Controllers.NotificationsController.GetNotifications (NayifatAPI)'
2025-02-06 13:53:43.793 +03:00 [INF] Request finished HTTP/1.1 POST http://eb3c-46-152-255-232.ngrok-free.app/api/notifications/list - 200 null application/json; charset=utf-8 30.0621ms
2025-02-06 13:57:39.597 +03:00 [INF] Request starting HTTP/1.1 POST http://eb3c-46-152-255-232.ngrok-free.app/api/notifications/list - application/json; charset=utf-8 45
2025-02-06 13:57:39.613 +03:00 [INF] Executing endpoint 'NayifatAPI.Controllers.NotificationsController.GetNotifications (NayifatAPI)'
2025-02-06 13:57:39.618 +03:00 [INF] Route matched with {action = "GetNotifications", controller = "Notifications"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetNotifications(NayifatAPI.Controllers.GetNotificationsRequest) on controller NayifatAPI.Controllers.NotificationsController (NayifatAPI).
2025-02-06 13:57:39.673 +03:00 [INF] Executed DbCommand (11ms) [Parameters=[@__providedApiKey_0='?' (Size = 255)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [a].[api_Key], [a].[CreatedAt], [a].[Description], [a].[ExpiresAt], [a].[IsActive], [a].[LastUsedAt]
FROM [ApiKeys] AS [a]
WHERE [a].[api_Key] = @__providedApiKey_0 AND [a].[IsActive] = CAST(1 AS bit)
2025-02-06 13:57:39.681 +03:00 [INF] Executed DbCommand (5ms) [Parameters=[@__request_NationalId_0='?' (Size = 450)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [u].[national_id], [u].[last_updated], [u].[notifications]
FROM [user_notifications] AS [u]
WHERE [u].[national_id] = @__request_NationalId_0
2025-02-06 13:57:39.685 +03:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType11`2[[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Object, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-02-06 13:57:39.688 +03:00 [INF] Executed action NayifatAPI.Controllers.NotificationsController.GetNotifications (NayifatAPI) in 55.9864ms
2025-02-06 13:57:39.691 +03:00 [INF] Executed endpoint 'NayifatAPI.Controllers.NotificationsController.GetNotifications (NayifatAPI)'
2025-02-06 13:57:39.693 +03:00 [INF] Request finished HTTP/1.1 POST http://eb3c-46-152-255-232.ngrok-free.app/api/notifications/list - 200 null application/json; charset=utf-8 95.3527ms
2025-02-06 13:57:40.122 +03:00 [INF] Request starting HTTP/1.1 POST http://eb3c-46-152-255-232.ngrok-free.app/api/notifications/list - application/json; charset=utf-8 39
2025-02-06 13:57:40.125 +03:00 [INF] Executing endpoint 'NayifatAPI.Controllers.NotificationsController.GetNotifications (NayifatAPI)'
2025-02-06 13:57:40.127 +03:00 [INF] Route matched with {action = "GetNotifications", controller = "Notifications"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetNotifications(NayifatAPI.Controllers.GetNotificationsRequest) on controller NayifatAPI.Controllers.NotificationsController (NayifatAPI).
2025-02-06 13:57:40.136 +03:00 [INF] Executed DbCommand (5ms) [Parameters=[@__providedApiKey_0='?' (Size = 255)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [a].[api_Key], [a].[CreatedAt], [a].[Description], [a].[ExpiresAt], [a].[IsActive], [a].[LastUsedAt]
FROM [ApiKeys] AS [a]
WHERE [a].[api_Key] = @__providedApiKey_0 AND [a].[IsActive] = CAST(1 AS bit)
2025-02-06 13:57:40.142 +03:00 [INF] Executed DbCommand (2ms) [Parameters=[@__request_NationalId_0='?' (Size = 450)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [u].[national_id], [u].[last_updated], [u].[notifications]
FROM [user_notifications] AS [u]
WHERE [u].[national_id] = @__request_NationalId_0
2025-02-06 13:57:40.152 +03:00 [INF] Executed DbCommand (7ms) [Parameters=[@__Parse_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [n].[Id], [n].[additional_data], [n].[big_picture_url], [n].[Body], [n].[body_ar], [n].[body_en], [n].[created_at], [n].[expiry_at], [n].[large_icon_url], [n].[Route], [n].[target_criteria], [n].[Title], [n].[title_ar], [n].[title_en]
FROM [notification_templates] AS [n]
WHERE [n].[Id] = @__Parse_0
2025-02-06 13:57:40.158 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@__Parse_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [n].[Id], [n].[additional_data], [n].[big_picture_url], [n].[Body], [n].[body_ar], [n].[body_en], [n].[created_at], [n].[expiry_at], [n].[large_icon_url], [n].[Route], [n].[target_criteria], [n].[Title], [n].[title_ar], [n].[title_en]
FROM [notification_templates] AS [n]
WHERE [n].[Id] = @__Parse_0
2025-02-06 13:57:40.165 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@__Parse_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [n].[Id], [n].[additional_data], [n].[big_picture_url], [n].[Body], [n].[body_ar], [n].[body_en], [n].[created_at], [n].[expiry_at], [n].[large_icon_url], [n].[Route], [n].[target_criteria], [n].[Title], [n].[title_ar], [n].[title_en]
FROM [notification_templates] AS [n]
WHERE [n].[Id] = @__Parse_0
2025-02-06 13:57:40.171 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@__Parse_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [n].[Id], [n].[additional_data], [n].[big_picture_url], [n].[Body], [n].[body_ar], [n].[body_en], [n].[created_at], [n].[expiry_at], [n].[large_icon_url], [n].[Route], [n].[target_criteria], [n].[Title], [n].[title_ar], [n].[title_en]
FROM [notification_templates] AS [n]
WHERE [n].[Id] = @__Parse_0
2025-02-06 13:57:40.176 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@__Parse_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [n].[Id], [n].[additional_data], [n].[big_picture_url], [n].[Body], [n].[body_ar], [n].[body_en], [n].[created_at], [n].[expiry_at], [n].[large_icon_url], [n].[Route], [n].[target_criteria], [n].[Title], [n].[title_ar], [n].[title_en]
FROM [notification_templates] AS [n]
WHERE [n].[Id] = @__Parse_0
2025-02-06 13:57:40.185 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@__Parse_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [n].[Id], [n].[additional_data], [n].[big_picture_url], [n].[Body], [n].[body_ar], [n].[body_en], [n].[created_at], [n].[expiry_at], [n].[large_icon_url], [n].[Route], [n].[target_criteria], [n].[Title], [n].[title_ar], [n].[title_en]
FROM [notification_templates] AS [n]
WHERE [n].[Id] = @__Parse_0
2025-02-06 13:57:40.190 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@__Parse_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [n].[Id], [n].[additional_data], [n].[big_picture_url], [n].[Body], [n].[body_ar], [n].[body_en], [n].[created_at], [n].[expiry_at], [n].[large_icon_url], [n].[Route], [n].[target_criteria], [n].[Title], [n].[title_ar], [n].[title_en]
FROM [notification_templates] AS [n]
WHERE [n].[Id] = @__Parse_0
2025-02-06 13:57:40.196 +03:00 [INF] Executed DbCommand (2ms) [Parameters=[@__Parse_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [n].[Id], [n].[additional_data], [n].[big_picture_url], [n].[Body], [n].[body_ar], [n].[body_en], [n].[created_at], [n].[expiry_at], [n].[large_icon_url], [n].[Route], [n].[target_criteria], [n].[Title], [n].[title_ar], [n].[title_en]
FROM [notification_templates] AS [n]
WHERE [n].[Id] = @__Parse_0
2025-02-06 13:57:40.203 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@__Parse_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [n].[Id], [n].[additional_data], [n].[big_picture_url], [n].[Body], [n].[body_ar], [n].[body_en], [n].[created_at], [n].[expiry_at], [n].[large_icon_url], [n].[Route], [n].[target_criteria], [n].[Title], [n].[title_ar], [n].[title_en]
FROM [notification_templates] AS [n]
WHERE [n].[Id] = @__Parse_0
2025-02-06 13:57:40.210 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@__Parse_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [n].[Id], [n].[additional_data], [n].[big_picture_url], [n].[Body], [n].[body_ar], [n].[body_en], [n].[created_at], [n].[expiry_at], [n].[large_icon_url], [n].[Route], [n].[target_criteria], [n].[Title], [n].[title_ar], [n].[title_en]
FROM [notification_templates] AS [n]
WHERE [n].[Id] = @__Parse_0
2025-02-06 13:57:40.220 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@__Parse_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [n].[Id], [n].[additional_data], [n].[big_picture_url], [n].[Body], [n].[body_ar], [n].[body_en], [n].[created_at], [n].[expiry_at], [n].[large_icon_url], [n].[Route], [n].[target_criteria], [n].[Title], [n].[title_ar], [n].[title_en]
FROM [notification_templates] AS [n]
WHERE [n].[Id] = @__Parse_0
2025-02-06 13:57:40.226 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@__Parse_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [n].[Id], [n].[additional_data], [n].[big_picture_url], [n].[Body], [n].[body_ar], [n].[body_en], [n].[created_at], [n].[expiry_at], [n].[large_icon_url], [n].[Route], [n].[target_criteria], [n].[Title], [n].[title_ar], [n].[title_en]
FROM [notification_templates] AS [n]
WHERE [n].[Id] = @__Parse_0
2025-02-06 13:57:40.232 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@__Parse_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [n].[Id], [n].[additional_data], [n].[big_picture_url], [n].[Body], [n].[body_ar], [n].[body_en], [n].[created_at], [n].[expiry_at], [n].[large_icon_url], [n].[Route], [n].[target_criteria], [n].[Title], [n].[title_ar], [n].[title_en]
FROM [notification_templates] AS [n]
WHERE [n].[Id] = @__Parse_0
2025-02-06 13:57:40.236 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@__Parse_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [n].[Id], [n].[additional_data], [n].[big_picture_url], [n].[Body], [n].[body_ar], [n].[body_en], [n].[created_at], [n].[expiry_at], [n].[large_icon_url], [n].[Route], [n].[target_criteria], [n].[Title], [n].[title_ar], [n].[title_en]
FROM [notification_templates] AS [n]
WHERE [n].[Id] = @__Parse_0
2025-02-06 13:57:40.241 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@__Parse_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [n].[Id], [n].[additional_data], [n].[big_picture_url], [n].[Body], [n].[body_ar], [n].[body_en], [n].[created_at], [n].[expiry_at], [n].[large_icon_url], [n].[Route], [n].[target_criteria], [n].[Title], [n].[title_ar], [n].[title_en]
FROM [notification_templates] AS [n]
WHERE [n].[Id] = @__Parse_0
2025-02-06 13:57:40.247 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@__Parse_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [n].[Id], [n].[additional_data], [n].[big_picture_url], [n].[Body], [n].[body_ar], [n].[body_en], [n].[created_at], [n].[expiry_at], [n].[large_icon_url], [n].[Route], [n].[target_criteria], [n].[Title], [n].[title_ar], [n].[title_en]
FROM [notification_templates] AS [n]
WHERE [n].[Id] = @__Parse_0
2025-02-06 13:57:40.252 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@__Parse_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [n].[Id], [n].[additional_data], [n].[big_picture_url], [n].[Body], [n].[body_ar], [n].[body_en], [n].[created_at], [n].[expiry_at], [n].[large_icon_url], [n].[Route], [n].[target_criteria], [n].[Title], [n].[title_ar], [n].[title_en]
FROM [notification_templates] AS [n]
WHERE [n].[Id] = @__Parse_0
2025-02-06 13:57:40.258 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@__Parse_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [n].[Id], [n].[additional_data], [n].[big_picture_url], [n].[Body], [n].[body_ar], [n].[body_en], [n].[created_at], [n].[expiry_at], [n].[large_icon_url], [n].[Route], [n].[target_criteria], [n].[Title], [n].[title_ar], [n].[title_en]
FROM [notification_templates] AS [n]
WHERE [n].[Id] = @__Parse_0
2025-02-06 13:57:40.263 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@__Parse_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [n].[Id], [n].[additional_data], [n].[big_picture_url], [n].[Body], [n].[body_ar], [n].[body_en], [n].[created_at], [n].[expiry_at], [n].[large_icon_url], [n].[Route], [n].[target_criteria], [n].[Title], [n].[title_ar], [n].[title_en]
FROM [notification_templates] AS [n]
WHERE [n].[Id] = @__Parse_0
2025-02-06 13:57:40.267 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@__Parse_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [n].[Id], [n].[additional_data], [n].[big_picture_url], [n].[Body], [n].[body_ar], [n].[body_en], [n].[created_at], [n].[expiry_at], [n].[large_icon_url], [n].[Route], [n].[target_criteria], [n].[Title], [n].[title_ar], [n].[title_en]
FROM [notification_templates] AS [n]
WHERE [n].[Id] = @__Parse_0
2025-02-06 13:57:40.273 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@__Parse_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [n].[Id], [n].[additional_data], [n].[big_picture_url], [n].[Body], [n].[body_ar], [n].[body_en], [n].[created_at], [n].[expiry_at], [n].[large_icon_url], [n].[Route], [n].[target_criteria], [n].[Title], [n].[title_ar], [n].[title_en]
FROM [notification_templates] AS [n]
WHERE [n].[Id] = @__Parse_0
2025-02-06 13:57:40.291 +03:00 [INF] Executed DbCommand (13ms) [Parameters=[@p0='?' (Size = 4000), @p1='?' (DbType = DateTime2), @p2='?' (Size = 4000), @p3='?' (Size = 4000), @p4='?' (Size = 4000), @p5='?' (Size = 450), @p6='?' (Size = 4000), @p7='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SET IMPLICIT_TRANSACTIONS OFF;
SET NOCOUNT ON;
INSERT INTO [AuthLogs] ([AuthType], [CreatedAt], [DeviceId], [FailureReason], [IpAddress], [NationalId], [Status], [UserAgent])
OUTPUT INSERTED.[Id]
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7);
2025-02-06 13:57:40.297 +03:00 [ERR] An exception occurred in the database while saving changes for context type 'NayifatAPI.Data.ApplicationDbContext'.
Microsoft.EntityFrameworkCore.DbUpdateException: An error occurred while saving the entity changes. See the inner exception for details.
 ---> Microsoft.Data.SqlClient.SqlException (0x80131904): The INSERT statement conflicted with the FOREIGN KEY constraint "FK_AuthLogs_Customers_NationalId". The conflict occurred in database "NayifatApp", table "dbo.Customers", column 'NationalId'.
   at Microsoft.Data.SqlClient.SqlConnection.OnError(SqlException exception, Boolean breakConnection, Action`1 wrapCloseInAction)
   at Microsoft.Data.SqlClient.SqlInternalConnection.OnError(SqlException exception, Boolean breakConnection, Action`1 wrapCloseInAction)
   at Microsoft.Data.SqlClient.TdsParser.ThrowExceptionAndWarning(TdsParserStateObject stateObj, Boolean callerHasConnectionLock, Boolean asyncClose)
   at Microsoft.Data.SqlClient.TdsParser.TryRun(RunBehavior runBehavior, SqlCommand cmdHandler, SqlDataReader dataStream, BulkCopySimpleResultSet bulkCopyHandler, TdsParserStateObject stateObj, Boolean& dataReady)
   at Microsoft.Data.SqlClient.SqlDataReader.TryHasMoreRows(Boolean& moreRows)
   at Microsoft.Data.SqlClient.SqlDataReader.TryReadInternal(Boolean setTimeout, Boolean& more)
   at Microsoft.Data.SqlClient.SqlDataReader.ReadAsyncExecute(Task task, Object state)
   at Microsoft.Data.SqlClient.SqlDataReader.InvokeAsyncCall[T](SqlDataReaderBaseAsyncCallContext`1 context)
--- End of stack trace from previous location ---
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeResultSetAsync(Int32 startCommandIndex, RelationalDataReader reader, CancellationToken cancellationToken)
ClientConnectionId:2c533c28-7377-495e-b51f-6adbafed467b
Error Number:547,State:0,Class:16
   --- End of inner exception stack trace ---
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeResultSetAsync(Int32 startCommandIndex, RelationalDataReader reader, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeAsync(RelationalDataReader reader, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Update.Internal.SqlServerModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(IList`1 entriesToSave, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(StateManager stateManager, Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Storage.Internal.SqlServerExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
Microsoft.EntityFrameworkCore.DbUpdateException: An error occurred while saving the entity changes. See the inner exception for details.
 ---> Microsoft.Data.SqlClient.SqlException (0x80131904): The INSERT statement conflicted with the FOREIGN KEY constraint "FK_AuthLogs_Customers_NationalId". The conflict occurred in database "NayifatApp", table "dbo.Customers", column 'NationalId'.
   at Microsoft.Data.SqlClient.SqlConnection.OnError(SqlException exception, Boolean breakConnection, Action`1 wrapCloseInAction)
   at Microsoft.Data.SqlClient.SqlInternalConnection.OnError(SqlException exception, Boolean breakConnection, Action`1 wrapCloseInAction)
   at Microsoft.Data.SqlClient.TdsParser.ThrowExceptionAndWarning(TdsParserStateObject stateObj, Boolean callerHasConnectionLock, Boolean asyncClose)
   at Microsoft.Data.SqlClient.TdsParser.TryRun(RunBehavior runBehavior, SqlCommand cmdHandler, SqlDataReader dataStream, BulkCopySimpleResultSet bulkCopyHandler, TdsParserStateObject stateObj, Boolean& dataReady)
   at Microsoft.Data.SqlClient.SqlDataReader.TryHasMoreRows(Boolean& moreRows)
   at Microsoft.Data.SqlClient.SqlDataReader.TryReadInternal(Boolean setTimeout, Boolean& more)
   at Microsoft.Data.SqlClient.SqlDataReader.ReadAsyncExecute(Task task, Object state)
   at Microsoft.Data.SqlClient.SqlDataReader.InvokeAsyncCall[T](SqlDataReaderBaseAsyncCallContext`1 context)
--- End of stack trace from previous location ---
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeResultSetAsync(Int32 startCommandIndex, RelationalDataReader reader, CancellationToken cancellationToken)
ClientConnectionId:2c533c28-7377-495e-b51f-6adbafed467b
Error Number:547,State:0,Class:16
   --- End of inner exception stack trace ---
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeResultSetAsync(Int32 startCommandIndex, RelationalDataReader reader, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeAsync(RelationalDataReader reader, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Update.Internal.SqlServerModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(IList`1 entriesToSave, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(StateManager stateManager, Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Storage.Internal.SqlServerExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
2025-02-06 13:57:40.323 +03:00 [ERR] Error logging audit event. NationalId: all, Action: notification_delivered, Details: {"notification_count":21,"notification_ids":[38,37,36,35,34,33,32,31,30,29,28,27,26,25,24,23,23,20,19,18,12],"timestamp":"2025-02-06T13:57:40.1455014"}
Microsoft.EntityFrameworkCore.DbUpdateException: An error occurred while saving the entity changes. See the inner exception for details.
 ---> Microsoft.Data.SqlClient.SqlException (0x80131904): The INSERT statement conflicted with the FOREIGN KEY constraint "FK_AuthLogs_Customers_NationalId". The conflict occurred in database "NayifatApp", table "dbo.Customers", column 'NationalId'.
   at Microsoft.Data.SqlClient.SqlConnection.OnError(SqlException exception, Boolean breakConnection, Action`1 wrapCloseInAction)
   at Microsoft.Data.SqlClient.SqlInternalConnection.OnError(SqlException exception, Boolean breakConnection, Action`1 wrapCloseInAction)
   at Microsoft.Data.SqlClient.TdsParser.ThrowExceptionAndWarning(TdsParserStateObject stateObj, Boolean callerHasConnectionLock, Boolean asyncClose)
   at Microsoft.Data.SqlClient.TdsParser.TryRun(RunBehavior runBehavior, SqlCommand cmdHandler, SqlDataReader dataStream, BulkCopySimpleResultSet bulkCopyHandler, TdsParserStateObject stateObj, Boolean& dataReady)
   at Microsoft.Data.SqlClient.SqlDataReader.TryHasMoreRows(Boolean& moreRows)
   at Microsoft.Data.SqlClient.SqlDataReader.TryReadInternal(Boolean setTimeout, Boolean& more)
   at Microsoft.Data.SqlClient.SqlDataReader.ReadAsyncExecute(Task task, Object state)
   at Microsoft.Data.SqlClient.SqlDataReader.InvokeAsyncCall[T](SqlDataReaderBaseAsyncCallContext`1 context)
--- End of stack trace from previous location ---
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeResultSetAsync(Int32 startCommandIndex, RelationalDataReader reader, CancellationToken cancellationToken)
ClientConnectionId:2c533c28-7377-495e-b51f-6adbafed467b
Error Number:547,State:0,Class:16
   --- End of inner exception stack trace ---
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeResultSetAsync(Int32 startCommandIndex, RelationalDataReader reader, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeAsync(RelationalDataReader reader, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Update.Internal.SqlServerModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(IList`1 entriesToSave, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(StateManager stateManager, Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Storage.Internal.SqlServerExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at NayifatAPI.Services.AuditLogService.LogAsync(String nationalId, String action, Object details) in C:\Users\yamta\StudioProjects\nayifat_app_2025_new\NayifatAPI\Services\AuditLogService.cs:line 36
2025-02-06 13:57:40.409 +03:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType11`2[[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Object, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-02-06 13:57:40.414 +03:00 [INF] Executed action NayifatAPI.Controllers.NotificationsController.GetNotifications (NayifatAPI) in 285.4228ms
2025-02-06 13:57:40.480 +03:00 [INF] Executed endpoint 'NayifatAPI.Controllers.NotificationsController.GetNotifications (NayifatAPI)'
2025-02-06 13:57:40.497 +03:00 [INF] Request finished HTTP/1.1 POST http://eb3c-46-152-255-232.ngrok-free.app/api/notifications/list - 200 null application/json; charset=utf-8 374.4241ms
2025-02-06 13:58:21.964 +03:00 [INF] Request starting HTTP/1.1 POST http://eb3c-46-152-255-232.ngrok-free.app/api/notifications/list - application/json; charset=utf-8 45
2025-02-06 13:58:22.221 +03:00 [INF] Executing endpoint 'NayifatAPI.Controllers.NotificationsController.GetNotifications (NayifatAPI)'
2025-02-06 13:58:22.255 +03:00 [INF] Route matched with {action = "GetNotifications", controller = "Notifications"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetNotifications(NayifatAPI.Controllers.GetNotificationsRequest) on controller NayifatAPI.Controllers.NotificationsController (NayifatAPI).
2025-02-06 13:58:22.291 +03:00 [INF] Executed DbCommand (29ms) [Parameters=[@__providedApiKey_0='?' (Size = 255)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [a].[api_Key], [a].[CreatedAt], [a].[Description], [a].[ExpiresAt], [a].[IsActive], [a].[LastUsedAt]
FROM [ApiKeys] AS [a]
WHERE [a].[api_Key] = @__providedApiKey_0 AND [a].[IsActive] = CAST(1 AS bit)
2025-02-06 13:58:22.309 +03:00 [INF] Executed DbCommand (15ms) [Parameters=[@__request_NationalId_0='?' (Size = 450)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [u].[national_id], [u].[last_updated], [u].[notifications]
FROM [user_notifications] AS [u]
WHERE [u].[national_id] = @__request_NationalId_0
2025-02-06 13:58:22.328 +03:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType11`2[[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Object, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-02-06 13:58:22.330 +03:00 [INF] Executed action NayifatAPI.Controllers.NotificationsController.GetNotifications (NayifatAPI) in 71.0393ms
2025-02-06 13:58:22.332 +03:00 [INF] Executed endpoint 'NayifatAPI.Controllers.NotificationsController.GetNotifications (NayifatAPI)'
2025-02-06 13:58:22.334 +03:00 [INF] Request finished HTTP/1.1 POST http://eb3c-46-152-255-232.ngrok-free.app/api/notifications/list - 200 null application/json; charset=utf-8 370.0956ms
2025-02-06 13:58:22.757 +03:00 [INF] Request starting HTTP/1.1 POST http://eb3c-46-152-255-232.ngrok-free.app/api/notifications/list - application/json; charset=utf-8 39
2025-02-06 13:58:22.961 +03:00 [INF] Executing endpoint 'NayifatAPI.Controllers.NotificationsController.GetNotifications (NayifatAPI)'
2025-02-06 13:58:23.450 +03:00 [INF] Route matched with {action = "GetNotifications", controller = "Notifications"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetNotifications(NayifatAPI.Controllers.GetNotificationsRequest) on controller NayifatAPI.Controllers.NotificationsController (NayifatAPI).
2025-02-06 13:58:23.611 +03:00 [INF] Executed DbCommand (132ms) [Parameters=[@__providedApiKey_0='?' (Size = 255)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [a].[api_Key], [a].[CreatedAt], [a].[Description], [a].[ExpiresAt], [a].[IsActive], [a].[LastUsedAt]
FROM [ApiKeys] AS [a]
WHERE [a].[api_Key] = @__providedApiKey_0 AND [a].[IsActive] = CAST(1 AS bit)
2025-02-06 13:58:23.916 +03:00 [INF] Executed DbCommand (103ms) [Parameters=[@__request_NationalId_0='?' (Size = 450)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [u].[national_id], [u].[last_updated], [u].[notifications]
FROM [user_notifications] AS [u]
WHERE [u].[national_id] = @__request_NationalId_0
2025-02-06 13:58:24.103 +03:00 [INF] Executed DbCommand (22ms) [Parameters=[@__Parse_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [n].[Id], [n].[additional_data], [n].[big_picture_url], [n].[Body], [n].[body_ar], [n].[body_en], [n].[created_at], [n].[expiry_at], [n].[large_icon_url], [n].[Route], [n].[target_criteria], [n].[Title], [n].[title_ar], [n].[title_en]
FROM [notification_templates] AS [n]
WHERE [n].[Id] = @__Parse_0
2025-02-06 13:58:24.247 +03:00 [INF] Executed DbCommand (20ms) [Parameters=[@__Parse_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [n].[Id], [n].[additional_data], [n].[big_picture_url], [n].[Body], [n].[body_ar], [n].[body_en], [n].[created_at], [n].[expiry_at], [n].[large_icon_url], [n].[Route], [n].[target_criteria], [n].[Title], [n].[title_ar], [n].[title_en]
FROM [notification_templates] AS [n]
WHERE [n].[Id] = @__Parse_0
2025-02-06 13:58:24.264 +03:00 [INF] Executed DbCommand (13ms) [Parameters=[@__Parse_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [n].[Id], [n].[additional_data], [n].[big_picture_url], [n].[Body], [n].[body_ar], [n].[body_en], [n].[created_at], [n].[expiry_at], [n].[large_icon_url], [n].[Route], [n].[target_criteria], [n].[Title], [n].[title_ar], [n].[title_en]
FROM [notification_templates] AS [n]
WHERE [n].[Id] = @__Parse_0
2025-02-06 13:58:24.479 +03:00 [INF] Executed DbCommand (85ms) [Parameters=[@__Parse_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [n].[Id], [n].[additional_data], [n].[big_picture_url], [n].[Body], [n].[body_ar], [n].[body_en], [n].[created_at], [n].[expiry_at], [n].[large_icon_url], [n].[Route], [n].[target_criteria], [n].[Title], [n].[title_ar], [n].[title_en]
FROM [notification_templates] AS [n]
WHERE [n].[Id] = @__Parse_0
2025-02-06 13:58:24.845 +03:00 [INF] Executed DbCommand (15ms) [Parameters=[@__Parse_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [n].[Id], [n].[additional_data], [n].[big_picture_url], [n].[Body], [n].[body_ar], [n].[body_en], [n].[created_at], [n].[expiry_at], [n].[large_icon_url], [n].[Route], [n].[target_criteria], [n].[Title], [n].[title_ar], [n].[title_en]
FROM [notification_templates] AS [n]
WHERE [n].[Id] = @__Parse_0
2025-02-06 13:58:24.855 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@__Parse_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [n].[Id], [n].[additional_data], [n].[big_picture_url], [n].[Body], [n].[body_ar], [n].[body_en], [n].[created_at], [n].[expiry_at], [n].[large_icon_url], [n].[Route], [n].[target_criteria], [n].[Title], [n].[title_ar], [n].[title_en]
FROM [notification_templates] AS [n]
WHERE [n].[Id] = @__Parse_0
2025-02-06 13:58:24.867 +03:00 [INF] Executed DbCommand (7ms) [Parameters=[@__Parse_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [n].[Id], [n].[additional_data], [n].[big_picture_url], [n].[Body], [n].[body_ar], [n].[body_en], [n].[created_at], [n].[expiry_at], [n].[large_icon_url], [n].[Route], [n].[target_criteria], [n].[Title], [n].[title_ar], [n].[title_en]
FROM [notification_templates] AS [n]
WHERE [n].[Id] = @__Parse_0
2025-02-06 13:58:24.889 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@__Parse_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [n].[Id], [n].[additional_data], [n].[big_picture_url], [n].[Body], [n].[body_ar], [n].[body_en], [n].[created_at], [n].[expiry_at], [n].[large_icon_url], [n].[Route], [n].[target_criteria], [n].[Title], [n].[title_ar], [n].[title_en]
FROM [notification_templates] AS [n]
WHERE [n].[Id] = @__Parse_0
2025-02-06 13:58:24.894 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@__Parse_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [n].[Id], [n].[additional_data], [n].[big_picture_url], [n].[Body], [n].[body_ar], [n].[body_en], [n].[created_at], [n].[expiry_at], [n].[large_icon_url], [n].[Route], [n].[target_criteria], [n].[Title], [n].[title_ar], [n].[title_en]
FROM [notification_templates] AS [n]
WHERE [n].[Id] = @__Parse_0
2025-02-06 13:58:24.907 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@__Parse_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [n].[Id], [n].[additional_data], [n].[big_picture_url], [n].[Body], [n].[body_ar], [n].[body_en], [n].[created_at], [n].[expiry_at], [n].[large_icon_url], [n].[Route], [n].[target_criteria], [n].[Title], [n].[title_ar], [n].[title_en]
FROM [notification_templates] AS [n]
WHERE [n].[Id] = @__Parse_0
2025-02-06 13:58:24.935 +03:00 [INF] Executed DbCommand (9ms) [Parameters=[@__Parse_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [n].[Id], [n].[additional_data], [n].[big_picture_url], [n].[Body], [n].[body_ar], [n].[body_en], [n].[created_at], [n].[expiry_at], [n].[large_icon_url], [n].[Route], [n].[target_criteria], [n].[Title], [n].[title_ar], [n].[title_en]
FROM [notification_templates] AS [n]
WHERE [n].[Id] = @__Parse_0
2025-02-06 13:58:24.949 +03:00 [INF] Executed DbCommand (4ms) [Parameters=[@__Parse_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [n].[Id], [n].[additional_data], [n].[big_picture_url], [n].[Body], [n].[body_ar], [n].[body_en], [n].[created_at], [n].[expiry_at], [n].[large_icon_url], [n].[Route], [n].[target_criteria], [n].[Title], [n].[title_ar], [n].[title_en]
FROM [notification_templates] AS [n]
WHERE [n].[Id] = @__Parse_0
2025-02-06 13:58:24.961 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@__Parse_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [n].[Id], [n].[additional_data], [n].[big_picture_url], [n].[Body], [n].[body_ar], [n].[body_en], [n].[created_at], [n].[expiry_at], [n].[large_icon_url], [n].[Route], [n].[target_criteria], [n].[Title], [n].[title_ar], [n].[title_en]
FROM [notification_templates] AS [n]
WHERE [n].[Id] = @__Parse_0
2025-02-06 13:58:24.997 +03:00 [INF] Executed DbCommand (25ms) [Parameters=[@__Parse_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [n].[Id], [n].[additional_data], [n].[big_picture_url], [n].[Body], [n].[body_ar], [n].[body_en], [n].[created_at], [n].[expiry_at], [n].[large_icon_url], [n].[Route], [n].[target_criteria], [n].[Title], [n].[title_ar], [n].[title_en]
FROM [notification_templates] AS [n]
WHERE [n].[Id] = @__Parse_0
2025-02-06 13:58:25.024 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@__Parse_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [n].[Id], [n].[additional_data], [n].[big_picture_url], [n].[Body], [n].[body_ar], [n].[body_en], [n].[created_at], [n].[expiry_at], [n].[large_icon_url], [n].[Route], [n].[target_criteria], [n].[Title], [n].[title_ar], [n].[title_en]
FROM [notification_templates] AS [n]
WHERE [n].[Id] = @__Parse_0
2025-02-06 13:58:25.033 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@__Parse_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [n].[Id], [n].[additional_data], [n].[big_picture_url], [n].[Body], [n].[body_ar], [n].[body_en], [n].[created_at], [n].[expiry_at], [n].[large_icon_url], [n].[Route], [n].[target_criteria], [n].[Title], [n].[title_ar], [n].[title_en]
FROM [notification_templates] AS [n]
WHERE [n].[Id] = @__Parse_0
2025-02-06 13:58:25.047 +03:00 [INF] Executed DbCommand (2ms) [Parameters=[@__Parse_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [n].[Id], [n].[additional_data], [n].[big_picture_url], [n].[Body], [n].[body_ar], [n].[body_en], [n].[created_at], [n].[expiry_at], [n].[large_icon_url], [n].[Route], [n].[target_criteria], [n].[Title], [n].[title_ar], [n].[title_en]
FROM [notification_templates] AS [n]
WHERE [n].[Id] = @__Parse_0
2025-02-06 13:58:25.071 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@__Parse_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [n].[Id], [n].[additional_data], [n].[big_picture_url], [n].[Body], [n].[body_ar], [n].[body_en], [n].[created_at], [n].[expiry_at], [n].[large_icon_url], [n].[Route], [n].[target_criteria], [n].[Title], [n].[title_ar], [n].[title_en]
FROM [notification_templates] AS [n]
WHERE [n].[Id] = @__Parse_0
2025-02-06 13:58:25.083 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@__Parse_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [n].[Id], [n].[additional_data], [n].[big_picture_url], [n].[Body], [n].[body_ar], [n].[body_en], [n].[created_at], [n].[expiry_at], [n].[large_icon_url], [n].[Route], [n].[target_criteria], [n].[Title], [n].[title_ar], [n].[title_en]
FROM [notification_templates] AS [n]
WHERE [n].[Id] = @__Parse_0
2025-02-06 13:58:25.104 +03:00 [INF] Executed DbCommand (8ms) [Parameters=[@__Parse_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [n].[Id], [n].[additional_data], [n].[big_picture_url], [n].[Body], [n].[body_ar], [n].[body_en], [n].[created_at], [n].[expiry_at], [n].[large_icon_url], [n].[Route], [n].[target_criteria], [n].[Title], [n].[title_ar], [n].[title_en]
FROM [notification_templates] AS [n]
WHERE [n].[Id] = @__Parse_0
2025-02-06 13:58:25.140 +03:00 [INF] Executed DbCommand (4ms) [Parameters=[@__Parse_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [n].[Id], [n].[additional_data], [n].[big_picture_url], [n].[Body], [n].[body_ar], [n].[body_en], [n].[created_at], [n].[expiry_at], [n].[large_icon_url], [n].[Route], [n].[target_criteria], [n].[Title], [n].[title_ar], [n].[title_en]
FROM [notification_templates] AS [n]
WHERE [n].[Id] = @__Parse_0
2025-02-06 13:58:25.164 +03:00 [INF] Executed DbCommand (16ms) [Parameters=[@p0='?' (Size = 4000), @p1='?' (DbType = DateTime2), @p2='?' (Size = 4000), @p3='?' (Size = 4000), @p4='?' (Size = 4000), @p5='?' (Size = 450), @p6='?' (Size = 4000), @p7='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SET IMPLICIT_TRANSACTIONS OFF;
SET NOCOUNT ON;
INSERT INTO [AuthLogs] ([AuthType], [CreatedAt], [DeviceId], [FailureReason], [IpAddress], [NationalId], [Status], [UserAgent])
OUTPUT INSERTED.[Id]
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7);
2025-02-06 13:58:25.178 +03:00 [ERR] An exception occurred in the database while saving changes for context type 'NayifatAPI.Data.ApplicationDbContext'.
Microsoft.EntityFrameworkCore.DbUpdateException: An error occurred while saving the entity changes. See the inner exception for details.
 ---> Microsoft.Data.SqlClient.SqlException (0x80131904): The INSERT statement conflicted with the FOREIGN KEY constraint "FK_AuthLogs_Customers_NationalId". The conflict occurred in database "NayifatApp", table "dbo.Customers", column 'NationalId'.
   at Microsoft.Data.SqlClient.SqlConnection.OnError(SqlException exception, Boolean breakConnection, Action`1 wrapCloseInAction)
   at Microsoft.Data.SqlClient.SqlInternalConnection.OnError(SqlException exception, Boolean breakConnection, Action`1 wrapCloseInAction)
   at Microsoft.Data.SqlClient.TdsParser.ThrowExceptionAndWarning(TdsParserStateObject stateObj, Boolean callerHasConnectionLock, Boolean asyncClose)
   at Microsoft.Data.SqlClient.TdsParser.TryRun(RunBehavior runBehavior, SqlCommand cmdHandler, SqlDataReader dataStream, BulkCopySimpleResultSet bulkCopyHandler, TdsParserStateObject stateObj, Boolean& dataReady)
   at Microsoft.Data.SqlClient.SqlDataReader.TryHasMoreRows(Boolean& moreRows)
   at Microsoft.Data.SqlClient.SqlDataReader.TryReadInternal(Boolean setTimeout, Boolean& more)
   at Microsoft.Data.SqlClient.SqlDataReader.ReadAsyncExecute(Task task, Object state)
   at Microsoft.Data.SqlClient.SqlDataReader.InvokeAsyncCall[T](SqlDataReaderBaseAsyncCallContext`1 context)
--- End of stack trace from previous location ---
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeResultSetAsync(Int32 startCommandIndex, RelationalDataReader reader, CancellationToken cancellationToken)
ClientConnectionId:2c533c28-7377-495e-b51f-6adbafed467b
Error Number:547,State:0,Class:16
   --- End of inner exception stack trace ---
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeResultSetAsync(Int32 startCommandIndex, RelationalDataReader reader, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeAsync(RelationalDataReader reader, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Update.Internal.SqlServerModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(IList`1 entriesToSave, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(StateManager stateManager, Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Storage.Internal.SqlServerExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
Microsoft.EntityFrameworkCore.DbUpdateException: An error occurred while saving the entity changes. See the inner exception for details.
 ---> Microsoft.Data.SqlClient.SqlException (0x80131904): The INSERT statement conflicted with the FOREIGN KEY constraint "FK_AuthLogs_Customers_NationalId". The conflict occurred in database "NayifatApp", table "dbo.Customers", column 'NationalId'.
   at Microsoft.Data.SqlClient.SqlConnection.OnError(SqlException exception, Boolean breakConnection, Action`1 wrapCloseInAction)
   at Microsoft.Data.SqlClient.SqlInternalConnection.OnError(SqlException exception, Boolean breakConnection, Action`1 wrapCloseInAction)
   at Microsoft.Data.SqlClient.TdsParser.ThrowExceptionAndWarning(TdsParserStateObject stateObj, Boolean callerHasConnectionLock, Boolean asyncClose)
   at Microsoft.Data.SqlClient.TdsParser.TryRun(RunBehavior runBehavior, SqlCommand cmdHandler, SqlDataReader dataStream, BulkCopySimpleResultSet bulkCopyHandler, TdsParserStateObject stateObj, Boolean& dataReady)
   at Microsoft.Data.SqlClient.SqlDataReader.TryHasMoreRows(Boolean& moreRows)
   at Microsoft.Data.SqlClient.SqlDataReader.TryReadInternal(Boolean setTimeout, Boolean& more)
   at Microsoft.Data.SqlClient.SqlDataReader.ReadAsyncExecute(Task task, Object state)
   at Microsoft.Data.SqlClient.SqlDataReader.InvokeAsyncCall[T](SqlDataReaderBaseAsyncCallContext`1 context)
--- End of stack trace from previous location ---
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeResultSetAsync(Int32 startCommandIndex, RelationalDataReader reader, CancellationToken cancellationToken)
ClientConnectionId:2c533c28-7377-495e-b51f-6adbafed467b
Error Number:547,State:0,Class:16
   --- End of inner exception stack trace ---
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeResultSetAsync(Int32 startCommandIndex, RelationalDataReader reader, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeAsync(RelationalDataReader reader, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Update.Internal.SqlServerModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(IList`1 entriesToSave, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(StateManager stateManager, Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Storage.Internal.SqlServerExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
2025-02-06 13:58:25.249 +03:00 [ERR] Error logging audit event. NationalId: all, Action: notification_delivered, Details: {"notification_count":21,"notification_ids":[38,37,36,35,34,33,32,31,30,29,28,27,26,25,24,23,23,20,19,18,12],"timestamp":"2025-02-06T13:58:24.080904"}
Microsoft.EntityFrameworkCore.DbUpdateException: An error occurred while saving the entity changes. See the inner exception for details.
 ---> Microsoft.Data.SqlClient.SqlException (0x80131904): The INSERT statement conflicted with the FOREIGN KEY constraint "FK_AuthLogs_Customers_NationalId". The conflict occurred in database "NayifatApp", table "dbo.Customers", column 'NationalId'.
   at Microsoft.Data.SqlClient.SqlConnection.OnError(SqlException exception, Boolean breakConnection, Action`1 wrapCloseInAction)
   at Microsoft.Data.SqlClient.SqlInternalConnection.OnError(SqlException exception, Boolean breakConnection, Action`1 wrapCloseInAction)
   at Microsoft.Data.SqlClient.TdsParser.ThrowExceptionAndWarning(TdsParserStateObject stateObj, Boolean callerHasConnectionLock, Boolean asyncClose)
   at Microsoft.Data.SqlClient.TdsParser.TryRun(RunBehavior runBehavior, SqlCommand cmdHandler, SqlDataReader dataStream, BulkCopySimpleResultSet bulkCopyHandler, TdsParserStateObject stateObj, Boolean& dataReady)
   at Microsoft.Data.SqlClient.SqlDataReader.TryHasMoreRows(Boolean& moreRows)
   at Microsoft.Data.SqlClient.SqlDataReader.TryReadInternal(Boolean setTimeout, Boolean& more)
   at Microsoft.Data.SqlClient.SqlDataReader.ReadAsyncExecute(Task task, Object state)
   at Microsoft.Data.SqlClient.SqlDataReader.InvokeAsyncCall[T](SqlDataReaderBaseAsyncCallContext`1 context)
--- End of stack trace from previous location ---
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeResultSetAsync(Int32 startCommandIndex, RelationalDataReader reader, CancellationToken cancellationToken)
ClientConnectionId:2c533c28-7377-495e-b51f-6adbafed467b
Error Number:547,State:0,Class:16
   --- End of inner exception stack trace ---
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeResultSetAsync(Int32 startCommandIndex, RelationalDataReader reader, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeAsync(RelationalDataReader reader, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Update.Internal.SqlServerModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(IList`1 entriesToSave, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(StateManager stateManager, Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Storage.Internal.SqlServerExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at NayifatAPI.Services.AuditLogService.LogAsync(String nationalId, String action, Object details) in C:\Users\yamta\StudioProjects\nayifat_app_2025_new\NayifatAPI\Services\AuditLogService.cs:line 36
2025-02-06 13:58:25.278 +03:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType11`2[[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Object, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-02-06 13:58:25.290 +03:00 [INF] Executed action NayifatAPI.Controllers.NotificationsController.GetNotifications (NayifatAPI) in 1815.1178ms
2025-02-06 13:58:25.305 +03:00 [INF] Executed endpoint 'NayifatAPI.Controllers.NotificationsController.GetNotifications (NayifatAPI)'
2025-02-06 13:58:25.308 +03:00 [INF] Request finished HTTP/1.1 POST http://eb3c-46-152-255-232.ngrok-free.app/api/notifications/list - 200 null application/json; charset=utf-8 2551.3695ms
2025-02-06 14:02:39.572 +03:00 [INF] Request starting HTTP/1.1 POST http://eb3c-46-152-255-232.ngrok-free.app/api/notifications/list - application/json; charset=utf-8 45
2025-02-06 14:02:39.574 +03:00 [INF] Executing endpoint 'NayifatAPI.Controllers.NotificationsController.GetNotifications (NayifatAPI)'
2025-02-06 14:02:39.576 +03:00 [INF] Route matched with {action = "GetNotifications", controller = "Notifications"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetNotifications(NayifatAPI.Controllers.GetNotificationsRequest) on controller NayifatAPI.Controllers.NotificationsController (NayifatAPI).
2025-02-06 14:02:39.606 +03:00 [INF] Executed DbCommand (27ms) [Parameters=[@__providedApiKey_0='?' (Size = 255)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [a].[api_Key], [a].[CreatedAt], [a].[Description], [a].[ExpiresAt], [a].[IsActive], [a].[LastUsedAt]
FROM [ApiKeys] AS [a]
WHERE [a].[api_Key] = @__providedApiKey_0 AND [a].[IsActive] = CAST(1 AS bit)
2025-02-06 14:02:39.612 +03:00 [INF] Executed DbCommand (4ms) [Parameters=[@__request_NationalId_0='?' (Size = 450)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [u].[national_id], [u].[last_updated], [u].[notifications]
FROM [user_notifications] AS [u]
WHERE [u].[national_id] = @__request_NationalId_0
2025-02-06 14:02:39.618 +03:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType11`2[[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Object, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-02-06 14:02:39.619 +03:00 [INF] Executed action NayifatAPI.Controllers.NotificationsController.GetNotifications (NayifatAPI) in 41.9967ms
2025-02-06 14:02:39.621 +03:00 [INF] Executed endpoint 'NayifatAPI.Controllers.NotificationsController.GetNotifications (NayifatAPI)'
2025-02-06 14:02:39.622 +03:00 [INF] Request finished HTTP/1.1 POST http://eb3c-46-152-255-232.ngrok-free.app/api/notifications/list - 200 null application/json; charset=utf-8 50.085ms
2025-02-06 14:02:40.069 +03:00 [INF] Request starting HTTP/1.1 POST http://eb3c-46-152-255-232.ngrok-free.app/api/notifications/list - application/json; charset=utf-8 39
2025-02-06 14:02:40.072 +03:00 [INF] Executing endpoint 'NayifatAPI.Controllers.NotificationsController.GetNotifications (NayifatAPI)'
2025-02-06 14:02:40.073 +03:00 [INF] Route matched with {action = "GetNotifications", controller = "Notifications"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetNotifications(NayifatAPI.Controllers.GetNotificationsRequest) on controller NayifatAPI.Controllers.NotificationsController (NayifatAPI).
2025-02-06 14:02:40.078 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@__providedApiKey_0='?' (Size = 255)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [a].[api_Key], [a].[CreatedAt], [a].[Description], [a].[ExpiresAt], [a].[IsActive], [a].[LastUsedAt]
FROM [ApiKeys] AS [a]
WHERE [a].[api_Key] = @__providedApiKey_0 AND [a].[IsActive] = CAST(1 AS bit)
2025-02-06 14:02:40.084 +03:00 [INF] Executed DbCommand (2ms) [Parameters=[@__request_NationalId_0='?' (Size = 450)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [u].[national_id], [u].[last_updated], [u].[notifications]
FROM [user_notifications] AS [u]
WHERE [u].[national_id] = @__request_NationalId_0
2025-02-06 14:02:40.097 +03:00 [INF] Executed DbCommand (10ms) [Parameters=[@__Parse_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [n].[Id], [n].[additional_data], [n].[big_picture_url], [n].[Body], [n].[body_ar], [n].[body_en], [n].[created_at], [n].[expiry_at], [n].[large_icon_url], [n].[Route], [n].[target_criteria], [n].[Title], [n].[title_ar], [n].[title_en]
FROM [notification_templates] AS [n]
WHERE [n].[Id] = @__Parse_0
2025-02-06 14:02:40.100 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@__Parse_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [n].[Id], [n].[additional_data], [n].[big_picture_url], [n].[Body], [n].[body_ar], [n].[body_en], [n].[created_at], [n].[expiry_at], [n].[large_icon_url], [n].[Route], [n].[target_criteria], [n].[Title], [n].[title_ar], [n].[title_en]
FROM [notification_templates] AS [n]
WHERE [n].[Id] = @__Parse_0
2025-02-06 14:02:40.102 +03:00 [INF] Executed DbCommand (0ms) [Parameters=[@__Parse_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [n].[Id], [n].[additional_data], [n].[big_picture_url], [n].[Body], [n].[body_ar], [n].[body_en], [n].[created_at], [n].[expiry_at], [n].[large_icon_url], [n].[Route], [n].[target_criteria], [n].[Title], [n].[title_ar], [n].[title_en]
FROM [notification_templates] AS [n]
WHERE [n].[Id] = @__Parse_0
2025-02-06 14:02:40.105 +03:00 [INF] Executed DbCommand (0ms) [Parameters=[@__Parse_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [n].[Id], [n].[additional_data], [n].[big_picture_url], [n].[Body], [n].[body_ar], [n].[body_en], [n].[created_at], [n].[expiry_at], [n].[large_icon_url], [n].[Route], [n].[target_criteria], [n].[Title], [n].[title_ar], [n].[title_en]
FROM [notification_templates] AS [n]
WHERE [n].[Id] = @__Parse_0
2025-02-06 14:02:40.107 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@__Parse_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [n].[Id], [n].[additional_data], [n].[big_picture_url], [n].[Body], [n].[body_ar], [n].[body_en], [n].[created_at], [n].[expiry_at], [n].[large_icon_url], [n].[Route], [n].[target_criteria], [n].[Title], [n].[title_ar], [n].[title_en]
FROM [notification_templates] AS [n]
WHERE [n].[Id] = @__Parse_0
2025-02-06 14:02:40.110 +03:00 [INF] Executed DbCommand (0ms) [Parameters=[@__Parse_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [n].[Id], [n].[additional_data], [n].[big_picture_url], [n].[Body], [n].[body_ar], [n].[body_en], [n].[created_at], [n].[expiry_at], [n].[large_icon_url], [n].[Route], [n].[target_criteria], [n].[Title], [n].[title_ar], [n].[title_en]
FROM [notification_templates] AS [n]
WHERE [n].[Id] = @__Parse_0
2025-02-06 14:02:40.112 +03:00 [INF] Executed DbCommand (0ms) [Parameters=[@__Parse_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [n].[Id], [n].[additional_data], [n].[big_picture_url], [n].[Body], [n].[body_ar], [n].[body_en], [n].[created_at], [n].[expiry_at], [n].[large_icon_url], [n].[Route], [n].[target_criteria], [n].[Title], [n].[title_ar], [n].[title_en]
FROM [notification_templates] AS [n]
WHERE [n].[Id] = @__Parse_0
2025-02-06 14:02:40.116 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@__Parse_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [n].[Id], [n].[additional_data], [n].[big_picture_url], [n].[Body], [n].[body_ar], [n].[body_en], [n].[created_at], [n].[expiry_at], [n].[large_icon_url], [n].[Route], [n].[target_criteria], [n].[Title], [n].[title_ar], [n].[title_en]
FROM [notification_templates] AS [n]
WHERE [n].[Id] = @__Parse_0
2025-02-06 14:02:40.121 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@__Parse_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [n].[Id], [n].[additional_data], [n].[big_picture_url], [n].[Body], [n].[body_ar], [n].[body_en], [n].[created_at], [n].[expiry_at], [n].[large_icon_url], [n].[Route], [n].[target_criteria], [n].[Title], [n].[title_ar], [n].[title_en]
FROM [notification_templates] AS [n]
WHERE [n].[Id] = @__Parse_0
2025-02-06 14:02:40.124 +03:00 [INF] Executed DbCommand (0ms) [Parameters=[@__Parse_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [n].[Id], [n].[additional_data], [n].[big_picture_url], [n].[Body], [n].[body_ar], [n].[body_en], [n].[created_at], [n].[expiry_at], [n].[large_icon_url], [n].[Route], [n].[target_criteria], [n].[Title], [n].[title_ar], [n].[title_en]
FROM [notification_templates] AS [n]
WHERE [n].[Id] = @__Parse_0
2025-02-06 14:02:40.127 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@__Parse_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [n].[Id], [n].[additional_data], [n].[big_picture_url], [n].[Body], [n].[body_ar], [n].[body_en], [n].[created_at], [n].[expiry_at], [n].[large_icon_url], [n].[Route], [n].[target_criteria], [n].[Title], [n].[title_ar], [n].[title_en]
FROM [notification_templates] AS [n]
WHERE [n].[Id] = @__Parse_0
2025-02-06 14:02:40.130 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@__Parse_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [n].[Id], [n].[additional_data], [n].[big_picture_url], [n].[Body], [n].[body_ar], [n].[body_en], [n].[created_at], [n].[expiry_at], [n].[large_icon_url], [n].[Route], [n].[target_criteria], [n].[Title], [n].[title_ar], [n].[title_en]
FROM [notification_templates] AS [n]
WHERE [n].[Id] = @__Parse_0
2025-02-06 14:02:40.134 +03:00 [INF] Executed DbCommand (0ms) [Parameters=[@__Parse_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [n].[Id], [n].[additional_data], [n].[big_picture_url], [n].[Body], [n].[body_ar], [n].[body_en], [n].[created_at], [n].[expiry_at], [n].[large_icon_url], [n].[Route], [n].[target_criteria], [n].[Title], [n].[title_ar], [n].[title_en]
FROM [notification_templates] AS [n]
WHERE [n].[Id] = @__Parse_0
2025-02-06 14:02:40.137 +03:00 [INF] Executed DbCommand (0ms) [Parameters=[@__Parse_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [n].[Id], [n].[additional_data], [n].[big_picture_url], [n].[Body], [n].[body_ar], [n].[body_en], [n].[created_at], [n].[expiry_at], [n].[large_icon_url], [n].[Route], [n].[target_criteria], [n].[Title], [n].[title_ar], [n].[title_en]
FROM [notification_templates] AS [n]
WHERE [n].[Id] = @__Parse_0
2025-02-06 14:02:40.140 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@__Parse_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [n].[Id], [n].[additional_data], [n].[big_picture_url], [n].[Body], [n].[body_ar], [n].[body_en], [n].[created_at], [n].[expiry_at], [n].[large_icon_url], [n].[Route], [n].[target_criteria], [n].[Title], [n].[title_ar], [n].[title_en]
FROM [notification_templates] AS [n]
WHERE [n].[Id] = @__Parse_0
2025-02-06 14:02:40.144 +03:00 [INF] Executed DbCommand (0ms) [Parameters=[@__Parse_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [n].[Id], [n].[additional_data], [n].[big_picture_url], [n].[Body], [n].[body_ar], [n].[body_en], [n].[created_at], [n].[expiry_at], [n].[large_icon_url], [n].[Route], [n].[target_criteria], [n].[Title], [n].[title_ar], [n].[title_en]
FROM [notification_templates] AS [n]
WHERE [n].[Id] = @__Parse_0
2025-02-06 14:02:40.146 +03:00 [INF] Executed DbCommand (0ms) [Parameters=[@__Parse_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [n].[Id], [n].[additional_data], [n].[big_picture_url], [n].[Body], [n].[body_ar], [n].[body_en], [n].[created_at], [n].[expiry_at], [n].[large_icon_url], [n].[Route], [n].[target_criteria], [n].[Title], [n].[title_ar], [n].[title_en]
FROM [notification_templates] AS [n]
WHERE [n].[Id] = @__Parse_0
2025-02-06 14:02:40.149 +03:00 [INF] Executed DbCommand (0ms) [Parameters=[@__Parse_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [n].[Id], [n].[additional_data], [n].[big_picture_url], [n].[Body], [n].[body_ar], [n].[body_en], [n].[created_at], [n].[expiry_at], [n].[large_icon_url], [n].[Route], [n].[target_criteria], [n].[Title], [n].[title_ar], [n].[title_en]
FROM [notification_templates] AS [n]
WHERE [n].[Id] = @__Parse_0
2025-02-06 14:02:40.151 +03:00 [INF] Executed DbCommand (0ms) [Parameters=[@__Parse_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [n].[Id], [n].[additional_data], [n].[big_picture_url], [n].[Body], [n].[body_ar], [n].[body_en], [n].[created_at], [n].[expiry_at], [n].[large_icon_url], [n].[Route], [n].[target_criteria], [n].[Title], [n].[title_ar], [n].[title_en]
FROM [notification_templates] AS [n]
WHERE [n].[Id] = @__Parse_0
2025-02-06 14:02:40.153 +03:00 [INF] Executed DbCommand (0ms) [Parameters=[@__Parse_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [n].[Id], [n].[additional_data], [n].[big_picture_url], [n].[Body], [n].[body_ar], [n].[body_en], [n].[created_at], [n].[expiry_at], [n].[large_icon_url], [n].[Route], [n].[target_criteria], [n].[Title], [n].[title_ar], [n].[title_en]
FROM [notification_templates] AS [n]
WHERE [n].[Id] = @__Parse_0
2025-02-06 14:02:40.156 +03:00 [INF] Executed DbCommand (0ms) [Parameters=[@__Parse_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [n].[Id], [n].[additional_data], [n].[big_picture_url], [n].[Body], [n].[body_ar], [n].[body_en], [n].[created_at], [n].[expiry_at], [n].[large_icon_url], [n].[Route], [n].[target_criteria], [n].[Title], [n].[title_ar], [n].[title_en]
FROM [notification_templates] AS [n]
WHERE [n].[Id] = @__Parse_0
2025-02-06 14:02:40.174 +03:00 [INF] Executed DbCommand (15ms) [Parameters=[@p0='?' (Size = 4000), @p1='?' (DbType = DateTime2), @p2='?' (Size = 4000), @p3='?' (Size = 4000), @p4='?' (Size = 4000), @p5='?' (Size = 450), @p6='?' (Size = 4000), @p7='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SET IMPLICIT_TRANSACTIONS OFF;
SET NOCOUNT ON;
INSERT INTO [AuthLogs] ([AuthType], [CreatedAt], [DeviceId], [FailureReason], [IpAddress], [NationalId], [Status], [UserAgent])
OUTPUT INSERTED.[Id]
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7);
2025-02-06 14:02:40.179 +03:00 [ERR] An exception occurred in the database while saving changes for context type 'NayifatAPI.Data.ApplicationDbContext'.
Microsoft.EntityFrameworkCore.DbUpdateException: An error occurred while saving the entity changes. See the inner exception for details.
 ---> Microsoft.Data.SqlClient.SqlException (0x80131904): The INSERT statement conflicted with the FOREIGN KEY constraint "FK_AuthLogs_Customers_NationalId". The conflict occurred in database "NayifatApp", table "dbo.Customers", column 'NationalId'.
   at Microsoft.Data.SqlClient.SqlConnection.OnError(SqlException exception, Boolean breakConnection, Action`1 wrapCloseInAction)
   at Microsoft.Data.SqlClient.SqlInternalConnection.OnError(SqlException exception, Boolean breakConnection, Action`1 wrapCloseInAction)
   at Microsoft.Data.SqlClient.TdsParser.ThrowExceptionAndWarning(TdsParserStateObject stateObj, Boolean callerHasConnectionLock, Boolean asyncClose)
   at Microsoft.Data.SqlClient.TdsParser.TryRun(RunBehavior runBehavior, SqlCommand cmdHandler, SqlDataReader dataStream, BulkCopySimpleResultSet bulkCopyHandler, TdsParserStateObject stateObj, Boolean& dataReady)
   at Microsoft.Data.SqlClient.SqlDataReader.TryHasMoreRows(Boolean& moreRows)
   at Microsoft.Data.SqlClient.SqlDataReader.TryReadInternal(Boolean setTimeout, Boolean& more)
   at Microsoft.Data.SqlClient.SqlDataReader.ReadAsyncExecute(Task task, Object state)
   at Microsoft.Data.SqlClient.SqlDataReader.InvokeAsyncCall[T](SqlDataReaderBaseAsyncCallContext`1 context)
--- End of stack trace from previous location ---
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeResultSetAsync(Int32 startCommandIndex, RelationalDataReader reader, CancellationToken cancellationToken)
ClientConnectionId:2c533c28-7377-495e-b51f-6adbafed467b
Error Number:547,State:0,Class:16
   --- End of inner exception stack trace ---
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeResultSetAsync(Int32 startCommandIndex, RelationalDataReader reader, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeAsync(RelationalDataReader reader, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Update.Internal.SqlServerModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(IList`1 entriesToSave, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(StateManager stateManager, Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Storage.Internal.SqlServerExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
Microsoft.EntityFrameworkCore.DbUpdateException: An error occurred while saving the entity changes. See the inner exception for details.
 ---> Microsoft.Data.SqlClient.SqlException (0x80131904): The INSERT statement conflicted with the FOREIGN KEY constraint "FK_AuthLogs_Customers_NationalId". The conflict occurred in database "NayifatApp", table "dbo.Customers", column 'NationalId'.
   at Microsoft.Data.SqlClient.SqlConnection.OnError(SqlException exception, Boolean breakConnection, Action`1 wrapCloseInAction)
   at Microsoft.Data.SqlClient.SqlInternalConnection.OnError(SqlException exception, Boolean breakConnection, Action`1 wrapCloseInAction)
   at Microsoft.Data.SqlClient.TdsParser.ThrowExceptionAndWarning(TdsParserStateObject stateObj, Boolean callerHasConnectionLock, Boolean asyncClose)
   at Microsoft.Data.SqlClient.TdsParser.TryRun(RunBehavior runBehavior, SqlCommand cmdHandler, SqlDataReader dataStream, BulkCopySimpleResultSet bulkCopyHandler, TdsParserStateObject stateObj, Boolean& dataReady)
   at Microsoft.Data.SqlClient.SqlDataReader.TryHasMoreRows(Boolean& moreRows)
   at Microsoft.Data.SqlClient.SqlDataReader.TryReadInternal(Boolean setTimeout, Boolean& more)
   at Microsoft.Data.SqlClient.SqlDataReader.ReadAsyncExecute(Task task, Object state)
   at Microsoft.Data.SqlClient.SqlDataReader.InvokeAsyncCall[T](SqlDataReaderBaseAsyncCallContext`1 context)
--- End of stack trace from previous location ---
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeResultSetAsync(Int32 startCommandIndex, RelationalDataReader reader, CancellationToken cancellationToken)
ClientConnectionId:2c533c28-7377-495e-b51f-6adbafed467b
Error Number:547,State:0,Class:16
   --- End of inner exception stack trace ---
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeResultSetAsync(Int32 startCommandIndex, RelationalDataReader reader, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeAsync(RelationalDataReader reader, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Update.Internal.SqlServerModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(IList`1 entriesToSave, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(StateManager stateManager, Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Storage.Internal.SqlServerExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
2025-02-06 14:02:40.191 +03:00 [ERR] Error logging audit event. NationalId: all, Action: notification_delivered, Details: {"notification_count":21,"notification_ids":[38,37,36,35,34,33,32,31,30,29,28,27,26,25,24,23,23,20,19,18,12],"timestamp":"2025-02-06T14:02:40.0874064"}
Microsoft.EntityFrameworkCore.DbUpdateException: An error occurred while saving the entity changes. See the inner exception for details.
 ---> Microsoft.Data.SqlClient.SqlException (0x80131904): The INSERT statement conflicted with the FOREIGN KEY constraint "FK_AuthLogs_Customers_NationalId". The conflict occurred in database "NayifatApp", table "dbo.Customers", column 'NationalId'.
   at Microsoft.Data.SqlClient.SqlConnection.OnError(SqlException exception, Boolean breakConnection, Action`1 wrapCloseInAction)
   at Microsoft.Data.SqlClient.SqlInternalConnection.OnError(SqlException exception, Boolean breakConnection, Action`1 wrapCloseInAction)
   at Microsoft.Data.SqlClient.TdsParser.ThrowExceptionAndWarning(TdsParserStateObject stateObj, Boolean callerHasConnectionLock, Boolean asyncClose)
   at Microsoft.Data.SqlClient.TdsParser.TryRun(RunBehavior runBehavior, SqlCommand cmdHandler, SqlDataReader dataStream, BulkCopySimpleResultSet bulkCopyHandler, TdsParserStateObject stateObj, Boolean& dataReady)
   at Microsoft.Data.SqlClient.SqlDataReader.TryHasMoreRows(Boolean& moreRows)
   at Microsoft.Data.SqlClient.SqlDataReader.TryReadInternal(Boolean setTimeout, Boolean& more)
   at Microsoft.Data.SqlClient.SqlDataReader.ReadAsyncExecute(Task task, Object state)
   at Microsoft.Data.SqlClient.SqlDataReader.InvokeAsyncCall[T](SqlDataReaderBaseAsyncCallContext`1 context)
--- End of stack trace from previous location ---
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeResultSetAsync(Int32 startCommandIndex, RelationalDataReader reader, CancellationToken cancellationToken)
ClientConnectionId:2c533c28-7377-495e-b51f-6adbafed467b
Error Number:547,State:0,Class:16
   --- End of inner exception stack trace ---
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeResultSetAsync(Int32 startCommandIndex, RelationalDataReader reader, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeAsync(RelationalDataReader reader, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Update.Internal.SqlServerModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(IList`1 entriesToSave, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(StateManager stateManager, Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Storage.Internal.SqlServerExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at NayifatAPI.Services.AuditLogService.LogAsync(String nationalId, String action, Object details) in C:\Users\yamta\StudioProjects\nayifat_app_2025_new\NayifatAPI\Services\AuditLogService.cs:line 36
2025-02-06 14:02:40.200 +03:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType11`2[[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Object, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-02-06 14:02:40.201 +03:00 [INF] Executed action NayifatAPI.Controllers.NotificationsController.GetNotifications (NayifatAPI) in 125.3585ms
2025-02-06 14:02:40.202 +03:00 [INF] Executed endpoint 'NayifatAPI.Controllers.NotificationsController.GetNotifications (NayifatAPI)'
2025-02-06 14:02:40.203 +03:00 [INF] Request finished HTTP/1.1 POST http://eb3c-46-152-255-232.ngrok-free.app/api/notifications/list - 200 null application/json; charset=utf-8 134.4625ms
2025-02-06 14:13:30.444 +03:00 [INF] Request starting HTTP/1.1 POST http://eb3c-46-152-255-232.ngrok-free.app/api/notifications/list - application/json; charset=utf-8 45
2025-02-06 14:13:30.444 +03:00 [INF] Request starting HTTP/1.1 POST http://eb3c-46-152-255-232.ngrok-free.app/api/notifications/list - application/json; charset=utf-8 45
2025-02-06 14:13:30.448 +03:00 [INF] Executing endpoint 'NayifatAPI.Controllers.NotificationsController.GetNotifications (NayifatAPI)'
2025-02-06 14:13:30.450 +03:00 [INF] Executing endpoint 'NayifatAPI.Controllers.NotificationsController.GetNotifications (NayifatAPI)'
2025-02-06 14:13:30.451 +03:00 [INF] Route matched with {action = "GetNotifications", controller = "Notifications"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetNotifications(NayifatAPI.Controllers.GetNotificationsRequest) on controller NayifatAPI.Controllers.NotificationsController (NayifatAPI).
2025-02-06 14:13:30.453 +03:00 [INF] Route matched with {action = "GetNotifications", controller = "Notifications"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetNotifications(NayifatAPI.Controllers.GetNotificationsRequest) on controller NayifatAPI.Controllers.NotificationsController (NayifatAPI).
2025-02-06 14:13:30.487 +03:00 [INF] Executed DbCommand (17ms) [Parameters=[@__providedApiKey_0='?' (Size = 255)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [a].[api_Key], [a].[CreatedAt], [a].[Description], [a].[ExpiresAt], [a].[IsActive], [a].[LastUsedAt]
FROM [ApiKeys] AS [a]
WHERE [a].[api_Key] = @__providedApiKey_0 AND [a].[IsActive] = CAST(1 AS bit)
2025-02-06 14:13:30.488 +03:00 [INF] Executed DbCommand (13ms) [Parameters=[@__providedApiKey_0='?' (Size = 255)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [a].[api_Key], [a].[CreatedAt], [a].[Description], [a].[ExpiresAt], [a].[IsActive], [a].[LastUsedAt]
FROM [ApiKeys] AS [a]
WHERE [a].[api_Key] = @__providedApiKey_0 AND [a].[IsActive] = CAST(1 AS bit)
2025-02-06 14:13:30.493 +03:00 [INF] Executed DbCommand (4ms) [Parameters=[@__request_NationalId_0='?' (Size = 450)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [u].[national_id], [u].[last_updated], [u].[notifications]
FROM [user_notifications] AS [u]
WHERE [u].[national_id] = @__request_NationalId_0
2025-02-06 14:13:30.494 +03:00 [INF] Executed DbCommand (3ms) [Parameters=[@__request_NationalId_0='?' (Size = 450)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [u].[national_id], [u].[last_updated], [u].[notifications]
FROM [user_notifications] AS [u]
WHERE [u].[national_id] = @__request_NationalId_0
2025-02-06 14:13:30.497 +03:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType11`2[[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Object, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-02-06 14:13:30.499 +03:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType11`2[[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Object, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-02-06 14:13:30.500 +03:00 [INF] Executed action NayifatAPI.Controllers.NotificationsController.GetNotifications (NayifatAPI) in 44.7087ms
2025-02-06 14:13:30.501 +03:00 [INF] Executed action NayifatAPI.Controllers.NotificationsController.GetNotifications (NayifatAPI) in 44.3843ms
2025-02-06 14:13:30.502 +03:00 [INF] Executed endpoint 'NayifatAPI.Controllers.NotificationsController.GetNotifications (NayifatAPI)'
2025-02-06 14:13:30.504 +03:00 [INF] Executed endpoint 'NayifatAPI.Controllers.NotificationsController.GetNotifications (NayifatAPI)'
2025-02-06 14:13:30.504 +03:00 [INF] Request finished HTTP/1.1 POST http://eb3c-46-152-255-232.ngrok-free.app/api/notifications/list - 200 null application/json; charset=utf-8 60.2525ms
2025-02-06 14:13:30.505 +03:00 [INF] Request finished HTTP/1.1 POST http://eb3c-46-152-255-232.ngrok-free.app/api/notifications/list - 200 null application/json; charset=utf-8 60.8933ms
2025-02-06 14:13:30.622 +03:00 [INF] Request starting HTTP/1.1 POST http://eb3c-46-152-255-232.ngrok-free.app/api/notifications/list - application/json 39
2025-02-06 14:13:30.623 +03:00 [INF] Request starting HTTP/1.1 POST http://eb3c-46-152-255-232.ngrok-free.app/api/notifications/list - application/json 39
2025-02-06 14:13:30.625 +03:00 [INF] Executing endpoint 'NayifatAPI.Controllers.NotificationsController.GetNotifications (NayifatAPI)'
2025-02-06 14:13:30.627 +03:00 [INF] Executing endpoint 'NayifatAPI.Controllers.NotificationsController.GetNotifications (NayifatAPI)'
2025-02-06 14:13:30.628 +03:00 [INF] Route matched with {action = "GetNotifications", controller = "Notifications"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetNotifications(NayifatAPI.Controllers.GetNotificationsRequest) on controller NayifatAPI.Controllers.NotificationsController (NayifatAPI).
2025-02-06 14:13:30.632 +03:00 [INF] Route matched with {action = "GetNotifications", controller = "Notifications"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetNotifications(NayifatAPI.Controllers.GetNotificationsRequest) on controller NayifatAPI.Controllers.NotificationsController (NayifatAPI).
2025-02-06 14:13:30.636 +03:00 [INF] Executed DbCommand (2ms) [Parameters=[@__providedApiKey_0='?' (Size = 255)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [a].[api_Key], [a].[CreatedAt], [a].[Description], [a].[ExpiresAt], [a].[IsActive], [a].[LastUsedAt]
FROM [ApiKeys] AS [a]
WHERE [a].[api_Key] = @__providedApiKey_0 AND [a].[IsActive] = CAST(1 AS bit)
2025-02-06 14:13:30.637 +03:00 [INF] Executed DbCommand (0ms) [Parameters=[@__providedApiKey_0='?' (Size = 255)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [a].[api_Key], [a].[CreatedAt], [a].[Description], [a].[ExpiresAt], [a].[IsActive], [a].[LastUsedAt]
FROM [ApiKeys] AS [a]
WHERE [a].[api_Key] = @__providedApiKey_0 AND [a].[IsActive] = CAST(1 AS bit)
2025-02-06 14:13:30.640 +03:00 [INF] Executed DbCommand (0ms) [Parameters=[@__request_NationalId_0='?' (Size = 450)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [u].[national_id], [u].[last_updated], [u].[notifications]
FROM [user_notifications] AS [u]
WHERE [u].[national_id] = @__request_NationalId_0
2025-02-06 14:13:30.641 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@__request_NationalId_0='?' (Size = 450)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [u].[national_id], [u].[last_updated], [u].[notifications]
FROM [user_notifications] AS [u]
WHERE [u].[national_id] = @__request_NationalId_0
2025-02-06 14:13:30.652 +03:00 [INF] Executed DbCommand (9ms) [Parameters=[@__Parse_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [n].[Id], [n].[additional_data], [n].[big_picture_url], [n].[Body], [n].[body_ar], [n].[body_en], [n].[created_at], [n].[expiry_at], [n].[large_icon_url], [n].[Route], [n].[target_criteria], [n].[Title], [n].[title_ar], [n].[title_en]
FROM [notification_templates] AS [n]
WHERE [n].[Id] = @__Parse_0
2025-02-06 14:13:30.652 +03:00 [INF] Executed DbCommand (8ms) [Parameters=[@__Parse_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [n].[Id], [n].[additional_data], [n].[big_picture_url], [n].[Body], [n].[body_ar], [n].[body_en], [n].[created_at], [n].[expiry_at], [n].[large_icon_url], [n].[Route], [n].[target_criteria], [n].[Title], [n].[title_ar], [n].[title_en]
FROM [notification_templates] AS [n]
WHERE [n].[Id] = @__Parse_0
2025-02-06 14:13:30.655 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@__Parse_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [n].[Id], [n].[additional_data], [n].[big_picture_url], [n].[Body], [n].[body_ar], [n].[body_en], [n].[created_at], [n].[expiry_at], [n].[large_icon_url], [n].[Route], [n].[target_criteria], [n].[Title], [n].[title_ar], [n].[title_en]
FROM [notification_templates] AS [n]
WHERE [n].[Id] = @__Parse_0
2025-02-06 14:13:30.657 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@__Parse_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [n].[Id], [n].[additional_data], [n].[big_picture_url], [n].[Body], [n].[body_ar], [n].[body_en], [n].[created_at], [n].[expiry_at], [n].[large_icon_url], [n].[Route], [n].[target_criteria], [n].[Title], [n].[title_ar], [n].[title_en]
FROM [notification_templates] AS [n]
WHERE [n].[Id] = @__Parse_0
2025-02-06 14:13:30.660 +03:00 [INF] Executed DbCommand (0ms) [Parameters=[@__Parse_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [n].[Id], [n].[additional_data], [n].[big_picture_url], [n].[Body], [n].[body_ar], [n].[body_en], [n].[created_at], [n].[expiry_at], [n].[large_icon_url], [n].[Route], [n].[target_criteria], [n].[Title], [n].[title_ar], [n].[title_en]
FROM [notification_templates] AS [n]
WHERE [n].[Id] = @__Parse_0
2025-02-06 14:13:30.662 +03:00 [INF] Executed DbCommand (0ms) [Parameters=[@__Parse_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [n].[Id], [n].[additional_data], [n].[big_picture_url], [n].[Body], [n].[body_ar], [n].[body_en], [n].[created_at], [n].[expiry_at], [n].[large_icon_url], [n].[Route], [n].[target_criteria], [n].[Title], [n].[title_ar], [n].[title_en]
FROM [notification_templates] AS [n]
WHERE [n].[Id] = @__Parse_0
2025-02-06 14:13:30.664 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@__Parse_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [n].[Id], [n].[additional_data], [n].[big_picture_url], [n].[Body], [n].[body_ar], [n].[body_en], [n].[created_at], [n].[expiry_at], [n].[large_icon_url], [n].[Route], [n].[target_criteria], [n].[Title], [n].[title_ar], [n].[title_en]
FROM [notification_templates] AS [n]
WHERE [n].[Id] = @__Parse_0
2025-02-06 14:13:30.668 +03:00 [INF] Executed DbCommand (2ms) [Parameters=[@__Parse_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [n].[Id], [n].[additional_data], [n].[big_picture_url], [n].[Body], [n].[body_ar], [n].[body_en], [n].[created_at], [n].[expiry_at], [n].[large_icon_url], [n].[Route], [n].[target_criteria], [n].[Title], [n].[title_ar], [n].[title_en]
FROM [notification_templates] AS [n]
WHERE [n].[Id] = @__Parse_0
2025-02-06 14:13:30.669 +03:00 [INF] Executed DbCommand (0ms) [Parameters=[@__Parse_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [n].[Id], [n].[additional_data], [n].[big_picture_url], [n].[Body], [n].[body_ar], [n].[body_en], [n].[created_at], [n].[expiry_at], [n].[large_icon_url], [n].[Route], [n].[target_criteria], [n].[Title], [n].[title_ar], [n].[title_en]
FROM [notification_templates] AS [n]
WHERE [n].[Id] = @__Parse_0
2025-02-06 14:13:30.671 +03:00 [INF] Executed DbCommand (0ms) [Parameters=[@__Parse_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [n].[Id], [n].[additional_data], [n].[big_picture_url], [n].[Body], [n].[body_ar], [n].[body_en], [n].[created_at], [n].[expiry_at], [n].[large_icon_url], [n].[Route], [n].[target_criteria], [n].[Title], [n].[title_ar], [n].[title_en]
FROM [notification_templates] AS [n]
WHERE [n].[Id] = @__Parse_0
2025-02-06 14:13:30.673 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@__Parse_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [n].[Id], [n].[additional_data], [n].[big_picture_url], [n].[Body], [n].[body_ar], [n].[body_en], [n].[created_at], [n].[expiry_at], [n].[large_icon_url], [n].[Route], [n].[target_criteria], [n].[Title], [n].[title_ar], [n].[title_en]
FROM [notification_templates] AS [n]
WHERE [n].[Id] = @__Parse_0
2025-02-06 14:13:30.674 +03:00 [INF] Executed DbCommand (0ms) [Parameters=[@__Parse_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [n].[Id], [n].[additional_data], [n].[big_picture_url], [n].[Body], [n].[body_ar], [n].[body_en], [n].[created_at], [n].[expiry_at], [n].[large_icon_url], [n].[Route], [n].[target_criteria], [n].[Title], [n].[title_ar], [n].[title_en]
FROM [notification_templates] AS [n]
WHERE [n].[Id] = @__Parse_0
2025-02-06 14:13:30.677 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@__Parse_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [n].[Id], [n].[additional_data], [n].[big_picture_url], [n].[Body], [n].[body_ar], [n].[body_en], [n].[created_at], [n].[expiry_at], [n].[large_icon_url], [n].[Route], [n].[target_criteria], [n].[Title], [n].[title_ar], [n].[title_en]
FROM [notification_templates] AS [n]
WHERE [n].[Id] = @__Parse_0
2025-02-06 14:13:30.679 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@__Parse_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [n].[Id], [n].[additional_data], [n].[big_picture_url], [n].[Body], [n].[body_ar], [n].[body_en], [n].[created_at], [n].[expiry_at], [n].[large_icon_url], [n].[Route], [n].[target_criteria], [n].[Title], [n].[title_ar], [n].[title_en]
FROM [notification_templates] AS [n]
WHERE [n].[Id] = @__Parse_0
2025-02-06 14:13:30.680 +03:00 [INF] Executed DbCommand (0ms) [Parameters=[@__Parse_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [n].[Id], [n].[additional_data], [n].[big_picture_url], [n].[Body], [n].[body_ar], [n].[body_en], [n].[created_at], [n].[expiry_at], [n].[large_icon_url], [n].[Route], [n].[target_criteria], [n].[Title], [n].[title_ar], [n].[title_en]
FROM [notification_templates] AS [n]
WHERE [n].[Id] = @__Parse_0
2025-02-06 14:13:30.682 +03:00 [INF] Executed DbCommand (0ms) [Parameters=[@__Parse_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [n].[Id], [n].[additional_data], [n].[big_picture_url], [n].[Body], [n].[body_ar], [n].[body_en], [n].[created_at], [n].[expiry_at], [n].[large_icon_url], [n].[Route], [n].[target_criteria], [n].[Title], [n].[title_ar], [n].[title_en]
FROM [notification_templates] AS [n]
WHERE [n].[Id] = @__Parse_0
2025-02-06 14:13:30.684 +03:00 [INF] Executed DbCommand (0ms) [Parameters=[@__Parse_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [n].[Id], [n].[additional_data], [n].[big_picture_url], [n].[Body], [n].[body_ar], [n].[body_en], [n].[created_at], [n].[expiry_at], [n].[large_icon_url], [n].[Route], [n].[target_criteria], [n].[Title], [n].[title_ar], [n].[title_en]
FROM [notification_templates] AS [n]
WHERE [n].[Id] = @__Parse_0
2025-02-06 14:13:30.685 +03:00 [INF] Executed DbCommand (0ms) [Parameters=[@__Parse_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [n].[Id], [n].[additional_data], [n].[big_picture_url], [n].[Body], [n].[body_ar], [n].[body_en], [n].[created_at], [n].[expiry_at], [n].[large_icon_url], [n].[Route], [n].[target_criteria], [n].[Title], [n].[title_ar], [n].[title_en]
FROM [notification_templates] AS [n]
WHERE [n].[Id] = @__Parse_0
2025-02-06 14:13:30.687 +03:00 [INF] Executed DbCommand (0ms) [Parameters=[@__Parse_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [n].[Id], [n].[additional_data], [n].[big_picture_url], [n].[Body], [n].[body_ar], [n].[body_en], [n].[created_at], [n].[expiry_at], [n].[large_icon_url], [n].[Route], [n].[target_criteria], [n].[Title], [n].[title_ar], [n].[title_en]
FROM [notification_templates] AS [n]
WHERE [n].[Id] = @__Parse_0
2025-02-06 14:13:30.689 +03:00 [INF] Executed DbCommand (0ms) [Parameters=[@__Parse_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [n].[Id], [n].[additional_data], [n].[big_picture_url], [n].[Body], [n].[body_ar], [n].[body_en], [n].[created_at], [n].[expiry_at], [n].[large_icon_url], [n].[Route], [n].[target_criteria], [n].[Title], [n].[title_ar], [n].[title_en]
FROM [notification_templates] AS [n]
WHERE [n].[Id] = @__Parse_0
2025-02-06 14:13:30.690 +03:00 [INF] Executed DbCommand (0ms) [Parameters=[@__Parse_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [n].[Id], [n].[additional_data], [n].[big_picture_url], [n].[Body], [n].[body_ar], [n].[body_en], [n].[created_at], [n].[expiry_at], [n].[large_icon_url], [n].[Route], [n].[target_criteria], [n].[Title], [n].[title_ar], [n].[title_en]
FROM [notification_templates] AS [n]
WHERE [n].[Id] = @__Parse_0
2025-02-06 14:13:30.692 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@__Parse_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [n].[Id], [n].[additional_data], [n].[big_picture_url], [n].[Body], [n].[body_ar], [n].[body_en], [n].[created_at], [n].[expiry_at], [n].[large_icon_url], [n].[Route], [n].[target_criteria], [n].[Title], [n].[title_ar], [n].[title_en]
FROM [notification_templates] AS [n]
WHERE [n].[Id] = @__Parse_0
2025-02-06 14:13:30.694 +03:00 [INF] Executed DbCommand (0ms) [Parameters=[@__Parse_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [n].[Id], [n].[additional_data], [n].[big_picture_url], [n].[Body], [n].[body_ar], [n].[body_en], [n].[created_at], [n].[expiry_at], [n].[large_icon_url], [n].[Route], [n].[target_criteria], [n].[Title], [n].[title_ar], [n].[title_en]
FROM [notification_templates] AS [n]
WHERE [n].[Id] = @__Parse_0
2025-02-06 14:13:30.695 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@__Parse_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [n].[Id], [n].[additional_data], [n].[big_picture_url], [n].[Body], [n].[body_ar], [n].[body_en], [n].[created_at], [n].[expiry_at], [n].[large_icon_url], [n].[Route], [n].[target_criteria], [n].[Title], [n].[title_ar], [n].[title_en]
FROM [notification_templates] AS [n]
WHERE [n].[Id] = @__Parse_0
2025-02-06 14:13:30.697 +03:00 [INF] Executed DbCommand (0ms) [Parameters=[@__Parse_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [n].[Id], [n].[additional_data], [n].[big_picture_url], [n].[Body], [n].[body_ar], [n].[body_en], [n].[created_at], [n].[expiry_at], [n].[large_icon_url], [n].[Route], [n].[target_criteria], [n].[Title], [n].[title_ar], [n].[title_en]
FROM [notification_templates] AS [n]
WHERE [n].[Id] = @__Parse_0
2025-02-06 14:13:30.698 +03:00 [INF] Executed DbCommand (0ms) [Parameters=[@__Parse_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [n].[Id], [n].[additional_data], [n].[big_picture_url], [n].[Body], [n].[body_ar], [n].[body_en], [n].[created_at], [n].[expiry_at], [n].[large_icon_url], [n].[Route], [n].[target_criteria], [n].[Title], [n].[title_ar], [n].[title_en]
FROM [notification_templates] AS [n]
WHERE [n].[Id] = @__Parse_0
2025-02-06 14:13:30.700 +03:00 [INF] Executed DbCommand (0ms) [Parameters=[@__Parse_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [n].[Id], [n].[additional_data], [n].[big_picture_url], [n].[Body], [n].[body_ar], [n].[body_en], [n].[created_at], [n].[expiry_at], [n].[large_icon_url], [n].[Route], [n].[target_criteria], [n].[Title], [n].[title_ar], [n].[title_en]
FROM [notification_templates] AS [n]
WHERE [n].[Id] = @__Parse_0
2025-02-06 14:13:30.702 +03:00 [INF] Executed DbCommand (0ms) [Parameters=[@__Parse_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [n].[Id], [n].[additional_data], [n].[big_picture_url], [n].[Body], [n].[body_ar], [n].[body_en], [n].[created_at], [n].[expiry_at], [n].[large_icon_url], [n].[Route], [n].[target_criteria], [n].[Title], [n].[title_ar], [n].[title_en]
FROM [notification_templates] AS [n]
WHERE [n].[Id] = @__Parse_0
2025-02-06 14:13:30.703 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@__Parse_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [n].[Id], [n].[additional_data], [n].[big_picture_url], [n].[Body], [n].[body_ar], [n].[body_en], [n].[created_at], [n].[expiry_at], [n].[large_icon_url], [n].[Route], [n].[target_criteria], [n].[Title], [n].[title_ar], [n].[title_en]
FROM [notification_templates] AS [n]
WHERE [n].[Id] = @__Parse_0
2025-02-06 14:13:30.705 +03:00 [INF] Executed DbCommand (0ms) [Parameters=[@__Parse_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [n].[Id], [n].[additional_data], [n].[big_picture_url], [n].[Body], [n].[body_ar], [n].[body_en], [n].[created_at], [n].[expiry_at], [n].[large_icon_url], [n].[Route], [n].[target_criteria], [n].[Title], [n].[title_ar], [n].[title_en]
FROM [notification_templates] AS [n]
WHERE [n].[Id] = @__Parse_0
2025-02-06 14:13:30.706 +03:00 [INF] Executed DbCommand (0ms) [Parameters=[@__Parse_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [n].[Id], [n].[additional_data], [n].[big_picture_url], [n].[Body], [n].[body_ar], [n].[body_en], [n].[created_at], [n].[expiry_at], [n].[large_icon_url], [n].[Route], [n].[target_criteria], [n].[Title], [n].[title_ar], [n].[title_en]
FROM [notification_templates] AS [n]
WHERE [n].[Id] = @__Parse_0
2025-02-06 14:13:30.708 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@__Parse_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [n].[Id], [n].[additional_data], [n].[big_picture_url], [n].[Body], [n].[body_ar], [n].[body_en], [n].[created_at], [n].[expiry_at], [n].[large_icon_url], [n].[Route], [n].[target_criteria], [n].[Title], [n].[title_ar], [n].[title_en]
FROM [notification_templates] AS [n]
WHERE [n].[Id] = @__Parse_0
2025-02-06 14:13:30.710 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@__Parse_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [n].[Id], [n].[additional_data], [n].[big_picture_url], [n].[Body], [n].[body_ar], [n].[body_en], [n].[created_at], [n].[expiry_at], [n].[large_icon_url], [n].[Route], [n].[target_criteria], [n].[Title], [n].[title_ar], [n].[title_en]
FROM [notification_templates] AS [n]
WHERE [n].[Id] = @__Parse_0
2025-02-06 14:13:30.711 +03:00 [INF] Executed DbCommand (0ms) [Parameters=[@__Parse_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [n].[Id], [n].[additional_data], [n].[big_picture_url], [n].[Body], [n].[body_ar], [n].[body_en], [n].[created_at], [n].[expiry_at], [n].[large_icon_url], [n].[Route], [n].[target_criteria], [n].[Title], [n].[title_ar], [n].[title_en]
FROM [notification_templates] AS [n]
WHERE [n].[Id] = @__Parse_0
2025-02-06 14:13:30.713 +03:00 [INF] Executed DbCommand (0ms) [Parameters=[@__Parse_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [n].[Id], [n].[additional_data], [n].[big_picture_url], [n].[Body], [n].[body_ar], [n].[body_en], [n].[created_at], [n].[expiry_at], [n].[large_icon_url], [n].[Route], [n].[target_criteria], [n].[Title], [n].[title_ar], [n].[title_en]
FROM [notification_templates] AS [n]
WHERE [n].[Id] = @__Parse_0
2025-02-06 14:13:30.715 +03:00 [INF] Executed DbCommand (0ms) [Parameters=[@__Parse_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [n].[Id], [n].[additional_data], [n].[big_picture_url], [n].[Body], [n].[body_ar], [n].[body_en], [n].[created_at], [n].[expiry_at], [n].[large_icon_url], [n].[Route], [n].[target_criteria], [n].[Title], [n].[title_ar], [n].[title_en]
FROM [notification_templates] AS [n]
WHERE [n].[Id] = @__Parse_0
2025-02-06 14:13:30.716 +03:00 [INF] Executed DbCommand (0ms) [Parameters=[@__Parse_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [n].[Id], [n].[additional_data], [n].[big_picture_url], [n].[Body], [n].[body_ar], [n].[body_en], [n].[created_at], [n].[expiry_at], [n].[large_icon_url], [n].[Route], [n].[target_criteria], [n].[Title], [n].[title_ar], [n].[title_en]
FROM [notification_templates] AS [n]
WHERE [n].[Id] = @__Parse_0
2025-02-06 14:13:30.718 +03:00 [INF] Executed DbCommand (0ms) [Parameters=[@__Parse_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [n].[Id], [n].[additional_data], [n].[big_picture_url], [n].[Body], [n].[body_ar], [n].[body_en], [n].[created_at], [n].[expiry_at], [n].[large_icon_url], [n].[Route], [n].[target_criteria], [n].[Title], [n].[title_ar], [n].[title_en]
FROM [notification_templates] AS [n]
WHERE [n].[Id] = @__Parse_0
2025-02-06 14:13:30.720 +03:00 [INF] Executed DbCommand (0ms) [Parameters=[@__Parse_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [n].[Id], [n].[additional_data], [n].[big_picture_url], [n].[Body], [n].[body_ar], [n].[body_en], [n].[created_at], [n].[expiry_at], [n].[large_icon_url], [n].[Route], [n].[target_criteria], [n].[Title], [n].[title_ar], [n].[title_en]
FROM [notification_templates] AS [n]
WHERE [n].[Id] = @__Parse_0
2025-02-06 14:13:30.721 +03:00 [INF] Executed DbCommand (0ms) [Parameters=[@__Parse_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [n].[Id], [n].[additional_data], [n].[big_picture_url], [n].[Body], [n].[body_ar], [n].[body_en], [n].[created_at], [n].[expiry_at], [n].[large_icon_url], [n].[Route], [n].[target_criteria], [n].[Title], [n].[title_ar], [n].[title_en]
FROM [notification_templates] AS [n]
WHERE [n].[Id] = @__Parse_0
2025-02-06 14:13:30.723 +03:00 [INF] Executed DbCommand (0ms) [Parameters=[@__Parse_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [n].[Id], [n].[additional_data], [n].[big_picture_url], [n].[Body], [n].[body_ar], [n].[body_en], [n].[created_at], [n].[expiry_at], [n].[large_icon_url], [n].[Route], [n].[target_criteria], [n].[Title], [n].[title_ar], [n].[title_en]
FROM [notification_templates] AS [n]
WHERE [n].[Id] = @__Parse_0
2025-02-06 14:13:30.725 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@__Parse_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [n].[Id], [n].[additional_data], [n].[big_picture_url], [n].[Body], [n].[body_ar], [n].[body_en], [n].[created_at], [n].[expiry_at], [n].[large_icon_url], [n].[Route], [n].[target_criteria], [n].[Title], [n].[title_ar], [n].[title_en]
FROM [notification_templates] AS [n]
WHERE [n].[Id] = @__Parse_0
2025-02-06 14:13:30.741 +03:00 [INF] Executed DbCommand (13ms) [Parameters=[@p0='?' (Size = 4000), @p1='?' (DbType = DateTime2), @p2='?' (Size = 4000), @p3='?' (Size = 4000), @p4='?' (Size = 4000), @p5='?' (Size = 450), @p6='?' (Size = 4000), @p7='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SET IMPLICIT_TRANSACTIONS OFF;
SET NOCOUNT ON;
INSERT INTO [AuthLogs] ([AuthType], [CreatedAt], [DeviceId], [FailureReason], [IpAddress], [NationalId], [Status], [UserAgent])
OUTPUT INSERTED.[Id]
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7);
2025-02-06 14:13:30.741 +03:00 [INF] Executed DbCommand (14ms) [Parameters=[@p0='?' (Size = 4000), @p1='?' (DbType = DateTime2), @p2='?' (Size = 4000), @p3='?' (Size = 4000), @p4='?' (Size = 4000), @p5='?' (Size = 450), @p6='?' (Size = 4000), @p7='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SET IMPLICIT_TRANSACTIONS OFF;
SET NOCOUNT ON;
INSERT INTO [AuthLogs] ([AuthType], [CreatedAt], [DeviceId], [FailureReason], [IpAddress], [NationalId], [Status], [UserAgent])
OUTPUT INSERTED.[Id]
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7);
2025-02-06 14:13:30.746 +03:00 [ERR] An exception occurred in the database while saving changes for context type 'NayifatAPI.Data.ApplicationDbContext'.
Microsoft.EntityFrameworkCore.DbUpdateException: An error occurred while saving the entity changes. See the inner exception for details.
 ---> Microsoft.Data.SqlClient.SqlException (0x80131904): The INSERT statement conflicted with the FOREIGN KEY constraint "FK_AuthLogs_Customers_NationalId". The conflict occurred in database "NayifatApp", table "dbo.Customers", column 'NationalId'.
   at Microsoft.Data.SqlClient.SqlConnection.OnError(SqlException exception, Boolean breakConnection, Action`1 wrapCloseInAction)
   at Microsoft.Data.SqlClient.SqlInternalConnection.OnError(SqlException exception, Boolean breakConnection, Action`1 wrapCloseInAction)
   at Microsoft.Data.SqlClient.TdsParser.ThrowExceptionAndWarning(TdsParserStateObject stateObj, Boolean callerHasConnectionLock, Boolean asyncClose)
   at Microsoft.Data.SqlClient.TdsParser.TryRun(RunBehavior runBehavior, SqlCommand cmdHandler, SqlDataReader dataStream, BulkCopySimpleResultSet bulkCopyHandler, TdsParserStateObject stateObj, Boolean& dataReady)
   at Microsoft.Data.SqlClient.SqlDataReader.TryHasMoreRows(Boolean& moreRows)
   at Microsoft.Data.SqlClient.SqlDataReader.TryReadInternal(Boolean setTimeout, Boolean& more)
   at Microsoft.Data.SqlClient.SqlDataReader.ReadAsyncExecute(Task task, Object state)
   at Microsoft.Data.SqlClient.SqlDataReader.InvokeAsyncCall[T](SqlDataReaderBaseAsyncCallContext`1 context)
--- End of stack trace from previous location ---
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeResultSetAsync(Int32 startCommandIndex, RelationalDataReader reader, CancellationToken cancellationToken)
ClientConnectionId:fcd336cd-d2a0-42ee-80de-222852601375
Error Number:547,State:0,Class:16
   --- End of inner exception stack trace ---
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeResultSetAsync(Int32 startCommandIndex, RelationalDataReader reader, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeAsync(RelationalDataReader reader, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Update.Internal.SqlServerModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(IList`1 entriesToSave, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(StateManager stateManager, Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Storage.Internal.SqlServerExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
Microsoft.EntityFrameworkCore.DbUpdateException: An error occurred while saving the entity changes. See the inner exception for details.
 ---> Microsoft.Data.SqlClient.SqlException (0x80131904): The INSERT statement conflicted with the FOREIGN KEY constraint "FK_AuthLogs_Customers_NationalId". The conflict occurred in database "NayifatApp", table "dbo.Customers", column 'NationalId'.
   at Microsoft.Data.SqlClient.SqlConnection.OnError(SqlException exception, Boolean breakConnection, Action`1 wrapCloseInAction)
   at Microsoft.Data.SqlClient.SqlInternalConnection.OnError(SqlException exception, Boolean breakConnection, Action`1 wrapCloseInAction)
   at Microsoft.Data.SqlClient.TdsParser.ThrowExceptionAndWarning(TdsParserStateObject stateObj, Boolean callerHasConnectionLock, Boolean asyncClose)
   at Microsoft.Data.SqlClient.TdsParser.TryRun(RunBehavior runBehavior, SqlCommand cmdHandler, SqlDataReader dataStream, BulkCopySimpleResultSet bulkCopyHandler, TdsParserStateObject stateObj, Boolean& dataReady)
   at Microsoft.Data.SqlClient.SqlDataReader.TryHasMoreRows(Boolean& moreRows)
   at Microsoft.Data.SqlClient.SqlDataReader.TryReadInternal(Boolean setTimeout, Boolean& more)
   at Microsoft.Data.SqlClient.SqlDataReader.ReadAsyncExecute(Task task, Object state)
   at Microsoft.Data.SqlClient.SqlDataReader.InvokeAsyncCall[T](SqlDataReaderBaseAsyncCallContext`1 context)
--- End of stack trace from previous location ---
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeResultSetAsync(Int32 startCommandIndex, RelationalDataReader reader, CancellationToken cancellationToken)
ClientConnectionId:fcd336cd-d2a0-42ee-80de-222852601375
Error Number:547,State:0,Class:16
   --- End of inner exception stack trace ---
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeResultSetAsync(Int32 startCommandIndex, RelationalDataReader reader, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeAsync(RelationalDataReader reader, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Update.Internal.SqlServerModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(IList`1 entriesToSave, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(StateManager stateManager, Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Storage.Internal.SqlServerExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
2025-02-06 14:13:30.751 +03:00 [ERR] An exception occurred in the database while saving changes for context type 'NayifatAPI.Data.ApplicationDbContext'.
Microsoft.EntityFrameworkCore.DbUpdateException: An error occurred while saving the entity changes. See the inner exception for details.
 ---> Microsoft.Data.SqlClient.SqlException (0x80131904): The INSERT statement conflicted with the FOREIGN KEY constraint "FK_AuthLogs_Customers_NationalId". The conflict occurred in database "NayifatApp", table "dbo.Customers", column 'NationalId'.
   at Microsoft.Data.SqlClient.SqlConnection.OnError(SqlException exception, Boolean breakConnection, Action`1 wrapCloseInAction)
   at Microsoft.Data.SqlClient.SqlInternalConnection.OnError(SqlException exception, Boolean breakConnection, Action`1 wrapCloseInAction)
   at Microsoft.Data.SqlClient.TdsParser.ThrowExceptionAndWarning(TdsParserStateObject stateObj, Boolean callerHasConnectionLock, Boolean asyncClose)
   at Microsoft.Data.SqlClient.TdsParser.TryRun(RunBehavior runBehavior, SqlCommand cmdHandler, SqlDataReader dataStream, BulkCopySimpleResultSet bulkCopyHandler, TdsParserStateObject stateObj, Boolean& dataReady)
   at Microsoft.Data.SqlClient.SqlDataReader.TryHasMoreRows(Boolean& moreRows)
   at Microsoft.Data.SqlClient.SqlDataReader.TryReadInternal(Boolean setTimeout, Boolean& more)
   at Microsoft.Data.SqlClient.SqlDataReader.ReadAsyncExecute(Task task, Object state)
   at Microsoft.Data.SqlClient.SqlDataReader.InvokeAsyncCall[T](SqlDataReaderBaseAsyncCallContext`1 context)
--- End of stack trace from previous location ---
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeResultSetAsync(Int32 startCommandIndex, RelationalDataReader reader, CancellationToken cancellationToken)
ClientConnectionId:bf727c6f-4310-43ba-83f8-e824e95b383e
Error Number:547,State:0,Class:16
   --- End of inner exception stack trace ---
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeResultSetAsync(Int32 startCommandIndex, RelationalDataReader reader, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeAsync(RelationalDataReader reader, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Update.Internal.SqlServerModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(IList`1 entriesToSave, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(StateManager stateManager, Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Storage.Internal.SqlServerExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
Microsoft.EntityFrameworkCore.DbUpdateException: An error occurred while saving the entity changes. See the inner exception for details.
 ---> Microsoft.Data.SqlClient.SqlException (0x80131904): The INSERT statement conflicted with the FOREIGN KEY constraint "FK_AuthLogs_Customers_NationalId". The conflict occurred in database "NayifatApp", table "dbo.Customers", column 'NationalId'.
   at Microsoft.Data.SqlClient.SqlConnection.OnError(SqlException exception, Boolean breakConnection, Action`1 wrapCloseInAction)
   at Microsoft.Data.SqlClient.SqlInternalConnection.OnError(SqlException exception, Boolean breakConnection, Action`1 wrapCloseInAction)
   at Microsoft.Data.SqlClient.TdsParser.ThrowExceptionAndWarning(TdsParserStateObject stateObj, Boolean callerHasConnectionLock, Boolean asyncClose)
   at Microsoft.Data.SqlClient.TdsParser.TryRun(RunBehavior runBehavior, SqlCommand cmdHandler, SqlDataReader dataStream, BulkCopySimpleResultSet bulkCopyHandler, TdsParserStateObject stateObj, Boolean& dataReady)
   at Microsoft.Data.SqlClient.SqlDataReader.TryHasMoreRows(Boolean& moreRows)
   at Microsoft.Data.SqlClient.SqlDataReader.TryReadInternal(Boolean setTimeout, Boolean& more)
   at Microsoft.Data.SqlClient.SqlDataReader.ReadAsyncExecute(Task task, Object state)
   at Microsoft.Data.SqlClient.SqlDataReader.InvokeAsyncCall[T](SqlDataReaderBaseAsyncCallContext`1 context)
--- End of stack trace from previous location ---
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeResultSetAsync(Int32 startCommandIndex, RelationalDataReader reader, CancellationToken cancellationToken)
ClientConnectionId:bf727c6f-4310-43ba-83f8-e824e95b383e
Error Number:547,State:0,Class:16
   --- End of inner exception stack trace ---
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeResultSetAsync(Int32 startCommandIndex, RelationalDataReader reader, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeAsync(RelationalDataReader reader, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Update.Internal.SqlServerModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(IList`1 entriesToSave, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(StateManager stateManager, Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Storage.Internal.SqlServerExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
2025-02-06 14:13:30.773 +03:00 [ERR] Error logging audit event. NationalId: all, Action: notification_delivered, Details: {"notification_count":21,"notification_ids":[38,37,36,35,34,33,32,31,30,29,28,27,26,25,24,23,23,20,19,18,12],"timestamp":"2025-02-06T14:13:30.644669"}
Microsoft.EntityFrameworkCore.DbUpdateException: An error occurred while saving the entity changes. See the inner exception for details.
 ---> Microsoft.Data.SqlClient.SqlException (0x80131904): The INSERT statement conflicted with the FOREIGN KEY constraint "FK_AuthLogs_Customers_NationalId". The conflict occurred in database "NayifatApp", table "dbo.Customers", column 'NationalId'.
   at Microsoft.Data.SqlClient.SqlConnection.OnError(SqlException exception, Boolean breakConnection, Action`1 wrapCloseInAction)
   at Microsoft.Data.SqlClient.SqlInternalConnection.OnError(SqlException exception, Boolean breakConnection, Action`1 wrapCloseInAction)
   at Microsoft.Data.SqlClient.TdsParser.ThrowExceptionAndWarning(TdsParserStateObject stateObj, Boolean callerHasConnectionLock, Boolean asyncClose)
   at Microsoft.Data.SqlClient.TdsParser.TryRun(RunBehavior runBehavior, SqlCommand cmdHandler, SqlDataReader dataStream, BulkCopySimpleResultSet bulkCopyHandler, TdsParserStateObject stateObj, Boolean& dataReady)
   at Microsoft.Data.SqlClient.SqlDataReader.TryHasMoreRows(Boolean& moreRows)
   at Microsoft.Data.SqlClient.SqlDataReader.TryReadInternal(Boolean setTimeout, Boolean& more)
   at Microsoft.Data.SqlClient.SqlDataReader.ReadAsyncExecute(Task task, Object state)
   at Microsoft.Data.SqlClient.SqlDataReader.InvokeAsyncCall[T](SqlDataReaderBaseAsyncCallContext`1 context)
--- End of stack trace from previous location ---
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeResultSetAsync(Int32 startCommandIndex, RelationalDataReader reader, CancellationToken cancellationToken)
ClientConnectionId:fcd336cd-d2a0-42ee-80de-222852601375
Error Number:547,State:0,Class:16
   --- End of inner exception stack trace ---
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeResultSetAsync(Int32 startCommandIndex, RelationalDataReader reader, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeAsync(RelationalDataReader reader, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Update.Internal.SqlServerModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(IList`1 entriesToSave, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(StateManager stateManager, Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Storage.Internal.SqlServerExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at NayifatAPI.Services.AuditLogService.LogAsync(String nationalId, String action, Object details) in C:\Users\yamta\StudioProjects\nayifat_app_2025_new\NayifatAPI\Services\AuditLogService.cs:line 36
2025-02-06 14:13:30.792 +03:00 [ERR] Error logging audit event. NationalId: all, Action: notification_delivered, Details: {"notification_count":21,"notification_ids":[38,37,36,35,34,33,32,31,30,29,28,27,26,25,24,23,23,20,19,18,12],"timestamp":"2025-02-06T14:13:30.6431438"}
Microsoft.EntityFrameworkCore.DbUpdateException: An error occurred while saving the entity changes. See the inner exception for details.
 ---> Microsoft.Data.SqlClient.SqlException (0x80131904): The INSERT statement conflicted with the FOREIGN KEY constraint "FK_AuthLogs_Customers_NationalId". The conflict occurred in database "NayifatApp", table "dbo.Customers", column 'NationalId'.
   at Microsoft.Data.SqlClient.SqlConnection.OnError(SqlException exception, Boolean breakConnection, Action`1 wrapCloseInAction)
   at Microsoft.Data.SqlClient.SqlInternalConnection.OnError(SqlException exception, Boolean breakConnection, Action`1 wrapCloseInAction)
   at Microsoft.Data.SqlClient.TdsParser.ThrowExceptionAndWarning(TdsParserStateObject stateObj, Boolean callerHasConnectionLock, Boolean asyncClose)
   at Microsoft.Data.SqlClient.TdsParser.TryRun(RunBehavior runBehavior, SqlCommand cmdHandler, SqlDataReader dataStream, BulkCopySimpleResultSet bulkCopyHandler, TdsParserStateObject stateObj, Boolean& dataReady)
   at Microsoft.Data.SqlClient.SqlDataReader.TryHasMoreRows(Boolean& moreRows)
   at Microsoft.Data.SqlClient.SqlDataReader.TryReadInternal(Boolean setTimeout, Boolean& more)
   at Microsoft.Data.SqlClient.SqlDataReader.ReadAsyncExecute(Task task, Object state)
   at Microsoft.Data.SqlClient.SqlDataReader.InvokeAsyncCall[T](SqlDataReaderBaseAsyncCallContext`1 context)
--- End of stack trace from previous location ---
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeResultSetAsync(Int32 startCommandIndex, RelationalDataReader reader, CancellationToken cancellationToken)
ClientConnectionId:bf727c6f-4310-43ba-83f8-e824e95b383e
Error Number:547,State:0,Class:16
   --- End of inner exception stack trace ---
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeResultSetAsync(Int32 startCommandIndex, RelationalDataReader reader, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeAsync(RelationalDataReader reader, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Update.Internal.SqlServerModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(IList`1 entriesToSave, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(StateManager stateManager, Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Storage.Internal.SqlServerExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at NayifatAPI.Services.AuditLogService.LogAsync(String nationalId, String action, Object details) in C:\Users\yamta\StudioProjects\nayifat_app_2025_new\NayifatAPI\Services\AuditLogService.cs:line 36
2025-02-06 14:13:30.801 +03:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType11`2[[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Object, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-02-06 14:13:30.809 +03:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType11`2[[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Object, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-02-06 14:13:30.810 +03:00 [INF] Executed action NayifatAPI.Controllers.NotificationsController.GetNotifications (NayifatAPI) in 179.0965ms
2025-02-06 14:13:30.811 +03:00 [INF] Executed action NayifatAPI.Controllers.NotificationsController.GetNotifications (NayifatAPI) in 175.6731ms
2025-02-06 14:13:30.812 +03:00 [INF] Executed endpoint 'NayifatAPI.Controllers.NotificationsController.GetNotifications (NayifatAPI)'
2025-02-06 14:13:30.813 +03:00 [INF] Executed endpoint 'NayifatAPI.Controllers.NotificationsController.GetNotifications (NayifatAPI)'
2025-02-06 14:13:30.814 +03:00 [INF] Request finished HTTP/1.1 POST http://eb3c-46-152-255-232.ngrok-free.app/api/notifications/list - 200 null application/json; charset=utf-8 192.3724ms
2025-02-06 14:13:30.815 +03:00 [INF] Request finished HTTP/1.1 POST http://eb3c-46-152-255-232.ngrok-free.app/api/notifications/list - 200 null application/json; charset=utf-8 195.411ms
2025-02-06 14:13:30.898 +03:00 [INF] Request starting HTTP/1.1 POST http://eb3c-46-152-255-232.ngrok-free.app/api/notifications/list - application/json; charset=utf-8 39
2025-02-06 14:13:30.898 +03:00 [INF] Request starting HTTP/1.1 POST http://eb3c-46-152-255-232.ngrok-free.app/api/notifications/list - application/json; charset=utf-8 39
2025-02-06 14:13:30.902 +03:00 [INF] Executing endpoint 'NayifatAPI.Controllers.NotificationsController.GetNotifications (NayifatAPI)'
2025-02-06 14:13:30.904 +03:00 [INF] Executing endpoint 'NayifatAPI.Controllers.NotificationsController.GetNotifications (NayifatAPI)'
2025-02-06 14:13:30.904 +03:00 [INF] Route matched with {action = "GetNotifications", controller = "Notifications"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetNotifications(NayifatAPI.Controllers.GetNotificationsRequest) on controller NayifatAPI.Controllers.NotificationsController (NayifatAPI).
2025-02-06 14:13:30.905 +03:00 [INF] Route matched with {action = "GetNotifications", controller = "Notifications"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetNotifications(NayifatAPI.Controllers.GetNotificationsRequest) on controller NayifatAPI.Controllers.NotificationsController (NayifatAPI).
2025-02-06 14:13:30.925 +03:00 [INF] Executed DbCommand (13ms) [Parameters=[@__providedApiKey_0='?' (Size = 255)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [a].[api_Key], [a].[CreatedAt], [a].[Description], [a].[ExpiresAt], [a].[IsActive], [a].[LastUsedAt]
FROM [ApiKeys] AS [a]
WHERE [a].[api_Key] = @__providedApiKey_0 AND [a].[IsActive] = CAST(1 AS bit)
2025-02-06 14:13:30.925 +03:00 [INF] Executed DbCommand (14ms) [Parameters=[@__providedApiKey_0='?' (Size = 255)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [a].[api_Key], [a].[CreatedAt], [a].[Description], [a].[ExpiresAt], [a].[IsActive], [a].[LastUsedAt]
FROM [ApiKeys] AS [a]
WHERE [a].[api_Key] = @__providedApiKey_0 AND [a].[IsActive] = CAST(1 AS bit)
2025-02-06 14:13:30.929 +03:00 [INF] Executed DbCommand (0ms) [Parameters=[@__request_NationalId_0='?' (Size = 450)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [u].[national_id], [u].[last_updated], [u].[notifications]
FROM [user_notifications] AS [u]
WHERE [u].[national_id] = @__request_NationalId_0
2025-02-06 14:13:30.931 +03:00 [INF] Executed DbCommand (0ms) [Parameters=[@__request_NationalId_0='?' (Size = 450)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [u].[national_id], [u].[last_updated], [u].[notifications]
FROM [user_notifications] AS [u]
WHERE [u].[national_id] = @__request_NationalId_0
2025-02-06 14:13:30.937 +03:00 [INF] Executed DbCommand (0ms) [Parameters=[@__Parse_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [n].[Id], [n].[additional_data], [n].[big_picture_url], [n].[Body], [n].[body_ar], [n].[body_en], [n].[created_at], [n].[expiry_at], [n].[large_icon_url], [n].[Route], [n].[target_criteria], [n].[Title], [n].[title_ar], [n].[title_en]
FROM [notification_templates] AS [n]
WHERE [n].[Id] = @__Parse_0
2025-02-06 14:13:30.938 +03:00 [INF] Executed DbCommand (5ms) [Parameters=[@__Parse_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [n].[Id], [n].[additional_data], [n].[big_picture_url], [n].[Body], [n].[body_ar], [n].[body_en], [n].[created_at], [n].[expiry_at], [n].[large_icon_url], [n].[Route], [n].[target_criteria], [n].[Title], [n].[title_ar], [n].[title_en]
FROM [notification_templates] AS [n]
WHERE [n].[Id] = @__Parse_0
2025-02-06 14:13:30.940 +03:00 [INF] Executed DbCommand (0ms) [Parameters=[@__Parse_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [n].[Id], [n].[additional_data], [n].[big_picture_url], [n].[Body], [n].[body_ar], [n].[body_en], [n].[created_at], [n].[expiry_at], [n].[large_icon_url], [n].[Route], [n].[target_criteria], [n].[Title], [n].[title_ar], [n].[title_en]
FROM [notification_templates] AS [n]
WHERE [n].[Id] = @__Parse_0
2025-02-06 14:13:30.943 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@__Parse_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [n].[Id], [n].[additional_data], [n].[big_picture_url], [n].[Body], [n].[body_ar], [n].[body_en], [n].[created_at], [n].[expiry_at], [n].[large_icon_url], [n].[Route], [n].[target_criteria], [n].[Title], [n].[title_ar], [n].[title_en]
FROM [notification_templates] AS [n]
WHERE [n].[Id] = @__Parse_0
2025-02-06 14:13:30.946 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@__Parse_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [n].[Id], [n].[additional_data], [n].[big_picture_url], [n].[Body], [n].[body_ar], [n].[body_en], [n].[created_at], [n].[expiry_at], [n].[large_icon_url], [n].[Route], [n].[target_criteria], [n].[Title], [n].[title_ar], [n].[title_en]
FROM [notification_templates] AS [n]
WHERE [n].[Id] = @__Parse_0
2025-02-06 14:13:30.949 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@__Parse_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [n].[Id], [n].[additional_data], [n].[big_picture_url], [n].[Body], [n].[body_ar], [n].[body_en], [n].[created_at], [n].[expiry_at], [n].[large_icon_url], [n].[Route], [n].[target_criteria], [n].[Title], [n].[title_ar], [n].[title_en]
FROM [notification_templates] AS [n]
WHERE [n].[Id] = @__Parse_0
2025-02-06 14:13:30.951 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@__Parse_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [n].[Id], [n].[additional_data], [n].[big_picture_url], [n].[Body], [n].[body_ar], [n].[body_en], [n].[created_at], [n].[expiry_at], [n].[large_icon_url], [n].[Route], [n].[target_criteria], [n].[Title], [n].[title_ar], [n].[title_en]
FROM [notification_templates] AS [n]
WHERE [n].[Id] = @__Parse_0
2025-02-06 14:13:30.953 +03:00 [INF] Executed DbCommand (0ms) [Parameters=[@__Parse_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [n].[Id], [n].[additional_data], [n].[big_picture_url], [n].[Body], [n].[body_ar], [n].[body_en], [n].[created_at], [n].[expiry_at], [n].[large_icon_url], [n].[Route], [n].[target_criteria], [n].[Title], [n].[title_ar], [n].[title_en]
FROM [notification_templates] AS [n]
WHERE [n].[Id] = @__Parse_0
2025-02-06 14:13:30.956 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@__Parse_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [n].[Id], [n].[additional_data], [n].[big_picture_url], [n].[Body], [n].[body_ar], [n].[body_en], [n].[created_at], [n].[expiry_at], [n].[large_icon_url], [n].[Route], [n].[target_criteria], [n].[Title], [n].[title_ar], [n].[title_en]
FROM [notification_templates] AS [n]
WHERE [n].[Id] = @__Parse_0
2025-02-06 14:13:30.959 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@__Parse_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [n].[Id], [n].[additional_data], [n].[big_picture_url], [n].[Body], [n].[body_ar], [n].[body_en], [n].[created_at], [n].[expiry_at], [n].[large_icon_url], [n].[Route], [n].[target_criteria], [n].[Title], [n].[title_ar], [n].[title_en]
FROM [notification_templates] AS [n]
WHERE [n].[Id] = @__Parse_0
2025-02-06 14:13:30.962 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@__Parse_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [n].[Id], [n].[additional_data], [n].[big_picture_url], [n].[Body], [n].[body_ar], [n].[body_en], [n].[created_at], [n].[expiry_at], [n].[large_icon_url], [n].[Route], [n].[target_criteria], [n].[Title], [n].[title_ar], [n].[title_en]
FROM [notification_templates] AS [n]
WHERE [n].[Id] = @__Parse_0
2025-02-06 14:13:30.964 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@__Parse_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [n].[Id], [n].[additional_data], [n].[big_picture_url], [n].[Body], [n].[body_ar], [n].[body_en], [n].[created_at], [n].[expiry_at], [n].[large_icon_url], [n].[Route], [n].[target_criteria], [n].[Title], [n].[title_ar], [n].[title_en]
FROM [notification_templates] AS [n]
WHERE [n].[Id] = @__Parse_0
2025-02-06 14:13:30.967 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@__Parse_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [n].[Id], [n].[additional_data], [n].[big_picture_url], [n].[Body], [n].[body_ar], [n].[body_en], [n].[created_at], [n].[expiry_at], [n].[large_icon_url], [n].[Route], [n].[target_criteria], [n].[Title], [n].[title_ar], [n].[title_en]
FROM [notification_templates] AS [n]
WHERE [n].[Id] = @__Parse_0
2025-02-06 14:13:30.970 +03:00 [INF] Executed DbCommand (0ms) [Parameters=[@__Parse_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [n].[Id], [n].[additional_data], [n].[big_picture_url], [n].[Body], [n].[body_ar], [n].[body_en], [n].[created_at], [n].[expiry_at], [n].[large_icon_url], [n].[Route], [n].[target_criteria], [n].[Title], [n].[title_ar], [n].[title_en]
FROM [notification_templates] AS [n]
WHERE [n].[Id] = @__Parse_0
2025-02-06 14:13:30.973 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@__Parse_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [n].[Id], [n].[additional_data], [n].[big_picture_url], [n].[Body], [n].[body_ar], [n].[body_en], [n].[created_at], [n].[expiry_at], [n].[large_icon_url], [n].[Route], [n].[target_criteria], [n].[Title], [n].[title_ar], [n].[title_en]
FROM [notification_templates] AS [n]
WHERE [n].[Id] = @__Parse_0
2025-02-06 14:13:30.976 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@__Parse_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [n].[Id], [n].[additional_data], [n].[big_picture_url], [n].[Body], [n].[body_ar], [n].[body_en], [n].[created_at], [n].[expiry_at], [n].[large_icon_url], [n].[Route], [n].[target_criteria], [n].[Title], [n].[title_ar], [n].[title_en]
FROM [notification_templates] AS [n]
WHERE [n].[Id] = @__Parse_0
2025-02-06 14:13:30.978 +03:00 [INF] Executed DbCommand (0ms) [Parameters=[@__Parse_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [n].[Id], [n].[additional_data], [n].[big_picture_url], [n].[Body], [n].[body_ar], [n].[body_en], [n].[created_at], [n].[expiry_at], [n].[large_icon_url], [n].[Route], [n].[target_criteria], [n].[Title], [n].[title_ar], [n].[title_en]
FROM [notification_templates] AS [n]
WHERE [n].[Id] = @__Parse_0
2025-02-06 14:13:30.981 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@__Parse_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [n].[Id], [n].[additional_data], [n].[big_picture_url], [n].[Body], [n].[body_ar], [n].[body_en], [n].[created_at], [n].[expiry_at], [n].[large_icon_url], [n].[Route], [n].[target_criteria], [n].[Title], [n].[title_ar], [n].[title_en]
FROM [notification_templates] AS [n]
WHERE [n].[Id] = @__Parse_0
2025-02-06 14:13:30.983 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@__Parse_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [n].[Id], [n].[additional_data], [n].[big_picture_url], [n].[Body], [n].[body_ar], [n].[body_en], [n].[created_at], [n].[expiry_at], [n].[large_icon_url], [n].[Route], [n].[target_criteria], [n].[Title], [n].[title_ar], [n].[title_en]
FROM [notification_templates] AS [n]
WHERE [n].[Id] = @__Parse_0
2025-02-06 14:13:30.985 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@__Parse_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [n].[Id], [n].[additional_data], [n].[big_picture_url], [n].[Body], [n].[body_ar], [n].[body_en], [n].[created_at], [n].[expiry_at], [n].[large_icon_url], [n].[Route], [n].[target_criteria], [n].[Title], [n].[title_ar], [n].[title_en]
FROM [notification_templates] AS [n]
WHERE [n].[Id] = @__Parse_0
2025-02-06 14:13:30.986 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@__Parse_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [n].[Id], [n].[additional_data], [n].[big_picture_url], [n].[Body], [n].[body_ar], [n].[body_en], [n].[created_at], [n].[expiry_at], [n].[large_icon_url], [n].[Route], [n].[target_criteria], [n].[Title], [n].[title_ar], [n].[title_en]
FROM [notification_templates] AS [n]
WHERE [n].[Id] = @__Parse_0
2025-02-06 14:13:30.988 +03:00 [INF] Executed DbCommand (0ms) [Parameters=[@__Parse_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [n].[Id], [n].[additional_data], [n].[big_picture_url], [n].[Body], [n].[body_ar], [n].[body_en], [n].[created_at], [n].[expiry_at], [n].[large_icon_url], [n].[Route], [n].[target_criteria], [n].[Title], [n].[title_ar], [n].[title_en]
FROM [notification_templates] AS [n]
WHERE [n].[Id] = @__Parse_0
2025-02-06 14:13:30.989 +03:00 [INF] Executed DbCommand (0ms) [Parameters=[@__Parse_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [n].[Id], [n].[additional_data], [n].[big_picture_url], [n].[Body], [n].[body_ar], [n].[body_en], [n].[created_at], [n].[expiry_at], [n].[large_icon_url], [n].[Route], [n].[target_criteria], [n].[Title], [n].[title_ar], [n].[title_en]
FROM [notification_templates] AS [n]
WHERE [n].[Id] = @__Parse_0
2025-02-06 14:13:30.991 +03:00 [INF] Executed DbCommand (0ms) [Parameters=[@__Parse_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [n].[Id], [n].[additional_data], [n].[big_picture_url], [n].[Body], [n].[body_ar], [n].[body_en], [n].[created_at], [n].[expiry_at], [n].[large_icon_url], [n].[Route], [n].[target_criteria], [n].[Title], [n].[title_ar], [n].[title_en]
FROM [notification_templates] AS [n]
WHERE [n].[Id] = @__Parse_0
2025-02-06 14:13:30.994 +03:00 [INF] Executed DbCommand (0ms) [Parameters=[@__Parse_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [n].[Id], [n].[additional_data], [n].[big_picture_url], [n].[Body], [n].[body_ar], [n].[body_en], [n].[created_at], [n].[expiry_at], [n].[large_icon_url], [n].[Route], [n].[target_criteria], [n].[Title], [n].[title_ar], [n].[title_en]
FROM [notification_templates] AS [n]
WHERE [n].[Id] = @__Parse_0
2025-02-06 14:13:30.996 +03:00 [INF] Executed DbCommand (0ms) [Parameters=[@__Parse_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [n].[Id], [n].[additional_data], [n].[big_picture_url], [n].[Body], [n].[body_ar], [n].[body_en], [n].[created_at], [n].[expiry_at], [n].[large_icon_url], [n].[Route], [n].[target_criteria], [n].[Title], [n].[title_ar], [n].[title_en]
FROM [notification_templates] AS [n]
WHERE [n].[Id] = @__Parse_0
2025-02-06 14:13:30.998 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@__Parse_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [n].[Id], [n].[additional_data], [n].[big_picture_url], [n].[Body], [n].[body_ar], [n].[body_en], [n].[created_at], [n].[expiry_at], [n].[large_icon_url], [n].[Route], [n].[target_criteria], [n].[Title], [n].[title_ar], [n].[title_en]
FROM [notification_templates] AS [n]
WHERE [n].[Id] = @__Parse_0
2025-02-06 14:13:30.999 +03:00 [INF] Executed DbCommand (0ms) [Parameters=[@__Parse_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [n].[Id], [n].[additional_data], [n].[big_picture_url], [n].[Body], [n].[body_ar], [n].[body_en], [n].[created_at], [n].[expiry_at], [n].[large_icon_url], [n].[Route], [n].[target_criteria], [n].[Title], [n].[title_ar], [n].[title_en]
FROM [notification_templates] AS [n]
WHERE [n].[Id] = @__Parse_0
2025-02-06 14:13:31.001 +03:00 [INF] Executed DbCommand (0ms) [Parameters=[@__Parse_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [n].[Id], [n].[additional_data], [n].[big_picture_url], [n].[Body], [n].[body_ar], [n].[body_en], [n].[created_at], [n].[expiry_at], [n].[large_icon_url], [n].[Route], [n].[target_criteria], [n].[Title], [n].[title_ar], [n].[title_en]
FROM [notification_templates] AS [n]
WHERE [n].[Id] = @__Parse_0
2025-02-06 14:13:31.003 +03:00 [INF] Executed DbCommand (0ms) [Parameters=[@__Parse_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [n].[Id], [n].[additional_data], [n].[big_picture_url], [n].[Body], [n].[body_ar], [n].[body_en], [n].[created_at], [n].[expiry_at], [n].[large_icon_url], [n].[Route], [n].[target_criteria], [n].[Title], [n].[title_ar], [n].[title_en]
FROM [notification_templates] AS [n]
WHERE [n].[Id] = @__Parse_0
2025-02-06 14:13:31.004 +03:00 [INF] Executed DbCommand (0ms) [Parameters=[@__Parse_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [n].[Id], [n].[additional_data], [n].[big_picture_url], [n].[Body], [n].[body_ar], [n].[body_en], [n].[created_at], [n].[expiry_at], [n].[large_icon_url], [n].[Route], [n].[target_criteria], [n].[Title], [n].[title_ar], [n].[title_en]
FROM [notification_templates] AS [n]
WHERE [n].[Id] = @__Parse_0
2025-02-06 14:13:31.008 +03:00 [INF] Executed DbCommand (0ms) [Parameters=[@__Parse_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [n].[Id], [n].[additional_data], [n].[big_picture_url], [n].[Body], [n].[body_ar], [n].[body_en], [n].[created_at], [n].[expiry_at], [n].[large_icon_url], [n].[Route], [n].[target_criteria], [n].[Title], [n].[title_ar], [n].[title_en]
FROM [notification_templates] AS [n]
WHERE [n].[Id] = @__Parse_0
2025-02-06 14:13:31.010 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@__Parse_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [n].[Id], [n].[additional_data], [n].[big_picture_url], [n].[Body], [n].[body_ar], [n].[body_en], [n].[created_at], [n].[expiry_at], [n].[large_icon_url], [n].[Route], [n].[target_criteria], [n].[Title], [n].[title_ar], [n].[title_en]
FROM [notification_templates] AS [n]
WHERE [n].[Id] = @__Parse_0
2025-02-06 14:13:31.013 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@__Parse_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [n].[Id], [n].[additional_data], [n].[big_picture_url], [n].[Body], [n].[body_ar], [n].[body_en], [n].[created_at], [n].[expiry_at], [n].[large_icon_url], [n].[Route], [n].[target_criteria], [n].[Title], [n].[title_ar], [n].[title_en]
FROM [notification_templates] AS [n]
WHERE [n].[Id] = @__Parse_0
2025-02-06 14:13:31.014 +03:00 [INF] Executed DbCommand (0ms) [Parameters=[@__Parse_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [n].[Id], [n].[additional_data], [n].[big_picture_url], [n].[Body], [n].[body_ar], [n].[body_en], [n].[created_at], [n].[expiry_at], [n].[large_icon_url], [n].[Route], [n].[target_criteria], [n].[Title], [n].[title_ar], [n].[title_en]
FROM [notification_templates] AS [n]
WHERE [n].[Id] = @__Parse_0
2025-02-06 14:13:31.016 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@__Parse_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [n].[Id], [n].[additional_data], [n].[big_picture_url], [n].[Body], [n].[body_ar], [n].[body_en], [n].[created_at], [n].[expiry_at], [n].[large_icon_url], [n].[Route], [n].[target_criteria], [n].[Title], [n].[title_ar], [n].[title_en]
FROM [notification_templates] AS [n]
WHERE [n].[Id] = @__Parse_0
2025-02-06 14:13:31.018 +03:00 [INF] Executed DbCommand (0ms) [Parameters=[@__Parse_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [n].[Id], [n].[additional_data], [n].[big_picture_url], [n].[Body], [n].[body_ar], [n].[body_en], [n].[created_at], [n].[expiry_at], [n].[large_icon_url], [n].[Route], [n].[target_criteria], [n].[Title], [n].[title_ar], [n].[title_en]
FROM [notification_templates] AS [n]
WHERE [n].[Id] = @__Parse_0
2025-02-06 14:13:31.020 +03:00 [INF] Executed DbCommand (0ms) [Parameters=[@__Parse_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [n].[Id], [n].[additional_data], [n].[big_picture_url], [n].[Body], [n].[body_ar], [n].[body_en], [n].[created_at], [n].[expiry_at], [n].[large_icon_url], [n].[Route], [n].[target_criteria], [n].[Title], [n].[title_ar], [n].[title_en]
FROM [notification_templates] AS [n]
WHERE [n].[Id] = @__Parse_0
2025-02-06 14:13:31.023 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@__Parse_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [n].[Id], [n].[additional_data], [n].[big_picture_url], [n].[Body], [n].[body_ar], [n].[body_en], [n].[created_at], [n].[expiry_at], [n].[large_icon_url], [n].[Route], [n].[target_criteria], [n].[Title], [n].[title_ar], [n].[title_en]
FROM [notification_templates] AS [n]
WHERE [n].[Id] = @__Parse_0
2025-02-06 14:13:31.025 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@__Parse_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [n].[Id], [n].[additional_data], [n].[big_picture_url], [n].[Body], [n].[body_ar], [n].[body_en], [n].[created_at], [n].[expiry_at], [n].[large_icon_url], [n].[Route], [n].[target_criteria], [n].[Title], [n].[title_ar], [n].[title_en]
FROM [notification_templates] AS [n]
WHERE [n].[Id] = @__Parse_0
2025-02-06 14:13:31.027 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@__Parse_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [n].[Id], [n].[additional_data], [n].[big_picture_url], [n].[Body], [n].[body_ar], [n].[body_en], [n].[created_at], [n].[expiry_at], [n].[large_icon_url], [n].[Route], [n].[target_criteria], [n].[Title], [n].[title_ar], [n].[title_en]
FROM [notification_templates] AS [n]
WHERE [n].[Id] = @__Parse_0
2025-02-06 14:13:31.031 +03:00 [INF] Executed DbCommand (2ms) [Parameters=[@p0='?' (Size = 4000), @p1='?' (DbType = DateTime2), @p2='?' (Size = 4000), @p3='?' (Size = 4000), @p4='?' (Size = 4000), @p5='?' (Size = 450), @p6='?' (Size = 4000), @p7='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SET IMPLICIT_TRANSACTIONS OFF;
SET NOCOUNT ON;
INSERT INTO [AuthLogs] ([AuthType], [CreatedAt], [DeviceId], [FailureReason], [IpAddress], [NationalId], [Status], [UserAgent])
OUTPUT INSERTED.[Id]
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7);
2025-02-06 14:13:31.032 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@__Parse_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [n].[Id], [n].[additional_data], [n].[big_picture_url], [n].[Body], [n].[body_ar], [n].[body_en], [n].[created_at], [n].[expiry_at], [n].[large_icon_url], [n].[Route], [n].[target_criteria], [n].[Title], [n].[title_ar], [n].[title_en]
FROM [notification_templates] AS [n]
WHERE [n].[Id] = @__Parse_0
2025-02-06 14:13:31.035 +03:00 [ERR] An exception occurred in the database while saving changes for context type 'NayifatAPI.Data.ApplicationDbContext'.
Microsoft.EntityFrameworkCore.DbUpdateException: An error occurred while saving the entity changes. See the inner exception for details.
 ---> Microsoft.Data.SqlClient.SqlException (0x80131904): The INSERT statement conflicted with the FOREIGN KEY constraint "FK_AuthLogs_Customers_NationalId". The conflict occurred in database "NayifatApp", table "dbo.Customers", column 'NationalId'.
   at Microsoft.Data.SqlClient.SqlConnection.OnError(SqlException exception, Boolean breakConnection, Action`1 wrapCloseInAction)
   at Microsoft.Data.SqlClient.SqlInternalConnection.OnError(SqlException exception, Boolean breakConnection, Action`1 wrapCloseInAction)
   at Microsoft.Data.SqlClient.TdsParser.ThrowExceptionAndWarning(TdsParserStateObject stateObj, Boolean callerHasConnectionLock, Boolean asyncClose)
   at Microsoft.Data.SqlClient.TdsParser.TryRun(RunBehavior runBehavior, SqlCommand cmdHandler, SqlDataReader dataStream, BulkCopySimpleResultSet bulkCopyHandler, TdsParserStateObject stateObj, Boolean& dataReady)
   at Microsoft.Data.SqlClient.SqlDataReader.TryHasMoreRows(Boolean& moreRows)
   at Microsoft.Data.SqlClient.SqlDataReader.TryReadInternal(Boolean setTimeout, Boolean& more)
   at Microsoft.Data.SqlClient.SqlDataReader.ReadAsyncExecute(Task task, Object state)
   at Microsoft.Data.SqlClient.SqlDataReader.InvokeAsyncCall[T](SqlDataReaderBaseAsyncCallContext`1 context)
--- End of stack trace from previous location ---
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeResultSetAsync(Int32 startCommandIndex, RelationalDataReader reader, CancellationToken cancellationToken)
ClientConnectionId:bf727c6f-4310-43ba-83f8-e824e95b383e
Error Number:547,State:0,Class:16
   --- End of inner exception stack trace ---
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeResultSetAsync(Int32 startCommandIndex, RelationalDataReader reader, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeAsync(RelationalDataReader reader, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Update.Internal.SqlServerModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(IList`1 entriesToSave, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(StateManager stateManager, Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Storage.Internal.SqlServerExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
Microsoft.EntityFrameworkCore.DbUpdateException: An error occurred while saving the entity changes. See the inner exception for details.
 ---> Microsoft.Data.SqlClient.SqlException (0x80131904): The INSERT statement conflicted with the FOREIGN KEY constraint "FK_AuthLogs_Customers_NationalId". The conflict occurred in database "NayifatApp", table "dbo.Customers", column 'NationalId'.
   at Microsoft.Data.SqlClient.SqlConnection.OnError(SqlException exception, Boolean breakConnection, Action`1 wrapCloseInAction)
   at Microsoft.Data.SqlClient.SqlInternalConnection.OnError(SqlException exception, Boolean breakConnection, Action`1 wrapCloseInAction)
   at Microsoft.Data.SqlClient.TdsParser.ThrowExceptionAndWarning(TdsParserStateObject stateObj, Boolean callerHasConnectionLock, Boolean asyncClose)
   at Microsoft.Data.SqlClient.TdsParser.TryRun(RunBehavior runBehavior, SqlCommand cmdHandler, SqlDataReader dataStream, BulkCopySimpleResultSet bulkCopyHandler, TdsParserStateObject stateObj, Boolean& dataReady)
   at Microsoft.Data.SqlClient.SqlDataReader.TryHasMoreRows(Boolean& moreRows)
   at Microsoft.Data.SqlClient.SqlDataReader.TryReadInternal(Boolean setTimeout, Boolean& more)
   at Microsoft.Data.SqlClient.SqlDataReader.ReadAsyncExecute(Task task, Object state)
   at Microsoft.Data.SqlClient.SqlDataReader.InvokeAsyncCall[T](SqlDataReaderBaseAsyncCallContext`1 context)
--- End of stack trace from previous location ---
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeResultSetAsync(Int32 startCommandIndex, RelationalDataReader reader, CancellationToken cancellationToken)
ClientConnectionId:bf727c6f-4310-43ba-83f8-e824e95b383e
Error Number:547,State:0,Class:16
   --- End of inner exception stack trace ---
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeResultSetAsync(Int32 startCommandIndex, RelationalDataReader reader, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeAsync(RelationalDataReader reader, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Update.Internal.SqlServerModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(IList`1 entriesToSave, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(StateManager stateManager, Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Storage.Internal.SqlServerExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
2025-02-06 14:13:31.038 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@p0='?' (Size = 4000), @p1='?' (DbType = DateTime2), @p2='?' (Size = 4000), @p3='?' (Size = 4000), @p4='?' (Size = 4000), @p5='?' (Size = 450), @p6='?' (Size = 4000), @p7='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SET IMPLICIT_TRANSACTIONS OFF;
SET NOCOUNT ON;
INSERT INTO [AuthLogs] ([AuthType], [CreatedAt], [DeviceId], [FailureReason], [IpAddress], [NationalId], [Status], [UserAgent])
OUTPUT INSERTED.[Id]
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7);
2025-02-06 14:13:31.053 +03:00 [ERR] Error logging audit event. NationalId: all, Action: notification_delivered, Details: {"notification_count":21,"notification_ids":[38,37,36,35,34,33,32,31,30,29,28,27,26,25,24,23,23,20,19,18,12],"timestamp":"2025-02-06T14:13:30.9366768"}
Microsoft.EntityFrameworkCore.DbUpdateException: An error occurred while saving the entity changes. See the inner exception for details.
 ---> Microsoft.Data.SqlClient.SqlException (0x80131904): The INSERT statement conflicted with the FOREIGN KEY constraint "FK_AuthLogs_Customers_NationalId". The conflict occurred in database "NayifatApp", table "dbo.Customers", column 'NationalId'.
   at Microsoft.Data.SqlClient.SqlConnection.OnError(SqlException exception, Boolean breakConnection, Action`1 wrapCloseInAction)
   at Microsoft.Data.SqlClient.SqlInternalConnection.OnError(SqlException exception, Boolean breakConnection, Action`1 wrapCloseInAction)
   at Microsoft.Data.SqlClient.TdsParser.ThrowExceptionAndWarning(TdsParserStateObject stateObj, Boolean callerHasConnectionLock, Boolean asyncClose)
   at Microsoft.Data.SqlClient.TdsParser.TryRun(RunBehavior runBehavior, SqlCommand cmdHandler, SqlDataReader dataStream, BulkCopySimpleResultSet bulkCopyHandler, TdsParserStateObject stateObj, Boolean& dataReady)
   at Microsoft.Data.SqlClient.SqlDataReader.TryHasMoreRows(Boolean& moreRows)
   at Microsoft.Data.SqlClient.SqlDataReader.TryReadInternal(Boolean setTimeout, Boolean& more)
   at Microsoft.Data.SqlClient.SqlDataReader.ReadAsyncExecute(Task task, Object state)
   at Microsoft.Data.SqlClient.SqlDataReader.InvokeAsyncCall[T](SqlDataReaderBaseAsyncCallContext`1 context)
--- End of stack trace from previous location ---
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeResultSetAsync(Int32 startCommandIndex, RelationalDataReader reader, CancellationToken cancellationToken)
ClientConnectionId:bf727c6f-4310-43ba-83f8-e824e95b383e
Error Number:547,State:0,Class:16
   --- End of inner exception stack trace ---
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeResultSetAsync(Int32 startCommandIndex, RelationalDataReader reader, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeAsync(RelationalDataReader reader, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Update.Internal.SqlServerModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(IList`1 entriesToSave, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(StateManager stateManager, Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Storage.Internal.SqlServerExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at NayifatAPI.Services.AuditLogService.LogAsync(String nationalId, String action, Object details) in C:\Users\yamta\StudioProjects\nayifat_app_2025_new\NayifatAPI\Services\AuditLogService.cs:line 36
2025-02-06 14:13:31.058 +03:00 [ERR] An exception occurred in the database while saving changes for context type 'NayifatAPI.Data.ApplicationDbContext'.
Microsoft.EntityFrameworkCore.DbUpdateException: An error occurred while saving the entity changes. See the inner exception for details.
 ---> Microsoft.Data.SqlClient.SqlException (0x80131904): The INSERT statement conflicted with the FOREIGN KEY constraint "FK_AuthLogs_Customers_NationalId". The conflict occurred in database "NayifatApp", table "dbo.Customers", column 'NationalId'.
   at Microsoft.Data.SqlClient.SqlConnection.OnError(SqlException exception, Boolean breakConnection, Action`1 wrapCloseInAction)
   at Microsoft.Data.SqlClient.SqlInternalConnection.OnError(SqlException exception, Boolean breakConnection, Action`1 wrapCloseInAction)
   at Microsoft.Data.SqlClient.TdsParser.ThrowExceptionAndWarning(TdsParserStateObject stateObj, Boolean callerHasConnectionLock, Boolean asyncClose)
   at Microsoft.Data.SqlClient.TdsParser.TryRun(RunBehavior runBehavior, SqlCommand cmdHandler, SqlDataReader dataStream, BulkCopySimpleResultSet bulkCopyHandler, TdsParserStateObject stateObj, Boolean& dataReady)
   at Microsoft.Data.SqlClient.SqlDataReader.TryHasMoreRows(Boolean& moreRows)
   at Microsoft.Data.SqlClient.SqlDataReader.TryReadInternal(Boolean setTimeout, Boolean& more)
   at Microsoft.Data.SqlClient.SqlDataReader.ReadAsyncExecute(Task task, Object state)
   at Microsoft.Data.SqlClient.SqlDataReader.InvokeAsyncCall[T](SqlDataReaderBaseAsyncCallContext`1 context)
--- End of stack trace from previous location ---
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeResultSetAsync(Int32 startCommandIndex, RelationalDataReader reader, CancellationToken cancellationToken)
ClientConnectionId:fcd336cd-d2a0-42ee-80de-222852601375
Error Number:547,State:0,Class:16
   --- End of inner exception stack trace ---
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeResultSetAsync(Int32 startCommandIndex, RelationalDataReader reader, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeAsync(RelationalDataReader reader, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Update.Internal.SqlServerModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(IList`1 entriesToSave, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(StateManager stateManager, Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Storage.Internal.SqlServerExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
Microsoft.EntityFrameworkCore.DbUpdateException: An error occurred while saving the entity changes. See the inner exception for details.
 ---> Microsoft.Data.SqlClient.SqlException (0x80131904): The INSERT statement conflicted with the FOREIGN KEY constraint "FK_AuthLogs_Customers_NationalId". The conflict occurred in database "NayifatApp", table "dbo.Customers", column 'NationalId'.
   at Microsoft.Data.SqlClient.SqlConnection.OnError(SqlException exception, Boolean breakConnection, Action`1 wrapCloseInAction)
   at Microsoft.Data.SqlClient.SqlInternalConnection.OnError(SqlException exception, Boolean breakConnection, Action`1 wrapCloseInAction)
   at Microsoft.Data.SqlClient.TdsParser.ThrowExceptionAndWarning(TdsParserStateObject stateObj, Boolean callerHasConnectionLock, Boolean asyncClose)
   at Microsoft.Data.SqlClient.TdsParser.TryRun(RunBehavior runBehavior, SqlCommand cmdHandler, SqlDataReader dataStream, BulkCopySimpleResultSet bulkCopyHandler, TdsParserStateObject stateObj, Boolean& dataReady)
   at Microsoft.Data.SqlClient.SqlDataReader.TryHasMoreRows(Boolean& moreRows)
   at Microsoft.Data.SqlClient.SqlDataReader.TryReadInternal(Boolean setTimeout, Boolean& more)
   at Microsoft.Data.SqlClient.SqlDataReader.ReadAsyncExecute(Task task, Object state)
   at Microsoft.Data.SqlClient.SqlDataReader.InvokeAsyncCall[T](SqlDataReaderBaseAsyncCallContext`1 context)
--- End of stack trace from previous location ---
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeResultSetAsync(Int32 startCommandIndex, RelationalDataReader reader, CancellationToken cancellationToken)
ClientConnectionId:fcd336cd-d2a0-42ee-80de-222852601375
Error Number:547,State:0,Class:16
   --- End of inner exception stack trace ---
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeResultSetAsync(Int32 startCommandIndex, RelationalDataReader reader, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeAsync(RelationalDataReader reader, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Update.Internal.SqlServerModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(IList`1 entriesToSave, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(StateManager stateManager, Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Storage.Internal.SqlServerExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
2025-02-06 14:13:31.066 +03:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType11`2[[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Object, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-02-06 14:13:31.079 +03:00 [ERR] Error logging audit event. NationalId: all, Action: notification_delivered, Details: {"notification_count":21,"notification_ids":[38,37,36,35,34,33,32,31,30,29,28,27,26,25,24,23,23,20,19,18,12],"timestamp":"2025-02-06T14:13:30.9339358"}
Microsoft.EntityFrameworkCore.DbUpdateException: An error occurred while saving the entity changes. See the inner exception for details.
 ---> Microsoft.Data.SqlClient.SqlException (0x80131904): The INSERT statement conflicted with the FOREIGN KEY constraint "FK_AuthLogs_Customers_NationalId". The conflict occurred in database "NayifatApp", table "dbo.Customers", column 'NationalId'.
   at Microsoft.Data.SqlClient.SqlConnection.OnError(SqlException exception, Boolean breakConnection, Action`1 wrapCloseInAction)
   at Microsoft.Data.SqlClient.SqlInternalConnection.OnError(SqlException exception, Boolean breakConnection, Action`1 wrapCloseInAction)
   at Microsoft.Data.SqlClient.TdsParser.ThrowExceptionAndWarning(TdsParserStateObject stateObj, Boolean callerHasConnectionLock, Boolean asyncClose)
   at Microsoft.Data.SqlClient.TdsParser.TryRun(RunBehavior runBehavior, SqlCommand cmdHandler, SqlDataReader dataStream, BulkCopySimpleResultSet bulkCopyHandler, TdsParserStateObject stateObj, Boolean& dataReady)
   at Microsoft.Data.SqlClient.SqlDataReader.TryHasMoreRows(Boolean& moreRows)
   at Microsoft.Data.SqlClient.SqlDataReader.TryReadInternal(Boolean setTimeout, Boolean& more)
   at Microsoft.Data.SqlClient.SqlDataReader.ReadAsyncExecute(Task task, Object state)
   at Microsoft.Data.SqlClient.SqlDataReader.InvokeAsyncCall[T](SqlDataReaderBaseAsyncCallContext`1 context)
--- End of stack trace from previous location ---
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeResultSetAsync(Int32 startCommandIndex, RelationalDataReader reader, CancellationToken cancellationToken)
ClientConnectionId:fcd336cd-d2a0-42ee-80de-222852601375
Error Number:547,State:0,Class:16
   --- End of inner exception stack trace ---
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeResultSetAsync(Int32 startCommandIndex, RelationalDataReader reader, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeAsync(RelationalDataReader reader, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Update.Internal.SqlServerModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(IList`1 entriesToSave, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(StateManager stateManager, Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Storage.Internal.SqlServerExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at NayifatAPI.Services.AuditLogService.LogAsync(String nationalId, String action, Object details) in C:\Users\yamta\StudioProjects\nayifat_app_2025_new\NayifatAPI\Services\AuditLogService.cs:line 36
2025-02-06 14:13:31.080 +03:00 [INF] Executed action NayifatAPI.Controllers.NotificationsController.GetNotifications (NayifatAPI) in 171.5067ms
2025-02-06 14:13:31.092 +03:00 [INF] Executed endpoint 'NayifatAPI.Controllers.NotificationsController.GetNotifications (NayifatAPI)'
2025-02-06 14:13:31.092 +03:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType11`2[[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Object, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-02-06 14:13:31.093 +03:00 [INF] Request finished HTTP/1.1 POST http://eb3c-46-152-255-232.ngrok-free.app/api/notifications/list - 200 null application/json; charset=utf-8 195.389ms
2025-02-06 14:13:31.095 +03:00 [INF] Executed action NayifatAPI.Controllers.NotificationsController.GetNotifications (NayifatAPI) in 184.5764ms
2025-02-06 14:13:31.096 +03:00 [INF] Request starting HTTP/1.1 POST http://eb3c-46-152-255-232.ngrok-free.app/api/notifications/list - application/json 45
2025-02-06 14:13:31.098 +03:00 [INF] Executed endpoint 'NayifatAPI.Controllers.NotificationsController.GetNotifications (NayifatAPI)'
2025-02-06 14:13:31.100 +03:00 [INF] Executing endpoint 'NayifatAPI.Controllers.NotificationsController.GetNotifications (NayifatAPI)'
2025-02-06 14:13:31.100 +03:00 [INF] Request finished HTTP/1.1 POST http://eb3c-46-152-255-232.ngrok-free.app/api/notifications/list - 200 null application/json; charset=utf-8 202.0738ms
2025-02-06 14:13:31.102 +03:00 [INF] Route matched with {action = "GetNotifications", controller = "Notifications"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetNotifications(NayifatAPI.Controllers.GetNotificationsRequest) on controller NayifatAPI.Controllers.NotificationsController (NayifatAPI).
2025-02-06 14:13:31.103 +03:00 [INF] Request starting HTTP/1.1 POST http://eb3c-46-152-255-232.ngrok-free.app/api/notifications/list - application/json 45
2025-02-06 14:13:31.106 +03:00 [INF] Executed DbCommand (0ms) [Parameters=[@__providedApiKey_0='?' (Size = 255)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [a].[api_Key], [a].[CreatedAt], [a].[Description], [a].[ExpiresAt], [a].[IsActive], [a].[LastUsedAt]
FROM [ApiKeys] AS [a]
WHERE [a].[api_Key] = @__providedApiKey_0 AND [a].[IsActive] = CAST(1 AS bit)
2025-02-06 14:13:31.106 +03:00 [INF] Executing endpoint 'NayifatAPI.Controllers.NotificationsController.GetNotifications (NayifatAPI)'
2025-02-06 14:13:31.109 +03:00 [INF] Executed DbCommand (0ms) [Parameters=[@__request_NationalId_0='?' (Size = 450)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [u].[national_id], [u].[last_updated], [u].[notifications]
FROM [user_notifications] AS [u]
WHERE [u].[national_id] = @__request_NationalId_0
2025-02-06 14:13:31.110 +03:00 [INF] Route matched with {action = "GetNotifications", controller = "Notifications"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetNotifications(NayifatAPI.Controllers.GetNotificationsRequest) on controller NayifatAPI.Controllers.NotificationsController (NayifatAPI).
2025-02-06 14:13:31.112 +03:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType11`2[[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Object, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-02-06 14:13:31.114 +03:00 [INF] Executed action NayifatAPI.Controllers.NotificationsController.GetNotifications (NayifatAPI) in 9.4504ms
2025-02-06 14:13:31.114 +03:00 [INF] Executed DbCommand (0ms) [Parameters=[@__providedApiKey_0='?' (Size = 255)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [a].[api_Key], [a].[CreatedAt], [a].[Description], [a].[ExpiresAt], [a].[IsActive], [a].[LastUsedAt]
FROM [ApiKeys] AS [a]
WHERE [a].[api_Key] = @__providedApiKey_0 AND [a].[IsActive] = CAST(1 AS bit)
2025-02-06 14:13:31.115 +03:00 [INF] Executed endpoint 'NayifatAPI.Controllers.NotificationsController.GetNotifications (NayifatAPI)'
2025-02-06 14:13:31.117 +03:00 [INF] Request finished HTTP/1.1 POST http://eb3c-46-152-255-232.ngrok-free.app/api/notifications/list - 200 null application/json; charset=utf-8 21.0938ms
2025-02-06 14:13:31.118 +03:00 [INF] Executed DbCommand (0ms) [Parameters=[@__request_NationalId_0='?' (Size = 450)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [u].[national_id], [u].[last_updated], [u].[notifications]
FROM [user_notifications] AS [u]
WHERE [u].[national_id] = @__request_NationalId_0
2025-02-06 14:13:31.122 +03:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType11`2[[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Object, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-02-06 14:13:31.124 +03:00 [INF] Executed action NayifatAPI.Controllers.NotificationsController.GetNotifications (NayifatAPI) in 11.4981ms
2025-02-06 14:13:31.128 +03:00 [INF] Executed endpoint 'NayifatAPI.Controllers.NotificationsController.GetNotifications (NayifatAPI)'
2025-02-06 14:13:31.128 +03:00 [INF] Request finished HTTP/1.1 POST http://eb3c-46-152-255-232.ngrok-free.app/api/notifications/list - 200 null application/json; charset=utf-8 25.2721ms
2025-02-06 14:22:50.949 +03:00 [INF] Request starting HTTP/1.1 POST http://eb3c-46-152-255-232.ngrok-free.app/api/notifications/list - application/json 45
2025-02-06 14:22:50.952 +03:00 [INF] Executing endpoint 'NayifatAPI.Controllers.NotificationsController.GetNotifications (NayifatAPI)'
2025-02-06 14:22:50.955 +03:00 [INF] Route matched with {action = "GetNotifications", controller = "Notifications"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetNotifications(NayifatAPI.Controllers.GetNotificationsRequest) on controller NayifatAPI.Controllers.NotificationsController (NayifatAPI).
2025-02-06 14:22:51.078 +03:00 [INF] Executed DbCommand (32ms) [Parameters=[@__providedApiKey_0='?' (Size = 255)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [a].[api_Key], [a].[CreatedAt], [a].[Description], [a].[ExpiresAt], [a].[IsActive], [a].[LastUsedAt]
FROM [ApiKeys] AS [a]
WHERE [a].[api_Key] = @__providedApiKey_0 AND [a].[IsActive] = CAST(1 AS bit)
2025-02-06 14:22:51.084 +03:00 [INF] Executed DbCommand (4ms) [Parameters=[@__request_NationalId_0='?' (Size = 450)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [u].[national_id], [u].[last_updated], [u].[notifications]
FROM [user_notifications] AS [u]
WHERE [u].[national_id] = @__request_NationalId_0
2025-02-06 14:22:51.087 +03:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType11`2[[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Object, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-02-06 14:22:51.095 +03:00 [INF] Executed action NayifatAPI.Controllers.NotificationsController.GetNotifications (NayifatAPI) in 136.881ms
2025-02-06 14:22:51.096 +03:00 [INF] Executed endpoint 'NayifatAPI.Controllers.NotificationsController.GetNotifications (NayifatAPI)'
2025-02-06 14:22:51.097 +03:00 [INF] Request finished HTTP/1.1 POST http://eb3c-46-152-255-232.ngrok-free.app/api/notifications/list - 200 null application/json; charset=utf-8 148.8335ms
2025-02-06 14:23:16.539 +03:00 [INF] Request starting HTTP/1.1 POST http://eb3c-46-152-255-232.ngrok-free.app/api/notifications/list - application/json; charset=utf-8 45
2025-02-06 14:23:16.540 +03:00 [INF] Request starting HTTP/1.1 POST http://eb3c-46-152-255-232.ngrok-free.app/api/content/timestamps - application/json; charset=utf-8 2
2025-02-06 14:23:16.542 +03:00 [INF] Executing endpoint 'NayifatAPI.Controllers.NotificationsController.GetNotifications (NayifatAPI)'
2025-02-06 14:23:16.544 +03:00 [INF] Executing endpoint 'NayifatAPI.Controllers.ContentController.GetTimestamps (NayifatAPI)'
2025-02-06 14:23:16.545 +03:00 [INF] Route matched with {action = "GetNotifications", controller = "Notifications"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetNotifications(NayifatAPI.Controllers.GetNotificationsRequest) on controller NayifatAPI.Controllers.NotificationsController (NayifatAPI).
2025-02-06 14:23:16.546 +03:00 [INF] Route matched with {action = "GetTimestamps", controller = "Content"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetTimestamps() on controller NayifatAPI.Controllers.ContentController (NayifatAPI).
2025-02-06 14:23:16.551 +03:00 [INF] TTT_
2025-02-06 14:23:16.553 +03:00 [INF] TTT_=== Getting Content Timestamps ===
2025-02-06 14:23:16.554 +03:00 [INF] Executed DbCommand (0ms) [Parameters=[@__providedApiKey_0='?' (Size = 255)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [a].[api_Key], [a].[CreatedAt], [a].[Description], [a].[ExpiresAt], [a].[IsActive], [a].[LastUsedAt]
FROM [ApiKeys] AS [a]
WHERE [a].[api_Key] = @__providedApiKey_0 AND [a].[IsActive] = CAST(1 AS bit)
2025-02-06 14:23:16.556 +03:00 [INF] Executed DbCommand (0ms) [Parameters=[@__request_NationalId_0='?' (Size = 450)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [u].[national_id], [u].[last_updated], [u].[notifications]
FROM [user_notifications] AS [u]
WHERE [u].[national_id] = @__request_NationalId_0
2025-02-06 14:23:16.558 +03:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType11`2[[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Object, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-02-06 14:23:16.559 +03:00 [INF] Executed DbCommand (0ms) [Parameters=[@__providedApiKey_0='?' (Size = 255)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [a].[api_Key], [a].[CreatedAt], [a].[Description], [a].[ExpiresAt], [a].[IsActive], [a].[LastUsedAt]
FROM [ApiKeys] AS [a]
WHERE [a].[api_Key] = @__providedApiKey_0 AND [a].[IsActive] = CAST(1 AS bit)
2025-02-06 14:23:16.560 +03:00 [INF] Executed action NayifatAPI.Controllers.NotificationsController.GetNotifications (NayifatAPI) in 11.6ms
2025-02-06 14:23:16.561 +03:00 [INF] TTT_Fetching timestamps from database
2025-02-06 14:23:16.562 +03:00 [INF] Executed endpoint 'NayifatAPI.Controllers.NotificationsController.GetNotifications (NayifatAPI)'
2025-02-06 14:23:16.563 +03:00 [INF] Request finished HTTP/1.1 POST http://eb3c-46-152-255-232.ngrok-free.app/api/notifications/list - 200 null application/json; charset=utf-8 23.7366ms
2025-02-06 14:23:16.645 +03:00 [INF] Executed DbCommand (77ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT [m].[page] AS [Page], [m].[key_name] AS [KeyName], [m].[last_updated] AS [LastUpdated]
FROM [master_config] AS [m]
2025-02-06 14:23:16.647 +03:00 [INF] TTT_Found 18 content items
2025-02-06 14:23:16.651 +03:00 [INF] TTT_Page: home
2025-02-06 14:23:16.651 +03:00 [INF] TTT_  - slideshow_content: "2025-02-05T13:56:06.9430000"
2025-02-06 14:23:16.654 +03:00 [INF] TTT_  - slideshow_content_ar: "2025-02-05T14:22:06.9430000"
2025-02-06 14:23:16.655 +03:00 [INF] TTT_  - contact_details: "2025-02-05T15:43:06.9430000"
2025-02-06 14:23:16.656 +03:00 [INF] TTT_  - contact_details_ar: "2025-02-05T14:06:06.9430000"
2025-02-06 14:23:16.657 +03:00 [INF] TTT_  - termsEN1: "2025-02-03T14:23:58.0000000"
2025-02-06 14:23:16.658 +03:00 [INF] TTT_  - termsEN2: "2025-02-03T14:25:20.1730000"
2025-02-06 14:23:16.658 +03:00 [INF] TTT_  - privacyEN1: "2025-02-03T14:26:08.6130000"
2025-02-06 14:23:16.659 +03:00 [INF] TTT_  - privacyEN2: "2025-02-03T14:25:20.1730000"
2025-02-06 14:23:16.660 +03:00 [INF] TTT_  - termsAR1: "2025-02-03T14:23:58.0000000"
2025-02-06 14:23:16.661 +03:00 [INF] TTT_  - termsAR2: "2025-02-03T14:25:20.1730000"
2025-02-06 14:23:16.662 +03:00 [INF] TTT_  - privacyAR1: "2025-02-03T14:26:08.6130000"
2025-02-06 14:23:16.663 +03:00 [INF] TTT_  - privacyAR2: "2025-02-03T14:25:20.1730000"
2025-02-06 14:23:16.664 +03:00 [INF] TTT_  - terms&conditionsCC_AR: "2025-02-03T17:06:57.7700000"
2025-02-06 14:23:16.664 +03:00 [INF] TTT_  - terms&conditionsCC_EN: "2025-02-03T17:07:47.4900000"
2025-02-06 14:23:16.665 +03:00 [INF] TTT_  - terms&conditionsPF_AR: "2025-02-03T17:06:57.7700000"
2025-02-06 14:23:16.666 +03:00 [INF] TTT_  - terms&conditionsPF_EN: "2025-02-03T17:06:57.7700000"
2025-02-06 14:23:16.667 +03:00 [INF] TTT_Page: loans
2025-02-06 14:23:16.667 +03:00 [INF] TTT_  - loan_ad: "2025-02-05T13:56:06.9430000"
2025-02-06 14:23:16.668 +03:00 [INF] TTT_Page: cards
2025-02-06 14:23:16.669 +03:00 [INF] TTT_  - card_ad: "2025-02-05T15:43:06.9430000"
2025-02-06 14:23:16.670 +03:00 [INF] TTT_Successfully retrieved all timestamps
2025-02-06 14:23:16.671 +03:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType11`2[[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Object, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-02-06 14:23:16.672 +03:00 [INF] Executed action NayifatAPI.Controllers.ContentController.GetTimestamps (NayifatAPI) in 121.3246ms
2025-02-06 14:23:16.674 +03:00 [INF] Executed endpoint 'NayifatAPI.Controllers.ContentController.GetTimestamps (NayifatAPI)'
2025-02-06 14:23:16.675 +03:00 [INF] Request finished HTTP/1.1 POST http://eb3c-46-152-255-232.ngrok-free.app/api/content/timestamps - 200 null application/json; charset=utf-8 135.2913ms
2025-02-06 14:23:17.160 +03:00 [INF] Request starting HTTP/1.1 POST http://eb3c-46-152-255-232.ngrok-free.app/api/notifications/list - application/json; charset=utf-8 39
2025-02-06 14:23:17.163 +03:00 [INF] Executing endpoint 'NayifatAPI.Controllers.NotificationsController.GetNotifications (NayifatAPI)'
2025-02-06 14:23:17.163 +03:00 [INF] Route matched with {action = "GetNotifications", controller = "Notifications"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetNotifications(NayifatAPI.Controllers.GetNotificationsRequest) on controller NayifatAPI.Controllers.NotificationsController (NayifatAPI).
2025-02-06 14:23:17.166 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@__providedApiKey_0='?' (Size = 255)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [a].[api_Key], [a].[CreatedAt], [a].[Description], [a].[ExpiresAt], [a].[IsActive], [a].[LastUsedAt]
FROM [ApiKeys] AS [a]
WHERE [a].[api_Key] = @__providedApiKey_0 AND [a].[IsActive] = CAST(1 AS bit)
2025-02-06 14:23:17.168 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@__request_NationalId_0='?' (Size = 450)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [u].[national_id], [u].[last_updated], [u].[notifications]
FROM [user_notifications] AS [u]
WHERE [u].[national_id] = @__request_NationalId_0
2025-02-06 14:23:17.178 +03:00 [INF] Executed DbCommand (8ms) [Parameters=[@__Parse_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [n].[Id], [n].[additional_data], [n].[big_picture_url], [n].[Body], [n].[body_ar], [n].[body_en], [n].[created_at], [n].[expiry_at], [n].[large_icon_url], [n].[Route], [n].[target_criteria], [n].[Title], [n].[title_ar], [n].[title_en]
FROM [notification_templates] AS [n]
WHERE [n].[Id] = @__Parse_0
2025-02-06 14:23:17.182 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@__Parse_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [n].[Id], [n].[additional_data], [n].[big_picture_url], [n].[Body], [n].[body_ar], [n].[body_en], [n].[created_at], [n].[expiry_at], [n].[large_icon_url], [n].[Route], [n].[target_criteria], [n].[Title], [n].[title_ar], [n].[title_en]
FROM [notification_templates] AS [n]
WHERE [n].[Id] = @__Parse_0
2025-02-06 14:23:17.185 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@__Parse_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [n].[Id], [n].[additional_data], [n].[big_picture_url], [n].[Body], [n].[body_ar], [n].[body_en], [n].[created_at], [n].[expiry_at], [n].[large_icon_url], [n].[Route], [n].[target_criteria], [n].[Title], [n].[title_ar], [n].[title_en]
FROM [notification_templates] AS [n]
WHERE [n].[Id] = @__Parse_0
2025-02-06 14:23:17.188 +03:00 [INF] Executed DbCommand (0ms) [Parameters=[@__Parse_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [n].[Id], [n].[additional_data], [n].[big_picture_url], [n].[Body], [n].[body_ar], [n].[body_en], [n].[created_at], [n].[expiry_at], [n].[large_icon_url], [n].[Route], [n].[target_criteria], [n].[Title], [n].[title_ar], [n].[title_en]
FROM [notification_templates] AS [n]
WHERE [n].[Id] = @__Parse_0
2025-02-06 14:23:17.190 +03:00 [INF] Executed DbCommand (0ms) [Parameters=[@__Parse_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [n].[Id], [n].[additional_data], [n].[big_picture_url], [n].[Body], [n].[body_ar], [n].[body_en], [n].[created_at], [n].[expiry_at], [n].[large_icon_url], [n].[Route], [n].[target_criteria], [n].[Title], [n].[title_ar], [n].[title_en]
FROM [notification_templates] AS [n]
WHERE [n].[Id] = @__Parse_0
2025-02-06 14:23:17.192 +03:00 [INF] Executed DbCommand (0ms) [Parameters=[@__Parse_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [n].[Id], [n].[additional_data], [n].[big_picture_url], [n].[Body], [n].[body_ar], [n].[body_en], [n].[created_at], [n].[expiry_at], [n].[large_icon_url], [n].[Route], [n].[target_criteria], [n].[Title], [n].[title_ar], [n].[title_en]
FROM [notification_templates] AS [n]
WHERE [n].[Id] = @__Parse_0
2025-02-06 14:23:17.194 +03:00 [INF] Executed DbCommand (0ms) [Parameters=[@__Parse_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [n].[Id], [n].[additional_data], [n].[big_picture_url], [n].[Body], [n].[body_ar], [n].[body_en], [n].[created_at], [n].[expiry_at], [n].[large_icon_url], [n].[Route], [n].[target_criteria], [n].[Title], [n].[title_ar], [n].[title_en]
FROM [notification_templates] AS [n]
WHERE [n].[Id] = @__Parse_0
2025-02-06 14:23:17.195 +03:00 [INF] Executed DbCommand (0ms) [Parameters=[@__Parse_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [n].[Id], [n].[additional_data], [n].[big_picture_url], [n].[Body], [n].[body_ar], [n].[body_en], [n].[created_at], [n].[expiry_at], [n].[large_icon_url], [n].[Route], [n].[target_criteria], [n].[Title], [n].[title_ar], [n].[title_en]
FROM [notification_templates] AS [n]
WHERE [n].[Id] = @__Parse_0
2025-02-06 14:23:17.198 +03:00 [INF] Executed DbCommand (0ms) [Parameters=[@__Parse_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [n].[Id], [n].[additional_data], [n].[big_picture_url], [n].[Body], [n].[body_ar], [n].[body_en], [n].[created_at], [n].[expiry_at], [n].[large_icon_url], [n].[Route], [n].[target_criteria], [n].[Title], [n].[title_ar], [n].[title_en]
FROM [notification_templates] AS [n]
WHERE [n].[Id] = @__Parse_0
2025-02-06 14:23:17.200 +03:00 [INF] Executed DbCommand (0ms) [Parameters=[@__Parse_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [n].[Id], [n].[additional_data], [n].[big_picture_url], [n].[Body], [n].[body_ar], [n].[body_en], [n].[created_at], [n].[expiry_at], [n].[large_icon_url], [n].[Route], [n].[target_criteria], [n].[Title], [n].[title_ar], [n].[title_en]
FROM [notification_templates] AS [n]
WHERE [n].[Id] = @__Parse_0
2025-02-06 14:23:17.202 +03:00 [INF] Executed DbCommand (0ms) [Parameters=[@__Parse_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [n].[Id], [n].[additional_data], [n].[big_picture_url], [n].[Body], [n].[body_ar], [n].[body_en], [n].[created_at], [n].[expiry_at], [n].[large_icon_url], [n].[Route], [n].[target_criteria], [n].[Title], [n].[title_ar], [n].[title_en]
FROM [notification_templates] AS [n]
WHERE [n].[Id] = @__Parse_0
2025-02-06 14:23:17.204 +03:00 [INF] Executed DbCommand (0ms) [Parameters=[@__Parse_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [n].[Id], [n].[additional_data], [n].[big_picture_url], [n].[Body], [n].[body_ar], [n].[body_en], [n].[created_at], [n].[expiry_at], [n].[large_icon_url], [n].[Route], [n].[target_criteria], [n].[Title], [n].[title_ar], [n].[title_en]
FROM [notification_templates] AS [n]
WHERE [n].[Id] = @__Parse_0
2025-02-06 14:23:17.206 +03:00 [INF] Executed DbCommand (0ms) [Parameters=[@__Parse_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [n].[Id], [n].[additional_data], [n].[big_picture_url], [n].[Body], [n].[body_ar], [n].[body_en], [n].[created_at], [n].[expiry_at], [n].[large_icon_url], [n].[Route], [n].[target_criteria], [n].[Title], [n].[title_ar], [n].[title_en]
FROM [notification_templates] AS [n]
WHERE [n].[Id] = @__Parse_0
2025-02-06 14:23:17.209 +03:00 [INF] Executed DbCommand (0ms) [Parameters=[@__Parse_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [n].[Id], [n].[additional_data], [n].[big_picture_url], [n].[Body], [n].[body_ar], [n].[body_en], [n].[created_at], [n].[expiry_at], [n].[large_icon_url], [n].[Route], [n].[target_criteria], [n].[Title], [n].[title_ar], [n].[title_en]
FROM [notification_templates] AS [n]
WHERE [n].[Id] = @__Parse_0
2025-02-06 14:23:17.210 +03:00 [INF] Executed DbCommand (0ms) [Parameters=[@__Parse_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [n].[Id], [n].[additional_data], [n].[big_picture_url], [n].[Body], [n].[body_ar], [n].[body_en], [n].[created_at], [n].[expiry_at], [n].[large_icon_url], [n].[Route], [n].[target_criteria], [n].[Title], [n].[title_ar], [n].[title_en]
FROM [notification_templates] AS [n]
WHERE [n].[Id] = @__Parse_0
2025-02-06 14:23:17.212 +03:00 [INF] Executed DbCommand (0ms) [Parameters=[@__Parse_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [n].[Id], [n].[additional_data], [n].[big_picture_url], [n].[Body], [n].[body_ar], [n].[body_en], [n].[created_at], [n].[expiry_at], [n].[large_icon_url], [n].[Route], [n].[target_criteria], [n].[Title], [n].[title_ar], [n].[title_en]
FROM [notification_templates] AS [n]
WHERE [n].[Id] = @__Parse_0
2025-02-06 14:23:17.214 +03:00 [INF] Executed DbCommand (0ms) [Parameters=[@__Parse_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [n].[Id], [n].[additional_data], [n].[big_picture_url], [n].[Body], [n].[body_ar], [n].[body_en], [n].[created_at], [n].[expiry_at], [n].[large_icon_url], [n].[Route], [n].[target_criteria], [n].[Title], [n].[title_ar], [n].[title_en]
FROM [notification_templates] AS [n]
WHERE [n].[Id] = @__Parse_0
2025-02-06 14:23:17.216 +03:00 [INF] Executed DbCommand (0ms) [Parameters=[@__Parse_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [n].[Id], [n].[additional_data], [n].[big_picture_url], [n].[Body], [n].[body_ar], [n].[body_en], [n].[created_at], [n].[expiry_at], [n].[large_icon_url], [n].[Route], [n].[target_criteria], [n].[Title], [n].[title_ar], [n].[title_en]
FROM [notification_templates] AS [n]
WHERE [n].[Id] = @__Parse_0
2025-02-06 14:23:17.221 +03:00 [INF] Executed DbCommand (0ms) [Parameters=[@__Parse_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [n].[Id], [n].[additional_data], [n].[big_picture_url], [n].[Body], [n].[body_ar], [n].[body_en], [n].[created_at], [n].[expiry_at], [n].[large_icon_url], [n].[Route], [n].[target_criteria], [n].[Title], [n].[title_ar], [n].[title_en]
FROM [notification_templates] AS [n]
WHERE [n].[Id] = @__Parse_0
2025-02-06 14:23:17.224 +03:00 [INF] Executed DbCommand (0ms) [Parameters=[@__Parse_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [n].[Id], [n].[additional_data], [n].[big_picture_url], [n].[Body], [n].[body_ar], [n].[body_en], [n].[created_at], [n].[expiry_at], [n].[large_icon_url], [n].[Route], [n].[target_criteria], [n].[Title], [n].[title_ar], [n].[title_en]
FROM [notification_templates] AS [n]
WHERE [n].[Id] = @__Parse_0
2025-02-06 14:23:17.226 +03:00 [INF] Executed DbCommand (0ms) [Parameters=[@__Parse_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [n].[Id], [n].[additional_data], [n].[big_picture_url], [n].[Body], [n].[body_ar], [n].[body_en], [n].[created_at], [n].[expiry_at], [n].[large_icon_url], [n].[Route], [n].[target_criteria], [n].[Title], [n].[title_ar], [n].[title_en]
FROM [notification_templates] AS [n]
WHERE [n].[Id] = @__Parse_0
2025-02-06 14:23:17.235 +03:00 [INF] Executed DbCommand (7ms) [Parameters=[@p0='?' (Size = 4000), @p1='?' (DbType = DateTime2), @p2='?' (Size = 4000), @p3='?' (Size = 4000), @p4='?' (Size = 4000), @p5='?' (Size = 450), @p6='?' (Size = 4000), @p7='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SET IMPLICIT_TRANSACTIONS OFF;
SET NOCOUNT ON;
INSERT INTO [AuthLogs] ([AuthType], [CreatedAt], [DeviceId], [FailureReason], [IpAddress], [NationalId], [Status], [UserAgent])
OUTPUT INSERTED.[Id]
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7);
2025-02-06 14:23:17.238 +03:00 [ERR] An exception occurred in the database while saving changes for context type 'NayifatAPI.Data.ApplicationDbContext'.
Microsoft.EntityFrameworkCore.DbUpdateException: An error occurred while saving the entity changes. See the inner exception for details.
 ---> Microsoft.Data.SqlClient.SqlException (0x80131904): The INSERT statement conflicted with the FOREIGN KEY constraint "FK_AuthLogs_Customers_NationalId". The conflict occurred in database "NayifatApp", table "dbo.Customers", column 'NationalId'.
   at Microsoft.Data.SqlClient.SqlConnection.OnError(SqlException exception, Boolean breakConnection, Action`1 wrapCloseInAction)
   at Microsoft.Data.SqlClient.SqlInternalConnection.OnError(SqlException exception, Boolean breakConnection, Action`1 wrapCloseInAction)
   at Microsoft.Data.SqlClient.TdsParser.ThrowExceptionAndWarning(TdsParserStateObject stateObj, Boolean callerHasConnectionLock, Boolean asyncClose)
   at Microsoft.Data.SqlClient.TdsParser.TryRun(RunBehavior runBehavior, SqlCommand cmdHandler, SqlDataReader dataStream, BulkCopySimpleResultSet bulkCopyHandler, TdsParserStateObject stateObj, Boolean& dataReady)
   at Microsoft.Data.SqlClient.SqlDataReader.TryHasMoreRows(Boolean& moreRows)
   at Microsoft.Data.SqlClient.SqlDataReader.TryReadInternal(Boolean setTimeout, Boolean& more)
   at Microsoft.Data.SqlClient.SqlDataReader.ReadAsyncExecute(Task task, Object state)
   at Microsoft.Data.SqlClient.SqlDataReader.InvokeAsyncCall[T](SqlDataReaderBaseAsyncCallContext`1 context)
--- End of stack trace from previous location ---
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeResultSetAsync(Int32 startCommandIndex, RelationalDataReader reader, CancellationToken cancellationToken)
ClientConnectionId:49bf509c-44a4-4600-90e3-61f9fcbb1f83
Error Number:547,State:0,Class:16
   --- End of inner exception stack trace ---
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeResultSetAsync(Int32 startCommandIndex, RelationalDataReader reader, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeAsync(RelationalDataReader reader, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Update.Internal.SqlServerModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(IList`1 entriesToSave, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(StateManager stateManager, Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Storage.Internal.SqlServerExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
Microsoft.EntityFrameworkCore.DbUpdateException: An error occurred while saving the entity changes. See the inner exception for details.
 ---> Microsoft.Data.SqlClient.SqlException (0x80131904): The INSERT statement conflicted with the FOREIGN KEY constraint "FK_AuthLogs_Customers_NationalId". The conflict occurred in database "NayifatApp", table "dbo.Customers", column 'NationalId'.
   at Microsoft.Data.SqlClient.SqlConnection.OnError(SqlException exception, Boolean breakConnection, Action`1 wrapCloseInAction)
   at Microsoft.Data.SqlClient.SqlInternalConnection.OnError(SqlException exception, Boolean breakConnection, Action`1 wrapCloseInAction)
   at Microsoft.Data.SqlClient.TdsParser.ThrowExceptionAndWarning(TdsParserStateObject stateObj, Boolean callerHasConnectionLock, Boolean asyncClose)
   at Microsoft.Data.SqlClient.TdsParser.TryRun(RunBehavior runBehavior, SqlCommand cmdHandler, SqlDataReader dataStream, BulkCopySimpleResultSet bulkCopyHandler, TdsParserStateObject stateObj, Boolean& dataReady)
   at Microsoft.Data.SqlClient.SqlDataReader.TryHasMoreRows(Boolean& moreRows)
   at Microsoft.Data.SqlClient.SqlDataReader.TryReadInternal(Boolean setTimeout, Boolean& more)
   at Microsoft.Data.SqlClient.SqlDataReader.ReadAsyncExecute(Task task, Object state)
   at Microsoft.Data.SqlClient.SqlDataReader.InvokeAsyncCall[T](SqlDataReaderBaseAsyncCallContext`1 context)
--- End of stack trace from previous location ---
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeResultSetAsync(Int32 startCommandIndex, RelationalDataReader reader, CancellationToken cancellationToken)
ClientConnectionId:49bf509c-44a4-4600-90e3-61f9fcbb1f83
Error Number:547,State:0,Class:16
   --- End of inner exception stack trace ---
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeResultSetAsync(Int32 startCommandIndex, RelationalDataReader reader, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeAsync(RelationalDataReader reader, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Update.Internal.SqlServerModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(IList`1 entriesToSave, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(StateManager stateManager, Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Storage.Internal.SqlServerExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
2025-02-06 14:23:17.249 +03:00 [ERR] Error logging audit event. NationalId: all, Action: notification_delivered, Details: {"notification_count":21,"notification_ids":[38,37,36,35,34,33,32,31,30,29,28,27,26,25,24,23,23,20,19,18,12],"timestamp":"2025-02-06T14:23:17.17052"}
Microsoft.EntityFrameworkCore.DbUpdateException: An error occurred while saving the entity changes. See the inner exception for details.
 ---> Microsoft.Data.SqlClient.SqlException (0x80131904): The INSERT statement conflicted with the FOREIGN KEY constraint "FK_AuthLogs_Customers_NationalId". The conflict occurred in database "NayifatApp", table "dbo.Customers", column 'NationalId'.
   at Microsoft.Data.SqlClient.SqlConnection.OnError(SqlException exception, Boolean breakConnection, Action`1 wrapCloseInAction)
   at Microsoft.Data.SqlClient.SqlInternalConnection.OnError(SqlException exception, Boolean breakConnection, Action`1 wrapCloseInAction)
   at Microsoft.Data.SqlClient.TdsParser.ThrowExceptionAndWarning(TdsParserStateObject stateObj, Boolean callerHasConnectionLock, Boolean asyncClose)
   at Microsoft.Data.SqlClient.TdsParser.TryRun(RunBehavior runBehavior, SqlCommand cmdHandler, SqlDataReader dataStream, BulkCopySimpleResultSet bulkCopyHandler, TdsParserStateObject stateObj, Boolean& dataReady)
   at Microsoft.Data.SqlClient.SqlDataReader.TryHasMoreRows(Boolean& moreRows)
   at Microsoft.Data.SqlClient.SqlDataReader.TryReadInternal(Boolean setTimeout, Boolean& more)
   at Microsoft.Data.SqlClient.SqlDataReader.ReadAsyncExecute(Task task, Object state)
   at Microsoft.Data.SqlClient.SqlDataReader.InvokeAsyncCall[T](SqlDataReaderBaseAsyncCallContext`1 context)
--- End of stack trace from previous location ---
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeResultSetAsync(Int32 startCommandIndex, RelationalDataReader reader, CancellationToken cancellationToken)
ClientConnectionId:49bf509c-44a4-4600-90e3-61f9fcbb1f83
Error Number:547,State:0,Class:16
   --- End of inner exception stack trace ---
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeResultSetAsync(Int32 startCommandIndex, RelationalDataReader reader, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeAsync(RelationalDataReader reader, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Update.Internal.SqlServerModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(IList`1 entriesToSave, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(StateManager stateManager, Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Storage.Internal.SqlServerExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at NayifatAPI.Services.AuditLogService.LogAsync(String nationalId, String action, Object details) in C:\Users\yamta\StudioProjects\nayifat_app_2025_new\NayifatAPI\Services\AuditLogService.cs:line 36
2025-02-06 14:23:17.258 +03:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType11`2[[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Object, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-02-06 14:23:17.259 +03:00 [INF] Executed action NayifatAPI.Controllers.NotificationsController.GetNotifications (NayifatAPI) in 94.4195ms
2025-02-06 14:23:17.260 +03:00 [INF] Executed endpoint 'NayifatAPI.Controllers.NotificationsController.GetNotifications (NayifatAPI)'
2025-02-06 14:23:17.263 +03:00 [INF] Request finished HTTP/1.1 POST http://eb3c-46-152-255-232.ngrok-free.app/api/notifications/list - 200 null application/json; charset=utf-8 102.6117ms
2025-02-06 14:28:17.811 +03:00 [INF] Request starting HTTP/1.1 POST http://eb3c-46-152-255-232.ngrok-free.app/api/notifications/list - application/json; charset=utf-8 45
2025-02-06 14:28:17.817 +03:00 [INF] Executing endpoint 'NayifatAPI.Controllers.NotificationsController.GetNotifications (NayifatAPI)'
2025-02-06 14:28:17.818 +03:00 [INF] Route matched with {action = "GetNotifications", controller = "Notifications"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetNotifications(NayifatAPI.Controllers.GetNotificationsRequest) on controller NayifatAPI.Controllers.NotificationsController (NayifatAPI).
2025-02-06 14:28:18.532 +03:00 [INF] Executed DbCommand (709ms) [Parameters=[@__providedApiKey_0='?' (Size = 255)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [a].[api_Key], [a].[CreatedAt], [a].[Description], [a].[ExpiresAt], [a].[IsActive], [a].[LastUsedAt]
FROM [ApiKeys] AS [a]
WHERE [a].[api_Key] = @__providedApiKey_0 AND [a].[IsActive] = CAST(1 AS bit)
2025-02-06 14:28:18.538 +03:00 [INF] Executed DbCommand (4ms) [Parameters=[@__request_NationalId_0='?' (Size = 450)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [u].[national_id], [u].[last_updated], [u].[notifications]
FROM [user_notifications] AS [u]
WHERE [u].[national_id] = @__request_NationalId_0
2025-02-06 14:28:18.541 +03:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType11`2[[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Object, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-02-06 14:28:18.542 +03:00 [INF] Executed action NayifatAPI.Controllers.NotificationsController.GetNotifications (NayifatAPI) in 721.5803ms
2025-02-06 14:28:18.546 +03:00 [INF] Executed endpoint 'NayifatAPI.Controllers.NotificationsController.GetNotifications (NayifatAPI)'
2025-02-06 14:28:18.548 +03:00 [INF] Request finished HTTP/1.1 POST http://eb3c-46-152-255-232.ngrok-free.app/api/notifications/list - 200 null application/json; charset=utf-8 737.1049ms
2025-02-06 14:28:18.924 +03:00 [INF] Request starting HTTP/1.1 POST http://eb3c-46-152-255-232.ngrok-free.app/api/notifications/list - application/json; charset=utf-8 39
2025-02-06 14:28:18.931 +03:00 [INF] Executing endpoint 'NayifatAPI.Controllers.NotificationsController.GetNotifications (NayifatAPI)'
2025-02-06 14:28:18.932 +03:00 [INF] Route matched with {action = "GetNotifications", controller = "Notifications"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetNotifications(NayifatAPI.Controllers.GetNotificationsRequest) on controller NayifatAPI.Controllers.NotificationsController (NayifatAPI).
2025-02-06 14:28:18.940 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@__providedApiKey_0='?' (Size = 255)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [a].[api_Key], [a].[CreatedAt], [a].[Description], [a].[ExpiresAt], [a].[IsActive], [a].[LastUsedAt]
FROM [ApiKeys] AS [a]
WHERE [a].[api_Key] = @__providedApiKey_0 AND [a].[IsActive] = CAST(1 AS bit)
2025-02-06 14:28:18.945 +03:00 [INF] Executed DbCommand (2ms) [Parameters=[@__request_NationalId_0='?' (Size = 450)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [u].[national_id], [u].[last_updated], [u].[notifications]
FROM [user_notifications] AS [u]
WHERE [u].[national_id] = @__request_NationalId_0
2025-02-06 14:28:19.366 +03:00 [INF] Executed DbCommand (413ms) [Parameters=[@__Parse_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [n].[Id], [n].[additional_data], [n].[big_picture_url], [n].[Body], [n].[body_ar], [n].[body_en], [n].[created_at], [n].[expiry_at], [n].[large_icon_url], [n].[Route], [n].[target_criteria], [n].[Title], [n].[title_ar], [n].[title_en]
FROM [notification_templates] AS [n]
WHERE [n].[Id] = @__Parse_0
2025-02-06 14:28:19.370 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@__Parse_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [n].[Id], [n].[additional_data], [n].[big_picture_url], [n].[Body], [n].[body_ar], [n].[body_en], [n].[created_at], [n].[expiry_at], [n].[large_icon_url], [n].[Route], [n].[target_criteria], [n].[Title], [n].[title_ar], [n].[title_en]
FROM [notification_templates] AS [n]
WHERE [n].[Id] = @__Parse_0
2025-02-06 14:28:19.373 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@__Parse_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [n].[Id], [n].[additional_data], [n].[big_picture_url], [n].[Body], [n].[body_ar], [n].[body_en], [n].[created_at], [n].[expiry_at], [n].[large_icon_url], [n].[Route], [n].[target_criteria], [n].[Title], [n].[title_ar], [n].[title_en]
FROM [notification_templates] AS [n]
WHERE [n].[Id] = @__Parse_0
2025-02-06 14:28:19.377 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@__Parse_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [n].[Id], [n].[additional_data], [n].[big_picture_url], [n].[Body], [n].[body_ar], [n].[body_en], [n].[created_at], [n].[expiry_at], [n].[large_icon_url], [n].[Route], [n].[target_criteria], [n].[Title], [n].[title_ar], [n].[title_en]
FROM [notification_templates] AS [n]
WHERE [n].[Id] = @__Parse_0
2025-02-06 14:28:19.383 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@__Parse_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [n].[Id], [n].[additional_data], [n].[big_picture_url], [n].[Body], [n].[body_ar], [n].[body_en], [n].[created_at], [n].[expiry_at], [n].[large_icon_url], [n].[Route], [n].[target_criteria], [n].[Title], [n].[title_ar], [n].[title_en]
FROM [notification_templates] AS [n]
WHERE [n].[Id] = @__Parse_0
2025-02-06 14:28:19.387 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@__Parse_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [n].[Id], [n].[additional_data], [n].[big_picture_url], [n].[Body], [n].[body_ar], [n].[body_en], [n].[created_at], [n].[expiry_at], [n].[large_icon_url], [n].[Route], [n].[target_criteria], [n].[Title], [n].[title_ar], [n].[title_en]
FROM [notification_templates] AS [n]
WHERE [n].[Id] = @__Parse_0
2025-02-06 14:28:19.391 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@__Parse_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [n].[Id], [n].[additional_data], [n].[big_picture_url], [n].[Body], [n].[body_ar], [n].[body_en], [n].[created_at], [n].[expiry_at], [n].[large_icon_url], [n].[Route], [n].[target_criteria], [n].[Title], [n].[title_ar], [n].[title_en]
FROM [notification_templates] AS [n]
WHERE [n].[Id] = @__Parse_0
2025-02-06 14:28:19.396 +03:00 [INF] Executed DbCommand (2ms) [Parameters=[@__Parse_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [n].[Id], [n].[additional_data], [n].[big_picture_url], [n].[Body], [n].[body_ar], [n].[body_en], [n].[created_at], [n].[expiry_at], [n].[large_icon_url], [n].[Route], [n].[target_criteria], [n].[Title], [n].[title_ar], [n].[title_en]
FROM [notification_templates] AS [n]
WHERE [n].[Id] = @__Parse_0
2025-02-06 14:28:19.404 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@__Parse_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [n].[Id], [n].[additional_data], [n].[big_picture_url], [n].[Body], [n].[body_ar], [n].[body_en], [n].[created_at], [n].[expiry_at], [n].[large_icon_url], [n].[Route], [n].[target_criteria], [n].[Title], [n].[title_ar], [n].[title_en]
FROM [notification_templates] AS [n]
WHERE [n].[Id] = @__Parse_0
2025-02-06 14:28:19.411 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@__Parse_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [n].[Id], [n].[additional_data], [n].[big_picture_url], [n].[Body], [n].[body_ar], [n].[body_en], [n].[created_at], [n].[expiry_at], [n].[large_icon_url], [n].[Route], [n].[target_criteria], [n].[Title], [n].[title_ar], [n].[title_en]
FROM [notification_templates] AS [n]
WHERE [n].[Id] = @__Parse_0
2025-02-06 14:28:19.419 +03:00 [INF] Executed DbCommand (4ms) [Parameters=[@__Parse_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [n].[Id], [n].[additional_data], [n].[big_picture_url], [n].[Body], [n].[body_ar], [n].[body_en], [n].[created_at], [n].[expiry_at], [n].[large_icon_url], [n].[Route], [n].[target_criteria], [n].[Title], [n].[title_ar], [n].[title_en]
FROM [notification_templates] AS [n]
WHERE [n].[Id] = @__Parse_0
2025-02-06 14:28:19.427 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@__Parse_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [n].[Id], [n].[additional_data], [n].[big_picture_url], [n].[Body], [n].[body_ar], [n].[body_en], [n].[created_at], [n].[expiry_at], [n].[large_icon_url], [n].[Route], [n].[target_criteria], [n].[Title], [n].[title_ar], [n].[title_en]
FROM [notification_templates] AS [n]
WHERE [n].[Id] = @__Parse_0
2025-02-06 14:28:19.433 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@__Parse_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [n].[Id], [n].[additional_data], [n].[big_picture_url], [n].[Body], [n].[body_ar], [n].[body_en], [n].[created_at], [n].[expiry_at], [n].[large_icon_url], [n].[Route], [n].[target_criteria], [n].[Title], [n].[title_ar], [n].[title_en]
FROM [notification_templates] AS [n]
WHERE [n].[Id] = @__Parse_0
2025-02-06 14:28:19.438 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@__Parse_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [n].[Id], [n].[additional_data], [n].[big_picture_url], [n].[Body], [n].[body_ar], [n].[body_en], [n].[created_at], [n].[expiry_at], [n].[large_icon_url], [n].[Route], [n].[target_criteria], [n].[Title], [n].[title_ar], [n].[title_en]
FROM [notification_templates] AS [n]
WHERE [n].[Id] = @__Parse_0
2025-02-06 14:28:19.442 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@__Parse_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [n].[Id], [n].[additional_data], [n].[big_picture_url], [n].[Body], [n].[body_ar], [n].[body_en], [n].[created_at], [n].[expiry_at], [n].[large_icon_url], [n].[Route], [n].[target_criteria], [n].[Title], [n].[title_ar], [n].[title_en]
FROM [notification_templates] AS [n]
WHERE [n].[Id] = @__Parse_0
2025-02-06 14:28:19.448 +03:00 [INF] Executed DbCommand (4ms) [Parameters=[@__Parse_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [n].[Id], [n].[additional_data], [n].[big_picture_url], [n].[Body], [n].[body_ar], [n].[body_en], [n].[created_at], [n].[expiry_at], [n].[large_icon_url], [n].[Route], [n].[target_criteria], [n].[Title], [n].[title_ar], [n].[title_en]
FROM [notification_templates] AS [n]
WHERE [n].[Id] = @__Parse_0
2025-02-06 14:28:19.454 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@__Parse_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [n].[Id], [n].[additional_data], [n].[big_picture_url], [n].[Body], [n].[body_ar], [n].[body_en], [n].[created_at], [n].[expiry_at], [n].[large_icon_url], [n].[Route], [n].[target_criteria], [n].[Title], [n].[title_ar], [n].[title_en]
FROM [notification_templates] AS [n]
WHERE [n].[Id] = @__Parse_0
2025-02-06 14:28:19.473 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@__Parse_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [n].[Id], [n].[additional_data], [n].[big_picture_url], [n].[Body], [n].[body_ar], [n].[body_en], [n].[created_at], [n].[expiry_at], [n].[large_icon_url], [n].[Route], [n].[target_criteria], [n].[Title], [n].[title_ar], [n].[title_en]
FROM [notification_templates] AS [n]
WHERE [n].[Id] = @__Parse_0
2025-02-06 14:28:19.480 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@__Parse_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [n].[Id], [n].[additional_data], [n].[big_picture_url], [n].[Body], [n].[body_ar], [n].[body_en], [n].[created_at], [n].[expiry_at], [n].[large_icon_url], [n].[Route], [n].[target_criteria], [n].[Title], [n].[title_ar], [n].[title_en]
FROM [notification_templates] AS [n]
WHERE [n].[Id] = @__Parse_0
2025-02-06 14:28:19.485 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@__Parse_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [n].[Id], [n].[additional_data], [n].[big_picture_url], [n].[Body], [n].[body_ar], [n].[body_en], [n].[created_at], [n].[expiry_at], [n].[large_icon_url], [n].[Route], [n].[target_criteria], [n].[Title], [n].[title_ar], [n].[title_en]
FROM [notification_templates] AS [n]
WHERE [n].[Id] = @__Parse_0
2025-02-06 14:28:19.490 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@__Parse_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [n].[Id], [n].[additional_data], [n].[big_picture_url], [n].[Body], [n].[body_ar], [n].[body_en], [n].[created_at], [n].[expiry_at], [n].[large_icon_url], [n].[Route], [n].[target_criteria], [n].[Title], [n].[title_ar], [n].[title_en]
FROM [notification_templates] AS [n]
WHERE [n].[Id] = @__Parse_0
2025-02-06 14:28:19.700 +03:00 [INF] Executed DbCommand (202ms) [Parameters=[@p0='?' (Size = 4000), @p1='?' (DbType = DateTime2), @p2='?' (Size = 4000), @p3='?' (Size = 4000), @p4='?' (Size = 4000), @p5='?' (Size = 450), @p6='?' (Size = 4000), @p7='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SET IMPLICIT_TRANSACTIONS OFF;
SET NOCOUNT ON;
INSERT INTO [AuthLogs] ([AuthType], [CreatedAt], [DeviceId], [FailureReason], [IpAddress], [NationalId], [Status], [UserAgent])
OUTPUT INSERTED.[Id]
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7);
2025-02-06 14:28:19.705 +03:00 [ERR] An exception occurred in the database while saving changes for context type 'NayifatAPI.Data.ApplicationDbContext'.
Microsoft.EntityFrameworkCore.DbUpdateException: An error occurred while saving the entity changes. See the inner exception for details.
 ---> Microsoft.Data.SqlClient.SqlException (0x80131904): The INSERT statement conflicted with the FOREIGN KEY constraint "FK_AuthLogs_Customers_NationalId". The conflict occurred in database "NayifatApp", table "dbo.Customers", column 'NationalId'.
   at Microsoft.Data.SqlClient.SqlConnection.OnError(SqlException exception, Boolean breakConnection, Action`1 wrapCloseInAction)
   at Microsoft.Data.SqlClient.SqlInternalConnection.OnError(SqlException exception, Boolean breakConnection, Action`1 wrapCloseInAction)
   at Microsoft.Data.SqlClient.TdsParser.ThrowExceptionAndWarning(TdsParserStateObject stateObj, Boolean callerHasConnectionLock, Boolean asyncClose)
   at Microsoft.Data.SqlClient.TdsParser.TryRun(RunBehavior runBehavior, SqlCommand cmdHandler, SqlDataReader dataStream, BulkCopySimpleResultSet bulkCopyHandler, TdsParserStateObject stateObj, Boolean& dataReady)
   at Microsoft.Data.SqlClient.SqlDataReader.TryHasMoreRows(Boolean& moreRows)
   at Microsoft.Data.SqlClient.SqlDataReader.TryReadInternal(Boolean setTimeout, Boolean& more)
   at Microsoft.Data.SqlClient.SqlDataReader.ReadAsyncExecute(Task task, Object state)
   at Microsoft.Data.SqlClient.SqlDataReader.InvokeAsyncCall[T](SqlDataReaderBaseAsyncCallContext`1 context)
--- End of stack trace from previous location ---
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeResultSetAsync(Int32 startCommandIndex, RelationalDataReader reader, CancellationToken cancellationToken)
ClientConnectionId:3c86f457-218f-4b5b-8fdd-a6c97d0074e8
Error Number:547,State:0,Class:16
   --- End of inner exception stack trace ---
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeResultSetAsync(Int32 startCommandIndex, RelationalDataReader reader, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeAsync(RelationalDataReader reader, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Update.Internal.SqlServerModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(IList`1 entriesToSave, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(StateManager stateManager, Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Storage.Internal.SqlServerExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
Microsoft.EntityFrameworkCore.DbUpdateException: An error occurred while saving the entity changes. See the inner exception for details.
 ---> Microsoft.Data.SqlClient.SqlException (0x80131904): The INSERT statement conflicted with the FOREIGN KEY constraint "FK_AuthLogs_Customers_NationalId". The conflict occurred in database "NayifatApp", table "dbo.Customers", column 'NationalId'.
   at Microsoft.Data.SqlClient.SqlConnection.OnError(SqlException exception, Boolean breakConnection, Action`1 wrapCloseInAction)
   at Microsoft.Data.SqlClient.SqlInternalConnection.OnError(SqlException exception, Boolean breakConnection, Action`1 wrapCloseInAction)
   at Microsoft.Data.SqlClient.TdsParser.ThrowExceptionAndWarning(TdsParserStateObject stateObj, Boolean callerHasConnectionLock, Boolean asyncClose)
   at Microsoft.Data.SqlClient.TdsParser.TryRun(RunBehavior runBehavior, SqlCommand cmdHandler, SqlDataReader dataStream, BulkCopySimpleResultSet bulkCopyHandler, TdsParserStateObject stateObj, Boolean& dataReady)
   at Microsoft.Data.SqlClient.SqlDataReader.TryHasMoreRows(Boolean& moreRows)
   at Microsoft.Data.SqlClient.SqlDataReader.TryReadInternal(Boolean setTimeout, Boolean& more)
   at Microsoft.Data.SqlClient.SqlDataReader.ReadAsyncExecute(Task task, Object state)
   at Microsoft.Data.SqlClient.SqlDataReader.InvokeAsyncCall[T](SqlDataReaderBaseAsyncCallContext`1 context)
--- End of stack trace from previous location ---
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeResultSetAsync(Int32 startCommandIndex, RelationalDataReader reader, CancellationToken cancellationToken)
ClientConnectionId:3c86f457-218f-4b5b-8fdd-a6c97d0074e8
Error Number:547,State:0,Class:16
   --- End of inner exception stack trace ---
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeResultSetAsync(Int32 startCommandIndex, RelationalDataReader reader, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeAsync(RelationalDataReader reader, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Update.Internal.SqlServerModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(IList`1 entriesToSave, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(StateManager stateManager, Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Storage.Internal.SqlServerExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
2025-02-06 14:28:19.736 +03:00 [ERR] Error logging audit event. NationalId: all, Action: notification_delivered, Details: {"notification_count":21,"notification_ids":[38,37,36,35,34,33,32,31,30,29,28,27,26,25,24,23,23,20,19,18,12],"timestamp":"2025-02-06T14:28:18.9522801"}
Microsoft.EntityFrameworkCore.DbUpdateException: An error occurred while saving the entity changes. See the inner exception for details.
 ---> Microsoft.Data.SqlClient.SqlException (0x80131904): The INSERT statement conflicted with the FOREIGN KEY constraint "FK_AuthLogs_Customers_NationalId". The conflict occurred in database "NayifatApp", table "dbo.Customers", column 'NationalId'.
   at Microsoft.Data.SqlClient.SqlConnection.OnError(SqlException exception, Boolean breakConnection, Action`1 wrapCloseInAction)
   at Microsoft.Data.SqlClient.SqlInternalConnection.OnError(SqlException exception, Boolean breakConnection, Action`1 wrapCloseInAction)
   at Microsoft.Data.SqlClient.TdsParser.ThrowExceptionAndWarning(TdsParserStateObject stateObj, Boolean callerHasConnectionLock, Boolean asyncClose)
   at Microsoft.Data.SqlClient.TdsParser.TryRun(RunBehavior runBehavior, SqlCommand cmdHandler, SqlDataReader dataStream, BulkCopySimpleResultSet bulkCopyHandler, TdsParserStateObject stateObj, Boolean& dataReady)
   at Microsoft.Data.SqlClient.SqlDataReader.TryHasMoreRows(Boolean& moreRows)
   at Microsoft.Data.SqlClient.SqlDataReader.TryReadInternal(Boolean setTimeout, Boolean& more)
   at Microsoft.Data.SqlClient.SqlDataReader.ReadAsyncExecute(Task task, Object state)
   at Microsoft.Data.SqlClient.SqlDataReader.InvokeAsyncCall[T](SqlDataReaderBaseAsyncCallContext`1 context)
--- End of stack trace from previous location ---
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeResultSetAsync(Int32 startCommandIndex, RelationalDataReader reader, CancellationToken cancellationToken)
ClientConnectionId:3c86f457-218f-4b5b-8fdd-a6c97d0074e8
Error Number:547,State:0,Class:16
   --- End of inner exception stack trace ---
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeResultSetAsync(Int32 startCommandIndex, RelationalDataReader reader, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeAsync(RelationalDataReader reader, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Update.Internal.SqlServerModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(IList`1 entriesToSave, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(StateManager stateManager, Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Storage.Internal.SqlServerExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at NayifatAPI.Services.AuditLogService.LogAsync(String nationalId, String action, Object details) in C:\Users\yamta\StudioProjects\nayifat_app_2025_new\NayifatAPI\Services\AuditLogService.cs:line 36
2025-02-06 14:28:19.811 +03:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType11`2[[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Object, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-02-06 14:28:19.817 +03:00 [INF] Executed action NayifatAPI.Controllers.NotificationsController.GetNotifications (NayifatAPI) in 879.5748ms
2025-02-06 14:28:19.827 +03:00 [INF] Executed endpoint 'NayifatAPI.Controllers.NotificationsController.GetNotifications (NayifatAPI)'
2025-02-06 14:28:19.846 +03:00 [INF] Request finished HTTP/1.1 POST http://eb3c-46-152-255-232.ngrok-free.app/api/notifications/list - 200 null application/json; charset=utf-8 921.405ms
2025-02-06 14:32:45.421 +03:00 [INF] Request starting HTTP/1.1 POST http://eb3c-46-152-255-232.ngrok-free.app/api/notifications/list - application/json 39
2025-02-06 14:32:45.424 +03:00 [INF] Executing endpoint 'NayifatAPI.Controllers.NotificationsController.GetNotifications (NayifatAPI)'
2025-02-06 14:32:45.425 +03:00 [INF] Route matched with {action = "GetNotifications", controller = "Notifications"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetNotifications(NayifatAPI.Controllers.GetNotificationsRequest) on controller NayifatAPI.Controllers.NotificationsController (NayifatAPI).
2025-02-06 14:32:45.511 +03:00 [INF] Executed DbCommand (82ms) [Parameters=[@__providedApiKey_0='?' (Size = 255)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [a].[api_Key], [a].[CreatedAt], [a].[Description], [a].[ExpiresAt], [a].[IsActive], [a].[LastUsedAt]
FROM [ApiKeys] AS [a]
WHERE [a].[api_Key] = @__providedApiKey_0 AND [a].[IsActive] = CAST(1 AS bit)
2025-02-06 14:32:45.520 +03:00 [INF] Executed DbCommand (5ms) [Parameters=[@__request_NationalId_0='?' (Size = 450)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [u].[national_id], [u].[last_updated], [u].[notifications]
FROM [user_notifications] AS [u]
WHERE [u].[national_id] = @__request_NationalId_0
2025-02-06 14:32:45.528 +03:00 [INF] Executed DbCommand (5ms) [Parameters=[@__Parse_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [n].[Id], [n].[additional_data], [n].[big_picture_url], [n].[Body], [n].[body_ar], [n].[body_en], [n].[created_at], [n].[expiry_at], [n].[large_icon_url], [n].[Route], [n].[target_criteria], [n].[Title], [n].[title_ar], [n].[title_en]
FROM [notification_templates] AS [n]
WHERE [n].[Id] = @__Parse_0
2025-02-06 14:32:45.533 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@__Parse_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [n].[Id], [n].[additional_data], [n].[big_picture_url], [n].[Body], [n].[body_ar], [n].[body_en], [n].[created_at], [n].[expiry_at], [n].[large_icon_url], [n].[Route], [n].[target_criteria], [n].[Title], [n].[title_ar], [n].[title_en]
FROM [notification_templates] AS [n]
WHERE [n].[Id] = @__Parse_0
2025-02-06 14:32:45.536 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@__Parse_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [n].[Id], [n].[additional_data], [n].[big_picture_url], [n].[Body], [n].[body_ar], [n].[body_en], [n].[created_at], [n].[expiry_at], [n].[large_icon_url], [n].[Route], [n].[target_criteria], [n].[Title], [n].[title_ar], [n].[title_en]
FROM [notification_templates] AS [n]
WHERE [n].[Id] = @__Parse_0
2025-02-06 14:32:45.539 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@__Parse_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [n].[Id], [n].[additional_data], [n].[big_picture_url], [n].[Body], [n].[body_ar], [n].[body_en], [n].[created_at], [n].[expiry_at], [n].[large_icon_url], [n].[Route], [n].[target_criteria], [n].[Title], [n].[title_ar], [n].[title_en]
FROM [notification_templates] AS [n]
WHERE [n].[Id] = @__Parse_0
2025-02-06 14:32:45.542 +03:00 [INF] Executed DbCommand (0ms) [Parameters=[@__Parse_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [n].[Id], [n].[additional_data], [n].[big_picture_url], [n].[Body], [n].[body_ar], [n].[body_en], [n].[created_at], [n].[expiry_at], [n].[large_icon_url], [n].[Route], [n].[target_criteria], [n].[Title], [n].[title_ar], [n].[title_en]
FROM [notification_templates] AS [n]
WHERE [n].[Id] = @__Parse_0
2025-02-06 14:32:45.545 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@__Parse_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [n].[Id], [n].[additional_data], [n].[big_picture_url], [n].[Body], [n].[body_ar], [n].[body_en], [n].[created_at], [n].[expiry_at], [n].[large_icon_url], [n].[Route], [n].[target_criteria], [n].[Title], [n].[title_ar], [n].[title_en]
FROM [notification_templates] AS [n]
WHERE [n].[Id] = @__Parse_0
2025-02-06 14:32:45.555 +03:00 [INF] Executed DbCommand (2ms) [Parameters=[@__Parse_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [n].[Id], [n].[additional_data], [n].[big_picture_url], [n].[Body], [n].[body_ar], [n].[body_en], [n].[created_at], [n].[expiry_at], [n].[large_icon_url], [n].[Route], [n].[target_criteria], [n].[Title], [n].[title_ar], [n].[title_en]
FROM [notification_templates] AS [n]
WHERE [n].[Id] = @__Parse_0
2025-02-06 14:32:45.561 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@__Parse_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [n].[Id], [n].[additional_data], [n].[big_picture_url], [n].[Body], [n].[body_ar], [n].[body_en], [n].[created_at], [n].[expiry_at], [n].[large_icon_url], [n].[Route], [n].[target_criteria], [n].[Title], [n].[title_ar], [n].[title_en]
FROM [notification_templates] AS [n]
WHERE [n].[Id] = @__Parse_0
2025-02-06 14:32:45.568 +03:00 [INF] Executed DbCommand (2ms) [Parameters=[@__Parse_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [n].[Id], [n].[additional_data], [n].[big_picture_url], [n].[Body], [n].[body_ar], [n].[body_en], [n].[created_at], [n].[expiry_at], [n].[large_icon_url], [n].[Route], [n].[target_criteria], [n].[Title], [n].[title_ar], [n].[title_en]
FROM [notification_templates] AS [n]
WHERE [n].[Id] = @__Parse_0
2025-02-06 14:32:45.572 +03:00 [INF] Executed DbCommand (0ms) [Parameters=[@__Parse_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [n].[Id], [n].[additional_data], [n].[big_picture_url], [n].[Body], [n].[body_ar], [n].[body_en], [n].[created_at], [n].[expiry_at], [n].[large_icon_url], [n].[Route], [n].[target_criteria], [n].[Title], [n].[title_ar], [n].[title_en]
FROM [notification_templates] AS [n]
WHERE [n].[Id] = @__Parse_0
2025-02-06 14:32:45.575 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@__Parse_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [n].[Id], [n].[additional_data], [n].[big_picture_url], [n].[Body], [n].[body_ar], [n].[body_en], [n].[created_at], [n].[expiry_at], [n].[large_icon_url], [n].[Route], [n].[target_criteria], [n].[Title], [n].[title_ar], [n].[title_en]
FROM [notification_templates] AS [n]
WHERE [n].[Id] = @__Parse_0
2025-02-06 14:32:45.581 +03:00 [INF] Executed DbCommand (2ms) [Parameters=[@__Parse_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [n].[Id], [n].[additional_data], [n].[big_picture_url], [n].[Body], [n].[body_ar], [n].[body_en], [n].[created_at], [n].[expiry_at], [n].[large_icon_url], [n].[Route], [n].[target_criteria], [n].[Title], [n].[title_ar], [n].[title_en]
FROM [notification_templates] AS [n]
WHERE [n].[Id] = @__Parse_0
2025-02-06 14:32:45.588 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@__Parse_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [n].[Id], [n].[additional_data], [n].[big_picture_url], [n].[Body], [n].[body_ar], [n].[body_en], [n].[created_at], [n].[expiry_at], [n].[large_icon_url], [n].[Route], [n].[target_criteria], [n].[Title], [n].[title_ar], [n].[title_en]
FROM [notification_templates] AS [n]
WHERE [n].[Id] = @__Parse_0
2025-02-06 14:32:45.591 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@__Parse_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [n].[Id], [n].[additional_data], [n].[big_picture_url], [n].[Body], [n].[body_ar], [n].[body_en], [n].[created_at], [n].[expiry_at], [n].[large_icon_url], [n].[Route], [n].[target_criteria], [n].[Title], [n].[title_ar], [n].[title_en]
FROM [notification_templates] AS [n]
WHERE [n].[Id] = @__Parse_0
2025-02-06 14:32:45.594 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@__Parse_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [n].[Id], [n].[additional_data], [n].[big_picture_url], [n].[Body], [n].[body_ar], [n].[body_en], [n].[created_at], [n].[expiry_at], [n].[large_icon_url], [n].[Route], [n].[target_criteria], [n].[Title], [n].[title_ar], [n].[title_en]
FROM [notification_templates] AS [n]
WHERE [n].[Id] = @__Parse_0
2025-02-06 14:32:45.597 +03:00 [INF] Executed DbCommand (0ms) [Parameters=[@__Parse_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [n].[Id], [n].[additional_data], [n].[big_picture_url], [n].[Body], [n].[body_ar], [n].[body_en], [n].[created_at], [n].[expiry_at], [n].[large_icon_url], [n].[Route], [n].[target_criteria], [n].[Title], [n].[title_ar], [n].[title_en]
FROM [notification_templates] AS [n]
WHERE [n].[Id] = @__Parse_0
2025-02-06 14:32:45.601 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@__Parse_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [n].[Id], [n].[additional_data], [n].[big_picture_url], [n].[Body], [n].[body_ar], [n].[body_en], [n].[created_at], [n].[expiry_at], [n].[large_icon_url], [n].[Route], [n].[target_criteria], [n].[Title], [n].[title_ar], [n].[title_en]
FROM [notification_templates] AS [n]
WHERE [n].[Id] = @__Parse_0
2025-02-06 14:32:45.604 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@__Parse_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [n].[Id], [n].[additional_data], [n].[big_picture_url], [n].[Body], [n].[body_ar], [n].[body_en], [n].[created_at], [n].[expiry_at], [n].[large_icon_url], [n].[Route], [n].[target_criteria], [n].[Title], [n].[title_ar], [n].[title_en]
FROM [notification_templates] AS [n]
WHERE [n].[Id] = @__Parse_0
2025-02-06 14:32:45.607 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@__Parse_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [n].[Id], [n].[additional_data], [n].[big_picture_url], [n].[Body], [n].[body_ar], [n].[body_en], [n].[created_at], [n].[expiry_at], [n].[large_icon_url], [n].[Route], [n].[target_criteria], [n].[Title], [n].[title_ar], [n].[title_en]
FROM [notification_templates] AS [n]
WHERE [n].[Id] = @__Parse_0
2025-02-06 14:32:45.609 +03:00 [INF] Executed DbCommand (0ms) [Parameters=[@__Parse_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [n].[Id], [n].[additional_data], [n].[big_picture_url], [n].[Body], [n].[body_ar], [n].[body_en], [n].[created_at], [n].[expiry_at], [n].[large_icon_url], [n].[Route], [n].[target_criteria], [n].[Title], [n].[title_ar], [n].[title_en]
FROM [notification_templates] AS [n]
WHERE [n].[Id] = @__Parse_0
2025-02-06 14:32:45.612 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@__Parse_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [n].[Id], [n].[additional_data], [n].[big_picture_url], [n].[Body], [n].[body_ar], [n].[body_en], [n].[created_at], [n].[expiry_at], [n].[large_icon_url], [n].[Route], [n].[target_criteria], [n].[Title], [n].[title_ar], [n].[title_en]
FROM [notification_templates] AS [n]
WHERE [n].[Id] = @__Parse_0
2025-02-06 14:32:45.643 +03:00 [INF] Executed DbCommand (26ms) [Parameters=[@p0='?' (Size = 4000), @p1='?' (DbType = DateTime2), @p2='?' (Size = 4000), @p3='?' (Size = 4000), @p4='?' (Size = 4000), @p5='?' (Size = 450), @p6='?' (Size = 4000), @p7='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SET IMPLICIT_TRANSACTIONS OFF;
SET NOCOUNT ON;
INSERT INTO [AuthLogs] ([AuthType], [CreatedAt], [DeviceId], [FailureReason], [IpAddress], [NationalId], [Status], [UserAgent])
OUTPUT INSERTED.[Id]
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7);
2025-02-06 14:32:45.647 +03:00 [ERR] An exception occurred in the database while saving changes for context type 'NayifatAPI.Data.ApplicationDbContext'.
Microsoft.EntityFrameworkCore.DbUpdateException: An error occurred while saving the entity changes. See the inner exception for details.
 ---> Microsoft.Data.SqlClient.SqlException (0x80131904): The INSERT statement conflicted with the FOREIGN KEY constraint "FK_AuthLogs_Customers_NationalId". The conflict occurred in database "NayifatApp", table "dbo.Customers", column 'NationalId'.
   at Microsoft.Data.SqlClient.SqlConnection.OnError(SqlException exception, Boolean breakConnection, Action`1 wrapCloseInAction)
   at Microsoft.Data.SqlClient.SqlInternalConnection.OnError(SqlException exception, Boolean breakConnection, Action`1 wrapCloseInAction)
   at Microsoft.Data.SqlClient.TdsParser.ThrowExceptionAndWarning(TdsParserStateObject stateObj, Boolean callerHasConnectionLock, Boolean asyncClose)
   at Microsoft.Data.SqlClient.TdsParser.TryRun(RunBehavior runBehavior, SqlCommand cmdHandler, SqlDataReader dataStream, BulkCopySimpleResultSet bulkCopyHandler, TdsParserStateObject stateObj, Boolean& dataReady)
   at Microsoft.Data.SqlClient.SqlDataReader.TryHasMoreRows(Boolean& moreRows)
   at Microsoft.Data.SqlClient.SqlDataReader.TryReadInternal(Boolean setTimeout, Boolean& more)
   at Microsoft.Data.SqlClient.SqlDataReader.ReadAsyncExecute(Task task, Object state)
   at Microsoft.Data.SqlClient.SqlDataReader.InvokeAsyncCall[T](SqlDataReaderBaseAsyncCallContext`1 context)
--- End of stack trace from previous location ---
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeResultSetAsync(Int32 startCommandIndex, RelationalDataReader reader, CancellationToken cancellationToken)
ClientConnectionId:3c86f457-218f-4b5b-8fdd-a6c97d0074e8
Error Number:547,State:0,Class:16
   --- End of inner exception stack trace ---
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeResultSetAsync(Int32 startCommandIndex, RelationalDataReader reader, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeAsync(RelationalDataReader reader, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Update.Internal.SqlServerModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(IList`1 entriesToSave, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(StateManager stateManager, Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Storage.Internal.SqlServerExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
Microsoft.EntityFrameworkCore.DbUpdateException: An error occurred while saving the entity changes. See the inner exception for details.
 ---> Microsoft.Data.SqlClient.SqlException (0x80131904): The INSERT statement conflicted with the FOREIGN KEY constraint "FK_AuthLogs_Customers_NationalId". The conflict occurred in database "NayifatApp", table "dbo.Customers", column 'NationalId'.
   at Microsoft.Data.SqlClient.SqlConnection.OnError(SqlException exception, Boolean breakConnection, Action`1 wrapCloseInAction)
   at Microsoft.Data.SqlClient.SqlInternalConnection.OnError(SqlException exception, Boolean breakConnection, Action`1 wrapCloseInAction)
   at Microsoft.Data.SqlClient.TdsParser.ThrowExceptionAndWarning(TdsParserStateObject stateObj, Boolean callerHasConnectionLock, Boolean asyncClose)
   at Microsoft.Data.SqlClient.TdsParser.TryRun(RunBehavior runBehavior, SqlCommand cmdHandler, SqlDataReader dataStream, BulkCopySimpleResultSet bulkCopyHandler, TdsParserStateObject stateObj, Boolean& dataReady)
   at Microsoft.Data.SqlClient.SqlDataReader.TryHasMoreRows(Boolean& moreRows)
   at Microsoft.Data.SqlClient.SqlDataReader.TryReadInternal(Boolean setTimeout, Boolean& more)
   at Microsoft.Data.SqlClient.SqlDataReader.ReadAsyncExecute(Task task, Object state)
   at Microsoft.Data.SqlClient.SqlDataReader.InvokeAsyncCall[T](SqlDataReaderBaseAsyncCallContext`1 context)
--- End of stack trace from previous location ---
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeResultSetAsync(Int32 startCommandIndex, RelationalDataReader reader, CancellationToken cancellationToken)
ClientConnectionId:3c86f457-218f-4b5b-8fdd-a6c97d0074e8
Error Number:547,State:0,Class:16
   --- End of inner exception stack trace ---
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeResultSetAsync(Int32 startCommandIndex, RelationalDataReader reader, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeAsync(RelationalDataReader reader, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Update.Internal.SqlServerModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(IList`1 entriesToSave, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(StateManager stateManager, Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Storage.Internal.SqlServerExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
2025-02-06 14:32:45.659 +03:00 [ERR] Error logging audit event. NationalId: all, Action: notification_delivered, Details: {"notification_count":21,"notification_ids":[38,37,36,35,34,33,32,31,30,29,28,27,26,25,24,23,23,20,19,18,12],"timestamp":"2025-02-06T14:32:45.5229522"}
Microsoft.EntityFrameworkCore.DbUpdateException: An error occurred while saving the entity changes. See the inner exception for details.
 ---> Microsoft.Data.SqlClient.SqlException (0x80131904): The INSERT statement conflicted with the FOREIGN KEY constraint "FK_AuthLogs_Customers_NationalId". The conflict occurred in database "NayifatApp", table "dbo.Customers", column 'NationalId'.
   at Microsoft.Data.SqlClient.SqlConnection.OnError(SqlException exception, Boolean breakConnection, Action`1 wrapCloseInAction)
   at Microsoft.Data.SqlClient.SqlInternalConnection.OnError(SqlException exception, Boolean breakConnection, Action`1 wrapCloseInAction)
   at Microsoft.Data.SqlClient.TdsParser.ThrowExceptionAndWarning(TdsParserStateObject stateObj, Boolean callerHasConnectionLock, Boolean asyncClose)
   at Microsoft.Data.SqlClient.TdsParser.TryRun(RunBehavior runBehavior, SqlCommand cmdHandler, SqlDataReader dataStream, BulkCopySimpleResultSet bulkCopyHandler, TdsParserStateObject stateObj, Boolean& dataReady)
   at Microsoft.Data.SqlClient.SqlDataReader.TryHasMoreRows(Boolean& moreRows)
   at Microsoft.Data.SqlClient.SqlDataReader.TryReadInternal(Boolean setTimeout, Boolean& more)
   at Microsoft.Data.SqlClient.SqlDataReader.ReadAsyncExecute(Task task, Object state)
   at Microsoft.Data.SqlClient.SqlDataReader.InvokeAsyncCall[T](SqlDataReaderBaseAsyncCallContext`1 context)
--- End of stack trace from previous location ---
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeResultSetAsync(Int32 startCommandIndex, RelationalDataReader reader, CancellationToken cancellationToken)
ClientConnectionId:3c86f457-218f-4b5b-8fdd-a6c97d0074e8
Error Number:547,State:0,Class:16
   --- End of inner exception stack trace ---
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeResultSetAsync(Int32 startCommandIndex, RelationalDataReader reader, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeAsync(RelationalDataReader reader, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Update.Internal.SqlServerModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(IList`1 entriesToSave, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(StateManager stateManager, Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Storage.Internal.SqlServerExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at NayifatAPI.Services.AuditLogService.LogAsync(String nationalId, String action, Object details) in C:\Users\yamta\StudioProjects\nayifat_app_2025_new\NayifatAPI\Services\AuditLogService.cs:line 36
2025-02-06 14:32:45.668 +03:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType11`2[[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Object, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-02-06 14:32:45.670 +03:00 [INF] Executed action NayifatAPI.Controllers.NotificationsController.GetNotifications (NayifatAPI) in 242.8034ms
2025-02-06 14:32:45.671 +03:00 [INF] Executed endpoint 'NayifatAPI.Controllers.NotificationsController.GetNotifications (NayifatAPI)'
2025-02-06 14:32:45.672 +03:00 [INF] Request finished HTTP/1.1 POST http://eb3c-46-152-255-232.ngrok-free.app/api/notifications/list - 200 null application/json; charset=utf-8 251.0303ms
2025-02-06 14:32:45.687 +03:00 [INF] Request starting HTTP/1.1 POST http://eb3c-46-152-255-232.ngrok-free.app/api/notifications/list - application/json 39
2025-02-06 14:32:45.689 +03:00 [INF] Executing endpoint 'NayifatAPI.Controllers.NotificationsController.GetNotifications (NayifatAPI)'
2025-02-06 14:32:45.690 +03:00 [INF] Route matched with {action = "GetNotifications", controller = "Notifications"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetNotifications(NayifatAPI.Controllers.GetNotificationsRequest) on controller NayifatAPI.Controllers.NotificationsController (NayifatAPI).
2025-02-06 14:32:45.695 +03:00 [INF] Executed DbCommand (2ms) [Parameters=[@__providedApiKey_0='?' (Size = 255)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [a].[api_Key], [a].[CreatedAt], [a].[Description], [a].[ExpiresAt], [a].[IsActive], [a].[LastUsedAt]
FROM [ApiKeys] AS [a]
WHERE [a].[api_Key] = @__providedApiKey_0 AND [a].[IsActive] = CAST(1 AS bit)
2025-02-06 14:32:45.703 +03:00 [INF] Executed DbCommand (4ms) [Parameters=[@__request_NationalId_0='?' (Size = 450)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [u].[national_id], [u].[last_updated], [u].[notifications]
FROM [user_notifications] AS [u]
WHERE [u].[national_id] = @__request_NationalId_0
2025-02-06 14:32:45.707 +03:00 [INF] Executed DbCommand (2ms) [Parameters=[@__Parse_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [n].[Id], [n].[additional_data], [n].[big_picture_url], [n].[Body], [n].[body_ar], [n].[body_en], [n].[created_at], [n].[expiry_at], [n].[large_icon_url], [n].[Route], [n].[target_criteria], [n].[Title], [n].[title_ar], [n].[title_en]
FROM [notification_templates] AS [n]
WHERE [n].[Id] = @__Parse_0
2025-02-06 14:32:45.710 +03:00 [INF] Executed DbCommand (0ms) [Parameters=[@__Parse_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [n].[Id], [n].[additional_data], [n].[big_picture_url], [n].[Body], [n].[body_ar], [n].[body_en], [n].[created_at], [n].[expiry_at], [n].[large_icon_url], [n].[Route], [n].[target_criteria], [n].[Title], [n].[title_ar], [n].[title_en]
FROM [notification_templates] AS [n]
WHERE [n].[Id] = @__Parse_0
2025-02-06 14:32:45.713 +03:00 [INF] Executed DbCommand (0ms) [Parameters=[@__Parse_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [n].[Id], [n].[additional_data], [n].[big_picture_url], [n].[Body], [n].[body_ar], [n].[body_en], [n].[created_at], [n].[expiry_at], [n].[large_icon_url], [n].[Route], [n].[target_criteria], [n].[Title], [n].[title_ar], [n].[title_en]
FROM [notification_templates] AS [n]
WHERE [n].[Id] = @__Parse_0
2025-02-06 14:32:45.716 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@__Parse_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [n].[Id], [n].[additional_data], [n].[big_picture_url], [n].[Body], [n].[body_ar], [n].[body_en], [n].[created_at], [n].[expiry_at], [n].[large_icon_url], [n].[Route], [n].[target_criteria], [n].[Title], [n].[title_ar], [n].[title_en]
FROM [notification_templates] AS [n]
WHERE [n].[Id] = @__Parse_0
2025-02-06 14:32:45.719 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@__Parse_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [n].[Id], [n].[additional_data], [n].[big_picture_url], [n].[Body], [n].[body_ar], [n].[body_en], [n].[created_at], [n].[expiry_at], [n].[large_icon_url], [n].[Route], [n].[target_criteria], [n].[Title], [n].[title_ar], [n].[title_en]
FROM [notification_templates] AS [n]
WHERE [n].[Id] = @__Parse_0
2025-02-06 14:32:45.722 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@__Parse_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [n].[Id], [n].[additional_data], [n].[big_picture_url], [n].[Body], [n].[body_ar], [n].[body_en], [n].[created_at], [n].[expiry_at], [n].[large_icon_url], [n].[Route], [n].[target_criteria], [n].[Title], [n].[title_ar], [n].[title_en]
FROM [notification_templates] AS [n]
WHERE [n].[Id] = @__Parse_0
2025-02-06 14:32:45.725 +03:00 [INF] Executed DbCommand (0ms) [Parameters=[@__Parse_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [n].[Id], [n].[additional_data], [n].[big_picture_url], [n].[Body], [n].[body_ar], [n].[body_en], [n].[created_at], [n].[expiry_at], [n].[large_icon_url], [n].[Route], [n].[target_criteria], [n].[Title], [n].[title_ar], [n].[title_en]
FROM [notification_templates] AS [n]
WHERE [n].[Id] = @__Parse_0
2025-02-06 14:32:45.728 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@__Parse_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [n].[Id], [n].[additional_data], [n].[big_picture_url], [n].[Body], [n].[body_ar], [n].[body_en], [n].[created_at], [n].[expiry_at], [n].[large_icon_url], [n].[Route], [n].[target_criteria], [n].[Title], [n].[title_ar], [n].[title_en]
FROM [notification_templates] AS [n]
WHERE [n].[Id] = @__Parse_0
2025-02-06 14:32:45.731 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@__Parse_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [n].[Id], [n].[additional_data], [n].[big_picture_url], [n].[Body], [n].[body_ar], [n].[body_en], [n].[created_at], [n].[expiry_at], [n].[large_icon_url], [n].[Route], [n].[target_criteria], [n].[Title], [n].[title_ar], [n].[title_en]
FROM [notification_templates] AS [n]
WHERE [n].[Id] = @__Parse_0
2025-02-06 14:32:45.734 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@__Parse_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [n].[Id], [n].[additional_data], [n].[big_picture_url], [n].[Body], [n].[body_ar], [n].[body_en], [n].[created_at], [n].[expiry_at], [n].[large_icon_url], [n].[Route], [n].[target_criteria], [n].[Title], [n].[title_ar], [n].[title_en]
FROM [notification_templates] AS [n]
WHERE [n].[Id] = @__Parse_0
2025-02-06 14:32:45.737 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@__Parse_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [n].[Id], [n].[additional_data], [n].[big_picture_url], [n].[Body], [n].[body_ar], [n].[body_en], [n].[created_at], [n].[expiry_at], [n].[large_icon_url], [n].[Route], [n].[target_criteria], [n].[Title], [n].[title_ar], [n].[title_en]
FROM [notification_templates] AS [n]
WHERE [n].[Id] = @__Parse_0
2025-02-06 14:32:45.740 +03:00 [INF] Executed DbCommand (0ms) [Parameters=[@__Parse_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [n].[Id], [n].[additional_data], [n].[big_picture_url], [n].[Body], [n].[body_ar], [n].[body_en], [n].[created_at], [n].[expiry_at], [n].[large_icon_url], [n].[Route], [n].[target_criteria], [n].[Title], [n].[title_ar], [n].[title_en]
FROM [notification_templates] AS [n]
WHERE [n].[Id] = @__Parse_0
2025-02-06 14:32:45.743 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@__Parse_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [n].[Id], [n].[additional_data], [n].[big_picture_url], [n].[Body], [n].[body_ar], [n].[body_en], [n].[created_at], [n].[expiry_at], [n].[large_icon_url], [n].[Route], [n].[target_criteria], [n].[Title], [n].[title_ar], [n].[title_en]
FROM [notification_templates] AS [n]
WHERE [n].[Id] = @__Parse_0
2025-02-06 14:32:45.746 +03:00 [INF] Executed DbCommand (0ms) [Parameters=[@__Parse_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [n].[Id], [n].[additional_data], [n].[big_picture_url], [n].[Body], [n].[body_ar], [n].[body_en], [n].[created_at], [n].[expiry_at], [n].[large_icon_url], [n].[Route], [n].[target_criteria], [n].[Title], [n].[title_ar], [n].[title_en]
FROM [notification_templates] AS [n]
WHERE [n].[Id] = @__Parse_0
2025-02-06 14:32:45.749 +03:00 [INF] Executed DbCommand (0ms) [Parameters=[@__Parse_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [n].[Id], [n].[additional_data], [n].[big_picture_url], [n].[Body], [n].[body_ar], [n].[body_en], [n].[created_at], [n].[expiry_at], [n].[large_icon_url], [n].[Route], [n].[target_criteria], [n].[Title], [n].[title_ar], [n].[title_en]
FROM [notification_templates] AS [n]
WHERE [n].[Id] = @__Parse_0
2025-02-06 14:32:45.755 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@__Parse_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [n].[Id], [n].[additional_data], [n].[big_picture_url], [n].[Body], [n].[body_ar], [n].[body_en], [n].[created_at], [n].[expiry_at], [n].[large_icon_url], [n].[Route], [n].[target_criteria], [n].[Title], [n].[title_ar], [n].[title_en]
FROM [notification_templates] AS [n]
WHERE [n].[Id] = @__Parse_0
2025-02-06 14:32:45.758 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@__Parse_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [n].[Id], [n].[additional_data], [n].[big_picture_url], [n].[Body], [n].[body_ar], [n].[body_en], [n].[created_at], [n].[expiry_at], [n].[large_icon_url], [n].[Route], [n].[target_criteria], [n].[Title], [n].[title_ar], [n].[title_en]
FROM [notification_templates] AS [n]
WHERE [n].[Id] = @__Parse_0
2025-02-06 14:32:45.761 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@__Parse_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [n].[Id], [n].[additional_data], [n].[big_picture_url], [n].[Body], [n].[body_ar], [n].[body_en], [n].[created_at], [n].[expiry_at], [n].[large_icon_url], [n].[Route], [n].[target_criteria], [n].[Title], [n].[title_ar], [n].[title_en]
FROM [notification_templates] AS [n]
WHERE [n].[Id] = @__Parse_0
2025-02-06 14:32:45.764 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@__Parse_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [n].[Id], [n].[additional_data], [n].[big_picture_url], [n].[Body], [n].[body_ar], [n].[body_en], [n].[created_at], [n].[expiry_at], [n].[large_icon_url], [n].[Route], [n].[target_criteria], [n].[Title], [n].[title_ar], [n].[title_en]
FROM [notification_templates] AS [n]
WHERE [n].[Id] = @__Parse_0
2025-02-06 14:32:45.769 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@__Parse_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [n].[Id], [n].[additional_data], [n].[big_picture_url], [n].[Body], [n].[body_ar], [n].[body_en], [n].[created_at], [n].[expiry_at], [n].[large_icon_url], [n].[Route], [n].[target_criteria], [n].[Title], [n].[title_ar], [n].[title_en]
FROM [notification_templates] AS [n]
WHERE [n].[Id] = @__Parse_0
2025-02-06 14:32:45.773 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@__Parse_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [n].[Id], [n].[additional_data], [n].[big_picture_url], [n].[Body], [n].[body_ar], [n].[body_en], [n].[created_at], [n].[expiry_at], [n].[large_icon_url], [n].[Route], [n].[target_criteria], [n].[Title], [n].[title_ar], [n].[title_en]
FROM [notification_templates] AS [n]
WHERE [n].[Id] = @__Parse_0
2025-02-06 14:32:45.785 +03:00 [INF] Executed DbCommand (8ms) [Parameters=[@p0='?' (Size = 4000), @p1='?' (DbType = DateTime2), @p2='?' (Size = 4000), @p3='?' (Size = 4000), @p4='?' (Size = 4000), @p5='?' (Size = 450), @p6='?' (Size = 4000), @p7='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SET IMPLICIT_TRANSACTIONS OFF;
SET NOCOUNT ON;
INSERT INTO [AuthLogs] ([AuthType], [CreatedAt], [DeviceId], [FailureReason], [IpAddress], [NationalId], [Status], [UserAgent])
OUTPUT INSERTED.[Id]
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7);
2025-02-06 14:32:45.790 +03:00 [ERR] An exception occurred in the database while saving changes for context type 'NayifatAPI.Data.ApplicationDbContext'.
Microsoft.EntityFrameworkCore.DbUpdateException: An error occurred while saving the entity changes. See the inner exception for details.
 ---> Microsoft.Data.SqlClient.SqlException (0x80131904): The INSERT statement conflicted with the FOREIGN KEY constraint "FK_AuthLogs_Customers_NationalId". The conflict occurred in database "NayifatApp", table "dbo.Customers", column 'NationalId'.
   at Microsoft.Data.SqlClient.SqlConnection.OnError(SqlException exception, Boolean breakConnection, Action`1 wrapCloseInAction)
   at Microsoft.Data.SqlClient.SqlInternalConnection.OnError(SqlException exception, Boolean breakConnection, Action`1 wrapCloseInAction)
   at Microsoft.Data.SqlClient.TdsParser.ThrowExceptionAndWarning(TdsParserStateObject stateObj, Boolean callerHasConnectionLock, Boolean asyncClose)
   at Microsoft.Data.SqlClient.TdsParser.TryRun(RunBehavior runBehavior, SqlCommand cmdHandler, SqlDataReader dataStream, BulkCopySimpleResultSet bulkCopyHandler, TdsParserStateObject stateObj, Boolean& dataReady)
   at Microsoft.Data.SqlClient.SqlDataReader.TryHasMoreRows(Boolean& moreRows)
   at Microsoft.Data.SqlClient.SqlDataReader.TryReadInternal(Boolean setTimeout, Boolean& more)
   at Microsoft.Data.SqlClient.SqlDataReader.ReadAsyncExecute(Task task, Object state)
   at Microsoft.Data.SqlClient.SqlDataReader.InvokeAsyncCall[T](SqlDataReaderBaseAsyncCallContext`1 context)
--- End of stack trace from previous location ---
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeResultSetAsync(Int32 startCommandIndex, RelationalDataReader reader, CancellationToken cancellationToken)
ClientConnectionId:3c86f457-218f-4b5b-8fdd-a6c97d0074e8
Error Number:547,State:0,Class:16
   --- End of inner exception stack trace ---
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeResultSetAsync(Int32 startCommandIndex, RelationalDataReader reader, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeAsync(RelationalDataReader reader, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Update.Internal.SqlServerModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(IList`1 entriesToSave, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(StateManager stateManager, Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Storage.Internal.SqlServerExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
Microsoft.EntityFrameworkCore.DbUpdateException: An error occurred while saving the entity changes. See the inner exception for details.
 ---> Microsoft.Data.SqlClient.SqlException (0x80131904): The INSERT statement conflicted with the FOREIGN KEY constraint "FK_AuthLogs_Customers_NationalId". The conflict occurred in database "NayifatApp", table "dbo.Customers", column 'NationalId'.
   at Microsoft.Data.SqlClient.SqlConnection.OnError(SqlException exception, Boolean breakConnection, Action`1 wrapCloseInAction)
   at Microsoft.Data.SqlClient.SqlInternalConnection.OnError(SqlException exception, Boolean breakConnection, Action`1 wrapCloseInAction)
   at Microsoft.Data.SqlClient.TdsParser.ThrowExceptionAndWarning(TdsParserStateObject stateObj, Boolean callerHasConnectionLock, Boolean asyncClose)
   at Microsoft.Data.SqlClient.TdsParser.TryRun(RunBehavior runBehavior, SqlCommand cmdHandler, SqlDataReader dataStream, BulkCopySimpleResultSet bulkCopyHandler, TdsParserStateObject stateObj, Boolean& dataReady)
   at Microsoft.Data.SqlClient.SqlDataReader.TryHasMoreRows(Boolean& moreRows)
   at Microsoft.Data.SqlClient.SqlDataReader.TryReadInternal(Boolean setTimeout, Boolean& more)
   at Microsoft.Data.SqlClient.SqlDataReader.ReadAsyncExecute(Task task, Object state)
   at Microsoft.Data.SqlClient.SqlDataReader.InvokeAsyncCall[T](SqlDataReaderBaseAsyncCallContext`1 context)
--- End of stack trace from previous location ---
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeResultSetAsync(Int32 startCommandIndex, RelationalDataReader reader, CancellationToken cancellationToken)
ClientConnectionId:3c86f457-218f-4b5b-8fdd-a6c97d0074e8
Error Number:547,State:0,Class:16
   --- End of inner exception stack trace ---
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeResultSetAsync(Int32 startCommandIndex, RelationalDataReader reader, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeAsync(RelationalDataReader reader, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Update.Internal.SqlServerModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(IList`1 entriesToSave, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(StateManager stateManager, Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Storage.Internal.SqlServerExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
2025-02-06 14:32:45.810 +03:00 [ERR] Error logging audit event. NationalId: all, Action: notification_delivered, Details: {"notification_count":21,"notification_ids":[38,37,36,35,34,33,32,31,30,29,28,27,26,25,24,23,23,20,19,18,12],"timestamp":"2025-02-06T14:32:45.7051569"}
Microsoft.EntityFrameworkCore.DbUpdateException: An error occurred while saving the entity changes. See the inner exception for details.
 ---> Microsoft.Data.SqlClient.SqlException (0x80131904): The INSERT statement conflicted with the FOREIGN KEY constraint "FK_AuthLogs_Customers_NationalId". The conflict occurred in database "NayifatApp", table "dbo.Customers", column 'NationalId'.
   at Microsoft.Data.SqlClient.SqlConnection.OnError(SqlException exception, Boolean breakConnection, Action`1 wrapCloseInAction)
   at Microsoft.Data.SqlClient.SqlInternalConnection.OnError(SqlException exception, Boolean breakConnection, Action`1 wrapCloseInAction)
   at Microsoft.Data.SqlClient.TdsParser.ThrowExceptionAndWarning(TdsParserStateObject stateObj, Boolean callerHasConnectionLock, Boolean asyncClose)
   at Microsoft.Data.SqlClient.TdsParser.TryRun(RunBehavior runBehavior, SqlCommand cmdHandler, SqlDataReader dataStream, BulkCopySimpleResultSet bulkCopyHandler, TdsParserStateObject stateObj, Boolean& dataReady)
   at Microsoft.Data.SqlClient.SqlDataReader.TryHasMoreRows(Boolean& moreRows)
   at Microsoft.Data.SqlClient.SqlDataReader.TryReadInternal(Boolean setTimeout, Boolean& more)
   at Microsoft.Data.SqlClient.SqlDataReader.ReadAsyncExecute(Task task, Object state)
   at Microsoft.Data.SqlClient.SqlDataReader.InvokeAsyncCall[T](SqlDataReaderBaseAsyncCallContext`1 context)
--- End of stack trace from previous location ---
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeResultSetAsync(Int32 startCommandIndex, RelationalDataReader reader, CancellationToken cancellationToken)
ClientConnectionId:3c86f457-218f-4b5b-8fdd-a6c97d0074e8
Error Number:547,State:0,Class:16
   --- End of inner exception stack trace ---
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeResultSetAsync(Int32 startCommandIndex, RelationalDataReader reader, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeAsync(RelationalDataReader reader, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Update.Internal.SqlServerModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(IList`1 entriesToSave, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(StateManager stateManager, Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Storage.Internal.SqlServerExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at NayifatAPI.Services.AuditLogService.LogAsync(String nationalId, String action, Object details) in C:\Users\yamta\StudioProjects\nayifat_app_2025_new\NayifatAPI\Services\AuditLogService.cs:line 36
2025-02-06 14:32:45.827 +03:00 [INF] Request starting HTTP/1.1 POST http://eb3c-46-152-255-232.ngrok-free.app/api/notifications/list - application/json 45
2025-02-06 14:32:45.828 +03:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType11`2[[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Object, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-02-06 14:32:45.832 +03:00 [INF] Executing endpoint 'NayifatAPI.Controllers.NotificationsController.GetNotifications (NayifatAPI)'
2025-02-06 14:32:45.833 +03:00 [INF] Executed action NayifatAPI.Controllers.NotificationsController.GetNotifications (NayifatAPI) in 140.5598ms
2025-02-06 14:32:45.835 +03:00 [INF] Route matched with {action = "GetNotifications", controller = "Notifications"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetNotifications(NayifatAPI.Controllers.GetNotificationsRequest) on controller NayifatAPI.Controllers.NotificationsController (NayifatAPI).
2025-02-06 14:32:45.836 +03:00 [INF] Executed endpoint 'NayifatAPI.Controllers.NotificationsController.GetNotifications (NayifatAPI)'
2025-02-06 14:32:45.839 +03:00 [INF] Request finished HTTP/1.1 POST http://eb3c-46-152-255-232.ngrok-free.app/api/notifications/list - 200 null application/json; charset=utf-8 151.566ms
2025-02-06 14:32:45.842 +03:00 [INF] Executed DbCommand (3ms) [Parameters=[@__providedApiKey_0='?' (Size = 255)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [a].[api_Key], [a].[CreatedAt], [a].[Description], [a].[ExpiresAt], [a].[IsActive], [a].[LastUsedAt]
FROM [ApiKeys] AS [a]
WHERE [a].[api_Key] = @__providedApiKey_0 AND [a].[IsActive] = CAST(1 AS bit)
2025-02-06 14:32:45.850 +03:00 [INF] Executed DbCommand (5ms) [Parameters=[@__request_NationalId_0='?' (Size = 450)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [u].[national_id], [u].[last_updated], [u].[notifications]
FROM [user_notifications] AS [u]
WHERE [u].[national_id] = @__request_NationalId_0
2025-02-06 14:32:45.853 +03:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType11`2[[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Object, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-02-06 14:32:45.854 +03:00 [INF] Executed action NayifatAPI.Controllers.NotificationsController.GetNotifications (NayifatAPI) in 16.7066ms
2025-02-06 14:32:45.856 +03:00 [INF] Executed endpoint 'NayifatAPI.Controllers.NotificationsController.GetNotifications (NayifatAPI)'
2025-02-06 14:32:45.857 +03:00 [INF] Request finished HTTP/1.1 POST http://eb3c-46-152-255-232.ngrok-free.app/api/notifications/list - 200 null application/json; charset=utf-8 30.1868ms
2025-02-06 14:32:46.033 +03:00 [INF] Request starting HTTP/1.1 POST http://eb3c-46-152-255-232.ngrok-free.app/api/notifications/list - application/json 45
2025-02-06 14:32:46.038 +03:00 [INF] Executing endpoint 'NayifatAPI.Controllers.NotificationsController.GetNotifications (NayifatAPI)'
2025-02-06 14:32:46.039 +03:00 [INF] Route matched with {action = "GetNotifications", controller = "Notifications"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetNotifications(NayifatAPI.Controllers.GetNotificationsRequest) on controller NayifatAPI.Controllers.NotificationsController (NayifatAPI).
2025-02-06 14:32:46.046 +03:00 [INF] Executed DbCommand (4ms) [Parameters=[@__providedApiKey_0='?' (Size = 255)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [a].[api_Key], [a].[CreatedAt], [a].[Description], [a].[ExpiresAt], [a].[IsActive], [a].[LastUsedAt]
FROM [ApiKeys] AS [a]
WHERE [a].[api_Key] = @__providedApiKey_0 AND [a].[IsActive] = CAST(1 AS bit)
2025-02-06 14:32:46.058 +03:00 [INF] Executed DbCommand (7ms) [Parameters=[@__request_NationalId_0='?' (Size = 450)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [u].[national_id], [u].[last_updated], [u].[notifications]
FROM [user_notifications] AS [u]
WHERE [u].[national_id] = @__request_NationalId_0
2025-02-06 14:32:46.061 +03:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType11`2[[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Object, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-02-06 14:32:46.063 +03:00 [INF] Executed action NayifatAPI.Controllers.NotificationsController.GetNotifications (NayifatAPI) in 21.6398ms
2025-02-06 14:32:46.066 +03:00 [INF] Executed endpoint 'NayifatAPI.Controllers.NotificationsController.GetNotifications (NayifatAPI)'
2025-02-06 14:32:46.067 +03:00 [INF] Request finished HTTP/1.1 POST http://eb3c-46-152-255-232.ngrok-free.app/api/notifications/list - 200 null application/json; charset=utf-8 33.6264ms
2025-02-06 14:33:17.795 +03:00 [INF] Request starting HTTP/1.1 POST http://eb3c-46-152-255-232.ngrok-free.app/api/notifications/list - application/json; charset=utf-8 45
2025-02-06 14:33:17.800 +03:00 [INF] Executing endpoint 'NayifatAPI.Controllers.NotificationsController.GetNotifications (NayifatAPI)'
2025-02-06 14:33:17.801 +03:00 [INF] Route matched with {action = "GetNotifications", controller = "Notifications"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetNotifications(NayifatAPI.Controllers.GetNotificationsRequest) on controller NayifatAPI.Controllers.NotificationsController (NayifatAPI).
2025-02-06 14:33:17.809 +03:00 [INF] Executed DbCommand (4ms) [Parameters=[@__providedApiKey_0='?' (Size = 255)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [a].[api_Key], [a].[CreatedAt], [a].[Description], [a].[ExpiresAt], [a].[IsActive], [a].[LastUsedAt]
FROM [ApiKeys] AS [a]
WHERE [a].[api_Key] = @__providedApiKey_0 AND [a].[IsActive] = CAST(1 AS bit)
2025-02-06 14:33:17.814 +03:00 [INF] Executed DbCommand (3ms) [Parameters=[@__request_NationalId_0='?' (Size = 450)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [u].[national_id], [u].[last_updated], [u].[notifications]
FROM [user_notifications] AS [u]
WHERE [u].[national_id] = @__request_NationalId_0
2025-02-06 14:33:17.816 +03:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType11`2[[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Object, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-02-06 14:33:17.818 +03:00 [INF] Executed action NayifatAPI.Controllers.NotificationsController.GetNotifications (NayifatAPI) in 14.1406ms
2025-02-06 14:33:17.819 +03:00 [INF] Executed endpoint 'NayifatAPI.Controllers.NotificationsController.GetNotifications (NayifatAPI)'
2025-02-06 14:33:17.820 +03:00 [INF] Request finished HTTP/1.1 POST http://eb3c-46-152-255-232.ngrok-free.app/api/notifications/list - 200 null application/json; charset=utf-8 25.085ms
2025-02-06 14:33:18.189 +03:00 [INF] Request starting HTTP/1.1 POST http://eb3c-46-152-255-232.ngrok-free.app/api/notifications/list - application/json; charset=utf-8 39
2025-02-06 14:33:18.192 +03:00 [INF] Executing endpoint 'NayifatAPI.Controllers.NotificationsController.GetNotifications (NayifatAPI)'
2025-02-06 14:33:18.192 +03:00 [INF] Route matched with {action = "GetNotifications", controller = "Notifications"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetNotifications(NayifatAPI.Controllers.GetNotificationsRequest) on controller NayifatAPI.Controllers.NotificationsController (NayifatAPI).
2025-02-06 14:33:18.198 +03:00 [INF] Executed DbCommand (2ms) [Parameters=[@__providedApiKey_0='?' (Size = 255)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [a].[api_Key], [a].[CreatedAt], [a].[Description], [a].[ExpiresAt], [a].[IsActive], [a].[LastUsedAt]
FROM [ApiKeys] AS [a]
WHERE [a].[api_Key] = @__providedApiKey_0 AND [a].[IsActive] = CAST(1 AS bit)
2025-02-06 14:33:18.202 +03:00 [INF] Executed DbCommand (2ms) [Parameters=[@__request_NationalId_0='?' (Size = 450)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [u].[national_id], [u].[last_updated], [u].[notifications]
FROM [user_notifications] AS [u]
WHERE [u].[national_id] = @__request_NationalId_0
2025-02-06 14:33:18.209 +03:00 [INF] Executed DbCommand (3ms) [Parameters=[@__Parse_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [n].[Id], [n].[additional_data], [n].[big_picture_url], [n].[Body], [n].[body_ar], [n].[body_en], [n].[created_at], [n].[expiry_at], [n].[large_icon_url], [n].[Route], [n].[target_criteria], [n].[Title], [n].[title_ar], [n].[title_en]
FROM [notification_templates] AS [n]
WHERE [n].[Id] = @__Parse_0
2025-02-06 14:33:18.211 +03:00 [INF] Executed DbCommand (0ms) [Parameters=[@__Parse_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [n].[Id], [n].[additional_data], [n].[big_picture_url], [n].[Body], [n].[body_ar], [n].[body_en], [n].[created_at], [n].[expiry_at], [n].[large_icon_url], [n].[Route], [n].[target_criteria], [n].[Title], [n].[title_ar], [n].[title_en]
FROM [notification_templates] AS [n]
WHERE [n].[Id] = @__Parse_0
2025-02-06 14:33:18.214 +03:00 [INF] Executed DbCommand (0ms) [Parameters=[@__Parse_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [n].[Id], [n].[additional_data], [n].[big_picture_url], [n].[Body], [n].[body_ar], [n].[body_en], [n].[created_at], [n].[expiry_at], [n].[large_icon_url], [n].[Route], [n].[target_criteria], [n].[Title], [n].[title_ar], [n].[title_en]
FROM [notification_templates] AS [n]
WHERE [n].[Id] = @__Parse_0
2025-02-06 14:33:18.216 +03:00 [INF] Executed DbCommand (0ms) [Parameters=[@__Parse_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [n].[Id], [n].[additional_data], [n].[big_picture_url], [n].[Body], [n].[body_ar], [n].[body_en], [n].[created_at], [n].[expiry_at], [n].[large_icon_url], [n].[Route], [n].[target_criteria], [n].[Title], [n].[title_ar], [n].[title_en]
FROM [notification_templates] AS [n]
WHERE [n].[Id] = @__Parse_0
2025-02-06 14:33:18.218 +03:00 [INF] Executed DbCommand (0ms) [Parameters=[@__Parse_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [n].[Id], [n].[additional_data], [n].[big_picture_url], [n].[Body], [n].[body_ar], [n].[body_en], [n].[created_at], [n].[expiry_at], [n].[large_icon_url], [n].[Route], [n].[target_criteria], [n].[Title], [n].[title_ar], [n].[title_en]
FROM [notification_templates] AS [n]
WHERE [n].[Id] = @__Parse_0
2025-02-06 14:33:18.222 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@__Parse_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [n].[Id], [n].[additional_data], [n].[big_picture_url], [n].[Body], [n].[body_ar], [n].[body_en], [n].[created_at], [n].[expiry_at], [n].[large_icon_url], [n].[Route], [n].[target_criteria], [n].[Title], [n].[title_ar], [n].[title_en]
FROM [notification_templates] AS [n]
WHERE [n].[Id] = @__Parse_0
2025-02-06 14:33:18.227 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@__Parse_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [n].[Id], [n].[additional_data], [n].[big_picture_url], [n].[Body], [n].[body_ar], [n].[body_en], [n].[created_at], [n].[expiry_at], [n].[large_icon_url], [n].[Route], [n].[target_criteria], [n].[Title], [n].[title_ar], [n].[title_en]
FROM [notification_templates] AS [n]
WHERE [n].[Id] = @__Parse_0
2025-02-06 14:33:18.229 +03:00 [INF] Executed DbCommand (0ms) [Parameters=[@__Parse_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [n].[Id], [n].[additional_data], [n].[big_picture_url], [n].[Body], [n].[body_ar], [n].[body_en], [n].[created_at], [n].[expiry_at], [n].[large_icon_url], [n].[Route], [n].[target_criteria], [n].[Title], [n].[title_ar], [n].[title_en]
FROM [notification_templates] AS [n]
WHERE [n].[Id] = @__Parse_0
2025-02-06 14:33:18.232 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@__Parse_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [n].[Id], [n].[additional_data], [n].[big_picture_url], [n].[Body], [n].[body_ar], [n].[body_en], [n].[created_at], [n].[expiry_at], [n].[large_icon_url], [n].[Route], [n].[target_criteria], [n].[Title], [n].[title_ar], [n].[title_en]
FROM [notification_templates] AS [n]
WHERE [n].[Id] = @__Parse_0
2025-02-06 14:33:18.235 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@__Parse_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [n].[Id], [n].[additional_data], [n].[big_picture_url], [n].[Body], [n].[body_ar], [n].[body_en], [n].[created_at], [n].[expiry_at], [n].[large_icon_url], [n].[Route], [n].[target_criteria], [n].[Title], [n].[title_ar], [n].[title_en]
FROM [notification_templates] AS [n]
WHERE [n].[Id] = @__Parse_0
2025-02-06 14:33:18.239 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@__Parse_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [n].[Id], [n].[additional_data], [n].[big_picture_url], [n].[Body], [n].[body_ar], [n].[body_en], [n].[created_at], [n].[expiry_at], [n].[large_icon_url], [n].[Route], [n].[target_criteria], [n].[Title], [n].[title_ar], [n].[title_en]
FROM [notification_templates] AS [n]
WHERE [n].[Id] = @__Parse_0
2025-02-06 14:33:18.243 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@__Parse_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [n].[Id], [n].[additional_data], [n].[big_picture_url], [n].[Body], [n].[body_ar], [n].[body_en], [n].[created_at], [n].[expiry_at], [n].[large_icon_url], [n].[Route], [n].[target_criteria], [n].[Title], [n].[title_ar], [n].[title_en]
FROM [notification_templates] AS [n]
WHERE [n].[Id] = @__Parse_0
2025-02-06 14:33:18.246 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@__Parse_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [n].[Id], [n].[additional_data], [n].[big_picture_url], [n].[Body], [n].[body_ar], [n].[body_en], [n].[created_at], [n].[expiry_at], [n].[large_icon_url], [n].[Route], [n].[target_criteria], [n].[Title], [n].[title_ar], [n].[title_en]
FROM [notification_templates] AS [n]
WHERE [n].[Id] = @__Parse_0
2025-02-06 14:33:18.249 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@__Parse_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [n].[Id], [n].[additional_data], [n].[big_picture_url], [n].[Body], [n].[body_ar], [n].[body_en], [n].[created_at], [n].[expiry_at], [n].[large_icon_url], [n].[Route], [n].[target_criteria], [n].[Title], [n].[title_ar], [n].[title_en]
FROM [notification_templates] AS [n]
WHERE [n].[Id] = @__Parse_0
2025-02-06 14:33:18.253 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@__Parse_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [n].[Id], [n].[additional_data], [n].[big_picture_url], [n].[Body], [n].[body_ar], [n].[body_en], [n].[created_at], [n].[expiry_at], [n].[large_icon_url], [n].[Route], [n].[target_criteria], [n].[Title], [n].[title_ar], [n].[title_en]
FROM [notification_templates] AS [n]
WHERE [n].[Id] = @__Parse_0
2025-02-06 14:33:18.257 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@__Parse_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [n].[Id], [n].[additional_data], [n].[big_picture_url], [n].[Body], [n].[body_ar], [n].[body_en], [n].[created_at], [n].[expiry_at], [n].[large_icon_url], [n].[Route], [n].[target_criteria], [n].[Title], [n].[title_ar], [n].[title_en]
FROM [notification_templates] AS [n]
WHERE [n].[Id] = @__Parse_0
2025-02-06 14:33:18.260 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@__Parse_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [n].[Id], [n].[additional_data], [n].[big_picture_url], [n].[Body], [n].[body_ar], [n].[body_en], [n].[created_at], [n].[expiry_at], [n].[large_icon_url], [n].[Route], [n].[target_criteria], [n].[Title], [n].[title_ar], [n].[title_en]
FROM [notification_templates] AS [n]
WHERE [n].[Id] = @__Parse_0
2025-02-06 14:33:18.262 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@__Parse_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [n].[Id], [n].[additional_data], [n].[big_picture_url], [n].[Body], [n].[body_ar], [n].[body_en], [n].[created_at], [n].[expiry_at], [n].[large_icon_url], [n].[Route], [n].[target_criteria], [n].[Title], [n].[title_ar], [n].[title_en]
FROM [notification_templates] AS [n]
WHERE [n].[Id] = @__Parse_0
2025-02-06 14:33:18.268 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@__Parse_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [n].[Id], [n].[additional_data], [n].[big_picture_url], [n].[Body], [n].[body_ar], [n].[body_en], [n].[created_at], [n].[expiry_at], [n].[large_icon_url], [n].[Route], [n].[target_criteria], [n].[Title], [n].[title_ar], [n].[title_en]
FROM [notification_templates] AS [n]
WHERE [n].[Id] = @__Parse_0
2025-02-06 14:33:18.272 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@__Parse_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [n].[Id], [n].[additional_data], [n].[big_picture_url], [n].[Body], [n].[body_ar], [n].[body_en], [n].[created_at], [n].[expiry_at], [n].[large_icon_url], [n].[Route], [n].[target_criteria], [n].[Title], [n].[title_ar], [n].[title_en]
FROM [notification_templates] AS [n]
WHERE [n].[Id] = @__Parse_0
2025-02-06 14:33:18.276 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@__Parse_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [n].[Id], [n].[additional_data], [n].[big_picture_url], [n].[Body], [n].[body_ar], [n].[body_en], [n].[created_at], [n].[expiry_at], [n].[large_icon_url], [n].[Route], [n].[target_criteria], [n].[Title], [n].[title_ar], [n].[title_en]
FROM [notification_templates] AS [n]
WHERE [n].[Id] = @__Parse_0
2025-02-06 14:33:18.286 +03:00 [INF] Executed DbCommand (4ms) [Parameters=[@p0='?' (Size = 4000), @p1='?' (DbType = DateTime2), @p2='?' (Size = 4000), @p3='?' (Size = 4000), @p4='?' (Size = 4000), @p5='?' (Size = 450), @p6='?' (Size = 4000), @p7='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SET IMPLICIT_TRANSACTIONS OFF;
SET NOCOUNT ON;
INSERT INTO [AuthLogs] ([AuthType], [CreatedAt], [DeviceId], [FailureReason], [IpAddress], [NationalId], [Status], [UserAgent])
OUTPUT INSERTED.[Id]
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7);
2025-02-06 14:33:18.290 +03:00 [ERR] An exception occurred in the database while saving changes for context type 'NayifatAPI.Data.ApplicationDbContext'.
Microsoft.EntityFrameworkCore.DbUpdateException: An error occurred while saving the entity changes. See the inner exception for details.
 ---> Microsoft.Data.SqlClient.SqlException (0x80131904): The INSERT statement conflicted with the FOREIGN KEY constraint "FK_AuthLogs_Customers_NationalId". The conflict occurred in database "NayifatApp", table "dbo.Customers", column 'NationalId'.
   at Microsoft.Data.SqlClient.SqlConnection.OnError(SqlException exception, Boolean breakConnection, Action`1 wrapCloseInAction)
   at Microsoft.Data.SqlClient.SqlInternalConnection.OnError(SqlException exception, Boolean breakConnection, Action`1 wrapCloseInAction)
   at Microsoft.Data.SqlClient.TdsParser.ThrowExceptionAndWarning(TdsParserStateObject stateObj, Boolean callerHasConnectionLock, Boolean asyncClose)
   at Microsoft.Data.SqlClient.TdsParser.TryRun(RunBehavior runBehavior, SqlCommand cmdHandler, SqlDataReader dataStream, BulkCopySimpleResultSet bulkCopyHandler, TdsParserStateObject stateObj, Boolean& dataReady)
   at Microsoft.Data.SqlClient.SqlDataReader.TryHasMoreRows(Boolean& moreRows)
   at Microsoft.Data.SqlClient.SqlDataReader.TryReadInternal(Boolean setTimeout, Boolean& more)
   at Microsoft.Data.SqlClient.SqlDataReader.ReadAsyncExecute(Task task, Object state)
   at Microsoft.Data.SqlClient.SqlDataReader.InvokeAsyncCall[T](SqlDataReaderBaseAsyncCallContext`1 context)
--- End of stack trace from previous location ---
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeResultSetAsync(Int32 startCommandIndex, RelationalDataReader reader, CancellationToken cancellationToken)
ClientConnectionId:3c86f457-218f-4b5b-8fdd-a6c97d0074e8
Error Number:547,State:0,Class:16
   --- End of inner exception stack trace ---
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeResultSetAsync(Int32 startCommandIndex, RelationalDataReader reader, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeAsync(RelationalDataReader reader, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Update.Internal.SqlServerModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(IList`1 entriesToSave, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(StateManager stateManager, Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Storage.Internal.SqlServerExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
Microsoft.EntityFrameworkCore.DbUpdateException: An error occurred while saving the entity changes. See the inner exception for details.
 ---> Microsoft.Data.SqlClient.SqlException (0x80131904): The INSERT statement conflicted with the FOREIGN KEY constraint "FK_AuthLogs_Customers_NationalId". The conflict occurred in database "NayifatApp", table "dbo.Customers", column 'NationalId'.
   at Microsoft.Data.SqlClient.SqlConnection.OnError(SqlException exception, Boolean breakConnection, Action`1 wrapCloseInAction)
   at Microsoft.Data.SqlClient.SqlInternalConnection.OnError(SqlException exception, Boolean breakConnection, Action`1 wrapCloseInAction)
   at Microsoft.Data.SqlClient.TdsParser.ThrowExceptionAndWarning(TdsParserStateObject stateObj, Boolean callerHasConnectionLock, Boolean asyncClose)
   at Microsoft.Data.SqlClient.TdsParser.TryRun(RunBehavior runBehavior, SqlCommand cmdHandler, SqlDataReader dataStream, BulkCopySimpleResultSet bulkCopyHandler, TdsParserStateObject stateObj, Boolean& dataReady)
   at Microsoft.Data.SqlClient.SqlDataReader.TryHasMoreRows(Boolean& moreRows)
   at Microsoft.Data.SqlClient.SqlDataReader.TryReadInternal(Boolean setTimeout, Boolean& more)
   at Microsoft.Data.SqlClient.SqlDataReader.ReadAsyncExecute(Task task, Object state)
   at Microsoft.Data.SqlClient.SqlDataReader.InvokeAsyncCall[T](SqlDataReaderBaseAsyncCallContext`1 context)
--- End of stack trace from previous location ---
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeResultSetAsync(Int32 startCommandIndex, RelationalDataReader reader, CancellationToken cancellationToken)
ClientConnectionId:3c86f457-218f-4b5b-8fdd-a6c97d0074e8
Error Number:547,State:0,Class:16
   --- End of inner exception stack trace ---
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeResultSetAsync(Int32 startCommandIndex, RelationalDataReader reader, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeAsync(RelationalDataReader reader, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Update.Internal.SqlServerModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(IList`1 entriesToSave, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(StateManager stateManager, Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Storage.Internal.SqlServerExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
2025-02-06 14:33:18.305 +03:00 [ERR] Error logging audit event. NationalId: all, Action: notification_delivered, Details: {"notification_count":21,"notification_ids":[38,37,36,35,34,33,32,31,30,29,28,27,26,25,24,23,23,20,19,18,12],"timestamp":"2025-02-06T14:33:18.2059092"}
Microsoft.EntityFrameworkCore.DbUpdateException: An error occurred while saving the entity changes. See the inner exception for details.
 ---> Microsoft.Data.SqlClient.SqlException (0x80131904): The INSERT statement conflicted with the FOREIGN KEY constraint "FK_AuthLogs_Customers_NationalId". The conflict occurred in database "NayifatApp", table "dbo.Customers", column 'NationalId'.
   at Microsoft.Data.SqlClient.SqlConnection.OnError(SqlException exception, Boolean breakConnection, Action`1 wrapCloseInAction)
   at Microsoft.Data.SqlClient.SqlInternalConnection.OnError(SqlException exception, Boolean breakConnection, Action`1 wrapCloseInAction)
   at Microsoft.Data.SqlClient.TdsParser.ThrowExceptionAndWarning(TdsParserStateObject stateObj, Boolean callerHasConnectionLock, Boolean asyncClose)
   at Microsoft.Data.SqlClient.TdsParser.TryRun(RunBehavior runBehavior, SqlCommand cmdHandler, SqlDataReader dataStream, BulkCopySimpleResultSet bulkCopyHandler, TdsParserStateObject stateObj, Boolean& dataReady)
   at Microsoft.Data.SqlClient.SqlDataReader.TryHasMoreRows(Boolean& moreRows)
   at Microsoft.Data.SqlClient.SqlDataReader.TryReadInternal(Boolean setTimeout, Boolean& more)
   at Microsoft.Data.SqlClient.SqlDataReader.ReadAsyncExecute(Task task, Object state)
   at Microsoft.Data.SqlClient.SqlDataReader.InvokeAsyncCall[T](SqlDataReaderBaseAsyncCallContext`1 context)
--- End of stack trace from previous location ---
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeResultSetAsync(Int32 startCommandIndex, RelationalDataReader reader, CancellationToken cancellationToken)
ClientConnectionId:3c86f457-218f-4b5b-8fdd-a6c97d0074e8
Error Number:547,State:0,Class:16
   --- End of inner exception stack trace ---
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeResultSetAsync(Int32 startCommandIndex, RelationalDataReader reader, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeAsync(RelationalDataReader reader, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Update.Internal.SqlServerModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(IList`1 entriesToSave, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(StateManager stateManager, Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Storage.Internal.SqlServerExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at NayifatAPI.Services.AuditLogService.LogAsync(String nationalId, String action, Object details) in C:\Users\yamta\StudioProjects\nayifat_app_2025_new\NayifatAPI\Services\AuditLogService.cs:line 36
2025-02-06 14:33:18.316 +03:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType11`2[[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Object, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-02-06 14:33:18.318 +03:00 [INF] Executed action NayifatAPI.Controllers.NotificationsController.GetNotifications (NayifatAPI) in 124.0289ms
2025-02-06 14:33:18.319 +03:00 [INF] Executed endpoint 'NayifatAPI.Controllers.NotificationsController.GetNotifications (NayifatAPI)'
2025-02-06 14:33:18.322 +03:00 [INF] Request finished HTTP/1.1 POST http://eb3c-46-152-255-232.ngrok-free.app/api/notifications/list - 200 null application/json; charset=utf-8 132.6734ms
2025-02-06 14:38:19.127 +03:00 [INF] Request starting HTTP/1.1 POST http://eb3c-46-152-255-232.ngrok-free.app/api/notifications/list - application/json; charset=utf-8 45
2025-02-06 14:38:20.558 +03:00 [INF] Executing endpoint 'NayifatAPI.Controllers.NotificationsController.GetNotifications (NayifatAPI)'
2025-02-06 14:38:20.562 +03:00 [INF] Route matched with {action = "GetNotifications", controller = "Notifications"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetNotifications(NayifatAPI.Controllers.GetNotificationsRequest) on controller NayifatAPI.Controllers.NotificationsController (NayifatAPI).
2025-02-06 14:38:22.179 +03:00 [INF] Executed DbCommand (1,314ms) [Parameters=[@__providedApiKey_0='?' (Size = 255)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [a].[api_Key], [a].[CreatedAt], [a].[Description], [a].[ExpiresAt], [a].[IsActive], [a].[LastUsedAt]
FROM [ApiKeys] AS [a]
WHERE [a].[api_Key] = @__providedApiKey_0 AND [a].[IsActive] = CAST(1 AS bit)
2025-02-06 14:38:27.249 +03:00 [INF] Executed DbCommand (2,164ms) [Parameters=[@__request_NationalId_0='?' (Size = 450)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [u].[national_id], [u].[last_updated], [u].[notifications]
FROM [user_notifications] AS [u]
WHERE [u].[national_id] = @__request_NationalId_0
2025-02-06 14:38:29.892 +03:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType11`2[[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Object, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-02-06 14:38:29.894 +03:00 [INF] Executed action NayifatAPI.Controllers.NotificationsController.GetNotifications (NayifatAPI) in 9034.9228ms
2025-02-06 14:38:29.897 +03:00 [INF] Executed endpoint 'NayifatAPI.Controllers.NotificationsController.GetNotifications (NayifatAPI)'
2025-02-06 14:38:29.909 +03:00 [INF] Request finished HTTP/1.1 POST http://eb3c-46-152-255-232.ngrok-free.app/api/notifications/list - 200 null application/json; charset=utf-8 10782.537ms
2025-02-06 14:38:31.814 +03:00 [INF] Request starting HTTP/1.1 POST http://eb3c-46-152-255-232.ngrok-free.app/api/notifications/list - application/json; charset=utf-8 39
2025-02-06 14:38:37.583 +03:00 [INF] Executing endpoint 'NayifatAPI.Controllers.NotificationsController.GetNotifications (NayifatAPI)'
2025-02-06 14:38:37.584 +03:00 [INF] Route matched with {action = "GetNotifications", controller = "Notifications"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetNotifications(NayifatAPI.Controllers.GetNotificationsRequest) on controller NayifatAPI.Controllers.NotificationsController (NayifatAPI).
2025-02-06 14:38:39.842 +03:00 [INF] Executed DbCommand (2,254ms) [Parameters=[@__providedApiKey_0='?' (Size = 255)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [a].[api_Key], [a].[CreatedAt], [a].[Description], [a].[ExpiresAt], [a].[IsActive], [a].[LastUsedAt]
FROM [ApiKeys] AS [a]
WHERE [a].[api_Key] = @__providedApiKey_0 AND [a].[IsActive] = CAST(1 AS bit)
2025-02-06 14:38:40.221 +03:00 [INF] Executed DbCommand (365ms) [Parameters=[@__request_NationalId_0='?' (Size = 450)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [u].[national_id], [u].[last_updated], [u].[notifications]
FROM [user_notifications] AS [u]
WHERE [u].[national_id] = @__request_NationalId_0
2025-02-06 14:38:43.346 +03:00 [INF] Executed DbCommand (624ms) [Parameters=[@__Parse_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [n].[Id], [n].[additional_data], [n].[big_picture_url], [n].[Body], [n].[body_ar], [n].[body_en], [n].[created_at], [n].[expiry_at], [n].[large_icon_url], [n].[Route], [n].[target_criteria], [n].[Title], [n].[title_ar], [n].[title_en]
FROM [notification_templates] AS [n]
WHERE [n].[Id] = @__Parse_0
2025-02-06 14:38:44.324 +03:00 [INF] Executed DbCommand (968ms) [Parameters=[@__Parse_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [n].[Id], [n].[additional_data], [n].[big_picture_url], [n].[Body], [n].[body_ar], [n].[body_en], [n].[created_at], [n].[expiry_at], [n].[large_icon_url], [n].[Route], [n].[target_criteria], [n].[Title], [n].[title_ar], [n].[title_en]
FROM [notification_templates] AS [n]
WHERE [n].[Id] = @__Parse_0
2025-02-06 14:38:47.840 +03:00 [INF] Executed DbCommand (2,279ms) [Parameters=[@__Parse_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [n].[Id], [n].[additional_data], [n].[big_picture_url], [n].[Body], [n].[body_ar], [n].[body_en], [n].[created_at], [n].[expiry_at], [n].[large_icon_url], [n].[Route], [n].[target_criteria], [n].[Title], [n].[title_ar], [n].[title_en]
FROM [notification_templates] AS [n]
WHERE [n].[Id] = @__Parse_0
2025-02-06 14:38:51.532 +03:00 [INF] Executed DbCommand (734ms) [Parameters=[@__Parse_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [n].[Id], [n].[additional_data], [n].[big_picture_url], [n].[Body], [n].[body_ar], [n].[body_en], [n].[created_at], [n].[expiry_at], [n].[large_icon_url], [n].[Route], [n].[target_criteria], [n].[Title], [n].[title_ar], [n].[title_en]
FROM [notification_templates] AS [n]
WHERE [n].[Id] = @__Parse_0
2025-02-06 14:38:56.490 +03:00 [INF] Executed DbCommand (3,468ms) [Parameters=[@__Parse_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [n].[Id], [n].[additional_data], [n].[big_picture_url], [n].[Body], [n].[body_ar], [n].[body_en], [n].[created_at], [n].[expiry_at], [n].[large_icon_url], [n].[Route], [n].[target_criteria], [n].[Title], [n].[title_ar], [n].[title_en]
FROM [notification_templates] AS [n]
WHERE [n].[Id] = @__Parse_0
2025-02-06 14:39:03.879 +03:00 [INF] Executed DbCommand (785ms) [Parameters=[@__Parse_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [n].[Id], [n].[additional_data], [n].[big_picture_url], [n].[Body], [n].[body_ar], [n].[body_en], [n].[created_at], [n].[expiry_at], [n].[large_icon_url], [n].[Route], [n].[target_criteria], [n].[Title], [n].[title_ar], [n].[title_en]
FROM [notification_templates] AS [n]
WHERE [n].[Id] = @__Parse_0
2025-02-06 14:39:16.755 +03:00 [INF] Executed DbCommand (46ms) [Parameters=[@__Parse_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [n].[Id], [n].[additional_data], [n].[big_picture_url], [n].[Body], [n].[body_ar], [n].[body_en], [n].[created_at], [n].[expiry_at], [n].[large_icon_url], [n].[Route], [n].[target_criteria], [n].[Title], [n].[title_ar], [n].[title_en]
FROM [notification_templates] AS [n]
WHERE [n].[Id] = @__Parse_0
2025-02-06 14:39:19.729 +03:00 [INF] Executed DbCommand (48ms) [Parameters=[@__Parse_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [n].[Id], [n].[additional_data], [n].[big_picture_url], [n].[Body], [n].[body_ar], [n].[body_en], [n].[created_at], [n].[expiry_at], [n].[large_icon_url], [n].[Route], [n].[target_criteria], [n].[Title], [n].[title_ar], [n].[title_en]
FROM [notification_templates] AS [n]
WHERE [n].[Id] = @__Parse_0
2025-02-06 14:39:20.041 +03:00 [INF] Executed DbCommand (13ms) [Parameters=[@__Parse_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [n].[Id], [n].[additional_data], [n].[big_picture_url], [n].[Body], [n].[body_ar], [n].[body_en], [n].[created_at], [n].[expiry_at], [n].[large_icon_url], [n].[Route], [n].[target_criteria], [n].[Title], [n].[title_ar], [n].[title_en]
FROM [notification_templates] AS [n]
WHERE [n].[Id] = @__Parse_0
2025-02-06 14:39:22.954 +03:00 [INF] Executed DbCommand (30ms) [Parameters=[@__Parse_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [n].[Id], [n].[additional_data], [n].[big_picture_url], [n].[Body], [n].[body_ar], [n].[body_en], [n].[created_at], [n].[expiry_at], [n].[large_icon_url], [n].[Route], [n].[target_criteria], [n].[Title], [n].[title_ar], [n].[title_en]
FROM [notification_templates] AS [n]
WHERE [n].[Id] = @__Parse_0
2025-02-06 14:39:24.194 +03:00 [INF] Executed DbCommand (26ms) [Parameters=[@__Parse_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [n].[Id], [n].[additional_data], [n].[big_picture_url], [n].[Body], [n].[body_ar], [n].[body_en], [n].[created_at], [n].[expiry_at], [n].[large_icon_url], [n].[Route], [n].[target_criteria], [n].[Title], [n].[title_ar], [n].[title_en]
FROM [notification_templates] AS [n]
WHERE [n].[Id] = @__Parse_0
2025-02-06 14:39:24.628 +03:00 [INF] Executed DbCommand (74ms) [Parameters=[@__Parse_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [n].[Id], [n].[additional_data], [n].[big_picture_url], [n].[Body], [n].[body_ar], [n].[body_en], [n].[created_at], [n].[expiry_at], [n].[large_icon_url], [n].[Route], [n].[target_criteria], [n].[Title], [n].[title_ar], [n].[title_en]
FROM [notification_templates] AS [n]
WHERE [n].[Id] = @__Parse_0
2025-02-06 14:39:25.152 +03:00 [INF] Executed DbCommand (18ms) [Parameters=[@__Parse_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [n].[Id], [n].[additional_data], [n].[big_picture_url], [n].[Body], [n].[body_ar], [n].[body_en], [n].[created_at], [n].[expiry_at], [n].[large_icon_url], [n].[Route], [n].[target_criteria], [n].[Title], [n].[title_ar], [n].[title_en]
FROM [notification_templates] AS [n]
WHERE [n].[Id] = @__Parse_0
2025-02-06 14:39:25.247 +03:00 [INF] Executed DbCommand (6ms) [Parameters=[@__Parse_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [n].[Id], [n].[additional_data], [n].[big_picture_url], [n].[Body], [n].[body_ar], [n].[body_en], [n].[created_at], [n].[expiry_at], [n].[large_icon_url], [n].[Route], [n].[target_criteria], [n].[Title], [n].[title_ar], [n].[title_en]
FROM [notification_templates] AS [n]
WHERE [n].[Id] = @__Parse_0
2025-02-06 14:39:25.255 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@__Parse_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [n].[Id], [n].[additional_data], [n].[big_picture_url], [n].[Body], [n].[body_ar], [n].[body_en], [n].[created_at], [n].[expiry_at], [n].[large_icon_url], [n].[Route], [n].[target_criteria], [n].[Title], [n].[title_ar], [n].[title_en]
FROM [notification_templates] AS [n]
WHERE [n].[Id] = @__Parse_0
2025-02-06 14:39:25.268 +03:00 [INF] Executed DbCommand (8ms) [Parameters=[@__Parse_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [n].[Id], [n].[additional_data], [n].[big_picture_url], [n].[Body], [n].[body_ar], [n].[body_en], [n].[created_at], [n].[expiry_at], [n].[large_icon_url], [n].[Route], [n].[target_criteria], [n].[Title], [n].[title_ar], [n].[title_en]
FROM [notification_templates] AS [n]
WHERE [n].[Id] = @__Parse_0
2025-02-06 14:39:25.388 +03:00 [INF] Executed DbCommand (24ms) [Parameters=[@__Parse_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [n].[Id], [n].[additional_data], [n].[big_picture_url], [n].[Body], [n].[body_ar], [n].[body_en], [n].[created_at], [n].[expiry_at], [n].[large_icon_url], [n].[Route], [n].[target_criteria], [n].[Title], [n].[title_ar], [n].[title_en]
FROM [notification_templates] AS [n]
WHERE [n].[Id] = @__Parse_0
2025-02-06 14:39:25.481 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@__Parse_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [n].[Id], [n].[additional_data], [n].[big_picture_url], [n].[Body], [n].[body_ar], [n].[body_en], [n].[created_at], [n].[expiry_at], [n].[large_icon_url], [n].[Route], [n].[target_criteria], [n].[Title], [n].[title_ar], [n].[title_en]
FROM [notification_templates] AS [n]
WHERE [n].[Id] = @__Parse_0
2025-02-06 14:39:25.487 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@__Parse_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [n].[Id], [n].[additional_data], [n].[big_picture_url], [n].[Body], [n].[body_ar], [n].[body_en], [n].[created_at], [n].[expiry_at], [n].[large_icon_url], [n].[Route], [n].[target_criteria], [n].[Title], [n].[title_ar], [n].[title_en]
FROM [notification_templates] AS [n]
WHERE [n].[Id] = @__Parse_0
2025-02-06 14:39:25.496 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@__Parse_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [n].[Id], [n].[additional_data], [n].[big_picture_url], [n].[Body], [n].[body_ar], [n].[body_en], [n].[created_at], [n].[expiry_at], [n].[large_icon_url], [n].[Route], [n].[target_criteria], [n].[Title], [n].[title_ar], [n].[title_en]
FROM [notification_templates] AS [n]
WHERE [n].[Id] = @__Parse_0
2025-02-06 14:39:27.569 +03:00 [INF] Executed DbCommand (7ms) [Parameters=[@__Parse_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [n].[Id], [n].[additional_data], [n].[big_picture_url], [n].[Body], [n].[body_ar], [n].[body_en], [n].[created_at], [n].[expiry_at], [n].[large_icon_url], [n].[Route], [n].[target_criteria], [n].[Title], [n].[title_ar], [n].[title_en]
FROM [notification_templates] AS [n]
WHERE [n].[Id] = @__Parse_0
2025-02-06 14:39:27.926 +03:00 [INF] Executed DbCommand (350ms) [Parameters=[@p0='?' (Size = 4000), @p1='?' (DbType = DateTime2), @p2='?' (Size = 4000), @p3='?' (Size = 4000), @p4='?' (Size = 4000), @p5='?' (Size = 450), @p6='?' (Size = 4000), @p7='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SET IMPLICIT_TRANSACTIONS OFF;
SET NOCOUNT ON;
INSERT INTO [AuthLogs] ([AuthType], [CreatedAt], [DeviceId], [FailureReason], [IpAddress], [NationalId], [Status], [UserAgent])
OUTPUT INSERTED.[Id]
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7);
2025-02-06 14:39:28.184 +03:00 [ERR] An exception occurred in the database while saving changes for context type 'NayifatAPI.Data.ApplicationDbContext'.
Microsoft.EntityFrameworkCore.DbUpdateException: An error occurred while saving the entity changes. See the inner exception for details.
 ---> Microsoft.Data.SqlClient.SqlException (0x80131904): The INSERT statement conflicted with the FOREIGN KEY constraint "FK_AuthLogs_Customers_NationalId". The conflict occurred in database "NayifatApp", table "dbo.Customers", column 'NationalId'.
   at Microsoft.Data.SqlClient.SqlConnection.OnError(SqlException exception, Boolean breakConnection, Action`1 wrapCloseInAction)
   at Microsoft.Data.SqlClient.SqlInternalConnection.OnError(SqlException exception, Boolean breakConnection, Action`1 wrapCloseInAction)
   at Microsoft.Data.SqlClient.TdsParser.ThrowExceptionAndWarning(TdsParserStateObject stateObj, Boolean callerHasConnectionLock, Boolean asyncClose)
   at Microsoft.Data.SqlClient.TdsParser.TryRun(RunBehavior runBehavior, SqlCommand cmdHandler, SqlDataReader dataStream, BulkCopySimpleResultSet bulkCopyHandler, TdsParserStateObject stateObj, Boolean& dataReady)
   at Microsoft.Data.SqlClient.SqlDataReader.TryHasMoreRows(Boolean& moreRows)
   at Microsoft.Data.SqlClient.SqlDataReader.TryReadInternal(Boolean setTimeout, Boolean& more)
   at Microsoft.Data.SqlClient.SqlDataReader.ReadAsyncExecute(Task task, Object state)
   at Microsoft.Data.SqlClient.SqlDataReader.InvokeAsyncCall[T](SqlDataReaderBaseAsyncCallContext`1 context)
--- End of stack trace from previous location ---
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeResultSetAsync(Int32 startCommandIndex, RelationalDataReader reader, CancellationToken cancellationToken)
ClientConnectionId:3c86f457-218f-4b5b-8fdd-a6c97d0074e8
Error Number:547,State:0,Class:16
   --- End of inner exception stack trace ---
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeResultSetAsync(Int32 startCommandIndex, RelationalDataReader reader, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeAsync(RelationalDataReader reader, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Update.Internal.SqlServerModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(IList`1 entriesToSave, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(StateManager stateManager, Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Storage.Internal.SqlServerExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
Microsoft.EntityFrameworkCore.DbUpdateException: An error occurred while saving the entity changes. See the inner exception for details.
 ---> Microsoft.Data.SqlClient.SqlException (0x80131904): The INSERT statement conflicted with the FOREIGN KEY constraint "FK_AuthLogs_Customers_NationalId". The conflict occurred in database "NayifatApp", table "dbo.Customers", column 'NationalId'.
   at Microsoft.Data.SqlClient.SqlConnection.OnError(SqlException exception, Boolean breakConnection, Action`1 wrapCloseInAction)
   at Microsoft.Data.SqlClient.SqlInternalConnection.OnError(SqlException exception, Boolean breakConnection, Action`1 wrapCloseInAction)
   at Microsoft.Data.SqlClient.TdsParser.ThrowExceptionAndWarning(TdsParserStateObject stateObj, Boolean callerHasConnectionLock, Boolean asyncClose)
   at Microsoft.Data.SqlClient.TdsParser.TryRun(RunBehavior runBehavior, SqlCommand cmdHandler, SqlDataReader dataStream, BulkCopySimpleResultSet bulkCopyHandler, TdsParserStateObject stateObj, Boolean& dataReady)
   at Microsoft.Data.SqlClient.SqlDataReader.TryHasMoreRows(Boolean& moreRows)
   at Microsoft.Data.SqlClient.SqlDataReader.TryReadInternal(Boolean setTimeout, Boolean& more)
   at Microsoft.Data.SqlClient.SqlDataReader.ReadAsyncExecute(Task task, Object state)
   at Microsoft.Data.SqlClient.SqlDataReader.InvokeAsyncCall[T](SqlDataReaderBaseAsyncCallContext`1 context)
--- End of stack trace from previous location ---
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeResultSetAsync(Int32 startCommandIndex, RelationalDataReader reader, CancellationToken cancellationToken)
ClientConnectionId:3c86f457-218f-4b5b-8fdd-a6c97d0074e8
Error Number:547,State:0,Class:16
   --- End of inner exception stack trace ---
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeResultSetAsync(Int32 startCommandIndex, RelationalDataReader reader, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeAsync(RelationalDataReader reader, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Update.Internal.SqlServerModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(IList`1 entriesToSave, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(StateManager stateManager, Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Storage.Internal.SqlServerExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
2025-02-06 14:39:33.038 +03:00 [ERR] Error logging audit event. NationalId: all, Action: notification_delivered, Details: {"notification_count":21,"notification_ids":[38,37,36,35,34,33,32,31,30,29,28,27,26,25,24,23,23,20,19,18,12],"timestamp":"2025-02-06T14:38:42.7213752"}
Microsoft.EntityFrameworkCore.DbUpdateException: An error occurred while saving the entity changes. See the inner exception for details.
 ---> Microsoft.Data.SqlClient.SqlException (0x80131904): The INSERT statement conflicted with the FOREIGN KEY constraint "FK_AuthLogs_Customers_NationalId". The conflict occurred in database "NayifatApp", table "dbo.Customers", column 'NationalId'.
   at Microsoft.Data.SqlClient.SqlConnection.OnError(SqlException exception, Boolean breakConnection, Action`1 wrapCloseInAction)
   at Microsoft.Data.SqlClient.SqlInternalConnection.OnError(SqlException exception, Boolean breakConnection, Action`1 wrapCloseInAction)
   at Microsoft.Data.SqlClient.TdsParser.ThrowExceptionAndWarning(TdsParserStateObject stateObj, Boolean callerHasConnectionLock, Boolean asyncClose)
   at Microsoft.Data.SqlClient.TdsParser.TryRun(RunBehavior runBehavior, SqlCommand cmdHandler, SqlDataReader dataStream, BulkCopySimpleResultSet bulkCopyHandler, TdsParserStateObject stateObj, Boolean& dataReady)
   at Microsoft.Data.SqlClient.SqlDataReader.TryHasMoreRows(Boolean& moreRows)
   at Microsoft.Data.SqlClient.SqlDataReader.TryReadInternal(Boolean setTimeout, Boolean& more)
   at Microsoft.Data.SqlClient.SqlDataReader.ReadAsyncExecute(Task task, Object state)
   at Microsoft.Data.SqlClient.SqlDataReader.InvokeAsyncCall[T](SqlDataReaderBaseAsyncCallContext`1 context)
--- End of stack trace from previous location ---
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeResultSetAsync(Int32 startCommandIndex, RelationalDataReader reader, CancellationToken cancellationToken)
ClientConnectionId:3c86f457-218f-4b5b-8fdd-a6c97d0074e8
Error Number:547,State:0,Class:16
   --- End of inner exception stack trace ---
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeResultSetAsync(Int32 startCommandIndex, RelationalDataReader reader, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeAsync(RelationalDataReader reader, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Update.Internal.SqlServerModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(IList`1 entriesToSave, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(StateManager stateManager, Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Storage.Internal.SqlServerExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at NayifatAPI.Services.AuditLogService.LogAsync(String nationalId, String action, Object details) in C:\Users\yamta\StudioProjects\nayifat_app_2025_new\NayifatAPI\Services\AuditLogService.cs:line 36
2025-02-06 14:39:33.054 +03:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType11`2[[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Object, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-02-06 14:39:33.057 +03:00 [INF] Executed action NayifatAPI.Controllers.NotificationsController.GetNotifications (NayifatAPI) in 55470.5669ms
2025-02-06 14:39:33.059 +03:00 [INF] Executed endpoint 'NayifatAPI.Controllers.NotificationsController.GetNotifications (NayifatAPI)'
2025-02-06 14:39:33.060 +03:00 [INF] Request finished HTTP/1.1 POST http://eb3c-46-152-255-232.ngrok-free.app/api/notifications/list - 200 null application/json; charset=utf-8 61246.1777ms
2025-02-06 14:41:09.095 +03:00 [INF] Request starting HTTP/1.1 POST http://eb3c-46-152-255-232.ngrok-free.app/api/notifications/list - application/json 39
2025-02-06 14:41:09.098 +03:00 [INF] Executing endpoint 'NayifatAPI.Controllers.NotificationsController.GetNotifications (NayifatAPI)'
2025-02-06 14:41:09.099 +03:00 [INF] Route matched with {action = "GetNotifications", controller = "Notifications"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetNotifications(NayifatAPI.Controllers.GetNotificationsRequest) on controller NayifatAPI.Controllers.NotificationsController (NayifatAPI).
2025-02-06 14:41:09.121 +03:00 [INF] Executed DbCommand (17ms) [Parameters=[@__providedApiKey_0='?' (Size = 255)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [a].[api_Key], [a].[CreatedAt], [a].[Description], [a].[ExpiresAt], [a].[IsActive], [a].[LastUsedAt]
FROM [ApiKeys] AS [a]
WHERE [a].[api_Key] = @__providedApiKey_0 AND [a].[IsActive] = CAST(1 AS bit)
2025-02-06 14:41:09.130 +03:00 [INF] Executed DbCommand (6ms) [Parameters=[@__request_NationalId_0='?' (Size = 450)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [u].[national_id], [u].[last_updated], [u].[notifications]
FROM [user_notifications] AS [u]
WHERE [u].[national_id] = @__request_NationalId_0
2025-02-06 14:41:09.136 +03:00 [INF] Executed DbCommand (3ms) [Parameters=[@__Parse_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [n].[Id], [n].[additional_data], [n].[big_picture_url], [n].[Body], [n].[body_ar], [n].[body_en], [n].[created_at], [n].[expiry_at], [n].[large_icon_url], [n].[Route], [n].[target_criteria], [n].[Title], [n].[title_ar], [n].[title_en]
FROM [notification_templates] AS [n]
WHERE [n].[Id] = @__Parse_0
2025-02-06 14:41:09.139 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@__Parse_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [n].[Id], [n].[additional_data], [n].[big_picture_url], [n].[Body], [n].[body_ar], [n].[body_en], [n].[created_at], [n].[expiry_at], [n].[large_icon_url], [n].[Route], [n].[target_criteria], [n].[Title], [n].[title_ar], [n].[title_en]
FROM [notification_templates] AS [n]
WHERE [n].[Id] = @__Parse_0
2025-02-06 14:41:09.147 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@__Parse_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [n].[Id], [n].[additional_data], [n].[big_picture_url], [n].[Body], [n].[body_ar], [n].[body_en], [n].[created_at], [n].[expiry_at], [n].[large_icon_url], [n].[Route], [n].[target_criteria], [n].[Title], [n].[title_ar], [n].[title_en]
FROM [notification_templates] AS [n]
WHERE [n].[Id] = @__Parse_0
2025-02-06 14:41:09.151 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@__Parse_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [n].[Id], [n].[additional_data], [n].[big_picture_url], [n].[Body], [n].[body_ar], [n].[body_en], [n].[created_at], [n].[expiry_at], [n].[large_icon_url], [n].[Route], [n].[target_criteria], [n].[Title], [n].[title_ar], [n].[title_en]
FROM [notification_templates] AS [n]
WHERE [n].[Id] = @__Parse_0
2025-02-06 14:41:09.154 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@__Parse_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [n].[Id], [n].[additional_data], [n].[big_picture_url], [n].[Body], [n].[body_ar], [n].[body_en], [n].[created_at], [n].[expiry_at], [n].[large_icon_url], [n].[Route], [n].[target_criteria], [n].[Title], [n].[title_ar], [n].[title_en]
FROM [notification_templates] AS [n]
WHERE [n].[Id] = @__Parse_0
2025-02-06 14:41:09.158 +03:00 [INF] Executed DbCommand (0ms) [Parameters=[@__Parse_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [n].[Id], [n].[additional_data], [n].[big_picture_url], [n].[Body], [n].[body_ar], [n].[body_en], [n].[created_at], [n].[expiry_at], [n].[large_icon_url], [n].[Route], [n].[target_criteria], [n].[Title], [n].[title_ar], [n].[title_en]
FROM [notification_templates] AS [n]
WHERE [n].[Id] = @__Parse_0
2025-02-06 14:41:09.161 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@__Parse_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [n].[Id], [n].[additional_data], [n].[big_picture_url], [n].[Body], [n].[body_ar], [n].[body_en], [n].[created_at], [n].[expiry_at], [n].[large_icon_url], [n].[Route], [n].[target_criteria], [n].[Title], [n].[title_ar], [n].[title_en]
FROM [notification_templates] AS [n]
WHERE [n].[Id] = @__Parse_0
2025-02-06 14:41:09.164 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@__Parse_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [n].[Id], [n].[additional_data], [n].[big_picture_url], [n].[Body], [n].[body_ar], [n].[body_en], [n].[created_at], [n].[expiry_at], [n].[large_icon_url], [n].[Route], [n].[target_criteria], [n].[Title], [n].[title_ar], [n].[title_en]
FROM [notification_templates] AS [n]
WHERE [n].[Id] = @__Parse_0
2025-02-06 14:41:09.168 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@__Parse_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [n].[Id], [n].[additional_data], [n].[big_picture_url], [n].[Body], [n].[body_ar], [n].[body_en], [n].[created_at], [n].[expiry_at], [n].[large_icon_url], [n].[Route], [n].[target_criteria], [n].[Title], [n].[title_ar], [n].[title_en]
FROM [notification_templates] AS [n]
WHERE [n].[Id] = @__Parse_0
2025-02-06 14:41:09.171 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@__Parse_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [n].[Id], [n].[additional_data], [n].[big_picture_url], [n].[Body], [n].[body_ar], [n].[body_en], [n].[created_at], [n].[expiry_at], [n].[large_icon_url], [n].[Route], [n].[target_criteria], [n].[Title], [n].[title_ar], [n].[title_en]
FROM [notification_templates] AS [n]
WHERE [n].[Id] = @__Parse_0
2025-02-06 14:41:09.177 +03:00 [INF] Executed DbCommand (0ms) [Parameters=[@__Parse_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [n].[Id], [n].[additional_data], [n].[big_picture_url], [n].[Body], [n].[body_ar], [n].[body_en], [n].[created_at], [n].[expiry_at], [n].[large_icon_url], [n].[Route], [n].[target_criteria], [n].[Title], [n].[title_ar], [n].[title_en]
FROM [notification_templates] AS [n]
WHERE [n].[Id] = @__Parse_0
2025-02-06 14:41:09.180 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@__Parse_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [n].[Id], [n].[additional_data], [n].[big_picture_url], [n].[Body], [n].[body_ar], [n].[body_en], [n].[created_at], [n].[expiry_at], [n].[large_icon_url], [n].[Route], [n].[target_criteria], [n].[Title], [n].[title_ar], [n].[title_en]
FROM [notification_templates] AS [n]
WHERE [n].[Id] = @__Parse_0
2025-02-06 14:41:09.183 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@__Parse_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [n].[Id], [n].[additional_data], [n].[big_picture_url], [n].[Body], [n].[body_ar], [n].[body_en], [n].[created_at], [n].[expiry_at], [n].[large_icon_url], [n].[Route], [n].[target_criteria], [n].[Title], [n].[title_ar], [n].[title_en]
FROM [notification_templates] AS [n]
WHERE [n].[Id] = @__Parse_0
2025-02-06 14:41:09.189 +03:00 [INF] Executed DbCommand (2ms) [Parameters=[@__Parse_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [n].[Id], [n].[additional_data], [n].[big_picture_url], [n].[Body], [n].[body_ar], [n].[body_en], [n].[created_at], [n].[expiry_at], [n].[large_icon_url], [n].[Route], [n].[target_criteria], [n].[Title], [n].[title_ar], [n].[title_en]
FROM [notification_templates] AS [n]
WHERE [n].[Id] = @__Parse_0
2025-02-06 14:41:09.194 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@__Parse_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [n].[Id], [n].[additional_data], [n].[big_picture_url], [n].[Body], [n].[body_ar], [n].[body_en], [n].[created_at], [n].[expiry_at], [n].[large_icon_url], [n].[Route], [n].[target_criteria], [n].[Title], [n].[title_ar], [n].[title_en]
FROM [notification_templates] AS [n]
WHERE [n].[Id] = @__Parse_0
2025-02-06 14:41:09.196 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@__Parse_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [n].[Id], [n].[additional_data], [n].[big_picture_url], [n].[Body], [n].[body_ar], [n].[body_en], [n].[created_at], [n].[expiry_at], [n].[large_icon_url], [n].[Route], [n].[target_criteria], [n].[Title], [n].[title_ar], [n].[title_en]
FROM [notification_templates] AS [n]
WHERE [n].[Id] = @__Parse_0
2025-02-06 14:41:09.199 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@__Parse_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [n].[Id], [n].[additional_data], [n].[big_picture_url], [n].[Body], [n].[body_ar], [n].[body_en], [n].[created_at], [n].[expiry_at], [n].[large_icon_url], [n].[Route], [n].[target_criteria], [n].[Title], [n].[title_ar], [n].[title_en]
FROM [notification_templates] AS [n]
WHERE [n].[Id] = @__Parse_0
2025-02-06 14:41:09.203 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@__Parse_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [n].[Id], [n].[additional_data], [n].[big_picture_url], [n].[Body], [n].[body_ar], [n].[body_en], [n].[created_at], [n].[expiry_at], [n].[large_icon_url], [n].[Route], [n].[target_criteria], [n].[Title], [n].[title_ar], [n].[title_en]
FROM [notification_templates] AS [n]
WHERE [n].[Id] = @__Parse_0
2025-02-06 14:41:09.207 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@__Parse_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [n].[Id], [n].[additional_data], [n].[big_picture_url], [n].[Body], [n].[body_ar], [n].[body_en], [n].[created_at], [n].[expiry_at], [n].[large_icon_url], [n].[Route], [n].[target_criteria], [n].[Title], [n].[title_ar], [n].[title_en]
FROM [notification_templates] AS [n]
WHERE [n].[Id] = @__Parse_0
2025-02-06 14:41:09.210 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@__Parse_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [n].[Id], [n].[additional_data], [n].[big_picture_url], [n].[Body], [n].[body_ar], [n].[body_en], [n].[created_at], [n].[expiry_at], [n].[large_icon_url], [n].[Route], [n].[target_criteria], [n].[Title], [n].[title_ar], [n].[title_en]
FROM [notification_templates] AS [n]
WHERE [n].[Id] = @__Parse_0
2025-02-06 14:41:09.213 +03:00 [INF] Executed DbCommand (0ms) [Parameters=[@__Parse_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [n].[Id], [n].[additional_data], [n].[big_picture_url], [n].[Body], [n].[body_ar], [n].[body_en], [n].[created_at], [n].[expiry_at], [n].[large_icon_url], [n].[Route], [n].[target_criteria], [n].[Title], [n].[title_ar], [n].[title_en]
FROM [notification_templates] AS [n]
WHERE [n].[Id] = @__Parse_0
2025-02-06 14:41:09.227 +03:00 [INF] Executed DbCommand (11ms) [Parameters=[@p0='?' (Size = 4000), @p1='?' (DbType = DateTime2), @p2='?' (Size = 4000), @p3='?' (Size = 4000), @p4='?' (Size = 4000), @p5='?' (Size = 450), @p6='?' (Size = 4000), @p7='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SET IMPLICIT_TRANSACTIONS OFF;
SET NOCOUNT ON;
INSERT INTO [AuthLogs] ([AuthType], [CreatedAt], [DeviceId], [FailureReason], [IpAddress], [NationalId], [Status], [UserAgent])
OUTPUT INSERTED.[Id]
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7);
2025-02-06 14:41:09.233 +03:00 [ERR] An exception occurred in the database while saving changes for context type 'NayifatAPI.Data.ApplicationDbContext'.
Microsoft.EntityFrameworkCore.DbUpdateException: An error occurred while saving the entity changes. See the inner exception for details.
 ---> Microsoft.Data.SqlClient.SqlException (0x80131904): The INSERT statement conflicted with the FOREIGN KEY constraint "FK_AuthLogs_Customers_NationalId". The conflict occurred in database "NayifatApp", table "dbo.Customers", column 'NationalId'.
   at Microsoft.Data.SqlClient.SqlConnection.OnError(SqlException exception, Boolean breakConnection, Action`1 wrapCloseInAction)
   at Microsoft.Data.SqlClient.SqlInternalConnection.OnError(SqlException exception, Boolean breakConnection, Action`1 wrapCloseInAction)
   at Microsoft.Data.SqlClient.TdsParser.ThrowExceptionAndWarning(TdsParserStateObject stateObj, Boolean callerHasConnectionLock, Boolean asyncClose)
   at Microsoft.Data.SqlClient.TdsParser.TryRun(RunBehavior runBehavior, SqlCommand cmdHandler, SqlDataReader dataStream, BulkCopySimpleResultSet bulkCopyHandler, TdsParserStateObject stateObj, Boolean& dataReady)
   at Microsoft.Data.SqlClient.SqlDataReader.TryHasMoreRows(Boolean& moreRows)
   at Microsoft.Data.SqlClient.SqlDataReader.TryReadInternal(Boolean setTimeout, Boolean& more)
   at Microsoft.Data.SqlClient.SqlDataReader.ReadAsyncExecute(Task task, Object state)
   at Microsoft.Data.SqlClient.SqlDataReader.InvokeAsyncCall[T](SqlDataReaderBaseAsyncCallContext`1 context)
--- End of stack trace from previous location ---
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeResultSetAsync(Int32 startCommandIndex, RelationalDataReader reader, CancellationToken cancellationToken)
ClientConnectionId:3c86f457-218f-4b5b-8fdd-a6c97d0074e8
Error Number:547,State:0,Class:16
   --- End of inner exception stack trace ---
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeResultSetAsync(Int32 startCommandIndex, RelationalDataReader reader, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeAsync(RelationalDataReader reader, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Update.Internal.SqlServerModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(IList`1 entriesToSave, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(StateManager stateManager, Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Storage.Internal.SqlServerExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
Microsoft.EntityFrameworkCore.DbUpdateException: An error occurred while saving the entity changes. See the inner exception for details.
 ---> Microsoft.Data.SqlClient.SqlException (0x80131904): The INSERT statement conflicted with the FOREIGN KEY constraint "FK_AuthLogs_Customers_NationalId". The conflict occurred in database "NayifatApp", table "dbo.Customers", column 'NationalId'.
   at Microsoft.Data.SqlClient.SqlConnection.OnError(SqlException exception, Boolean breakConnection, Action`1 wrapCloseInAction)
   at Microsoft.Data.SqlClient.SqlInternalConnection.OnError(SqlException exception, Boolean breakConnection, Action`1 wrapCloseInAction)
   at Microsoft.Data.SqlClient.TdsParser.ThrowExceptionAndWarning(TdsParserStateObject stateObj, Boolean callerHasConnectionLock, Boolean asyncClose)
   at Microsoft.Data.SqlClient.TdsParser.TryRun(RunBehavior runBehavior, SqlCommand cmdHandler, SqlDataReader dataStream, BulkCopySimpleResultSet bulkCopyHandler, TdsParserStateObject stateObj, Boolean& dataReady)
   at Microsoft.Data.SqlClient.SqlDataReader.TryHasMoreRows(Boolean& moreRows)
   at Microsoft.Data.SqlClient.SqlDataReader.TryReadInternal(Boolean setTimeout, Boolean& more)
   at Microsoft.Data.SqlClient.SqlDataReader.ReadAsyncExecute(Task task, Object state)
   at Microsoft.Data.SqlClient.SqlDataReader.InvokeAsyncCall[T](SqlDataReaderBaseAsyncCallContext`1 context)
--- End of stack trace from previous location ---
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeResultSetAsync(Int32 startCommandIndex, RelationalDataReader reader, CancellationToken cancellationToken)
ClientConnectionId:3c86f457-218f-4b5b-8fdd-a6c97d0074e8
Error Number:547,State:0,Class:16
   --- End of inner exception stack trace ---
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeResultSetAsync(Int32 startCommandIndex, RelationalDataReader reader, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeAsync(RelationalDataReader reader, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Update.Internal.SqlServerModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(IList`1 entriesToSave, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(StateManager stateManager, Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Storage.Internal.SqlServerExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
2025-02-06 14:41:09.263 +03:00 [ERR] Error logging audit event. NationalId: all, Action: notification_delivered, Details: {"notification_count":21,"notification_ids":[38,37,36,35,34,33,32,31,30,29,28,27,26,25,24,23,23,20,19,18,12],"timestamp":"2025-02-06T14:41:09.1327846"}
Microsoft.EntityFrameworkCore.DbUpdateException: An error occurred while saving the entity changes. See the inner exception for details.
 ---> Microsoft.Data.SqlClient.SqlException (0x80131904): The INSERT statement conflicted with the FOREIGN KEY constraint "FK_AuthLogs_Customers_NationalId". The conflict occurred in database "NayifatApp", table "dbo.Customers", column 'NationalId'.
   at Microsoft.Data.SqlClient.SqlConnection.OnError(SqlException exception, Boolean breakConnection, Action`1 wrapCloseInAction)
   at Microsoft.Data.SqlClient.SqlInternalConnection.OnError(SqlException exception, Boolean breakConnection, Action`1 wrapCloseInAction)
   at Microsoft.Data.SqlClient.TdsParser.ThrowExceptionAndWarning(TdsParserStateObject stateObj, Boolean callerHasConnectionLock, Boolean asyncClose)
   at Microsoft.Data.SqlClient.TdsParser.TryRun(RunBehavior runBehavior, SqlCommand cmdHandler, SqlDataReader dataStream, BulkCopySimpleResultSet bulkCopyHandler, TdsParserStateObject stateObj, Boolean& dataReady)
   at Microsoft.Data.SqlClient.SqlDataReader.TryHasMoreRows(Boolean& moreRows)
   at Microsoft.Data.SqlClient.SqlDataReader.TryReadInternal(Boolean setTimeout, Boolean& more)
   at Microsoft.Data.SqlClient.SqlDataReader.ReadAsyncExecute(Task task, Object state)
   at Microsoft.Data.SqlClient.SqlDataReader.InvokeAsyncCall[T](SqlDataReaderBaseAsyncCallContext`1 context)
--- End of stack trace from previous location ---
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeResultSetAsync(Int32 startCommandIndex, RelationalDataReader reader, CancellationToken cancellationToken)
ClientConnectionId:3c86f457-218f-4b5b-8fdd-a6c97d0074e8
Error Number:547,State:0,Class:16
   --- End of inner exception stack trace ---
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeResultSetAsync(Int32 startCommandIndex, RelationalDataReader reader, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeAsync(RelationalDataReader reader, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Update.Internal.SqlServerModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(IList`1 entriesToSave, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(StateManager stateManager, Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Storage.Internal.SqlServerExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at NayifatAPI.Services.AuditLogService.LogAsync(String nationalId, String action, Object details) in C:\Users\yamta\StudioProjects\nayifat_app_2025_new\NayifatAPI\Services\AuditLogService.cs:line 36
2025-02-06 14:41:09.276 +03:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType11`2[[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Object, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-02-06 14:41:09.278 +03:00 [INF] Executed action NayifatAPI.Controllers.NotificationsController.GetNotifications (NayifatAPI) in 176.9675ms
2025-02-06 14:41:09.281 +03:00 [INF] Executed endpoint 'NayifatAPI.Controllers.NotificationsController.GetNotifications (NayifatAPI)'
2025-02-06 14:41:09.282 +03:00 [INF] Request finished HTTP/1.1 POST http://eb3c-46-152-255-232.ngrok-free.app/api/notifications/list - 200 null application/json; charset=utf-8 187.6469ms
2025-02-06 14:41:09.548 +03:00 [INF] Request starting HTTP/1.1 POST http://eb3c-46-152-255-232.ngrok-free.app/api/notifications/list - application/json 45
2025-02-06 14:41:09.555 +03:00 [INF] Executing endpoint 'NayifatAPI.Controllers.NotificationsController.GetNotifications (NayifatAPI)'
2025-02-06 14:41:09.556 +03:00 [INF] Route matched with {action = "GetNotifications", controller = "Notifications"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetNotifications(NayifatAPI.Controllers.GetNotificationsRequest) on controller NayifatAPI.Controllers.NotificationsController (NayifatAPI).
2025-02-06 14:41:09.562 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@__providedApiKey_0='?' (Size = 255)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [a].[api_Key], [a].[CreatedAt], [a].[Description], [a].[ExpiresAt], [a].[IsActive], [a].[LastUsedAt]
FROM [ApiKeys] AS [a]
WHERE [a].[api_Key] = @__providedApiKey_0 AND [a].[IsActive] = CAST(1 AS bit)
2025-02-06 14:41:09.567 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@__request_NationalId_0='?' (Size = 450)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [u].[national_id], [u].[last_updated], [u].[notifications]
FROM [user_notifications] AS [u]
WHERE [u].[national_id] = @__request_NationalId_0
2025-02-06 14:41:09.569 +03:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType11`2[[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Object, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-02-06 14:41:09.571 +03:00 [INF] Executed action NayifatAPI.Controllers.NotificationsController.GetNotifications (NayifatAPI) in 11.0638ms
2025-02-06 14:41:09.572 +03:00 [INF] Executed endpoint 'NayifatAPI.Controllers.NotificationsController.GetNotifications (NayifatAPI)'
2025-02-06 14:41:09.574 +03:00 [INF] Request finished HTTP/1.1 POST http://eb3c-46-152-255-232.ngrok-free.app/api/notifications/list - 200 null application/json; charset=utf-8 26.6062ms
2025-02-06 14:41:20.090 +03:00 [INF] Request starting HTTP/1.1 POST http://eb3c-46-152-255-232.ngrok-free.app/api/notifications/list - application/json; charset=utf-8 45
2025-02-06 14:41:20.093 +03:00 [INF] Executing endpoint 'NayifatAPI.Controllers.NotificationsController.GetNotifications (NayifatAPI)'
2025-02-06 14:41:20.094 +03:00 [INF] Route matched with {action = "GetNotifications", controller = "Notifications"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetNotifications(NayifatAPI.Controllers.GetNotificationsRequest) on controller NayifatAPI.Controllers.NotificationsController (NayifatAPI).
2025-02-06 14:41:20.114 +03:00 [INF] Executed DbCommand (13ms) [Parameters=[@__providedApiKey_0='?' (Size = 255)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [a].[api_Key], [a].[CreatedAt], [a].[Description], [a].[ExpiresAt], [a].[IsActive], [a].[LastUsedAt]
FROM [ApiKeys] AS [a]
WHERE [a].[api_Key] = @__providedApiKey_0 AND [a].[IsActive] = CAST(1 AS bit)
2025-02-06 14:41:20.120 +03:00 [INF] Executed DbCommand (3ms) [Parameters=[@__request_NationalId_0='?' (Size = 450)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [u].[national_id], [u].[last_updated], [u].[notifications]
FROM [user_notifications] AS [u]
WHERE [u].[national_id] = @__request_NationalId_0
2025-02-06 14:41:20.124 +03:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType11`2[[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Object, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-02-06 14:41:20.126 +03:00 [INF] Executed action NayifatAPI.Controllers.NotificationsController.GetNotifications (NayifatAPI) in 29.5891ms
2025-02-06 14:41:20.130 +03:00 [INF] Executed endpoint 'NayifatAPI.Controllers.NotificationsController.GetNotifications (NayifatAPI)'
2025-02-06 14:41:20.131 +03:00 [INF] Request finished HTTP/1.1 POST http://eb3c-46-152-255-232.ngrok-free.app/api/notifications/list - 200 null application/json; charset=utf-8 41.0748ms
2025-02-06 14:41:20.760 +03:00 [INF] Request starting HTTP/1.1 POST http://eb3c-46-152-255-232.ngrok-free.app/api/notifications/list - application/json; charset=utf-8 39
2025-02-06 14:41:20.765 +03:00 [INF] Executing endpoint 'NayifatAPI.Controllers.NotificationsController.GetNotifications (NayifatAPI)'
2025-02-06 14:41:20.766 +03:00 [INF] Route matched with {action = "GetNotifications", controller = "Notifications"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetNotifications(NayifatAPI.Controllers.GetNotificationsRequest) on controller NayifatAPI.Controllers.NotificationsController (NayifatAPI).
2025-02-06 14:41:20.773 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@__providedApiKey_0='?' (Size = 255)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [a].[api_Key], [a].[CreatedAt], [a].[Description], [a].[ExpiresAt], [a].[IsActive], [a].[LastUsedAt]
FROM [ApiKeys] AS [a]
WHERE [a].[api_Key] = @__providedApiKey_0 AND [a].[IsActive] = CAST(1 AS bit)
2025-02-06 14:41:20.777 +03:00 [INF] Executed DbCommand (0ms) [Parameters=[@__request_NationalId_0='?' (Size = 450)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [u].[national_id], [u].[last_updated], [u].[notifications]
FROM [user_notifications] AS [u]
WHERE [u].[national_id] = @__request_NationalId_0
2025-02-06 14:41:20.784 +03:00 [INF] Executed DbCommand (3ms) [Parameters=[@__Parse_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [n].[Id], [n].[additional_data], [n].[big_picture_url], [n].[Body], [n].[body_ar], [n].[body_en], [n].[created_at], [n].[expiry_at], [n].[large_icon_url], [n].[Route], [n].[target_criteria], [n].[Title], [n].[title_ar], [n].[title_en]
FROM [notification_templates] AS [n]
WHERE [n].[Id] = @__Parse_0
2025-02-06 14:41:20.788 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@__Parse_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [n].[Id], [n].[additional_data], [n].[big_picture_url], [n].[Body], [n].[body_ar], [n].[body_en], [n].[created_at], [n].[expiry_at], [n].[large_icon_url], [n].[Route], [n].[target_criteria], [n].[Title], [n].[title_ar], [n].[title_en]
FROM [notification_templates] AS [n]
WHERE [n].[Id] = @__Parse_0
2025-02-06 14:41:20.791 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@__Parse_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [n].[Id], [n].[additional_data], [n].[big_picture_url], [n].[Body], [n].[body_ar], [n].[body_en], [n].[created_at], [n].[expiry_at], [n].[large_icon_url], [n].[Route], [n].[target_criteria], [n].[Title], [n].[title_ar], [n].[title_en]
FROM [notification_templates] AS [n]
WHERE [n].[Id] = @__Parse_0
2025-02-06 14:41:20.794 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@__Parse_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [n].[Id], [n].[additional_data], [n].[big_picture_url], [n].[Body], [n].[body_ar], [n].[body_en], [n].[created_at], [n].[expiry_at], [n].[large_icon_url], [n].[Route], [n].[target_criteria], [n].[Title], [n].[title_ar], [n].[title_en]
FROM [notification_templates] AS [n]
WHERE [n].[Id] = @__Parse_0
2025-02-06 14:41:20.798 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@__Parse_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [n].[Id], [n].[additional_data], [n].[big_picture_url], [n].[Body], [n].[body_ar], [n].[body_en], [n].[created_at], [n].[expiry_at], [n].[large_icon_url], [n].[Route], [n].[target_criteria], [n].[Title], [n].[title_ar], [n].[title_en]
FROM [notification_templates] AS [n]
WHERE [n].[Id] = @__Parse_0
2025-02-06 14:41:20.802 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@__Parse_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [n].[Id], [n].[additional_data], [n].[big_picture_url], [n].[Body], [n].[body_ar], [n].[body_en], [n].[created_at], [n].[expiry_at], [n].[large_icon_url], [n].[Route], [n].[target_criteria], [n].[Title], [n].[title_ar], [n].[title_en]
FROM [notification_templates] AS [n]
WHERE [n].[Id] = @__Parse_0
2025-02-06 14:41:20.812 +03:00 [INF] Executed DbCommand (6ms) [Parameters=[@__Parse_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [n].[Id], [n].[additional_data], [n].[big_picture_url], [n].[Body], [n].[body_ar], [n].[body_en], [n].[created_at], [n].[expiry_at], [n].[large_icon_url], [n].[Route], [n].[target_criteria], [n].[Title], [n].[title_ar], [n].[title_en]
FROM [notification_templates] AS [n]
WHERE [n].[Id] = @__Parse_0
2025-02-06 14:41:20.815 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@__Parse_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [n].[Id], [n].[additional_data], [n].[big_picture_url], [n].[Body], [n].[body_ar], [n].[body_en], [n].[created_at], [n].[expiry_at], [n].[large_icon_url], [n].[Route], [n].[target_criteria], [n].[Title], [n].[title_ar], [n].[title_en]
FROM [notification_templates] AS [n]
WHERE [n].[Id] = @__Parse_0
2025-02-06 14:41:20.820 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@__Parse_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [n].[Id], [n].[additional_data], [n].[big_picture_url], [n].[Body], [n].[body_ar], [n].[body_en], [n].[created_at], [n].[expiry_at], [n].[large_icon_url], [n].[Route], [n].[target_criteria], [n].[Title], [n].[title_ar], [n].[title_en]
FROM [notification_templates] AS [n]
WHERE [n].[Id] = @__Parse_0
2025-02-06 14:41:20.824 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@__Parse_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [n].[Id], [n].[additional_data], [n].[big_picture_url], [n].[Body], [n].[body_ar], [n].[body_en], [n].[created_at], [n].[expiry_at], [n].[large_icon_url], [n].[Route], [n].[target_criteria], [n].[Title], [n].[title_ar], [n].[title_en]
FROM [notification_templates] AS [n]
WHERE [n].[Id] = @__Parse_0
2025-02-06 14:41:20.829 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@__Parse_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [n].[Id], [n].[additional_data], [n].[big_picture_url], [n].[Body], [n].[body_ar], [n].[body_en], [n].[created_at], [n].[expiry_at], [n].[large_icon_url], [n].[Route], [n].[target_criteria], [n].[Title], [n].[title_ar], [n].[title_en]
FROM [notification_templates] AS [n]
WHERE [n].[Id] = @__Parse_0
2025-02-06 14:41:20.834 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@__Parse_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [n].[Id], [n].[additional_data], [n].[big_picture_url], [n].[Body], [n].[body_ar], [n].[body_en], [n].[created_at], [n].[expiry_at], [n].[large_icon_url], [n].[Route], [n].[target_criteria], [n].[Title], [n].[title_ar], [n].[title_en]
FROM [notification_templates] AS [n]
WHERE [n].[Id] = @__Parse_0
2025-02-06 14:41:20.838 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@__Parse_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [n].[Id], [n].[additional_data], [n].[big_picture_url], [n].[Body], [n].[body_ar], [n].[body_en], [n].[created_at], [n].[expiry_at], [n].[large_icon_url], [n].[Route], [n].[target_criteria], [n].[Title], [n].[title_ar], [n].[title_en]
FROM [notification_templates] AS [n]
WHERE [n].[Id] = @__Parse_0
2025-02-06 14:41:20.843 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@__Parse_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [n].[Id], [n].[additional_data], [n].[big_picture_url], [n].[Body], [n].[body_ar], [n].[body_en], [n].[created_at], [n].[expiry_at], [n].[large_icon_url], [n].[Route], [n].[target_criteria], [n].[Title], [n].[title_ar], [n].[title_en]
FROM [notification_templates] AS [n]
WHERE [n].[Id] = @__Parse_0
2025-02-06 14:41:20.848 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@__Parse_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [n].[Id], [n].[additional_data], [n].[big_picture_url], [n].[Body], [n].[body_ar], [n].[body_en], [n].[created_at], [n].[expiry_at], [n].[large_icon_url], [n].[Route], [n].[target_criteria], [n].[Title], [n].[title_ar], [n].[title_en]
FROM [notification_templates] AS [n]
WHERE [n].[Id] = @__Parse_0
2025-02-06 14:41:20.854 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@__Parse_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [n].[Id], [n].[additional_data], [n].[big_picture_url], [n].[Body], [n].[body_ar], [n].[body_en], [n].[created_at], [n].[expiry_at], [n].[large_icon_url], [n].[Route], [n].[target_criteria], [n].[Title], [n].[title_ar], [n].[title_en]
FROM [notification_templates] AS [n]
WHERE [n].[Id] = @__Parse_0
2025-02-06 14:41:20.860 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@__Parse_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [n].[Id], [n].[additional_data], [n].[big_picture_url], [n].[Body], [n].[body_ar], [n].[body_en], [n].[created_at], [n].[expiry_at], [n].[large_icon_url], [n].[Route], [n].[target_criteria], [n].[Title], [n].[title_ar], [n].[title_en]
FROM [notification_templates] AS [n]
WHERE [n].[Id] = @__Parse_0
2025-02-06 14:41:20.865 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@__Parse_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [n].[Id], [n].[additional_data], [n].[big_picture_url], [n].[Body], [n].[body_ar], [n].[body_en], [n].[created_at], [n].[expiry_at], [n].[large_icon_url], [n].[Route], [n].[target_criteria], [n].[Title], [n].[title_ar], [n].[title_en]
FROM [notification_templates] AS [n]
WHERE [n].[Id] = @__Parse_0
2025-02-06 14:41:20.870 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@__Parse_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [n].[Id], [n].[additional_data], [n].[big_picture_url], [n].[Body], [n].[body_ar], [n].[body_en], [n].[created_at], [n].[expiry_at], [n].[large_icon_url], [n].[Route], [n].[target_criteria], [n].[Title], [n].[title_ar], [n].[title_en]
FROM [notification_templates] AS [n]
WHERE [n].[Id] = @__Parse_0
2025-02-06 14:41:20.875 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@__Parse_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [n].[Id], [n].[additional_data], [n].[big_picture_url], [n].[Body], [n].[body_ar], [n].[body_en], [n].[created_at], [n].[expiry_at], [n].[large_icon_url], [n].[Route], [n].[target_criteria], [n].[Title], [n].[title_ar], [n].[title_en]
FROM [notification_templates] AS [n]
WHERE [n].[Id] = @__Parse_0
2025-02-06 14:41:20.880 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@__Parse_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [n].[Id], [n].[additional_data], [n].[big_picture_url], [n].[Body], [n].[body_ar], [n].[body_en], [n].[created_at], [n].[expiry_at], [n].[large_icon_url], [n].[Route], [n].[target_criteria], [n].[Title], [n].[title_ar], [n].[title_en]
FROM [notification_templates] AS [n]
WHERE [n].[Id] = @__Parse_0
2025-02-06 14:41:20.894 +03:00 [INF] Executed DbCommand (11ms) [Parameters=[@p0='?' (Size = 4000), @p1='?' (DbType = DateTime2), @p2='?' (Size = 4000), @p3='?' (Size = 4000), @p4='?' (Size = 4000), @p5='?' (Size = 450), @p6='?' (Size = 4000), @p7='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SET IMPLICIT_TRANSACTIONS OFF;
SET NOCOUNT ON;
INSERT INTO [AuthLogs] ([AuthType], [CreatedAt], [DeviceId], [FailureReason], [IpAddress], [NationalId], [Status], [UserAgent])
OUTPUT INSERTED.[Id]
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7);
2025-02-06 14:41:20.898 +03:00 [ERR] An exception occurred in the database while saving changes for context type 'NayifatAPI.Data.ApplicationDbContext'.
Microsoft.EntityFrameworkCore.DbUpdateException: An error occurred while saving the entity changes. See the inner exception for details.
 ---> Microsoft.Data.SqlClient.SqlException (0x80131904): The INSERT statement conflicted with the FOREIGN KEY constraint "FK_AuthLogs_Customers_NationalId". The conflict occurred in database "NayifatApp", table "dbo.Customers", column 'NationalId'.
   at Microsoft.Data.SqlClient.SqlConnection.OnError(SqlException exception, Boolean breakConnection, Action`1 wrapCloseInAction)
   at Microsoft.Data.SqlClient.SqlInternalConnection.OnError(SqlException exception, Boolean breakConnection, Action`1 wrapCloseInAction)
   at Microsoft.Data.SqlClient.TdsParser.ThrowExceptionAndWarning(TdsParserStateObject stateObj, Boolean callerHasConnectionLock, Boolean asyncClose)
   at Microsoft.Data.SqlClient.TdsParser.TryRun(RunBehavior runBehavior, SqlCommand cmdHandler, SqlDataReader dataStream, BulkCopySimpleResultSet bulkCopyHandler, TdsParserStateObject stateObj, Boolean& dataReady)
   at Microsoft.Data.SqlClient.SqlDataReader.TryHasMoreRows(Boolean& moreRows)
   at Microsoft.Data.SqlClient.SqlDataReader.TryReadInternal(Boolean setTimeout, Boolean& more)
   at Microsoft.Data.SqlClient.SqlDataReader.ReadAsyncExecute(Task task, Object state)
   at Microsoft.Data.SqlClient.SqlDataReader.InvokeAsyncCall[T](SqlDataReaderBaseAsyncCallContext`1 context)
--- End of stack trace from previous location ---
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeResultSetAsync(Int32 startCommandIndex, RelationalDataReader reader, CancellationToken cancellationToken)
ClientConnectionId:3c86f457-218f-4b5b-8fdd-a6c97d0074e8
Error Number:547,State:0,Class:16
   --- End of inner exception stack trace ---
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeResultSetAsync(Int32 startCommandIndex, RelationalDataReader reader, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeAsync(RelationalDataReader reader, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Update.Internal.SqlServerModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(IList`1 entriesToSave, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(StateManager stateManager, Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Storage.Internal.SqlServerExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
Microsoft.EntityFrameworkCore.DbUpdateException: An error occurred while saving the entity changes. See the inner exception for details.
 ---> Microsoft.Data.SqlClient.SqlException (0x80131904): The INSERT statement conflicted with the FOREIGN KEY constraint "FK_AuthLogs_Customers_NationalId". The conflict occurred in database "NayifatApp", table "dbo.Customers", column 'NationalId'.
   at Microsoft.Data.SqlClient.SqlConnection.OnError(SqlException exception, Boolean breakConnection, Action`1 wrapCloseInAction)
   at Microsoft.Data.SqlClient.SqlInternalConnection.OnError(SqlException exception, Boolean breakConnection, Action`1 wrapCloseInAction)
   at Microsoft.Data.SqlClient.TdsParser.ThrowExceptionAndWarning(TdsParserStateObject stateObj, Boolean callerHasConnectionLock, Boolean asyncClose)
   at Microsoft.Data.SqlClient.TdsParser.TryRun(RunBehavior runBehavior, SqlCommand cmdHandler, SqlDataReader dataStream, BulkCopySimpleResultSet bulkCopyHandler, TdsParserStateObject stateObj, Boolean& dataReady)
   at Microsoft.Data.SqlClient.SqlDataReader.TryHasMoreRows(Boolean& moreRows)
   at Microsoft.Data.SqlClient.SqlDataReader.TryReadInternal(Boolean setTimeout, Boolean& more)
   at Microsoft.Data.SqlClient.SqlDataReader.ReadAsyncExecute(Task task, Object state)
   at Microsoft.Data.SqlClient.SqlDataReader.InvokeAsyncCall[T](SqlDataReaderBaseAsyncCallContext`1 context)
--- End of stack trace from previous location ---
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeResultSetAsync(Int32 startCommandIndex, RelationalDataReader reader, CancellationToken cancellationToken)
ClientConnectionId:3c86f457-218f-4b5b-8fdd-a6c97d0074e8
Error Number:547,State:0,Class:16
   --- End of inner exception stack trace ---
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeResultSetAsync(Int32 startCommandIndex, RelationalDataReader reader, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeAsync(RelationalDataReader reader, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Update.Internal.SqlServerModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(IList`1 entriesToSave, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(StateManager stateManager, Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Storage.Internal.SqlServerExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
2025-02-06 14:41:20.919 +03:00 [ERR] Error logging audit event. NationalId: all, Action: notification_delivered, Details: {"notification_count":21,"notification_ids":[38,37,36,35,34,33,32,31,30,29,28,27,26,25,24,23,23,20,19,18,12],"timestamp":"2025-02-06T14:41:20.7810922"}
Microsoft.EntityFrameworkCore.DbUpdateException: An error occurred while saving the entity changes. See the inner exception for details.
 ---> Microsoft.Data.SqlClient.SqlException (0x80131904): The INSERT statement conflicted with the FOREIGN KEY constraint "FK_AuthLogs_Customers_NationalId". The conflict occurred in database "NayifatApp", table "dbo.Customers", column 'NationalId'.
   at Microsoft.Data.SqlClient.SqlConnection.OnError(SqlException exception, Boolean breakConnection, Action`1 wrapCloseInAction)
   at Microsoft.Data.SqlClient.SqlInternalConnection.OnError(SqlException exception, Boolean breakConnection, Action`1 wrapCloseInAction)
   at Microsoft.Data.SqlClient.TdsParser.ThrowExceptionAndWarning(TdsParserStateObject stateObj, Boolean callerHasConnectionLock, Boolean asyncClose)
   at Microsoft.Data.SqlClient.TdsParser.TryRun(RunBehavior runBehavior, SqlCommand cmdHandler, SqlDataReader dataStream, BulkCopySimpleResultSet bulkCopyHandler, TdsParserStateObject stateObj, Boolean& dataReady)
   at Microsoft.Data.SqlClient.SqlDataReader.TryHasMoreRows(Boolean& moreRows)
   at Microsoft.Data.SqlClient.SqlDataReader.TryReadInternal(Boolean setTimeout, Boolean& more)
   at Microsoft.Data.SqlClient.SqlDataReader.ReadAsyncExecute(Task task, Object state)
   at Microsoft.Data.SqlClient.SqlDataReader.InvokeAsyncCall[T](SqlDataReaderBaseAsyncCallContext`1 context)
--- End of stack trace from previous location ---
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeResultSetAsync(Int32 startCommandIndex, RelationalDataReader reader, CancellationToken cancellationToken)
ClientConnectionId:3c86f457-218f-4b5b-8fdd-a6c97d0074e8
Error Number:547,State:0,Class:16
   --- End of inner exception stack trace ---
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeResultSetAsync(Int32 startCommandIndex, RelationalDataReader reader, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeAsync(RelationalDataReader reader, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Update.Internal.SqlServerModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(IList`1 entriesToSave, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(StateManager stateManager, Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Storage.Internal.SqlServerExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at NayifatAPI.Services.AuditLogService.LogAsync(String nationalId, String action, Object details) in C:\Users\yamta\StudioProjects\nayifat_app_2025_new\NayifatAPI\Services\AuditLogService.cs:line 36
2025-02-06 14:41:20.938 +03:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType11`2[[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Object, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-02-06 14:41:20.940 +03:00 [INF] Executed action NayifatAPI.Controllers.NotificationsController.GetNotifications (NayifatAPI) in 171.0126ms
2025-02-06 14:41:20.941 +03:00 [INF] Executed endpoint 'NayifatAPI.Controllers.NotificationsController.GetNotifications (NayifatAPI)'
2025-02-06 14:41:20.943 +03:00 [INF] Request finished HTTP/1.1 POST http://eb3c-46-152-255-232.ngrok-free.app/api/notifications/list - 200 null application/json; charset=utf-8 182.8856ms
2025-02-06 14:46:22.718 +03:00 [INF] Request starting HTTP/1.1 POST http://eb3c-46-152-255-232.ngrok-free.app/api/notifications/list - application/json; charset=utf-8 45
2025-02-06 14:46:22.720 +03:00 [INF] Executing endpoint 'NayifatAPI.Controllers.NotificationsController.GetNotifications (NayifatAPI)'
2025-02-06 14:46:22.721 +03:00 [INF] Route matched with {action = "GetNotifications", controller = "Notifications"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetNotifications(NayifatAPI.Controllers.GetNotificationsRequest) on controller NayifatAPI.Controllers.NotificationsController (NayifatAPI).
2025-02-06 14:46:22.746 +03:00 [INF] Executed DbCommand (10ms) [Parameters=[@__providedApiKey_0='?' (Size = 255)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [a].[api_Key], [a].[CreatedAt], [a].[Description], [a].[ExpiresAt], [a].[IsActive], [a].[LastUsedAt]
FROM [ApiKeys] AS [a]
WHERE [a].[api_Key] = @__providedApiKey_0 AND [a].[IsActive] = CAST(1 AS bit)
2025-02-06 14:46:22.752 +03:00 [INF] Executed DbCommand (3ms) [Parameters=[@__request_NationalId_0='?' (Size = 450)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [u].[national_id], [u].[last_updated], [u].[notifications]
FROM [user_notifications] AS [u]
WHERE [u].[national_id] = @__request_NationalId_0
2025-02-06 14:46:22.756 +03:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType11`2[[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Object, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-02-06 14:46:22.757 +03:00 [INF] Executed action NayifatAPI.Controllers.NotificationsController.GetNotifications (NayifatAPI) in 29.2399ms
2025-02-06 14:46:22.759 +03:00 [INF] Executed endpoint 'NayifatAPI.Controllers.NotificationsController.GetNotifications (NayifatAPI)'
2025-02-06 14:46:22.760 +03:00 [INF] Request finished HTTP/1.1 POST http://eb3c-46-152-255-232.ngrok-free.app/api/notifications/list - 200 null application/json; charset=utf-8 42.0622ms
2025-02-06 14:46:23.106 +03:00 [INF] Request starting HTTP/1.1 POST http://eb3c-46-152-255-232.ngrok-free.app/api/notifications/list - application/json; charset=utf-8 39
2025-02-06 14:46:23.110 +03:00 [INF] Executing endpoint 'NayifatAPI.Controllers.NotificationsController.GetNotifications (NayifatAPI)'
2025-02-06 14:46:23.111 +03:00 [INF] Route matched with {action = "GetNotifications", controller = "Notifications"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetNotifications(NayifatAPI.Controllers.GetNotificationsRequest) on controller NayifatAPI.Controllers.NotificationsController (NayifatAPI).
2025-02-06 14:46:23.114 +03:00 [INF] Executed DbCommand (0ms) [Parameters=[@__providedApiKey_0='?' (Size = 255)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [a].[api_Key], [a].[CreatedAt], [a].[Description], [a].[ExpiresAt], [a].[IsActive], [a].[LastUsedAt]
FROM [ApiKeys] AS [a]
WHERE [a].[api_Key] = @__providedApiKey_0 AND [a].[IsActive] = CAST(1 AS bit)
2025-02-06 14:46:23.117 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@__request_NationalId_0='?' (Size = 450)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [u].[national_id], [u].[last_updated], [u].[notifications]
FROM [user_notifications] AS [u]
WHERE [u].[national_id] = @__request_NationalId_0
2025-02-06 14:46:23.123 +03:00 [INF] Executed DbCommand (3ms) [Parameters=[@__Parse_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [n].[Id], [n].[additional_data], [n].[big_picture_url], [n].[Body], [n].[body_ar], [n].[body_en], [n].[created_at], [n].[expiry_at], [n].[large_icon_url], [n].[Route], [n].[target_criteria], [n].[Title], [n].[title_ar], [n].[title_en]
FROM [notification_templates] AS [n]
WHERE [n].[Id] = @__Parse_0
2025-02-06 14:46:23.126 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@__Parse_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [n].[Id], [n].[additional_data], [n].[big_picture_url], [n].[Body], [n].[body_ar], [n].[body_en], [n].[created_at], [n].[expiry_at], [n].[large_icon_url], [n].[Route], [n].[target_criteria], [n].[Title], [n].[title_ar], [n].[title_en]
FROM [notification_templates] AS [n]
WHERE [n].[Id] = @__Parse_0
2025-02-06 14:46:23.133 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@__Parse_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [n].[Id], [n].[additional_data], [n].[big_picture_url], [n].[Body], [n].[body_ar], [n].[body_en], [n].[created_at], [n].[expiry_at], [n].[large_icon_url], [n].[Route], [n].[target_criteria], [n].[Title], [n].[title_ar], [n].[title_en]
FROM [notification_templates] AS [n]
WHERE [n].[Id] = @__Parse_0
2025-02-06 14:46:23.136 +03:00 [INF] Executed DbCommand (0ms) [Parameters=[@__Parse_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [n].[Id], [n].[additional_data], [n].[big_picture_url], [n].[Body], [n].[body_ar], [n].[body_en], [n].[created_at], [n].[expiry_at], [n].[large_icon_url], [n].[Route], [n].[target_criteria], [n].[Title], [n].[title_ar], [n].[title_en]
FROM [notification_templates] AS [n]
WHERE [n].[Id] = @__Parse_0
2025-02-06 14:46:23.139 +03:00 [INF] Executed DbCommand (0ms) [Parameters=[@__Parse_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [n].[Id], [n].[additional_data], [n].[big_picture_url], [n].[Body], [n].[body_ar], [n].[body_en], [n].[created_at], [n].[expiry_at], [n].[large_icon_url], [n].[Route], [n].[target_criteria], [n].[Title], [n].[title_ar], [n].[title_en]
FROM [notification_templates] AS [n]
WHERE [n].[Id] = @__Parse_0
2025-02-06 14:46:23.142 +03:00 [INF] Executed DbCommand (0ms) [Parameters=[@__Parse_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [n].[Id], [n].[additional_data], [n].[big_picture_url], [n].[Body], [n].[body_ar], [n].[body_en], [n].[created_at], [n].[expiry_at], [n].[large_icon_url], [n].[Route], [n].[target_criteria], [n].[Title], [n].[title_ar], [n].[title_en]
FROM [notification_templates] AS [n]
WHERE [n].[Id] = @__Parse_0
2025-02-06 14:46:23.150 +03:00 [INF] Executed DbCommand (6ms) [Parameters=[@__Parse_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [n].[Id], [n].[additional_data], [n].[big_picture_url], [n].[Body], [n].[body_ar], [n].[body_en], [n].[created_at], [n].[expiry_at], [n].[large_icon_url], [n].[Route], [n].[target_criteria], [n].[Title], [n].[title_ar], [n].[title_en]
FROM [notification_templates] AS [n]
WHERE [n].[Id] = @__Parse_0
2025-02-06 14:46:23.152 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@__Parse_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [n].[Id], [n].[additional_data], [n].[big_picture_url], [n].[Body], [n].[body_ar], [n].[body_en], [n].[created_at], [n].[expiry_at], [n].[large_icon_url], [n].[Route], [n].[target_criteria], [n].[Title], [n].[title_ar], [n].[title_en]
FROM [notification_templates] AS [n]
WHERE [n].[Id] = @__Parse_0
2025-02-06 14:46:23.155 +03:00 [INF] Executed DbCommand (0ms) [Parameters=[@__Parse_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [n].[Id], [n].[additional_data], [n].[big_picture_url], [n].[Body], [n].[body_ar], [n].[body_en], [n].[created_at], [n].[expiry_at], [n].[large_icon_url], [n].[Route], [n].[target_criteria], [n].[Title], [n].[title_ar], [n].[title_en]
FROM [notification_templates] AS [n]
WHERE [n].[Id] = @__Parse_0
2025-02-06 14:46:23.157 +03:00 [INF] Executed DbCommand (0ms) [Parameters=[@__Parse_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [n].[Id], [n].[additional_data], [n].[big_picture_url], [n].[Body], [n].[body_ar], [n].[body_en], [n].[created_at], [n].[expiry_at], [n].[large_icon_url], [n].[Route], [n].[target_criteria], [n].[Title], [n].[title_ar], [n].[title_en]
FROM [notification_templates] AS [n]
WHERE [n].[Id] = @__Parse_0
2025-02-06 14:46:23.160 +03:00 [INF] Executed DbCommand (0ms) [Parameters=[@__Parse_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [n].[Id], [n].[additional_data], [n].[big_picture_url], [n].[Body], [n].[body_ar], [n].[body_en], [n].[created_at], [n].[expiry_at], [n].[large_icon_url], [n].[Route], [n].[target_criteria], [n].[Title], [n].[title_ar], [n].[title_en]
FROM [notification_templates] AS [n]
WHERE [n].[Id] = @__Parse_0
2025-02-06 14:46:23.163 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@__Parse_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [n].[Id], [n].[additional_data], [n].[big_picture_url], [n].[Body], [n].[body_ar], [n].[body_en], [n].[created_at], [n].[expiry_at], [n].[large_icon_url], [n].[Route], [n].[target_criteria], [n].[Title], [n].[title_ar], [n].[title_en]
FROM [notification_templates] AS [n]
WHERE [n].[Id] = @__Parse_0
2025-02-06 14:46:23.166 +03:00 [INF] Executed DbCommand (0ms) [Parameters=[@__Parse_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [n].[Id], [n].[additional_data], [n].[big_picture_url], [n].[Body], [n].[body_ar], [n].[body_en], [n].[created_at], [n].[expiry_at], [n].[large_icon_url], [n].[Route], [n].[target_criteria], [n].[Title], [n].[title_ar], [n].[title_en]
FROM [notification_templates] AS [n]
WHERE [n].[Id] = @__Parse_0
2025-02-06 14:46:23.169 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@__Parse_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [n].[Id], [n].[additional_data], [n].[big_picture_url], [n].[Body], [n].[body_ar], [n].[body_en], [n].[created_at], [n].[expiry_at], [n].[large_icon_url], [n].[Route], [n].[target_criteria], [n].[Title], [n].[title_ar], [n].[title_en]
FROM [notification_templates] AS [n]
WHERE [n].[Id] = @__Parse_0
2025-02-06 14:46:23.172 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@__Parse_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [n].[Id], [n].[additional_data], [n].[big_picture_url], [n].[Body], [n].[body_ar], [n].[body_en], [n].[created_at], [n].[expiry_at], [n].[large_icon_url], [n].[Route], [n].[target_criteria], [n].[Title], [n].[title_ar], [n].[title_en]
FROM [notification_templates] AS [n]
WHERE [n].[Id] = @__Parse_0
2025-02-06 14:46:23.174 +03:00 [INF] Executed DbCommand (0ms) [Parameters=[@__Parse_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [n].[Id], [n].[additional_data], [n].[big_picture_url], [n].[Body], [n].[body_ar], [n].[body_en], [n].[created_at], [n].[expiry_at], [n].[large_icon_url], [n].[Route], [n].[target_criteria], [n].[Title], [n].[title_ar], [n].[title_en]
FROM [notification_templates] AS [n]
WHERE [n].[Id] = @__Parse_0
2025-02-06 14:46:23.177 +03:00 [INF] Executed DbCommand (0ms) [Parameters=[@__Parse_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [n].[Id], [n].[additional_data], [n].[big_picture_url], [n].[Body], [n].[body_ar], [n].[body_en], [n].[created_at], [n].[expiry_at], [n].[large_icon_url], [n].[Route], [n].[target_criteria], [n].[Title], [n].[title_ar], [n].[title_en]
FROM [notification_templates] AS [n]
WHERE [n].[Id] = @__Parse_0
2025-02-06 14:46:23.179 +03:00 [INF] Executed DbCommand (0ms) [Parameters=[@__Parse_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [n].[Id], [n].[additional_data], [n].[big_picture_url], [n].[Body], [n].[body_ar], [n].[body_en], [n].[created_at], [n].[expiry_at], [n].[large_icon_url], [n].[Route], [n].[target_criteria], [n].[Title], [n].[title_ar], [n].[title_en]
FROM [notification_templates] AS [n]
WHERE [n].[Id] = @__Parse_0
2025-02-06 14:46:23.182 +03:00 [INF] Executed DbCommand (0ms) [Parameters=[@__Parse_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [n].[Id], [n].[additional_data], [n].[big_picture_url], [n].[Body], [n].[body_ar], [n].[body_en], [n].[created_at], [n].[expiry_at], [n].[large_icon_url], [n].[Route], [n].[target_criteria], [n].[Title], [n].[title_ar], [n].[title_en]
FROM [notification_templates] AS [n]
WHERE [n].[Id] = @__Parse_0
2025-02-06 14:46:23.184 +03:00 [INF] Executed DbCommand (0ms) [Parameters=[@__Parse_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [n].[Id], [n].[additional_data], [n].[big_picture_url], [n].[Body], [n].[body_ar], [n].[body_en], [n].[created_at], [n].[expiry_at], [n].[large_icon_url], [n].[Route], [n].[target_criteria], [n].[Title], [n].[title_ar], [n].[title_en]
FROM [notification_templates] AS [n]
WHERE [n].[Id] = @__Parse_0
2025-02-06 14:46:23.187 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@__Parse_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [n].[Id], [n].[additional_data], [n].[big_picture_url], [n].[Body], [n].[body_ar], [n].[body_en], [n].[created_at], [n].[expiry_at], [n].[large_icon_url], [n].[Route], [n].[target_criteria], [n].[Title], [n].[title_ar], [n].[title_en]
FROM [notification_templates] AS [n]
WHERE [n].[Id] = @__Parse_0
2025-02-06 14:46:23.224 +03:00 [INF] Executed DbCommand (9ms) [Parameters=[@p0='?' (Size = 4000), @p1='?' (DbType = DateTime2), @p2='?' (Size = 4000), @p3='?' (Size = 4000), @p4='?' (Size = 4000), @p5='?' (Size = 450), @p6='?' (Size = 4000), @p7='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SET IMPLICIT_TRANSACTIONS OFF;
SET NOCOUNT ON;
INSERT INTO [AuthLogs] ([AuthType], [CreatedAt], [DeviceId], [FailureReason], [IpAddress], [NationalId], [Status], [UserAgent])
OUTPUT INSERTED.[Id]
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7);
2025-02-06 14:46:23.229 +03:00 [ERR] An exception occurred in the database while saving changes for context type 'NayifatAPI.Data.ApplicationDbContext'.
Microsoft.EntityFrameworkCore.DbUpdateException: An error occurred while saving the entity changes. See the inner exception for details.
 ---> Microsoft.Data.SqlClient.SqlException (0x80131904): The INSERT statement conflicted with the FOREIGN KEY constraint "FK_AuthLogs_Customers_NationalId". The conflict occurred in database "NayifatApp", table "dbo.Customers", column 'NationalId'.
   at Microsoft.Data.SqlClient.SqlConnection.OnError(SqlException exception, Boolean breakConnection, Action`1 wrapCloseInAction)
   at Microsoft.Data.SqlClient.SqlInternalConnection.OnError(SqlException exception, Boolean breakConnection, Action`1 wrapCloseInAction)
   at Microsoft.Data.SqlClient.TdsParser.ThrowExceptionAndWarning(TdsParserStateObject stateObj, Boolean callerHasConnectionLock, Boolean asyncClose)
   at Microsoft.Data.SqlClient.TdsParser.TryRun(RunBehavior runBehavior, SqlCommand cmdHandler, SqlDataReader dataStream, BulkCopySimpleResultSet bulkCopyHandler, TdsParserStateObject stateObj, Boolean& dataReady)
   at Microsoft.Data.SqlClient.SqlDataReader.TryHasMoreRows(Boolean& moreRows)
   at Microsoft.Data.SqlClient.SqlDataReader.TryReadInternal(Boolean setTimeout, Boolean& more)
   at Microsoft.Data.SqlClient.SqlDataReader.ReadAsyncExecute(Task task, Object state)
   at Microsoft.Data.SqlClient.SqlDataReader.InvokeAsyncCall[T](SqlDataReaderBaseAsyncCallContext`1 context)
--- End of stack trace from previous location ---
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeResultSetAsync(Int32 startCommandIndex, RelationalDataReader reader, CancellationToken cancellationToken)
ClientConnectionId:bbb02d6b-9a24-40fc-a1f2-4f6ce238cfbc
Error Number:547,State:0,Class:16
   --- End of inner exception stack trace ---
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeResultSetAsync(Int32 startCommandIndex, RelationalDataReader reader, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeAsync(RelationalDataReader reader, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Update.Internal.SqlServerModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(IList`1 entriesToSave, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(StateManager stateManager, Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Storage.Internal.SqlServerExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
Microsoft.EntityFrameworkCore.DbUpdateException: An error occurred while saving the entity changes. See the inner exception for details.
 ---> Microsoft.Data.SqlClient.SqlException (0x80131904): The INSERT statement conflicted with the FOREIGN KEY constraint "FK_AuthLogs_Customers_NationalId". The conflict occurred in database "NayifatApp", table "dbo.Customers", column 'NationalId'.
   at Microsoft.Data.SqlClient.SqlConnection.OnError(SqlException exception, Boolean breakConnection, Action`1 wrapCloseInAction)
   at Microsoft.Data.SqlClient.SqlInternalConnection.OnError(SqlException exception, Boolean breakConnection, Action`1 wrapCloseInAction)
   at Microsoft.Data.SqlClient.TdsParser.ThrowExceptionAndWarning(TdsParserStateObject stateObj, Boolean callerHasConnectionLock, Boolean asyncClose)
   at Microsoft.Data.SqlClient.TdsParser.TryRun(RunBehavior runBehavior, SqlCommand cmdHandler, SqlDataReader dataStream, BulkCopySimpleResultSet bulkCopyHandler, TdsParserStateObject stateObj, Boolean& dataReady)
   at Microsoft.Data.SqlClient.SqlDataReader.TryHasMoreRows(Boolean& moreRows)
   at Microsoft.Data.SqlClient.SqlDataReader.TryReadInternal(Boolean setTimeout, Boolean& more)
   at Microsoft.Data.SqlClient.SqlDataReader.ReadAsyncExecute(Task task, Object state)
   at Microsoft.Data.SqlClient.SqlDataReader.InvokeAsyncCall[T](SqlDataReaderBaseAsyncCallContext`1 context)
--- End of stack trace from previous location ---
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeResultSetAsync(Int32 startCommandIndex, RelationalDataReader reader, CancellationToken cancellationToken)
ClientConnectionId:bbb02d6b-9a24-40fc-a1f2-4f6ce238cfbc
Error Number:547,State:0,Class:16
   --- End of inner exception stack trace ---
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeResultSetAsync(Int32 startCommandIndex, RelationalDataReader reader, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeAsync(RelationalDataReader reader, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Update.Internal.SqlServerModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(IList`1 entriesToSave, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(StateManager stateManager, Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Storage.Internal.SqlServerExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
2025-02-06 14:46:23.241 +03:00 [ERR] Error logging audit event. NationalId: all, Action: notification_delivered, Details: {"notification_count":21,"notification_ids":[38,37,36,35,34,33,32,31,30,29,28,27,26,25,24,23,23,20,19,18,12],"timestamp":"2025-02-06T14:46:23.1201553"}
Microsoft.EntityFrameworkCore.DbUpdateException: An error occurred while saving the entity changes. See the inner exception for details.
 ---> Microsoft.Data.SqlClient.SqlException (0x80131904): The INSERT statement conflicted with the FOREIGN KEY constraint "FK_AuthLogs_Customers_NationalId". The conflict occurred in database "NayifatApp", table "dbo.Customers", column 'NationalId'.
   at Microsoft.Data.SqlClient.SqlConnection.OnError(SqlException exception, Boolean breakConnection, Action`1 wrapCloseInAction)
   at Microsoft.Data.SqlClient.SqlInternalConnection.OnError(SqlException exception, Boolean breakConnection, Action`1 wrapCloseInAction)
   at Microsoft.Data.SqlClient.TdsParser.ThrowExceptionAndWarning(TdsParserStateObject stateObj, Boolean callerHasConnectionLock, Boolean asyncClose)
   at Microsoft.Data.SqlClient.TdsParser.TryRun(RunBehavior runBehavior, SqlCommand cmdHandler, SqlDataReader dataStream, BulkCopySimpleResultSet bulkCopyHandler, TdsParserStateObject stateObj, Boolean& dataReady)
   at Microsoft.Data.SqlClient.SqlDataReader.TryHasMoreRows(Boolean& moreRows)
   at Microsoft.Data.SqlClient.SqlDataReader.TryReadInternal(Boolean setTimeout, Boolean& more)
   at Microsoft.Data.SqlClient.SqlDataReader.ReadAsyncExecute(Task task, Object state)
   at Microsoft.Data.SqlClient.SqlDataReader.InvokeAsyncCall[T](SqlDataReaderBaseAsyncCallContext`1 context)
--- End of stack trace from previous location ---
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeResultSetAsync(Int32 startCommandIndex, RelationalDataReader reader, CancellationToken cancellationToken)
ClientConnectionId:bbb02d6b-9a24-40fc-a1f2-4f6ce238cfbc
Error Number:547,State:0,Class:16
   --- End of inner exception stack trace ---
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeResultSetAsync(Int32 startCommandIndex, RelationalDataReader reader, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeAsync(RelationalDataReader reader, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Update.Internal.SqlServerModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(IList`1 entriesToSave, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(StateManager stateManager, Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Storage.Internal.SqlServerExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at NayifatAPI.Services.AuditLogService.LogAsync(String nationalId, String action, Object details) in C:\Users\yamta\StudioProjects\nayifat_app_2025_new\NayifatAPI\Services\AuditLogService.cs:line 36
2025-02-06 14:46:23.252 +03:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType11`2[[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Object, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-02-06 14:46:23.253 +03:00 [INF] Executed action NayifatAPI.Controllers.NotificationsController.GetNotifications (NayifatAPI) in 139.9528ms
2025-02-06 14:46:23.254 +03:00 [INF] Executed endpoint 'NayifatAPI.Controllers.NotificationsController.GetNotifications (NayifatAPI)'
2025-02-06 14:46:23.255 +03:00 [INF] Request finished HTTP/1.1 POST http://eb3c-46-152-255-232.ngrok-free.app/api/notifications/list - 200 null application/json; charset=utf-8 149.0708ms
2025-02-06 15:01:33.680 +03:00 [INF] Request starting HTTP/1.1 POST http://eb3c-46-152-255-232.ngrok-free.app/api/notifications/list - application/json; charset=utf-8 45
2025-02-06 15:01:33.682 +03:00 [INF] Executing endpoint 'NayifatAPI.Controllers.NotificationsController.GetNotifications (NayifatAPI)'
2025-02-06 15:01:33.683 +03:00 [INF] Route matched with {action = "GetNotifications", controller = "Notifications"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetNotifications(NayifatAPI.Controllers.GetNotificationsRequest) on controller NayifatAPI.Controllers.NotificationsController (NayifatAPI).
2025-02-06 15:01:33.744 +03:00 [INF] Executed DbCommand (46ms) [Parameters=[@__providedApiKey_0='?' (Size = 255)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [a].[api_Key], [a].[CreatedAt], [a].[Description], [a].[ExpiresAt], [a].[IsActive], [a].[LastUsedAt]
FROM [ApiKeys] AS [a]
WHERE [a].[api_Key] = @__providedApiKey_0 AND [a].[IsActive] = CAST(1 AS bit)
2025-02-06 15:01:33.750 +03:00 [INF] Executed DbCommand (3ms) [Parameters=[@__request_NationalId_0='?' (Size = 450)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [u].[national_id], [u].[last_updated], [u].[notifications]
FROM [user_notifications] AS [u]
WHERE [u].[national_id] = @__request_NationalId_0
2025-02-06 15:01:33.752 +03:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType11`2[[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Object, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-02-06 15:01:33.753 +03:00 [INF] Executed action NayifatAPI.Controllers.NotificationsController.GetNotifications (NayifatAPI) in 67.6711ms
2025-02-06 15:01:33.755 +03:00 [INF] Executed endpoint 'NayifatAPI.Controllers.NotificationsController.GetNotifications (NayifatAPI)'
2025-02-06 15:01:33.756 +03:00 [INF] Request finished HTTP/1.1 POST http://eb3c-46-152-255-232.ngrok-free.app/api/notifications/list - 200 null application/json; charset=utf-8 76.0532ms
2025-02-06 15:01:33.882 +03:00 [INF] Request starting HTTP/1.1 POST http://eb3c-46-152-255-232.ngrok-free.app/api/notifications/list - application/json 39
2025-02-06 15:01:33.885 +03:00 [INF] Executing endpoint 'NayifatAPI.Controllers.NotificationsController.GetNotifications (NayifatAPI)'
2025-02-06 15:01:33.886 +03:00 [INF] Route matched with {action = "GetNotifications", controller = "Notifications"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetNotifications(NayifatAPI.Controllers.GetNotificationsRequest) on controller NayifatAPI.Controllers.NotificationsController (NayifatAPI).
2025-02-06 15:01:33.890 +03:00 [INF] Executed DbCommand (0ms) [Parameters=[@__providedApiKey_0='?' (Size = 255)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [a].[api_Key], [a].[CreatedAt], [a].[Description], [a].[ExpiresAt], [a].[IsActive], [a].[LastUsedAt]
FROM [ApiKeys] AS [a]
WHERE [a].[api_Key] = @__providedApiKey_0 AND [a].[IsActive] = CAST(1 AS bit)
2025-02-06 15:01:33.892 +03:00 [INF] Executed DbCommand (0ms) [Parameters=[@__request_NationalId_0='?' (Size = 450)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [u].[national_id], [u].[last_updated], [u].[notifications]
FROM [user_notifications] AS [u]
WHERE [u].[national_id] = @__request_NationalId_0
2025-02-06 15:01:33.904 +03:00 [INF] Executed DbCommand (9ms) [Parameters=[@__Parse_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [n].[Id], [n].[additional_data], [n].[big_picture_url], [n].[Body], [n].[body_ar], [n].[body_en], [n].[created_at], [n].[expiry_at], [n].[large_icon_url], [n].[Route], [n].[target_criteria], [n].[Title], [n].[title_ar], [n].[title_en]
FROM [notification_templates] AS [n]
WHERE [n].[Id] = @__Parse_0
2025-02-06 15:01:33.907 +03:00 [INF] Executed DbCommand (0ms) [Parameters=[@__Parse_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [n].[Id], [n].[additional_data], [n].[big_picture_url], [n].[Body], [n].[body_ar], [n].[body_en], [n].[created_at], [n].[expiry_at], [n].[large_icon_url], [n].[Route], [n].[target_criteria], [n].[Title], [n].[title_ar], [n].[title_en]
FROM [notification_templates] AS [n]
WHERE [n].[Id] = @__Parse_0
2025-02-06 15:01:33.910 +03:00 [INF] Executed DbCommand (0ms) [Parameters=[@__Parse_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [n].[Id], [n].[additional_data], [n].[big_picture_url], [n].[Body], [n].[body_ar], [n].[body_en], [n].[created_at], [n].[expiry_at], [n].[large_icon_url], [n].[Route], [n].[target_criteria], [n].[Title], [n].[title_ar], [n].[title_en]
FROM [notification_templates] AS [n]
WHERE [n].[Id] = @__Parse_0
2025-02-06 15:01:33.913 +03:00 [INF] Executed DbCommand (0ms) [Parameters=[@__Parse_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [n].[Id], [n].[additional_data], [n].[big_picture_url], [n].[Body], [n].[body_ar], [n].[body_en], [n].[created_at], [n].[expiry_at], [n].[large_icon_url], [n].[Route], [n].[target_criteria], [n].[Title], [n].[title_ar], [n].[title_en]
FROM [notification_templates] AS [n]
WHERE [n].[Id] = @__Parse_0
2025-02-06 15:01:33.917 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@__Parse_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [n].[Id], [n].[additional_data], [n].[big_picture_url], [n].[Body], [n].[body_ar], [n].[body_en], [n].[created_at], [n].[expiry_at], [n].[large_icon_url], [n].[Route], [n].[target_criteria], [n].[Title], [n].[title_ar], [n].[title_en]
FROM [notification_templates] AS [n]
WHERE [n].[Id] = @__Parse_0
2025-02-06 15:01:33.920 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@__Parse_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [n].[Id], [n].[additional_data], [n].[big_picture_url], [n].[Body], [n].[body_ar], [n].[body_en], [n].[created_at], [n].[expiry_at], [n].[large_icon_url], [n].[Route], [n].[target_criteria], [n].[Title], [n].[title_ar], [n].[title_en]
FROM [notification_templates] AS [n]
WHERE [n].[Id] = @__Parse_0
2025-02-06 15:01:33.923 +03:00 [INF] Executed DbCommand (0ms) [Parameters=[@__Parse_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [n].[Id], [n].[additional_data], [n].[big_picture_url], [n].[Body], [n].[body_ar], [n].[body_en], [n].[created_at], [n].[expiry_at], [n].[large_icon_url], [n].[Route], [n].[target_criteria], [n].[Title], [n].[title_ar], [n].[title_en]
FROM [notification_templates] AS [n]
WHERE [n].[Id] = @__Parse_0
2025-02-06 15:01:33.925 +03:00 [INF] Executed DbCommand (0ms) [Parameters=[@__Parse_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [n].[Id], [n].[additional_data], [n].[big_picture_url], [n].[Body], [n].[body_ar], [n].[body_en], [n].[created_at], [n].[expiry_at], [n].[large_icon_url], [n].[Route], [n].[target_criteria], [n].[Title], [n].[title_ar], [n].[title_en]
FROM [notification_templates] AS [n]
WHERE [n].[Id] = @__Parse_0
2025-02-06 15:01:33.928 +03:00 [INF] Executed DbCommand (0ms) [Parameters=[@__Parse_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [n].[Id], [n].[additional_data], [n].[big_picture_url], [n].[Body], [n].[body_ar], [n].[body_en], [n].[created_at], [n].[expiry_at], [n].[large_icon_url], [n].[Route], [n].[target_criteria], [n].[Title], [n].[title_ar], [n].[title_en]
FROM [notification_templates] AS [n]
WHERE [n].[Id] = @__Parse_0
2025-02-06 15:01:33.931 +03:00 [INF] Executed DbCommand (0ms) [Parameters=[@__Parse_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [n].[Id], [n].[additional_data], [n].[big_picture_url], [n].[Body], [n].[body_ar], [n].[body_en], [n].[created_at], [n].[expiry_at], [n].[large_icon_url], [n].[Route], [n].[target_criteria], [n].[Title], [n].[title_ar], [n].[title_en]
FROM [notification_templates] AS [n]
WHERE [n].[Id] = @__Parse_0
2025-02-06 15:01:33.933 +03:00 [INF] Executed DbCommand (0ms) [Parameters=[@__Parse_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [n].[Id], [n].[additional_data], [n].[big_picture_url], [n].[Body], [n].[body_ar], [n].[body_en], [n].[created_at], [n].[expiry_at], [n].[large_icon_url], [n].[Route], [n].[target_criteria], [n].[Title], [n].[title_ar], [n].[title_en]
FROM [notification_templates] AS [n]
WHERE [n].[Id] = @__Parse_0
2025-02-06 15:01:33.936 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@__Parse_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [n].[Id], [n].[additional_data], [n].[big_picture_url], [n].[Body], [n].[body_ar], [n].[body_en], [n].[created_at], [n].[expiry_at], [n].[large_icon_url], [n].[Route], [n].[target_criteria], [n].[Title], [n].[title_ar], [n].[title_en]
FROM [notification_templates] AS [n]
WHERE [n].[Id] = @__Parse_0
2025-02-06 15:01:33.938 +03:00 [INF] Executed DbCommand (0ms) [Parameters=[@__Parse_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [n].[Id], [n].[additional_data], [n].[big_picture_url], [n].[Body], [n].[body_ar], [n].[body_en], [n].[created_at], [n].[expiry_at], [n].[large_icon_url], [n].[Route], [n].[target_criteria], [n].[Title], [n].[title_ar], [n].[title_en]
FROM [notification_templates] AS [n]
WHERE [n].[Id] = @__Parse_0
2025-02-06 15:01:33.940 +03:00 [INF] Executed DbCommand (0ms) [Parameters=[@__Parse_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [n].[Id], [n].[additional_data], [n].[big_picture_url], [n].[Body], [n].[body_ar], [n].[body_en], [n].[created_at], [n].[expiry_at], [n].[large_icon_url], [n].[Route], [n].[target_criteria], [n].[Title], [n].[title_ar], [n].[title_en]
FROM [notification_templates] AS [n]
WHERE [n].[Id] = @__Parse_0
2025-02-06 15:01:33.943 +03:00 [INF] Executed DbCommand (0ms) [Parameters=[@__Parse_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [n].[Id], [n].[additional_data], [n].[big_picture_url], [n].[Body], [n].[body_ar], [n].[body_en], [n].[created_at], [n].[expiry_at], [n].[large_icon_url], [n].[Route], [n].[target_criteria], [n].[Title], [n].[title_ar], [n].[title_en]
FROM [notification_templates] AS [n]
WHERE [n].[Id] = @__Parse_0
2025-02-06 15:01:33.945 +03:00 [INF] Executed DbCommand (0ms) [Parameters=[@__Parse_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [n].[Id], [n].[additional_data], [n].[big_picture_url], [n].[Body], [n].[body_ar], [n].[body_en], [n].[created_at], [n].[expiry_at], [n].[large_icon_url], [n].[Route], [n].[target_criteria], [n].[Title], [n].[title_ar], [n].[title_en]
FROM [notification_templates] AS [n]
WHERE [n].[Id] = @__Parse_0
2025-02-06 15:01:33.947 +03:00 [INF] Executed DbCommand (0ms) [Parameters=[@__Parse_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [n].[Id], [n].[additional_data], [n].[big_picture_url], [n].[Body], [n].[body_ar], [n].[body_en], [n].[created_at], [n].[expiry_at], [n].[large_icon_url], [n].[Route], [n].[target_criteria], [n].[Title], [n].[title_ar], [n].[title_en]
FROM [notification_templates] AS [n]
WHERE [n].[Id] = @__Parse_0
2025-02-06 15:01:33.949 +03:00 [INF] Executed DbCommand (0ms) [Parameters=[@__Parse_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [n].[Id], [n].[additional_data], [n].[big_picture_url], [n].[Body], [n].[body_ar], [n].[body_en], [n].[created_at], [n].[expiry_at], [n].[large_icon_url], [n].[Route], [n].[target_criteria], [n].[Title], [n].[title_ar], [n].[title_en]
FROM [notification_templates] AS [n]
WHERE [n].[Id] = @__Parse_0
2025-02-06 15:01:33.952 +03:00 [INF] Executed DbCommand (0ms) [Parameters=[@__Parse_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [n].[Id], [n].[additional_data], [n].[big_picture_url], [n].[Body], [n].[body_ar], [n].[body_en], [n].[created_at], [n].[expiry_at], [n].[large_icon_url], [n].[Route], [n].[target_criteria], [n].[Title], [n].[title_ar], [n].[title_en]
FROM [notification_templates] AS [n]
WHERE [n].[Id] = @__Parse_0
2025-02-06 15:01:33.954 +03:00 [INF] Executed DbCommand (0ms) [Parameters=[@__Parse_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [n].[Id], [n].[additional_data], [n].[big_picture_url], [n].[Body], [n].[body_ar], [n].[body_en], [n].[created_at], [n].[expiry_at], [n].[large_icon_url], [n].[Route], [n].[target_criteria], [n].[Title], [n].[title_ar], [n].[title_en]
FROM [notification_templates] AS [n]
WHERE [n].[Id] = @__Parse_0
2025-02-06 15:01:33.956 +03:00 [INF] Executed DbCommand (0ms) [Parameters=[@__Parse_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [n].[Id], [n].[additional_data], [n].[big_picture_url], [n].[Body], [n].[body_ar], [n].[body_en], [n].[created_at], [n].[expiry_at], [n].[large_icon_url], [n].[Route], [n].[target_criteria], [n].[Title], [n].[title_ar], [n].[title_en]
FROM [notification_templates] AS [n]
WHERE [n].[Id] = @__Parse_0
2025-02-06 15:01:33.971 +03:00 [INF] Executed DbCommand (11ms) [Parameters=[@p0='?' (Size = 4000), @p1='?' (DbType = DateTime2), @p2='?' (Size = 4000), @p3='?' (Size = 4000), @p4='?' (Size = 4000), @p5='?' (Size = 450), @p6='?' (Size = 4000), @p7='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SET IMPLICIT_TRANSACTIONS OFF;
SET NOCOUNT ON;
INSERT INTO [AuthLogs] ([AuthType], [CreatedAt], [DeviceId], [FailureReason], [IpAddress], [NationalId], [Status], [UserAgent])
OUTPUT INSERTED.[Id]
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7);
2025-02-06 15:01:33.974 +03:00 [ERR] An exception occurred in the database while saving changes for context type 'NayifatAPI.Data.ApplicationDbContext'.
Microsoft.EntityFrameworkCore.DbUpdateException: An error occurred while saving the entity changes. See the inner exception for details.
 ---> Microsoft.Data.SqlClient.SqlException (0x80131904): The INSERT statement conflicted with the FOREIGN KEY constraint "FK_AuthLogs_Customers_NationalId". The conflict occurred in database "NayifatApp", table "dbo.Customers", column 'NationalId'.
   at Microsoft.Data.SqlClient.SqlConnection.OnError(SqlException exception, Boolean breakConnection, Action`1 wrapCloseInAction)
   at Microsoft.Data.SqlClient.SqlInternalConnection.OnError(SqlException exception, Boolean breakConnection, Action`1 wrapCloseInAction)
   at Microsoft.Data.SqlClient.TdsParser.ThrowExceptionAndWarning(TdsParserStateObject stateObj, Boolean callerHasConnectionLock, Boolean asyncClose)
   at Microsoft.Data.SqlClient.TdsParser.TryRun(RunBehavior runBehavior, SqlCommand cmdHandler, SqlDataReader dataStream, BulkCopySimpleResultSet bulkCopyHandler, TdsParserStateObject stateObj, Boolean& dataReady)
   at Microsoft.Data.SqlClient.SqlDataReader.TryHasMoreRows(Boolean& moreRows)
   at Microsoft.Data.SqlClient.SqlDataReader.TryReadInternal(Boolean setTimeout, Boolean& more)
   at Microsoft.Data.SqlClient.SqlDataReader.ReadAsyncExecute(Task task, Object state)
   at Microsoft.Data.SqlClient.SqlDataReader.InvokeAsyncCall[T](SqlDataReaderBaseAsyncCallContext`1 context)
--- End of stack trace from previous location ---
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeResultSetAsync(Int32 startCommandIndex, RelationalDataReader reader, CancellationToken cancellationToken)
ClientConnectionId:56c2b118-9ee9-4904-b637-e2bd4c9322ad
Error Number:547,State:0,Class:16
   --- End of inner exception stack trace ---
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeResultSetAsync(Int32 startCommandIndex, RelationalDataReader reader, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeAsync(RelationalDataReader reader, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Update.Internal.SqlServerModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(IList`1 entriesToSave, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(StateManager stateManager, Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Storage.Internal.SqlServerExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
Microsoft.EntityFrameworkCore.DbUpdateException: An error occurred while saving the entity changes. See the inner exception for details.
 ---> Microsoft.Data.SqlClient.SqlException (0x80131904): The INSERT statement conflicted with the FOREIGN KEY constraint "FK_AuthLogs_Customers_NationalId". The conflict occurred in database "NayifatApp", table "dbo.Customers", column 'NationalId'.
   at Microsoft.Data.SqlClient.SqlConnection.OnError(SqlException exception, Boolean breakConnection, Action`1 wrapCloseInAction)
   at Microsoft.Data.SqlClient.SqlInternalConnection.OnError(SqlException exception, Boolean breakConnection, Action`1 wrapCloseInAction)
   at Microsoft.Data.SqlClient.TdsParser.ThrowExceptionAndWarning(TdsParserStateObject stateObj, Boolean callerHasConnectionLock, Boolean asyncClose)
   at Microsoft.Data.SqlClient.TdsParser.TryRun(RunBehavior runBehavior, SqlCommand cmdHandler, SqlDataReader dataStream, BulkCopySimpleResultSet bulkCopyHandler, TdsParserStateObject stateObj, Boolean& dataReady)
   at Microsoft.Data.SqlClient.SqlDataReader.TryHasMoreRows(Boolean& moreRows)
   at Microsoft.Data.SqlClient.SqlDataReader.TryReadInternal(Boolean setTimeout, Boolean& more)
   at Microsoft.Data.SqlClient.SqlDataReader.ReadAsyncExecute(Task task, Object state)
   at Microsoft.Data.SqlClient.SqlDataReader.InvokeAsyncCall[T](SqlDataReaderBaseAsyncCallContext`1 context)
--- End of stack trace from previous location ---
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeResultSetAsync(Int32 startCommandIndex, RelationalDataReader reader, CancellationToken cancellationToken)
ClientConnectionId:56c2b118-9ee9-4904-b637-e2bd4c9322ad
Error Number:547,State:0,Class:16
   --- End of inner exception stack trace ---
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeResultSetAsync(Int32 startCommandIndex, RelationalDataReader reader, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeAsync(RelationalDataReader reader, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Update.Internal.SqlServerModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(IList`1 entriesToSave, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(StateManager stateManager, Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Storage.Internal.SqlServerExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
2025-02-06 15:01:33.986 +03:00 [ERR] Error logging audit event. NationalId: all, Action: notification_delivered, Details: {"notification_count":21,"notification_ids":[38,37,36,35,34,33,32,31,30,29,28,27,26,25,24,23,23,20,19,18,12],"timestamp":"2025-02-06T15:01:33.8945398"}
Microsoft.EntityFrameworkCore.DbUpdateException: An error occurred while saving the entity changes. See the inner exception for details.
 ---> Microsoft.Data.SqlClient.SqlException (0x80131904): The INSERT statement conflicted with the FOREIGN KEY constraint "FK_AuthLogs_Customers_NationalId". The conflict occurred in database "NayifatApp", table "dbo.Customers", column 'NationalId'.
   at Microsoft.Data.SqlClient.SqlConnection.OnError(SqlException exception, Boolean breakConnection, Action`1 wrapCloseInAction)
   at Microsoft.Data.SqlClient.SqlInternalConnection.OnError(SqlException exception, Boolean breakConnection, Action`1 wrapCloseInAction)
   at Microsoft.Data.SqlClient.TdsParser.ThrowExceptionAndWarning(TdsParserStateObject stateObj, Boolean callerHasConnectionLock, Boolean asyncClose)
   at Microsoft.Data.SqlClient.TdsParser.TryRun(RunBehavior runBehavior, SqlCommand cmdHandler, SqlDataReader dataStream, BulkCopySimpleResultSet bulkCopyHandler, TdsParserStateObject stateObj, Boolean& dataReady)
   at Microsoft.Data.SqlClient.SqlDataReader.TryHasMoreRows(Boolean& moreRows)
   at Microsoft.Data.SqlClient.SqlDataReader.TryReadInternal(Boolean setTimeout, Boolean& more)
   at Microsoft.Data.SqlClient.SqlDataReader.ReadAsyncExecute(Task task, Object state)
   at Microsoft.Data.SqlClient.SqlDataReader.InvokeAsyncCall[T](SqlDataReaderBaseAsyncCallContext`1 context)
--- End of stack trace from previous location ---
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeResultSetAsync(Int32 startCommandIndex, RelationalDataReader reader, CancellationToken cancellationToken)
ClientConnectionId:56c2b118-9ee9-4904-b637-e2bd4c9322ad
Error Number:547,State:0,Class:16
   --- End of inner exception stack trace ---
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeResultSetAsync(Int32 startCommandIndex, RelationalDataReader reader, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeAsync(RelationalDataReader reader, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Update.Internal.SqlServerModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(IList`1 entriesToSave, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(StateManager stateManager, Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Storage.Internal.SqlServerExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at NayifatAPI.Services.AuditLogService.LogAsync(String nationalId, String action, Object details) in C:\Users\yamta\StudioProjects\nayifat_app_2025_new\NayifatAPI\Services\AuditLogService.cs:line 36
2025-02-06 15:01:33.996 +03:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType11`2[[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Object, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-02-06 15:01:33.997 +03:00 [INF] Executed action NayifatAPI.Controllers.NotificationsController.GetNotifications (NayifatAPI) in 109.9927ms
2025-02-06 15:01:33.998 +03:00 [INF] Executed endpoint 'NayifatAPI.Controllers.NotificationsController.GetNotifications (NayifatAPI)'
2025-02-06 15:01:34.000 +03:00 [INF] Request finished HTTP/1.1 POST http://eb3c-46-152-255-232.ngrok-free.app/api/notifications/list - 200 null application/json; charset=utf-8 117.6508ms
2025-02-06 15:01:34.175 +03:00 [INF] Request starting HTTP/1.1 POST http://eb3c-46-152-255-232.ngrok-free.app/api/notifications/list - application/json; charset=utf-8 39
2025-02-06 15:01:34.178 +03:00 [INF] Executing endpoint 'NayifatAPI.Controllers.NotificationsController.GetNotifications (NayifatAPI)'
2025-02-06 15:01:34.179 +03:00 [INF] Route matched with {action = "GetNotifications", controller = "Notifications"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetNotifications(NayifatAPI.Controllers.GetNotificationsRequest) on controller NayifatAPI.Controllers.NotificationsController (NayifatAPI).
2025-02-06 15:01:34.183 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@__providedApiKey_0='?' (Size = 255)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [a].[api_Key], [a].[CreatedAt], [a].[Description], [a].[ExpiresAt], [a].[IsActive], [a].[LastUsedAt]
FROM [ApiKeys] AS [a]
WHERE [a].[api_Key] = @__providedApiKey_0 AND [a].[IsActive] = CAST(1 AS bit)
2025-02-06 15:01:34.188 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@__request_NationalId_0='?' (Size = 450)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [u].[national_id], [u].[last_updated], [u].[notifications]
FROM [user_notifications] AS [u]
WHERE [u].[national_id] = @__request_NationalId_0
2025-02-06 15:01:34.190 +03:00 [INF] Request starting HTTP/1.1 POST http://eb3c-46-152-255-232.ngrok-free.app/api/notifications/list - application/json 39
2025-02-06 15:01:34.192 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@__Parse_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [n].[Id], [n].[additional_data], [n].[big_picture_url], [n].[Body], [n].[body_ar], [n].[body_en], [n].[created_at], [n].[expiry_at], [n].[large_icon_url], [n].[Route], [n].[target_criteria], [n].[Title], [n].[title_ar], [n].[title_en]
FROM [notification_templates] AS [n]
WHERE [n].[Id] = @__Parse_0
2025-02-06 15:01:34.193 +03:00 [INF] Executing endpoint 'NayifatAPI.Controllers.NotificationsController.GetNotifications (NayifatAPI)'
2025-02-06 15:01:34.196 +03:00 [INF] Route matched with {action = "GetNotifications", controller = "Notifications"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetNotifications(NayifatAPI.Controllers.GetNotificationsRequest) on controller NayifatAPI.Controllers.NotificationsController (NayifatAPI).
2025-02-06 15:01:34.196 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@__Parse_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [n].[Id], [n].[additional_data], [n].[big_picture_url], [n].[Body], [n].[body_ar], [n].[body_en], [n].[created_at], [n].[expiry_at], [n].[large_icon_url], [n].[Route], [n].[target_criteria], [n].[Title], [n].[title_ar], [n].[title_en]
FROM [notification_templates] AS [n]
WHERE [n].[Id] = @__Parse_0
2025-02-06 15:01:34.202 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@__Parse_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [n].[Id], [n].[additional_data], [n].[big_picture_url], [n].[Body], [n].[body_ar], [n].[body_en], [n].[created_at], [n].[expiry_at], [n].[large_icon_url], [n].[Route], [n].[target_criteria], [n].[Title], [n].[title_ar], [n].[title_en]
FROM [notification_templates] AS [n]
WHERE [n].[Id] = @__Parse_0
2025-02-06 15:01:34.206 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@__providedApiKey_0='?' (Size = 255)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [a].[api_Key], [a].[CreatedAt], [a].[Description], [a].[ExpiresAt], [a].[IsActive], [a].[LastUsedAt]
FROM [ApiKeys] AS [a]
WHERE [a].[api_Key] = @__providedApiKey_0 AND [a].[IsActive] = CAST(1 AS bit)
2025-02-06 15:01:34.207 +03:00 [INF] Executed DbCommand (0ms) [Parameters=[@__Parse_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [n].[Id], [n].[additional_data], [n].[big_picture_url], [n].[Body], [n].[body_ar], [n].[body_en], [n].[created_at], [n].[expiry_at], [n].[large_icon_url], [n].[Route], [n].[target_criteria], [n].[Title], [n].[title_ar], [n].[title_en]
FROM [notification_templates] AS [n]
WHERE [n].[Id] = @__Parse_0
2025-02-06 15:01:34.209 +03:00 [INF] Executed DbCommand (0ms) [Parameters=[@__request_NationalId_0='?' (Size = 450)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [u].[national_id], [u].[last_updated], [u].[notifications]
FROM [user_notifications] AS [u]
WHERE [u].[national_id] = @__request_NationalId_0
2025-02-06 15:01:34.211 +03:00 [INF] Executed DbCommand (0ms) [Parameters=[@__Parse_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [n].[Id], [n].[additional_data], [n].[big_picture_url], [n].[Body], [n].[body_ar], [n].[body_en], [n].[created_at], [n].[expiry_at], [n].[large_icon_url], [n].[Route], [n].[target_criteria], [n].[Title], [n].[title_ar], [n].[title_en]
FROM [notification_templates] AS [n]
WHERE [n].[Id] = @__Parse_0
2025-02-06 15:01:34.212 +03:00 [INF] Executed DbCommand (0ms) [Parameters=[@__Parse_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [n].[Id], [n].[additional_data], [n].[big_picture_url], [n].[Body], [n].[body_ar], [n].[body_en], [n].[created_at], [n].[expiry_at], [n].[large_icon_url], [n].[Route], [n].[target_criteria], [n].[Title], [n].[title_ar], [n].[title_en]
FROM [notification_templates] AS [n]
WHERE [n].[Id] = @__Parse_0
2025-02-06 15:01:34.214 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@__Parse_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [n].[Id], [n].[additional_data], [n].[big_picture_url], [n].[Body], [n].[body_ar], [n].[body_en], [n].[created_at], [n].[expiry_at], [n].[large_icon_url], [n].[Route], [n].[target_criteria], [n].[Title], [n].[title_ar], [n].[title_en]
FROM [notification_templates] AS [n]
WHERE [n].[Id] = @__Parse_0
2025-02-06 15:01:34.216 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@__Parse_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [n].[Id], [n].[additional_data], [n].[big_picture_url], [n].[Body], [n].[body_ar], [n].[body_en], [n].[created_at], [n].[expiry_at], [n].[large_icon_url], [n].[Route], [n].[target_criteria], [n].[Title], [n].[title_ar], [n].[title_en]
FROM [notification_templates] AS [n]
WHERE [n].[Id] = @__Parse_0
2025-02-06 15:01:34.217 +03:00 [INF] Executed DbCommand (0ms) [Parameters=[@__Parse_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [n].[Id], [n].[additional_data], [n].[big_picture_url], [n].[Body], [n].[body_ar], [n].[body_en], [n].[created_at], [n].[expiry_at], [n].[large_icon_url], [n].[Route], [n].[target_criteria], [n].[Title], [n].[title_ar], [n].[title_en]
FROM [notification_templates] AS [n]
WHERE [n].[Id] = @__Parse_0
2025-02-06 15:01:34.219 +03:00 [INF] Executed DbCommand (0ms) [Parameters=[@__Parse_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [n].[Id], [n].[additional_data], [n].[big_picture_url], [n].[Body], [n].[body_ar], [n].[body_en], [n].[created_at], [n].[expiry_at], [n].[large_icon_url], [n].[Route], [n].[target_criteria], [n].[Title], [n].[title_ar], [n].[title_en]
FROM [notification_templates] AS [n]
WHERE [n].[Id] = @__Parse_0
2025-02-06 15:01:34.220 +03:00 [INF] Executed DbCommand (0ms) [Parameters=[@__Parse_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [n].[Id], [n].[additional_data], [n].[big_picture_url], [n].[Body], [n].[body_ar], [n].[body_en], [n].[created_at], [n].[expiry_at], [n].[large_icon_url], [n].[Route], [n].[target_criteria], [n].[Title], [n].[title_ar], [n].[title_en]
FROM [notification_templates] AS [n]
WHERE [n].[Id] = @__Parse_0
2025-02-06 15:01:34.222 +03:00 [INF] Executed DbCommand (0ms) [Parameters=[@__Parse_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [n].[Id], [n].[additional_data], [n].[big_picture_url], [n].[Body], [n].[body_ar], [n].[body_en], [n].[created_at], [n].[expiry_at], [n].[large_icon_url], [n].[Route], [n].[target_criteria], [n].[Title], [n].[title_ar], [n].[title_en]
FROM [notification_templates] AS [n]
WHERE [n].[Id] = @__Parse_0
2025-02-06 15:01:34.224 +03:00 [INF] Executed DbCommand (0ms) [Parameters=[@__Parse_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [n].[Id], [n].[additional_data], [n].[big_picture_url], [n].[Body], [n].[body_ar], [n].[body_en], [n].[created_at], [n].[expiry_at], [n].[large_icon_url], [n].[Route], [n].[target_criteria], [n].[Title], [n].[title_ar], [n].[title_en]
FROM [notification_templates] AS [n]
WHERE [n].[Id] = @__Parse_0
2025-02-06 15:01:34.225 +03:00 [INF] Executed DbCommand (0ms) [Parameters=[@__Parse_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [n].[Id], [n].[additional_data], [n].[big_picture_url], [n].[Body], [n].[body_ar], [n].[body_en], [n].[created_at], [n].[expiry_at], [n].[large_icon_url], [n].[Route], [n].[target_criteria], [n].[Title], [n].[title_ar], [n].[title_en]
FROM [notification_templates] AS [n]
WHERE [n].[Id] = @__Parse_0
2025-02-06 15:01:34.227 +03:00 [INF] Executed DbCommand (0ms) [Parameters=[@__Parse_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [n].[Id], [n].[additional_data], [n].[big_picture_url], [n].[Body], [n].[body_ar], [n].[body_en], [n].[created_at], [n].[expiry_at], [n].[large_icon_url], [n].[Route], [n].[target_criteria], [n].[Title], [n].[title_ar], [n].[title_en]
FROM [notification_templates] AS [n]
WHERE [n].[Id] = @__Parse_0
2025-02-06 15:01:34.229 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@__Parse_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [n].[Id], [n].[additional_data], [n].[big_picture_url], [n].[Body], [n].[body_ar], [n].[body_en], [n].[created_at], [n].[expiry_at], [n].[large_icon_url], [n].[Route], [n].[target_criteria], [n].[Title], [n].[title_ar], [n].[title_en]
FROM [notification_templates] AS [n]
WHERE [n].[Id] = @__Parse_0
2025-02-06 15:01:34.231 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@__Parse_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [n].[Id], [n].[additional_data], [n].[big_picture_url], [n].[Body], [n].[body_ar], [n].[body_en], [n].[created_at], [n].[expiry_at], [n].[large_icon_url], [n].[Route], [n].[target_criteria], [n].[Title], [n].[title_ar], [n].[title_en]
FROM [notification_templates] AS [n]
WHERE [n].[Id] = @__Parse_0
2025-02-06 15:01:34.232 +03:00 [INF] Executed DbCommand (0ms) [Parameters=[@__Parse_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [n].[Id], [n].[additional_data], [n].[big_picture_url], [n].[Body], [n].[body_ar], [n].[body_en], [n].[created_at], [n].[expiry_at], [n].[large_icon_url], [n].[Route], [n].[target_criteria], [n].[Title], [n].[title_ar], [n].[title_en]
FROM [notification_templates] AS [n]
WHERE [n].[Id] = @__Parse_0
2025-02-06 15:01:34.235 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@__Parse_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [n].[Id], [n].[additional_data], [n].[big_picture_url], [n].[Body], [n].[body_ar], [n].[body_en], [n].[created_at], [n].[expiry_at], [n].[large_icon_url], [n].[Route], [n].[target_criteria], [n].[Title], [n].[title_ar], [n].[title_en]
FROM [notification_templates] AS [n]
WHERE [n].[Id] = @__Parse_0
2025-02-06 15:01:34.236 +03:00 [INF] Executed DbCommand (0ms) [Parameters=[@__Parse_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [n].[Id], [n].[additional_data], [n].[big_picture_url], [n].[Body], [n].[body_ar], [n].[body_en], [n].[created_at], [n].[expiry_at], [n].[large_icon_url], [n].[Route], [n].[target_criteria], [n].[Title], [n].[title_ar], [n].[title_en]
FROM [notification_templates] AS [n]
WHERE [n].[Id] = @__Parse_0
2025-02-06 15:01:34.238 +03:00 [INF] Executed DbCommand (0ms) [Parameters=[@__Parse_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [n].[Id], [n].[additional_data], [n].[big_picture_url], [n].[Body], [n].[body_ar], [n].[body_en], [n].[created_at], [n].[expiry_at], [n].[large_icon_url], [n].[Route], [n].[target_criteria], [n].[Title], [n].[title_ar], [n].[title_en]
FROM [notification_templates] AS [n]
WHERE [n].[Id] = @__Parse_0
2025-02-06 15:01:34.238 +03:00 [INF] Request starting HTTP/1.1 POST http://eb3c-46-152-255-232.ngrok-free.app/api/notifications/list - application/json 45
2025-02-06 15:01:34.240 +03:00 [INF] Executed DbCommand (0ms) [Parameters=[@__Parse_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [n].[Id], [n].[additional_data], [n].[big_picture_url], [n].[Body], [n].[body_ar], [n].[body_en], [n].[created_at], [n].[expiry_at], [n].[large_icon_url], [n].[Route], [n].[target_criteria], [n].[Title], [n].[title_ar], [n].[title_en]
FROM [notification_templates] AS [n]
WHERE [n].[Id] = @__Parse_0
2025-02-06 15:01:34.241 +03:00 [INF] Executed DbCommand (0ms) [Parameters=[@__Parse_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [n].[Id], [n].[additional_data], [n].[big_picture_url], [n].[Body], [n].[body_ar], [n].[body_en], [n].[created_at], [n].[expiry_at], [n].[large_icon_url], [n].[Route], [n].[target_criteria], [n].[Title], [n].[title_ar], [n].[title_en]
FROM [notification_templates] AS [n]
WHERE [n].[Id] = @__Parse_0
2025-02-06 15:01:34.242 +03:00 [INF] Executing endpoint 'NayifatAPI.Controllers.NotificationsController.GetNotifications (NayifatAPI)'
2025-02-06 15:01:34.245 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@__Parse_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [n].[Id], [n].[additional_data], [n].[big_picture_url], [n].[Body], [n].[body_ar], [n].[body_en], [n].[created_at], [n].[expiry_at], [n].[large_icon_url], [n].[Route], [n].[target_criteria], [n].[Title], [n].[title_ar], [n].[title_en]
FROM [notification_templates] AS [n]
WHERE [n].[Id] = @__Parse_0
2025-02-06 15:01:34.247 +03:00 [INF] Route matched with {action = "GetNotifications", controller = "Notifications"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetNotifications(NayifatAPI.Controllers.GetNotificationsRequest) on controller NayifatAPI.Controllers.NotificationsController (NayifatAPI).
2025-02-06 15:01:34.247 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@__Parse_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [n].[Id], [n].[additional_data], [n].[big_picture_url], [n].[Body], [n].[body_ar], [n].[body_en], [n].[created_at], [n].[expiry_at], [n].[large_icon_url], [n].[Route], [n].[target_criteria], [n].[Title], [n].[title_ar], [n].[title_en]
FROM [notification_templates] AS [n]
WHERE [n].[Id] = @__Parse_0
2025-02-06 15:01:34.249 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@__Parse_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [n].[Id], [n].[additional_data], [n].[big_picture_url], [n].[Body], [n].[body_ar], [n].[body_en], [n].[created_at], [n].[expiry_at], [n].[large_icon_url], [n].[Route], [n].[target_criteria], [n].[Title], [n].[title_ar], [n].[title_en]
FROM [notification_templates] AS [n]
WHERE [n].[Id] = @__Parse_0
2025-02-06 15:01:34.252 +03:00 [INF] Executed DbCommand (0ms) [Parameters=[@__Parse_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [n].[Id], [n].[additional_data], [n].[big_picture_url], [n].[Body], [n].[body_ar], [n].[body_en], [n].[created_at], [n].[expiry_at], [n].[large_icon_url], [n].[Route], [n].[target_criteria], [n].[Title], [n].[title_ar], [n].[title_en]
FROM [notification_templates] AS [n]
WHERE [n].[Id] = @__Parse_0
2025-02-06 15:01:34.254 +03:00 [INF] Executed DbCommand (0ms) [Parameters=[@__Parse_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [n].[Id], [n].[additional_data], [n].[big_picture_url], [n].[Body], [n].[body_ar], [n].[body_en], [n].[created_at], [n].[expiry_at], [n].[large_icon_url], [n].[Route], [n].[target_criteria], [n].[Title], [n].[title_ar], [n].[title_en]
FROM [notification_templates] AS [n]
WHERE [n].[Id] = @__Parse_0
2025-02-06 15:01:34.256 +03:00 [INF] Executed DbCommand (0ms) [Parameters=[@__Parse_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [n].[Id], [n].[additional_data], [n].[big_picture_url], [n].[Body], [n].[body_ar], [n].[body_en], [n].[created_at], [n].[expiry_at], [n].[large_icon_url], [n].[Route], [n].[target_criteria], [n].[Title], [n].[title_ar], [n].[title_en]
FROM [notification_templates] AS [n]
WHERE [n].[Id] = @__Parse_0
2025-02-06 15:01:34.257 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@__providedApiKey_0='?' (Size = 255)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [a].[api_Key], [a].[CreatedAt], [a].[Description], [a].[ExpiresAt], [a].[IsActive], [a].[LastUsedAt]
FROM [ApiKeys] AS [a]
WHERE [a].[api_Key] = @__providedApiKey_0 AND [a].[IsActive] = CAST(1 AS bit)
2025-02-06 15:01:34.258 +03:00 [INF] Executed DbCommand (0ms) [Parameters=[@__Parse_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [n].[Id], [n].[additional_data], [n].[big_picture_url], [n].[Body], [n].[body_ar], [n].[body_en], [n].[created_at], [n].[expiry_at], [n].[large_icon_url], [n].[Route], [n].[target_criteria], [n].[Title], [n].[title_ar], [n].[title_en]
FROM [notification_templates] AS [n]
WHERE [n].[Id] = @__Parse_0
2025-02-06 15:01:34.260 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@__Parse_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [n].[Id], [n].[additional_data], [n].[big_picture_url], [n].[Body], [n].[body_ar], [n].[body_en], [n].[created_at], [n].[expiry_at], [n].[large_icon_url], [n].[Route], [n].[target_criteria], [n].[Title], [n].[title_ar], [n].[title_en]
FROM [notification_templates] AS [n]
WHERE [n].[Id] = @__Parse_0
2025-02-06 15:01:34.261 +03:00 [INF] Executed DbCommand (0ms) [Parameters=[@__request_NationalId_0='?' (Size = 450)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [u].[national_id], [u].[last_updated], [u].[notifications]
FROM [user_notifications] AS [u]
WHERE [u].[national_id] = @__request_NationalId_0
2025-02-06 15:01:34.263 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@__Parse_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [n].[Id], [n].[additional_data], [n].[big_picture_url], [n].[Body], [n].[body_ar], [n].[body_en], [n].[created_at], [n].[expiry_at], [n].[large_icon_url], [n].[Route], [n].[target_criteria], [n].[Title], [n].[title_ar], [n].[title_en]
FROM [notification_templates] AS [n]
WHERE [n].[Id] = @__Parse_0
2025-02-06 15:01:34.265 +03:00 [INF] Executed DbCommand (0ms) [Parameters=[@__Parse_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [n].[Id], [n].[additional_data], [n].[big_picture_url], [n].[Body], [n].[body_ar], [n].[body_en], [n].[created_at], [n].[expiry_at], [n].[large_icon_url], [n].[Route], [n].[target_criteria], [n].[Title], [n].[title_ar], [n].[title_en]
FROM [notification_templates] AS [n]
WHERE [n].[Id] = @__Parse_0
2025-02-06 15:01:34.266 +03:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType11`2[[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Object, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-02-06 15:01:34.268 +03:00 [INF] Executed DbCommand (0ms) [Parameters=[@__Parse_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [n].[Id], [n].[additional_data], [n].[big_picture_url], [n].[Body], [n].[body_ar], [n].[body_en], [n].[created_at], [n].[expiry_at], [n].[large_icon_url], [n].[Route], [n].[target_criteria], [n].[Title], [n].[title_ar], [n].[title_en]
FROM [notification_templates] AS [n]
WHERE [n].[Id] = @__Parse_0
2025-02-06 15:01:34.269 +03:00 [INF] Executed DbCommand (0ms) [Parameters=[@__Parse_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [n].[Id], [n].[additional_data], [n].[big_picture_url], [n].[Body], [n].[body_ar], [n].[body_en], [n].[created_at], [n].[expiry_at], [n].[large_icon_url], [n].[Route], [n].[target_criteria], [n].[Title], [n].[title_ar], [n].[title_en]
FROM [notification_templates] AS [n]
WHERE [n].[Id] = @__Parse_0
2025-02-06 15:01:34.270 +03:00 [INF] Executed action NayifatAPI.Controllers.NotificationsController.GetNotifications (NayifatAPI) in 19.7807ms
2025-02-06 15:01:34.272 +03:00 [INF] Executed DbCommand (0ms) [Parameters=[@__Parse_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [n].[Id], [n].[additional_data], [n].[big_picture_url], [n].[Body], [n].[body_ar], [n].[body_en], [n].[created_at], [n].[expiry_at], [n].[large_icon_url], [n].[Route], [n].[target_criteria], [n].[Title], [n].[title_ar], [n].[title_en]
FROM [notification_templates] AS [n]
WHERE [n].[Id] = @__Parse_0
2025-02-06 15:01:34.273 +03:00 [INF] Executed DbCommand (0ms) [Parameters=[@__Parse_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [n].[Id], [n].[additional_data], [n].[big_picture_url], [n].[Body], [n].[body_ar], [n].[body_en], [n].[created_at], [n].[expiry_at], [n].[large_icon_url], [n].[Route], [n].[target_criteria], [n].[Title], [n].[title_ar], [n].[title_en]
FROM [notification_templates] AS [n]
WHERE [n].[Id] = @__Parse_0
2025-02-06 15:01:34.273 +03:00 [INF] Executed endpoint 'NayifatAPI.Controllers.NotificationsController.GetNotifications (NayifatAPI)'
2025-02-06 15:01:34.276 +03:00 [INF] Executed DbCommand (0ms) [Parameters=[@__Parse_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [n].[Id], [n].[additional_data], [n].[big_picture_url], [n].[Body], [n].[body_ar], [n].[body_en], [n].[created_at], [n].[expiry_at], [n].[large_icon_url], [n].[Route], [n].[target_criteria], [n].[Title], [n].[title_ar], [n].[title_en]
FROM [notification_templates] AS [n]
WHERE [n].[Id] = @__Parse_0
2025-02-06 15:01:34.278 +03:00 [INF] Request finished HTTP/1.1 POST http://eb3c-46-152-255-232.ngrok-free.app/api/notifications/list - 200 null application/json; charset=utf-8 40.0729ms
2025-02-06 15:01:34.280 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@p0='?' (Size = 4000), @p1='?' (DbType = DateTime2), @p2='?' (Size = 4000), @p3='?' (Size = 4000), @p4='?' (Size = 4000), @p5='?' (Size = 450), @p6='?' (Size = 4000), @p7='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SET IMPLICIT_TRANSACTIONS OFF;
SET NOCOUNT ON;
INSERT INTO [AuthLogs] ([AuthType], [CreatedAt], [DeviceId], [FailureReason], [IpAddress], [NationalId], [Status], [UserAgent])
OUTPUT INSERTED.[Id]
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7);
2025-02-06 15:01:34.281 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@__Parse_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [n].[Id], [n].[additional_data], [n].[big_picture_url], [n].[Body], [n].[body_ar], [n].[body_en], [n].[created_at], [n].[expiry_at], [n].[large_icon_url], [n].[Route], [n].[target_criteria], [n].[Title], [n].[title_ar], [n].[title_en]
FROM [notification_templates] AS [n]
WHERE [n].[Id] = @__Parse_0
2025-02-06 15:01:34.285 +03:00 [ERR] An exception occurred in the database while saving changes for context type 'NayifatAPI.Data.ApplicationDbContext'.
Microsoft.EntityFrameworkCore.DbUpdateException: An error occurred while saving the entity changes. See the inner exception for details.
 ---> Microsoft.Data.SqlClient.SqlException (0x80131904): The INSERT statement conflicted with the FOREIGN KEY constraint "FK_AuthLogs_Customers_NationalId". The conflict occurred in database "NayifatApp", table "dbo.Customers", column 'NationalId'.
   at Microsoft.Data.SqlClient.SqlConnection.OnError(SqlException exception, Boolean breakConnection, Action`1 wrapCloseInAction)
   at Microsoft.Data.SqlClient.SqlInternalConnection.OnError(SqlException exception, Boolean breakConnection, Action`1 wrapCloseInAction)
   at Microsoft.Data.SqlClient.TdsParser.ThrowExceptionAndWarning(TdsParserStateObject stateObj, Boolean callerHasConnectionLock, Boolean asyncClose)
   at Microsoft.Data.SqlClient.TdsParser.TryRun(RunBehavior runBehavior, SqlCommand cmdHandler, SqlDataReader dataStream, BulkCopySimpleResultSet bulkCopyHandler, TdsParserStateObject stateObj, Boolean& dataReady)
   at Microsoft.Data.SqlClient.SqlDataReader.TryHasMoreRows(Boolean& moreRows)
   at Microsoft.Data.SqlClient.SqlDataReader.TryReadInternal(Boolean setTimeout, Boolean& more)
   at Microsoft.Data.SqlClient.SqlDataReader.ReadAsyncExecute(Task task, Object state)
   at Microsoft.Data.SqlClient.SqlDataReader.InvokeAsyncCall[T](SqlDataReaderBaseAsyncCallContext`1 context)
--- End of stack trace from previous location ---
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeResultSetAsync(Int32 startCommandIndex, RelationalDataReader reader, CancellationToken cancellationToken)
ClientConnectionId:56c2b118-9ee9-4904-b637-e2bd4c9322ad
Error Number:547,State:0,Class:16
   --- End of inner exception stack trace ---
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeResultSetAsync(Int32 startCommandIndex, RelationalDataReader reader, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeAsync(RelationalDataReader reader, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Update.Internal.SqlServerModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(IList`1 entriesToSave, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(StateManager stateManager, Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Storage.Internal.SqlServerExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
Microsoft.EntityFrameworkCore.DbUpdateException: An error occurred while saving the entity changes. See the inner exception for details.
 ---> Microsoft.Data.SqlClient.SqlException (0x80131904): The INSERT statement conflicted with the FOREIGN KEY constraint "FK_AuthLogs_Customers_NationalId". The conflict occurred in database "NayifatApp", table "dbo.Customers", column 'NationalId'.
   at Microsoft.Data.SqlClient.SqlConnection.OnError(SqlException exception, Boolean breakConnection, Action`1 wrapCloseInAction)
   at Microsoft.Data.SqlClient.SqlInternalConnection.OnError(SqlException exception, Boolean breakConnection, Action`1 wrapCloseInAction)
   at Microsoft.Data.SqlClient.TdsParser.ThrowExceptionAndWarning(TdsParserStateObject stateObj, Boolean callerHasConnectionLock, Boolean asyncClose)
   at Microsoft.Data.SqlClient.TdsParser.TryRun(RunBehavior runBehavior, SqlCommand cmdHandler, SqlDataReader dataStream, BulkCopySimpleResultSet bulkCopyHandler, TdsParserStateObject stateObj, Boolean& dataReady)
   at Microsoft.Data.SqlClient.SqlDataReader.TryHasMoreRows(Boolean& moreRows)
   at Microsoft.Data.SqlClient.SqlDataReader.TryReadInternal(Boolean setTimeout, Boolean& more)
   at Microsoft.Data.SqlClient.SqlDataReader.ReadAsyncExecute(Task task, Object state)
   at Microsoft.Data.SqlClient.SqlDataReader.InvokeAsyncCall[T](SqlDataReaderBaseAsyncCallContext`1 context)
--- End of stack trace from previous location ---
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeResultSetAsync(Int32 startCommandIndex, RelationalDataReader reader, CancellationToken cancellationToken)
ClientConnectionId:56c2b118-9ee9-4904-b637-e2bd4c9322ad
Error Number:547,State:0,Class:16
   --- End of inner exception stack trace ---
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeResultSetAsync(Int32 startCommandIndex, RelationalDataReader reader, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeAsync(RelationalDataReader reader, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Update.Internal.SqlServerModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(IList`1 entriesToSave, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(StateManager stateManager, Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Storage.Internal.SqlServerExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
2025-02-06 15:01:34.286 +03:00 [INF] Executed DbCommand (0ms) [Parameters=[@__Parse_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [n].[Id], [n].[additional_data], [n].[big_picture_url], [n].[Body], [n].[body_ar], [n].[body_en], [n].[created_at], [n].[expiry_at], [n].[large_icon_url], [n].[Route], [n].[target_criteria], [n].[Title], [n].[title_ar], [n].[title_en]
FROM [notification_templates] AS [n]
WHERE [n].[Id] = @__Parse_0
2025-02-06 15:01:34.296 +03:00 [ERR] Error logging audit event. NationalId: all, Action: notification_delivered, Details: {"notification_count":21,"notification_ids":[38,37,36,35,34,33,32,31,30,29,28,27,26,25,24,23,23,20,19,18,12],"timestamp":"2025-02-06T15:01:34.19134"}
Microsoft.EntityFrameworkCore.DbUpdateException: An error occurred while saving the entity changes. See the inner exception for details.
 ---> Microsoft.Data.SqlClient.SqlException (0x80131904): The INSERT statement conflicted with the FOREIGN KEY constraint "FK_AuthLogs_Customers_NationalId". The conflict occurred in database "NayifatApp", table "dbo.Customers", column 'NationalId'.
   at Microsoft.Data.SqlClient.SqlConnection.OnError(SqlException exception, Boolean breakConnection, Action`1 wrapCloseInAction)
   at Microsoft.Data.SqlClient.SqlInternalConnection.OnError(SqlException exception, Boolean breakConnection, Action`1 wrapCloseInAction)
   at Microsoft.Data.SqlClient.TdsParser.ThrowExceptionAndWarning(TdsParserStateObject stateObj, Boolean callerHasConnectionLock, Boolean asyncClose)
   at Microsoft.Data.SqlClient.TdsParser.TryRun(RunBehavior runBehavior, SqlCommand cmdHandler, SqlDataReader dataStream, BulkCopySimpleResultSet bulkCopyHandler, TdsParserStateObject stateObj, Boolean& dataReady)
   at Microsoft.Data.SqlClient.SqlDataReader.TryHasMoreRows(Boolean& moreRows)
   at Microsoft.Data.SqlClient.SqlDataReader.TryReadInternal(Boolean setTimeout, Boolean& more)
   at Microsoft.Data.SqlClient.SqlDataReader.ReadAsyncExecute(Task task, Object state)
   at Microsoft.Data.SqlClient.SqlDataReader.InvokeAsyncCall[T](SqlDataReaderBaseAsyncCallContext`1 context)
--- End of stack trace from previous location ---
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeResultSetAsync(Int32 startCommandIndex, RelationalDataReader reader, CancellationToken cancellationToken)
ClientConnectionId:56c2b118-9ee9-4904-b637-e2bd4c9322ad
Error Number:547,State:0,Class:16
   --- End of inner exception stack trace ---
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeResultSetAsync(Int32 startCommandIndex, RelationalDataReader reader, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeAsync(RelationalDataReader reader, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Update.Internal.SqlServerModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(IList`1 entriesToSave, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(StateManager stateManager, Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Storage.Internal.SqlServerExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at NayifatAPI.Services.AuditLogService.LogAsync(String nationalId, String action, Object details) in C:\Users\yamta\StudioProjects\nayifat_app_2025_new\NayifatAPI\Services\AuditLogService.cs:line 36
2025-02-06 15:01:34.297 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@__Parse_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [n].[Id], [n].[additional_data], [n].[big_picture_url], [n].[Body], [n].[body_ar], [n].[body_en], [n].[created_at], [n].[expiry_at], [n].[large_icon_url], [n].[Route], [n].[target_criteria], [n].[Title], [n].[title_ar], [n].[title_en]
FROM [notification_templates] AS [n]
WHERE [n].[Id] = @__Parse_0
2025-02-06 15:01:34.308 +03:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType11`2[[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Object, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-02-06 15:01:34.310 +03:00 [INF] Executed DbCommand (0ms) [Parameters=[@__Parse_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [n].[Id], [n].[additional_data], [n].[big_picture_url], [n].[Body], [n].[body_ar], [n].[body_en], [n].[created_at], [n].[expiry_at], [n].[large_icon_url], [n].[Route], [n].[target_criteria], [n].[Title], [n].[title_ar], [n].[title_en]
FROM [notification_templates] AS [n]
WHERE [n].[Id] = @__Parse_0
2025-02-06 15:01:34.311 +03:00 [INF] Executed action NayifatAPI.Controllers.NotificationsController.GetNotifications (NayifatAPI) in 130.982ms
2025-02-06 15:01:34.313 +03:00 [INF] Executed endpoint 'NayifatAPI.Controllers.NotificationsController.GetNotifications (NayifatAPI)'
2025-02-06 15:01:34.314 +03:00 [INF] Request finished HTTP/1.1 POST http://eb3c-46-152-255-232.ngrok-free.app/api/notifications/list - 200 null application/json; charset=utf-8 138.4333ms
2025-02-06 15:01:34.315 +03:00 [INF] Executed DbCommand (2ms) [Parameters=[@p0='?' (Size = 4000), @p1='?' (DbType = DateTime2), @p2='?' (Size = 4000), @p3='?' (Size = 4000), @p4='?' (Size = 4000), @p5='?' (Size = 450), @p6='?' (Size = 4000), @p7='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SET IMPLICIT_TRANSACTIONS OFF;
SET NOCOUNT ON;
INSERT INTO [AuthLogs] ([AuthType], [CreatedAt], [DeviceId], [FailureReason], [IpAddress], [NationalId], [Status], [UserAgent])
OUTPUT INSERTED.[Id]
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7);
2025-02-06 15:01:34.319 +03:00 [ERR] An exception occurred in the database while saving changes for context type 'NayifatAPI.Data.ApplicationDbContext'.
Microsoft.EntityFrameworkCore.DbUpdateException: An error occurred while saving the entity changes. See the inner exception for details.
 ---> Microsoft.Data.SqlClient.SqlException (0x80131904): The INSERT statement conflicted with the FOREIGN KEY constraint "FK_AuthLogs_Customers_NationalId". The conflict occurred in database "NayifatApp", table "dbo.Customers", column 'NationalId'.
   at Microsoft.Data.SqlClient.SqlConnection.OnError(SqlException exception, Boolean breakConnection, Action`1 wrapCloseInAction)
   at Microsoft.Data.SqlClient.SqlInternalConnection.OnError(SqlException exception, Boolean breakConnection, Action`1 wrapCloseInAction)
   at Microsoft.Data.SqlClient.TdsParser.ThrowExceptionAndWarning(TdsParserStateObject stateObj, Boolean callerHasConnectionLock, Boolean asyncClose)
   at Microsoft.Data.SqlClient.TdsParser.TryRun(RunBehavior runBehavior, SqlCommand cmdHandler, SqlDataReader dataStream, BulkCopySimpleResultSet bulkCopyHandler, TdsParserStateObject stateObj, Boolean& dataReady)
   at Microsoft.Data.SqlClient.SqlDataReader.TryHasMoreRows(Boolean& moreRows)
   at Microsoft.Data.SqlClient.SqlDataReader.TryReadInternal(Boolean setTimeout, Boolean& more)
   at Microsoft.Data.SqlClient.SqlDataReader.ReadAsyncExecute(Task task, Object state)
   at Microsoft.Data.SqlClient.SqlDataReader.InvokeAsyncCall[T](SqlDataReaderBaseAsyncCallContext`1 context)
--- End of stack trace from previous location ---
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeResultSetAsync(Int32 startCommandIndex, RelationalDataReader reader, CancellationToken cancellationToken)
ClientConnectionId:8cf28dc7-d8f1-4fdf-904f-524aa00aa969
Error Number:547,State:0,Class:16
   --- End of inner exception stack trace ---
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeResultSetAsync(Int32 startCommandIndex, RelationalDataReader reader, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeAsync(RelationalDataReader reader, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Update.Internal.SqlServerModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(IList`1 entriesToSave, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(StateManager stateManager, Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Storage.Internal.SqlServerExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
Microsoft.EntityFrameworkCore.DbUpdateException: An error occurred while saving the entity changes. See the inner exception for details.
 ---> Microsoft.Data.SqlClient.SqlException (0x80131904): The INSERT statement conflicted with the FOREIGN KEY constraint "FK_AuthLogs_Customers_NationalId". The conflict occurred in database "NayifatApp", table "dbo.Customers", column 'NationalId'.
   at Microsoft.Data.SqlClient.SqlConnection.OnError(SqlException exception, Boolean breakConnection, Action`1 wrapCloseInAction)
   at Microsoft.Data.SqlClient.SqlInternalConnection.OnError(SqlException exception, Boolean breakConnection, Action`1 wrapCloseInAction)
   at Microsoft.Data.SqlClient.TdsParser.ThrowExceptionAndWarning(TdsParserStateObject stateObj, Boolean callerHasConnectionLock, Boolean asyncClose)
   at Microsoft.Data.SqlClient.TdsParser.TryRun(RunBehavior runBehavior, SqlCommand cmdHandler, SqlDataReader dataStream, BulkCopySimpleResultSet bulkCopyHandler, TdsParserStateObject stateObj, Boolean& dataReady)
   at Microsoft.Data.SqlClient.SqlDataReader.TryHasMoreRows(Boolean& moreRows)
   at Microsoft.Data.SqlClient.SqlDataReader.TryReadInternal(Boolean setTimeout, Boolean& more)
   at Microsoft.Data.SqlClient.SqlDataReader.ReadAsyncExecute(Task task, Object state)
   at Microsoft.Data.SqlClient.SqlDataReader.InvokeAsyncCall[T](SqlDataReaderBaseAsyncCallContext`1 context)
--- End of stack trace from previous location ---
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeResultSetAsync(Int32 startCommandIndex, RelationalDataReader reader, CancellationToken cancellationToken)
ClientConnectionId:8cf28dc7-d8f1-4fdf-904f-524aa00aa969
Error Number:547,State:0,Class:16
   --- End of inner exception stack trace ---
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeResultSetAsync(Int32 startCommandIndex, RelationalDataReader reader, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeAsync(RelationalDataReader reader, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Update.Internal.SqlServerModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(IList`1 entriesToSave, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(StateManager stateManager, Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Storage.Internal.SqlServerExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
2025-02-06 15:01:34.333 +03:00 [ERR] Error logging audit event. NationalId: all, Action: notification_delivered, Details: {"notification_count":21,"notification_ids":[38,37,36,35,34,33,32,31,30,29,28,27,26,25,24,23,23,20,19,18,12],"timestamp":"2025-02-06T15:01:34.2121962"}
Microsoft.EntityFrameworkCore.DbUpdateException: An error occurred while saving the entity changes. See the inner exception for details.
 ---> Microsoft.Data.SqlClient.SqlException (0x80131904): The INSERT statement conflicted with the FOREIGN KEY constraint "FK_AuthLogs_Customers_NationalId". The conflict occurred in database "NayifatApp", table "dbo.Customers", column 'NationalId'.
   at Microsoft.Data.SqlClient.SqlConnection.OnError(SqlException exception, Boolean breakConnection, Action`1 wrapCloseInAction)
   at Microsoft.Data.SqlClient.SqlInternalConnection.OnError(SqlException exception, Boolean breakConnection, Action`1 wrapCloseInAction)
   at Microsoft.Data.SqlClient.TdsParser.ThrowExceptionAndWarning(TdsParserStateObject stateObj, Boolean callerHasConnectionLock, Boolean asyncClose)
   at Microsoft.Data.SqlClient.TdsParser.TryRun(RunBehavior runBehavior, SqlCommand cmdHandler, SqlDataReader dataStream, BulkCopySimpleResultSet bulkCopyHandler, TdsParserStateObject stateObj, Boolean& dataReady)
   at Microsoft.Data.SqlClient.SqlDataReader.TryHasMoreRows(Boolean& moreRows)
   at Microsoft.Data.SqlClient.SqlDataReader.TryReadInternal(Boolean setTimeout, Boolean& more)
   at Microsoft.Data.SqlClient.SqlDataReader.ReadAsyncExecute(Task task, Object state)
   at Microsoft.Data.SqlClient.SqlDataReader.InvokeAsyncCall[T](SqlDataReaderBaseAsyncCallContext`1 context)
--- End of stack trace from previous location ---
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeResultSetAsync(Int32 startCommandIndex, RelationalDataReader reader, CancellationToken cancellationToken)
ClientConnectionId:8cf28dc7-d8f1-4fdf-904f-524aa00aa969
Error Number:547,State:0,Class:16
   --- End of inner exception stack trace ---
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeResultSetAsync(Int32 startCommandIndex, RelationalDataReader reader, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeAsync(RelationalDataReader reader, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Update.Internal.SqlServerModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(IList`1 entriesToSave, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(StateManager stateManager, Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Storage.Internal.SqlServerExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at NayifatAPI.Services.AuditLogService.LogAsync(String nationalId, String action, Object details) in C:\Users\yamta\StudioProjects\nayifat_app_2025_new\NayifatAPI\Services\AuditLogService.cs:line 36
2025-02-06 15:01:34.343 +03:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType11`2[[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Object, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-02-06 15:01:34.344 +03:00 [INF] Executed action NayifatAPI.Controllers.NotificationsController.GetNotifications (NayifatAPI) in 145.7105ms
2025-02-06 15:01:34.345 +03:00 [INF] Executed endpoint 'NayifatAPI.Controllers.NotificationsController.GetNotifications (NayifatAPI)'
2025-02-06 15:01:34.346 +03:00 [INF] Request finished HTTP/1.1 POST http://eb3c-46-152-255-232.ngrok-free.app/api/notifications/list - 200 null application/json; charset=utf-8 155.2222ms
2025-02-06 15:01:34.709 +03:00 [INF] Request starting HTTP/1.1 POST http://eb3c-46-152-255-232.ngrok-free.app/api/notifications/list - application/json 45
2025-02-06 15:01:34.713 +03:00 [INF] Executing endpoint 'NayifatAPI.Controllers.NotificationsController.GetNotifications (NayifatAPI)'
2025-02-06 15:01:34.714 +03:00 [INF] Route matched with {action = "GetNotifications", controller = "Notifications"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetNotifications(NayifatAPI.Controllers.GetNotificationsRequest) on controller NayifatAPI.Controllers.NotificationsController (NayifatAPI).
2025-02-06 15:01:34.716 +03:00 [INF] Executed DbCommand (0ms) [Parameters=[@__providedApiKey_0='?' (Size = 255)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [a].[api_Key], [a].[CreatedAt], [a].[Description], [a].[ExpiresAt], [a].[IsActive], [a].[LastUsedAt]
FROM [ApiKeys] AS [a]
WHERE [a].[api_Key] = @__providedApiKey_0 AND [a].[IsActive] = CAST(1 AS bit)
2025-02-06 15:01:34.718 +03:00 [INF] Executed DbCommand (0ms) [Parameters=[@__request_NationalId_0='?' (Size = 450)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [u].[national_id], [u].[last_updated], [u].[notifications]
FROM [user_notifications] AS [u]
WHERE [u].[national_id] = @__request_NationalId_0
2025-02-06 15:01:34.720 +03:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType11`2[[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Object, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-02-06 15:01:34.721 +03:00 [INF] Executed action NayifatAPI.Controllers.NotificationsController.GetNotifications (NayifatAPI) in 6.4461ms
2025-02-06 15:01:34.723 +03:00 [INF] Executed endpoint 'NayifatAPI.Controllers.NotificationsController.GetNotifications (NayifatAPI)'
2025-02-06 15:01:34.724 +03:00 [INF] Request finished HTTP/1.1 POST http://eb3c-46-152-255-232.ngrok-free.app/api/notifications/list - 200 null application/json; charset=utf-8 14.5442ms
2025-02-06 15:11:20.017 +03:00 [INF] Request starting HTTP/1.1 POST http://eb3c-46-152-255-232.ngrok-free.app/api/notifications/list - application/json; charset=utf-8 45
2025-02-06 15:11:20.020 +03:00 [INF] Executing endpoint 'NayifatAPI.Controllers.NotificationsController.GetNotifications (NayifatAPI)'
2025-02-06 15:11:20.021 +03:00 [INF] Route matched with {action = "GetNotifications", controller = "Notifications"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetNotifications(NayifatAPI.Controllers.GetNotificationsRequest) on controller NayifatAPI.Controllers.NotificationsController (NayifatAPI).
2025-02-06 15:11:20.044 +03:00 [INF] Executed DbCommand (14ms) [Parameters=[@__providedApiKey_0='?' (Size = 255)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [a].[api_Key], [a].[CreatedAt], [a].[Description], [a].[ExpiresAt], [a].[IsActive], [a].[LastUsedAt]
FROM [ApiKeys] AS [a]
WHERE [a].[api_Key] = @__providedApiKey_0 AND [a].[IsActive] = CAST(1 AS bit)
2025-02-06 15:11:20.049 +03:00 [INF] Executed DbCommand (3ms) [Parameters=[@__request_NationalId_0='?' (Size = 450)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [u].[national_id], [u].[last_updated], [u].[notifications]
FROM [user_notifications] AS [u]
WHERE [u].[national_id] = @__request_NationalId_0
2025-02-06 15:11:20.052 +03:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType11`2[[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Object, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-02-06 15:11:20.053 +03:00 [INF] Executed action NayifatAPI.Controllers.NotificationsController.GetNotifications (NayifatAPI) in 29.6234ms
2025-02-06 15:11:20.054 +03:00 [INF] Executed endpoint 'NayifatAPI.Controllers.NotificationsController.GetNotifications (NayifatAPI)'
2025-02-06 15:11:20.056 +03:00 [INF] Request finished HTTP/1.1 POST http://eb3c-46-152-255-232.ngrok-free.app/api/notifications/list - 200 null application/json; charset=utf-8 39.0305ms
2025-02-06 15:11:20.452 +03:00 [INF] Request starting HTTP/1.1 POST http://eb3c-46-152-255-232.ngrok-free.app/api/notifications/list - application/json; charset=utf-8 39
2025-02-06 15:11:20.456 +03:00 [INF] Executing endpoint 'NayifatAPI.Controllers.NotificationsController.GetNotifications (NayifatAPI)'
2025-02-06 15:11:20.457 +03:00 [INF] Route matched with {action = "GetNotifications", controller = "Notifications"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetNotifications(NayifatAPI.Controllers.GetNotificationsRequest) on controller NayifatAPI.Controllers.NotificationsController (NayifatAPI).
2025-02-06 15:11:20.459 +03:00 [INF] Executed DbCommand (0ms) [Parameters=[@__providedApiKey_0='?' (Size = 255)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [a].[api_Key], [a].[CreatedAt], [a].[Description], [a].[ExpiresAt], [a].[IsActive], [a].[LastUsedAt]
FROM [ApiKeys] AS [a]
WHERE [a].[api_Key] = @__providedApiKey_0 AND [a].[IsActive] = CAST(1 AS bit)
2025-02-06 15:11:20.462 +03:00 [INF] Executed DbCommand (0ms) [Parameters=[@__request_NationalId_0='?' (Size = 450)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [u].[national_id], [u].[last_updated], [u].[notifications]
FROM [user_notifications] AS [u]
WHERE [u].[national_id] = @__request_NationalId_0
2025-02-06 15:11:20.474 +03:00 [INF] Executed DbCommand (11ms) [Parameters=[@__Parse_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [n].[Id], [n].[additional_data], [n].[big_picture_url], [n].[Body], [n].[body_ar], [n].[body_en], [n].[created_at], [n].[expiry_at], [n].[large_icon_url], [n].[Route], [n].[target_criteria], [n].[Title], [n].[title_ar], [n].[title_en]
FROM [notification_templates] AS [n]
WHERE [n].[Id] = @__Parse_0
2025-02-06 15:11:20.476 +03:00 [INF] Executed DbCommand (0ms) [Parameters=[@__Parse_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [n].[Id], [n].[additional_data], [n].[big_picture_url], [n].[Body], [n].[body_ar], [n].[body_en], [n].[created_at], [n].[expiry_at], [n].[large_icon_url], [n].[Route], [n].[target_criteria], [n].[Title], [n].[title_ar], [n].[title_en]
FROM [notification_templates] AS [n]
WHERE [n].[Id] = @__Parse_0
2025-02-06 15:11:20.479 +03:00 [INF] Executed DbCommand (0ms) [Parameters=[@__Parse_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [n].[Id], [n].[additional_data], [n].[big_picture_url], [n].[Body], [n].[body_ar], [n].[body_en], [n].[created_at], [n].[expiry_at], [n].[large_icon_url], [n].[Route], [n].[target_criteria], [n].[Title], [n].[title_ar], [n].[title_en]
FROM [notification_templates] AS [n]
WHERE [n].[Id] = @__Parse_0
2025-02-06 15:11:20.482 +03:00 [INF] Executed DbCommand (0ms) [Parameters=[@__Parse_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [n].[Id], [n].[additional_data], [n].[big_picture_url], [n].[Body], [n].[body_ar], [n].[body_en], [n].[created_at], [n].[expiry_at], [n].[large_icon_url], [n].[Route], [n].[target_criteria], [n].[Title], [n].[title_ar], [n].[title_en]
FROM [notification_templates] AS [n]
WHERE [n].[Id] = @__Parse_0
2025-02-06 15:11:20.484 +03:00 [INF] Executed DbCommand (0ms) [Parameters=[@__Parse_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [n].[Id], [n].[additional_data], [n].[big_picture_url], [n].[Body], [n].[body_ar], [n].[body_en], [n].[created_at], [n].[expiry_at], [n].[large_icon_url], [n].[Route], [n].[target_criteria], [n].[Title], [n].[title_ar], [n].[title_en]
FROM [notification_templates] AS [n]
WHERE [n].[Id] = @__Parse_0
2025-02-06 15:11:20.487 +03:00 [INF] Executed DbCommand (0ms) [Parameters=[@__Parse_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [n].[Id], [n].[additional_data], [n].[big_picture_url], [n].[Body], [n].[body_ar], [n].[body_en], [n].[created_at], [n].[expiry_at], [n].[large_icon_url], [n].[Route], [n].[target_criteria], [n].[Title], [n].[title_ar], [n].[title_en]
FROM [notification_templates] AS [n]
WHERE [n].[Id] = @__Parse_0
2025-02-06 15:11:20.489 +03:00 [INF] Executed DbCommand (0ms) [Parameters=[@__Parse_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [n].[Id], [n].[additional_data], [n].[big_picture_url], [n].[Body], [n].[body_ar], [n].[body_en], [n].[created_at], [n].[expiry_at], [n].[large_icon_url], [n].[Route], [n].[target_criteria], [n].[Title], [n].[title_ar], [n].[title_en]
FROM [notification_templates] AS [n]
WHERE [n].[Id] = @__Parse_0
2025-02-06 15:11:20.491 +03:00 [INF] Executed DbCommand (0ms) [Parameters=[@__Parse_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [n].[Id], [n].[additional_data], [n].[big_picture_url], [n].[Body], [n].[body_ar], [n].[body_en], [n].[created_at], [n].[expiry_at], [n].[large_icon_url], [n].[Route], [n].[target_criteria], [n].[Title], [n].[title_ar], [n].[title_en]
FROM [notification_templates] AS [n]
WHERE [n].[Id] = @__Parse_0
2025-02-06 15:11:20.493 +03:00 [INF] Executed DbCommand (0ms) [Parameters=[@__Parse_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [n].[Id], [n].[additional_data], [n].[big_picture_url], [n].[Body], [n].[body_ar], [n].[body_en], [n].[created_at], [n].[expiry_at], [n].[large_icon_url], [n].[Route], [n].[target_criteria], [n].[Title], [n].[title_ar], [n].[title_en]
FROM [notification_templates] AS [n]
WHERE [n].[Id] = @__Parse_0
2025-02-06 15:11:20.495 +03:00 [INF] Executed DbCommand (0ms) [Parameters=[@__Parse_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [n].[Id], [n].[additional_data], [n].[big_picture_url], [n].[Body], [n].[body_ar], [n].[body_en], [n].[created_at], [n].[expiry_at], [n].[large_icon_url], [n].[Route], [n].[target_criteria], [n].[Title], [n].[title_ar], [n].[title_en]
FROM [notification_templates] AS [n]
WHERE [n].[Id] = @__Parse_0
2025-02-06 15:11:20.497 +03:00 [INF] Executed DbCommand (0ms) [Parameters=[@__Parse_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [n].[Id], [n].[additional_data], [n].[big_picture_url], [n].[Body], [n].[body_ar], [n].[body_en], [n].[created_at], [n].[expiry_at], [n].[large_icon_url], [n].[Route], [n].[target_criteria], [n].[Title], [n].[title_ar], [n].[title_en]
FROM [notification_templates] AS [n]
WHERE [n].[Id] = @__Parse_0
2025-02-06 15:11:20.500 +03:00 [INF] Executed DbCommand (0ms) [Parameters=[@__Parse_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [n].[Id], [n].[additional_data], [n].[big_picture_url], [n].[Body], [n].[body_ar], [n].[body_en], [n].[created_at], [n].[expiry_at], [n].[large_icon_url], [n].[Route], [n].[target_criteria], [n].[Title], [n].[title_ar], [n].[title_en]
FROM [notification_templates] AS [n]
WHERE [n].[Id] = @__Parse_0
2025-02-06 15:11:20.502 +03:00 [INF] Executed DbCommand (0ms) [Parameters=[@__Parse_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [n].[Id], [n].[additional_data], [n].[big_picture_url], [n].[Body], [n].[body_ar], [n].[body_en], [n].[created_at], [n].[expiry_at], [n].[large_icon_url], [n].[Route], [n].[target_criteria], [n].[Title], [n].[title_ar], [n].[title_en]
FROM [notification_templates] AS [n]
WHERE [n].[Id] = @__Parse_0
2025-02-06 15:11:20.504 +03:00 [INF] Executed DbCommand (0ms) [Parameters=[@__Parse_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [n].[Id], [n].[additional_data], [n].[big_picture_url], [n].[Body], [n].[body_ar], [n].[body_en], [n].[created_at], [n].[expiry_at], [n].[large_icon_url], [n].[Route], [n].[target_criteria], [n].[Title], [n].[title_ar], [n].[title_en]
FROM [notification_templates] AS [n]
WHERE [n].[Id] = @__Parse_0
2025-02-06 15:11:20.507 +03:00 [INF] Executed DbCommand (0ms) [Parameters=[@__Parse_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [n].[Id], [n].[additional_data], [n].[big_picture_url], [n].[Body], [n].[body_ar], [n].[body_en], [n].[created_at], [n].[expiry_at], [n].[large_icon_url], [n].[Route], [n].[target_criteria], [n].[Title], [n].[title_ar], [n].[title_en]
FROM [notification_templates] AS [n]
WHERE [n].[Id] = @__Parse_0
2025-02-06 15:11:20.509 +03:00 [INF] Executed DbCommand (0ms) [Parameters=[@__Parse_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [n].[Id], [n].[additional_data], [n].[big_picture_url], [n].[Body], [n].[body_ar], [n].[body_en], [n].[created_at], [n].[expiry_at], [n].[large_icon_url], [n].[Route], [n].[target_criteria], [n].[Title], [n].[title_ar], [n].[title_en]
FROM [notification_templates] AS [n]
WHERE [n].[Id] = @__Parse_0
2025-02-06 15:11:20.511 +03:00 [INF] Executed DbCommand (0ms) [Parameters=[@__Parse_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [n].[Id], [n].[additional_data], [n].[big_picture_url], [n].[Body], [n].[body_ar], [n].[body_en], [n].[created_at], [n].[expiry_at], [n].[large_icon_url], [n].[Route], [n].[target_criteria], [n].[Title], [n].[title_ar], [n].[title_en]
FROM [notification_templates] AS [n]
WHERE [n].[Id] = @__Parse_0
2025-02-06 15:11:20.513 +03:00 [INF] Executed DbCommand (0ms) [Parameters=[@__Parse_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [n].[Id], [n].[additional_data], [n].[big_picture_url], [n].[Body], [n].[body_ar], [n].[body_en], [n].[created_at], [n].[expiry_at], [n].[large_icon_url], [n].[Route], [n].[target_criteria], [n].[Title], [n].[title_ar], [n].[title_en]
FROM [notification_templates] AS [n]
WHERE [n].[Id] = @__Parse_0
2025-02-06 15:11:20.515 +03:00 [INF] Executed DbCommand (0ms) [Parameters=[@__Parse_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [n].[Id], [n].[additional_data], [n].[big_picture_url], [n].[Body], [n].[body_ar], [n].[body_en], [n].[created_at], [n].[expiry_at], [n].[large_icon_url], [n].[Route], [n].[target_criteria], [n].[Title], [n].[title_ar], [n].[title_en]
FROM [notification_templates] AS [n]
WHERE [n].[Id] = @__Parse_0
2025-02-06 15:11:20.520 +03:00 [INF] Executed DbCommand (0ms) [Parameters=[@__Parse_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [n].[Id], [n].[additional_data], [n].[big_picture_url], [n].[Body], [n].[body_ar], [n].[body_en], [n].[created_at], [n].[expiry_at], [n].[large_icon_url], [n].[Route], [n].[target_criteria], [n].[Title], [n].[title_ar], [n].[title_en]
FROM [notification_templates] AS [n]
WHERE [n].[Id] = @__Parse_0
2025-02-06 15:11:20.522 +03:00 [INF] Executed DbCommand (0ms) [Parameters=[@__Parse_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [n].[Id], [n].[additional_data], [n].[big_picture_url], [n].[Body], [n].[body_ar], [n].[body_en], [n].[created_at], [n].[expiry_at], [n].[large_icon_url], [n].[Route], [n].[target_criteria], [n].[Title], [n].[title_ar], [n].[title_en]
FROM [notification_templates] AS [n]
WHERE [n].[Id] = @__Parse_0
2025-02-06 15:11:20.532 +03:00 [INF] Executed DbCommand (6ms) [Parameters=[@p0='?' (Size = 4000), @p1='?' (DbType = DateTime2), @p2='?' (Size = 4000), @p3='?' (Size = 4000), @p4='?' (Size = 4000), @p5='?' (Size = 450), @p6='?' (Size = 4000), @p7='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SET IMPLICIT_TRANSACTIONS OFF;
SET NOCOUNT ON;
INSERT INTO [AuthLogs] ([AuthType], [CreatedAt], [DeviceId], [FailureReason], [IpAddress], [NationalId], [Status], [UserAgent])
OUTPUT INSERTED.[Id]
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7);
2025-02-06 15:11:20.536 +03:00 [ERR] An exception occurred in the database while saving changes for context type 'NayifatAPI.Data.ApplicationDbContext'.
Microsoft.EntityFrameworkCore.DbUpdateException: An error occurred while saving the entity changes. See the inner exception for details.
 ---> Microsoft.Data.SqlClient.SqlException (0x80131904): The INSERT statement conflicted with the FOREIGN KEY constraint "FK_AuthLogs_Customers_NationalId". The conflict occurred in database "NayifatApp", table "dbo.Customers", column 'NationalId'.
   at Microsoft.Data.SqlClient.SqlConnection.OnError(SqlException exception, Boolean breakConnection, Action`1 wrapCloseInAction)
   at Microsoft.Data.SqlClient.SqlInternalConnection.OnError(SqlException exception, Boolean breakConnection, Action`1 wrapCloseInAction)
   at Microsoft.Data.SqlClient.TdsParser.ThrowExceptionAndWarning(TdsParserStateObject stateObj, Boolean callerHasConnectionLock, Boolean asyncClose)
   at Microsoft.Data.SqlClient.TdsParser.TryRun(RunBehavior runBehavior, SqlCommand cmdHandler, SqlDataReader dataStream, BulkCopySimpleResultSet bulkCopyHandler, TdsParserStateObject stateObj, Boolean& dataReady)
   at Microsoft.Data.SqlClient.SqlDataReader.TryHasMoreRows(Boolean& moreRows)
   at Microsoft.Data.SqlClient.SqlDataReader.TryReadInternal(Boolean setTimeout, Boolean& more)
   at Microsoft.Data.SqlClient.SqlDataReader.ReadAsyncExecute(Task task, Object state)
   at Microsoft.Data.SqlClient.SqlDataReader.InvokeAsyncCall[T](SqlDataReaderBaseAsyncCallContext`1 context)
--- End of stack trace from previous location ---
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeResultSetAsync(Int32 startCommandIndex, RelationalDataReader reader, CancellationToken cancellationToken)
ClientConnectionId:d05da912-74c2-43ca-9c27-77b1375a080c
Error Number:547,State:0,Class:16
   --- End of inner exception stack trace ---
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeResultSetAsync(Int32 startCommandIndex, RelationalDataReader reader, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeAsync(RelationalDataReader reader, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Update.Internal.SqlServerModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(IList`1 entriesToSave, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(StateManager stateManager, Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Storage.Internal.SqlServerExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
Microsoft.EntityFrameworkCore.DbUpdateException: An error occurred while saving the entity changes. See the inner exception for details.
 ---> Microsoft.Data.SqlClient.SqlException (0x80131904): The INSERT statement conflicted with the FOREIGN KEY constraint "FK_AuthLogs_Customers_NationalId". The conflict occurred in database "NayifatApp", table "dbo.Customers", column 'NationalId'.
   at Microsoft.Data.SqlClient.SqlConnection.OnError(SqlException exception, Boolean breakConnection, Action`1 wrapCloseInAction)
   at Microsoft.Data.SqlClient.SqlInternalConnection.OnError(SqlException exception, Boolean breakConnection, Action`1 wrapCloseInAction)
   at Microsoft.Data.SqlClient.TdsParser.ThrowExceptionAndWarning(TdsParserStateObject stateObj, Boolean callerHasConnectionLock, Boolean asyncClose)
   at Microsoft.Data.SqlClient.TdsParser.TryRun(RunBehavior runBehavior, SqlCommand cmdHandler, SqlDataReader dataStream, BulkCopySimpleResultSet bulkCopyHandler, TdsParserStateObject stateObj, Boolean& dataReady)
   at Microsoft.Data.SqlClient.SqlDataReader.TryHasMoreRows(Boolean& moreRows)
   at Microsoft.Data.SqlClient.SqlDataReader.TryReadInternal(Boolean setTimeout, Boolean& more)
   at Microsoft.Data.SqlClient.SqlDataReader.ReadAsyncExecute(Task task, Object state)
   at Microsoft.Data.SqlClient.SqlDataReader.InvokeAsyncCall[T](SqlDataReaderBaseAsyncCallContext`1 context)
--- End of stack trace from previous location ---
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeResultSetAsync(Int32 startCommandIndex, RelationalDataReader reader, CancellationToken cancellationToken)
ClientConnectionId:d05da912-74c2-43ca-9c27-77b1375a080c
Error Number:547,State:0,Class:16
   --- End of inner exception stack trace ---
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeResultSetAsync(Int32 startCommandIndex, RelationalDataReader reader, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeAsync(RelationalDataReader reader, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Update.Internal.SqlServerModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(IList`1 entriesToSave, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(StateManager stateManager, Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Storage.Internal.SqlServerExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
2025-02-06 15:11:20.546 +03:00 [ERR] Error logging audit event. NationalId: all, Action: notification_delivered, Details: {"notification_count":21,"notification_ids":[38,37,36,35,34,33,32,31,30,29,28,27,26,25,24,23,23,20,19,18,12],"timestamp":"2025-02-06T15:11:20.4634072"}
Microsoft.EntityFrameworkCore.DbUpdateException: An error occurred while saving the entity changes. See the inner exception for details.
 ---> Microsoft.Data.SqlClient.SqlException (0x80131904): The INSERT statement conflicted with the FOREIGN KEY constraint "FK_AuthLogs_Customers_NationalId". The conflict occurred in database "NayifatApp", table "dbo.Customers", column 'NationalId'.
   at Microsoft.Data.SqlClient.SqlConnection.OnError(SqlException exception, Boolean breakConnection, Action`1 wrapCloseInAction)
   at Microsoft.Data.SqlClient.SqlInternalConnection.OnError(SqlException exception, Boolean breakConnection, Action`1 wrapCloseInAction)
   at Microsoft.Data.SqlClient.TdsParser.ThrowExceptionAndWarning(TdsParserStateObject stateObj, Boolean callerHasConnectionLock, Boolean asyncClose)
   at Microsoft.Data.SqlClient.TdsParser.TryRun(RunBehavior runBehavior, SqlCommand cmdHandler, SqlDataReader dataStream, BulkCopySimpleResultSet bulkCopyHandler, TdsParserStateObject stateObj, Boolean& dataReady)
   at Microsoft.Data.SqlClient.SqlDataReader.TryHasMoreRows(Boolean& moreRows)
   at Microsoft.Data.SqlClient.SqlDataReader.TryReadInternal(Boolean setTimeout, Boolean& more)
   at Microsoft.Data.SqlClient.SqlDataReader.ReadAsyncExecute(Task task, Object state)
   at Microsoft.Data.SqlClient.SqlDataReader.InvokeAsyncCall[T](SqlDataReaderBaseAsyncCallContext`1 context)
--- End of stack trace from previous location ---
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeResultSetAsync(Int32 startCommandIndex, RelationalDataReader reader, CancellationToken cancellationToken)
ClientConnectionId:d05da912-74c2-43ca-9c27-77b1375a080c
Error Number:547,State:0,Class:16
   --- End of inner exception stack trace ---
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeResultSetAsync(Int32 startCommandIndex, RelationalDataReader reader, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeAsync(RelationalDataReader reader, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Update.Internal.SqlServerModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(IList`1 entriesToSave, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(StateManager stateManager, Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Storage.Internal.SqlServerExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at NayifatAPI.Services.AuditLogService.LogAsync(String nationalId, String action, Object details) in C:\Users\yamta\StudioProjects\nayifat_app_2025_new\NayifatAPI\Services\AuditLogService.cs:line 36
2025-02-06 15:11:20.556 +03:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType11`2[[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Object, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-02-06 15:11:20.558 +03:00 [INF] Executed action NayifatAPI.Controllers.NotificationsController.GetNotifications (NayifatAPI) in 99.8041ms
2025-02-06 15:11:20.559 +03:00 [INF] Executed endpoint 'NayifatAPI.Controllers.NotificationsController.GetNotifications (NayifatAPI)'
2025-02-06 15:11:20.561 +03:00 [INF] Request finished HTTP/1.1 POST http://eb3c-46-152-255-232.ngrok-free.app/api/notifications/list - 200 null application/json; charset=utf-8 109.08ms
2025-02-06 15:11:22.028 +03:00 [INF] Request starting HTTP/1.1 POST http://eb3c-46-152-255-232.ngrok-free.app/api/content/timestamps - application/json; charset=utf-8 2
2025-02-06 15:11:22.031 +03:00 [INF] Executing endpoint 'NayifatAPI.Controllers.ContentController.GetTimestamps (NayifatAPI)'
2025-02-06 15:11:22.032 +03:00 [INF] Route matched with {action = "GetTimestamps", controller = "Content"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetTimestamps() on controller NayifatAPI.Controllers.ContentController (NayifatAPI).
2025-02-06 15:11:22.033 +03:00 [INF] TTT_
2025-02-06 15:11:22.033 +03:00 [INF] TTT_=== Getting Content Timestamps ===
2025-02-06 15:11:22.035 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@__providedApiKey_0='?' (Size = 255)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [a].[api_Key], [a].[CreatedAt], [a].[Description], [a].[ExpiresAt], [a].[IsActive], [a].[LastUsedAt]
FROM [ApiKeys] AS [a]
WHERE [a].[api_Key] = @__providedApiKey_0 AND [a].[IsActive] = CAST(1 AS bit)
2025-02-06 15:11:22.037 +03:00 [INF] TTT_Fetching timestamps from database
2025-02-06 15:11:22.047 +03:00 [INF] Executed DbCommand (9ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT [m].[page] AS [Page], [m].[key_name] AS [KeyName], [m].[last_updated] AS [LastUpdated]
FROM [master_config] AS [m]
2025-02-06 15:11:22.049 +03:00 [INF] TTT_Found 18 content items
2025-02-06 15:11:22.050 +03:00 [INF] TTT_Page: home
2025-02-06 15:11:22.050 +03:00 [INF] TTT_  - slideshow_content: "2025-02-05T13:56:06.9430000"
2025-02-06 15:11:22.051 +03:00 [INF] TTT_  - slideshow_content_ar: "2025-02-05T14:22:06.9430000"
2025-02-06 15:11:22.052 +03:00 [INF] TTT_  - contact_details: "2025-02-05T15:43:06.9430000"
2025-02-06 15:11:22.052 +03:00 [INF] TTT_  - contact_details_ar: "2025-02-05T14:06:06.9430000"
2025-02-06 15:11:22.053 +03:00 [INF] TTT_  - termsEN1: "2025-02-03T14:23:58.0000000"
2025-02-06 15:11:22.053 +03:00 [INF] TTT_  - termsEN2: "2025-02-03T14:25:20.1730000"
2025-02-06 15:11:22.054 +03:00 [INF] TTT_  - privacyEN1: "2025-02-03T14:26:08.6130000"
2025-02-06 15:11:22.055 +03:00 [INF] TTT_  - privacyEN2: "2025-02-03T14:25:20.1730000"
2025-02-06 15:11:22.055 +03:00 [INF] TTT_  - termsAR1: "2025-02-03T14:23:58.0000000"
2025-02-06 15:11:22.056 +03:00 [INF] TTT_  - termsAR2: "2025-02-03T14:25:20.1730000"
2025-02-06 15:11:22.057 +03:00 [INF] TTT_  - privacyAR1: "2025-02-03T14:26:08.6130000"
2025-02-06 15:11:22.057 +03:00 [INF] TTT_  - privacyAR2: "2025-02-03T14:25:20.1730000"
2025-02-06 15:11:22.058 +03:00 [INF] TTT_  - terms&conditionsCC_AR: "2025-02-03T17:06:57.7700000"
2025-02-06 15:11:22.059 +03:00 [INF] TTT_  - terms&conditionsCC_EN: "2025-02-03T17:07:47.4900000"
2025-02-06 15:11:22.060 +03:00 [INF] TTT_  - terms&conditionsPF_AR: "2025-02-03T17:06:57.7700000"
2025-02-06 15:11:22.060 +03:00 [INF] TTT_  - terms&conditionsPF_EN: "2025-02-03T17:06:57.7700000"
2025-02-06 15:11:22.061 +03:00 [INF] TTT_Page: loans
2025-02-06 15:11:22.062 +03:00 [INF] TTT_  - loan_ad: "2025-02-05T13:56:06.9430000"
2025-02-06 15:11:22.062 +03:00 [INF] TTT_Page: cards
2025-02-06 15:11:22.063 +03:00 [INF] TTT_  - card_ad: "2025-02-05T15:43:06.9430000"
2025-02-06 15:11:22.063 +03:00 [INF] TTT_Successfully retrieved all timestamps
2025-02-06 15:11:22.064 +03:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType11`2[[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Object, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-02-06 15:11:22.065 +03:00 [INF] Executed action NayifatAPI.Controllers.ContentController.GetTimestamps (NayifatAPI) in 31.9414ms
2025-02-06 15:11:22.066 +03:00 [INF] Executed endpoint 'NayifatAPI.Controllers.ContentController.GetTimestamps (NayifatAPI)'
2025-02-06 15:11:22.067 +03:00 [INF] Request finished HTTP/1.1 POST http://eb3c-46-152-255-232.ngrok-free.app/api/content/timestamps - 200 null application/json; charset=utf-8 39.3762ms
2025-02-06 15:11:22.910 +03:00 [INF] Request starting HTTP/1.1 POST http://eb3c-46-152-255-232.ngrok-free.app/api/notifications/list - application/json; charset=utf-8 45
2025-02-06 15:11:22.913 +03:00 [INF] Executing endpoint 'NayifatAPI.Controllers.NotificationsController.GetNotifications (NayifatAPI)'
2025-02-06 15:11:22.914 +03:00 [INF] Route matched with {action = "GetNotifications", controller = "Notifications"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetNotifications(NayifatAPI.Controllers.GetNotificationsRequest) on controller NayifatAPI.Controllers.NotificationsController (NayifatAPI).
2025-02-06 15:11:22.918 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@__providedApiKey_0='?' (Size = 255)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [a].[api_Key], [a].[CreatedAt], [a].[Description], [a].[ExpiresAt], [a].[IsActive], [a].[LastUsedAt]
FROM [ApiKeys] AS [a]
WHERE [a].[api_Key] = @__providedApiKey_0 AND [a].[IsActive] = CAST(1 AS bit)
2025-02-06 15:11:22.923 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@__request_NationalId_0='?' (Size = 450)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [u].[national_id], [u].[last_updated], [u].[notifications]
FROM [user_notifications] AS [u]
WHERE [u].[national_id] = @__request_NationalId_0
2025-02-06 15:11:22.925 +03:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType11`2[[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Object, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-02-06 15:11:22.927 +03:00 [INF] Executed action NayifatAPI.Controllers.NotificationsController.GetNotifications (NayifatAPI) in 11.6684ms
2025-02-06 15:11:22.928 +03:00 [INF] Executed endpoint 'NayifatAPI.Controllers.NotificationsController.GetNotifications (NayifatAPI)'
2025-02-06 15:11:22.930 +03:00 [INF] Request finished HTTP/1.1 POST http://eb3c-46-152-255-232.ngrok-free.app/api/notifications/list - 200 null application/json; charset=utf-8 19.4764ms
2025-02-06 15:11:23.323 +03:00 [INF] Request starting HTTP/1.1 POST http://eb3c-46-152-255-232.ngrok-free.app/api/notifications/list - application/json; charset=utf-8 39
2025-02-06 15:11:23.324 +03:00 [INF] Executing endpoint 'NayifatAPI.Controllers.NotificationsController.GetNotifications (NayifatAPI)'
2025-02-06 15:11:23.325 +03:00 [INF] Route matched with {action = "GetNotifications", controller = "Notifications"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetNotifications(NayifatAPI.Controllers.GetNotificationsRequest) on controller NayifatAPI.Controllers.NotificationsController (NayifatAPI).
2025-02-06 15:11:23.328 +03:00 [INF] Executed DbCommand (0ms) [Parameters=[@__providedApiKey_0='?' (Size = 255)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [a].[api_Key], [a].[CreatedAt], [a].[Description], [a].[ExpiresAt], [a].[IsActive], [a].[LastUsedAt]
FROM [ApiKeys] AS [a]
WHERE [a].[api_Key] = @__providedApiKey_0 AND [a].[IsActive] = CAST(1 AS bit)
2025-02-06 15:11:23.329 +03:00 [INF] Executed DbCommand (0ms) [Parameters=[@__request_NationalId_0='?' (Size = 450)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [u].[national_id], [u].[last_updated], [u].[notifications]
FROM [user_notifications] AS [u]
WHERE [u].[national_id] = @__request_NationalId_0
2025-02-06 15:11:23.331 +03:00 [INF] Executed DbCommand (0ms) [Parameters=[@__Parse_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [n].[Id], [n].[additional_data], [n].[big_picture_url], [n].[Body], [n].[body_ar], [n].[body_en], [n].[created_at], [n].[expiry_at], [n].[large_icon_url], [n].[Route], [n].[target_criteria], [n].[Title], [n].[title_ar], [n].[title_en]
FROM [notification_templates] AS [n]
WHERE [n].[Id] = @__Parse_0
2025-02-06 15:11:23.334 +03:00 [INF] Executed DbCommand (0ms) [Parameters=[@__Parse_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [n].[Id], [n].[additional_data], [n].[big_picture_url], [n].[Body], [n].[body_ar], [n].[body_en], [n].[created_at], [n].[expiry_at], [n].[large_icon_url], [n].[Route], [n].[target_criteria], [n].[Title], [n].[title_ar], [n].[title_en]
FROM [notification_templates] AS [n]
WHERE [n].[Id] = @__Parse_0
2025-02-06 15:11:23.337 +03:00 [INF] Executed DbCommand (0ms) [Parameters=[@__Parse_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [n].[Id], [n].[additional_data], [n].[big_picture_url], [n].[Body], [n].[body_ar], [n].[body_en], [n].[created_at], [n].[expiry_at], [n].[large_icon_url], [n].[Route], [n].[target_criteria], [n].[Title], [n].[title_ar], [n].[title_en]
FROM [notification_templates] AS [n]
WHERE [n].[Id] = @__Parse_0
2025-02-06 15:11:23.339 +03:00 [INF] Executed DbCommand (0ms) [Parameters=[@__Parse_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [n].[Id], [n].[additional_data], [n].[big_picture_url], [n].[Body], [n].[body_ar], [n].[body_en], [n].[created_at], [n].[expiry_at], [n].[large_icon_url], [n].[Route], [n].[target_criteria], [n].[Title], [n].[title_ar], [n].[title_en]
FROM [notification_templates] AS [n]
WHERE [n].[Id] = @__Parse_0
2025-02-06 15:11:23.341 +03:00 [INF] Executed DbCommand (0ms) [Parameters=[@__Parse_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [n].[Id], [n].[additional_data], [n].[big_picture_url], [n].[Body], [n].[body_ar], [n].[body_en], [n].[created_at], [n].[expiry_at], [n].[large_icon_url], [n].[Route], [n].[target_criteria], [n].[Title], [n].[title_ar], [n].[title_en]
FROM [notification_templates] AS [n]
WHERE [n].[Id] = @__Parse_0
2025-02-06 15:11:23.342 +03:00 [INF] Executed DbCommand (0ms) [Parameters=[@__Parse_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [n].[Id], [n].[additional_data], [n].[big_picture_url], [n].[Body], [n].[body_ar], [n].[body_en], [n].[created_at], [n].[expiry_at], [n].[large_icon_url], [n].[Route], [n].[target_criteria], [n].[Title], [n].[title_ar], [n].[title_en]
FROM [notification_templates] AS [n]
WHERE [n].[Id] = @__Parse_0
2025-02-06 15:11:23.344 +03:00 [INF] Executed DbCommand (0ms) [Parameters=[@__Parse_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [n].[Id], [n].[additional_data], [n].[big_picture_url], [n].[Body], [n].[body_ar], [n].[body_en], [n].[created_at], [n].[expiry_at], [n].[large_icon_url], [n].[Route], [n].[target_criteria], [n].[Title], [n].[title_ar], [n].[title_en]
FROM [notification_templates] AS [n]
WHERE [n].[Id] = @__Parse_0
2025-02-06 15:11:23.346 +03:00 [INF] Executed DbCommand (0ms) [Parameters=[@__Parse_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [n].[Id], [n].[additional_data], [n].[big_picture_url], [n].[Body], [n].[body_ar], [n].[body_en], [n].[created_at], [n].[expiry_at], [n].[large_icon_url], [n].[Route], [n].[target_criteria], [n].[Title], [n].[title_ar], [n].[title_en]
FROM [notification_templates] AS [n]
WHERE [n].[Id] = @__Parse_0
2025-02-06 15:11:23.348 +03:00 [INF] Executed DbCommand (0ms) [Parameters=[@__Parse_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [n].[Id], [n].[additional_data], [n].[big_picture_url], [n].[Body], [n].[body_ar], [n].[body_en], [n].[created_at], [n].[expiry_at], [n].[large_icon_url], [n].[Route], [n].[target_criteria], [n].[Title], [n].[title_ar], [n].[title_en]
FROM [notification_templates] AS [n]
WHERE [n].[Id] = @__Parse_0
2025-02-06 15:11:23.350 +03:00 [INF] Executed DbCommand (0ms) [Parameters=[@__Parse_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [n].[Id], [n].[additional_data], [n].[big_picture_url], [n].[Body], [n].[body_ar], [n].[body_en], [n].[created_at], [n].[expiry_at], [n].[large_icon_url], [n].[Route], [n].[target_criteria], [n].[Title], [n].[title_ar], [n].[title_en]
FROM [notification_templates] AS [n]
WHERE [n].[Id] = @__Parse_0
2025-02-06 15:11:23.353 +03:00 [INF] Executed DbCommand (0ms) [Parameters=[@__Parse_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [n].[Id], [n].[additional_data], [n].[big_picture_url], [n].[Body], [n].[body_ar], [n].[body_en], [n].[created_at], [n].[expiry_at], [n].[large_icon_url], [n].[Route], [n].[target_criteria], [n].[Title], [n].[title_ar], [n].[title_en]
FROM [notification_templates] AS [n]
WHERE [n].[Id] = @__Parse_0
2025-02-06 15:11:23.354 +03:00 [INF] Executed DbCommand (0ms) [Parameters=[@__Parse_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [n].[Id], [n].[additional_data], [n].[big_picture_url], [n].[Body], [n].[body_ar], [n].[body_en], [n].[created_at], [n].[expiry_at], [n].[large_icon_url], [n].[Route], [n].[target_criteria], [n].[Title], [n].[title_ar], [n].[title_en]
FROM [notification_templates] AS [n]
WHERE [n].[Id] = @__Parse_0
2025-02-06 15:11:23.356 +03:00 [INF] Executed DbCommand (0ms) [Parameters=[@__Parse_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [n].[Id], [n].[additional_data], [n].[big_picture_url], [n].[Body], [n].[body_ar], [n].[body_en], [n].[created_at], [n].[expiry_at], [n].[large_icon_url], [n].[Route], [n].[target_criteria], [n].[Title], [n].[title_ar], [n].[title_en]
FROM [notification_templates] AS [n]
WHERE [n].[Id] = @__Parse_0
2025-02-06 15:11:23.358 +03:00 [INF] Executed DbCommand (0ms) [Parameters=[@__Parse_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [n].[Id], [n].[additional_data], [n].[big_picture_url], [n].[Body], [n].[body_ar], [n].[body_en], [n].[created_at], [n].[expiry_at], [n].[large_icon_url], [n].[Route], [n].[target_criteria], [n].[Title], [n].[title_ar], [n].[title_en]
FROM [notification_templates] AS [n]
WHERE [n].[Id] = @__Parse_0
2025-02-06 15:11:23.361 +03:00 [INF] Executed DbCommand (0ms) [Parameters=[@__Parse_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [n].[Id], [n].[additional_data], [n].[big_picture_url], [n].[Body], [n].[body_ar], [n].[body_en], [n].[created_at], [n].[expiry_at], [n].[large_icon_url], [n].[Route], [n].[target_criteria], [n].[Title], [n].[title_ar], [n].[title_en]
FROM [notification_templates] AS [n]
WHERE [n].[Id] = @__Parse_0
2025-02-06 15:11:23.362 +03:00 [INF] Executed DbCommand (0ms) [Parameters=[@__Parse_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [n].[Id], [n].[additional_data], [n].[big_picture_url], [n].[Body], [n].[body_ar], [n].[body_en], [n].[created_at], [n].[expiry_at], [n].[large_icon_url], [n].[Route], [n].[target_criteria], [n].[Title], [n].[title_ar], [n].[title_en]
FROM [notification_templates] AS [n]
WHERE [n].[Id] = @__Parse_0
2025-02-06 15:11:23.365 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@__Parse_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [n].[Id], [n].[additional_data], [n].[big_picture_url], [n].[Body], [n].[body_ar], [n].[body_en], [n].[created_at], [n].[expiry_at], [n].[large_icon_url], [n].[Route], [n].[target_criteria], [n].[Title], [n].[title_ar], [n].[title_en]
FROM [notification_templates] AS [n]
WHERE [n].[Id] = @__Parse_0
2025-02-06 15:11:23.367 +03:00 [INF] Executed DbCommand (0ms) [Parameters=[@__Parse_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [n].[Id], [n].[additional_data], [n].[big_picture_url], [n].[Body], [n].[body_ar], [n].[body_en], [n].[created_at], [n].[expiry_at], [n].[large_icon_url], [n].[Route], [n].[target_criteria], [n].[Title], [n].[title_ar], [n].[title_en]
FROM [notification_templates] AS [n]
WHERE [n].[Id] = @__Parse_0
2025-02-06 15:11:23.370 +03:00 [INF] Executed DbCommand (0ms) [Parameters=[@__Parse_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [n].[Id], [n].[additional_data], [n].[big_picture_url], [n].[Body], [n].[body_ar], [n].[body_en], [n].[created_at], [n].[expiry_at], [n].[large_icon_url], [n].[Route], [n].[target_criteria], [n].[Title], [n].[title_ar], [n].[title_en]
FROM [notification_templates] AS [n]
WHERE [n].[Id] = @__Parse_0
2025-02-06 15:11:23.372 +03:00 [INF] Executed DbCommand (0ms) [Parameters=[@__Parse_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [n].[Id], [n].[additional_data], [n].[big_picture_url], [n].[Body], [n].[body_ar], [n].[body_en], [n].[created_at], [n].[expiry_at], [n].[large_icon_url], [n].[Route], [n].[target_criteria], [n].[Title], [n].[title_ar], [n].[title_en]
FROM [notification_templates] AS [n]
WHERE [n].[Id] = @__Parse_0
2025-02-06 15:11:23.377 +03:00 [INF] Executed DbCommand (0ms) [Parameters=[@__Parse_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [n].[Id], [n].[additional_data], [n].[big_picture_url], [n].[Body], [n].[body_ar], [n].[body_en], [n].[created_at], [n].[expiry_at], [n].[large_icon_url], [n].[Route], [n].[target_criteria], [n].[Title], [n].[title_ar], [n].[title_en]
FROM [notification_templates] AS [n]
WHERE [n].[Id] = @__Parse_0
2025-02-06 15:11:23.380 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@p0='?' (Size = 4000), @p1='?' (DbType = DateTime2), @p2='?' (Size = 4000), @p3='?' (Size = 4000), @p4='?' (Size = 4000), @p5='?' (Size = 450), @p6='?' (Size = 4000), @p7='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SET IMPLICIT_TRANSACTIONS OFF;
SET NOCOUNT ON;
INSERT INTO [AuthLogs] ([AuthType], [CreatedAt], [DeviceId], [FailureReason], [IpAddress], [NationalId], [Status], [UserAgent])
OUTPUT INSERTED.[Id]
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7);
2025-02-06 15:11:23.383 +03:00 [ERR] An exception occurred in the database while saving changes for context type 'NayifatAPI.Data.ApplicationDbContext'.
Microsoft.EntityFrameworkCore.DbUpdateException: An error occurred while saving the entity changes. See the inner exception for details.
 ---> Microsoft.Data.SqlClient.SqlException (0x80131904): The INSERT statement conflicted with the FOREIGN KEY constraint "FK_AuthLogs_Customers_NationalId". The conflict occurred in database "NayifatApp", table "dbo.Customers", column 'NationalId'.
   at Microsoft.Data.SqlClient.SqlConnection.OnError(SqlException exception, Boolean breakConnection, Action`1 wrapCloseInAction)
   at Microsoft.Data.SqlClient.SqlInternalConnection.OnError(SqlException exception, Boolean breakConnection, Action`1 wrapCloseInAction)
   at Microsoft.Data.SqlClient.TdsParser.ThrowExceptionAndWarning(TdsParserStateObject stateObj, Boolean callerHasConnectionLock, Boolean asyncClose)
   at Microsoft.Data.SqlClient.TdsParser.TryRun(RunBehavior runBehavior, SqlCommand cmdHandler, SqlDataReader dataStream, BulkCopySimpleResultSet bulkCopyHandler, TdsParserStateObject stateObj, Boolean& dataReady)
   at Microsoft.Data.SqlClient.SqlDataReader.TryHasMoreRows(Boolean& moreRows)
   at Microsoft.Data.SqlClient.SqlDataReader.TryReadInternal(Boolean setTimeout, Boolean& more)
   at Microsoft.Data.SqlClient.SqlDataReader.ReadAsyncExecute(Task task, Object state)
   at Microsoft.Data.SqlClient.SqlDataReader.InvokeAsyncCall[T](SqlDataReaderBaseAsyncCallContext`1 context)
--- End of stack trace from previous location ---
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeResultSetAsync(Int32 startCommandIndex, RelationalDataReader reader, CancellationToken cancellationToken)
ClientConnectionId:d05da912-74c2-43ca-9c27-77b1375a080c
Error Number:547,State:0,Class:16
   --- End of inner exception stack trace ---
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeResultSetAsync(Int32 startCommandIndex, RelationalDataReader reader, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeAsync(RelationalDataReader reader, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Update.Internal.SqlServerModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(IList`1 entriesToSave, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(StateManager stateManager, Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Storage.Internal.SqlServerExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
Microsoft.EntityFrameworkCore.DbUpdateException: An error occurred while saving the entity changes. See the inner exception for details.
 ---> Microsoft.Data.SqlClient.SqlException (0x80131904): The INSERT statement conflicted with the FOREIGN KEY constraint "FK_AuthLogs_Customers_NationalId". The conflict occurred in database "NayifatApp", table "dbo.Customers", column 'NationalId'.
   at Microsoft.Data.SqlClient.SqlConnection.OnError(SqlException exception, Boolean breakConnection, Action`1 wrapCloseInAction)
   at Microsoft.Data.SqlClient.SqlInternalConnection.OnError(SqlException exception, Boolean breakConnection, Action`1 wrapCloseInAction)
   at Microsoft.Data.SqlClient.TdsParser.ThrowExceptionAndWarning(TdsParserStateObject stateObj, Boolean callerHasConnectionLock, Boolean asyncClose)
   at Microsoft.Data.SqlClient.TdsParser.TryRun(RunBehavior runBehavior, SqlCommand cmdHandler, SqlDataReader dataStream, BulkCopySimpleResultSet bulkCopyHandler, TdsParserStateObject stateObj, Boolean& dataReady)
   at Microsoft.Data.SqlClient.SqlDataReader.TryHasMoreRows(Boolean& moreRows)
   at Microsoft.Data.SqlClient.SqlDataReader.TryReadInternal(Boolean setTimeout, Boolean& more)
   at Microsoft.Data.SqlClient.SqlDataReader.ReadAsyncExecute(Task task, Object state)
   at Microsoft.Data.SqlClient.SqlDataReader.InvokeAsyncCall[T](SqlDataReaderBaseAsyncCallContext`1 context)
--- End of stack trace from previous location ---
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeResultSetAsync(Int32 startCommandIndex, RelationalDataReader reader, CancellationToken cancellationToken)
ClientConnectionId:d05da912-74c2-43ca-9c27-77b1375a080c
Error Number:547,State:0,Class:16
   --- End of inner exception stack trace ---
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeResultSetAsync(Int32 startCommandIndex, RelationalDataReader reader, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeAsync(RelationalDataReader reader, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Update.Internal.SqlServerModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(IList`1 entriesToSave, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(StateManager stateManager, Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Storage.Internal.SqlServerExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
2025-02-06 15:11:23.392 +03:00 [ERR] Error logging audit event. NationalId: all, Action: notification_delivered, Details: {"notification_count":21,"notification_ids":[38,37,36,35,34,33,32,31,30,29,28,27,26,25,24,23,23,20,19,18,12],"timestamp":"2025-02-06T15:11:23.3313143"}
Microsoft.EntityFrameworkCore.DbUpdateException: An error occurred while saving the entity changes. See the inner exception for details.
 ---> Microsoft.Data.SqlClient.SqlException (0x80131904): The INSERT statement conflicted with the FOREIGN KEY constraint "FK_AuthLogs_Customers_NationalId". The conflict occurred in database "NayifatApp", table "dbo.Customers", column 'NationalId'.
   at Microsoft.Data.SqlClient.SqlConnection.OnError(SqlException exception, Boolean breakConnection, Action`1 wrapCloseInAction)
   at Microsoft.Data.SqlClient.SqlInternalConnection.OnError(SqlException exception, Boolean breakConnection, Action`1 wrapCloseInAction)
   at Microsoft.Data.SqlClient.TdsParser.ThrowExceptionAndWarning(TdsParserStateObject stateObj, Boolean callerHasConnectionLock, Boolean asyncClose)
   at Microsoft.Data.SqlClient.TdsParser.TryRun(RunBehavior runBehavior, SqlCommand cmdHandler, SqlDataReader dataStream, BulkCopySimpleResultSet bulkCopyHandler, TdsParserStateObject stateObj, Boolean& dataReady)
   at Microsoft.Data.SqlClient.SqlDataReader.TryHasMoreRows(Boolean& moreRows)
   at Microsoft.Data.SqlClient.SqlDataReader.TryReadInternal(Boolean setTimeout, Boolean& more)
   at Microsoft.Data.SqlClient.SqlDataReader.ReadAsyncExecute(Task task, Object state)
   at Microsoft.Data.SqlClient.SqlDataReader.InvokeAsyncCall[T](SqlDataReaderBaseAsyncCallContext`1 context)
--- End of stack trace from previous location ---
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeResultSetAsync(Int32 startCommandIndex, RelationalDataReader reader, CancellationToken cancellationToken)
ClientConnectionId:d05da912-74c2-43ca-9c27-77b1375a080c
Error Number:547,State:0,Class:16
   --- End of inner exception stack trace ---
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeResultSetAsync(Int32 startCommandIndex, RelationalDataReader reader, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeAsync(RelationalDataReader reader, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Update.Internal.SqlServerModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(IList`1 entriesToSave, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(StateManager stateManager, Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Storage.Internal.SqlServerExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at NayifatAPI.Services.AuditLogService.LogAsync(String nationalId, String action, Object details) in C:\Users\yamta\StudioProjects\nayifat_app_2025_new\NayifatAPI\Services\AuditLogService.cs:line 36
2025-02-06 15:11:23.404 +03:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType11`2[[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Object, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-02-06 15:11:23.405 +03:00 [INF] Executed action NayifatAPI.Controllers.NotificationsController.GetNotifications (NayifatAPI) in 78.5916ms
2025-02-06 15:11:23.407 +03:00 [INF] Executed endpoint 'NayifatAPI.Controllers.NotificationsController.GetNotifications (NayifatAPI)'
2025-02-06 15:11:23.408 +03:00 [INF] Request finished HTTP/1.1 POST http://eb3c-46-152-255-232.ngrok-free.app/api/notifications/list - 200 null application/json; charset=utf-8 85.4389ms
2025-02-06 15:13:35.640 +03:00 [INF] Request starting HTTP/1.1 POST http://eb3c-46-152-255-232.ngrok-free.app/api/notifications/list - application/json 39
2025-02-06 15:13:35.876 +03:00 [INF] Executing endpoint 'NayifatAPI.Controllers.NotificationsController.GetNotifications (NayifatAPI)'
2025-02-06 15:13:35.878 +03:00 [INF] Route matched with {action = "GetNotifications", controller = "Notifications"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetNotifications(NayifatAPI.Controllers.GetNotificationsRequest) on controller NayifatAPI.Controllers.NotificationsController (NayifatAPI).
2025-02-06 15:13:35.916 +03:00 [INF] Executed DbCommand (32ms) [Parameters=[@__providedApiKey_0='?' (Size = 255)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [a].[api_Key], [a].[CreatedAt], [a].[Description], [a].[ExpiresAt], [a].[IsActive], [a].[LastUsedAt]
FROM [ApiKeys] AS [a]
WHERE [a].[api_Key] = @__providedApiKey_0 AND [a].[IsActive] = CAST(1 AS bit)
2025-02-06 15:13:35.936 +03:00 [INF] Executed DbCommand (12ms) [Parameters=[@__request_NationalId_0='?' (Size = 450)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [u].[national_id], [u].[last_updated], [u].[notifications]
FROM [user_notifications] AS [u]
WHERE [u].[national_id] = @__request_NationalId_0
2025-02-06 15:13:35.978 +03:00 [INF] Executed DbCommand (35ms) [Parameters=[@__Parse_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [n].[Id], [n].[additional_data], [n].[big_picture_url], [n].[Body], [n].[body_ar], [n].[body_en], [n].[created_at], [n].[expiry_at], [n].[large_icon_url], [n].[Route], [n].[target_criteria], [n].[Title], [n].[title_ar], [n].[title_en]
FROM [notification_templates] AS [n]
WHERE [n].[Id] = @__Parse_0
2025-02-06 15:13:35.999 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@__Parse_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [n].[Id], [n].[additional_data], [n].[big_picture_url], [n].[Body], [n].[body_ar], [n].[body_en], [n].[created_at], [n].[expiry_at], [n].[large_icon_url], [n].[Route], [n].[target_criteria], [n].[Title], [n].[title_ar], [n].[title_en]
FROM [notification_templates] AS [n]
WHERE [n].[Id] = @__Parse_0
2025-02-06 15:13:36.013 +03:00 [INF] Executed DbCommand (2ms) [Parameters=[@__Parse_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [n].[Id], [n].[additional_data], [n].[big_picture_url], [n].[Body], [n].[body_ar], [n].[body_en], [n].[created_at], [n].[expiry_at], [n].[large_icon_url], [n].[Route], [n].[target_criteria], [n].[Title], [n].[title_ar], [n].[title_en]
FROM [notification_templates] AS [n]
WHERE [n].[Id] = @__Parse_0
2025-02-06 15:13:36.026 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@__Parse_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [n].[Id], [n].[additional_data], [n].[big_picture_url], [n].[Body], [n].[body_ar], [n].[body_en], [n].[created_at], [n].[expiry_at], [n].[large_icon_url], [n].[Route], [n].[target_criteria], [n].[Title], [n].[title_ar], [n].[title_en]
FROM [notification_templates] AS [n]
WHERE [n].[Id] = @__Parse_0
2025-02-06 15:13:36.039 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@__Parse_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [n].[Id], [n].[additional_data], [n].[big_picture_url], [n].[Body], [n].[body_ar], [n].[body_en], [n].[created_at], [n].[expiry_at], [n].[large_icon_url], [n].[Route], [n].[target_criteria], [n].[Title], [n].[title_ar], [n].[title_en]
FROM [notification_templates] AS [n]
WHERE [n].[Id] = @__Parse_0
2025-02-06 15:13:36.048 +03:00 [INF] Executed DbCommand (2ms) [Parameters=[@__Parse_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [n].[Id], [n].[additional_data], [n].[big_picture_url], [n].[Body], [n].[body_ar], [n].[body_en], [n].[created_at], [n].[expiry_at], [n].[large_icon_url], [n].[Route], [n].[target_criteria], [n].[Title], [n].[title_ar], [n].[title_en]
FROM [notification_templates] AS [n]
WHERE [n].[Id] = @__Parse_0
2025-02-06 15:13:36.081 +03:00 [INF] Executed DbCommand (5ms) [Parameters=[@__Parse_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [n].[Id], [n].[additional_data], [n].[big_picture_url], [n].[Body], [n].[body_ar], [n].[body_en], [n].[created_at], [n].[expiry_at], [n].[large_icon_url], [n].[Route], [n].[target_criteria], [n].[Title], [n].[title_ar], [n].[title_en]
FROM [notification_templates] AS [n]
WHERE [n].[Id] = @__Parse_0
2025-02-06 15:13:36.110 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@__Parse_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [n].[Id], [n].[additional_data], [n].[big_picture_url], [n].[Body], [n].[body_ar], [n].[body_en], [n].[created_at], [n].[expiry_at], [n].[large_icon_url], [n].[Route], [n].[target_criteria], [n].[Title], [n].[title_ar], [n].[title_en]
FROM [notification_templates] AS [n]
WHERE [n].[Id] = @__Parse_0
2025-02-06 15:13:36.136 +03:00 [INF] Executed DbCommand (7ms) [Parameters=[@__Parse_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [n].[Id], [n].[additional_data], [n].[big_picture_url], [n].[Body], [n].[body_ar], [n].[body_en], [n].[created_at], [n].[expiry_at], [n].[large_icon_url], [n].[Route], [n].[target_criteria], [n].[Title], [n].[title_ar], [n].[title_en]
FROM [notification_templates] AS [n]
WHERE [n].[Id] = @__Parse_0
2025-02-06 15:13:36.143 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@__Parse_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [n].[Id], [n].[additional_data], [n].[big_picture_url], [n].[Body], [n].[body_ar], [n].[body_en], [n].[created_at], [n].[expiry_at], [n].[large_icon_url], [n].[Route], [n].[target_criteria], [n].[Title], [n].[title_ar], [n].[title_en]
FROM [notification_templates] AS [n]
WHERE [n].[Id] = @__Parse_0
2025-02-06 15:13:36.149 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@__Parse_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [n].[Id], [n].[additional_data], [n].[big_picture_url], [n].[Body], [n].[body_ar], [n].[body_en], [n].[created_at], [n].[expiry_at], [n].[large_icon_url], [n].[Route], [n].[target_criteria], [n].[Title], [n].[title_ar], [n].[title_en]
FROM [notification_templates] AS [n]
WHERE [n].[Id] = @__Parse_0
2025-02-06 15:13:36.156 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@__Parse_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [n].[Id], [n].[additional_data], [n].[big_picture_url], [n].[Body], [n].[body_ar], [n].[body_en], [n].[created_at], [n].[expiry_at], [n].[large_icon_url], [n].[Route], [n].[target_criteria], [n].[Title], [n].[title_ar], [n].[title_en]
FROM [notification_templates] AS [n]
WHERE [n].[Id] = @__Parse_0
2025-02-06 15:13:36.162 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@__Parse_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [n].[Id], [n].[additional_data], [n].[big_picture_url], [n].[Body], [n].[body_ar], [n].[body_en], [n].[created_at], [n].[expiry_at], [n].[large_icon_url], [n].[Route], [n].[target_criteria], [n].[Title], [n].[title_ar], [n].[title_en]
FROM [notification_templates] AS [n]
WHERE [n].[Id] = @__Parse_0
2025-02-06 15:13:36.173 +03:00 [INF] Executed DbCommand (2ms) [Parameters=[@__Parse_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [n].[Id], [n].[additional_data], [n].[big_picture_url], [n].[Body], [n].[body_ar], [n].[body_en], [n].[created_at], [n].[expiry_at], [n].[large_icon_url], [n].[Route], [n].[target_criteria], [n].[Title], [n].[title_ar], [n].[title_en]
FROM [notification_templates] AS [n]
WHERE [n].[Id] = @__Parse_0
2025-02-06 15:13:36.221 +03:00 [INF] Executed DbCommand (21ms) [Parameters=[@__Parse_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [n].[Id], [n].[additional_data], [n].[big_picture_url], [n].[Body], [n].[body_ar], [n].[body_en], [n].[created_at], [n].[expiry_at], [n].[large_icon_url], [n].[Route], [n].[target_criteria], [n].[Title], [n].[title_ar], [n].[title_en]
FROM [notification_templates] AS [n]
WHERE [n].[Id] = @__Parse_0
2025-02-06 15:13:36.229 +03:00 [INF] Executed DbCommand (2ms) [Parameters=[@__Parse_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [n].[Id], [n].[additional_data], [n].[big_picture_url], [n].[Body], [n].[body_ar], [n].[body_en], [n].[created_at], [n].[expiry_at], [n].[large_icon_url], [n].[Route], [n].[target_criteria], [n].[Title], [n].[title_ar], [n].[title_en]
FROM [notification_templates] AS [n]
WHERE [n].[Id] = @__Parse_0
2025-02-06 15:13:36.309 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@__Parse_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [n].[Id], [n].[additional_data], [n].[big_picture_url], [n].[Body], [n].[body_ar], [n].[body_en], [n].[created_at], [n].[expiry_at], [n].[large_icon_url], [n].[Route], [n].[target_criteria], [n].[Title], [n].[title_ar], [n].[title_en]
FROM [notification_templates] AS [n]
WHERE [n].[Id] = @__Parse_0
2025-02-06 15:13:36.362 +03:00 [INF] Executed DbCommand (12ms) [Parameters=[@__Parse_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [n].[Id], [n].[additional_data], [n].[big_picture_url], [n].[Body], [n].[body_ar], [n].[body_en], [n].[created_at], [n].[expiry_at], [n].[large_icon_url], [n].[Route], [n].[target_criteria], [n].[Title], [n].[title_ar], [n].[title_en]
FROM [notification_templates] AS [n]
WHERE [n].[Id] = @__Parse_0
2025-02-06 15:13:36.418 +03:00 [INF] Executed DbCommand (3ms) [Parameters=[@__Parse_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [n].[Id], [n].[additional_data], [n].[big_picture_url], [n].[Body], [n].[body_ar], [n].[body_en], [n].[created_at], [n].[expiry_at], [n].[large_icon_url], [n].[Route], [n].[target_criteria], [n].[Title], [n].[title_ar], [n].[title_en]
FROM [notification_templates] AS [n]
WHERE [n].[Id] = @__Parse_0
2025-02-06 15:13:36.425 +03:00 [INF] Executed DbCommand (2ms) [Parameters=[@__Parse_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [n].[Id], [n].[additional_data], [n].[big_picture_url], [n].[Body], [n].[body_ar], [n].[body_en], [n].[created_at], [n].[expiry_at], [n].[large_icon_url], [n].[Route], [n].[target_criteria], [n].[Title], [n].[title_ar], [n].[title_en]
FROM [notification_templates] AS [n]
WHERE [n].[Id] = @__Parse_0
2025-02-06 15:13:36.489 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@__Parse_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [n].[Id], [n].[additional_data], [n].[big_picture_url], [n].[Body], [n].[body_ar], [n].[body_en], [n].[created_at], [n].[expiry_at], [n].[large_icon_url], [n].[Route], [n].[target_criteria], [n].[Title], [n].[title_ar], [n].[title_en]
FROM [notification_templates] AS [n]
WHERE [n].[Id] = @__Parse_0
2025-02-06 15:13:36.552 +03:00 [INF] Executed DbCommand (51ms) [Parameters=[@p0='?' (Size = 4000), @p1='?' (DbType = DateTime2), @p2='?' (Size = 4000), @p3='?' (Size = 4000), @p4='?' (Size = 4000), @p5='?' (Size = 450), @p6='?' (Size = 4000), @p7='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SET IMPLICIT_TRANSACTIONS OFF;
SET NOCOUNT ON;
INSERT INTO [AuthLogs] ([AuthType], [CreatedAt], [DeviceId], [FailureReason], [IpAddress], [NationalId], [Status], [UserAgent])
OUTPUT INSERTED.[Id]
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7);
2025-02-06 15:13:36.583 +03:00 [ERR] An exception occurred in the database while saving changes for context type 'NayifatAPI.Data.ApplicationDbContext'.
Microsoft.EntityFrameworkCore.DbUpdateException: An error occurred while saving the entity changes. See the inner exception for details.
 ---> Microsoft.Data.SqlClient.SqlException (0x80131904): The INSERT statement conflicted with the FOREIGN KEY constraint "FK_AuthLogs_Customers_NationalId". The conflict occurred in database "NayifatApp", table "dbo.Customers", column 'NationalId'.
   at Microsoft.Data.SqlClient.SqlConnection.OnError(SqlException exception, Boolean breakConnection, Action`1 wrapCloseInAction)
   at Microsoft.Data.SqlClient.SqlInternalConnection.OnError(SqlException exception, Boolean breakConnection, Action`1 wrapCloseInAction)
   at Microsoft.Data.SqlClient.TdsParser.ThrowExceptionAndWarning(TdsParserStateObject stateObj, Boolean callerHasConnectionLock, Boolean asyncClose)
   at Microsoft.Data.SqlClient.TdsParser.TryRun(RunBehavior runBehavior, SqlCommand cmdHandler, SqlDataReader dataStream, BulkCopySimpleResultSet bulkCopyHandler, TdsParserStateObject stateObj, Boolean& dataReady)
   at Microsoft.Data.SqlClient.SqlDataReader.TryHasMoreRows(Boolean& moreRows)
   at Microsoft.Data.SqlClient.SqlDataReader.TryReadInternal(Boolean setTimeout, Boolean& more)
   at Microsoft.Data.SqlClient.SqlDataReader.ReadAsyncExecute(Task task, Object state)
   at Microsoft.Data.SqlClient.SqlDataReader.InvokeAsyncCall[T](SqlDataReaderBaseAsyncCallContext`1 context)
--- End of stack trace from previous location ---
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeResultSetAsync(Int32 startCommandIndex, RelationalDataReader reader, CancellationToken cancellationToken)
ClientConnectionId:d05da912-74c2-43ca-9c27-77b1375a080c
Error Number:547,State:0,Class:16
   --- End of inner exception stack trace ---
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeResultSetAsync(Int32 startCommandIndex, RelationalDataReader reader, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeAsync(RelationalDataReader reader, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Update.Internal.SqlServerModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(IList`1 entriesToSave, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(StateManager stateManager, Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Storage.Internal.SqlServerExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
Microsoft.EntityFrameworkCore.DbUpdateException: An error occurred while saving the entity changes. See the inner exception for details.
 ---> Microsoft.Data.SqlClient.SqlException (0x80131904): The INSERT statement conflicted with the FOREIGN KEY constraint "FK_AuthLogs_Customers_NationalId". The conflict occurred in database "NayifatApp", table "dbo.Customers", column 'NationalId'.
   at Microsoft.Data.SqlClient.SqlConnection.OnError(SqlException exception, Boolean breakConnection, Action`1 wrapCloseInAction)
   at Microsoft.Data.SqlClient.SqlInternalConnection.OnError(SqlException exception, Boolean breakConnection, Action`1 wrapCloseInAction)
   at Microsoft.Data.SqlClient.TdsParser.ThrowExceptionAndWarning(TdsParserStateObject stateObj, Boolean callerHasConnectionLock, Boolean asyncClose)
   at Microsoft.Data.SqlClient.TdsParser.TryRun(RunBehavior runBehavior, SqlCommand cmdHandler, SqlDataReader dataStream, BulkCopySimpleResultSet bulkCopyHandler, TdsParserStateObject stateObj, Boolean& dataReady)
   at Microsoft.Data.SqlClient.SqlDataReader.TryHasMoreRows(Boolean& moreRows)
   at Microsoft.Data.SqlClient.SqlDataReader.TryReadInternal(Boolean setTimeout, Boolean& more)
   at Microsoft.Data.SqlClient.SqlDataReader.ReadAsyncExecute(Task task, Object state)
   at Microsoft.Data.SqlClient.SqlDataReader.InvokeAsyncCall[T](SqlDataReaderBaseAsyncCallContext`1 context)
--- End of stack trace from previous location ---
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeResultSetAsync(Int32 startCommandIndex, RelationalDataReader reader, CancellationToken cancellationToken)
ClientConnectionId:d05da912-74c2-43ca-9c27-77b1375a080c
Error Number:547,State:0,Class:16
   --- End of inner exception stack trace ---
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeResultSetAsync(Int32 startCommandIndex, RelationalDataReader reader, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeAsync(RelationalDataReader reader, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Update.Internal.SqlServerModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(IList`1 entriesToSave, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(StateManager stateManager, Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Storage.Internal.SqlServerExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
2025-02-06 15:13:36.737 +03:00 [ERR] Error logging audit event. NationalId: all, Action: notification_delivered, Details: {"notification_count":21,"notification_ids":[38,37,36,35,34,33,32,31,30,29,28,27,26,25,24,23,23,20,19,18,12],"timestamp":"2025-02-06T15:13:35.9422319"}
Microsoft.EntityFrameworkCore.DbUpdateException: An error occurred while saving the entity changes. See the inner exception for details.
 ---> Microsoft.Data.SqlClient.SqlException (0x80131904): The INSERT statement conflicted with the FOREIGN KEY constraint "FK_AuthLogs_Customers_NationalId". The conflict occurred in database "NayifatApp", table "dbo.Customers", column 'NationalId'.
   at Microsoft.Data.SqlClient.SqlConnection.OnError(SqlException exception, Boolean breakConnection, Action`1 wrapCloseInAction)
   at Microsoft.Data.SqlClient.SqlInternalConnection.OnError(SqlException exception, Boolean breakConnection, Action`1 wrapCloseInAction)
   at Microsoft.Data.SqlClient.TdsParser.ThrowExceptionAndWarning(TdsParserStateObject stateObj, Boolean callerHasConnectionLock, Boolean asyncClose)
   at Microsoft.Data.SqlClient.TdsParser.TryRun(RunBehavior runBehavior, SqlCommand cmdHandler, SqlDataReader dataStream, BulkCopySimpleResultSet bulkCopyHandler, TdsParserStateObject stateObj, Boolean& dataReady)
   at Microsoft.Data.SqlClient.SqlDataReader.TryHasMoreRows(Boolean& moreRows)
   at Microsoft.Data.SqlClient.SqlDataReader.TryReadInternal(Boolean setTimeout, Boolean& more)
   at Microsoft.Data.SqlClient.SqlDataReader.ReadAsyncExecute(Task task, Object state)
   at Microsoft.Data.SqlClient.SqlDataReader.InvokeAsyncCall[T](SqlDataReaderBaseAsyncCallContext`1 context)
--- End of stack trace from previous location ---
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeResultSetAsync(Int32 startCommandIndex, RelationalDataReader reader, CancellationToken cancellationToken)
ClientConnectionId:d05da912-74c2-43ca-9c27-77b1375a080c
Error Number:547,State:0,Class:16
   --- End of inner exception stack trace ---
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeResultSetAsync(Int32 startCommandIndex, RelationalDataReader reader, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeAsync(RelationalDataReader reader, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Update.Internal.SqlServerModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(IList`1 entriesToSave, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(StateManager stateManager, Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Storage.Internal.SqlServerExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at NayifatAPI.Services.AuditLogService.LogAsync(String nationalId, String action, Object details) in C:\Users\yamta\StudioProjects\nayifat_app_2025_new\NayifatAPI\Services\AuditLogService.cs:line 36
2025-02-06 15:13:36.941 +03:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType11`2[[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Object, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-02-06 15:13:36.943 +03:00 [INF] Executed action NayifatAPI.Controllers.NotificationsController.GetNotifications (NayifatAPI) in 1060.9634ms
2025-02-06 15:13:36.949 +03:00 [INF] Executed endpoint 'NayifatAPI.Controllers.NotificationsController.GetNotifications (NayifatAPI)'
2025-02-06 15:13:36.954 +03:00 [INF] Request finished HTTP/1.1 POST http://eb3c-46-152-255-232.ngrok-free.app/api/notifications/list - 200 null application/json; charset=utf-8 1314.0365ms
2025-02-06 15:13:37.125 +03:00 [INF] Request starting HTTP/1.1 POST http://eb3c-46-152-255-232.ngrok-free.app/api/notifications/list - application/json 45
2025-02-06 15:13:37.142 +03:00 [INF] Executing endpoint 'NayifatAPI.Controllers.NotificationsController.GetNotifications (NayifatAPI)'
2025-02-06 15:13:37.152 +03:00 [INF] Route matched with {action = "GetNotifications", controller = "Notifications"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetNotifications(NayifatAPI.Controllers.GetNotificationsRequest) on controller NayifatAPI.Controllers.NotificationsController (NayifatAPI).
2025-02-06 15:13:37.240 +03:00 [INF] Executed DbCommand (12ms) [Parameters=[@__providedApiKey_0='?' (Size = 255)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [a].[api_Key], [a].[CreatedAt], [a].[Description], [a].[ExpiresAt], [a].[IsActive], [a].[LastUsedAt]
FROM [ApiKeys] AS [a]
WHERE [a].[api_Key] = @__providedApiKey_0 AND [a].[IsActive] = CAST(1 AS bit)
2025-02-06 15:13:37.322 +03:00 [INF] Executed DbCommand (14ms) [Parameters=[@__request_NationalId_0='?' (Size = 450)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [u].[national_id], [u].[last_updated], [u].[notifications]
FROM [user_notifications] AS [u]
WHERE [u].[national_id] = @__request_NationalId_0
2025-02-06 15:13:37.331 +03:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType11`2[[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Object, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-02-06 15:13:37.355 +03:00 [INF] Executed action NayifatAPI.Controllers.NotificationsController.GetNotifications (NayifatAPI) in 129.4014ms
2025-02-06 15:13:37.359 +03:00 [INF] Executed endpoint 'NayifatAPI.Controllers.NotificationsController.GetNotifications (NayifatAPI)'
2025-02-06 15:13:37.364 +03:00 [INF] Request finished HTTP/1.1 POST http://eb3c-46-152-255-232.ngrok-free.app/api/notifications/list - 200 null application/json; charset=utf-8 239.0559ms
2025-02-06 15:13:46.376 +03:00 [INF] Request starting HTTP/1.1 POST http://eb3c-46-152-255-232.ngrok-free.app/api/notifications/list - application/json; charset=utf-8 45
2025-02-06 15:13:46.546 +03:00 [INF] Executing endpoint 'NayifatAPI.Controllers.NotificationsController.GetNotifications (NayifatAPI)'
2025-02-06 15:13:46.611 +03:00 [INF] Route matched with {action = "GetNotifications", controller = "Notifications"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetNotifications(NayifatAPI.Controllers.GetNotificationsRequest) on controller NayifatAPI.Controllers.NotificationsController (NayifatAPI).
2025-02-06 15:13:46.808 +03:00 [INF] Executed DbCommand (142ms) [Parameters=[@__providedApiKey_0='?' (Size = 255)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [a].[api_Key], [a].[CreatedAt], [a].[Description], [a].[ExpiresAt], [a].[IsActive], [a].[LastUsedAt]
FROM [ApiKeys] AS [a]
WHERE [a].[api_Key] = @__providedApiKey_0 AND [a].[IsActive] = CAST(1 AS bit)
2025-02-06 15:13:46.836 +03:00 [INF] Executed DbCommand (26ms) [Parameters=[@__request_NationalId_0='?' (Size = 450)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [u].[national_id], [u].[last_updated], [u].[notifications]
FROM [user_notifications] AS [u]
WHERE [u].[national_id] = @__request_NationalId_0
2025-02-06 15:13:46.878 +03:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType11`2[[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Object, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-02-06 15:13:46.926 +03:00 [INF] Executed action NayifatAPI.Controllers.NotificationsController.GetNotifications (NayifatAPI) in 262.4273ms
2025-02-06 15:13:46.997 +03:00 [INF] Executed endpoint 'NayifatAPI.Controllers.NotificationsController.GetNotifications (NayifatAPI)'
2025-02-06 15:13:47.018 +03:00 [INF] Request finished HTTP/1.1 POST http://eb3c-46-152-255-232.ngrok-free.app/api/notifications/list - 200 null application/json; charset=utf-8 642.4314ms
2025-02-06 15:13:47.507 +03:00 [INF] Request starting HTTP/1.1 POST http://eb3c-46-152-255-232.ngrok-free.app/api/notifications/list - application/json; charset=utf-8 39
2025-02-06 15:13:48.888 +03:00 [INF] Executing endpoint 'NayifatAPI.Controllers.NotificationsController.GetNotifications (NayifatAPI)'
2025-02-06 15:13:48.890 +03:00 [INF] Route matched with {action = "GetNotifications", controller = "Notifications"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetNotifications(NayifatAPI.Controllers.GetNotificationsRequest) on controller NayifatAPI.Controllers.NotificationsController (NayifatAPI).
2025-02-06 15:13:48.909 +03:00 [INF] Executed DbCommand (16ms) [Parameters=[@__providedApiKey_0='?' (Size = 255)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [a].[api_Key], [a].[CreatedAt], [a].[Description], [a].[ExpiresAt], [a].[IsActive], [a].[LastUsedAt]
FROM [ApiKeys] AS [a]
WHERE [a].[api_Key] = @__providedApiKey_0 AND [a].[IsActive] = CAST(1 AS bit)
2025-02-06 15:13:48.940 +03:00 [INF] Executed DbCommand (29ms) [Parameters=[@__request_NationalId_0='?' (Size = 450)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [u].[national_id], [u].[last_updated], [u].[notifications]
FROM [user_notifications] AS [u]
WHERE [u].[national_id] = @__request_NationalId_0
2025-02-06 15:13:49.430 +03:00 [INF] Executed DbCommand (59ms) [Parameters=[@__Parse_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [n].[Id], [n].[additional_data], [n].[big_picture_url], [n].[Body], [n].[body_ar], [n].[body_en], [n].[created_at], [n].[expiry_at], [n].[large_icon_url], [n].[Route], [n].[target_criteria], [n].[Title], [n].[title_ar], [n].[title_en]
FROM [notification_templates] AS [n]
WHERE [n].[Id] = @__Parse_0
2025-02-06 15:13:50.173 +03:00 [INF] Executed DbCommand (22ms) [Parameters=[@__Parse_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [n].[Id], [n].[additional_data], [n].[big_picture_url], [n].[Body], [n].[body_ar], [n].[body_en], [n].[created_at], [n].[expiry_at], [n].[large_icon_url], [n].[Route], [n].[target_criteria], [n].[Title], [n].[title_ar], [n].[title_en]
FROM [notification_templates] AS [n]
WHERE [n].[Id] = @__Parse_0
2025-02-06 15:13:50.683 +03:00 [INF] Executed DbCommand (5ms) [Parameters=[@__Parse_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [n].[Id], [n].[additional_data], [n].[big_picture_url], [n].[Body], [n].[body_ar], [n].[body_en], [n].[created_at], [n].[expiry_at], [n].[large_icon_url], [n].[Route], [n].[target_criteria], [n].[Title], [n].[title_ar], [n].[title_en]
FROM [notification_templates] AS [n]
WHERE [n].[Id] = @__Parse_0
2025-02-06 15:13:50.709 +03:00 [INF] Executed DbCommand (17ms) [Parameters=[@__Parse_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [n].[Id], [n].[additional_data], [n].[big_picture_url], [n].[Body], [n].[body_ar], [n].[body_en], [n].[created_at], [n].[expiry_at], [n].[large_icon_url], [n].[Route], [n].[target_criteria], [n].[Title], [n].[title_ar], [n].[title_en]
FROM [notification_templates] AS [n]
WHERE [n].[Id] = @__Parse_0
2025-02-06 15:13:50.844 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@__Parse_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [n].[Id], [n].[additional_data], [n].[big_picture_url], [n].[Body], [n].[body_ar], [n].[body_en], [n].[created_at], [n].[expiry_at], [n].[large_icon_url], [n].[Route], [n].[target_criteria], [n].[Title], [n].[title_ar], [n].[title_en]
FROM [notification_templates] AS [n]
WHERE [n].[Id] = @__Parse_0
2025-02-06 15:13:50.850 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@__Parse_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [n].[Id], [n].[additional_data], [n].[big_picture_url], [n].[Body], [n].[body_ar], [n].[body_en], [n].[created_at], [n].[expiry_at], [n].[large_icon_url], [n].[Route], [n].[target_criteria], [n].[Title], [n].[title_ar], [n].[title_en]
FROM [notification_templates] AS [n]
WHERE [n].[Id] = @__Parse_0
2025-02-06 15:13:50.859 +03:00 [INF] Executed DbCommand (5ms) [Parameters=[@__Parse_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [n].[Id], [n].[additional_data], [n].[big_picture_url], [n].[Body], [n].[body_ar], [n].[body_en], [n].[created_at], [n].[expiry_at], [n].[large_icon_url], [n].[Route], [n].[target_criteria], [n].[Title], [n].[title_ar], [n].[title_en]
FROM [notification_templates] AS [n]
WHERE [n].[Id] = @__Parse_0
2025-02-06 15:13:50.864 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@__Parse_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [n].[Id], [n].[additional_data], [n].[big_picture_url], [n].[Body], [n].[body_ar], [n].[body_en], [n].[created_at], [n].[expiry_at], [n].[large_icon_url], [n].[Route], [n].[target_criteria], [n].[Title], [n].[title_ar], [n].[title_en]
FROM [notification_templates] AS [n]
WHERE [n].[Id] = @__Parse_0
2025-02-06 15:13:50.870 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@__Parse_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [n].[Id], [n].[additional_data], [n].[big_picture_url], [n].[Body], [n].[body_ar], [n].[body_en], [n].[created_at], [n].[expiry_at], [n].[large_icon_url], [n].[Route], [n].[target_criteria], [n].[Title], [n].[title_ar], [n].[title_en]
FROM [notification_templates] AS [n]
WHERE [n].[Id] = @__Parse_0
2025-02-06 15:13:50.875 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@__Parse_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [n].[Id], [n].[additional_data], [n].[big_picture_url], [n].[Body], [n].[body_ar], [n].[body_en], [n].[created_at], [n].[expiry_at], [n].[large_icon_url], [n].[Route], [n].[target_criteria], [n].[Title], [n].[title_ar], [n].[title_en]
FROM [notification_templates] AS [n]
WHERE [n].[Id] = @__Parse_0
2025-02-06 15:13:50.880 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@__Parse_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [n].[Id], [n].[additional_data], [n].[big_picture_url], [n].[Body], [n].[body_ar], [n].[body_en], [n].[created_at], [n].[expiry_at], [n].[large_icon_url], [n].[Route], [n].[target_criteria], [n].[Title], [n].[title_ar], [n].[title_en]
FROM [notification_templates] AS [n]
WHERE [n].[Id] = @__Parse_0
2025-02-06 15:13:50.886 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@__Parse_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [n].[Id], [n].[additional_data], [n].[big_picture_url], [n].[Body], [n].[body_ar], [n].[body_en], [n].[created_at], [n].[expiry_at], [n].[large_icon_url], [n].[Route], [n].[target_criteria], [n].[Title], [n].[title_ar], [n].[title_en]
FROM [notification_templates] AS [n]
WHERE [n].[Id] = @__Parse_0
2025-02-06 15:13:50.891 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@__Parse_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [n].[Id], [n].[additional_data], [n].[big_picture_url], [n].[Body], [n].[body_ar], [n].[body_en], [n].[created_at], [n].[expiry_at], [n].[large_icon_url], [n].[Route], [n].[target_criteria], [n].[Title], [n].[title_ar], [n].[title_en]
FROM [notification_templates] AS [n]
WHERE [n].[Id] = @__Parse_0
2025-02-06 15:13:50.896 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@__Parse_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [n].[Id], [n].[additional_data], [n].[big_picture_url], [n].[Body], [n].[body_ar], [n].[body_en], [n].[created_at], [n].[expiry_at], [n].[large_icon_url], [n].[Route], [n].[target_criteria], [n].[Title], [n].[title_ar], [n].[title_en]
FROM [notification_templates] AS [n]
WHERE [n].[Id] = @__Parse_0
2025-02-06 15:13:50.903 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@__Parse_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [n].[Id], [n].[additional_data], [n].[big_picture_url], [n].[Body], [n].[body_ar], [n].[body_en], [n].[created_at], [n].[expiry_at], [n].[large_icon_url], [n].[Route], [n].[target_criteria], [n].[Title], [n].[title_ar], [n].[title_en]
FROM [notification_templates] AS [n]
WHERE [n].[Id] = @__Parse_0
2025-02-06 15:13:50.911 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@__Parse_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [n].[Id], [n].[additional_data], [n].[big_picture_url], [n].[Body], [n].[body_ar], [n].[body_en], [n].[created_at], [n].[expiry_at], [n].[large_icon_url], [n].[Route], [n].[target_criteria], [n].[Title], [n].[title_ar], [n].[title_en]
FROM [notification_templates] AS [n]
WHERE [n].[Id] = @__Parse_0
2025-02-06 15:13:50.917 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@__Parse_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [n].[Id], [n].[additional_data], [n].[big_picture_url], [n].[Body], [n].[body_ar], [n].[body_en], [n].[created_at], [n].[expiry_at], [n].[large_icon_url], [n].[Route], [n].[target_criteria], [n].[Title], [n].[title_ar], [n].[title_en]
FROM [notification_templates] AS [n]
WHERE [n].[Id] = @__Parse_0
2025-02-06 15:13:50.923 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@__Parse_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [n].[Id], [n].[additional_data], [n].[big_picture_url], [n].[Body], [n].[body_ar], [n].[body_en], [n].[created_at], [n].[expiry_at], [n].[large_icon_url], [n].[Route], [n].[target_criteria], [n].[Title], [n].[title_ar], [n].[title_en]
FROM [notification_templates] AS [n]
WHERE [n].[Id] = @__Parse_0
2025-02-06 15:13:50.931 +03:00 [INF] Executed DbCommand (2ms) [Parameters=[@__Parse_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [n].[Id], [n].[additional_data], [n].[big_picture_url], [n].[Body], [n].[body_ar], [n].[body_en], [n].[created_at], [n].[expiry_at], [n].[large_icon_url], [n].[Route], [n].[target_criteria], [n].[Title], [n].[title_ar], [n].[title_en]
FROM [notification_templates] AS [n]
WHERE [n].[Id] = @__Parse_0
2025-02-06 15:13:50.958 +03:00 [INF] Executed DbCommand (4ms) [Parameters=[@__Parse_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [n].[Id], [n].[additional_data], [n].[big_picture_url], [n].[Body], [n].[body_ar], [n].[body_en], [n].[created_at], [n].[expiry_at], [n].[large_icon_url], [n].[Route], [n].[target_criteria], [n].[Title], [n].[title_ar], [n].[title_en]
FROM [notification_templates] AS [n]
WHERE [n].[Id] = @__Parse_0
2025-02-06 15:13:50.978 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@__Parse_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [n].[Id], [n].[additional_data], [n].[big_picture_url], [n].[Body], [n].[body_ar], [n].[body_en], [n].[created_at], [n].[expiry_at], [n].[large_icon_url], [n].[Route], [n].[target_criteria], [n].[Title], [n].[title_ar], [n].[title_en]
FROM [notification_templates] AS [n]
WHERE [n].[Id] = @__Parse_0
2025-02-06 15:13:51.025 +03:00 [INF] Executed DbCommand (29ms) [Parameters=[@p0='?' (Size = 4000), @p1='?' (DbType = DateTime2), @p2='?' (Size = 4000), @p3='?' (Size = 4000), @p4='?' (Size = 4000), @p5='?' (Size = 450), @p6='?' (Size = 4000), @p7='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SET IMPLICIT_TRANSACTIONS OFF;
SET NOCOUNT ON;
INSERT INTO [AuthLogs] ([AuthType], [CreatedAt], [DeviceId], [FailureReason], [IpAddress], [NationalId], [Status], [UserAgent])
OUTPUT INSERTED.[Id]
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7);
2025-02-06 15:13:51.032 +03:00 [ERR] An exception occurred in the database while saving changes for context type 'NayifatAPI.Data.ApplicationDbContext'.
Microsoft.EntityFrameworkCore.DbUpdateException: An error occurred while saving the entity changes. See the inner exception for details.
 ---> Microsoft.Data.SqlClient.SqlException (0x80131904): The INSERT statement conflicted with the FOREIGN KEY constraint "FK_AuthLogs_Customers_NationalId". The conflict occurred in database "NayifatApp", table "dbo.Customers", column 'NationalId'.
   at Microsoft.Data.SqlClient.SqlConnection.OnError(SqlException exception, Boolean breakConnection, Action`1 wrapCloseInAction)
   at Microsoft.Data.SqlClient.SqlInternalConnection.OnError(SqlException exception, Boolean breakConnection, Action`1 wrapCloseInAction)
   at Microsoft.Data.SqlClient.TdsParser.ThrowExceptionAndWarning(TdsParserStateObject stateObj, Boolean callerHasConnectionLock, Boolean asyncClose)
   at Microsoft.Data.SqlClient.TdsParser.TryRun(RunBehavior runBehavior, SqlCommand cmdHandler, SqlDataReader dataStream, BulkCopySimpleResultSet bulkCopyHandler, TdsParserStateObject stateObj, Boolean& dataReady)
   at Microsoft.Data.SqlClient.SqlDataReader.TryHasMoreRows(Boolean& moreRows)
   at Microsoft.Data.SqlClient.SqlDataReader.TryReadInternal(Boolean setTimeout, Boolean& more)
   at Microsoft.Data.SqlClient.SqlDataReader.ReadAsyncExecute(Task task, Object state)
   at Microsoft.Data.SqlClient.SqlDataReader.InvokeAsyncCall[T](SqlDataReaderBaseAsyncCallContext`1 context)
--- End of stack trace from previous location ---
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeResultSetAsync(Int32 startCommandIndex, RelationalDataReader reader, CancellationToken cancellationToken)
ClientConnectionId:d05da912-74c2-43ca-9c27-77b1375a080c
Error Number:547,State:0,Class:16
   --- End of inner exception stack trace ---
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeResultSetAsync(Int32 startCommandIndex, RelationalDataReader reader, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeAsync(RelationalDataReader reader, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Update.Internal.SqlServerModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(IList`1 entriesToSave, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(StateManager stateManager, Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Storage.Internal.SqlServerExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
Microsoft.EntityFrameworkCore.DbUpdateException: An error occurred while saving the entity changes. See the inner exception for details.
 ---> Microsoft.Data.SqlClient.SqlException (0x80131904): The INSERT statement conflicted with the FOREIGN KEY constraint "FK_AuthLogs_Customers_NationalId". The conflict occurred in database "NayifatApp", table "dbo.Customers", column 'NationalId'.
   at Microsoft.Data.SqlClient.SqlConnection.OnError(SqlException exception, Boolean breakConnection, Action`1 wrapCloseInAction)
   at Microsoft.Data.SqlClient.SqlInternalConnection.OnError(SqlException exception, Boolean breakConnection, Action`1 wrapCloseInAction)
   at Microsoft.Data.SqlClient.TdsParser.ThrowExceptionAndWarning(TdsParserStateObject stateObj, Boolean callerHasConnectionLock, Boolean asyncClose)
   at Microsoft.Data.SqlClient.TdsParser.TryRun(RunBehavior runBehavior, SqlCommand cmdHandler, SqlDataReader dataStream, BulkCopySimpleResultSet bulkCopyHandler, TdsParserStateObject stateObj, Boolean& dataReady)
   at Microsoft.Data.SqlClient.SqlDataReader.TryHasMoreRows(Boolean& moreRows)
   at Microsoft.Data.SqlClient.SqlDataReader.TryReadInternal(Boolean setTimeout, Boolean& more)
   at Microsoft.Data.SqlClient.SqlDataReader.ReadAsyncExecute(Task task, Object state)
   at Microsoft.Data.SqlClient.SqlDataReader.InvokeAsyncCall[T](SqlDataReaderBaseAsyncCallContext`1 context)
--- End of stack trace from previous location ---
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeResultSetAsync(Int32 startCommandIndex, RelationalDataReader reader, CancellationToken cancellationToken)
ClientConnectionId:d05da912-74c2-43ca-9c27-77b1375a080c
Error Number:547,State:0,Class:16
   --- End of inner exception stack trace ---
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeResultSetAsync(Int32 startCommandIndex, RelationalDataReader reader, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeAsync(RelationalDataReader reader, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Update.Internal.SqlServerModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(IList`1 entriesToSave, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(StateManager stateManager, Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Storage.Internal.SqlServerExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
2025-02-06 15:13:51.620 +03:00 [ERR] Error logging audit event. NationalId: all, Action: notification_delivered, Details: {"notification_count":21,"notification_ids":[38,37,36,35,34,33,32,31,30,29,28,27,26,25,24,23,23,20,19,18,12],"timestamp":"2025-02-06T15:13:49.3697013"}
Microsoft.EntityFrameworkCore.DbUpdateException: An error occurred while saving the entity changes. See the inner exception for details.
 ---> Microsoft.Data.SqlClient.SqlException (0x80131904): The INSERT statement conflicted with the FOREIGN KEY constraint "FK_AuthLogs_Customers_NationalId". The conflict occurred in database "NayifatApp", table "dbo.Customers", column 'NationalId'.
   at Microsoft.Data.SqlClient.SqlConnection.OnError(SqlException exception, Boolean breakConnection, Action`1 wrapCloseInAction)
   at Microsoft.Data.SqlClient.SqlInternalConnection.OnError(SqlException exception, Boolean breakConnection, Action`1 wrapCloseInAction)
   at Microsoft.Data.SqlClient.TdsParser.ThrowExceptionAndWarning(TdsParserStateObject stateObj, Boolean callerHasConnectionLock, Boolean asyncClose)
   at Microsoft.Data.SqlClient.TdsParser.TryRun(RunBehavior runBehavior, SqlCommand cmdHandler, SqlDataReader dataStream, BulkCopySimpleResultSet bulkCopyHandler, TdsParserStateObject stateObj, Boolean& dataReady)
   at Microsoft.Data.SqlClient.SqlDataReader.TryHasMoreRows(Boolean& moreRows)
   at Microsoft.Data.SqlClient.SqlDataReader.TryReadInternal(Boolean setTimeout, Boolean& more)
   at Microsoft.Data.SqlClient.SqlDataReader.ReadAsyncExecute(Task task, Object state)
   at Microsoft.Data.SqlClient.SqlDataReader.InvokeAsyncCall[T](SqlDataReaderBaseAsyncCallContext`1 context)
--- End of stack trace from previous location ---
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeResultSetAsync(Int32 startCommandIndex, RelationalDataReader reader, CancellationToken cancellationToken)
ClientConnectionId:d05da912-74c2-43ca-9c27-77b1375a080c
Error Number:547,State:0,Class:16
   --- End of inner exception stack trace ---
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeResultSetAsync(Int32 startCommandIndex, RelationalDataReader reader, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeAsync(RelationalDataReader reader, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Update.Internal.SqlServerModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(IList`1 entriesToSave, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(StateManager stateManager, Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Storage.Internal.SqlServerExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at NayifatAPI.Services.AuditLogService.LogAsync(String nationalId, String action, Object details) in C:\Users\yamta\StudioProjects\nayifat_app_2025_new\NayifatAPI\Services\AuditLogService.cs:line 36
2025-02-06 15:13:51.653 +03:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType11`2[[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Object, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-02-06 15:13:51.672 +03:00 [INF] Executed action NayifatAPI.Controllers.NotificationsController.GetNotifications (NayifatAPI) in 2780.9019ms
2025-02-06 15:13:51.682 +03:00 [INF] Executed endpoint 'NayifatAPI.Controllers.NotificationsController.GetNotifications (NayifatAPI)'
2025-02-06 15:13:51.684 +03:00 [INF] Request finished HTTP/1.1 POST http://eb3c-46-152-255-232.ngrok-free.app/api/notifications/list - 200 null application/json; charset=utf-8 4176.6258ms
2025-02-06 15:16:08.978 +03:00 [INF] Request starting HTTP/1.1 POST http://eb3c-46-152-255-232.ngrok-free.app/api/content/timestamps - application/json; charset=utf-8 2
2025-02-06 15:16:08.996 +03:00 [INF] Executing endpoint 'NayifatAPI.Controllers.ContentController.GetTimestamps (NayifatAPI)'
2025-02-06 15:16:09.002 +03:00 [INF] Route matched with {action = "GetTimestamps", controller = "Content"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetTimestamps() on controller NayifatAPI.Controllers.ContentController (NayifatAPI).
2025-02-06 15:16:09.007 +03:00 [INF] TTT_
2025-02-06 15:16:09.008 +03:00 [INF] TTT_=== Getting Content Timestamps ===
2025-02-06 15:16:09.049 +03:00 [INF] Executed DbCommand (36ms) [Parameters=[@__providedApiKey_0='?' (Size = 255)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [a].[api_Key], [a].[CreatedAt], [a].[Description], [a].[ExpiresAt], [a].[IsActive], [a].[LastUsedAt]
FROM [ApiKeys] AS [a]
WHERE [a].[api_Key] = @__providedApiKey_0 AND [a].[IsActive] = CAST(1 AS bit)
2025-02-06 15:16:09.051 +03:00 [INF] TTT_Fetching timestamps from database
2025-02-06 15:16:09.058 +03:00 [INF] Executed DbCommand (6ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT [m].[page] AS [Page], [m].[key_name] AS [KeyName], [m].[last_updated] AS [LastUpdated]
FROM [master_config] AS [m]
2025-02-06 15:16:09.060 +03:00 [INF] TTT_Found 18 content items
2025-02-06 15:16:09.061 +03:00 [INF] TTT_Page: home
2025-02-06 15:16:09.062 +03:00 [INF] TTT_  - slideshow_content: "2025-02-05T13:56:06.9430000"
2025-02-06 15:16:09.062 +03:00 [INF] TTT_  - slideshow_content_ar: "2025-02-05T14:22:06.9430000"
2025-02-06 15:16:09.063 +03:00 [INF] TTT_  - contact_details: "2025-02-05T15:43:06.9430000"
2025-02-06 15:16:09.065 +03:00 [INF] TTT_  - contact_details_ar: "2025-02-05T14:06:06.9430000"
2025-02-06 15:16:09.066 +03:00 [INF] TTT_  - termsEN1: "2025-02-03T14:23:58.0000000"
2025-02-06 15:16:09.067 +03:00 [INF] TTT_  - termsEN2: "2025-02-03T14:25:20.1730000"
2025-02-06 15:16:09.067 +03:00 [INF] TTT_  - privacyEN1: "2025-02-03T14:26:08.6130000"
2025-02-06 15:16:09.068 +03:00 [INF] TTT_  - privacyEN2: "2025-02-03T14:25:20.1730000"
2025-02-06 15:16:09.069 +03:00 [INF] TTT_  - termsAR1: "2025-02-03T14:23:58.0000000"
2025-02-06 15:16:09.070 +03:00 [INF] TTT_  - termsAR2: "2025-02-03T14:25:20.1730000"
2025-02-06 15:16:09.071 +03:00 [INF] TTT_  - privacyAR1: "2025-02-03T14:26:08.6130000"
2025-02-06 15:16:09.071 +03:00 [INF] TTT_  - privacyAR2: "2025-02-03T14:25:20.1730000"
2025-02-06 15:16:09.073 +03:00 [INF] TTT_  - terms&conditionsCC_AR: "2025-02-03T17:06:57.7700000"
2025-02-06 15:16:09.074 +03:00 [INF] TTT_  - terms&conditionsCC_EN: "2025-02-03T17:07:47.4900000"
2025-02-06 15:16:09.074 +03:00 [INF] TTT_  - terms&conditionsPF_AR: "2025-02-03T17:06:57.7700000"
2025-02-06 15:16:09.075 +03:00 [INF] TTT_  - terms&conditionsPF_EN: "2025-02-03T17:06:57.7700000"
2025-02-06 15:16:09.076 +03:00 [INF] TTT_Page: loans
2025-02-06 15:16:09.077 +03:00 [INF] TTT_  - loan_ad: "2025-02-05T13:56:06.9430000"
2025-02-06 15:16:09.078 +03:00 [INF] TTT_Page: cards
2025-02-06 15:16:09.078 +03:00 [INF] TTT_  - card_ad: "2025-02-05T15:43:06.9430000"
2025-02-06 15:16:09.079 +03:00 [INF] TTT_Successfully retrieved all timestamps
2025-02-06 15:16:09.080 +03:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType11`2[[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Object, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-02-06 15:16:09.082 +03:00 [INF] Executed action NayifatAPI.Controllers.ContentController.GetTimestamps (NayifatAPI) in 76.1712ms
2025-02-06 15:16:09.083 +03:00 [INF] Executed endpoint 'NayifatAPI.Controllers.ContentController.GetTimestamps (NayifatAPI)'
2025-02-06 15:16:09.085 +03:00 [INF] Request finished HTTP/1.1 POST http://eb3c-46-152-255-232.ngrok-free.app/api/content/timestamps - 200 null application/json; charset=utf-8 107.1531ms
2025-02-06 17:33:14.660 +03:00 [INF] Request starting HTTP/1.1 POST http://eb3c-46-152-255-232.ngrok-free.app/api/content/timestamps - application/json; charset=utf-8 2
2025-02-06 17:33:14.664 +03:00 [INF] Executing endpoint 'NayifatAPI.Controllers.ContentController.GetTimestamps (NayifatAPI)'
2025-02-06 17:33:14.665 +03:00 [INF] Route matched with {action = "GetTimestamps", controller = "Content"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetTimestamps() on controller NayifatAPI.Controllers.ContentController (NayifatAPI).
2025-02-06 17:33:14.668 +03:00 [INF] TTT_
2025-02-06 17:33:14.720 +03:00 [INF] TTT_=== Getting Content Timestamps ===
2025-02-06 17:33:14.910 +03:00 [INF] Executed DbCommand (35ms) [Parameters=[@__providedApiKey_0='?' (Size = 255)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [a].[api_Key], [a].[CreatedAt], [a].[Description], [a].[ExpiresAt], [a].[IsActive], [a].[LastUsedAt]
FROM [ApiKeys] AS [a]
WHERE [a].[api_Key] = @__providedApiKey_0 AND [a].[IsActive] = CAST(1 AS bit)
2025-02-06 17:33:15.152 +03:00 [INF] TTT_Fetching timestamps from database
2025-02-06 17:33:15.281 +03:00 [INF] Executed DbCommand (40ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT [m].[page] AS [Page], [m].[key_name] AS [KeyName], [m].[last_updated] AS [LastUpdated]
FROM [master_config] AS [m]
2025-02-06 17:33:15.375 +03:00 [INF] TTT_Found 18 content items
2025-02-06 17:33:15.377 +03:00 [INF] TTT_Page: home
2025-02-06 17:33:15.378 +03:00 [INF] TTT_  - slideshow_content: "2025-02-05T13:56:06.9430000"
2025-02-06 17:33:15.487 +03:00 [INF] TTT_  - slideshow_content_ar: "2025-02-05T14:22:06.9430000"
2025-02-06 17:33:15.500 +03:00 [INF] TTT_  - contact_details: "2025-02-05T15:43:06.9430000"
2025-02-06 17:33:15.505 +03:00 [INF] TTT_  - contact_details_ar: "2025-02-05T14:06:06.9430000"
2025-02-06 17:33:15.516 +03:00 [INF] TTT_  - termsEN1: "2025-02-03T14:23:58.0000000"
2025-02-06 17:33:15.550 +03:00 [INF] TTT_  - termsEN2: "2025-02-03T14:25:20.1730000"
2025-02-06 17:33:15.674 +03:00 [INF] TTT_  - privacyEN1: "2025-02-03T14:26:08.6130000"
2025-02-06 17:33:15.679 +03:00 [INF] TTT_  - privacyEN2: "2025-02-03T14:25:20.1730000"
2025-02-06 17:33:15.721 +03:00 [INF] TTT_  - termsAR1: "2025-02-03T14:23:58.0000000"
2025-02-06 17:33:15.743 +03:00 [INF] TTT_  - termsAR2: "2025-02-03T14:25:20.1730000"
2025-02-06 17:33:15.747 +03:00 [INF] TTT_  - privacyAR1: "2025-02-03T14:26:08.6130000"
2025-02-06 17:33:15.749 +03:00 [INF] TTT_  - privacyAR2: "2025-02-03T14:25:20.1730000"
2025-02-06 17:33:15.760 +03:00 [INF] TTT_  - terms&conditionsCC_AR: "2025-02-03T17:06:57.7700000"
2025-02-06 17:33:15.763 +03:00 [INF] TTT_  - terms&conditionsCC_EN: "2025-02-03T17:07:47.4900000"
2025-02-06 17:33:15.765 +03:00 [INF] TTT_  - terms&conditionsPF_AR: "2025-02-03T17:06:57.7700000"
2025-02-06 17:33:15.766 +03:00 [INF] TTT_  - terms&conditionsPF_EN: "2025-02-03T17:06:57.7700000"
2025-02-06 17:33:15.768 +03:00 [INF] TTT_Page: loans
2025-02-06 17:33:15.774 +03:00 [INF] TTT_  - loan_ad: "2025-02-05T13:56:06.9430000"
2025-02-06 17:33:15.780 +03:00 [INF] TTT_Page: cards
2025-02-06 17:33:15.786 +03:00 [INF] TTT_  - card_ad: "2025-02-05T15:43:06.9430000"
2025-02-06 17:33:15.793 +03:00 [INF] TTT_Successfully retrieved all timestamps
2025-02-06 17:33:15.803 +03:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType11`2[[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Object, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-02-06 17:33:15.805 +03:00 [INF] Executed action NayifatAPI.Controllers.ContentController.GetTimestamps (NayifatAPI) in 1138.2174ms
2025-02-06 17:33:15.807 +03:00 [INF] Executed endpoint 'NayifatAPI.Controllers.ContentController.GetTimestamps (NayifatAPI)'
2025-02-06 17:33:15.819 +03:00 [INF] Request finished HTTP/1.1 POST http://eb3c-46-152-255-232.ngrok-free.app/api/content/timestamps - 200 null application/json; charset=utf-8 1158.9374ms
2025-02-06 17:34:24.025 +03:00 [INF] Request starting HTTP/1.1 POST http://eb3c-46-152-255-232.ngrok-free.app/api/notifications/list - application/json 39
2025-02-06 17:34:24.032 +03:00 [INF] Executing endpoint 'NayifatAPI.Controllers.NotificationsController.GetNotifications (NayifatAPI)'
2025-02-06 17:34:24.036 +03:00 [INF] Route matched with {action = "GetNotifications", controller = "Notifications"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetNotifications(NayifatAPI.Controllers.GetNotificationsRequest) on controller NayifatAPI.Controllers.NotificationsController (NayifatAPI).
2025-02-06 17:34:24.144 +03:00 [INF] Executed DbCommand (92ms) [Parameters=[@__providedApiKey_0='?' (Size = 255)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [a].[api_Key], [a].[CreatedAt], [a].[Description], [a].[ExpiresAt], [a].[IsActive], [a].[LastUsedAt]
FROM [ApiKeys] AS [a]
WHERE [a].[api_Key] = @__providedApiKey_0 AND [a].[IsActive] = CAST(1 AS bit)
2025-02-06 17:34:24.159 +03:00 [INF] Executed DbCommand (9ms) [Parameters=[@__request_NationalId_0='?' (Size = 450)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [u].[national_id], [u].[last_updated], [u].[notifications]
FROM [user_notifications] AS [u]
WHERE [u].[national_id] = @__request_NationalId_0
2025-02-06 17:34:24.184 +03:00 [INF] Executed DbCommand (13ms) [Parameters=[@__Parse_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [n].[Id], [n].[additional_data], [n].[big_picture_url], [n].[Body], [n].[body_ar], [n].[body_en], [n].[created_at], [n].[expiry_at], [n].[large_icon_url], [n].[Route], [n].[target_criteria], [n].[Title], [n].[title_ar], [n].[title_en]
FROM [notification_templates] AS [n]
WHERE [n].[Id] = @__Parse_0
2025-02-06 17:34:24.190 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@__Parse_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [n].[Id], [n].[additional_data], [n].[big_picture_url], [n].[Body], [n].[body_ar], [n].[body_en], [n].[created_at], [n].[expiry_at], [n].[large_icon_url], [n].[Route], [n].[target_criteria], [n].[Title], [n].[title_ar], [n].[title_en]
FROM [notification_templates] AS [n]
WHERE [n].[Id] = @__Parse_0
2025-02-06 17:34:24.197 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@__Parse_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [n].[Id], [n].[additional_data], [n].[big_picture_url], [n].[Body], [n].[body_ar], [n].[body_en], [n].[created_at], [n].[expiry_at], [n].[large_icon_url], [n].[Route], [n].[target_criteria], [n].[Title], [n].[title_ar], [n].[title_en]
FROM [notification_templates] AS [n]
WHERE [n].[Id] = @__Parse_0
2025-02-06 17:34:24.201 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@__Parse_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [n].[Id], [n].[additional_data], [n].[big_picture_url], [n].[Body], [n].[body_ar], [n].[body_en], [n].[created_at], [n].[expiry_at], [n].[large_icon_url], [n].[Route], [n].[target_criteria], [n].[Title], [n].[title_ar], [n].[title_en]
FROM [notification_templates] AS [n]
WHERE [n].[Id] = @__Parse_0
2025-02-06 17:34:24.208 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@__Parse_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [n].[Id], [n].[additional_data], [n].[big_picture_url], [n].[Body], [n].[body_ar], [n].[body_en], [n].[created_at], [n].[expiry_at], [n].[large_icon_url], [n].[Route], [n].[target_criteria], [n].[Title], [n].[title_ar], [n].[title_en]
FROM [notification_templates] AS [n]
WHERE [n].[Id] = @__Parse_0
2025-02-06 17:34:24.215 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@__Parse_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [n].[Id], [n].[additional_data], [n].[big_picture_url], [n].[Body], [n].[body_ar], [n].[body_en], [n].[created_at], [n].[expiry_at], [n].[large_icon_url], [n].[Route], [n].[target_criteria], [n].[Title], [n].[title_ar], [n].[title_en]
FROM [notification_templates] AS [n]
WHERE [n].[Id] = @__Parse_0
2025-02-06 17:34:24.220 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@__Parse_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [n].[Id], [n].[additional_data], [n].[big_picture_url], [n].[Body], [n].[body_ar], [n].[body_en], [n].[created_at], [n].[expiry_at], [n].[large_icon_url], [n].[Route], [n].[target_criteria], [n].[Title], [n].[title_ar], [n].[title_en]
FROM [notification_templates] AS [n]
WHERE [n].[Id] = @__Parse_0
2025-02-06 17:34:24.227 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@__Parse_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [n].[Id], [n].[additional_data], [n].[big_picture_url], [n].[Body], [n].[body_ar], [n].[body_en], [n].[created_at], [n].[expiry_at], [n].[large_icon_url], [n].[Route], [n].[target_criteria], [n].[Title], [n].[title_ar], [n].[title_en]
FROM [notification_templates] AS [n]
WHERE [n].[Id] = @__Parse_0
2025-02-06 17:34:24.233 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@__Parse_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [n].[Id], [n].[additional_data], [n].[big_picture_url], [n].[Body], [n].[body_ar], [n].[body_en], [n].[created_at], [n].[expiry_at], [n].[large_icon_url], [n].[Route], [n].[target_criteria], [n].[Title], [n].[title_ar], [n].[title_en]
FROM [notification_templates] AS [n]
WHERE [n].[Id] = @__Parse_0
2025-02-06 17:34:24.239 +03:00 [INF] Executed DbCommand (2ms) [Parameters=[@__Parse_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [n].[Id], [n].[additional_data], [n].[big_picture_url], [n].[Body], [n].[body_ar], [n].[body_en], [n].[created_at], [n].[expiry_at], [n].[large_icon_url], [n].[Route], [n].[target_criteria], [n].[Title], [n].[title_ar], [n].[title_en]
FROM [notification_templates] AS [n]
WHERE [n].[Id] = @__Parse_0
2025-02-06 17:34:24.244 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@__Parse_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [n].[Id], [n].[additional_data], [n].[big_picture_url], [n].[Body], [n].[body_ar], [n].[body_en], [n].[created_at], [n].[expiry_at], [n].[large_icon_url], [n].[Route], [n].[target_criteria], [n].[Title], [n].[title_ar], [n].[title_en]
FROM [notification_templates] AS [n]
WHERE [n].[Id] = @__Parse_0
2025-02-06 17:34:24.253 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@__Parse_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [n].[Id], [n].[additional_data], [n].[big_picture_url], [n].[Body], [n].[body_ar], [n].[body_en], [n].[created_at], [n].[expiry_at], [n].[large_icon_url], [n].[Route], [n].[target_criteria], [n].[Title], [n].[title_ar], [n].[title_en]
FROM [notification_templates] AS [n]
WHERE [n].[Id] = @__Parse_0
2025-02-06 17:34:24.267 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@__Parse_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [n].[Id], [n].[additional_data], [n].[big_picture_url], [n].[Body], [n].[body_ar], [n].[body_en], [n].[created_at], [n].[expiry_at], [n].[large_icon_url], [n].[Route], [n].[target_criteria], [n].[Title], [n].[title_ar], [n].[title_en]
FROM [notification_templates] AS [n]
WHERE [n].[Id] = @__Parse_0
2025-02-06 17:34:24.280 +03:00 [INF] Executed DbCommand (5ms) [Parameters=[@__Parse_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [n].[Id], [n].[additional_data], [n].[big_picture_url], [n].[Body], [n].[body_ar], [n].[body_en], [n].[created_at], [n].[expiry_at], [n].[large_icon_url], [n].[Route], [n].[target_criteria], [n].[Title], [n].[title_ar], [n].[title_en]
FROM [notification_templates] AS [n]
WHERE [n].[Id] = @__Parse_0
2025-02-06 17:34:24.291 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@__Parse_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [n].[Id], [n].[additional_data], [n].[big_picture_url], [n].[Body], [n].[body_ar], [n].[body_en], [n].[created_at], [n].[expiry_at], [n].[large_icon_url], [n].[Route], [n].[target_criteria], [n].[Title], [n].[title_ar], [n].[title_en]
FROM [notification_templates] AS [n]
WHERE [n].[Id] = @__Parse_0
2025-02-06 17:34:24.302 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@__Parse_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [n].[Id], [n].[additional_data], [n].[big_picture_url], [n].[Body], [n].[body_ar], [n].[body_en], [n].[created_at], [n].[expiry_at], [n].[large_icon_url], [n].[Route], [n].[target_criteria], [n].[Title], [n].[title_ar], [n].[title_en]
FROM [notification_templates] AS [n]
WHERE [n].[Id] = @__Parse_0
2025-02-06 17:34:24.309 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@__Parse_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [n].[Id], [n].[additional_data], [n].[big_picture_url], [n].[Body], [n].[body_ar], [n].[body_en], [n].[created_at], [n].[expiry_at], [n].[large_icon_url], [n].[Route], [n].[target_criteria], [n].[Title], [n].[title_ar], [n].[title_en]
FROM [notification_templates] AS [n]
WHERE [n].[Id] = @__Parse_0
2025-02-06 17:34:24.319 +03:00 [INF] Executed DbCommand (2ms) [Parameters=[@__Parse_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [n].[Id], [n].[additional_data], [n].[big_picture_url], [n].[Body], [n].[body_ar], [n].[body_en], [n].[created_at], [n].[expiry_at], [n].[large_icon_url], [n].[Route], [n].[target_criteria], [n].[Title], [n].[title_ar], [n].[title_en]
FROM [notification_templates] AS [n]
WHERE [n].[Id] = @__Parse_0
2025-02-06 17:34:24.332 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@__Parse_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [n].[Id], [n].[additional_data], [n].[big_picture_url], [n].[Body], [n].[body_ar], [n].[body_en], [n].[created_at], [n].[expiry_at], [n].[large_icon_url], [n].[Route], [n].[target_criteria], [n].[Title], [n].[title_ar], [n].[title_en]
FROM [notification_templates] AS [n]
WHERE [n].[Id] = @__Parse_0
2025-02-06 17:34:24.343 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@__Parse_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [n].[Id], [n].[additional_data], [n].[big_picture_url], [n].[Body], [n].[body_ar], [n].[body_en], [n].[created_at], [n].[expiry_at], [n].[large_icon_url], [n].[Route], [n].[target_criteria], [n].[Title], [n].[title_ar], [n].[title_en]
FROM [notification_templates] AS [n]
WHERE [n].[Id] = @__Parse_0
2025-02-06 17:34:24.356 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@__Parse_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [n].[Id], [n].[additional_data], [n].[big_picture_url], [n].[Body], [n].[body_ar], [n].[body_en], [n].[created_at], [n].[expiry_at], [n].[large_icon_url], [n].[Route], [n].[target_criteria], [n].[Title], [n].[title_ar], [n].[title_en]
FROM [notification_templates] AS [n]
WHERE [n].[Id] = @__Parse_0
2025-02-06 17:34:24.485 +03:00 [INF] Executed DbCommand (107ms) [Parameters=[@p0='?' (Size = 4000), @p1='?' (DbType = DateTime2), @p2='?' (Size = 4000), @p3='?' (Size = 4000), @p4='?' (Size = 4000), @p5='?' (Size = 450), @p6='?' (Size = 4000), @p7='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SET IMPLICIT_TRANSACTIONS OFF;
SET NOCOUNT ON;
INSERT INTO [AuthLogs] ([AuthType], [CreatedAt], [DeviceId], [FailureReason], [IpAddress], [NationalId], [Status], [UserAgent])
OUTPUT INSERTED.[Id]
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7);
2025-02-06 17:34:24.513 +03:00 [ERR] An exception occurred in the database while saving changes for context type 'NayifatAPI.Data.ApplicationDbContext'.
Microsoft.EntityFrameworkCore.DbUpdateException: An error occurred while saving the entity changes. See the inner exception for details.
 ---> Microsoft.Data.SqlClient.SqlException (0x80131904): The INSERT statement conflicted with the FOREIGN KEY constraint "FK_AuthLogs_Customers_NationalId". The conflict occurred in database "NayifatApp", table "dbo.Customers", column 'NationalId'.
   at Microsoft.Data.SqlClient.SqlConnection.OnError(SqlException exception, Boolean breakConnection, Action`1 wrapCloseInAction)
   at Microsoft.Data.SqlClient.SqlInternalConnection.OnError(SqlException exception, Boolean breakConnection, Action`1 wrapCloseInAction)
   at Microsoft.Data.SqlClient.TdsParser.ThrowExceptionAndWarning(TdsParserStateObject stateObj, Boolean callerHasConnectionLock, Boolean asyncClose)
   at Microsoft.Data.SqlClient.TdsParser.TryRun(RunBehavior runBehavior, SqlCommand cmdHandler, SqlDataReader dataStream, BulkCopySimpleResultSet bulkCopyHandler, TdsParserStateObject stateObj, Boolean& dataReady)
   at Microsoft.Data.SqlClient.SqlDataReader.TryHasMoreRows(Boolean& moreRows)
   at Microsoft.Data.SqlClient.SqlDataReader.TryReadInternal(Boolean setTimeout, Boolean& more)
   at Microsoft.Data.SqlClient.SqlDataReader.ReadAsyncExecute(Task task, Object state)
   at Microsoft.Data.SqlClient.SqlDataReader.InvokeAsyncCall[T](SqlDataReaderBaseAsyncCallContext`1 context)
--- End of stack trace from previous location ---
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeResultSetAsync(Int32 startCommandIndex, RelationalDataReader reader, CancellationToken cancellationToken)
ClientConnectionId:5a7c9a24-abaa-40f1-b5b7-6cbf9d0bf44e
Error Number:547,State:0,Class:16
   --- End of inner exception stack trace ---
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeResultSetAsync(Int32 startCommandIndex, RelationalDataReader reader, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeAsync(RelationalDataReader reader, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Update.Internal.SqlServerModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(IList`1 entriesToSave, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(StateManager stateManager, Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Storage.Internal.SqlServerExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
Microsoft.EntityFrameworkCore.DbUpdateException: An error occurred while saving the entity changes. See the inner exception for details.
 ---> Microsoft.Data.SqlClient.SqlException (0x80131904): The INSERT statement conflicted with the FOREIGN KEY constraint "FK_AuthLogs_Customers_NationalId". The conflict occurred in database "NayifatApp", table "dbo.Customers", column 'NationalId'.
   at Microsoft.Data.SqlClient.SqlConnection.OnError(SqlException exception, Boolean breakConnection, Action`1 wrapCloseInAction)
   at Microsoft.Data.SqlClient.SqlInternalConnection.OnError(SqlException exception, Boolean breakConnection, Action`1 wrapCloseInAction)
   at Microsoft.Data.SqlClient.TdsParser.ThrowExceptionAndWarning(TdsParserStateObject stateObj, Boolean callerHasConnectionLock, Boolean asyncClose)
   at Microsoft.Data.SqlClient.TdsParser.TryRun(RunBehavior runBehavior, SqlCommand cmdHandler, SqlDataReader dataStream, BulkCopySimpleResultSet bulkCopyHandler, TdsParserStateObject stateObj, Boolean& dataReady)
   at Microsoft.Data.SqlClient.SqlDataReader.TryHasMoreRows(Boolean& moreRows)
   at Microsoft.Data.SqlClient.SqlDataReader.TryReadInternal(Boolean setTimeout, Boolean& more)
   at Microsoft.Data.SqlClient.SqlDataReader.ReadAsyncExecute(Task task, Object state)
   at Microsoft.Data.SqlClient.SqlDataReader.InvokeAsyncCall[T](SqlDataReaderBaseAsyncCallContext`1 context)
--- End of stack trace from previous location ---
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeResultSetAsync(Int32 startCommandIndex, RelationalDataReader reader, CancellationToken cancellationToken)
ClientConnectionId:5a7c9a24-abaa-40f1-b5b7-6cbf9d0bf44e
Error Number:547,State:0,Class:16
   --- End of inner exception stack trace ---
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeResultSetAsync(Int32 startCommandIndex, RelationalDataReader reader, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeAsync(RelationalDataReader reader, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Update.Internal.SqlServerModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(IList`1 entriesToSave, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(StateManager stateManager, Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Storage.Internal.SqlServerExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
2025-02-06 17:34:24.550 +03:00 [ERR] Error logging audit event. NationalId: all, Action: notification_delivered, Details: {"notification_count":21,"notification_ids":[38,37,36,35,34,33,32,31,30,29,28,27,26,25,24,23,23,20,19,18,12],"timestamp":"2025-02-06T17:34:24.166391"}
Microsoft.EntityFrameworkCore.DbUpdateException: An error occurred while saving the entity changes. See the inner exception for details.
 ---> Microsoft.Data.SqlClient.SqlException (0x80131904): The INSERT statement conflicted with the FOREIGN KEY constraint "FK_AuthLogs_Customers_NationalId". The conflict occurred in database "NayifatApp", table "dbo.Customers", column 'NationalId'.
   at Microsoft.Data.SqlClient.SqlConnection.OnError(SqlException exception, Boolean breakConnection, Action`1 wrapCloseInAction)
   at Microsoft.Data.SqlClient.SqlInternalConnection.OnError(SqlException exception, Boolean breakConnection, Action`1 wrapCloseInAction)
   at Microsoft.Data.SqlClient.TdsParser.ThrowExceptionAndWarning(TdsParserStateObject stateObj, Boolean callerHasConnectionLock, Boolean asyncClose)
   at Microsoft.Data.SqlClient.TdsParser.TryRun(RunBehavior runBehavior, SqlCommand cmdHandler, SqlDataReader dataStream, BulkCopySimpleResultSet bulkCopyHandler, TdsParserStateObject stateObj, Boolean& dataReady)
   at Microsoft.Data.SqlClient.SqlDataReader.TryHasMoreRows(Boolean& moreRows)
   at Microsoft.Data.SqlClient.SqlDataReader.TryReadInternal(Boolean setTimeout, Boolean& more)
   at Microsoft.Data.SqlClient.SqlDataReader.ReadAsyncExecute(Task task, Object state)
   at Microsoft.Data.SqlClient.SqlDataReader.InvokeAsyncCall[T](SqlDataReaderBaseAsyncCallContext`1 context)
--- End of stack trace from previous location ---
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeResultSetAsync(Int32 startCommandIndex, RelationalDataReader reader, CancellationToken cancellationToken)
ClientConnectionId:5a7c9a24-abaa-40f1-b5b7-6cbf9d0bf44e
Error Number:547,State:0,Class:16
   --- End of inner exception stack trace ---
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeResultSetAsync(Int32 startCommandIndex, RelationalDataReader reader, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeAsync(RelationalDataReader reader, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Update.Internal.SqlServerModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(IList`1 entriesToSave, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(StateManager stateManager, Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Storage.Internal.SqlServerExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at NayifatAPI.Services.AuditLogService.LogAsync(String nationalId, String action, Object details) in C:\Users\yamta\StudioProjects\nayifat_app_2025_new\NayifatAPI\Services\AuditLogService.cs:line 36
2025-02-06 17:34:24.573 +03:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType11`2[[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Object, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-02-06 17:34:24.581 +03:00 [INF] Executed action NayifatAPI.Controllers.NotificationsController.GetNotifications (NayifatAPI) in 543.0146ms
2025-02-06 17:34:24.602 +03:00 [INF] Executed endpoint 'NayifatAPI.Controllers.NotificationsController.GetNotifications (NayifatAPI)'
2025-02-06 17:34:24.636 +03:00 [INF] Request finished HTTP/1.1 POST http://eb3c-46-152-255-232.ngrok-free.app/api/notifications/list - 200 null application/json; charset=utf-8 610.8878ms
2025-02-06 17:34:25.008 +03:00 [INF] Request starting HTTP/1.1 POST http://eb3c-46-152-255-232.ngrok-free.app/api/notifications/list - application/json 45
2025-02-06 17:34:25.012 +03:00 [INF] Executing endpoint 'NayifatAPI.Controllers.NotificationsController.GetNotifications (NayifatAPI)'
2025-02-06 17:34:25.014 +03:00 [INF] Route matched with {action = "GetNotifications", controller = "Notifications"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetNotifications(NayifatAPI.Controllers.GetNotificationsRequest) on controller NayifatAPI.Controllers.NotificationsController (NayifatAPI).
2025-02-06 17:34:25.026 +03:00 [INF] Executed DbCommand (6ms) [Parameters=[@__providedApiKey_0='?' (Size = 255)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [a].[api_Key], [a].[CreatedAt], [a].[Description], [a].[ExpiresAt], [a].[IsActive], [a].[LastUsedAt]
FROM [ApiKeys] AS [a]
WHERE [a].[api_Key] = @__providedApiKey_0 AND [a].[IsActive] = CAST(1 AS bit)
2025-02-06 17:34:25.043 +03:00 [INF] Executed DbCommand (10ms) [Parameters=[@__request_NationalId_0='?' (Size = 450)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [u].[national_id], [u].[last_updated], [u].[notifications]
FROM [user_notifications] AS [u]
WHERE [u].[national_id] = @__request_NationalId_0
2025-02-06 17:34:25.050 +03:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType11`2[[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Object, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-02-06 17:34:25.052 +03:00 [INF] Executed action NayifatAPI.Controllers.NotificationsController.GetNotifications (NayifatAPI) in 34.3042ms
2025-02-06 17:34:25.059 +03:00 [INF] Executed endpoint 'NayifatAPI.Controllers.NotificationsController.GetNotifications (NayifatAPI)'
2025-02-06 17:34:25.067 +03:00 [INF] Request finished HTTP/1.1 POST http://eb3c-46-152-255-232.ngrok-free.app/api/notifications/list - 200 null application/json; charset=utf-8 59.2353ms
