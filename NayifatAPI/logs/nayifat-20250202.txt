2025-02-02 00:00:09.255 +03:00 [INF] Request starting HTTP/1.1 POST http://957c-51-252-155-185.ngrok-free.app/api/Registration/register - application/json 993
2025-02-02 00:00:09.271 +03:00 [INF] Executing endpoint 'NayifatAPI.Controllers.RegistrationController.Register (NayifatAPI)'
2025-02-02 00:00:09.496 +03:00 [INF] Route matched with {action = "Register", controller = "Registration"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] Register(System.Object) on controller NayifatAPI.Controllers.RegistrationController (NayifatAPI).
2025-02-02 00:00:09.663 +03:00 [INF] Executed DbCommand (143ms) [Parameters=[@__providedApiKey_0='?' (Size = 255)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [a].[Key], [a].[CreatedAt], [a].[Description], [a].[ExpiresAt], [a].[IsActive], [a].[LastUsedAt]
FROM [ApiKeys] AS [a]
WHERE [a].[Key] = @__providedApiKey_0 AND [a].[IsActive] = CAST(1 AS bit)
2025-02-02 00:00:09.668 +03:00 [ERR] Error during registration for National ID: null
System.Text.Json.JsonException: JSON deserialization for type 'NayifatAPI.Controllers.IdCheckRequest' was missing required properties, including the following: DeviceInfo
   at System.Text.Json.ThrowHelper.ThrowJsonException_JsonRequiredPropertyMissing(JsonTypeInfo parent, BitArray requiredPropertiesSet)
   at System.Text.Json.Serialization.Converters.ObjectDefaultConverter`1.OnTryRead(Utf8JsonReader& reader, Type typeToConvert, JsonSerializerOptions options, ReadStack& state, T& value)
   at System.Text.Json.Serialization.JsonConverter`1.TryRead(Utf8JsonReader& reader, Type typeToConvert, JsonSerializerOptions options, ReadStack& state, T& value, Boolean& isPopulatedValue)
   at System.Text.Json.Serialization.JsonConverter`1.ReadCore(Utf8JsonReader& reader, JsonSerializerOptions options, ReadStack& state)
   at System.Text.Json.JsonSerializer.ReadFromSpan[TValue](ReadOnlySpan`1 utf8Json, JsonTypeInfo`1 jsonTypeInfo, Nullable`1 actualByteCount)
   at System.Text.Json.JsonSerializer.ReadFromSpan[TValue](ReadOnlySpan`1 json, JsonTypeInfo`1 jsonTypeInfo)
   at System.Text.Json.JsonSerializer.Deserialize[TValue](String json, JsonSerializerOptions options)
   at NayifatAPI.Controllers.RegistrationController.Register(Object request) in C:\Users\yamta\StudioProjects\nayifat_app_2025_new\nayifatapi\Controllers\RegistrationController.cs:line 52
2025-02-02 00:00:09.677 +03:00 [INF] Executing ObjectResult, writing value of type '<>f__AnonymousType11`2[[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-02-02 00:00:09.681 +03:00 [INF] Executed action NayifatAPI.Controllers.RegistrationController.Register (NayifatAPI) in 181.0077ms
2025-02-02 00:00:09.683 +03:00 [INF] Executed endpoint 'NayifatAPI.Controllers.RegistrationController.Register (NayifatAPI)'
2025-02-02 00:00:09.684 +03:00 [INF] Request finished HTTP/1.1 POST http://957c-51-252-155-185.ngrok-free.app/api/Registration/register - 500 null application/json; charset=utf-8 429.4478ms
2025-02-02 00:02:05.211 +03:00 [INF] Request starting HTTP/1.1 POST http://957c-51-252-155-185.ngrok-free.app/api/Yakeen/getCitizenInfo/json - application/json; charset=utf-8 83
2025-02-02 00:02:05.214 +03:00 [INF] Executing endpoint 'NayifatAPI.Controllers.YakeenController.GetCitizenInfo (NayifatAPI)'
2025-02-02 00:02:05.215 +03:00 [INF] Route matched with {action = "GetCitizenInfo", controller = "Yakeen"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.ActionResult`1[NayifatAPI.Models.YakeenCitizenInfo]] GetCitizenInfo(CitizenInfoRequest) on controller NayifatAPI.Controllers.YakeenController (NayifatAPI).
2025-02-02 00:02:05.225 +03:00 [INF] Executed DbCommand (7ms) [Parameters=[@__request_IqamaNumber_0='?' (Size = 50)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [y].[Id], [y].[DateOfBirth], [y].[DateOfBirthHijri], [y].[EnglishFirstName], [y].[EnglishLastName], [y].[EnglishSecondName], [y].[EnglishThirdName], [y].[FamilyName], [y].[FatherName], [y].[FirstName], [y].[Gender], [y].[GenderFieldSpecified], [y].[GrandFatherName], [y].[HifizaIssuePlace], [y].[HifizaNumber], [y].[IdExpiryDate], [y].[IdIssueDate], [y].[IdIssuePlace], [y].[IdVersionNumber], [y].[IqamaNumber], [y].[LogIdField], [y].[NumberOfVehiclesReg], [y].[OccupationCode], [y].[SocialStatusDetailedDesc], [y].[SubtribeName], [y].[TotalNumberOfCurrentDependents]
FROM [YakeenCitizenInfo] AS [y]
WHERE [y].[IqamaNumber] = @__request_IqamaNumber_0
2025-02-02 00:02:05.228 +03:00 [INF] Executing OkObjectResult, writing value of type 'NayifatAPI.Models.YakeenCitizenInfo'.
2025-02-02 00:02:05.229 +03:00 [INF] Executed action NayifatAPI.Controllers.YakeenController.GetCitizenInfo (NayifatAPI) in 13.1401ms
2025-02-02 00:02:05.230 +03:00 [INF] Executed endpoint 'NayifatAPI.Controllers.YakeenController.GetCitizenInfo (NayifatAPI)'
2025-02-02 00:02:05.231 +03:00 [INF] Request finished HTTP/1.1 POST http://957c-51-252-155-185.ngrok-free.app/api/Yakeen/getCitizenInfo/json - 200 null application/json; charset=utf-8 20.6008ms
2025-02-02 00:02:06.090 +03:00 [INF] Request starting HTTP/1.1 POST http://957c-51-252-155-185.ngrok-free.app/api/Registration/register - application/json; charset=utf-8 627
2025-02-02 00:02:06.092 +03:00 [INF] Executing endpoint 'NayifatAPI.Controllers.RegistrationController.Register (NayifatAPI)'
2025-02-02 00:02:06.101 +03:00 [INF] Route matched with {action = "Register", controller = "Registration"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] Register(System.Object) on controller NayifatAPI.Controllers.RegistrationController (NayifatAPI).
2025-02-02 00:02:06.106 +03:00 [INF] Executed DbCommand (2ms) [Parameters=[@__providedApiKey_0='?' (Size = 255)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [a].[Key], [a].[CreatedAt], [a].[Description], [a].[ExpiresAt], [a].[IsActive], [a].[LastUsedAt]
FROM [ApiKeys] AS [a]
WHERE [a].[Key] = @__providedApiKey_0 AND [a].[IsActive] = CAST(1 AS bit)
2025-02-02 00:02:06.146 +03:00 [INF] Executed DbCommand (29ms) [Parameters=[@__registrationRequest_NationalId_0='?' (Size = 450)], CommandType='"Text"', CommandTimeout='30']
SELECT CASE
    WHEN EXISTS (
        SELECT 1
        FROM [Customers] AS [c]
        WHERE [c].[NationalId] = @__registrationRequest_NationalId_0) THEN CAST(1 AS bit)
    ELSE CAST(0 AS bit)
END
2025-02-02 00:02:06.450 +03:00 [INF] Executed DbCommand (3ms) [Parameters=[@__registrationRequest_NationalId_0='?' (Size = 450)], CommandType='"Text"', CommandTimeout='30']
UPDATE [c]
SET [c].[LastUsedAt] = GETUTCDATE(),
    [c].[Status] = N'disabled'
FROM [Customer_Devices] AS [c]
WHERE [c].[NationalId] = @__registrationRequest_NationalId_0
2025-02-02 00:02:06.468 +03:00 [WRN] Savepoints are disabled because Multiple Active Result Sets (MARS) is enabled. If 'SaveChanges' fails, then the transaction cannot be automatically rolled back to a known clean state. Instead, the transaction should be rolled back by the application before retrying 'SaveChanges'. See https://go.microsoft.com/fwlink/?linkid=2149338 for more information and examples. To identify the code which triggers this warning, call 'ConfigureWarnings(w => w.Throw(SqlServerEventId.SavepointsDisabledBecauseOfMARS))'.
2025-02-02 00:02:06.535 +03:00 [ERR] Failed executing DbCommand (29ms) [Parameters=[@p0='?' (Size = 450), @p1='?' (Size = 4000), @p2='?' (Size = 4000), @p3='?' (Size = 4000), @p4='?' (DbType = Boolean), @p5='?' (DbType = DateTime2), @p6='?' (DbType = DateTime2), @p7='?' (DbType = Int32), @p8='?' (Size = 4000), @p9='?' (Size = 4000), @p10='?' (Size = 4000), @p11='?' (Size = 4000), @p12='?' (Size = 4000), @p13='?' (Size = 4000), @p14='?' (Size = 4000), @p15='?' (Size = 4000), @p16='?' (Size = 4000), @p17='?' (Size = 4000), @p18='?' (DbType = DateTime2), @p19='?' (Size = 4000), @p20='?' (DbType = Int32), @p21='?' (Size = 4000), @p22='?' (DbType = Boolean), @p23='?' (Size = 4000), @p24='?' (DbType = DateTime2), @p25='?' (Size = 4000), @p26='?' (Size = 4000), @p27='?' (DbType = DateTime2), @p28='?' (Precision = 18) (Scale = 2) (DbType = Decimal), @p29='?' (Precision = 18) (Scale = 2) (DbType = Decimal), @p30='?' (Precision = 18) (Scale = 2) (DbType = Decimal), @p31='?' (Size = 4000), @p32='?' (Size = 4000), @p33='?' (Size = 4000), @p34='?' (Size = 4000), @p35='?' (Size = 4000), @p36='?' (Size = 4000), @p37='?' (Size = 4000), @p38='?' (Size = 4000), @p39='?' (DbType = DateTime2), @p40='?' (Size = 4000), @p41='?' (Size = 4000), @p42='?' (Size = 4000), @p43='?' (Size = 450), @p44='?' (Size = 4000), @p45='?' (Size = 4000), @p46='?' (DbType = Boolean), @p47='?' (Size = 4000), @p48='?' (DbType = DateTime2), @p49='?' (Size = 450), @p50='?' (DbType = DateTime2), @p51='?' (Size = 4000), @p52='?' (Size = 4000), @p53='?' (Size = 450), @p54='?' (Size = 4000), @p55='?' (Size = 4000), @p56='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SET NOCOUNT ON;
INSERT INTO [Customers] ([NationalId], [AddNo], [BuildingNo], [City], [Consent], [ConsentDate], [DateOfBirth], [Dependents], [District], [Email], [Employer], [EmployerName], [EmploymentStatus], [FamilyNameAr], [FamilyNameEn], [FirstNameAr], [FirstNameEn], [Iban], [IdExpiryDate], [Language], [Los], [Mpin], [MpinEnabled], [NafathStatus], [NafathTimestamp], [Password], [Phone], [RegistrationDate], [Salary], [SalaryCustomer], [SalaryDakhli], [SecondNameAr], [SecondNameEn], [Sector], [Street], [ThirdNameAr], [ThirdNameEn], [Zipcode])
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7, @p8, @p9, @p10, @p11, @p12, @p13, @p14, @p15, @p16, @p17, @p18, @p19, @p20, @p21, @p22, @p23, @p24, @p25, @p26, @p27, @p28, @p29, @p30, @p31, @p32, @p33, @p34, @p35, @p36, @p37);
INSERT INTO [AuthLogs] ([AuthType], [CreatedAt], [DeviceId], [FailureReason], [IpAddress], [NationalId], [Status], [UserAgent])
OUTPUT INSERTED.[Id]
VALUES (@p38, @p39, @p40, @p41, @p42, @p43, @p44, @p45);
INSERT INTO [Customer_Devices] ([BiometricEnabled], [BiometricToken], [CreatedAt], [DeviceId], [LastUsedAt], [Manufacturer], [Model], [NationalId], [OsVersion], [Platform], [Status])
OUTPUT INSERTED.[Id]
VALUES (@p46, @p47, @p48, @p49, @p50, @p51, @p52, @p53, @p54, @p55, @p56);
2025-02-02 00:02:06.592 +03:00 [ERR] An exception occurred in the database while saving changes for context type 'NayifatAPI.Data.ApplicationDbContext'.
Microsoft.EntityFrameworkCore.DbUpdateException: An error occurred while saving the entity changes. See the inner exception for details.
 ---> Microsoft.Data.SqlClient.SqlException (0x80131904): Invalid column name 'EmployerName'.
Invalid column name 'EmploymentStatus'.
Invalid column name 'Language'.
Invalid column name 'Salary'.
   at Microsoft.Data.SqlClient.SqlCommand.<>c.<ExecuteDbDataReaderAsync>b__209_0(Task`1 result)
   at System.Threading.Tasks.ContinuationResultTaskFromResultTask`2.InnerInvoke()
   at System.Threading.ExecutionContext.RunInternal(ExecutionContext executionContext, ContextCallback callback, Object state)
--- End of stack trace from previous location ---
   at System.Threading.ExecutionContext.RunInternal(ExecutionContext executionContext, ContextCallback callback, Object state)
   at System.Threading.Tasks.Task.ExecuteWithThreadLocal(Task& currentTaskSlot, Thread threadPoolThread)
--- End of stack trace from previous location ---
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
ClientConnectionId:9fd3acb5-ab9a-445a-817a-3b4e9334ea92
Error Number:207,State:1,Class:16
   --- End of inner exception stack trace ---
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Update.Internal.SqlServerModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(IList`1 entriesToSave, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(StateManager stateManager, Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Storage.Internal.SqlServerExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
Microsoft.EntityFrameworkCore.DbUpdateException: An error occurred while saving the entity changes. See the inner exception for details.
 ---> Microsoft.Data.SqlClient.SqlException (0x80131904): Invalid column name 'EmployerName'.
Invalid column name 'EmploymentStatus'.
Invalid column name 'Language'.
Invalid column name 'Salary'.
   at Microsoft.Data.SqlClient.SqlCommand.<>c.<ExecuteDbDataReaderAsync>b__209_0(Task`1 result)
   at System.Threading.Tasks.ContinuationResultTaskFromResultTask`2.InnerInvoke()
   at System.Threading.ExecutionContext.RunInternal(ExecutionContext executionContext, ContextCallback callback, Object state)
--- End of stack trace from previous location ---
   at System.Threading.ExecutionContext.RunInternal(ExecutionContext executionContext, ContextCallback callback, Object state)
   at System.Threading.Tasks.Task.ExecuteWithThreadLocal(Task& currentTaskSlot, Thread threadPoolThread)
--- End of stack trace from previous location ---
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
ClientConnectionId:9fd3acb5-ab9a-445a-817a-3b4e9334ea92
Error Number:207,State:1,Class:16
   --- End of inner exception stack trace ---
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Update.Internal.SqlServerModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(IList`1 entriesToSave, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(StateManager stateManager, Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Storage.Internal.SqlServerExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
2025-02-02 00:02:06.864 +03:00 [ERR] Error during registration for National ID: 1064448614
Microsoft.EntityFrameworkCore.DbUpdateException: An error occurred while saving the entity changes. See the inner exception for details.
 ---> Microsoft.Data.SqlClient.SqlException (0x80131904): Invalid column name 'EmployerName'.
Invalid column name 'EmploymentStatus'.
Invalid column name 'Language'.
Invalid column name 'Salary'.
   at Microsoft.Data.SqlClient.SqlCommand.<>c.<ExecuteDbDataReaderAsync>b__209_0(Task`1 result)
   at System.Threading.Tasks.ContinuationResultTaskFromResultTask`2.InnerInvoke()
   at System.Threading.ExecutionContext.RunInternal(ExecutionContext executionContext, ContextCallback callback, Object state)
--- End of stack trace from previous location ---
   at System.Threading.ExecutionContext.RunInternal(ExecutionContext executionContext, ContextCallback callback, Object state)
   at System.Threading.Tasks.Task.ExecuteWithThreadLocal(Task& currentTaskSlot, Thread threadPoolThread)
--- End of stack trace from previous location ---
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
ClientConnectionId:9fd3acb5-ab9a-445a-817a-3b4e9334ea92
Error Number:207,State:1,Class:16
   --- End of inner exception stack trace ---
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Update.Internal.SqlServerModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(IList`1 entriesToSave, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(StateManager stateManager, Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Storage.Internal.SqlServerExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at NayifatAPI.Controllers.RegistrationController.Register(Object request) in C:\Users\yamta\StudioProjects\nayifat_app_2025_new\nayifatapi\Controllers\RegistrationController.cs:line 153
   at NayifatAPI.Controllers.RegistrationController.Register(Object request) in C:\Users\yamta\StudioProjects\nayifat_app_2025_new\nayifatapi\Controllers\RegistrationController.cs:line 190
2025-02-02 00:02:07.335 +03:00 [ERR] Failed executing DbCommand (43ms) [Parameters=[@p0='?' (Size = 450), @p1='?' (Size = 4000), @p2='?' (Size = 4000), @p3='?' (Size = 4000), @p4='?' (DbType = Boolean), @p5='?' (DbType = DateTime2), @p6='?' (DbType = DateTime2), @p7='?' (DbType = Int32), @p8='?' (Size = 4000), @p9='?' (Size = 4000), @p10='?' (Size = 4000), @p11='?' (Size = 4000), @p12='?' (Size = 4000), @p13='?' (Size = 4000), @p14='?' (Size = 4000), @p15='?' (Size = 4000), @p16='?' (Size = 4000), @p17='?' (Size = 4000), @p18='?' (DbType = DateTime2), @p19='?' (Size = 4000), @p20='?' (DbType = Int32), @p21='?' (Size = 4000), @p22='?' (DbType = Boolean), @p23='?' (Size = 4000), @p24='?' (DbType = DateTime2), @p25='?' (Size = 4000), @p26='?' (Size = 4000), @p27='?' (DbType = DateTime2), @p28='?' (Precision = 18) (Scale = 2) (DbType = Decimal), @p29='?' (Precision = 18) (Scale = 2) (DbType = Decimal), @p30='?' (Precision = 18) (Scale = 2) (DbType = Decimal), @p31='?' (Size = 4000), @p32='?' (Size = 4000), @p33='?' (Size = 4000), @p34='?' (Size = 4000), @p35='?' (Size = 4000), @p36='?' (Size = 4000), @p37='?' (Size = 4000), @p38='?' (Size = 4000), @p39='?' (DbType = DateTime2), @p40='?' (Size = 4000), @p41='?' (Size = 4000), @p42='?' (Size = 4000), @p43='?' (Size = 450), @p44='?' (Size = 4000), @p45='?' (Size = 4000), @p46='?' (Size = 4000), @p47='?' (DbType = DateTime2), @p48='?' (Size = 4000), @p49='?' (Size = 4000), @p50='?' (Size = 4000), @p51='?' (Size = 450), @p52='?' (Size = 4000), @p53='?' (Size = 4000), @p54='?' (DbType = Boolean), @p55='?' (Size = 4000), @p56='?' (DbType = DateTime2), @p57='?' (Size = 450), @p58='?' (DbType = DateTime2), @p59='?' (Size = 4000), @p60='?' (Size = 4000), @p61='?' (Size = 450), @p62='?' (Size = 4000), @p63='?' (Size = 4000), @p64='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SET NOCOUNT ON;
INSERT INTO [Customers] ([NationalId], [AddNo], [BuildingNo], [City], [Consent], [ConsentDate], [DateOfBirth], [Dependents], [District], [Email], [Employer], [EmployerName], [EmploymentStatus], [FamilyNameAr], [FamilyNameEn], [FirstNameAr], [FirstNameEn], [Iban], [IdExpiryDate], [Language], [Los], [Mpin], [MpinEnabled], [NafathStatus], [NafathTimestamp], [Password], [Phone], [RegistrationDate], [Salary], [SalaryCustomer], [SalaryDakhli], [SecondNameAr], [SecondNameEn], [Sector], [Street], [ThirdNameAr], [ThirdNameEn], [Zipcode])
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7, @p8, @p9, @p10, @p11, @p12, @p13, @p14, @p15, @p16, @p17, @p18, @p19, @p20, @p21, @p22, @p23, @p24, @p25, @p26, @p27, @p28, @p29, @p30, @p31, @p32, @p33, @p34, @p35, @p36, @p37);
MERGE [AuthLogs] USING (
VALUES (@p38, @p39, @p40, @p41, @p42, @p43, @p44, @p45, 0),
(@p46, @p47, @p48, @p49, @p50, @p51, @p52, @p53, 1)) AS i ([AuthType], [CreatedAt], [DeviceId], [FailureReason], [IpAddress], [NationalId], [Status], [UserAgent], _Position) ON 1=0
WHEN NOT MATCHED THEN
INSERT ([AuthType], [CreatedAt], [DeviceId], [FailureReason], [IpAddress], [NationalId], [Status], [UserAgent])
VALUES (i.[AuthType], i.[CreatedAt], i.[DeviceId], i.[FailureReason], i.[IpAddress], i.[NationalId], i.[Status], i.[UserAgent])
OUTPUT INSERTED.[Id], i._Position;
INSERT INTO [Customer_Devices] ([BiometricEnabled], [BiometricToken], [CreatedAt], [DeviceId], [LastUsedAt], [Manufacturer], [Model], [NationalId], [OsVersion], [Platform], [Status])
OUTPUT INSERTED.[Id]
VALUES (@p54, @p55, @p56, @p57, @p58, @p59, @p60, @p61, @p62, @p63, @p64);
2025-02-02 00:02:07.658 +03:00 [ERR] An exception occurred in the database while saving changes for context type 'NayifatAPI.Data.ApplicationDbContext'.
Microsoft.EntityFrameworkCore.DbUpdateException: An error occurred while saving the entity changes. See the inner exception for details.
 ---> Microsoft.Data.SqlClient.SqlException (0x80131904): Invalid column name 'EmployerName'.
Invalid column name 'EmploymentStatus'.
Invalid column name 'Language'.
Invalid column name 'Salary'.
   at Microsoft.Data.SqlClient.SqlCommand.<>c.<ExecuteDbDataReaderAsync>b__209_0(Task`1 result)
   at System.Threading.Tasks.ContinuationResultTaskFromResultTask`2.InnerInvoke()
   at System.Threading.ExecutionContext.RunInternal(ExecutionContext executionContext, ContextCallback callback, Object state)
--- End of stack trace from previous location ---
   at System.Threading.ExecutionContext.RunInternal(ExecutionContext executionContext, ContextCallback callback, Object state)
   at System.Threading.Tasks.Task.ExecuteWithThreadLocal(Task& currentTaskSlot, Thread threadPoolThread)
--- End of stack trace from previous location ---
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
ClientConnectionId:9fd3acb5-ab9a-445a-817a-3b4e9334ea92
Error Number:207,State:1,Class:16
   --- End of inner exception stack trace ---
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Update.Internal.SqlServerModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(IList`1 entriesToSave, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(StateManager stateManager, Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Storage.Internal.SqlServerExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
Microsoft.EntityFrameworkCore.DbUpdateException: An error occurred while saving the entity changes. See the inner exception for details.
 ---> Microsoft.Data.SqlClient.SqlException (0x80131904): Invalid column name 'EmployerName'.
Invalid column name 'EmploymentStatus'.
Invalid column name 'Language'.
Invalid column name 'Salary'.
   at Microsoft.Data.SqlClient.SqlCommand.<>c.<ExecuteDbDataReaderAsync>b__209_0(Task`1 result)
   at System.Threading.Tasks.ContinuationResultTaskFromResultTask`2.InnerInvoke()
   at System.Threading.ExecutionContext.RunInternal(ExecutionContext executionContext, ContextCallback callback, Object state)
--- End of stack trace from previous location ---
   at System.Threading.ExecutionContext.RunInternal(ExecutionContext executionContext, ContextCallback callback, Object state)
   at System.Threading.Tasks.Task.ExecuteWithThreadLocal(Task& currentTaskSlot, Thread threadPoolThread)
--- End of stack trace from previous location ---
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
ClientConnectionId:9fd3acb5-ab9a-445a-817a-3b4e9334ea92
Error Number:207,State:1,Class:16
   --- End of inner exception stack trace ---
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Update.Internal.SqlServerModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(IList`1 entriesToSave, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(StateManager stateManager, Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Storage.Internal.SqlServerExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
2025-02-02 00:02:08.066 +03:00 [INF] Executed action NayifatAPI.Controllers.RegistrationController.Register (NayifatAPI) in 1962.9532ms
2025-02-02 00:02:08.069 +03:00 [INF] Executed endpoint 'NayifatAPI.Controllers.RegistrationController.Register (NayifatAPI)'
2025-02-02 00:02:08.070 +03:00 [ERR] Unhandled exception
Microsoft.EntityFrameworkCore.DbUpdateException: An error occurred while saving the entity changes. See the inner exception for details.
 ---> Microsoft.Data.SqlClient.SqlException (0x80131904): Invalid column name 'EmployerName'.
Invalid column name 'EmploymentStatus'.
Invalid column name 'Language'.
Invalid column name 'Salary'.
   at Microsoft.Data.SqlClient.SqlCommand.<>c.<ExecuteDbDataReaderAsync>b__209_0(Task`1 result)
   at System.Threading.Tasks.ContinuationResultTaskFromResultTask`2.InnerInvoke()
   at System.Threading.ExecutionContext.RunInternal(ExecutionContext executionContext, ContextCallback callback, Object state)
--- End of stack trace from previous location ---
   at System.Threading.ExecutionContext.RunInternal(ExecutionContext executionContext, ContextCallback callback, Object state)
   at System.Threading.Tasks.Task.ExecuteWithThreadLocal(Task& currentTaskSlot, Thread threadPoolThread)
--- End of stack trace from previous location ---
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
ClientConnectionId:9fd3acb5-ab9a-445a-817a-3b4e9334ea92
Error Number:207,State:1,Class:16
   --- End of inner exception stack trace ---
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Update.Internal.SqlServerModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(IList`1 entriesToSave, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(StateManager stateManager, Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Storage.Internal.SqlServerExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at NayifatAPI.Controllers.RegistrationController.Register(Object request) in C:\Users\yamta\StudioProjects\nayifat_app_2025_new\nayifatapi\Controllers\RegistrationController.cs:line 213
   at Microsoft.AspNetCore.Mvc.Infrastructure.ActionMethodExecutor.TaskOfIActionResultExecutor.Execute(ActionContext actionContext, IActionResultTypeMapper mapper, ObjectMethodExecutor executor, Object controller, Object[] arguments)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.<InvokeActionMethodAsync>g__Awaited|12_0(ControllerActionInvoker invoker, ValueTask`1 actionResultValueTask)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.<InvokeNextActionFilterAsync>g__Awaited|10_0(ControllerActionInvoker invoker, Task lastTask, State next, Scope scope, Object state, Boolean isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.Rethrow(ActionExecutedContextSealed context)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.Next(State& next, Scope& scope, Object& state, Boolean& isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.<InvokeInnerFilterAsync>g__Awaited|13_0(ControllerActionInvoker invoker, Task lastTask, State next, Scope scope, Object state, Boolean isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeFilterPipelineAsync>g__Awaited|20_0(ResourceInvoker invoker, Task lastTask, State next, Scope scope, Object state, Boolean isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeAsync>g__Logged|17_1(ResourceInvoker invoker)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeAsync>g__Logged|17_1(ResourceInvoker invoker)
   at Microsoft.AspNetCore.Routing.EndpointMiddleware.<Invoke>g__AwaitRequestTask|7_0(Endpoint endpoint, Task requestTask, ILogger logger)
   at Microsoft.AspNetCore.Authorization.AuthorizationMiddleware.Invoke(HttpContext context)
   at Program.<>c.<<<Main>$>b__0_3>d.MoveNext() in C:\Users\yamta\StudioProjects\nayifat_app_2025_new\nayifatapi\Program.cs:line 85
2025-02-02 00:02:09.458 +03:00 [ERR] An unhandled exception has occurred while executing the request.
Microsoft.EntityFrameworkCore.DbUpdateException: An error occurred while saving the entity changes. See the inner exception for details.
 ---> Microsoft.Data.SqlClient.SqlException (0x80131904): Invalid column name 'EmployerName'.
Invalid column name 'EmploymentStatus'.
Invalid column name 'Language'.
Invalid column name 'Salary'.
   at Microsoft.Data.SqlClient.SqlCommand.<>c.<ExecuteDbDataReaderAsync>b__209_0(Task`1 result)
   at System.Threading.Tasks.ContinuationResultTaskFromResultTask`2.InnerInvoke()
   at System.Threading.ExecutionContext.RunInternal(ExecutionContext executionContext, ContextCallback callback, Object state)
--- End of stack trace from previous location ---
   at System.Threading.ExecutionContext.RunInternal(ExecutionContext executionContext, ContextCallback callback, Object state)
   at System.Threading.Tasks.Task.ExecuteWithThreadLocal(Task& currentTaskSlot, Thread threadPoolThread)
--- End of stack trace from previous location ---
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
ClientConnectionId:9fd3acb5-ab9a-445a-817a-3b4e9334ea92
Error Number:207,State:1,Class:16
   --- End of inner exception stack trace ---
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Update.Internal.SqlServerModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(IList`1 entriesToSave, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(StateManager stateManager, Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Storage.Internal.SqlServerExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at NayifatAPI.Controllers.RegistrationController.Register(Object request) in C:\Users\yamta\StudioProjects\nayifat_app_2025_new\nayifatapi\Controllers\RegistrationController.cs:line 213
   at Microsoft.AspNetCore.Mvc.Infrastructure.ActionMethodExecutor.TaskOfIActionResultExecutor.Execute(ActionContext actionContext, IActionResultTypeMapper mapper, ObjectMethodExecutor executor, Object controller, Object[] arguments)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.<InvokeActionMethodAsync>g__Awaited|12_0(ControllerActionInvoker invoker, ValueTask`1 actionResultValueTask)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.<InvokeNextActionFilterAsync>g__Awaited|10_0(ControllerActionInvoker invoker, Task lastTask, State next, Scope scope, Object state, Boolean isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.Rethrow(ActionExecutedContextSealed context)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.Next(State& next, Scope& scope, Object& state, Boolean& isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.<InvokeInnerFilterAsync>g__Awaited|13_0(ControllerActionInvoker invoker, Task lastTask, State next, Scope scope, Object state, Boolean isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeFilterPipelineAsync>g__Awaited|20_0(ResourceInvoker invoker, Task lastTask, State next, Scope scope, Object state, Boolean isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeAsync>g__Logged|17_1(ResourceInvoker invoker)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeAsync>g__Logged|17_1(ResourceInvoker invoker)
   at Microsoft.AspNetCore.Routing.EndpointMiddleware.<Invoke>g__AwaitRequestTask|7_0(Endpoint endpoint, Task requestTask, ILogger logger)
   at Microsoft.AspNetCore.Authorization.AuthorizationMiddleware.Invoke(HttpContext context)
   at Program.<>c.<<<Main>$>b__0_3>d.MoveNext() in C:\Users\yamta\StudioProjects\nayifat_app_2025_new\nayifatapi\Program.cs:line 85
--- End of stack trace from previous location ---
   at Swashbuckle.AspNetCore.SwaggerUI.SwaggerUIMiddleware.Invoke(HttpContext httpContext)
   at Swashbuckle.AspNetCore.Swagger.SwaggerMiddleware.Invoke(HttpContext httpContext, ISwaggerProvider swaggerProvider)
   at Microsoft.AspNetCore.Authentication.AuthenticationMiddleware.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Diagnostics.DeveloperExceptionPageMiddlewareImpl.Invoke(HttpContext context)
2025-02-02 00:02:09.487 +03:00 [INF] Request finished HTTP/1.1 POST http://957c-51-252-155-185.ngrok-free.app/api/Registration/register - 500 null text/plain; charset=utf-8 3396.7011ms
2025-02-02 00:02:11.910 +03:00 [INF] Request starting HTTP/1.1 POST http://957c-51-252-155-185.ngrok-free.app/api/Registration/register - application/json; charset=utf-8 627
2025-02-02 00:02:11.912 +03:00 [INF] Executing endpoint 'NayifatAPI.Controllers.RegistrationController.Register (NayifatAPI)'
2025-02-02 00:02:11.913 +03:00 [INF] Route matched with {action = "Register", controller = "Registration"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] Register(System.Object) on controller NayifatAPI.Controllers.RegistrationController (NayifatAPI).
2025-02-02 00:02:11.916 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@__providedApiKey_0='?' (Size = 255)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [a].[Key], [a].[CreatedAt], [a].[Description], [a].[ExpiresAt], [a].[IsActive], [a].[LastUsedAt]
FROM [ApiKeys] AS [a]
WHERE [a].[Key] = @__providedApiKey_0 AND [a].[IsActive] = CAST(1 AS bit)
2025-02-02 00:02:11.920 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@__registrationRequest_NationalId_0='?' (Size = 450)], CommandType='"Text"', CommandTimeout='30']
SELECT CASE
    WHEN EXISTS (
        SELECT 1
        FROM [Customers] AS [c]
        WHERE [c].[NationalId] = @__registrationRequest_NationalId_0) THEN CAST(1 AS bit)
    ELSE CAST(0 AS bit)
END
2025-02-02 00:02:12.123 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@__registrationRequest_NationalId_0='?' (Size = 450)], CommandType='"Text"', CommandTimeout='30']
UPDATE [c]
SET [c].[LastUsedAt] = GETUTCDATE(),
    [c].[Status] = N'disabled'
FROM [Customer_Devices] AS [c]
WHERE [c].[NationalId] = @__registrationRequest_NationalId_0
2025-02-02 00:02:12.125 +03:00 [WRN] Savepoints are disabled because Multiple Active Result Sets (MARS) is enabled. If 'SaveChanges' fails, then the transaction cannot be automatically rolled back to a known clean state. Instead, the transaction should be rolled back by the application before retrying 'SaveChanges'. See https://go.microsoft.com/fwlink/?linkid=2149338 for more information and examples. To identify the code which triggers this warning, call 'ConfigureWarnings(w => w.Throw(SqlServerEventId.SavepointsDisabledBecauseOfMARS))'.
2025-02-02 00:02:12.130 +03:00 [ERR] Failed executing DbCommand (2ms) [Parameters=[@p0='?' (Size = 450), @p1='?' (Size = 4000), @p2='?' (Size = 4000), @p3='?' (Size = 4000), @p4='?' (DbType = Boolean), @p5='?' (DbType = DateTime2), @p6='?' (DbType = DateTime2), @p7='?' (DbType = Int32), @p8='?' (Size = 4000), @p9='?' (Size = 4000), @p10='?' (Size = 4000), @p11='?' (Size = 4000), @p12='?' (Size = 4000), @p13='?' (Size = 4000), @p14='?' (Size = 4000), @p15='?' (Size = 4000), @p16='?' (Size = 4000), @p17='?' (Size = 4000), @p18='?' (DbType = DateTime2), @p19='?' (Size = 4000), @p20='?' (DbType = Int32), @p21='?' (Size = 4000), @p22='?' (DbType = Boolean), @p23='?' (Size = 4000), @p24='?' (DbType = DateTime2), @p25='?' (Size = 4000), @p26='?' (Size = 4000), @p27='?' (DbType = DateTime2), @p28='?' (Precision = 18) (Scale = 2) (DbType = Decimal), @p29='?' (Precision = 18) (Scale = 2) (DbType = Decimal), @p30='?' (Precision = 18) (Scale = 2) (DbType = Decimal), @p31='?' (Size = 4000), @p32='?' (Size = 4000), @p33='?' (Size = 4000), @p34='?' (Size = 4000), @p35='?' (Size = 4000), @p36='?' (Size = 4000), @p37='?' (Size = 4000), @p38='?' (Size = 4000), @p39='?' (DbType = DateTime2), @p40='?' (Size = 4000), @p41='?' (Size = 4000), @p42='?' (Size = 4000), @p43='?' (Size = 450), @p44='?' (Size = 4000), @p45='?' (Size = 4000), @p46='?' (DbType = Boolean), @p47='?' (Size = 4000), @p48='?' (DbType = DateTime2), @p49='?' (Size = 450), @p50='?' (DbType = DateTime2), @p51='?' (Size = 4000), @p52='?' (Size = 4000), @p53='?' (Size = 450), @p54='?' (Size = 4000), @p55='?' (Size = 4000), @p56='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SET NOCOUNT ON;
INSERT INTO [Customers] ([NationalId], [AddNo], [BuildingNo], [City], [Consent], [ConsentDate], [DateOfBirth], [Dependents], [District], [Email], [Employer], [EmployerName], [EmploymentStatus], [FamilyNameAr], [FamilyNameEn], [FirstNameAr], [FirstNameEn], [Iban], [IdExpiryDate], [Language], [Los], [Mpin], [MpinEnabled], [NafathStatus], [NafathTimestamp], [Password], [Phone], [RegistrationDate], [Salary], [SalaryCustomer], [SalaryDakhli], [SecondNameAr], [SecondNameEn], [Sector], [Street], [ThirdNameAr], [ThirdNameEn], [Zipcode])
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7, @p8, @p9, @p10, @p11, @p12, @p13, @p14, @p15, @p16, @p17, @p18, @p19, @p20, @p21, @p22, @p23, @p24, @p25, @p26, @p27, @p28, @p29, @p30, @p31, @p32, @p33, @p34, @p35, @p36, @p37);
INSERT INTO [AuthLogs] ([AuthType], [CreatedAt], [DeviceId], [FailureReason], [IpAddress], [NationalId], [Status], [UserAgent])
OUTPUT INSERTED.[Id]
VALUES (@p38, @p39, @p40, @p41, @p42, @p43, @p44, @p45);
INSERT INTO [Customer_Devices] ([BiometricEnabled], [BiometricToken], [CreatedAt], [DeviceId], [LastUsedAt], [Manufacturer], [Model], [NationalId], [OsVersion], [Platform], [Status])
OUTPUT INSERTED.[Id]
VALUES (@p46, @p47, @p48, @p49, @p50, @p51, @p52, @p53, @p54, @p55, @p56);
2025-02-02 00:02:12.135 +03:00 [ERR] An exception occurred in the database while saving changes for context type 'NayifatAPI.Data.ApplicationDbContext'.
Microsoft.EntityFrameworkCore.DbUpdateException: An error occurred while saving the entity changes. See the inner exception for details.
 ---> Microsoft.Data.SqlClient.SqlException (0x80131904): Invalid column name 'EmployerName'.
Invalid column name 'EmploymentStatus'.
Invalid column name 'Language'.
Invalid column name 'Salary'.
   at Microsoft.Data.SqlClient.SqlCommand.<>c.<ExecuteDbDataReaderAsync>b__209_0(Task`1 result)
   at System.Threading.Tasks.ContinuationResultTaskFromResultTask`2.InnerInvoke()
   at System.Threading.ExecutionContext.RunInternal(ExecutionContext executionContext, ContextCallback callback, Object state)
--- End of stack trace from previous location ---
   at System.Threading.ExecutionContext.RunInternal(ExecutionContext executionContext, ContextCallback callback, Object state)
   at System.Threading.Tasks.Task.ExecuteWithThreadLocal(Task& currentTaskSlot, Thread threadPoolThread)
--- End of stack trace from previous location ---
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
ClientConnectionId:9fd3acb5-ab9a-445a-817a-3b4e9334ea92
Error Number:207,State:1,Class:16
   --- End of inner exception stack trace ---
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Update.Internal.SqlServerModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(IList`1 entriesToSave, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(StateManager stateManager, Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Storage.Internal.SqlServerExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
Microsoft.EntityFrameworkCore.DbUpdateException: An error occurred while saving the entity changes. See the inner exception for details.
 ---> Microsoft.Data.SqlClient.SqlException (0x80131904): Invalid column name 'EmployerName'.
Invalid column name 'EmploymentStatus'.
Invalid column name 'Language'.
Invalid column name 'Salary'.
   at Microsoft.Data.SqlClient.SqlCommand.<>c.<ExecuteDbDataReaderAsync>b__209_0(Task`1 result)
   at System.Threading.Tasks.ContinuationResultTaskFromResultTask`2.InnerInvoke()
   at System.Threading.ExecutionContext.RunInternal(ExecutionContext executionContext, ContextCallback callback, Object state)
--- End of stack trace from previous location ---
   at System.Threading.ExecutionContext.RunInternal(ExecutionContext executionContext, ContextCallback callback, Object state)
   at System.Threading.Tasks.Task.ExecuteWithThreadLocal(Task& currentTaskSlot, Thread threadPoolThread)
--- End of stack trace from previous location ---
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
ClientConnectionId:9fd3acb5-ab9a-445a-817a-3b4e9334ea92
Error Number:207,State:1,Class:16
   --- End of inner exception stack trace ---
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Update.Internal.SqlServerModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(IList`1 entriesToSave, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(StateManager stateManager, Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Storage.Internal.SqlServerExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
2025-02-02 00:02:12.150 +03:00 [ERR] Error during registration for National ID: 1064448614
Microsoft.EntityFrameworkCore.DbUpdateException: An error occurred while saving the entity changes. See the inner exception for details.
 ---> Microsoft.Data.SqlClient.SqlException (0x80131904): Invalid column name 'EmployerName'.
Invalid column name 'EmploymentStatus'.
Invalid column name 'Language'.
Invalid column name 'Salary'.
   at Microsoft.Data.SqlClient.SqlCommand.<>c.<ExecuteDbDataReaderAsync>b__209_0(Task`1 result)
   at System.Threading.Tasks.ContinuationResultTaskFromResultTask`2.InnerInvoke()
   at System.Threading.ExecutionContext.RunInternal(ExecutionContext executionContext, ContextCallback callback, Object state)
--- End of stack trace from previous location ---
   at System.Threading.ExecutionContext.RunInternal(ExecutionContext executionContext, ContextCallback callback, Object state)
   at System.Threading.Tasks.Task.ExecuteWithThreadLocal(Task& currentTaskSlot, Thread threadPoolThread)
--- End of stack trace from previous location ---
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
ClientConnectionId:9fd3acb5-ab9a-445a-817a-3b4e9334ea92
Error Number:207,State:1,Class:16
   --- End of inner exception stack trace ---
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Update.Internal.SqlServerModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(IList`1 entriesToSave, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(StateManager stateManager, Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Storage.Internal.SqlServerExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at NayifatAPI.Controllers.RegistrationController.Register(Object request) in C:\Users\yamta\StudioProjects\nayifat_app_2025_new\nayifatapi\Controllers\RegistrationController.cs:line 153
   at NayifatAPI.Controllers.RegistrationController.Register(Object request) in C:\Users\yamta\StudioProjects\nayifat_app_2025_new\nayifatapi\Controllers\RegistrationController.cs:line 190
2025-02-02 00:02:12.171 +03:00 [ERR] Failed executing DbCommand (4ms) [Parameters=[@p0='?' (Size = 450), @p1='?' (Size = 4000), @p2='?' (Size = 4000), @p3='?' (Size = 4000), @p4='?' (DbType = Boolean), @p5='?' (DbType = DateTime2), @p6='?' (DbType = DateTime2), @p7='?' (DbType = Int32), @p8='?' (Size = 4000), @p9='?' (Size = 4000), @p10='?' (Size = 4000), @p11='?' (Size = 4000), @p12='?' (Size = 4000), @p13='?' (Size = 4000), @p14='?' (Size = 4000), @p15='?' (Size = 4000), @p16='?' (Size = 4000), @p17='?' (Size = 4000), @p18='?' (DbType = DateTime2), @p19='?' (Size = 4000), @p20='?' (DbType = Int32), @p21='?' (Size = 4000), @p22='?' (DbType = Boolean), @p23='?' (Size = 4000), @p24='?' (DbType = DateTime2), @p25='?' (Size = 4000), @p26='?' (Size = 4000), @p27='?' (DbType = DateTime2), @p28='?' (Precision = 18) (Scale = 2) (DbType = Decimal), @p29='?' (Precision = 18) (Scale = 2) (DbType = Decimal), @p30='?' (Precision = 18) (Scale = 2) (DbType = Decimal), @p31='?' (Size = 4000), @p32='?' (Size = 4000), @p33='?' (Size = 4000), @p34='?' (Size = 4000), @p35='?' (Size = 4000), @p36='?' (Size = 4000), @p37='?' (Size = 4000), @p38='?' (Size = 4000), @p39='?' (DbType = DateTime2), @p40='?' (Size = 4000), @p41='?' (Size = 4000), @p42='?' (Size = 4000), @p43='?' (Size = 450), @p44='?' (Size = 4000), @p45='?' (Size = 4000), @p46='?' (Size = 4000), @p47='?' (DbType = DateTime2), @p48='?' (Size = 4000), @p49='?' (Size = 4000), @p50='?' (Size = 4000), @p51='?' (Size = 450), @p52='?' (Size = 4000), @p53='?' (Size = 4000), @p54='?' (DbType = Boolean), @p55='?' (Size = 4000), @p56='?' (DbType = DateTime2), @p57='?' (Size = 450), @p58='?' (DbType = DateTime2), @p59='?' (Size = 4000), @p60='?' (Size = 4000), @p61='?' (Size = 450), @p62='?' (Size = 4000), @p63='?' (Size = 4000), @p64='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SET NOCOUNT ON;
INSERT INTO [Customers] ([NationalId], [AddNo], [BuildingNo], [City], [Consent], [ConsentDate], [DateOfBirth], [Dependents], [District], [Email], [Employer], [EmployerName], [EmploymentStatus], [FamilyNameAr], [FamilyNameEn], [FirstNameAr], [FirstNameEn], [Iban], [IdExpiryDate], [Language], [Los], [Mpin], [MpinEnabled], [NafathStatus], [NafathTimestamp], [Password], [Phone], [RegistrationDate], [Salary], [SalaryCustomer], [SalaryDakhli], [SecondNameAr], [SecondNameEn], [Sector], [Street], [ThirdNameAr], [ThirdNameEn], [Zipcode])
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7, @p8, @p9, @p10, @p11, @p12, @p13, @p14, @p15, @p16, @p17, @p18, @p19, @p20, @p21, @p22, @p23, @p24, @p25, @p26, @p27, @p28, @p29, @p30, @p31, @p32, @p33, @p34, @p35, @p36, @p37);
MERGE [AuthLogs] USING (
VALUES (@p38, @p39, @p40, @p41, @p42, @p43, @p44, @p45, 0),
(@p46, @p47, @p48, @p49, @p50, @p51, @p52, @p53, 1)) AS i ([AuthType], [CreatedAt], [DeviceId], [FailureReason], [IpAddress], [NationalId], [Status], [UserAgent], _Position) ON 1=0
WHEN NOT MATCHED THEN
INSERT ([AuthType], [CreatedAt], [DeviceId], [FailureReason], [IpAddress], [NationalId], [Status], [UserAgent])
VALUES (i.[AuthType], i.[CreatedAt], i.[DeviceId], i.[FailureReason], i.[IpAddress], i.[NationalId], i.[Status], i.[UserAgent])
OUTPUT INSERTED.[Id], i._Position;
INSERT INTO [Customer_Devices] ([BiometricEnabled], [BiometricToken], [CreatedAt], [DeviceId], [LastUsedAt], [Manufacturer], [Model], [NationalId], [OsVersion], [Platform], [Status])
OUTPUT INSERTED.[Id]
VALUES (@p54, @p55, @p56, @p57, @p58, @p59, @p60, @p61, @p62, @p63, @p64);
2025-02-02 00:02:12.181 +03:00 [ERR] An exception occurred in the database while saving changes for context type 'NayifatAPI.Data.ApplicationDbContext'.
Microsoft.EntityFrameworkCore.DbUpdateException: An error occurred while saving the entity changes. See the inner exception for details.
 ---> Microsoft.Data.SqlClient.SqlException (0x80131904): Invalid column name 'EmployerName'.
Invalid column name 'EmploymentStatus'.
Invalid column name 'Language'.
Invalid column name 'Salary'.
   at Microsoft.Data.SqlClient.SqlCommand.<>c.<ExecuteDbDataReaderAsync>b__209_0(Task`1 result)
   at System.Threading.Tasks.ContinuationResultTaskFromResultTask`2.InnerInvoke()
   at System.Threading.ExecutionContext.RunInternal(ExecutionContext executionContext, ContextCallback callback, Object state)
--- End of stack trace from previous location ---
   at System.Threading.ExecutionContext.RunInternal(ExecutionContext executionContext, ContextCallback callback, Object state)
   at System.Threading.Tasks.Task.ExecuteWithThreadLocal(Task& currentTaskSlot, Thread threadPoolThread)
--- End of stack trace from previous location ---
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
ClientConnectionId:9fd3acb5-ab9a-445a-817a-3b4e9334ea92
Error Number:207,State:1,Class:16
   --- End of inner exception stack trace ---
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Update.Internal.SqlServerModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(IList`1 entriesToSave, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(StateManager stateManager, Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Storage.Internal.SqlServerExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
Microsoft.EntityFrameworkCore.DbUpdateException: An error occurred while saving the entity changes. See the inner exception for details.
 ---> Microsoft.Data.SqlClient.SqlException (0x80131904): Invalid column name 'EmployerName'.
Invalid column name 'EmploymentStatus'.
Invalid column name 'Language'.
Invalid column name 'Salary'.
   at Microsoft.Data.SqlClient.SqlCommand.<>c.<ExecuteDbDataReaderAsync>b__209_0(Task`1 result)
   at System.Threading.Tasks.ContinuationResultTaskFromResultTask`2.InnerInvoke()
   at System.Threading.ExecutionContext.RunInternal(ExecutionContext executionContext, ContextCallback callback, Object state)
--- End of stack trace from previous location ---
   at System.Threading.ExecutionContext.RunInternal(ExecutionContext executionContext, ContextCallback callback, Object state)
   at System.Threading.Tasks.Task.ExecuteWithThreadLocal(Task& currentTaskSlot, Thread threadPoolThread)
--- End of stack trace from previous location ---
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
ClientConnectionId:9fd3acb5-ab9a-445a-817a-3b4e9334ea92
Error Number:207,State:1,Class:16
   --- End of inner exception stack trace ---
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Update.Internal.SqlServerModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(IList`1 entriesToSave, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(StateManager stateManager, Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Storage.Internal.SqlServerExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
2025-02-02 00:02:12.202 +03:00 [INF] Executed action NayifatAPI.Controllers.RegistrationController.Register (NayifatAPI) in 288.0546ms
2025-02-02 00:02:12.203 +03:00 [INF] Executed endpoint 'NayifatAPI.Controllers.RegistrationController.Register (NayifatAPI)'
2025-02-02 00:02:12.205 +03:00 [ERR] Unhandled exception
Microsoft.EntityFrameworkCore.DbUpdateException: An error occurred while saving the entity changes. See the inner exception for details.
 ---> Microsoft.Data.SqlClient.SqlException (0x80131904): Invalid column name 'EmployerName'.
Invalid column name 'EmploymentStatus'.
Invalid column name 'Language'.
Invalid column name 'Salary'.
   at Microsoft.Data.SqlClient.SqlCommand.<>c.<ExecuteDbDataReaderAsync>b__209_0(Task`1 result)
   at System.Threading.Tasks.ContinuationResultTaskFromResultTask`2.InnerInvoke()
   at System.Threading.ExecutionContext.RunInternal(ExecutionContext executionContext, ContextCallback callback, Object state)
--- End of stack trace from previous location ---
   at System.Threading.ExecutionContext.RunInternal(ExecutionContext executionContext, ContextCallback callback, Object state)
   at System.Threading.Tasks.Task.ExecuteWithThreadLocal(Task& currentTaskSlot, Thread threadPoolThread)
--- End of stack trace from previous location ---
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
ClientConnectionId:9fd3acb5-ab9a-445a-817a-3b4e9334ea92
Error Number:207,State:1,Class:16
   --- End of inner exception stack trace ---
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Update.Internal.SqlServerModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(IList`1 entriesToSave, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(StateManager stateManager, Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Storage.Internal.SqlServerExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at NayifatAPI.Controllers.RegistrationController.Register(Object request) in C:\Users\yamta\StudioProjects\nayifat_app_2025_new\nayifatapi\Controllers\RegistrationController.cs:line 213
   at Microsoft.AspNetCore.Mvc.Infrastructure.ActionMethodExecutor.TaskOfIActionResultExecutor.Execute(ActionContext actionContext, IActionResultTypeMapper mapper, ObjectMethodExecutor executor, Object controller, Object[] arguments)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.<InvokeActionMethodAsync>g__Awaited|12_0(ControllerActionInvoker invoker, ValueTask`1 actionResultValueTask)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.<InvokeNextActionFilterAsync>g__Awaited|10_0(ControllerActionInvoker invoker, Task lastTask, State next, Scope scope, Object state, Boolean isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.Rethrow(ActionExecutedContextSealed context)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.Next(State& next, Scope& scope, Object& state, Boolean& isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.<InvokeInnerFilterAsync>g__Awaited|13_0(ControllerActionInvoker invoker, Task lastTask, State next, Scope scope, Object state, Boolean isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeFilterPipelineAsync>g__Awaited|20_0(ResourceInvoker invoker, Task lastTask, State next, Scope scope, Object state, Boolean isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeAsync>g__Logged|17_1(ResourceInvoker invoker)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeAsync>g__Logged|17_1(ResourceInvoker invoker)
   at Microsoft.AspNetCore.Routing.EndpointMiddleware.<Invoke>g__AwaitRequestTask|7_0(Endpoint endpoint, Task requestTask, ILogger logger)
   at Microsoft.AspNetCore.Authorization.AuthorizationMiddleware.Invoke(HttpContext context)
   at Program.<>c.<<<Main>$>b__0_3>d.MoveNext() in C:\Users\yamta\StudioProjects\nayifat_app_2025_new\nayifatapi\Program.cs:line 85
2025-02-02 00:02:12.223 +03:00 [ERR] An unhandled exception has occurred while executing the request.
Microsoft.EntityFrameworkCore.DbUpdateException: An error occurred while saving the entity changes. See the inner exception for details.
 ---> Microsoft.Data.SqlClient.SqlException (0x80131904): Invalid column name 'EmployerName'.
Invalid column name 'EmploymentStatus'.
Invalid column name 'Language'.
Invalid column name 'Salary'.
   at Microsoft.Data.SqlClient.SqlCommand.<>c.<ExecuteDbDataReaderAsync>b__209_0(Task`1 result)
   at System.Threading.Tasks.ContinuationResultTaskFromResultTask`2.InnerInvoke()
   at System.Threading.ExecutionContext.RunInternal(ExecutionContext executionContext, ContextCallback callback, Object state)
--- End of stack trace from previous location ---
   at System.Threading.ExecutionContext.RunInternal(ExecutionContext executionContext, ContextCallback callback, Object state)
   at System.Threading.Tasks.Task.ExecuteWithThreadLocal(Task& currentTaskSlot, Thread threadPoolThread)
--- End of stack trace from previous location ---
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
ClientConnectionId:9fd3acb5-ab9a-445a-817a-3b4e9334ea92
Error Number:207,State:1,Class:16
   --- End of inner exception stack trace ---
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Update.Internal.SqlServerModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(IList`1 entriesToSave, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(StateManager stateManager, Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Storage.Internal.SqlServerExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at NayifatAPI.Controllers.RegistrationController.Register(Object request) in C:\Users\yamta\StudioProjects\nayifat_app_2025_new\nayifatapi\Controllers\RegistrationController.cs:line 213
   at Microsoft.AspNetCore.Mvc.Infrastructure.ActionMethodExecutor.TaskOfIActionResultExecutor.Execute(ActionContext actionContext, IActionResultTypeMapper mapper, ObjectMethodExecutor executor, Object controller, Object[] arguments)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.<InvokeActionMethodAsync>g__Awaited|12_0(ControllerActionInvoker invoker, ValueTask`1 actionResultValueTask)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.<InvokeNextActionFilterAsync>g__Awaited|10_0(ControllerActionInvoker invoker, Task lastTask, State next, Scope scope, Object state, Boolean isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.Rethrow(ActionExecutedContextSealed context)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.Next(State& next, Scope& scope, Object& state, Boolean& isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.<InvokeInnerFilterAsync>g__Awaited|13_0(ControllerActionInvoker invoker, Task lastTask, State next, Scope scope, Object state, Boolean isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeFilterPipelineAsync>g__Awaited|20_0(ResourceInvoker invoker, Task lastTask, State next, Scope scope, Object state, Boolean isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeAsync>g__Logged|17_1(ResourceInvoker invoker)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeAsync>g__Logged|17_1(ResourceInvoker invoker)
   at Microsoft.AspNetCore.Routing.EndpointMiddleware.<Invoke>g__AwaitRequestTask|7_0(Endpoint endpoint, Task requestTask, ILogger logger)
   at Microsoft.AspNetCore.Authorization.AuthorizationMiddleware.Invoke(HttpContext context)
   at Program.<>c.<<<Main>$>b__0_3>d.MoveNext() in C:\Users\yamta\StudioProjects\nayifat_app_2025_new\nayifatapi\Program.cs:line 85
--- End of stack trace from previous location ---
   at Swashbuckle.AspNetCore.SwaggerUI.SwaggerUIMiddleware.Invoke(HttpContext httpContext)
   at Swashbuckle.AspNetCore.Swagger.SwaggerMiddleware.Invoke(HttpContext httpContext, ISwaggerProvider swaggerProvider)
   at Microsoft.AspNetCore.Authentication.AuthenticationMiddleware.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Diagnostics.DeveloperExceptionPageMiddlewareImpl.Invoke(HttpContext context)
2025-02-02 00:02:12.241 +03:00 [INF] Request finished HTTP/1.1 POST http://957c-51-252-155-185.ngrok-free.app/api/Registration/register - 500 null text/plain; charset=utf-8 330.8997ms
2025-02-02 00:02:16.701 +03:00 [INF] Request starting HTTP/1.1 POST http://957c-51-252-155-185.ngrok-free.app/api/Registration/register - application/json; charset=utf-8 627
2025-02-02 00:02:16.704 +03:00 [INF] Executing endpoint 'NayifatAPI.Controllers.RegistrationController.Register (NayifatAPI)'
2025-02-02 00:02:16.705 +03:00 [INF] Route matched with {action = "Register", controller = "Registration"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] Register(System.Object) on controller NayifatAPI.Controllers.RegistrationController (NayifatAPI).
2025-02-02 00:02:16.708 +03:00 [INF] Executed DbCommand (0ms) [Parameters=[@__providedApiKey_0='?' (Size = 255)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [a].[Key], [a].[CreatedAt], [a].[Description], [a].[ExpiresAt], [a].[IsActive], [a].[LastUsedAt]
FROM [ApiKeys] AS [a]
WHERE [a].[Key] = @__providedApiKey_0 AND [a].[IsActive] = CAST(1 AS bit)
2025-02-02 00:02:16.711 +03:00 [INF] Executed DbCommand (0ms) [Parameters=[@__registrationRequest_NationalId_0='?' (Size = 450)], CommandType='"Text"', CommandTimeout='30']
SELECT CASE
    WHEN EXISTS (
        SELECT 1
        FROM [Customers] AS [c]
        WHERE [c].[NationalId] = @__registrationRequest_NationalId_0) THEN CAST(1 AS bit)
    ELSE CAST(0 AS bit)
END
2025-02-02 00:02:16.889 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@__registrationRequest_NationalId_0='?' (Size = 450)], CommandType='"Text"', CommandTimeout='30']
UPDATE [c]
SET [c].[LastUsedAt] = GETUTCDATE(),
    [c].[Status] = N'disabled'
FROM [Customer_Devices] AS [c]
WHERE [c].[NationalId] = @__registrationRequest_NationalId_0
2025-02-02 00:02:16.892 +03:00 [WRN] Savepoints are disabled because Multiple Active Result Sets (MARS) is enabled. If 'SaveChanges' fails, then the transaction cannot be automatically rolled back to a known clean state. Instead, the transaction should be rolled back by the application before retrying 'SaveChanges'. See https://go.microsoft.com/fwlink/?linkid=2149338 for more information and examples. To identify the code which triggers this warning, call 'ConfigureWarnings(w => w.Throw(SqlServerEventId.SavepointsDisabledBecauseOfMARS))'.
2025-02-02 00:02:16.895 +03:00 [ERR] Failed executing DbCommand (2ms) [Parameters=[@p0='?' (Size = 450), @p1='?' (Size = 4000), @p2='?' (Size = 4000), @p3='?' (Size = 4000), @p4='?' (DbType = Boolean), @p5='?' (DbType = DateTime2), @p6='?' (DbType = DateTime2), @p7='?' (DbType = Int32), @p8='?' (Size = 4000), @p9='?' (Size = 4000), @p10='?' (Size = 4000), @p11='?' (Size = 4000), @p12='?' (Size = 4000), @p13='?' (Size = 4000), @p14='?' (Size = 4000), @p15='?' (Size = 4000), @p16='?' (Size = 4000), @p17='?' (Size = 4000), @p18='?' (DbType = DateTime2), @p19='?' (Size = 4000), @p20='?' (DbType = Int32), @p21='?' (Size = 4000), @p22='?' (DbType = Boolean), @p23='?' (Size = 4000), @p24='?' (DbType = DateTime2), @p25='?' (Size = 4000), @p26='?' (Size = 4000), @p27='?' (DbType = DateTime2), @p28='?' (Precision = 18) (Scale = 2) (DbType = Decimal), @p29='?' (Precision = 18) (Scale = 2) (DbType = Decimal), @p30='?' (Precision = 18) (Scale = 2) (DbType = Decimal), @p31='?' (Size = 4000), @p32='?' (Size = 4000), @p33='?' (Size = 4000), @p34='?' (Size = 4000), @p35='?' (Size = 4000), @p36='?' (Size = 4000), @p37='?' (Size = 4000), @p38='?' (Size = 4000), @p39='?' (DbType = DateTime2), @p40='?' (Size = 4000), @p41='?' (Size = 4000), @p42='?' (Size = 4000), @p43='?' (Size = 450), @p44='?' (Size = 4000), @p45='?' (Size = 4000), @p46='?' (DbType = Boolean), @p47='?' (Size = 4000), @p48='?' (DbType = DateTime2), @p49='?' (Size = 450), @p50='?' (DbType = DateTime2), @p51='?' (Size = 4000), @p52='?' (Size = 4000), @p53='?' (Size = 450), @p54='?' (Size = 4000), @p55='?' (Size = 4000), @p56='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SET NOCOUNT ON;
INSERT INTO [Customers] ([NationalId], [AddNo], [BuildingNo], [City], [Consent], [ConsentDate], [DateOfBirth], [Dependents], [District], [Email], [Employer], [EmployerName], [EmploymentStatus], [FamilyNameAr], [FamilyNameEn], [FirstNameAr], [FirstNameEn], [Iban], [IdExpiryDate], [Language], [Los], [Mpin], [MpinEnabled], [NafathStatus], [NafathTimestamp], [Password], [Phone], [RegistrationDate], [Salary], [SalaryCustomer], [SalaryDakhli], [SecondNameAr], [SecondNameEn], [Sector], [Street], [ThirdNameAr], [ThirdNameEn], [Zipcode])
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7, @p8, @p9, @p10, @p11, @p12, @p13, @p14, @p15, @p16, @p17, @p18, @p19, @p20, @p21, @p22, @p23, @p24, @p25, @p26, @p27, @p28, @p29, @p30, @p31, @p32, @p33, @p34, @p35, @p36, @p37);
INSERT INTO [AuthLogs] ([AuthType], [CreatedAt], [DeviceId], [FailureReason], [IpAddress], [NationalId], [Status], [UserAgent])
OUTPUT INSERTED.[Id]
VALUES (@p38, @p39, @p40, @p41, @p42, @p43, @p44, @p45);
INSERT INTO [Customer_Devices] ([BiometricEnabled], [BiometricToken], [CreatedAt], [DeviceId], [LastUsedAt], [Manufacturer], [Model], [NationalId], [OsVersion], [Platform], [Status])
OUTPUT INSERTED.[Id]
VALUES (@p46, @p47, @p48, @p49, @p50, @p51, @p52, @p53, @p54, @p55, @p56);
2025-02-02 00:02:16.901 +03:00 [ERR] An exception occurred in the database while saving changes for context type 'NayifatAPI.Data.ApplicationDbContext'.
Microsoft.EntityFrameworkCore.DbUpdateException: An error occurred while saving the entity changes. See the inner exception for details.
 ---> Microsoft.Data.SqlClient.SqlException (0x80131904): Invalid column name 'EmployerName'.
Invalid column name 'EmploymentStatus'.
Invalid column name 'Language'.
Invalid column name 'Salary'.
   at Microsoft.Data.SqlClient.SqlCommand.<>c.<ExecuteDbDataReaderAsync>b__209_0(Task`1 result)
   at System.Threading.Tasks.ContinuationResultTaskFromResultTask`2.InnerInvoke()
   at System.Threading.ExecutionContext.RunInternal(ExecutionContext executionContext, ContextCallback callback, Object state)
--- End of stack trace from previous location ---
   at System.Threading.ExecutionContext.RunInternal(ExecutionContext executionContext, ContextCallback callback, Object state)
   at System.Threading.Tasks.Task.ExecuteWithThreadLocal(Task& currentTaskSlot, Thread threadPoolThread)
--- End of stack trace from previous location ---
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
ClientConnectionId:9fd3acb5-ab9a-445a-817a-3b4e9334ea92
Error Number:207,State:1,Class:16
   --- End of inner exception stack trace ---
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Update.Internal.SqlServerModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(IList`1 entriesToSave, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(StateManager stateManager, Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Storage.Internal.SqlServerExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
Microsoft.EntityFrameworkCore.DbUpdateException: An error occurred while saving the entity changes. See the inner exception for details.
 ---> Microsoft.Data.SqlClient.SqlException (0x80131904): Invalid column name 'EmployerName'.
Invalid column name 'EmploymentStatus'.
Invalid column name 'Language'.
Invalid column name 'Salary'.
   at Microsoft.Data.SqlClient.SqlCommand.<>c.<ExecuteDbDataReaderAsync>b__209_0(Task`1 result)
   at System.Threading.Tasks.ContinuationResultTaskFromResultTask`2.InnerInvoke()
   at System.Threading.ExecutionContext.RunInternal(ExecutionContext executionContext, ContextCallback callback, Object state)
--- End of stack trace from previous location ---
   at System.Threading.ExecutionContext.RunInternal(ExecutionContext executionContext, ContextCallback callback, Object state)
   at System.Threading.Tasks.Task.ExecuteWithThreadLocal(Task& currentTaskSlot, Thread threadPoolThread)
--- End of stack trace from previous location ---
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
ClientConnectionId:9fd3acb5-ab9a-445a-817a-3b4e9334ea92
Error Number:207,State:1,Class:16
   --- End of inner exception stack trace ---
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Update.Internal.SqlServerModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(IList`1 entriesToSave, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(StateManager stateManager, Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Storage.Internal.SqlServerExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
2025-02-02 00:02:16.916 +03:00 [ERR] Error during registration for National ID: 1064448614
Microsoft.EntityFrameworkCore.DbUpdateException: An error occurred while saving the entity changes. See the inner exception for details.
 ---> Microsoft.Data.SqlClient.SqlException (0x80131904): Invalid column name 'EmployerName'.
Invalid column name 'EmploymentStatus'.
Invalid column name 'Language'.
Invalid column name 'Salary'.
   at Microsoft.Data.SqlClient.SqlCommand.<>c.<ExecuteDbDataReaderAsync>b__209_0(Task`1 result)
   at System.Threading.Tasks.ContinuationResultTaskFromResultTask`2.InnerInvoke()
   at System.Threading.ExecutionContext.RunInternal(ExecutionContext executionContext, ContextCallback callback, Object state)
--- End of stack trace from previous location ---
   at System.Threading.ExecutionContext.RunInternal(ExecutionContext executionContext, ContextCallback callback, Object state)
   at System.Threading.Tasks.Task.ExecuteWithThreadLocal(Task& currentTaskSlot, Thread threadPoolThread)
--- End of stack trace from previous location ---
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
ClientConnectionId:9fd3acb5-ab9a-445a-817a-3b4e9334ea92
Error Number:207,State:1,Class:16
   --- End of inner exception stack trace ---
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Update.Internal.SqlServerModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(IList`1 entriesToSave, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(StateManager stateManager, Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Storage.Internal.SqlServerExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at NayifatAPI.Controllers.RegistrationController.Register(Object request) in C:\Users\yamta\StudioProjects\nayifat_app_2025_new\nayifatapi\Controllers\RegistrationController.cs:line 153
   at NayifatAPI.Controllers.RegistrationController.Register(Object request) in C:\Users\yamta\StudioProjects\nayifat_app_2025_new\nayifatapi\Controllers\RegistrationController.cs:line 190
2025-02-02 00:02:16.932 +03:00 [ERR] Failed executing DbCommand (3ms) [Parameters=[@p0='?' (Size = 450), @p1='?' (Size = 4000), @p2='?' (Size = 4000), @p3='?' (Size = 4000), @p4='?' (DbType = Boolean), @p5='?' (DbType = DateTime2), @p6='?' (DbType = DateTime2), @p7='?' (DbType = Int32), @p8='?' (Size = 4000), @p9='?' (Size = 4000), @p10='?' (Size = 4000), @p11='?' (Size = 4000), @p12='?' (Size = 4000), @p13='?' (Size = 4000), @p14='?' (Size = 4000), @p15='?' (Size = 4000), @p16='?' (Size = 4000), @p17='?' (Size = 4000), @p18='?' (DbType = DateTime2), @p19='?' (Size = 4000), @p20='?' (DbType = Int32), @p21='?' (Size = 4000), @p22='?' (DbType = Boolean), @p23='?' (Size = 4000), @p24='?' (DbType = DateTime2), @p25='?' (Size = 4000), @p26='?' (Size = 4000), @p27='?' (DbType = DateTime2), @p28='?' (Precision = 18) (Scale = 2) (DbType = Decimal), @p29='?' (Precision = 18) (Scale = 2) (DbType = Decimal), @p30='?' (Precision = 18) (Scale = 2) (DbType = Decimal), @p31='?' (Size = 4000), @p32='?' (Size = 4000), @p33='?' (Size = 4000), @p34='?' (Size = 4000), @p35='?' (Size = 4000), @p36='?' (Size = 4000), @p37='?' (Size = 4000), @p38='?' (Size = 4000), @p39='?' (DbType = DateTime2), @p40='?' (Size = 4000), @p41='?' (Size = 4000), @p42='?' (Size = 4000), @p43='?' (Size = 450), @p44='?' (Size = 4000), @p45='?' (Size = 4000), @p46='?' (Size = 4000), @p47='?' (DbType = DateTime2), @p48='?' (Size = 4000), @p49='?' (Size = 4000), @p50='?' (Size = 4000), @p51='?' (Size = 450), @p52='?' (Size = 4000), @p53='?' (Size = 4000), @p54='?' (DbType = Boolean), @p55='?' (Size = 4000), @p56='?' (DbType = DateTime2), @p57='?' (Size = 450), @p58='?' (DbType = DateTime2), @p59='?' (Size = 4000), @p60='?' (Size = 4000), @p61='?' (Size = 450), @p62='?' (Size = 4000), @p63='?' (Size = 4000), @p64='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SET NOCOUNT ON;
INSERT INTO [Customers] ([NationalId], [AddNo], [BuildingNo], [City], [Consent], [ConsentDate], [DateOfBirth], [Dependents], [District], [Email], [Employer], [EmployerName], [EmploymentStatus], [FamilyNameAr], [FamilyNameEn], [FirstNameAr], [FirstNameEn], [Iban], [IdExpiryDate], [Language], [Los], [Mpin], [MpinEnabled], [NafathStatus], [NafathTimestamp], [Password], [Phone], [RegistrationDate], [Salary], [SalaryCustomer], [SalaryDakhli], [SecondNameAr], [SecondNameEn], [Sector], [Street], [ThirdNameAr], [ThirdNameEn], [Zipcode])
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7, @p8, @p9, @p10, @p11, @p12, @p13, @p14, @p15, @p16, @p17, @p18, @p19, @p20, @p21, @p22, @p23, @p24, @p25, @p26, @p27, @p28, @p29, @p30, @p31, @p32, @p33, @p34, @p35, @p36, @p37);
MERGE [AuthLogs] USING (
VALUES (@p38, @p39, @p40, @p41, @p42, @p43, @p44, @p45, 0),
(@p46, @p47, @p48, @p49, @p50, @p51, @p52, @p53, 1)) AS i ([AuthType], [CreatedAt], [DeviceId], [FailureReason], [IpAddress], [NationalId], [Status], [UserAgent], _Position) ON 1=0
WHEN NOT MATCHED THEN
INSERT ([AuthType], [CreatedAt], [DeviceId], [FailureReason], [IpAddress], [NationalId], [Status], [UserAgent])
VALUES (i.[AuthType], i.[CreatedAt], i.[DeviceId], i.[FailureReason], i.[IpAddress], i.[NationalId], i.[Status], i.[UserAgent])
OUTPUT INSERTED.[Id], i._Position;
INSERT INTO [Customer_Devices] ([BiometricEnabled], [BiometricToken], [CreatedAt], [DeviceId], [LastUsedAt], [Manufacturer], [Model], [NationalId], [OsVersion], [Platform], [Status])
OUTPUT INSERTED.[Id]
VALUES (@p54, @p55, @p56, @p57, @p58, @p59, @p60, @p61, @p62, @p63, @p64);
2025-02-02 00:02:16.938 +03:00 [ERR] An exception occurred in the database while saving changes for context type 'NayifatAPI.Data.ApplicationDbContext'.
Microsoft.EntityFrameworkCore.DbUpdateException: An error occurred while saving the entity changes. See the inner exception for details.
 ---> Microsoft.Data.SqlClient.SqlException (0x80131904): Invalid column name 'EmployerName'.
Invalid column name 'EmploymentStatus'.
Invalid column name 'Language'.
Invalid column name 'Salary'.
   at Microsoft.Data.SqlClient.SqlCommand.<>c.<ExecuteDbDataReaderAsync>b__209_0(Task`1 result)
   at System.Threading.Tasks.ContinuationResultTaskFromResultTask`2.InnerInvoke()
   at System.Threading.ExecutionContext.RunInternal(ExecutionContext executionContext, ContextCallback callback, Object state)
--- End of stack trace from previous location ---
   at System.Threading.ExecutionContext.RunInternal(ExecutionContext executionContext, ContextCallback callback, Object state)
   at System.Threading.Tasks.Task.ExecuteWithThreadLocal(Task& currentTaskSlot, Thread threadPoolThread)
--- End of stack trace from previous location ---
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
ClientConnectionId:9fd3acb5-ab9a-445a-817a-3b4e9334ea92
Error Number:207,State:1,Class:16
   --- End of inner exception stack trace ---
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Update.Internal.SqlServerModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(IList`1 entriesToSave, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(StateManager stateManager, Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Storage.Internal.SqlServerExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
Microsoft.EntityFrameworkCore.DbUpdateException: An error occurred while saving the entity changes. See the inner exception for details.
 ---> Microsoft.Data.SqlClient.SqlException (0x80131904): Invalid column name 'EmployerName'.
Invalid column name 'EmploymentStatus'.
Invalid column name 'Language'.
Invalid column name 'Salary'.
   at Microsoft.Data.SqlClient.SqlCommand.<>c.<ExecuteDbDataReaderAsync>b__209_0(Task`1 result)
   at System.Threading.Tasks.ContinuationResultTaskFromResultTask`2.InnerInvoke()
   at System.Threading.ExecutionContext.RunInternal(ExecutionContext executionContext, ContextCallback callback, Object state)
--- End of stack trace from previous location ---
   at System.Threading.ExecutionContext.RunInternal(ExecutionContext executionContext, ContextCallback callback, Object state)
   at System.Threading.Tasks.Task.ExecuteWithThreadLocal(Task& currentTaskSlot, Thread threadPoolThread)
--- End of stack trace from previous location ---
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
ClientConnectionId:9fd3acb5-ab9a-445a-817a-3b4e9334ea92
Error Number:207,State:1,Class:16
   --- End of inner exception stack trace ---
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Update.Internal.SqlServerModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(IList`1 entriesToSave, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(StateManager stateManager, Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Storage.Internal.SqlServerExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
2025-02-02 00:02:16.953 +03:00 [INF] Executed action NayifatAPI.Controllers.RegistrationController.Register (NayifatAPI) in 247.1394ms
2025-02-02 00:02:16.955 +03:00 [INF] Executed endpoint 'NayifatAPI.Controllers.RegistrationController.Register (NayifatAPI)'
2025-02-02 00:02:16.957 +03:00 [ERR] Unhandled exception
Microsoft.EntityFrameworkCore.DbUpdateException: An error occurred while saving the entity changes. See the inner exception for details.
 ---> Microsoft.Data.SqlClient.SqlException (0x80131904): Invalid column name 'EmployerName'.
Invalid column name 'EmploymentStatus'.
Invalid column name 'Language'.
Invalid column name 'Salary'.
   at Microsoft.Data.SqlClient.SqlCommand.<>c.<ExecuteDbDataReaderAsync>b__209_0(Task`1 result)
   at System.Threading.Tasks.ContinuationResultTaskFromResultTask`2.InnerInvoke()
   at System.Threading.ExecutionContext.RunInternal(ExecutionContext executionContext, ContextCallback callback, Object state)
--- End of stack trace from previous location ---
   at System.Threading.ExecutionContext.RunInternal(ExecutionContext executionContext, ContextCallback callback, Object state)
   at System.Threading.Tasks.Task.ExecuteWithThreadLocal(Task& currentTaskSlot, Thread threadPoolThread)
--- End of stack trace from previous location ---
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
ClientConnectionId:9fd3acb5-ab9a-445a-817a-3b4e9334ea92
Error Number:207,State:1,Class:16
   --- End of inner exception stack trace ---
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Update.Internal.SqlServerModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(IList`1 entriesToSave, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(StateManager stateManager, Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Storage.Internal.SqlServerExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at NayifatAPI.Controllers.RegistrationController.Register(Object request) in C:\Users\yamta\StudioProjects\nayifat_app_2025_new\nayifatapi\Controllers\RegistrationController.cs:line 213
   at Microsoft.AspNetCore.Mvc.Infrastructure.ActionMethodExecutor.TaskOfIActionResultExecutor.Execute(ActionContext actionContext, IActionResultTypeMapper mapper, ObjectMethodExecutor executor, Object controller, Object[] arguments)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.<InvokeActionMethodAsync>g__Awaited|12_0(ControllerActionInvoker invoker, ValueTask`1 actionResultValueTask)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.<InvokeNextActionFilterAsync>g__Awaited|10_0(ControllerActionInvoker invoker, Task lastTask, State next, Scope scope, Object state, Boolean isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.Rethrow(ActionExecutedContextSealed context)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.Next(State& next, Scope& scope, Object& state, Boolean& isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.<InvokeInnerFilterAsync>g__Awaited|13_0(ControllerActionInvoker invoker, Task lastTask, State next, Scope scope, Object state, Boolean isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeFilterPipelineAsync>g__Awaited|20_0(ResourceInvoker invoker, Task lastTask, State next, Scope scope, Object state, Boolean isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeAsync>g__Logged|17_1(ResourceInvoker invoker)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeAsync>g__Logged|17_1(ResourceInvoker invoker)
   at Microsoft.AspNetCore.Routing.EndpointMiddleware.<Invoke>g__AwaitRequestTask|7_0(Endpoint endpoint, Task requestTask, ILogger logger)
   at Microsoft.AspNetCore.Authorization.AuthorizationMiddleware.Invoke(HttpContext context)
   at Program.<>c.<<<Main>$>b__0_3>d.MoveNext() in C:\Users\yamta\StudioProjects\nayifat_app_2025_new\nayifatapi\Program.cs:line 85
2025-02-02 00:02:16.971 +03:00 [ERR] An unhandled exception has occurred while executing the request.
Microsoft.EntityFrameworkCore.DbUpdateException: An error occurred while saving the entity changes. See the inner exception for details.
 ---> Microsoft.Data.SqlClient.SqlException (0x80131904): Invalid column name 'EmployerName'.
Invalid column name 'EmploymentStatus'.
Invalid column name 'Language'.
Invalid column name 'Salary'.
   at Microsoft.Data.SqlClient.SqlCommand.<>c.<ExecuteDbDataReaderAsync>b__209_0(Task`1 result)
   at System.Threading.Tasks.ContinuationResultTaskFromResultTask`2.InnerInvoke()
   at System.Threading.ExecutionContext.RunInternal(ExecutionContext executionContext, ContextCallback callback, Object state)
--- End of stack trace from previous location ---
   at System.Threading.ExecutionContext.RunInternal(ExecutionContext executionContext, ContextCallback callback, Object state)
   at System.Threading.Tasks.Task.ExecuteWithThreadLocal(Task& currentTaskSlot, Thread threadPoolThread)
--- End of stack trace from previous location ---
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
ClientConnectionId:9fd3acb5-ab9a-445a-817a-3b4e9334ea92
Error Number:207,State:1,Class:16
   --- End of inner exception stack trace ---
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Update.Internal.SqlServerModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(IList`1 entriesToSave, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(StateManager stateManager, Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Storage.Internal.SqlServerExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at NayifatAPI.Controllers.RegistrationController.Register(Object request) in C:\Users\yamta\StudioProjects\nayifat_app_2025_new\nayifatapi\Controllers\RegistrationController.cs:line 213
   at Microsoft.AspNetCore.Mvc.Infrastructure.ActionMethodExecutor.TaskOfIActionResultExecutor.Execute(ActionContext actionContext, IActionResultTypeMapper mapper, ObjectMethodExecutor executor, Object controller, Object[] arguments)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.<InvokeActionMethodAsync>g__Awaited|12_0(ControllerActionInvoker invoker, ValueTask`1 actionResultValueTask)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.<InvokeNextActionFilterAsync>g__Awaited|10_0(ControllerActionInvoker invoker, Task lastTask, State next, Scope scope, Object state, Boolean isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.Rethrow(ActionExecutedContextSealed context)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.Next(State& next, Scope& scope, Object& state, Boolean& isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.<InvokeInnerFilterAsync>g__Awaited|13_0(ControllerActionInvoker invoker, Task lastTask, State next, Scope scope, Object state, Boolean isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeFilterPipelineAsync>g__Awaited|20_0(ResourceInvoker invoker, Task lastTask, State next, Scope scope, Object state, Boolean isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeAsync>g__Logged|17_1(ResourceInvoker invoker)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeAsync>g__Logged|17_1(ResourceInvoker invoker)
   at Microsoft.AspNetCore.Routing.EndpointMiddleware.<Invoke>g__AwaitRequestTask|7_0(Endpoint endpoint, Task requestTask, ILogger logger)
   at Microsoft.AspNetCore.Authorization.AuthorizationMiddleware.Invoke(HttpContext context)
   at Program.<>c.<<<Main>$>b__0_3>d.MoveNext() in C:\Users\yamta\StudioProjects\nayifat_app_2025_new\nayifatapi\Program.cs:line 85
--- End of stack trace from previous location ---
   at Swashbuckle.AspNetCore.SwaggerUI.SwaggerUIMiddleware.Invoke(HttpContext httpContext)
   at Swashbuckle.AspNetCore.Swagger.SwaggerMiddleware.Invoke(HttpContext httpContext, ISwaggerProvider swaggerProvider)
   at Microsoft.AspNetCore.Authentication.AuthenticationMiddleware.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Diagnostics.DeveloperExceptionPageMiddlewareImpl.Invoke(HttpContext context)
2025-02-02 00:02:16.991 +03:00 [INF] Request finished HTTP/1.1 POST http://957c-51-252-155-185.ngrok-free.app/api/Registration/register - 500 null text/plain; charset=utf-8 289.8775ms
2025-02-02 00:04:44.210 +03:00 [INF] Request starting HTTP/1.1 POST http://957c-51-252-155-185.ngrok-free.app/api/Registration/register - application/json; charset=utf-8 153
2025-02-02 00:04:44.213 +03:00 [INF] Executing endpoint 'NayifatAPI.Controllers.RegistrationController.Register (NayifatAPI)'
2025-02-02 00:04:44.214 +03:00 [INF] Route matched with {action = "Register", controller = "Registration"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] Register(System.Object) on controller NayifatAPI.Controllers.RegistrationController (NayifatAPI).
2025-02-02 00:04:44.222 +03:00 [INF] Executed DbCommand (6ms) [Parameters=[@__providedApiKey_0='?' (Size = 255)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [a].[Key], [a].[CreatedAt], [a].[Description], [a].[ExpiresAt], [a].[IsActive], [a].[LastUsedAt]
FROM [ApiKeys] AS [a]
WHERE [a].[Key] = @__providedApiKey_0 AND [a].[IsActive] = CAST(1 AS bit)
2025-02-02 00:04:44.229 +03:00 [INF] Executed DbCommand (4ms) [Parameters=[@__idCheckRequest_NationalId_0='?' (Size = 450)], CommandType='"Text"', CommandTimeout='30']
SELECT CASE
    WHEN EXISTS (
        SELECT 1
        FROM [Customers] AS [c]
        WHERE [c].[NationalId] = @__idCheckRequest_NationalId_0) THEN CAST(1 AS bit)
    ELSE CAST(0 AS bit)
END
2025-02-02 00:04:44.231 +03:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType9`2[[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Object, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-02-02 00:04:44.233 +03:00 [INF] Executed action NayifatAPI.Controllers.RegistrationController.Register (NayifatAPI) in 18.1848ms
2025-02-02 00:04:44.234 +03:00 [INF] Executed endpoint 'NayifatAPI.Controllers.RegistrationController.Register (NayifatAPI)'
2025-02-02 00:04:44.235 +03:00 [INF] Request finished HTTP/1.1 POST http://957c-51-252-155-185.ngrok-free.app/api/Registration/register - 200 null application/json; charset=utf-8 24.5641ms
2025-02-02 00:04:45.153 +03:00 [INF] Request starting HTTP/1.1 POST http://957c-51-252-155-185.ngrok-free.app/api/proxy/forward?url=https://icreditdept.com/api/testasp/test_local_generate_otp.php - application/json; charset=utf-8 89
2025-02-02 00:04:45.155 +03:00 [INF] Executing endpoint 'NayifatAPI.Controllers.ProxyController.ForwardRequest (NayifatAPI)'
2025-02-02 00:04:45.156 +03:00 [INF] Route matched with {action = "ForwardRequest", controller = "Proxy"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] ForwardRequest() on controller NayifatAPI.Controllers.ProxyController (NayifatAPI).
2025-02-02 00:04:45.159 +03:00 [INF] Start processing HTTP request POST https://icreditdept.com/api/testasp/test_local_generate_otp.php
2025-02-02 00:04:45.160 +03:00 [INF] Sending HTTP request POST https://icreditdept.com/api/testasp/test_local_generate_otp.php
2025-02-02 00:04:46.604 +03:00 [INF] Received HTTP response headers after 1442.7655ms - 200
2025-02-02 00:04:46.605 +03:00 [INF] End processing HTTP request after 1446.0157ms - 200
2025-02-02 00:04:46.606 +03:00 [INF] Raw response length: 200
2025-02-02 00:04:46.607 +03:00 [INF] Response content: {"success":true,"errors":[],"result":{"nationalId":"1064448614","otp":767811,"expiryDate":"2025-02-02 00:09:46","successMsg":"Success","errCode":0,"errMsg":null},"type":"N","message":null,"code":null}
2025-02-02 00:04:46.609 +03:00 [INF] Executing ContentResult with HTTP Response ContentType of application/json
2025-02-02 00:04:46.610 +03:00 [INF] Executed action NayifatAPI.Controllers.ProxyController.ForwardRequest (NayifatAPI) in 1452.3728ms
2025-02-02 00:04:46.612 +03:00 [INF] Executed endpoint 'NayifatAPI.Controllers.ProxyController.ForwardRequest (NayifatAPI)'
2025-02-02 00:04:46.614 +03:00 [INF] Request finished HTTP/1.1 POST http://957c-51-252-155-185.ngrok-free.app/api/proxy/forward?url=https://icreditdept.com/api/testasp/test_local_generate_otp.php - 200 200 application/json 1461.1162ms
2025-02-02 00:05:34.937 +03:00 [INF] Request starting HTTP/1.1 POST http://957c-51-252-155-185.ngrok-free.app/api/proxy/forward?url=https://icreditdept.com/api/testasp/test_local_verify_otp.php - application/json; charset=utf-8 53
2025-02-02 00:05:34.939 +03:00 [INF] Executing endpoint 'NayifatAPI.Controllers.ProxyController.ForwardRequest (NayifatAPI)'
2025-02-02 00:05:34.940 +03:00 [INF] Route matched with {action = "ForwardRequest", controller = "Proxy"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] ForwardRequest() on controller NayifatAPI.Controllers.ProxyController (NayifatAPI).
2025-02-02 00:05:34.942 +03:00 [INF] Start processing HTTP request POST https://icreditdept.com/api/testasp/test_local_verify_otp.php
2025-02-02 00:05:34.944 +03:00 [INF] Sending HTTP request POST https://icreditdept.com/api/testasp/test_local_verify_otp.php
2025-02-02 00:05:35.404 +03:00 [INF] Received HTTP response headers after 458.4683ms - 200
2025-02-02 00:05:35.405 +03:00 [INF] End processing HTTP request after 462.4365ms - 200
2025-02-02 00:05:35.406 +03:00 [INF] Raw response length: 202
2025-02-02 00:05:35.407 +03:00 [INF] Response content: {"success":true,"errors":[],"result":{"nationalId":"1064448614","otp":"767811","verifiedFlag":true,"successMsg":"Verified successfully.","errCode":0,"errMsg":null},"type":"N","message":null,"code":null}
2025-02-02 00:05:35.408 +03:00 [INF] Executing ContentResult with HTTP Response ContentType of application/json
2025-02-02 00:05:35.408 +03:00 [INF] Executed action NayifatAPI.Controllers.ProxyController.ForwardRequest (NayifatAPI) in 466.6297ms
2025-02-02 00:05:35.409 +03:00 [INF] Executed endpoint 'NayifatAPI.Controllers.ProxyController.ForwardRequest (NayifatAPI)'
2025-02-02 00:05:35.411 +03:00 [INF] Request finished HTTP/1.1 POST http://957c-51-252-155-185.ngrok-free.app/api/proxy/forward?url=https://icreditdept.com/api/testasp/test_local_verify_otp.php - 200 202 application/json 474.2603ms
2025-02-02 00:05:57.097 +03:00 [INF] Request starting HTTP/1.1 POST http://957c-51-252-155-185.ngrok-free.app/api/Registration/register - application/json; charset=utf-8 153
2025-02-02 00:05:57.100 +03:00 [INF] Executing endpoint 'NayifatAPI.Controllers.RegistrationController.Register (NayifatAPI)'
2025-02-02 00:05:57.101 +03:00 [INF] Route matched with {action = "Register", controller = "Registration"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] Register(System.Object) on controller NayifatAPI.Controllers.RegistrationController (NayifatAPI).
2025-02-02 00:05:57.107 +03:00 [INF] Executed DbCommand (3ms) [Parameters=[@__providedApiKey_0='?' (Size = 255)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [a].[Key], [a].[CreatedAt], [a].[Description], [a].[ExpiresAt], [a].[IsActive], [a].[LastUsedAt]
FROM [ApiKeys] AS [a]
WHERE [a].[Key] = @__providedApiKey_0 AND [a].[IsActive] = CAST(1 AS bit)
2025-02-02 00:05:57.114 +03:00 [INF] Executed DbCommand (4ms) [Parameters=[@__idCheckRequest_NationalId_0='?' (Size = 450)], CommandType='"Text"', CommandTimeout='30']
SELECT CASE
    WHEN EXISTS (
        SELECT 1
        FROM [Customers] AS [c]
        WHERE [c].[NationalId] = @__idCheckRequest_NationalId_0) THEN CAST(1 AS bit)
    ELSE CAST(0 AS bit)
END
2025-02-02 00:05:57.117 +03:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType9`2[[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Object, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-02-02 00:05:57.119 +03:00 [INF] Executed action NayifatAPI.Controllers.RegistrationController.Register (NayifatAPI) in 16.1423ms
2025-02-02 00:05:57.121 +03:00 [INF] Executed endpoint 'NayifatAPI.Controllers.RegistrationController.Register (NayifatAPI)'
2025-02-02 00:05:57.125 +03:00 [INF] Request finished HTTP/1.1 POST http://957c-51-252-155-185.ngrok-free.app/api/Registration/register - 200 null application/json; charset=utf-8 27.0961ms
2025-02-02 00:05:57.798 +03:00 [INF] Request starting HTTP/1.1 POST http://957c-51-252-155-185.ngrok-free.app/api/proxy/forward?url=https://icreditdept.com/api/testasp/test_local_generate_otp.php - application/json; charset=utf-8 89
2025-02-02 00:05:57.801 +03:00 [INF] Executing endpoint 'NayifatAPI.Controllers.ProxyController.ForwardRequest (NayifatAPI)'
2025-02-02 00:05:57.802 +03:00 [INF] Route matched with {action = "ForwardRequest", controller = "Proxy"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] ForwardRequest() on controller NayifatAPI.Controllers.ProxyController (NayifatAPI).
2025-02-02 00:05:57.804 +03:00 [INF] Start processing HTTP request POST https://icreditdept.com/api/testasp/test_local_generate_otp.php
2025-02-02 00:05:57.805 +03:00 [INF] Sending HTTP request POST https://icreditdept.com/api/testasp/test_local_generate_otp.php
2025-02-02 00:05:58.281 +03:00 [INF] Received HTTP response headers after 474.7444ms - 200
2025-02-02 00:05:58.283 +03:00 [INF] End processing HTTP request after 478.6319ms - 200
2025-02-02 00:05:58.284 +03:00 [INF] Raw response length: 200
2025-02-02 00:05:58.285 +03:00 [INF] Response content: {"success":true,"errors":[],"result":{"nationalId":"1064448614","otp":735996,"expiryDate":"2025-02-02 00:10:58","successMsg":"Success","errCode":0,"errMsg":null},"type":"N","message":null,"code":null}
2025-02-02 00:05:58.285 +03:00 [INF] Executing ContentResult with HTTP Response ContentType of application/json
2025-02-02 00:05:58.286 +03:00 [INF] Executed action NayifatAPI.Controllers.ProxyController.ForwardRequest (NayifatAPI) in 482.666ms
2025-02-02 00:05:58.288 +03:00 [INF] Executed endpoint 'NayifatAPI.Controllers.ProxyController.ForwardRequest (NayifatAPI)'
2025-02-02 00:05:58.290 +03:00 [INF] Request finished HTTP/1.1 POST http://957c-51-252-155-185.ngrok-free.app/api/proxy/forward?url=https://icreditdept.com/api/testasp/test_local_generate_otp.php - 200 200 application/json 491.5694ms
2025-02-02 00:06:16.635 +03:00 [INF] Request starting HTTP/1.1 POST http://957c-51-252-155-185.ngrok-free.app/api/proxy/forward?url=https://icreditdept.com/api/testasp/test_local_verify_otp.php - application/json; charset=utf-8 53
2025-02-02 00:06:16.638 +03:00 [INF] Executing endpoint 'NayifatAPI.Controllers.ProxyController.ForwardRequest (NayifatAPI)'
2025-02-02 00:06:16.639 +03:00 [INF] Route matched with {action = "ForwardRequest", controller = "Proxy"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] ForwardRequest() on controller NayifatAPI.Controllers.ProxyController (NayifatAPI).
2025-02-02 00:06:16.640 +03:00 [INF] Start processing HTTP request POST https://icreditdept.com/api/testasp/test_local_verify_otp.php
2025-02-02 00:06:16.641 +03:00 [INF] Sending HTTP request POST https://icreditdept.com/api/testasp/test_local_verify_otp.php
2025-02-02 00:06:17.075 +03:00 [INF] Received HTTP response headers after 432.3892ms - 200
2025-02-02 00:06:17.076 +03:00 [INF] End processing HTTP request after 435.1568ms - 200
2025-02-02 00:06:17.077 +03:00 [INF] Raw response length: 202
2025-02-02 00:06:17.077 +03:00 [INF] Response content: {"success":true,"errors":[],"result":{"nationalId":"1064448614","otp":"735996","verifiedFlag":true,"successMsg":"Verified successfully.","errCode":0,"errMsg":null},"type":"N","message":null,"code":null}
2025-02-02 00:06:17.078 +03:00 [INF] Executing ContentResult with HTTP Response ContentType of application/json
2025-02-02 00:06:17.079 +03:00 [INF] Executed action NayifatAPI.Controllers.ProxyController.ForwardRequest (NayifatAPI) in 439.1828ms
2025-02-02 00:06:17.081 +03:00 [INF] Executed endpoint 'NayifatAPI.Controllers.ProxyController.ForwardRequest (NayifatAPI)'
2025-02-02 00:06:17.083 +03:00 [INF] Request finished HTTP/1.1 POST http://957c-51-252-155-185.ngrok-free.app/api/proxy/forward?url=https://icreditdept.com/api/testasp/test_local_verify_otp.php - 200 202 application/json 447.5467ms
2025-02-02 00:07:29.147 +03:00 [INF] Request starting HTTP/1.1 POST http://957c-51-252-155-185.ngrok-free.app/api/Registration/register - application/json; charset=utf-8 153
2025-02-02 00:07:29.271 +03:00 [INF] Executing endpoint 'NayifatAPI.Controllers.RegistrationController.Register (NayifatAPI)'
2025-02-02 00:07:29.273 +03:00 [INF] Route matched with {action = "Register", controller = "Registration"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] Register(System.Object) on controller NayifatAPI.Controllers.RegistrationController (NayifatAPI).
2025-02-02 00:07:29.287 +03:00 [INF] Executed DbCommand (7ms) [Parameters=[@__providedApiKey_0='?' (Size = 255)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [a].[Key], [a].[CreatedAt], [a].[Description], [a].[ExpiresAt], [a].[IsActive], [a].[LastUsedAt]
FROM [ApiKeys] AS [a]
WHERE [a].[Key] = @__providedApiKey_0 AND [a].[IsActive] = CAST(1 AS bit)
2025-02-02 00:07:29.300 +03:00 [INF] Executed DbCommand (7ms) [Parameters=[@__idCheckRequest_NationalId_0='?' (Size = 450)], CommandType='"Text"', CommandTimeout='30']
SELECT CASE
    WHEN EXISTS (
        SELECT 1
        FROM [Customers] AS [c]
        WHERE [c].[NationalId] = @__idCheckRequest_NationalId_0) THEN CAST(1 AS bit)
    ELSE CAST(0 AS bit)
END
2025-02-02 00:07:29.310 +03:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType9`2[[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Object, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-02-02 00:07:29.314 +03:00 [INF] Executed action NayifatAPI.Controllers.RegistrationController.Register (NayifatAPI) in 36.4357ms
2025-02-02 00:07:29.323 +03:00 [INF] Executed endpoint 'NayifatAPI.Controllers.RegistrationController.Register (NayifatAPI)'
2025-02-02 00:07:29.325 +03:00 [INF] Request finished HTTP/1.1 POST http://957c-51-252-155-185.ngrok-free.app/api/Registration/register - 200 null application/json; charset=utf-8 177.7213ms
2025-02-02 00:07:29.959 +03:00 [INF] Request starting HTTP/1.1 POST http://957c-51-252-155-185.ngrok-free.app/api/proxy/forward?url=https://icreditdept.com/api/testasp/test_local_generate_otp.php - application/json; charset=utf-8 89
2025-02-02 00:07:29.961 +03:00 [INF] Executing endpoint 'NayifatAPI.Controllers.ProxyController.ForwardRequest (NayifatAPI)'
2025-02-02 00:07:29.963 +03:00 [INF] Route matched with {action = "ForwardRequest", controller = "Proxy"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] ForwardRequest() on controller NayifatAPI.Controllers.ProxyController (NayifatAPI).
2025-02-02 00:07:29.965 +03:00 [INF] Start processing HTTP request POST https://icreditdept.com/api/testasp/test_local_generate_otp.php
2025-02-02 00:07:29.967 +03:00 [INF] Sending HTTP request POST https://icreditdept.com/api/testasp/test_local_generate_otp.php
2025-02-02 00:07:30.606 +03:00 [INF] Received HTTP response headers after 637.8239ms - 200
2025-02-02 00:07:30.607 +03:00 [INF] End processing HTTP request after 641.6511ms - 200
2025-02-02 00:07:30.608 +03:00 [INF] Raw response length: 200
2025-02-02 00:07:30.609 +03:00 [INF] Response content: {"success":true,"errors":[],"result":{"nationalId":"1064448614","otp":283310,"expiryDate":"2025-02-02 00:12:30","successMsg":"Success","errCode":0,"errMsg":null},"type":"N","message":null,"code":null}
2025-02-02 00:07:30.610 +03:00 [INF] Executing ContentResult with HTTP Response ContentType of application/json
2025-02-02 00:07:30.611 +03:00 [INF] Executed action NayifatAPI.Controllers.ProxyController.ForwardRequest (NayifatAPI) in 646.4926ms
2025-02-02 00:07:30.612 +03:00 [INF] Executed endpoint 'NayifatAPI.Controllers.ProxyController.ForwardRequest (NayifatAPI)'
2025-02-02 00:07:30.613 +03:00 [INF] Request finished HTTP/1.1 POST http://957c-51-252-155-185.ngrok-free.app/api/proxy/forward?url=https://icreditdept.com/api/testasp/test_local_generate_otp.php - 200 200 application/json 654.2683ms
2025-02-02 00:07:53.462 +03:00 [INF] Request starting HTTP/1.1 POST http://957c-51-252-155-185.ngrok-free.app/api/proxy/forward?url=https://icreditdept.com/api/testasp/test_local_verify_otp.php - application/json; charset=utf-8 53
2025-02-02 00:07:53.466 +03:00 [INF] Executing endpoint 'NayifatAPI.Controllers.ProxyController.ForwardRequest (NayifatAPI)'
2025-02-02 00:07:53.467 +03:00 [INF] Route matched with {action = "ForwardRequest", controller = "Proxy"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] ForwardRequest() on controller NayifatAPI.Controllers.ProxyController (NayifatAPI).
2025-02-02 00:07:53.470 +03:00 [INF] Start processing HTTP request POST https://icreditdept.com/api/testasp/test_local_verify_otp.php
2025-02-02 00:07:53.471 +03:00 [INF] Sending HTTP request POST https://icreditdept.com/api/testasp/test_local_verify_otp.php
2025-02-02 00:07:53.908 +03:00 [INF] Received HTTP response headers after 435.4575ms - 200
2025-02-02 00:07:53.910 +03:00 [INF] End processing HTTP request after 439.9795ms - 200
2025-02-02 00:07:53.912 +03:00 [INF] Raw response length: 202
2025-02-02 00:07:53.913 +03:00 [INF] Response content: {"success":true,"errors":[],"result":{"nationalId":"1064448614","otp":"283310","verifiedFlag":true,"successMsg":"Verified successfully.","errCode":0,"errMsg":null},"type":"N","message":null,"code":null}
2025-02-02 00:07:53.914 +03:00 [INF] Executing ContentResult with HTTP Response ContentType of application/json
2025-02-02 00:07:53.915 +03:00 [INF] Executed action NayifatAPI.Controllers.ProxyController.ForwardRequest (NayifatAPI) in 445.9925ms
2025-02-02 00:07:53.918 +03:00 [INF] Executed endpoint 'NayifatAPI.Controllers.ProxyController.ForwardRequest (NayifatAPI)'
2025-02-02 00:07:53.920 +03:00 [INF] Request finished HTTP/1.1 POST http://957c-51-252-155-185.ngrok-free.app/api/proxy/forward?url=https://icreditdept.com/api/testasp/test_local_verify_otp.php - 200 202 application/json 457.522ms
2025-02-02 00:07:54.966 +03:00 [INF] Request starting HTTP/1.1 POST http://957c-51-252-155-185.ngrok-free.app/api/Yakeen/getCitizenInfo/json - application/json; charset=utf-8 88
2025-02-02 00:07:55.100 +03:00 [INF] Executing endpoint 'NayifatAPI.Controllers.YakeenController.GetCitizenInfo (NayifatAPI)'
2025-02-02 00:07:55.105 +03:00 [INF] Route matched with {action = "GetCitizenInfo", controller = "Yakeen"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.ActionResult`1[NayifatAPI.Models.YakeenCitizenInfo]] GetCitizenInfo(CitizenInfoRequest) on controller NayifatAPI.Controllers.YakeenController (NayifatAPI).
2025-02-02 00:07:55.126 +03:00 [INF] Executed DbCommand (10ms) [Parameters=[@__request_IqamaNumber_0='?' (Size = 50)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [y].[Id], [y].[DateOfBirth], [y].[DateOfBirthHijri], [y].[EnglishFirstName], [y].[EnglishLastName], [y].[EnglishSecondName], [y].[EnglishThirdName], [y].[FamilyName], [y].[FatherName], [y].[FirstName], [y].[Gender], [y].[GenderFieldSpecified], [y].[GrandFatherName], [y].[HifizaIssuePlace], [y].[HifizaNumber], [y].[IdExpiryDate], [y].[IdIssueDate], [y].[IdIssuePlace], [y].[IdVersionNumber], [y].[IqamaNumber], [y].[LogIdField], [y].[NumberOfVehiclesReg], [y].[OccupationCode], [y].[SocialStatusDetailedDesc], [y].[SubtribeName], [y].[TotalNumberOfCurrentDependents]
FROM [YakeenCitizenInfo] AS [y]
WHERE [y].[IqamaNumber] = @__request_IqamaNumber_0
2025-02-02 00:07:55.152 +03:00 [INF] Executing OkObjectResult, writing value of type 'NayifatAPI.Models.YakeenCitizenInfo'.
2025-02-02 00:07:55.156 +03:00 [INF] Executed action NayifatAPI.Controllers.YakeenController.GetCitizenInfo (NayifatAPI) in 41.5158ms
2025-02-02 00:07:55.166 +03:00 [INF] Executed endpoint 'NayifatAPI.Controllers.YakeenController.GetCitizenInfo (NayifatAPI)'
2025-02-02 00:07:55.169 +03:00 [INF] Request finished HTTP/1.1 POST http://957c-51-252-155-185.ngrok-free.app/api/Yakeen/getCitizenInfo/json - 200 null application/json; charset=utf-8 202.928ms
2025-02-02 00:08:25.157 +03:00 [INF] Request starting HTTP/1.1 POST http://957c-51-252-155-185.ngrok-free.app/api/Yakeen/getCitizenInfo/json - application/json; charset=utf-8 83
2025-02-02 00:08:25.159 +03:00 [INF] Executing endpoint 'NayifatAPI.Controllers.YakeenController.GetCitizenInfo (NayifatAPI)'
2025-02-02 00:08:25.160 +03:00 [INF] Route matched with {action = "GetCitizenInfo", controller = "Yakeen"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.ActionResult`1[NayifatAPI.Models.YakeenCitizenInfo]] GetCitizenInfo(CitizenInfoRequest) on controller NayifatAPI.Controllers.YakeenController (NayifatAPI).
2025-02-02 00:08:25.167 +03:00 [INF] Executed DbCommand (4ms) [Parameters=[@__request_IqamaNumber_0='?' (Size = 50)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [y].[Id], [y].[DateOfBirth], [y].[DateOfBirthHijri], [y].[EnglishFirstName], [y].[EnglishLastName], [y].[EnglishSecondName], [y].[EnglishThirdName], [y].[FamilyName], [y].[FatherName], [y].[FirstName], [y].[Gender], [y].[GenderFieldSpecified], [y].[GrandFatherName], [y].[HifizaIssuePlace], [y].[HifizaNumber], [y].[IdExpiryDate], [y].[IdIssueDate], [y].[IdIssuePlace], [y].[IdVersionNumber], [y].[IqamaNumber], [y].[LogIdField], [y].[NumberOfVehiclesReg], [y].[OccupationCode], [y].[SocialStatusDetailedDesc], [y].[SubtribeName], [y].[TotalNumberOfCurrentDependents]
FROM [YakeenCitizenInfo] AS [y]
WHERE [y].[IqamaNumber] = @__request_IqamaNumber_0
2025-02-02 00:08:25.171 +03:00 [INF] Executing OkObjectResult, writing value of type 'NayifatAPI.Models.YakeenCitizenInfo'.
2025-02-02 00:08:25.172 +03:00 [INF] Executed action NayifatAPI.Controllers.YakeenController.GetCitizenInfo (NayifatAPI) in 10.8422ms
2025-02-02 00:08:25.173 +03:00 [INF] Executed endpoint 'NayifatAPI.Controllers.YakeenController.GetCitizenInfo (NayifatAPI)'
2025-02-02 00:08:25.174 +03:00 [INF] Request finished HTTP/1.1 POST http://957c-51-252-155-185.ngrok-free.app/api/Yakeen/getCitizenInfo/json - 200 null application/json; charset=utf-8 17.5946ms
2025-02-02 00:08:25.969 +03:00 [INF] Request starting HTTP/1.1 POST http://957c-51-252-155-185.ngrok-free.app/api/Registration/register - application/json; charset=utf-8 627
2025-02-02 00:08:25.971 +03:00 [INF] Executing endpoint 'NayifatAPI.Controllers.RegistrationController.Register (NayifatAPI)'
2025-02-02 00:08:25.972 +03:00 [INF] Route matched with {action = "Register", controller = "Registration"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] Register(System.Object) on controller NayifatAPI.Controllers.RegistrationController (NayifatAPI).
2025-02-02 00:08:25.974 +03:00 [INF] Executing ObjectResult, writing value of type '<>f__AnonymousType11`2[[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-02-02 00:08:25.975 +03:00 [INF] Executed action NayifatAPI.Controllers.RegistrationController.Register (NayifatAPI) in 1.6438ms
2025-02-02 00:08:25.977 +03:00 [INF] Executed endpoint 'NayifatAPI.Controllers.RegistrationController.Register (NayifatAPI)'
2025-02-02 00:08:25.977 +03:00 [INF] Request finished HTTP/1.1 POST http://957c-51-252-155-185.ngrok-free.app/api/Registration/register - 401 null application/json; charset=utf-8 8.9286ms
2025-02-02 00:08:28.306 +03:00 [INF] Request starting HTTP/1.1 POST http://957c-51-252-155-185.ngrok-free.app/api/Registration/register - application/json; charset=utf-8 627
2025-02-02 00:08:28.309 +03:00 [INF] Executing endpoint 'NayifatAPI.Controllers.RegistrationController.Register (NayifatAPI)'
2025-02-02 00:08:28.310 +03:00 [INF] Route matched with {action = "Register", controller = "Registration"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] Register(System.Object) on controller NayifatAPI.Controllers.RegistrationController (NayifatAPI).
2025-02-02 00:08:28.312 +03:00 [INF] Executing ObjectResult, writing value of type '<>f__AnonymousType11`2[[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-02-02 00:08:28.313 +03:00 [INF] Executed action NayifatAPI.Controllers.RegistrationController.Register (NayifatAPI) in 1.6977ms
2025-02-02 00:08:28.314 +03:00 [INF] Executed endpoint 'NayifatAPI.Controllers.RegistrationController.Register (NayifatAPI)'
2025-02-02 00:08:28.316 +03:00 [INF] Request finished HTTP/1.1 POST http://957c-51-252-155-185.ngrok-free.app/api/Registration/register - 401 null application/json; charset=utf-8 9.6255ms
2025-02-02 00:08:32.664 +03:00 [INF] Request starting HTTP/1.1 POST http://957c-51-252-155-185.ngrok-free.app/api/Registration/register - application/json; charset=utf-8 627
2025-02-02 00:08:32.707 +03:00 [INF] Executing endpoint 'NayifatAPI.Controllers.RegistrationController.Register (NayifatAPI)'
2025-02-02 00:08:32.708 +03:00 [INF] Route matched with {action = "Register", controller = "Registration"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] Register(System.Object) on controller NayifatAPI.Controllers.RegistrationController (NayifatAPI).
2025-02-02 00:08:32.714 +03:00 [INF] Executing ObjectResult, writing value of type '<>f__AnonymousType11`2[[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-02-02 00:08:32.716 +03:00 [INF] Executed action NayifatAPI.Controllers.RegistrationController.Register (NayifatAPI) in 2.4868ms
2025-02-02 00:08:32.717 +03:00 [INF] Executed endpoint 'NayifatAPI.Controllers.RegistrationController.Register (NayifatAPI)'
2025-02-02 00:08:32.718 +03:00 [INF] Request finished HTTP/1.1 POST http://957c-51-252-155-185.ngrok-free.app/api/Registration/register - 401 null application/json; charset=utf-8 54.4436ms
2025-02-02 00:10:21.745 +03:00 [INF] Request starting HTTP/1.1 POST http://957c-51-252-155-185.ngrok-free.app/api/Registration/register - application/json 627
2025-02-02 00:10:21.749 +03:00 [INF] Executing endpoint 'NayifatAPI.Controllers.RegistrationController.Register (NayifatAPI)'
2025-02-02 00:10:21.750 +03:00 [INF] Route matched with {action = "Register", controller = "Registration"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] Register(System.Object) on controller NayifatAPI.Controllers.RegistrationController (NayifatAPI).
2025-02-02 00:10:21.767 +03:00 [INF] Executed DbCommand (6ms) [Parameters=[@__providedApiKey_0='?' (Size = 255)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [a].[Key], [a].[CreatedAt], [a].[Description], [a].[ExpiresAt], [a].[IsActive], [a].[LastUsedAt]
FROM [ApiKeys] AS [a]
WHERE [a].[Key] = @__providedApiKey_0 AND [a].[IsActive] = CAST(1 AS bit)
2025-02-02 00:10:21.780 +03:00 [INF] Executed DbCommand (8ms) [Parameters=[@__registrationRequest_NationalId_0='?' (Size = 450)], CommandType='"Text"', CommandTimeout='30']
SELECT CASE
    WHEN EXISTS (
        SELECT 1
        FROM [Customers] AS [c]
        WHERE [c].[NationalId] = @__registrationRequest_NationalId_0) THEN CAST(1 AS bit)
    ELSE CAST(0 AS bit)
END
2025-02-02 00:10:22.145 +03:00 [INF] Executed DbCommand (7ms) [Parameters=[@__registrationRequest_NationalId_0='?' (Size = 450)], CommandType='"Text"', CommandTimeout='30']
UPDATE [c]
SET [c].[LastUsedAt] = GETUTCDATE(),
    [c].[Status] = N'disabled'
FROM [Customer_Devices] AS [c]
WHERE [c].[NationalId] = @__registrationRequest_NationalId_0
2025-02-02 00:10:22.152 +03:00 [WRN] Savepoints are disabled because Multiple Active Result Sets (MARS) is enabled. If 'SaveChanges' fails, then the transaction cannot be automatically rolled back to a known clean state. Instead, the transaction should be rolled back by the application before retrying 'SaveChanges'. See https://go.microsoft.com/fwlink/?linkid=2149338 for more information and examples. To identify the code which triggers this warning, call 'ConfigureWarnings(w => w.Throw(SqlServerEventId.SavepointsDisabledBecauseOfMARS))'.
2025-02-02 00:10:22.170 +03:00 [ERR] Failed executing DbCommand (15ms) [Parameters=[@p0='?' (Size = 450), @p1='?' (Size = 4000), @p2='?' (Size = 4000), @p3='?' (Size = 4000), @p4='?' (DbType = Boolean), @p5='?' (DbType = DateTime2), @p6='?' (DbType = DateTime2), @p7='?' (DbType = Int32), @p8='?' (Size = 4000), @p9='?' (Size = 4000), @p10='?' (Size = 4000), @p11='?' (Size = 4000), @p12='?' (Size = 4000), @p13='?' (Size = 4000), @p14='?' (Size = 4000), @p15='?' (Size = 4000), @p16='?' (Size = 4000), @p17='?' (Size = 4000), @p18='?' (DbType = DateTime2), @p19='?' (Size = 4000), @p20='?' (DbType = Int32), @p21='?' (Size = 4000), @p22='?' (DbType = Boolean), @p23='?' (Size = 4000), @p24='?' (DbType = DateTime2), @p25='?' (Size = 4000), @p26='?' (Size = 4000), @p27='?' (DbType = DateTime2), @p28='?' (Precision = 18) (Scale = 2) (DbType = Decimal), @p29='?' (Precision = 18) (Scale = 2) (DbType = Decimal), @p30='?' (Precision = 18) (Scale = 2) (DbType = Decimal), @p31='?' (Size = 4000), @p32='?' (Size = 4000), @p33='?' (Size = 4000), @p34='?' (Size = 4000), @p35='?' (Size = 4000), @p36='?' (Size = 4000), @p37='?' (Size = 4000), @p38='?' (Size = 4000), @p39='?' (DbType = DateTime2), @p40='?' (Size = 4000), @p41='?' (Size = 4000), @p42='?' (Size = 4000), @p43='?' (Size = 450), @p44='?' (Size = 4000), @p45='?' (Size = 4000), @p46='?' (DbType = Boolean), @p47='?' (Size = 4000), @p48='?' (DbType = DateTime2), @p49='?' (Size = 450), @p50='?' (DbType = DateTime2), @p51='?' (Size = 4000), @p52='?' (Size = 4000), @p53='?' (Size = 450), @p54='?' (Size = 4000), @p55='?' (Size = 4000), @p56='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SET NOCOUNT ON;
INSERT INTO [Customers] ([NationalId], [AddNo], [BuildingNo], [City], [Consent], [ConsentDate], [DateOfBirth], [Dependents], [District], [Email], [Employer], [EmployerName], [EmploymentStatus], [FamilyNameAr], [FamilyNameEn], [FirstNameAr], [FirstNameEn], [Iban], [IdExpiryDate], [Language], [Los], [Mpin], [MpinEnabled], [NafathStatus], [NafathTimestamp], [Password], [Phone], [RegistrationDate], [Salary], [SalaryCustomer], [SalaryDakhli], [SecondNameAr], [SecondNameEn], [Sector], [Street], [ThirdNameAr], [ThirdNameEn], [Zipcode])
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7, @p8, @p9, @p10, @p11, @p12, @p13, @p14, @p15, @p16, @p17, @p18, @p19, @p20, @p21, @p22, @p23, @p24, @p25, @p26, @p27, @p28, @p29, @p30, @p31, @p32, @p33, @p34, @p35, @p36, @p37);
INSERT INTO [AuthLogs] ([AuthType], [CreatedAt], [DeviceId], [FailureReason], [IpAddress], [NationalId], [Status], [UserAgent])
OUTPUT INSERTED.[Id]
VALUES (@p38, @p39, @p40, @p41, @p42, @p43, @p44, @p45);
INSERT INTO [Customer_Devices] ([BiometricEnabled], [BiometricToken], [CreatedAt], [DeviceId], [LastUsedAt], [Manufacturer], [Model], [NationalId], [OsVersion], [Platform], [Status])
OUTPUT INSERTED.[Id]
VALUES (@p46, @p47, @p48, @p49, @p50, @p51, @p52, @p53, @p54, @p55, @p56);
2025-02-02 00:10:22.193 +03:00 [ERR] An exception occurred in the database while saving changes for context type 'NayifatAPI.Data.ApplicationDbContext'.
Microsoft.EntityFrameworkCore.DbUpdateException: An error occurred while saving the entity changes. See the inner exception for details.
 ---> Microsoft.Data.SqlClient.SqlException (0x80131904): Invalid column name 'EmployerName'.
Invalid column name 'EmploymentStatus'.
Invalid column name 'Language'.
Invalid column name 'Salary'.
   at System.Threading.Tasks.ContinuationResultTaskFromResultTask`2.InnerInvoke()
   at System.Threading.ExecutionContext.RunInternal(ExecutionContext executionContext, ContextCallback callback, Object state)
--- End of stack trace from previous location ---
   at System.Threading.ExecutionContext.RunInternal(ExecutionContext executionContext, ContextCallback callback, Object state)
   at System.Threading.Tasks.Task.ExecuteWithThreadLocal(Task& currentTaskSlot, Thread threadPoolThread)
--- End of stack trace from previous location ---
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
ClientConnectionId:9fd3acb5-ab9a-445a-817a-3b4e9334ea92
Error Number:207,State:1,Class:16
   --- End of inner exception stack trace ---
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Update.Internal.SqlServerModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(IList`1 entriesToSave, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(StateManager stateManager, Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Storage.Internal.SqlServerExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
Microsoft.EntityFrameworkCore.DbUpdateException: An error occurred while saving the entity changes. See the inner exception for details.
 ---> Microsoft.Data.SqlClient.SqlException (0x80131904): Invalid column name 'EmployerName'.
Invalid column name 'EmploymentStatus'.
Invalid column name 'Language'.
Invalid column name 'Salary'.
   at System.Threading.Tasks.ContinuationResultTaskFromResultTask`2.InnerInvoke()
   at System.Threading.ExecutionContext.RunInternal(ExecutionContext executionContext, ContextCallback callback, Object state)
--- End of stack trace from previous location ---
   at System.Threading.ExecutionContext.RunInternal(ExecutionContext executionContext, ContextCallback callback, Object state)
   at System.Threading.Tasks.Task.ExecuteWithThreadLocal(Task& currentTaskSlot, Thread threadPoolThread)
--- End of stack trace from previous location ---
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
ClientConnectionId:9fd3acb5-ab9a-445a-817a-3b4e9334ea92
Error Number:207,State:1,Class:16
   --- End of inner exception stack trace ---
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Update.Internal.SqlServerModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(IList`1 entriesToSave, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(StateManager stateManager, Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Storage.Internal.SqlServerExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
2025-02-02 00:10:22.222 +03:00 [ERR] Error during registration for National ID: 1064448614
Microsoft.EntityFrameworkCore.DbUpdateException: An error occurred while saving the entity changes. See the inner exception for details.
 ---> Microsoft.Data.SqlClient.SqlException (0x80131904): Invalid column name 'EmployerName'.
Invalid column name 'EmploymentStatus'.
Invalid column name 'Language'.
Invalid column name 'Salary'.
   at System.Threading.Tasks.ContinuationResultTaskFromResultTask`2.InnerInvoke()
   at System.Threading.ExecutionContext.RunInternal(ExecutionContext executionContext, ContextCallback callback, Object state)
--- End of stack trace from previous location ---
   at System.Threading.ExecutionContext.RunInternal(ExecutionContext executionContext, ContextCallback callback, Object state)
   at System.Threading.Tasks.Task.ExecuteWithThreadLocal(Task& currentTaskSlot, Thread threadPoolThread)
--- End of stack trace from previous location ---
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
ClientConnectionId:9fd3acb5-ab9a-445a-817a-3b4e9334ea92
Error Number:207,State:1,Class:16
   --- End of inner exception stack trace ---
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Update.Internal.SqlServerModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(IList`1 entriesToSave, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(StateManager stateManager, Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Storage.Internal.SqlServerExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at NayifatAPI.Controllers.RegistrationController.Register(Object request) in C:\Users\yamta\StudioProjects\nayifat_app_2025_new\nayifatapi\Controllers\RegistrationController.cs:line 153
   at NayifatAPI.Controllers.RegistrationController.Register(Object request) in C:\Users\yamta\StudioProjects\nayifat_app_2025_new\nayifatapi\Controllers\RegistrationController.cs:line 190
2025-02-02 00:10:22.252 +03:00 [ERR] Failed executing DbCommand (7ms) [Parameters=[@p0='?' (Size = 450), @p1='?' (Size = 4000), @p2='?' (Size = 4000), @p3='?' (Size = 4000), @p4='?' (DbType = Boolean), @p5='?' (DbType = DateTime2), @p6='?' (DbType = DateTime2), @p7='?' (DbType = Int32), @p8='?' (Size = 4000), @p9='?' (Size = 4000), @p10='?' (Size = 4000), @p11='?' (Size = 4000), @p12='?' (Size = 4000), @p13='?' (Size = 4000), @p14='?' (Size = 4000), @p15='?' (Size = 4000), @p16='?' (Size = 4000), @p17='?' (Size = 4000), @p18='?' (DbType = DateTime2), @p19='?' (Size = 4000), @p20='?' (DbType = Int32), @p21='?' (Size = 4000), @p22='?' (DbType = Boolean), @p23='?' (Size = 4000), @p24='?' (DbType = DateTime2), @p25='?' (Size = 4000), @p26='?' (Size = 4000), @p27='?' (DbType = DateTime2), @p28='?' (Precision = 18) (Scale = 2) (DbType = Decimal), @p29='?' (Precision = 18) (Scale = 2) (DbType = Decimal), @p30='?' (Precision = 18) (Scale = 2) (DbType = Decimal), @p31='?' (Size = 4000), @p32='?' (Size = 4000), @p33='?' (Size = 4000), @p34='?' (Size = 4000), @p35='?' (Size = 4000), @p36='?' (Size = 4000), @p37='?' (Size = 4000), @p38='?' (Size = 4000), @p39='?' (DbType = DateTime2), @p40='?' (Size = 4000), @p41='?' (Size = 4000), @p42='?' (Size = 4000), @p43='?' (Size = 450), @p44='?' (Size = 4000), @p45='?' (Size = 4000), @p46='?' (Size = 4000), @p47='?' (DbType = DateTime2), @p48='?' (Size = 4000), @p49='?' (Size = 4000), @p50='?' (Size = 4000), @p51='?' (Size = 450), @p52='?' (Size = 4000), @p53='?' (Size = 4000), @p54='?' (DbType = Boolean), @p55='?' (Size = 4000), @p56='?' (DbType = DateTime2), @p57='?' (Size = 450), @p58='?' (DbType = DateTime2), @p59='?' (Size = 4000), @p60='?' (Size = 4000), @p61='?' (Size = 450), @p62='?' (Size = 4000), @p63='?' (Size = 4000), @p64='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SET NOCOUNT ON;
INSERT INTO [Customers] ([NationalId], [AddNo], [BuildingNo], [City], [Consent], [ConsentDate], [DateOfBirth], [Dependents], [District], [Email], [Employer], [EmployerName], [EmploymentStatus], [FamilyNameAr], [FamilyNameEn], [FirstNameAr], [FirstNameEn], [Iban], [IdExpiryDate], [Language], [Los], [Mpin], [MpinEnabled], [NafathStatus], [NafathTimestamp], [Password], [Phone], [RegistrationDate], [Salary], [SalaryCustomer], [SalaryDakhli], [SecondNameAr], [SecondNameEn], [Sector], [Street], [ThirdNameAr], [ThirdNameEn], [Zipcode])
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7, @p8, @p9, @p10, @p11, @p12, @p13, @p14, @p15, @p16, @p17, @p18, @p19, @p20, @p21, @p22, @p23, @p24, @p25, @p26, @p27, @p28, @p29, @p30, @p31, @p32, @p33, @p34, @p35, @p36, @p37);
MERGE [AuthLogs] USING (
VALUES (@p38, @p39, @p40, @p41, @p42, @p43, @p44, @p45, 0),
(@p46, @p47, @p48, @p49, @p50, @p51, @p52, @p53, 1)) AS i ([AuthType], [CreatedAt], [DeviceId], [FailureReason], [IpAddress], [NationalId], [Status], [UserAgent], _Position) ON 1=0
WHEN NOT MATCHED THEN
INSERT ([AuthType], [CreatedAt], [DeviceId], [FailureReason], [IpAddress], [NationalId], [Status], [UserAgent])
VALUES (i.[AuthType], i.[CreatedAt], i.[DeviceId], i.[FailureReason], i.[IpAddress], i.[NationalId], i.[Status], i.[UserAgent])
OUTPUT INSERTED.[Id], i._Position;
INSERT INTO [Customer_Devices] ([BiometricEnabled], [BiometricToken], [CreatedAt], [DeviceId], [LastUsedAt], [Manufacturer], [Model], [NationalId], [OsVersion], [Platform], [Status])
OUTPUT INSERTED.[Id]
VALUES (@p54, @p55, @p56, @p57, @p58, @p59, @p60, @p61, @p62, @p63, @p64);
2025-02-02 00:10:22.266 +03:00 [ERR] An exception occurred in the database while saving changes for context type 'NayifatAPI.Data.ApplicationDbContext'.
Microsoft.EntityFrameworkCore.DbUpdateException: An error occurred while saving the entity changes. See the inner exception for details.
 ---> Microsoft.Data.SqlClient.SqlException (0x80131904): Invalid column name 'EmployerName'.
Invalid column name 'EmploymentStatus'.
Invalid column name 'Language'.
Invalid column name 'Salary'.
   at System.Threading.Tasks.ContinuationResultTaskFromResultTask`2.InnerInvoke()
   at System.Threading.ExecutionContext.RunInternal(ExecutionContext executionContext, ContextCallback callback, Object state)
--- End of stack trace from previous location ---
   at System.Threading.ExecutionContext.RunInternal(ExecutionContext executionContext, ContextCallback callback, Object state)
   at System.Threading.Tasks.Task.ExecuteWithThreadLocal(Task& currentTaskSlot, Thread threadPoolThread)
--- End of stack trace from previous location ---
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
ClientConnectionId:9fd3acb5-ab9a-445a-817a-3b4e9334ea92
Error Number:207,State:1,Class:16
   --- End of inner exception stack trace ---
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Update.Internal.SqlServerModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(IList`1 entriesToSave, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(StateManager stateManager, Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Storage.Internal.SqlServerExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
Microsoft.EntityFrameworkCore.DbUpdateException: An error occurred while saving the entity changes. See the inner exception for details.
 ---> Microsoft.Data.SqlClient.SqlException (0x80131904): Invalid column name 'EmployerName'.
Invalid column name 'EmploymentStatus'.
Invalid column name 'Language'.
Invalid column name 'Salary'.
   at System.Threading.Tasks.ContinuationResultTaskFromResultTask`2.InnerInvoke()
   at System.Threading.ExecutionContext.RunInternal(ExecutionContext executionContext, ContextCallback callback, Object state)
--- End of stack trace from previous location ---
   at System.Threading.ExecutionContext.RunInternal(ExecutionContext executionContext, ContextCallback callback, Object state)
   at System.Threading.Tasks.Task.ExecuteWithThreadLocal(Task& currentTaskSlot, Thread threadPoolThread)
--- End of stack trace from previous location ---
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
ClientConnectionId:9fd3acb5-ab9a-445a-817a-3b4e9334ea92
Error Number:207,State:1,Class:16
   --- End of inner exception stack trace ---
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Update.Internal.SqlServerModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(IList`1 entriesToSave, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(StateManager stateManager, Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Storage.Internal.SqlServerExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
2025-02-02 00:10:22.299 +03:00 [INF] Executed action NayifatAPI.Controllers.RegistrationController.Register (NayifatAPI) in 544.0447ms
2025-02-02 00:10:22.302 +03:00 [INF] Executed endpoint 'NayifatAPI.Controllers.RegistrationController.Register (NayifatAPI)'
2025-02-02 00:10:22.304 +03:00 [ERR] Unhandled exception
Microsoft.EntityFrameworkCore.DbUpdateException: An error occurred while saving the entity changes. See the inner exception for details.
 ---> Microsoft.Data.SqlClient.SqlException (0x80131904): Invalid column name 'EmployerName'.
Invalid column name 'EmploymentStatus'.
Invalid column name 'Language'.
Invalid column name 'Salary'.
   at System.Threading.Tasks.ContinuationResultTaskFromResultTask`2.InnerInvoke()
   at System.Threading.ExecutionContext.RunInternal(ExecutionContext executionContext, ContextCallback callback, Object state)
--- End of stack trace from previous location ---
   at System.Threading.ExecutionContext.RunInternal(ExecutionContext executionContext, ContextCallback callback, Object state)
   at System.Threading.Tasks.Task.ExecuteWithThreadLocal(Task& currentTaskSlot, Thread threadPoolThread)
--- End of stack trace from previous location ---
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
ClientConnectionId:9fd3acb5-ab9a-445a-817a-3b4e9334ea92
Error Number:207,State:1,Class:16
   --- End of inner exception stack trace ---
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Update.Internal.SqlServerModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(IList`1 entriesToSave, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(StateManager stateManager, Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Storage.Internal.SqlServerExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at NayifatAPI.Controllers.RegistrationController.Register(Object request) in C:\Users\yamta\StudioProjects\nayifat_app_2025_new\nayifatapi\Controllers\RegistrationController.cs:line 213
   at Microsoft.AspNetCore.Mvc.Infrastructure.ActionMethodExecutor.TaskOfIActionResultExecutor.Execute(ActionContext actionContext, IActionResultTypeMapper mapper, ObjectMethodExecutor executor, Object controller, Object[] arguments)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.<InvokeActionMethodAsync>g__Awaited|12_0(ControllerActionInvoker invoker, ValueTask`1 actionResultValueTask)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.<InvokeNextActionFilterAsync>g__Awaited|10_0(ControllerActionInvoker invoker, Task lastTask, State next, Scope scope, Object state, Boolean isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.Rethrow(ActionExecutedContextSealed context)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.Next(State& next, Scope& scope, Object& state, Boolean& isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.<InvokeInnerFilterAsync>g__Awaited|13_0(ControllerActionInvoker invoker, Task lastTask, State next, Scope scope, Object state, Boolean isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeFilterPipelineAsync>g__Awaited|20_0(ResourceInvoker invoker, Task lastTask, State next, Scope scope, Object state, Boolean isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeAsync>g__Logged|17_1(ResourceInvoker invoker)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeAsync>g__Logged|17_1(ResourceInvoker invoker)
   at Microsoft.AspNetCore.Routing.EndpointMiddleware.<Invoke>g__AwaitRequestTask|7_0(Endpoint endpoint, Task requestTask, ILogger logger)
   at Microsoft.AspNetCore.Authorization.AuthorizationMiddleware.Invoke(HttpContext context)
   at Program.<>c.<<<Main>$>b__0_3>d.MoveNext() in C:\Users\yamta\StudioProjects\nayifat_app_2025_new\nayifatapi\Program.cs:line 85
2025-02-02 00:10:22.339 +03:00 [ERR] An unhandled exception has occurred while executing the request.
Microsoft.EntityFrameworkCore.DbUpdateException: An error occurred while saving the entity changes. See the inner exception for details.
 ---> Microsoft.Data.SqlClient.SqlException (0x80131904): Invalid column name 'EmployerName'.
Invalid column name 'EmploymentStatus'.
Invalid column name 'Language'.
Invalid column name 'Salary'.
   at System.Threading.Tasks.ContinuationResultTaskFromResultTask`2.InnerInvoke()
   at System.Threading.ExecutionContext.RunInternal(ExecutionContext executionContext, ContextCallback callback, Object state)
--- End of stack trace from previous location ---
   at System.Threading.ExecutionContext.RunInternal(ExecutionContext executionContext, ContextCallback callback, Object state)
   at System.Threading.Tasks.Task.ExecuteWithThreadLocal(Task& currentTaskSlot, Thread threadPoolThread)
--- End of stack trace from previous location ---
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
ClientConnectionId:9fd3acb5-ab9a-445a-817a-3b4e9334ea92
Error Number:207,State:1,Class:16
   --- End of inner exception stack trace ---
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Update.Internal.SqlServerModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(IList`1 entriesToSave, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(StateManager stateManager, Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Storage.Internal.SqlServerExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at NayifatAPI.Controllers.RegistrationController.Register(Object request) in C:\Users\yamta\StudioProjects\nayifat_app_2025_new\nayifatapi\Controllers\RegistrationController.cs:line 213
   at Microsoft.AspNetCore.Mvc.Infrastructure.ActionMethodExecutor.TaskOfIActionResultExecutor.Execute(ActionContext actionContext, IActionResultTypeMapper mapper, ObjectMethodExecutor executor, Object controller, Object[] arguments)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.<InvokeActionMethodAsync>g__Awaited|12_0(ControllerActionInvoker invoker, ValueTask`1 actionResultValueTask)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.<InvokeNextActionFilterAsync>g__Awaited|10_0(ControllerActionInvoker invoker, Task lastTask, State next, Scope scope, Object state, Boolean isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.Rethrow(ActionExecutedContextSealed context)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.Next(State& next, Scope& scope, Object& state, Boolean& isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.<InvokeInnerFilterAsync>g__Awaited|13_0(ControllerActionInvoker invoker, Task lastTask, State next, Scope scope, Object state, Boolean isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeFilterPipelineAsync>g__Awaited|20_0(ResourceInvoker invoker, Task lastTask, State next, Scope scope, Object state, Boolean isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeAsync>g__Logged|17_1(ResourceInvoker invoker)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeAsync>g__Logged|17_1(ResourceInvoker invoker)
   at Microsoft.AspNetCore.Routing.EndpointMiddleware.<Invoke>g__AwaitRequestTask|7_0(Endpoint endpoint, Task requestTask, ILogger logger)
   at Microsoft.AspNetCore.Authorization.AuthorizationMiddleware.Invoke(HttpContext context)
   at Program.<>c.<<<Main>$>b__0_3>d.MoveNext() in C:\Users\yamta\StudioProjects\nayifat_app_2025_new\nayifatapi\Program.cs:line 85
--- End of stack trace from previous location ---
   at Swashbuckle.AspNetCore.SwaggerUI.SwaggerUIMiddleware.Invoke(HttpContext httpContext)
   at Swashbuckle.AspNetCore.Swagger.SwaggerMiddleware.Invoke(HttpContext httpContext, ISwaggerProvider swaggerProvider)
   at Microsoft.AspNetCore.Authentication.AuthenticationMiddleware.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Diagnostics.DeveloperExceptionPageMiddlewareImpl.Invoke(HttpContext context)
2025-02-02 00:10:22.520 +03:00 [INF] Request finished HTTP/1.1 POST http://957c-51-252-155-185.ngrok-free.app/api/Registration/register - 500 null text/plain; charset=utf-8 774.8526ms
2025-02-02 00:11:29.163 +03:00 [INF] Application is shutting down...
2025-02-02 00:11:52.348 +03:00 [INF] Starting web application
2025-02-02 00:11:52.464 +03:00 [INF] Now listening on: http://localhost:5264
2025-02-02 00:11:52.469 +03:00 [INF] Application started. Press Ctrl+C to shut down.
2025-02-02 00:11:52.470 +03:00 [INF] Hosting environment: Development
2025-02-02 00:11:52.471 +03:00 [INF] Content root path: C:\Users\yamta\StudioProjects\nayifat_app_2025_new\nayifatapi
2025-02-02 00:12:06.579 +03:00 [INF] Request starting HTTP/1.1 POST http://957c-51-252-155-185.ngrok-free.app/api/Yakeen/getCitizenInfo/json - application/json; charset=utf-8 83
2025-02-02 00:12:06.792 +03:00 [WRN] Failed to determine the https port for redirect.
2025-02-02 00:12:06.879 +03:00 [INF] Executing endpoint 'NayifatAPI.Controllers.YakeenController.GetCitizenInfo (NayifatAPI)'
2025-02-02 00:12:07.065 +03:00 [INF] Route matched with {action = "GetCitizenInfo", controller = "Yakeen"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.ActionResult`1[NayifatAPI.Models.YakeenCitizenInfo]] GetCitizenInfo(CitizenInfoRequest) on controller NayifatAPI.Controllers.YakeenController (NayifatAPI).
2025-02-02 00:12:09.659 +03:00 [INF] Executed DbCommand (32ms) [Parameters=[@__request_IqamaNumber_0='?' (Size = 50)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [y].[Id], [y].[DateOfBirth], [y].[DateOfBirthHijri], [y].[EnglishFirstName], [y].[EnglishLastName], [y].[EnglishSecondName], [y].[EnglishThirdName], [y].[FamilyName], [y].[FatherName], [y].[FirstName], [y].[Gender], [y].[GenderFieldSpecified], [y].[GrandFatherName], [y].[HifizaIssuePlace], [y].[HifizaNumber], [y].[IdExpiryDate], [y].[IdIssueDate], [y].[IdIssuePlace], [y].[IdVersionNumber], [y].[IqamaNumber], [y].[LogIdField], [y].[NumberOfVehiclesReg], [y].[OccupationCode], [y].[SocialStatusDetailedDesc], [y].[SubtribeName], [y].[TotalNumberOfCurrentDependents]
FROM [YakeenCitizenInfo] AS [y]
WHERE [y].[IqamaNumber] = @__request_IqamaNumber_0
2025-02-02 00:12:09.751 +03:00 [INF] Executing OkObjectResult, writing value of type 'NayifatAPI.Models.YakeenCitizenInfo'.
2025-02-02 00:12:09.772 +03:00 [INF] Executed action NayifatAPI.Controllers.YakeenController.GetCitizenInfo (NayifatAPI) in 2480.949ms
2025-02-02 00:12:09.775 +03:00 [INF] Executed endpoint 'NayifatAPI.Controllers.YakeenController.GetCitizenInfo (NayifatAPI)'
2025-02-02 00:12:09.784 +03:00 [INF] Request finished HTTP/1.1 POST http://957c-51-252-155-185.ngrok-free.app/api/Yakeen/getCitizenInfo/json - 200 null application/json; charset=utf-8 3207.0774ms
2025-02-02 00:12:10.534 +03:00 [INF] Request starting HTTP/1.1 POST http://957c-51-252-155-185.ngrok-free.app/api/Registration/register - application/json; charset=utf-8 627
2025-02-02 00:12:10.540 +03:00 [INF] Executing endpoint 'NayifatAPI.Controllers.RegistrationController.Register (NayifatAPI)'
2025-02-02 00:12:10.547 +03:00 [INF] Route matched with {action = "Register", controller = "Registration"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] Register(NayifatAPI.Controllers.UserRegistrationRequest) on controller NayifatAPI.Controllers.RegistrationController (NayifatAPI).
2025-02-02 00:12:10.582 +03:00 [INF]  Starting registration process for NationalId: 1064448614
2025-02-02 00:12:10.613 +03:00 [INF] Executed DbCommand (3ms) [Parameters=[@__providedApiKey_0='?' (Size = 255)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [a].[Key], [a].[CreatedAt], [a].[Description], [a].[ExpiresAt], [a].[IsActive], [a].[LastUsedAt]
FROM [ApiKeys] AS [a]
WHERE [a].[Key] = @__providedApiKey_0 AND [a].[IsActive] = CAST(1 AS bit)
2025-02-02 00:12:10.654 +03:00 [INF] Executed DbCommand (3ms) [Parameters=[@__registrationRequest_NationalId_0='?' (Size = 450)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [c].[NationalId], [c].[AddNo], [c].[BuildingNo], [c].[City], [c].[Consent], [c].[ConsentDate], [c].[DateOfBirth], [c].[Dependents], [c].[District], [c].[Email], [c].[Employer], [c].[FamilyNameAr], [c].[FamilyNameEn], [c].[FirstNameAr], [c].[FirstNameEn], [c].[Iban], [c].[IdExpiryDate], [c].[Los], [c].[Mpin], [c].[MpinEnabled], [c].[NafathStatus], [c].[NafathTimestamp], [c].[Password], [c].[Phone], [c].[RegistrationDate], [c].[SalaryCustomer], [c].[SalaryDakhli], [c].[SecondNameAr], [c].[SecondNameEn], [c].[Sector], [c].[Street], [c].[ThirdNameAr], [c].[ThirdNameEn], [c].[Zipcode]
FROM [Customers] AS [c]
WHERE [c].[NationalId] = @__registrationRequest_NationalId_0
2025-02-02 00:12:10.657 +03:00 [INF]  User validation passed. Creating new customer record
2025-02-02 00:12:10.660 +03:00 [DBG]  Registration Request Data: {"NationalId":"1064448614","FirstNameEn":"Fatima","SecondNameEn":"Abdulaziz","ThirdNameEn":"Salem","FamilyNameEn":"AlSaud","FirstNameAr":" ","SecondNameAr":"","ThirdNameAr":" ","FamilyNameAr":"","Email":"talyami@gmail.com","Phone":"556355537","Password":"Asdfgh79","DateOfBirth":"1998-09-17T00:00:00.0000000","IdExpiryDate":"1450-10-03T00:00:00.0000000","BuildingNo":null,"Street":null,"District":null,"City":null,"Zipcode":null,"AddNo":null,"Iban":null,"Dependents":null,"SalaryDakhli":null,"SalaryCustomer":null,"Los":null,"Sector":null,"Employer":null,"Consent":true,"NafathStatus":null,"DeviceInfo":{"DeviceId":"TP1A.220624.014","Platform":"Android","Model":"SM-A515F","Manufacturer":"samsung","$type":"DeviceInfo"},"$type":"UserRegistrationRequest"}
2025-02-02 00:12:10.686 +03:00 [INF]  Hashing password
2025-02-02 00:12:11.010 +03:00 [INF]  Creating new customer record
2025-02-02 00:12:11.013 +03:00 [DBG]  New Customer Data: {"NationalId":"1064448614","FirstNameEn":"Fatima","FamilyNameEn":"AlSaud","Email":"talyami@gmail.com","Phone":"556355537","DateOfBirth":"1998-09-17T00:00:00.0000000","IdExpiryDate":"1450-10-03T00:00:00.0000000","RegistrationDate":"2025-02-01T21:12:11.0123488Z"}
2025-02-02 00:12:11.206 +03:00 [WRN] Savepoints are disabled because Multiple Active Result Sets (MARS) is enabled. If 'SaveChanges' fails, then the transaction cannot be automatically rolled back to a known clean state. Instead, the transaction should be rolled back by the application before retrying 'SaveChanges'. See https://go.microsoft.com/fwlink/?linkid=2149338 for more information and examples. To identify the code which triggers this warning, call 'ConfigureWarnings(w => w.Throw(SqlServerEventId.SavepointsDisabledBecauseOfMARS))'.
2025-02-02 00:12:11.289 +03:00 [INF] Executed DbCommand (78ms) [Parameters=[@p0='?' (Size = 450), @p1='?' (Size = 4000), @p2='?' (Size = 4000), @p3='?' (Size = 4000), @p4='?' (DbType = Boolean), @p5='?' (DbType = DateTime2), @p6='?' (DbType = DateTime2), @p7='?' (DbType = Int32), @p8='?' (Size = 4000), @p9='?' (Size = 4000), @p10='?' (Size = 4000), @p11='?' (Size = 4000), @p12='?' (Size = 4000), @p13='?' (Size = 4000), @p14='?' (Size = 4000), @p15='?' (Size = 4000), @p16='?' (DbType = DateTime2), @p17='?' (DbType = Int32), @p18='?' (Size = 4000), @p19='?' (DbType = Boolean), @p20='?' (Size = 4000), @p21='?' (DbType = DateTime2), @p22='?' (Size = 4000), @p23='?' (Size = 4000), @p24='?' (DbType = DateTime2), @p25='?' (Precision = 18) (Scale = 2) (DbType = Decimal), @p26='?' (Precision = 18) (Scale = 2) (DbType = Decimal), @p27='?' (Size = 4000), @p28='?' (Size = 4000), @p29='?' (Size = 4000), @p30='?' (Size = 4000), @p31='?' (Size = 4000), @p32='?' (Size = 4000), @p33='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SET IMPLICIT_TRANSACTIONS OFF;
SET NOCOUNT ON;
INSERT INTO [Customers] ([NationalId], [AddNo], [BuildingNo], [City], [Consent], [ConsentDate], [DateOfBirth], [Dependents], [District], [Email], [Employer], [FamilyNameAr], [FamilyNameEn], [FirstNameAr], [FirstNameEn], [Iban], [IdExpiryDate], [Los], [Mpin], [MpinEnabled], [NafathStatus], [NafathTimestamp], [Password], [Phone], [RegistrationDate], [SalaryCustomer], [SalaryDakhli], [SecondNameAr], [SecondNameEn], [Sector], [Street], [ThirdNameAr], [ThirdNameEn], [Zipcode])
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7, @p8, @p9, @p10, @p11, @p12, @p13, @p14, @p15, @p16, @p17, @p18, @p19, @p20, @p21, @p22, @p23, @p24, @p25, @p26, @p27, @p28, @p29, @p30, @p31, @p32, @p33);
2025-02-02 00:12:11.303 +03:00 [INF]  Customer record created successfully
2025-02-02 00:12:11.304 +03:00 [INF]  Adding device information
2025-02-02 00:12:11.305 +03:00 [DBG]  Device Info: {"DeviceId":"TP1A.220624.014","Platform":"Android","Model":"SM-A515F","Manufacturer":"samsung","$type":"DeviceInfo"}
2025-02-02 00:12:11.351 +03:00 [WRN] Savepoints are disabled because Multiple Active Result Sets (MARS) is enabled. If 'SaveChanges' fails, then the transaction cannot be automatically rolled back to a known clean state. Instead, the transaction should be rolled back by the application before retrying 'SaveChanges'. See https://go.microsoft.com/fwlink/?linkid=2149338 for more information and examples. To identify the code which triggers this warning, call 'ConfigureWarnings(w => w.Throw(SqlServerEventId.SavepointsDisabledBecauseOfMARS))'.
2025-02-02 00:12:11.473 +03:00 [INF] Executed DbCommand (120ms) [Parameters=[@p0='?' (DbType = Boolean), @p1='?' (Size = 4000), @p2='?' (DbType = DateTime2), @p3='?' (Size = 450), @p4='?' (DbType = DateTime2), @p5='?' (Size = 4000), @p6='?' (Size = 4000), @p7='?' (Size = 450), @p8='?' (Size = 4000), @p9='?' (Size = 4000), @p10='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SET IMPLICIT_TRANSACTIONS OFF;
SET NOCOUNT ON;
INSERT INTO [Customer_Devices] ([BiometricEnabled], [BiometricToken], [CreatedAt], [DeviceId], [LastUsedAt], [Manufacturer], [Model], [NationalId], [OsVersion], [Platform], [Status])
OUTPUT INSERTED.[Id]
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7, @p8, @p9, @p10);
2025-02-02 00:12:11.488 +03:00 [INF]  Device information added successfully
2025-02-02 00:12:11.495 +03:00 [INF]  Registration completed successfully
2025-02-02 00:12:11.500 +03:00 [DBG]  Response Data: {"success":true,"data":{"national_id":"1064448614","first_name_en":"Fatima","family_name_en":"AlSaud","email":"talyami@gmail.com","phone":"556355537","date_of_birth":"1998-09-17","id_expiry_date":"1450-10-03"}}
2025-02-02 00:12:11.506 +03:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType9`2[[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[<>f__AnonymousType42`7[[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]], NayifatAPI, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]]'.
2025-02-02 00:12:11.511 +03:00 [INF] Executed action NayifatAPI.Controllers.RegistrationController.Register (NayifatAPI) in 963.0852ms
2025-02-02 00:12:11.513 +03:00 [INF] Executed endpoint 'NayifatAPI.Controllers.RegistrationController.Register (NayifatAPI)'
2025-02-02 00:12:11.514 +03:00 [INF] Request finished HTTP/1.1 POST http://957c-51-252-155-185.ngrok-free.app/api/Registration/register - 200 null application/json; charset=utf-8 980.3471ms
2025-02-02 00:13:01.759 +03:00 [INF] Request starting HTTP/1.1 POST http://957c-51-252-155-185.ngrok-free.app/api/notifications/list - application/json; charset=utf-8 48
2025-02-02 00:13:01.765 +03:00 [INF] Executing endpoint 'NayifatAPI.Controllers.NotificationsController.GetNotifications (NayifatAPI)'
2025-02-02 00:13:01.771 +03:00 [INF] Route matched with {action = "GetNotifications", controller = "Notifications"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetNotifications(NayifatAPI.Controllers.GetNotificationsRequest) on controller NayifatAPI.Controllers.NotificationsController (NayifatAPI).
2025-02-02 00:13:01.785 +03:00 [INF] Executing BadRequestObjectResult, writing value of type 'Microsoft.AspNetCore.Mvc.ValidationProblemDetails'.
2025-02-02 00:13:01.809 +03:00 [INF] Executed action NayifatAPI.Controllers.NotificationsController.GetNotifications (NayifatAPI) in 34.9296ms
2025-02-02 00:13:01.811 +03:00 [INF] Executed endpoint 'NayifatAPI.Controllers.NotificationsController.GetNotifications (NayifatAPI)'
2025-02-02 00:13:01.812 +03:00 [INF] Request finished HTTP/1.1 POST http://957c-51-252-155-185.ngrok-free.app/api/notifications/list - 400 null application/problem+json; charset=utf-8 53.1369ms
2025-02-02 00:13:48.368 +03:00 [INF] Request starting HTTP/1.1 POST http://957c-51-252-155-185.ngrok-free.app/api/notifications/list - application/json; charset=utf-8 48
2025-02-02 00:13:48.595 +03:00 [INF] Executing endpoint 'NayifatAPI.Controllers.NotificationsController.GetNotifications (NayifatAPI)'
2025-02-02 00:13:48.606 +03:00 [INF] Route matched with {action = "GetNotifications", controller = "Notifications"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetNotifications(NayifatAPI.Controllers.GetNotificationsRequest) on controller NayifatAPI.Controllers.NotificationsController (NayifatAPI).
2025-02-02 00:13:48.610 +03:00 [INF] Executing BadRequestObjectResult, writing value of type 'Microsoft.AspNetCore.Mvc.ValidationProblemDetails'.
2025-02-02 00:13:48.612 +03:00 [INF] Executed action NayifatAPI.Controllers.NotificationsController.GetNotifications (NayifatAPI) in 3.7566ms
2025-02-02 00:13:48.613 +03:00 [INF] Executed endpoint 'NayifatAPI.Controllers.NotificationsController.GetNotifications (NayifatAPI)'
2025-02-02 00:13:48.614 +03:00 [INF] Request finished HTTP/1.1 POST http://957c-51-252-155-185.ngrok-free.app/api/notifications/list - 400 null application/problem+json; charset=utf-8 246.0496ms
2025-02-02 00:13:55.907 +03:00 [INF] Request starting HTTP/1.1 POST http://957c-51-252-155-185.ngrok-free.app/api/auth/signin - application/json; charset=utf-8 203
2025-02-02 00:13:55.910 +03:00 [INF] Executing endpoint 'NayifatAPI.Controllers.AuthController.SignIn (NayifatAPI)'
2025-02-02 00:13:55.914 +03:00 [INF] Route matched with {action = "SignIn", controller = "Auth"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] SignIn(NayifatAPI.Controllers.SignInRequest) on controller NayifatAPI.Controllers.AuthController (NayifatAPI).
2025-02-02 00:13:55.917 +03:00 [INF] Executing BadRequestObjectResult, writing value of type 'Microsoft.AspNetCore.Mvc.ValidationProblemDetails'.
2025-02-02 00:13:55.918 +03:00 [INF] Executed action NayifatAPI.Controllers.AuthController.SignIn (NayifatAPI) in 3.1432ms
2025-02-02 00:13:55.919 +03:00 [INF] Executed endpoint 'NayifatAPI.Controllers.AuthController.SignIn (NayifatAPI)'
2025-02-02 00:13:55.920 +03:00 [INF] Request finished HTTP/1.1 POST http://957c-51-252-155-185.ngrok-free.app/api/auth/signin - 400 null application/problem+json; charset=utf-8 12.4967ms
2025-02-02 00:14:23.802 +03:00 [INF] Request starting HTTP/1.1 POST http://957c-51-252-155-185.ngrok-free.app/api/auth/signin - application/json; charset=utf-8 203
2025-02-02 00:14:23.852 +03:00 [INF] Executing endpoint 'NayifatAPI.Controllers.AuthController.SignIn (NayifatAPI)'
2025-02-02 00:14:23.882 +03:00 [INF] Route matched with {action = "SignIn", controller = "Auth"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] SignIn(NayifatAPI.Controllers.SignInRequest) on controller NayifatAPI.Controllers.AuthController (NayifatAPI).
2025-02-02 00:14:23.885 +03:00 [INF] Executing BadRequestObjectResult, writing value of type 'Microsoft.AspNetCore.Mvc.ValidationProblemDetails'.
2025-02-02 00:14:23.886 +03:00 [INF] Executed action NayifatAPI.Controllers.AuthController.SignIn (NayifatAPI) in 2.6278ms
2025-02-02 00:14:23.888 +03:00 [INF] Executed endpoint 'NayifatAPI.Controllers.AuthController.SignIn (NayifatAPI)'
2025-02-02 00:14:23.889 +03:00 [INF] Request finished HTTP/1.1 POST http://957c-51-252-155-185.ngrok-free.app/api/auth/signin - 400 null application/problem+json; charset=utf-8 87.2222ms
2025-02-02 00:15:51.028 +03:00 [INF] Request starting HTTP/1.1 POST http://957c-51-252-155-185.ngrok-free.app/api/auth/signin - application/json; charset=utf-8 225
2025-02-02 00:15:51.165 +03:00 [INF] Executing endpoint 'NayifatAPI.Controllers.AuthController.SignIn (NayifatAPI)'
2025-02-02 00:15:51.166 +03:00 [INF] Route matched with {action = "SignIn", controller = "Auth"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] SignIn(NayifatAPI.Controllers.SignInRequest) on controller NayifatAPI.Controllers.AuthController (NayifatAPI).
2025-02-02 00:15:51.318 +03:00 [INF] Executing BadRequestObjectResult, writing value of type 'Microsoft.AspNetCore.Mvc.ValidationProblemDetails'.
2025-02-02 00:15:51.322 +03:00 [INF] Executed action NayifatAPI.Controllers.AuthController.SignIn (NayifatAPI) in 5.7437ms
2025-02-02 00:15:51.434 +03:00 [INF] Executed endpoint 'NayifatAPI.Controllers.AuthController.SignIn (NayifatAPI)'
2025-02-02 00:15:51.435 +03:00 [INF] Request finished HTTP/1.1 POST http://957c-51-252-155-185.ngrok-free.app/api/auth/signin - 400 null application/problem+json; charset=utf-8 407.0844ms
2025-02-02 00:16:44.669 +03:00 [INF] Request starting HTTP/1.1 POST http://957c-51-252-155-185.ngrok-free.app/api/auth/signin - application/json; charset=utf-8 203
2025-02-02 00:16:44.672 +03:00 [INF] Executing endpoint 'NayifatAPI.Controllers.AuthController.SignIn (NayifatAPI)'
2025-02-02 00:16:44.673 +03:00 [INF] Route matched with {action = "SignIn", controller = "Auth"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] SignIn(NayifatAPI.Controllers.SignInRequest) on controller NayifatAPI.Controllers.AuthController (NayifatAPI).
2025-02-02 00:16:44.676 +03:00 [INF] Executing BadRequestObjectResult, writing value of type 'Microsoft.AspNetCore.Mvc.ValidationProblemDetails'.
2025-02-02 00:16:44.677 +03:00 [INF] Executed action NayifatAPI.Controllers.AuthController.SignIn (NayifatAPI) in 2.4287ms
2025-02-02 00:16:44.679 +03:00 [INF] Executed endpoint 'NayifatAPI.Controllers.AuthController.SignIn (NayifatAPI)'
2025-02-02 00:16:44.680 +03:00 [INF] Request finished HTTP/1.1 POST http://957c-51-252-155-185.ngrok-free.app/api/auth/signin - 400 null application/problem+json; charset=utf-8 11.7893ms
2025-02-02 00:16:59.470 +03:00 [INF] Request starting HTTP/1.1 POST http://957c-51-252-155-185.ngrok-free.app/api/auth/signin - application/json; charset=utf-8 203
2025-02-02 00:16:59.474 +03:00 [INF] Executing endpoint 'NayifatAPI.Controllers.AuthController.SignIn (NayifatAPI)'
2025-02-02 00:16:59.475 +03:00 [INF] Route matched with {action = "SignIn", controller = "Auth"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] SignIn(NayifatAPI.Controllers.SignInRequest) on controller NayifatAPI.Controllers.AuthController (NayifatAPI).
2025-02-02 00:16:59.477 +03:00 [INF] Executing BadRequestObjectResult, writing value of type 'Microsoft.AspNetCore.Mvc.ValidationProblemDetails'.
2025-02-02 00:16:59.479 +03:00 [INF] Executed action NayifatAPI.Controllers.AuthController.SignIn (NayifatAPI) in 2.8612ms
2025-02-02 00:16:59.483 +03:00 [INF] Executed endpoint 'NayifatAPI.Controllers.AuthController.SignIn (NayifatAPI)'
2025-02-02 00:16:59.484 +03:00 [INF] Request finished HTTP/1.1 POST http://957c-51-252-155-185.ngrok-free.app/api/auth/signin - 400 null application/problem+json; charset=utf-8 14.1483ms
2025-02-02 00:18:04.721 +03:00 [INF] Request starting HTTP/1.1 POST http://957c-51-252-155-185.ngrok-free.app/api/notifications/list - application/json; charset=utf-8 48
2025-02-02 00:18:04.726 +03:00 [INF] Executing endpoint 'NayifatAPI.Controllers.NotificationsController.GetNotifications (NayifatAPI)'
2025-02-02 00:18:04.727 +03:00 [INF] Route matched with {action = "GetNotifications", controller = "Notifications"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetNotifications(NayifatAPI.Controllers.GetNotificationsRequest) on controller NayifatAPI.Controllers.NotificationsController (NayifatAPI).
2025-02-02 00:18:04.729 +03:00 [INF] Executing BadRequestObjectResult, writing value of type 'Microsoft.AspNetCore.Mvc.ValidationProblemDetails'.
2025-02-02 00:18:04.730 +03:00 [INF] Executed action NayifatAPI.Controllers.NotificationsController.GetNotifications (NayifatAPI) in 2.3259ms
2025-02-02 00:18:04.731 +03:00 [INF] Executed endpoint 'NayifatAPI.Controllers.NotificationsController.GetNotifications (NayifatAPI)'
2025-02-02 00:18:04.732 +03:00 [INF] Request finished HTTP/1.1 POST http://957c-51-252-155-185.ngrok-free.app/api/notifications/list - 400 null application/problem+json; charset=utf-8 10.8762ms
2025-02-02 00:18:49.528 +03:00 [INF] Request starting HTTP/1.1 POST http://957c-51-252-155-185.ngrok-free.app/api/notifications/list - application/json; charset=utf-8 48
2025-02-02 00:18:49.536 +03:00 [INF] Executing endpoint 'NayifatAPI.Controllers.NotificationsController.GetNotifications (NayifatAPI)'
2025-02-02 00:18:49.540 +03:00 [INF] Route matched with {action = "GetNotifications", controller = "Notifications"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetNotifications(NayifatAPI.Controllers.GetNotificationsRequest) on controller NayifatAPI.Controllers.NotificationsController (NayifatAPI).
2025-02-02 00:18:49.548 +03:00 [INF] Executing BadRequestObjectResult, writing value of type 'Microsoft.AspNetCore.Mvc.ValidationProblemDetails'.
2025-02-02 00:18:49.549 +03:00 [INF] Executed action NayifatAPI.Controllers.NotificationsController.GetNotifications (NayifatAPI) in 2.9095ms
2025-02-02 00:18:49.551 +03:00 [INF] Executed endpoint 'NayifatAPI.Controllers.NotificationsController.GetNotifications (NayifatAPI)'
2025-02-02 00:18:49.554 +03:00 [INF] Request finished HTTP/1.1 POST http://957c-51-252-155-185.ngrok-free.app/api/notifications/list - 400 null application/problem+json; charset=utf-8 25.8105ms
2025-02-02 00:23:04.635 +03:00 [INF] Request starting HTTP/1.1 POST http://957c-51-252-155-185.ngrok-free.app/api/notifications/list - application/json; charset=utf-8 48
2025-02-02 00:23:04.637 +03:00 [INF] Executing endpoint 'NayifatAPI.Controllers.NotificationsController.GetNotifications (NayifatAPI)'
2025-02-02 00:23:04.638 +03:00 [INF] Route matched with {action = "GetNotifications", controller = "Notifications"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetNotifications(NayifatAPI.Controllers.GetNotificationsRequest) on controller NayifatAPI.Controllers.NotificationsController (NayifatAPI).
2025-02-02 00:23:04.640 +03:00 [INF] Executing BadRequestObjectResult, writing value of type 'Microsoft.AspNetCore.Mvc.ValidationProblemDetails'.
2025-02-02 00:23:04.641 +03:00 [INF] Executed action NayifatAPI.Controllers.NotificationsController.GetNotifications (NayifatAPI) in 2.1072ms
2025-02-02 00:23:04.642 +03:00 [INF] Executed endpoint 'NayifatAPI.Controllers.NotificationsController.GetNotifications (NayifatAPI)'
2025-02-02 00:23:04.643 +03:00 [INF] Request finished HTTP/1.1 POST http://957c-51-252-155-185.ngrok-free.app/api/notifications/list - 400 null application/problem+json; charset=utf-8 8.4613ms
2025-02-02 00:23:49.592 +03:00 [INF] Request starting HTTP/1.1 POST http://957c-51-252-155-185.ngrok-free.app/api/notifications/list - application/json; charset=utf-8 48
2025-02-02 00:23:49.595 +03:00 [INF] Executing endpoint 'NayifatAPI.Controllers.NotificationsController.GetNotifications (NayifatAPI)'
2025-02-02 00:23:49.598 +03:00 [INF] Route matched with {action = "GetNotifications", controller = "Notifications"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetNotifications(NayifatAPI.Controllers.GetNotificationsRequest) on controller NayifatAPI.Controllers.NotificationsController (NayifatAPI).
2025-02-02 00:23:49.601 +03:00 [INF] Executing BadRequestObjectResult, writing value of type 'Microsoft.AspNetCore.Mvc.ValidationProblemDetails'.
2025-02-02 00:23:49.603 +03:00 [INF] Executed action NayifatAPI.Controllers.NotificationsController.GetNotifications (NayifatAPI) in 2.9197ms
2025-02-02 00:23:49.605 +03:00 [INF] Executed endpoint 'NayifatAPI.Controllers.NotificationsController.GetNotifications (NayifatAPI)'
2025-02-02 00:23:49.606 +03:00 [INF] Request finished HTTP/1.1 POST http://957c-51-252-155-185.ngrok-free.app/api/notifications/list - 400 null application/problem+json; charset=utf-8 13.727ms
2025-02-02 00:24:16.671 +03:00 [INF] Request starting HTTP/1.1 POST http://localhost:5264/api/notifications/list - application/json 48
2025-02-02 00:24:16.675 +03:00 [INF] Executing endpoint 'NayifatAPI.Controllers.NotificationsController.GetNotifications (NayifatAPI)'
2025-02-02 00:24:16.676 +03:00 [INF] Route matched with {action = "GetNotifications", controller = "Notifications"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetNotifications(NayifatAPI.Controllers.GetNotificationsRequest) on controller NayifatAPI.Controllers.NotificationsController (NayifatAPI).
2025-02-02 00:24:16.683 +03:00 [INF] Executing BadRequestObjectResult, writing value of type 'Microsoft.AspNetCore.Mvc.ValidationProblemDetails'.
2025-02-02 00:24:16.684 +03:00 [INF] Executed action NayifatAPI.Controllers.NotificationsController.GetNotifications (NayifatAPI) in 4.5963ms
2025-02-02 00:24:16.686 +03:00 [INF] Executed endpoint 'NayifatAPI.Controllers.NotificationsController.GetNotifications (NayifatAPI)'
2025-02-02 00:24:16.687 +03:00 [INF] Request finished HTTP/1.1 POST http://localhost:5264/api/notifications/list - 400 null application/problem+json; charset=utf-8 16.4815ms
2025-02-02 00:24:29.499 +03:00 [INF] Request starting HTTP/1.1 POST http://localhost:5264/api/notifications/list - application/json 47
2025-02-02 00:24:29.501 +03:00 [INF] Executing endpoint 'NayifatAPI.Controllers.NotificationsController.GetNotifications (NayifatAPI)'
2025-02-02 00:24:29.503 +03:00 [INF] Route matched with {action = "GetNotifications", controller = "Notifications"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetNotifications(NayifatAPI.Controllers.GetNotificationsRequest) on controller NayifatAPI.Controllers.NotificationsController (NayifatAPI).
2025-02-02 00:24:29.611 +03:00 [INF] Executed DbCommand (3ms) [Parameters=[@__providedApiKey_0='?' (Size = 255)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [a].[Key], [a].[CreatedAt], [a].[Description], [a].[ExpiresAt], [a].[IsActive], [a].[LastUsedAt]
FROM [ApiKeys] AS [a]
WHERE [a].[Key] = @__providedApiKey_0 AND [a].[IsActive] = CAST(1 AS bit)
2025-02-02 00:24:29.703 +03:00 [INF] Executed DbCommand (80ms) [Parameters=[@__request_NationalId_0='?' (Size = 450)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [u].[national_id], [u].[last_updated], [u].[notifications]
FROM [user_notifications] AS [u]
WHERE [u].[national_id] = @__request_NationalId_0
2025-02-02 00:24:29.708 +03:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType9`2[[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Object, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-02-02 00:24:29.712 +03:00 [INF] Executed action NayifatAPI.Controllers.NotificationsController.GetNotifications (NayifatAPI) in 206.7856ms
2025-02-02 00:24:29.713 +03:00 [INF] Executed endpoint 'NayifatAPI.Controllers.NotificationsController.GetNotifications (NayifatAPI)'
2025-02-02 00:24:29.715 +03:00 [INF] Request finished HTTP/1.1 POST http://localhost:5264/api/notifications/list - 200 null application/json; charset=utf-8 215.9708ms
2025-02-02 00:28:03.249 +03:00 [INF] Request starting HTTP/1.1 POST http://957c-51-252-155-185.ngrok-free.app/api/notifications/list - application/json; charset=utf-8 48
2025-02-02 00:28:03.290 +03:00 [INF] Executing endpoint 'NayifatAPI.Controllers.NotificationsController.GetNotifications (NayifatAPI)'
2025-02-02 00:28:03.293 +03:00 [INF] Route matched with {action = "GetNotifications", controller = "Notifications"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetNotifications(NayifatAPI.Controllers.GetNotificationsRequest) on controller NayifatAPI.Controllers.NotificationsController (NayifatAPI).
2025-02-02 00:28:03.299 +03:00 [INF] Executing BadRequestObjectResult, writing value of type 'Microsoft.AspNetCore.Mvc.ValidationProblemDetails'.
2025-02-02 00:28:03.340 +03:00 [INF] Executed action NayifatAPI.Controllers.NotificationsController.GetNotifications (NayifatAPI) in 42.2835ms
2025-02-02 00:28:03.345 +03:00 [INF] Executed endpoint 'NayifatAPI.Controllers.NotificationsController.GetNotifications (NayifatAPI)'
2025-02-02 00:28:03.385 +03:00 [INF] Request finished HTTP/1.1 POST http://957c-51-252-155-185.ngrok-free.app/api/notifications/list - 400 null application/problem+json; charset=utf-8 136.036ms
2025-02-02 00:28:49.751 +03:00 [INF] Request starting HTTP/1.1 POST http://957c-51-252-155-185.ngrok-free.app/api/notifications/list - application/json; charset=utf-8 48
2025-02-02 00:28:49.834 +03:00 [INF] Executing endpoint 'NayifatAPI.Controllers.NotificationsController.GetNotifications (NayifatAPI)'
2025-02-02 00:28:49.840 +03:00 [INF] Route matched with {action = "GetNotifications", controller = "Notifications"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetNotifications(NayifatAPI.Controllers.GetNotificationsRequest) on controller NayifatAPI.Controllers.NotificationsController (NayifatAPI).
2025-02-02 00:28:49.939 +03:00 [INF] Executing BadRequestObjectResult, writing value of type 'Microsoft.AspNetCore.Mvc.ValidationProblemDetails'.
2025-02-02 00:28:49.950 +03:00 [INF] Executed action NayifatAPI.Controllers.NotificationsController.GetNotifications (NayifatAPI) in 12.2879ms
2025-02-02 00:28:49.955 +03:00 [INF] Executed endpoint 'NayifatAPI.Controllers.NotificationsController.GetNotifications (NayifatAPI)'
2025-02-02 00:28:49.957 +03:00 [INF] Request finished HTTP/1.1 POST http://957c-51-252-155-185.ngrok-free.app/api/notifications/list - 400 null application/problem+json; charset=utf-8 205.526ms
2025-02-02 00:32:16.971 +03:00 [INF] Request starting HTTP/1.1 POST http://957c-51-252-155-185.ngrok-free.app/api/notifications/list - application/json; charset=utf-8 47
2025-02-02 00:32:16.974 +03:00 [INF] Executing endpoint 'NayifatAPI.Controllers.NotificationsController.GetNotifications (NayifatAPI)'
2025-02-02 00:32:16.976 +03:00 [INF] Route matched with {action = "GetNotifications", controller = "Notifications"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetNotifications(NayifatAPI.Controllers.GetNotificationsRequest) on controller NayifatAPI.Controllers.NotificationsController (NayifatAPI).
2025-02-02 00:32:17.798 +03:00 [INF] Executed DbCommand (81ms) [Parameters=[@__providedApiKey_0='?' (Size = 255)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [a].[Key], [a].[CreatedAt], [a].[Description], [a].[ExpiresAt], [a].[IsActive], [a].[LastUsedAt]
FROM [ApiKeys] AS [a]
WHERE [a].[Key] = @__providedApiKey_0 AND [a].[IsActive] = CAST(1 AS bit)
2025-02-02 00:32:18.275 +03:00 [INF] Executed DbCommand (76ms) [Parameters=[@__request_NationalId_0='?' (Size = 450)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [u].[national_id], [u].[last_updated], [u].[notifications]
FROM [user_notifications] AS [u]
WHERE [u].[national_id] = @__request_NationalId_0
2025-02-02 00:32:18.500 +03:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType9`2[[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Object, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-02-02 00:32:18.511 +03:00 [INF] Executed action NayifatAPI.Controllers.NotificationsController.GetNotifications (NayifatAPI) in 1532.7187ms
2025-02-02 00:32:18.517 +03:00 [INF] Executed endpoint 'NayifatAPI.Controllers.NotificationsController.GetNotifications (NayifatAPI)'
2025-02-02 00:32:18.518 +03:00 [INF] Request finished HTTP/1.1 POST http://957c-51-252-155-185.ngrok-free.app/api/notifications/list - 200 null application/json; charset=utf-8 1547.1023ms
2025-02-02 00:33:01.764 +03:00 [INF] Request starting HTTP/1.1 POST http://957c-51-252-155-185.ngrok-free.app/api/notifications/list - application/json; charset=utf-8 47
2025-02-02 00:33:01.768 +03:00 [INF] Executing endpoint 'NayifatAPI.Controllers.NotificationsController.GetNotifications (NayifatAPI)'
2025-02-02 00:33:01.769 +03:00 [INF] Route matched with {action = "GetNotifications", controller = "Notifications"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetNotifications(NayifatAPI.Controllers.GetNotificationsRequest) on controller NayifatAPI.Controllers.NotificationsController (NayifatAPI).
2025-02-02 00:33:01.775 +03:00 [INF] Executed DbCommand (3ms) [Parameters=[@__providedApiKey_0='?' (Size = 255)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [a].[Key], [a].[CreatedAt], [a].[Description], [a].[ExpiresAt], [a].[IsActive], [a].[LastUsedAt]
FROM [ApiKeys] AS [a]
WHERE [a].[Key] = @__providedApiKey_0 AND [a].[IsActive] = CAST(1 AS bit)
2025-02-02 00:33:01.780 +03:00 [INF] Executed DbCommand (2ms) [Parameters=[@__request_NationalId_0='?' (Size = 450)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [u].[national_id], [u].[last_updated], [u].[notifications]
FROM [user_notifications] AS [u]
WHERE [u].[national_id] = @__request_NationalId_0
2025-02-02 00:33:01.782 +03:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType9`2[[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Object, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-02-02 00:33:01.783 +03:00 [INF] Executed action NayifatAPI.Controllers.NotificationsController.GetNotifications (NayifatAPI) in 12.6931ms
2025-02-02 00:33:01.784 +03:00 [INF] Executed endpoint 'NayifatAPI.Controllers.NotificationsController.GetNotifications (NayifatAPI)'
2025-02-02 00:33:01.785 +03:00 [INF] Request finished HTTP/1.1 POST http://957c-51-252-155-185.ngrok-free.app/api/notifications/list - 200 null application/json; charset=utf-8 21.3553ms
2025-02-02 00:35:17.920 +03:00 [INF] Request starting HTTP/1.1 POST http://localhost:5264/api/notifications/list - application/json 47
2025-02-02 00:35:17.922 +03:00 [INF] Executing endpoint 'NayifatAPI.Controllers.NotificationsController.GetNotifications (NayifatAPI)'
2025-02-02 00:35:17.923 +03:00 [INF] Route matched with {action = "GetNotifications", controller = "Notifications"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetNotifications(NayifatAPI.Controllers.GetNotificationsRequest) on controller NayifatAPI.Controllers.NotificationsController (NayifatAPI).
2025-02-02 00:35:17.930 +03:00 [INF] Executed DbCommand (4ms) [Parameters=[@__providedApiKey_0='?' (Size = 255)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [a].[Key], [a].[CreatedAt], [a].[Description], [a].[ExpiresAt], [a].[IsActive], [a].[LastUsedAt]
FROM [ApiKeys] AS [a]
WHERE [a].[Key] = @__providedApiKey_0 AND [a].[IsActive] = CAST(1 AS bit)
2025-02-02 00:35:17.938 +03:00 [INF] Executed DbCommand (2ms) [Parameters=[@__request_NationalId_0='?' (Size = 450)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [u].[national_id], [u].[last_updated], [u].[notifications]
FROM [user_notifications] AS [u]
WHERE [u].[national_id] = @__request_NationalId_0
2025-02-02 00:35:17.940 +03:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType9`2[[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Object, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-02-02 00:35:17.942 +03:00 [INF] Executed action NayifatAPI.Controllers.NotificationsController.GetNotifications (NayifatAPI) in 17.3595ms
2025-02-02 00:35:17.943 +03:00 [INF] Executed endpoint 'NayifatAPI.Controllers.NotificationsController.GetNotifications (NayifatAPI)'
2025-02-02 00:35:17.946 +03:00 [INF] Request finished HTTP/1.1 POST http://localhost:5264/api/notifications/list - 200 null application/json; charset=utf-8 24.1819ms
2025-02-02 00:35:34.650 +03:00 [INF] Request starting HTTP/1.1 POST http://957c-51-252-155-185.ngrok-free.app/api/notifications/list - application/json; charset=utf-8 47
2025-02-02 00:35:34.738 +03:00 [INF] Executing endpoint 'NayifatAPI.Controllers.NotificationsController.GetNotifications (NayifatAPI)'
2025-02-02 00:35:34.739 +03:00 [INF] Route matched with {action = "GetNotifications", controller = "Notifications"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetNotifications(NayifatAPI.Controllers.GetNotificationsRequest) on controller NayifatAPI.Controllers.NotificationsController (NayifatAPI).
2025-02-02 00:35:34.807 +03:00 [INF] Executed DbCommand (66ms) [Parameters=[@__providedApiKey_0='?' (Size = 255)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [a].[Key], [a].[CreatedAt], [a].[Description], [a].[ExpiresAt], [a].[IsActive], [a].[LastUsedAt]
FROM [ApiKeys] AS [a]
WHERE [a].[Key] = @__providedApiKey_0 AND [a].[IsActive] = CAST(1 AS bit)
2025-02-02 00:35:34.892 +03:00 [INF] Executed DbCommand (79ms) [Parameters=[@__request_NationalId_0='?' (Size = 450)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [u].[national_id], [u].[last_updated], [u].[notifications]
FROM [user_notifications] AS [u]
WHERE [u].[national_id] = @__request_NationalId_0
2025-02-02 00:35:35.033 +03:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType9`2[[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Object, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-02-02 00:35:35.035 +03:00 [INF] Executed action NayifatAPI.Controllers.NotificationsController.GetNotifications (NayifatAPI) in 295.1445ms
2025-02-02 00:35:35.038 +03:00 [INF] Executed endpoint 'NayifatAPI.Controllers.NotificationsController.GetNotifications (NayifatAPI)'
2025-02-02 00:35:35.053 +03:00 [INF] Request finished HTTP/1.1 POST http://957c-51-252-155-185.ngrok-free.app/api/notifications/list - 200 null application/json; charset=utf-8 388.8009ms
2025-02-02 00:38:05.853 +03:00 [INF] Request starting HTTP/1.1 POST http://957c-51-252-155-185.ngrok-free.app/api/notifications/list - application/json; charset=utf-8 47
2025-02-02 00:38:05.856 +03:00 [INF] Executing endpoint 'NayifatAPI.Controllers.NotificationsController.GetNotifications (NayifatAPI)'
2025-02-02 00:38:05.857 +03:00 [INF] Route matched with {action = "GetNotifications", controller = "Notifications"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetNotifications(NayifatAPI.Controllers.GetNotificationsRequest) on controller NayifatAPI.Controllers.NotificationsController (NayifatAPI).
2025-02-02 00:38:05.920 +03:00 [INF] Executed DbCommand (26ms) [Parameters=[@__providedApiKey_0='?' (Size = 255)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [a].[Key], [a].[CreatedAt], [a].[Description], [a].[ExpiresAt], [a].[IsActive], [a].[LastUsedAt]
FROM [ApiKeys] AS [a]
WHERE [a].[Key] = @__providedApiKey_0 AND [a].[IsActive] = CAST(1 AS bit)
2025-02-02 00:38:06.023 +03:00 [INF] Executed DbCommand (20ms) [Parameters=[@__request_NationalId_0='?' (Size = 450)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [u].[national_id], [u].[last_updated], [u].[notifications]
FROM [user_notifications] AS [u]
WHERE [u].[national_id] = @__request_NationalId_0
2025-02-02 00:38:06.097 +03:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType9`2[[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Object, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-02-02 00:38:06.114 +03:00 [INF] Executed action NayifatAPI.Controllers.NotificationsController.GetNotifications (NayifatAPI) in 254.4569ms
2025-02-02 00:38:06.153 +03:00 [INF] Executed endpoint 'NayifatAPI.Controllers.NotificationsController.GetNotifications (NayifatAPI)'
2025-02-02 00:38:06.193 +03:00 [INF] Request finished HTTP/1.1 POST http://957c-51-252-155-185.ngrok-free.app/api/notifications/list - 200 null application/json; charset=utf-8 339.5697ms
2025-02-02 00:38:29.456 +03:00 [INF] Request starting HTTP/1.1 POST http://957c-51-252-155-185.ngrok-free.app/api/notifications/list - application/json; charset=utf-8 47
2025-02-02 00:38:29.489 +03:00 [INF] Executing endpoint 'NayifatAPI.Controllers.NotificationsController.GetNotifications (NayifatAPI)'
2025-02-02 00:38:29.505 +03:00 [INF] Route matched with {action = "GetNotifications", controller = "Notifications"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetNotifications(NayifatAPI.Controllers.GetNotificationsRequest) on controller NayifatAPI.Controllers.NotificationsController (NayifatAPI).
2025-02-02 00:38:29.516 +03:00 [INF] Executed DbCommand (2ms) [Parameters=[@__providedApiKey_0='?' (Size = 255)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [a].[Key], [a].[CreatedAt], [a].[Description], [a].[ExpiresAt], [a].[IsActive], [a].[LastUsedAt]
FROM [ApiKeys] AS [a]
WHERE [a].[Key] = @__providedApiKey_0 AND [a].[IsActive] = CAST(1 AS bit)
2025-02-02 00:38:29.532 +03:00 [INF] Executed DbCommand (5ms) [Parameters=[@__request_NationalId_0='?' (Size = 450)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [u].[national_id], [u].[last_updated], [u].[notifications]
FROM [user_notifications] AS [u]
WHERE [u].[national_id] = @__request_NationalId_0
2025-02-02 00:38:29.548 +03:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType9`2[[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Object, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-02-02 00:38:29.568 +03:00 [INF] Executed action NayifatAPI.Controllers.NotificationsController.GetNotifications (NayifatAPI) in 55.316ms
2025-02-02 00:38:29.581 +03:00 [INF] Executed endpoint 'NayifatAPI.Controllers.NotificationsController.GetNotifications (NayifatAPI)'
2025-02-02 00:38:29.583 +03:00 [INF] Request finished HTTP/1.1 POST http://957c-51-252-155-185.ngrok-free.app/api/notifications/list - 200 null application/json; charset=utf-8 127.6071ms
2025-02-02 00:38:48.646 +03:00 [INF] Request starting HTTP/1.1 POST http://957c-51-252-155-185.ngrok-free.app/api/device/unregister - application/json; charset=utf-8 174
2025-02-02 00:38:48.649 +03:00 [INF] Request finished HTTP/1.1 POST http://957c-51-252-155-185.ngrok-free.app/api/device/unregister - 404 0 null 2.7196ms
2025-02-02 00:38:48.651 +03:00 [INF] Request reached the end of the middleware pipeline without being handled by application code. Request path: POST http://957c-51-252-155-185.ngrok-free.app/api/device/unregister, Response status code: 404
2025-02-02 00:38:50.523 +03:00 [INF] Request starting HTTP/1.1 POST http://957c-51-252-155-185.ngrok-free.app/api/notifications/list - application/json; charset=utf-8 47
2025-02-02 00:38:50.528 +03:00 [INF] Executing endpoint 'NayifatAPI.Controllers.NotificationsController.GetNotifications (NayifatAPI)'
2025-02-02 00:38:50.529 +03:00 [INF] Route matched with {action = "GetNotifications", controller = "Notifications"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetNotifications(NayifatAPI.Controllers.GetNotificationsRequest) on controller NayifatAPI.Controllers.NotificationsController (NayifatAPI).
2025-02-02 00:38:50.532 +03:00 [INF] Executed DbCommand (0ms) [Parameters=[@__providedApiKey_0='?' (Size = 255)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [a].[Key], [a].[CreatedAt], [a].[Description], [a].[ExpiresAt], [a].[IsActive], [a].[LastUsedAt]
FROM [ApiKeys] AS [a]
WHERE [a].[Key] = @__providedApiKey_0 AND [a].[IsActive] = CAST(1 AS bit)
2025-02-02 00:38:50.535 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@__request_NationalId_0='?' (Size = 450)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [u].[national_id], [u].[last_updated], [u].[notifications]
FROM [user_notifications] AS [u]
WHERE [u].[national_id] = @__request_NationalId_0
2025-02-02 00:38:50.538 +03:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType9`2[[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Object, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-02-02 00:38:50.539 +03:00 [INF] Executed action NayifatAPI.Controllers.NotificationsController.GetNotifications (NayifatAPI) in 8.3838ms
2025-02-02 00:38:50.540 +03:00 [INF] Executed endpoint 'NayifatAPI.Controllers.NotificationsController.GetNotifications (NayifatAPI)'
2025-02-02 00:38:50.541 +03:00 [INF] Request finished HTTP/1.1 POST http://957c-51-252-155-185.ngrok-free.app/api/notifications/list - 200 null application/json; charset=utf-8 17.2963ms
2025-02-02 00:39:03.088 +03:00 [INF] Request starting HTTP/1.1 POST http://957c-51-252-155-185.ngrok-free.app/api/auth/signin - application/json; charset=utf-8 227
2025-02-02 00:39:03.091 +03:00 [INF] Executing endpoint 'NayifatAPI.Controllers.AuthController.SignIn (NayifatAPI)'
2025-02-02 00:39:03.092 +03:00 [INF] Route matched with {action = "SignIn", controller = "Auth"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] SignIn(NayifatAPI.Controllers.SignInRequest) on controller NayifatAPI.Controllers.AuthController (NayifatAPI).
2025-02-02 00:39:03.094 +03:00 [INF] Executing BadRequestObjectResult, writing value of type 'Microsoft.AspNetCore.Mvc.ValidationProblemDetails'.
2025-02-02 00:39:03.096 +03:00 [INF] Executed action NayifatAPI.Controllers.AuthController.SignIn (NayifatAPI) in 2.2953ms
2025-02-02 00:39:03.097 +03:00 [INF] Executed endpoint 'NayifatAPI.Controllers.AuthController.SignIn (NayifatAPI)'
2025-02-02 00:39:03.098 +03:00 [INF] Request finished HTTP/1.1 POST http://957c-51-252-155-185.ngrok-free.app/api/auth/signin - 400 null application/problem+json; charset=utf-8 9.9505ms
2025-02-02 00:39:20.473 +03:00 [INF] Request starting HTTP/1.1 POST http://957c-51-252-155-185.ngrok-free.app/api/auth/signin - application/json; charset=utf-8 225
2025-02-02 00:39:20.512 +03:00 [INF] Executing endpoint 'NayifatAPI.Controllers.AuthController.SignIn (NayifatAPI)'
2025-02-02 00:39:20.513 +03:00 [INF] Route matched with {action = "SignIn", controller = "Auth"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] SignIn(NayifatAPI.Controllers.SignInRequest) on controller NayifatAPI.Controllers.AuthController (NayifatAPI).
2025-02-02 00:39:20.516 +03:00 [INF] Executing BadRequestObjectResult, writing value of type 'Microsoft.AspNetCore.Mvc.ValidationProblemDetails'.
2025-02-02 00:39:20.517 +03:00 [INF] Executed action NayifatAPI.Controllers.AuthController.SignIn (NayifatAPI) in 2.1469ms
2025-02-02 00:39:20.518 +03:00 [INF] Executed endpoint 'NayifatAPI.Controllers.AuthController.SignIn (NayifatAPI)'
2025-02-02 00:39:20.519 +03:00 [INF] Request finished HTTP/1.1 POST http://957c-51-252-155-185.ngrok-free.app/api/auth/signin - 400 null application/problem+json; charset=utf-8 45.9957ms
2025-02-02 00:39:38.380 +03:00 [INF] Request starting HTTP/1.1 POST http://957c-51-252-155-185.ngrok-free.app/api/auth/signin - application/json; charset=utf-8 225
2025-02-02 00:39:38.385 +03:00 [INF] Executing endpoint 'NayifatAPI.Controllers.AuthController.SignIn (NayifatAPI)'
2025-02-02 00:39:38.385 +03:00 [INF] Route matched with {action = "SignIn", controller = "Auth"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] SignIn(NayifatAPI.Controllers.SignInRequest) on controller NayifatAPI.Controllers.AuthController (NayifatAPI).
2025-02-02 00:39:38.387 +03:00 [INF] Executing BadRequestObjectResult, writing value of type 'Microsoft.AspNetCore.Mvc.ValidationProblemDetails'.
2025-02-02 00:39:38.388 +03:00 [INF] Executed action NayifatAPI.Controllers.AuthController.SignIn (NayifatAPI) in 1.7075ms
2025-02-02 00:39:38.389 +03:00 [INF] Executed endpoint 'NayifatAPI.Controllers.AuthController.SignIn (NayifatAPI)'
2025-02-02 00:39:38.390 +03:00 [INF] Request finished HTTP/1.1 POST http://957c-51-252-155-185.ngrok-free.app/api/auth/signin - 400 null application/problem+json; charset=utf-8 10.32ms
2025-02-02 00:43:07.796 +03:00 [INF] Request starting HTTP/1.1 POST http://957c-51-252-155-185.ngrok-free.app/api/notifications/list - application/json; charset=utf-8 47
2025-02-02 00:43:07.807 +03:00 [INF] Executing endpoint 'NayifatAPI.Controllers.NotificationsController.GetNotifications (NayifatAPI)'
2025-02-02 00:43:07.808 +03:00 [INF] Route matched with {action = "GetNotifications", controller = "Notifications"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetNotifications(NayifatAPI.Controllers.GetNotificationsRequest) on controller NayifatAPI.Controllers.NotificationsController (NayifatAPI).
2025-02-02 00:43:07.815 +03:00 [INF] Executed DbCommand (3ms) [Parameters=[@__providedApiKey_0='?' (Size = 255)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [a].[Key], [a].[CreatedAt], [a].[Description], [a].[ExpiresAt], [a].[IsActive], [a].[LastUsedAt]
FROM [ApiKeys] AS [a]
WHERE [a].[Key] = @__providedApiKey_0 AND [a].[IsActive] = CAST(1 AS bit)
2025-02-02 00:43:07.878 +03:00 [INF] Executed DbCommand (61ms) [Parameters=[@__request_NationalId_0='?' (Size = 450)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [u].[national_id], [u].[last_updated], [u].[notifications]
FROM [user_notifications] AS [u]
WHERE [u].[national_id] = @__request_NationalId_0
2025-02-02 00:43:08.080 +03:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType9`2[[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Object, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-02-02 00:43:08.081 +03:00 [INF] Executed action NayifatAPI.Controllers.NotificationsController.GetNotifications (NayifatAPI) in 272.3684ms
2025-02-02 00:43:08.083 +03:00 [INF] Executed endpoint 'NayifatAPI.Controllers.NotificationsController.GetNotifications (NayifatAPI)'
2025-02-02 00:43:08.084 +03:00 [INF] Request finished HTTP/1.1 POST http://957c-51-252-155-185.ngrok-free.app/api/notifications/list - 200 null application/json; charset=utf-8 288.6827ms
2025-02-02 00:43:24.835 +03:00 [INF] Request starting HTTP/1.1 POST http://957c-51-252-155-185.ngrok-free.app/api/auth/signin - application/json; charset=utf-8 224
2025-02-02 00:43:24.839 +03:00 [INF] Executing endpoint 'NayifatAPI.Controllers.AuthController.SignIn (NayifatAPI)'
2025-02-02 00:43:24.840 +03:00 [INF] Route matched with {action = "SignIn", controller = "Auth"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] SignIn(NayifatAPI.Controllers.SignInRequest) on controller NayifatAPI.Controllers.AuthController (NayifatAPI).
2025-02-02 00:43:24.849 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@__providedApiKey_0='?' (Size = 255)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [a].[Key], [a].[CreatedAt], [a].[Description], [a].[ExpiresAt], [a].[IsActive], [a].[LastUsedAt]
FROM [ApiKeys] AS [a]
WHERE [a].[Key] = @__providedApiKey_0 AND [a].[IsActive] = CAST(1 AS bit)
2025-02-02 00:43:24.936 +03:00 [INF] Executed DbCommand (78ms) [Parameters=[@__request_NationalId_0='?' (Size = 450)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [c].[NationalId], [c].[AddNo], [c].[BuildingNo], [c].[City], [c].[Consent], [c].[ConsentDate], [c].[DateOfBirth], [c].[Dependents], [c].[District], [c].[Email], [c].[Employer], [c].[FamilyNameAr], [c].[FamilyNameEn], [c].[FirstNameAr], [c].[FirstNameEn], [c].[Iban], [c].[IdExpiryDate], [c].[Los], [c].[Mpin], [c].[MpinEnabled], [c].[NafathStatus], [c].[NafathTimestamp], [c].[Password], [c].[Phone], [c].[RegistrationDate], [c].[SalaryCustomer], [c].[SalaryDakhli], [c].[SecondNameAr], [c].[SecondNameEn], [c].[Sector], [c].[Street], [c].[ThirdNameAr], [c].[ThirdNameEn], [c].[Zipcode]
FROM [Customers] AS [c]
WHERE [c].[NationalId] = @__request_NationalId_0
2025-02-02 00:43:25.189 +03:00 [INF] Executed DbCommand (218ms) [Parameters=[@p0='?' (Size = 4000), @p1='?' (DbType = DateTime2), @p2='?' (Size = 4000), @p3='?' (Size = 4000), @p4='?' (Size = 4000), @p5='?' (Size = 450), @p6='?' (Size = 4000), @p7='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SET IMPLICIT_TRANSACTIONS OFF;
SET NOCOUNT ON;
INSERT INTO [AuthLogs] ([AuthType], [CreatedAt], [DeviceId], [FailureReason], [IpAddress], [NationalId], [Status], [UserAgent])
OUTPUT INSERTED.[Id]
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7);
2025-02-02 00:43:25.201 +03:00 [INF] Executing ObjectResult, writing value of type '<>f__AnonymousType12`3[[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Object, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-02-02 00:43:25.205 +03:00 [INF] Executed action NayifatAPI.Controllers.AuthController.SignIn (NayifatAPI) in 361.6266ms
2025-02-02 00:43:25.206 +03:00 [INF] Executed endpoint 'NayifatAPI.Controllers.AuthController.SignIn (NayifatAPI)'
2025-02-02 00:43:25.208 +03:00 [INF] Request finished HTTP/1.1 POST http://957c-51-252-155-185.ngrok-free.app/api/auth/signin - 401 null application/json; charset=utf-8 372.9728ms
2025-02-02 00:43:30.761 +03:00 [INF] Request starting HTTP/1.1 POST http://957c-51-252-155-185.ngrok-free.app/api/notifications/list - application/json; charset=utf-8 47
2025-02-02 00:43:30.763 +03:00 [INF] Executing endpoint 'NayifatAPI.Controllers.NotificationsController.GetNotifications (NayifatAPI)'
2025-02-02 00:43:30.765 +03:00 [INF] Route matched with {action = "GetNotifications", controller = "Notifications"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetNotifications(NayifatAPI.Controllers.GetNotificationsRequest) on controller NayifatAPI.Controllers.NotificationsController (NayifatAPI).
2025-02-02 00:43:30.771 +03:00 [INF] Executed DbCommand (4ms) [Parameters=[@__providedApiKey_0='?' (Size = 255)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [a].[Key], [a].[CreatedAt], [a].[Description], [a].[ExpiresAt], [a].[IsActive], [a].[LastUsedAt]
FROM [ApiKeys] AS [a]
WHERE [a].[Key] = @__providedApiKey_0 AND [a].[IsActive] = CAST(1 AS bit)
2025-02-02 00:43:30.776 +03:00 [INF] Executed DbCommand (3ms) [Parameters=[@__request_NationalId_0='?' (Size = 450)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [u].[national_id], [u].[last_updated], [u].[notifications]
FROM [user_notifications] AS [u]
WHERE [u].[national_id] = @__request_NationalId_0
2025-02-02 00:43:30.778 +03:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType9`2[[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Object, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-02-02 00:43:30.780 +03:00 [INF] Executed action NayifatAPI.Controllers.NotificationsController.GetNotifications (NayifatAPI) in 13.3326ms
2025-02-02 00:43:30.781 +03:00 [INF] Executed endpoint 'NayifatAPI.Controllers.NotificationsController.GetNotifications (NayifatAPI)'
2025-02-02 00:43:30.782 +03:00 [INF] Request finished HTTP/1.1 POST http://957c-51-252-155-185.ngrok-free.app/api/notifications/list - 200 null application/json; charset=utf-8 21.4051ms
2025-02-02 00:43:51.447 +03:00 [INF] Request starting HTTP/1.1 POST http://957c-51-252-155-185.ngrok-free.app/api/notifications/list - application/json; charset=utf-8 47
2025-02-02 00:43:51.450 +03:00 [INF] Executing endpoint 'NayifatAPI.Controllers.NotificationsController.GetNotifications (NayifatAPI)'
2025-02-02 00:43:51.450 +03:00 [INF] Route matched with {action = "GetNotifications", controller = "Notifications"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetNotifications(NayifatAPI.Controllers.GetNotificationsRequest) on controller NayifatAPI.Controllers.NotificationsController (NayifatAPI).
2025-02-02 00:43:51.455 +03:00 [INF] Executed DbCommand (2ms) [Parameters=[@__providedApiKey_0='?' (Size = 255)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [a].[Key], [a].[CreatedAt], [a].[Description], [a].[ExpiresAt], [a].[IsActive], [a].[LastUsedAt]
FROM [ApiKeys] AS [a]
WHERE [a].[Key] = @__providedApiKey_0 AND [a].[IsActive] = CAST(1 AS bit)
2025-02-02 00:43:51.460 +03:00 [INF] Executed DbCommand (2ms) [Parameters=[@__request_NationalId_0='?' (Size = 450)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [u].[national_id], [u].[last_updated], [u].[notifications]
FROM [user_notifications] AS [u]
WHERE [u].[national_id] = @__request_NationalId_0
2025-02-02 00:43:51.462 +03:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType9`2[[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Object, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-02-02 00:43:51.463 +03:00 [INF] Executed action NayifatAPI.Controllers.NotificationsController.GetNotifications (NayifatAPI) in 11.51ms
2025-02-02 00:43:51.480 +03:00 [INF] Executed endpoint 'NayifatAPI.Controllers.NotificationsController.GetNotifications (NayifatAPI)'
2025-02-02 00:43:51.482 +03:00 [INF] Request finished HTTP/1.1 POST http://957c-51-252-155-185.ngrok-free.app/api/notifications/list - 200 null application/json; charset=utf-8 34.8183ms
2025-02-02 00:44:30.508 +03:00 [INF] Request starting HTTP/1.1 POST http://localhost:5264/api/auth/signin - application/json 236
2025-02-02 00:44:30.510 +03:00 [INF] Executing endpoint 'NayifatAPI.Controllers.AuthController.SignIn (NayifatAPI)'
2025-02-02 00:44:30.511 +03:00 [INF] Route matched with {action = "SignIn", controller = "Auth"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] SignIn(NayifatAPI.Controllers.SignInRequest) on controller NayifatAPI.Controllers.AuthController (NayifatAPI).
2025-02-02 00:44:30.515 +03:00 [INF] Executed DbCommand (0ms) [Parameters=[@__providedApiKey_0='?' (Size = 255)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [a].[Key], [a].[CreatedAt], [a].[Description], [a].[ExpiresAt], [a].[IsActive], [a].[LastUsedAt]
FROM [ApiKeys] AS [a]
WHERE [a].[Key] = @__providedApiKey_0 AND [a].[IsActive] = CAST(1 AS bit)
2025-02-02 00:44:30.520 +03:00 [INF] Executed DbCommand (3ms) [Parameters=[@__request_NationalId_0='?' (Size = 450)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [c].[NationalId], [c].[AddNo], [c].[BuildingNo], [c].[City], [c].[Consent], [c].[ConsentDate], [c].[DateOfBirth], [c].[Dependents], [c].[District], [c].[Email], [c].[Employer], [c].[FamilyNameAr], [c].[FamilyNameEn], [c].[FirstNameAr], [c].[FirstNameEn], [c].[Iban], [c].[IdExpiryDate], [c].[Los], [c].[Mpin], [c].[MpinEnabled], [c].[NafathStatus], [c].[NafathTimestamp], [c].[Password], [c].[Phone], [c].[RegistrationDate], [c].[SalaryCustomer], [c].[SalaryDakhli], [c].[SecondNameAr], [c].[SecondNameEn], [c].[Sector], [c].[Street], [c].[ThirdNameAr], [c].[ThirdNameEn], [c].[Zipcode]
FROM [Customers] AS [c]
WHERE [c].[NationalId] = @__request_NationalId_0
2025-02-02 00:44:30.600 +03:00 [INF] Executed DbCommand (76ms) [Parameters=[@p0='?' (Size = 4000), @p1='?' (DbType = DateTime2), @p2='?' (Size = 4000), @p3='?' (Size = 4000), @p4='?' (Size = 4000), @p5='?' (Size = 450), @p6='?' (Size = 4000), @p7='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SET IMPLICIT_TRANSACTIONS OFF;
SET NOCOUNT ON;
INSERT INTO [AuthLogs] ([AuthType], [CreatedAt], [DeviceId], [FailureReason], [IpAddress], [NationalId], [Status], [UserAgent])
OUTPUT INSERTED.[Id]
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7);
2025-02-02 00:44:30.603 +03:00 [INF] Executing ObjectResult, writing value of type '<>f__AnonymousType12`3[[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Object, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-02-02 00:44:30.604 +03:00 [INF] Executed action NayifatAPI.Controllers.AuthController.SignIn (NayifatAPI) in 91.8785ms
2025-02-02 00:44:30.605 +03:00 [INF] Executed endpoint 'NayifatAPI.Controllers.AuthController.SignIn (NayifatAPI)'
2025-02-02 00:44:30.606 +03:00 [INF] Request finished HTTP/1.1 POST http://localhost:5264/api/auth/signin - 401 null application/json; charset=utf-8 98.1111ms
2025-02-02 00:45:13.021 +03:00 [INF] Request starting HTTP/1.1 POST http://localhost:5264/api/auth/signin - application/json 288
2025-02-02 00:45:13.024 +03:00 [INF] Executing endpoint 'NayifatAPI.Controllers.AuthController.SignIn (NayifatAPI)'
2025-02-02 00:45:13.025 +03:00 [INF] Route matched with {action = "SignIn", controller = "Auth"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] SignIn(NayifatAPI.Controllers.SignInRequest) on controller NayifatAPI.Controllers.AuthController (NayifatAPI).
2025-02-02 00:45:13.031 +03:00 [INF] Executed DbCommand (3ms) [Parameters=[@__providedApiKey_0='?' (Size = 255)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [a].[Key], [a].[CreatedAt], [a].[Description], [a].[ExpiresAt], [a].[IsActive], [a].[LastUsedAt]
FROM [ApiKeys] AS [a]
WHERE [a].[Key] = @__providedApiKey_0 AND [a].[IsActive] = CAST(1 AS bit)
2025-02-02 00:45:13.038 +03:00 [INF] Executed DbCommand (3ms) [Parameters=[@__request_NationalId_0='?' (Size = 450)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [c].[NationalId], [c].[AddNo], [c].[BuildingNo], [c].[City], [c].[Consent], [c].[ConsentDate], [c].[DateOfBirth], [c].[Dependents], [c].[District], [c].[Email], [c].[Employer], [c].[FamilyNameAr], [c].[FamilyNameEn], [c].[FirstNameAr], [c].[FirstNameEn], [c].[Iban], [c].[IdExpiryDate], [c].[Los], [c].[Mpin], [c].[MpinEnabled], [c].[NafathStatus], [c].[NafathTimestamp], [c].[Password], [c].[Phone], [c].[RegistrationDate], [c].[SalaryCustomer], [c].[SalaryDakhli], [c].[SecondNameAr], [c].[SecondNameEn], [c].[Sector], [c].[Street], [c].[ThirdNameAr], [c].[ThirdNameEn], [c].[Zipcode]
FROM [Customers] AS [c]
WHERE [c].[NationalId] = @__request_NationalId_0
2025-02-02 00:45:13.053 +03:00 [INF] Executed DbCommand (2ms) [Parameters=[@__request_NationalId_0='?' (Size = 450), @__request_DeviceId_1='?' (Size = 450)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [c].[Id], [c].[BiometricEnabled], [c].[BiometricToken], [c].[CreatedAt], [c].[DeviceId], [c].[LastUsedAt], [c].[Manufacturer], [c].[Model], [c].[NationalId], [c].[OsVersion], [c].[Platform], [c].[Status]
FROM [Customer_Devices] AS [c]
WHERE [c].[NationalId] = @__request_NationalId_0 AND [c].[DeviceId] = @__request_DeviceId_1 AND [c].[Status] = N'active'
2025-02-02 00:45:13.136 +03:00 [INF] Executed DbCommand (77ms) [Parameters=[@p0='?' (Size = 4000), @p1='?' (DbType = DateTime2), @p2='?' (Size = 4000), @p3='?' (Size = 4000), @p4='?' (Size = 4000), @p5='?' (Size = 450), @p6='?' (Size = 4000), @p7='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SET IMPLICIT_TRANSACTIONS OFF;
SET NOCOUNT ON;
INSERT INTO [AuthLogs] ([AuthType], [CreatedAt], [DeviceId], [FailureReason], [IpAddress], [NationalId], [Status], [UserAgent])
OUTPUT INSERTED.[Id]
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7);
2025-02-02 00:45:13.139 +03:00 [INF] Executing ObjectResult, writing value of type '<>f__AnonymousType12`3[[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Object, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-02-02 00:45:13.141 +03:00 [INF] Executed action NayifatAPI.Controllers.AuthController.SignIn (NayifatAPI) in 114.0833ms
2025-02-02 00:45:13.142 +03:00 [INF] Executed endpoint 'NayifatAPI.Controllers.AuthController.SignIn (NayifatAPI)'
2025-02-02 00:45:13.143 +03:00 [INF] Request finished HTTP/1.1 POST http://localhost:5264/api/auth/signin - 401 null application/json; charset=utf-8 121.8161ms
2025-02-02 00:47:52.528 +03:00 [INF] Request starting HTTP/1.1 POST http://957c-51-252-155-185.ngrok-free.app/api/auth/signin - application/json; charset=utf-8 224
2025-02-02 00:47:52.531 +03:00 [INF] Executing endpoint 'NayifatAPI.Controllers.AuthController.SignIn (NayifatAPI)'
2025-02-02 00:47:52.532 +03:00 [INF] Route matched with {action = "SignIn", controller = "Auth"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] SignIn(NayifatAPI.Controllers.SignInRequest) on controller NayifatAPI.Controllers.AuthController (NayifatAPI).
2025-02-02 00:47:52.538 +03:00 [INF] Executed DbCommand (3ms) [Parameters=[@__providedApiKey_0='?' (Size = 255)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [a].[Key], [a].[CreatedAt], [a].[Description], [a].[ExpiresAt], [a].[IsActive], [a].[LastUsedAt]
FROM [ApiKeys] AS [a]
WHERE [a].[Key] = @__providedApiKey_0 AND [a].[IsActive] = CAST(1 AS bit)
2025-02-02 00:47:52.543 +03:00 [INF] Executed DbCommand (2ms) [Parameters=[@__request_NationalId_0='?' (Size = 450)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [c].[NationalId], [c].[AddNo], [c].[BuildingNo], [c].[City], [c].[Consent], [c].[ConsentDate], [c].[DateOfBirth], [c].[Dependents], [c].[District], [c].[Email], [c].[Employer], [c].[FamilyNameAr], [c].[FamilyNameEn], [c].[FirstNameAr], [c].[FirstNameEn], [c].[Iban], [c].[IdExpiryDate], [c].[Los], [c].[Mpin], [c].[MpinEnabled], [c].[NafathStatus], [c].[NafathTimestamp], [c].[Password], [c].[Phone], [c].[RegistrationDate], [c].[SalaryCustomer], [c].[SalaryDakhli], [c].[SecondNameAr], [c].[SecondNameEn], [c].[Sector], [c].[Street], [c].[ThirdNameAr], [c].[ThirdNameEn], [c].[Zipcode]
FROM [Customers] AS [c]
WHERE [c].[NationalId] = @__request_NationalId_0
2025-02-02 00:47:52.553 +03:00 [INF] Executed DbCommand (8ms) [Parameters=[@p0='?' (Size = 4000), @p1='?' (DbType = DateTime2), @p2='?' (Size = 4000), @p3='?' (Size = 4000), @p4='?' (Size = 4000), @p5='?' (Size = 450), @p6='?' (Size = 4000), @p7='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SET IMPLICIT_TRANSACTIONS OFF;
SET NOCOUNT ON;
INSERT INTO [AuthLogs] ([AuthType], [CreatedAt], [DeviceId], [FailureReason], [IpAddress], [NationalId], [Status], [UserAgent])
OUTPUT INSERTED.[Id]
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7);
2025-02-02 00:47:52.556 +03:00 [INF] Executing ObjectResult, writing value of type '<>f__AnonymousType12`3[[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Object, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-02-02 00:47:52.558 +03:00 [INF] Executed action NayifatAPI.Controllers.AuthController.SignIn (NayifatAPI) in 24.7449ms
2025-02-02 00:47:52.559 +03:00 [INF] Executed endpoint 'NayifatAPI.Controllers.AuthController.SignIn (NayifatAPI)'
2025-02-02 00:47:52.560 +03:00 [INF] Request finished HTTP/1.1 POST http://957c-51-252-155-185.ngrok-free.app/api/auth/signin - 401 null application/json; charset=utf-8 32.413ms
2025-02-02 00:47:56.304 +03:00 [INF] Request starting HTTP/1.1 POST http://957c-51-252-155-185.ngrok-free.app/api/notifications/list - application/json; charset=utf-8 47
2025-02-02 00:47:56.307 +03:00 [INF] Executing endpoint 'NayifatAPI.Controllers.NotificationsController.GetNotifications (NayifatAPI)'
2025-02-02 00:47:56.308 +03:00 [INF] Route matched with {action = "GetNotifications", controller = "Notifications"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetNotifications(NayifatAPI.Controllers.GetNotificationsRequest) on controller NayifatAPI.Controllers.NotificationsController (NayifatAPI).
2025-02-02 00:47:56.313 +03:00 [INF] Executed DbCommand (3ms) [Parameters=[@__providedApiKey_0='?' (Size = 255)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [a].[Key], [a].[CreatedAt], [a].[Description], [a].[ExpiresAt], [a].[IsActive], [a].[LastUsedAt]
FROM [ApiKeys] AS [a]
WHERE [a].[Key] = @__providedApiKey_0 AND [a].[IsActive] = CAST(1 AS bit)
2025-02-02 00:47:56.319 +03:00 [INF] Executed DbCommand (3ms) [Parameters=[@__request_NationalId_0='?' (Size = 450)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [u].[national_id], [u].[last_updated], [u].[notifications]
FROM [user_notifications] AS [u]
WHERE [u].[national_id] = @__request_NationalId_0
2025-02-02 00:47:56.320 +03:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType9`2[[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Object, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-02-02 00:47:56.322 +03:00 [INF] Executed action NayifatAPI.Controllers.NotificationsController.GetNotifications (NayifatAPI) in 12.7875ms
2025-02-02 00:47:56.323 +03:00 [INF] Executed endpoint 'NayifatAPI.Controllers.NotificationsController.GetNotifications (NayifatAPI)'
2025-02-02 00:47:56.324 +03:00 [INF] Request finished HTTP/1.1 POST http://957c-51-252-155-185.ngrok-free.app/api/notifications/list - 200 null application/json; charset=utf-8 19.5844ms
2025-02-02 00:48:04.280 +03:00 [INF] Request starting HTTP/1.1 POST http://957c-51-252-155-185.ngrok-free.app/api/auth/signin - application/json; charset=utf-8 224
2025-02-02 00:48:04.284 +03:00 [INF] Executing endpoint 'NayifatAPI.Controllers.AuthController.SignIn (NayifatAPI)'
2025-02-02 00:48:04.286 +03:00 [INF] Route matched with {action = "SignIn", controller = "Auth"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] SignIn(NayifatAPI.Controllers.SignInRequest) on controller NayifatAPI.Controllers.AuthController (NayifatAPI).
2025-02-02 00:48:04.289 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@__providedApiKey_0='?' (Size = 255)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [a].[Key], [a].[CreatedAt], [a].[Description], [a].[ExpiresAt], [a].[IsActive], [a].[LastUsedAt]
FROM [ApiKeys] AS [a]
WHERE [a].[Key] = @__providedApiKey_0 AND [a].[IsActive] = CAST(1 AS bit)
2025-02-02 00:48:04.294 +03:00 [INF] Executed DbCommand (3ms) [Parameters=[@__request_NationalId_0='?' (Size = 450)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [c].[NationalId], [c].[AddNo], [c].[BuildingNo], [c].[City], [c].[Consent], [c].[ConsentDate], [c].[DateOfBirth], [c].[Dependents], [c].[District], [c].[Email], [c].[Employer], [c].[FamilyNameAr], [c].[FamilyNameEn], [c].[FirstNameAr], [c].[FirstNameEn], [c].[Iban], [c].[IdExpiryDate], [c].[Los], [c].[Mpin], [c].[MpinEnabled], [c].[NafathStatus], [c].[NafathTimestamp], [c].[Password], [c].[Phone], [c].[RegistrationDate], [c].[SalaryCustomer], [c].[SalaryDakhli], [c].[SecondNameAr], [c].[SecondNameEn], [c].[Sector], [c].[Street], [c].[ThirdNameAr], [c].[ThirdNameEn], [c].[Zipcode]
FROM [Customers] AS [c]
WHERE [c].[NationalId] = @__request_NationalId_0
2025-02-02 00:48:04.374 +03:00 [INF] Executed DbCommand (76ms) [Parameters=[@p0='?' (Size = 4000), @p1='?' (DbType = DateTime2), @p2='?' (Size = 4000), @p3='?' (Size = 4000), @p4='?' (Size = 4000), @p5='?' (Size = 450), @p6='?' (Size = 4000), @p7='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SET IMPLICIT_TRANSACTIONS OFF;
SET NOCOUNT ON;
INSERT INTO [AuthLogs] ([AuthType], [CreatedAt], [DeviceId], [FailureReason], [IpAddress], [NationalId], [Status], [UserAgent])
OUTPUT INSERTED.[Id]
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7);
2025-02-02 00:48:04.378 +03:00 [INF] Executing ObjectResult, writing value of type '<>f__AnonymousType12`3[[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Object, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-02-02 00:48:04.379 +03:00 [INF] Executed action NayifatAPI.Controllers.AuthController.SignIn (NayifatAPI) in 91.8417ms
2025-02-02 00:48:04.380 +03:00 [INF] Executed endpoint 'NayifatAPI.Controllers.AuthController.SignIn (NayifatAPI)'
2025-02-02 00:48:04.381 +03:00 [INF] Request finished HTTP/1.1 POST http://957c-51-252-155-185.ngrok-free.app/api/auth/signin - 401 null application/json; charset=utf-8 100.2396ms
2025-02-02 00:48:07.232 +03:00 [INF] Request starting HTTP/1.1 POST http://957c-51-252-155-185.ngrok-free.app/api/notifications/list - application/json; charset=utf-8 47
2025-02-02 00:48:07.236 +03:00 [INF] Executing endpoint 'NayifatAPI.Controllers.NotificationsController.GetNotifications (NayifatAPI)'
2025-02-02 00:48:07.237 +03:00 [INF] Route matched with {action = "GetNotifications", controller = "Notifications"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetNotifications(NayifatAPI.Controllers.GetNotificationsRequest) on controller NayifatAPI.Controllers.NotificationsController (NayifatAPI).
2025-02-02 00:48:07.239 +03:00 [INF] Executed DbCommand (0ms) [Parameters=[@__providedApiKey_0='?' (Size = 255)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [a].[Key], [a].[CreatedAt], [a].[Description], [a].[ExpiresAt], [a].[IsActive], [a].[LastUsedAt]
FROM [ApiKeys] AS [a]
WHERE [a].[Key] = @__providedApiKey_0 AND [a].[IsActive] = CAST(1 AS bit)
2025-02-02 00:48:07.243 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@__request_NationalId_0='?' (Size = 450)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [u].[national_id], [u].[last_updated], [u].[notifications]
FROM [user_notifications] AS [u]
WHERE [u].[national_id] = @__request_NationalId_0
2025-02-02 00:48:07.245 +03:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType9`2[[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Object, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-02-02 00:48:07.246 +03:00 [INF] Executed action NayifatAPI.Controllers.NotificationsController.GetNotifications (NayifatAPI) in 7.5061ms
2025-02-02 00:48:07.247 +03:00 [INF] Executed endpoint 'NayifatAPI.Controllers.NotificationsController.GetNotifications (NayifatAPI)'
2025-02-02 00:48:07.248 +03:00 [INF] Request finished HTTP/1.1 POST http://957c-51-252-155-185.ngrok-free.app/api/notifications/list - 200 null application/json; charset=utf-8 16.9077ms
2025-02-02 00:48:17.431 +03:00 [INF] Request starting HTTP/1.1 POST http://957c-51-252-155-185.ngrok-free.app/api/auth/signin - application/json; charset=utf-8 224
2025-02-02 00:48:17.434 +03:00 [INF] Executing endpoint 'NayifatAPI.Controllers.AuthController.SignIn (NayifatAPI)'
2025-02-02 00:48:17.435 +03:00 [INF] Route matched with {action = "SignIn", controller = "Auth"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] SignIn(NayifatAPI.Controllers.SignInRequest) on controller NayifatAPI.Controllers.AuthController (NayifatAPI).
2025-02-02 00:48:17.438 +03:00 [INF] Executed DbCommand (0ms) [Parameters=[@__providedApiKey_0='?' (Size = 255)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [a].[Key], [a].[CreatedAt], [a].[Description], [a].[ExpiresAt], [a].[IsActive], [a].[LastUsedAt]
FROM [ApiKeys] AS [a]
WHERE [a].[Key] = @__providedApiKey_0 AND [a].[IsActive] = CAST(1 AS bit)
2025-02-02 00:48:17.440 +03:00 [INF] Executed DbCommand (0ms) [Parameters=[@__request_NationalId_0='?' (Size = 450)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [c].[NationalId], [c].[AddNo], [c].[BuildingNo], [c].[City], [c].[Consent], [c].[ConsentDate], [c].[DateOfBirth], [c].[Dependents], [c].[District], [c].[Email], [c].[Employer], [c].[FamilyNameAr], [c].[FamilyNameEn], [c].[FirstNameAr], [c].[FirstNameEn], [c].[Iban], [c].[IdExpiryDate], [c].[Los], [c].[Mpin], [c].[MpinEnabled], [c].[NafathStatus], [c].[NafathTimestamp], [c].[Password], [c].[Phone], [c].[RegistrationDate], [c].[SalaryCustomer], [c].[SalaryDakhli], [c].[SecondNameAr], [c].[SecondNameEn], [c].[Sector], [c].[Street], [c].[ThirdNameAr], [c].[ThirdNameEn], [c].[Zipcode]
FROM [Customers] AS [c]
WHERE [c].[NationalId] = @__request_NationalId_0
2025-02-02 00:48:17.516 +03:00 [INF] Executed DbCommand (73ms) [Parameters=[@p0='?' (Size = 4000), @p1='?' (DbType = DateTime2), @p2='?' (Size = 4000), @p3='?' (Size = 4000), @p4='?' (Size = 4000), @p5='?' (Size = 450), @p6='?' (Size = 4000), @p7='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SET IMPLICIT_TRANSACTIONS OFF;
SET NOCOUNT ON;
INSERT INTO [AuthLogs] ([AuthType], [CreatedAt], [DeviceId], [FailureReason], [IpAddress], [NationalId], [Status], [UserAgent])
OUTPUT INSERTED.[Id]
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7);
2025-02-02 00:48:17.520 +03:00 [INF] Executing ObjectResult, writing value of type '<>f__AnonymousType12`3[[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Object, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-02-02 00:48:17.522 +03:00 [INF] Executed action NayifatAPI.Controllers.AuthController.SignIn (NayifatAPI) in 85.071ms
2025-02-02 00:48:17.523 +03:00 [INF] Executed endpoint 'NayifatAPI.Controllers.AuthController.SignIn (NayifatAPI)'
2025-02-02 00:48:17.525 +03:00 [INF] Request finished HTTP/1.1 POST http://957c-51-252-155-185.ngrok-free.app/api/auth/signin - 401 null application/json; charset=utf-8 93.2344ms
2025-02-02 00:48:30.834 +03:00 [INF] Request starting HTTP/1.1 POST http://957c-51-252-155-185.ngrok-free.app/api/notifications/list - application/json; charset=utf-8 47
2025-02-02 00:48:30.843 +03:00 [INF] Executing endpoint 'NayifatAPI.Controllers.NotificationsController.GetNotifications (NayifatAPI)'
2025-02-02 00:48:30.844 +03:00 [INF] Route matched with {action = "GetNotifications", controller = "Notifications"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetNotifications(NayifatAPI.Controllers.GetNotificationsRequest) on controller NayifatAPI.Controllers.NotificationsController (NayifatAPI).
2025-02-02 00:48:30.848 +03:00 [INF] Executed DbCommand (0ms) [Parameters=[@__providedApiKey_0='?' (Size = 255)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [a].[Key], [a].[CreatedAt], [a].[Description], [a].[ExpiresAt], [a].[IsActive], [a].[LastUsedAt]
FROM [ApiKeys] AS [a]
WHERE [a].[Key] = @__providedApiKey_0 AND [a].[IsActive] = CAST(1 AS bit)
2025-02-02 00:48:30.851 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@__request_NationalId_0='?' (Size = 450)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [u].[national_id], [u].[last_updated], [u].[notifications]
FROM [user_notifications] AS [u]
WHERE [u].[national_id] = @__request_NationalId_0
2025-02-02 00:48:30.853 +03:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType9`2[[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Object, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-02-02 00:48:30.854 +03:00 [INF] Executed action NayifatAPI.Controllers.NotificationsController.GetNotifications (NayifatAPI) in 8.5537ms
2025-02-02 00:48:30.856 +03:00 [INF] Executed endpoint 'NayifatAPI.Controllers.NotificationsController.GetNotifications (NayifatAPI)'
2025-02-02 00:48:30.857 +03:00 [INF] Request finished HTTP/1.1 POST http://957c-51-252-155-185.ngrok-free.app/api/notifications/list - 200 null application/json; charset=utf-8 22.9536ms
2025-02-02 00:48:51.354 +03:00 [INF] Request starting HTTP/1.1 POST http://957c-51-252-155-185.ngrok-free.app/api/notifications/list - application/json; charset=utf-8 47
2025-02-02 00:48:51.418 +03:00 [INF] Executing endpoint 'NayifatAPI.Controllers.NotificationsController.GetNotifications (NayifatAPI)'
2025-02-02 00:48:51.432 +03:00 [INF] Route matched with {action = "GetNotifications", controller = "Notifications"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetNotifications(NayifatAPI.Controllers.GetNotificationsRequest) on controller NayifatAPI.Controllers.NotificationsController (NayifatAPI).
2025-02-02 00:48:51.470 +03:00 [INF] Executed DbCommand (9ms) [Parameters=[@__providedApiKey_0='?' (Size = 255)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [a].[Key], [a].[CreatedAt], [a].[Description], [a].[ExpiresAt], [a].[IsActive], [a].[LastUsedAt]
FROM [ApiKeys] AS [a]
WHERE [a].[Key] = @__providedApiKey_0 AND [a].[IsActive] = CAST(1 AS bit)
2025-02-02 00:48:51.479 +03:00 [INF] Executed DbCommand (7ms) [Parameters=[@__request_NationalId_0='?' (Size = 450)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [u].[national_id], [u].[last_updated], [u].[notifications]
FROM [user_notifications] AS [u]
WHERE [u].[national_id] = @__request_NationalId_0
2025-02-02 00:48:51.511 +03:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType9`2[[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Object, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-02-02 00:48:51.524 +03:00 [INF] Executed action NayifatAPI.Controllers.NotificationsController.GetNotifications (NayifatAPI) in 65.2485ms
2025-02-02 00:48:51.555 +03:00 [INF] Executed endpoint 'NayifatAPI.Controllers.NotificationsController.GetNotifications (NayifatAPI)'
2025-02-02 00:48:51.564 +03:00 [INF] Request finished HTTP/1.1 POST http://957c-51-252-155-185.ngrok-free.app/api/notifications/list - 200 null application/json; charset=utf-8 209.4674ms
2025-02-02 00:49:38.715 +03:00 [INF] Request starting HTTP/1.1 POST http://localhost:5264/api/notifications/send - application/json 206
2025-02-02 00:49:38.717 +03:00 [INF] Executing endpoint 'NayifatAPI.Controllers.NotificationsController.SendNotification (NayifatAPI)'
2025-02-02 00:49:38.723 +03:00 [INF] Route matched with {action = "SendNotification", controller = "Notifications"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] SendNotification(NayifatAPI.Controllers.SendNotificationRequest) on controller NayifatAPI.Controllers.NotificationsController (NayifatAPI).
2025-02-02 00:49:38.743 +03:00 [INF] Executed DbCommand (3ms) [Parameters=[@__providedApiKey_0='?' (Size = 255)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [a].[Key], [a].[CreatedAt], [a].[Description], [a].[ExpiresAt], [a].[IsActive], [a].[LastUsedAt]
FROM [ApiKeys] AS [a]
WHERE [a].[Key] = @__providedApiKey_0 AND [a].[IsActive] = CAST(1 AS bit)
2025-02-02 00:49:38.747 +03:00 [INF] Received notification request: {"Title":null,"TitleEn":"Test Notification","TitleAr":" ","Filters":null,"NationalId":"1064448614","NationalIds":null}
2025-02-02 00:49:38.756 +03:00 [INF] Starting GetTargetUsers with request type: Single User
2025-02-02 00:49:38.781 +03:00 [INF] Executed DbCommand (2ms) [Parameters=[@__request_NationalId_0='?' (Size = 450)], CommandType='"Text"', CommandTimeout='30']
SELECT [c].[NationalId]
FROM [Customers] AS [c]
WHERE [c].[NationalId] = @__request_NationalId_0
2025-02-02 00:49:38.783 +03:00 [INF] Found 1 users matching national ID 1064448614
2025-02-02 00:49:38.785 +03:00 [INF] Target users query completed. Found 1 users
2025-02-02 00:49:38.786 +03:00 [INF] Found 1 target users for notification
2025-02-02 00:49:38.930 +03:00 [INF] Executed DbCommand (86ms) [Parameters=[@p0='?' (Size = 4000), @p1='?' (Size = 8000) (DbType = AnsiString), @p2='?' (Size = 4000), @p3='?' (Size = 8000) (DbType = AnsiString), @p4='?' (DbType = DateTime2), @p5='?' (DbType = DateTime2), @p6='?' (Size = 255), @p7='?' (Size = 4000), @p8='?' (Size = 255), @p9='?' (Size = 255), @p10='?' (Size = 255)], CommandType='"Text"', CommandTimeout='30']
SET IMPLICIT_TRANSACTIONS OFF;
SET NOCOUNT ON;
INSERT INTO [notification_templates] ([additional_data], [Body], [body_ar], [body_en], [created_at], [expiry_at], [Route], [target_criteria], [Title], [title_ar], [title_en])
OUTPUT INSERTED.[Id]
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7, @p8, @p9, @p10);
2025-02-02 00:49:38.935 +03:00 [INF] Created notification template with ID: 4
2025-02-02 00:49:38.944 +03:00 [INF] Executed DbCommand (4ms) [Parameters=[@p0='?' (Size = 4000), @p1='?' (DbType = DateTime2), @p2='?' (Size = 4000), @p3='?' (Size = 4000), @p4='?' (Size = 4000), @p5='?' (Size = 450), @p6='?' (Size = 4000), @p7='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SET IMPLICIT_TRANSACTIONS OFF;
SET NOCOUNT ON;
INSERT INTO [AuthLogs] ([AuthType], [CreatedAt], [DeviceId], [FailureReason], [IpAddress], [NationalId], [Status], [UserAgent])
OUTPUT INSERTED.[Id]
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7);
2025-02-02 00:49:38.952 +03:00 [INF] Executed DbCommand (2ms) [Parameters=[@__userId_0='?' (Size = 450)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [u].[national_id], [u].[last_updated], [u].[notifications]
FROM [user_notifications] AS [u]
WHERE [u].[national_id] = @__userId_0
2025-02-02 00:49:38.954 +03:00 [INF] Processing notification for user 1064448614. Existing notification record: false
2025-02-02 00:49:38.956 +03:00 [INF] Current notifications count for user 1064448614: 0
2025-02-02 00:49:38.966 +03:00 [INF] Serialized new notifications for user 1064448614. Length: 138
2025-02-02 00:49:38.988 +03:00 [INF] Executed DbCommand (11ms) [Parameters=[@p0='?' (Size = 4000), @p1='?' (Size = 4000), @p2='?' (DbType = DateTime2)], CommandType='"Text"', CommandTimeout='30']
INSERT INTO user_notifications (national_id, notifications, last_updated) VALUES (@p0, @p1, @p2)
2025-02-02 00:49:38.990 +03:00 [INF] Created new UserNotification entry for user: 1064448614
2025-02-02 00:49:38.994 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@p0='?' (Size = 4000), @p1='?' (DbType = DateTime2), @p2='?' (Size = 4000), @p3='?' (Size = 4000), @p4='?' (Size = 4000), @p5='?' (Size = 450), @p6='?' (Size = 4000), @p7='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SET IMPLICIT_TRANSACTIONS OFF;
SET NOCOUNT ON;
INSERT INTO [AuthLogs] ([AuthType], [CreatedAt], [DeviceId], [FailureReason], [IpAddress], [NationalId], [Status], [UserAgent])
OUTPUT INSERTED.[Id]
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7);
2025-02-02 00:49:38.996 +03:00 [INF] Successfully sent notifications. Template: 4, Success: 1, Total: 1
2025-02-02 00:49:38.998 +03:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType9`2[[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Object, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-02-02 00:49:39.001 +03:00 [INF] Executed action NayifatAPI.Controllers.NotificationsController.SendNotification (NayifatAPI) in 276.0871ms
2025-02-02 00:49:39.003 +03:00 [INF] Executed endpoint 'NayifatAPI.Controllers.NotificationsController.SendNotification (NayifatAPI)'
2025-02-02 00:49:39.005 +03:00 [INF] Request finished HTTP/1.1 POST http://localhost:5264/api/notifications/send - 200 null application/json; charset=utf-8 289.998ms
2025-02-02 00:49:45.586 +03:00 [INF] Request starting HTTP/1.1 POST http://957c-51-252-155-185.ngrok-free.app/api/notifications/list - application/json; charset=utf-8 47
2025-02-02 00:49:45.591 +03:00 [INF] Executing endpoint 'NayifatAPI.Controllers.NotificationsController.GetNotifications (NayifatAPI)'
2025-02-02 00:49:45.593 +03:00 [INF] Route matched with {action = "GetNotifications", controller = "Notifications"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetNotifications(NayifatAPI.Controllers.GetNotificationsRequest) on controller NayifatAPI.Controllers.NotificationsController (NayifatAPI).
2025-02-02 00:49:45.595 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@__providedApiKey_0='?' (Size = 255)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [a].[Key], [a].[CreatedAt], [a].[Description], [a].[ExpiresAt], [a].[IsActive], [a].[LastUsedAt]
FROM [ApiKeys] AS [a]
WHERE [a].[Key] = @__providedApiKey_0 AND [a].[IsActive] = CAST(1 AS bit)
2025-02-02 00:49:45.600 +03:00 [INF] Executed DbCommand (2ms) [Parameters=[@__request_NationalId_0='?' (Size = 450)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [u].[national_id], [u].[last_updated], [u].[notifications]
FROM [user_notifications] AS [u]
WHERE [u].[national_id] = @__request_NationalId_0
2025-02-02 00:49:45.650 +03:00 [INF] Executed DbCommand (11ms) [Parameters=[@__Parse_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [n].[Id], [n].[additional_data], [n].[Body], [n].[body_ar], [n].[body_en], [n].[created_at], [n].[expiry_at], [n].[Route], [n].[target_criteria], [n].[Title], [n].[title_ar], [n].[title_en]
FROM [notification_templates] AS [n]
WHERE [n].[Id] = @__Parse_0
2025-02-02 00:49:45.695 +03:00 [INF] Executed DbCommand (2ms) [Parameters=[@p0='?' (Size = 4000), @p1='?' (DbType = DateTime2), @p2='?' (Size = 4000), @p3='?' (Size = 4000), @p4='?' (Size = 4000), @p5='?' (Size = 450), @p6='?' (Size = 4000), @p7='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SET IMPLICIT_TRANSACTIONS OFF;
SET NOCOUNT ON;
INSERT INTO [AuthLogs] ([AuthType], [CreatedAt], [DeviceId], [FailureReason], [IpAddress], [NationalId], [Status], [UserAgent])
OUTPUT INSERTED.[Id]
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7);
2025-02-02 00:49:45.697 +03:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType9`2[[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Object, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-02-02 00:49:45.701 +03:00 [INF] Executed action NayifatAPI.Controllers.NotificationsController.GetNotifications (NayifatAPI) in 106.7346ms
2025-02-02 00:49:45.702 +03:00 [INF] Executed endpoint 'NayifatAPI.Controllers.NotificationsController.GetNotifications (NayifatAPI)'
2025-02-02 00:49:45.703 +03:00 [INF] Request finished HTTP/1.1 POST http://957c-51-252-155-185.ngrok-free.app/api/notifications/list - 200 null application/json; charset=utf-8 117.7709ms
2025-02-02 00:50:15.900 +03:00 [INF] Request starting HTTP/1.1 POST http://957c-51-252-155-185.ngrok-free.app/api/auth/signin - application/json; charset=utf-8 224
2025-02-02 00:50:15.904 +03:00 [INF] Executing endpoint 'NayifatAPI.Controllers.AuthController.SignIn (NayifatAPI)'
2025-02-02 00:50:15.905 +03:00 [INF] Route matched with {action = "SignIn", controller = "Auth"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] SignIn(NayifatAPI.Controllers.SignInRequest) on controller NayifatAPI.Controllers.AuthController (NayifatAPI).
2025-02-02 00:50:15.909 +03:00 [INF] Executed DbCommand (2ms) [Parameters=[@__providedApiKey_0='?' (Size = 255)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [a].[Key], [a].[CreatedAt], [a].[Description], [a].[ExpiresAt], [a].[IsActive], [a].[LastUsedAt]
FROM [ApiKeys] AS [a]
WHERE [a].[Key] = @__providedApiKey_0 AND [a].[IsActive] = CAST(1 AS bit)
2025-02-02 00:50:15.913 +03:00 [INF] Executed DbCommand (2ms) [Parameters=[@__request_NationalId_0='?' (Size = 450)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [c].[NationalId], [c].[AddNo], [c].[BuildingNo], [c].[City], [c].[Consent], [c].[ConsentDate], [c].[DateOfBirth], [c].[Dependents], [c].[District], [c].[Email], [c].[Employer], [c].[FamilyNameAr], [c].[FamilyNameEn], [c].[FirstNameAr], [c].[FirstNameEn], [c].[Iban], [c].[IdExpiryDate], [c].[Los], [c].[Mpin], [c].[MpinEnabled], [c].[NafathStatus], [c].[NafathTimestamp], [c].[Password], [c].[Phone], [c].[RegistrationDate], [c].[SalaryCustomer], [c].[SalaryDakhli], [c].[SecondNameAr], [c].[SecondNameEn], [c].[Sector], [c].[Street], [c].[ThirdNameAr], [c].[ThirdNameEn], [c].[Zipcode]
FROM [Customers] AS [c]
WHERE [c].[NationalId] = @__request_NationalId_0
2025-02-02 00:50:15.924 +03:00 [INF] Executed DbCommand (8ms) [Parameters=[@p0='?' (Size = 4000), @p1='?' (DbType = DateTime2), @p2='?' (Size = 4000), @p3='?' (Size = 4000), @p4='?' (Size = 4000), @p5='?' (Size = 450), @p6='?' (Size = 4000), @p7='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SET IMPLICIT_TRANSACTIONS OFF;
SET NOCOUNT ON;
INSERT INTO [AuthLogs] ([AuthType], [CreatedAt], [DeviceId], [FailureReason], [IpAddress], [NationalId], [Status], [UserAgent])
OUTPUT INSERTED.[Id]
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7);
2025-02-02 00:50:15.926 +03:00 [INF] Executing ObjectResult, writing value of type '<>f__AnonymousType12`3[[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Object, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-02-02 00:50:15.928 +03:00 [INF] Executed action NayifatAPI.Controllers.AuthController.SignIn (NayifatAPI) in 21.7182ms
2025-02-02 00:50:15.928 +03:00 [INF] Executed endpoint 'NayifatAPI.Controllers.AuthController.SignIn (NayifatAPI)'
2025-02-02 00:50:15.929 +03:00 [INF] Request finished HTTP/1.1 POST http://957c-51-252-155-185.ngrok-free.app/api/auth/signin - 401 null application/json; charset=utf-8 28.6761ms
2025-02-02 00:52:57.755 +03:00 [INF] Request starting HTTP/1.1 POST http://957c-51-252-155-185.ngrok-free.app/api/notifications/list - application/json; charset=utf-8 47
2025-02-02 00:52:57.758 +03:00 [INF] Executing endpoint 'NayifatAPI.Controllers.NotificationsController.GetNotifications (NayifatAPI)'
2025-02-02 00:52:57.759 +03:00 [INF] Route matched with {action = "GetNotifications", controller = "Notifications"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetNotifications(NayifatAPI.Controllers.GetNotificationsRequest) on controller NayifatAPI.Controllers.NotificationsController (NayifatAPI).
2025-02-02 00:52:57.764 +03:00 [INF] Executed DbCommand (2ms) [Parameters=[@__providedApiKey_0='?' (Size = 255)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [a].[Key], [a].[CreatedAt], [a].[Description], [a].[ExpiresAt], [a].[IsActive], [a].[LastUsedAt]
FROM [ApiKeys] AS [a]
WHERE [a].[Key] = @__providedApiKey_0 AND [a].[IsActive] = CAST(1 AS bit)
2025-02-02 00:52:57.767 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@__request_NationalId_0='?' (Size = 450)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [u].[national_id], [u].[last_updated], [u].[notifications]
FROM [user_notifications] AS [u]
WHERE [u].[national_id] = @__request_NationalId_0
2025-02-02 00:52:57.771 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@__Parse_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [n].[Id], [n].[additional_data], [n].[Body], [n].[body_ar], [n].[body_en], [n].[created_at], [n].[expiry_at], [n].[Route], [n].[target_criteria], [n].[Title], [n].[title_ar], [n].[title_en]
FROM [notification_templates] AS [n]
WHERE [n].[Id] = @__Parse_0
2025-02-02 00:52:57.781 +03:00 [INF] Executed DbCommand (8ms) [Parameters=[@p0='?' (Size = 4000), @p1='?' (DbType = DateTime2), @p2='?' (Size = 4000), @p3='?' (Size = 4000), @p4='?' (Size = 4000), @p5='?' (Size = 450), @p6='?' (Size = 4000), @p7='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SET IMPLICIT_TRANSACTIONS OFF;
SET NOCOUNT ON;
INSERT INTO [AuthLogs] ([AuthType], [CreatedAt], [DeviceId], [FailureReason], [IpAddress], [NationalId], [Status], [UserAgent])
OUTPUT INSERTED.[Id]
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7);
2025-02-02 00:52:57.783 +03:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType9`2[[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Object, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-02-02 00:52:57.784 +03:00 [INF] Executed action NayifatAPI.Controllers.NotificationsController.GetNotifications (NayifatAPI) in 23.034ms
2025-02-02 00:52:57.785 +03:00 [INF] Executed endpoint 'NayifatAPI.Controllers.NotificationsController.GetNotifications (NayifatAPI)'
2025-02-02 00:52:57.786 +03:00 [INF] Request finished HTTP/1.1 POST http://957c-51-252-155-185.ngrok-free.app/api/notifications/list - 200 null application/json; charset=utf-8 30.9376ms
2025-02-02 00:53:07.067 +03:00 [INF] Request starting HTTP/1.1 POST http://957c-51-252-155-185.ngrok-free.app/api/notifications/list - application/json; charset=utf-8 47
2025-02-02 00:53:07.329 +03:00 [INF] Executing endpoint 'NayifatAPI.Controllers.NotificationsController.GetNotifications (NayifatAPI)'
2025-02-02 00:53:07.345 +03:00 [INF] Route matched with {action = "GetNotifications", controller = "Notifications"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetNotifications(NayifatAPI.Controllers.GetNotificationsRequest) on controller NayifatAPI.Controllers.NotificationsController (NayifatAPI).
2025-02-02 00:53:07.349 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@__providedApiKey_0='?' (Size = 255)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [a].[Key], [a].[CreatedAt], [a].[Description], [a].[ExpiresAt], [a].[IsActive], [a].[LastUsedAt]
FROM [ApiKeys] AS [a]
WHERE [a].[Key] = @__providedApiKey_0 AND [a].[IsActive] = CAST(1 AS bit)
2025-02-02 00:53:07.367 +03:00 [INF] Executed DbCommand (15ms) [Parameters=[@__request_NationalId_0='?' (Size = 450)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [u].[national_id], [u].[last_updated], [u].[notifications]
FROM [user_notifications] AS [u]
WHERE [u].[national_id] = @__request_NationalId_0
2025-02-02 00:53:07.656 +03:00 [INF] Executed DbCommand (2ms) [Parameters=[@__Parse_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [n].[Id], [n].[additional_data], [n].[Body], [n].[body_ar], [n].[body_en], [n].[created_at], [n].[expiry_at], [n].[Route], [n].[target_criteria], [n].[Title], [n].[title_ar], [n].[title_en]
FROM [notification_templates] AS [n]
WHERE [n].[Id] = @__Parse_0
2025-02-02 00:53:07.670 +03:00 [INF] Executed DbCommand (6ms) [Parameters=[@p0='?' (Size = 4000), @p1='?' (DbType = DateTime2), @p2='?' (Size = 4000), @p3='?' (Size = 4000), @p4='?' (Size = 4000), @p5='?' (Size = 450), @p6='?' (Size = 4000), @p7='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SET IMPLICIT_TRANSACTIONS OFF;
SET NOCOUNT ON;
INSERT INTO [AuthLogs] ([AuthType], [CreatedAt], [DeviceId], [FailureReason], [IpAddress], [NationalId], [Status], [UserAgent])
OUTPUT INSERTED.[Id]
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7);
2025-02-02 00:53:07.673 +03:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType9`2[[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Object, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-02-02 00:53:07.983 +03:00 [INF] Executed action NayifatAPI.Controllers.NotificationsController.GetNotifications (NayifatAPI) in 636.164ms
2025-02-02 00:53:07.984 +03:00 [INF] Executed endpoint 'NayifatAPI.Controllers.NotificationsController.GetNotifications (NayifatAPI)'
2025-02-02 00:53:07.985 +03:00 [INF] Request finished HTTP/1.1 POST http://957c-51-252-155-185.ngrok-free.app/api/notifications/list - 200 null application/json; charset=utf-8 918.6004ms
2025-02-02 00:53:30.616 +03:00 [INF] Request starting HTTP/1.1 POST http://957c-51-252-155-185.ngrok-free.app/api/notifications/list - application/json; charset=utf-8 47
2025-02-02 00:53:30.866 +03:00 [INF] Executing endpoint 'NayifatAPI.Controllers.NotificationsController.GetNotifications (NayifatAPI)'
2025-02-02 00:53:30.868 +03:00 [INF] Route matched with {action = "GetNotifications", controller = "Notifications"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetNotifications(NayifatAPI.Controllers.GetNotificationsRequest) on controller NayifatAPI.Controllers.NotificationsController (NayifatAPI).
2025-02-02 00:53:30.874 +03:00 [INF] Executed DbCommand (3ms) [Parameters=[@__providedApiKey_0='?' (Size = 255)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [a].[Key], [a].[CreatedAt], [a].[Description], [a].[ExpiresAt], [a].[IsActive], [a].[LastUsedAt]
FROM [ApiKeys] AS [a]
WHERE [a].[Key] = @__providedApiKey_0 AND [a].[IsActive] = CAST(1 AS bit)
2025-02-02 00:53:30.881 +03:00 [INF] Executed DbCommand (3ms) [Parameters=[@__request_NationalId_0='?' (Size = 450)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [u].[national_id], [u].[last_updated], [u].[notifications]
FROM [user_notifications] AS [u]
WHERE [u].[national_id] = @__request_NationalId_0
2025-02-02 00:53:30.919 +03:00 [INF] Executed DbCommand (29ms) [Parameters=[@__Parse_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [n].[Id], [n].[additional_data], [n].[Body], [n].[body_ar], [n].[body_en], [n].[created_at], [n].[expiry_at], [n].[Route], [n].[target_criteria], [n].[Title], [n].[title_ar], [n].[title_en]
FROM [notification_templates] AS [n]
WHERE [n].[Id] = @__Parse_0
2025-02-02 00:53:31.281 +03:00 [INF] Executed DbCommand (121ms) [Parameters=[@p0='?' (Size = 4000), @p1='?' (DbType = DateTime2), @p2='?' (Size = 4000), @p3='?' (Size = 4000), @p4='?' (Size = 4000), @p5='?' (Size = 450), @p6='?' (Size = 4000), @p7='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SET IMPLICIT_TRANSACTIONS OFF;
SET NOCOUNT ON;
INSERT INTO [AuthLogs] ([AuthType], [CreatedAt], [DeviceId], [FailureReason], [IpAddress], [NationalId], [Status], [UserAgent])
OUTPUT INSERTED.[Id]
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7);
2025-02-02 00:53:31.448 +03:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType9`2[[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Object, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-02-02 00:53:31.449 +03:00 [INF] Executed action NayifatAPI.Controllers.NotificationsController.GetNotifications (NayifatAPI) in 579.289ms
2025-02-02 00:53:31.450 +03:00 [INF] Executed endpoint 'NayifatAPI.Controllers.NotificationsController.GetNotifications (NayifatAPI)'
2025-02-02 00:53:31.451 +03:00 [INF] Request finished HTTP/1.1 POST http://957c-51-252-155-185.ngrok-free.app/api/notifications/list - 200 null application/json; charset=utf-8 835.1511ms
2025-02-02 00:53:51.344 +03:00 [INF] Request starting HTTP/1.1 POST http://957c-51-252-155-185.ngrok-free.app/api/notifications/list - application/json; charset=utf-8 47
2025-02-02 00:53:51.347 +03:00 [INF] Executing endpoint 'NayifatAPI.Controllers.NotificationsController.GetNotifications (NayifatAPI)'
2025-02-02 00:53:51.348 +03:00 [INF] Route matched with {action = "GetNotifications", controller = "Notifications"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetNotifications(NayifatAPI.Controllers.GetNotificationsRequest) on controller NayifatAPI.Controllers.NotificationsController (NayifatAPI).
2025-02-02 00:53:51.351 +03:00 [INF] Executed DbCommand (0ms) [Parameters=[@__providedApiKey_0='?' (Size = 255)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [a].[Key], [a].[CreatedAt], [a].[Description], [a].[ExpiresAt], [a].[IsActive], [a].[LastUsedAt]
FROM [ApiKeys] AS [a]
WHERE [a].[Key] = @__providedApiKey_0 AND [a].[IsActive] = CAST(1 AS bit)
2025-02-02 00:53:51.355 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@__request_NationalId_0='?' (Size = 450)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [u].[national_id], [u].[last_updated], [u].[notifications]
FROM [user_notifications] AS [u]
WHERE [u].[national_id] = @__request_NationalId_0
2025-02-02 00:53:51.358 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@__Parse_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [n].[Id], [n].[additional_data], [n].[Body], [n].[body_ar], [n].[body_en], [n].[created_at], [n].[expiry_at], [n].[Route], [n].[target_criteria], [n].[Title], [n].[title_ar], [n].[title_en]
FROM [notification_templates] AS [n]
WHERE [n].[Id] = @__Parse_0
2025-02-02 00:53:51.434 +03:00 [INF] Executed DbCommand (73ms) [Parameters=[@p0='?' (Size = 4000), @p1='?' (DbType = DateTime2), @p2='?' (Size = 4000), @p3='?' (Size = 4000), @p4='?' (Size = 4000), @p5='?' (Size = 450), @p6='?' (Size = 4000), @p7='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SET IMPLICIT_TRANSACTIONS OFF;
SET NOCOUNT ON;
INSERT INTO [AuthLogs] ([AuthType], [CreatedAt], [DeviceId], [FailureReason], [IpAddress], [NationalId], [Status], [UserAgent])
OUTPUT INSERTED.[Id]
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7);
2025-02-02 00:53:51.437 +03:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType9`2[[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Object, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-02-02 00:53:51.438 +03:00 [INF] Executed action NayifatAPI.Controllers.NotificationsController.GetNotifications (NayifatAPI) in 87.6582ms
2025-02-02 00:53:51.439 +03:00 [INF] Executed endpoint 'NayifatAPI.Controllers.NotificationsController.GetNotifications (NayifatAPI)'
2025-02-02 00:53:51.440 +03:00 [INF] Request finished HTTP/1.1 POST http://957c-51-252-155-185.ngrok-free.app/api/notifications/list - 200 null application/json; charset=utf-8 95.4601ms
2025-02-02 00:54:47.087 +03:00 [INF] Request starting HTTP/1.1 POST http://957c-51-252-155-185.ngrok-free.app/api/notifications/list - application/json; charset=utf-8 47
2025-02-02 00:54:47.091 +03:00 [INF] Executing endpoint 'NayifatAPI.Controllers.NotificationsController.GetNotifications (NayifatAPI)'
2025-02-02 00:54:47.092 +03:00 [INF] Route matched with {action = "GetNotifications", controller = "Notifications"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetNotifications(NayifatAPI.Controllers.GetNotificationsRequest) on controller NayifatAPI.Controllers.NotificationsController (NayifatAPI).
2025-02-02 00:54:47.096 +03:00 [INF] Executed DbCommand (2ms) [Parameters=[@__providedApiKey_0='?' (Size = 255)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [a].[Key], [a].[CreatedAt], [a].[Description], [a].[ExpiresAt], [a].[IsActive], [a].[LastUsedAt]
FROM [ApiKeys] AS [a]
WHERE [a].[Key] = @__providedApiKey_0 AND [a].[IsActive] = CAST(1 AS bit)
2025-02-02 00:54:47.100 +03:00 [INF] Executed DbCommand (2ms) [Parameters=[@__request_NationalId_0='?' (Size = 450)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [u].[national_id], [u].[last_updated], [u].[notifications]
FROM [user_notifications] AS [u]
WHERE [u].[national_id] = @__request_NationalId_0
2025-02-02 00:54:47.107 +03:00 [INF] Executed DbCommand (3ms) [Parameters=[@__Parse_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [n].[Id], [n].[additional_data], [n].[Body], [n].[body_ar], [n].[body_en], [n].[created_at], [n].[expiry_at], [n].[Route], [n].[target_criteria], [n].[Title], [n].[title_ar], [n].[title_en]
FROM [notification_templates] AS [n]
WHERE [n].[Id] = @__Parse_0
2025-02-02 00:54:47.185 +03:00 [INF] Executed DbCommand (75ms) [Parameters=[@p0='?' (Size = 4000), @p1='?' (DbType = DateTime2), @p2='?' (Size = 4000), @p3='?' (Size = 4000), @p4='?' (Size = 4000), @p5='?' (Size = 450), @p6='?' (Size = 4000), @p7='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SET IMPLICIT_TRANSACTIONS OFF;
SET NOCOUNT ON;
INSERT INTO [AuthLogs] ([AuthType], [CreatedAt], [DeviceId], [FailureReason], [IpAddress], [NationalId], [Status], [UserAgent])
OUTPUT INSERTED.[Id]
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7);
2025-02-02 00:54:47.187 +03:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType9`2[[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Object, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-02-02 00:54:47.189 +03:00 [INF] Executed action NayifatAPI.Controllers.NotificationsController.GetNotifications (NayifatAPI) in 95.8164ms
2025-02-02 00:54:47.190 +03:00 [INF] Executed endpoint 'NayifatAPI.Controllers.NotificationsController.GetNotifications (NayifatAPI)'
2025-02-02 00:54:47.191 +03:00 [INF] Request finished HTTP/1.1 POST http://957c-51-252-155-185.ngrok-free.app/api/notifications/list - 200 null application/json; charset=utf-8 104.0088ms
2025-02-02 00:55:20.474 +03:00 [INF] Request starting HTTP/1.1 POST http://957c-51-252-155-185.ngrok-free.app/api/auth/signin - application/json; charset=utf-8 224
2025-02-02 00:55:20.480 +03:00 [INF] Executing endpoint 'NayifatAPI.Controllers.AuthController.SignIn (NayifatAPI)'
2025-02-02 00:55:20.481 +03:00 [INF] Route matched with {action = "SignIn", controller = "Auth"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] SignIn(NayifatAPI.Controllers.SignInRequest) on controller NayifatAPI.Controllers.AuthController (NayifatAPI).
2025-02-02 00:55:20.483 +03:00 [INF] Executed DbCommand (0ms) [Parameters=[@__providedApiKey_0='?' (Size = 255)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [a].[Key], [a].[CreatedAt], [a].[Description], [a].[ExpiresAt], [a].[IsActive], [a].[LastUsedAt]
FROM [ApiKeys] AS [a]
WHERE [a].[Key] = @__providedApiKey_0 AND [a].[IsActive] = CAST(1 AS bit)
2025-02-02 00:55:20.488 +03:00 [INF] Executed DbCommand (2ms) [Parameters=[@__request_NationalId_0='?' (Size = 450)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [c].[NationalId], [c].[AddNo], [c].[BuildingNo], [c].[City], [c].[Consent], [c].[ConsentDate], [c].[DateOfBirth], [c].[Dependents], [c].[District], [c].[Email], [c].[Employer], [c].[FamilyNameAr], [c].[FamilyNameEn], [c].[FirstNameAr], [c].[FirstNameEn], [c].[Iban], [c].[IdExpiryDate], [c].[Los], [c].[Mpin], [c].[MpinEnabled], [c].[NafathStatus], [c].[NafathTimestamp], [c].[Password], [c].[Phone], [c].[RegistrationDate], [c].[SalaryCustomer], [c].[SalaryDakhli], [c].[SecondNameAr], [c].[SecondNameEn], [c].[Sector], [c].[Street], [c].[ThirdNameAr], [c].[ThirdNameEn], [c].[Zipcode]
FROM [Customers] AS [c]
WHERE [c].[NationalId] = @__request_NationalId_0
2025-02-02 00:55:20.574 +03:00 [INF] Executed DbCommand (74ms) [Parameters=[@p0='?' (Size = 4000), @p1='?' (DbType = DateTime2), @p2='?' (Size = 4000), @p3='?' (Size = 4000), @p4='?' (Size = 4000), @p5='?' (Size = 450), @p6='?' (Size = 4000), @p7='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SET IMPLICIT_TRANSACTIONS OFF;
SET NOCOUNT ON;
INSERT INTO [AuthLogs] ([AuthType], [CreatedAt], [DeviceId], [FailureReason], [IpAddress], [NationalId], [Status], [UserAgent])
OUTPUT INSERTED.[Id]
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7);
2025-02-02 00:55:20.578 +03:00 [INF] Executing ObjectResult, writing value of type '<>f__AnonymousType12`3[[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Object, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-02-02 00:55:20.579 +03:00 [INF] Executed action NayifatAPI.Controllers.AuthController.SignIn (NayifatAPI) in 97.6509ms
2025-02-02 00:55:20.581 +03:00 [INF] Executed endpoint 'NayifatAPI.Controllers.AuthController.SignIn (NayifatAPI)'
2025-02-02 00:55:20.583 +03:00 [INF] Request finished HTTP/1.1 POST http://957c-51-252-155-185.ngrok-free.app/api/auth/signin - 401 null application/json; charset=utf-8 108.2313ms
2025-02-02 00:55:31.275 +03:00 [INF] Request starting HTTP/1.1 POST http://957c-51-252-155-185.ngrok-free.app/api/notifications/list - application/json; charset=utf-8 47
2025-02-02 00:55:31.278 +03:00 [INF] Executing endpoint 'NayifatAPI.Controllers.NotificationsController.GetNotifications (NayifatAPI)'
2025-02-02 00:55:31.280 +03:00 [INF] Route matched with {action = "GetNotifications", controller = "Notifications"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetNotifications(NayifatAPI.Controllers.GetNotificationsRequest) on controller NayifatAPI.Controllers.NotificationsController (NayifatAPI).
2025-02-02 00:55:31.284 +03:00 [INF] Executed DbCommand (2ms) [Parameters=[@__providedApiKey_0='?' (Size = 255)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [a].[Key], [a].[CreatedAt], [a].[Description], [a].[ExpiresAt], [a].[IsActive], [a].[LastUsedAt]
FROM [ApiKeys] AS [a]
WHERE [a].[Key] = @__providedApiKey_0 AND [a].[IsActive] = CAST(1 AS bit)
2025-02-02 00:55:31.288 +03:00 [INF] Executed DbCommand (2ms) [Parameters=[@__request_NationalId_0='?' (Size = 450)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [u].[national_id], [u].[last_updated], [u].[notifications]
FROM [user_notifications] AS [u]
WHERE [u].[national_id] = @__request_NationalId_0
2025-02-02 00:55:31.293 +03:00 [INF] Executed DbCommand (2ms) [Parameters=[@__Parse_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [n].[Id], [n].[additional_data], [n].[Body], [n].[body_ar], [n].[body_en], [n].[created_at], [n].[expiry_at], [n].[Route], [n].[target_criteria], [n].[Title], [n].[title_ar], [n].[title_en]
FROM [notification_templates] AS [n]
WHERE [n].[Id] = @__Parse_0
2025-02-02 00:55:31.371 +03:00 [INF] Executed DbCommand (76ms) [Parameters=[@p0='?' (Size = 4000), @p1='?' (DbType = DateTime2), @p2='?' (Size = 4000), @p3='?' (Size = 4000), @p4='?' (Size = 4000), @p5='?' (Size = 450), @p6='?' (Size = 4000), @p7='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SET IMPLICIT_TRANSACTIONS OFF;
SET NOCOUNT ON;
INSERT INTO [AuthLogs] ([AuthType], [CreatedAt], [DeviceId], [FailureReason], [IpAddress], [NationalId], [Status], [UserAgent])
OUTPUT INSERTED.[Id]
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7);
2025-02-02 00:55:31.375 +03:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType9`2[[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Object, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-02-02 00:55:31.377 +03:00 [INF] Executed action NayifatAPI.Controllers.NotificationsController.GetNotifications (NayifatAPI) in 95.6185ms
2025-02-02 00:55:31.379 +03:00 [INF] Executed endpoint 'NayifatAPI.Controllers.NotificationsController.GetNotifications (NayifatAPI)'
2025-02-02 00:55:31.381 +03:00 [INF] Request finished HTTP/1.1 POST http://957c-51-252-155-185.ngrok-free.app/api/notifications/list - 200 null application/json; charset=utf-8 105.4446ms
2025-02-02 00:56:01.610 +03:00 [INF] Request starting HTTP/1.1 POST http://957c-51-252-155-185.ngrok-free.app/api/notifications/list - application/json; charset=utf-8 47
2025-02-02 00:56:01.612 +03:00 [INF] Executing endpoint 'NayifatAPI.Controllers.NotificationsController.GetNotifications (NayifatAPI)'
2025-02-02 00:56:01.612 +03:00 [INF] Route matched with {action = "GetNotifications", controller = "Notifications"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetNotifications(NayifatAPI.Controllers.GetNotificationsRequest) on controller NayifatAPI.Controllers.NotificationsController (NayifatAPI).
2025-02-02 00:56:01.617 +03:00 [INF] Executed DbCommand (3ms) [Parameters=[@__providedApiKey_0='?' (Size = 255)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [a].[Key], [a].[CreatedAt], [a].[Description], [a].[ExpiresAt], [a].[IsActive], [a].[LastUsedAt]
FROM [ApiKeys] AS [a]
WHERE [a].[Key] = @__providedApiKey_0 AND [a].[IsActive] = CAST(1 AS bit)
2025-02-02 00:56:01.621 +03:00 [INF] Executed DbCommand (2ms) [Parameters=[@__request_NationalId_0='?' (Size = 450)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [u].[national_id], [u].[last_updated], [u].[notifications]
FROM [user_notifications] AS [u]
WHERE [u].[national_id] = @__request_NationalId_0
2025-02-02 00:56:01.624 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@__Parse_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [n].[Id], [n].[additional_data], [n].[Body], [n].[body_ar], [n].[body_en], [n].[created_at], [n].[expiry_at], [n].[Route], [n].[target_criteria], [n].[Title], [n].[title_ar], [n].[title_en]
FROM [notification_templates] AS [n]
WHERE [n].[Id] = @__Parse_0
2025-02-02 00:56:01.701 +03:00 [INF] Executed DbCommand (75ms) [Parameters=[@p0='?' (Size = 4000), @p1='?' (DbType = DateTime2), @p2='?' (Size = 4000), @p3='?' (Size = 4000), @p4='?' (Size = 4000), @p5='?' (Size = 450), @p6='?' (Size = 4000), @p7='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SET IMPLICIT_TRANSACTIONS OFF;
SET NOCOUNT ON;
INSERT INTO [AuthLogs] ([AuthType], [CreatedAt], [DeviceId], [FailureReason], [IpAddress], [NationalId], [Status], [UserAgent])
OUTPUT INSERTED.[Id]
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7);
2025-02-02 00:56:01.703 +03:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType9`2[[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Object, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-02-02 00:56:01.704 +03:00 [INF] Executed action NayifatAPI.Controllers.NotificationsController.GetNotifications (NayifatAPI) in 90.5519ms
2025-02-02 00:56:01.705 +03:00 [INF] Executed endpoint 'NayifatAPI.Controllers.NotificationsController.GetNotifications (NayifatAPI)'
2025-02-02 00:56:01.706 +03:00 [INF] Request finished HTTP/1.1 POST http://957c-51-252-155-185.ngrok-free.app/api/notifications/list - 200 null application/json; charset=utf-8 96.218ms
2025-02-02 00:56:11.555 +03:00 [INF] Application is shutting down...
2025-02-02 00:57:36.001 +03:00 [INF] Starting web application
2025-02-02 00:57:36.115 +03:00 [INF] Now listening on: http://localhost:5264
2025-02-02 00:57:36.120 +03:00 [INF] Application started. Press Ctrl+C to shut down.
2025-02-02 00:57:36.121 +03:00 [INF] Hosting environment: Development
2025-02-02 00:57:36.121 +03:00 [INF] Content root path: C:\Users\yamta\StudioProjects\nayifat_app_2025_new\nayifatapi
2025-02-02 00:57:55.343 +03:00 [INF] Request starting HTTP/1.1 POST http://957c-51-252-155-185.ngrok-free.app/api/auth/signin - application/json; charset=utf-8 224
2025-02-02 00:57:56.166 +03:00 [WRN] Failed to determine the https port for redirect.
2025-02-02 00:57:56.425 +03:00 [INF] Executing endpoint 'NayifatAPI.Controllers.AuthController.SignIn (NayifatAPI)'
2025-02-02 00:57:56.648 +03:00 [INF] Route matched with {action = "SignIn", controller = "Auth"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] SignIn(NayifatAPI.Controllers.SignInRequest) on controller NayifatAPI.Controllers.AuthController (NayifatAPI).
2025-02-02 00:57:57.712 +03:00 [INF] Executed DbCommand (23ms) [Parameters=[@__providedApiKey_0='?' (Size = 255)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [a].[Key], [a].[CreatedAt], [a].[Description], [a].[ExpiresAt], [a].[IsActive], [a].[LastUsedAt]
FROM [ApiKeys] AS [a]
WHERE [a].[Key] = @__providedApiKey_0 AND [a].[IsActive] = CAST(1 AS bit)
2025-02-02 00:57:57.805 +03:00 [INF] Executed DbCommand (12ms) [Parameters=[@__request_NationalId_0='?' (Size = 450)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [c].[NationalId], [c].[AddNo], [c].[BuildingNo], [c].[City], [c].[Consent], [c].[ConsentDate], [c].[DateOfBirth], [c].[Dependents], [c].[District], [c].[Email], [c].[Employer], [c].[FamilyNameAr], [c].[FamilyNameEn], [c].[FirstNameAr], [c].[FirstNameEn], [c].[Iban], [c].[IdExpiryDate], [c].[Los], [c].[Mpin], [c].[MpinEnabled], [c].[NafathStatus], [c].[NafathTimestamp], [c].[Password], [c].[Phone], [c].[RegistrationDate], [c].[SalaryCustomer], [c].[SalaryDakhli], [c].[SecondNameAr], [c].[SecondNameEn], [c].[Sector], [c].[Street], [c].[ThirdNameAr], [c].[ThirdNameEn], [c].[Zipcode]
FROM [Customers] AS [c]
WHERE [c].[NationalId] = @__request_NationalId_0
2025-02-02 00:57:58.338 +03:00 [INF] Executed DbCommand (79ms) [Parameters=[@__request_NationalId_0='?' (Size = 450), @__request_DeviceId_1='?' (Size = 450)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [c].[Id], [c].[BiometricEnabled], [c].[BiometricToken], [c].[CreatedAt], [c].[DeviceId], [c].[LastUsedAt], [c].[Manufacturer], [c].[Model], [c].[NationalId], [c].[OsVersion], [c].[Platform], [c].[Status]
FROM [Customer_Devices] AS [c]
WHERE [c].[NationalId] = @__request_NationalId_0 AND [c].[DeviceId] = @__request_DeviceId_1 AND [c].[Status] = N'active'
2025-02-02 00:57:58.556 +03:00 [INF] Executed DbCommand (27ms) [Parameters=[@p0='?' (Size = 4000), @p1='?' (DbType = DateTime2), @p2='?' (Size = 4000), @p3='?' (Size = 4000), @p4='?' (Size = 4000), @p5='?' (Size = 450), @p6='?' (Size = 4000), @p7='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SET IMPLICIT_TRANSACTIONS OFF;
SET NOCOUNT ON;
INSERT INTO [AuthLogs] ([AuthType], [CreatedAt], [DeviceId], [FailureReason], [IpAddress], [NationalId], [Status], [UserAgent])
OUTPUT INSERTED.[Id]
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7);
2025-02-02 00:57:58.592 +03:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType9`2[[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Object, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-02-02 00:57:58.609 +03:00 [INF] Executed action NayifatAPI.Controllers.AuthController.SignIn (NayifatAPI) in 1951.4167ms
2025-02-02 00:57:58.612 +03:00 [INF] Executed endpoint 'NayifatAPI.Controllers.AuthController.SignIn (NayifatAPI)'
2025-02-02 00:57:58.619 +03:00 [INF] Request finished HTTP/1.1 POST http://957c-51-252-155-185.ngrok-free.app/api/auth/signin - 200 null application/json; charset=utf-8 3279.0177ms
2025-02-02 00:58:40.877 +03:00 [INF] Request starting HTTP/1.1 POST http://957c-51-252-155-185.ngrok-free.app/api/notifications/list - application/json; charset=utf-8 47
2025-02-02 00:58:40.883 +03:00 [INF] Executing endpoint 'NayifatAPI.Controllers.NotificationsController.GetNotifications (NayifatAPI)'
2025-02-02 00:58:40.887 +03:00 [INF] Route matched with {action = "GetNotifications", controller = "Notifications"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetNotifications(NayifatAPI.Controllers.GetNotificationsRequest) on controller NayifatAPI.Controllers.NotificationsController (NayifatAPI).
2025-02-02 00:58:40.917 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@__providedApiKey_0='?' (Size = 255)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [a].[Key], [a].[CreatedAt], [a].[Description], [a].[ExpiresAt], [a].[IsActive], [a].[LastUsedAt]
FROM [ApiKeys] AS [a]
WHERE [a].[Key] = @__providedApiKey_0 AND [a].[IsActive] = CAST(1 AS bit)
2025-02-02 00:58:40.927 +03:00 [INF] Executed DbCommand (2ms) [Parameters=[@__request_NationalId_0='?' (Size = 450)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [u].[national_id], [u].[last_updated], [u].[notifications]
FROM [user_notifications] AS [u]
WHERE [u].[national_id] = @__request_NationalId_0
2025-02-02 00:58:40.958 +03:00 [INF] Executed DbCommand (2ms) [Parameters=[@__Parse_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [n].[Id], [n].[additional_data], [n].[Body], [n].[body_ar], [n].[body_en], [n].[created_at], [n].[expiry_at], [n].[Route], [n].[target_criteria], [n].[Title], [n].[title_ar], [n].[title_en]
FROM [notification_templates] AS [n]
WHERE [n].[Id] = @__Parse_0
2025-02-02 00:58:41.095 +03:00 [INF] Executed DbCommand (74ms) [Parameters=[@p0='?' (Size = 4000), @p1='?' (DbType = DateTime2), @p2='?' (Size = 4000), @p3='?' (Size = 4000), @p4='?' (Size = 4000), @p5='?' (Size = 450), @p6='?' (Size = 4000), @p7='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SET IMPLICIT_TRANSACTIONS OFF;
SET NOCOUNT ON;
INSERT INTO [AuthLogs] ([AuthType], [CreatedAt], [DeviceId], [FailureReason], [IpAddress], [NationalId], [Status], [UserAgent])
OUTPUT INSERTED.[Id]
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7);
2025-02-02 00:58:41.098 +03:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType9`2[[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Object, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-02-02 00:58:41.105 +03:00 [INF] Executed action NayifatAPI.Controllers.NotificationsController.GetNotifications (NayifatAPI) in 215.7765ms
2025-02-02 00:58:41.106 +03:00 [INF] Executed endpoint 'NayifatAPI.Controllers.NotificationsController.GetNotifications (NayifatAPI)'
2025-02-02 00:58:41.108 +03:00 [INF] Request finished HTTP/1.1 POST http://957c-51-252-155-185.ngrok-free.app/api/notifications/list - 200 null application/json; charset=utf-8 230.7977ms
2025-02-02 00:59:00.540 +03:00 [INF] Request starting HTTP/1.1 POST http://957c-51-252-155-185.ngrok-free.app/api/notifications/list - application/json; charset=utf-8 47
2025-02-02 00:59:00.547 +03:00 [INF] Executing endpoint 'NayifatAPI.Controllers.NotificationsController.GetNotifications (NayifatAPI)'
2025-02-02 00:59:00.548 +03:00 [INF] Route matched with {action = "GetNotifications", controller = "Notifications"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetNotifications(NayifatAPI.Controllers.GetNotificationsRequest) on controller NayifatAPI.Controllers.NotificationsController (NayifatAPI).
2025-02-02 00:59:00.607 +03:00 [INF] Executed DbCommand (3ms) [Parameters=[@__providedApiKey_0='?' (Size = 255)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [a].[Key], [a].[CreatedAt], [a].[Description], [a].[ExpiresAt], [a].[IsActive], [a].[LastUsedAt]
FROM [ApiKeys] AS [a]
WHERE [a].[Key] = @__providedApiKey_0 AND [a].[IsActive] = CAST(1 AS bit)
2025-02-02 00:59:00.612 +03:00 [INF] Executed DbCommand (2ms) [Parameters=[@__request_NationalId_0='?' (Size = 450)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [u].[national_id], [u].[last_updated], [u].[notifications]
FROM [user_notifications] AS [u]
WHERE [u].[national_id] = @__request_NationalId_0
2025-02-02 00:59:00.618 +03:00 [INF] Executed DbCommand (2ms) [Parameters=[@__Parse_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [n].[Id], [n].[additional_data], [n].[Body], [n].[body_ar], [n].[body_en], [n].[created_at], [n].[expiry_at], [n].[Route], [n].[target_criteria], [n].[Title], [n].[title_ar], [n].[title_en]
FROM [notification_templates] AS [n]
WHERE [n].[Id] = @__Parse_0
2025-02-02 00:59:00.629 +03:00 [INF] Executed DbCommand (8ms) [Parameters=[@p0='?' (Size = 4000), @p1='?' (DbType = DateTime2), @p2='?' (Size = 4000), @p3='?' (Size = 4000), @p4='?' (Size = 4000), @p5='?' (Size = 450), @p6='?' (Size = 4000), @p7='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SET IMPLICIT_TRANSACTIONS OFF;
SET NOCOUNT ON;
INSERT INTO [AuthLogs] ([AuthType], [CreatedAt], [DeviceId], [FailureReason], [IpAddress], [NationalId], [Status], [UserAgent])
OUTPUT INSERTED.[Id]
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7);
2025-02-02 00:59:00.632 +03:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType9`2[[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Object, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-02-02 00:59:00.633 +03:00 [INF] Executed action NayifatAPI.Controllers.NotificationsController.GetNotifications (NayifatAPI) in 83.875ms
2025-02-02 00:59:00.634 +03:00 [INF] Executed endpoint 'NayifatAPI.Controllers.NotificationsController.GetNotifications (NayifatAPI)'
2025-02-02 00:59:00.635 +03:00 [INF] Request finished HTTP/1.1 POST http://957c-51-252-155-185.ngrok-free.app/api/notifications/list - 200 null application/json; charset=utf-8 95.43ms
2025-02-02 00:59:59.111 +03:00 [INF] Request starting HTTP/1.1 POST http://957c-51-252-155-185.ngrok-free.app/api/notifications/send - application/json 206
2025-02-02 00:59:59.244 +03:00 [INF] Executing endpoint 'NayifatAPI.Controllers.NotificationsController.SendNotification (NayifatAPI)'
2025-02-02 00:59:59.252 +03:00 [INF] Route matched with {action = "SendNotification", controller = "Notifications"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] SendNotification(NayifatAPI.Controllers.SendNotificationRequest) on controller NayifatAPI.Controllers.NotificationsController (NayifatAPI).
2025-02-02 00:59:59.711 +03:00 [INF] Executed DbCommand (63ms) [Parameters=[@__providedApiKey_0='?' (Size = 255)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [a].[Key], [a].[CreatedAt], [a].[Description], [a].[ExpiresAt], [a].[IsActive], [a].[LastUsedAt]
FROM [ApiKeys] AS [a]
WHERE [a].[Key] = @__providedApiKey_0 AND [a].[IsActive] = CAST(1 AS bit)
2025-02-02 01:00:00.019 +03:00 [INF] Received notification request: {"Title":null,"TitleEn":"Test Notification","TitleAr":" ","Filters":null,"NationalId":"1064448614","NationalIds":null}
2025-02-02 01:00:00.411 +03:00 [INF] Starting GetTargetUsers with request type: Single User
2025-02-02 01:00:01.163 +03:00 [INF] Executed DbCommand (301ms) [Parameters=[@__request_NationalId_0='?' (Size = 450)], CommandType='"Text"', CommandTimeout='30']
SELECT [c].[NationalId]
FROM [Customers] AS [c]
WHERE [c].[NationalId] = @__request_NationalId_0
2025-02-02 01:00:01.257 +03:00 [INF] Found 1 users matching national ID 1064448614
2025-02-02 01:00:01.261 +03:00 [INF] Target users query completed. Found 1 users
2025-02-02 01:00:01.264 +03:00 [INF] Found 1 target users for notification
2025-02-02 01:00:01.334 +03:00 [INF] Executed DbCommand (61ms) [Parameters=[@p0='?' (Size = 4000), @p1='?' (Size = 8000) (DbType = AnsiString), @p2='?' (Size = 4000), @p3='?' (Size = 8000) (DbType = AnsiString), @p4='?' (DbType = DateTime2), @p5='?' (DbType = DateTime2), @p6='?' (Size = 255), @p7='?' (Size = 4000), @p8='?' (Size = 255), @p9='?' (Size = 255), @p10='?' (Size = 255)], CommandType='"Text"', CommandTimeout='30']
SET IMPLICIT_TRANSACTIONS OFF;
SET NOCOUNT ON;
INSERT INTO [notification_templates] ([additional_data], [Body], [body_ar], [body_en], [created_at], [expiry_at], [Route], [target_criteria], [Title], [title_ar], [title_en])
OUTPUT INSERTED.[Id]
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7, @p8, @p9, @p10);
2025-02-02 01:00:01.724 +03:00 [INF] Created notification template with ID: 5
2025-02-02 01:00:01.889 +03:00 [INF] Executed DbCommand (9ms) [Parameters=[@p0='?' (Size = 4000), @p1='?' (DbType = DateTime2), @p2='?' (Size = 4000), @p3='?' (Size = 4000), @p4='?' (Size = 4000), @p5='?' (Size = 450), @p6='?' (Size = 4000), @p7='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SET IMPLICIT_TRANSACTIONS OFF;
SET NOCOUNT ON;
INSERT INTO [AuthLogs] ([AuthType], [CreatedAt], [DeviceId], [FailureReason], [IpAddress], [NationalId], [Status], [UserAgent])
OUTPUT INSERTED.[Id]
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7);
2025-02-02 01:00:01.900 +03:00 [INF] Executed DbCommand (3ms) [Parameters=[@__userId_0='?' (Size = 450)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [u].[national_id], [u].[last_updated], [u].[notifications]
FROM [user_notifications] AS [u]
WHERE [u].[national_id] = @__userId_0
2025-02-02 01:00:01.902 +03:00 [INF] Processing notification for user 1064448614. Existing notification record: true
2025-02-02 01:00:01.905 +03:00 [INF] Current notifications count for user 1064448614: 1
2025-02-02 01:00:01.914 +03:00 [INF] Serialized new notifications for user 1064448614. Length: 275
2025-02-02 01:00:01.956 +03:00 [INF] Executed DbCommand (32ms) [Parameters=[@p0='?' (Size = 4000), @p1='?' (DbType = DateTime2), @p2='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
UPDATE user_notifications SET notifications = @p0, last_updated = @p1 WHERE national_id = @p2
2025-02-02 01:00:01.962 +03:00 [INF] Updated existing UserNotification for user: 1064448614
2025-02-02 01:00:01.966 +03:00 [INF] Executed DbCommand (2ms) [Parameters=[@p0='?' (Size = 4000), @p1='?' (DbType = DateTime2), @p2='?' (Size = 4000), @p3='?' (Size = 4000), @p4='?' (Size = 4000), @p5='?' (Size = 450), @p6='?' (Size = 4000), @p7='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SET IMPLICIT_TRANSACTIONS OFF;
SET NOCOUNT ON;
INSERT INTO [AuthLogs] ([AuthType], [CreatedAt], [DeviceId], [FailureReason], [IpAddress], [NationalId], [Status], [UserAgent])
OUTPUT INSERTED.[Id]
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7);
2025-02-02 01:00:01.971 +03:00 [INF] Successfully sent notifications. Template: 5, Success: 1, Total: 1
2025-02-02 01:00:01.974 +03:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType9`2[[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Object, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-02-02 01:00:01.981 +03:00 [INF] Executed action NayifatAPI.Controllers.NotificationsController.SendNotification (NayifatAPI) in 2366.3925ms
2025-02-02 01:00:01.985 +03:00 [INF] Executed endpoint 'NayifatAPI.Controllers.NotificationsController.SendNotification (NayifatAPI)'
2025-02-02 01:00:01.986 +03:00 [INF] Request finished HTTP/1.1 POST http://957c-51-252-155-185.ngrok-free.app/api/notifications/send - 200 null application/json; charset=utf-8 2875.0191ms
2025-02-02 01:00:03.936 +03:00 [INF] Request starting HTTP/1.1 POST http://957c-51-252-155-185.ngrok-free.app/api/notifications/list - application/json; charset=utf-8 47
2025-02-02 01:00:03.941 +03:00 [INF] Executing endpoint 'NayifatAPI.Controllers.NotificationsController.GetNotifications (NayifatAPI)'
2025-02-02 01:00:03.943 +03:00 [INF] Route matched with {action = "GetNotifications", controller = "Notifications"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetNotifications(NayifatAPI.Controllers.GetNotificationsRequest) on controller NayifatAPI.Controllers.NotificationsController (NayifatAPI).
2025-02-02 01:00:03.948 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@__providedApiKey_0='?' (Size = 255)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [a].[Key], [a].[CreatedAt], [a].[Description], [a].[ExpiresAt], [a].[IsActive], [a].[LastUsedAt]
FROM [ApiKeys] AS [a]
WHERE [a].[Key] = @__providedApiKey_0 AND [a].[IsActive] = CAST(1 AS bit)
2025-02-02 01:00:03.952 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@__request_NationalId_0='?' (Size = 450)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [u].[national_id], [u].[last_updated], [u].[notifications]
FROM [user_notifications] AS [u]
WHERE [u].[national_id] = @__request_NationalId_0
2025-02-02 01:00:03.959 +03:00 [INF] Executed DbCommand (3ms) [Parameters=[@__Parse_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [n].[Id], [n].[additional_data], [n].[Body], [n].[body_ar], [n].[body_en], [n].[created_at], [n].[expiry_at], [n].[Route], [n].[target_criteria], [n].[Title], [n].[title_ar], [n].[title_en]
FROM [notification_templates] AS [n]
WHERE [n].[Id] = @__Parse_0
2025-02-02 01:00:03.963 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@__Parse_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [n].[Id], [n].[additional_data], [n].[Body], [n].[body_ar], [n].[body_en], [n].[created_at], [n].[expiry_at], [n].[Route], [n].[target_criteria], [n].[Title], [n].[title_ar], [n].[title_en]
FROM [notification_templates] AS [n]
WHERE [n].[Id] = @__Parse_0
2025-02-02 01:00:03.975 +03:00 [INF] Executed DbCommand (6ms) [Parameters=[@p0='?' (Size = 4000), @p1='?' (DbType = DateTime2), @p2='?' (Size = 4000), @p3='?' (Size = 4000), @p4='?' (Size = 4000), @p5='?' (Size = 450), @p6='?' (Size = 4000), @p7='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SET IMPLICIT_TRANSACTIONS OFF;
SET NOCOUNT ON;
INSERT INTO [AuthLogs] ([AuthType], [CreatedAt], [DeviceId], [FailureReason], [IpAddress], [NationalId], [Status], [UserAgent])
OUTPUT INSERTED.[Id]
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7);
2025-02-02 01:00:03.979 +03:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType9`2[[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Object, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-02-02 01:00:03.981 +03:00 [INF] Executed action NayifatAPI.Controllers.NotificationsController.GetNotifications (NayifatAPI) in 35.6486ms
2025-02-02 01:00:03.983 +03:00 [INF] Executed endpoint 'NayifatAPI.Controllers.NotificationsController.GetNotifications (NayifatAPI)'
2025-02-02 01:00:03.984 +03:00 [INF] Request finished HTTP/1.1 POST http://957c-51-252-155-185.ngrok-free.app/api/notifications/list - 200 null application/json; charset=utf-8 48.7312ms
2025-02-02 01:00:49.988 +03:00 [INF] Request starting HTTP/1.1 POST http://957c-51-252-155-185.ngrok-free.app/api/notifications/list - application/json; charset=utf-8 47
2025-02-02 01:00:49.991 +03:00 [INF] Executing endpoint 'NayifatAPI.Controllers.NotificationsController.GetNotifications (NayifatAPI)'
2025-02-02 01:00:49.992 +03:00 [INF] Route matched with {action = "GetNotifications", controller = "Notifications"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetNotifications(NayifatAPI.Controllers.GetNotificationsRequest) on controller NayifatAPI.Controllers.NotificationsController (NayifatAPI).
2025-02-02 01:00:49.996 +03:00 [INF] Executed DbCommand (0ms) [Parameters=[@__providedApiKey_0='?' (Size = 255)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [a].[Key], [a].[CreatedAt], [a].[Description], [a].[ExpiresAt], [a].[IsActive], [a].[LastUsedAt]
FROM [ApiKeys] AS [a]
WHERE [a].[Key] = @__providedApiKey_0 AND [a].[IsActive] = CAST(1 AS bit)
2025-02-02 01:00:49.999 +03:00 [INF] Executed DbCommand (0ms) [Parameters=[@__request_NationalId_0='?' (Size = 450)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [u].[national_id], [u].[last_updated], [u].[notifications]
FROM [user_notifications] AS [u]
WHERE [u].[national_id] = @__request_NationalId_0
2025-02-02 01:00:50.001 +03:00 [INF] Executed DbCommand (0ms) [Parameters=[@__Parse_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [n].[Id], [n].[additional_data], [n].[Body], [n].[body_ar], [n].[body_en], [n].[created_at], [n].[expiry_at], [n].[Route], [n].[target_criteria], [n].[Title], [n].[title_ar], [n].[title_en]
FROM [notification_templates] AS [n]
WHERE [n].[Id] = @__Parse_0
2025-02-02 01:00:50.004 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@__Parse_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [n].[Id], [n].[additional_data], [n].[Body], [n].[body_ar], [n].[body_en], [n].[created_at], [n].[expiry_at], [n].[Route], [n].[target_criteria], [n].[Title], [n].[title_ar], [n].[title_en]
FROM [notification_templates] AS [n]
WHERE [n].[Id] = @__Parse_0
2025-02-02 01:00:50.013 +03:00 [INF] Executed DbCommand (6ms) [Parameters=[@p0='?' (Size = 4000), @p1='?' (DbType = DateTime2), @p2='?' (Size = 4000), @p3='?' (Size = 4000), @p4='?' (Size = 4000), @p5='?' (Size = 450), @p6='?' (Size = 4000), @p7='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SET IMPLICIT_TRANSACTIONS OFF;
SET NOCOUNT ON;
INSERT INTO [AuthLogs] ([AuthType], [CreatedAt], [DeviceId], [FailureReason], [IpAddress], [NationalId], [Status], [UserAgent])
OUTPUT INSERTED.[Id]
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7);
2025-02-02 01:00:50.015 +03:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType9`2[[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Object, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-02-02 01:00:50.016 +03:00 [INF] Executed action NayifatAPI.Controllers.NotificationsController.GetNotifications (NayifatAPI) in 23.2411ms
2025-02-02 01:00:50.017 +03:00 [INF] Executed endpoint 'NayifatAPI.Controllers.NotificationsController.GetNotifications (NayifatAPI)'
2025-02-02 01:00:50.018 +03:00 [INF] Request finished HTTP/1.1 POST http://957c-51-252-155-185.ngrok-free.app/api/notifications/list - 200 null application/json; charset=utf-8 30.3233ms
2025-02-02 01:01:12.844 +03:00 [INF] Request starting HTTP/1.1 POST http://957c-51-252-155-185.ngrok-free.app/api/auth/signin - application/json; charset=utf-8 224
2025-02-02 01:01:12.850 +03:00 [INF] Executing endpoint 'NayifatAPI.Controllers.AuthController.SignIn (NayifatAPI)'
2025-02-02 01:01:12.851 +03:00 [INF] Route matched with {action = "SignIn", controller = "Auth"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] SignIn(NayifatAPI.Controllers.SignInRequest) on controller NayifatAPI.Controllers.AuthController (NayifatAPI).
2025-02-02 01:01:12.855 +03:00 [INF] Executed DbCommand (2ms) [Parameters=[@__providedApiKey_0='?' (Size = 255)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [a].[Key], [a].[CreatedAt], [a].[Description], [a].[ExpiresAt], [a].[IsActive], [a].[LastUsedAt]
FROM [ApiKeys] AS [a]
WHERE [a].[Key] = @__providedApiKey_0 AND [a].[IsActive] = CAST(1 AS bit)
2025-02-02 01:01:12.859 +03:00 [INF] Executed DbCommand (2ms) [Parameters=[@__request_NationalId_0='?' (Size = 450)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [c].[NationalId], [c].[AddNo], [c].[BuildingNo], [c].[City], [c].[Consent], [c].[ConsentDate], [c].[DateOfBirth], [c].[Dependents], [c].[District], [c].[Email], [c].[Employer], [c].[FamilyNameAr], [c].[FamilyNameEn], [c].[FirstNameAr], [c].[FirstNameEn], [c].[Iban], [c].[IdExpiryDate], [c].[Los], [c].[Mpin], [c].[MpinEnabled], [c].[NafathStatus], [c].[NafathTimestamp], [c].[Password], [c].[Phone], [c].[RegistrationDate], [c].[SalaryCustomer], [c].[SalaryDakhli], [c].[SecondNameAr], [c].[SecondNameEn], [c].[Sector], [c].[Street], [c].[ThirdNameAr], [c].[ThirdNameEn], [c].[Zipcode]
FROM [Customers] AS [c]
WHERE [c].[NationalId] = @__request_NationalId_0
2025-02-02 01:01:13.059 +03:00 [INF] Executed DbCommand (6ms) [Parameters=[@__request_NationalId_0='?' (Size = 450), @__request_DeviceId_1='?' (Size = 450)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [c].[Id], [c].[BiometricEnabled], [c].[BiometricToken], [c].[CreatedAt], [c].[DeviceId], [c].[LastUsedAt], [c].[Manufacturer], [c].[Model], [c].[NationalId], [c].[OsVersion], [c].[Platform], [c].[Status]
FROM [Customer_Devices] AS [c]
WHERE [c].[NationalId] = @__request_NationalId_0 AND [c].[DeviceId] = @__request_DeviceId_1 AND [c].[Status] = N'active'
2025-02-02 01:01:13.139 +03:00 [INF] Executed DbCommand (75ms) [Parameters=[@p0='?' (Size = 4000), @p1='?' (DbType = DateTime2), @p2='?' (Size = 4000), @p3='?' (Size = 4000), @p4='?' (Size = 4000), @p5='?' (Size = 450), @p6='?' (Size = 4000), @p7='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SET IMPLICIT_TRANSACTIONS OFF;
SET NOCOUNT ON;
INSERT INTO [AuthLogs] ([AuthType], [CreatedAt], [DeviceId], [FailureReason], [IpAddress], [NationalId], [Status], [UserAgent])
OUTPUT INSERTED.[Id]
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7);
2025-02-02 01:01:13.141 +03:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType9`2[[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Object, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-02-02 01:01:13.142 +03:00 [INF] Executed action NayifatAPI.Controllers.AuthController.SignIn (NayifatAPI) in 290.553ms
2025-02-02 01:01:13.143 +03:00 [INF] Executed endpoint 'NayifatAPI.Controllers.AuthController.SignIn (NayifatAPI)'
2025-02-02 01:01:13.144 +03:00 [INF] Request finished HTTP/1.1 POST http://957c-51-252-155-185.ngrok-free.app/api/auth/signin - 200 null application/json; charset=utf-8 300.115ms
2025-02-02 01:02:58.970 +03:00 [INF] Application is shutting down...
2025-02-02 01:03:08.105 +03:00 [INF] Starting web application
2025-02-02 01:03:08.229 +03:00 [INF] Now listening on: http://localhost:5264
2025-02-02 01:03:08.235 +03:00 [INF] Application started. Press Ctrl+C to shut down.
2025-02-02 01:03:08.236 +03:00 [INF] Hosting environment: Development
2025-02-02 01:03:08.237 +03:00 [INF] Content root path: C:\Users\yamta\StudioProjects\nayifat_app_2025_new\nayifatapi
2025-02-02 01:03:19.685 +03:00 [INF] Request starting HTTP/1.1 POST http://957c-51-252-155-185.ngrok-free.app/api/auth/signin - application/json; charset=utf-8 224
2025-02-02 01:03:19.727 +03:00 [WRN] Failed to determine the https port for redirect.
2025-02-02 01:03:19.732 +03:00 [INF] Executing endpoint 'NayifatAPI.Controllers.AuthController.SignIn (NayifatAPI)'
2025-02-02 01:03:19.760 +03:00 [INF] Route matched with {action = "SignIn", controller = "Auth"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] SignIn(NayifatAPI.Controllers.SignInRequest) on controller NayifatAPI.Controllers.AuthController (NayifatAPI).
2025-02-02 01:03:20.924 +03:00 [INF] Executed DbCommand (29ms) [Parameters=[@__providedApiKey_0='?' (Size = 255)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [a].[Key], [a].[CreatedAt], [a].[Description], [a].[ExpiresAt], [a].[IsActive], [a].[LastUsedAt]
FROM [ApiKeys] AS [a]
WHERE [a].[Key] = @__providedApiKey_0 AND [a].[IsActive] = CAST(1 AS bit)
2025-02-02 01:03:21.036 +03:00 [INF] Executed DbCommand (14ms) [Parameters=[@__request_NationalId_0='?' (Size = 450)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [c].[NationalId], [c].[AddNo], [c].[BuildingNo], [c].[City], [c].[Consent], [c].[ConsentDate], [c].[DateOfBirth], [c].[Dependents], [c].[District], [c].[Email], [c].[Employer], [c].[FamilyNameAr], [c].[FamilyNameEn], [c].[FirstNameAr], [c].[FirstNameEn], [c].[Iban], [c].[IdExpiryDate], [c].[Los], [c].[Mpin], [c].[MpinEnabled], [c].[NafathStatus], [c].[NafathTimestamp], [c].[Password], [c].[Phone], [c].[RegistrationDate], [c].[SalaryCustomer], [c].[SalaryDakhli], [c].[SecondNameAr], [c].[SecondNameEn], [c].[Sector], [c].[Street], [c].[ThirdNameAr], [c].[ThirdNameEn], [c].[Zipcode]
FROM [Customers] AS [c]
WHERE [c].[NationalId] = @__request_NationalId_0
2025-02-02 01:03:21.127 +03:00 [INF] Starting password verification for NationalId: 1064448614
2025-02-02 01:03:21.456 +03:00 [INF] Password verification result for NationalId 1064448614: Success
2025-02-02 01:03:21.474 +03:00 [INF] Executed DbCommand (4ms) [Parameters=[@__request_NationalId_0='?' (Size = 450), @__request_DeviceId_1='?' (Size = 450)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [c].[Id], [c].[BiometricEnabled], [c].[BiometricToken], [c].[CreatedAt], [c].[DeviceId], [c].[LastUsedAt], [c].[Manufacturer], [c].[Model], [c].[NationalId], [c].[OsVersion], [c].[Platform], [c].[Status]
FROM [Customer_Devices] AS [c]
WHERE [c].[NationalId] = @__request_NationalId_0 AND [c].[DeviceId] = @__request_DeviceId_1 AND [c].[Status] = N'active'
2025-02-02 01:03:21.754 +03:00 [INF] Executed DbCommand (77ms) [Parameters=[@p0='?' (Size = 4000), @p1='?' (DbType = DateTime2), @p2='?' (Size = 4000), @p3='?' (Size = 4000), @p4='?' (Size = 4000), @p5='?' (Size = 450), @p6='?' (Size = 4000), @p7='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SET IMPLICIT_TRANSACTIONS OFF;
SET NOCOUNT ON;
INSERT INTO [AuthLogs] ([AuthType], [CreatedAt], [DeviceId], [FailureReason], [IpAddress], [NationalId], [Status], [UserAgent])
OUTPUT INSERTED.[Id]
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7);
2025-02-02 01:03:21.787 +03:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType9`2[[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Object, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-02-02 01:03:21.808 +03:00 [INF] Executed action NayifatAPI.Controllers.AuthController.SignIn (NayifatAPI) in 2043.088ms
2025-02-02 01:03:21.811 +03:00 [INF] Executed endpoint 'NayifatAPI.Controllers.AuthController.SignIn (NayifatAPI)'
2025-02-02 01:03:21.822 +03:00 [INF] Request finished HTTP/1.1 POST http://957c-51-252-155-185.ngrok-free.app/api/auth/signin - 200 null application/json; charset=utf-8 2137.9154ms
2025-02-02 01:05:05.253 +03:00 [INF] Request starting HTTP/1.1 POST http://957c-51-252-155-185.ngrok-free.app/api/notifications/list - application/json; charset=utf-8 47
2025-02-02 01:05:05.261 +03:00 [INF] Executing endpoint 'NayifatAPI.Controllers.NotificationsController.GetNotifications (NayifatAPI)'
2025-02-02 01:05:05.268 +03:00 [INF] Route matched with {action = "GetNotifications", controller = "Notifications"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetNotifications(NayifatAPI.Controllers.GetNotificationsRequest) on controller NayifatAPI.Controllers.NotificationsController (NayifatAPI).
2025-02-02 01:05:05.300 +03:00 [INF] Executed DbCommand (3ms) [Parameters=[@__providedApiKey_0='?' (Size = 255)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [a].[Key], [a].[CreatedAt], [a].[Description], [a].[ExpiresAt], [a].[IsActive], [a].[LastUsedAt]
FROM [ApiKeys] AS [a]
WHERE [a].[Key] = @__providedApiKey_0 AND [a].[IsActive] = CAST(1 AS bit)
2025-02-02 01:05:05.311 +03:00 [INF] Executed DbCommand (2ms) [Parameters=[@__request_NationalId_0='?' (Size = 450)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [u].[national_id], [u].[last_updated], [u].[notifications]
FROM [user_notifications] AS [u]
WHERE [u].[national_id] = @__request_NationalId_0
2025-02-02 01:05:05.332 +03:00 [INF] Executed DbCommand (2ms) [Parameters=[@__Parse_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [n].[Id], [n].[additional_data], [n].[Body], [n].[body_ar], [n].[body_en], [n].[created_at], [n].[expiry_at], [n].[Route], [n].[target_criteria], [n].[Title], [n].[title_ar], [n].[title_en]
FROM [notification_templates] AS [n]
WHERE [n].[Id] = @__Parse_0
2025-02-02 01:05:05.361 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@__Parse_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [n].[Id], [n].[additional_data], [n].[Body], [n].[body_ar], [n].[body_en], [n].[created_at], [n].[expiry_at], [n].[Route], [n].[target_criteria], [n].[Title], [n].[title_ar], [n].[title_en]
FROM [notification_templates] AS [n]
WHERE [n].[Id] = @__Parse_0
2025-02-02 01:05:05.409 +03:00 [INF] Executed DbCommand (10ms) [Parameters=[@p0='?' (Size = 4000), @p1='?' (DbType = DateTime2), @p2='?' (Size = 4000), @p3='?' (Size = 4000), @p4='?' (Size = 4000), @p5='?' (Size = 450), @p6='?' (Size = 4000), @p7='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SET IMPLICIT_TRANSACTIONS OFF;
SET NOCOUNT ON;
INSERT INTO [AuthLogs] ([AuthType], [CreatedAt], [DeviceId], [FailureReason], [IpAddress], [NationalId], [Status], [UserAgent])
OUTPUT INSERTED.[Id]
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7);
2025-02-02 01:05:05.413 +03:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType9`2[[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Object, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-02-02 01:05:05.422 +03:00 [INF] Executed action NayifatAPI.Controllers.NotificationsController.GetNotifications (NayifatAPI) in 151.1094ms
2025-02-02 01:05:05.423 +03:00 [INF] Executed endpoint 'NayifatAPI.Controllers.NotificationsController.GetNotifications (NayifatAPI)'
2025-02-02 01:05:05.424 +03:00 [INF] Request finished HTTP/1.1 POST http://957c-51-252-155-185.ngrok-free.app/api/notifications/list - 200 null application/json; charset=utf-8 171.216ms
2025-02-02 01:07:08.082 +03:00 [INF] Request starting HTTP/1.1 POST http://957c-51-252-155-185.ngrok-free.app/api/auth/signin - application/json; charset=utf-8 224
2025-02-02 01:07:08.082 +03:00 [INF] Request starting HTTP/1.1 POST http://957c-51-252-155-185.ngrok-free.app/api/auth/signin - application/json; charset=utf-8 224
2025-02-02 01:07:08.088 +03:00 [INF] Executing endpoint 'NayifatAPI.Controllers.AuthController.SignIn (NayifatAPI)'
2025-02-02 01:07:08.088 +03:00 [INF] Executing endpoint 'NayifatAPI.Controllers.AuthController.SignIn (NayifatAPI)'
2025-02-02 01:07:08.089 +03:00 [INF] Route matched with {action = "SignIn", controller = "Auth"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] SignIn(NayifatAPI.Controllers.SignInRequest) on controller NayifatAPI.Controllers.AuthController (NayifatAPI).
2025-02-02 01:07:08.090 +03:00 [INF] Route matched with {action = "SignIn", controller = "Auth"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] SignIn(NayifatAPI.Controllers.SignInRequest) on controller NayifatAPI.Controllers.AuthController (NayifatAPI).
2025-02-02 01:07:08.151 +03:00 [INF] Executed DbCommand (3ms) [Parameters=[@__providedApiKey_0='?' (Size = 255)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [a].[Key], [a].[CreatedAt], [a].[Description], [a].[ExpiresAt], [a].[IsActive], [a].[LastUsedAt]
FROM [ApiKeys] AS [a]
WHERE [a].[Key] = @__providedApiKey_0 AND [a].[IsActive] = CAST(1 AS bit)
2025-02-02 01:07:08.154 +03:00 [INF] Executed DbCommand (0ms) [Parameters=[@__providedApiKey_0='?' (Size = 255)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [a].[Key], [a].[CreatedAt], [a].[Description], [a].[ExpiresAt], [a].[IsActive], [a].[LastUsedAt]
FROM [ApiKeys] AS [a]
WHERE [a].[Key] = @__providedApiKey_0 AND [a].[IsActive] = CAST(1 AS bit)
2025-02-02 01:07:08.157 +03:00 [INF] Executed DbCommand (3ms) [Parameters=[@__request_NationalId_0='?' (Size = 450)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [c].[NationalId], [c].[AddNo], [c].[BuildingNo], [c].[City], [c].[Consent], [c].[ConsentDate], [c].[DateOfBirth], [c].[Dependents], [c].[District], [c].[Email], [c].[Employer], [c].[FamilyNameAr], [c].[FamilyNameEn], [c].[FirstNameAr], [c].[FirstNameEn], [c].[Iban], [c].[IdExpiryDate], [c].[Los], [c].[Mpin], [c].[MpinEnabled], [c].[NafathStatus], [c].[NafathTimestamp], [c].[Password], [c].[Phone], [c].[RegistrationDate], [c].[SalaryCustomer], [c].[SalaryDakhli], [c].[SecondNameAr], [c].[SecondNameEn], [c].[Sector], [c].[Street], [c].[ThirdNameAr], [c].[ThirdNameEn], [c].[Zipcode]
FROM [Customers] AS [c]
WHERE [c].[NationalId] = @__request_NationalId_0
2025-02-02 01:07:08.157 +03:00 [INF] Executed DbCommand (0ms) [Parameters=[@__request_NationalId_0='?' (Size = 450)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [c].[NationalId], [c].[AddNo], [c].[BuildingNo], [c].[City], [c].[Consent], [c].[ConsentDate], [c].[DateOfBirth], [c].[Dependents], [c].[District], [c].[Email], [c].[Employer], [c].[FamilyNameAr], [c].[FamilyNameEn], [c].[FirstNameAr], [c].[FirstNameEn], [c].[Iban], [c].[IdExpiryDate], [c].[Los], [c].[Mpin], [c].[MpinEnabled], [c].[NafathStatus], [c].[NafathTimestamp], [c].[Password], [c].[Phone], [c].[RegistrationDate], [c].[SalaryCustomer], [c].[SalaryDakhli], [c].[SecondNameAr], [c].[SecondNameEn], [c].[Sector], [c].[Street], [c].[ThirdNameAr], [c].[ThirdNameEn], [c].[Zipcode]
FROM [Customers] AS [c]
WHERE [c].[NationalId] = @__request_NationalId_0
2025-02-02 01:07:08.159 +03:00 [INF] Starting password verification for NationalId: 1064448614
2025-02-02 01:07:08.160 +03:00 [INF] Starting password verification for NationalId: 1064448614
2025-02-02 01:07:08.561 +03:00 [INF] Password verification result for NationalId 1064448614: Success
2025-02-02 01:07:08.567 +03:00 [INF] Password verification result for NationalId 1064448614: Success
2025-02-02 01:07:08.567 +03:00 [INF] Executed DbCommand (4ms) [Parameters=[@__request_NationalId_0='?' (Size = 450), @__request_DeviceId_1='?' (Size = 450)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [c].[Id], [c].[BiometricEnabled], [c].[BiometricToken], [c].[CreatedAt], [c].[DeviceId], [c].[LastUsedAt], [c].[Manufacturer], [c].[Model], [c].[NationalId], [c].[OsVersion], [c].[Platform], [c].[Status]
FROM [Customer_Devices] AS [c]
WHERE [c].[NationalId] = @__request_NationalId_0 AND [c].[DeviceId] = @__request_DeviceId_1 AND [c].[Status] = N'active'
2025-02-02 01:07:08.569 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@__request_NationalId_0='?' (Size = 450), @__request_DeviceId_1='?' (Size = 450)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [c].[Id], [c].[BiometricEnabled], [c].[BiometricToken], [c].[CreatedAt], [c].[DeviceId], [c].[LastUsedAt], [c].[Manufacturer], [c].[Model], [c].[NationalId], [c].[OsVersion], [c].[Platform], [c].[Status]
FROM [Customer_Devices] AS [c]
WHERE [c].[NationalId] = @__request_NationalId_0 AND [c].[DeviceId] = @__request_DeviceId_1 AND [c].[Status] = N'active'
2025-02-02 01:07:08.581 +03:00 [INF] Executed DbCommand (8ms) [Parameters=[@p0='?' (Size = 4000), @p1='?' (DbType = DateTime2), @p2='?' (Size = 4000), @p3='?' (Size = 4000), @p4='?' (Size = 4000), @p5='?' (Size = 450), @p6='?' (Size = 4000), @p7='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SET IMPLICIT_TRANSACTIONS OFF;
SET NOCOUNT ON;
INSERT INTO [AuthLogs] ([AuthType], [CreatedAt], [DeviceId], [FailureReason], [IpAddress], [NationalId], [Status], [UserAgent])
OUTPUT INSERTED.[Id]
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7);
2025-02-02 01:07:08.581 +03:00 [INF] Executed DbCommand (7ms) [Parameters=[@p0='?' (Size = 4000), @p1='?' (DbType = DateTime2), @p2='?' (Size = 4000), @p3='?' (Size = 4000), @p4='?' (Size = 4000), @p5='?' (Size = 450), @p6='?' (Size = 4000), @p7='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SET IMPLICIT_TRANSACTIONS OFF;
SET NOCOUNT ON;
INSERT INTO [AuthLogs] ([AuthType], [CreatedAt], [DeviceId], [FailureReason], [IpAddress], [NationalId], [Status], [UserAgent])
OUTPUT INSERTED.[Id]
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7);
2025-02-02 01:07:08.584 +03:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType9`2[[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Object, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-02-02 01:07:08.585 +03:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType9`2[[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Object, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-02-02 01:07:08.585 +03:00 [INF] Executed action NayifatAPI.Controllers.AuthController.SignIn (NayifatAPI) in 494.2911ms
2025-02-02 01:07:08.586 +03:00 [INF] Executed action NayifatAPI.Controllers.AuthController.SignIn (NayifatAPI) in 494.065ms
2025-02-02 01:07:08.588 +03:00 [INF] Executed endpoint 'NayifatAPI.Controllers.AuthController.SignIn (NayifatAPI)'
2025-02-02 01:07:08.590 +03:00 [INF] Executed endpoint 'NayifatAPI.Controllers.AuthController.SignIn (NayifatAPI)'
2025-02-02 01:07:08.591 +03:00 [INF] Request finished HTTP/1.1 POST http://957c-51-252-155-185.ngrok-free.app/api/auth/signin - 200 null application/json; charset=utf-8 508.9052ms
2025-02-02 01:07:08.592 +03:00 [INF] Request finished HTTP/1.1 POST http://957c-51-252-155-185.ngrok-free.app/api/auth/signin - 200 null application/json; charset=utf-8 509.6741ms
2025-02-02 01:07:09.296 +03:00 [INF] Request starting HTTP/1.1 POST http://957c-51-252-155-185.ngrok-free.app/api/auth/otp/generate - application/x-www-form-urlencoded; charset=utf-8 22
2025-02-02 01:07:09.301 +03:00 [INF] Executing endpoint 'NayifatAPI.Controllers.AuthController.GenerateOtp (NayifatAPI)'
2025-02-02 01:07:09.304 +03:00 [INF] Route matched with {action = "GenerateOtp", controller = "Auth"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GenerateOtp(NayifatAPI.Controllers.OtpGenerateRequest) on controller NayifatAPI.Controllers.AuthController (NayifatAPI).
2025-02-02 01:07:09.317 +03:00 [INF] Executing ObjectResult, writing value of type 'Microsoft.AspNetCore.Mvc.ProblemDetails'.
2025-02-02 01:07:09.333 +03:00 [INF] Executed action NayifatAPI.Controllers.AuthController.GenerateOtp (NayifatAPI) in 27.86ms
2025-02-02 01:07:09.334 +03:00 [INF] Executed endpoint 'NayifatAPI.Controllers.AuthController.GenerateOtp (NayifatAPI)'
2025-02-02 01:07:09.336 +03:00 [INF] Request finished HTTP/1.1 POST http://957c-51-252-155-185.ngrok-free.app/api/auth/otp/generate - 415 null application/problem+json; charset=utf-8 40.0507ms
2025-02-02 01:07:09.386 +03:00 [INF] Request starting HTTP/1.1 POST http://957c-51-252-155-185.ngrok-free.app/api/auth/otp/generate - application/x-www-form-urlencoded; charset=utf-8 22
2025-02-02 01:07:09.391 +03:00 [INF] Executing endpoint 'NayifatAPI.Controllers.AuthController.GenerateOtp (NayifatAPI)'
2025-02-02 01:07:09.392 +03:00 [INF] Route matched with {action = "GenerateOtp", controller = "Auth"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GenerateOtp(NayifatAPI.Controllers.OtpGenerateRequest) on controller NayifatAPI.Controllers.AuthController (NayifatAPI).
2025-02-02 01:07:09.394 +03:00 [INF] Executing ObjectResult, writing value of type 'Microsoft.AspNetCore.Mvc.ProblemDetails'.
2025-02-02 01:07:09.395 +03:00 [INF] Executed action NayifatAPI.Controllers.AuthController.GenerateOtp (NayifatAPI) in 2.0934ms
2025-02-02 01:07:09.396 +03:00 [INF] Executed endpoint 'NayifatAPI.Controllers.AuthController.GenerateOtp (NayifatAPI)'
2025-02-02 01:07:09.397 +03:00 [INF] Request finished HTTP/1.1 POST http://957c-51-252-155-185.ngrok-free.app/api/auth/otp/generate - 415 null application/problem+json; charset=utf-8 10.8676ms
2025-02-02 01:07:23.655 +03:00 [INF] Request starting HTTP/1.1 POST http://957c-51-252-155-185.ngrok-free.app/api/notifications/list - application/json; charset=utf-8 47
2025-02-02 01:07:23.658 +03:00 [INF] Executing endpoint 'NayifatAPI.Controllers.NotificationsController.GetNotifications (NayifatAPI)'
2025-02-02 01:07:23.660 +03:00 [INF] Route matched with {action = "GetNotifications", controller = "Notifications"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetNotifications(NayifatAPI.Controllers.GetNotificationsRequest) on controller NayifatAPI.Controllers.NotificationsController (NayifatAPI).
2025-02-02 01:07:23.663 +03:00 [INF] Executed DbCommand (0ms) [Parameters=[@__providedApiKey_0='?' (Size = 255)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [a].[Key], [a].[CreatedAt], [a].[Description], [a].[ExpiresAt], [a].[IsActive], [a].[LastUsedAt]
FROM [ApiKeys] AS [a]
WHERE [a].[Key] = @__providedApiKey_0 AND [a].[IsActive] = CAST(1 AS bit)
2025-02-02 01:07:23.667 +03:00 [INF] Executed DbCommand (2ms) [Parameters=[@__request_NationalId_0='?' (Size = 450)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [u].[national_id], [u].[last_updated], [u].[notifications]
FROM [user_notifications] AS [u]
WHERE [u].[national_id] = @__request_NationalId_0
2025-02-02 01:07:23.671 +03:00 [INF] Executed DbCommand (2ms) [Parameters=[@__Parse_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [n].[Id], [n].[additional_data], [n].[Body], [n].[body_ar], [n].[body_en], [n].[created_at], [n].[expiry_at], [n].[Route], [n].[target_criteria], [n].[Title], [n].[title_ar], [n].[title_en]
FROM [notification_templates] AS [n]
WHERE [n].[Id] = @__Parse_0
2025-02-02 01:07:23.675 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@__Parse_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [n].[Id], [n].[additional_data], [n].[Body], [n].[body_ar], [n].[body_en], [n].[created_at], [n].[expiry_at], [n].[Route], [n].[target_criteria], [n].[Title], [n].[title_ar], [n].[title_en]
FROM [notification_templates] AS [n]
WHERE [n].[Id] = @__Parse_0
2025-02-02 01:07:23.752 +03:00 [INF] Executed DbCommand (73ms) [Parameters=[@p0='?' (Size = 4000), @p1='?' (DbType = DateTime2), @p2='?' (Size = 4000), @p3='?' (Size = 4000), @p4='?' (Size = 4000), @p5='?' (Size = 450), @p6='?' (Size = 4000), @p7='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SET IMPLICIT_TRANSACTIONS OFF;
SET NOCOUNT ON;
INSERT INTO [AuthLogs] ([AuthType], [CreatedAt], [DeviceId], [FailureReason], [IpAddress], [NationalId], [Status], [UserAgent])
OUTPUT INSERTED.[Id]
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7);
2025-02-02 01:07:23.756 +03:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType9`2[[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Object, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-02-02 01:07:23.758 +03:00 [INF] Executed action NayifatAPI.Controllers.NotificationsController.GetNotifications (NayifatAPI) in 96.58ms
2025-02-02 01:07:23.759 +03:00 [INF] Executed endpoint 'NayifatAPI.Controllers.NotificationsController.GetNotifications (NayifatAPI)'
2025-02-02 01:07:23.760 +03:00 [INF] Request finished HTTP/1.1 POST http://957c-51-252-155-185.ngrok-free.app/api/notifications/list - 200 null application/json; charset=utf-8 105.0996ms
2025-02-02 01:08:36.325 +03:00 [INF] Request starting HTTP/1.1 POST http://957c-51-252-155-185.ngrok-free.app/api/auth/signin - application/json; charset=utf-8 224
2025-02-02 01:08:36.327 +03:00 [INF] Executing endpoint 'NayifatAPI.Controllers.AuthController.SignIn (NayifatAPI)'
2025-02-02 01:08:36.328 +03:00 [INF] Route matched with {action = "SignIn", controller = "Auth"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] SignIn(NayifatAPI.Controllers.SignInRequest) on controller NayifatAPI.Controllers.AuthController (NayifatAPI).
2025-02-02 01:08:36.333 +03:00 [INF] Executed DbCommand (2ms) [Parameters=[@__providedApiKey_0='?' (Size = 255)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [a].[Key], [a].[CreatedAt], [a].[Description], [a].[ExpiresAt], [a].[IsActive], [a].[LastUsedAt]
FROM [ApiKeys] AS [a]
WHERE [a].[Key] = @__providedApiKey_0 AND [a].[IsActive] = CAST(1 AS bit)
2025-02-02 01:08:36.340 +03:00 [INF] Executed DbCommand (3ms) [Parameters=[@__request_NationalId_0='?' (Size = 450)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [c].[NationalId], [c].[AddNo], [c].[BuildingNo], [c].[City], [c].[Consent], [c].[ConsentDate], [c].[DateOfBirth], [c].[Dependents], [c].[District], [c].[Email], [c].[Employer], [c].[FamilyNameAr], [c].[FamilyNameEn], [c].[FirstNameAr], [c].[FirstNameEn], [c].[Iban], [c].[IdExpiryDate], [c].[Los], [c].[Mpin], [c].[MpinEnabled], [c].[NafathStatus], [c].[NafathTimestamp], [c].[Password], [c].[Phone], [c].[RegistrationDate], [c].[SalaryCustomer], [c].[SalaryDakhli], [c].[SecondNameAr], [c].[SecondNameEn], [c].[Sector], [c].[Street], [c].[ThirdNameAr], [c].[ThirdNameEn], [c].[Zipcode]
FROM [Customers] AS [c]
WHERE [c].[NationalId] = @__request_NationalId_0
2025-02-02 01:08:36.343 +03:00 [INF] Starting password verification for NationalId: 1064448614
2025-02-02 01:08:36.522 +03:00 [INF] Password verification result for NationalId 1064448614: Success
2025-02-02 01:08:36.528 +03:00 [INF] Executed DbCommand (4ms) [Parameters=[@__request_NationalId_0='?' (Size = 450), @__request_DeviceId_1='?' (Size = 450)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [c].[Id], [c].[BiometricEnabled], [c].[BiometricToken], [c].[CreatedAt], [c].[DeviceId], [c].[LastUsedAt], [c].[Manufacturer], [c].[Model], [c].[NationalId], [c].[OsVersion], [c].[Platform], [c].[Status]
FROM [Customer_Devices] AS [c]
WHERE [c].[NationalId] = @__request_NationalId_0 AND [c].[DeviceId] = @__request_DeviceId_1 AND [c].[Status] = N'active'
2025-02-02 01:08:36.608 +03:00 [INF] Executed DbCommand (77ms) [Parameters=[@p0='?' (Size = 4000), @p1='?' (DbType = DateTime2), @p2='?' (Size = 4000), @p3='?' (Size = 4000), @p4='?' (Size = 4000), @p5='?' (Size = 450), @p6='?' (Size = 4000), @p7='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SET IMPLICIT_TRANSACTIONS OFF;
SET NOCOUNT ON;
INSERT INTO [AuthLogs] ([AuthType], [CreatedAt], [DeviceId], [FailureReason], [IpAddress], [NationalId], [Status], [UserAgent])
OUTPUT INSERTED.[Id]
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7);
2025-02-02 01:08:36.611 +03:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType9`2[[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Object, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-02-02 01:08:36.612 +03:00 [INF] Executed action NayifatAPI.Controllers.AuthController.SignIn (NayifatAPI) in 282.7495ms
2025-02-02 01:08:36.613 +03:00 [INF] Executed endpoint 'NayifatAPI.Controllers.AuthController.SignIn (NayifatAPI)'
2025-02-02 01:08:36.615 +03:00 [INF] Request finished HTTP/1.1 POST http://957c-51-252-155-185.ngrok-free.app/api/auth/signin - 200 null application/json; charset=utf-8 289.7024ms
2025-02-02 01:08:37.314 +03:00 [INF] Request starting HTTP/1.1 POST http://957c-51-252-155-185.ngrok-free.app/api/auth/otp/generate - application/x-www-form-urlencoded; charset=utf-8 22
2025-02-02 01:08:37.317 +03:00 [INF] Executing endpoint 'NayifatAPI.Controllers.AuthController.GenerateOtp (NayifatAPI)'
2025-02-02 01:08:37.319 +03:00 [INF] Route matched with {action = "GenerateOtp", controller = "Auth"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GenerateOtp(NayifatAPI.Controllers.OtpGenerateRequest) on controller NayifatAPI.Controllers.AuthController (NayifatAPI).
2025-02-02 01:08:37.321 +03:00 [INF] Executing ObjectResult, writing value of type 'Microsoft.AspNetCore.Mvc.ProblemDetails'.
2025-02-02 01:08:37.322 +03:00 [INF] Executed action NayifatAPI.Controllers.AuthController.GenerateOtp (NayifatAPI) in 1.5903ms
2025-02-02 01:08:37.323 +03:00 [INF] Executed endpoint 'NayifatAPI.Controllers.AuthController.GenerateOtp (NayifatAPI)'
2025-02-02 01:08:37.323 +03:00 [INF] Request finished HTTP/1.1 POST http://957c-51-252-155-185.ngrok-free.app/api/auth/otp/generate - 415 null application/problem+json; charset=utf-8 9.5119ms
2025-02-02 01:10:07.988 +03:00 [INF] Request starting HTTP/1.1 POST http://957c-51-252-155-185.ngrok-free.app/api/notifications/list - application/json; charset=utf-8 47
2025-02-02 01:10:07.992 +03:00 [INF] Executing endpoint 'NayifatAPI.Controllers.NotificationsController.GetNotifications (NayifatAPI)'
2025-02-02 01:10:07.993 +03:00 [INF] Route matched with {action = "GetNotifications", controller = "Notifications"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetNotifications(NayifatAPI.Controllers.GetNotificationsRequest) on controller NayifatAPI.Controllers.NotificationsController (NayifatAPI).
2025-02-02 01:10:08.000 +03:00 [INF] Executed DbCommand (3ms) [Parameters=[@__providedApiKey_0='?' (Size = 255)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [a].[Key], [a].[CreatedAt], [a].[Description], [a].[ExpiresAt], [a].[IsActive], [a].[LastUsedAt]
FROM [ApiKeys] AS [a]
WHERE [a].[Key] = @__providedApiKey_0 AND [a].[IsActive] = CAST(1 AS bit)
2025-02-02 01:10:08.130 +03:00 [INF] Executed DbCommand (127ms) [Parameters=[@__request_NationalId_0='?' (Size = 450)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [u].[national_id], [u].[last_updated], [u].[notifications]
FROM [user_notifications] AS [u]
WHERE [u].[national_id] = @__request_NationalId_0
2025-02-02 01:10:08.135 +03:00 [INF] Executed DbCommand (3ms) [Parameters=[@__Parse_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [n].[Id], [n].[additional_data], [n].[Body], [n].[body_ar], [n].[body_en], [n].[created_at], [n].[expiry_at], [n].[Route], [n].[target_criteria], [n].[Title], [n].[title_ar], [n].[title_en]
FROM [notification_templates] AS [n]
WHERE [n].[Id] = @__Parse_0
2025-02-02 01:10:08.139 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@__Parse_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [n].[Id], [n].[additional_data], [n].[Body], [n].[body_ar], [n].[body_en], [n].[created_at], [n].[expiry_at], [n].[Route], [n].[target_criteria], [n].[Title], [n].[title_ar], [n].[title_en]
FROM [notification_templates] AS [n]
WHERE [n].[Id] = @__Parse_0
2025-02-02 01:10:08.149 +03:00 [INF] Executed DbCommand (7ms) [Parameters=[@p0='?' (Size = 4000), @p1='?' (DbType = DateTime2), @p2='?' (Size = 4000), @p3='?' (Size = 4000), @p4='?' (Size = 4000), @p5='?' (Size = 450), @p6='?' (Size = 4000), @p7='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SET IMPLICIT_TRANSACTIONS OFF;
SET NOCOUNT ON;
INSERT INTO [AuthLogs] ([AuthType], [CreatedAt], [DeviceId], [FailureReason], [IpAddress], [NationalId], [Status], [UserAgent])
OUTPUT INSERTED.[Id]
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7);
2025-02-02 01:10:08.152 +03:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType9`2[[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Object, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-02-02 01:10:08.153 +03:00 [INF] Executed action NayifatAPI.Controllers.NotificationsController.GetNotifications (NayifatAPI) in 158.4498ms
2025-02-02 01:10:08.154 +03:00 [INF] Executed endpoint 'NayifatAPI.Controllers.NotificationsController.GetNotifications (NayifatAPI)'
2025-02-02 01:10:08.155 +03:00 [INF] Request finished HTTP/1.1 POST http://957c-51-252-155-185.ngrok-free.app/api/notifications/list - 200 null application/json; charset=utf-8 166.6765ms
2025-02-02 01:10:26.104 +03:00 [INF] Request starting HTTP/1.1 POST http://957c-51-252-155-185.ngrok-free.app/api/auth/signin - application/json; charset=utf-8 224
2025-02-02 01:10:26.108 +03:00 [INF] Executing endpoint 'NayifatAPI.Controllers.AuthController.SignIn (NayifatAPI)'
2025-02-02 01:10:26.109 +03:00 [INF] Route matched with {action = "SignIn", controller = "Auth"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] SignIn(NayifatAPI.Controllers.SignInRequest) on controller NayifatAPI.Controllers.AuthController (NayifatAPI).
2025-02-02 01:10:26.113 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@__providedApiKey_0='?' (Size = 255)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [a].[Key], [a].[CreatedAt], [a].[Description], [a].[ExpiresAt], [a].[IsActive], [a].[LastUsedAt]
FROM [ApiKeys] AS [a]
WHERE [a].[Key] = @__providedApiKey_0 AND [a].[IsActive] = CAST(1 AS bit)
2025-02-02 01:10:26.119 +03:00 [INF] Executed DbCommand (3ms) [Parameters=[@__request_NationalId_0='?' (Size = 450)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [c].[NationalId], [c].[AddNo], [c].[BuildingNo], [c].[City], [c].[Consent], [c].[ConsentDate], [c].[DateOfBirth], [c].[Dependents], [c].[District], [c].[Email], [c].[Employer], [c].[FamilyNameAr], [c].[FamilyNameEn], [c].[FirstNameAr], [c].[FirstNameEn], [c].[Iban], [c].[IdExpiryDate], [c].[Los], [c].[Mpin], [c].[MpinEnabled], [c].[NafathStatus], [c].[NafathTimestamp], [c].[Password], [c].[Phone], [c].[RegistrationDate], [c].[SalaryCustomer], [c].[SalaryDakhli], [c].[SecondNameAr], [c].[SecondNameEn], [c].[Sector], [c].[Street], [c].[ThirdNameAr], [c].[ThirdNameEn], [c].[Zipcode]
FROM [Customers] AS [c]
WHERE [c].[NationalId] = @__request_NationalId_0
2025-02-02 01:10:26.122 +03:00 [INF] Starting password verification for NationalId: 1064448614
2025-02-02 01:10:26.302 +03:00 [INF] Password verification result for NationalId 1064448614: Success
2025-02-02 01:10:26.306 +03:00 [INF] Executed DbCommand (2ms) [Parameters=[@__request_NationalId_0='?' (Size = 450), @__request_DeviceId_1='?' (Size = 450)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [c].[Id], [c].[BiometricEnabled], [c].[BiometricToken], [c].[CreatedAt], [c].[DeviceId], [c].[LastUsedAt], [c].[Manufacturer], [c].[Model], [c].[NationalId], [c].[OsVersion], [c].[Platform], [c].[Status]
FROM [Customer_Devices] AS [c]
WHERE [c].[NationalId] = @__request_NationalId_0 AND [c].[DeviceId] = @__request_DeviceId_1 AND [c].[Status] = N'active'
2025-02-02 01:10:26.383 +03:00 [INF] Executed DbCommand (75ms) [Parameters=[@p0='?' (Size = 4000), @p1='?' (DbType = DateTime2), @p2='?' (Size = 4000), @p3='?' (Size = 4000), @p4='?' (Size = 4000), @p5='?' (Size = 450), @p6='?' (Size = 4000), @p7='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SET IMPLICIT_TRANSACTIONS OFF;
SET NOCOUNT ON;
INSERT INTO [AuthLogs] ([AuthType], [CreatedAt], [DeviceId], [FailureReason], [IpAddress], [NationalId], [Status], [UserAgent])
OUTPUT INSERTED.[Id]
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7);
2025-02-02 01:10:26.386 +03:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType9`2[[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Object, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-02-02 01:10:26.387 +03:00 [INF] Executed action NayifatAPI.Controllers.AuthController.SignIn (NayifatAPI) in 276.6057ms
2025-02-02 01:10:26.388 +03:00 [INF] Executed endpoint 'NayifatAPI.Controllers.AuthController.SignIn (NayifatAPI)'
2025-02-02 01:10:26.390 +03:00 [INF] Request finished HTTP/1.1 POST http://957c-51-252-155-185.ngrok-free.app/api/auth/signin - 200 null application/json; charset=utf-8 286.2289ms
2025-02-02 01:10:26.985 +03:00 [INF] Request starting HTTP/1.1 POST http://957c-51-252-155-185.ngrok-free.app/api/auth/otp/generate - application/json; charset=utf-8 27
2025-02-02 01:10:26.988 +03:00 [INF] Executing endpoint 'NayifatAPI.Controllers.AuthController.GenerateOtp (NayifatAPI)'
2025-02-02 01:10:26.989 +03:00 [INF] Route matched with {action = "GenerateOtp", controller = "Auth"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GenerateOtp(NayifatAPI.Controllers.OtpGenerateRequest) on controller NayifatAPI.Controllers.AuthController (NayifatAPI).
2025-02-02 01:10:26.996 +03:00 [INF] Executing BadRequestObjectResult, writing value of type 'Microsoft.AspNetCore.Mvc.ValidationProblemDetails'.
2025-02-02 01:10:27.001 +03:00 [INF] Executed action NayifatAPI.Controllers.AuthController.GenerateOtp (NayifatAPI) in 10.1368ms
2025-02-02 01:10:27.003 +03:00 [INF] Executed endpoint 'NayifatAPI.Controllers.AuthController.GenerateOtp (NayifatAPI)'
2025-02-02 01:10:27.004 +03:00 [INF] Request finished HTTP/1.1 POST http://957c-51-252-155-185.ngrok-free.app/api/auth/otp/generate - 400 null application/problem+json; charset=utf-8 19.5782ms
2025-02-02 01:12:27.477 +03:00 [INF] Request starting HTTP/1.1 POST http://957c-51-252-155-185.ngrok-free.app/api/auth/signin - application/json; charset=utf-8 224
2025-02-02 01:12:27.579 +03:00 [INF] Executing endpoint 'NayifatAPI.Controllers.AuthController.SignIn (NayifatAPI)'
2025-02-02 01:12:27.593 +03:00 [INF] Route matched with {action = "SignIn", controller = "Auth"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] SignIn(NayifatAPI.Controllers.SignInRequest) on controller NayifatAPI.Controllers.AuthController (NayifatAPI).
2025-02-02 01:12:27.623 +03:00 [INF] Executed DbCommand (4ms) [Parameters=[@__providedApiKey_0='?' (Size = 255)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [a].[Key], [a].[CreatedAt], [a].[Description], [a].[ExpiresAt], [a].[IsActive], [a].[LastUsedAt]
FROM [ApiKeys] AS [a]
WHERE [a].[Key] = @__providedApiKey_0 AND [a].[IsActive] = CAST(1 AS bit)
2025-02-02 01:12:27.655 +03:00 [INF] Executed DbCommand (5ms) [Parameters=[@__request_NationalId_0='?' (Size = 450)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [c].[NationalId], [c].[AddNo], [c].[BuildingNo], [c].[City], [c].[Consent], [c].[ConsentDate], [c].[DateOfBirth], [c].[Dependents], [c].[District], [c].[Email], [c].[Employer], [c].[FamilyNameAr], [c].[FamilyNameEn], [c].[FirstNameAr], [c].[FirstNameEn], [c].[Iban], [c].[IdExpiryDate], [c].[Los], [c].[Mpin], [c].[MpinEnabled], [c].[NafathStatus], [c].[NafathTimestamp], [c].[Password], [c].[Phone], [c].[RegistrationDate], [c].[SalaryCustomer], [c].[SalaryDakhli], [c].[SecondNameAr], [c].[SecondNameEn], [c].[Sector], [c].[Street], [c].[ThirdNameAr], [c].[ThirdNameEn], [c].[Zipcode]
FROM [Customers] AS [c]
WHERE [c].[NationalId] = @__request_NationalId_0
2025-02-02 01:12:27.709 +03:00 [INF] Starting password verification for NationalId: 1064448614
2025-02-02 01:12:27.974 +03:00 [INF] Password verification result for NationalId 1064448614: Success
2025-02-02 01:12:27.982 +03:00 [INF] Executed DbCommand (4ms) [Parameters=[@__request_NationalId_0='?' (Size = 450), @__request_DeviceId_1='?' (Size = 450)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [c].[Id], [c].[BiometricEnabled], [c].[BiometricToken], [c].[CreatedAt], [c].[DeviceId], [c].[LastUsedAt], [c].[Manufacturer], [c].[Model], [c].[NationalId], [c].[OsVersion], [c].[Platform], [c].[Status]
FROM [Customer_Devices] AS [c]
WHERE [c].[NationalId] = @__request_NationalId_0 AND [c].[DeviceId] = @__request_DeviceId_1 AND [c].[Status] = N'active'
2025-02-02 01:12:28.079 +03:00 [INF] Executed DbCommand (94ms) [Parameters=[@p0='?' (Size = 4000), @p1='?' (DbType = DateTime2), @p2='?' (Size = 4000), @p3='?' (Size = 4000), @p4='?' (Size = 4000), @p5='?' (Size = 450), @p6='?' (Size = 4000), @p7='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SET IMPLICIT_TRANSACTIONS OFF;
SET NOCOUNT ON;
INSERT INTO [AuthLogs] ([AuthType], [CreatedAt], [DeviceId], [FailureReason], [IpAddress], [NationalId], [Status], [UserAgent])
OUTPUT INSERTED.[Id]
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7);
2025-02-02 01:12:28.091 +03:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType9`2[[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Object, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-02-02 01:12:28.093 +03:00 [INF] Executed action NayifatAPI.Controllers.AuthController.SignIn (NayifatAPI) in 475.8468ms
2025-02-02 01:12:28.107 +03:00 [INF] Executed endpoint 'NayifatAPI.Controllers.AuthController.SignIn (NayifatAPI)'
2025-02-02 01:12:28.123 +03:00 [INF] Request finished HTTP/1.1 POST http://957c-51-252-155-185.ngrok-free.app/api/auth/signin - 200 null application/json; charset=utf-8 646.1045ms
2025-02-02 01:14:07.361 +03:00 [INF] Request starting HTTP/1.1 POST http://957c-51-252-155-185.ngrok-free.app/api/auth/signin - application/json; charset=utf-8 224
2025-02-02 01:14:07.363 +03:00 [INF] Executing endpoint 'NayifatAPI.Controllers.AuthController.SignIn (NayifatAPI)'
2025-02-02 01:14:07.364 +03:00 [INF] Route matched with {action = "SignIn", controller = "Auth"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] SignIn(NayifatAPI.Controllers.SignInRequest) on controller NayifatAPI.Controllers.AuthController (NayifatAPI).
2025-02-02 01:14:07.371 +03:00 [INF] Executed DbCommand (3ms) [Parameters=[@__providedApiKey_0='?' (Size = 255)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [a].[Key], [a].[CreatedAt], [a].[Description], [a].[ExpiresAt], [a].[IsActive], [a].[LastUsedAt]
FROM [ApiKeys] AS [a]
WHERE [a].[Key] = @__providedApiKey_0 AND [a].[IsActive] = CAST(1 AS bit)
2025-02-02 01:14:07.381 +03:00 [INF] Executed DbCommand (3ms) [Parameters=[@__request_NationalId_0='?' (Size = 450)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [c].[NationalId], [c].[AddNo], [c].[BuildingNo], [c].[City], [c].[Consent], [c].[ConsentDate], [c].[DateOfBirth], [c].[Dependents], [c].[District], [c].[Email], [c].[Employer], [c].[FamilyNameAr], [c].[FamilyNameEn], [c].[FirstNameAr], [c].[FirstNameEn], [c].[Iban], [c].[IdExpiryDate], [c].[Los], [c].[Mpin], [c].[MpinEnabled], [c].[NafathStatus], [c].[NafathTimestamp], [c].[Password], [c].[Phone], [c].[RegistrationDate], [c].[SalaryCustomer], [c].[SalaryDakhli], [c].[SecondNameAr], [c].[SecondNameEn], [c].[Sector], [c].[Street], [c].[ThirdNameAr], [c].[ThirdNameEn], [c].[Zipcode]
FROM [Customers] AS [c]
WHERE [c].[NationalId] = @__request_NationalId_0
2025-02-02 01:14:07.384 +03:00 [INF] Starting password verification for NationalId: 1064448614
2025-02-02 01:14:07.578 +03:00 [INF] Password verification result for NationalId 1064448614: Success
2025-02-02 01:14:07.583 +03:00 [INF] Executed DbCommand (4ms) [Parameters=[@__request_NationalId_0='?' (Size = 450), @__request_DeviceId_1='?' (Size = 450)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [c].[Id], [c].[BiometricEnabled], [c].[BiometricToken], [c].[CreatedAt], [c].[DeviceId], [c].[LastUsedAt], [c].[Manufacturer], [c].[Model], [c].[NationalId], [c].[OsVersion], [c].[Platform], [c].[Status]
FROM [Customer_Devices] AS [c]
WHERE [c].[NationalId] = @__request_NationalId_0 AND [c].[DeviceId] = @__request_DeviceId_1 AND [c].[Status] = N'active'
2025-02-02 01:14:07.663 +03:00 [INF] Executed DbCommand (78ms) [Parameters=[@p0='?' (Size = 4000), @p1='?' (DbType = DateTime2), @p2='?' (Size = 4000), @p3='?' (Size = 4000), @p4='?' (Size = 4000), @p5='?' (Size = 450), @p6='?' (Size = 4000), @p7='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SET IMPLICIT_TRANSACTIONS OFF;
SET NOCOUNT ON;
INSERT INTO [AuthLogs] ([AuthType], [CreatedAt], [DeviceId], [FailureReason], [IpAddress], [NationalId], [Status], [UserAgent])
OUTPUT INSERTED.[Id]
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7);
2025-02-02 01:14:07.667 +03:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType9`2[[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Object, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-02-02 01:14:07.668 +03:00 [INF] Executed action NayifatAPI.Controllers.AuthController.SignIn (NayifatAPI) in 302.2428ms
2025-02-02 01:14:07.669 +03:00 [INF] Executed endpoint 'NayifatAPI.Controllers.AuthController.SignIn (NayifatAPI)'
2025-02-02 01:14:07.670 +03:00 [INF] Request finished HTTP/1.1 POST http://957c-51-252-155-185.ngrok-free.app/api/auth/signin - 200 null application/json; charset=utf-8 308.727ms
2025-02-02 01:14:08.519 +03:00 [INF] Request starting HTTP/1.1 POST http://957c-51-252-155-185.ngrok-free.app/api/auth/signin - application/json; charset=utf-8 49
2025-02-02 01:14:08.526 +03:00 [INF] Executing endpoint 'NayifatAPI.Controllers.AuthController.SignIn (NayifatAPI)'
2025-02-02 01:14:08.527 +03:00 [INF] Route matched with {action = "SignIn", controller = "Auth"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] SignIn(NayifatAPI.Controllers.SignInRequest) on controller NayifatAPI.Controllers.AuthController (NayifatAPI).
2025-02-02 01:14:08.529 +03:00 [INF] Executing BadRequestObjectResult, writing value of type 'Microsoft.AspNetCore.Mvc.ValidationProblemDetails'.
2025-02-02 01:14:08.530 +03:00 [INF] Executed action NayifatAPI.Controllers.AuthController.SignIn (NayifatAPI) in 1.725ms
2025-02-02 01:14:08.531 +03:00 [INF] Executed endpoint 'NayifatAPI.Controllers.AuthController.SignIn (NayifatAPI)'
2025-02-02 01:14:08.531 +03:00 [INF] Request finished HTTP/1.1 POST http://957c-51-252-155-185.ngrok-free.app/api/auth/signin - 400 null application/problem+json; charset=utf-8 12.0545ms
2025-02-02 01:15:08.475 +03:00 [INF] Request starting HTTP/1.1 POST http://957c-51-252-155-185.ngrok-free.app/api/auth/signin - application/json; charset=utf-8 224
2025-02-02 01:15:08.479 +03:00 [INF] Executing endpoint 'NayifatAPI.Controllers.AuthController.SignIn (NayifatAPI)'
2025-02-02 01:15:08.479 +03:00 [INF] Route matched with {action = "SignIn", controller = "Auth"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] SignIn(NayifatAPI.Controllers.SignInRequest) on controller NayifatAPI.Controllers.AuthController (NayifatAPI).
2025-02-02 01:15:08.485 +03:00 [INF] Executed DbCommand (2ms) [Parameters=[@__providedApiKey_0='?' (Size = 255)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [a].[Key], [a].[CreatedAt], [a].[Description], [a].[ExpiresAt], [a].[IsActive], [a].[LastUsedAt]
FROM [ApiKeys] AS [a]
WHERE [a].[Key] = @__providedApiKey_0 AND [a].[IsActive] = CAST(1 AS bit)
2025-02-02 01:15:08.489 +03:00 [INF] Executed DbCommand (2ms) [Parameters=[@__request_NationalId_0='?' (Size = 450)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [c].[NationalId], [c].[AddNo], [c].[BuildingNo], [c].[City], [c].[Consent], [c].[ConsentDate], [c].[DateOfBirth], [c].[Dependents], [c].[District], [c].[Email], [c].[Employer], [c].[FamilyNameAr], [c].[FamilyNameEn], [c].[FirstNameAr], [c].[FirstNameEn], [c].[Iban], [c].[IdExpiryDate], [c].[Los], [c].[Mpin], [c].[MpinEnabled], [c].[NafathStatus], [c].[NafathTimestamp], [c].[Password], [c].[Phone], [c].[RegistrationDate], [c].[SalaryCustomer], [c].[SalaryDakhli], [c].[SecondNameAr], [c].[SecondNameEn], [c].[Sector], [c].[Street], [c].[ThirdNameAr], [c].[ThirdNameEn], [c].[Zipcode]
FROM [Customers] AS [c]
WHERE [c].[NationalId] = @__request_NationalId_0
2025-02-02 01:15:08.493 +03:00 [INF] Starting password verification for NationalId: 1064448614
2025-02-02 01:15:08.663 +03:00 [INF] Password verification result for NationalId 1064448614: Success
2025-02-02 01:15:08.667 +03:00 [INF] Executed DbCommand (3ms) [Parameters=[@__request_NationalId_0='?' (Size = 450), @__request_DeviceId_1='?' (Size = 450)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [c].[Id], [c].[BiometricEnabled], [c].[BiometricToken], [c].[CreatedAt], [c].[DeviceId], [c].[LastUsedAt], [c].[Manufacturer], [c].[Model], [c].[NationalId], [c].[OsVersion], [c].[Platform], [c].[Status]
FROM [Customer_Devices] AS [c]
WHERE [c].[NationalId] = @__request_NationalId_0 AND [c].[DeviceId] = @__request_DeviceId_1 AND [c].[Status] = N'active'
2025-02-02 01:15:08.677 +03:00 [INF] Executed DbCommand (7ms) [Parameters=[@p0='?' (Size = 4000), @p1='?' (DbType = DateTime2), @p2='?' (Size = 4000), @p3='?' (Size = 4000), @p4='?' (Size = 4000), @p5='?' (Size = 450), @p6='?' (Size = 4000), @p7='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SET IMPLICIT_TRANSACTIONS OFF;
SET NOCOUNT ON;
INSERT INTO [AuthLogs] ([AuthType], [CreatedAt], [DeviceId], [FailureReason], [IpAddress], [NationalId], [Status], [UserAgent])
OUTPUT INSERTED.[Id]
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7);
2025-02-02 01:15:08.680 +03:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType9`2[[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Object, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-02-02 01:15:08.682 +03:00 [INF] Executed action NayifatAPI.Controllers.AuthController.SignIn (NayifatAPI) in 201.2429ms
2025-02-02 01:15:08.684 +03:00 [INF] Executed endpoint 'NayifatAPI.Controllers.AuthController.SignIn (NayifatAPI)'
2025-02-02 01:15:08.686 +03:00 [INF] Request finished HTTP/1.1 POST http://957c-51-252-155-185.ngrok-free.app/api/auth/signin - 200 null application/json; charset=utf-8 210.3932ms
2025-02-02 01:15:09.110 +03:00 [INF] Request starting HTTP/1.1 POST http://957c-51-252-155-185.ngrok-free.app/api/notifications/list - application/json; charset=utf-8 47
2025-02-02 01:15:09.112 +03:00 [INF] Executing endpoint 'NayifatAPI.Controllers.NotificationsController.GetNotifications (NayifatAPI)'
2025-02-02 01:15:09.113 +03:00 [INF] Route matched with {action = "GetNotifications", controller = "Notifications"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetNotifications(NayifatAPI.Controllers.GetNotificationsRequest) on controller NayifatAPI.Controllers.NotificationsController (NayifatAPI).
2025-02-02 01:15:09.116 +03:00 [INF] Executed DbCommand (0ms) [Parameters=[@__providedApiKey_0='?' (Size = 255)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [a].[Key], [a].[CreatedAt], [a].[Description], [a].[ExpiresAt], [a].[IsActive], [a].[LastUsedAt]
FROM [ApiKeys] AS [a]
WHERE [a].[Key] = @__providedApiKey_0 AND [a].[IsActive] = CAST(1 AS bit)
2025-02-02 01:15:09.121 +03:00 [INF] Executed DbCommand (2ms) [Parameters=[@__request_NationalId_0='?' (Size = 450)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [u].[national_id], [u].[last_updated], [u].[notifications]
FROM [user_notifications] AS [u]
WHERE [u].[national_id] = @__request_NationalId_0
2025-02-02 01:15:09.125 +03:00 [INF] Executed DbCommand (2ms) [Parameters=[@__Parse_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [n].[Id], [n].[additional_data], [n].[Body], [n].[body_ar], [n].[body_en], [n].[created_at], [n].[expiry_at], [n].[Route], [n].[target_criteria], [n].[Title], [n].[title_ar], [n].[title_en]
FROM [notification_templates] AS [n]
WHERE [n].[Id] = @__Parse_0
2025-02-02 01:15:09.128 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@__Parse_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [n].[Id], [n].[additional_data], [n].[Body], [n].[body_ar], [n].[body_en], [n].[created_at], [n].[expiry_at], [n].[Route], [n].[target_criteria], [n].[Title], [n].[title_ar], [n].[title_en]
FROM [notification_templates] AS [n]
WHERE [n].[Id] = @__Parse_0
2025-02-02 01:15:09.417 +03:00 [INF] Request starting HTTP/1.1 POST http://957c-51-252-155-185.ngrok-free.app/api/auth/signin - application/json; charset=utf-8 49
2025-02-02 01:15:09.421 +03:00 [INF] Executing endpoint 'NayifatAPI.Controllers.AuthController.SignIn (NayifatAPI)'
2025-02-02 01:15:09.421 +03:00 [INF] Route matched with {action = "SignIn", controller = "Auth"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] SignIn(NayifatAPI.Controllers.SignInRequest) on controller NayifatAPI.Controllers.AuthController (NayifatAPI).
2025-02-02 01:15:09.423 +03:00 [INF] Executing BadRequestObjectResult, writing value of type 'Microsoft.AspNetCore.Mvc.ValidationProblemDetails'.
2025-02-02 01:15:09.424 +03:00 [INF] Executed action NayifatAPI.Controllers.AuthController.SignIn (NayifatAPI) in 1.9964ms
2025-02-02 01:15:09.425 +03:00 [INF] Executed endpoint 'NayifatAPI.Controllers.AuthController.SignIn (NayifatAPI)'
2025-02-02 01:15:09.426 +03:00 [INF] Request finished HTTP/1.1 POST http://957c-51-252-155-185.ngrok-free.app/api/auth/signin - 400 null application/problem+json; charset=utf-8 9.317ms
2025-02-02 01:15:09.527 +03:00 [INF] Executed DbCommand (397ms) [Parameters=[@p0='?' (Size = 4000), @p1='?' (DbType = DateTime2), @p2='?' (Size = 4000), @p3='?' (Size = 4000), @p4='?' (Size = 4000), @p5='?' (Size = 450), @p6='?' (Size = 4000), @p7='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SET IMPLICIT_TRANSACTIONS OFF;
SET NOCOUNT ON;
INSERT INTO [AuthLogs] ([AuthType], [CreatedAt], [DeviceId], [FailureReason], [IpAddress], [NationalId], [Status], [UserAgent])
OUTPUT INSERTED.[Id]
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7);
2025-02-02 01:15:09.530 +03:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType9`2[[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Object, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-02-02 01:15:09.531 +03:00 [INF] Executed action NayifatAPI.Controllers.NotificationsController.GetNotifications (NayifatAPI) in 416.6691ms
2025-02-02 01:15:09.532 +03:00 [INF] Executed endpoint 'NayifatAPI.Controllers.NotificationsController.GetNotifications (NayifatAPI)'
2025-02-02 01:15:09.533 +03:00 [INF] Request finished HTTP/1.1 POST http://957c-51-252-155-185.ngrok-free.app/api/notifications/list - 200 null application/json; charset=utf-8 423.1419ms
2025-02-02 01:18:13.523 +03:00 [INF] Request starting HTTP/1.1 POST http://957c-51-252-155-185.ngrok-free.app/api/auth/signin - application/json; charset=utf-8 224
2025-02-02 01:18:13.531 +03:00 [INF] Executing endpoint 'NayifatAPI.Controllers.AuthController.SignIn (NayifatAPI)'
2025-02-02 01:18:13.531 +03:00 [INF] Route matched with {action = "SignIn", controller = "Auth"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] SignIn(NayifatAPI.Controllers.SignInRequest) on controller NayifatAPI.Controllers.AuthController (NayifatAPI).
2025-02-02 01:18:13.537 +03:00 [INF] Executed DbCommand (3ms) [Parameters=[@__providedApiKey_0='?' (Size = 255)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [a].[Key], [a].[CreatedAt], [a].[Description], [a].[ExpiresAt], [a].[IsActive], [a].[LastUsedAt]
FROM [ApiKeys] AS [a]
WHERE [a].[Key] = @__providedApiKey_0 AND [a].[IsActive] = CAST(1 AS bit)
2025-02-02 01:18:13.541 +03:00 [INF] Executed DbCommand (2ms) [Parameters=[@__request_NationalId_0='?' (Size = 450)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [c].[NationalId], [c].[AddNo], [c].[BuildingNo], [c].[City], [c].[Consent], [c].[ConsentDate], [c].[DateOfBirth], [c].[Dependents], [c].[District], [c].[Email], [c].[Employer], [c].[FamilyNameAr], [c].[FamilyNameEn], [c].[FirstNameAr], [c].[FirstNameEn], [c].[Iban], [c].[IdExpiryDate], [c].[Los], [c].[Mpin], [c].[MpinEnabled], [c].[NafathStatus], [c].[NafathTimestamp], [c].[Password], [c].[Phone], [c].[RegistrationDate], [c].[SalaryCustomer], [c].[SalaryDakhli], [c].[SecondNameAr], [c].[SecondNameEn], [c].[Sector], [c].[Street], [c].[ThirdNameAr], [c].[ThirdNameEn], [c].[Zipcode]
FROM [Customers] AS [c]
WHERE [c].[NationalId] = @__request_NationalId_0
2025-02-02 01:18:13.543 +03:00 [INF] Starting password verification for NationalId: 1064448614
2025-02-02 01:18:13.710 +03:00 [INF] Password verification result for NationalId 1064448614: Success
2025-02-02 01:18:13.715 +03:00 [INF] Executed DbCommand (2ms) [Parameters=[@__request_NationalId_0='?' (Size = 450), @__request_DeviceId_1='?' (Size = 450)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [c].[Id], [c].[BiometricEnabled], [c].[BiometricToken], [c].[CreatedAt], [c].[DeviceId], [c].[LastUsedAt], [c].[Manufacturer], [c].[Model], [c].[NationalId], [c].[OsVersion], [c].[Platform], [c].[Status]
FROM [Customer_Devices] AS [c]
WHERE [c].[NationalId] = @__request_NationalId_0 AND [c].[DeviceId] = @__request_DeviceId_1 AND [c].[Status] = N'active'
2025-02-02 01:18:13.792 +03:00 [INF] Executed DbCommand (75ms) [Parameters=[@p0='?' (Size = 4000), @p1='?' (DbType = DateTime2), @p2='?' (Size = 4000), @p3='?' (Size = 4000), @p4='?' (Size = 4000), @p5='?' (Size = 450), @p6='?' (Size = 4000), @p7='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SET IMPLICIT_TRANSACTIONS OFF;
SET NOCOUNT ON;
INSERT INTO [AuthLogs] ([AuthType], [CreatedAt], [DeviceId], [FailureReason], [IpAddress], [NationalId], [Status], [UserAgent])
OUTPUT INSERTED.[Id]
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7);
2025-02-02 01:18:13.795 +03:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType9`2[[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Object, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-02-02 01:18:13.796 +03:00 [INF] Executed action NayifatAPI.Controllers.AuthController.SignIn (NayifatAPI) in 263.4683ms
2025-02-02 01:18:13.797 +03:00 [INF] Executed endpoint 'NayifatAPI.Controllers.AuthController.SignIn (NayifatAPI)'
2025-02-02 01:18:13.798 +03:00 [INF] Request finished HTTP/1.1 POST http://957c-51-252-155-185.ngrok-free.app/api/auth/signin - 200 null application/json; charset=utf-8 274.6633ms
2025-02-02 01:18:14.770 +03:00 [INF] Request starting HTTP/1.1 POST http://957c-51-252-155-185.ngrok-free.app/api/auth/signin - application/json; charset=utf-8 49
2025-02-02 01:18:14.776 +03:00 [INF] Executing endpoint 'NayifatAPI.Controllers.AuthController.SignIn (NayifatAPI)'
2025-02-02 01:18:14.776 +03:00 [INF] Route matched with {action = "SignIn", controller = "Auth"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] SignIn(NayifatAPI.Controllers.SignInRequest) on controller NayifatAPI.Controllers.AuthController (NayifatAPI).
2025-02-02 01:18:14.779 +03:00 [INF] Executing BadRequestObjectResult, writing value of type 'Microsoft.AspNetCore.Mvc.ValidationProblemDetails'.
2025-02-02 01:18:14.780 +03:00 [INF] Executed action NayifatAPI.Controllers.AuthController.SignIn (NayifatAPI) in 2.6924ms
2025-02-02 01:18:14.781 +03:00 [INF] Executed endpoint 'NayifatAPI.Controllers.AuthController.SignIn (NayifatAPI)'
2025-02-02 01:18:14.783 +03:00 [INF] Request finished HTTP/1.1 POST http://957c-51-252-155-185.ngrok-free.app/api/auth/signin - 400 null application/problem+json; charset=utf-8 12.5619ms
2025-02-02 01:19:04.590 +03:00 [INF] Request starting HTTP/1.1 POST http://957c-51-252-155-185.ngrok-free.app/api/notifications/list - application/json; charset=utf-8 47
2025-02-02 01:19:04.596 +03:00 [INF] Executing endpoint 'NayifatAPI.Controllers.NotificationsController.GetNotifications (NayifatAPI)'
2025-02-02 01:19:04.597 +03:00 [INF] Route matched with {action = "GetNotifications", controller = "Notifications"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetNotifications(NayifatAPI.Controllers.GetNotificationsRequest) on controller NayifatAPI.Controllers.NotificationsController (NayifatAPI).
2025-02-02 01:19:04.601 +03:00 [INF] Executed DbCommand (2ms) [Parameters=[@__providedApiKey_0='?' (Size = 255)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [a].[Key], [a].[CreatedAt], [a].[Description], [a].[ExpiresAt], [a].[IsActive], [a].[LastUsedAt]
FROM [ApiKeys] AS [a]
WHERE [a].[Key] = @__providedApiKey_0 AND [a].[IsActive] = CAST(1 AS bit)
2025-02-02 01:19:04.605 +03:00 [INF] Executed DbCommand (2ms) [Parameters=[@__request_NationalId_0='?' (Size = 450)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [u].[national_id], [u].[last_updated], [u].[notifications]
FROM [user_notifications] AS [u]
WHERE [u].[national_id] = @__request_NationalId_0
2025-02-02 01:19:04.609 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@__Parse_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [n].[Id], [n].[additional_data], [n].[Body], [n].[body_ar], [n].[body_en], [n].[created_at], [n].[expiry_at], [n].[Route], [n].[target_criteria], [n].[Title], [n].[title_ar], [n].[title_en]
FROM [notification_templates] AS [n]
WHERE [n].[Id] = @__Parse_0
2025-02-02 01:19:04.613 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@__Parse_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [n].[Id], [n].[additional_data], [n].[Body], [n].[body_ar], [n].[body_en], [n].[created_at], [n].[expiry_at], [n].[Route], [n].[target_criteria], [n].[Title], [n].[title_ar], [n].[title_en]
FROM [notification_templates] AS [n]
WHERE [n].[Id] = @__Parse_0
2025-02-02 01:19:04.624 +03:00 [INF] Executed DbCommand (9ms) [Parameters=[@p0='?' (Size = 4000), @p1='?' (DbType = DateTime2), @p2='?' (Size = 4000), @p3='?' (Size = 4000), @p4='?' (Size = 4000), @p5='?' (Size = 450), @p6='?' (Size = 4000), @p7='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SET IMPLICIT_TRANSACTIONS OFF;
SET NOCOUNT ON;
INSERT INTO [AuthLogs] ([AuthType], [CreatedAt], [DeviceId], [FailureReason], [IpAddress], [NationalId], [Status], [UserAgent])
OUTPUT INSERTED.[Id]
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7);
2025-02-02 01:19:04.626 +03:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType9`2[[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Object, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-02-02 01:19:04.627 +03:00 [INF] Executed action NayifatAPI.Controllers.NotificationsController.GetNotifications (NayifatAPI) in 28.997ms
2025-02-02 01:19:04.628 +03:00 [INF] Executed endpoint 'NayifatAPI.Controllers.NotificationsController.GetNotifications (NayifatAPI)'
2025-02-02 01:19:04.629 +03:00 [INF] Request finished HTTP/1.1 POST http://957c-51-252-155-185.ngrok-free.app/api/notifications/list - 200 null application/json; charset=utf-8 39.0271ms
2025-02-02 01:20:04.670 +03:00 [INF] Request starting HTTP/1.1 POST http://957c-51-252-155-185.ngrok-free.app/api/auth/signin - application/json; charset=utf-8 224
2025-02-02 01:20:04.674 +03:00 [INF] Executing endpoint 'NayifatAPI.Controllers.AuthController.SignIn (NayifatAPI)'
2025-02-02 01:20:04.677 +03:00 [INF] Route matched with {action = "SignIn", controller = "Auth"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] SignIn(NayifatAPI.Controllers.SignInRequest) on controller NayifatAPI.Controllers.AuthController (NayifatAPI).
2025-02-02 01:20:04.687 +03:00 [INF] Executed DbCommand (6ms) [Parameters=[@__providedApiKey_0='?' (Size = 255)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [a].[Key], [a].[CreatedAt], [a].[Description], [a].[ExpiresAt], [a].[IsActive], [a].[LastUsedAt]
FROM [ApiKeys] AS [a]
WHERE [a].[Key] = @__providedApiKey_0 AND [a].[IsActive] = CAST(1 AS bit)
2025-02-02 01:20:04.696 +03:00 [INF] Executed DbCommand (3ms) [Parameters=[@__request_NationalId_0='?' (Size = 450)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [c].[NationalId], [c].[AddNo], [c].[BuildingNo], [c].[City], [c].[Consent], [c].[ConsentDate], [c].[DateOfBirth], [c].[Dependents], [c].[District], [c].[Email], [c].[Employer], [c].[FamilyNameAr], [c].[FamilyNameEn], [c].[FirstNameAr], [c].[FirstNameEn], [c].[Iban], [c].[IdExpiryDate], [c].[Los], [c].[Mpin], [c].[MpinEnabled], [c].[NafathStatus], [c].[NafathTimestamp], [c].[Password], [c].[Phone], [c].[RegistrationDate], [c].[SalaryCustomer], [c].[SalaryDakhli], [c].[SecondNameAr], [c].[SecondNameEn], [c].[Sector], [c].[Street], [c].[ThirdNameAr], [c].[ThirdNameEn], [c].[Zipcode]
FROM [Customers] AS [c]
WHERE [c].[NationalId] = @__request_NationalId_0
2025-02-02 01:20:04.700 +03:00 [INF] Starting password verification for NationalId: 1064448614
2025-02-02 01:20:04.910 +03:00 [INF] Password verification result for NationalId 1064448614: Success
2025-02-02 01:20:04.922 +03:00 [INF] Executed DbCommand (5ms) [Parameters=[@__request_NationalId_0='?' (Size = 450), @__request_DeviceId_1='?' (Size = 450)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [c].[Id], [c].[BiometricEnabled], [c].[BiometricToken], [c].[CreatedAt], [c].[DeviceId], [c].[LastUsedAt], [c].[Manufacturer], [c].[Model], [c].[NationalId], [c].[OsVersion], [c].[Platform], [c].[Status]
FROM [Customer_Devices] AS [c]
WHERE [c].[NationalId] = @__request_NationalId_0 AND [c].[DeviceId] = @__request_DeviceId_1 AND [c].[Status] = N'active'
2025-02-02 01:20:05.008 +03:00 [INF] Executed DbCommand (79ms) [Parameters=[@p0='?' (Size = 4000), @p1='?' (DbType = DateTime2), @p2='?' (Size = 4000), @p3='?' (Size = 4000), @p4='?' (Size = 4000), @p5='?' (Size = 450), @p6='?' (Size = 4000), @p7='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SET IMPLICIT_TRANSACTIONS OFF;
SET NOCOUNT ON;
INSERT INTO [AuthLogs] ([AuthType], [CreatedAt], [DeviceId], [FailureReason], [IpAddress], [NationalId], [Status], [UserAgent])
OUTPUT INSERTED.[Id]
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7);
2025-02-02 01:20:05.016 +03:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType9`2[[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Object, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-02-02 01:20:05.018 +03:00 [INF] Executed action NayifatAPI.Controllers.AuthController.SignIn (NayifatAPI) in 338.9858ms
2025-02-02 01:20:05.020 +03:00 [INF] Executed endpoint 'NayifatAPI.Controllers.AuthController.SignIn (NayifatAPI)'
2025-02-02 01:20:05.024 +03:00 [INF] Request finished HTTP/1.1 POST http://957c-51-252-155-185.ngrok-free.app/api/auth/signin - 200 null application/json; charset=utf-8 354.1943ms
2025-02-02 01:20:05.915 +03:00 [INF] Request starting HTTP/1.1 POST http://957c-51-252-155-185.ngrok-free.app/api/auth/signin - application/json; charset=utf-8 49
2025-02-02 01:20:05.920 +03:00 [INF] Executing endpoint 'NayifatAPI.Controllers.AuthController.SignIn (NayifatAPI)'
2025-02-02 01:20:05.922 +03:00 [INF] Route matched with {action = "SignIn", controller = "Auth"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] SignIn(NayifatAPI.Controllers.SignInRequest) on controller NayifatAPI.Controllers.AuthController (NayifatAPI).
2025-02-02 01:20:05.926 +03:00 [INF] Executing BadRequestObjectResult, writing value of type 'Microsoft.AspNetCore.Mvc.ValidationProblemDetails'.
2025-02-02 01:20:05.928 +03:00 [INF] Executed action NayifatAPI.Controllers.AuthController.SignIn (NayifatAPI) in 3.3095ms
2025-02-02 01:20:05.930 +03:00 [INF] Executed endpoint 'NayifatAPI.Controllers.AuthController.SignIn (NayifatAPI)'
2025-02-02 01:20:05.932 +03:00 [INF] Request finished HTTP/1.1 POST http://957c-51-252-155-185.ngrok-free.app/api/auth/signin - 400 null application/problem+json; charset=utf-8 16.7282ms
2025-02-02 01:21:37.767 +03:00 [INF] Request starting HTTP/1.1 POST http://957c-51-252-155-185.ngrok-free.app/api/auth/signin - application/json; charset=utf-8 224
2025-02-02 01:21:37.771 +03:00 [INF] Executing endpoint 'NayifatAPI.Controllers.AuthController.SignIn (NayifatAPI)'
2025-02-02 01:21:37.775 +03:00 [INF] Route matched with {action = "SignIn", controller = "Auth"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] SignIn(NayifatAPI.Controllers.SignInRequest) on controller NayifatAPI.Controllers.AuthController (NayifatAPI).
2025-02-02 01:21:37.786 +03:00 [INF] Executed DbCommand (6ms) [Parameters=[@__providedApiKey_0='?' (Size = 255)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [a].[Key], [a].[CreatedAt], [a].[Description], [a].[ExpiresAt], [a].[IsActive], [a].[LastUsedAt]
FROM [ApiKeys] AS [a]
WHERE [a].[Key] = @__providedApiKey_0 AND [a].[IsActive] = CAST(1 AS bit)
2025-02-02 01:21:37.796 +03:00 [INF] Executed DbCommand (4ms) [Parameters=[@__request_NationalId_0='?' (Size = 450)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [c].[NationalId], [c].[AddNo], [c].[BuildingNo], [c].[City], [c].[Consent], [c].[ConsentDate], [c].[DateOfBirth], [c].[Dependents], [c].[District], [c].[Email], [c].[Employer], [c].[FamilyNameAr], [c].[FamilyNameEn], [c].[FirstNameAr], [c].[FirstNameEn], [c].[Iban], [c].[IdExpiryDate], [c].[Los], [c].[Mpin], [c].[MpinEnabled], [c].[NafathStatus], [c].[NafathTimestamp], [c].[Password], [c].[Phone], [c].[RegistrationDate], [c].[SalaryCustomer], [c].[SalaryDakhli], [c].[SecondNameAr], [c].[SecondNameEn], [c].[Sector], [c].[Street], [c].[ThirdNameAr], [c].[ThirdNameEn], [c].[Zipcode]
FROM [Customers] AS [c]
WHERE [c].[NationalId] = @__request_NationalId_0
2025-02-02 01:21:37.799 +03:00 [INF] Starting password verification for NationalId: 1064448614
2025-02-02 01:21:37.982 +03:00 [INF] Password verification result for NationalId 1064448614: Success
2025-02-02 01:21:37.990 +03:00 [INF] Executed DbCommand (4ms) [Parameters=[@__request_NationalId_0='?' (Size = 450), @__request_DeviceId_1='?' (Size = 450)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [c].[Id], [c].[BiometricEnabled], [c].[BiometricToken], [c].[CreatedAt], [c].[DeviceId], [c].[LastUsedAt], [c].[Manufacturer], [c].[Model], [c].[NationalId], [c].[OsVersion], [c].[Platform], [c].[Status]
FROM [Customer_Devices] AS [c]
WHERE [c].[NationalId] = @__request_NationalId_0 AND [c].[DeviceId] = @__request_DeviceId_1 AND [c].[Status] = N'active'
2025-02-02 01:21:38.005 +03:00 [INF] Executed DbCommand (9ms) [Parameters=[@p0='?' (Size = 4000), @p1='?' (DbType = DateTime2), @p2='?' (Size = 4000), @p3='?' (Size = 4000), @p4='?' (Size = 4000), @p5='?' (Size = 450), @p6='?' (Size = 4000), @p7='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SET IMPLICIT_TRANSACTIONS OFF;
SET NOCOUNT ON;
INSERT INTO [AuthLogs] ([AuthType], [CreatedAt], [DeviceId], [FailureReason], [IpAddress], [NationalId], [Status], [UserAgent])
OUTPUT INSERTED.[Id]
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7);
2025-02-02 01:21:38.010 +03:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType9`2[[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Object, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-02-02 01:21:38.014 +03:00 [INF] Executed action NayifatAPI.Controllers.AuthController.SignIn (NayifatAPI) in 235.4874ms
2025-02-02 01:21:38.018 +03:00 [INF] Executed endpoint 'NayifatAPI.Controllers.AuthController.SignIn (NayifatAPI)'
2025-02-02 01:21:38.021 +03:00 [INF] Request finished HTTP/1.1 POST http://957c-51-252-155-185.ngrok-free.app/api/auth/signin - 200 null application/json; charset=utf-8 253.6707ms
2025-02-02 01:21:38.901 +03:00 [INF] Request starting HTTP/1.1 POST http://957c-51-252-155-185.ngrok-free.app/api/auth/signin - application/json; charset=utf-8 202
2025-02-02 01:21:38.905 +03:00 [INF] Executing endpoint 'NayifatAPI.Controllers.AuthController.SignIn (NayifatAPI)'
2025-02-02 01:21:38.906 +03:00 [INF] Route matched with {action = "SignIn", controller = "Auth"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] SignIn(NayifatAPI.Controllers.SignInRequest) on controller NayifatAPI.Controllers.AuthController (NayifatAPI).
2025-02-02 01:21:38.909 +03:00 [INF] Executing BadRequestObjectResult, writing value of type 'Microsoft.AspNetCore.Mvc.ValidationProblemDetails'.
2025-02-02 01:21:38.912 +03:00 [INF] Executed action NayifatAPI.Controllers.AuthController.SignIn (NayifatAPI) in 3.5971ms
2025-02-02 01:21:38.914 +03:00 [INF] Executed endpoint 'NayifatAPI.Controllers.AuthController.SignIn (NayifatAPI)'
2025-02-02 01:21:38.916 +03:00 [INF] Request finished HTTP/1.1 POST http://957c-51-252-155-185.ngrok-free.app/api/auth/signin - 400 null application/problem+json; charset=utf-8 14.916ms
2025-02-02 01:23:34.230 +03:00 [INF] Request starting HTTP/1.1 POST http://957c-51-252-155-185.ngrok-free.app/api/auth/signin - application/json; charset=utf-8 224
2025-02-02 01:23:34.234 +03:00 [INF] Executing endpoint 'NayifatAPI.Controllers.AuthController.SignIn (NayifatAPI)'
2025-02-02 01:23:34.236 +03:00 [INF] Route matched with {action = "SignIn", controller = "Auth"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] SignIn(NayifatAPI.Controllers.SignInRequest) on controller NayifatAPI.Controllers.AuthController (NayifatAPI).
2025-02-02 01:23:34.245 +03:00 [INF] Executed DbCommand (4ms) [Parameters=[@__providedApiKey_0='?' (Size = 255)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [a].[Key], [a].[CreatedAt], [a].[Description], [a].[ExpiresAt], [a].[IsActive], [a].[LastUsedAt]
FROM [ApiKeys] AS [a]
WHERE [a].[Key] = @__providedApiKey_0 AND [a].[IsActive] = CAST(1 AS bit)
2025-02-02 01:23:34.252 +03:00 [INF] Executed DbCommand (4ms) [Parameters=[@__request_NationalId_0='?' (Size = 450)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [c].[NationalId], [c].[AddNo], [c].[BuildingNo], [c].[City], [c].[Consent], [c].[ConsentDate], [c].[DateOfBirth], [c].[Dependents], [c].[District], [c].[Email], [c].[Employer], [c].[FamilyNameAr], [c].[FamilyNameEn], [c].[FirstNameAr], [c].[FirstNameEn], [c].[Iban], [c].[IdExpiryDate], [c].[Los], [c].[Mpin], [c].[MpinEnabled], [c].[NafathStatus], [c].[NafathTimestamp], [c].[Password], [c].[Phone], [c].[RegistrationDate], [c].[SalaryCustomer], [c].[SalaryDakhli], [c].[SecondNameAr], [c].[SecondNameEn], [c].[Sector], [c].[Street], [c].[ThirdNameAr], [c].[ThirdNameEn], [c].[Zipcode]
FROM [Customers] AS [c]
WHERE [c].[NationalId] = @__request_NationalId_0
2025-02-02 01:23:34.257 +03:00 [INF] Starting password verification for NationalId: 1064448614
2025-02-02 01:23:34.451 +03:00 [INF] Password verification result for NationalId 1064448614: Success
2025-02-02 01:23:34.459 +03:00 [INF] Executed DbCommand (4ms) [Parameters=[@__request_NationalId_0='?' (Size = 450), @__request_DeviceId_1='?' (Size = 450)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [c].[Id], [c].[BiometricEnabled], [c].[BiometricToken], [c].[CreatedAt], [c].[DeviceId], [c].[LastUsedAt], [c].[Manufacturer], [c].[Model], [c].[NationalId], [c].[OsVersion], [c].[Platform], [c].[Status]
FROM [Customer_Devices] AS [c]
WHERE [c].[NationalId] = @__request_NationalId_0 AND [c].[DeviceId] = @__request_DeviceId_1 AND [c].[Status] = N'active'
2025-02-02 01:23:34.541 +03:00 [INF] Executed DbCommand (76ms) [Parameters=[@p0='?' (Size = 4000), @p1='?' (DbType = DateTime2), @p2='?' (Size = 4000), @p3='?' (Size = 4000), @p4='?' (Size = 4000), @p5='?' (Size = 450), @p6='?' (Size = 4000), @p7='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SET IMPLICIT_TRANSACTIONS OFF;
SET NOCOUNT ON;
INSERT INTO [AuthLogs] ([AuthType], [CreatedAt], [DeviceId], [FailureReason], [IpAddress], [NationalId], [Status], [UserAgent])
OUTPUT INSERTED.[Id]
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7);
2025-02-02 01:23:34.545 +03:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType9`2[[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Object, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-02-02 01:23:34.546 +03:00 [INF] Executed action NayifatAPI.Controllers.AuthController.SignIn (NayifatAPI) in 307.2887ms
2025-02-02 01:23:34.551 +03:00 [INF] Executed endpoint 'NayifatAPI.Controllers.AuthController.SignIn (NayifatAPI)'
2025-02-02 01:23:34.554 +03:00 [INF] Request finished HTTP/1.1 POST http://957c-51-252-155-185.ngrok-free.app/api/auth/signin - 200 null application/json; charset=utf-8 323.4742ms
2025-02-02 01:26:31.101 +03:00 [INF] Request starting HTTP/1.1 POST http://957c-51-252-155-185.ngrok-free.app/api/auth/signin - application/json; charset=utf-8 224
2025-02-02 01:26:31.105 +03:00 [INF] Executing endpoint 'NayifatAPI.Controllers.AuthController.SignIn (NayifatAPI)'
2025-02-02 01:26:31.108 +03:00 [INF] Route matched with {action = "SignIn", controller = "Auth"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] SignIn(NayifatAPI.Controllers.SignInRequest) on controller NayifatAPI.Controllers.AuthController (NayifatAPI).
2025-02-02 01:26:31.119 +03:00 [INF] Executed DbCommand (7ms) [Parameters=[@__providedApiKey_0='?' (Size = 255)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [a].[Key], [a].[CreatedAt], [a].[Description], [a].[ExpiresAt], [a].[IsActive], [a].[LastUsedAt]
FROM [ApiKeys] AS [a]
WHERE [a].[Key] = @__providedApiKey_0 AND [a].[IsActive] = CAST(1 AS bit)
2025-02-02 01:26:31.128 +03:00 [INF] Executed DbCommand (5ms) [Parameters=[@__request_NationalId_0='?' (Size = 450)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [c].[NationalId], [c].[AddNo], [c].[BuildingNo], [c].[City], [c].[Consent], [c].[ConsentDate], [c].[DateOfBirth], [c].[Dependents], [c].[District], [c].[Email], [c].[Employer], [c].[FamilyNameAr], [c].[FamilyNameEn], [c].[FirstNameAr], [c].[FirstNameEn], [c].[Iban], [c].[IdExpiryDate], [c].[Los], [c].[Mpin], [c].[MpinEnabled], [c].[NafathStatus], [c].[NafathTimestamp], [c].[Password], [c].[Phone], [c].[RegistrationDate], [c].[SalaryCustomer], [c].[SalaryDakhli], [c].[SecondNameAr], [c].[SecondNameEn], [c].[Sector], [c].[Street], [c].[ThirdNameAr], [c].[ThirdNameEn], [c].[Zipcode]
FROM [Customers] AS [c]
WHERE [c].[NationalId] = @__request_NationalId_0
2025-02-02 01:26:31.133 +03:00 [INF] Starting password verification for NationalId: 1064448614
2025-02-02 01:26:31.350 +03:00 [INF] Password verification result for NationalId 1064448614: Success
2025-02-02 01:26:31.362 +03:00 [INF] Executed DbCommand (4ms) [Parameters=[@__request_NationalId_0='?' (Size = 450), @__request_DeviceId_1='?' (Size = 450)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [c].[Id], [c].[BiometricEnabled], [c].[BiometricToken], [c].[CreatedAt], [c].[DeviceId], [c].[LastUsedAt], [c].[Manufacturer], [c].[Model], [c].[NationalId], [c].[OsVersion], [c].[Platform], [c].[Status]
FROM [Customer_Devices] AS [c]
WHERE [c].[NationalId] = @__request_NationalId_0 AND [c].[DeviceId] = @__request_DeviceId_1 AND [c].[Status] = N'active'
2025-02-02 01:26:31.380 +03:00 [INF] Executed DbCommand (11ms) [Parameters=[@p0='?' (Size = 4000), @p1='?' (DbType = DateTime2), @p2='?' (Size = 4000), @p3='?' (Size = 4000), @p4='?' (Size = 4000), @p5='?' (Size = 450), @p6='?' (Size = 4000), @p7='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SET IMPLICIT_TRANSACTIONS OFF;
SET NOCOUNT ON;
INSERT INTO [AuthLogs] ([AuthType], [CreatedAt], [DeviceId], [FailureReason], [IpAddress], [NationalId], [Status], [UserAgent])
OUTPUT INSERTED.[Id]
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7);
2025-02-02 01:26:31.388 +03:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType9`2[[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Object, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-02-02 01:26:31.391 +03:00 [INF] Executed action NayifatAPI.Controllers.AuthController.SignIn (NayifatAPI) in 280.5478ms
2025-02-02 01:26:31.394 +03:00 [INF] Executed endpoint 'NayifatAPI.Controllers.AuthController.SignIn (NayifatAPI)'
2025-02-02 01:26:31.398 +03:00 [INF] Request finished HTTP/1.1 POST http://957c-51-252-155-185.ngrok-free.app/api/auth/signin - 200 null application/json; charset=utf-8 297.1647ms
2025-02-02 01:26:32.164 +03:00 [INF] Request starting HTTP/1.1 POST http://957c-51-252-155-185.ngrok-free.app/api/auth/generate-otp - application/json; charset=utf-8 82
2025-02-02 01:26:32.169 +03:00 [INF] Request finished HTTP/1.1 POST http://957c-51-252-155-185.ngrok-free.app/api/auth/generate-otp - 404 0 null 5.3492ms
2025-02-02 01:26:32.177 +03:00 [INF] Request reached the end of the middleware pipeline without being handled by application code. Request path: POST http://957c-51-252-155-185.ngrok-free.app/api/auth/generate-otp, Response status code: 404
2025-02-02 01:29:07.026 +03:00 [INF] Request starting HTTP/1.1 POST http://957c-51-252-155-185.ngrok-free.app/api/notifications/list - application/json; charset=utf-8 47
2025-02-02 01:29:07.029 +03:00 [INF] Executing endpoint 'NayifatAPI.Controllers.NotificationsController.GetNotifications (NayifatAPI)'
2025-02-02 01:29:07.030 +03:00 [INF] Route matched with {action = "GetNotifications", controller = "Notifications"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetNotifications(NayifatAPI.Controllers.GetNotificationsRequest) on controller NayifatAPI.Controllers.NotificationsController (NayifatAPI).
2025-02-02 01:29:07.037 +03:00 [INF] Executed DbCommand (4ms) [Parameters=[@__providedApiKey_0='?' (Size = 255)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [a].[Key], [a].[CreatedAt], [a].[Description], [a].[ExpiresAt], [a].[IsActive], [a].[LastUsedAt]
FROM [ApiKeys] AS [a]
WHERE [a].[Key] = @__providedApiKey_0 AND [a].[IsActive] = CAST(1 AS bit)
2025-02-02 01:29:07.047 +03:00 [INF] Executed DbCommand (4ms) [Parameters=[@__request_NationalId_0='?' (Size = 450)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [u].[national_id], [u].[last_updated], [u].[notifications]
FROM [user_notifications] AS [u]
WHERE [u].[national_id] = @__request_NationalId_0
2025-02-02 01:29:07.053 +03:00 [INF] Executed DbCommand (2ms) [Parameters=[@__Parse_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [n].[Id], [n].[additional_data], [n].[Body], [n].[body_ar], [n].[body_en], [n].[created_at], [n].[expiry_at], [n].[Route], [n].[target_criteria], [n].[Title], [n].[title_ar], [n].[title_en]
FROM [notification_templates] AS [n]
WHERE [n].[Id] = @__Parse_0
2025-02-02 01:29:07.061 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@__Parse_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [n].[Id], [n].[additional_data], [n].[Body], [n].[body_ar], [n].[body_en], [n].[created_at], [n].[expiry_at], [n].[Route], [n].[target_criteria], [n].[Title], [n].[title_ar], [n].[title_en]
FROM [notification_templates] AS [n]
WHERE [n].[Id] = @__Parse_0
2025-02-02 01:29:07.079 +03:00 [INF] Executed DbCommand (13ms) [Parameters=[@p0='?' (Size = 4000), @p1='?' (DbType = DateTime2), @p2='?' (Size = 4000), @p3='?' (Size = 4000), @p4='?' (Size = 4000), @p5='?' (Size = 450), @p6='?' (Size = 4000), @p7='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SET IMPLICIT_TRANSACTIONS OFF;
SET NOCOUNT ON;
INSERT INTO [AuthLogs] ([AuthType], [CreatedAt], [DeviceId], [FailureReason], [IpAddress], [NationalId], [Status], [UserAgent])
OUTPUT INSERTED.[Id]
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7);
2025-02-02 01:29:07.081 +03:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType9`2[[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Object, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-02-02 01:29:07.082 +03:00 [INF] Executed action NayifatAPI.Controllers.NotificationsController.GetNotifications (NayifatAPI) in 50.8181ms
2025-02-02 01:29:07.085 +03:00 [INF] Executed endpoint 'NayifatAPI.Controllers.NotificationsController.GetNotifications (NayifatAPI)'
2025-02-02 01:29:07.087 +03:00 [INF] Request finished HTTP/1.1 POST http://957c-51-252-155-185.ngrok-free.app/api/notifications/list - 200 null application/json; charset=utf-8 61.6941ms
2025-02-02 01:36:00.590 +03:00 [INF] Request starting HTTP/1.1 POST http://957c-51-252-155-185.ngrok-free.app/api/notifications/list - application/json; charset=utf-8 47
2025-02-02 01:36:00.596 +03:00 [INF] Executing endpoint 'NayifatAPI.Controllers.NotificationsController.GetNotifications (NayifatAPI)'
2025-02-02 01:36:00.601 +03:00 [INF] Route matched with {action = "GetNotifications", controller = "Notifications"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetNotifications(NayifatAPI.Controllers.GetNotificationsRequest) on controller NayifatAPI.Controllers.NotificationsController (NayifatAPI).
2025-02-02 01:36:00.627 +03:00 [INF] Executed DbCommand (6ms) [Parameters=[@__providedApiKey_0='?' (Size = 255)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [a].[Key], [a].[CreatedAt], [a].[Description], [a].[ExpiresAt], [a].[IsActive], [a].[LastUsedAt]
FROM [ApiKeys] AS [a]
WHERE [a].[Key] = @__providedApiKey_0 AND [a].[IsActive] = CAST(1 AS bit)
2025-02-02 01:36:00.637 +03:00 [INF] Executed DbCommand (5ms) [Parameters=[@__request_NationalId_0='?' (Size = 450)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [u].[national_id], [u].[last_updated], [u].[notifications]
FROM [user_notifications] AS [u]
WHERE [u].[national_id] = @__request_NationalId_0
2025-02-02 01:36:00.646 +03:00 [INF] Executed DbCommand (3ms) [Parameters=[@__Parse_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [n].[Id], [n].[additional_data], [n].[Body], [n].[body_ar], [n].[body_en], [n].[created_at], [n].[expiry_at], [n].[Route], [n].[target_criteria], [n].[Title], [n].[title_ar], [n].[title_en]
FROM [notification_templates] AS [n]
WHERE [n].[Id] = @__Parse_0
2025-02-02 01:36:00.654 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@__Parse_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [n].[Id], [n].[additional_data], [n].[Body], [n].[body_ar], [n].[body_en], [n].[created_at], [n].[expiry_at], [n].[Route], [n].[target_criteria], [n].[Title], [n].[title_ar], [n].[title_en]
FROM [notification_templates] AS [n]
WHERE [n].[Id] = @__Parse_0
2025-02-02 01:36:00.745 +03:00 [INF] Executed DbCommand (82ms) [Parameters=[@p0='?' (Size = 4000), @p1='?' (DbType = DateTime2), @p2='?' (Size = 4000), @p3='?' (Size = 4000), @p4='?' (Size = 4000), @p5='?' (Size = 450), @p6='?' (Size = 4000), @p7='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SET IMPLICIT_TRANSACTIONS OFF;
SET NOCOUNT ON;
INSERT INTO [AuthLogs] ([AuthType], [CreatedAt], [DeviceId], [FailureReason], [IpAddress], [NationalId], [Status], [UserAgent])
OUTPUT INSERTED.[Id]
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7);
2025-02-02 01:36:00.754 +03:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType9`2[[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Object, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-02-02 01:36:00.757 +03:00 [INF] Executed action NayifatAPI.Controllers.NotificationsController.GetNotifications (NayifatAPI) in 150.1554ms
2025-02-02 01:36:00.761 +03:00 [INF] Executed endpoint 'NayifatAPI.Controllers.NotificationsController.GetNotifications (NayifatAPI)'
2025-02-02 01:36:00.764 +03:00 [INF] Request finished HTTP/1.1 POST http://957c-51-252-155-185.ngrok-free.app/api/notifications/list - 200 null application/json; charset=utf-8 173.5885ms
2025-02-02 01:37:20.948 +03:00 [INF] Request starting HTTP/1.1 POST http://957c-51-252-155-185.ngrok-free.app/api/auth/signin - application/json; charset=utf-8 224
2025-02-02 01:37:20.953 +03:00 [INF] Executing endpoint 'NayifatAPI.Controllers.AuthController.SignIn (NayifatAPI)'
2025-02-02 01:37:20.954 +03:00 [INF] Route matched with {action = "SignIn", controller = "Auth"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] SignIn(NayifatAPI.Controllers.SignInRequest) on controller NayifatAPI.Controllers.AuthController (NayifatAPI).
2025-02-02 01:37:20.963 +03:00 [INF] Executed DbCommand (5ms) [Parameters=[@__providedApiKey_0='?' (Size = 255)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [a].[Key], [a].[CreatedAt], [a].[Description], [a].[ExpiresAt], [a].[IsActive], [a].[LastUsedAt]
FROM [ApiKeys] AS [a]
WHERE [a].[Key] = @__providedApiKey_0 AND [a].[IsActive] = CAST(1 AS bit)
2025-02-02 01:37:20.974 +03:00 [INF] Executed DbCommand (5ms) [Parameters=[@__request_NationalId_0='?' (Size = 450)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [c].[NationalId], [c].[AddNo], [c].[BuildingNo], [c].[City], [c].[Consent], [c].[ConsentDate], [c].[DateOfBirth], [c].[Dependents], [c].[District], [c].[Email], [c].[Employer], [c].[FamilyNameAr], [c].[FamilyNameEn], [c].[FirstNameAr], [c].[FirstNameEn], [c].[Iban], [c].[IdExpiryDate], [c].[Los], [c].[Mpin], [c].[MpinEnabled], [c].[NafathStatus], [c].[NafathTimestamp], [c].[Password], [c].[Phone], [c].[RegistrationDate], [c].[SalaryCustomer], [c].[SalaryDakhli], [c].[SecondNameAr], [c].[SecondNameEn], [c].[Sector], [c].[Street], [c].[ThirdNameAr], [c].[ThirdNameEn], [c].[Zipcode]
FROM [Customers] AS [c]
WHERE [c].[NationalId] = @__request_NationalId_0
2025-02-02 01:37:20.978 +03:00 [INF] Starting password verification for NationalId: 1064448614
2025-02-02 01:37:21.195 +03:00 [INF] Password verification result for NationalId 1064448614: Success
2025-02-02 01:37:21.203 +03:00 [INF] Executed DbCommand (6ms) [Parameters=[@__request_NationalId_0='?' (Size = 450), @__request_DeviceId_1='?' (Size = 450)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [c].[Id], [c].[BiometricEnabled], [c].[BiometricToken], [c].[CreatedAt], [c].[DeviceId], [c].[LastUsedAt], [c].[Manufacturer], [c].[Model], [c].[NationalId], [c].[OsVersion], [c].[Platform], [c].[Status]
FROM [Customer_Devices] AS [c]
WHERE [c].[NationalId] = @__request_NationalId_0 AND [c].[DeviceId] = @__request_DeviceId_1 AND [c].[Status] = N'active'
2025-02-02 01:37:21.285 +03:00 [INF] Executed DbCommand (77ms) [Parameters=[@p0='?' (Size = 4000), @p1='?' (DbType = DateTime2), @p2='?' (Size = 4000), @p3='?' (Size = 4000), @p4='?' (Size = 4000), @p5='?' (Size = 450), @p6='?' (Size = 4000), @p7='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SET IMPLICIT_TRANSACTIONS OFF;
SET NOCOUNT ON;
INSERT INTO [AuthLogs] ([AuthType], [CreatedAt], [DeviceId], [FailureReason], [IpAddress], [NationalId], [Status], [UserAgent])
OUTPUT INSERTED.[Id]
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7);
2025-02-02 01:37:21.289 +03:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType9`2[[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Object, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-02-02 01:37:21.291 +03:00 [INF] Executed action NayifatAPI.Controllers.AuthController.SignIn (NayifatAPI) in 333.7088ms
2025-02-02 01:37:21.293 +03:00 [INF] Executed endpoint 'NayifatAPI.Controllers.AuthController.SignIn (NayifatAPI)'
2025-02-02 01:37:21.295 +03:00 [INF] Request finished HTTP/1.1 POST http://957c-51-252-155-185.ngrok-free.app/api/auth/signin - 200 null application/json; charset=utf-8 347.0862ms
2025-02-02 01:37:22.136 +03:00 [INF] Request starting HTTP/1.1 POST http://957c-51-252-155-185.ngrok-free.app/api/auth/signin - application/json; charset=utf-8 49
2025-02-02 01:37:22.141 +03:00 [INF] Executing endpoint 'NayifatAPI.Controllers.AuthController.SignIn (NayifatAPI)'
2025-02-02 01:37:22.144 +03:00 [INF] Route matched with {action = "SignIn", controller = "Auth"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] SignIn(NayifatAPI.Controllers.SignInRequest) on controller NayifatAPI.Controllers.AuthController (NayifatAPI).
2025-02-02 01:37:22.148 +03:00 [INF] Executing BadRequestObjectResult, writing value of type 'Microsoft.AspNetCore.Mvc.ValidationProblemDetails'.
2025-02-02 01:37:22.151 +03:00 [INF] Executed action NayifatAPI.Controllers.AuthController.SignIn (NayifatAPI) in 4.6849ms
2025-02-02 01:37:22.154 +03:00 [INF] Executed endpoint 'NayifatAPI.Controllers.AuthController.SignIn (NayifatAPI)'
2025-02-02 01:37:22.157 +03:00 [INF] Request finished HTTP/1.1 POST http://957c-51-252-155-185.ngrok-free.app/api/auth/signin - 400 null application/problem+json; charset=utf-8 20.9351ms
2025-02-02 01:37:33.331 +03:00 [INF] Request starting HTTP/1.1 POST http://957c-51-252-155-185.ngrok-free.app/api/notifications/list - application/json; charset=utf-8 47
2025-02-02 01:37:33.338 +03:00 [INF] Executing endpoint 'NayifatAPI.Controllers.NotificationsController.GetNotifications (NayifatAPI)'
2025-02-02 01:37:33.339 +03:00 [INF] Route matched with {action = "GetNotifications", controller = "Notifications"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetNotifications(NayifatAPI.Controllers.GetNotificationsRequest) on controller NayifatAPI.Controllers.NotificationsController (NayifatAPI).
2025-02-02 01:37:33.345 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@__providedApiKey_0='?' (Size = 255)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [a].[Key], [a].[CreatedAt], [a].[Description], [a].[ExpiresAt], [a].[IsActive], [a].[LastUsedAt]
FROM [ApiKeys] AS [a]
WHERE [a].[Key] = @__providedApiKey_0 AND [a].[IsActive] = CAST(1 AS bit)
2025-02-02 01:37:33.354 +03:00 [INF] Executed DbCommand (4ms) [Parameters=[@__request_NationalId_0='?' (Size = 450)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [u].[national_id], [u].[last_updated], [u].[notifications]
FROM [user_notifications] AS [u]
WHERE [u].[national_id] = @__request_NationalId_0
2025-02-02 01:37:33.365 +03:00 [INF] Executed DbCommand (3ms) [Parameters=[@__Parse_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [n].[Id], [n].[additional_data], [n].[Body], [n].[body_ar], [n].[body_en], [n].[created_at], [n].[expiry_at], [n].[Route], [n].[target_criteria], [n].[Title], [n].[title_ar], [n].[title_en]
FROM [notification_templates] AS [n]
WHERE [n].[Id] = @__Parse_0
2025-02-02 01:37:33.373 +03:00 [INF] Executed DbCommand (2ms) [Parameters=[@__Parse_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [n].[Id], [n].[additional_data], [n].[Body], [n].[body_ar], [n].[body_en], [n].[created_at], [n].[expiry_at], [n].[Route], [n].[target_criteria], [n].[Title], [n].[title_ar], [n].[title_en]
FROM [notification_templates] AS [n]
WHERE [n].[Id] = @__Parse_0
2025-02-02 01:37:33.446 +03:00 [INF] Executed DbCommand (67ms) [Parameters=[@p0='?' (Size = 4000), @p1='?' (DbType = DateTime2), @p2='?' (Size = 4000), @p3='?' (Size = 4000), @p4='?' (Size = 4000), @p5='?' (Size = 450), @p6='?' (Size = 4000), @p7='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SET IMPLICIT_TRANSACTIONS OFF;
SET NOCOUNT ON;
INSERT INTO [AuthLogs] ([AuthType], [CreatedAt], [DeviceId], [FailureReason], [IpAddress], [NationalId], [Status], [UserAgent])
OUTPUT INSERTED.[Id]
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7);
2025-02-02 01:37:33.450 +03:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType9`2[[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Object, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-02-02 01:37:33.452 +03:00 [INF] Executed action NayifatAPI.Controllers.NotificationsController.GetNotifications (NayifatAPI) in 109.8031ms
2025-02-02 01:37:33.456 +03:00 [INF] Executed endpoint 'NayifatAPI.Controllers.NotificationsController.GetNotifications (NayifatAPI)'
2025-02-02 01:37:33.457 +03:00 [INF] Request finished HTTP/1.1 POST http://957c-51-252-155-185.ngrok-free.app/api/notifications/list - 200 null application/json; charset=utf-8 126.7909ms
2025-02-02 01:37:42.118 +03:00 [INF] Request starting HTTP/1.1 POST http://957c-51-252-155-185.ngrok-free.app/api/notifications/list - application/json; charset=utf-8 47
2025-02-02 01:37:42.226 +03:00 [INF] Executing endpoint 'NayifatAPI.Controllers.NotificationsController.GetNotifications (NayifatAPI)'
2025-02-02 01:37:42.308 +03:00 [INF] Route matched with {action = "GetNotifications", controller = "Notifications"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetNotifications(NayifatAPI.Controllers.GetNotificationsRequest) on controller NayifatAPI.Controllers.NotificationsController (NayifatAPI).
2025-02-02 01:37:42.339 +03:00 [INF] Executed DbCommand (20ms) [Parameters=[@__providedApiKey_0='?' (Size = 255)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [a].[Key], [a].[CreatedAt], [a].[Description], [a].[ExpiresAt], [a].[IsActive], [a].[LastUsedAt]
FROM [ApiKeys] AS [a]
WHERE [a].[Key] = @__providedApiKey_0 AND [a].[IsActive] = CAST(1 AS bit)
2025-02-02 01:37:42.417 +03:00 [INF] Executed DbCommand (2ms) [Parameters=[@__request_NationalId_0='?' (Size = 450)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [u].[national_id], [u].[last_updated], [u].[notifications]
FROM [user_notifications] AS [u]
WHERE [u].[national_id] = @__request_NationalId_0
2025-02-02 01:37:42.453 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@__Parse_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [n].[Id], [n].[additional_data], [n].[Body], [n].[body_ar], [n].[body_en], [n].[created_at], [n].[expiry_at], [n].[Route], [n].[target_criteria], [n].[Title], [n].[title_ar], [n].[title_en]
FROM [notification_templates] AS [n]
WHERE [n].[Id] = @__Parse_0
2025-02-02 01:37:42.456 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@__Parse_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [n].[Id], [n].[additional_data], [n].[Body], [n].[body_ar], [n].[body_en], [n].[created_at], [n].[expiry_at], [n].[Route], [n].[target_criteria], [n].[Title], [n].[title_ar], [n].[title_en]
FROM [notification_templates] AS [n]
WHERE [n].[Id] = @__Parse_0
2025-02-02 01:37:42.855 +03:00 [INF] Executed DbCommand (57ms) [Parameters=[@p0='?' (Size = 4000), @p1='?' (DbType = DateTime2), @p2='?' (Size = 4000), @p3='?' (Size = 4000), @p4='?' (Size = 4000), @p5='?' (Size = 450), @p6='?' (Size = 4000), @p7='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SET IMPLICIT_TRANSACTIONS OFF;
SET NOCOUNT ON;
INSERT INTO [AuthLogs] ([AuthType], [CreatedAt], [DeviceId], [FailureReason], [IpAddress], [NationalId], [Status], [UserAgent])
OUTPUT INSERTED.[Id]
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7);
2025-02-02 01:37:42.987 +03:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType9`2[[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Object, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-02-02 01:37:42.989 +03:00 [INF] Executed action NayifatAPI.Controllers.NotificationsController.GetNotifications (NayifatAPI) in 671.7845ms
2025-02-02 01:37:42.991 +03:00 [INF] Executed endpoint 'NayifatAPI.Controllers.NotificationsController.GetNotifications (NayifatAPI)'
2025-02-02 01:37:42.992 +03:00 [INF] Request finished HTTP/1.1 POST http://957c-51-252-155-185.ngrok-free.app/api/notifications/list - 200 null application/json; charset=utf-8 873.7713ms
2025-02-02 01:37:46.534 +03:00 [INF] Request starting HTTP/1.1 POST http://957c-51-252-155-185.ngrok-free.app/api/notifications/list - application/json; charset=utf-8 47
2025-02-02 01:37:46.537 +03:00 [INF] Executing endpoint 'NayifatAPI.Controllers.NotificationsController.GetNotifications (NayifatAPI)'
2025-02-02 01:37:46.539 +03:00 [INF] Route matched with {action = "GetNotifications", controller = "Notifications"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetNotifications(NayifatAPI.Controllers.GetNotificationsRequest) on controller NayifatAPI.Controllers.NotificationsController (NayifatAPI).
2025-02-02 01:37:46.542 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@__providedApiKey_0='?' (Size = 255)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [a].[Key], [a].[CreatedAt], [a].[Description], [a].[ExpiresAt], [a].[IsActive], [a].[LastUsedAt]
FROM [ApiKeys] AS [a]
WHERE [a].[Key] = @__providedApiKey_0 AND [a].[IsActive] = CAST(1 AS bit)
2025-02-02 01:37:46.546 +03:00 [INF] Executed DbCommand (0ms) [Parameters=[@__request_NationalId_0='?' (Size = 450)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [u].[national_id], [u].[last_updated], [u].[notifications]
FROM [user_notifications] AS [u]
WHERE [u].[national_id] = @__request_NationalId_0
2025-02-02 01:37:46.550 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@__Parse_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [n].[Id], [n].[additional_data], [n].[Body], [n].[body_ar], [n].[body_en], [n].[created_at], [n].[expiry_at], [n].[Route], [n].[target_criteria], [n].[Title], [n].[title_ar], [n].[title_en]
FROM [notification_templates] AS [n]
WHERE [n].[Id] = @__Parse_0
2025-02-02 01:37:46.555 +03:00 [INF] Executed DbCommand (0ms) [Parameters=[@__Parse_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [n].[Id], [n].[additional_data], [n].[Body], [n].[body_ar], [n].[body_en], [n].[created_at], [n].[expiry_at], [n].[Route], [n].[target_criteria], [n].[Title], [n].[title_ar], [n].[title_en]
FROM [notification_templates] AS [n]
WHERE [n].[Id] = @__Parse_0
2025-02-02 01:37:46.564 +03:00 [INF] Executed DbCommand (7ms) [Parameters=[@p0='?' (Size = 4000), @p1='?' (DbType = DateTime2), @p2='?' (Size = 4000), @p3='?' (Size = 4000), @p4='?' (Size = 4000), @p5='?' (Size = 450), @p6='?' (Size = 4000), @p7='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SET IMPLICIT_TRANSACTIONS OFF;
SET NOCOUNT ON;
INSERT INTO [AuthLogs] ([AuthType], [CreatedAt], [DeviceId], [FailureReason], [IpAddress], [NationalId], [Status], [UserAgent])
OUTPUT INSERTED.[Id]
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7);
2025-02-02 01:37:46.568 +03:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType9`2[[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Object, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-02-02 01:37:46.570 +03:00 [INF] Executed action NayifatAPI.Controllers.NotificationsController.GetNotifications (NayifatAPI) in 30.1618ms
2025-02-02 01:37:46.574 +03:00 [INF] Executed endpoint 'NayifatAPI.Controllers.NotificationsController.GetNotifications (NayifatAPI)'
2025-02-02 01:37:46.577 +03:00 [INF] Request finished HTTP/1.1 POST http://957c-51-252-155-185.ngrok-free.app/api/notifications/list - 200 null application/json; charset=utf-8 43.5139ms
2025-02-02 01:38:12.743 +03:00 [INF] Request starting HTTP/1.1 POST http://957c-51-252-155-185.ngrok-free.app/api/auth/signin - application/json; charset=utf-8 224
2025-02-02 01:38:12.750 +03:00 [INF] Executing endpoint 'NayifatAPI.Controllers.AuthController.SignIn (NayifatAPI)'
2025-02-02 01:38:12.753 +03:00 [INF] Route matched with {action = "SignIn", controller = "Auth"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] SignIn(NayifatAPI.Controllers.SignInRequest) on controller NayifatAPI.Controllers.AuthController (NayifatAPI).
2025-02-02 01:38:12.759 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@__providedApiKey_0='?' (Size = 255)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [a].[Key], [a].[CreatedAt], [a].[Description], [a].[ExpiresAt], [a].[IsActive], [a].[LastUsedAt]
FROM [ApiKeys] AS [a]
WHERE [a].[Key] = @__providedApiKey_0 AND [a].[IsActive] = CAST(1 AS bit)
2025-02-02 01:38:12.763 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@__request_NationalId_0='?' (Size = 450)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [c].[NationalId], [c].[AddNo], [c].[BuildingNo], [c].[City], [c].[Consent], [c].[ConsentDate], [c].[DateOfBirth], [c].[Dependents], [c].[District], [c].[Email], [c].[Employer], [c].[FamilyNameAr], [c].[FamilyNameEn], [c].[FirstNameAr], [c].[FirstNameEn], [c].[Iban], [c].[IdExpiryDate], [c].[Los], [c].[Mpin], [c].[MpinEnabled], [c].[NafathStatus], [c].[NafathTimestamp], [c].[Password], [c].[Phone], [c].[RegistrationDate], [c].[SalaryCustomer], [c].[SalaryDakhli], [c].[SecondNameAr], [c].[SecondNameEn], [c].[Sector], [c].[Street], [c].[ThirdNameAr], [c].[ThirdNameEn], [c].[Zipcode]
FROM [Customers] AS [c]
WHERE [c].[NationalId] = @__request_NationalId_0
2025-02-02 01:38:12.766 +03:00 [INF] Starting password verification for NationalId: 1064448614
2025-02-02 01:38:12.959 +03:00 [INF] Password verification result for NationalId 1064448614: Success
2025-02-02 01:38:12.963 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@__request_NationalId_0='?' (Size = 450), @__request_DeviceId_1='?' (Size = 450)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [c].[Id], [c].[BiometricEnabled], [c].[BiometricToken], [c].[CreatedAt], [c].[DeviceId], [c].[LastUsedAt], [c].[Manufacturer], [c].[Model], [c].[NationalId], [c].[OsVersion], [c].[Platform], [c].[Status]
FROM [Customer_Devices] AS [c]
WHERE [c].[NationalId] = @__request_NationalId_0 AND [c].[DeviceId] = @__request_DeviceId_1 AND [c].[Status] = N'active'
2025-02-02 01:38:13.041 +03:00 [INF] Executed DbCommand (74ms) [Parameters=[@p0='?' (Size = 4000), @p1='?' (DbType = DateTime2), @p2='?' (Size = 4000), @p3='?' (Size = 4000), @p4='?' (Size = 4000), @p5='?' (Size = 450), @p6='?' (Size = 4000), @p7='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SET IMPLICIT_TRANSACTIONS OFF;
SET NOCOUNT ON;
INSERT INTO [AuthLogs] ([AuthType], [CreatedAt], [DeviceId], [FailureReason], [IpAddress], [NationalId], [Status], [UserAgent])
OUTPUT INSERTED.[Id]
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7);
2025-02-02 01:38:13.045 +03:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType9`2[[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Object, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-02-02 01:38:13.048 +03:00 [INF] Executed action NayifatAPI.Controllers.AuthController.SignIn (NayifatAPI) in 290.8845ms
2025-02-02 01:38:13.050 +03:00 [INF] Executed endpoint 'NayifatAPI.Controllers.AuthController.SignIn (NayifatAPI)'
2025-02-02 01:38:13.053 +03:00 [INF] Request finished HTTP/1.1 POST http://957c-51-252-155-185.ngrok-free.app/api/auth/signin - 200 null application/json; charset=utf-8 309.4167ms
2025-02-02 01:38:13.870 +03:00 [INF] Request starting HTTP/1.1 POST http://957c-51-252-155-185.ngrok-free.app/api/auth/signin - application/json; charset=utf-8 49
2025-02-02 01:38:13.877 +03:00 [INF] Executing endpoint 'NayifatAPI.Controllers.AuthController.SignIn (NayifatAPI)'
2025-02-02 01:38:13.879 +03:00 [INF] Route matched with {action = "SignIn", controller = "Auth"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] SignIn(NayifatAPI.Controllers.SignInRequest) on controller NayifatAPI.Controllers.AuthController (NayifatAPI).
2025-02-02 01:38:13.883 +03:00 [INF] Executing BadRequestObjectResult, writing value of type 'Microsoft.AspNetCore.Mvc.ValidationProblemDetails'.
2025-02-02 01:38:13.884 +03:00 [INF] Executed action NayifatAPI.Controllers.AuthController.SignIn (NayifatAPI) in 2.3425ms
2025-02-02 01:38:13.887 +03:00 [INF] Executed endpoint 'NayifatAPI.Controllers.AuthController.SignIn (NayifatAPI)'
2025-02-02 01:38:13.888 +03:00 [INF] Request finished HTTP/1.1 POST http://957c-51-252-155-185.ngrok-free.app/api/auth/signin - 400 null application/problem+json; charset=utf-8 18.6414ms
2025-02-02 01:40:18.396 +03:00 [INF] Request starting HTTP/1.1 POST http://957c-51-252-155-185.ngrok-free.app/api/auth/signin - application/json; charset=utf-8 224
2025-02-02 01:40:18.564 +03:00 [INF] Executing endpoint 'NayifatAPI.Controllers.AuthController.SignIn (NayifatAPI)'
2025-02-02 01:40:18.565 +03:00 [INF] Route matched with {action = "SignIn", controller = "Auth"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] SignIn(NayifatAPI.Controllers.SignInRequest) on controller NayifatAPI.Controllers.AuthController (NayifatAPI).
2025-02-02 01:40:18.584 +03:00 [INF] Executed DbCommand (16ms) [Parameters=[@__providedApiKey_0='?' (Size = 255)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [a].[Key], [a].[CreatedAt], [a].[Description], [a].[ExpiresAt], [a].[IsActive], [a].[LastUsedAt]
FROM [ApiKeys] AS [a]
WHERE [a].[Key] = @__providedApiKey_0 AND [a].[IsActive] = CAST(1 AS bit)
2025-02-02 01:40:18.598 +03:00 [INF] Executed DbCommand (12ms) [Parameters=[@__request_NationalId_0='?' (Size = 450)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [c].[NationalId], [c].[AddNo], [c].[BuildingNo], [c].[City], [c].[Consent], [c].[ConsentDate], [c].[DateOfBirth], [c].[Dependents], [c].[District], [c].[Email], [c].[Employer], [c].[FamilyNameAr], [c].[FamilyNameEn], [c].[FirstNameAr], [c].[FirstNameEn], [c].[Iban], [c].[IdExpiryDate], [c].[Los], [c].[Mpin], [c].[MpinEnabled], [c].[NafathStatus], [c].[NafathTimestamp], [c].[Password], [c].[Phone], [c].[RegistrationDate], [c].[SalaryCustomer], [c].[SalaryDakhli], [c].[SecondNameAr], [c].[SecondNameEn], [c].[Sector], [c].[Street], [c].[ThirdNameAr], [c].[ThirdNameEn], [c].[Zipcode]
FROM [Customers] AS [c]
WHERE [c].[NationalId] = @__request_NationalId_0
2025-02-02 01:40:18.602 +03:00 [INF] Starting password verification for NationalId: 1064448614
2025-02-02 01:40:19.657 +03:00 [INF] Password verification result for NationalId 1064448614: Success
2025-02-02 01:40:19.957 +03:00 [INF] Executed DbCommand (3ms) [Parameters=[@__request_NationalId_0='?' (Size = 450), @__request_DeviceId_1='?' (Size = 450)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [c].[Id], [c].[BiometricEnabled], [c].[BiometricToken], [c].[CreatedAt], [c].[DeviceId], [c].[LastUsedAt], [c].[Manufacturer], [c].[Model], [c].[NationalId], [c].[OsVersion], [c].[Platform], [c].[Status]
FROM [Customer_Devices] AS [c]
WHERE [c].[NationalId] = @__request_NationalId_0 AND [c].[DeviceId] = @__request_DeviceId_1 AND [c].[Status] = N'active'
2025-02-02 01:40:20.420 +03:00 [INF] Executed DbCommand (382ms) [Parameters=[@p0='?' (Size = 4000), @p1='?' (DbType = DateTime2), @p2='?' (Size = 4000), @p3='?' (Size = 4000), @p4='?' (Size = 4000), @p5='?' (Size = 450), @p6='?' (Size = 4000), @p7='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SET IMPLICIT_TRANSACTIONS OFF;
SET NOCOUNT ON;
INSERT INTO [AuthLogs] ([AuthType], [CreatedAt], [DeviceId], [FailureReason], [IpAddress], [NationalId], [Status], [UserAgent])
OUTPUT INSERTED.[Id]
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7);
2025-02-02 01:40:20.458 +03:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType9`2[[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Object, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-02-02 01:40:20.459 +03:00 [INF] Executed action NayifatAPI.Controllers.AuthController.SignIn (NayifatAPI) in 1893.2967ms
2025-02-02 01:40:20.461 +03:00 [INF] Executed endpoint 'NayifatAPI.Controllers.AuthController.SignIn (NayifatAPI)'
2025-02-02 01:40:20.463 +03:00 [INF] Request finished HTTP/1.1 POST http://957c-51-252-155-185.ngrok-free.app/api/auth/signin - 200 null application/json; charset=utf-8 2066.6508ms
2025-02-02 01:41:02.088 +03:00 [INF] Request starting HTTP/1.1 POST http://957c-51-252-155-185.ngrok-free.app/api/notifications/list - application/json; charset=utf-8 47
2025-02-02 01:41:02.456 +03:00 [INF] Executing endpoint 'NayifatAPI.Controllers.NotificationsController.GetNotifications (NayifatAPI)'
2025-02-02 01:41:02.456 +03:00 [INF] Route matched with {action = "GetNotifications", controller = "Notifications"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetNotifications(NayifatAPI.Controllers.GetNotificationsRequest) on controller NayifatAPI.Controllers.NotificationsController (NayifatAPI).
2025-02-02 01:41:02.464 +03:00 [INF] Executed DbCommand (5ms) [Parameters=[@__providedApiKey_0='?' (Size = 255)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [a].[Key], [a].[CreatedAt], [a].[Description], [a].[ExpiresAt], [a].[IsActive], [a].[LastUsedAt]
FROM [ApiKeys] AS [a]
WHERE [a].[Key] = @__providedApiKey_0 AND [a].[IsActive] = CAST(1 AS bit)
2025-02-02 01:41:02.470 +03:00 [INF] Executed DbCommand (3ms) [Parameters=[@__request_NationalId_0='?' (Size = 450)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [u].[national_id], [u].[last_updated], [u].[notifications]
FROM [user_notifications] AS [u]
WHERE [u].[national_id] = @__request_NationalId_0
2025-02-02 01:41:02.477 +03:00 [INF] Executed DbCommand (3ms) [Parameters=[@__Parse_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [n].[Id], [n].[additional_data], [n].[Body], [n].[body_ar], [n].[body_en], [n].[created_at], [n].[expiry_at], [n].[Route], [n].[target_criteria], [n].[Title], [n].[title_ar], [n].[title_en]
FROM [notification_templates] AS [n]
WHERE [n].[Id] = @__Parse_0
2025-02-02 01:41:02.515 +03:00 [INF] Executed DbCommand (15ms) [Parameters=[@__Parse_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [n].[Id], [n].[additional_data], [n].[Body], [n].[body_ar], [n].[body_en], [n].[created_at], [n].[expiry_at], [n].[Route], [n].[target_criteria], [n].[Title], [n].[title_ar], [n].[title_en]
FROM [notification_templates] AS [n]
WHERE [n].[Id] = @__Parse_0
2025-02-02 01:41:03.009 +03:00 [INF] Executed DbCommand (71ms) [Parameters=[@p0='?' (Size = 4000), @p1='?' (DbType = DateTime2), @p2='?' (Size = 4000), @p3='?' (Size = 4000), @p4='?' (Size = 4000), @p5='?' (Size = 450), @p6='?' (Size = 4000), @p7='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SET IMPLICIT_TRANSACTIONS OFF;
SET NOCOUNT ON;
INSERT INTO [AuthLogs] ([AuthType], [CreatedAt], [DeviceId], [FailureReason], [IpAddress], [NationalId], [Status], [UserAgent])
OUTPUT INSERTED.[Id]
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7);
2025-02-02 01:41:03.513 +03:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType9`2[[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Object, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-02-02 01:41:03.514 +03:00 [INF] Executed action NayifatAPI.Controllers.NotificationsController.GetNotifications (NayifatAPI) in 1055.7793ms
2025-02-02 01:41:03.516 +03:00 [INF] Executed endpoint 'NayifatAPI.Controllers.NotificationsController.GetNotifications (NayifatAPI)'
2025-02-02 01:41:03.518 +03:00 [INF] Request finished HTTP/1.1 POST http://957c-51-252-155-185.ngrok-free.app/api/notifications/list - 200 null application/json; charset=utf-8 1430.2869ms
2025-02-02 01:42:36.315 +03:00 [INF] Request starting HTTP/1.1 POST http://957c-51-252-155-185.ngrok-free.app/api/notifications/list - application/json; charset=utf-8 47
2025-02-02 01:42:36.322 +03:00 [INF] Executing endpoint 'NayifatAPI.Controllers.NotificationsController.GetNotifications (NayifatAPI)'
2025-02-02 01:42:36.324 +03:00 [INF] Route matched with {action = "GetNotifications", controller = "Notifications"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetNotifications(NayifatAPI.Controllers.GetNotificationsRequest) on controller NayifatAPI.Controllers.NotificationsController (NayifatAPI).
2025-02-02 01:42:36.889 +03:00 [INF] Executed DbCommand (6ms) [Parameters=[@__providedApiKey_0='?' (Size = 255)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [a].[Key], [a].[CreatedAt], [a].[Description], [a].[ExpiresAt], [a].[IsActive], [a].[LastUsedAt]
FROM [ApiKeys] AS [a]
WHERE [a].[Key] = @__providedApiKey_0 AND [a].[IsActive] = CAST(1 AS bit)
2025-02-02 01:42:36.914 +03:00 [INF] Executed DbCommand (20ms) [Parameters=[@__request_NationalId_0='?' (Size = 450)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [u].[national_id], [u].[last_updated], [u].[notifications]
FROM [user_notifications] AS [u]
WHERE [u].[national_id] = @__request_NationalId_0
2025-02-02 01:42:38.007 +03:00 [INF] Executed DbCommand (5ms) [Parameters=[@__Parse_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [n].[Id], [n].[additional_data], [n].[Body], [n].[body_ar], [n].[body_en], [n].[created_at], [n].[expiry_at], [n].[Route], [n].[target_criteria], [n].[Title], [n].[title_ar], [n].[title_en]
FROM [notification_templates] AS [n]
WHERE [n].[Id] = @__Parse_0
2025-02-02 01:42:38.040 +03:00 [INF] Executed DbCommand (27ms) [Parameters=[@__Parse_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [n].[Id], [n].[additional_data], [n].[Body], [n].[body_ar], [n].[body_en], [n].[created_at], [n].[expiry_at], [n].[Route], [n].[target_criteria], [n].[Title], [n].[title_ar], [n].[title_en]
FROM [notification_templates] AS [n]
WHERE [n].[Id] = @__Parse_0
2025-02-02 01:42:38.872 +03:00 [INF] Executed DbCommand (312ms) [Parameters=[@p0='?' (Size = 4000), @p1='?' (DbType = DateTime2), @p2='?' (Size = 4000), @p3='?' (Size = 4000), @p4='?' (Size = 4000), @p5='?' (Size = 450), @p6='?' (Size = 4000), @p7='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SET IMPLICIT_TRANSACTIONS OFF;
SET NOCOUNT ON;
INSERT INTO [AuthLogs] ([AuthType], [CreatedAt], [DeviceId], [FailureReason], [IpAddress], [NationalId], [Status], [UserAgent])
OUTPUT INSERTED.[Id]
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7);
2025-02-02 01:42:38.965 +03:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType9`2[[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Object, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-02-02 01:42:38.970 +03:00 [INF] Executed action NayifatAPI.Controllers.NotificationsController.GetNotifications (NayifatAPI) in 2089.1732ms
2025-02-02 01:42:38.977 +03:00 [INF] Executed endpoint 'NayifatAPI.Controllers.NotificationsController.GetNotifications (NayifatAPI)'
2025-02-02 01:42:38.979 +03:00 [INF] Request finished HTTP/1.1 POST http://957c-51-252-155-185.ngrok-free.app/api/notifications/list - 200 null application/json; charset=utf-8 2663.9819ms
2025-02-02 01:42:40.708 +03:00 [INF] Request starting HTTP/1.1 POST http://957c-51-252-155-185.ngrok-free.app/api/proxy/forward?url=https://icreditdept.com/api/testasp/test_local_generate_otp.php - application/json 115
2025-02-02 01:42:40.716 +03:00 [INF] Executing endpoint 'NayifatAPI.Controllers.ProxyController.ForwardRequest (NayifatAPI)'
2025-02-02 01:42:40.728 +03:00 [INF] Route matched with {action = "ForwardRequest", controller = "Proxy"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] ForwardRequest() on controller NayifatAPI.Controllers.ProxyController (NayifatAPI).
2025-02-02 01:42:40.799 +03:00 [INF] Start processing HTTP request POST https://icreditdept.com/api/testasp/test_local_generate_otp.php
2025-02-02 01:42:40.804 +03:00 [INF] Sending HTTP request POST https://icreditdept.com/api/testasp/test_local_generate_otp.php
2025-02-02 01:42:42.408 +03:00 [INF] Received HTTP response headers after 1597.7449ms - 200
2025-02-02 01:42:42.414 +03:00 [INF] End processing HTTP request after 1624.965ms - 200
2025-02-02 01:42:42.431 +03:00 [INF] Raw response length: 200
2025-02-02 01:42:42.433 +03:00 [INF] Response content: {"success":true,"errors":[],"result":{"nationalId":"1064448614","otp":922207,"expiryDate":"2025-02-02 01:47:42","successMsg":"Success","errCode":0,"errMsg":null},"type":"N","message":null,"code":null}
2025-02-02 01:42:42.439 +03:00 [INF] Executing ContentResult with HTTP Response ContentType of application/json
2025-02-02 01:42:42.448 +03:00 [INF] Executed action NayifatAPI.Controllers.ProxyController.ForwardRequest (NayifatAPI) in 1711.137ms
2025-02-02 01:42:42.453 +03:00 [INF] Executed endpoint 'NayifatAPI.Controllers.ProxyController.ForwardRequest (NayifatAPI)'
2025-02-02 01:42:42.456 +03:00 [INF] Request finished HTTP/1.1 POST http://957c-51-252-155-185.ngrok-free.app/api/proxy/forward?url=https://icreditdept.com/api/testasp/test_local_generate_otp.php - 200 200 application/json 1747.9738ms
2025-02-02 01:42:43.716 +03:00 [INF] Request starting HTTP/1.1 POST http://957c-51-252-155-185.ngrok-free.app/api/notifications/list - application/json; charset=utf-8 47
2025-02-02 01:42:43.722 +03:00 [INF] Executing endpoint 'NayifatAPI.Controllers.NotificationsController.GetNotifications (NayifatAPI)'
2025-02-02 01:42:43.724 +03:00 [INF] Route matched with {action = "GetNotifications", controller = "Notifications"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetNotifications(NayifatAPI.Controllers.GetNotificationsRequest) on controller NayifatAPI.Controllers.NotificationsController (NayifatAPI).
2025-02-02 01:42:43.740 +03:00 [INF] Executed DbCommand (5ms) [Parameters=[@__providedApiKey_0='?' (Size = 255)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [a].[Key], [a].[CreatedAt], [a].[Description], [a].[ExpiresAt], [a].[IsActive], [a].[LastUsedAt]
FROM [ApiKeys] AS [a]
WHERE [a].[Key] = @__providedApiKey_0 AND [a].[IsActive] = CAST(1 AS bit)
2025-02-02 01:42:43.753 +03:00 [INF] Executed DbCommand (4ms) [Parameters=[@__request_NationalId_0='?' (Size = 450)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [u].[national_id], [u].[last_updated], [u].[notifications]
FROM [user_notifications] AS [u]
WHERE [u].[national_id] = @__request_NationalId_0
2025-02-02 01:42:43.770 +03:00 [INF] Executed DbCommand (6ms) [Parameters=[@__Parse_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [n].[Id], [n].[additional_data], [n].[Body], [n].[body_ar], [n].[body_en], [n].[created_at], [n].[expiry_at], [n].[Route], [n].[target_criteria], [n].[Title], [n].[title_ar], [n].[title_en]
FROM [notification_templates] AS [n]
WHERE [n].[Id] = @__Parse_0
2025-02-02 01:42:43.780 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@__Parse_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [n].[Id], [n].[additional_data], [n].[Body], [n].[body_ar], [n].[body_en], [n].[created_at], [n].[expiry_at], [n].[Route], [n].[target_criteria], [n].[Title], [n].[title_ar], [n].[title_en]
FROM [notification_templates] AS [n]
WHERE [n].[Id] = @__Parse_0
2025-02-02 01:42:43.811 +03:00 [INF] Executed DbCommand (24ms) [Parameters=[@p0='?' (Size = 4000), @p1='?' (DbType = DateTime2), @p2='?' (Size = 4000), @p3='?' (Size = 4000), @p4='?' (Size = 4000), @p5='?' (Size = 450), @p6='?' (Size = 4000), @p7='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SET IMPLICIT_TRANSACTIONS OFF;
SET NOCOUNT ON;
INSERT INTO [AuthLogs] ([AuthType], [CreatedAt], [DeviceId], [FailureReason], [IpAddress], [NationalId], [Status], [UserAgent])
OUTPUT INSERTED.[Id]
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7);
2025-02-02 01:42:43.821 +03:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType9`2[[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Object, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-02-02 01:42:43.828 +03:00 [INF] Executed action NayifatAPI.Controllers.NotificationsController.GetNotifications (NayifatAPI) in 95.2577ms
2025-02-02 01:42:43.833 +03:00 [INF] Executed endpoint 'NayifatAPI.Controllers.NotificationsController.GetNotifications (NayifatAPI)'
2025-02-02 01:42:43.836 +03:00 [INF] Request finished HTTP/1.1 POST http://957c-51-252-155-185.ngrok-free.app/api/notifications/list - 200 null application/json; charset=utf-8 119.7885ms
2025-02-02 01:44:13.555 +03:00 [INF] Request starting HTTP/1.1 POST http://957c-51-252-155-185.ngrok-free.app/api/auth/signin - application/json; charset=utf-8 224
2025-02-02 01:44:13.677 +03:00 [INF] Executing endpoint 'NayifatAPI.Controllers.AuthController.SignIn (NayifatAPI)'
2025-02-02 01:44:13.679 +03:00 [INF] Route matched with {action = "SignIn", controller = "Auth"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] SignIn(NayifatAPI.Controllers.SignInRequest) on controller NayifatAPI.Controllers.AuthController (NayifatAPI).
2025-02-02 01:44:13.692 +03:00 [INF] Executed DbCommand (8ms) [Parameters=[@__providedApiKey_0='?' (Size = 255)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [a].[Key], [a].[CreatedAt], [a].[Description], [a].[ExpiresAt], [a].[IsActive], [a].[LastUsedAt]
FROM [ApiKeys] AS [a]
WHERE [a].[Key] = @__providedApiKey_0 AND [a].[IsActive] = CAST(1 AS bit)
2025-02-02 01:44:13.701 +03:00 [INF] Executed DbCommand (6ms) [Parameters=[@__request_NationalId_0='?' (Size = 450)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [c].[NationalId], [c].[AddNo], [c].[BuildingNo], [c].[City], [c].[Consent], [c].[ConsentDate], [c].[DateOfBirth], [c].[Dependents], [c].[District], [c].[Email], [c].[Employer], [c].[FamilyNameAr], [c].[FamilyNameEn], [c].[FirstNameAr], [c].[FirstNameEn], [c].[Iban], [c].[IdExpiryDate], [c].[Los], [c].[Mpin], [c].[MpinEnabled], [c].[NafathStatus], [c].[NafathTimestamp], [c].[Password], [c].[Phone], [c].[RegistrationDate], [c].[SalaryCustomer], [c].[SalaryDakhli], [c].[SecondNameAr], [c].[SecondNameEn], [c].[Sector], [c].[Street], [c].[ThirdNameAr], [c].[ThirdNameEn], [c].[Zipcode]
FROM [Customers] AS [c]
WHERE [c].[NationalId] = @__request_NationalId_0
2025-02-02 01:44:13.704 +03:00 [INF] Starting password verification for NationalId: 1064448614
2025-02-02 01:44:13.981 +03:00 [INF] Password verification result for NationalId 1064448614: Success
2025-02-02 01:44:14.096 +03:00 [INF] Executed DbCommand (4ms) [Parameters=[@__request_NationalId_0='?' (Size = 450), @__request_DeviceId_1='?' (Size = 450)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [c].[Id], [c].[BiometricEnabled], [c].[BiometricToken], [c].[CreatedAt], [c].[DeviceId], [c].[LastUsedAt], [c].[Manufacturer], [c].[Model], [c].[NationalId], [c].[OsVersion], [c].[Platform], [c].[Status]
FROM [Customer_Devices] AS [c]
WHERE [c].[NationalId] = @__request_NationalId_0 AND [c].[DeviceId] = @__request_DeviceId_1 AND [c].[Status] = N'active'
2025-02-02 01:44:14.286 +03:00 [INF] Executed DbCommand (90ms) [Parameters=[@p0='?' (Size = 4000), @p1='?' (DbType = DateTime2), @p2='?' (Size = 4000), @p3='?' (Size = 4000), @p4='?' (Size = 4000), @p5='?' (Size = 450), @p6='?' (Size = 4000), @p7='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SET IMPLICIT_TRANSACTIONS OFF;
SET NOCOUNT ON;
INSERT INTO [AuthLogs] ([AuthType], [CreatedAt], [DeviceId], [FailureReason], [IpAddress], [NationalId], [Status], [UserAgent])
OUTPUT INSERTED.[Id]
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7);
2025-02-02 01:44:14.390 +03:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType9`2[[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Object, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-02-02 01:44:14.440 +03:00 [INF] Executed action NayifatAPI.Controllers.AuthController.SignIn (NayifatAPI) in 757.5898ms
2025-02-02 01:44:14.445 +03:00 [INF] Executed endpoint 'NayifatAPI.Controllers.AuthController.SignIn (NayifatAPI)'
2025-02-02 01:44:14.447 +03:00 [INF] Request finished HTTP/1.1 POST http://957c-51-252-155-185.ngrok-free.app/api/auth/signin - 200 null application/json; charset=utf-8 891.5373ms
2025-02-02 01:44:51.185 +03:00 [INF] Request starting HTTP/1.1 POST http://957c-51-252-155-185.ngrok-free.app/api/notifications/list - application/json; charset=utf-8 47
2025-02-02 01:44:51.192 +03:00 [INF] Executing endpoint 'NayifatAPI.Controllers.NotificationsController.GetNotifications (NayifatAPI)'
2025-02-02 01:44:51.194 +03:00 [INF] Route matched with {action = "GetNotifications", controller = "Notifications"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetNotifications(NayifatAPI.Controllers.GetNotificationsRequest) on controller NayifatAPI.Controllers.NotificationsController (NayifatAPI).
2025-02-02 01:44:51.199 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@__providedApiKey_0='?' (Size = 255)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [a].[Key], [a].[CreatedAt], [a].[Description], [a].[ExpiresAt], [a].[IsActive], [a].[LastUsedAt]
FROM [ApiKeys] AS [a]
WHERE [a].[Key] = @__providedApiKey_0 AND [a].[IsActive] = CAST(1 AS bit)
2025-02-02 01:44:51.207 +03:00 [INF] Executed DbCommand (3ms) [Parameters=[@__request_NationalId_0='?' (Size = 450)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [u].[national_id], [u].[last_updated], [u].[notifications]
FROM [user_notifications] AS [u]
WHERE [u].[national_id] = @__request_NationalId_0
2025-02-02 01:44:51.215 +03:00 [INF] Executed DbCommand (3ms) [Parameters=[@__Parse_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [n].[Id], [n].[additional_data], [n].[Body], [n].[body_ar], [n].[body_en], [n].[created_at], [n].[expiry_at], [n].[Route], [n].[target_criteria], [n].[Title], [n].[title_ar], [n].[title_en]
FROM [notification_templates] AS [n]
WHERE [n].[Id] = @__Parse_0
2025-02-02 01:44:51.219 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@__Parse_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [n].[Id], [n].[additional_data], [n].[Body], [n].[body_ar], [n].[body_en], [n].[created_at], [n].[expiry_at], [n].[Route], [n].[target_criteria], [n].[Title], [n].[title_ar], [n].[title_en]
FROM [notification_templates] AS [n]
WHERE [n].[Id] = @__Parse_0
2025-02-02 01:44:51.232 +03:00 [INF] Executed DbCommand (6ms) [Parameters=[@p0='?' (Size = 4000), @p1='?' (DbType = DateTime2), @p2='?' (Size = 4000), @p3='?' (Size = 4000), @p4='?' (Size = 4000), @p5='?' (Size = 450), @p6='?' (Size = 4000), @p7='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SET IMPLICIT_TRANSACTIONS OFF;
SET NOCOUNT ON;
INSERT INTO [AuthLogs] ([AuthType], [CreatedAt], [DeviceId], [FailureReason], [IpAddress], [NationalId], [Status], [UserAgent])
OUTPUT INSERTED.[Id]
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7);
2025-02-02 01:44:51.237 +03:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType9`2[[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Object, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-02-02 01:44:51.238 +03:00 [INF] Executed action NayifatAPI.Controllers.NotificationsController.GetNotifications (NayifatAPI) in 41.2714ms
2025-02-02 01:44:51.241 +03:00 [INF] Executed endpoint 'NayifatAPI.Controllers.NotificationsController.GetNotifications (NayifatAPI)'
2025-02-02 01:44:51.243 +03:00 [INF] Request finished HTTP/1.1 POST http://957c-51-252-155-185.ngrok-free.app/api/notifications/list - 200 null application/json; charset=utf-8 57.9985ms
2025-02-02 01:45:56.734 +03:00 [INF] Request starting HTTP/1.1 POST http://957c-51-252-155-185.ngrok-free.app/api/notifications/list - application/json; charset=utf-8 47
2025-02-02 01:45:56.742 +03:00 [INF] Executing endpoint 'NayifatAPI.Controllers.NotificationsController.GetNotifications (NayifatAPI)'
2025-02-02 01:45:56.746 +03:00 [INF] Route matched with {action = "GetNotifications", controller = "Notifications"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetNotifications(NayifatAPI.Controllers.GetNotificationsRequest) on controller NayifatAPI.Controllers.NotificationsController (NayifatAPI).
2025-02-02 01:45:56.759 +03:00 [INF] Executed DbCommand (6ms) [Parameters=[@__providedApiKey_0='?' (Size = 255)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [a].[Key], [a].[CreatedAt], [a].[Description], [a].[ExpiresAt], [a].[IsActive], [a].[LastUsedAt]
FROM [ApiKeys] AS [a]
WHERE [a].[Key] = @__providedApiKey_0 AND [a].[IsActive] = CAST(1 AS bit)
2025-02-02 01:45:56.770 +03:00 [INF] Executed DbCommand (4ms) [Parameters=[@__request_NationalId_0='?' (Size = 450)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [u].[national_id], [u].[last_updated], [u].[notifications]
FROM [user_notifications] AS [u]
WHERE [u].[national_id] = @__request_NationalId_0
2025-02-02 01:45:56.777 +03:00 [INF] Executed DbCommand (2ms) [Parameters=[@__Parse_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [n].[Id], [n].[additional_data], [n].[Body], [n].[body_ar], [n].[body_en], [n].[created_at], [n].[expiry_at], [n].[Route], [n].[target_criteria], [n].[Title], [n].[title_ar], [n].[title_en]
FROM [notification_templates] AS [n]
WHERE [n].[Id] = @__Parse_0
2025-02-02 01:45:56.786 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@__Parse_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [n].[Id], [n].[additional_data], [n].[Body], [n].[body_ar], [n].[body_en], [n].[created_at], [n].[expiry_at], [n].[Route], [n].[target_criteria], [n].[Title], [n].[title_ar], [n].[title_en]
FROM [notification_templates] AS [n]
WHERE [n].[Id] = @__Parse_0
2025-02-02 01:45:56.873 +03:00 [INF] Executed DbCommand (80ms) [Parameters=[@p0='?' (Size = 4000), @p1='?' (DbType = DateTime2), @p2='?' (Size = 4000), @p3='?' (Size = 4000), @p4='?' (Size = 4000), @p5='?' (Size = 450), @p6='?' (Size = 4000), @p7='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SET IMPLICIT_TRANSACTIONS OFF;
SET NOCOUNT ON;
INSERT INTO [AuthLogs] ([AuthType], [CreatedAt], [DeviceId], [FailureReason], [IpAddress], [NationalId], [Status], [UserAgent])
OUTPUT INSERTED.[Id]
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7);
2025-02-02 01:45:56.881 +03:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType9`2[[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Object, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-02-02 01:45:56.883 +03:00 [INF] Executed action NayifatAPI.Controllers.NotificationsController.GetNotifications (NayifatAPI) in 131.9392ms
2025-02-02 01:45:56.887 +03:00 [INF] Executed endpoint 'NayifatAPI.Controllers.NotificationsController.GetNotifications (NayifatAPI)'
2025-02-02 01:45:56.888 +03:00 [INF] Request finished HTTP/1.1 POST http://957c-51-252-155-185.ngrok-free.app/api/notifications/list - 200 null application/json; charset=utf-8 153.7654ms
2025-02-02 01:45:58.437 +03:00 [INF] Request starting HTTP/1.1 POST http://957c-51-252-155-185.ngrok-free.app/api/notifications/list - application/json; charset=utf-8 47
2025-02-02 01:45:58.441 +03:00 [INF] Executing endpoint 'NayifatAPI.Controllers.NotificationsController.GetNotifications (NayifatAPI)'
2025-02-02 01:45:58.443 +03:00 [INF] Route matched with {action = "GetNotifications", controller = "Notifications"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetNotifications(NayifatAPI.Controllers.GetNotificationsRequest) on controller NayifatAPI.Controllers.NotificationsController (NayifatAPI).
2025-02-02 01:45:58.452 +03:00 [INF] Executed DbCommand (6ms) [Parameters=[@__providedApiKey_0='?' (Size = 255)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [a].[Key], [a].[CreatedAt], [a].[Description], [a].[ExpiresAt], [a].[IsActive], [a].[LastUsedAt]
FROM [ApiKeys] AS [a]
WHERE [a].[Key] = @__providedApiKey_0 AND [a].[IsActive] = CAST(1 AS bit)
2025-02-02 01:45:58.462 +03:00 [INF] Executed DbCommand (5ms) [Parameters=[@__request_NationalId_0='?' (Size = 450)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [u].[national_id], [u].[last_updated], [u].[notifications]
FROM [user_notifications] AS [u]
WHERE [u].[national_id] = @__request_NationalId_0
2025-02-02 01:45:58.473 +03:00 [INF] Executed DbCommand (4ms) [Parameters=[@__Parse_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [n].[Id], [n].[additional_data], [n].[Body], [n].[body_ar], [n].[body_en], [n].[created_at], [n].[expiry_at], [n].[Route], [n].[target_criteria], [n].[Title], [n].[title_ar], [n].[title_en]
FROM [notification_templates] AS [n]
WHERE [n].[Id] = @__Parse_0
2025-02-02 01:45:58.483 +03:00 [INF] Executed DbCommand (4ms) [Parameters=[@__Parse_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [n].[Id], [n].[additional_data], [n].[Body], [n].[body_ar], [n].[body_en], [n].[created_at], [n].[expiry_at], [n].[Route], [n].[target_criteria], [n].[Title], [n].[title_ar], [n].[title_en]
FROM [notification_templates] AS [n]
WHERE [n].[Id] = @__Parse_0
2025-02-02 01:45:58.497 +03:00 [INF] Executed DbCommand (10ms) [Parameters=[@p0='?' (Size = 4000), @p1='?' (DbType = DateTime2), @p2='?' (Size = 4000), @p3='?' (Size = 4000), @p4='?' (Size = 4000), @p5='?' (Size = 450), @p6='?' (Size = 4000), @p7='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SET IMPLICIT_TRANSACTIONS OFF;
SET NOCOUNT ON;
INSERT INTO [AuthLogs] ([AuthType], [CreatedAt], [DeviceId], [FailureReason], [IpAddress], [NationalId], [Status], [UserAgent])
OUTPUT INSERTED.[Id]
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7);
2025-02-02 01:45:58.500 +03:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType9`2[[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Object, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-02-02 01:45:58.503 +03:00 [INF] Executed action NayifatAPI.Controllers.NotificationsController.GetNotifications (NayifatAPI) in 58.3624ms
2025-02-02 01:45:58.506 +03:00 [INF] Executed endpoint 'NayifatAPI.Controllers.NotificationsController.GetNotifications (NayifatAPI)'
2025-02-02 01:45:58.509 +03:00 [INF] Request finished HTTP/1.1 POST http://957c-51-252-155-185.ngrok-free.app/api/notifications/list - 200 null application/json; charset=utf-8 72.0031ms
2025-02-02 01:46:07.274 +03:00 [INF] Request starting HTTP/1.1 POST http://957c-51-252-155-185.ngrok-free.app/api/auth/signin - application/json; charset=utf-8 224
2025-02-02 01:46:07.827 +03:00 [INF] Executing endpoint 'NayifatAPI.Controllers.AuthController.SignIn (NayifatAPI)'
2025-02-02 01:46:07.832 +03:00 [INF] Route matched with {action = "SignIn", controller = "Auth"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] SignIn(NayifatAPI.Controllers.SignInRequest) on controller NayifatAPI.Controllers.AuthController (NayifatAPI).
2025-02-02 01:46:07.893 +03:00 [INF] Executed DbCommand (53ms) [Parameters=[@__providedApiKey_0='?' (Size = 255)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [a].[Key], [a].[CreatedAt], [a].[Description], [a].[ExpiresAt], [a].[IsActive], [a].[LastUsedAt]
FROM [ApiKeys] AS [a]
WHERE [a].[Key] = @__providedApiKey_0 AND [a].[IsActive] = CAST(1 AS bit)
2025-02-02 01:46:08.053 +03:00 [INF] Executed DbCommand (152ms) [Parameters=[@__request_NationalId_0='?' (Size = 450)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [c].[NationalId], [c].[AddNo], [c].[BuildingNo], [c].[City], [c].[Consent], [c].[ConsentDate], [c].[DateOfBirth], [c].[Dependents], [c].[District], [c].[Email], [c].[Employer], [c].[FamilyNameAr], [c].[FamilyNameEn], [c].[FirstNameAr], [c].[FirstNameEn], [c].[Iban], [c].[IdExpiryDate], [c].[Los], [c].[Mpin], [c].[MpinEnabled], [c].[NafathStatus], [c].[NafathTimestamp], [c].[Password], [c].[Phone], [c].[RegistrationDate], [c].[SalaryCustomer], [c].[SalaryDakhli], [c].[SecondNameAr], [c].[SecondNameEn], [c].[Sector], [c].[Street], [c].[ThirdNameAr], [c].[ThirdNameEn], [c].[Zipcode]
FROM [Customers] AS [c]
WHERE [c].[NationalId] = @__request_NationalId_0
2025-02-02 01:46:08.354 +03:00 [INF] Starting password verification for NationalId: 1064448614
2025-02-02 01:46:09.043 +03:00 [INF] Password verification result for NationalId 1064448614: Success
2025-02-02 01:46:09.050 +03:00 [INF] Executed DbCommand (4ms) [Parameters=[@__request_NationalId_0='?' (Size = 450), @__request_DeviceId_1='?' (Size = 450)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [c].[Id], [c].[BiometricEnabled], [c].[BiometricToken], [c].[CreatedAt], [c].[DeviceId], [c].[LastUsedAt], [c].[Manufacturer], [c].[Model], [c].[NationalId], [c].[OsVersion], [c].[Platform], [c].[Status]
FROM [Customer_Devices] AS [c]
WHERE [c].[NationalId] = @__request_NationalId_0 AND [c].[DeviceId] = @__request_DeviceId_1 AND [c].[Status] = N'active'
2025-02-02 01:46:09.132 +03:00 [INF] Executed DbCommand (78ms) [Parameters=[@p0='?' (Size = 4000), @p1='?' (DbType = DateTime2), @p2='?' (Size = 4000), @p3='?' (Size = 4000), @p4='?' (Size = 4000), @p5='?' (Size = 450), @p6='?' (Size = 4000), @p7='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SET IMPLICIT_TRANSACTIONS OFF;
SET NOCOUNT ON;
INSERT INTO [AuthLogs] ([AuthType], [CreatedAt], [DeviceId], [FailureReason], [IpAddress], [NationalId], [Status], [UserAgent])
OUTPUT INSERTED.[Id]
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7);
2025-02-02 01:46:09.137 +03:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType9`2[[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Object, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-02-02 01:46:09.138 +03:00 [INF] Executed action NayifatAPI.Controllers.AuthController.SignIn (NayifatAPI) in 1300.1235ms
2025-02-02 01:46:09.140 +03:00 [INF] Executed endpoint 'NayifatAPI.Controllers.AuthController.SignIn (NayifatAPI)'
2025-02-02 01:46:09.142 +03:00 [INF] Request finished HTTP/1.1 POST http://957c-51-252-155-185.ngrok-free.app/api/auth/signin - 200 null application/json; charset=utf-8 1867.8964ms
2025-02-02 01:46:10.022 +03:00 [INF] Request starting HTTP/1.1 POST http://957c-51-252-155-185.ngrok-free.app/api/proxy/forward?url=https://icreditdept.com/api/testasp/test_local_generate_otp.php - application/json; charset=utf-8 84
2025-02-02 01:46:10.026 +03:00 [INF] Executing endpoint 'NayifatAPI.Controllers.ProxyController.ForwardRequest (NayifatAPI)'
2025-02-02 01:46:10.027 +03:00 [INF] Route matched with {action = "ForwardRequest", controller = "Proxy"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] ForwardRequest() on controller NayifatAPI.Controllers.ProxyController (NayifatAPI).
2025-02-02 01:46:10.030 +03:00 [INF] Start processing HTTP request POST https://icreditdept.com/api/testasp/test_local_generate_otp.php
2025-02-02 01:46:10.033 +03:00 [INF] Sending HTTP request POST https://icreditdept.com/api/testasp/test_local_generate_otp.php
2025-02-02 01:46:10.681 +03:00 [INF] Received HTTP response headers after 647.2863ms - 200
2025-02-02 01:46:10.683 +03:00 [INF] End processing HTTP request after 652.6097ms - 200
2025-02-02 01:46:10.686 +03:00 [INF] Raw response length: 200
2025-02-02 01:46:10.687 +03:00 [INF] Response content: {"success":true,"errors":[],"result":{"nationalId":"1064448614","otp":553863,"expiryDate":"2025-02-02 01:51:10","successMsg":"Success","errCode":0,"errMsg":null},"type":"N","message":null,"code":null}
2025-02-02 01:46:10.688 +03:00 [INF] Executing ContentResult with HTTP Response ContentType of application/json
2025-02-02 01:46:10.690 +03:00 [INF] Executed action NayifatAPI.Controllers.ProxyController.ForwardRequest (NayifatAPI) in 660.8566ms
2025-02-02 01:46:10.693 +03:00 [INF] Executed endpoint 'NayifatAPI.Controllers.ProxyController.ForwardRequest (NayifatAPI)'
2025-02-02 01:46:10.695 +03:00 [INF] Request finished HTTP/1.1 POST http://957c-51-252-155-185.ngrok-free.app/api/proxy/forward?url=https://icreditdept.com/api/testasp/test_local_generate_otp.php - 200 200 application/json 673.0386ms
2025-02-02 01:46:53.132 +03:00 [INF] Request starting HTTP/1.1 POST http://957c-51-252-155-185.ngrok-free.app/api/auth/otp/verify - application/json; charset=utf-8 48
2025-02-02 01:46:53.394 +03:00 [INF] Executing endpoint 'NayifatAPI.Controllers.AuthController.VerifyOtp (NayifatAPI)'
2025-02-02 01:46:53.398 +03:00 [INF] Route matched with {action = "VerifyOtp", controller = "Auth"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] VerifyOtp(NayifatAPI.Controllers.OtpVerifyRequest) on controller NayifatAPI.Controllers.AuthController (NayifatAPI).
2025-02-02 01:46:53.404 +03:00 [INF] Executing BadRequestObjectResult, writing value of type 'Microsoft.AspNetCore.Mvc.ValidationProblemDetails'.
2025-02-02 01:46:53.405 +03:00 [INF] Executed action NayifatAPI.Controllers.AuthController.VerifyOtp (NayifatAPI) in 4.8476ms
2025-02-02 01:46:53.656 +03:00 [INF] Executed endpoint 'NayifatAPI.Controllers.AuthController.VerifyOtp (NayifatAPI)'
2025-02-02 01:46:53.658 +03:00 [INF] Request finished HTTP/1.1 POST http://957c-51-252-155-185.ngrok-free.app/api/auth/otp/verify - 400 null application/problem+json; charset=utf-8 525.7536ms
2025-02-02 01:49:38.164 +03:00 [INF] Request starting HTTP/1.1 POST http://957c-51-252-155-185.ngrok-free.app/api/auth/signin - application/json; charset=utf-8 224
2025-02-02 01:49:38.166 +03:00 [INF] Executing endpoint 'NayifatAPI.Controllers.AuthController.SignIn (NayifatAPI)'
2025-02-02 01:49:38.170 +03:00 [INF] Route matched with {action = "SignIn", controller = "Auth"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] SignIn(NayifatAPI.Controllers.SignInRequest) on controller NayifatAPI.Controllers.AuthController (NayifatAPI).
2025-02-02 01:49:38.182 +03:00 [INF] Executed DbCommand (7ms) [Parameters=[@__providedApiKey_0='?' (Size = 255)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [a].[Key], [a].[CreatedAt], [a].[Description], [a].[ExpiresAt], [a].[IsActive], [a].[LastUsedAt]
FROM [ApiKeys] AS [a]
WHERE [a].[Key] = @__providedApiKey_0 AND [a].[IsActive] = CAST(1 AS bit)
2025-02-02 01:49:38.193 +03:00 [INF] Executed DbCommand (7ms) [Parameters=[@__request_NationalId_0='?' (Size = 450)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [c].[NationalId], [c].[AddNo], [c].[BuildingNo], [c].[City], [c].[Consent], [c].[ConsentDate], [c].[DateOfBirth], [c].[Dependents], [c].[District], [c].[Email], [c].[Employer], [c].[FamilyNameAr], [c].[FamilyNameEn], [c].[FirstNameAr], [c].[FirstNameEn], [c].[Iban], [c].[IdExpiryDate], [c].[Los], [c].[Mpin], [c].[MpinEnabled], [c].[NafathStatus], [c].[NafathTimestamp], [c].[Password], [c].[Phone], [c].[RegistrationDate], [c].[SalaryCustomer], [c].[SalaryDakhli], [c].[SecondNameAr], [c].[SecondNameEn], [c].[Sector], [c].[Street], [c].[ThirdNameAr], [c].[ThirdNameEn], [c].[Zipcode]
FROM [Customers] AS [c]
WHERE [c].[NationalId] = @__request_NationalId_0
2025-02-02 01:49:38.198 +03:00 [INF] Starting password verification for NationalId: 1064448614
2025-02-02 01:49:38.391 +03:00 [INF] Password verification result for NationalId 1064448614: Success
2025-02-02 01:49:38.399 +03:00 [INF] Executed DbCommand (5ms) [Parameters=[@__request_NationalId_0='?' (Size = 450), @__request_DeviceId_1='?' (Size = 450)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [c].[Id], [c].[BiometricEnabled], [c].[BiometricToken], [c].[CreatedAt], [c].[DeviceId], [c].[LastUsedAt], [c].[Manufacturer], [c].[Model], [c].[NationalId], [c].[OsVersion], [c].[Platform], [c].[Status]
FROM [Customer_Devices] AS [c]
WHERE [c].[NationalId] = @__request_NationalId_0 AND [c].[DeviceId] = @__request_DeviceId_1 AND [c].[Status] = N'active'
2025-02-02 01:49:38.483 +03:00 [INF] Executed DbCommand (78ms) [Parameters=[@p0='?' (Size = 4000), @p1='?' (DbType = DateTime2), @p2='?' (Size = 4000), @p3='?' (Size = 4000), @p4='?' (Size = 4000), @p5='?' (Size = 450), @p6='?' (Size = 4000), @p7='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SET IMPLICIT_TRANSACTIONS OFF;
SET NOCOUNT ON;
INSERT INTO [AuthLogs] ([AuthType], [CreatedAt], [DeviceId], [FailureReason], [IpAddress], [NationalId], [Status], [UserAgent])
OUTPUT INSERTED.[Id]
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7);
2025-02-02 01:49:38.490 +03:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType9`2[[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Object, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-02-02 01:49:38.494 +03:00 [INF] Executed action NayifatAPI.Controllers.AuthController.SignIn (NayifatAPI) in 320.1613ms
2025-02-02 01:49:38.496 +03:00 [INF] Executed endpoint 'NayifatAPI.Controllers.AuthController.SignIn (NayifatAPI)'
2025-02-02 01:49:38.498 +03:00 [INF] Request finished HTTP/1.1 POST http://957c-51-252-155-185.ngrok-free.app/api/auth/signin - 200 null application/json; charset=utf-8 334.3399ms
2025-02-02 01:49:39.066 +03:00 [INF] Request starting HTTP/1.1 POST http://957c-51-252-155-185.ngrok-free.app/api/auth/signin - application/json; charset=utf-8 49
2025-02-02 01:49:39.072 +03:00 [INF] Executing endpoint 'NayifatAPI.Controllers.AuthController.SignIn (NayifatAPI)'
2025-02-02 01:49:39.073 +03:00 [INF] Route matched with {action = "SignIn", controller = "Auth"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] SignIn(NayifatAPI.Controllers.SignInRequest) on controller NayifatAPI.Controllers.AuthController (NayifatAPI).
2025-02-02 01:49:39.076 +03:00 [INF] Executing BadRequestObjectResult, writing value of type 'Microsoft.AspNetCore.Mvc.ValidationProblemDetails'.
2025-02-02 01:49:39.078 +03:00 [INF] Executed action NayifatAPI.Controllers.AuthController.SignIn (NayifatAPI) in 2.5259ms
2025-02-02 01:49:39.081 +03:00 [INF] Executed endpoint 'NayifatAPI.Controllers.AuthController.SignIn (NayifatAPI)'
2025-02-02 01:49:39.084 +03:00 [INF] Request finished HTTP/1.1 POST http://957c-51-252-155-185.ngrok-free.app/api/auth/signin - 400 null application/problem+json; charset=utf-8 17.1905ms
2025-02-02 01:49:52.526 +03:00 [INF] Request starting HTTP/1.1 POST http://957c-51-252-155-185.ngrok-free.app/api/notifications/list - application/json; charset=utf-8 47
2025-02-02 01:49:52.528 +03:00 [INF] Executing endpoint 'NayifatAPI.Controllers.NotificationsController.GetNotifications (NayifatAPI)'
2025-02-02 01:49:52.529 +03:00 [INF] Route matched with {action = "GetNotifications", controller = "Notifications"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetNotifications(NayifatAPI.Controllers.GetNotificationsRequest) on controller NayifatAPI.Controllers.NotificationsController (NayifatAPI).
2025-02-02 01:49:52.535 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@__providedApiKey_0='?' (Size = 255)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [a].[Key], [a].[CreatedAt], [a].[Description], [a].[ExpiresAt], [a].[IsActive], [a].[LastUsedAt]
FROM [ApiKeys] AS [a]
WHERE [a].[Key] = @__providedApiKey_0 AND [a].[IsActive] = CAST(1 AS bit)
2025-02-02 01:49:52.541 +03:00 [INF] Executed DbCommand (4ms) [Parameters=[@__request_NationalId_0='?' (Size = 450)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [u].[national_id], [u].[last_updated], [u].[notifications]
FROM [user_notifications] AS [u]
WHERE [u].[national_id] = @__request_NationalId_0
2025-02-02 01:49:52.547 +03:00 [INF] Executed DbCommand (2ms) [Parameters=[@__Parse_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [n].[Id], [n].[additional_data], [n].[Body], [n].[body_ar], [n].[body_en], [n].[created_at], [n].[expiry_at], [n].[Route], [n].[target_criteria], [n].[Title], [n].[title_ar], [n].[title_en]
FROM [notification_templates] AS [n]
WHERE [n].[Id] = @__Parse_0
2025-02-02 01:49:52.554 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@__Parse_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [n].[Id], [n].[additional_data], [n].[Body], [n].[body_ar], [n].[body_en], [n].[created_at], [n].[expiry_at], [n].[Route], [n].[target_criteria], [n].[Title], [n].[title_ar], [n].[title_en]
FROM [notification_templates] AS [n]
WHERE [n].[Id] = @__Parse_0
2025-02-02 01:49:52.635 +03:00 [INF] Executed DbCommand (74ms) [Parameters=[@p0='?' (Size = 4000), @p1='?' (DbType = DateTime2), @p2='?' (Size = 4000), @p3='?' (Size = 4000), @p4='?' (Size = 4000), @p5='?' (Size = 450), @p6='?' (Size = 4000), @p7='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SET IMPLICIT_TRANSACTIONS OFF;
SET NOCOUNT ON;
INSERT INTO [AuthLogs] ([AuthType], [CreatedAt], [DeviceId], [FailureReason], [IpAddress], [NationalId], [Status], [UserAgent])
OUTPUT INSERTED.[Id]
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7);
2025-02-02 01:49:52.644 +03:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType9`2[[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Object, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-02-02 01:49:52.648 +03:00 [INF] Executed action NayifatAPI.Controllers.NotificationsController.GetNotifications (NayifatAPI) in 114.3366ms
2025-02-02 01:49:52.651 +03:00 [INF] Executed endpoint 'NayifatAPI.Controllers.NotificationsController.GetNotifications (NayifatAPI)'
2025-02-02 01:49:52.655 +03:00 [INF] Request finished HTTP/1.1 POST http://957c-51-252-155-185.ngrok-free.app/api/notifications/list - 200 null application/json; charset=utf-8 128.7178ms
2025-02-02 01:50:58.558 +03:00 [INF] Request starting HTTP/1.1 POST http://957c-51-252-155-185.ngrok-free.app/api/notifications/list - application/json; charset=utf-8 47
2025-02-02 01:50:58.562 +03:00 [INF] Executing endpoint 'NayifatAPI.Controllers.NotificationsController.GetNotifications (NayifatAPI)'
2025-02-02 01:50:58.565 +03:00 [INF] Route matched with {action = "GetNotifications", controller = "Notifications"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetNotifications(NayifatAPI.Controllers.GetNotificationsRequest) on controller NayifatAPI.Controllers.NotificationsController (NayifatAPI).
2025-02-02 01:50:58.577 +03:00 [INF] Executed DbCommand (5ms) [Parameters=[@__providedApiKey_0='?' (Size = 255)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [a].[Key], [a].[CreatedAt], [a].[Description], [a].[ExpiresAt], [a].[IsActive], [a].[LastUsedAt]
FROM [ApiKeys] AS [a]
WHERE [a].[Key] = @__providedApiKey_0 AND [a].[IsActive] = CAST(1 AS bit)
2025-02-02 01:50:58.587 +03:00 [INF] Executed DbCommand (3ms) [Parameters=[@__request_NationalId_0='?' (Size = 450)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [u].[national_id], [u].[last_updated], [u].[notifications]
FROM [user_notifications] AS [u]
WHERE [u].[national_id] = @__request_NationalId_0
2025-02-02 01:50:58.600 +03:00 [INF] Executed DbCommand (4ms) [Parameters=[@__Parse_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [n].[Id], [n].[additional_data], [n].[Body], [n].[body_ar], [n].[body_en], [n].[created_at], [n].[expiry_at], [n].[Route], [n].[target_criteria], [n].[Title], [n].[title_ar], [n].[title_en]
FROM [notification_templates] AS [n]
WHERE [n].[Id] = @__Parse_0
2025-02-02 01:50:58.604 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@__Parse_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [n].[Id], [n].[additional_data], [n].[Body], [n].[body_ar], [n].[body_en], [n].[created_at], [n].[expiry_at], [n].[Route], [n].[target_criteria], [n].[Title], [n].[title_ar], [n].[title_en]
FROM [notification_templates] AS [n]
WHERE [n].[Id] = @__Parse_0
2025-02-02 01:50:58.620 +03:00 [INF] Executed DbCommand (12ms) [Parameters=[@p0='?' (Size = 4000), @p1='?' (DbType = DateTime2), @p2='?' (Size = 4000), @p3='?' (Size = 4000), @p4='?' (Size = 4000), @p5='?' (Size = 450), @p6='?' (Size = 4000), @p7='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SET IMPLICIT_TRANSACTIONS OFF;
SET NOCOUNT ON;
INSERT INTO [AuthLogs] ([AuthType], [CreatedAt], [DeviceId], [FailureReason], [IpAddress], [NationalId], [Status], [UserAgent])
OUTPUT INSERTED.[Id]
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7);
2025-02-02 01:50:58.625 +03:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType9`2[[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Object, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-02-02 01:50:58.631 +03:00 [INF] Executed action NayifatAPI.Controllers.NotificationsController.GetNotifications (NayifatAPI) in 59.9429ms
2025-02-02 01:50:58.633 +03:00 [INF] Executed endpoint 'NayifatAPI.Controllers.NotificationsController.GetNotifications (NayifatAPI)'
2025-02-02 01:50:58.637 +03:00 [INF] Request finished HTTP/1.1 POST http://957c-51-252-155-185.ngrok-free.app/api/notifications/list - 200 null application/json; charset=utf-8 79.19ms
2025-02-02 01:50:59.319 +03:00 [INF] Request starting HTTP/1.1 POST http://957c-51-252-155-185.ngrok-free.app/api/notifications/list - application/json; charset=utf-8 47
2025-02-02 01:50:59.323 +03:00 [INF] Executing endpoint 'NayifatAPI.Controllers.NotificationsController.GetNotifications (NayifatAPI)'
2025-02-02 01:50:59.324 +03:00 [INF] Route matched with {action = "GetNotifications", controller = "Notifications"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetNotifications(NayifatAPI.Controllers.GetNotificationsRequest) on controller NayifatAPI.Controllers.NotificationsController (NayifatAPI).
2025-02-02 01:50:59.329 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@__providedApiKey_0='?' (Size = 255)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [a].[Key], [a].[CreatedAt], [a].[Description], [a].[ExpiresAt], [a].[IsActive], [a].[LastUsedAt]
FROM [ApiKeys] AS [a]
WHERE [a].[Key] = @__providedApiKey_0 AND [a].[IsActive] = CAST(1 AS bit)
2025-02-02 01:50:59.333 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@__request_NationalId_0='?' (Size = 450)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [u].[national_id], [u].[last_updated], [u].[notifications]
FROM [user_notifications] AS [u]
WHERE [u].[national_id] = @__request_NationalId_0
2025-02-02 01:50:59.339 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@__Parse_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [n].[Id], [n].[additional_data], [n].[Body], [n].[body_ar], [n].[body_en], [n].[created_at], [n].[expiry_at], [n].[Route], [n].[target_criteria], [n].[Title], [n].[title_ar], [n].[title_en]
FROM [notification_templates] AS [n]
WHERE [n].[Id] = @__Parse_0
2025-02-02 01:50:59.347 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@__Parse_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [n].[Id], [n].[additional_data], [n].[Body], [n].[body_ar], [n].[body_en], [n].[created_at], [n].[expiry_at], [n].[Route], [n].[target_criteria], [n].[Title], [n].[title_ar], [n].[title_en]
FROM [notification_templates] AS [n]
WHERE [n].[Id] = @__Parse_0
2025-02-02 01:50:59.356 +03:00 [INF] Executed DbCommand (6ms) [Parameters=[@p0='?' (Size = 4000), @p1='?' (DbType = DateTime2), @p2='?' (Size = 4000), @p3='?' (Size = 4000), @p4='?' (Size = 4000), @p5='?' (Size = 450), @p6='?' (Size = 4000), @p7='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SET IMPLICIT_TRANSACTIONS OFF;
SET NOCOUNT ON;
INSERT INTO [AuthLogs] ([AuthType], [CreatedAt], [DeviceId], [FailureReason], [IpAddress], [NationalId], [Status], [UserAgent])
OUTPUT INSERTED.[Id]
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7);
2025-02-02 01:50:59.362 +03:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType9`2[[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Object, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-02-02 01:50:59.364 +03:00 [INF] Executed action NayifatAPI.Controllers.NotificationsController.GetNotifications (NayifatAPI) in 36.4478ms
2025-02-02 01:50:59.366 +03:00 [INF] Executed endpoint 'NayifatAPI.Controllers.NotificationsController.GetNotifications (NayifatAPI)'
2025-02-02 01:50:59.367 +03:00 [INF] Request finished HTTP/1.1 POST http://957c-51-252-155-185.ngrok-free.app/api/notifications/list - 200 null application/json; charset=utf-8 48.4732ms
2025-02-02 01:52:54.648 +03:00 [INF] Request starting HTTP/1.1 POST http://957c-51-252-155-185.ngrok-free.app/api/auth/signin - application/json; charset=utf-8 224
2025-02-02 01:52:55.135 +03:00 [INF] Executing endpoint 'NayifatAPI.Controllers.AuthController.SignIn (NayifatAPI)'
2025-02-02 01:52:55.137 +03:00 [INF] Route matched with {action = "SignIn", controller = "Auth"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] SignIn(NayifatAPI.Controllers.SignInRequest) on controller NayifatAPI.Controllers.AuthController (NayifatAPI).
2025-02-02 01:52:55.149 +03:00 [INF] Executed DbCommand (10ms) [Parameters=[@__providedApiKey_0='?' (Size = 255)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [a].[Key], [a].[CreatedAt], [a].[Description], [a].[ExpiresAt], [a].[IsActive], [a].[LastUsedAt]
FROM [ApiKeys] AS [a]
WHERE [a].[Key] = @__providedApiKey_0 AND [a].[IsActive] = CAST(1 AS bit)
2025-02-02 01:52:55.311 +03:00 [INF] Executed DbCommand (160ms) [Parameters=[@__request_NationalId_0='?' (Size = 450)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [c].[NationalId], [c].[AddNo], [c].[BuildingNo], [c].[City], [c].[Consent], [c].[ConsentDate], [c].[DateOfBirth], [c].[Dependents], [c].[District], [c].[Email], [c].[Employer], [c].[FamilyNameAr], [c].[FamilyNameEn], [c].[FirstNameAr], [c].[FirstNameEn], [c].[Iban], [c].[IdExpiryDate], [c].[Los], [c].[Mpin], [c].[MpinEnabled], [c].[NafathStatus], [c].[NafathTimestamp], [c].[Password], [c].[Phone], [c].[RegistrationDate], [c].[SalaryCustomer], [c].[SalaryDakhli], [c].[SecondNameAr], [c].[SecondNameEn], [c].[Sector], [c].[Street], [c].[ThirdNameAr], [c].[ThirdNameEn], [c].[Zipcode]
FROM [Customers] AS [c]
WHERE [c].[NationalId] = @__request_NationalId_0
2025-02-02 01:52:55.421 +03:00 [INF] Starting password verification for NationalId: 1064448614
2025-02-02 01:52:55.624 +03:00 [INF] Password verification result for NationalId 1064448614: Success
2025-02-02 01:52:55.633 +03:00 [INF] Executed DbCommand (5ms) [Parameters=[@__request_NationalId_0='?' (Size = 450), @__request_DeviceId_1='?' (Size = 450)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [c].[Id], [c].[BiometricEnabled], [c].[BiometricToken], [c].[CreatedAt], [c].[DeviceId], [c].[LastUsedAt], [c].[Manufacturer], [c].[Model], [c].[NationalId], [c].[OsVersion], [c].[Platform], [c].[Status]
FROM [Customer_Devices] AS [c]
WHERE [c].[NationalId] = @__request_NationalId_0 AND [c].[DeviceId] = @__request_DeviceId_1 AND [c].[Status] = N'active'
2025-02-02 01:52:55.649 +03:00 [INF] Executed DbCommand (11ms) [Parameters=[@p0='?' (Size = 4000), @p1='?' (DbType = DateTime2), @p2='?' (Size = 4000), @p3='?' (Size = 4000), @p4='?' (Size = 4000), @p5='?' (Size = 450), @p6='?' (Size = 4000), @p7='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SET IMPLICIT_TRANSACTIONS OFF;
SET NOCOUNT ON;
INSERT INTO [AuthLogs] ([AuthType], [CreatedAt], [DeviceId], [FailureReason], [IpAddress], [NationalId], [Status], [UserAgent])
OUTPUT INSERTED.[Id]
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7);
2025-02-02 01:52:55.651 +03:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType9`2[[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Object, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-02-02 01:52:55.654 +03:00 [INF] Executed action NayifatAPI.Controllers.AuthController.SignIn (NayifatAPI) in 514.9902ms
2025-02-02 01:52:55.658 +03:00 [INF] Executed endpoint 'NayifatAPI.Controllers.AuthController.SignIn (NayifatAPI)'
2025-02-02 01:52:55.660 +03:00 [INF] Request finished HTTP/1.1 POST http://957c-51-252-155-185.ngrok-free.app/api/auth/signin - 200 null application/json; charset=utf-8 1012.4363ms
2025-02-02 01:52:56.510 +03:00 [INF] Request starting HTTP/1.1 POST http://957c-51-252-155-185.ngrok-free.app/api/auth/signin - application/json; charset=utf-8 49
2025-02-02 01:52:56.514 +03:00 [INF] Executing endpoint 'NayifatAPI.Controllers.AuthController.SignIn (NayifatAPI)'
2025-02-02 01:52:56.516 +03:00 [INF] Route matched with {action = "SignIn", controller = "Auth"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] SignIn(NayifatAPI.Controllers.SignInRequest) on controller NayifatAPI.Controllers.AuthController (NayifatAPI).
2025-02-02 01:52:56.519 +03:00 [INF] Executing BadRequestObjectResult, writing value of type 'Microsoft.AspNetCore.Mvc.ValidationProblemDetails'.
2025-02-02 01:52:56.521 +03:00 [INF] Executed action NayifatAPI.Controllers.AuthController.SignIn (NayifatAPI) in 3.0374ms
2025-02-02 01:52:56.523 +03:00 [INF] Executed endpoint 'NayifatAPI.Controllers.AuthController.SignIn (NayifatAPI)'
2025-02-02 01:52:56.524 +03:00 [INF] Request finished HTTP/1.1 POST http://957c-51-252-155-185.ngrok-free.app/api/auth/signin - 400 null application/problem+json; charset=utf-8 14.358ms
2025-02-02 01:54:52.742 +03:00 [INF] Request starting HTTP/1.1 POST http://957c-51-252-155-185.ngrok-free.app/api/notifications/list - application/json; charset=utf-8 47
2025-02-02 01:54:52.747 +03:00 [INF] Executing endpoint 'NayifatAPI.Controllers.NotificationsController.GetNotifications (NayifatAPI)'
2025-02-02 01:54:52.748 +03:00 [INF] Route matched with {action = "GetNotifications", controller = "Notifications"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetNotifications(NayifatAPI.Controllers.GetNotificationsRequest) on controller NayifatAPI.Controllers.NotificationsController (NayifatAPI).
2025-02-02 01:54:52.758 +03:00 [INF] Executed DbCommand (5ms) [Parameters=[@__providedApiKey_0='?' (Size = 255)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [a].[Key], [a].[CreatedAt], [a].[Description], [a].[ExpiresAt], [a].[IsActive], [a].[LastUsedAt]
FROM [ApiKeys] AS [a]
WHERE [a].[Key] = @__providedApiKey_0 AND [a].[IsActive] = CAST(1 AS bit)
2025-02-02 01:54:52.765 +03:00 [INF] Executed DbCommand (3ms) [Parameters=[@__request_NationalId_0='?' (Size = 450)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [u].[national_id], [u].[last_updated], [u].[notifications]
FROM [user_notifications] AS [u]
WHERE [u].[national_id] = @__request_NationalId_0
2025-02-02 01:54:52.773 +03:00 [INF] Executed DbCommand (3ms) [Parameters=[@__Parse_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [n].[Id], [n].[additional_data], [n].[Body], [n].[body_ar], [n].[body_en], [n].[created_at], [n].[expiry_at], [n].[Route], [n].[target_criteria], [n].[Title], [n].[title_ar], [n].[title_en]
FROM [notification_templates] AS [n]
WHERE [n].[Id] = @__Parse_0
2025-02-02 01:54:52.779 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@__Parse_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [n].[Id], [n].[additional_data], [n].[Body], [n].[body_ar], [n].[body_en], [n].[created_at], [n].[expiry_at], [n].[Route], [n].[target_criteria], [n].[Title], [n].[title_ar], [n].[title_en]
FROM [notification_templates] AS [n]
WHERE [n].[Id] = @__Parse_0
2025-02-02 01:54:52.797 +03:00 [INF] Executed DbCommand (11ms) [Parameters=[@p0='?' (Size = 4000), @p1='?' (DbType = DateTime2), @p2='?' (Size = 4000), @p3='?' (Size = 4000), @p4='?' (Size = 4000), @p5='?' (Size = 450), @p6='?' (Size = 4000), @p7='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SET IMPLICIT_TRANSACTIONS OFF;
SET NOCOUNT ON;
INSERT INTO [AuthLogs] ([AuthType], [CreatedAt], [DeviceId], [FailureReason], [IpAddress], [NationalId], [Status], [UserAgent])
OUTPUT INSERTED.[Id]
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7);
2025-02-02 01:54:52.804 +03:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType9`2[[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Object, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-02-02 01:54:52.808 +03:00 [INF] Executed action NayifatAPI.Controllers.NotificationsController.GetNotifications (NayifatAPI) in 57.1459ms
2025-02-02 01:54:52.810 +03:00 [INF] Executed endpoint 'NayifatAPI.Controllers.NotificationsController.GetNotifications (NayifatAPI)'
2025-02-02 01:54:52.814 +03:00 [INF] Request finished HTTP/1.1 POST http://957c-51-252-155-185.ngrok-free.app/api/notifications/list - 200 null application/json; charset=utf-8 72.2064ms
2025-02-02 01:55:18.065 +03:00 [INF] Request starting HTTP/1.1 POST http://957c-51-252-155-185.ngrok-free.app/api/auth/signin - application/json; charset=utf-8 224
2025-02-02 01:55:18.067 +03:00 [INF] Executing endpoint 'NayifatAPI.Controllers.AuthController.SignIn (NayifatAPI)'
2025-02-02 01:55:18.068 +03:00 [INF] Route matched with {action = "SignIn", controller = "Auth"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] SignIn(NayifatAPI.Controllers.SignInRequest) on controller NayifatAPI.Controllers.AuthController (NayifatAPI).
2025-02-02 01:55:18.071 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@__providedApiKey_0='?' (Size = 255)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [a].[Key], [a].[CreatedAt], [a].[Description], [a].[ExpiresAt], [a].[IsActive], [a].[LastUsedAt]
FROM [ApiKeys] AS [a]
WHERE [a].[Key] = @__providedApiKey_0 AND [a].[IsActive] = CAST(1 AS bit)
2025-02-02 01:55:18.078 +03:00 [INF] Executed DbCommand (4ms) [Parameters=[@__request_NationalId_0='?' (Size = 450)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [c].[NationalId], [c].[AddNo], [c].[BuildingNo], [c].[City], [c].[Consent], [c].[ConsentDate], [c].[DateOfBirth], [c].[Dependents], [c].[District], [c].[Email], [c].[Employer], [c].[FamilyNameAr], [c].[FamilyNameEn], [c].[FirstNameAr], [c].[FirstNameEn], [c].[Iban], [c].[IdExpiryDate], [c].[Los], [c].[Mpin], [c].[MpinEnabled], [c].[NafathStatus], [c].[NafathTimestamp], [c].[Password], [c].[Phone], [c].[RegistrationDate], [c].[SalaryCustomer], [c].[SalaryDakhli], [c].[SecondNameAr], [c].[SecondNameEn], [c].[Sector], [c].[Street], [c].[ThirdNameAr], [c].[ThirdNameEn], [c].[Zipcode]
FROM [Customers] AS [c]
WHERE [c].[NationalId] = @__request_NationalId_0
2025-02-02 01:55:18.082 +03:00 [INF] Starting password verification for NationalId: 1064448614
2025-02-02 01:55:18.277 +03:00 [INF] Password verification result for NationalId 1064448614: Success
2025-02-02 01:55:18.285 +03:00 [INF] Executed DbCommand (4ms) [Parameters=[@__request_NationalId_0='?' (Size = 450), @__request_DeviceId_1='?' (Size = 450)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [c].[Id], [c].[BiometricEnabled], [c].[BiometricToken], [c].[CreatedAt], [c].[DeviceId], [c].[LastUsedAt], [c].[Manufacturer], [c].[Model], [c].[NationalId], [c].[OsVersion], [c].[Platform], [c].[Status]
FROM [Customer_Devices] AS [c]
WHERE [c].[NationalId] = @__request_NationalId_0 AND [c].[DeviceId] = @__request_DeviceId_1 AND [c].[Status] = N'active'
2025-02-02 01:55:18.365 +03:00 [INF] Executed DbCommand (74ms) [Parameters=[@p0='?' (Size = 4000), @p1='?' (DbType = DateTime2), @p2='?' (Size = 4000), @p3='?' (Size = 4000), @p4='?' (Size = 4000), @p5='?' (Size = 450), @p6='?' (Size = 4000), @p7='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SET IMPLICIT_TRANSACTIONS OFF;
SET NOCOUNT ON;
INSERT INTO [AuthLogs] ([AuthType], [CreatedAt], [DeviceId], [FailureReason], [IpAddress], [NationalId], [Status], [UserAgent])
OUTPUT INSERTED.[Id]
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7);
2025-02-02 01:55:18.375 +03:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType9`2[[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Object, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-02-02 01:55:18.377 +03:00 [INF] Executed action NayifatAPI.Controllers.AuthController.SignIn (NayifatAPI) in 307.2434ms
2025-02-02 01:55:18.381 +03:00 [INF] Executed endpoint 'NayifatAPI.Controllers.AuthController.SignIn (NayifatAPI)'
2025-02-02 01:55:18.383 +03:00 [INF] Request finished HTTP/1.1 POST http://957c-51-252-155-185.ngrok-free.app/api/auth/signin - 200 null application/json; charset=utf-8 318.0312ms
2025-02-02 01:55:58.614 +03:00 [INF] Request starting HTTP/1.1 POST http://957c-51-252-155-185.ngrok-free.app/api/notifications/list - application/json; charset=utf-8 47
2025-02-02 01:55:58.618 +03:00 [INF] Executing endpoint 'NayifatAPI.Controllers.NotificationsController.GetNotifications (NayifatAPI)'
2025-02-02 01:55:58.621 +03:00 [INF] Route matched with {action = "GetNotifications", controller = "Notifications"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetNotifications(NayifatAPI.Controllers.GetNotificationsRequest) on controller NayifatAPI.Controllers.NotificationsController (NayifatAPI).
2025-02-02 01:55:58.627 +03:00 [INF] Executed DbCommand (2ms) [Parameters=[@__providedApiKey_0='?' (Size = 255)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [a].[Key], [a].[CreatedAt], [a].[Description], [a].[ExpiresAt], [a].[IsActive], [a].[LastUsedAt]
FROM [ApiKeys] AS [a]
WHERE [a].[Key] = @__providedApiKey_0 AND [a].[IsActive] = CAST(1 AS bit)
2025-02-02 01:55:58.638 +03:00 [INF] Executed DbCommand (2ms) [Parameters=[@__request_NationalId_0='?' (Size = 450)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [u].[national_id], [u].[last_updated], [u].[notifications]
FROM [user_notifications] AS [u]
WHERE [u].[national_id] = @__request_NationalId_0
2025-02-02 01:55:58.645 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@__Parse_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [n].[Id], [n].[additional_data], [n].[Body], [n].[body_ar], [n].[body_en], [n].[created_at], [n].[expiry_at], [n].[Route], [n].[target_criteria], [n].[Title], [n].[title_ar], [n].[title_en]
FROM [notification_templates] AS [n]
WHERE [n].[Id] = @__Parse_0
2025-02-02 01:55:58.651 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@__Parse_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [n].[Id], [n].[additional_data], [n].[Body], [n].[body_ar], [n].[body_en], [n].[created_at], [n].[expiry_at], [n].[Route], [n].[target_criteria], [n].[Title], [n].[title_ar], [n].[title_en]
FROM [notification_templates] AS [n]
WHERE [n].[Id] = @__Parse_0
2025-02-02 01:55:58.669 +03:00 [INF] Executed DbCommand (9ms) [Parameters=[@p0='?' (Size = 4000), @p1='?' (DbType = DateTime2), @p2='?' (Size = 4000), @p3='?' (Size = 4000), @p4='?' (Size = 4000), @p5='?' (Size = 450), @p6='?' (Size = 4000), @p7='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SET IMPLICIT_TRANSACTIONS OFF;
SET NOCOUNT ON;
INSERT INTO [AuthLogs] ([AuthType], [CreatedAt], [DeviceId], [FailureReason], [IpAddress], [NationalId], [Status], [UserAgent])
OUTPUT INSERTED.[Id]
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7);
2025-02-02 01:55:58.678 +03:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType9`2[[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Object, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-02-02 01:55:58.681 +03:00 [INF] Executed action NayifatAPI.Controllers.NotificationsController.GetNotifications (NayifatAPI) in 57.5535ms
2025-02-02 01:55:58.688 +03:00 [INF] Executed endpoint 'NayifatAPI.Controllers.NotificationsController.GetNotifications (NayifatAPI)'
2025-02-02 01:55:58.691 +03:00 [INF] Request finished HTTP/1.1 POST http://957c-51-252-155-185.ngrok-free.app/api/notifications/list - 200 null application/json; charset=utf-8 77.006ms
2025-02-02 01:55:59.245 +03:00 [INF] Request starting HTTP/1.1 POST http://957c-51-252-155-185.ngrok-free.app/api/notifications/list - application/json; charset=utf-8 47
2025-02-02 01:55:59.251 +03:00 [INF] Executing endpoint 'NayifatAPI.Controllers.NotificationsController.GetNotifications (NayifatAPI)'
2025-02-02 01:55:59.255 +03:00 [INF] Route matched with {action = "GetNotifications", controller = "Notifications"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetNotifications(NayifatAPI.Controllers.GetNotificationsRequest) on controller NayifatAPI.Controllers.NotificationsController (NayifatAPI).
2025-02-02 01:55:59.261 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@__providedApiKey_0='?' (Size = 255)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [a].[Key], [a].[CreatedAt], [a].[Description], [a].[ExpiresAt], [a].[IsActive], [a].[LastUsedAt]
FROM [ApiKeys] AS [a]
WHERE [a].[Key] = @__providedApiKey_0 AND [a].[IsActive] = CAST(1 AS bit)
2025-02-02 01:55:59.271 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@__request_NationalId_0='?' (Size = 450)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [u].[national_id], [u].[last_updated], [u].[notifications]
FROM [user_notifications] AS [u]
WHERE [u].[national_id] = @__request_NationalId_0
2025-02-02 01:55:59.278 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@__Parse_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [n].[Id], [n].[additional_data], [n].[Body], [n].[body_ar], [n].[body_en], [n].[created_at], [n].[expiry_at], [n].[Route], [n].[target_criteria], [n].[Title], [n].[title_ar], [n].[title_en]
FROM [notification_templates] AS [n]
WHERE [n].[Id] = @__Parse_0
2025-02-02 01:55:59.286 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@__Parse_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [n].[Id], [n].[additional_data], [n].[Body], [n].[body_ar], [n].[body_en], [n].[created_at], [n].[expiry_at], [n].[Route], [n].[target_criteria], [n].[Title], [n].[title_ar], [n].[title_en]
FROM [notification_templates] AS [n]
WHERE [n].[Id] = @__Parse_0
2025-02-02 01:55:59.302 +03:00 [INF] Executed DbCommand (6ms) [Parameters=[@p0='?' (Size = 4000), @p1='?' (DbType = DateTime2), @p2='?' (Size = 4000), @p3='?' (Size = 4000), @p4='?' (Size = 4000), @p5='?' (Size = 450), @p6='?' (Size = 4000), @p7='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SET IMPLICIT_TRANSACTIONS OFF;
SET NOCOUNT ON;
INSERT INTO [AuthLogs] ([AuthType], [CreatedAt], [DeviceId], [FailureReason], [IpAddress], [NationalId], [Status], [UserAgent])
OUTPUT INSERTED.[Id]
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7);
2025-02-02 01:55:59.309 +03:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType9`2[[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Object, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-02-02 01:55:59.310 +03:00 [INF] Executed action NayifatAPI.Controllers.NotificationsController.GetNotifications (NayifatAPI) in 50.9386ms
2025-02-02 01:55:59.312 +03:00 [INF] Executed endpoint 'NayifatAPI.Controllers.NotificationsController.GetNotifications (NayifatAPI)'
2025-02-02 01:55:59.315 +03:00 [INF] Request finished HTTP/1.1 POST http://957c-51-252-155-185.ngrok-free.app/api/notifications/list - 200 null application/json; charset=utf-8 69.9417ms
2025-02-02 01:57:03.408 +03:00 [INF] Request starting HTTP/1.1 POST http://957c-51-252-155-185.ngrok-free.app/api/auth/signin - application/json; charset=utf-8 50
2025-02-02 01:57:03.826 +03:00 [INF] Executing endpoint 'NayifatAPI.Controllers.AuthController.SignIn (NayifatAPI)'
2025-02-02 01:57:03.828 +03:00 [INF] Route matched with {action = "SignIn", controller = "Auth"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] SignIn(NayifatAPI.Controllers.SignInRequest) on controller NayifatAPI.Controllers.AuthController (NayifatAPI).
2025-02-02 01:57:03.836 +03:00 [INF] Executing BadRequestObjectResult, writing value of type 'Microsoft.AspNetCore.Mvc.ValidationProblemDetails'.
2025-02-02 01:57:03.839 +03:00 [INF] Executed action NayifatAPI.Controllers.AuthController.SignIn (NayifatAPI) in 3.7291ms
2025-02-02 01:57:03.841 +03:00 [INF] Executed endpoint 'NayifatAPI.Controllers.AuthController.SignIn (NayifatAPI)'
2025-02-02 01:57:03.845 +03:00 [INF] Request finished HTTP/1.1 POST http://957c-51-252-155-185.ngrok-free.app/api/auth/signin - 400 null application/problem+json; charset=utf-8 436.7219ms
2025-02-02 01:58:25.710 +03:00 [INF] Request starting HTTP/1.1 POST http://957c-51-252-155-185.ngrok-free.app/api/notifications/list - application/json; charset=utf-8 47
2025-02-02 01:58:25.714 +03:00 [INF] Executing endpoint 'NayifatAPI.Controllers.NotificationsController.GetNotifications (NayifatAPI)'
2025-02-02 01:58:25.716 +03:00 [INF] Route matched with {action = "GetNotifications", controller = "Notifications"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetNotifications(NayifatAPI.Controllers.GetNotificationsRequest) on controller NayifatAPI.Controllers.NotificationsController (NayifatAPI).
2025-02-02 01:58:25.725 +03:00 [INF] Executed DbCommand (5ms) [Parameters=[@__providedApiKey_0='?' (Size = 255)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [a].[Key], [a].[CreatedAt], [a].[Description], [a].[ExpiresAt], [a].[IsActive], [a].[LastUsedAt]
FROM [ApiKeys] AS [a]
WHERE [a].[Key] = @__providedApiKey_0 AND [a].[IsActive] = CAST(1 AS bit)
2025-02-02 01:58:25.732 +03:00 [INF] Executed DbCommand (4ms) [Parameters=[@__request_NationalId_0='?' (Size = 450)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [u].[national_id], [u].[last_updated], [u].[notifications]
FROM [user_notifications] AS [u]
WHERE [u].[national_id] = @__request_NationalId_0
2025-02-02 01:58:25.738 +03:00 [INF] Executed DbCommand (3ms) [Parameters=[@__Parse_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [n].[Id], [n].[additional_data], [n].[Body], [n].[body_ar], [n].[body_en], [n].[created_at], [n].[expiry_at], [n].[Route], [n].[target_criteria], [n].[Title], [n].[title_ar], [n].[title_en]
FROM [notification_templates] AS [n]
WHERE [n].[Id] = @__Parse_0
2025-02-02 01:58:25.744 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@__Parse_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [n].[Id], [n].[additional_data], [n].[Body], [n].[body_ar], [n].[body_en], [n].[created_at], [n].[expiry_at], [n].[Route], [n].[target_criteria], [n].[Title], [n].[title_ar], [n].[title_en]
FROM [notification_templates] AS [n]
WHERE [n].[Id] = @__Parse_0
2025-02-02 01:58:25.829 +03:00 [INF] Executed DbCommand (80ms) [Parameters=[@p0='?' (Size = 4000), @p1='?' (DbType = DateTime2), @p2='?' (Size = 4000), @p3='?' (Size = 4000), @p4='?' (Size = 4000), @p5='?' (Size = 450), @p6='?' (Size = 4000), @p7='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SET IMPLICIT_TRANSACTIONS OFF;
SET NOCOUNT ON;
INSERT INTO [AuthLogs] ([AuthType], [CreatedAt], [DeviceId], [FailureReason], [IpAddress], [NationalId], [Status], [UserAgent])
OUTPUT INSERTED.[Id]
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7);
2025-02-02 01:58:25.832 +03:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType9`2[[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Object, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-02-02 01:58:25.835 +03:00 [INF] Executed action NayifatAPI.Controllers.NotificationsController.GetNotifications (NayifatAPI) in 116.0542ms
2025-02-02 01:58:25.840 +03:00 [INF] Executed endpoint 'NayifatAPI.Controllers.NotificationsController.GetNotifications (NayifatAPI)'
2025-02-02 01:58:25.842 +03:00 [INF] Request finished HTTP/1.1 POST http://957c-51-252-155-185.ngrok-free.app/api/notifications/list - 200 null application/json; charset=utf-8 131.7326ms
2025-02-02 01:58:43.908 +03:00 [INF] Request starting HTTP/1.1 POST http://957c-51-252-155-185.ngrok-free.app/api/notifications/list - application/json; charset=utf-8 47
2025-02-02 01:58:43.912 +03:00 [INF] Executing endpoint 'NayifatAPI.Controllers.NotificationsController.GetNotifications (NayifatAPI)'
2025-02-02 01:58:43.914 +03:00 [INF] Route matched with {action = "GetNotifications", controller = "Notifications"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetNotifications(NayifatAPI.Controllers.GetNotificationsRequest) on controller NayifatAPI.Controllers.NotificationsController (NayifatAPI).
2025-02-02 01:58:43.920 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@__providedApiKey_0='?' (Size = 255)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [a].[Key], [a].[CreatedAt], [a].[Description], [a].[ExpiresAt], [a].[IsActive], [a].[LastUsedAt]
FROM [ApiKeys] AS [a]
WHERE [a].[Key] = @__providedApiKey_0 AND [a].[IsActive] = CAST(1 AS bit)
2025-02-02 01:58:43.928 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@__request_NationalId_0='?' (Size = 450)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [u].[national_id], [u].[last_updated], [u].[notifications]
FROM [user_notifications] AS [u]
WHERE [u].[national_id] = @__request_NationalId_0
2025-02-02 01:58:43.932 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@__Parse_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [n].[Id], [n].[additional_data], [n].[Body], [n].[body_ar], [n].[body_en], [n].[created_at], [n].[expiry_at], [n].[Route], [n].[target_criteria], [n].[Title], [n].[title_ar], [n].[title_en]
FROM [notification_templates] AS [n]
WHERE [n].[Id] = @__Parse_0
2025-02-02 01:58:43.938 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@__Parse_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [n].[Id], [n].[additional_data], [n].[Body], [n].[body_ar], [n].[body_en], [n].[created_at], [n].[expiry_at], [n].[Route], [n].[target_criteria], [n].[Title], [n].[title_ar], [n].[title_en]
FROM [notification_templates] AS [n]
WHERE [n].[Id] = @__Parse_0
2025-02-02 01:58:44.017 +03:00 [INF] Executed DbCommand (74ms) [Parameters=[@p0='?' (Size = 4000), @p1='?' (DbType = DateTime2), @p2='?' (Size = 4000), @p3='?' (Size = 4000), @p4='?' (Size = 4000), @p5='?' (Size = 450), @p6='?' (Size = 4000), @p7='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SET IMPLICIT_TRANSACTIONS OFF;
SET NOCOUNT ON;
INSERT INTO [AuthLogs] ([AuthType], [CreatedAt], [DeviceId], [FailureReason], [IpAddress], [NationalId], [Status], [UserAgent])
OUTPUT INSERTED.[Id]
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7);
2025-02-02 01:58:44.024 +03:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType9`2[[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Object, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-02-02 01:58:44.026 +03:00 [INF] Executed action NayifatAPI.Controllers.NotificationsController.GetNotifications (NayifatAPI) in 107.4864ms
2025-02-02 01:58:44.029 +03:00 [INF] Executed endpoint 'NayifatAPI.Controllers.NotificationsController.GetNotifications (NayifatAPI)'
2025-02-02 01:58:44.031 +03:00 [INF] Request finished HTTP/1.1 POST http://957c-51-252-155-185.ngrok-free.app/api/notifications/list - 200 null application/json; charset=utf-8 123.07ms
2025-02-02 01:59:36.909 +03:00 [INF] Request starting HTTP/1.1 POST http://957c-51-252-155-185.ngrok-free.app/api/auth/signin - application/json; charset=utf-8 224
2025-02-02 01:59:36.911 +03:00 [INF] Executing endpoint 'NayifatAPI.Controllers.AuthController.SignIn (NayifatAPI)'
2025-02-02 01:59:36.912 +03:00 [INF] Route matched with {action = "SignIn", controller = "Auth"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] SignIn(NayifatAPI.Controllers.SignInRequest) on controller NayifatAPI.Controllers.AuthController (NayifatAPI).
2025-02-02 01:59:36.921 +03:00 [INF] Executed DbCommand (6ms) [Parameters=[@__providedApiKey_0='?' (Size = 255)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [a].[Key], [a].[CreatedAt], [a].[Description], [a].[ExpiresAt], [a].[IsActive], [a].[LastUsedAt]
FROM [ApiKeys] AS [a]
WHERE [a].[Key] = @__providedApiKey_0 AND [a].[IsActive] = CAST(1 AS bit)
2025-02-02 01:59:36.932 +03:00 [INF] Executed DbCommand (6ms) [Parameters=[@__request_NationalId_0='?' (Size = 450)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [c].[NationalId], [c].[AddNo], [c].[BuildingNo], [c].[City], [c].[Consent], [c].[ConsentDate], [c].[DateOfBirth], [c].[Dependents], [c].[District], [c].[Email], [c].[Employer], [c].[FamilyNameAr], [c].[FamilyNameEn], [c].[FirstNameAr], [c].[FirstNameEn], [c].[Iban], [c].[IdExpiryDate], [c].[Los], [c].[Mpin], [c].[MpinEnabled], [c].[NafathStatus], [c].[NafathTimestamp], [c].[Password], [c].[Phone], [c].[RegistrationDate], [c].[SalaryCustomer], [c].[SalaryDakhli], [c].[SecondNameAr], [c].[SecondNameEn], [c].[Sector], [c].[Street], [c].[ThirdNameAr], [c].[ThirdNameEn], [c].[Zipcode]
FROM [Customers] AS [c]
WHERE [c].[NationalId] = @__request_NationalId_0
2025-02-02 01:59:36.936 +03:00 [INF] Starting password verification for NationalId: 1064448614
2025-02-02 01:59:37.117 +03:00 [INF] Password verification result for NationalId 1064448614: Success
2025-02-02 01:59:37.129 +03:00 [INF] Executed DbCommand (6ms) [Parameters=[@__request_NationalId_0='?' (Size = 450), @__request_DeviceId_1='?' (Size = 450)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [c].[Id], [c].[BiometricEnabled], [c].[BiometricToken], [c].[CreatedAt], [c].[DeviceId], [c].[LastUsedAt], [c].[Manufacturer], [c].[Model], [c].[NationalId], [c].[OsVersion], [c].[Platform], [c].[Status]
FROM [Customer_Devices] AS [c]
WHERE [c].[NationalId] = @__request_NationalId_0 AND [c].[DeviceId] = @__request_DeviceId_1 AND [c].[Status] = N'active'
2025-02-02 01:59:37.211 +03:00 [INF] Executed DbCommand (77ms) [Parameters=[@p0='?' (Size = 4000), @p1='?' (DbType = DateTime2), @p2='?' (Size = 4000), @p3='?' (Size = 4000), @p4='?' (Size = 4000), @p5='?' (Size = 450), @p6='?' (Size = 4000), @p7='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SET IMPLICIT_TRANSACTIONS OFF;
SET NOCOUNT ON;
INSERT INTO [AuthLogs] ([AuthType], [CreatedAt], [DeviceId], [FailureReason], [IpAddress], [NationalId], [Status], [UserAgent])
OUTPUT INSERTED.[Id]
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7);
2025-02-02 01:59:37.219 +03:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType9`2[[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Object, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-02-02 01:59:37.221 +03:00 [INF] Executed action NayifatAPI.Controllers.AuthController.SignIn (NayifatAPI) in 307.5986ms
2025-02-02 01:59:37.223 +03:00 [INF] Executed endpoint 'NayifatAPI.Controllers.AuthController.SignIn (NayifatAPI)'
2025-02-02 01:59:37.226 +03:00 [INF] Request finished HTTP/1.1 POST http://957c-51-252-155-185.ngrok-free.app/api/auth/signin - 200 null application/json; charset=utf-8 317.0009ms
2025-02-02 01:59:38.381 +03:00 [INF] Request starting HTTP/1.1 POST http://957c-51-252-155-185.ngrok-free.app/api/proxy/forward?url=https://icreditdept.com/api/testasp/test_local_generate_otp.php - application/json; charset=utf-8 84
2025-02-02 01:59:38.385 +03:00 [INF] Executing endpoint 'NayifatAPI.Controllers.ProxyController.ForwardRequest (NayifatAPI)'
2025-02-02 01:59:38.386 +03:00 [INF] Route matched with {action = "ForwardRequest", controller = "Proxy"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] ForwardRequest() on controller NayifatAPI.Controllers.ProxyController (NayifatAPI).
2025-02-02 01:59:38.389 +03:00 [INF] Start processing HTTP request POST https://icreditdept.com/api/testasp/test_local_generate_otp.php
2025-02-02 01:59:38.390 +03:00 [INF] Sending HTTP request POST https://icreditdept.com/api/testasp/test_local_generate_otp.php
2025-02-02 01:59:39.652 +03:00 [INF] Received HTTP response headers after 1259.5918ms - 200
2025-02-02 01:59:39.653 +03:00 [INF] End processing HTTP request after 1264.4071ms - 200
2025-02-02 01:59:39.654 +03:00 [INF] Raw response length: 200
2025-02-02 01:59:39.655 +03:00 [INF] Response content: {"success":true,"errors":[],"result":{"nationalId":"1064448614","otp":963215,"expiryDate":"2025-02-02 02:04:39","successMsg":"Success","errCode":0,"errMsg":null},"type":"N","message":null,"code":null}
2025-02-02 01:59:39.656 +03:00 [INF] Executing ContentResult with HTTP Response ContentType of application/json
2025-02-02 01:59:39.657 +03:00 [INF] Executed action NayifatAPI.Controllers.ProxyController.ForwardRequest (NayifatAPI) in 1269.3883ms
2025-02-02 01:59:39.658 +03:00 [INF] Executed endpoint 'NayifatAPI.Controllers.ProxyController.ForwardRequest (NayifatAPI)'
2025-02-02 01:59:39.660 +03:00 [INF] Request finished HTTP/1.1 POST http://957c-51-252-155-185.ngrok-free.app/api/proxy/forward?url=https://icreditdept.com/api/testasp/test_local_generate_otp.php - 200 200 application/json 1278.6976ms
2025-02-02 02:02:08.855 +03:00 [INF] Request starting HTTP/1.1 POST http://957c-51-252-155-185.ngrok-free.app/api/auth/signin - application/json; charset=utf-8 224
2025-02-02 02:02:08.858 +03:00 [INF] Executing endpoint 'NayifatAPI.Controllers.AuthController.SignIn (NayifatAPI)'
2025-02-02 02:02:08.859 +03:00 [INF] Route matched with {action = "SignIn", controller = "Auth"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] SignIn(NayifatAPI.Controllers.SignInRequest) on controller NayifatAPI.Controllers.AuthController (NayifatAPI).
2025-02-02 02:02:08.945 +03:00 [INF] Executed DbCommand (82ms) [Parameters=[@__providedApiKey_0='?' (Size = 255)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [a].[Key], [a].[CreatedAt], [a].[Description], [a].[ExpiresAt], [a].[IsActive], [a].[LastUsedAt]
FROM [ApiKeys] AS [a]
WHERE [a].[Key] = @__providedApiKey_0 AND [a].[IsActive] = CAST(1 AS bit)
2025-02-02 02:02:08.955 +03:00 [INF] Executed DbCommand (5ms) [Parameters=[@__request_NationalId_0='?' (Size = 450)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [c].[NationalId], [c].[AddNo], [c].[BuildingNo], [c].[City], [c].[Consent], [c].[ConsentDate], [c].[DateOfBirth], [c].[Dependents], [c].[District], [c].[Email], [c].[Employer], [c].[FamilyNameAr], [c].[FamilyNameEn], [c].[FirstNameAr], [c].[FirstNameEn], [c].[Iban], [c].[IdExpiryDate], [c].[Los], [c].[Mpin], [c].[MpinEnabled], [c].[NafathStatus], [c].[NafathTimestamp], [c].[Password], [c].[Phone], [c].[RegistrationDate], [c].[SalaryCustomer], [c].[SalaryDakhli], [c].[SecondNameAr], [c].[SecondNameEn], [c].[Sector], [c].[Street], [c].[ThirdNameAr], [c].[ThirdNameEn], [c].[Zipcode]
FROM [Customers] AS [c]
WHERE [c].[NationalId] = @__request_NationalId_0
2025-02-02 02:02:08.963 +03:00 [INF] Starting password verification for NationalId: 1064448614
2025-02-02 02:02:09.161 +03:00 [INF] Password verification result for NationalId 1064448614: Success
2025-02-02 02:02:09.166 +03:00 [INF] Executed DbCommand (4ms) [Parameters=[@__request_NationalId_0='?' (Size = 450), @__request_DeviceId_1='?' (Size = 450)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [c].[Id], [c].[BiometricEnabled], [c].[BiometricToken], [c].[CreatedAt], [c].[DeviceId], [c].[LastUsedAt], [c].[Manufacturer], [c].[Model], [c].[NationalId], [c].[OsVersion], [c].[Platform], [c].[Status]
FROM [Customer_Devices] AS [c]
WHERE [c].[NationalId] = @__request_NationalId_0 AND [c].[DeviceId] = @__request_DeviceId_1 AND [c].[Status] = N'active'
2025-02-02 02:02:09.182 +03:00 [INF] Executed DbCommand (10ms) [Parameters=[@p0='?' (Size = 4000), @p1='?' (DbType = DateTime2), @p2='?' (Size = 4000), @p3='?' (Size = 4000), @p4='?' (Size = 4000), @p5='?' (Size = 450), @p6='?' (Size = 4000), @p7='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SET IMPLICIT_TRANSACTIONS OFF;
SET NOCOUNT ON;
INSERT INTO [AuthLogs] ([AuthType], [CreatedAt], [DeviceId], [FailureReason], [IpAddress], [NationalId], [Status], [UserAgent])
OUTPUT INSERTED.[Id]
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7);
2025-02-02 02:02:09.188 +03:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType9`2[[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Object, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-02-02 02:02:09.189 +03:00 [INF] Executed action NayifatAPI.Controllers.AuthController.SignIn (NayifatAPI) in 327.3311ms
2025-02-02 02:02:09.191 +03:00 [INF] Executed endpoint 'NayifatAPI.Controllers.AuthController.SignIn (NayifatAPI)'
2025-02-02 02:02:09.193 +03:00 [INF] Request finished HTTP/1.1 POST http://957c-51-252-155-185.ngrok-free.app/api/auth/signin - 200 null application/json; charset=utf-8 337.1959ms
2025-02-02 02:03:45.684 +03:00 [INF] Request starting HTTP/1.1 POST http://957c-51-252-155-185.ngrok-free.app/api/notifications/list - application/json; charset=utf-8 47
2025-02-02 02:03:45.748 +03:00 [INF] Executing endpoint 'NayifatAPI.Controllers.NotificationsController.GetNotifications (NayifatAPI)'
2025-02-02 02:03:45.749 +03:00 [INF] Route matched with {action = "GetNotifications", controller = "Notifications"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetNotifications(NayifatAPI.Controllers.GetNotificationsRequest) on controller NayifatAPI.Controllers.NotificationsController (NayifatAPI).
2025-02-02 02:03:45.762 +03:00 [INF] Executed DbCommand (7ms) [Parameters=[@__providedApiKey_0='?' (Size = 255)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [a].[Key], [a].[CreatedAt], [a].[Description], [a].[ExpiresAt], [a].[IsActive], [a].[LastUsedAt]
FROM [ApiKeys] AS [a]
WHERE [a].[Key] = @__providedApiKey_0 AND [a].[IsActive] = CAST(1 AS bit)
2025-02-02 02:03:45.768 +03:00 [INF] Executed DbCommand (3ms) [Parameters=[@__request_NationalId_0='?' (Size = 450)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [u].[national_id], [u].[last_updated], [u].[notifications]
FROM [user_notifications] AS [u]
WHERE [u].[national_id] = @__request_NationalId_0
2025-02-02 02:03:45.778 +03:00 [INF] Executed DbCommand (5ms) [Parameters=[@__Parse_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [n].[Id], [n].[additional_data], [n].[Body], [n].[body_ar], [n].[body_en], [n].[created_at], [n].[expiry_at], [n].[Route], [n].[target_criteria], [n].[Title], [n].[title_ar], [n].[title_en]
FROM [notification_templates] AS [n]
WHERE [n].[Id] = @__Parse_0
2025-02-02 02:03:45.786 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@__Parse_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [n].[Id], [n].[additional_data], [n].[Body], [n].[body_ar], [n].[body_en], [n].[created_at], [n].[expiry_at], [n].[Route], [n].[target_criteria], [n].[Title], [n].[title_ar], [n].[title_en]
FROM [notification_templates] AS [n]
WHERE [n].[Id] = @__Parse_0
2025-02-02 02:03:45.871 +03:00 [INF] Executed DbCommand (79ms) [Parameters=[@p0='?' (Size = 4000), @p1='?' (DbType = DateTime2), @p2='?' (Size = 4000), @p3='?' (Size = 4000), @p4='?' (Size = 4000), @p5='?' (Size = 450), @p6='?' (Size = 4000), @p7='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SET IMPLICIT_TRANSACTIONS OFF;
SET NOCOUNT ON;
INSERT INTO [AuthLogs] ([AuthType], [CreatedAt], [DeviceId], [FailureReason], [IpAddress], [NationalId], [Status], [UserAgent])
OUTPUT INSERTED.[Id]
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7);
2025-02-02 02:03:45.877 +03:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType9`2[[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Object, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-02-02 02:03:45.879 +03:00 [INF] Executed action NayifatAPI.Controllers.NotificationsController.GetNotifications (NayifatAPI) in 125.9891ms
2025-02-02 02:03:45.881 +03:00 [INF] Executed endpoint 'NayifatAPI.Controllers.NotificationsController.GetNotifications (NayifatAPI)'
2025-02-02 02:03:45.883 +03:00 [INF] Request finished HTTP/1.1 POST http://957c-51-252-155-185.ngrok-free.app/api/notifications/list - 200 null application/json; charset=utf-8 198.7254ms
2025-02-02 02:08:47.682 +03:00 [INF] Request starting HTTP/1.1 POST http://957c-51-252-155-185.ngrok-free.app/api/notifications/list - application/json; charset=utf-8 47
2025-02-02 02:08:47.686 +03:00 [INF] Executing endpoint 'NayifatAPI.Controllers.NotificationsController.GetNotifications (NayifatAPI)'
2025-02-02 02:08:47.689 +03:00 [INF] Route matched with {action = "GetNotifications", controller = "Notifications"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetNotifications(NayifatAPI.Controllers.GetNotificationsRequest) on controller NayifatAPI.Controllers.NotificationsController (NayifatAPI).
2025-02-02 02:08:47.700 +03:00 [INF] Executed DbCommand (6ms) [Parameters=[@__providedApiKey_0='?' (Size = 255)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [a].[Key], [a].[CreatedAt], [a].[Description], [a].[ExpiresAt], [a].[IsActive], [a].[LastUsedAt]
FROM [ApiKeys] AS [a]
WHERE [a].[Key] = @__providedApiKey_0 AND [a].[IsActive] = CAST(1 AS bit)
2025-02-02 02:08:47.707 +03:00 [INF] Executed DbCommand (2ms) [Parameters=[@__request_NationalId_0='?' (Size = 450)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [u].[national_id], [u].[last_updated], [u].[notifications]
FROM [user_notifications] AS [u]
WHERE [u].[national_id] = @__request_NationalId_0
2025-02-02 02:08:47.714 +03:00 [INF] Executed DbCommand (2ms) [Parameters=[@__Parse_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [n].[Id], [n].[additional_data], [n].[Body], [n].[body_ar], [n].[body_en], [n].[created_at], [n].[expiry_at], [n].[Route], [n].[target_criteria], [n].[Title], [n].[title_ar], [n].[title_en]
FROM [notification_templates] AS [n]
WHERE [n].[Id] = @__Parse_0
2025-02-02 02:08:47.718 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@__Parse_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [n].[Id], [n].[additional_data], [n].[Body], [n].[body_ar], [n].[body_en], [n].[created_at], [n].[expiry_at], [n].[Route], [n].[target_criteria], [n].[Title], [n].[title_ar], [n].[title_en]
FROM [notification_templates] AS [n]
WHERE [n].[Id] = @__Parse_0
2025-02-02 02:08:47.799 +03:00 [INF] Executed DbCommand (77ms) [Parameters=[@p0='?' (Size = 4000), @p1='?' (DbType = DateTime2), @p2='?' (Size = 4000), @p3='?' (Size = 4000), @p4='?' (Size = 4000), @p5='?' (Size = 450), @p6='?' (Size = 4000), @p7='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SET IMPLICIT_TRANSACTIONS OFF;
SET NOCOUNT ON;
INSERT INTO [AuthLogs] ([AuthType], [CreatedAt], [DeviceId], [FailureReason], [IpAddress], [NationalId], [Status], [UserAgent])
OUTPUT INSERTED.[Id]
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7);
2025-02-02 02:08:47.803 +03:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType9`2[[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Object, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-02-02 02:08:47.805 +03:00 [INF] Executed action NayifatAPI.Controllers.NotificationsController.GetNotifications (NayifatAPI) in 113.3742ms
2025-02-02 02:08:47.808 +03:00 [INF] Executed endpoint 'NayifatAPI.Controllers.NotificationsController.GetNotifications (NayifatAPI)'
2025-02-02 02:08:47.810 +03:00 [INF] Request finished HTTP/1.1 POST http://957c-51-252-155-185.ngrok-free.app/api/notifications/list - 200 null application/json; charset=utf-8 128.3618ms
2025-02-02 02:09:57.412 +03:00 [INF] Request starting HTTP/1.1 POST http://957c-51-252-155-185.ngrok-free.app/api/auth/signin - application/json; charset=utf-8 224
2025-02-02 02:09:57.496 +03:00 [INF] Executing endpoint 'NayifatAPI.Controllers.AuthController.SignIn (NayifatAPI)'
2025-02-02 02:09:57.512 +03:00 [INF] Route matched with {action = "SignIn", controller = "Auth"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] SignIn(NayifatAPI.Controllers.SignInRequest) on controller NayifatAPI.Controllers.AuthController (NayifatAPI).
2025-02-02 02:09:57.575 +03:00 [INF] Executed DbCommand (15ms) [Parameters=[@__providedApiKey_0='?' (Size = 255)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [a].[Key], [a].[CreatedAt], [a].[Description], [a].[ExpiresAt], [a].[IsActive], [a].[LastUsedAt]
FROM [ApiKeys] AS [a]
WHERE [a].[Key] = @__providedApiKey_0 AND [a].[IsActive] = CAST(1 AS bit)
2025-02-02 02:09:57.591 +03:00 [INF] Executed DbCommand (12ms) [Parameters=[@__request_NationalId_0='?' (Size = 450)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [c].[NationalId], [c].[AddNo], [c].[BuildingNo], [c].[City], [c].[Consent], [c].[ConsentDate], [c].[DateOfBirth], [c].[Dependents], [c].[District], [c].[Email], [c].[Employer], [c].[FamilyNameAr], [c].[FamilyNameEn], [c].[FirstNameAr], [c].[FirstNameEn], [c].[Iban], [c].[IdExpiryDate], [c].[Los], [c].[Mpin], [c].[MpinEnabled], [c].[NafathStatus], [c].[NafathTimestamp], [c].[Password], [c].[Phone], [c].[RegistrationDate], [c].[SalaryCustomer], [c].[SalaryDakhli], [c].[SecondNameAr], [c].[SecondNameEn], [c].[Sector], [c].[Street], [c].[ThirdNameAr], [c].[ThirdNameEn], [c].[Zipcode]
FROM [Customers] AS [c]
WHERE [c].[NationalId] = @__request_NationalId_0
2025-02-02 02:09:57.634 +03:00 [INF] Starting password verification for NationalId: 1064448614
2025-02-02 02:09:57.944 +03:00 [INF] Password verification result for NationalId 1064448614: Success
2025-02-02 02:09:58.009 +03:00 [INF] Executed DbCommand (8ms) [Parameters=[@__request_NationalId_0='?' (Size = 450), @__request_DeviceId_1='?' (Size = 450)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [c].[Id], [c].[BiometricEnabled], [c].[BiometricToken], [c].[CreatedAt], [c].[DeviceId], [c].[LastUsedAt], [c].[Manufacturer], [c].[Model], [c].[NationalId], [c].[OsVersion], [c].[Platform], [c].[Status]
FROM [Customer_Devices] AS [c]
WHERE [c].[NationalId] = @__request_NationalId_0 AND [c].[DeviceId] = @__request_DeviceId_1 AND [c].[Status] = N'active'
2025-02-02 02:09:58.122 +03:00 [INF] Executed DbCommand (80ms) [Parameters=[@p0='?' (Size = 4000), @p1='?' (DbType = DateTime2), @p2='?' (Size = 4000), @p3='?' (Size = 4000), @p4='?' (Size = 4000), @p5='?' (Size = 450), @p6='?' (Size = 4000), @p7='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SET IMPLICIT_TRANSACTIONS OFF;
SET NOCOUNT ON;
INSERT INTO [AuthLogs] ([AuthType], [CreatedAt], [DeviceId], [FailureReason], [IpAddress], [NationalId], [Status], [UserAgent])
OUTPUT INSERTED.[Id]
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7);
2025-02-02 02:09:58.200 +03:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType9`2[[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Object, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-02-02 02:09:58.237 +03:00 [INF] Executed action NayifatAPI.Controllers.AuthController.SignIn (NayifatAPI) in 678.9135ms
2025-02-02 02:09:58.250 +03:00 [INF] Executed endpoint 'NayifatAPI.Controllers.AuthController.SignIn (NayifatAPI)'
2025-02-02 02:09:58.256 +03:00 [INF] Request finished HTTP/1.1 POST http://957c-51-252-155-185.ngrok-free.app/api/auth/signin - 200 null application/json; charset=utf-8 844.0996ms
2025-02-02 02:11:37.878 +03:00 [INF] Request starting HTTP/1.1 POST http://957c-51-252-155-185.ngrok-free.app/api/auth/signin - application/json; charset=utf-8 224
2025-02-02 02:11:38.039 +03:00 [INF] Executing endpoint 'NayifatAPI.Controllers.AuthController.SignIn (NayifatAPI)'
2025-02-02 02:11:38.054 +03:00 [INF] Route matched with {action = "SignIn", controller = "Auth"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] SignIn(NayifatAPI.Controllers.SignInRequest) on controller NayifatAPI.Controllers.AuthController (NayifatAPI).
2025-02-02 02:11:38.060 +03:00 [INF] Executed DbCommand (3ms) [Parameters=[@__providedApiKey_0='?' (Size = 255)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [a].[Key], [a].[CreatedAt], [a].[Description], [a].[ExpiresAt], [a].[IsActive], [a].[LastUsedAt]
FROM [ApiKeys] AS [a]
WHERE [a].[Key] = @__providedApiKey_0 AND [a].[IsActive] = CAST(1 AS bit)
2025-02-02 02:11:38.096 +03:00 [INF] Executed DbCommand (33ms) [Parameters=[@__request_NationalId_0='?' (Size = 450)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [c].[NationalId], [c].[AddNo], [c].[BuildingNo], [c].[City], [c].[Consent], [c].[ConsentDate], [c].[DateOfBirth], [c].[Dependents], [c].[District], [c].[Email], [c].[Employer], [c].[FamilyNameAr], [c].[FamilyNameEn], [c].[FirstNameAr], [c].[FirstNameEn], [c].[Iban], [c].[IdExpiryDate], [c].[Los], [c].[Mpin], [c].[MpinEnabled], [c].[NafathStatus], [c].[NafathTimestamp], [c].[Password], [c].[Phone], [c].[RegistrationDate], [c].[SalaryCustomer], [c].[SalaryDakhli], [c].[SecondNameAr], [c].[SecondNameEn], [c].[Sector], [c].[Street], [c].[ThirdNameAr], [c].[ThirdNameEn], [c].[Zipcode]
FROM [Customers] AS [c]
WHERE [c].[NationalId] = @__request_NationalId_0
2025-02-02 02:11:38.394 +03:00 [INF] Starting password verification for NationalId: 1064448614
2025-02-02 02:11:38.755 +03:00 [INF] Password verification result for NationalId 1064448614: Success
2025-02-02 02:11:38.783 +03:00 [INF] Executed DbCommand (24ms) [Parameters=[@__request_NationalId_0='?' (Size = 450), @__request_DeviceId_1='?' (Size = 450)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [c].[Id], [c].[BiometricEnabled], [c].[BiometricToken], [c].[CreatedAt], [c].[DeviceId], [c].[LastUsedAt], [c].[Manufacturer], [c].[Model], [c].[NationalId], [c].[OsVersion], [c].[Platform], [c].[Status]
FROM [Customer_Devices] AS [c]
WHERE [c].[NationalId] = @__request_NationalId_0 AND [c].[DeviceId] = @__request_DeviceId_1 AND [c].[Status] = N'active'
2025-02-02 02:11:38.846 +03:00 [INF] Executed DbCommand (61ms) [Parameters=[@p0='?' (Size = 4000), @p1='?' (DbType = DateTime2), @p2='?' (Size = 4000), @p3='?' (Size = 4000), @p4='?' (Size = 4000), @p5='?' (Size = 450), @p6='?' (Size = 4000), @p7='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SET IMPLICIT_TRANSACTIONS OFF;
SET NOCOUNT ON;
INSERT INTO [AuthLogs] ([AuthType], [CreatedAt], [DeviceId], [FailureReason], [IpAddress], [NationalId], [Status], [UserAgent])
OUTPUT INSERTED.[Id]
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7);
2025-02-02 02:11:39.224 +03:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType9`2[[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Object, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-02-02 02:11:39.226 +03:00 [INF] Executed action NayifatAPI.Controllers.AuthController.SignIn (NayifatAPI) in 1170.1003ms
2025-02-02 02:11:39.228 +03:00 [INF] Executed endpoint 'NayifatAPI.Controllers.AuthController.SignIn (NayifatAPI)'
2025-02-02 02:11:39.230 +03:00 [INF] Request finished HTTP/1.1 POST http://957c-51-252-155-185.ngrok-free.app/api/auth/signin - 200 null application/json; charset=utf-8 1351.1753ms
2025-02-02 02:11:40.140 +03:00 [INF] Request starting HTTP/1.1 POST http://957c-51-252-155-185.ngrok-free.app/api/proxy/forward?url=https://icreditdept.com/api/testasp/test_local_generate_otp.php - application/json; charset=utf-8 84
2025-02-02 02:11:40.149 +03:00 [INF] Executing endpoint 'NayifatAPI.Controllers.ProxyController.ForwardRequest (NayifatAPI)'
2025-02-02 02:11:40.150 +03:00 [INF] Route matched with {action = "ForwardRequest", controller = "Proxy"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] ForwardRequest() on controller NayifatAPI.Controllers.ProxyController (NayifatAPI).
2025-02-02 02:11:40.154 +03:00 [INF] Start processing HTTP request POST https://icreditdept.com/api/testasp/test_local_generate_otp.php
2025-02-02 02:11:40.156 +03:00 [INF] Sending HTTP request POST https://icreditdept.com/api/testasp/test_local_generate_otp.php
2025-02-02 02:11:40.893 +03:00 [INF] Received HTTP response headers after 735.0731ms - 200
2025-02-02 02:11:40.896 +03:00 [INF] End processing HTTP request after 742.1436ms - 200
2025-02-02 02:11:40.898 +03:00 [INF] Raw response length: 200
2025-02-02 02:11:40.899 +03:00 [INF] Response content: {"success":true,"errors":[],"result":{"nationalId":"1064448614","otp":480869,"expiryDate":"2025-02-02 02:16:40","successMsg":"Success","errCode":0,"errMsg":null},"type":"N","message":null,"code":null}
2025-02-02 02:11:40.900 +03:00 [INF] Executing ContentResult with HTTP Response ContentType of application/json
2025-02-02 02:11:40.901 +03:00 [INF] Executed action NayifatAPI.Controllers.ProxyController.ForwardRequest (NayifatAPI) in 748.5616ms
2025-02-02 02:11:40.904 +03:00 [INF] Executed endpoint 'NayifatAPI.Controllers.ProxyController.ForwardRequest (NayifatAPI)'
2025-02-02 02:11:40.905 +03:00 [INF] Request finished HTTP/1.1 POST http://957c-51-252-155-185.ngrok-free.app/api/proxy/forward?url=https://icreditdept.com/api/testasp/test_local_generate_otp.php - 200 200 application/json 765.503ms
2025-02-02 02:13:45.735 +03:00 [INF] Request starting HTTP/1.1 POST http://957c-51-252-155-185.ngrok-free.app/api/notifications/list - application/json; charset=utf-8 47
2025-02-02 02:13:45.742 +03:00 [INF] Executing endpoint 'NayifatAPI.Controllers.NotificationsController.GetNotifications (NayifatAPI)'
2025-02-02 02:13:45.743 +03:00 [INF] Route matched with {action = "GetNotifications", controller = "Notifications"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetNotifications(NayifatAPI.Controllers.GetNotificationsRequest) on controller NayifatAPI.Controllers.NotificationsController (NayifatAPI).
2025-02-02 02:13:45.751 +03:00 [INF] Executed DbCommand (5ms) [Parameters=[@__providedApiKey_0='?' (Size = 255)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [a].[Key], [a].[CreatedAt], [a].[Description], [a].[ExpiresAt], [a].[IsActive], [a].[LastUsedAt]
FROM [ApiKeys] AS [a]
WHERE [a].[Key] = @__providedApiKey_0 AND [a].[IsActive] = CAST(1 AS bit)
2025-02-02 02:13:45.758 +03:00 [INF] Executed DbCommand (2ms) [Parameters=[@__request_NationalId_0='?' (Size = 450)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [u].[national_id], [u].[last_updated], [u].[notifications]
FROM [user_notifications] AS [u]
WHERE [u].[national_id] = @__request_NationalId_0
2025-02-02 02:13:45.763 +03:00 [INF] Executed DbCommand (2ms) [Parameters=[@__Parse_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [n].[Id], [n].[additional_data], [n].[Body], [n].[body_ar], [n].[body_en], [n].[created_at], [n].[expiry_at], [n].[Route], [n].[target_criteria], [n].[Title], [n].[title_ar], [n].[title_en]
FROM [notification_templates] AS [n]
WHERE [n].[Id] = @__Parse_0
2025-02-02 02:13:45.768 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@__Parse_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [n].[Id], [n].[additional_data], [n].[Body], [n].[body_ar], [n].[body_en], [n].[created_at], [n].[expiry_at], [n].[Route], [n].[target_criteria], [n].[Title], [n].[title_ar], [n].[title_en]
FROM [notification_templates] AS [n]
WHERE [n].[Id] = @__Parse_0
2025-02-02 02:13:45.847 +03:00 [INF] Executed DbCommand (76ms) [Parameters=[@p0='?' (Size = 4000), @p1='?' (DbType = DateTime2), @p2='?' (Size = 4000), @p3='?' (Size = 4000), @p4='?' (Size = 4000), @p5='?' (Size = 450), @p6='?' (Size = 4000), @p7='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SET IMPLICIT_TRANSACTIONS OFF;
SET NOCOUNT ON;
INSERT INTO [AuthLogs] ([AuthType], [CreatedAt], [DeviceId], [FailureReason], [IpAddress], [NationalId], [Status], [UserAgent])
OUTPUT INSERTED.[Id]
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7);
2025-02-02 02:13:45.858 +03:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType9`2[[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Object, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-02-02 02:13:45.860 +03:00 [INF] Executed action NayifatAPI.Controllers.NotificationsController.GetNotifications (NayifatAPI) in 115.0077ms
2025-02-02 02:13:45.862 +03:00 [INF] Executed endpoint 'NayifatAPI.Controllers.NotificationsController.GetNotifications (NayifatAPI)'
2025-02-02 02:13:45.863 +03:00 [INF] Request finished HTTP/1.1 POST http://957c-51-252-155-185.ngrok-free.app/api/notifications/list - 200 null application/json; charset=utf-8 128.193ms
2025-02-02 02:15:21.872 +03:00 [INF] Request starting HTTP/1.1 POST http://957c-51-252-155-185.ngrok-free.app/api/auth/signin - application/json; charset=utf-8 224
2025-02-02 02:15:21.881 +03:00 [INF] Executing endpoint 'NayifatAPI.Controllers.AuthController.SignIn (NayifatAPI)'
2025-02-02 02:15:21.882 +03:00 [INF] Route matched with {action = "SignIn", controller = "Auth"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] SignIn(NayifatAPI.Controllers.SignInRequest) on controller NayifatAPI.Controllers.AuthController (NayifatAPI).
2025-02-02 02:15:21.891 +03:00 [INF] Executed DbCommand (6ms) [Parameters=[@__providedApiKey_0='?' (Size = 255)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [a].[Key], [a].[CreatedAt], [a].[Description], [a].[ExpiresAt], [a].[IsActive], [a].[LastUsedAt]
FROM [ApiKeys] AS [a]
WHERE [a].[Key] = @__providedApiKey_0 AND [a].[IsActive] = CAST(1 AS bit)
2025-02-02 02:15:21.896 +03:00 [INF] Executed DbCommand (2ms) [Parameters=[@__request_NationalId_0='?' (Size = 450)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [c].[NationalId], [c].[AddNo], [c].[BuildingNo], [c].[City], [c].[Consent], [c].[ConsentDate], [c].[DateOfBirth], [c].[Dependents], [c].[District], [c].[Email], [c].[Employer], [c].[FamilyNameAr], [c].[FamilyNameEn], [c].[FirstNameAr], [c].[FirstNameEn], [c].[Iban], [c].[IdExpiryDate], [c].[Los], [c].[Mpin], [c].[MpinEnabled], [c].[NafathStatus], [c].[NafathTimestamp], [c].[Password], [c].[Phone], [c].[RegistrationDate], [c].[SalaryCustomer], [c].[SalaryDakhli], [c].[SecondNameAr], [c].[SecondNameEn], [c].[Sector], [c].[Street], [c].[ThirdNameAr], [c].[ThirdNameEn], [c].[Zipcode]
FROM [Customers] AS [c]
WHERE [c].[NationalId] = @__request_NationalId_0
2025-02-02 02:15:21.898 +03:00 [INF] Starting password verification for NationalId: 1064448614
2025-02-02 02:15:22.094 +03:00 [INF] Password verification result for NationalId 1064448614: Success
2025-02-02 02:15:22.100 +03:00 [INF] Executed DbCommand (3ms) [Parameters=[@__request_NationalId_0='?' (Size = 450), @__request_DeviceId_1='?' (Size = 450)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [c].[Id], [c].[BiometricEnabled], [c].[BiometricToken], [c].[CreatedAt], [c].[DeviceId], [c].[LastUsedAt], [c].[Manufacturer], [c].[Model], [c].[NationalId], [c].[OsVersion], [c].[Platform], [c].[Status]
FROM [Customer_Devices] AS [c]
WHERE [c].[NationalId] = @__request_NationalId_0 AND [c].[DeviceId] = @__request_DeviceId_1 AND [c].[Status] = N'active'
2025-02-02 02:15:22.181 +03:00 [INF] Executed DbCommand (77ms) [Parameters=[@p0='?' (Size = 4000), @p1='?' (DbType = DateTime2), @p2='?' (Size = 4000), @p3='?' (Size = 4000), @p4='?' (Size = 4000), @p5='?' (Size = 450), @p6='?' (Size = 4000), @p7='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SET IMPLICIT_TRANSACTIONS OFF;
SET NOCOUNT ON;
INSERT INTO [AuthLogs] ([AuthType], [CreatedAt], [DeviceId], [FailureReason], [IpAddress], [NationalId], [Status], [UserAgent])
OUTPUT INSERTED.[Id]
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7);
2025-02-02 02:15:22.185 +03:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType9`2[[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Object, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-02-02 02:15:22.186 +03:00 [INF] Executed action NayifatAPI.Controllers.AuthController.SignIn (NayifatAPI) in 303.0577ms
2025-02-02 02:15:22.188 +03:00 [INF] Executed endpoint 'NayifatAPI.Controllers.AuthController.SignIn (NayifatAPI)'
2025-02-02 02:15:22.190 +03:00 [INF] Request finished HTTP/1.1 POST http://957c-51-252-155-185.ngrok-free.app/api/auth/signin - 200 null application/json; charset=utf-8 317.7199ms
2025-02-02 02:15:23.159 +03:00 [INF] Request starting HTTP/1.1 POST http://957c-51-252-155-185.ngrok-free.app/api/proxy/forward?url=https://icreditdept.com/api/testasp/test_local_generate_otp.php - application/json; charset=utf-8 84
2025-02-02 02:15:23.164 +03:00 [INF] Executing endpoint 'NayifatAPI.Controllers.ProxyController.ForwardRequest (NayifatAPI)'
2025-02-02 02:15:23.165 +03:00 [INF] Route matched with {action = "ForwardRequest", controller = "Proxy"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] ForwardRequest() on controller NayifatAPI.Controllers.ProxyController (NayifatAPI).
2025-02-02 02:15:23.167 +03:00 [INF] Start processing HTTP request POST https://icreditdept.com/api/testasp/test_local_generate_otp.php
2025-02-02 02:15:23.169 +03:00 [INF] Sending HTTP request POST https://icreditdept.com/api/testasp/test_local_generate_otp.php
2025-02-02 02:15:24.421 +03:00 [INF] Received HTTP response headers after 1251.0641ms - 200
2025-02-02 02:15:24.423 +03:00 [INF] End processing HTTP request after 1255.7453ms - 200
2025-02-02 02:15:24.425 +03:00 [INF] Raw response length: 200
2025-02-02 02:15:24.425 +03:00 [INF] Response content: {"success":true,"errors":[],"result":{"nationalId":"1064448614","otp":746951,"expiryDate":"2025-02-02 02:20:24","successMsg":"Success","errCode":0,"errMsg":null},"type":"N","message":null,"code":null}
2025-02-02 02:15:24.427 +03:00 [INF] Executing ContentResult with HTTP Response ContentType of application/json
2025-02-02 02:15:24.428 +03:00 [INF] Executed action NayifatAPI.Controllers.ProxyController.ForwardRequest (NayifatAPI) in 1260.8677ms
2025-02-02 02:15:24.429 +03:00 [INF] Executed endpoint 'NayifatAPI.Controllers.ProxyController.ForwardRequest (NayifatAPI)'
2025-02-02 02:15:24.431 +03:00 [INF] Request finished HTTP/1.1 POST http://957c-51-252-155-185.ngrok-free.app/api/proxy/forward?url=https://icreditdept.com/api/testasp/test_local_generate_otp.php - 200 200 application/json 1272.3149ms
2025-02-02 02:15:37.153 +03:00 [INF] Request starting HTTP/1.1 POST http://957c-51-252-155-185.ngrok-free.app/api/proxy/forward?url=https://icreditdept.com/api/testasp/test_local_verify_otp.php - application/json; charset=utf-8 53
2025-02-02 02:15:37.160 +03:00 [INF] Executing endpoint 'NayifatAPI.Controllers.ProxyController.ForwardRequest (NayifatAPI)'
2025-02-02 02:15:37.161 +03:00 [INF] Route matched with {action = "ForwardRequest", controller = "Proxy"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] ForwardRequest() on controller NayifatAPI.Controllers.ProxyController (NayifatAPI).
2025-02-02 02:15:37.163 +03:00 [INF] Start processing HTTP request POST https://icreditdept.com/api/testasp/test_local_verify_otp.php
2025-02-02 02:15:37.164 +03:00 [INF] Sending HTTP request POST https://icreditdept.com/api/testasp/test_local_verify_otp.php
2025-02-02 02:15:37.621 +03:00 [INF] Received HTTP response headers after 454.3038ms - 200
2025-02-02 02:15:37.624 +03:00 [INF] End processing HTTP request after 460.4984ms - 200
2025-02-02 02:15:37.628 +03:00 [INF] Raw response length: 202
2025-02-02 02:15:37.629 +03:00 [INF] Response content: {"success":true,"errors":[],"result":{"nationalId":"1064448614","otp":"746951","verifiedFlag":true,"successMsg":"Verified successfully.","errCode":0,"errMsg":null},"type":"N","message":null,"code":null}
2025-02-02 02:15:37.630 +03:00 [INF] Executing ContentResult with HTTP Response ContentType of application/json
2025-02-02 02:15:37.631 +03:00 [INF] Executed action NayifatAPI.Controllers.ProxyController.ForwardRequest (NayifatAPI) in 467.953ms
2025-02-02 02:15:37.633 +03:00 [INF] Executed endpoint 'NayifatAPI.Controllers.ProxyController.ForwardRequest (NayifatAPI)'
2025-02-02 02:15:37.634 +03:00 [INF] Request finished HTTP/1.1 POST http://957c-51-252-155-185.ngrok-free.app/api/proxy/forward?url=https://icreditdept.com/api/testasp/test_local_verify_otp.php - 200 202 application/json 481.64ms
2025-02-02 02:17:38.928 +03:00 [INF] Request starting HTTP/1.1 POST http://957c-51-252-155-185.ngrok-free.app/api/proxy/forward?url=https://icreditdept.com/api/testasp/test_local_verify_otp.php - application/json; charset=utf-8 53
2025-02-02 02:17:38.932 +03:00 [INF] Executing endpoint 'NayifatAPI.Controllers.ProxyController.ForwardRequest (NayifatAPI)'
2025-02-02 02:17:38.932 +03:00 [INF] Route matched with {action = "ForwardRequest", controller = "Proxy"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] ForwardRequest() on controller NayifatAPI.Controllers.ProxyController (NayifatAPI).
2025-02-02 02:17:38.934 +03:00 [INF] Start processing HTTP request POST https://icreditdept.com/api/testasp/test_local_verify_otp.php
2025-02-02 02:17:38.936 +03:00 [INF] Sending HTTP request POST https://icreditdept.com/api/testasp/test_local_verify_otp.php
2025-02-02 02:17:39.665 +03:00 [INF] Received HTTP response headers after 728.2807ms - 200
2025-02-02 02:17:39.666 +03:00 [INF] End processing HTTP request after 731.9936ms - 200
2025-02-02 02:17:39.668 +03:00 [INF] Raw response length: 43
2025-02-02 02:17:39.669 +03:00 [INF] Response content: {"success":false,"message":"Incorrect OTP"}
2025-02-02 02:17:39.670 +03:00 [INF] Executing ContentResult with HTTP Response ContentType of application/json
2025-02-02 02:17:39.671 +03:00 [INF] Executed action NayifatAPI.Controllers.ProxyController.ForwardRequest (NayifatAPI) in 736.8468ms
2025-02-02 02:17:39.672 +03:00 [INF] Executed endpoint 'NayifatAPI.Controllers.ProxyController.ForwardRequest (NayifatAPI)'
2025-02-02 02:17:39.674 +03:00 [INF] Request finished HTTP/1.1 POST http://957c-51-252-155-185.ngrok-free.app/api/proxy/forward?url=https://icreditdept.com/api/testasp/test_local_verify_otp.php - 200 43 application/json 746.8621ms
2025-02-02 02:18:13.117 +03:00 [INF] Request starting HTTP/1.1 POST http://957c-51-252-155-185.ngrok-free.app/api/notifications/list - application/json; charset=utf-8 47
2025-02-02 02:18:13.126 +03:00 [INF] Executing endpoint 'NayifatAPI.Controllers.NotificationsController.GetNotifications (NayifatAPI)'
2025-02-02 02:18:13.127 +03:00 [INF] Route matched with {action = "GetNotifications", controller = "Notifications"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetNotifications(NayifatAPI.Controllers.GetNotificationsRequest) on controller NayifatAPI.Controllers.NotificationsController (NayifatAPI).
2025-02-02 02:18:13.132 +03:00 [INF] Executed DbCommand (2ms) [Parameters=[@__providedApiKey_0='?' (Size = 255)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [a].[Key], [a].[CreatedAt], [a].[Description], [a].[ExpiresAt], [a].[IsActive], [a].[LastUsedAt]
FROM [ApiKeys] AS [a]
WHERE [a].[Key] = @__providedApiKey_0 AND [a].[IsActive] = CAST(1 AS bit)
2025-02-02 02:18:13.136 +03:00 [INF] Executed DbCommand (2ms) [Parameters=[@__request_NationalId_0='?' (Size = 450)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [u].[national_id], [u].[last_updated], [u].[notifications]
FROM [user_notifications] AS [u]
WHERE [u].[national_id] = @__request_NationalId_0
2025-02-02 02:18:13.139 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@__Parse_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [n].[Id], [n].[additional_data], [n].[Body], [n].[body_ar], [n].[body_en], [n].[created_at], [n].[expiry_at], [n].[Route], [n].[target_criteria], [n].[Title], [n].[title_ar], [n].[title_en]
FROM [notification_templates] AS [n]
WHERE [n].[Id] = @__Parse_0
2025-02-02 02:18:13.143 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@__Parse_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [n].[Id], [n].[additional_data], [n].[Body], [n].[body_ar], [n].[body_en], [n].[created_at], [n].[expiry_at], [n].[Route], [n].[target_criteria], [n].[Title], [n].[title_ar], [n].[title_en]
FROM [notification_templates] AS [n]
WHERE [n].[Id] = @__Parse_0
2025-02-02 02:18:13.220 +03:00 [INF] Executed DbCommand (76ms) [Parameters=[@p0='?' (Size = 4000), @p1='?' (DbType = DateTime2), @p2='?' (Size = 4000), @p3='?' (Size = 4000), @p4='?' (Size = 4000), @p5='?' (Size = 450), @p6='?' (Size = 4000), @p7='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SET IMPLICIT_TRANSACTIONS OFF;
SET NOCOUNT ON;
INSERT INTO [AuthLogs] ([AuthType], [CreatedAt], [DeviceId], [FailureReason], [IpAddress], [NationalId], [Status], [UserAgent])
OUTPUT INSERTED.[Id]
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7);
2025-02-02 02:18:13.224 +03:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType9`2[[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Object, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-02-02 02:18:13.226 +03:00 [INF] Executed action NayifatAPI.Controllers.NotificationsController.GetNotifications (NayifatAPI) in 97.1968ms
2025-02-02 02:18:13.227 +03:00 [INF] Executed endpoint 'NayifatAPI.Controllers.NotificationsController.GetNotifications (NayifatAPI)'
2025-02-02 02:18:13.230 +03:00 [INF] Request finished HTTP/1.1 POST http://957c-51-252-155-185.ngrok-free.app/api/notifications/list - 200 null application/json; charset=utf-8 113.3071ms
2025-02-02 02:18:39.914 +03:00 [INF] Request starting HTTP/1.1 POST http://957c-51-252-155-185.ngrok-free.app/api/auth/signin - application/json; charset=utf-8 224
2025-02-02 02:18:39.916 +03:00 [INF] Executing endpoint 'NayifatAPI.Controllers.AuthController.SignIn (NayifatAPI)'
2025-02-02 02:18:39.917 +03:00 [INF] Route matched with {action = "SignIn", controller = "Auth"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] SignIn(NayifatAPI.Controllers.SignInRequest) on controller NayifatAPI.Controllers.AuthController (NayifatAPI).
2025-02-02 02:18:39.920 +03:00 [INF] Executed DbCommand (0ms) [Parameters=[@__providedApiKey_0='?' (Size = 255)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [a].[Key], [a].[CreatedAt], [a].[Description], [a].[ExpiresAt], [a].[IsActive], [a].[LastUsedAt]
FROM [ApiKeys] AS [a]
WHERE [a].[Key] = @__providedApiKey_0 AND [a].[IsActive] = CAST(1 AS bit)
2025-02-02 02:18:39.924 +03:00 [INF] Executed DbCommand (2ms) [Parameters=[@__request_NationalId_0='?' (Size = 450)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [c].[NationalId], [c].[AddNo], [c].[BuildingNo], [c].[City], [c].[Consent], [c].[ConsentDate], [c].[DateOfBirth], [c].[Dependents], [c].[District], [c].[Email], [c].[Employer], [c].[FamilyNameAr], [c].[FamilyNameEn], [c].[FirstNameAr], [c].[FirstNameEn], [c].[Iban], [c].[IdExpiryDate], [c].[Los], [c].[Mpin], [c].[MpinEnabled], [c].[NafathStatus], [c].[NafathTimestamp], [c].[Password], [c].[Phone], [c].[RegistrationDate], [c].[SalaryCustomer], [c].[SalaryDakhli], [c].[SecondNameAr], [c].[SecondNameEn], [c].[Sector], [c].[Street], [c].[ThirdNameAr], [c].[ThirdNameEn], [c].[Zipcode]
FROM [Customers] AS [c]
WHERE [c].[NationalId] = @__request_NationalId_0
2025-02-02 02:18:39.927 +03:00 [INF] Starting password verification for NationalId: 1064448614
2025-02-02 02:18:40.108 +03:00 [INF] Password verification result for NationalId 1064448614: Success
2025-02-02 02:18:40.114 +03:00 [INF] Executed DbCommand (4ms) [Parameters=[@__request_NationalId_0='?' (Size = 450), @__request_DeviceId_1='?' (Size = 450)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [c].[Id], [c].[BiometricEnabled], [c].[BiometricToken], [c].[CreatedAt], [c].[DeviceId], [c].[LastUsedAt], [c].[Manufacturer], [c].[Model], [c].[NationalId], [c].[OsVersion], [c].[Platform], [c].[Status]
FROM [Customer_Devices] AS [c]
WHERE [c].[NationalId] = @__request_NationalId_0 AND [c].[DeviceId] = @__request_DeviceId_1 AND [c].[Status] = N'active'
2025-02-02 02:18:40.120 +03:00 [INF] Executed DbCommand (4ms) [Parameters=[@p0='?' (Size = 4000), @p1='?' (DbType = DateTime2), @p2='?' (Size = 4000), @p3='?' (Size = 4000), @p4='?' (Size = 4000), @p5='?' (Size = 450), @p6='?' (Size = 4000), @p7='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SET IMPLICIT_TRANSACTIONS OFF;
SET NOCOUNT ON;
INSERT INTO [AuthLogs] ([AuthType], [CreatedAt], [DeviceId], [FailureReason], [IpAddress], [NationalId], [Status], [UserAgent])
OUTPUT INSERTED.[Id]
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7);
2025-02-02 02:18:40.122 +03:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType9`2[[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Object, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-02-02 02:18:40.123 +03:00 [INF] Executed action NayifatAPI.Controllers.AuthController.SignIn (NayifatAPI) in 204.3036ms
2025-02-02 02:18:40.124 +03:00 [INF] Executed endpoint 'NayifatAPI.Controllers.AuthController.SignIn (NayifatAPI)'
2025-02-02 02:18:40.126 +03:00 [INF] Request finished HTTP/1.1 POST http://957c-51-252-155-185.ngrok-free.app/api/auth/signin - 200 null application/json; charset=utf-8 211.8736ms
2025-02-02 02:18:41.143 +03:00 [INF] Request starting HTTP/1.1 POST http://957c-51-252-155-185.ngrok-free.app/api/proxy/forward?url=https://icreditdept.com/api/testasp/test_local_generate_otp.php - application/json; charset=utf-8 84
2025-02-02 02:18:41.148 +03:00 [INF] Executing endpoint 'NayifatAPI.Controllers.ProxyController.ForwardRequest (NayifatAPI)'
2025-02-02 02:18:41.149 +03:00 [INF] Route matched with {action = "ForwardRequest", controller = "Proxy"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] ForwardRequest() on controller NayifatAPI.Controllers.ProxyController (NayifatAPI).
2025-02-02 02:18:41.150 +03:00 [INF] Start processing HTTP request POST https://icreditdept.com/api/testasp/test_local_generate_otp.php
2025-02-02 02:18:41.151 +03:00 [INF] Sending HTTP request POST https://icreditdept.com/api/testasp/test_local_generate_otp.php
2025-02-02 02:18:41.626 +03:00 [INF] Received HTTP response headers after 473.9374ms - 200
2025-02-02 02:18:41.630 +03:00 [INF] End processing HTTP request after 479.3377ms - 200
2025-02-02 02:18:41.633 +03:00 [INF] Raw response length: 200
2025-02-02 02:18:41.633 +03:00 [INF] Response content: {"success":true,"errors":[],"result":{"nationalId":"1064448614","otp":473752,"expiryDate":"2025-02-02 02:23:41","successMsg":"Success","errCode":0,"errMsg":null},"type":"N","message":null,"code":null}
2025-02-02 02:18:41.634 +03:00 [INF] Executing ContentResult with HTTP Response ContentType of application/json
2025-02-02 02:18:41.635 +03:00 [INF] Executed action NayifatAPI.Controllers.ProxyController.ForwardRequest (NayifatAPI) in 484.4291ms
2025-02-02 02:18:41.636 +03:00 [INF] Executed endpoint 'NayifatAPI.Controllers.ProxyController.ForwardRequest (NayifatAPI)'
2025-02-02 02:18:41.637 +03:00 [INF] Request finished HTTP/1.1 POST http://957c-51-252-155-185.ngrok-free.app/api/proxy/forward?url=https://icreditdept.com/api/testasp/test_local_generate_otp.php - 200 200 application/json 494.0494ms
2025-02-02 02:18:55.868 +03:00 [INF] Request starting HTTP/1.1 POST http://957c-51-252-155-185.ngrok-free.app/api/proxy/forward?url=https://icreditdept.com/api/testasp/test_local_verify_otp.php - application/json; charset=utf-8 53
2025-02-02 02:18:55.871 +03:00 [INF] Executing endpoint 'NayifatAPI.Controllers.ProxyController.ForwardRequest (NayifatAPI)'
2025-02-02 02:18:55.871 +03:00 [INF] Route matched with {action = "ForwardRequest", controller = "Proxy"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] ForwardRequest() on controller NayifatAPI.Controllers.ProxyController (NayifatAPI).
2025-02-02 02:18:55.873 +03:00 [INF] Start processing HTTP request POST https://icreditdept.com/api/testasp/test_local_verify_otp.php
2025-02-02 02:18:55.873 +03:00 [INF] Sending HTTP request POST https://icreditdept.com/api/testasp/test_local_verify_otp.php
2025-02-02 02:18:56.349 +03:00 [INF] Received HTTP response headers after 474.2419ms - 200
2025-02-02 02:18:56.352 +03:00 [INF] End processing HTTP request after 478.9496ms - 200
2025-02-02 02:18:56.353 +03:00 [INF] Raw response length: 202
2025-02-02 02:18:56.353 +03:00 [INF] Response content: {"success":true,"errors":[],"result":{"nationalId":"1064448614","otp":"473752","verifiedFlag":true,"successMsg":"Verified successfully.","errCode":0,"errMsg":null},"type":"N","message":null,"code":null}
2025-02-02 02:18:56.354 +03:00 [INF] Executing ContentResult with HTTP Response ContentType of application/json
2025-02-02 02:18:56.354 +03:00 [INF] Executed action NayifatAPI.Controllers.ProxyController.ForwardRequest (NayifatAPI) in 482.0199ms
2025-02-02 02:18:56.356 +03:00 [INF] Executed endpoint 'NayifatAPI.Controllers.ProxyController.ForwardRequest (NayifatAPI)'
2025-02-02 02:18:56.356 +03:00 [INF] Request finished HTTP/1.1 POST http://957c-51-252-155-185.ngrok-free.app/api/proxy/forward?url=https://icreditdept.com/api/testasp/test_local_verify_otp.php - 200 202 application/json 488.5138ms
2025-02-02 02:18:57.468 +03:00 [INF] Request starting HTTP/1.1 POST http://957c-51-252-155-185.ngrok-free.app/api/auth/signin - application/json; charset=utf-8 49
2025-02-02 02:18:57.473 +03:00 [INF] Executing endpoint 'NayifatAPI.Controllers.AuthController.SignIn (NayifatAPI)'
2025-02-02 02:18:57.474 +03:00 [INF] Route matched with {action = "SignIn", controller = "Auth"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] SignIn(NayifatAPI.Controllers.SignInRequest) on controller NayifatAPI.Controllers.AuthController (NayifatAPI).
2025-02-02 02:18:57.476 +03:00 [INF] Executing BadRequestObjectResult, writing value of type 'Microsoft.AspNetCore.Mvc.ValidationProblemDetails'.
2025-02-02 02:18:57.477 +03:00 [INF] Executed action NayifatAPI.Controllers.AuthController.SignIn (NayifatAPI) in 1.7048ms
2025-02-02 02:18:57.478 +03:00 [INF] Executed endpoint 'NayifatAPI.Controllers.AuthController.SignIn (NayifatAPI)'
2025-02-02 02:18:57.479 +03:00 [INF] Request finished HTTP/1.1 POST http://957c-51-252-155-185.ngrok-free.app/api/auth/signin - 400 null application/problem+json; charset=utf-8 10.421ms
2025-02-02 03:21:01.980 +03:00 [INF] Request starting HTTP/1.1 POST http://957c-51-252-155-185.ngrok-free.app/api/notifications/list - application/json; charset=utf-8 47
2025-02-02 03:21:01.985 +03:00 [INF] Executing endpoint 'NayifatAPI.Controllers.NotificationsController.GetNotifications (NayifatAPI)'
2025-02-02 03:21:01.987 +03:00 [INF] Route matched with {action = "GetNotifications", controller = "Notifications"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetNotifications(NayifatAPI.Controllers.GetNotificationsRequest) on controller NayifatAPI.Controllers.NotificationsController (NayifatAPI).
2025-02-02 03:21:02.015 +03:00 [INF] Executed DbCommand (17ms) [Parameters=[@__providedApiKey_0='?' (Size = 255)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [a].[Key], [a].[CreatedAt], [a].[Description], [a].[ExpiresAt], [a].[IsActive], [a].[LastUsedAt]
FROM [ApiKeys] AS [a]
WHERE [a].[Key] = @__providedApiKey_0 AND [a].[IsActive] = CAST(1 AS bit)
2025-02-02 03:21:02.022 +03:00 [INF] Executed DbCommand (4ms) [Parameters=[@__request_NationalId_0='?' (Size = 450)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [u].[national_id], [u].[last_updated], [u].[notifications]
FROM [user_notifications] AS [u]
WHERE [u].[national_id] = @__request_NationalId_0
2025-02-02 03:21:02.029 +03:00 [INF] Executed DbCommand (4ms) [Parameters=[@__Parse_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [n].[Id], [n].[additional_data], [n].[Body], [n].[body_ar], [n].[body_en], [n].[created_at], [n].[expiry_at], [n].[Route], [n].[target_criteria], [n].[Title], [n].[title_ar], [n].[title_en]
FROM [notification_templates] AS [n]
WHERE [n].[Id] = @__Parse_0
2025-02-02 03:21:02.032 +03:00 [INF] Executed DbCommand (0ms) [Parameters=[@__Parse_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [n].[Id], [n].[additional_data], [n].[Body], [n].[body_ar], [n].[body_en], [n].[created_at], [n].[expiry_at], [n].[Route], [n].[target_criteria], [n].[Title], [n].[title_ar], [n].[title_en]
FROM [notification_templates] AS [n]
WHERE [n].[Id] = @__Parse_0
2025-02-02 03:21:02.042 +03:00 [INF] Executed DbCommand (7ms) [Parameters=[@p0='?' (Size = 4000), @p1='?' (DbType = DateTime2), @p2='?' (Size = 4000), @p3='?' (Size = 4000), @p4='?' (Size = 4000), @p5='?' (Size = 450), @p6='?' (Size = 4000), @p7='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SET IMPLICIT_TRANSACTIONS OFF;
SET NOCOUNT ON;
INSERT INTO [AuthLogs] ([AuthType], [CreatedAt], [DeviceId], [FailureReason], [IpAddress], [NationalId], [Status], [UserAgent])
OUTPUT INSERTED.[Id]
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7);
2025-02-02 03:21:02.046 +03:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType9`2[[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Object, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-02-02 03:21:02.048 +03:00 [INF] Executed action NayifatAPI.Controllers.NotificationsController.GetNotifications (NayifatAPI) in 58.4184ms
2025-02-02 03:21:02.049 +03:00 [INF] Executed endpoint 'NayifatAPI.Controllers.NotificationsController.GetNotifications (NayifatAPI)'
2025-02-02 03:21:02.051 +03:00 [INF] Request finished HTTP/1.1 POST http://957c-51-252-155-185.ngrok-free.app/api/notifications/list - 200 null application/json; charset=utf-8 71.2299ms
2025-02-02 04:21:11.163 +03:00 [INF] Request starting HTTP/1.1 POST http://957c-51-252-155-185.ngrok-free.app/api/notifications/list - application/json; charset=utf-8 47
2025-02-02 04:21:11.405 +03:00 [INF] Executing endpoint 'NayifatAPI.Controllers.NotificationsController.GetNotifications (NayifatAPI)'
2025-02-02 04:21:11.406 +03:00 [INF] Route matched with {action = "GetNotifications", controller = "Notifications"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetNotifications(NayifatAPI.Controllers.GetNotificationsRequest) on controller NayifatAPI.Controllers.NotificationsController (NayifatAPI).
2025-02-02 04:21:12.065 +03:00 [INF] Executed DbCommand (361ms) [Parameters=[@__providedApiKey_0='?' (Size = 255)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [a].[Key], [a].[CreatedAt], [a].[Description], [a].[ExpiresAt], [a].[IsActive], [a].[LastUsedAt]
FROM [ApiKeys] AS [a]
WHERE [a].[Key] = @__providedApiKey_0 AND [a].[IsActive] = CAST(1 AS bit)
2025-02-02 04:21:12.194 +03:00 [INF] Executed DbCommand (55ms) [Parameters=[@__request_NationalId_0='?' (Size = 450)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [u].[national_id], [u].[last_updated], [u].[notifications]
FROM [user_notifications] AS [u]
WHERE [u].[national_id] = @__request_NationalId_0
2025-02-02 04:21:12.205 +03:00 [INF] Executed DbCommand (3ms) [Parameters=[@__Parse_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [n].[Id], [n].[additional_data], [n].[Body], [n].[body_ar], [n].[body_en], [n].[created_at], [n].[expiry_at], [n].[Route], [n].[target_criteria], [n].[Title], [n].[title_ar], [n].[title_en]
FROM [notification_templates] AS [n]
WHERE [n].[Id] = @__Parse_0
2025-02-02 04:21:12.208 +03:00 [INF] Executed DbCommand (0ms) [Parameters=[@__Parse_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [n].[Id], [n].[additional_data], [n].[Body], [n].[body_ar], [n].[body_en], [n].[created_at], [n].[expiry_at], [n].[Route], [n].[target_criteria], [n].[Title], [n].[title_ar], [n].[title_en]
FROM [notification_templates] AS [n]
WHERE [n].[Id] = @__Parse_0
2025-02-02 04:21:12.218 +03:00 [INF] Executed DbCommand (7ms) [Parameters=[@p0='?' (Size = 4000), @p1='?' (DbType = DateTime2), @p2='?' (Size = 4000), @p3='?' (Size = 4000), @p4='?' (Size = 4000), @p5='?' (Size = 450), @p6='?' (Size = 4000), @p7='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SET IMPLICIT_TRANSACTIONS OFF;
SET NOCOUNT ON;
INSERT INTO [AuthLogs] ([AuthType], [CreatedAt], [DeviceId], [FailureReason], [IpAddress], [NationalId], [Status], [UserAgent])
OUTPUT INSERTED.[Id]
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7);
2025-02-02 04:21:12.220 +03:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType9`2[[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Object, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-02-02 04:21:12.221 +03:00 [INF] Executed action NayifatAPI.Controllers.NotificationsController.GetNotifications (NayifatAPI) in 812.3246ms
2025-02-02 04:21:12.222 +03:00 [INF] Executed endpoint 'NayifatAPI.Controllers.NotificationsController.GetNotifications (NayifatAPI)'
2025-02-02 04:21:12.223 +03:00 [INF] Request finished HTTP/1.1 POST http://957c-51-252-155-185.ngrok-free.app/api/notifications/list - 200 null application/json; charset=utf-8 1060.6727ms
2025-02-02 06:21:46.739 +03:00 [INF] Request starting HTTP/1.1 POST http://957c-51-252-155-185.ngrok-free.app/api/notifications/list - application/json; charset=utf-8 47
2025-02-02 06:21:46.743 +03:00 [INF] Executing endpoint 'NayifatAPI.Controllers.NotificationsController.GetNotifications (NayifatAPI)'
2025-02-02 06:21:46.744 +03:00 [INF] Route matched with {action = "GetNotifications", controller = "Notifications"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetNotifications(NayifatAPI.Controllers.GetNotificationsRequest) on controller NayifatAPI.Controllers.NotificationsController (NayifatAPI).
2025-02-02 06:21:46.948 +03:00 [INF] Executed DbCommand (86ms) [Parameters=[@__providedApiKey_0='?' (Size = 255)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [a].[Key], [a].[CreatedAt], [a].[Description], [a].[ExpiresAt], [a].[IsActive], [a].[LastUsedAt]
FROM [ApiKeys] AS [a]
WHERE [a].[Key] = @__providedApiKey_0 AND [a].[IsActive] = CAST(1 AS bit)
2025-02-02 06:21:46.960 +03:00 [INF] Executed DbCommand (6ms) [Parameters=[@__request_NationalId_0='?' (Size = 450)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [u].[national_id], [u].[last_updated], [u].[notifications]
FROM [user_notifications] AS [u]
WHERE [u].[national_id] = @__request_NationalId_0
2025-02-02 06:21:46.969 +03:00 [INF] Executed DbCommand (4ms) [Parameters=[@__Parse_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [n].[Id], [n].[additional_data], [n].[Body], [n].[body_ar], [n].[body_en], [n].[created_at], [n].[expiry_at], [n].[Route], [n].[target_criteria], [n].[Title], [n].[title_ar], [n].[title_en]
FROM [notification_templates] AS [n]
WHERE [n].[Id] = @__Parse_0
2025-02-02 06:21:46.973 +03:00 [INF] Executed DbCommand (0ms) [Parameters=[@__Parse_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [n].[Id], [n].[additional_data], [n].[Body], [n].[body_ar], [n].[body_en], [n].[created_at], [n].[expiry_at], [n].[Route], [n].[target_criteria], [n].[Title], [n].[title_ar], [n].[title_en]
FROM [notification_templates] AS [n]
WHERE [n].[Id] = @__Parse_0
2025-02-02 06:21:46.985 +03:00 [INF] Executed DbCommand (8ms) [Parameters=[@p0='?' (Size = 4000), @p1='?' (DbType = DateTime2), @p2='?' (Size = 4000), @p3='?' (Size = 4000), @p4='?' (Size = 4000), @p5='?' (Size = 450), @p6='?' (Size = 4000), @p7='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SET IMPLICIT_TRANSACTIONS OFF;
SET NOCOUNT ON;
INSERT INTO [AuthLogs] ([AuthType], [CreatedAt], [DeviceId], [FailureReason], [IpAddress], [NationalId], [Status], [UserAgent])
OUTPUT INSERTED.[Id]
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7);
2025-02-02 06:21:46.989 +03:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType9`2[[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Object, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-02-02 06:21:46.990 +03:00 [INF] Executed action NayifatAPI.Controllers.NotificationsController.GetNotifications (NayifatAPI) in 242.5046ms
2025-02-02 06:21:46.992 +03:00 [INF] Executed endpoint 'NayifatAPI.Controllers.NotificationsController.GetNotifications (NayifatAPI)'
2025-02-02 06:21:46.993 +03:00 [INF] Request finished HTTP/1.1 POST http://957c-51-252-155-185.ngrok-free.app/api/notifications/list - 200 null application/json; charset=utf-8 254.2071ms
2025-02-02 09:23:19.217 +03:00 [INF] Starting web application
2025-02-02 09:23:19.573 +03:00 [INF] Now listening on: http://localhost:5264
2025-02-02 09:23:19.592 +03:00 [INF] Application started. Press Ctrl+C to shut down.
2025-02-02 09:23:19.607 +03:00 [INF] Hosting environment: Development
2025-02-02 09:23:19.610 +03:00 [INF] Content root path: C:\Users\yamta\StudioProjects\nayifat_app_2025_new\nayifatapi
2025-02-02 09:31:19.844 +03:00 [INF] Request starting HTTP/1.1 POST http://e04c-46-152-255-232.ngrok-free.app/api/auth/signin - application/json; charset=utf-8 224
2025-02-02 09:31:19.895 +03:00 [WRN] Failed to determine the https port for redirect.
2025-02-02 09:31:19.898 +03:00 [INF] Executing endpoint 'NayifatAPI.Controllers.AuthController.SignIn (NayifatAPI)'
2025-02-02 09:31:19.922 +03:00 [INF] Route matched with {action = "SignIn", controller = "Auth"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] SignIn(NayifatAPI.Controllers.SignInRequest) on controller NayifatAPI.Controllers.AuthController (NayifatAPI).
2025-02-02 09:31:21.413 +03:00 [INF] Executed DbCommand (34ms) [Parameters=[@__providedApiKey_0='?' (Size = 255)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [a].[Key], [a].[CreatedAt], [a].[Description], [a].[ExpiresAt], [a].[IsActive], [a].[LastUsedAt]
FROM [ApiKeys] AS [a]
WHERE [a].[Key] = @__providedApiKey_0 AND [a].[IsActive] = CAST(1 AS bit)
2025-02-02 09:31:21.524 +03:00 [INF] Executed DbCommand (21ms) [Parameters=[@__request_NationalId_0='?' (Size = 450)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [c].[NationalId], [c].[AddNo], [c].[BuildingNo], [c].[City], [c].[Consent], [c].[ConsentDate], [c].[DateOfBirth], [c].[Dependents], [c].[District], [c].[Email], [c].[Employer], [c].[FamilyNameAr], [c].[FamilyNameEn], [c].[FirstNameAr], [c].[FirstNameEn], [c].[Iban], [c].[IdExpiryDate], [c].[Los], [c].[Mpin], [c].[MpinEnabled], [c].[NafathStatus], [c].[NafathTimestamp], [c].[Password], [c].[Phone], [c].[RegistrationDate], [c].[SalaryCustomer], [c].[SalaryDakhli], [c].[SecondNameAr], [c].[SecondNameEn], [c].[Sector], [c].[Street], [c].[ThirdNameAr], [c].[ThirdNameEn], [c].[Zipcode]
FROM [Customers] AS [c]
WHERE [c].[NationalId] = @__request_NationalId_0
2025-02-02 09:31:21.611 +03:00 [INF] Starting password verification for NationalId: 1064448614
2025-02-02 09:31:21.992 +03:00 [INF] Password verification result for NationalId 1064448614: Success
2025-02-02 09:31:22.020 +03:00 [INF] Executed DbCommand (10ms) [Parameters=[@__request_NationalId_0='?' (Size = 450), @__request_DeviceId_1='?' (Size = 450)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [c].[Id], [c].[BiometricEnabled], [c].[BiometricToken], [c].[CreatedAt], [c].[DeviceId], [c].[LastUsedAt], [c].[Manufacturer], [c].[Model], [c].[NationalId], [c].[OsVersion], [c].[Platform], [c].[Status]
FROM [Customer_Devices] AS [c]
WHERE [c].[NationalId] = @__request_NationalId_0 AND [c].[DeviceId] = @__request_DeviceId_1 AND [c].[Status] = N'active'
2025-02-02 09:31:22.219 +03:00 [INF] Executed DbCommand (13ms) [Parameters=[@p0='?' (Size = 4000), @p1='?' (DbType = DateTime2), @p2='?' (Size = 4000), @p3='?' (Size = 4000), @p4='?' (Size = 4000), @p5='?' (Size = 450), @p6='?' (Size = 4000), @p7='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SET IMPLICIT_TRANSACTIONS OFF;
SET NOCOUNT ON;
INSERT INTO [AuthLogs] ([AuthType], [CreatedAt], [DeviceId], [FailureReason], [IpAddress], [NationalId], [Status], [UserAgent])
OUTPUT INSERTED.[Id]
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7);
2025-02-02 09:31:22.256 +03:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType9`2[[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Object, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-02-02 09:31:22.277 +03:00 [INF] Executed action NayifatAPI.Controllers.AuthController.SignIn (NayifatAPI) in 2348.1531ms
2025-02-02 09:31:22.280 +03:00 [INF] Executed endpoint 'NayifatAPI.Controllers.AuthController.SignIn (NayifatAPI)'
2025-02-02 09:31:22.291 +03:00 [INF] Request finished HTTP/1.1 POST http://e04c-46-152-255-232.ngrok-free.app/api/auth/signin - 200 null application/json; charset=utf-8 2448.1847ms
2025-02-02 09:31:22.772 +03:00 [INF] Request starting HTTP/1.1 POST http://e04c-46-152-255-232.ngrok-free.app/api/proxy/forward?url=https://icreditdept.com/api/testasp/test_local_generate_otp.php - application/json; charset=utf-8 84
2025-02-02 09:31:22.779 +03:00 [INF] Executing endpoint 'NayifatAPI.Controllers.ProxyController.ForwardRequest (NayifatAPI)'
2025-02-02 09:31:22.784 +03:00 [INF] Route matched with {action = "ForwardRequest", controller = "Proxy"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] ForwardRequest() on controller NayifatAPI.Controllers.ProxyController (NayifatAPI).
2025-02-02 09:31:22.807 +03:00 [INF] Start processing HTTP request POST https://icreditdept.com/api/testasp/test_local_generate_otp.php
2025-02-02 09:31:22.809 +03:00 [INF] Sending HTTP request POST https://icreditdept.com/api/testasp/test_local_generate_otp.php
2025-02-02 09:31:23.413 +03:00 [INF] Received HTTP response headers after 601.0249ms - 200
2025-02-02 09:31:23.415 +03:00 [INF] End processing HTTP request after 609.8735ms - 200
2025-02-02 09:31:23.423 +03:00 [INF] Raw response length: 200
2025-02-02 09:31:23.424 +03:00 [INF] Response content: {"success":true,"errors":[],"result":{"nationalId":"1064448614","otp":947942,"expiryDate":"2025-02-02 09:36:23","successMsg":"Success","errCode":0,"errMsg":null},"type":"N","message":null,"code":null}
2025-02-02 09:31:23.426 +03:00 [INF] Executing ContentResult with HTTP Response ContentType of application/json
2025-02-02 09:31:23.428 +03:00 [INF] Executed action NayifatAPI.Controllers.ProxyController.ForwardRequest (NayifatAPI) in 641.7914ms
2025-02-02 09:31:23.429 +03:00 [INF] Executed endpoint 'NayifatAPI.Controllers.ProxyController.ForwardRequest (NayifatAPI)'
2025-02-02 09:31:23.431 +03:00 [INF] Request finished HTTP/1.1 POST http://e04c-46-152-255-232.ngrok-free.app/api/proxy/forward?url=https://icreditdept.com/api/testasp/test_local_generate_otp.php - 200 200 application/json 658.9579ms
2025-02-02 09:32:04.304 +03:00 [INF] Request starting HTTP/1.1 POST http://e04c-46-152-255-232.ngrok-free.app/api/proxy/forward?url=https://icreditdept.com/api/testasp/test_local_verify_otp.php - application/json; charset=utf-8 53
2025-02-02 09:32:04.308 +03:00 [INF] Executing endpoint 'NayifatAPI.Controllers.ProxyController.ForwardRequest (NayifatAPI)'
2025-02-02 09:32:04.309 +03:00 [INF] Route matched with {action = "ForwardRequest", controller = "Proxy"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] ForwardRequest() on controller NayifatAPI.Controllers.ProxyController (NayifatAPI).
2025-02-02 09:32:04.314 +03:00 [INF] Start processing HTTP request POST https://icreditdept.com/api/testasp/test_local_verify_otp.php
2025-02-02 09:32:04.315 +03:00 [INF] Sending HTTP request POST https://icreditdept.com/api/testasp/test_local_verify_otp.php
2025-02-02 09:32:04.624 +03:00 [INF] Received HTTP response headers after 308.2835ms - 200
2025-02-02 09:32:04.626 +03:00 [INF] End processing HTTP request after 312.5939ms - 200
2025-02-02 09:32:04.629 +03:00 [INF] Raw response length: 202
2025-02-02 09:32:04.630 +03:00 [INF] Response content: {"success":true,"errors":[],"result":{"nationalId":"1064448614","otp":"947942","verifiedFlag":true,"successMsg":"Verified successfully.","errCode":0,"errMsg":null},"type":"N","message":null,"code":null}
2025-02-02 09:32:04.631 +03:00 [INF] Executing ContentResult with HTTP Response ContentType of application/json
2025-02-02 09:32:04.632 +03:00 [INF] Executed action NayifatAPI.Controllers.ProxyController.ForwardRequest (NayifatAPI) in 320.3444ms
2025-02-02 09:32:04.634 +03:00 [INF] Executed endpoint 'NayifatAPI.Controllers.ProxyController.ForwardRequest (NayifatAPI)'
2025-02-02 09:32:04.635 +03:00 [INF] Request finished HTTP/1.1 POST http://e04c-46-152-255-232.ngrok-free.app/api/proxy/forward?url=https://icreditdept.com/api/testasp/test_local_verify_otp.php - 200 202 application/json 331.1997ms
2025-02-02 09:32:04.943 +03:00 [INF] Request starting HTTP/1.1 POST http://e04c-46-152-255-232.ngrok-free.app/api/auth/signin - application/json; charset=utf-8 49
2025-02-02 09:32:04.948 +03:00 [INF] Executing endpoint 'NayifatAPI.Controllers.AuthController.SignIn (NayifatAPI)'
2025-02-02 09:32:04.949 +03:00 [INF] Route matched with {action = "SignIn", controller = "Auth"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] SignIn(NayifatAPI.Controllers.SignInRequest) on controller NayifatAPI.Controllers.AuthController (NayifatAPI).
2025-02-02 09:32:04.954 +03:00 [INF] Executing BadRequestObjectResult, writing value of type 'Microsoft.AspNetCore.Mvc.ValidationProblemDetails'.
2025-02-02 09:32:04.973 +03:00 [INF] Executed action NayifatAPI.Controllers.AuthController.SignIn (NayifatAPI) in 22.6002ms
2025-02-02 09:32:04.976 +03:00 [INF] Executed endpoint 'NayifatAPI.Controllers.AuthController.SignIn (NayifatAPI)'
2025-02-02 09:32:04.977 +03:00 [INF] Request finished HTTP/1.1 POST http://e04c-46-152-255-232.ngrok-free.app/api/auth/signin - 400 null application/problem+json; charset=utf-8 34.1501ms
2025-02-02 09:35:17.127 +03:00 [INF] Request starting HTTP/1.1 POST http://e04c-46-152-255-232.ngrok-free.app/api/notifications/list - application/json; charset=utf-8 47
2025-02-02 09:35:17.169 +03:00 [INF] Executing endpoint 'NayifatAPI.Controllers.NotificationsController.GetNotifications (NayifatAPI)'
2025-02-02 09:35:17.182 +03:00 [INF] Route matched with {action = "GetNotifications", controller = "Notifications"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetNotifications(NayifatAPI.Controllers.GetNotificationsRequest) on controller NayifatAPI.Controllers.NotificationsController (NayifatAPI).
2025-02-02 09:35:17.234 +03:00 [INF] Executed DbCommand (6ms) [Parameters=[@__providedApiKey_0='?' (Size = 255)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [a].[Key], [a].[CreatedAt], [a].[Description], [a].[ExpiresAt], [a].[IsActive], [a].[LastUsedAt]
FROM [ApiKeys] AS [a]
WHERE [a].[Key] = @__providedApiKey_0 AND [a].[IsActive] = CAST(1 AS bit)
2025-02-02 09:35:17.326 +03:00 [INF] Executed DbCommand (81ms) [Parameters=[@__request_NationalId_0='?' (Size = 450)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [u].[national_id], [u].[last_updated], [u].[notifications]
FROM [user_notifications] AS [u]
WHERE [u].[national_id] = @__request_NationalId_0
2025-02-02 09:35:17.391 +03:00 [INF] Executed DbCommand (12ms) [Parameters=[@__Parse_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [n].[Id], [n].[additional_data], [n].[Body], [n].[body_ar], [n].[body_en], [n].[created_at], [n].[expiry_at], [n].[Route], [n].[target_criteria], [n].[Title], [n].[title_ar], [n].[title_en]
FROM [notification_templates] AS [n]
WHERE [n].[Id] = @__Parse_0
2025-02-02 09:35:17.431 +03:00 [INF] Executed DbCommand (2ms) [Parameters=[@__Parse_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [n].[Id], [n].[additional_data], [n].[Body], [n].[body_ar], [n].[body_en], [n].[created_at], [n].[expiry_at], [n].[Route], [n].[target_criteria], [n].[Title], [n].[title_ar], [n].[title_en]
FROM [notification_templates] AS [n]
WHERE [n].[Id] = @__Parse_0
2025-02-02 09:35:17.587 +03:00 [INF] Executed DbCommand (44ms) [Parameters=[@p0='?' (Size = 4000), @p1='?' (DbType = DateTime2), @p2='?' (Size = 4000), @p3='?' (Size = 4000), @p4='?' (Size = 4000), @p5='?' (Size = 450), @p6='?' (Size = 4000), @p7='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SET IMPLICIT_TRANSACTIONS OFF;
SET NOCOUNT ON;
INSERT INTO [AuthLogs] ([AuthType], [CreatedAt], [DeviceId], [FailureReason], [IpAddress], [NationalId], [Status], [UserAgent])
OUTPUT INSERTED.[Id]
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7);
2025-02-02 09:35:17.609 +03:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType9`2[[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Object, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-02-02 09:35:17.626 +03:00 [INF] Executed action NayifatAPI.Controllers.NotificationsController.GetNotifications (NayifatAPI) in 441.2548ms
2025-02-02 09:35:17.631 +03:00 [INF] Executed endpoint 'NayifatAPI.Controllers.NotificationsController.GetNotifications (NayifatAPI)'
2025-02-02 09:35:17.635 +03:00 [INF] Request finished HTTP/1.1 POST http://e04c-46-152-255-232.ngrok-free.app/api/notifications/list - 200 null application/json; charset=utf-8 507.5311ms
2025-02-02 09:35:51.762 +03:00 [INF] Request starting HTTP/1.1 POST http://e04c-46-152-255-232.ngrok-free.app/api/auth/signin - application/json; charset=utf-8 224
2025-02-02 09:35:51.765 +03:00 [INF] Executing endpoint 'NayifatAPI.Controllers.AuthController.SignIn (NayifatAPI)'
2025-02-02 09:35:51.766 +03:00 [INF] Route matched with {action = "SignIn", controller = "Auth"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] SignIn(NayifatAPI.Controllers.SignInRequest) on controller NayifatAPI.Controllers.AuthController (NayifatAPI).
2025-02-02 09:35:51.823 +03:00 [INF] Executed DbCommand (2ms) [Parameters=[@__providedApiKey_0='?' (Size = 255)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [a].[Key], [a].[CreatedAt], [a].[Description], [a].[ExpiresAt], [a].[IsActive], [a].[LastUsedAt]
FROM [ApiKeys] AS [a]
WHERE [a].[Key] = @__providedApiKey_0 AND [a].[IsActive] = CAST(1 AS bit)
2025-02-02 09:35:51.828 +03:00 [INF] Executed DbCommand (2ms) [Parameters=[@__request_NationalId_0='?' (Size = 450)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [c].[NationalId], [c].[AddNo], [c].[BuildingNo], [c].[City], [c].[Consent], [c].[ConsentDate], [c].[DateOfBirth], [c].[Dependents], [c].[District], [c].[Email], [c].[Employer], [c].[FamilyNameAr], [c].[FamilyNameEn], [c].[FirstNameAr], [c].[FirstNameEn], [c].[Iban], [c].[IdExpiryDate], [c].[Los], [c].[Mpin], [c].[MpinEnabled], [c].[NafathStatus], [c].[NafathTimestamp], [c].[Password], [c].[Phone], [c].[RegistrationDate], [c].[SalaryCustomer], [c].[SalaryDakhli], [c].[SecondNameAr], [c].[SecondNameEn], [c].[Sector], [c].[Street], [c].[ThirdNameAr], [c].[ThirdNameEn], [c].[Zipcode]
FROM [Customers] AS [c]
WHERE [c].[NationalId] = @__request_NationalId_0
2025-02-02 09:35:51.831 +03:00 [INF] Starting password verification for NationalId: 1064448614
2025-02-02 09:35:52.026 +03:00 [INF] Password verification result for NationalId 1064448614: Success
2025-02-02 09:35:52.030 +03:00 [INF] Executed DbCommand (2ms) [Parameters=[@__request_NationalId_0='?' (Size = 450), @__request_DeviceId_1='?' (Size = 450)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [c].[Id], [c].[BiometricEnabled], [c].[BiometricToken], [c].[CreatedAt], [c].[DeviceId], [c].[LastUsedAt], [c].[Manufacturer], [c].[Model], [c].[NationalId], [c].[OsVersion], [c].[Platform], [c].[Status]
FROM [Customer_Devices] AS [c]
WHERE [c].[NationalId] = @__request_NationalId_0 AND [c].[DeviceId] = @__request_DeviceId_1 AND [c].[Status] = N'active'
2025-02-02 09:35:52.108 +03:00 [INF] Executed DbCommand (75ms) [Parameters=[@p0='?' (Size = 4000), @p1='?' (DbType = DateTime2), @p2='?' (Size = 4000), @p3='?' (Size = 4000), @p4='?' (Size = 4000), @p5='?' (Size = 450), @p6='?' (Size = 4000), @p7='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SET IMPLICIT_TRANSACTIONS OFF;
SET NOCOUNT ON;
INSERT INTO [AuthLogs] ([AuthType], [CreatedAt], [DeviceId], [FailureReason], [IpAddress], [NationalId], [Status], [UserAgent])
OUTPUT INSERTED.[Id]
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7);
2025-02-02 09:35:52.111 +03:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType9`2[[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Object, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-02-02 09:35:52.113 +03:00 [INF] Executed action NayifatAPI.Controllers.AuthController.SignIn (NayifatAPI) in 345.4473ms
2025-02-02 09:35:52.114 +03:00 [INF] Executed endpoint 'NayifatAPI.Controllers.AuthController.SignIn (NayifatAPI)'
2025-02-02 09:35:52.116 +03:00 [INF] Request finished HTTP/1.1 POST http://e04c-46-152-255-232.ngrok-free.app/api/auth/signin - 200 null application/json; charset=utf-8 354.2377ms
2025-02-02 09:35:52.452 +03:00 [INF] Request starting HTTP/1.1 POST http://e04c-46-152-255-232.ngrok-free.app/api/auth/signin - application/json; charset=utf-8 49
2025-02-02 09:35:52.456 +03:00 [INF] Executing endpoint 'NayifatAPI.Controllers.AuthController.SignIn (NayifatAPI)'
2025-02-02 09:35:52.457 +03:00 [INF] Route matched with {action = "SignIn", controller = "Auth"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] SignIn(NayifatAPI.Controllers.SignInRequest) on controller NayifatAPI.Controllers.AuthController (NayifatAPI).
2025-02-02 09:35:52.459 +03:00 [INF] Executing BadRequestObjectResult, writing value of type 'Microsoft.AspNetCore.Mvc.ValidationProblemDetails'.
2025-02-02 09:35:52.461 +03:00 [INF] Executed action NayifatAPI.Controllers.AuthController.SignIn (NayifatAPI) in 2.967ms
2025-02-02 09:35:52.463 +03:00 [INF] Executed endpoint 'NayifatAPI.Controllers.AuthController.SignIn (NayifatAPI)'
2025-02-02 09:35:52.464 +03:00 [INF] Request finished HTTP/1.1 POST http://e04c-46-152-255-232.ngrok-free.app/api/auth/signin - 400 null application/problem+json; charset=utf-8 12.0176ms
2025-02-02 09:38:32.117 +03:00 [INF] Request starting HTTP/1.1 POST http://e04c-46-152-255-232.ngrok-free.app/api/auth/signin - application/json; charset=utf-8 224
2025-02-02 09:38:32.121 +03:00 [INF] Executing endpoint 'NayifatAPI.Controllers.AuthController.SignIn (NayifatAPI)'
2025-02-02 09:38:32.122 +03:00 [INF] Route matched with {action = "SignIn", controller = "Auth"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] SignIn(NayifatAPI.Controllers.SignInRequest) on controller NayifatAPI.Controllers.AuthController (NayifatAPI).
2025-02-02 09:38:32.130 +03:00 [INF] Executed DbCommand (3ms) [Parameters=[@__providedApiKey_0='?' (Size = 255)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [a].[Key], [a].[CreatedAt], [a].[Description], [a].[ExpiresAt], [a].[IsActive], [a].[LastUsedAt]
FROM [ApiKeys] AS [a]
WHERE [a].[Key] = @__providedApiKey_0 AND [a].[IsActive] = CAST(1 AS bit)
2025-02-02 09:38:32.136 +03:00 [INF] Executed DbCommand (4ms) [Parameters=[@__request_NationalId_0='?' (Size = 450)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [c].[NationalId], [c].[AddNo], [c].[BuildingNo], [c].[City], [c].[Consent], [c].[ConsentDate], [c].[DateOfBirth], [c].[Dependents], [c].[District], [c].[Email], [c].[Employer], [c].[FamilyNameAr], [c].[FamilyNameEn], [c].[FirstNameAr], [c].[FirstNameEn], [c].[Iban], [c].[IdExpiryDate], [c].[Los], [c].[Mpin], [c].[MpinEnabled], [c].[NafathStatus], [c].[NafathTimestamp], [c].[Password], [c].[Phone], [c].[RegistrationDate], [c].[SalaryCustomer], [c].[SalaryDakhli], [c].[SecondNameAr], [c].[SecondNameEn], [c].[Sector], [c].[Street], [c].[ThirdNameAr], [c].[ThirdNameEn], [c].[Zipcode]
FROM [Customers] AS [c]
WHERE [c].[NationalId] = @__request_NationalId_0
2025-02-02 09:38:32.139 +03:00 [INF] Starting password verification for NationalId: 1064448614
2025-02-02 09:38:32.327 +03:00 [INF] Password verification result for NationalId 1064448614: Success
2025-02-02 09:38:32.332 +03:00 [INF] Executed DbCommand (2ms) [Parameters=[@__request_NationalId_0='?' (Size = 450), @__request_DeviceId_1='?' (Size = 450)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [c].[Id], [c].[BiometricEnabled], [c].[BiometricToken], [c].[CreatedAt], [c].[DeviceId], [c].[LastUsedAt], [c].[Manufacturer], [c].[Model], [c].[NationalId], [c].[OsVersion], [c].[Platform], [c].[Status]
FROM [Customer_Devices] AS [c]
WHERE [c].[NationalId] = @__request_NationalId_0 AND [c].[DeviceId] = @__request_DeviceId_1 AND [c].[Status] = N'active'
2025-02-02 09:38:32.411 +03:00 [INF] Executed DbCommand (75ms) [Parameters=[@p0='?' (Size = 4000), @p1='?' (DbType = DateTime2), @p2='?' (Size = 4000), @p3='?' (Size = 4000), @p4='?' (Size = 4000), @p5='?' (Size = 450), @p6='?' (Size = 4000), @p7='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SET IMPLICIT_TRANSACTIONS OFF;
SET NOCOUNT ON;
INSERT INTO [AuthLogs] ([AuthType], [CreatedAt], [DeviceId], [FailureReason], [IpAddress], [NationalId], [Status], [UserAgent])
OUTPUT INSERTED.[Id]
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7);
2025-02-02 09:38:32.413 +03:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType9`2[[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Object, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-02-02 09:38:32.415 +03:00 [INF] Executed action NayifatAPI.Controllers.AuthController.SignIn (NayifatAPI) in 290.831ms
2025-02-02 09:38:32.416 +03:00 [INF] Executed endpoint 'NayifatAPI.Controllers.AuthController.SignIn (NayifatAPI)'
2025-02-02 09:38:32.418 +03:00 [INF] Request finished HTTP/1.1 POST http://e04c-46-152-255-232.ngrok-free.app/api/auth/signin - 200 null application/json; charset=utf-8 301.0181ms
2025-02-02 09:38:32.747 +03:00 [INF] Request starting HTTP/1.1 POST http://e04c-46-152-255-232.ngrok-free.app/api/proxy/forward?url=https://icreditdept.com/api/testasp/test_local_generate_otp.php - application/json; charset=utf-8 84
2025-02-02 09:38:32.749 +03:00 [INF] Executing endpoint 'NayifatAPI.Controllers.ProxyController.ForwardRequest (NayifatAPI)'
2025-02-02 09:38:32.750 +03:00 [INF] Route matched with {action = "ForwardRequest", controller = "Proxy"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] ForwardRequest() on controller NayifatAPI.Controllers.ProxyController (NayifatAPI).
2025-02-02 09:38:32.752 +03:00 [INF] Start processing HTTP request POST https://icreditdept.com/api/testasp/test_local_generate_otp.php
2025-02-02 09:38:32.753 +03:00 [INF] Sending HTTP request POST https://icreditdept.com/api/testasp/test_local_generate_otp.php
2025-02-02 09:38:33.358 +03:00 [INF] Received HTTP response headers after 604.6369ms - 200
2025-02-02 09:38:33.361 +03:00 [INF] End processing HTTP request after 608.127ms - 200
2025-02-02 09:38:33.361 +03:00 [INF] Raw response length: 200
2025-02-02 09:38:33.362 +03:00 [INF] Response content: {"success":true,"errors":[],"result":{"nationalId":"1064448614","otp":359325,"expiryDate":"2025-02-02 09:43:33","successMsg":"Success","errCode":0,"errMsg":null},"type":"N","message":null,"code":null}
2025-02-02 09:38:33.363 +03:00 [INF] Executing ContentResult with HTTP Response ContentType of application/json
2025-02-02 09:38:33.363 +03:00 [INF] Executed action NayifatAPI.Controllers.ProxyController.ForwardRequest (NayifatAPI) in 611.8317ms
2025-02-02 09:38:33.364 +03:00 [INF] Executed endpoint 'NayifatAPI.Controllers.ProxyController.ForwardRequest (NayifatAPI)'
2025-02-02 09:38:33.367 +03:00 [INF] Request finished HTTP/1.1 POST http://e04c-46-152-255-232.ngrok-free.app/api/proxy/forward?url=https://icreditdept.com/api/testasp/test_local_generate_otp.php - 200 200 application/json 619.7851ms
2025-02-02 09:40:17.095 +03:00 [INF] Request starting HTTP/1.1 POST http://e04c-46-152-255-232.ngrok-free.app/api/notifications/list - application/json; charset=utf-8 47
2025-02-02 09:40:17.097 +03:00 [INF] Executing endpoint 'NayifatAPI.Controllers.NotificationsController.GetNotifications (NayifatAPI)'
2025-02-02 09:40:17.098 +03:00 [INF] Route matched with {action = "GetNotifications", controller = "Notifications"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetNotifications(NayifatAPI.Controllers.GetNotificationsRequest) on controller NayifatAPI.Controllers.NotificationsController (NayifatAPI).
2025-02-02 09:40:17.104 +03:00 [INF] Executed DbCommand (3ms) [Parameters=[@__providedApiKey_0='?' (Size = 255)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [a].[Key], [a].[CreatedAt], [a].[Description], [a].[ExpiresAt], [a].[IsActive], [a].[LastUsedAt]
FROM [ApiKeys] AS [a]
WHERE [a].[Key] = @__providedApiKey_0 AND [a].[IsActive] = CAST(1 AS bit)
2025-02-02 09:40:17.110 +03:00 [INF] Executed DbCommand (3ms) [Parameters=[@__request_NationalId_0='?' (Size = 450)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [u].[national_id], [u].[last_updated], [u].[notifications]
FROM [user_notifications] AS [u]
WHERE [u].[national_id] = @__request_NationalId_0
2025-02-02 09:40:17.114 +03:00 [INF] Executed DbCommand (2ms) [Parameters=[@__Parse_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [n].[Id], [n].[additional_data], [n].[Body], [n].[body_ar], [n].[body_en], [n].[created_at], [n].[expiry_at], [n].[Route], [n].[target_criteria], [n].[Title], [n].[title_ar], [n].[title_en]
FROM [notification_templates] AS [n]
WHERE [n].[Id] = @__Parse_0
2025-02-02 09:40:17.116 +03:00 [INF] Executed DbCommand (0ms) [Parameters=[@__Parse_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [n].[Id], [n].[additional_data], [n].[Body], [n].[body_ar], [n].[body_en], [n].[created_at], [n].[expiry_at], [n].[Route], [n].[target_criteria], [n].[Title], [n].[title_ar], [n].[title_en]
FROM [notification_templates] AS [n]
WHERE [n].[Id] = @__Parse_0
2025-02-02 09:40:17.128 +03:00 [INF] Executed DbCommand (8ms) [Parameters=[@p0='?' (Size = 4000), @p1='?' (DbType = DateTime2), @p2='?' (Size = 4000), @p3='?' (Size = 4000), @p4='?' (Size = 4000), @p5='?' (Size = 450), @p6='?' (Size = 4000), @p7='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SET IMPLICIT_TRANSACTIONS OFF;
SET NOCOUNT ON;
INSERT INTO [AuthLogs] ([AuthType], [CreatedAt], [DeviceId], [FailureReason], [IpAddress], [NationalId], [Status], [UserAgent])
OUTPUT INSERTED.[Id]
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7);
2025-02-02 09:40:17.130 +03:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType9`2[[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Object, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-02-02 09:40:17.131 +03:00 [INF] Executed action NayifatAPI.Controllers.NotificationsController.GetNotifications (NayifatAPI) in 31.8424ms
2025-02-02 09:40:17.132 +03:00 [INF] Executed endpoint 'NayifatAPI.Controllers.NotificationsController.GetNotifications (NayifatAPI)'
2025-02-02 09:40:17.134 +03:00 [INF] Request finished HTTP/1.1 POST http://e04c-46-152-255-232.ngrok-free.app/api/notifications/list - 200 null application/json; charset=utf-8 39.1482ms
2025-02-02 09:47:30.444 +03:00 [INF] Request starting HTTP/1.1 POST http://e04c-46-152-255-232.ngrok-free.app/api/auth/signin - application/json; charset=utf-8 224
2025-02-02 09:47:30.446 +03:00 [INF] Executing endpoint 'NayifatAPI.Controllers.AuthController.SignIn (NayifatAPI)'
2025-02-02 09:47:30.447 +03:00 [INF] Route matched with {action = "SignIn", controller = "Auth"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] SignIn(NayifatAPI.Controllers.SignInRequest) on controller NayifatAPI.Controllers.AuthController (NayifatAPI).
2025-02-02 09:47:30.459 +03:00 [INF] Executed DbCommand (3ms) [Parameters=[@__providedApiKey_0='?' (Size = 255)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [a].[Key], [a].[CreatedAt], [a].[Description], [a].[ExpiresAt], [a].[IsActive], [a].[LastUsedAt]
FROM [ApiKeys] AS [a]
WHERE [a].[Key] = @__providedApiKey_0 AND [a].[IsActive] = CAST(1 AS bit)
2025-02-02 09:47:30.467 +03:00 [INF] Executed DbCommand (5ms) [Parameters=[@__request_NationalId_0='?' (Size = 450)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [c].[NationalId], [c].[AddNo], [c].[BuildingNo], [c].[City], [c].[Consent], [c].[ConsentDate], [c].[DateOfBirth], [c].[Dependents], [c].[District], [c].[Email], [c].[Employer], [c].[FamilyNameAr], [c].[FamilyNameEn], [c].[FirstNameAr], [c].[FirstNameEn], [c].[Iban], [c].[IdExpiryDate], [c].[Los], [c].[Mpin], [c].[MpinEnabled], [c].[NafathStatus], [c].[NafathTimestamp], [c].[Password], [c].[Phone], [c].[RegistrationDate], [c].[SalaryCustomer], [c].[SalaryDakhli], [c].[SecondNameAr], [c].[SecondNameEn], [c].[Sector], [c].[Street], [c].[ThirdNameAr], [c].[ThirdNameEn], [c].[Zipcode]
FROM [Customers] AS [c]
WHERE [c].[NationalId] = @__request_NationalId_0
2025-02-02 09:47:30.469 +03:00 [INF] Starting password verification for NationalId: 1064448614
2025-02-02 09:47:30.714 +03:00 [INF] Password verification result for NationalId 1064448614: Success
2025-02-02 09:47:30.747 +03:00 [INF] Executed DbCommand (30ms) [Parameters=[@__request_NationalId_0='?' (Size = 450), @__request_DeviceId_1='?' (Size = 450)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [c].[Id], [c].[BiometricEnabled], [c].[BiometricToken], [c].[CreatedAt], [c].[DeviceId], [c].[LastUsedAt], [c].[Manufacturer], [c].[Model], [c].[NationalId], [c].[OsVersion], [c].[Platform], [c].[Status]
FROM [Customer_Devices] AS [c]
WHERE [c].[NationalId] = @__request_NationalId_0 AND [c].[DeviceId] = @__request_DeviceId_1 AND [c].[Status] = N'active'
2025-02-02 09:47:30.867 +03:00 [INF] Executed DbCommand (99ms) [Parameters=[@p0='?' (Size = 4000), @p1='?' (DbType = DateTime2), @p2='?' (Size = 4000), @p3='?' (Size = 4000), @p4='?' (Size = 4000), @p5='?' (Size = 450), @p6='?' (Size = 4000), @p7='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SET IMPLICIT_TRANSACTIONS OFF;
SET NOCOUNT ON;
INSERT INTO [AuthLogs] ([AuthType], [CreatedAt], [DeviceId], [FailureReason], [IpAddress], [NationalId], [Status], [UserAgent])
OUTPUT INSERTED.[Id]
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7);
2025-02-02 09:47:30.869 +03:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType9`2[[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Object, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-02-02 09:47:30.871 +03:00 [INF] Executed action NayifatAPI.Controllers.AuthController.SignIn (NayifatAPI) in 421.783ms
2025-02-02 09:47:30.872 +03:00 [INF] Executed endpoint 'NayifatAPI.Controllers.AuthController.SignIn (NayifatAPI)'
2025-02-02 09:47:30.874 +03:00 [INF] Request finished HTTP/1.1 POST http://e04c-46-152-255-232.ngrok-free.app/api/auth/signin - 200 null application/json; charset=utf-8 430.6267ms
2025-02-02 09:49:43.462 +03:00 [INF] Request starting HTTP/1.1 POST http://e04c-46-152-255-232.ngrok-free.app/api/auth/signin - application/json; charset=utf-8 224
2025-02-02 09:49:43.464 +03:00 [INF] Executing endpoint 'NayifatAPI.Controllers.AuthController.SignIn (NayifatAPI)'
2025-02-02 09:49:43.466 +03:00 [INF] Route matched with {action = "SignIn", controller = "Auth"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] SignIn(NayifatAPI.Controllers.SignInRequest) on controller NayifatAPI.Controllers.AuthController (NayifatAPI).
2025-02-02 09:49:43.513 +03:00 [INF] Executed DbCommand (30ms) [Parameters=[@__providedApiKey_0='?' (Size = 255)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [a].[Key], [a].[CreatedAt], [a].[Description], [a].[ExpiresAt], [a].[IsActive], [a].[LastUsedAt]
FROM [ApiKeys] AS [a]
WHERE [a].[Key] = @__providedApiKey_0 AND [a].[IsActive] = CAST(1 AS bit)
2025-02-02 09:49:43.552 +03:00 [INF] Executed DbCommand (27ms) [Parameters=[@__request_NationalId_0='?' (Size = 450)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [c].[NationalId], [c].[AddNo], [c].[BuildingNo], [c].[City], [c].[Consent], [c].[ConsentDate], [c].[DateOfBirth], [c].[Dependents], [c].[District], [c].[Email], [c].[Employer], [c].[FamilyNameAr], [c].[FamilyNameEn], [c].[FirstNameAr], [c].[FirstNameEn], [c].[Iban], [c].[IdExpiryDate], [c].[Los], [c].[Mpin], [c].[MpinEnabled], [c].[NafathStatus], [c].[NafathTimestamp], [c].[Password], [c].[Phone], [c].[RegistrationDate], [c].[SalaryCustomer], [c].[SalaryDakhli], [c].[SecondNameAr], [c].[SecondNameEn], [c].[Sector], [c].[Street], [c].[ThirdNameAr], [c].[ThirdNameEn], [c].[Zipcode]
FROM [Customers] AS [c]
WHERE [c].[NationalId] = @__request_NationalId_0
2025-02-02 09:49:43.562 +03:00 [INF] Starting password verification for NationalId: 1064448614
2025-02-02 09:49:43.823 +03:00 [INF] Password verification result for NationalId 1064448614: Success
2025-02-02 09:49:43.871 +03:00 [INF] Executed DbCommand (37ms) [Parameters=[@__request_NationalId_0='?' (Size = 450), @__request_DeviceId_1='?' (Size = 450)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [c].[Id], [c].[BiometricEnabled], [c].[BiometricToken], [c].[CreatedAt], [c].[DeviceId], [c].[LastUsedAt], [c].[Manufacturer], [c].[Model], [c].[NationalId], [c].[OsVersion], [c].[Platform], [c].[Status]
FROM [Customer_Devices] AS [c]
WHERE [c].[NationalId] = @__request_NationalId_0 AND [c].[DeviceId] = @__request_DeviceId_1 AND [c].[Status] = N'active'
2025-02-02 09:49:43.992 +03:00 [INF] Executed DbCommand (98ms) [Parameters=[@p0='?' (Size = 4000), @p1='?' (DbType = DateTime2), @p2='?' (Size = 4000), @p3='?' (Size = 4000), @p4='?' (Size = 4000), @p5='?' (Size = 450), @p6='?' (Size = 4000), @p7='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SET IMPLICIT_TRANSACTIONS OFF;
SET NOCOUNT ON;
INSERT INTO [AuthLogs] ([AuthType], [CreatedAt], [DeviceId], [FailureReason], [IpAddress], [NationalId], [Status], [UserAgent])
OUTPUT INSERTED.[Id]
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7);
2025-02-02 09:49:44.006 +03:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType9`2[[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Object, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-02-02 09:49:44.015 +03:00 [INF] Executed action NayifatAPI.Controllers.AuthController.SignIn (NayifatAPI) in 534.3144ms
2025-02-02 09:49:44.019 +03:00 [INF] Executed endpoint 'NayifatAPI.Controllers.AuthController.SignIn (NayifatAPI)'
2025-02-02 09:49:44.030 +03:00 [INF] Request finished HTTP/1.1 POST http://e04c-46-152-255-232.ngrok-free.app/api/auth/signin - 200 null application/json; charset=utf-8 568.1649ms
2025-02-02 09:50:29.563 +03:00 [INF] Request starting HTTP/1.1 POST http://e04c-46-152-255-232.ngrok-free.app/api/notifications/list - application/json; charset=utf-8 47
2025-02-02 09:50:29.566 +03:00 [INF] Executing endpoint 'NayifatAPI.Controllers.NotificationsController.GetNotifications (NayifatAPI)'
2025-02-02 09:50:29.567 +03:00 [INF] Route matched with {action = "GetNotifications", controller = "Notifications"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetNotifications(NayifatAPI.Controllers.GetNotificationsRequest) on controller NayifatAPI.Controllers.NotificationsController (NayifatAPI).
2025-02-02 09:50:29.573 +03:00 [INF] Executed DbCommand (3ms) [Parameters=[@__providedApiKey_0='?' (Size = 255)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [a].[Key], [a].[CreatedAt], [a].[Description], [a].[ExpiresAt], [a].[IsActive], [a].[LastUsedAt]
FROM [ApiKeys] AS [a]
WHERE [a].[Key] = @__providedApiKey_0 AND [a].[IsActive] = CAST(1 AS bit)
2025-02-02 09:50:29.578 +03:00 [INF] Executed DbCommand (2ms) [Parameters=[@__request_NationalId_0='?' (Size = 450)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [u].[national_id], [u].[last_updated], [u].[notifications]
FROM [user_notifications] AS [u]
WHERE [u].[national_id] = @__request_NationalId_0
2025-02-02 09:50:29.584 +03:00 [INF] Executed DbCommand (3ms) [Parameters=[@__Parse_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [n].[Id], [n].[additional_data], [n].[Body], [n].[body_ar], [n].[body_en], [n].[created_at], [n].[expiry_at], [n].[Route], [n].[target_criteria], [n].[Title], [n].[title_ar], [n].[title_en]
FROM [notification_templates] AS [n]
WHERE [n].[Id] = @__Parse_0
2025-02-02 09:50:29.588 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@__Parse_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [n].[Id], [n].[additional_data], [n].[Body], [n].[body_ar], [n].[body_en], [n].[created_at], [n].[expiry_at], [n].[Route], [n].[target_criteria], [n].[Title], [n].[title_ar], [n].[title_en]
FROM [notification_templates] AS [n]
WHERE [n].[Id] = @__Parse_0
2025-02-02 09:50:29.668 +03:00 [INF] Executed DbCommand (76ms) [Parameters=[@p0='?' (Size = 4000), @p1='?' (DbType = DateTime2), @p2='?' (Size = 4000), @p3='?' (Size = 4000), @p4='?' (Size = 4000), @p5='?' (Size = 450), @p6='?' (Size = 4000), @p7='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SET IMPLICIT_TRANSACTIONS OFF;
SET NOCOUNT ON;
INSERT INTO [AuthLogs] ([AuthType], [CreatedAt], [DeviceId], [FailureReason], [IpAddress], [NationalId], [Status], [UserAgent])
OUTPUT INSERTED.[Id]
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7);
2025-02-02 09:50:29.671 +03:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType9`2[[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Object, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-02-02 09:50:29.672 +03:00 [INF] Executed action NayifatAPI.Controllers.NotificationsController.GetNotifications (NayifatAPI) in 103.421ms
2025-02-02 09:50:29.673 +03:00 [INF] Executed endpoint 'NayifatAPI.Controllers.NotificationsController.GetNotifications (NayifatAPI)'
2025-02-02 09:50:29.674 +03:00 [INF] Request finished HTTP/1.1 POST http://e04c-46-152-255-232.ngrok-free.app/api/notifications/list - 200 null application/json; charset=utf-8 111.2493ms
2025-02-02 10:10:11.730 +03:00 [INF] Starting web application
2025-02-02 10:10:12.122 +03:00 [INF] Now listening on: http://localhost:5264
2025-02-02 10:10:12.417 +03:00 [INF] Application started. Press Ctrl+C to shut down.
2025-02-02 10:10:12.420 +03:00 [INF] Hosting environment: Development
2025-02-02 10:10:12.425 +03:00 [INF] Content root path: C:\Users\yamta\StudioProjects\nayifat_app_2025_new\nayifatapi
2025-02-02 10:18:14.731 +03:00 [INF] Request starting HTTP/1.1 POST http://07ca-46-152-255-232.ngrok-free.app/api/notifications/list - application/json; charset=utf-8 47
2025-02-02 10:18:14.808 +03:00 [WRN] Failed to determine the https port for redirect.
2025-02-02 10:18:14.815 +03:00 [INF] Executing endpoint 'NayifatAPI.Controllers.NotificationsController.GetNotifications (NayifatAPI)'
2025-02-02 10:18:14.850 +03:00 [INF] Route matched with {action = "GetNotifications", controller = "Notifications"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetNotifications(NayifatAPI.Controllers.GetNotificationsRequest) on controller NayifatAPI.Controllers.NotificationsController (NayifatAPI).
2025-02-02 10:18:16.935 +03:00 [INF] Executed DbCommand (50ms) [Parameters=[@__providedApiKey_0='?' (Size = 255)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [a].[Key], [a].[CreatedAt], [a].[Description], [a].[ExpiresAt], [a].[IsActive], [a].[LastUsedAt]
FROM [ApiKeys] AS [a]
WHERE [a].[Key] = @__providedApiKey_0 AND [a].[IsActive] = CAST(1 AS bit)
2025-02-02 10:18:17.109 +03:00 [INF] Executed DbCommand (17ms) [Parameters=[@__request_NationalId_0='?' (Size = 450)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [u].[national_id], [u].[last_updated], [u].[notifications]
FROM [user_notifications] AS [u]
WHERE [u].[national_id] = @__request_NationalId_0
2025-02-02 10:18:17.177 +03:00 [INF] Executed DbCommand (9ms) [Parameters=[@__Parse_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [n].[Id], [n].[additional_data], [n].[Body], [n].[body_ar], [n].[body_en], [n].[created_at], [n].[expiry_at], [n].[Route], [n].[target_criteria], [n].[Title], [n].[title_ar], [n].[title_en]
FROM [notification_templates] AS [n]
WHERE [n].[Id] = @__Parse_0
2025-02-02 10:18:17.221 +03:00 [INF] Executed DbCommand (0ms) [Parameters=[@__Parse_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [n].[Id], [n].[additional_data], [n].[Body], [n].[body_ar], [n].[body_en], [n].[created_at], [n].[expiry_at], [n].[Route], [n].[target_criteria], [n].[Title], [n].[title_ar], [n].[title_en]
FROM [notification_templates] AS [n]
WHERE [n].[Id] = @__Parse_0
2025-02-02 10:18:17.407 +03:00 [INF] Executed DbCommand (12ms) [Parameters=[@p0='?' (Size = 4000), @p1='?' (DbType = DateTime2), @p2='?' (Size = 4000), @p3='?' (Size = 4000), @p4='?' (Size = 4000), @p5='?' (Size = 450), @p6='?' (Size = 4000), @p7='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SET IMPLICIT_TRANSACTIONS OFF;
SET NOCOUNT ON;
INSERT INTO [AuthLogs] ([AuthType], [CreatedAt], [DeviceId], [FailureReason], [IpAddress], [NationalId], [Status], [UserAgent])
OUTPUT INSERTED.[Id]
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7);
2025-02-02 10:18:17.440 +03:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType9`2[[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Object, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-02-02 10:18:17.475 +03:00 [INF] Executed action NayifatAPI.Controllers.NotificationsController.GetNotifications (NayifatAPI) in 2616.4595ms
2025-02-02 10:18:17.480 +03:00 [INF] Executed endpoint 'NayifatAPI.Controllers.NotificationsController.GetNotifications (NayifatAPI)'
2025-02-02 10:18:17.494 +03:00 [INF] Request finished HTTP/1.1 POST http://07ca-46-152-255-232.ngrok-free.app/api/notifications/list - 200 null application/json; charset=utf-8 2774.4907ms
2025-02-02 10:19:35.540 +03:00 [INF] Request starting HTTP/1.1 POST http://07ca-46-152-255-232.ngrok-free.app/api/auth/signin - application/json; charset=utf-8 224
2025-02-02 10:19:35.545 +03:00 [INF] Executing endpoint 'NayifatAPI.Controllers.AuthController.SignIn (NayifatAPI)'
2025-02-02 10:19:35.550 +03:00 [INF] Route matched with {action = "SignIn", controller = "Auth"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] SignIn(NayifatAPI.Controllers.SignInRequest) on controller NayifatAPI.Controllers.AuthController (NayifatAPI).
2025-02-02 10:19:35.576 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@__providedApiKey_0='?' (Size = 255)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [a].[Key], [a].[CreatedAt], [a].[Description], [a].[ExpiresAt], [a].[IsActive], [a].[LastUsedAt]
FROM [ApiKeys] AS [a]
WHERE [a].[Key] = @__providedApiKey_0 AND [a].[IsActive] = CAST(1 AS bit)
2025-02-02 10:19:35.592 +03:00 [INF] Executed DbCommand (2ms) [Parameters=[@__request_NationalId_0='?' (Size = 450)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [c].[NationalId], [c].[AddNo], [c].[BuildingNo], [c].[City], [c].[Consent], [c].[ConsentDate], [c].[DateOfBirth], [c].[Dependents], [c].[District], [c].[Email], [c].[Employer], [c].[FamilyNameAr], [c].[FamilyNameEn], [c].[FirstNameAr], [c].[FirstNameEn], [c].[Iban], [c].[IdExpiryDate], [c].[Los], [c].[Mpin], [c].[MpinEnabled], [c].[NafathStatus], [c].[NafathTimestamp], [c].[Password], [c].[Phone], [c].[RegistrationDate], [c].[SalaryCustomer], [c].[SalaryDakhli], [c].[SecondNameAr], [c].[SecondNameEn], [c].[Sector], [c].[Street], [c].[ThirdNameAr], [c].[ThirdNameEn], [c].[Zipcode]
FROM [Customers] AS [c]
WHERE [c].[NationalId] = @__request_NationalId_0
2025-02-02 10:19:35.654 +03:00 [INF] Starting password verification for NationalId: 1064448614
2025-02-02 10:19:35.964 +03:00 [INF] Password verification result for NationalId 1064448614: Success
2025-02-02 10:19:36.049 +03:00 [INF] Executed DbCommand (77ms) [Parameters=[@__request_NationalId_0='?' (Size = 450), @__request_DeviceId_1='?' (Size = 450)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [c].[Id], [c].[BiometricEnabled], [c].[BiometricToken], [c].[CreatedAt], [c].[DeviceId], [c].[LastUsedAt], [c].[Manufacturer], [c].[Model], [c].[NationalId], [c].[OsVersion], [c].[Platform], [c].[Status]
FROM [Customer_Devices] AS [c]
WHERE [c].[NationalId] = @__request_NationalId_0 AND [c].[DeviceId] = @__request_DeviceId_1 AND [c].[Status] = N'active'
2025-02-02 10:19:36.122 +03:00 [INF] Executed DbCommand (6ms) [Parameters=[@p0='?' (Size = 4000), @p1='?' (DbType = DateTime2), @p2='?' (Size = 4000), @p3='?' (Size = 4000), @p4='?' (Size = 4000), @p5='?' (Size = 450), @p6='?' (Size = 4000), @p7='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SET IMPLICIT_TRANSACTIONS OFF;
SET NOCOUNT ON;
INSERT INTO [AuthLogs] ([AuthType], [CreatedAt], [DeviceId], [FailureReason], [IpAddress], [NationalId], [Status], [UserAgent])
OUTPUT INSERTED.[Id]
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7);
2025-02-02 10:19:36.125 +03:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType9`2[[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Object, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-02-02 10:19:36.128 +03:00 [INF] Executed action NayifatAPI.Controllers.AuthController.SignIn (NayifatAPI) in 575.717ms
2025-02-02 10:19:36.129 +03:00 [INF] Executed endpoint 'NayifatAPI.Controllers.AuthController.SignIn (NayifatAPI)'
2025-02-02 10:19:36.131 +03:00 [INF] Request finished HTTP/1.1 POST http://07ca-46-152-255-232.ngrok-free.app/api/auth/signin - 200 null application/json; charset=utf-8 590.9734ms
2025-02-02 10:19:36.620 +03:00 [INF] Request starting HTTP/1.1 POST http://07ca-46-152-255-232.ngrok-free.app/api/auth/generate-otp - application/json; charset=utf-8 89
2025-02-02 10:19:36.629 +03:00 [INF] Request finished HTTP/1.1 POST http://07ca-46-152-255-232.ngrok-free.app/api/auth/generate-otp - 404 0 null 9.4043ms
2025-02-02 10:19:36.634 +03:00 [INF] Request reached the end of the middleware pipeline without being handled by application code. Request path: POST http://07ca-46-152-255-232.ngrok-free.app/api/auth/generate-otp, Response status code: 404
2025-02-02 10:23:18.381 +03:00 [INF] Request starting HTTP/1.1 POST http://07ca-46-152-255-232.ngrok-free.app/api/notifications/list - application/json; charset=utf-8 47
2025-02-02 10:23:18.388 +03:00 [INF] Executing endpoint 'NayifatAPI.Controllers.NotificationsController.GetNotifications (NayifatAPI)'
2025-02-02 10:23:18.389 +03:00 [INF] Route matched with {action = "GetNotifications", controller = "Notifications"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetNotifications(NayifatAPI.Controllers.GetNotificationsRequest) on controller NayifatAPI.Controllers.NotificationsController (NayifatAPI).
2025-02-02 10:23:18.737 +03:00 [INF] Executed DbCommand (96ms) [Parameters=[@__providedApiKey_0='?' (Size = 255)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [a].[Key], [a].[CreatedAt], [a].[Description], [a].[ExpiresAt], [a].[IsActive], [a].[LastUsedAt]
FROM [ApiKeys] AS [a]
WHERE [a].[Key] = @__providedApiKey_0 AND [a].[IsActive] = CAST(1 AS bit)
2025-02-02 10:23:18.797 +03:00 [INF] Executed DbCommand (56ms) [Parameters=[@__request_NationalId_0='?' (Size = 450)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [u].[national_id], [u].[last_updated], [u].[notifications]
FROM [user_notifications] AS [u]
WHERE [u].[national_id] = @__request_NationalId_0
2025-02-02 10:23:18.845 +03:00 [INF] Executed DbCommand (44ms) [Parameters=[@__Parse_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [n].[Id], [n].[additional_data], [n].[Body], [n].[body_ar], [n].[body_en], [n].[created_at], [n].[expiry_at], [n].[Route], [n].[target_criteria], [n].[Title], [n].[title_ar], [n].[title_en]
FROM [notification_templates] AS [n]
WHERE [n].[Id] = @__Parse_0
2025-02-02 10:23:18.850 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@__Parse_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [n].[Id], [n].[additional_data], [n].[Body], [n].[body_ar], [n].[body_en], [n].[created_at], [n].[expiry_at], [n].[Route], [n].[target_criteria], [n].[Title], [n].[title_ar], [n].[title_en]
FROM [notification_templates] AS [n]
WHERE [n].[Id] = @__Parse_0
2025-02-02 10:23:19.104 +03:00 [INF] Executed DbCommand (236ms) [Parameters=[@p0='?' (Size = 4000), @p1='?' (DbType = DateTime2), @p2='?' (Size = 4000), @p3='?' (Size = 4000), @p4='?' (Size = 4000), @p5='?' (Size = 450), @p6='?' (Size = 4000), @p7='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SET IMPLICIT_TRANSACTIONS OFF;
SET NOCOUNT ON;
INSERT INTO [AuthLogs] ([AuthType], [CreatedAt], [DeviceId], [FailureReason], [IpAddress], [NationalId], [Status], [UserAgent])
OUTPUT INSERTED.[Id]
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7);
2025-02-02 10:23:19.108 +03:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType9`2[[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Object, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-02-02 10:23:19.110 +03:00 [INF] Executed action NayifatAPI.Controllers.NotificationsController.GetNotifications (NayifatAPI) in 719.0964ms
2025-02-02 10:23:19.112 +03:00 [INF] Executed endpoint 'NayifatAPI.Controllers.NotificationsController.GetNotifications (NayifatAPI)'
2025-02-02 10:23:19.113 +03:00 [INF] Request finished HTTP/1.1 POST http://07ca-46-152-255-232.ngrok-free.app/api/notifications/list - 200 null application/json; charset=utf-8 732.4904ms
2025-02-02 10:26:16.647 +03:00 [INF] Request starting HTTP/1.1 POST http://07ca-46-152-255-232.ngrok-free.app/api/auth/signin - application/json; charset=utf-8 224
2025-02-02 10:26:16.651 +03:00 [INF] Executing endpoint 'NayifatAPI.Controllers.AuthController.SignIn (NayifatAPI)'
2025-02-02 10:26:16.652 +03:00 [INF] Route matched with {action = "SignIn", controller = "Auth"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] SignIn(NayifatAPI.Controllers.SignInRequest) on controller NayifatAPI.Controllers.AuthController (NayifatAPI).
2025-02-02 10:26:16.741 +03:00 [INF] Executed DbCommand (85ms) [Parameters=[@__providedApiKey_0='?' (Size = 255)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [a].[Key], [a].[CreatedAt], [a].[Description], [a].[ExpiresAt], [a].[IsActive], [a].[LastUsedAt]
FROM [ApiKeys] AS [a]
WHERE [a].[Key] = @__providedApiKey_0 AND [a].[IsActive] = CAST(1 AS bit)
2025-02-02 10:26:16.749 +03:00 [INF] Executed DbCommand (3ms) [Parameters=[@__request_NationalId_0='?' (Size = 450)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [c].[NationalId], [c].[AddNo], [c].[BuildingNo], [c].[City], [c].[Consent], [c].[ConsentDate], [c].[DateOfBirth], [c].[Dependents], [c].[District], [c].[Email], [c].[Employer], [c].[FamilyNameAr], [c].[FamilyNameEn], [c].[FirstNameAr], [c].[FirstNameEn], [c].[Iban], [c].[IdExpiryDate], [c].[Los], [c].[Mpin], [c].[MpinEnabled], [c].[NafathStatus], [c].[NafathTimestamp], [c].[Password], [c].[Phone], [c].[RegistrationDate], [c].[SalaryCustomer], [c].[SalaryDakhli], [c].[SecondNameAr], [c].[SecondNameEn], [c].[Sector], [c].[Street], [c].[ThirdNameAr], [c].[ThirdNameEn], [c].[Zipcode]
FROM [Customers] AS [c]
WHERE [c].[NationalId] = @__request_NationalId_0
2025-02-02 10:26:16.752 +03:00 [INF] Starting password verification for NationalId: 1064448614
2025-02-02 10:26:16.927 +03:00 [INF] Password verification result for NationalId 1064448614: Success
2025-02-02 10:26:18.157 +03:00 [INF] Executed DbCommand (1,227ms) [Parameters=[@__request_NationalId_0='?' (Size = 450), @__request_DeviceId_1='?' (Size = 450)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [c].[Id], [c].[BiometricEnabled], [c].[BiometricToken], [c].[CreatedAt], [c].[DeviceId], [c].[LastUsedAt], [c].[Manufacturer], [c].[Model], [c].[NationalId], [c].[OsVersion], [c].[Platform], [c].[Status]
FROM [Customer_Devices] AS [c]
WHERE [c].[NationalId] = @__request_NationalId_0 AND [c].[DeviceId] = @__request_DeviceId_1 AND [c].[Status] = N'active'
2025-02-02 10:26:18.166 +03:00 [INF] Executed DbCommand (3ms) [Parameters=[@p0='?' (Size = 4000), @p1='?' (DbType = DateTime2), @p2='?' (Size = 4000), @p3='?' (Size = 4000), @p4='?' (Size = 4000), @p5='?' (Size = 450), @p6='?' (Size = 4000), @p7='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SET IMPLICIT_TRANSACTIONS OFF;
SET NOCOUNT ON;
INSERT INTO [AuthLogs] ([AuthType], [CreatedAt], [DeviceId], [FailureReason], [IpAddress], [NationalId], [Status], [UserAgent])
OUTPUT INSERTED.[Id]
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7);
2025-02-02 10:26:18.175 +03:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType9`2[[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Object, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-02-02 10:26:18.176 +03:00 [INF] Executed action NayifatAPI.Controllers.AuthController.SignIn (NayifatAPI) in 1521.8882ms
2025-02-02 10:26:18.178 +03:00 [INF] Executed endpoint 'NayifatAPI.Controllers.AuthController.SignIn (NayifatAPI)'
2025-02-02 10:26:18.179 +03:00 [INF] Request finished HTTP/1.1 POST http://07ca-46-152-255-232.ngrok-free.app/api/auth/signin - 200 null application/json; charset=utf-8 1531.4285ms
2025-02-02 10:26:18.664 +03:00 [INF] Request starting HTTP/1.1 POST http://07ca-46-152-255-232.ngrok-free.app/api/auth/otp/generate - application/json; charset=utf-8 89
2025-02-02 10:26:18.669 +03:00 [INF] Executing endpoint 'NayifatAPI.Controllers.AuthController.GenerateOtp (NayifatAPI)'
2025-02-02 10:26:18.672 +03:00 [INF] Route matched with {action = "GenerateOtp", controller = "Auth"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GenerateOtp(NayifatAPI.Controllers.OtpGenerateRequest) on controller NayifatAPI.Controllers.AuthController (NayifatAPI).
2025-02-02 10:26:18.678 +03:00 [INF] Executing BadRequestObjectResult, writing value of type 'Microsoft.AspNetCore.Mvc.ValidationProblemDetails'.
2025-02-02 10:26:18.693 +03:00 [INF] Executed action NayifatAPI.Controllers.AuthController.GenerateOtp (NayifatAPI) in 18.9942ms
2025-02-02 10:26:18.695 +03:00 [INF] Executed endpoint 'NayifatAPI.Controllers.AuthController.GenerateOtp (NayifatAPI)'
2025-02-02 10:26:18.699 +03:00 [INF] Request finished HTTP/1.1 POST http://07ca-46-152-255-232.ngrok-free.app/api/auth/otp/generate - 400 null application/problem+json; charset=utf-8 35.2455ms
2025-02-02 10:27:53.365 +03:00 [INF] Request starting HTTP/1.1 POST http://07ca-46-152-255-232.ngrok-free.app/api/proxy/forward?url=https://icreditdept.com/api/testasp/test_local_generate_otp.php - application/json 115
2025-02-02 10:27:53.368 +03:00 [INF] Executing endpoint 'NayifatAPI.Controllers.ProxyController.ForwardRequest (NayifatAPI)'
2025-02-02 10:27:53.376 +03:00 [INF] Route matched with {action = "ForwardRequest", controller = "Proxy"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] ForwardRequest() on controller NayifatAPI.Controllers.ProxyController (NayifatAPI).
2025-02-02 10:27:53.417 +03:00 [INF] Start processing HTTP request POST https://icreditdept.com/api/testasp/test_local_generate_otp.php
2025-02-02 10:27:53.420 +03:00 [INF] Sending HTTP request POST https://icreditdept.com/api/testasp/test_local_generate_otp.php
2025-02-02 10:27:53.907 +03:00 [INF] Received HTTP response headers after 484.3983ms - 200
2025-02-02 10:27:53.909 +03:00 [INF] End processing HTTP request after 497.1377ms - 200
2025-02-02 10:27:53.918 +03:00 [INF] Raw response length: 200
2025-02-02 10:27:53.920 +03:00 [INF] Response content: {"success":true,"errors":[],"result":{"nationalId":"1064448614","otp":331509,"expiryDate":"2025-02-02 10:32:54","successMsg":"Success","errCode":0,"errMsg":null},"type":"N","message":null,"code":null}
2025-02-02 10:27:53.922 +03:00 [INF] Executing ContentResult with HTTP Response ContentType of application/json
2025-02-02 10:27:53.924 +03:00 [INF] Executed action NayifatAPI.Controllers.ProxyController.ForwardRequest (NayifatAPI) in 545.4998ms
2025-02-02 10:27:53.926 +03:00 [INF] Executed endpoint 'NayifatAPI.Controllers.ProxyController.ForwardRequest (NayifatAPI)'
2025-02-02 10:27:53.928 +03:00 [INF] Request finished HTTP/1.1 POST http://07ca-46-152-255-232.ngrok-free.app/api/proxy/forward?url=https://icreditdept.com/api/testasp/test_local_generate_otp.php - 200 200 application/json 562.7525ms
2025-02-02 10:28:18.251 +03:00 [INF] Request starting HTTP/1.1 POST http://07ca-46-152-255-232.ngrok-free.app/api/notifications/list - application/json; charset=utf-8 47
2025-02-02 10:28:18.254 +03:00 [INF] Executing endpoint 'NayifatAPI.Controllers.NotificationsController.GetNotifications (NayifatAPI)'
2025-02-02 10:28:18.255 +03:00 [INF] Route matched with {action = "GetNotifications", controller = "Notifications"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetNotifications(NayifatAPI.Controllers.GetNotificationsRequest) on controller NayifatAPI.Controllers.NotificationsController (NayifatAPI).
2025-02-02 10:28:18.262 +03:00 [INF] Executed DbCommand (2ms) [Parameters=[@__providedApiKey_0='?' (Size = 255)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [a].[Key], [a].[CreatedAt], [a].[Description], [a].[ExpiresAt], [a].[IsActive], [a].[LastUsedAt]
FROM [ApiKeys] AS [a]
WHERE [a].[Key] = @__providedApiKey_0 AND [a].[IsActive] = CAST(1 AS bit)
2025-02-02 10:28:18.344 +03:00 [INF] Executed DbCommand (76ms) [Parameters=[@__request_NationalId_0='?' (Size = 450)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [u].[national_id], [u].[last_updated], [u].[notifications]
FROM [user_notifications] AS [u]
WHERE [u].[national_id] = @__request_NationalId_0
2025-02-02 10:28:18.351 +03:00 [INF] Executed DbCommand (3ms) [Parameters=[@__Parse_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [n].[Id], [n].[additional_data], [n].[Body], [n].[body_ar], [n].[body_en], [n].[created_at], [n].[expiry_at], [n].[Route], [n].[target_criteria], [n].[Title], [n].[title_ar], [n].[title_en]
FROM [notification_templates] AS [n]
WHERE [n].[Id] = @__Parse_0
2025-02-02 10:28:18.354 +03:00 [INF] Executed DbCommand (0ms) [Parameters=[@__Parse_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [n].[Id], [n].[additional_data], [n].[Body], [n].[body_ar], [n].[body_en], [n].[created_at], [n].[expiry_at], [n].[Route], [n].[target_criteria], [n].[Title], [n].[title_ar], [n].[title_en]
FROM [notification_templates] AS [n]
WHERE [n].[Id] = @__Parse_0
2025-02-02 10:28:18.365 +03:00 [INF] Executed DbCommand (7ms) [Parameters=[@p0='?' (Size = 4000), @p1='?' (DbType = DateTime2), @p2='?' (Size = 4000), @p3='?' (Size = 4000), @p4='?' (Size = 4000), @p5='?' (Size = 450), @p6='?' (Size = 4000), @p7='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SET IMPLICIT_TRANSACTIONS OFF;
SET NOCOUNT ON;
INSERT INTO [AuthLogs] ([AuthType], [CreatedAt], [DeviceId], [FailureReason], [IpAddress], [NationalId], [Status], [UserAgent])
OUTPUT INSERTED.[Id]
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7);
2025-02-02 10:28:18.368 +03:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType9`2[[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Object, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-02-02 10:28:18.371 +03:00 [INF] Executed action NayifatAPI.Controllers.NotificationsController.GetNotifications (NayifatAPI) in 114.0628ms
2025-02-02 10:28:18.374 +03:00 [INF] Executed endpoint 'NayifatAPI.Controllers.NotificationsController.GetNotifications (NayifatAPI)'
2025-02-02 10:28:18.376 +03:00 [INF] Request finished HTTP/1.1 POST http://07ca-46-152-255-232.ngrok-free.app/api/notifications/list - 200 null application/json; charset=utf-8 124.6309ms
2025-02-02 10:32:46.932 +03:00 [INF] Request starting HTTP/1.1 POST http://07ca-46-152-255-232.ngrok-free.app/api/auth/signin - application/json; charset=utf-8 224
2025-02-02 10:32:46.936 +03:00 [INF] Executing endpoint 'NayifatAPI.Controllers.AuthController.SignIn (NayifatAPI)'
2025-02-02 10:32:46.936 +03:00 [INF] Route matched with {action = "SignIn", controller = "Auth"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] SignIn(NayifatAPI.Controllers.SignInRequest) on controller NayifatAPI.Controllers.AuthController (NayifatAPI).
2025-02-02 10:32:46.942 +03:00 [INF] Executed DbCommand (2ms) [Parameters=[@__providedApiKey_0='?' (Size = 255)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [a].[Key], [a].[CreatedAt], [a].[Description], [a].[ExpiresAt], [a].[IsActive], [a].[LastUsedAt]
FROM [ApiKeys] AS [a]
WHERE [a].[Key] = @__providedApiKey_0 AND [a].[IsActive] = CAST(1 AS bit)
2025-02-02 10:32:46.946 +03:00 [INF] Executed DbCommand (2ms) [Parameters=[@__request_NationalId_0='?' (Size = 450)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [c].[NationalId], [c].[AddNo], [c].[BuildingNo], [c].[City], [c].[Consent], [c].[ConsentDate], [c].[DateOfBirth], [c].[Dependents], [c].[District], [c].[Email], [c].[Employer], [c].[FamilyNameAr], [c].[FamilyNameEn], [c].[FirstNameAr], [c].[FirstNameEn], [c].[Iban], [c].[IdExpiryDate], [c].[Los], [c].[Mpin], [c].[MpinEnabled], [c].[NafathStatus], [c].[NafathTimestamp], [c].[Password], [c].[Phone], [c].[RegistrationDate], [c].[SalaryCustomer], [c].[SalaryDakhli], [c].[SecondNameAr], [c].[SecondNameEn], [c].[Sector], [c].[Street], [c].[ThirdNameAr], [c].[ThirdNameEn], [c].[Zipcode]
FROM [Customers] AS [c]
WHERE [c].[NationalId] = @__request_NationalId_0
2025-02-02 10:32:46.950 +03:00 [INF] Starting password verification for NationalId: 1064448614
2025-02-02 10:32:47.119 +03:00 [INF] Password verification result for NationalId 1064448614: Success
2025-02-02 10:32:47.125 +03:00 [INF] Executed DbCommand (3ms) [Parameters=[@__request_NationalId_0='?' (Size = 450), @__request_DeviceId_1='?' (Size = 450)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [c].[Id], [c].[BiometricEnabled], [c].[BiometricToken], [c].[CreatedAt], [c].[DeviceId], [c].[LastUsedAt], [c].[Manufacturer], [c].[Model], [c].[NationalId], [c].[OsVersion], [c].[Platform], [c].[Status]
FROM [Customer_Devices] AS [c]
WHERE [c].[NationalId] = @__request_NationalId_0 AND [c].[DeviceId] = @__request_DeviceId_1 AND [c].[Status] = N'active'
2025-02-02 10:32:47.245 +03:00 [INF] Executed DbCommand (117ms) [Parameters=[@p0='?' (Size = 4000), @p1='?' (DbType = DateTime2), @p2='?' (Size = 4000), @p3='?' (Size = 4000), @p4='?' (Size = 4000), @p5='?' (Size = 450), @p6='?' (Size = 4000), @p7='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SET IMPLICIT_TRANSACTIONS OFF;
SET NOCOUNT ON;
INSERT INTO [AuthLogs] ([AuthType], [CreatedAt], [DeviceId], [FailureReason], [IpAddress], [NationalId], [Status], [UserAgent])
OUTPUT INSERTED.[Id]
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7);
2025-02-02 10:32:47.248 +03:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType9`2[[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Object, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-02-02 10:32:47.250 +03:00 [INF] Executed action NayifatAPI.Controllers.AuthController.SignIn (NayifatAPI) in 311.7002ms
2025-02-02 10:32:47.251 +03:00 [INF] Executed endpoint 'NayifatAPI.Controllers.AuthController.SignIn (NayifatAPI)'
2025-02-02 10:32:47.253 +03:00 [INF] Request finished HTTP/1.1 POST http://07ca-46-152-255-232.ngrok-free.app/api/auth/signin - 200 null application/json; charset=utf-8 320.7151ms
2025-02-02 10:32:47.892 +03:00 [INF] Request starting HTTP/1.1 POST http://07ca-46-152-255-232.ngrok-free.app/api/auth/otp/generate - application/json; charset=utf-8 84
2025-02-02 10:32:47.899 +03:00 [INF] Executing endpoint 'NayifatAPI.Controllers.AuthController.GenerateOtp (NayifatAPI)'
2025-02-02 10:32:47.900 +03:00 [INF] Route matched with {action = "GenerateOtp", controller = "Auth"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GenerateOtp(NayifatAPI.Controllers.OtpGenerateRequest) on controller NayifatAPI.Controllers.AuthController (NayifatAPI).
2025-02-02 10:32:47.904 +03:00 [INF] Executing BadRequestObjectResult, writing value of type 'Microsoft.AspNetCore.Mvc.ValidationProblemDetails'.
2025-02-02 10:32:47.906 +03:00 [INF] Executed action NayifatAPI.Controllers.AuthController.GenerateOtp (NayifatAPI) in 2.817ms
2025-02-02 10:32:47.907 +03:00 [INF] Executed endpoint 'NayifatAPI.Controllers.AuthController.GenerateOtp (NayifatAPI)'
2025-02-02 10:32:47.908 +03:00 [INF] Request finished HTTP/1.1 POST http://07ca-46-152-255-232.ngrok-free.app/api/auth/otp/generate - 400 null application/problem+json; charset=utf-8 15.6472ms
2025-02-02 10:33:18.111 +03:00 [INF] Request starting HTTP/1.1 POST http://07ca-46-152-255-232.ngrok-free.app/api/notifications/list - application/json; charset=utf-8 47
2025-02-02 10:33:18.114 +03:00 [INF] Executing endpoint 'NayifatAPI.Controllers.NotificationsController.GetNotifications (NayifatAPI)'
2025-02-02 10:33:18.115 +03:00 [INF] Route matched with {action = "GetNotifications", controller = "Notifications"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetNotifications(NayifatAPI.Controllers.GetNotificationsRequest) on controller NayifatAPI.Controllers.NotificationsController (NayifatAPI).
2025-02-02 10:33:18.120 +03:00 [INF] Executed DbCommand (2ms) [Parameters=[@__providedApiKey_0='?' (Size = 255)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [a].[Key], [a].[CreatedAt], [a].[Description], [a].[ExpiresAt], [a].[IsActive], [a].[LastUsedAt]
FROM [ApiKeys] AS [a]
WHERE [a].[Key] = @__providedApiKey_0 AND [a].[IsActive] = CAST(1 AS bit)
2025-02-02 10:33:18.126 +03:00 [INF] Executed DbCommand (2ms) [Parameters=[@__request_NationalId_0='?' (Size = 450)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [u].[national_id], [u].[last_updated], [u].[notifications]
FROM [user_notifications] AS [u]
WHERE [u].[national_id] = @__request_NationalId_0
2025-02-02 10:33:18.131 +03:00 [INF] Executed DbCommand (2ms) [Parameters=[@__Parse_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [n].[Id], [n].[additional_data], [n].[Body], [n].[body_ar], [n].[body_en], [n].[created_at], [n].[expiry_at], [n].[Route], [n].[target_criteria], [n].[Title], [n].[title_ar], [n].[title_en]
FROM [notification_templates] AS [n]
WHERE [n].[Id] = @__Parse_0
2025-02-02 10:33:18.133 +03:00 [INF] Executed DbCommand (0ms) [Parameters=[@__Parse_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [n].[Id], [n].[additional_data], [n].[Body], [n].[body_ar], [n].[body_en], [n].[created_at], [n].[expiry_at], [n].[Route], [n].[target_criteria], [n].[Title], [n].[title_ar], [n].[title_en]
FROM [notification_templates] AS [n]
WHERE [n].[Id] = @__Parse_0
2025-02-02 10:33:18.143 +03:00 [INF] Executed DbCommand (8ms) [Parameters=[@p0='?' (Size = 4000), @p1='?' (DbType = DateTime2), @p2='?' (Size = 4000), @p3='?' (Size = 4000), @p4='?' (Size = 4000), @p5='?' (Size = 450), @p6='?' (Size = 4000), @p7='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SET IMPLICIT_TRANSACTIONS OFF;
SET NOCOUNT ON;
INSERT INTO [AuthLogs] ([AuthType], [CreatedAt], [DeviceId], [FailureReason], [IpAddress], [NationalId], [Status], [UserAgent])
OUTPUT INSERTED.[Id]
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7);
2025-02-02 10:33:18.146 +03:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType9`2[[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Object, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-02-02 10:33:18.147 +03:00 [INF] Executed action NayifatAPI.Controllers.NotificationsController.GetNotifications (NayifatAPI) in 30.4553ms
2025-02-02 10:33:18.148 +03:00 [INF] Executed endpoint 'NayifatAPI.Controllers.NotificationsController.GetNotifications (NayifatAPI)'
2025-02-02 10:33:18.149 +03:00 [INF] Request finished HTTP/1.1 POST http://07ca-46-152-255-232.ngrok-free.app/api/notifications/list - 200 null application/json; charset=utf-8 37.9854ms
2025-02-02 10:37:31.587 +03:00 [INF] Request starting HTTP/1.1 POST http://07ca-46-152-255-232.ngrok-free.app/api/auth/signin - application/json; charset=utf-8 224
2025-02-02 10:37:31.592 +03:00 [INF] Executing endpoint 'NayifatAPI.Controllers.AuthController.SignIn (NayifatAPI)'
2025-02-02 10:37:31.592 +03:00 [INF] Route matched with {action = "SignIn", controller = "Auth"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] SignIn(NayifatAPI.Controllers.SignInRequest) on controller NayifatAPI.Controllers.AuthController (NayifatAPI).
2025-02-02 10:37:31.602 +03:00 [INF] Executed DbCommand (2ms) [Parameters=[@__providedApiKey_0='?' (Size = 255)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [a].[Key], [a].[CreatedAt], [a].[Description], [a].[ExpiresAt], [a].[IsActive], [a].[LastUsedAt]
FROM [ApiKeys] AS [a]
WHERE [a].[Key] = @__providedApiKey_0 AND [a].[IsActive] = CAST(1 AS bit)
2025-02-02 10:37:31.608 +03:00 [INF] Executed DbCommand (3ms) [Parameters=[@__request_NationalId_0='?' (Size = 450)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [c].[NationalId], [c].[AddNo], [c].[BuildingNo], [c].[City], [c].[Consent], [c].[ConsentDate], [c].[DateOfBirth], [c].[Dependents], [c].[District], [c].[Email], [c].[Employer], [c].[FamilyNameAr], [c].[FamilyNameEn], [c].[FirstNameAr], [c].[FirstNameEn], [c].[Iban], [c].[IdExpiryDate], [c].[Los], [c].[Mpin], [c].[MpinEnabled], [c].[NafathStatus], [c].[NafathTimestamp], [c].[Password], [c].[Phone], [c].[RegistrationDate], [c].[SalaryCustomer], [c].[SalaryDakhli], [c].[SecondNameAr], [c].[SecondNameEn], [c].[Sector], [c].[Street], [c].[ThirdNameAr], [c].[ThirdNameEn], [c].[Zipcode]
FROM [Customers] AS [c]
WHERE [c].[NationalId] = @__request_NationalId_0
2025-02-02 10:37:31.610 +03:00 [INF] Starting password verification for NationalId: 1064448614
2025-02-02 10:37:31.774 +03:00 [INF] Password verification result for NationalId 1064448614: Success
2025-02-02 10:37:31.778 +03:00 [INF] Executed DbCommand (2ms) [Parameters=[@__request_NationalId_0='?' (Size = 450), @__request_DeviceId_1='?' (Size = 450)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [c].[Id], [c].[BiometricEnabled], [c].[BiometricToken], [c].[CreatedAt], [c].[DeviceId], [c].[LastUsedAt], [c].[Manufacturer], [c].[Model], [c].[NationalId], [c].[OsVersion], [c].[Platform], [c].[Status]
FROM [Customer_Devices] AS [c]
WHERE [c].[NationalId] = @__request_NationalId_0 AND [c].[DeviceId] = @__request_DeviceId_1 AND [c].[Status] = N'active'
2025-02-02 10:37:31.859 +03:00 [INF] Executed DbCommand (75ms) [Parameters=[@p0='?' (Size = 4000), @p1='?' (DbType = DateTime2), @p2='?' (Size = 4000), @p3='?' (Size = 4000), @p4='?' (Size = 4000), @p5='?' (Size = 450), @p6='?' (Size = 4000), @p7='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SET IMPLICIT_TRANSACTIONS OFF;
SET NOCOUNT ON;
INSERT INTO [AuthLogs] ([AuthType], [CreatedAt], [DeviceId], [FailureReason], [IpAddress], [NationalId], [Status], [UserAgent])
OUTPUT INSERTED.[Id]
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7);
2025-02-02 10:37:31.862 +03:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType9`2[[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Object, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-02-02 10:37:31.863 +03:00 [INF] Executed action NayifatAPI.Controllers.AuthController.SignIn (NayifatAPI) in 269.4669ms
2025-02-02 10:37:31.865 +03:00 [INF] Executed endpoint 'NayifatAPI.Controllers.AuthController.SignIn (NayifatAPI)'
2025-02-02 10:37:31.867 +03:00 [INF] Request finished HTTP/1.1 POST http://07ca-46-152-255-232.ngrok-free.app/api/auth/signin - 200 null application/json; charset=utf-8 279.2574ms
2025-02-02 10:37:32.214 +03:00 [INF] Request starting HTTP/1.1 POST http://07ca-46-152-255-232.ngrok-free.app/api/proxy/forward?url=https://icreditdept.com/api/testasp/test_local_generate_otp.php - application/json; charset=utf-8 84
2025-02-02 10:37:32.271 +03:00 [INF] Executing endpoint 'NayifatAPI.Controllers.ProxyController.ForwardRequest (NayifatAPI)'
2025-02-02 10:37:32.295 +03:00 [INF] Route matched with {action = "ForwardRequest", controller = "Proxy"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] ForwardRequest() on controller NayifatAPI.Controllers.ProxyController (NayifatAPI).
2025-02-02 10:37:32.328 +03:00 [INF] Start processing HTTP request POST https://icreditdept.com/api/testasp/test_local_generate_otp.php
2025-02-02 10:37:32.330 +03:00 [INF] Sending HTTP request POST https://icreditdept.com/api/testasp/test_local_generate_otp.php
2025-02-02 10:37:32.999 +03:00 [INF] Received HTTP response headers after 667.0933ms - 200
2025-02-02 10:37:33.024 +03:00 [INF] End processing HTTP request after 696.7131ms - 200
2025-02-02 10:37:33.092 +03:00 [INF] Raw response length: 200
2025-02-02 10:37:33.093 +03:00 [INF] Response content: {"success":true,"errors":[],"result":{"nationalId":"1064448614","otp":487243,"expiryDate":"2025-02-02 10:42:33","successMsg":"Success","errCode":0,"errMsg":null},"type":"N","message":null,"code":null}
2025-02-02 10:37:33.094 +03:00 [INF] Executing ContentResult with HTTP Response ContentType of application/json
2025-02-02 10:37:33.095 +03:00 [INF] Executed action NayifatAPI.Controllers.ProxyController.ForwardRequest (NayifatAPI) in 772.9426ms
2025-02-02 10:37:33.097 +03:00 [INF] Executed endpoint 'NayifatAPI.Controllers.ProxyController.ForwardRequest (NayifatAPI)'
2025-02-02 10:37:33.098 +03:00 [INF] Request finished HTTP/1.1 POST http://07ca-46-152-255-232.ngrok-free.app/api/proxy/forward?url=https://icreditdept.com/api/testasp/test_local_generate_otp.php - 200 200 application/json 884.0474ms
2025-02-02 10:37:54.952 +03:00 [INF] Request starting HTTP/1.1 POST http://07ca-46-152-255-232.ngrok-free.app/api/proxy/forward?url=https://icreditdept.com/api/testasp/test_local_verify_otp.php - application/json; charset=utf-8 53
2025-02-02 10:37:54.955 +03:00 [INF] Executing endpoint 'NayifatAPI.Controllers.ProxyController.ForwardRequest (NayifatAPI)'
2025-02-02 10:37:54.956 +03:00 [INF] Route matched with {action = "ForwardRequest", controller = "Proxy"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] ForwardRequest() on controller NayifatAPI.Controllers.ProxyController (NayifatAPI).
2025-02-02 10:37:54.959 +03:00 [INF] Start processing HTTP request POST https://icreditdept.com/api/testasp/test_local_verify_otp.php
2025-02-02 10:37:54.959 +03:00 [INF] Sending HTTP request POST https://icreditdept.com/api/testasp/test_local_verify_otp.php
2025-02-02 10:37:55.408 +03:00 [INF] Received HTTP response headers after 447.2065ms - 200
2025-02-02 10:37:55.409 +03:00 [INF] End processing HTTP request after 450.2688ms - 200
2025-02-02 10:37:55.410 +03:00 [INF] Raw response length: 202
2025-02-02 10:37:55.410 +03:00 [INF] Response content: {"success":true,"errors":[],"result":{"nationalId":"1064448614","otp":"487243","verifiedFlag":true,"successMsg":"Verified successfully.","errCode":0,"errMsg":null},"type":"N","message":null,"code":null}
2025-02-02 10:37:55.411 +03:00 [INF] Executing ContentResult with HTTP Response ContentType of application/json
2025-02-02 10:37:55.411 +03:00 [INF] Executed action NayifatAPI.Controllers.ProxyController.ForwardRequest (NayifatAPI) in 453.3563ms
2025-02-02 10:37:55.413 +03:00 [INF] Executed endpoint 'NayifatAPI.Controllers.ProxyController.ForwardRequest (NayifatAPI)'
2025-02-02 10:37:55.414 +03:00 [INF] Request finished HTTP/1.1 POST http://07ca-46-152-255-232.ngrok-free.app/api/proxy/forward?url=https://icreditdept.com/api/testasp/test_local_verify_otp.php - 200 202 application/json 462.0648ms
2025-02-02 10:37:55.720 +03:00 [INF] Request starting HTTP/1.1 POST http://07ca-46-152-255-232.ngrok-free.app/api/auth/signin - application/json; charset=utf-8 49
2025-02-02 10:37:55.725 +03:00 [INF] Executing endpoint 'NayifatAPI.Controllers.AuthController.SignIn (NayifatAPI)'
2025-02-02 10:37:55.727 +03:00 [INF] Route matched with {action = "SignIn", controller = "Auth"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] SignIn(NayifatAPI.Controllers.SignInRequest) on controller NayifatAPI.Controllers.AuthController (NayifatAPI).
2025-02-02 10:37:55.729 +03:00 [INF] Executing BadRequestObjectResult, writing value of type 'Microsoft.AspNetCore.Mvc.ValidationProblemDetails'.
2025-02-02 10:37:55.730 +03:00 [INF] Executed action NayifatAPI.Controllers.AuthController.SignIn (NayifatAPI) in 2.0409ms
2025-02-02 10:37:55.733 +03:00 [INF] Executed endpoint 'NayifatAPI.Controllers.AuthController.SignIn (NayifatAPI)'
2025-02-02 10:37:55.735 +03:00 [INF] Request finished HTTP/1.1 POST http://07ca-46-152-255-232.ngrok-free.app/api/auth/signin - 400 null application/problem+json; charset=utf-8 15.0498ms
2025-02-02 10:38:18.251 +03:00 [INF] Request starting HTTP/1.1 POST http://07ca-46-152-255-232.ngrok-free.app/api/notifications/list - application/json; charset=utf-8 47
2025-02-02 10:38:18.254 +03:00 [INF] Executing endpoint 'NayifatAPI.Controllers.NotificationsController.GetNotifications (NayifatAPI)'
2025-02-02 10:38:18.254 +03:00 [INF] Route matched with {action = "GetNotifications", controller = "Notifications"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetNotifications(NayifatAPI.Controllers.GetNotificationsRequest) on controller NayifatAPI.Controllers.NotificationsController (NayifatAPI).
2025-02-02 10:38:18.258 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@__providedApiKey_0='?' (Size = 255)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [a].[Key], [a].[CreatedAt], [a].[Description], [a].[ExpiresAt], [a].[IsActive], [a].[LastUsedAt]
FROM [ApiKeys] AS [a]
WHERE [a].[Key] = @__providedApiKey_0 AND [a].[IsActive] = CAST(1 AS bit)
2025-02-02 10:38:18.263 +03:00 [INF] Executed DbCommand (2ms) [Parameters=[@__request_NationalId_0='?' (Size = 450)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [u].[national_id], [u].[last_updated], [u].[notifications]
FROM [user_notifications] AS [u]
WHERE [u].[national_id] = @__request_NationalId_0
2025-02-02 10:38:18.267 +03:00 [INF] Executed DbCommand (2ms) [Parameters=[@__Parse_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [n].[Id], [n].[additional_data], [n].[Body], [n].[body_ar], [n].[body_en], [n].[created_at], [n].[expiry_at], [n].[Route], [n].[target_criteria], [n].[Title], [n].[title_ar], [n].[title_en]
FROM [notification_templates] AS [n]
WHERE [n].[Id] = @__Parse_0
2025-02-02 10:38:18.269 +03:00 [INF] Executed DbCommand (0ms) [Parameters=[@__Parse_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [n].[Id], [n].[additional_data], [n].[Body], [n].[body_ar], [n].[body_en], [n].[created_at], [n].[expiry_at], [n].[Route], [n].[target_criteria], [n].[Title], [n].[title_ar], [n].[title_en]
FROM [notification_templates] AS [n]
WHERE [n].[Id] = @__Parse_0
2025-02-02 10:38:18.345 +03:00 [INF] Executed DbCommand (73ms) [Parameters=[@p0='?' (Size = 4000), @p1='?' (DbType = DateTime2), @p2='?' (Size = 4000), @p3='?' (Size = 4000), @p4='?' (Size = 4000), @p5='?' (Size = 450), @p6='?' (Size = 4000), @p7='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SET IMPLICIT_TRANSACTIONS OFF;
SET NOCOUNT ON;
INSERT INTO [AuthLogs] ([AuthType], [CreatedAt], [DeviceId], [FailureReason], [IpAddress], [NationalId], [Status], [UserAgent])
OUTPUT INSERTED.[Id]
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7);
2025-02-02 10:38:18.347 +03:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType9`2[[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Object, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-02-02 10:38:18.348 +03:00 [INF] Executed action NayifatAPI.Controllers.NotificationsController.GetNotifications (NayifatAPI) in 92.1009ms
2025-02-02 10:38:18.349 +03:00 [INF] Executed endpoint 'NayifatAPI.Controllers.NotificationsController.GetNotifications (NayifatAPI)'
2025-02-02 10:38:18.350 +03:00 [INF] Request finished HTTP/1.1 POST http://07ca-46-152-255-232.ngrok-free.app/api/notifications/list - 200 null application/json; charset=utf-8 99.1605ms
2025-02-02 10:40:24.626 +03:00 [INF] Request starting HTTP/1.1 POST http://07ca-46-152-255-232.ngrok-free.app/api/notifications/list - application/json; charset=utf-8 47
2025-02-02 10:40:24.628 +03:00 [INF] Executing endpoint 'NayifatAPI.Controllers.NotificationsController.GetNotifications (NayifatAPI)'
2025-02-02 10:40:24.630 +03:00 [INF] Route matched with {action = "GetNotifications", controller = "Notifications"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetNotifications(NayifatAPI.Controllers.GetNotificationsRequest) on controller NayifatAPI.Controllers.NotificationsController (NayifatAPI).
2025-02-02 10:40:24.676 +03:00 [INF] Executed DbCommand (41ms) [Parameters=[@__providedApiKey_0='?' (Size = 255)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [a].[Key], [a].[CreatedAt], [a].[Description], [a].[ExpiresAt], [a].[IsActive], [a].[LastUsedAt]
FROM [ApiKeys] AS [a]
WHERE [a].[Key] = @__providedApiKey_0 AND [a].[IsActive] = CAST(1 AS bit)
2025-02-02 10:40:24.715 +03:00 [INF] Executed DbCommand (35ms) [Parameters=[@__request_NationalId_0='?' (Size = 450)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [u].[national_id], [u].[last_updated], [u].[notifications]
FROM [user_notifications] AS [u]
WHERE [u].[national_id] = @__request_NationalId_0
2025-02-02 10:40:24.902 +03:00 [INF] Executed DbCommand (3ms) [Parameters=[@__Parse_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [n].[Id], [n].[additional_data], [n].[Body], [n].[body_ar], [n].[body_en], [n].[created_at], [n].[expiry_at], [n].[Route], [n].[target_criteria], [n].[Title], [n].[title_ar], [n].[title_en]
FROM [notification_templates] AS [n]
WHERE [n].[Id] = @__Parse_0
2025-02-02 10:40:25.011 +03:00 [INF] Executed DbCommand (89ms) [Parameters=[@__Parse_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [n].[Id], [n].[additional_data], [n].[Body], [n].[body_ar], [n].[body_en], [n].[created_at], [n].[expiry_at], [n].[Route], [n].[target_criteria], [n].[Title], [n].[title_ar], [n].[title_en]
FROM [notification_templates] AS [n]
WHERE [n].[Id] = @__Parse_0
2025-02-02 10:40:25.250 +03:00 [INF] Executed DbCommand (42ms) [Parameters=[@p0='?' (Size = 4000), @p1='?' (DbType = DateTime2), @p2='?' (Size = 4000), @p3='?' (Size = 4000), @p4='?' (Size = 4000), @p5='?' (Size = 450), @p6='?' (Size = 4000), @p7='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SET IMPLICIT_TRANSACTIONS OFF;
SET NOCOUNT ON;
INSERT INTO [AuthLogs] ([AuthType], [CreatedAt], [DeviceId], [FailureReason], [IpAddress], [NationalId], [Status], [UserAgent])
OUTPUT INSERTED.[Id]
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7);
2025-02-02 10:40:25.546 +03:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType9`2[[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Object, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-02-02 10:40:25.550 +03:00 [INF] Executed action NayifatAPI.Controllers.NotificationsController.GetNotifications (NayifatAPI) in 917.8416ms
2025-02-02 10:40:25.881 +03:00 [INF] Executed endpoint 'NayifatAPI.Controllers.NotificationsController.GetNotifications (NayifatAPI)'
2025-02-02 10:40:25.883 +03:00 [INF] Request finished HTTP/1.1 POST http://07ca-46-152-255-232.ngrok-free.app/api/notifications/list - 200 null application/json; charset=utf-8 1257.7069ms
2025-02-02 10:45:26.632 +03:00 [INF] Request starting HTTP/1.1 POST http://07ca-46-152-255-232.ngrok-free.app/api/notifications/list - application/json; charset=utf-8 47
2025-02-02 10:45:26.707 +03:00 [INF] Executing endpoint 'NayifatAPI.Controllers.NotificationsController.GetNotifications (NayifatAPI)'
2025-02-02 10:45:26.722 +03:00 [INF] Route matched with {action = "GetNotifications", controller = "Notifications"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetNotifications(NayifatAPI.Controllers.GetNotificationsRequest) on controller NayifatAPI.Controllers.NotificationsController (NayifatAPI).
2025-02-02 10:45:26.736 +03:00 [INF] Executed DbCommand (5ms) [Parameters=[@__providedApiKey_0='?' (Size = 255)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [a].[Key], [a].[CreatedAt], [a].[Description], [a].[ExpiresAt], [a].[IsActive], [a].[LastUsedAt]
FROM [ApiKeys] AS [a]
WHERE [a].[Key] = @__providedApiKey_0 AND [a].[IsActive] = CAST(1 AS bit)
2025-02-02 10:45:26.743 +03:00 [INF] Executed DbCommand (3ms) [Parameters=[@__request_NationalId_0='?' (Size = 450)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [u].[national_id], [u].[last_updated], [u].[notifications]
FROM [user_notifications] AS [u]
WHERE [u].[national_id] = @__request_NationalId_0
2025-02-02 10:45:26.767 +03:00 [INF] Executed DbCommand (5ms) [Parameters=[@__Parse_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [n].[Id], [n].[additional_data], [n].[Body], [n].[body_ar], [n].[body_en], [n].[created_at], [n].[expiry_at], [n].[Route], [n].[target_criteria], [n].[Title], [n].[title_ar], [n].[title_en]
FROM [notification_templates] AS [n]
WHERE [n].[Id] = @__Parse_0
2025-02-02 10:45:26.807 +03:00 [INF] Executed DbCommand (3ms) [Parameters=[@__Parse_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [n].[Id], [n].[additional_data], [n].[Body], [n].[body_ar], [n].[body_en], [n].[created_at], [n].[expiry_at], [n].[Route], [n].[target_criteria], [n].[Title], [n].[title_ar], [n].[title_en]
FROM [notification_templates] AS [n]
WHERE [n].[Id] = @__Parse_0
2025-02-02 10:45:26.917 +03:00 [INF] Executed DbCommand (80ms) [Parameters=[@p0='?' (Size = 4000), @p1='?' (DbType = DateTime2), @p2='?' (Size = 4000), @p3='?' (Size = 4000), @p4='?' (Size = 4000), @p5='?' (Size = 450), @p6='?' (Size = 4000), @p7='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SET IMPLICIT_TRANSACTIONS OFF;
SET NOCOUNT ON;
INSERT INTO [AuthLogs] ([AuthType], [CreatedAt], [DeviceId], [FailureReason], [IpAddress], [NationalId], [Status], [UserAgent])
OUTPUT INSERTED.[Id]
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7);
2025-02-02 10:45:26.958 +03:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType9`2[[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Object, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-02-02 10:45:26.988 +03:00 [INF] Executed action NayifatAPI.Controllers.NotificationsController.GetNotifications (NayifatAPI) in 264.1506ms
2025-02-02 10:45:27.003 +03:00 [INF] Executed endpoint 'NayifatAPI.Controllers.NotificationsController.GetNotifications (NayifatAPI)'
2025-02-02 10:45:27.031 +03:00 [INF] Request finished HTTP/1.1 POST http://07ca-46-152-255-232.ngrok-free.app/api/notifications/list - 200 null application/json; charset=utf-8 398.8879ms
2025-02-02 10:50:26.656 +03:00 [INF] Request starting HTTP/1.1 POST http://07ca-46-152-255-232.ngrok-free.app/api/notifications/list - application/json; charset=utf-8 47
2025-02-02 10:50:26.660 +03:00 [INF] Executing endpoint 'NayifatAPI.Controllers.NotificationsController.GetNotifications (NayifatAPI)'
2025-02-02 10:50:26.662 +03:00 [INF] Route matched with {action = "GetNotifications", controller = "Notifications"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetNotifications(NayifatAPI.Controllers.GetNotificationsRequest) on controller NayifatAPI.Controllers.NotificationsController (NayifatAPI).
2025-02-02 10:50:26.667 +03:00 [INF] Executed DbCommand (2ms) [Parameters=[@__providedApiKey_0='?' (Size = 255)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [a].[Key], [a].[CreatedAt], [a].[Description], [a].[ExpiresAt], [a].[IsActive], [a].[LastUsedAt]
FROM [ApiKeys] AS [a]
WHERE [a].[Key] = @__providedApiKey_0 AND [a].[IsActive] = CAST(1 AS bit)
2025-02-02 10:50:26.672 +03:00 [INF] Executed DbCommand (2ms) [Parameters=[@__request_NationalId_0='?' (Size = 450)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [u].[national_id], [u].[last_updated], [u].[notifications]
FROM [user_notifications] AS [u]
WHERE [u].[national_id] = @__request_NationalId_0
2025-02-02 10:50:26.675 +03:00 [INF] Executed DbCommand (2ms) [Parameters=[@__Parse_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [n].[Id], [n].[additional_data], [n].[Body], [n].[body_ar], [n].[body_en], [n].[created_at], [n].[expiry_at], [n].[Route], [n].[target_criteria], [n].[Title], [n].[title_ar], [n].[title_en]
FROM [notification_templates] AS [n]
WHERE [n].[Id] = @__Parse_0
2025-02-02 10:50:26.679 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@__Parse_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [n].[Id], [n].[additional_data], [n].[Body], [n].[body_ar], [n].[body_en], [n].[created_at], [n].[expiry_at], [n].[Route], [n].[target_criteria], [n].[Title], [n].[title_ar], [n].[title_en]
FROM [notification_templates] AS [n]
WHERE [n].[Id] = @__Parse_0
2025-02-02 10:50:26.691 +03:00 [INF] Executed DbCommand (8ms) [Parameters=[@p0='?' (Size = 4000), @p1='?' (DbType = DateTime2), @p2='?' (Size = 4000), @p3='?' (Size = 4000), @p4='?' (Size = 4000), @p5='?' (Size = 450), @p6='?' (Size = 4000), @p7='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SET IMPLICIT_TRANSACTIONS OFF;
SET NOCOUNT ON;
INSERT INTO [AuthLogs] ([AuthType], [CreatedAt], [DeviceId], [FailureReason], [IpAddress], [NationalId], [Status], [UserAgent])
OUTPUT INSERTED.[Id]
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7);
2025-02-02 10:50:26.693 +03:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType9`2[[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Object, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-02-02 10:50:26.694 +03:00 [INF] Executed action NayifatAPI.Controllers.NotificationsController.GetNotifications (NayifatAPI) in 30.992ms
2025-02-02 10:50:26.696 +03:00 [INF] Executed endpoint 'NayifatAPI.Controllers.NotificationsController.GetNotifications (NayifatAPI)'
2025-02-02 10:50:26.697 +03:00 [INF] Request finished HTTP/1.1 POST http://07ca-46-152-255-232.ngrok-free.app/api/notifications/list - 200 null application/json; charset=utf-8 40.7819ms
2025-02-02 10:52:52.906 +03:00 [INF] Request starting HTTP/1.1 POST http://07ca-46-152-255-232.ngrok-free.app/api/auth/signin - application/json; charset=utf-8 224
2025-02-02 10:52:52.910 +03:00 [INF] Executing endpoint 'NayifatAPI.Controllers.AuthController.SignIn (NayifatAPI)'
2025-02-02 10:52:52.910 +03:00 [INF] Route matched with {action = "SignIn", controller = "Auth"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] SignIn(NayifatAPI.Controllers.SignInRequest) on controller NayifatAPI.Controllers.AuthController (NayifatAPI).
2025-02-02 10:52:52.916 +03:00 [INF] Executed DbCommand (2ms) [Parameters=[@__providedApiKey_0='?' (Size = 255)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [a].[Key], [a].[CreatedAt], [a].[Description], [a].[ExpiresAt], [a].[IsActive], [a].[LastUsedAt]
FROM [ApiKeys] AS [a]
WHERE [a].[Key] = @__providedApiKey_0 AND [a].[IsActive] = CAST(1 AS bit)
2025-02-02 10:52:52.920 +03:00 [INF] Executed DbCommand (2ms) [Parameters=[@__request_NationalId_0='?' (Size = 450)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [c].[NationalId], [c].[AddNo], [c].[BuildingNo], [c].[City], [c].[Consent], [c].[ConsentDate], [c].[DateOfBirth], [c].[Dependents], [c].[District], [c].[Email], [c].[Employer], [c].[FamilyNameAr], [c].[FamilyNameEn], [c].[FirstNameAr], [c].[FirstNameEn], [c].[Iban], [c].[IdExpiryDate], [c].[Los], [c].[Mpin], [c].[MpinEnabled], [c].[NafathStatus], [c].[NafathTimestamp], [c].[Password], [c].[Phone], [c].[RegistrationDate], [c].[SalaryCustomer], [c].[SalaryDakhli], [c].[SecondNameAr], [c].[SecondNameEn], [c].[Sector], [c].[Street], [c].[ThirdNameAr], [c].[ThirdNameEn], [c].[Zipcode]
FROM [Customers] AS [c]
WHERE [c].[NationalId] = @__request_NationalId_0
2025-02-02 10:52:52.922 +03:00 [INF] Starting password verification for NationalId: 1064448614
2025-02-02 10:52:53.097 +03:00 [INF] Password verification result for NationalId 1064448614: Success
2025-02-02 10:52:53.100 +03:00 [INF] Executed DbCommand (2ms) [Parameters=[@__request_NationalId_0='?' (Size = 450), @__request_DeviceId_1='?' (Size = 450)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [c].[Id], [c].[BiometricEnabled], [c].[BiometricToken], [c].[CreatedAt], [c].[DeviceId], [c].[LastUsedAt], [c].[Manufacturer], [c].[Model], [c].[NationalId], [c].[OsVersion], [c].[Platform], [c].[Status]
FROM [Customer_Devices] AS [c]
WHERE [c].[NationalId] = @__request_NationalId_0 AND [c].[DeviceId] = @__request_DeviceId_1 AND [c].[Status] = N'active'
2025-02-02 10:52:53.111 +03:00 [INF] Executed DbCommand (9ms) [Parameters=[@p0='?' (Size = 4000), @p1='?' (DbType = DateTime2), @p2='?' (Size = 4000), @p3='?' (Size = 4000), @p4='?' (Size = 4000), @p5='?' (Size = 450), @p6='?' (Size = 4000), @p7='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SET IMPLICIT_TRANSACTIONS OFF;
SET NOCOUNT ON;
INSERT INTO [AuthLogs] ([AuthType], [CreatedAt], [DeviceId], [FailureReason], [IpAddress], [NationalId], [Status], [UserAgent])
OUTPUT INSERTED.[Id]
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7);
2025-02-02 10:52:53.114 +03:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType9`2[[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Object, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-02-02 10:52:53.115 +03:00 [INF] Executed action NayifatAPI.Controllers.AuthController.SignIn (NayifatAPI) in 203.8793ms
2025-02-02 10:52:53.117 +03:00 [INF] Executed endpoint 'NayifatAPI.Controllers.AuthController.SignIn (NayifatAPI)'
2025-02-02 10:52:53.118 +03:00 [INF] Request finished HTTP/1.1 POST http://07ca-46-152-255-232.ngrok-free.app/api/auth/signin - 200 null application/json; charset=utf-8 211.7529ms
2025-02-02 10:52:53.619 +03:00 [INF] Request starting HTTP/1.1 POST http://07ca-46-152-255-232.ngrok-free.app/api/proxy/forward?url=https://icreditdept.com/api/testasp/test_local_generate_otp.php - application/json; charset=utf-8 84
2025-02-02 10:52:53.623 +03:00 [INF] Executing endpoint 'NayifatAPI.Controllers.ProxyController.ForwardRequest (NayifatAPI)'
2025-02-02 10:52:53.624 +03:00 [INF] Route matched with {action = "ForwardRequest", controller = "Proxy"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] ForwardRequest() on controller NayifatAPI.Controllers.ProxyController (NayifatAPI).
2025-02-02 10:52:53.626 +03:00 [INF] Start processing HTTP request POST https://icreditdept.com/api/testasp/test_local_generate_otp.php
2025-02-02 10:52:53.627 +03:00 [INF] Sending HTTP request POST https://icreditdept.com/api/testasp/test_local_generate_otp.php
2025-02-02 10:52:54.252 +03:00 [INF] Received HTTP response headers after 624.7043ms - 200
2025-02-02 10:52:54.254 +03:00 [INF] End processing HTTP request after 627.9865ms - 200
2025-02-02 10:52:54.255 +03:00 [INF] Raw response length: 200
2025-02-02 10:52:54.256 +03:00 [INF] Response content: {"success":true,"errors":[],"result":{"nationalId":"1064448614","otp":402518,"expiryDate":"2025-02-02 10:57:54","successMsg":"Success","errCode":0,"errMsg":null},"type":"N","message":null,"code":null}
2025-02-02 10:52:54.256 +03:00 [INF] Executing ContentResult with HTTP Response ContentType of application/json
2025-02-02 10:52:54.257 +03:00 [INF] Executed action NayifatAPI.Controllers.ProxyController.ForwardRequest (NayifatAPI) in 631.729ms
2025-02-02 10:52:54.258 +03:00 [INF] Executed endpoint 'NayifatAPI.Controllers.ProxyController.ForwardRequest (NayifatAPI)'
2025-02-02 10:52:54.260 +03:00 [INF] Request finished HTTP/1.1 POST http://07ca-46-152-255-232.ngrok-free.app/api/proxy/forward?url=https://icreditdept.com/api/testasp/test_local_generate_otp.php - 200 200 application/json 640.8677ms
2025-02-02 10:53:04.581 +03:00 [INF] Request starting HTTP/1.1 POST http://07ca-46-152-255-232.ngrok-free.app/api/proxy/forward?url=https://icreditdept.com/api/testasp/test_local_verify_otp.php - application/json; charset=utf-8 53
2025-02-02 10:53:04.584 +03:00 [INF] Executing endpoint 'NayifatAPI.Controllers.ProxyController.ForwardRequest (NayifatAPI)'
2025-02-02 10:53:04.585 +03:00 [INF] Route matched with {action = "ForwardRequest", controller = "Proxy"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] ForwardRequest() on controller NayifatAPI.Controllers.ProxyController (NayifatAPI).
2025-02-02 10:53:04.587 +03:00 [INF] Start processing HTTP request POST https://icreditdept.com/api/testasp/test_local_verify_otp.php
2025-02-02 10:53:04.588 +03:00 [INF] Sending HTTP request POST https://icreditdept.com/api/testasp/test_local_verify_otp.php
2025-02-02 10:53:05.049 +03:00 [INF] Received HTTP response headers after 460.4224ms - 200
2025-02-02 10:53:05.050 +03:00 [INF] End processing HTTP request after 463.2885ms - 200
2025-02-02 10:53:05.052 +03:00 [INF] Raw response length: 202
2025-02-02 10:53:05.053 +03:00 [INF] Response content: {"success":true,"errors":[],"result":{"nationalId":"1064448614","otp":"402518","verifiedFlag":true,"successMsg":"Verified successfully.","errCode":0,"errMsg":null},"type":"N","message":null,"code":null}
2025-02-02 10:53:05.054 +03:00 [INF] Executing ContentResult with HTTP Response ContentType of application/json
2025-02-02 10:53:05.055 +03:00 [INF] Executed action NayifatAPI.Controllers.ProxyController.ForwardRequest (NayifatAPI) in 468.3196ms
2025-02-02 10:53:05.056 +03:00 [INF] Executed endpoint 'NayifatAPI.Controllers.ProxyController.ForwardRequest (NayifatAPI)'
2025-02-02 10:53:05.058 +03:00 [INF] Request finished HTTP/1.1 POST http://07ca-46-152-255-232.ngrok-free.app/api/proxy/forward?url=https://icreditdept.com/api/testasp/test_local_verify_otp.php - 200 202 application/json 477.0831ms
2025-02-02 10:53:05.419 +03:00 [INF] Request starting HTTP/1.1 POST http://07ca-46-152-255-232.ngrok-free.app/api/auth/signin - application/json; charset=utf-8 49
2025-02-02 10:53:05.423 +03:00 [INF] Executing endpoint 'NayifatAPI.Controllers.AuthController.SignIn (NayifatAPI)'
2025-02-02 10:53:05.424 +03:00 [INF] Route matched with {action = "SignIn", controller = "Auth"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] SignIn(NayifatAPI.Controllers.SignInRequest) on controller NayifatAPI.Controllers.AuthController (NayifatAPI).
2025-02-02 10:53:05.425 +03:00 [INF] Executing BadRequestObjectResult, writing value of type 'Microsoft.AspNetCore.Mvc.ValidationProblemDetails'.
2025-02-02 10:53:05.426 +03:00 [INF] Executed action NayifatAPI.Controllers.AuthController.SignIn (NayifatAPI) in 1.4655ms
2025-02-02 10:53:05.427 +03:00 [INF] Executed endpoint 'NayifatAPI.Controllers.AuthController.SignIn (NayifatAPI)'
2025-02-02 10:53:05.428 +03:00 [INF] Request finished HTTP/1.1 POST http://07ca-46-152-255-232.ngrok-free.app/api/auth/signin - 400 null application/problem+json; charset=utf-8 9.0463ms
2025-02-02 10:55:28.488 +03:00 [INF] Request starting HTTP/1.1 POST http://07ca-46-152-255-232.ngrok-free.app/api/notifications/list - application/json; charset=utf-8 47
2025-02-02 10:55:28.490 +03:00 [INF] Executing endpoint 'NayifatAPI.Controllers.NotificationsController.GetNotifications (NayifatAPI)'
2025-02-02 10:55:28.491 +03:00 [INF] Route matched with {action = "GetNotifications", controller = "Notifications"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetNotifications(NayifatAPI.Controllers.GetNotificationsRequest) on controller NayifatAPI.Controllers.NotificationsController (NayifatAPI).
2025-02-02 10:55:28.496 +03:00 [INF] Executed DbCommand (3ms) [Parameters=[@__providedApiKey_0='?' (Size = 255)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [a].[Key], [a].[CreatedAt], [a].[Description], [a].[ExpiresAt], [a].[IsActive], [a].[LastUsedAt]
FROM [ApiKeys] AS [a]
WHERE [a].[Key] = @__providedApiKey_0 AND [a].[IsActive] = CAST(1 AS bit)
2025-02-02 10:55:28.501 +03:00 [INF] Executed DbCommand (3ms) [Parameters=[@__request_NationalId_0='?' (Size = 450)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [u].[national_id], [u].[last_updated], [u].[notifications]
FROM [user_notifications] AS [u]
WHERE [u].[national_id] = @__request_NationalId_0
2025-02-02 10:55:28.505 +03:00 [INF] Executed DbCommand (2ms) [Parameters=[@__Parse_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [n].[Id], [n].[additional_data], [n].[Body], [n].[body_ar], [n].[body_en], [n].[created_at], [n].[expiry_at], [n].[Route], [n].[target_criteria], [n].[Title], [n].[title_ar], [n].[title_en]
FROM [notification_templates] AS [n]
WHERE [n].[Id] = @__Parse_0
2025-02-02 10:55:28.511 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@__Parse_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [n].[Id], [n].[additional_data], [n].[Body], [n].[body_ar], [n].[body_en], [n].[created_at], [n].[expiry_at], [n].[Route], [n].[target_criteria], [n].[Title], [n].[title_ar], [n].[title_en]
FROM [notification_templates] AS [n]
WHERE [n].[Id] = @__Parse_0
2025-02-02 10:55:28.589 +03:00 [INF] Executed DbCommand (75ms) [Parameters=[@p0='?' (Size = 4000), @p1='?' (DbType = DateTime2), @p2='?' (Size = 4000), @p3='?' (Size = 4000), @p4='?' (Size = 4000), @p5='?' (Size = 450), @p6='?' (Size = 4000), @p7='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SET IMPLICIT_TRANSACTIONS OFF;
SET NOCOUNT ON;
INSERT INTO [AuthLogs] ([AuthType], [CreatedAt], [DeviceId], [FailureReason], [IpAddress], [NationalId], [Status], [UserAgent])
OUTPUT INSERTED.[Id]
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7);
2025-02-02 10:55:28.592 +03:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType9`2[[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Object, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-02-02 10:55:28.592 +03:00 [INF] Executed action NayifatAPI.Controllers.NotificationsController.GetNotifications (NayifatAPI) in 100.3797ms
2025-02-02 10:55:28.594 +03:00 [INF] Executed endpoint 'NayifatAPI.Controllers.NotificationsController.GetNotifications (NayifatAPI)'
2025-02-02 10:55:28.595 +03:00 [INF] Request finished HTTP/1.1 POST http://07ca-46-152-255-232.ngrok-free.app/api/notifications/list - 200 null application/json; charset=utf-8 107.2785ms
2025-02-02 10:56:01.809 +03:00 [INF] Request starting HTTP/1.1 POST http://07ca-46-152-255-232.ngrok-free.app/api/auth/signin - application/json; charset=utf-8 224
2025-02-02 10:56:01.819 +03:00 [INF] Executing endpoint 'NayifatAPI.Controllers.AuthController.SignIn (NayifatAPI)'
2025-02-02 10:56:01.822 +03:00 [INF] Route matched with {action = "SignIn", controller = "Auth"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] SignIn(NayifatAPI.Controllers.SignInRequest) on controller NayifatAPI.Controllers.AuthController (NayifatAPI).
2025-02-02 10:56:01.829 +03:00 [INF] Executed DbCommand (3ms) [Parameters=[@__providedApiKey_0='?' (Size = 255)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [a].[Key], [a].[CreatedAt], [a].[Description], [a].[ExpiresAt], [a].[IsActive], [a].[LastUsedAt]
FROM [ApiKeys] AS [a]
WHERE [a].[Key] = @__providedApiKey_0 AND [a].[IsActive] = CAST(1 AS bit)
2025-02-02 10:56:01.836 +03:00 [INF] Executed DbCommand (4ms) [Parameters=[@__request_NationalId_0='?' (Size = 450)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [c].[NationalId], [c].[AddNo], [c].[BuildingNo], [c].[City], [c].[Consent], [c].[ConsentDate], [c].[DateOfBirth], [c].[Dependents], [c].[District], [c].[Email], [c].[Employer], [c].[FamilyNameAr], [c].[FamilyNameEn], [c].[FirstNameAr], [c].[FirstNameEn], [c].[Iban], [c].[IdExpiryDate], [c].[Los], [c].[Mpin], [c].[MpinEnabled], [c].[NafathStatus], [c].[NafathTimestamp], [c].[Password], [c].[Phone], [c].[RegistrationDate], [c].[SalaryCustomer], [c].[SalaryDakhli], [c].[SecondNameAr], [c].[SecondNameEn], [c].[Sector], [c].[Street], [c].[ThirdNameAr], [c].[ThirdNameEn], [c].[Zipcode]
FROM [Customers] AS [c]
WHERE [c].[NationalId] = @__request_NationalId_0
2025-02-02 10:56:01.841 +03:00 [INF] Starting password verification for NationalId: 1064448614
2025-02-02 10:56:02.027 +03:00 [INF] Password verification result for NationalId 1064448614: Success
2025-02-02 10:56:02.031 +03:00 [INF] Executed DbCommand (3ms) [Parameters=[@__request_NationalId_0='?' (Size = 450), @__request_DeviceId_1='?' (Size = 450)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [c].[Id], [c].[BiometricEnabled], [c].[BiometricToken], [c].[CreatedAt], [c].[DeviceId], [c].[LastUsedAt], [c].[Manufacturer], [c].[Model], [c].[NationalId], [c].[OsVersion], [c].[Platform], [c].[Status]
FROM [Customer_Devices] AS [c]
WHERE [c].[NationalId] = @__request_NationalId_0 AND [c].[DeviceId] = @__request_DeviceId_1 AND [c].[Status] = N'active'
2025-02-02 10:56:02.043 +03:00 [INF] Executed DbCommand (9ms) [Parameters=[@p0='?' (Size = 4000), @p1='?' (DbType = DateTime2), @p2='?' (Size = 4000), @p3='?' (Size = 4000), @p4='?' (Size = 4000), @p5='?' (Size = 450), @p6='?' (Size = 4000), @p7='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SET IMPLICIT_TRANSACTIONS OFF;
SET NOCOUNT ON;
INSERT INTO [AuthLogs] ([AuthType], [CreatedAt], [DeviceId], [FailureReason], [IpAddress], [NationalId], [Status], [UserAgent])
OUTPUT INSERTED.[Id]
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7);
2025-02-02 10:56:02.045 +03:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType9`2[[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Object, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-02-02 10:56:02.046 +03:00 [INF] Executed action NayifatAPI.Controllers.AuthController.SignIn (NayifatAPI) in 222.0654ms
2025-02-02 10:56:02.048 +03:00 [INF] Executed endpoint 'NayifatAPI.Controllers.AuthController.SignIn (NayifatAPI)'
2025-02-02 10:56:02.049 +03:00 [INF] Request finished HTTP/1.1 POST http://07ca-46-152-255-232.ngrok-free.app/api/auth/signin - 200 null application/json; charset=utf-8 239.7376ms
2025-02-02 10:56:02.515 +03:00 [INF] Request starting HTTP/1.1 POST http://07ca-46-152-255-232.ngrok-free.app/api/proxy/forward?url=https://icreditdept.com/api/testasp/test_local_generate_otp.php - application/json; charset=utf-8 84
2025-02-02 10:56:02.518 +03:00 [INF] Executing endpoint 'NayifatAPI.Controllers.ProxyController.ForwardRequest (NayifatAPI)'
2025-02-02 10:56:02.519 +03:00 [INF] Route matched with {action = "ForwardRequest", controller = "Proxy"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] ForwardRequest() on controller NayifatAPI.Controllers.ProxyController (NayifatAPI).
2025-02-02 10:56:02.521 +03:00 [INF] Start processing HTTP request POST https://icreditdept.com/api/testasp/test_local_generate_otp.php
2025-02-02 10:56:02.523 +03:00 [INF] Sending HTTP request POST https://icreditdept.com/api/testasp/test_local_generate_otp.php
2025-02-02 10:56:03.128 +03:00 [INF] Received HTTP response headers after 604.071ms - 200
2025-02-02 10:56:03.130 +03:00 [INF] End processing HTTP request after 608.6887ms - 200
2025-02-02 10:56:03.131 +03:00 [INF] Raw response length: 200
2025-02-02 10:56:03.131 +03:00 [INF] Response content: {"success":true,"errors":[],"result":{"nationalId":"1064448614","otp":603933,"expiryDate":"2025-02-02 11:01:03","successMsg":"Success","errCode":0,"errMsg":null},"type":"N","message":null,"code":null}
2025-02-02 10:56:03.132 +03:00 [INF] Executing ContentResult with HTTP Response ContentType of application/json
2025-02-02 10:56:03.133 +03:00 [INF] Executed action NayifatAPI.Controllers.ProxyController.ForwardRequest (NayifatAPI) in 612.3155ms
2025-02-02 10:56:03.134 +03:00 [INF] Executed endpoint 'NayifatAPI.Controllers.ProxyController.ForwardRequest (NayifatAPI)'
2025-02-02 10:56:03.136 +03:00 [INF] Request finished HTTP/1.1 POST http://07ca-46-152-255-232.ngrok-free.app/api/proxy/forward?url=https://icreditdept.com/api/testasp/test_local_generate_otp.php - 200 200 application/json 620.6187ms
2025-02-02 10:56:22.114 +03:00 [INF] Request starting HTTP/1.1 POST http://07ca-46-152-255-232.ngrok-free.app/api/proxy/forward?url=https://icreditdept.com/api/testasp/test_local_verify_otp.php - application/json; charset=utf-8 53
2025-02-02 10:56:22.116 +03:00 [INF] Executing endpoint 'NayifatAPI.Controllers.ProxyController.ForwardRequest (NayifatAPI)'
2025-02-02 10:56:22.117 +03:00 [INF] Route matched with {action = "ForwardRequest", controller = "Proxy"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] ForwardRequest() on controller NayifatAPI.Controllers.ProxyController (NayifatAPI).
2025-02-02 10:56:22.119 +03:00 [INF] Start processing HTTP request POST https://icreditdept.com/api/testasp/test_local_verify_otp.php
2025-02-02 10:56:22.119 +03:00 [INF] Sending HTTP request POST https://icreditdept.com/api/testasp/test_local_verify_otp.php
2025-02-02 10:56:22.373 +03:00 [INF] Received HTTP response headers after 253.0104ms - 200
2025-02-02 10:56:22.375 +03:00 [INF] End processing HTTP request after 256.4012ms - 200
2025-02-02 10:56:22.379 +03:00 [INF] Raw response length: 202
2025-02-02 10:56:22.380 +03:00 [INF] Response content: {"success":true,"errors":[],"result":{"nationalId":"1064448614","otp":"603933","verifiedFlag":true,"successMsg":"Verified successfully.","errCode":0,"errMsg":null},"type":"N","message":null,"code":null}
2025-02-02 10:56:22.381 +03:00 [INF] Executing ContentResult with HTTP Response ContentType of application/json
2025-02-02 10:56:22.381 +03:00 [INF] Executed action NayifatAPI.Controllers.ProxyController.ForwardRequest (NayifatAPI) in 263.0263ms
2025-02-02 10:56:22.382 +03:00 [INF] Executed endpoint 'NayifatAPI.Controllers.ProxyController.ForwardRequest (NayifatAPI)'
2025-02-02 10:56:22.383 +03:00 [INF] Request finished HTTP/1.1 POST http://07ca-46-152-255-232.ngrok-free.app/api/proxy/forward?url=https://icreditdept.com/api/testasp/test_local_verify_otp.php - 200 202 application/json 269.3669ms
2025-02-02 10:57:04.040 +03:00 [INF] Request starting HTTP/1.1 POST http://07ca-46-152-255-232.ngrok-free.app/api/notifications/list - application/json; charset=utf-8 47
2025-02-02 10:57:04.047 +03:00 [INF] Executing endpoint 'NayifatAPI.Controllers.NotificationsController.GetNotifications (NayifatAPI)'
2025-02-02 10:57:04.047 +03:00 [INF] Route matched with {action = "GetNotifications", controller = "Notifications"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetNotifications(NayifatAPI.Controllers.GetNotificationsRequest) on controller NayifatAPI.Controllers.NotificationsController (NayifatAPI).
2025-02-02 10:57:04.052 +03:00 [INF] Executed DbCommand (2ms) [Parameters=[@__providedApiKey_0='?' (Size = 255)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [a].[Key], [a].[CreatedAt], [a].[Description], [a].[ExpiresAt], [a].[IsActive], [a].[LastUsedAt]
FROM [ApiKeys] AS [a]
WHERE [a].[Key] = @__providedApiKey_0 AND [a].[IsActive] = CAST(1 AS bit)
2025-02-02 10:57:04.058 +03:00 [INF] Executed DbCommand (3ms) [Parameters=[@__request_NationalId_0='?' (Size = 450)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [u].[national_id], [u].[last_updated], [u].[notifications]
FROM [user_notifications] AS [u]
WHERE [u].[national_id] = @__request_NationalId_0
2025-02-02 10:57:04.062 +03:00 [INF] Executed DbCommand (2ms) [Parameters=[@__Parse_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [n].[Id], [n].[additional_data], [n].[Body], [n].[body_ar], [n].[body_en], [n].[created_at], [n].[expiry_at], [n].[Route], [n].[target_criteria], [n].[Title], [n].[title_ar], [n].[title_en]
FROM [notification_templates] AS [n]
WHERE [n].[Id] = @__Parse_0
2025-02-02 10:57:04.065 +03:00 [INF] Executed DbCommand (0ms) [Parameters=[@__Parse_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [n].[Id], [n].[additional_data], [n].[Body], [n].[body_ar], [n].[body_en], [n].[created_at], [n].[expiry_at], [n].[Route], [n].[target_criteria], [n].[Title], [n].[title_ar], [n].[title_en]
FROM [notification_templates] AS [n]
WHERE [n].[Id] = @__Parse_0
2025-02-02 10:57:04.076 +03:00 [INF] Executed DbCommand (9ms) [Parameters=[@p0='?' (Size = 4000), @p1='?' (DbType = DateTime2), @p2='?' (Size = 4000), @p3='?' (Size = 4000), @p4='?' (Size = 4000), @p5='?' (Size = 450), @p6='?' (Size = 4000), @p7='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SET IMPLICIT_TRANSACTIONS OFF;
SET NOCOUNT ON;
INSERT INTO [AuthLogs] ([AuthType], [CreatedAt], [DeviceId], [FailureReason], [IpAddress], [NationalId], [Status], [UserAgent])
OUTPUT INSERTED.[Id]
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7);
2025-02-02 10:57:04.079 +03:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType9`2[[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Object, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-02-02 10:57:04.080 +03:00 [INF] Executed action NayifatAPI.Controllers.NotificationsController.GetNotifications (NayifatAPI) in 31.5516ms
2025-02-02 10:57:04.081 +03:00 [INF] Executed endpoint 'NayifatAPI.Controllers.NotificationsController.GetNotifications (NayifatAPI)'
2025-02-02 10:57:04.082 +03:00 [INF] Request finished HTTP/1.1 POST http://07ca-46-152-255-232.ngrok-free.app/api/notifications/list - 200 null application/json; charset=utf-8 41.9362ms
2025-02-02 10:57:56.172 +03:00 [INF] Request starting HTTP/1.1 POST http://07ca-46-152-255-232.ngrok-free.app/api/auth/signin - application/json; charset=utf-8 224
2025-02-02 10:57:56.280 +03:00 [INF] Executing endpoint 'NayifatAPI.Controllers.AuthController.SignIn (NayifatAPI)'
2025-02-02 10:57:56.282 +03:00 [INF] Route matched with {action = "SignIn", controller = "Auth"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] SignIn(NayifatAPI.Controllers.SignInRequest) on controller NayifatAPI.Controllers.AuthController (NayifatAPI).
2025-02-02 10:57:56.289 +03:00 [INF] Executed DbCommand (3ms) [Parameters=[@__providedApiKey_0='?' (Size = 255)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [a].[Key], [a].[CreatedAt], [a].[Description], [a].[ExpiresAt], [a].[IsActive], [a].[LastUsedAt]
FROM [ApiKeys] AS [a]
WHERE [a].[Key] = @__providedApiKey_0 AND [a].[IsActive] = CAST(1 AS bit)
2025-02-02 10:57:56.297 +03:00 [INF] Executed DbCommand (4ms) [Parameters=[@__request_NationalId_0='?' (Size = 450)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [c].[NationalId], [c].[AddNo], [c].[BuildingNo], [c].[City], [c].[Consent], [c].[ConsentDate], [c].[DateOfBirth], [c].[Dependents], [c].[District], [c].[Email], [c].[Employer], [c].[FamilyNameAr], [c].[FamilyNameEn], [c].[FirstNameAr], [c].[FirstNameEn], [c].[Iban], [c].[IdExpiryDate], [c].[Los], [c].[Mpin], [c].[MpinEnabled], [c].[NafathStatus], [c].[NafathTimestamp], [c].[Password], [c].[Phone], [c].[RegistrationDate], [c].[SalaryCustomer], [c].[SalaryDakhli], [c].[SecondNameAr], [c].[SecondNameEn], [c].[Sector], [c].[Street], [c].[ThirdNameAr], [c].[ThirdNameEn], [c].[Zipcode]
FROM [Customers] AS [c]
WHERE [c].[NationalId] = @__request_NationalId_0
2025-02-02 10:57:56.300 +03:00 [INF] Starting password verification for NationalId: 1064448614
2025-02-02 10:57:56.640 +03:00 [INF] Password verification result for NationalId 1064448614: Success
2025-02-02 10:57:56.674 +03:00 [INF] Executed DbCommand (3ms) [Parameters=[@__request_NationalId_0='?' (Size = 450), @__request_DeviceId_1='?' (Size = 450)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [c].[Id], [c].[BiometricEnabled], [c].[BiometricToken], [c].[CreatedAt], [c].[DeviceId], [c].[LastUsedAt], [c].[Manufacturer], [c].[Model], [c].[NationalId], [c].[OsVersion], [c].[Platform], [c].[Status]
FROM [Customer_Devices] AS [c]
WHERE [c].[NationalId] = @__request_NationalId_0 AND [c].[DeviceId] = @__request_DeviceId_1 AND [c].[Status] = N'active'
2025-02-02 10:57:56.757 +03:00 [INF] Executed DbCommand (79ms) [Parameters=[@p0='?' (Size = 4000), @p1='?' (DbType = DateTime2), @p2='?' (Size = 4000), @p3='?' (Size = 4000), @p4='?' (Size = 4000), @p5='?' (Size = 450), @p6='?' (Size = 4000), @p7='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SET IMPLICIT_TRANSACTIONS OFF;
SET NOCOUNT ON;
INSERT INTO [AuthLogs] ([AuthType], [CreatedAt], [DeviceId], [FailureReason], [IpAddress], [NationalId], [Status], [UserAgent])
OUTPUT INSERTED.[Id]
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7);
2025-02-02 10:57:56.759 +03:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType9`2[[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Object, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-02-02 10:57:56.761 +03:00 [INF] Executed action NayifatAPI.Controllers.AuthController.SignIn (NayifatAPI) in 476.7138ms
2025-02-02 10:57:56.763 +03:00 [INF] Executed endpoint 'NayifatAPI.Controllers.AuthController.SignIn (NayifatAPI)'
2025-02-02 10:57:56.765 +03:00 [INF] Request finished HTTP/1.1 POST http://07ca-46-152-255-232.ngrok-free.app/api/auth/signin - 200 null application/json; charset=utf-8 592.3785ms
2025-02-02 10:57:57.299 +03:00 [INF] Request starting HTTP/1.1 POST http://07ca-46-152-255-232.ngrok-free.app/api/proxy/forward?url=https://icreditdept.com/api/testasp/test_local_generate_otp.php - application/json; charset=utf-8 84
2025-02-02 10:57:57.304 +03:00 [INF] Executing endpoint 'NayifatAPI.Controllers.ProxyController.ForwardRequest (NayifatAPI)'
2025-02-02 10:57:57.305 +03:00 [INF] Route matched with {action = "ForwardRequest", controller = "Proxy"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] ForwardRequest() on controller NayifatAPI.Controllers.ProxyController (NayifatAPI).
2025-02-02 10:57:57.307 +03:00 [INF] Start processing HTTP request POST https://icreditdept.com/api/testasp/test_local_generate_otp.php
2025-02-02 10:57:57.308 +03:00 [INF] Sending HTTP request POST https://icreditdept.com/api/testasp/test_local_generate_otp.php
2025-02-02 10:57:57.827 +03:00 [INF] Received HTTP response headers after 518.5777ms - 200
2025-02-02 10:57:57.828 +03:00 [INF] End processing HTTP request after 520.6429ms - 200
2025-02-02 10:57:57.828 +03:00 [INF] Raw response length: 200
2025-02-02 10:57:57.829 +03:00 [INF] Response content: {"success":true,"errors":[],"result":{"nationalId":"1064448614","otp":709148,"expiryDate":"2025-02-02 11:02:58","successMsg":"Success","errCode":0,"errMsg":null},"type":"N","message":null,"code":null}
2025-02-02 10:57:57.830 +03:00 [INF] Executing ContentResult with HTTP Response ContentType of application/json
2025-02-02 10:57:57.830 +03:00 [INF] Executed action NayifatAPI.Controllers.ProxyController.ForwardRequest (NayifatAPI) in 523.832ms
2025-02-02 10:57:57.832 +03:00 [INF] Executed endpoint 'NayifatAPI.Controllers.ProxyController.ForwardRequest (NayifatAPI)'
2025-02-02 10:57:57.834 +03:00 [INF] Request finished HTTP/1.1 POST http://07ca-46-152-255-232.ngrok-free.app/api/proxy/forward?url=https://icreditdept.com/api/testasp/test_local_generate_otp.php - 200 200 application/json 535.0293ms
2025-02-02 10:58:22.792 +03:00 [INF] Request starting HTTP/1.1 POST http://07ca-46-152-255-232.ngrok-free.app/api/proxy/forward?url=https://icreditdept.com/api/testasp/test_local_verify_otp.php - application/json; charset=utf-8 53
2025-02-02 10:58:22.795 +03:00 [INF] Executing endpoint 'NayifatAPI.Controllers.ProxyController.ForwardRequest (NayifatAPI)'
2025-02-02 10:58:22.796 +03:00 [INF] Route matched with {action = "ForwardRequest", controller = "Proxy"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] ForwardRequest() on controller NayifatAPI.Controllers.ProxyController (NayifatAPI).
2025-02-02 10:58:22.798 +03:00 [INF] Start processing HTTP request POST https://icreditdept.com/api/testasp/test_local_verify_otp.php
2025-02-02 10:58:22.800 +03:00 [INF] Sending HTTP request POST https://icreditdept.com/api/testasp/test_local_verify_otp.php
2025-02-02 10:58:23.362 +03:00 [INF] Received HTTP response headers after 561.0864ms - 200
2025-02-02 10:58:23.364 +03:00 [INF] End processing HTTP request after 566.1308ms - 200
2025-02-02 10:58:23.365 +03:00 [INF] Raw response length: 202
2025-02-02 10:58:23.365 +03:00 [INF] Response content: {"success":true,"errors":[],"result":{"nationalId":"1064448614","otp":"709148","verifiedFlag":true,"successMsg":"Verified successfully.","errCode":0,"errMsg":null},"type":"N","message":null,"code":null}
2025-02-02 10:58:23.366 +03:00 [INF] Executing ContentResult with HTTP Response ContentType of application/json
2025-02-02 10:58:23.367 +03:00 [INF] Executed action NayifatAPI.Controllers.ProxyController.ForwardRequest (NayifatAPI) in 569.1757ms
2025-02-02 10:58:23.368 +03:00 [INF] Executed endpoint 'NayifatAPI.Controllers.ProxyController.ForwardRequest (NayifatAPI)'
2025-02-02 10:58:23.369 +03:00 [INF] Request finished HTTP/1.1 POST http://07ca-46-152-255-232.ngrok-free.app/api/proxy/forward?url=https://icreditdept.com/api/testasp/test_local_verify_otp.php - 200 202 application/json 576.986ms
2025-02-02 11:02:10.745 +03:00 [INF] Request starting HTTP/1.1 POST http://07ca-46-152-255-232.ngrok-free.app/api/notifications/list - application/json; charset=utf-8 47
2025-02-02 11:02:10.748 +03:00 [INF] Executing endpoint 'NayifatAPI.Controllers.NotificationsController.GetNotifications (NayifatAPI)'
2025-02-02 11:02:10.749 +03:00 [INF] Route matched with {action = "GetNotifications", controller = "Notifications"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetNotifications(NayifatAPI.Controllers.GetNotificationsRequest) on controller NayifatAPI.Controllers.NotificationsController (NayifatAPI).
2025-02-02 11:02:10.829 +03:00 [INF] Executed DbCommand (78ms) [Parameters=[@__providedApiKey_0='?' (Size = 255)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [a].[Key], [a].[CreatedAt], [a].[Description], [a].[ExpiresAt], [a].[IsActive], [a].[LastUsedAt]
FROM [ApiKeys] AS [a]
WHERE [a].[Key] = @__providedApiKey_0 AND [a].[IsActive] = CAST(1 AS bit)
2025-02-02 11:02:10.835 +03:00 [INF] Executed DbCommand (3ms) [Parameters=[@__request_NationalId_0='?' (Size = 450)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [u].[national_id], [u].[last_updated], [u].[notifications]
FROM [user_notifications] AS [u]
WHERE [u].[national_id] = @__request_NationalId_0
2025-02-02 11:02:10.841 +03:00 [INF] Executed DbCommand (3ms) [Parameters=[@__Parse_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [n].[Id], [n].[additional_data], [n].[Body], [n].[body_ar], [n].[body_en], [n].[created_at], [n].[expiry_at], [n].[Route], [n].[target_criteria], [n].[Title], [n].[title_ar], [n].[title_en]
FROM [notification_templates] AS [n]
WHERE [n].[Id] = @__Parse_0
2025-02-02 11:02:10.845 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@__Parse_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [n].[Id], [n].[additional_data], [n].[Body], [n].[body_ar], [n].[body_en], [n].[created_at], [n].[expiry_at], [n].[Route], [n].[target_criteria], [n].[Title], [n].[title_ar], [n].[title_en]
FROM [notification_templates] AS [n]
WHERE [n].[Id] = @__Parse_0
2025-02-02 11:02:10.852 +03:00 [INF] Executed DbCommand (4ms) [Parameters=[@p0='?' (Size = 4000), @p1='?' (DbType = DateTime2), @p2='?' (Size = 4000), @p3='?' (Size = 4000), @p4='?' (Size = 4000), @p5='?' (Size = 450), @p6='?' (Size = 4000), @p7='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SET IMPLICIT_TRANSACTIONS OFF;
SET NOCOUNT ON;
INSERT INTO [AuthLogs] ([AuthType], [CreatedAt], [DeviceId], [FailureReason], [IpAddress], [NationalId], [Status], [UserAgent])
OUTPUT INSERTED.[Id]
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7);
2025-02-02 11:02:10.855 +03:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType9`2[[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Object, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-02-02 11:02:10.858 +03:00 [INF] Executed action NayifatAPI.Controllers.NotificationsController.GetNotifications (NayifatAPI) in 107.529ms
2025-02-02 11:02:10.859 +03:00 [INF] Executed endpoint 'NayifatAPI.Controllers.NotificationsController.GetNotifications (NayifatAPI)'
2025-02-02 11:02:10.862 +03:00 [INF] Request finished HTTP/1.1 POST http://07ca-46-152-255-232.ngrok-free.app/api/notifications/list - 200 null application/json; charset=utf-8 116.8981ms
2025-02-02 11:08:07.925 +03:00 [INF] Request starting HTTP/1.1 POST http://07ca-46-152-255-232.ngrok-free.app/api/notifications/list - application/json; charset=utf-8 47
2025-02-02 11:08:07.928 +03:00 [INF] Executing endpoint 'NayifatAPI.Controllers.NotificationsController.GetNotifications (NayifatAPI)'
2025-02-02 11:08:07.929 +03:00 [INF] Route matched with {action = "GetNotifications", controller = "Notifications"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetNotifications(NayifatAPI.Controllers.GetNotificationsRequest) on controller NayifatAPI.Controllers.NotificationsController (NayifatAPI).
2025-02-02 11:08:07.947 +03:00 [INF] Executed DbCommand (10ms) [Parameters=[@__providedApiKey_0='?' (Size = 255)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [a].[Key], [a].[CreatedAt], [a].[Description], [a].[ExpiresAt], [a].[IsActive], [a].[LastUsedAt]
FROM [ApiKeys] AS [a]
WHERE [a].[Key] = @__providedApiKey_0 AND [a].[IsActive] = CAST(1 AS bit)
2025-02-02 11:08:07.962 +03:00 [INF] Executed DbCommand (13ms) [Parameters=[@__request_NationalId_0='?' (Size = 450)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [u].[national_id], [u].[last_updated], [u].[notifications]
FROM [user_notifications] AS [u]
WHERE [u].[national_id] = @__request_NationalId_0
2025-02-02 11:08:07.998 +03:00 [INF] Executed DbCommand (34ms) [Parameters=[@__Parse_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [n].[Id], [n].[additional_data], [n].[Body], [n].[body_ar], [n].[body_en], [n].[created_at], [n].[expiry_at], [n].[Route], [n].[target_criteria], [n].[Title], [n].[title_ar], [n].[title_en]
FROM [notification_templates] AS [n]
WHERE [n].[Id] = @__Parse_0
2025-02-02 11:08:08.001 +03:00 [INF] Executed DbCommand (0ms) [Parameters=[@__Parse_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [n].[Id], [n].[additional_data], [n].[Body], [n].[body_ar], [n].[body_en], [n].[created_at], [n].[expiry_at], [n].[Route], [n].[target_criteria], [n].[Title], [n].[title_ar], [n].[title_en]
FROM [notification_templates] AS [n]
WHERE [n].[Id] = @__Parse_0
2025-02-02 11:08:08.010 +03:00 [INF] Executed DbCommand (7ms) [Parameters=[@p0='?' (Size = 4000), @p1='?' (DbType = DateTime2), @p2='?' (Size = 4000), @p3='?' (Size = 4000), @p4='?' (Size = 4000), @p5='?' (Size = 450), @p6='?' (Size = 4000), @p7='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SET IMPLICIT_TRANSACTIONS OFF;
SET NOCOUNT ON;
INSERT INTO [AuthLogs] ([AuthType], [CreatedAt], [DeviceId], [FailureReason], [IpAddress], [NationalId], [Status], [UserAgent])
OUTPUT INSERTED.[Id]
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7);
2025-02-02 11:08:08.012 +03:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType9`2[[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Object, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-02-02 11:08:08.013 +03:00 [INF] Executed action NayifatAPI.Controllers.NotificationsController.GetNotifications (NayifatAPI) in 82.8196ms
2025-02-02 11:08:08.015 +03:00 [INF] Executed endpoint 'NayifatAPI.Controllers.NotificationsController.GetNotifications (NayifatAPI)'
2025-02-02 11:08:08.016 +03:00 [INF] Request finished HTTP/1.1 POST http://07ca-46-152-255-232.ngrok-free.app/api/notifications/list - 200 null application/json; charset=utf-8 90.13ms
2025-02-02 11:10:59.019 +03:00 [INF] Request starting HTTP/1.1 POST http://07ca-46-152-255-232.ngrok-free.app/api/notifications/list - application/json; charset=utf-8 47
2025-02-02 11:10:59.142 +03:00 [INF] Executing endpoint 'NayifatAPI.Controllers.NotificationsController.GetNotifications (NayifatAPI)'
2025-02-02 11:10:59.173 +03:00 [INF] Route matched with {action = "GetNotifications", controller = "Notifications"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetNotifications(NayifatAPI.Controllers.GetNotificationsRequest) on controller NayifatAPI.Controllers.NotificationsController (NayifatAPI).
2025-02-02 11:10:59.208 +03:00 [INF] Executed DbCommand (21ms) [Parameters=[@__providedApiKey_0='?' (Size = 255)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [a].[Key], [a].[CreatedAt], [a].[Description], [a].[ExpiresAt], [a].[IsActive], [a].[LastUsedAt]
FROM [ApiKeys] AS [a]
WHERE [a].[Key] = @__providedApiKey_0 AND [a].[IsActive] = CAST(1 AS bit)
2025-02-02 11:10:59.218 +03:00 [INF] Executed DbCommand (4ms) [Parameters=[@__request_NationalId_0='?' (Size = 450)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [u].[national_id], [u].[last_updated], [u].[notifications]
FROM [user_notifications] AS [u]
WHERE [u].[national_id] = @__request_NationalId_0
2025-02-02 11:10:59.236 +03:00 [INF] Executed DbCommand (5ms) [Parameters=[@__Parse_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [n].[Id], [n].[additional_data], [n].[Body], [n].[body_ar], [n].[body_en], [n].[created_at], [n].[expiry_at], [n].[Route], [n].[target_criteria], [n].[Title], [n].[title_ar], [n].[title_en]
FROM [notification_templates] AS [n]
WHERE [n].[Id] = @__Parse_0
2025-02-02 11:10:59.249 +03:00 [INF] Executed DbCommand (2ms) [Parameters=[@__Parse_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [n].[Id], [n].[additional_data], [n].[Body], [n].[body_ar], [n].[body_en], [n].[created_at], [n].[expiry_at], [n].[Route], [n].[target_criteria], [n].[Title], [n].[title_ar], [n].[title_en]
FROM [notification_templates] AS [n]
WHERE [n].[Id] = @__Parse_0
2025-02-02 11:10:59.349 +03:00 [INF] Executed DbCommand (84ms) [Parameters=[@p0='?' (Size = 4000), @p1='?' (DbType = DateTime2), @p2='?' (Size = 4000), @p3='?' (Size = 4000), @p4='?' (Size = 4000), @p5='?' (Size = 450), @p6='?' (Size = 4000), @p7='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SET IMPLICIT_TRANSACTIONS OFF;
SET NOCOUNT ON;
INSERT INTO [AuthLogs] ([AuthType], [CreatedAt], [DeviceId], [FailureReason], [IpAddress], [NationalId], [Status], [UserAgent])
OUTPUT INSERTED.[Id]
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7);
2025-02-02 11:10:59.360 +03:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType9`2[[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Object, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-02-02 11:10:59.380 +03:00 [INF] Executed action NayifatAPI.Controllers.NotificationsController.GetNotifications (NayifatAPI) in 197.522ms
2025-02-02 11:10:59.385 +03:00 [INF] Executed endpoint 'NayifatAPI.Controllers.NotificationsController.GetNotifications (NayifatAPI)'
2025-02-02 11:10:59.389 +03:00 [INF] Request finished HTTP/1.1 POST http://07ca-46-152-255-232.ngrok-free.app/api/notifications/list - 200 null application/json; charset=utf-8 370.1488ms
2025-02-02 11:16:00.335 +03:00 [INF] Request starting HTTP/1.1 POST http://07ca-46-152-255-232.ngrok-free.app/api/notifications/list - application/json; charset=utf-8 47
2025-02-02 11:16:00.339 +03:00 [INF] Executing endpoint 'NayifatAPI.Controllers.NotificationsController.GetNotifications (NayifatAPI)'
2025-02-02 11:16:00.341 +03:00 [INF] Route matched with {action = "GetNotifications", controller = "Notifications"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetNotifications(NayifatAPI.Controllers.GetNotificationsRequest) on controller NayifatAPI.Controllers.NotificationsController (NayifatAPI).
2025-02-02 11:16:00.361 +03:00 [INF] Executed DbCommand (16ms) [Parameters=[@__providedApiKey_0='?' (Size = 255)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [a].[Key], [a].[CreatedAt], [a].[Description], [a].[ExpiresAt], [a].[IsActive], [a].[LastUsedAt]
FROM [ApiKeys] AS [a]
WHERE [a].[Key] = @__providedApiKey_0 AND [a].[IsActive] = CAST(1 AS bit)
2025-02-02 11:16:00.368 +03:00 [INF] Executed DbCommand (4ms) [Parameters=[@__request_NationalId_0='?' (Size = 450)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [u].[national_id], [u].[last_updated], [u].[notifications]
FROM [user_notifications] AS [u]
WHERE [u].[national_id] = @__request_NationalId_0
2025-02-02 11:16:00.377 +03:00 [INF] Executed DbCommand (6ms) [Parameters=[@__Parse_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [n].[Id], [n].[additional_data], [n].[Body], [n].[body_ar], [n].[body_en], [n].[created_at], [n].[expiry_at], [n].[Route], [n].[target_criteria], [n].[Title], [n].[title_ar], [n].[title_en]
FROM [notification_templates] AS [n]
WHERE [n].[Id] = @__Parse_0
2025-02-02 11:16:00.382 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@__Parse_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [n].[Id], [n].[additional_data], [n].[Body], [n].[body_ar], [n].[body_en], [n].[created_at], [n].[expiry_at], [n].[Route], [n].[target_criteria], [n].[Title], [n].[title_ar], [n].[title_en]
FROM [notification_templates] AS [n]
WHERE [n].[Id] = @__Parse_0
2025-02-02 11:16:00.396 +03:00 [INF] Executed DbCommand (10ms) [Parameters=[@p0='?' (Size = 4000), @p1='?' (DbType = DateTime2), @p2='?' (Size = 4000), @p3='?' (Size = 4000), @p4='?' (Size = 4000), @p5='?' (Size = 450), @p6='?' (Size = 4000), @p7='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SET IMPLICIT_TRANSACTIONS OFF;
SET NOCOUNT ON;
INSERT INTO [AuthLogs] ([AuthType], [CreatedAt], [DeviceId], [FailureReason], [IpAddress], [NationalId], [Status], [UserAgent])
OUTPUT INSERTED.[Id]
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7);
2025-02-02 11:16:00.400 +03:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType9`2[[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Object, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-02-02 11:16:00.401 +03:00 [INF] Executed action NayifatAPI.Controllers.NotificationsController.GetNotifications (NayifatAPI) in 58.7809ms
2025-02-02 11:16:00.404 +03:00 [INF] Executed endpoint 'NayifatAPI.Controllers.NotificationsController.GetNotifications (NayifatAPI)'
2025-02-02 11:16:00.405 +03:00 [INF] Request finished HTTP/1.1 POST http://07ca-46-152-255-232.ngrok-free.app/api/notifications/list - 200 null application/json; charset=utf-8 70.8487ms
2025-02-02 11:22:08.696 +03:00 [INF] Request starting HTTP/1.1 POST http://07ca-46-152-255-232.ngrok-free.app/api/notifications/list - application/json; charset=utf-8 47
2025-02-02 11:22:08.707 +03:00 [INF] Executing endpoint 'NayifatAPI.Controllers.NotificationsController.GetNotifications (NayifatAPI)'
2025-02-02 11:22:08.708 +03:00 [INF] Route matched with {action = "GetNotifications", controller = "Notifications"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetNotifications(NayifatAPI.Controllers.GetNotificationsRequest) on controller NayifatAPI.Controllers.NotificationsController (NayifatAPI).
2025-02-02 11:22:09.637 +03:00 [INF] Executed DbCommand (844ms) [Parameters=[@__providedApiKey_0='?' (Size = 255)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [a].[Key], [a].[CreatedAt], [a].[Description], [a].[ExpiresAt], [a].[IsActive], [a].[LastUsedAt]
FROM [ApiKeys] AS [a]
WHERE [a].[Key] = @__providedApiKey_0 AND [a].[IsActive] = CAST(1 AS bit)
2025-02-02 11:22:09.648 +03:00 [INF] Executed DbCommand (5ms) [Parameters=[@__request_NationalId_0='?' (Size = 450)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [u].[national_id], [u].[last_updated], [u].[notifications]
FROM [user_notifications] AS [u]
WHERE [u].[national_id] = @__request_NationalId_0
2025-02-02 11:22:09.655 +03:00 [INF] Executed DbCommand (4ms) [Parameters=[@__Parse_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [n].[Id], [n].[additional_data], [n].[Body], [n].[body_ar], [n].[body_en], [n].[created_at], [n].[expiry_at], [n].[Route], [n].[target_criteria], [n].[Title], [n].[title_ar], [n].[title_en]
FROM [notification_templates] AS [n]
WHERE [n].[Id] = @__Parse_0
2025-02-02 11:22:09.657 +03:00 [INF] Executed DbCommand (0ms) [Parameters=[@__Parse_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [n].[Id], [n].[additional_data], [n].[Body], [n].[body_ar], [n].[body_en], [n].[created_at], [n].[expiry_at], [n].[Route], [n].[target_criteria], [n].[Title], [n].[title_ar], [n].[title_en]
FROM [notification_templates] AS [n]
WHERE [n].[Id] = @__Parse_0
2025-02-02 11:22:09.668 +03:00 [INF] Executed DbCommand (8ms) [Parameters=[@p0='?' (Size = 4000), @p1='?' (DbType = DateTime2), @p2='?' (Size = 4000), @p3='?' (Size = 4000), @p4='?' (Size = 4000), @p5='?' (Size = 450), @p6='?' (Size = 4000), @p7='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SET IMPLICIT_TRANSACTIONS OFF;
SET NOCOUNT ON;
INSERT INTO [AuthLogs] ([AuthType], [CreatedAt], [DeviceId], [FailureReason], [IpAddress], [NationalId], [Status], [UserAgent])
OUTPUT INSERTED.[Id]
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7);
2025-02-02 11:22:09.670 +03:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType9`2[[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Object, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-02-02 11:22:09.671 +03:00 [INF] Executed action NayifatAPI.Controllers.NotificationsController.GetNotifications (NayifatAPI) in 961.6342ms
2025-02-02 11:22:09.672 +03:00 [INF] Executed endpoint 'NayifatAPI.Controllers.NotificationsController.GetNotifications (NayifatAPI)'
2025-02-02 11:22:09.673 +03:00 [INF] Request finished HTTP/1.1 POST http://07ca-46-152-255-232.ngrok-free.app/api/notifications/list - 200 null application/json; charset=utf-8 977.5334ms
2025-02-02 11:22:51.109 +03:00 [INF] Request starting HTTP/1.1 POST http://07ca-46-152-255-232.ngrok-free.app/api/notifications/list - application/json; charset=utf-8 47
2025-02-02 11:22:51.259 +03:00 [INF] Executing endpoint 'NayifatAPI.Controllers.NotificationsController.GetNotifications (NayifatAPI)'
2025-02-02 11:22:51.297 +03:00 [INF] Route matched with {action = "GetNotifications", controller = "Notifications"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetNotifications(NayifatAPI.Controllers.GetNotificationsRequest) on controller NayifatAPI.Controllers.NotificationsController (NayifatAPI).
2025-02-02 11:22:51.492 +03:00 [INF] Executed DbCommand (109ms) [Parameters=[@__providedApiKey_0='?' (Size = 255)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [a].[Key], [a].[CreatedAt], [a].[Description], [a].[ExpiresAt], [a].[IsActive], [a].[LastUsedAt]
FROM [ApiKeys] AS [a]
WHERE [a].[Key] = @__providedApiKey_0 AND [a].[IsActive] = CAST(1 AS bit)
2025-02-02 11:22:51.540 +03:00 [INF] Executed DbCommand (43ms) [Parameters=[@__request_NationalId_0='?' (Size = 450)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [u].[national_id], [u].[last_updated], [u].[notifications]
FROM [user_notifications] AS [u]
WHERE [u].[national_id] = @__request_NationalId_0
2025-02-02 11:22:51.647 +03:00 [INF] Executed DbCommand (74ms) [Parameters=[@__Parse_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [n].[Id], [n].[additional_data], [n].[Body], [n].[body_ar], [n].[body_en], [n].[created_at], [n].[expiry_at], [n].[Route], [n].[target_criteria], [n].[Title], [n].[title_ar], [n].[title_en]
FROM [notification_templates] AS [n]
WHERE [n].[Id] = @__Parse_0
2025-02-02 11:22:51.694 +03:00 [INF] Executed DbCommand (15ms) [Parameters=[@__Parse_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [n].[Id], [n].[additional_data], [n].[Body], [n].[body_ar], [n].[body_en], [n].[created_at], [n].[expiry_at], [n].[Route], [n].[target_criteria], [n].[Title], [n].[title_ar], [n].[title_en]
FROM [notification_templates] AS [n]
WHERE [n].[Id] = @__Parse_0
2025-02-02 11:22:51.916 +03:00 [INF] Executed DbCommand (122ms) [Parameters=[@p0='?' (Size = 4000), @p1='?' (DbType = DateTime2), @p2='?' (Size = 4000), @p3='?' (Size = 4000), @p4='?' (Size = 4000), @p5='?' (Size = 450), @p6='?' (Size = 4000), @p7='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SET IMPLICIT_TRANSACTIONS OFF;
SET NOCOUNT ON;
INSERT INTO [AuthLogs] ([AuthType], [CreatedAt], [DeviceId], [FailureReason], [IpAddress], [NationalId], [Status], [UserAgent])
OUTPUT INSERTED.[Id]
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7);
2025-02-02 11:22:52.075 +03:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType9`2[[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Object, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-02-02 11:22:52.077 +03:00 [INF] Executed action NayifatAPI.Controllers.NotificationsController.GetNotifications (NayifatAPI) in 695.4485ms
2025-02-02 11:22:52.080 +03:00 [INF] Executed endpoint 'NayifatAPI.Controllers.NotificationsController.GetNotifications (NayifatAPI)'
2025-02-02 11:22:52.082 +03:00 [INF] Request finished HTTP/1.1 POST http://07ca-46-152-255-232.ngrok-free.app/api/notifications/list - 200 null application/json; charset=utf-8 973.9871ms
2025-02-02 11:23:14.205 +03:00 [INF] Request starting HTTP/1.1 POST http://07ca-46-152-255-232.ngrok-free.app/api/auth/signin - application/json; charset=utf-8 224
2025-02-02 11:23:14.207 +03:00 [INF] Executing endpoint 'NayifatAPI.Controllers.AuthController.SignIn (NayifatAPI)'
2025-02-02 11:23:14.208 +03:00 [INF] Route matched with {action = "SignIn", controller = "Auth"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] SignIn(NayifatAPI.Controllers.SignInRequest) on controller NayifatAPI.Controllers.AuthController (NayifatAPI).
2025-02-02 11:23:14.211 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@__providedApiKey_0='?' (Size = 255)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [a].[Key], [a].[CreatedAt], [a].[Description], [a].[ExpiresAt], [a].[IsActive], [a].[LastUsedAt]
FROM [ApiKeys] AS [a]
WHERE [a].[Key] = @__providedApiKey_0 AND [a].[IsActive] = CAST(1 AS bit)
2025-02-02 11:23:14.216 +03:00 [INF] Executed DbCommand (2ms) [Parameters=[@__request_NationalId_0='?' (Size = 450)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [c].[NationalId], [c].[AddNo], [c].[BuildingNo], [c].[City], [c].[Consent], [c].[ConsentDate], [c].[DateOfBirth], [c].[Dependents], [c].[District], [c].[Email], [c].[Employer], [c].[FamilyNameAr], [c].[FamilyNameEn], [c].[FirstNameAr], [c].[FirstNameEn], [c].[Iban], [c].[IdExpiryDate], [c].[Los], [c].[Mpin], [c].[MpinEnabled], [c].[NafathStatus], [c].[NafathTimestamp], [c].[Password], [c].[Phone], [c].[RegistrationDate], [c].[SalaryCustomer], [c].[SalaryDakhli], [c].[SecondNameAr], [c].[SecondNameEn], [c].[Sector], [c].[Street], [c].[ThirdNameAr], [c].[ThirdNameEn], [c].[Zipcode]
FROM [Customers] AS [c]
WHERE [c].[NationalId] = @__request_NationalId_0
2025-02-02 11:23:14.218 +03:00 [INF] Starting password verification for NationalId: 1064448614
2025-02-02 11:23:14.406 +03:00 [INF] Password verification result for NationalId 1064448614: Success
2025-02-02 11:23:14.484 +03:00 [INF] Executed DbCommand (77ms) [Parameters=[@__request_NationalId_0='?' (Size = 450), @__request_DeviceId_1='?' (Size = 450)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [c].[Id], [c].[BiometricEnabled], [c].[BiometricToken], [c].[CreatedAt], [c].[DeviceId], [c].[LastUsedAt], [c].[Manufacturer], [c].[Model], [c].[NationalId], [c].[OsVersion], [c].[Platform], [c].[Status]
FROM [Customer_Devices] AS [c]
WHERE [c].[NationalId] = @__request_NationalId_0 AND [c].[DeviceId] = @__request_DeviceId_1 AND [c].[Status] = N'active'
2025-02-02 11:23:14.488 +03:00 [INF] Executed DbCommand (2ms) [Parameters=[@p0='?' (Size = 4000), @p1='?' (DbType = DateTime2), @p2='?' (Size = 4000), @p3='?' (Size = 4000), @p4='?' (Size = 4000), @p5='?' (Size = 450), @p6='?' (Size = 4000), @p7='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SET IMPLICIT_TRANSACTIONS OFF;
SET NOCOUNT ON;
INSERT INTO [AuthLogs] ([AuthType], [CreatedAt], [DeviceId], [FailureReason], [IpAddress], [NationalId], [Status], [UserAgent])
OUTPUT INSERTED.[Id]
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7);
2025-02-02 11:23:14.491 +03:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType9`2[[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Object, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-02-02 11:23:14.493 +03:00 [INF] Executed action NayifatAPI.Controllers.AuthController.SignIn (NayifatAPI) in 284.6695ms
2025-02-02 11:23:14.494 +03:00 [INF] Executed endpoint 'NayifatAPI.Controllers.AuthController.SignIn (NayifatAPI)'
2025-02-02 11:23:14.495 +03:00 [INF] Request finished HTTP/1.1 POST http://07ca-46-152-255-232.ngrok-free.app/api/auth/signin - 200 null application/json; charset=utf-8 290.0778ms
2025-02-02 11:23:15.005 +03:00 [INF] Request starting HTTP/1.1 POST http://07ca-46-152-255-232.ngrok-free.app/api/proxy/forward?url=https://icreditdept.com/api/testasp/test_local_generate_otp.php - application/json; charset=utf-8 84
2025-02-02 11:23:15.007 +03:00 [INF] Executing endpoint 'NayifatAPI.Controllers.ProxyController.ForwardRequest (NayifatAPI)'
2025-02-02 11:23:15.008 +03:00 [INF] Route matched with {action = "ForwardRequest", controller = "Proxy"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] ForwardRequest() on controller NayifatAPI.Controllers.ProxyController (NayifatAPI).
2025-02-02 11:23:15.009 +03:00 [INF] Start processing HTTP request POST https://icreditdept.com/api/testasp/test_local_generate_otp.php
2025-02-02 11:23:15.010 +03:00 [INF] Sending HTTP request POST https://icreditdept.com/api/testasp/test_local_generate_otp.php
2025-02-02 11:23:15.723 +03:00 [INF] Received HTTP response headers after 711.8999ms - 200
2025-02-02 11:23:15.724 +03:00 [INF] End processing HTTP request after 714.2626ms - 200
2025-02-02 11:23:15.724 +03:00 [INF] Raw response length: 200
2025-02-02 11:23:15.725 +03:00 [INF] Response content: {"success":true,"errors":[],"result":{"nationalId":"1064448614","otp":867591,"expiryDate":"2025-02-02 11:28:15","successMsg":"Success","errCode":0,"errMsg":null},"type":"N","message":null,"code":null}
2025-02-02 11:23:15.726 +03:00 [INF] Executing ContentResult with HTTP Response ContentType of application/json
2025-02-02 11:23:15.726 +03:00 [INF] Executed action NayifatAPI.Controllers.ProxyController.ForwardRequest (NayifatAPI) in 717.2738ms
2025-02-02 11:23:15.727 +03:00 [INF] Executed endpoint 'NayifatAPI.Controllers.ProxyController.ForwardRequest (NayifatAPI)'
2025-02-02 11:23:15.728 +03:00 [INF] Request finished HTTP/1.1 POST http://07ca-46-152-255-232.ngrok-free.app/api/proxy/forward?url=https://icreditdept.com/api/testasp/test_local_generate_otp.php - 200 200 application/json 723.3376ms
2025-02-02 11:23:32.313 +03:00 [INF] Request starting HTTP/1.1 POST http://07ca-46-152-255-232.ngrok-free.app/api/proxy/forward?url=https://icreditdept.com/api/testasp/test_local_verify_otp.php - application/json; charset=utf-8 53
2025-02-02 11:23:32.317 +03:00 [INF] Executing endpoint 'NayifatAPI.Controllers.ProxyController.ForwardRequest (NayifatAPI)'
2025-02-02 11:23:32.319 +03:00 [INF] Route matched with {action = "ForwardRequest", controller = "Proxy"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] ForwardRequest() on controller NayifatAPI.Controllers.ProxyController (NayifatAPI).
2025-02-02 11:23:32.321 +03:00 [INF] Start processing HTTP request POST https://icreditdept.com/api/testasp/test_local_verify_otp.php
2025-02-02 11:23:32.322 +03:00 [INF] Sending HTTP request POST https://icreditdept.com/api/testasp/test_local_verify_otp.php
2025-02-02 11:23:32.793 +03:00 [INF] Received HTTP response headers after 470.2602ms - 200
2025-02-02 11:23:32.799 +03:00 [INF] End processing HTTP request after 477.4222ms - 200
2025-02-02 11:23:32.801 +03:00 [INF] Raw response length: 202
2025-02-02 11:23:32.802 +03:00 [INF] Response content: {"success":true,"errors":[],"result":{"nationalId":"1064448614","otp":"867591","verifiedFlag":true,"successMsg":"Verified successfully.","errCode":0,"errMsg":null},"type":"N","message":null,"code":null}
2025-02-02 11:23:32.803 +03:00 [INF] Executing ContentResult with HTTP Response ContentType of application/json
2025-02-02 11:23:32.805 +03:00 [INF] Executed action NayifatAPI.Controllers.ProxyController.ForwardRequest (NayifatAPI) in 483.9079ms
2025-02-02 11:23:32.807 +03:00 [INF] Executed endpoint 'NayifatAPI.Controllers.ProxyController.ForwardRequest (NayifatAPI)'
2025-02-02 11:23:32.808 +03:00 [INF] Request finished HTTP/1.1 POST http://07ca-46-152-255-232.ngrok-free.app/api/proxy/forward?url=https://icreditdept.com/api/testasp/test_local_verify_otp.php - 200 202 application/json 495.1925ms
2025-02-02 11:23:33.676 +03:00 [INF] Request starting HTTP/1.1 POST http://07ca-46-152-255-232.ngrok-free.app/api/device - application/json; charset=utf-8 122
2025-02-02 11:23:33.679 +03:00 [INF] Executing endpoint 'NayifatAPI.Controllers.DeviceController.RegisterDevice (NayifatAPI)'
2025-02-02 11:23:33.686 +03:00 [INF] Route matched with {action = "RegisterDevice", controller = "Device"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] RegisterDevice(NayifatAPI.Controllers.RegisterDeviceRequest) on controller NayifatAPI.Controllers.DeviceController (NayifatAPI).
2025-02-02 11:23:33.691 +03:00 [INF] Executing BadRequestObjectResult, writing value of type 'Microsoft.AspNetCore.Mvc.ValidationProblemDetails'.
2025-02-02 11:23:33.693 +03:00 [INF] Executed action NayifatAPI.Controllers.DeviceController.RegisterDevice (NayifatAPI) in 5.6144ms
2025-02-02 11:23:33.694 +03:00 [INF] Executed endpoint 'NayifatAPI.Controllers.DeviceController.RegisterDevice (NayifatAPI)'
2025-02-02 11:23:33.695 +03:00 [INF] Request finished HTTP/1.1 POST http://07ca-46-152-255-232.ngrok-free.app/api/device - 400 null application/problem+json; charset=utf-8 18.7992ms
2025-02-02 11:27:52.905 +03:00 [INF] Request starting HTTP/1.1 POST http://07ca-46-152-255-232.ngrok-free.app/api/notifications/list - application/json; charset=utf-8 47
2025-02-02 11:27:52.908 +03:00 [INF] Executing endpoint 'NayifatAPI.Controllers.NotificationsController.GetNotifications (NayifatAPI)'
2025-02-02 11:27:52.909 +03:00 [INF] Route matched with {action = "GetNotifications", controller = "Notifications"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetNotifications(NayifatAPI.Controllers.GetNotificationsRequest) on controller NayifatAPI.Controllers.NotificationsController (NayifatAPI).
2025-02-02 11:27:52.937 +03:00 [INF] Executed DbCommand (13ms) [Parameters=[@__providedApiKey_0='?' (Size = 255)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [a].[Key], [a].[CreatedAt], [a].[Description], [a].[ExpiresAt], [a].[IsActive], [a].[LastUsedAt]
FROM [ApiKeys] AS [a]
WHERE [a].[Key] = @__providedApiKey_0 AND [a].[IsActive] = CAST(1 AS bit)
2025-02-02 11:27:52.944 +03:00 [INF] Executed DbCommand (5ms) [Parameters=[@__request_NationalId_0='?' (Size = 450)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [u].[national_id], [u].[last_updated], [u].[notifications]
FROM [user_notifications] AS [u]
WHERE [u].[national_id] = @__request_NationalId_0
2025-02-02 11:27:52.951 +03:00 [INF] Executed DbCommand (5ms) [Parameters=[@__Parse_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [n].[Id], [n].[additional_data], [n].[Body], [n].[body_ar], [n].[body_en], [n].[created_at], [n].[expiry_at], [n].[Route], [n].[target_criteria], [n].[Title], [n].[title_ar], [n].[title_en]
FROM [notification_templates] AS [n]
WHERE [n].[Id] = @__Parse_0
2025-02-02 11:27:52.953 +03:00 [INF] Executed DbCommand (0ms) [Parameters=[@__Parse_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [n].[Id], [n].[additional_data], [n].[Body], [n].[body_ar], [n].[body_en], [n].[created_at], [n].[expiry_at], [n].[Route], [n].[target_criteria], [n].[Title], [n].[title_ar], [n].[title_en]
FROM [notification_templates] AS [n]
WHERE [n].[Id] = @__Parse_0
2025-02-02 11:27:52.960 +03:00 [INF] Executed DbCommand (5ms) [Parameters=[@p0='?' (Size = 4000), @p1='?' (DbType = DateTime2), @p2='?' (Size = 4000), @p3='?' (Size = 4000), @p4='?' (Size = 4000), @p5='?' (Size = 450), @p6='?' (Size = 4000), @p7='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SET IMPLICIT_TRANSACTIONS OFF;
SET NOCOUNT ON;
INSERT INTO [AuthLogs] ([AuthType], [CreatedAt], [DeviceId], [FailureReason], [IpAddress], [NationalId], [Status], [UserAgent])
OUTPUT INSERTED.[Id]
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7);
2025-02-02 11:27:52.962 +03:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType9`2[[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Object, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-02-02 11:27:52.964 +03:00 [INF] Executed action NayifatAPI.Controllers.NotificationsController.GetNotifications (NayifatAPI) in 53.3278ms
2025-02-02 11:27:52.965 +03:00 [INF] Executed endpoint 'NayifatAPI.Controllers.NotificationsController.GetNotifications (NayifatAPI)'
2025-02-02 11:27:52.967 +03:00 [INF] Request finished HTTP/1.1 POST http://07ca-46-152-255-232.ngrok-free.app/api/notifications/list - 200 null application/json; charset=utf-8 61.8843ms
2025-02-02 11:28:21.746 +03:00 [INF] Request starting HTTP/1.1 POST http://07ca-46-152-255-232.ngrok-free.app/api/auth/signin - application/json; charset=utf-8 224
2025-02-02 11:28:21.748 +03:00 [INF] Executing endpoint 'NayifatAPI.Controllers.AuthController.SignIn (NayifatAPI)'
2025-02-02 11:28:21.748 +03:00 [INF] Route matched with {action = "SignIn", controller = "Auth"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] SignIn(NayifatAPI.Controllers.SignInRequest) on controller NayifatAPI.Controllers.AuthController (NayifatAPI).
2025-02-02 11:28:21.783 +03:00 [INF] Executed DbCommand (32ms) [Parameters=[@__providedApiKey_0='?' (Size = 255)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [a].[Key], [a].[CreatedAt], [a].[Description], [a].[ExpiresAt], [a].[IsActive], [a].[LastUsedAt]
FROM [ApiKeys] AS [a]
WHERE [a].[Key] = @__providedApiKey_0 AND [a].[IsActive] = CAST(1 AS bit)
2025-02-02 11:28:21.789 +03:00 [INF] Executed DbCommand (4ms) [Parameters=[@__request_NationalId_0='?' (Size = 450)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [c].[NationalId], [c].[AddNo], [c].[BuildingNo], [c].[City], [c].[Consent], [c].[ConsentDate], [c].[DateOfBirth], [c].[Dependents], [c].[District], [c].[Email], [c].[Employer], [c].[FamilyNameAr], [c].[FamilyNameEn], [c].[FirstNameAr], [c].[FirstNameEn], [c].[Iban], [c].[IdExpiryDate], [c].[Los], [c].[Mpin], [c].[MpinEnabled], [c].[NafathStatus], [c].[NafathTimestamp], [c].[Password], [c].[Phone], [c].[RegistrationDate], [c].[SalaryCustomer], [c].[SalaryDakhli], [c].[SecondNameAr], [c].[SecondNameEn], [c].[Sector], [c].[Street], [c].[ThirdNameAr], [c].[ThirdNameEn], [c].[Zipcode]
FROM [Customers] AS [c]
WHERE [c].[NationalId] = @__request_NationalId_0
2025-02-02 11:28:21.791 +03:00 [INF] Starting password verification for NationalId: 1064448614
2025-02-02 11:28:21.977 +03:00 [INF] Password verification result for NationalId 1064448614: Success
2025-02-02 11:28:21.988 +03:00 [INF] Executed DbCommand (9ms) [Parameters=[@__request_NationalId_0='?' (Size = 450), @__request_DeviceId_1='?' (Size = 450)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [c].[Id], [c].[BiometricEnabled], [c].[BiometricToken], [c].[CreatedAt], [c].[DeviceId], [c].[LastUsedAt], [c].[Manufacturer], [c].[Model], [c].[NationalId], [c].[OsVersion], [c].[Platform], [c].[Status]
FROM [Customer_Devices] AS [c]
WHERE [c].[NationalId] = @__request_NationalId_0 AND [c].[DeviceId] = @__request_DeviceId_1 AND [c].[Status] = N'active'
2025-02-02 11:28:21.997 +03:00 [INF] Executed DbCommand (5ms) [Parameters=[@p0='?' (Size = 4000), @p1='?' (DbType = DateTime2), @p2='?' (Size = 4000), @p3='?' (Size = 4000), @p4='?' (Size = 4000), @p5='?' (Size = 450), @p6='?' (Size = 4000), @p7='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SET IMPLICIT_TRANSACTIONS OFF;
SET NOCOUNT ON;
INSERT INTO [AuthLogs] ([AuthType], [CreatedAt], [DeviceId], [FailureReason], [IpAddress], [NationalId], [Status], [UserAgent])
OUTPUT INSERTED.[Id]
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7);
2025-02-02 11:28:21.999 +03:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType9`2[[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Object, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-02-02 11:28:22.000 +03:00 [INF] Executed action NayifatAPI.Controllers.AuthController.SignIn (NayifatAPI) in 250.8534ms
2025-02-02 11:28:22.003 +03:00 [INF] Executed endpoint 'NayifatAPI.Controllers.AuthController.SignIn (NayifatAPI)'
2025-02-02 11:28:22.004 +03:00 [INF] Request finished HTTP/1.1 POST http://07ca-46-152-255-232.ngrok-free.app/api/auth/signin - 200 null application/json; charset=utf-8 257.6151ms
2025-02-02 11:28:22.542 +03:00 [INF] Request starting HTTP/1.1 POST http://07ca-46-152-255-232.ngrok-free.app/api/proxy/forward?url=https://icreditdept.com/api/testasp/test_local_generate_otp.php - application/json; charset=utf-8 84
2025-02-02 11:28:22.544 +03:00 [INF] Executing endpoint 'NayifatAPI.Controllers.ProxyController.ForwardRequest (NayifatAPI)'
2025-02-02 11:28:22.545 +03:00 [INF] Route matched with {action = "ForwardRequest", controller = "Proxy"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] ForwardRequest() on controller NayifatAPI.Controllers.ProxyController (NayifatAPI).
2025-02-02 11:28:22.546 +03:00 [INF] Start processing HTTP request POST https://icreditdept.com/api/testasp/test_local_generate_otp.php
2025-02-02 11:28:22.547 +03:00 [INF] Sending HTTP request POST https://icreditdept.com/api/testasp/test_local_generate_otp.php
2025-02-02 11:28:23.164 +03:00 [INF] Received HTTP response headers after 616.9549ms - 200
2025-02-02 11:28:23.165 +03:00 [INF] End processing HTTP request after 619.2809ms - 200
2025-02-02 11:28:23.166 +03:00 [INF] Raw response length: 200
2025-02-02 11:28:23.167 +03:00 [INF] Response content: {"success":true,"errors":[],"result":{"nationalId":"1064448614","otp":818175,"expiryDate":"2025-02-02 11:33:23","successMsg":"Success","errCode":0,"errMsg":null},"type":"N","message":null,"code":null}
2025-02-02 11:28:23.168 +03:00 [INF] Executing ContentResult with HTTP Response ContentType of application/json
2025-02-02 11:28:23.169 +03:00 [INF] Executed action NayifatAPI.Controllers.ProxyController.ForwardRequest (NayifatAPI) in 623.2946ms
2025-02-02 11:28:23.175 +03:00 [INF] Executed endpoint 'NayifatAPI.Controllers.ProxyController.ForwardRequest (NayifatAPI)'
2025-02-02 11:28:23.176 +03:00 [INF] Request finished HTTP/1.1 POST http://07ca-46-152-255-232.ngrok-free.app/api/proxy/forward?url=https://icreditdept.com/api/testasp/test_local_generate_otp.php - 200 200 application/json 634.5829ms
2025-02-02 11:28:41.201 +03:00 [INF] Request starting HTTP/1.1 POST http://07ca-46-152-255-232.ngrok-free.app/api/proxy/forward?url=https://icreditdept.com/api/testasp/test_local_verify_otp.php - application/json; charset=utf-8 53
2025-02-02 11:28:41.476 +03:00 [INF] Executing endpoint 'NayifatAPI.Controllers.ProxyController.ForwardRequest (NayifatAPI)'
2025-02-02 11:28:41.477 +03:00 [INF] Route matched with {action = "ForwardRequest", controller = "Proxy"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] ForwardRequest() on controller NayifatAPI.Controllers.ProxyController (NayifatAPI).
2025-02-02 11:28:41.481 +03:00 [INF] Start processing HTTP request POST https://icreditdept.com/api/testasp/test_local_verify_otp.php
2025-02-02 11:28:41.483 +03:00 [INF] Sending HTTP request POST https://icreditdept.com/api/testasp/test_local_verify_otp.php
2025-02-02 11:28:41.939 +03:00 [INF] Received HTTP response headers after 452.3071ms - 200
2025-02-02 11:28:41.940 +03:00 [INF] End processing HTTP request after 459.575ms - 200
2025-02-02 11:28:41.941 +03:00 [INF] Raw response length: 202
2025-02-02 11:28:41.942 +03:00 [INF] Response content: {"success":true,"errors":[],"result":{"nationalId":"1064448614","otp":"818175","verifiedFlag":true,"successMsg":"Verified successfully.","errCode":0,"errMsg":null},"type":"N","message":null,"code":null}
2025-02-02 11:28:41.943 +03:00 [INF] Executing ContentResult with HTTP Response ContentType of application/json
2025-02-02 11:28:41.943 +03:00 [INF] Executed action NayifatAPI.Controllers.ProxyController.ForwardRequest (NayifatAPI) in 463.6047ms
2025-02-02 11:28:41.945 +03:00 [INF] Executed endpoint 'NayifatAPI.Controllers.ProxyController.ForwardRequest (NayifatAPI)'
2025-02-02 11:28:41.946 +03:00 [INF] Request finished HTTP/1.1 POST http://07ca-46-152-255-232.ngrok-free.app/api/proxy/forward?url=https://icreditdept.com/api/testasp/test_local_verify_otp.php - 200 202 application/json 745.0387ms
2025-02-02 11:28:42.927 +03:00 [INF] Request starting HTTP/1.1 POST http://07ca-46-152-255-232.ngrok-free.app/api/api/device - application/json; charset=utf-8 163
2025-02-02 11:28:42.929 +03:00 [INF] Request finished HTTP/1.1 POST http://07ca-46-152-255-232.ngrok-free.app/api/api/device - 404 0 null 2.6011ms
2025-02-02 11:28:42.931 +03:00 [INF] Request reached the end of the middleware pipeline without being handled by application code. Request path: POST http://07ca-46-152-255-232.ngrok-free.app/api/api/device, Response status code: 404
2025-02-02 11:32:52.720 +03:00 [INF] Request starting HTTP/1.1 POST http://07ca-46-152-255-232.ngrok-free.app/api/notifications/list - application/json; charset=utf-8 47
2025-02-02 11:32:52.723 +03:00 [INF] Executing endpoint 'NayifatAPI.Controllers.NotificationsController.GetNotifications (NayifatAPI)'
2025-02-02 11:32:52.724 +03:00 [INF] Route matched with {action = "GetNotifications", controller = "Notifications"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetNotifications(NayifatAPI.Controllers.GetNotificationsRequest) on controller NayifatAPI.Controllers.NotificationsController (NayifatAPI).
2025-02-02 11:32:52.746 +03:00 [INF] Executed DbCommand (19ms) [Parameters=[@__providedApiKey_0='?' (Size = 255)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [a].[Key], [a].[CreatedAt], [a].[Description], [a].[ExpiresAt], [a].[IsActive], [a].[LastUsedAt]
FROM [ApiKeys] AS [a]
WHERE [a].[Key] = @__providedApiKey_0 AND [a].[IsActive] = CAST(1 AS bit)
2025-02-02 11:32:52.751 +03:00 [INF] Executed DbCommand (3ms) [Parameters=[@__request_NationalId_0='?' (Size = 450)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [u].[national_id], [u].[last_updated], [u].[notifications]
FROM [user_notifications] AS [u]
WHERE [u].[national_id] = @__request_NationalId_0
2025-02-02 11:32:52.756 +03:00 [INF] Executed DbCommand (3ms) [Parameters=[@__Parse_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [n].[Id], [n].[additional_data], [n].[Body], [n].[body_ar], [n].[body_en], [n].[created_at], [n].[expiry_at], [n].[Route], [n].[target_criteria], [n].[Title], [n].[title_ar], [n].[title_en]
FROM [notification_templates] AS [n]
WHERE [n].[Id] = @__Parse_0
2025-02-02 11:32:52.759 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@__Parse_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [n].[Id], [n].[additional_data], [n].[Body], [n].[body_ar], [n].[body_en], [n].[created_at], [n].[expiry_at], [n].[Route], [n].[target_criteria], [n].[Title], [n].[title_ar], [n].[title_en]
FROM [notification_templates] AS [n]
WHERE [n].[Id] = @__Parse_0
2025-02-02 11:32:52.767 +03:00 [INF] Executed DbCommand (5ms) [Parameters=[@p0='?' (Size = 4000), @p1='?' (DbType = DateTime2), @p2='?' (Size = 4000), @p3='?' (Size = 4000), @p4='?' (Size = 4000), @p5='?' (Size = 450), @p6='?' (Size = 4000), @p7='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SET IMPLICIT_TRANSACTIONS OFF;
SET NOCOUNT ON;
INSERT INTO [AuthLogs] ([AuthType], [CreatedAt], [DeviceId], [FailureReason], [IpAddress], [NationalId], [Status], [UserAgent])
OUTPUT INSERTED.[Id]
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7);
2025-02-02 11:32:52.768 +03:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType9`2[[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Object, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-02-02 11:32:52.770 +03:00 [INF] Executed action NayifatAPI.Controllers.NotificationsController.GetNotifications (NayifatAPI) in 44.4092ms
2025-02-02 11:32:52.771 +03:00 [INF] Executed endpoint 'NayifatAPI.Controllers.NotificationsController.GetNotifications (NayifatAPI)'
2025-02-02 11:32:52.772 +03:00 [INF] Request finished HTTP/1.1 POST http://07ca-46-152-255-232.ngrok-free.app/api/notifications/list - 200 null application/json; charset=utf-8 51.4111ms
2025-02-02 11:34:37.936 +03:00 [INF] Request starting HTTP/1.1 POST http://07ca-46-152-255-232.ngrok-free.app/api/auth/signin - application/json; charset=utf-8 224
2025-02-02 11:34:37.937 +03:00 [INF] Executing endpoint 'NayifatAPI.Controllers.AuthController.SignIn (NayifatAPI)'
2025-02-02 11:34:37.938 +03:00 [INF] Route matched with {action = "SignIn", controller = "Auth"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] SignIn(NayifatAPI.Controllers.SignInRequest) on controller NayifatAPI.Controllers.AuthController (NayifatAPI).
2025-02-02 11:34:38.218 +03:00 [INF] Executed DbCommand (278ms) [Parameters=[@__providedApiKey_0='?' (Size = 255)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [a].[Key], [a].[CreatedAt], [a].[Description], [a].[ExpiresAt], [a].[IsActive], [a].[LastUsedAt]
FROM [ApiKeys] AS [a]
WHERE [a].[Key] = @__providedApiKey_0 AND [a].[IsActive] = CAST(1 AS bit)
2025-02-02 11:34:38.223 +03:00 [INF] Executed DbCommand (2ms) [Parameters=[@__request_NationalId_0='?' (Size = 450)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [c].[NationalId], [c].[AddNo], [c].[BuildingNo], [c].[City], [c].[Consent], [c].[ConsentDate], [c].[DateOfBirth], [c].[Dependents], [c].[District], [c].[Email], [c].[Employer], [c].[FamilyNameAr], [c].[FamilyNameEn], [c].[FirstNameAr], [c].[FirstNameEn], [c].[Iban], [c].[IdExpiryDate], [c].[Los], [c].[Mpin], [c].[MpinEnabled], [c].[NafathStatus], [c].[NafathTimestamp], [c].[Password], [c].[Phone], [c].[RegistrationDate], [c].[SalaryCustomer], [c].[SalaryDakhli], [c].[SecondNameAr], [c].[SecondNameEn], [c].[Sector], [c].[Street], [c].[ThirdNameAr], [c].[ThirdNameEn], [c].[Zipcode]
FROM [Customers] AS [c]
WHERE [c].[NationalId] = @__request_NationalId_0
2025-02-02 11:34:38.225 +03:00 [INF] Starting password verification for NationalId: 1064448614
2025-02-02 11:34:38.404 +03:00 [INF] Password verification result for NationalId 1064448614: Success
2025-02-02 11:34:38.414 +03:00 [INF] Executed DbCommand (8ms) [Parameters=[@__request_NationalId_0='?' (Size = 450), @__request_DeviceId_1='?' (Size = 450)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [c].[Id], [c].[BiometricEnabled], [c].[BiometricToken], [c].[CreatedAt], [c].[DeviceId], [c].[LastUsedAt], [c].[Manufacturer], [c].[Model], [c].[NationalId], [c].[OsVersion], [c].[Platform], [c].[Status]
FROM [Customer_Devices] AS [c]
WHERE [c].[NationalId] = @__request_NationalId_0 AND [c].[DeviceId] = @__request_DeviceId_1 AND [c].[Status] = N'active'
2025-02-02 11:34:38.425 +03:00 [INF] Executed DbCommand (5ms) [Parameters=[@p0='?' (Size = 4000), @p1='?' (DbType = DateTime2), @p2='?' (Size = 4000), @p3='?' (Size = 4000), @p4='?' (Size = 4000), @p5='?' (Size = 450), @p6='?' (Size = 4000), @p7='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SET IMPLICIT_TRANSACTIONS OFF;
SET NOCOUNT ON;
INSERT INTO [AuthLogs] ([AuthType], [CreatedAt], [DeviceId], [FailureReason], [IpAddress], [NationalId], [Status], [UserAgent])
OUTPUT INSERTED.[Id]
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7);
2025-02-02 11:34:38.427 +03:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType9`2[[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Object, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-02-02 11:34:38.428 +03:00 [INF] Executed action NayifatAPI.Controllers.AuthController.SignIn (NayifatAPI) in 488.2284ms
2025-02-02 11:34:38.428 +03:00 [INF] Executed endpoint 'NayifatAPI.Controllers.AuthController.SignIn (NayifatAPI)'
2025-02-02 11:34:38.429 +03:00 [INF] Request finished HTTP/1.1 POST http://07ca-46-152-255-232.ngrok-free.app/api/auth/signin - 200 null application/json; charset=utf-8 493.6963ms
2025-02-02 11:34:38.863 +03:00 [INF] Request starting HTTP/1.1 POST http://07ca-46-152-255-232.ngrok-free.app/api/proxy/forward?url=https://icreditdept.com/api/testasp/test_local_generate_otp.php - application/json; charset=utf-8 84
2025-02-02 11:34:38.872 +03:00 [INF] Executing endpoint 'NayifatAPI.Controllers.ProxyController.ForwardRequest (NayifatAPI)'
2025-02-02 11:34:38.873 +03:00 [INF] Route matched with {action = "ForwardRequest", controller = "Proxy"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] ForwardRequest() on controller NayifatAPI.Controllers.ProxyController (NayifatAPI).
2025-02-02 11:34:38.875 +03:00 [INF] Start processing HTTP request POST https://icreditdept.com/api/testasp/test_local_generate_otp.php
2025-02-02 11:34:38.876 +03:00 [INF] Sending HTTP request POST https://icreditdept.com/api/testasp/test_local_generate_otp.php
2025-02-02 11:34:39.442 +03:00 [INF] Received HTTP response headers after 564.5071ms - 200
2025-02-02 11:34:39.443 +03:00 [INF] End processing HTTP request after 567.8904ms - 200
2025-02-02 11:34:39.444 +03:00 [INF] Raw response length: 200
2025-02-02 11:34:39.444 +03:00 [INF] Response content: {"success":true,"errors":[],"result":{"nationalId":"1064448614","otp":906904,"expiryDate":"2025-02-02 11:39:39","successMsg":"Success","errCode":0,"errMsg":null},"type":"N","message":null,"code":null}
2025-02-02 11:34:39.446 +03:00 [INF] Executing ContentResult with HTTP Response ContentType of application/json
2025-02-02 11:34:39.446 +03:00 [INF] Executed action NayifatAPI.Controllers.ProxyController.ForwardRequest (NayifatAPI) in 572.0528ms
2025-02-02 11:34:39.447 +03:00 [INF] Executed endpoint 'NayifatAPI.Controllers.ProxyController.ForwardRequest (NayifatAPI)'
2025-02-02 11:34:39.448 +03:00 [INF] Request finished HTTP/1.1 POST http://07ca-46-152-255-232.ngrok-free.app/api/proxy/forward?url=https://icreditdept.com/api/testasp/test_local_generate_otp.php - 200 200 application/json 584.8534ms
2025-02-02 11:34:49.702 +03:00 [INF] Request starting HTTP/1.1 POST http://07ca-46-152-255-232.ngrok-free.app/api/proxy/forward?url=https://icreditdept.com/api/testasp/test_local_verify_otp.php - application/json; charset=utf-8 53
2025-02-02 11:34:49.704 +03:00 [INF] Executing endpoint 'NayifatAPI.Controllers.ProxyController.ForwardRequest (NayifatAPI)'
2025-02-02 11:34:49.705 +03:00 [INF] Route matched with {action = "ForwardRequest", controller = "Proxy"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] ForwardRequest() on controller NayifatAPI.Controllers.ProxyController (NayifatAPI).
2025-02-02 11:34:49.707 +03:00 [INF] Start processing HTTP request POST https://icreditdept.com/api/testasp/test_local_verify_otp.php
2025-02-02 11:34:49.707 +03:00 [INF] Sending HTTP request POST https://icreditdept.com/api/testasp/test_local_verify_otp.php
2025-02-02 11:34:50.210 +03:00 [INF] Received HTTP response headers after 500.8261ms - 200
2025-02-02 11:34:50.212 +03:00 [INF] End processing HTTP request after 505.4006ms - 200
2025-02-02 11:34:50.213 +03:00 [INF] Raw response length: 202
2025-02-02 11:34:50.215 +03:00 [INF] Response content: {"success":true,"errors":[],"result":{"nationalId":"1064448614","otp":"906904","verifiedFlag":true,"successMsg":"Verified successfully.","errCode":0,"errMsg":null},"type":"N","message":null,"code":null}
2025-02-02 11:34:50.216 +03:00 [INF] Executing ContentResult with HTTP Response ContentType of application/json
2025-02-02 11:34:50.217 +03:00 [INF] Executed action NayifatAPI.Controllers.ProxyController.ForwardRequest (NayifatAPI) in 510.1997ms
2025-02-02 11:34:50.219 +03:00 [INF] Executed endpoint 'NayifatAPI.Controllers.ProxyController.ForwardRequest (NayifatAPI)'
2025-02-02 11:34:50.221 +03:00 [INF] Request finished HTTP/1.1 POST http://07ca-46-152-255-232.ngrok-free.app/api/proxy/forward?url=https://icreditdept.com/api/testasp/test_local_verify_otp.php - 200 202 application/json 518.4261ms
2025-02-02 11:34:51.144 +03:00 [INF] Request starting HTTP/1.1 POST http://07ca-46-152-255-232.ngrok-free.app/api/device - application/json; charset=utf-8 202
2025-02-02 11:34:51.150 +03:00 [INF] Executing endpoint 'NayifatAPI.Controllers.DeviceController.RegisterDevice (NayifatAPI)'
2025-02-02 11:34:51.152 +03:00 [INF] Route matched with {action = "RegisterDevice", controller = "Device"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] RegisterDevice(NayifatAPI.Controllers.RegisterDeviceRequest) on controller NayifatAPI.Controllers.DeviceController (NayifatAPI).
2025-02-02 11:34:51.154 +03:00 [INF] Executing BadRequestObjectResult, writing value of type 'Microsoft.AspNetCore.Mvc.ValidationProblemDetails'.
2025-02-02 11:34:51.155 +03:00 [INF] Executed action NayifatAPI.Controllers.DeviceController.RegisterDevice (NayifatAPI) in 2.1227ms
2025-02-02 11:34:51.157 +03:00 [INF] Executed endpoint 'NayifatAPI.Controllers.DeviceController.RegisterDevice (NayifatAPI)'
2025-02-02 11:34:51.158 +03:00 [INF] Request finished HTTP/1.1 POST http://07ca-46-152-255-232.ngrok-free.app/api/device - 400 null application/problem+json; charset=utf-8 13.7724ms
2025-02-02 11:36:28.640 +03:00 [INF] Request starting HTTP/1.1 POST http://07ca-46-152-255-232.ngrok-free.app/api/auth/signin - application/json; charset=utf-8 224
2025-02-02 11:36:28.642 +03:00 [INF] Executing endpoint 'NayifatAPI.Controllers.AuthController.SignIn (NayifatAPI)'
2025-02-02 11:36:28.643 +03:00 [INF] Route matched with {action = "SignIn", controller = "Auth"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] SignIn(NayifatAPI.Controllers.SignInRequest) on controller NayifatAPI.Controllers.AuthController (NayifatAPI).
2025-02-02 11:36:29.628 +03:00 [INF] Executed DbCommand (983ms) [Parameters=[@__providedApiKey_0='?' (Size = 255)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [a].[Key], [a].[CreatedAt], [a].[Description], [a].[ExpiresAt], [a].[IsActive], [a].[LastUsedAt]
FROM [ApiKeys] AS [a]
WHERE [a].[Key] = @__providedApiKey_0 AND [a].[IsActive] = CAST(1 AS bit)
2025-02-02 11:36:29.636 +03:00 [INF] Executed DbCommand (5ms) [Parameters=[@__request_NationalId_0='?' (Size = 450)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [c].[NationalId], [c].[AddNo], [c].[BuildingNo], [c].[City], [c].[Consent], [c].[ConsentDate], [c].[DateOfBirth], [c].[Dependents], [c].[District], [c].[Email], [c].[Employer], [c].[FamilyNameAr], [c].[FamilyNameEn], [c].[FirstNameAr], [c].[FirstNameEn], [c].[Iban], [c].[IdExpiryDate], [c].[Los], [c].[Mpin], [c].[MpinEnabled], [c].[NafathStatus], [c].[NafathTimestamp], [c].[Password], [c].[Phone], [c].[RegistrationDate], [c].[SalaryCustomer], [c].[SalaryDakhli], [c].[SecondNameAr], [c].[SecondNameEn], [c].[Sector], [c].[Street], [c].[ThirdNameAr], [c].[ThirdNameEn], [c].[Zipcode]
FROM [Customers] AS [c]
WHERE [c].[NationalId] = @__request_NationalId_0
2025-02-02 11:36:29.638 +03:00 [INF] Starting password verification for NationalId: 1064448614
2025-02-02 11:36:29.819 +03:00 [INF] Password verification result for NationalId 1064448614: Success
2025-02-02 11:36:29.843 +03:00 [INF] Executed DbCommand (22ms) [Parameters=[@__request_NationalId_0='?' (Size = 450), @__request_DeviceId_1='?' (Size = 450)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [c].[Id], [c].[BiometricEnabled], [c].[BiometricToken], [c].[CreatedAt], [c].[DeviceId], [c].[LastUsedAt], [c].[Manufacturer], [c].[Model], [c].[NationalId], [c].[OsVersion], [c].[Platform], [c].[Status]
FROM [Customer_Devices] AS [c]
WHERE [c].[NationalId] = @__request_NationalId_0 AND [c].[DeviceId] = @__request_DeviceId_1 AND [c].[Status] = N'active'
2025-02-02 11:36:29.852 +03:00 [INF] Executed DbCommand (6ms) [Parameters=[@p0='?' (Size = 4000), @p1='?' (DbType = DateTime2), @p2='?' (Size = 4000), @p3='?' (Size = 4000), @p4='?' (Size = 4000), @p5='?' (Size = 450), @p6='?' (Size = 4000), @p7='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SET IMPLICIT_TRANSACTIONS OFF;
SET NOCOUNT ON;
INSERT INTO [AuthLogs] ([AuthType], [CreatedAt], [DeviceId], [FailureReason], [IpAddress], [NationalId], [Status], [UserAgent])
OUTPUT INSERTED.[Id]
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7);
2025-02-02 11:36:29.855 +03:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType9`2[[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Object, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-02-02 11:36:29.856 +03:00 [INF] Executed action NayifatAPI.Controllers.AuthController.SignIn (NayifatAPI) in 1212.0729ms
2025-02-02 11:36:29.858 +03:00 [INF] Executed endpoint 'NayifatAPI.Controllers.AuthController.SignIn (NayifatAPI)'
2025-02-02 11:36:29.859 +03:00 [INF] Request finished HTTP/1.1 POST http://07ca-46-152-255-232.ngrok-free.app/api/auth/signin - 200 null application/json; charset=utf-8 1218.2224ms
2025-02-02 11:36:30.473 +03:00 [INF] Request starting HTTP/1.1 POST http://07ca-46-152-255-232.ngrok-free.app/api/proxy/forward?url=https://icreditdept.com/api/testasp/test_local_generate_otp.php - application/json; charset=utf-8 84
2025-02-02 11:36:30.475 +03:00 [INF] Executing endpoint 'NayifatAPI.Controllers.ProxyController.ForwardRequest (NayifatAPI)'
2025-02-02 11:36:30.476 +03:00 [INF] Route matched with {action = "ForwardRequest", controller = "Proxy"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] ForwardRequest() on controller NayifatAPI.Controllers.ProxyController (NayifatAPI).
2025-02-02 11:36:30.477 +03:00 [INF] Start processing HTTP request POST https://icreditdept.com/api/testasp/test_local_generate_otp.php
2025-02-02 11:36:30.478 +03:00 [INF] Sending HTTP request POST https://icreditdept.com/api/testasp/test_local_generate_otp.php
2025-02-02 11:36:31.838 +03:00 [INF] Received HTTP response headers after 1358.9401ms - 200
2025-02-02 11:36:31.839 +03:00 [INF] End processing HTTP request after 1361.4273ms - 200
2025-02-02 11:36:31.840 +03:00 [INF] Raw response length: 200
2025-02-02 11:36:31.841 +03:00 [INF] Response content: {"success":true,"errors":[],"result":{"nationalId":"1064448614","otp":312788,"expiryDate":"2025-02-02 11:41:32","successMsg":"Success","errCode":0,"errMsg":null},"type":"N","message":null,"code":null}
2025-02-02 11:36:31.842 +03:00 [INF] Executing ContentResult with HTTP Response ContentType of application/json
2025-02-02 11:36:31.843 +03:00 [INF] Executed action NayifatAPI.Controllers.ProxyController.ForwardRequest (NayifatAPI) in 1365.7148ms
2025-02-02 11:36:31.844 +03:00 [INF] Executed endpoint 'NayifatAPI.Controllers.ProxyController.ForwardRequest (NayifatAPI)'
2025-02-02 11:36:31.846 +03:00 [INF] Request finished HTTP/1.1 POST http://07ca-46-152-255-232.ngrok-free.app/api/proxy/forward?url=https://icreditdept.com/api/testasp/test_local_generate_otp.php - 200 200 application/json 1372.9855ms
2025-02-02 11:36:49.098 +03:00 [INF] Request starting HTTP/1.1 POST http://07ca-46-152-255-232.ngrok-free.app/api/proxy/forward?url=https://icreditdept.com/api/testasp/test_local_verify_otp.php - application/json; charset=utf-8 53
2025-02-02 11:36:49.100 +03:00 [INF] Executing endpoint 'NayifatAPI.Controllers.ProxyController.ForwardRequest (NayifatAPI)'
2025-02-02 11:36:49.100 +03:00 [INF] Route matched with {action = "ForwardRequest", controller = "Proxy"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] ForwardRequest() on controller NayifatAPI.Controllers.ProxyController (NayifatAPI).
2025-02-02 11:36:49.102 +03:00 [INF] Start processing HTTP request POST https://icreditdept.com/api/testasp/test_local_verify_otp.php
2025-02-02 11:36:49.103 +03:00 [INF] Sending HTTP request POST https://icreditdept.com/api/testasp/test_local_verify_otp.php
2025-02-02 11:36:49.673 +03:00 [INF] Received HTTP response headers after 569.8744ms - 200
2025-02-02 11:36:49.674 +03:00 [INF] End processing HTTP request after 572.394ms - 200
2025-02-02 11:36:49.675 +03:00 [INF] Raw response length: 202
2025-02-02 11:36:49.676 +03:00 [INF] Response content: {"success":true,"errors":[],"result":{"nationalId":"1064448614","otp":"312788","verifiedFlag":true,"successMsg":"Verified successfully.","errCode":0,"errMsg":null},"type":"N","message":null,"code":null}
2025-02-02 11:36:49.677 +03:00 [INF] Executing ContentResult with HTTP Response ContentType of application/json
2025-02-02 11:36:49.678 +03:00 [INF] Executed action NayifatAPI.Controllers.ProxyController.ForwardRequest (NayifatAPI) in 576.404ms
2025-02-02 11:36:49.680 +03:00 [INF] Executed endpoint 'NayifatAPI.Controllers.ProxyController.ForwardRequest (NayifatAPI)'
2025-02-02 11:36:49.683 +03:00 [INF] Request finished HTTP/1.1 POST http://07ca-46-152-255-232.ngrok-free.app/api/proxy/forward?url=https://icreditdept.com/api/testasp/test_local_verify_otp.php - 200 202 application/json 585.5545ms
2025-02-02 11:36:50.521 +03:00 [INF] Request starting HTTP/1.1 POST http://07ca-46-152-255-232.ngrok-free.app/api/device - application/json; charset=utf-8 202
2025-02-02 11:36:50.544 +03:00 [INF] Executing endpoint 'NayifatAPI.Controllers.DeviceController.RegisterDevice (NayifatAPI)'
2025-02-02 11:36:50.567 +03:00 [INF] Route matched with {action = "RegisterDevice", controller = "Device"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] RegisterDevice(NayifatAPI.Controllers.RegisterDeviceRequest) on controller NayifatAPI.Controllers.DeviceController (NayifatAPI).
2025-02-02 11:36:50.592 +03:00 [INF] Executing BadRequestObjectResult, writing value of type 'Microsoft.AspNetCore.Mvc.ValidationProblemDetails'.
2025-02-02 11:36:50.612 +03:00 [INF] Executed action NayifatAPI.Controllers.DeviceController.RegisterDevice (NayifatAPI) in 20.6908ms
2025-02-02 11:36:50.630 +03:00 [INF] Executed endpoint 'NayifatAPI.Controllers.DeviceController.RegisterDevice (NayifatAPI)'
2025-02-02 11:36:50.640 +03:00 [INF] Request finished HTTP/1.1 POST http://07ca-46-152-255-232.ngrok-free.app/api/device - 400 null application/problem+json; charset=utf-8 118.9279ms
2025-02-02 11:37:53.207 +03:00 [INF] Request starting HTTP/1.1 POST http://07ca-46-152-255-232.ngrok-free.app/api/notifications/list - application/json; charset=utf-8 47
2025-02-02 11:37:53.210 +03:00 [INF] Executing endpoint 'NayifatAPI.Controllers.NotificationsController.GetNotifications (NayifatAPI)'
2025-02-02 11:37:53.211 +03:00 [INF] Route matched with {action = "GetNotifications", controller = "Notifications"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetNotifications(NayifatAPI.Controllers.GetNotificationsRequest) on controller NayifatAPI.Controllers.NotificationsController (NayifatAPI).
2025-02-02 11:37:53.292 +03:00 [INF] Executed DbCommand (78ms) [Parameters=[@__providedApiKey_0='?' (Size = 255)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [a].[Key], [a].[CreatedAt], [a].[Description], [a].[ExpiresAt], [a].[IsActive], [a].[LastUsedAt]
FROM [ApiKeys] AS [a]
WHERE [a].[Key] = @__providedApiKey_0 AND [a].[IsActive] = CAST(1 AS bit)
2025-02-02 11:37:53.296 +03:00 [INF] Executed DbCommand (2ms) [Parameters=[@__request_NationalId_0='?' (Size = 450)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [u].[national_id], [u].[last_updated], [u].[notifications]
FROM [user_notifications] AS [u]
WHERE [u].[national_id] = @__request_NationalId_0
2025-02-02 11:37:53.301 +03:00 [INF] Executed DbCommand (3ms) [Parameters=[@__Parse_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [n].[Id], [n].[additional_data], [n].[Body], [n].[body_ar], [n].[body_en], [n].[created_at], [n].[expiry_at], [n].[Route], [n].[target_criteria], [n].[Title], [n].[title_ar], [n].[title_en]
FROM [notification_templates] AS [n]
WHERE [n].[Id] = @__Parse_0
2025-02-02 11:37:53.306 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@__Parse_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [n].[Id], [n].[additional_data], [n].[Body], [n].[body_ar], [n].[body_en], [n].[created_at], [n].[expiry_at], [n].[Route], [n].[target_criteria], [n].[Title], [n].[title_ar], [n].[title_en]
FROM [notification_templates] AS [n]
WHERE [n].[Id] = @__Parse_0
2025-02-02 11:37:53.339 +03:00 [INF] Executed DbCommand (30ms) [Parameters=[@p0='?' (Size = 4000), @p1='?' (DbType = DateTime2), @p2='?' (Size = 4000), @p3='?' (Size = 4000), @p4='?' (Size = 4000), @p5='?' (Size = 450), @p6='?' (Size = 4000), @p7='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SET IMPLICIT_TRANSACTIONS OFF;
SET NOCOUNT ON;
INSERT INTO [AuthLogs] ([AuthType], [CreatedAt], [DeviceId], [FailureReason], [IpAddress], [NationalId], [Status], [UserAgent])
OUTPUT INSERTED.[Id]
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7);
2025-02-02 11:37:53.341 +03:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType9`2[[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Object, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-02-02 11:37:53.342 +03:00 [INF] Executed action NayifatAPI.Controllers.NotificationsController.GetNotifications (NayifatAPI) in 130.4483ms
2025-02-02 11:37:53.344 +03:00 [INF] Executed endpoint 'NayifatAPI.Controllers.NotificationsController.GetNotifications (NayifatAPI)'
2025-02-02 11:37:53.345 +03:00 [INF] Request finished HTTP/1.1 POST http://07ca-46-152-255-232.ngrok-free.app/api/notifications/list - 200 null application/json; charset=utf-8 137.7796ms
2025-02-02 11:42:41.750 +03:00 [INF] Request starting HTTP/1.1 POST http://07ca-46-152-255-232.ngrok-free.app/api/auth/signin - application/json; charset=utf-8 224
2025-02-02 11:42:41.752 +03:00 [INF] Executing endpoint 'NayifatAPI.Controllers.AuthController.SignIn (NayifatAPI)'
2025-02-02 11:42:41.753 +03:00 [INF] Route matched with {action = "SignIn", controller = "Auth"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] SignIn(NayifatAPI.Controllers.SignInRequest) on controller NayifatAPI.Controllers.AuthController (NayifatAPI).
2025-02-02 11:42:41.836 +03:00 [INF] Executed DbCommand (76ms) [Parameters=[@__providedApiKey_0='?' (Size = 255)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [a].[Key], [a].[CreatedAt], [a].[Description], [a].[ExpiresAt], [a].[IsActive], [a].[LastUsedAt]
FROM [ApiKeys] AS [a]
WHERE [a].[Key] = @__providedApiKey_0 AND [a].[IsActive] = CAST(1 AS bit)
2025-02-02 11:42:41.844 +03:00 [INF] Executed DbCommand (5ms) [Parameters=[@__request_NationalId_0='?' (Size = 450)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [c].[NationalId], [c].[AddNo], [c].[BuildingNo], [c].[City], [c].[Consent], [c].[ConsentDate], [c].[DateOfBirth], [c].[Dependents], [c].[District], [c].[Email], [c].[Employer], [c].[FamilyNameAr], [c].[FamilyNameEn], [c].[FirstNameAr], [c].[FirstNameEn], [c].[Iban], [c].[IdExpiryDate], [c].[Los], [c].[Mpin], [c].[MpinEnabled], [c].[NafathStatus], [c].[NafathTimestamp], [c].[Password], [c].[Phone], [c].[RegistrationDate], [c].[SalaryCustomer], [c].[SalaryDakhli], [c].[SecondNameAr], [c].[SecondNameEn], [c].[Sector], [c].[Street], [c].[ThirdNameAr], [c].[ThirdNameEn], [c].[Zipcode]
FROM [Customers] AS [c]
WHERE [c].[NationalId] = @__request_NationalId_0
2025-02-02 11:42:41.846 +03:00 [INF] Starting password verification for NationalId: 1064448614
2025-02-02 11:42:42.024 +03:00 [INF] Password verification result for NationalId 1064448614: Success
2025-02-02 11:42:42.033 +03:00 [INF] Executed DbCommand (8ms) [Parameters=[@__request_NationalId_0='?' (Size = 450), @__request_DeviceId_1='?' (Size = 450)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [c].[Id], [c].[BiometricEnabled], [c].[BiometricToken], [c].[CreatedAt], [c].[DeviceId], [c].[LastUsedAt], [c].[Manufacturer], [c].[Model], [c].[NationalId], [c].[OsVersion], [c].[Platform], [c].[Status]
FROM [Customer_Devices] AS [c]
WHERE [c].[NationalId] = @__request_NationalId_0 AND [c].[DeviceId] = @__request_DeviceId_1 AND [c].[Status] = N'active'
2025-02-02 11:42:42.041 +03:00 [INF] Executed DbCommand (5ms) [Parameters=[@p0='?' (Size = 4000), @p1='?' (DbType = DateTime2), @p2='?' (Size = 4000), @p3='?' (Size = 4000), @p4='?' (Size = 4000), @p5='?' (Size = 450), @p6='?' (Size = 4000), @p7='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SET IMPLICIT_TRANSACTIONS OFF;
SET NOCOUNT ON;
INSERT INTO [AuthLogs] ([AuthType], [CreatedAt], [DeviceId], [FailureReason], [IpAddress], [NationalId], [Status], [UserAgent])
OUTPUT INSERTED.[Id]
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7);
2025-02-02 11:42:42.044 +03:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType9`2[[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Object, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-02-02 11:42:42.046 +03:00 [INF] Executed action NayifatAPI.Controllers.AuthController.SignIn (NayifatAPI) in 291.2476ms
2025-02-02 11:42:42.047 +03:00 [INF] Executed endpoint 'NayifatAPI.Controllers.AuthController.SignIn (NayifatAPI)'
2025-02-02 11:42:42.052 +03:00 [INF] Request finished HTTP/1.1 POST http://07ca-46-152-255-232.ngrok-free.app/api/auth/signin - 200 null application/json; charset=utf-8 302.4407ms
2025-02-02 11:42:42.416 +03:00 [INF] Request starting HTTP/1.1 POST http://07ca-46-152-255-232.ngrok-free.app/api/proxy/forward?url=https://icreditdept.com/api/testasp/test_local_generate_otp.php - application/json; charset=utf-8 84
2025-02-02 11:42:42.421 +03:00 [INF] Executing endpoint 'NayifatAPI.Controllers.ProxyController.ForwardRequest (NayifatAPI)'
2025-02-02 11:42:42.422 +03:00 [INF] Route matched with {action = "ForwardRequest", controller = "Proxy"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] ForwardRequest() on controller NayifatAPI.Controllers.ProxyController (NayifatAPI).
2025-02-02 11:42:42.423 +03:00 [INF] Start processing HTTP request POST https://icreditdept.com/api/testasp/test_local_generate_otp.php
2025-02-02 11:42:42.424 +03:00 [INF] Sending HTTP request POST https://icreditdept.com/api/testasp/test_local_generate_otp.php
2025-02-02 11:42:42.923 +03:00 [INF] Received HTTP response headers after 497.5954ms - 200
2025-02-02 11:42:42.924 +03:00 [INF] End processing HTTP request after 500.7685ms - 200
2025-02-02 11:42:42.925 +03:00 [INF] Raw response length: 200
2025-02-02 11:42:42.925 +03:00 [INF] Response content: {"success":true,"errors":[],"result":{"nationalId":"1064448614","otp":968213,"expiryDate":"2025-02-02 11:47:43","successMsg":"Success","errCode":0,"errMsg":null},"type":"N","message":null,"code":null}
2025-02-02 11:42:42.926 +03:00 [INF] Executing ContentResult with HTTP Response ContentType of application/json
2025-02-02 11:42:42.926 +03:00 [INF] Executed action NayifatAPI.Controllers.ProxyController.ForwardRequest (NayifatAPI) in 503.7398ms
2025-02-02 11:42:42.928 +03:00 [INF] Executed endpoint 'NayifatAPI.Controllers.ProxyController.ForwardRequest (NayifatAPI)'
2025-02-02 11:42:42.929 +03:00 [INF] Request finished HTTP/1.1 POST http://07ca-46-152-255-232.ngrok-free.app/api/proxy/forward?url=https://icreditdept.com/api/testasp/test_local_generate_otp.php - 200 200 application/json 512.5832ms
2025-02-02 11:42:52.817 +03:00 [INF] Request starting HTTP/1.1 POST http://07ca-46-152-255-232.ngrok-free.app/api/notifications/list - application/json; charset=utf-8 47
2025-02-02 11:42:52.822 +03:00 [INF] Executing endpoint 'NayifatAPI.Controllers.NotificationsController.GetNotifications (NayifatAPI)'
2025-02-02 11:42:52.823 +03:00 [INF] Route matched with {action = "GetNotifications", controller = "Notifications"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetNotifications(NayifatAPI.Controllers.GetNotificationsRequest) on controller NayifatAPI.Controllers.NotificationsController (NayifatAPI).
2025-02-02 11:42:52.828 +03:00 [INF] Executed DbCommand (0ms) [Parameters=[@__providedApiKey_0='?' (Size = 255)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [a].[Key], [a].[CreatedAt], [a].[Description], [a].[ExpiresAt], [a].[IsActive], [a].[LastUsedAt]
FROM [ApiKeys] AS [a]
WHERE [a].[Key] = @__providedApiKey_0 AND [a].[IsActive] = CAST(1 AS bit)
2025-02-02 11:42:52.839 +03:00 [INF] Executed DbCommand (9ms) [Parameters=[@__request_NationalId_0='?' (Size = 450)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [u].[national_id], [u].[last_updated], [u].[notifications]
FROM [user_notifications] AS [u]
WHERE [u].[national_id] = @__request_NationalId_0
2025-02-02 11:42:52.844 +03:00 [INF] Executed DbCommand (3ms) [Parameters=[@__Parse_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [n].[Id], [n].[additional_data], [n].[Body], [n].[body_ar], [n].[body_en], [n].[created_at], [n].[expiry_at], [n].[Route], [n].[target_criteria], [n].[Title], [n].[title_ar], [n].[title_en]
FROM [notification_templates] AS [n]
WHERE [n].[Id] = @__Parse_0
2025-02-02 11:42:52.847 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@__Parse_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [n].[Id], [n].[additional_data], [n].[Body], [n].[body_ar], [n].[body_en], [n].[created_at], [n].[expiry_at], [n].[Route], [n].[target_criteria], [n].[Title], [n].[title_ar], [n].[title_en]
FROM [notification_templates] AS [n]
WHERE [n].[Id] = @__Parse_0
2025-02-02 11:42:52.853 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@p0='?' (Size = 4000), @p1='?' (DbType = DateTime2), @p2='?' (Size = 4000), @p3='?' (Size = 4000), @p4='?' (Size = 4000), @p5='?' (Size = 450), @p6='?' (Size = 4000), @p7='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SET IMPLICIT_TRANSACTIONS OFF;
SET NOCOUNT ON;
INSERT INTO [AuthLogs] ([AuthType], [CreatedAt], [DeviceId], [FailureReason], [IpAddress], [NationalId], [Status], [UserAgent])
OUTPUT INSERTED.[Id]
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7);
2025-02-02 11:42:52.855 +03:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType9`2[[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Object, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-02-02 11:42:52.856 +03:00 [INF] Executed action NayifatAPI.Controllers.NotificationsController.GetNotifications (NayifatAPI) in 30.4895ms
2025-02-02 11:42:52.857 +03:00 [INF] Executed endpoint 'NayifatAPI.Controllers.NotificationsController.GetNotifications (NayifatAPI)'
2025-02-02 11:42:52.858 +03:00 [INF] Request finished HTTP/1.1 POST http://07ca-46-152-255-232.ngrok-free.app/api/notifications/list - 200 null application/json; charset=utf-8 41.2211ms
2025-02-02 11:42:57.524 +03:00 [INF] Request starting HTTP/1.1 POST http://07ca-46-152-255-232.ngrok-free.app/api/proxy/forward?url=https://icreditdept.com/api/testasp/test_local_verify_otp.php - application/json; charset=utf-8 53
2025-02-02 11:42:57.529 +03:00 [INF] Executing endpoint 'NayifatAPI.Controllers.ProxyController.ForwardRequest (NayifatAPI)'
2025-02-02 11:42:57.530 +03:00 [INF] Route matched with {action = "ForwardRequest", controller = "Proxy"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] ForwardRequest() on controller NayifatAPI.Controllers.ProxyController (NayifatAPI).
2025-02-02 11:42:57.533 +03:00 [INF] Start processing HTTP request POST https://icreditdept.com/api/testasp/test_local_verify_otp.php
2025-02-02 11:42:57.535 +03:00 [INF] Sending HTTP request POST https://icreditdept.com/api/testasp/test_local_verify_otp.php
2025-02-02 11:42:58.061 +03:00 [INF] Received HTTP response headers after 524.4558ms - 200
2025-02-02 11:42:58.062 +03:00 [INF] End processing HTTP request after 529.1839ms - 200
2025-02-02 11:42:58.063 +03:00 [INF] Raw response length: 202
2025-02-02 11:42:58.064 +03:00 [INF] Response content: {"success":true,"errors":[],"result":{"nationalId":"1064448614","otp":"968213","verifiedFlag":true,"successMsg":"Verified successfully.","errCode":0,"errMsg":null},"type":"N","message":null,"code":null}
2025-02-02 11:42:58.065 +03:00 [INF] Executing ContentResult with HTTP Response ContentType of application/json
2025-02-02 11:42:58.066 +03:00 [INF] Executed action NayifatAPI.Controllers.ProxyController.ForwardRequest (NayifatAPI) in 534.0104ms
2025-02-02 11:42:58.067 +03:00 [INF] Executed endpoint 'NayifatAPI.Controllers.ProxyController.ForwardRequest (NayifatAPI)'
2025-02-02 11:42:58.068 +03:00 [INF] Request finished HTTP/1.1 POST http://07ca-46-152-255-232.ngrok-free.app/api/proxy/forward?url=https://icreditdept.com/api/testasp/test_local_verify_otp.php - 200 202 application/json 544.2924ms
2025-02-02 11:42:59.020 +03:00 [INF] Request starting HTTP/1.1 POST http://07ca-46-152-255-232.ngrok-free.app/api/device - application/json; charset=utf-8 202
2025-02-02 11:42:59.041 +03:00 [INF] Executing endpoint 'NayifatAPI.Controllers.DeviceController.RegisterDevice (NayifatAPI)'
2025-02-02 11:42:59.070 +03:00 [INF] Route matched with {action = "RegisterDevice", controller = "Device"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] RegisterDevice(NayifatAPI.Controllers.RegisterDeviceRequest) on controller NayifatAPI.Controllers.DeviceController (NayifatAPI).
2025-02-02 11:42:59.112 +03:00 [INF] Executing BadRequestObjectResult, writing value of type 'Microsoft.AspNetCore.Mvc.ValidationProblemDetails'.
2025-02-02 11:42:59.123 +03:00 [INF] Executed action NayifatAPI.Controllers.DeviceController.RegisterDevice (NayifatAPI) in 12.7099ms
2025-02-02 11:42:59.140 +03:00 [INF] Executed endpoint 'NayifatAPI.Controllers.DeviceController.RegisterDevice (NayifatAPI)'
2025-02-02 11:42:59.168 +03:00 [INF] Request finished HTTP/1.1 POST http://07ca-46-152-255-232.ngrok-free.app/api/device - 400 null application/problem+json; charset=utf-8 148.1128ms
2025-02-02 11:45:13.711 +03:00 [INF] Request starting HTTP/1.1 POST http://07ca-46-152-255-232.ngrok-free.app/api/notifications/list - application/json; charset=utf-8 47
2025-02-02 11:45:13.872 +03:00 [INF] Executing endpoint 'NayifatAPI.Controllers.NotificationsController.GetNotifications (NayifatAPI)'
2025-02-02 11:45:13.890 +03:00 [INF] Route matched with {action = "GetNotifications", controller = "Notifications"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetNotifications(NayifatAPI.Controllers.GetNotificationsRequest) on controller NayifatAPI.Controllers.NotificationsController (NayifatAPI).
2025-02-02 11:45:13.905 +03:00 [INF] Executed DbCommand (6ms) [Parameters=[@__providedApiKey_0='?' (Size = 255)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [a].[Key], [a].[CreatedAt], [a].[Description], [a].[ExpiresAt], [a].[IsActive], [a].[LastUsedAt]
FROM [ApiKeys] AS [a]
WHERE [a].[Key] = @__providedApiKey_0 AND [a].[IsActive] = CAST(1 AS bit)
2025-02-02 11:45:13.916 +03:00 [INF] Executed DbCommand (3ms) [Parameters=[@__request_NationalId_0='?' (Size = 450)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [u].[national_id], [u].[last_updated], [u].[notifications]
FROM [user_notifications] AS [u]
WHERE [u].[national_id] = @__request_NationalId_0
2025-02-02 11:45:13.925 +03:00 [INF] Executed DbCommand (6ms) [Parameters=[@__Parse_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [n].[Id], [n].[additional_data], [n].[Body], [n].[body_ar], [n].[body_en], [n].[created_at], [n].[expiry_at], [n].[Route], [n].[target_criteria], [n].[Title], [n].[title_ar], [n].[title_en]
FROM [notification_templates] AS [n]
WHERE [n].[Id] = @__Parse_0
2025-02-02 11:45:13.948 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@__Parse_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [n].[Id], [n].[additional_data], [n].[Body], [n].[body_ar], [n].[body_en], [n].[created_at], [n].[expiry_at], [n].[Route], [n].[target_criteria], [n].[Title], [n].[title_ar], [n].[title_en]
FROM [notification_templates] AS [n]
WHERE [n].[Id] = @__Parse_0
2025-02-02 11:45:13.970 +03:00 [INF] Executed DbCommand (18ms) [Parameters=[@p0='?' (Size = 4000), @p1='?' (DbType = DateTime2), @p2='?' (Size = 4000), @p3='?' (Size = 4000), @p4='?' (Size = 4000), @p5='?' (Size = 450), @p6='?' (Size = 4000), @p7='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SET IMPLICIT_TRANSACTIONS OFF;
SET NOCOUNT ON;
INSERT INTO [AuthLogs] ([AuthType], [CreatedAt], [DeviceId], [FailureReason], [IpAddress], [NationalId], [Status], [UserAgent])
OUTPUT INSERTED.[Id]
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7);
2025-02-02 11:45:13.976 +03:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType9`2[[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Object, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-02-02 11:45:13.979 +03:00 [INF] Executed action NayifatAPI.Controllers.NotificationsController.GetNotifications (NayifatAPI) in 83.3573ms
2025-02-02 11:45:13.983 +03:00 [INF] Executed endpoint 'NayifatAPI.Controllers.NotificationsController.GetNotifications (NayifatAPI)'
2025-02-02 11:45:13.985 +03:00 [INF] Request finished HTTP/1.1 POST http://07ca-46-152-255-232.ngrok-free.app/api/notifications/list - 200 null application/json; charset=utf-8 274.8623ms
2025-02-02 11:45:26.744 +03:00 [INF] Request starting HTTP/1.1 POST http://07ca-46-152-255-232.ngrok-free.app/api/auth/signin - application/json; charset=utf-8 224
2025-02-02 11:45:26.927 +03:00 [INF] Executing endpoint 'NayifatAPI.Controllers.AuthController.SignIn (NayifatAPI)'
2025-02-02 11:45:26.930 +03:00 [INF] Route matched with {action = "SignIn", controller = "Auth"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] SignIn(NayifatAPI.Controllers.SignInRequest) on controller NayifatAPI.Controllers.AuthController (NayifatAPI).
2025-02-02 11:45:26.936 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@__providedApiKey_0='?' (Size = 255)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [a].[Key], [a].[CreatedAt], [a].[Description], [a].[ExpiresAt], [a].[IsActive], [a].[LastUsedAt]
FROM [ApiKeys] AS [a]
WHERE [a].[Key] = @__providedApiKey_0 AND [a].[IsActive] = CAST(1 AS bit)
2025-02-02 11:45:26.942 +03:00 [INF] Executed DbCommand (4ms) [Parameters=[@__request_NationalId_0='?' (Size = 450)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [c].[NationalId], [c].[AddNo], [c].[BuildingNo], [c].[City], [c].[Consent], [c].[ConsentDate], [c].[DateOfBirth], [c].[Dependents], [c].[District], [c].[Email], [c].[Employer], [c].[FamilyNameAr], [c].[FamilyNameEn], [c].[FirstNameAr], [c].[FirstNameEn], [c].[Iban], [c].[IdExpiryDate], [c].[Los], [c].[Mpin], [c].[MpinEnabled], [c].[NafathStatus], [c].[NafathTimestamp], [c].[Password], [c].[Phone], [c].[RegistrationDate], [c].[SalaryCustomer], [c].[SalaryDakhli], [c].[SecondNameAr], [c].[SecondNameEn], [c].[Sector], [c].[Street], [c].[ThirdNameAr], [c].[ThirdNameEn], [c].[Zipcode]
FROM [Customers] AS [c]
WHERE [c].[NationalId] = @__request_NationalId_0
2025-02-02 11:45:26.981 +03:00 [INF] Starting password verification for NationalId: 1064448614
2025-02-02 11:45:27.366 +03:00 [INF] Password verification result for NationalId 1064448614: Success
2025-02-02 11:45:27.409 +03:00 [INF] Executed DbCommand (6ms) [Parameters=[@__request_NationalId_0='?' (Size = 450), @__request_DeviceId_1='?' (Size = 450)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [c].[Id], [c].[BiometricEnabled], [c].[BiometricToken], [c].[CreatedAt], [c].[DeviceId], [c].[LastUsedAt], [c].[Manufacturer], [c].[Model], [c].[NationalId], [c].[OsVersion], [c].[Platform], [c].[Status]
FROM [Customer_Devices] AS [c]
WHERE [c].[NationalId] = @__request_NationalId_0 AND [c].[DeviceId] = @__request_DeviceId_1 AND [c].[Status] = N'active'
2025-02-02 11:45:27.519 +03:00 [INF] Executed DbCommand (74ms) [Parameters=[@p0='?' (Size = 4000), @p1='?' (DbType = DateTime2), @p2='?' (Size = 4000), @p3='?' (Size = 4000), @p4='?' (Size = 4000), @p5='?' (Size = 450), @p6='?' (Size = 4000), @p7='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SET IMPLICIT_TRANSACTIONS OFF;
SET NOCOUNT ON;
INSERT INTO [AuthLogs] ([AuthType], [CreatedAt], [DeviceId], [FailureReason], [IpAddress], [NationalId], [Status], [UserAgent])
OUTPUT INSERTED.[Id]
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7);
2025-02-02 11:45:27.523 +03:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType9`2[[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Object, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-02-02 11:45:27.525 +03:00 [INF] Executed action NayifatAPI.Controllers.AuthController.SignIn (NayifatAPI) in 591.3797ms
2025-02-02 11:45:27.527 +03:00 [INF] Executed endpoint 'NayifatAPI.Controllers.AuthController.SignIn (NayifatAPI)'
2025-02-02 11:45:27.546 +03:00 [INF] Request finished HTTP/1.1 POST http://07ca-46-152-255-232.ngrok-free.app/api/auth/signin - 200 null application/json; charset=utf-8 802.0996ms
2025-02-02 11:45:28.138 +03:00 [INF] Request starting HTTP/1.1 POST http://07ca-46-152-255-232.ngrok-free.app/api/proxy/forward?url=https://icreditdept.com/api/testasp/test_local_generate_otp.php - application/json; charset=utf-8 84
2025-02-02 11:45:28.147 +03:00 [INF] Executing endpoint 'NayifatAPI.Controllers.ProxyController.ForwardRequest (NayifatAPI)'
2025-02-02 11:45:28.172 +03:00 [INF] Route matched with {action = "ForwardRequest", controller = "Proxy"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] ForwardRequest() on controller NayifatAPI.Controllers.ProxyController (NayifatAPI).
2025-02-02 11:45:28.282 +03:00 [INF] Start processing HTTP request POST https://icreditdept.com/api/testasp/test_local_generate_otp.php
2025-02-02 11:45:28.285 +03:00 [INF] Sending HTTP request POST https://icreditdept.com/api/testasp/test_local_generate_otp.php
2025-02-02 11:45:29.126 +03:00 [INF] Received HTTP response headers after 837.3727ms - 200
2025-02-02 11:45:29.386 +03:00 [INF] End processing HTTP request after 1104.2014ms - 200
2025-02-02 11:45:29.408 +03:00 [INF] Raw response length: 200
2025-02-02 11:45:29.414 +03:00 [INF] Response content: {"success":true,"errors":[],"result":{"nationalId":"1064448614","otp":476854,"expiryDate":"2025-02-02 11:50:29","successMsg":"Success","errCode":0,"errMsg":null},"type":"N","message":null,"code":null}
2025-02-02 11:45:29.418 +03:00 [INF] Executing ContentResult with HTTP Response ContentType of application/json
2025-02-02 11:45:29.420 +03:00 [INF] Executed action NayifatAPI.Controllers.ProxyController.ForwardRequest (NayifatAPI) in 1138.5989ms
2025-02-02 11:45:29.422 +03:00 [INF] Executed endpoint 'NayifatAPI.Controllers.ProxyController.ForwardRequest (NayifatAPI)'
2025-02-02 11:45:29.425 +03:00 [INF] Request finished HTTP/1.1 POST http://07ca-46-152-255-232.ngrok-free.app/api/proxy/forward?url=https://icreditdept.com/api/testasp/test_local_generate_otp.php - 200 200 application/json 1287.1433ms
2025-02-02 11:45:41.790 +03:00 [INF] Request starting HTTP/1.1 POST http://07ca-46-152-255-232.ngrok-free.app/api/proxy/forward?url=https://icreditdept.com/api/testasp/test_local_verify_otp.php - application/json; charset=utf-8 53
2025-02-02 11:45:41.800 +03:00 [INF] Executing endpoint 'NayifatAPI.Controllers.ProxyController.ForwardRequest (NayifatAPI)'
2025-02-02 11:45:41.801 +03:00 [INF] Route matched with {action = "ForwardRequest", controller = "Proxy"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] ForwardRequest() on controller NayifatAPI.Controllers.ProxyController (NayifatAPI).
2025-02-02 11:45:41.803 +03:00 [INF] Start processing HTTP request POST https://icreditdept.com/api/testasp/test_local_verify_otp.php
2025-02-02 11:45:41.804 +03:00 [INF] Sending HTTP request POST https://icreditdept.com/api/testasp/test_local_verify_otp.php
2025-02-02 11:45:42.415 +03:00 [INF] Received HTTP response headers after 609.7518ms - 200
2025-02-02 11:45:42.421 +03:00 [INF] End processing HTTP request after 617.784ms - 200
2025-02-02 11:45:42.423 +03:00 [INF] Raw response length: 202
2025-02-02 11:45:42.424 +03:00 [INF] Response content: {"success":true,"errors":[],"result":{"nationalId":"1064448614","otp":"476854","verifiedFlag":true,"successMsg":"Verified successfully.","errCode":0,"errMsg":null},"type":"N","message":null,"code":null}
2025-02-02 11:45:42.427 +03:00 [INF] Executing ContentResult with HTTP Response ContentType of application/json
2025-02-02 11:45:42.443 +03:00 [INF] Executed action NayifatAPI.Controllers.ProxyController.ForwardRequest (NayifatAPI) in 640.5816ms
2025-02-02 11:45:42.735 +03:00 [INF] Executed endpoint 'NayifatAPI.Controllers.ProxyController.ForwardRequest (NayifatAPI)'
2025-02-02 11:45:42.736 +03:00 [INF] Request finished HTTP/1.1 POST http://07ca-46-152-255-232.ngrok-free.app/api/proxy/forward?url=https://icreditdept.com/api/testasp/test_local_verify_otp.php - 200 202 application/json 946.226ms
2025-02-02 11:45:43.389 +03:00 [INF] Request starting HTTP/1.1 POST http://07ca-46-152-255-232.ngrok-free.app/api/device - application/json; charset=utf-8 163
2025-02-02 11:45:43.391 +03:00 [INF] Executing endpoint 'NayifatAPI.Controllers.DeviceController.RegisterDevice (NayifatAPI)'
2025-02-02 11:45:43.392 +03:00 [INF] Route matched with {action = "RegisterDevice", controller = "Device"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] RegisterDevice(NayifatAPI.Controllers.RegisterDeviceRequest) on controller NayifatAPI.Controllers.DeviceController (NayifatAPI).
2025-02-02 11:45:43.400 +03:00 [INF] Executing ObjectResult, writing value of type '<>f__AnonymousType11`2[[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-02-02 11:45:43.402 +03:00 [INF] Executed action NayifatAPI.Controllers.DeviceController.RegisterDevice (NayifatAPI) in 8.8303ms
2025-02-02 11:45:43.403 +03:00 [INF] Executed endpoint 'NayifatAPI.Controllers.DeviceController.RegisterDevice (NayifatAPI)'
2025-02-02 11:45:43.403 +03:00 [INF] Request finished HTTP/1.1 POST http://07ca-46-152-255-232.ngrok-free.app/api/device - 401 null application/json; charset=utf-8 14.8083ms
2025-02-02 11:47:21.615 +03:00 [INF] Request starting HTTP/1.1 POST http://07ca-46-152-255-232.ngrok-free.app/api/notifications/list - application/json; charset=utf-8 47
2025-02-02 11:47:21.618 +03:00 [INF] Executing endpoint 'NayifatAPI.Controllers.NotificationsController.GetNotifications (NayifatAPI)'
2025-02-02 11:47:21.619 +03:00 [INF] Route matched with {action = "GetNotifications", controller = "Notifications"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetNotifications(NayifatAPI.Controllers.GetNotificationsRequest) on controller NayifatAPI.Controllers.NotificationsController (NayifatAPI).
2025-02-02 11:47:21.624 +03:00 [INF] Executed DbCommand (2ms) [Parameters=[@__providedApiKey_0='?' (Size = 255)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [a].[Key], [a].[CreatedAt], [a].[Description], [a].[ExpiresAt], [a].[IsActive], [a].[LastUsedAt]
FROM [ApiKeys] AS [a]
WHERE [a].[Key] = @__providedApiKey_0 AND [a].[IsActive] = CAST(1 AS bit)
2025-02-02 11:47:21.628 +03:00 [INF] Executed DbCommand (2ms) [Parameters=[@__request_NationalId_0='?' (Size = 450)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [u].[national_id], [u].[last_updated], [u].[notifications]
FROM [user_notifications] AS [u]
WHERE [u].[national_id] = @__request_NationalId_0
2025-02-02 11:47:21.632 +03:00 [INF] Executed DbCommand (2ms) [Parameters=[@__Parse_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [n].[Id], [n].[additional_data], [n].[Body], [n].[body_ar], [n].[body_en], [n].[created_at], [n].[expiry_at], [n].[Route], [n].[target_criteria], [n].[Title], [n].[title_ar], [n].[title_en]
FROM [notification_templates] AS [n]
WHERE [n].[Id] = @__Parse_0
2025-02-02 11:47:21.635 +03:00 [INF] Executed DbCommand (0ms) [Parameters=[@__Parse_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [n].[Id], [n].[additional_data], [n].[Body], [n].[body_ar], [n].[body_en], [n].[created_at], [n].[expiry_at], [n].[Route], [n].[target_criteria], [n].[Title], [n].[title_ar], [n].[title_en]
FROM [notification_templates] AS [n]
WHERE [n].[Id] = @__Parse_0
2025-02-02 11:47:23.497 +03:00 [INF] Executed DbCommand (1,859ms) [Parameters=[@p0='?' (Size = 4000), @p1='?' (DbType = DateTime2), @p2='?' (Size = 4000), @p3='?' (Size = 4000), @p4='?' (Size = 4000), @p5='?' (Size = 450), @p6='?' (Size = 4000), @p7='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SET IMPLICIT_TRANSACTIONS OFF;
SET NOCOUNT ON;
INSERT INTO [AuthLogs] ([AuthType], [CreatedAt], [DeviceId], [FailureReason], [IpAddress], [NationalId], [Status], [UserAgent])
OUTPUT INSERTED.[Id]
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7);
2025-02-02 11:47:23.499 +03:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType9`2[[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Object, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-02-02 11:47:23.500 +03:00 [INF] Executed action NayifatAPI.Controllers.NotificationsController.GetNotifications (NayifatAPI) in 1880.3747ms
2025-02-02 11:47:23.501 +03:00 [INF] Executed endpoint 'NayifatAPI.Controllers.NotificationsController.GetNotifications (NayifatAPI)'
2025-02-02 11:47:23.503 +03:00 [INF] Request finished HTTP/1.1 POST http://07ca-46-152-255-232.ngrok-free.app/api/notifications/list - 200 null application/json; charset=utf-8 1887.6774ms
2025-02-02 11:48:34.231 +03:00 [INF] Request starting HTTP/1.1 POST http://07ca-46-152-255-232.ngrok-free.app/api/auth/signin - application/json; charset=utf-8 224
2025-02-02 11:48:34.234 +03:00 [INF] Executing endpoint 'NayifatAPI.Controllers.AuthController.SignIn (NayifatAPI)'
2025-02-02 11:48:34.236 +03:00 [INF] Route matched with {action = "SignIn", controller = "Auth"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] SignIn(NayifatAPI.Controllers.SignInRequest) on controller NayifatAPI.Controllers.AuthController (NayifatAPI).
2025-02-02 11:48:34.240 +03:00 [INF] Executed DbCommand (2ms) [Parameters=[@__providedApiKey_0='?' (Size = 255)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [a].[Key], [a].[CreatedAt], [a].[Description], [a].[ExpiresAt], [a].[IsActive], [a].[LastUsedAt]
FROM [ApiKeys] AS [a]
WHERE [a].[Key] = @__providedApiKey_0 AND [a].[IsActive] = CAST(1 AS bit)
2025-02-02 11:48:34.244 +03:00 [INF] Executed DbCommand (2ms) [Parameters=[@__request_NationalId_0='?' (Size = 450)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [c].[NationalId], [c].[AddNo], [c].[BuildingNo], [c].[City], [c].[Consent], [c].[ConsentDate], [c].[DateOfBirth], [c].[Dependents], [c].[District], [c].[Email], [c].[Employer], [c].[FamilyNameAr], [c].[FamilyNameEn], [c].[FirstNameAr], [c].[FirstNameEn], [c].[Iban], [c].[IdExpiryDate], [c].[Los], [c].[Mpin], [c].[MpinEnabled], [c].[NafathStatus], [c].[NafathTimestamp], [c].[Password], [c].[Phone], [c].[RegistrationDate], [c].[SalaryCustomer], [c].[SalaryDakhli], [c].[SecondNameAr], [c].[SecondNameEn], [c].[Sector], [c].[Street], [c].[ThirdNameAr], [c].[ThirdNameEn], [c].[Zipcode]
FROM [Customers] AS [c]
WHERE [c].[NationalId] = @__request_NationalId_0
2025-02-02 11:48:34.246 +03:00 [INF] Starting password verification for NationalId: 1064448614
2025-02-02 11:48:34.420 +03:00 [INF] Password verification result for NationalId 1064448614: Success
2025-02-02 11:48:34.425 +03:00 [INF] Executed DbCommand (3ms) [Parameters=[@__request_NationalId_0='?' (Size = 450), @__request_DeviceId_1='?' (Size = 450)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [c].[Id], [c].[BiometricEnabled], [c].[BiometricToken], [c].[CreatedAt], [c].[DeviceId], [c].[LastUsedAt], [c].[Manufacturer], [c].[Model], [c].[NationalId], [c].[OsVersion], [c].[Platform], [c].[Status]
FROM [Customer_Devices] AS [c]
WHERE [c].[NationalId] = @__request_NationalId_0 AND [c].[DeviceId] = @__request_DeviceId_1 AND [c].[Status] = N'active'
2025-02-02 11:48:34.504 +03:00 [INF] Executed DbCommand (76ms) [Parameters=[@p0='?' (Size = 4000), @p1='?' (DbType = DateTime2), @p2='?' (Size = 4000), @p3='?' (Size = 4000), @p4='?' (Size = 4000), @p5='?' (Size = 450), @p6='?' (Size = 4000), @p7='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SET IMPLICIT_TRANSACTIONS OFF;
SET NOCOUNT ON;
INSERT INTO [AuthLogs] ([AuthType], [CreatedAt], [DeviceId], [FailureReason], [IpAddress], [NationalId], [Status], [UserAgent])
OUTPUT INSERTED.[Id]
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7);
2025-02-02 11:48:34.507 +03:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType9`2[[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Object, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-02-02 11:48:34.508 +03:00 [INF] Executed action NayifatAPI.Controllers.AuthController.SignIn (NayifatAPI) in 271.0426ms
2025-02-02 11:48:34.509 +03:00 [INF] Executed endpoint 'NayifatAPI.Controllers.AuthController.SignIn (NayifatAPI)'
2025-02-02 11:48:34.510 +03:00 [INF] Request finished HTTP/1.1 POST http://07ca-46-152-255-232.ngrok-free.app/api/auth/signin - 200 null application/json; charset=utf-8 278.452ms
2025-02-02 11:48:35.134 +03:00 [INF] Request starting HTTP/1.1 POST http://07ca-46-152-255-232.ngrok-free.app/api/proxy/forward?url=https://icreditdept.com/api/testasp/test_local_generate_otp.php - application/json; charset=utf-8 84
2025-02-02 11:48:35.137 +03:00 [INF] Executing endpoint 'NayifatAPI.Controllers.ProxyController.ForwardRequest (NayifatAPI)'
2025-02-02 11:48:35.138 +03:00 [INF] Route matched with {action = "ForwardRequest", controller = "Proxy"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] ForwardRequest() on controller NayifatAPI.Controllers.ProxyController (NayifatAPI).
2025-02-02 11:48:35.141 +03:00 [INF] Start processing HTTP request POST https://icreditdept.com/api/testasp/test_local_generate_otp.php
2025-02-02 11:48:35.141 +03:00 [INF] Sending HTTP request POST https://icreditdept.com/api/testasp/test_local_generate_otp.php
2025-02-02 11:48:35.826 +03:00 [INF] Received HTTP response headers after 683.4135ms - 200
2025-02-02 11:48:35.827 +03:00 [INF] End processing HTTP request after 686.6635ms - 200
2025-02-02 11:48:35.829 +03:00 [INF] Raw response length: 200
2025-02-02 11:48:35.829 +03:00 [INF] Response content: {"success":true,"errors":[],"result":{"nationalId":"1064448614","otp":595235,"expiryDate":"2025-02-02 11:53:36","successMsg":"Success","errCode":0,"errMsg":null},"type":"N","message":null,"code":null}
2025-02-02 11:48:35.830 +03:00 [INF] Executing ContentResult with HTTP Response ContentType of application/json
2025-02-02 11:48:35.832 +03:00 [INF] Executed action NayifatAPI.Controllers.ProxyController.ForwardRequest (NayifatAPI) in 691.9387ms
2025-02-02 11:48:35.835 +03:00 [INF] Executed endpoint 'NayifatAPI.Controllers.ProxyController.ForwardRequest (NayifatAPI)'
2025-02-02 11:48:35.841 +03:00 [INF] Request finished HTTP/1.1 POST http://07ca-46-152-255-232.ngrok-free.app/api/proxy/forward?url=https://icreditdept.com/api/testasp/test_local_generate_otp.php - 200 200 application/json 706.736ms
2025-02-02 11:49:02.475 +03:00 [INF] Request starting HTTP/1.1 POST http://07ca-46-152-255-232.ngrok-free.app/api/proxy/forward?url=https://icreditdept.com/api/testasp/test_local_verify_otp.php - application/json; charset=utf-8 53
2025-02-02 11:49:02.478 +03:00 [INF] Executing endpoint 'NayifatAPI.Controllers.ProxyController.ForwardRequest (NayifatAPI)'
2025-02-02 11:49:02.480 +03:00 [INF] Route matched with {action = "ForwardRequest", controller = "Proxy"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] ForwardRequest() on controller NayifatAPI.Controllers.ProxyController (NayifatAPI).
2025-02-02 11:49:02.482 +03:00 [INF] Start processing HTTP request POST https://icreditdept.com/api/testasp/test_local_verify_otp.php
2025-02-02 11:49:02.483 +03:00 [INF] Sending HTTP request POST https://icreditdept.com/api/testasp/test_local_verify_otp.php
2025-02-02 11:49:02.900 +03:00 [INF] Received HTTP response headers after 415.9704ms - 200
2025-02-02 11:49:02.902 +03:00 [INF] End processing HTTP request after 419.8552ms - 200
2025-02-02 11:49:02.904 +03:00 [INF] Raw response length: 202
2025-02-02 11:49:02.905 +03:00 [INF] Response content: {"success":true,"errors":[],"result":{"nationalId":"1064448614","otp":"595235","verifiedFlag":true,"successMsg":"Verified successfully.","errCode":0,"errMsg":null},"type":"N","message":null,"code":null}
2025-02-02 11:49:02.907 +03:00 [INF] Executing ContentResult with HTTP Response ContentType of application/json
2025-02-02 11:49:02.908 +03:00 [INF] Executed action NayifatAPI.Controllers.ProxyController.ForwardRequest (NayifatAPI) in 426.1136ms
2025-02-02 11:49:02.909 +03:00 [INF] Executed endpoint 'NayifatAPI.Controllers.ProxyController.ForwardRequest (NayifatAPI)'
2025-02-02 11:49:02.910 +03:00 [INF] Request finished HTTP/1.1 POST http://07ca-46-152-255-232.ngrok-free.app/api/proxy/forward?url=https://icreditdept.com/api/testasp/test_local_verify_otp.php - 200 202 application/json 434.7539ms
2025-02-02 11:49:03.995 +03:00 [INF] Request starting HTTP/1.1 POST http://07ca-46-152-255-232.ngrok-free.app/api/device - application/json; charset=utf-8 163
2025-02-02 11:49:03.997 +03:00 [INF] Executing endpoint 'NayifatAPI.Controllers.DeviceController.RegisterDevice (NayifatAPI)'
2025-02-02 11:49:03.998 +03:00 [INF] Route matched with {action = "RegisterDevice", controller = "Device"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] RegisterDevice(NayifatAPI.Controllers.RegisterDeviceRequest) on controller NayifatAPI.Controllers.DeviceController (NayifatAPI).
2025-02-02 11:49:04.004 +03:00 [INF] Executed DbCommand (5ms) [Parameters=[@__providedApiKey_0='?' (Size = 255)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [a].[Key], [a].[CreatedAt], [a].[Description], [a].[ExpiresAt], [a].[IsActive], [a].[LastUsedAt]
FROM [ApiKeys] AS [a]
WHERE [a].[Key] = @__providedApiKey_0 AND [a].[IsActive] = CAST(1 AS bit)
2025-02-02 11:49:04.033 +03:00 [INF] Executed DbCommand (3ms) [Parameters=[@__p_0='?' (Size = 450)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [c].[NationalId], [c].[AddNo], [c].[BuildingNo], [c].[City], [c].[Consent], [c].[ConsentDate], [c].[DateOfBirth], [c].[Dependents], [c].[District], [c].[Email], [c].[Employer], [c].[FamilyNameAr], [c].[FamilyNameEn], [c].[FirstNameAr], [c].[FirstNameEn], [c].[Iban], [c].[IdExpiryDate], [c].[Los], [c].[Mpin], [c].[MpinEnabled], [c].[NafathStatus], [c].[NafathTimestamp], [c].[Password], [c].[Phone], [c].[RegistrationDate], [c].[SalaryCustomer], [c].[SalaryDakhli], [c].[SecondNameAr], [c].[SecondNameEn], [c].[Sector], [c].[Street], [c].[ThirdNameAr], [c].[ThirdNameEn], [c].[Zipcode]
FROM [Customers] AS [c]
WHERE [c].[NationalId] = @__p_0
2025-02-02 11:49:04.142 +03:00 [INF] Executed DbCommand (85ms) [Parameters=[@__request_NationalId_0='?' (Size = 450)], CommandType='"Text"', CommandTimeout='30']
UPDATE [c]
SET [c].[LastUsedAt] = GETUTCDATE(),
    [c].[Status] = N'disabled'
FROM [Customer_Devices] AS [c]
WHERE [c].[NationalId] = @__request_NationalId_0
2025-02-02 11:49:04.187 +03:00 [INF] Executed DbCommand (27ms) [Parameters=[@p0='?' (Size = 4000), @p1='?' (DbType = DateTime2), @p2='?' (Size = 4000), @p3='?' (Size = 4000), @p4='?' (Size = 4000), @p5='?' (Size = 450), @p6='?' (Size = 4000), @p7='?' (Size = 4000), @p8='?' (DbType = Boolean), @p9='?' (Size = 4000), @p10='?' (DbType = DateTime2), @p11='?' (Size = 450), @p12='?' (DbType = DateTime2), @p13='?' (Size = 4000), @p14='?' (Size = 4000), @p15='?' (Size = 450), @p16='?' (Size = 4000), @p17='?' (Size = 4000), @p18='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SET NOCOUNT ON;
INSERT INTO [AuthLogs] ([AuthType], [CreatedAt], [DeviceId], [FailureReason], [IpAddress], [NationalId], [Status], [UserAgent])
OUTPUT INSERTED.[Id]
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7);
INSERT INTO [Customer_Devices] ([BiometricEnabled], [BiometricToken], [CreatedAt], [DeviceId], [LastUsedAt], [Manufacturer], [Model], [NationalId], [OsVersion], [Platform], [Status])
OUTPUT INSERTED.[Id]
VALUES (@p8, @p9, @p10, @p11, @p12, @p13, @p14, @p15, @p16, @p17, @p18);
2025-02-02 11:49:04.216 +03:00 [ERR] An exception occurred in the database while saving changes for context type 'NayifatAPI.Data.ApplicationDbContext'.
Microsoft.EntityFrameworkCore.DbUpdateException: An error occurred while saving the entity changes. See the inner exception for details.
 ---> Microsoft.Data.SqlClient.SqlException (0x80131904): Cannot insert duplicate key row in object 'dbo.Customer_Devices' with unique index 'IX_Customer_Devices_NationalId_DeviceId'. The duplicate key value is (1064448614, TP1A.220624.014).
   at Microsoft.Data.SqlClient.SqlConnection.OnError(SqlException exception, Boolean breakConnection, Action`1 wrapCloseInAction)
   at Microsoft.Data.SqlClient.SqlInternalConnection.OnError(SqlException exception, Boolean breakConnection, Action`1 wrapCloseInAction)
   at Microsoft.Data.SqlClient.TdsParser.ThrowExceptionAndWarning(TdsParserStateObject stateObj, Boolean callerHasConnectionLock, Boolean asyncClose)
   at Microsoft.Data.SqlClient.TdsParser.TryRun(RunBehavior runBehavior, SqlCommand cmdHandler, SqlDataReader dataStream, BulkCopySimpleResultSet bulkCopyHandler, TdsParserStateObject stateObj, Boolean& dataReady)
   at Microsoft.Data.SqlClient.SqlDataReader.TryHasMoreRows(Boolean& moreRows)
   at Microsoft.Data.SqlClient.SqlDataReader.TryReadInternal(Boolean setTimeout, Boolean& more)
   at Microsoft.Data.SqlClient.SqlDataReader.ReadAsyncExecute(Task task, Object state)
   at Microsoft.Data.SqlClient.SqlDataReader.InvokeAsyncCall[T](SqlDataReaderBaseAsyncCallContext`1 context)
--- End of stack trace from previous location ---
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeResultSetAsync(Int32 startCommandIndex, RelationalDataReader reader, CancellationToken cancellationToken)
ClientConnectionId:76e9411c-2de4-4282-9849-c6cd79b81e9d
Error Number:2601,State:1,Class:14
   --- End of inner exception stack trace ---
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeResultSetAsync(Int32 startCommandIndex, RelationalDataReader reader, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeAsync(RelationalDataReader reader, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Update.Internal.SqlServerModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(IList`1 entriesToSave, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(StateManager stateManager, Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Storage.Internal.SqlServerExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
Microsoft.EntityFrameworkCore.DbUpdateException: An error occurred while saving the entity changes. See the inner exception for details.
 ---> Microsoft.Data.SqlClient.SqlException (0x80131904): Cannot insert duplicate key row in object 'dbo.Customer_Devices' with unique index 'IX_Customer_Devices_NationalId_DeviceId'. The duplicate key value is (1064448614, TP1A.220624.014).
   at Microsoft.Data.SqlClient.SqlConnection.OnError(SqlException exception, Boolean breakConnection, Action`1 wrapCloseInAction)
   at Microsoft.Data.SqlClient.SqlInternalConnection.OnError(SqlException exception, Boolean breakConnection, Action`1 wrapCloseInAction)
   at Microsoft.Data.SqlClient.TdsParser.ThrowExceptionAndWarning(TdsParserStateObject stateObj, Boolean callerHasConnectionLock, Boolean asyncClose)
   at Microsoft.Data.SqlClient.TdsParser.TryRun(RunBehavior runBehavior, SqlCommand cmdHandler, SqlDataReader dataStream, BulkCopySimpleResultSet bulkCopyHandler, TdsParserStateObject stateObj, Boolean& dataReady)
   at Microsoft.Data.SqlClient.SqlDataReader.TryHasMoreRows(Boolean& moreRows)
   at Microsoft.Data.SqlClient.SqlDataReader.TryReadInternal(Boolean setTimeout, Boolean& more)
   at Microsoft.Data.SqlClient.SqlDataReader.ReadAsyncExecute(Task task, Object state)
   at Microsoft.Data.SqlClient.SqlDataReader.InvokeAsyncCall[T](SqlDataReaderBaseAsyncCallContext`1 context)
--- End of stack trace from previous location ---
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeResultSetAsync(Int32 startCommandIndex, RelationalDataReader reader, CancellationToken cancellationToken)
ClientConnectionId:76e9411c-2de4-4282-9849-c6cd79b81e9d
Error Number:2601,State:1,Class:14
   --- End of inner exception stack trace ---
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeResultSetAsync(Int32 startCommandIndex, RelationalDataReader reader, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeAsync(RelationalDataReader reader, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Update.Internal.SqlServerModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(IList`1 entriesToSave, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(StateManager stateManager, Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Storage.Internal.SqlServerExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
2025-02-02 11:49:04.226 +03:00 [ERR] Error registering device for National ID: 1064448614
Microsoft.EntityFrameworkCore.DbUpdateException: An error occurred while saving the entity changes. See the inner exception for details.
 ---> Microsoft.Data.SqlClient.SqlException (0x80131904): Cannot insert duplicate key row in object 'dbo.Customer_Devices' with unique index 'IX_Customer_Devices_NationalId_DeviceId'. The duplicate key value is (1064448614, TP1A.220624.014).
   at Microsoft.Data.SqlClient.SqlConnection.OnError(SqlException exception, Boolean breakConnection, Action`1 wrapCloseInAction)
   at Microsoft.Data.SqlClient.SqlInternalConnection.OnError(SqlException exception, Boolean breakConnection, Action`1 wrapCloseInAction)
   at Microsoft.Data.SqlClient.TdsParser.ThrowExceptionAndWarning(TdsParserStateObject stateObj, Boolean callerHasConnectionLock, Boolean asyncClose)
   at Microsoft.Data.SqlClient.TdsParser.TryRun(RunBehavior runBehavior, SqlCommand cmdHandler, SqlDataReader dataStream, BulkCopySimpleResultSet bulkCopyHandler, TdsParserStateObject stateObj, Boolean& dataReady)
   at Microsoft.Data.SqlClient.SqlDataReader.TryHasMoreRows(Boolean& moreRows)
   at Microsoft.Data.SqlClient.SqlDataReader.TryReadInternal(Boolean setTimeout, Boolean& more)
   at Microsoft.Data.SqlClient.SqlDataReader.ReadAsyncExecute(Task task, Object state)
   at Microsoft.Data.SqlClient.SqlDataReader.InvokeAsyncCall[T](SqlDataReaderBaseAsyncCallContext`1 context)
--- End of stack trace from previous location ---
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeResultSetAsync(Int32 startCommandIndex, RelationalDataReader reader, CancellationToken cancellationToken)
ClientConnectionId:76e9411c-2de4-4282-9849-c6cd79b81e9d
Error Number:2601,State:1,Class:14
   --- End of inner exception stack trace ---
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeResultSetAsync(Int32 startCommandIndex, RelationalDataReader reader, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeAsync(RelationalDataReader reader, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Update.Internal.SqlServerModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(IList`1 entriesToSave, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(StateManager stateManager, Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Storage.Internal.SqlServerExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at NayifatAPI.Controllers.DeviceController.RegisterDevice(RegisterDeviceRequest request) in C:\Users\yamta\StudioProjects\nayifat_app_2025_new\nayifatapi\Controllers\DeviceController.cs:line 78
2025-02-02 11:49:04.259 +03:00 [INF] Executed DbCommand (19ms) [Parameters=[@p0='?' (Size = 4000), @p1='?' (DbType = DateTime2), @p2='?' (Size = 4000), @p3='?' (Size = 4000), @p4='?' (Size = 4000), @p5='?' (Size = 450), @p6='?' (Size = 4000), @p7='?' (Size = 4000), @p8='?' (Size = 4000), @p9='?' (DbType = DateTime2), @p10='?' (Size = 4000), @p11='?' (Size = 4000), @p12='?' (Size = 4000), @p13='?' (Size = 450), @p14='?' (Size = 4000), @p15='?' (Size = 4000), @p16='?' (DbType = Boolean), @p17='?' (Size = 4000), @p18='?' (DbType = DateTime2), @p19='?' (Size = 450), @p20='?' (DbType = DateTime2), @p21='?' (Size = 4000), @p22='?' (Size = 4000), @p23='?' (Size = 450), @p24='?' (Size = 4000), @p25='?' (Size = 4000), @p26='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SET NOCOUNT ON;
MERGE [AuthLogs] USING (
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7, 0),
(@p8, @p9, @p10, @p11, @p12, @p13, @p14, @p15, 1)) AS i ([AuthType], [CreatedAt], [DeviceId], [FailureReason], [IpAddress], [NationalId], [Status], [UserAgent], _Position) ON 1=0
WHEN NOT MATCHED THEN
INSERT ([AuthType], [CreatedAt], [DeviceId], [FailureReason], [IpAddress], [NationalId], [Status], [UserAgent])
VALUES (i.[AuthType], i.[CreatedAt], i.[DeviceId], i.[FailureReason], i.[IpAddress], i.[NationalId], i.[Status], i.[UserAgent])
OUTPUT INSERTED.[Id], i._Position;
INSERT INTO [Customer_Devices] ([BiometricEnabled], [BiometricToken], [CreatedAt], [DeviceId], [LastUsedAt], [Manufacturer], [Model], [NationalId], [OsVersion], [Platform], [Status])
OUTPUT INSERTED.[Id]
VALUES (@p16, @p17, @p18, @p19, @p20, @p21, @p22, @p23, @p24, @p25, @p26);
2025-02-02 11:49:04.263 +03:00 [ERR] An exception occurred in the database while saving changes for context type 'NayifatAPI.Data.ApplicationDbContext'.
Microsoft.EntityFrameworkCore.DbUpdateException: An error occurred while saving the entity changes. See the inner exception for details.
 ---> Microsoft.Data.SqlClient.SqlException (0x80131904): Cannot insert duplicate key row in object 'dbo.Customer_Devices' with unique index 'IX_Customer_Devices_NationalId_DeviceId'. The duplicate key value is (1064448614, TP1A.220624.014).
   at Microsoft.Data.SqlClient.SqlConnection.OnError(SqlException exception, Boolean breakConnection, Action`1 wrapCloseInAction)
   at Microsoft.Data.SqlClient.SqlInternalConnection.OnError(SqlException exception, Boolean breakConnection, Action`1 wrapCloseInAction)
   at Microsoft.Data.SqlClient.TdsParser.ThrowExceptionAndWarning(TdsParserStateObject stateObj, Boolean callerHasConnectionLock, Boolean asyncClose)
   at Microsoft.Data.SqlClient.TdsParser.TryRun(RunBehavior runBehavior, SqlCommand cmdHandler, SqlDataReader dataStream, BulkCopySimpleResultSet bulkCopyHandler, TdsParserStateObject stateObj, Boolean& dataReady)
   at Microsoft.Data.SqlClient.SqlDataReader.TryHasMoreRows(Boolean& moreRows)
   at Microsoft.Data.SqlClient.SqlDataReader.TryReadInternal(Boolean setTimeout, Boolean& more)
   at Microsoft.Data.SqlClient.SqlDataReader.ReadAsyncExecute(Task task, Object state)
   at Microsoft.Data.SqlClient.SqlDataReader.InvokeAsyncCall[T](SqlDataReaderBaseAsyncCallContext`1 context)
--- End of stack trace from previous location ---
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeResultSetAsync(Int32 startCommandIndex, RelationalDataReader reader, CancellationToken cancellationToken)
ClientConnectionId:76e9411c-2de4-4282-9849-c6cd79b81e9d
Error Number:2601,State:1,Class:14
   --- End of inner exception stack trace ---
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeResultSetAsync(Int32 startCommandIndex, RelationalDataReader reader, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeAsync(RelationalDataReader reader, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Update.Internal.SqlServerModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(IList`1 entriesToSave, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(StateManager stateManager, Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Storage.Internal.SqlServerExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
Microsoft.EntityFrameworkCore.DbUpdateException: An error occurred while saving the entity changes. See the inner exception for details.
 ---> Microsoft.Data.SqlClient.SqlException (0x80131904): Cannot insert duplicate key row in object 'dbo.Customer_Devices' with unique index 'IX_Customer_Devices_NationalId_DeviceId'. The duplicate key value is (1064448614, TP1A.220624.014).
   at Microsoft.Data.SqlClient.SqlConnection.OnError(SqlException exception, Boolean breakConnection, Action`1 wrapCloseInAction)
   at Microsoft.Data.SqlClient.SqlInternalConnection.OnError(SqlException exception, Boolean breakConnection, Action`1 wrapCloseInAction)
   at Microsoft.Data.SqlClient.TdsParser.ThrowExceptionAndWarning(TdsParserStateObject stateObj, Boolean callerHasConnectionLock, Boolean asyncClose)
   at Microsoft.Data.SqlClient.TdsParser.TryRun(RunBehavior runBehavior, SqlCommand cmdHandler, SqlDataReader dataStream, BulkCopySimpleResultSet bulkCopyHandler, TdsParserStateObject stateObj, Boolean& dataReady)
   at Microsoft.Data.SqlClient.SqlDataReader.TryHasMoreRows(Boolean& moreRows)
   at Microsoft.Data.SqlClient.SqlDataReader.TryReadInternal(Boolean setTimeout, Boolean& more)
   at Microsoft.Data.SqlClient.SqlDataReader.ReadAsyncExecute(Task task, Object state)
   at Microsoft.Data.SqlClient.SqlDataReader.InvokeAsyncCall[T](SqlDataReaderBaseAsyncCallContext`1 context)
--- End of stack trace from previous location ---
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeResultSetAsync(Int32 startCommandIndex, RelationalDataReader reader, CancellationToken cancellationToken)
ClientConnectionId:76e9411c-2de4-4282-9849-c6cd79b81e9d
Error Number:2601,State:1,Class:14
   --- End of inner exception stack trace ---
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeResultSetAsync(Int32 startCommandIndex, RelationalDataReader reader, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeAsync(RelationalDataReader reader, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Update.Internal.SqlServerModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(IList`1 entriesToSave, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(StateManager stateManager, Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Storage.Internal.SqlServerExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
2025-02-02 11:49:04.273 +03:00 [INF] Executed action NayifatAPI.Controllers.DeviceController.RegisterDevice (NayifatAPI) in 273.9877ms
2025-02-02 11:49:04.274 +03:00 [INF] Executed endpoint 'NayifatAPI.Controllers.DeviceController.RegisterDevice (NayifatAPI)'
2025-02-02 11:49:04.275 +03:00 [ERR] Unhandled exception
Microsoft.EntityFrameworkCore.DbUpdateException: An error occurred while saving the entity changes. See the inner exception for details.
 ---> Microsoft.Data.SqlClient.SqlException (0x80131904): Cannot insert duplicate key row in object 'dbo.Customer_Devices' with unique index 'IX_Customer_Devices_NationalId_DeviceId'. The duplicate key value is (1064448614, TP1A.220624.014).
   at Microsoft.Data.SqlClient.SqlConnection.OnError(SqlException exception, Boolean breakConnection, Action`1 wrapCloseInAction)
   at Microsoft.Data.SqlClient.SqlInternalConnection.OnError(SqlException exception, Boolean breakConnection, Action`1 wrapCloseInAction)
   at Microsoft.Data.SqlClient.TdsParser.ThrowExceptionAndWarning(TdsParserStateObject stateObj, Boolean callerHasConnectionLock, Boolean asyncClose)
   at Microsoft.Data.SqlClient.TdsParser.TryRun(RunBehavior runBehavior, SqlCommand cmdHandler, SqlDataReader dataStream, BulkCopySimpleResultSet bulkCopyHandler, TdsParserStateObject stateObj, Boolean& dataReady)
   at Microsoft.Data.SqlClient.SqlDataReader.TryHasMoreRows(Boolean& moreRows)
   at Microsoft.Data.SqlClient.SqlDataReader.TryReadInternal(Boolean setTimeout, Boolean& more)
   at Microsoft.Data.SqlClient.SqlDataReader.ReadAsyncExecute(Task task, Object state)
   at Microsoft.Data.SqlClient.SqlDataReader.InvokeAsyncCall[T](SqlDataReaderBaseAsyncCallContext`1 context)
--- End of stack trace from previous location ---
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeResultSetAsync(Int32 startCommandIndex, RelationalDataReader reader, CancellationToken cancellationToken)
ClientConnectionId:76e9411c-2de4-4282-9849-c6cd79b81e9d
Error Number:2601,State:1,Class:14
   --- End of inner exception stack trace ---
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeResultSetAsync(Int32 startCommandIndex, RelationalDataReader reader, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeAsync(RelationalDataReader reader, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Update.Internal.SqlServerModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(IList`1 entriesToSave, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(StateManager stateManager, Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Storage.Internal.SqlServerExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at NayifatAPI.Controllers.DeviceController.RegisterDevice(RegisterDeviceRequest request) in C:\Users\yamta\StudioProjects\nayifat_app_2025_new\nayifatapi\Controllers\DeviceController.cs:line 105
   at Microsoft.AspNetCore.Mvc.Infrastructure.ActionMethodExecutor.TaskOfIActionResultExecutor.Execute(ActionContext actionContext, IActionResultTypeMapper mapper, ObjectMethodExecutor executor, Object controller, Object[] arguments)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.<InvokeActionMethodAsync>g__Awaited|12_0(ControllerActionInvoker invoker, ValueTask`1 actionResultValueTask)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.<InvokeNextActionFilterAsync>g__Awaited|10_0(ControllerActionInvoker invoker, Task lastTask, State next, Scope scope, Object state, Boolean isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.Rethrow(ActionExecutedContextSealed context)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.Next(State& next, Scope& scope, Object& state, Boolean& isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.<InvokeInnerFilterAsync>g__Awaited|13_0(ControllerActionInvoker invoker, Task lastTask, State next, Scope scope, Object state, Boolean isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeFilterPipelineAsync>g__Awaited|20_0(ResourceInvoker invoker, Task lastTask, State next, Scope scope, Object state, Boolean isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeAsync>g__Logged|17_1(ResourceInvoker invoker)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeAsync>g__Logged|17_1(ResourceInvoker invoker)
   at Microsoft.AspNetCore.Routing.EndpointMiddleware.<Invoke>g__AwaitRequestTask|7_0(Endpoint endpoint, Task requestTask, ILogger logger)
   at Microsoft.AspNetCore.Authorization.AuthorizationMiddleware.Invoke(HttpContext context)
   at Program.<>c.<<<Main>$>b__0_3>d.MoveNext() in C:\Users\yamta\StudioProjects\nayifat_app_2025_new\nayifatapi\Program.cs:line 85
2025-02-02 11:49:04.290 +03:00 [ERR] An unhandled exception has occurred while executing the request.
Microsoft.EntityFrameworkCore.DbUpdateException: An error occurred while saving the entity changes. See the inner exception for details.
 ---> Microsoft.Data.SqlClient.SqlException (0x80131904): Cannot insert duplicate key row in object 'dbo.Customer_Devices' with unique index 'IX_Customer_Devices_NationalId_DeviceId'. The duplicate key value is (1064448614, TP1A.220624.014).
   at Microsoft.Data.SqlClient.SqlConnection.OnError(SqlException exception, Boolean breakConnection, Action`1 wrapCloseInAction)
   at Microsoft.Data.SqlClient.SqlInternalConnection.OnError(SqlException exception, Boolean breakConnection, Action`1 wrapCloseInAction)
   at Microsoft.Data.SqlClient.TdsParser.ThrowExceptionAndWarning(TdsParserStateObject stateObj, Boolean callerHasConnectionLock, Boolean asyncClose)
   at Microsoft.Data.SqlClient.TdsParser.TryRun(RunBehavior runBehavior, SqlCommand cmdHandler, SqlDataReader dataStream, BulkCopySimpleResultSet bulkCopyHandler, TdsParserStateObject stateObj, Boolean& dataReady)
   at Microsoft.Data.SqlClient.SqlDataReader.TryHasMoreRows(Boolean& moreRows)
   at Microsoft.Data.SqlClient.SqlDataReader.TryReadInternal(Boolean setTimeout, Boolean& more)
   at Microsoft.Data.SqlClient.SqlDataReader.ReadAsyncExecute(Task task, Object state)
   at Microsoft.Data.SqlClient.SqlDataReader.InvokeAsyncCall[T](SqlDataReaderBaseAsyncCallContext`1 context)
--- End of stack trace from previous location ---
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeResultSetAsync(Int32 startCommandIndex, RelationalDataReader reader, CancellationToken cancellationToken)
ClientConnectionId:76e9411c-2de4-4282-9849-c6cd79b81e9d
Error Number:2601,State:1,Class:14
   --- End of inner exception stack trace ---
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeResultSetAsync(Int32 startCommandIndex, RelationalDataReader reader, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeAsync(RelationalDataReader reader, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Update.Internal.SqlServerModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(IList`1 entriesToSave, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(StateManager stateManager, Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Storage.Internal.SqlServerExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at NayifatAPI.Controllers.DeviceController.RegisterDevice(RegisterDeviceRequest request) in C:\Users\yamta\StudioProjects\nayifat_app_2025_new\nayifatapi\Controllers\DeviceController.cs:line 105
   at Microsoft.AspNetCore.Mvc.Infrastructure.ActionMethodExecutor.TaskOfIActionResultExecutor.Execute(ActionContext actionContext, IActionResultTypeMapper mapper, ObjectMethodExecutor executor, Object controller, Object[] arguments)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.<InvokeActionMethodAsync>g__Awaited|12_0(ControllerActionInvoker invoker, ValueTask`1 actionResultValueTask)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.<InvokeNextActionFilterAsync>g__Awaited|10_0(ControllerActionInvoker invoker, Task lastTask, State next, Scope scope, Object state, Boolean isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.Rethrow(ActionExecutedContextSealed context)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.Next(State& next, Scope& scope, Object& state, Boolean& isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.<InvokeInnerFilterAsync>g__Awaited|13_0(ControllerActionInvoker invoker, Task lastTask, State next, Scope scope, Object state, Boolean isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeFilterPipelineAsync>g__Awaited|20_0(ResourceInvoker invoker, Task lastTask, State next, Scope scope, Object state, Boolean isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeAsync>g__Logged|17_1(ResourceInvoker invoker)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeAsync>g__Logged|17_1(ResourceInvoker invoker)
   at Microsoft.AspNetCore.Routing.EndpointMiddleware.<Invoke>g__AwaitRequestTask|7_0(Endpoint endpoint, Task requestTask, ILogger logger)
   at Microsoft.AspNetCore.Authorization.AuthorizationMiddleware.Invoke(HttpContext context)
   at Program.<>c.<<<Main>$>b__0_3>d.MoveNext() in C:\Users\yamta\StudioProjects\nayifat_app_2025_new\nayifatapi\Program.cs:line 85
--- End of stack trace from previous location ---
   at Swashbuckle.AspNetCore.SwaggerUI.SwaggerUIMiddleware.Invoke(HttpContext httpContext)
   at Swashbuckle.AspNetCore.Swagger.SwaggerMiddleware.Invoke(HttpContext httpContext, ISwaggerProvider swaggerProvider)
   at Microsoft.AspNetCore.Authentication.AuthenticationMiddleware.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Diagnostics.DeveloperExceptionPageMiddlewareImpl.Invoke(HttpContext context)
2025-02-02 11:49:04.310 +03:00 [INF] Request finished HTTP/1.1 POST http://07ca-46-152-255-232.ngrok-free.app/api/device - 500 null text/plain; charset=utf-8 315.4509ms
2025-02-02 11:52:24.841 +03:00 [INF] Request starting HTTP/1.1 POST http://07ca-46-152-255-232.ngrok-free.app/api/notifications/list - application/json; charset=utf-8 47
2025-02-02 11:52:24.847 +03:00 [INF] Executing endpoint 'NayifatAPI.Controllers.NotificationsController.GetNotifications (NayifatAPI)'
2025-02-02 11:52:24.847 +03:00 [INF] Route matched with {action = "GetNotifications", controller = "Notifications"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetNotifications(NayifatAPI.Controllers.GetNotificationsRequest) on controller NayifatAPI.Controllers.NotificationsController (NayifatAPI).
2025-02-02 11:52:24.852 +03:00 [INF] Executed DbCommand (2ms) [Parameters=[@__providedApiKey_0='?' (Size = 255)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [a].[Key], [a].[CreatedAt], [a].[Description], [a].[ExpiresAt], [a].[IsActive], [a].[LastUsedAt]
FROM [ApiKeys] AS [a]
WHERE [a].[Key] = @__providedApiKey_0 AND [a].[IsActive] = CAST(1 AS bit)
2025-02-02 11:52:24.855 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@__request_NationalId_0='?' (Size = 450)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [u].[national_id], [u].[last_updated], [u].[notifications]
FROM [user_notifications] AS [u]
WHERE [u].[national_id] = @__request_NationalId_0
2025-02-02 11:52:24.859 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@__Parse_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [n].[Id], [n].[additional_data], [n].[Body], [n].[body_ar], [n].[body_en], [n].[created_at], [n].[expiry_at], [n].[Route], [n].[target_criteria], [n].[Title], [n].[title_ar], [n].[title_en]
FROM [notification_templates] AS [n]
WHERE [n].[Id] = @__Parse_0
2025-02-02 11:52:24.861 +03:00 [INF] Executed DbCommand (0ms) [Parameters=[@__Parse_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [n].[Id], [n].[additional_data], [n].[Body], [n].[body_ar], [n].[body_en], [n].[created_at], [n].[expiry_at], [n].[Route], [n].[target_criteria], [n].[Title], [n].[title_ar], [n].[title_en]
FROM [notification_templates] AS [n]
WHERE [n].[Id] = @__Parse_0
2025-02-02 11:52:24.941 +03:00 [INF] Executed DbCommand (78ms) [Parameters=[@p0='?' (Size = 4000), @p1='?' (DbType = DateTime2), @p2='?' (Size = 4000), @p3='?' (Size = 4000), @p4='?' (Size = 4000), @p5='?' (Size = 450), @p6='?' (Size = 4000), @p7='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SET IMPLICIT_TRANSACTIONS OFF;
SET NOCOUNT ON;
INSERT INTO [AuthLogs] ([AuthType], [CreatedAt], [DeviceId], [FailureReason], [IpAddress], [NationalId], [Status], [UserAgent])
OUTPUT INSERTED.[Id]
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7);
2025-02-02 11:52:24.943 +03:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType9`2[[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Object, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-02-02 11:52:24.944 +03:00 [INF] Executed action NayifatAPI.Controllers.NotificationsController.GetNotifications (NayifatAPI) in 95.7584ms
2025-02-02 11:52:24.946 +03:00 [INF] Executed endpoint 'NayifatAPI.Controllers.NotificationsController.GetNotifications (NayifatAPI)'
2025-02-02 11:52:24.947 +03:00 [INF] Request finished HTTP/1.1 POST http://07ca-46-152-255-232.ngrok-free.app/api/notifications/list - 200 null application/json; charset=utf-8 105.9588ms
2025-02-02 11:57:25.994 +03:00 [INF] Request starting HTTP/1.1 POST http://07ca-46-152-255-232.ngrok-free.app/api/notifications/list - application/json; charset=utf-8 47
2025-02-02 11:57:26.056 +03:00 [INF] Executing endpoint 'NayifatAPI.Controllers.NotificationsController.GetNotifications (NayifatAPI)'
2025-02-02 11:57:26.058 +03:00 [INF] Route matched with {action = "GetNotifications", controller = "Notifications"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetNotifications(NayifatAPI.Controllers.GetNotificationsRequest) on controller NayifatAPI.Controllers.NotificationsController (NayifatAPI).
2025-02-02 11:57:26.125 +03:00 [INF] Executed DbCommand (8ms) [Parameters=[@__providedApiKey_0='?' (Size = 255)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [a].[Key], [a].[CreatedAt], [a].[Description], [a].[ExpiresAt], [a].[IsActive], [a].[LastUsedAt]
FROM [ApiKeys] AS [a]
WHERE [a].[Key] = @__providedApiKey_0 AND [a].[IsActive] = CAST(1 AS bit)
2025-02-02 11:57:26.132 +03:00 [INF] Executed DbCommand (3ms) [Parameters=[@__request_NationalId_0='?' (Size = 450)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [u].[national_id], [u].[last_updated], [u].[notifications]
FROM [user_notifications] AS [u]
WHERE [u].[national_id] = @__request_NationalId_0
2025-02-02 11:57:26.138 +03:00 [INF] Executed DbCommand (3ms) [Parameters=[@__Parse_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [n].[Id], [n].[additional_data], [n].[Body], [n].[body_ar], [n].[body_en], [n].[created_at], [n].[expiry_at], [n].[Route], [n].[target_criteria], [n].[Title], [n].[title_ar], [n].[title_en]
FROM [notification_templates] AS [n]
WHERE [n].[Id] = @__Parse_0
2025-02-02 11:57:26.144 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@__Parse_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [n].[Id], [n].[additional_data], [n].[Body], [n].[body_ar], [n].[body_en], [n].[created_at], [n].[expiry_at], [n].[Route], [n].[target_criteria], [n].[Title], [n].[title_ar], [n].[title_en]
FROM [notification_templates] AS [n]
WHERE [n].[Id] = @__Parse_0
2025-02-02 11:57:26.227 +03:00 [INF] Executed DbCommand (79ms) [Parameters=[@p0='?' (Size = 4000), @p1='?' (DbType = DateTime2), @p2='?' (Size = 4000), @p3='?' (Size = 4000), @p4='?' (Size = 4000), @p5='?' (Size = 450), @p6='?' (Size = 4000), @p7='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SET IMPLICIT_TRANSACTIONS OFF;
SET NOCOUNT ON;
INSERT INTO [AuthLogs] ([AuthType], [CreatedAt], [DeviceId], [FailureReason], [IpAddress], [NationalId], [Status], [UserAgent])
OUTPUT INSERTED.[Id]
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7);
2025-02-02 11:57:26.231 +03:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType9`2[[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Object, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-02-02 11:57:26.232 +03:00 [INF] Executed action NayifatAPI.Controllers.NotificationsController.GetNotifications (NayifatAPI) in 170.8585ms
2025-02-02 11:57:26.235 +03:00 [INF] Executed endpoint 'NayifatAPI.Controllers.NotificationsController.GetNotifications (NayifatAPI)'
2025-02-02 11:57:26.237 +03:00 [INF] Request finished HTTP/1.1 POST http://07ca-46-152-255-232.ngrok-free.app/api/notifications/list - 200 null application/json; charset=utf-8 243.2087ms
2025-02-02 11:59:06.174 +03:00 [INF] Request starting HTTP/1.1 POST http://07ca-46-152-255-232.ngrok-free.app/api/auth/signin - application/json; charset=utf-8 224
2025-02-02 11:59:06.176 +03:00 [INF] Executing endpoint 'NayifatAPI.Controllers.AuthController.SignIn (NayifatAPI)'
2025-02-02 11:59:06.177 +03:00 [INF] Route matched with {action = "SignIn", controller = "Auth"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] SignIn(NayifatAPI.Controllers.SignInRequest) on controller NayifatAPI.Controllers.AuthController (NayifatAPI).
2025-02-02 11:59:06.181 +03:00 [INF] Executed DbCommand (2ms) [Parameters=[@__providedApiKey_0='?' (Size = 255)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [a].[Key], [a].[CreatedAt], [a].[Description], [a].[ExpiresAt], [a].[IsActive], [a].[LastUsedAt]
FROM [ApiKeys] AS [a]
WHERE [a].[Key] = @__providedApiKey_0 AND [a].[IsActive] = CAST(1 AS bit)
2025-02-02 11:59:06.186 +03:00 [INF] Executed DbCommand (3ms) [Parameters=[@__request_NationalId_0='?' (Size = 450)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [c].[NationalId], [c].[AddNo], [c].[BuildingNo], [c].[City], [c].[Consent], [c].[ConsentDate], [c].[DateOfBirth], [c].[Dependents], [c].[District], [c].[Email], [c].[Employer], [c].[FamilyNameAr], [c].[FamilyNameEn], [c].[FirstNameAr], [c].[FirstNameEn], [c].[Iban], [c].[IdExpiryDate], [c].[Los], [c].[Mpin], [c].[MpinEnabled], [c].[NafathStatus], [c].[NafathTimestamp], [c].[Password], [c].[Phone], [c].[RegistrationDate], [c].[SalaryCustomer], [c].[SalaryDakhli], [c].[SecondNameAr], [c].[SecondNameEn], [c].[Sector], [c].[Street], [c].[ThirdNameAr], [c].[ThirdNameEn], [c].[Zipcode]
FROM [Customers] AS [c]
WHERE [c].[NationalId] = @__request_NationalId_0
2025-02-02 11:59:06.188 +03:00 [INF] Starting password verification for NationalId: 1064448614
2025-02-02 11:59:06.373 +03:00 [INF] Password verification result for NationalId 1064448614: Success
2025-02-02 11:59:06.452 +03:00 [INF] Executed DbCommand (78ms) [Parameters=[@__request_NationalId_0='?' (Size = 450), @__request_DeviceId_1='?' (Size = 450)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [c].[Id], [c].[BiometricEnabled], [c].[BiometricToken], [c].[CreatedAt], [c].[DeviceId], [c].[LastUsedAt], [c].[Manufacturer], [c].[Model], [c].[NationalId], [c].[OsVersion], [c].[Platform], [c].[Status]
FROM [Customer_Devices] AS [c]
WHERE [c].[NationalId] = @__request_NationalId_0 AND [c].[DeviceId] = @__request_DeviceId_1 AND [c].[Status] = N'active'
2025-02-02 11:59:06.458 +03:00 [INF] Executed DbCommand (3ms) [Parameters=[@p0='?' (Size = 4000), @p1='?' (DbType = DateTime2), @p2='?' (Size = 4000), @p3='?' (Size = 4000), @p4='?' (Size = 4000), @p5='?' (Size = 450), @p6='?' (Size = 4000), @p7='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SET IMPLICIT_TRANSACTIONS OFF;
SET NOCOUNT ON;
INSERT INTO [AuthLogs] ([AuthType], [CreatedAt], [DeviceId], [FailureReason], [IpAddress], [NationalId], [Status], [UserAgent])
OUTPUT INSERTED.[Id]
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7);
2025-02-02 11:59:06.461 +03:00 [INF] Executing ObjectResult, writing value of type '<>f__AnonymousType12`3[[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Object, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-02-02 11:59:06.463 +03:00 [INF] Executed action NayifatAPI.Controllers.AuthController.SignIn (NayifatAPI) in 285.5388ms
2025-02-02 11:59:06.464 +03:00 [INF] Executed endpoint 'NayifatAPI.Controllers.AuthController.SignIn (NayifatAPI)'
2025-02-02 11:59:06.466 +03:00 [INF] Request finished HTTP/1.1 POST http://07ca-46-152-255-232.ngrok-free.app/api/auth/signin - 401 null application/json; charset=utf-8 292.0724ms
2025-02-02 11:59:26.360 +03:00 [INF] Request starting HTTP/1.1 POST http://07ca-46-152-255-232.ngrok-free.app/api/auth/signin - application/json; charset=utf-8 224
2025-02-02 11:59:26.363 +03:00 [INF] Executing endpoint 'NayifatAPI.Controllers.AuthController.SignIn (NayifatAPI)'
2025-02-02 11:59:26.365 +03:00 [INF] Route matched with {action = "SignIn", controller = "Auth"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] SignIn(NayifatAPI.Controllers.SignInRequest) on controller NayifatAPI.Controllers.AuthController (NayifatAPI).
2025-02-02 11:59:26.367 +03:00 [INF] Executed DbCommand (0ms) [Parameters=[@__providedApiKey_0='?' (Size = 255)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [a].[Key], [a].[CreatedAt], [a].[Description], [a].[ExpiresAt], [a].[IsActive], [a].[LastUsedAt]
FROM [ApiKeys] AS [a]
WHERE [a].[Key] = @__providedApiKey_0 AND [a].[IsActive] = CAST(1 AS bit)
2025-02-02 11:59:26.370 +03:00 [INF] Executed DbCommand (0ms) [Parameters=[@__request_NationalId_0='?' (Size = 450)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [c].[NationalId], [c].[AddNo], [c].[BuildingNo], [c].[City], [c].[Consent], [c].[ConsentDate], [c].[DateOfBirth], [c].[Dependents], [c].[District], [c].[Email], [c].[Employer], [c].[FamilyNameAr], [c].[FamilyNameEn], [c].[FirstNameAr], [c].[FirstNameEn], [c].[Iban], [c].[IdExpiryDate], [c].[Los], [c].[Mpin], [c].[MpinEnabled], [c].[NafathStatus], [c].[NafathTimestamp], [c].[Password], [c].[Phone], [c].[RegistrationDate], [c].[SalaryCustomer], [c].[SalaryDakhli], [c].[SecondNameAr], [c].[SecondNameEn], [c].[Sector], [c].[Street], [c].[ThirdNameAr], [c].[ThirdNameEn], [c].[Zipcode]
FROM [Customers] AS [c]
WHERE [c].[NationalId] = @__request_NationalId_0
2025-02-02 11:59:26.372 +03:00 [INF] Starting password verification for NationalId: 1064448614
2025-02-02 11:59:26.549 +03:00 [INF] Password verification result for NationalId 1064448614: Success
2025-02-02 11:59:26.551 +03:00 [INF] Executed DbCommand (0ms) [Parameters=[@__request_NationalId_0='?' (Size = 450), @__request_DeviceId_1='?' (Size = 450)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [c].[Id], [c].[BiometricEnabled], [c].[BiometricToken], [c].[CreatedAt], [c].[DeviceId], [c].[LastUsedAt], [c].[Manufacturer], [c].[Model], [c].[NationalId], [c].[OsVersion], [c].[Platform], [c].[Status]
FROM [Customer_Devices] AS [c]
WHERE [c].[NationalId] = @__request_NationalId_0 AND [c].[DeviceId] = @__request_DeviceId_1 AND [c].[Status] = N'active'
2025-02-02 11:59:26.627 +03:00 [INF] Executed DbCommand (73ms) [Parameters=[@p0='?' (Size = 4000), @p1='?' (DbType = DateTime2), @p2='?' (Size = 4000), @p3='?' (Size = 4000), @p4='?' (Size = 4000), @p5='?' (Size = 450), @p6='?' (Size = 4000), @p7='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SET IMPLICIT_TRANSACTIONS OFF;
SET NOCOUNT ON;
INSERT INTO [AuthLogs] ([AuthType], [CreatedAt], [DeviceId], [FailureReason], [IpAddress], [NationalId], [Status], [UserAgent])
OUTPUT INSERTED.[Id]
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7);
2025-02-02 11:59:26.630 +03:00 [INF] Executing ObjectResult, writing value of type '<>f__AnonymousType12`3[[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Object, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-02-02 11:59:26.631 +03:00 [INF] Executed action NayifatAPI.Controllers.AuthController.SignIn (NayifatAPI) in 264.4908ms
2025-02-02 11:59:26.631 +03:00 [INF] Executed endpoint 'NayifatAPI.Controllers.AuthController.SignIn (NayifatAPI)'
2025-02-02 11:59:26.632 +03:00 [INF] Request finished HTTP/1.1 POST http://07ca-46-152-255-232.ngrok-free.app/api/auth/signin - 401 null application/json; charset=utf-8 271.7421ms
2025-02-02 12:01:44.452 +03:00 [INF] Request starting HTTP/1.1 POST http://07ca-46-152-255-232.ngrok-free.app/api/auth/signin - application/json; charset=utf-8 224
2025-02-02 12:01:44.454 +03:00 [INF] Executing endpoint 'NayifatAPI.Controllers.AuthController.SignIn (NayifatAPI)'
2025-02-02 12:01:44.455 +03:00 [INF] Route matched with {action = "SignIn", controller = "Auth"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] SignIn(NayifatAPI.Controllers.SignInRequest) on controller NayifatAPI.Controllers.AuthController (NayifatAPI).
2025-02-02 12:01:44.465 +03:00 [INF] Executed DbCommand (8ms) [Parameters=[@__providedApiKey_0='?' (Size = 255)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [a].[Key], [a].[CreatedAt], [a].[Description], [a].[ExpiresAt], [a].[IsActive], [a].[LastUsedAt]
FROM [ApiKeys] AS [a]
WHERE [a].[Key] = @__providedApiKey_0 AND [a].[IsActive] = CAST(1 AS bit)
2025-02-02 12:01:44.469 +03:00 [INF] Executed DbCommand (2ms) [Parameters=[@__request_NationalId_0='?' (Size = 450)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [c].[NationalId], [c].[AddNo], [c].[BuildingNo], [c].[City], [c].[Consent], [c].[ConsentDate], [c].[DateOfBirth], [c].[Dependents], [c].[District], [c].[Email], [c].[Employer], [c].[FamilyNameAr], [c].[FamilyNameEn], [c].[FirstNameAr], [c].[FirstNameEn], [c].[Iban], [c].[IdExpiryDate], [c].[Los], [c].[Mpin], [c].[MpinEnabled], [c].[NafathStatus], [c].[NafathTimestamp], [c].[Password], [c].[Phone], [c].[RegistrationDate], [c].[SalaryCustomer], [c].[SalaryDakhli], [c].[SecondNameAr], [c].[SecondNameEn], [c].[Sector], [c].[Street], [c].[ThirdNameAr], [c].[ThirdNameEn], [c].[Zipcode]
FROM [Customers] AS [c]
WHERE [c].[NationalId] = @__request_NationalId_0
2025-02-02 12:01:44.471 +03:00 [INF] Starting password verification for NationalId: 1064448614
2025-02-02 12:01:44.643 +03:00 [INF] Password verification result for NationalId 1064448614: Success
2025-02-02 12:01:44.646 +03:00 [INF] Executed DbCommand (2ms) [Parameters=[@__request_NationalId_0='?' (Size = 450), @__request_DeviceId_1='?' (Size = 450)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [c].[Id], [c].[BiometricEnabled], [c].[BiometricToken], [c].[CreatedAt], [c].[DeviceId], [c].[LastUsedAt], [c].[Manufacturer], [c].[Model], [c].[NationalId], [c].[OsVersion], [c].[Platform], [c].[Status]
FROM [Customer_Devices] AS [c]
WHERE [c].[NationalId] = @__request_NationalId_0 AND [c].[DeviceId] = @__request_DeviceId_1 AND [c].[Status] = N'active'
2025-02-02 12:01:44.656 +03:00 [INF] Executed DbCommand (7ms) [Parameters=[@p0='?' (Size = 4000), @p1='?' (DbType = DateTime2), @p2='?' (Size = 4000), @p3='?' (Size = 4000), @p4='?' (Size = 4000), @p5='?' (Size = 450), @p6='?' (Size = 4000), @p7='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SET IMPLICIT_TRANSACTIONS OFF;
SET NOCOUNT ON;
INSERT INTO [AuthLogs] ([AuthType], [CreatedAt], [DeviceId], [FailureReason], [IpAddress], [NationalId], [Status], [UserAgent])
OUTPUT INSERTED.[Id]
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7);
2025-02-02 12:01:44.658 +03:00 [INF] Executing ObjectResult, writing value of type '<>f__AnonymousType12`3[[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Object, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-02-02 12:01:44.659 +03:00 [INF] Executed action NayifatAPI.Controllers.AuthController.SignIn (NayifatAPI) in 201.9632ms
2025-02-02 12:01:44.659 +03:00 [INF] Executed endpoint 'NayifatAPI.Controllers.AuthController.SignIn (NayifatAPI)'
2025-02-02 12:01:44.662 +03:00 [INF] Request finished HTTP/1.1 POST http://07ca-46-152-255-232.ngrok-free.app/api/auth/signin - 401 null application/json; charset=utf-8 209.8259ms
2025-02-02 12:03:56.252 +03:00 [INF] Request starting HTTP/1.1 POST http://07ca-46-152-255-232.ngrok-free.app/api/auth/signin - application/json; charset=utf-8 224
2025-02-02 12:03:56.257 +03:00 [INF] Executing endpoint 'NayifatAPI.Controllers.AuthController.SignIn (NayifatAPI)'
2025-02-02 12:03:56.258 +03:00 [INF] Route matched with {action = "SignIn", controller = "Auth"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] SignIn(NayifatAPI.Controllers.SignInRequest) on controller NayifatAPI.Controllers.AuthController (NayifatAPI).
2025-02-02 12:03:56.264 +03:00 [INF] Executed DbCommand (3ms) [Parameters=[@__providedApiKey_0='?' (Size = 255)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [a].[Key], [a].[CreatedAt], [a].[Description], [a].[ExpiresAt], [a].[IsActive], [a].[LastUsedAt]
FROM [ApiKeys] AS [a]
WHERE [a].[Key] = @__providedApiKey_0 AND [a].[IsActive] = CAST(1 AS bit)
2025-02-02 12:03:56.269 +03:00 [INF] Executed DbCommand (3ms) [Parameters=[@__request_NationalId_0='?' (Size = 450)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [c].[NationalId], [c].[AddNo], [c].[BuildingNo], [c].[City], [c].[Consent], [c].[ConsentDate], [c].[DateOfBirth], [c].[Dependents], [c].[District], [c].[Email], [c].[Employer], [c].[FamilyNameAr], [c].[FamilyNameEn], [c].[FirstNameAr], [c].[FirstNameEn], [c].[Iban], [c].[IdExpiryDate], [c].[Los], [c].[Mpin], [c].[MpinEnabled], [c].[NafathStatus], [c].[NafathTimestamp], [c].[Password], [c].[Phone], [c].[RegistrationDate], [c].[SalaryCustomer], [c].[SalaryDakhli], [c].[SecondNameAr], [c].[SecondNameEn], [c].[Sector], [c].[Street], [c].[ThirdNameAr], [c].[ThirdNameEn], [c].[Zipcode]
FROM [Customers] AS [c]
WHERE [c].[NationalId] = @__request_NationalId_0
2025-02-02 12:03:56.271 +03:00 [INF] Starting password verification for NationalId: 1064448614
2025-02-02 12:03:56.437 +03:00 [INF] Password verification result for NationalId 1064448614: Success
2025-02-02 12:03:56.439 +03:00 [INF] Executed DbCommand (2ms) [Parameters=[@__request_NationalId_0='?' (Size = 450), @__request_DeviceId_1='?' (Size = 450)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [c].[Id], [c].[BiometricEnabled], [c].[BiometricToken], [c].[CreatedAt], [c].[DeviceId], [c].[LastUsedAt], [c].[Manufacturer], [c].[Model], [c].[NationalId], [c].[OsVersion], [c].[Platform], [c].[Status]
FROM [Customer_Devices] AS [c]
WHERE [c].[NationalId] = @__request_NationalId_0 AND [c].[DeviceId] = @__request_DeviceId_1 AND [c].[Status] = N'active'
2025-02-02 12:03:56.516 +03:00 [INF] Executed DbCommand (75ms) [Parameters=[@p0='?' (Size = 4000), @p1='?' (DbType = DateTime2), @p2='?' (Size = 4000), @p3='?' (Size = 4000), @p4='?' (Size = 4000), @p5='?' (Size = 450), @p6='?' (Size = 4000), @p7='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SET IMPLICIT_TRANSACTIONS OFF;
SET NOCOUNT ON;
INSERT INTO [AuthLogs] ([AuthType], [CreatedAt], [DeviceId], [FailureReason], [IpAddress], [NationalId], [Status], [UserAgent])
OUTPUT INSERTED.[Id]
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7);
2025-02-02 12:03:56.518 +03:00 [INF] Executing ObjectResult, writing value of type '<>f__AnonymousType12`3[[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Object, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-02-02 12:03:56.519 +03:00 [INF] Executed action NayifatAPI.Controllers.AuthController.SignIn (NayifatAPI) in 259.229ms
2025-02-02 12:03:56.520 +03:00 [INF] Executed endpoint 'NayifatAPI.Controllers.AuthController.SignIn (NayifatAPI)'
2025-02-02 12:03:56.520 +03:00 [INF] Request finished HTTP/1.1 POST http://07ca-46-152-255-232.ngrok-free.app/api/auth/signin - 401 null application/json; charset=utf-8 268.5204ms
2025-02-02 12:04:19.313 +03:00 [INF] Request starting HTTP/1.1 POST http://07ca-46-152-255-232.ngrok-free.app/api/notifications/list - application/json; charset=utf-8 47
2025-02-02 12:04:19.345 +03:00 [INF] Executing endpoint 'NayifatAPI.Controllers.NotificationsController.GetNotifications (NayifatAPI)'
2025-02-02 12:04:19.346 +03:00 [INF] Route matched with {action = "GetNotifications", controller = "Notifications"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetNotifications(NayifatAPI.Controllers.GetNotificationsRequest) on controller NayifatAPI.Controllers.NotificationsController (NayifatAPI).
2025-02-02 12:04:19.355 +03:00 [INF] Executed DbCommand (6ms) [Parameters=[@__providedApiKey_0='?' (Size = 255)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [a].[Key], [a].[CreatedAt], [a].[Description], [a].[ExpiresAt], [a].[IsActive], [a].[LastUsedAt]
FROM [ApiKeys] AS [a]
WHERE [a].[Key] = @__providedApiKey_0 AND [a].[IsActive] = CAST(1 AS bit)
2025-02-02 12:04:19.363 +03:00 [INF] Executed DbCommand (6ms) [Parameters=[@__request_NationalId_0='?' (Size = 450)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [u].[national_id], [u].[last_updated], [u].[notifications]
FROM [user_notifications] AS [u]
WHERE [u].[national_id] = @__request_NationalId_0
2025-02-02 12:04:19.438 +03:00 [INF] Executed DbCommand (8ms) [Parameters=[@__Parse_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [n].[Id], [n].[additional_data], [n].[Body], [n].[body_ar], [n].[body_en], [n].[created_at], [n].[expiry_at], [n].[Route], [n].[target_criteria], [n].[Title], [n].[title_ar], [n].[title_en]
FROM [notification_templates] AS [n]
WHERE [n].[Id] = @__Parse_0
2025-02-02 12:04:19.474 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@__Parse_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [n].[Id], [n].[additional_data], [n].[Body], [n].[body_ar], [n].[body_en], [n].[created_at], [n].[expiry_at], [n].[Route], [n].[target_criteria], [n].[Title], [n].[title_ar], [n].[title_en]
FROM [notification_templates] AS [n]
WHERE [n].[Id] = @__Parse_0
2025-02-02 12:04:19.590 +03:00 [INF] Executed DbCommand (103ms) [Parameters=[@p0='?' (Size = 4000), @p1='?' (DbType = DateTime2), @p2='?' (Size = 4000), @p3='?' (Size = 4000), @p4='?' (Size = 4000), @p5='?' (Size = 450), @p6='?' (Size = 4000), @p7='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SET IMPLICIT_TRANSACTIONS OFF;
SET NOCOUNT ON;
INSERT INTO [AuthLogs] ([AuthType], [CreatedAt], [DeviceId], [FailureReason], [IpAddress], [NationalId], [Status], [UserAgent])
OUTPUT INSERTED.[Id]
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7);
2025-02-02 12:04:19.637 +03:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType9`2[[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Object, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-02-02 12:04:19.676 +03:00 [INF] Executed action NayifatAPI.Controllers.NotificationsController.GetNotifications (NayifatAPI) in 327.9676ms
2025-02-02 12:04:19.679 +03:00 [INF] Executed endpoint 'NayifatAPI.Controllers.NotificationsController.GetNotifications (NayifatAPI)'
2025-02-02 12:04:19.680 +03:00 [INF] Request finished HTTP/1.1 POST http://07ca-46-152-255-232.ngrok-free.app/api/notifications/list - 200 null application/json; charset=utf-8 367.1285ms
2025-02-02 12:06:53.909 +03:00 [INF] Request starting HTTP/1.1 POST http://07ca-46-152-255-232.ngrok-free.app/api/auth/signin - application/json; charset=utf-8 224
2025-02-02 12:06:53.910 +03:00 [INF] Executing endpoint 'NayifatAPI.Controllers.AuthController.SignIn (NayifatAPI)'
2025-02-02 12:06:53.911 +03:00 [INF] Route matched with {action = "SignIn", controller = "Auth"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] SignIn(NayifatAPI.Controllers.SignInRequest) on controller NayifatAPI.Controllers.AuthController (NayifatAPI).
2025-02-02 12:06:53.917 +03:00 [INF] Executed DbCommand (3ms) [Parameters=[@__providedApiKey_0='?' (Size = 255)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [a].[Key], [a].[CreatedAt], [a].[Description], [a].[ExpiresAt], [a].[IsActive], [a].[LastUsedAt]
FROM [ApiKeys] AS [a]
WHERE [a].[Key] = @__providedApiKey_0 AND [a].[IsActive] = CAST(1 AS bit)
2025-02-02 12:06:53.923 +03:00 [INF] Executed DbCommand (3ms) [Parameters=[@__request_NationalId_0='?' (Size = 450)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [c].[NationalId], [c].[AddNo], [c].[BuildingNo], [c].[City], [c].[Consent], [c].[ConsentDate], [c].[DateOfBirth], [c].[Dependents], [c].[District], [c].[Email], [c].[Employer], [c].[FamilyNameAr], [c].[FamilyNameEn], [c].[FirstNameAr], [c].[FirstNameEn], [c].[Iban], [c].[IdExpiryDate], [c].[Los], [c].[Mpin], [c].[MpinEnabled], [c].[NafathStatus], [c].[NafathTimestamp], [c].[Password], [c].[Phone], [c].[RegistrationDate], [c].[SalaryCustomer], [c].[SalaryDakhli], [c].[SecondNameAr], [c].[SecondNameEn], [c].[Sector], [c].[Street], [c].[ThirdNameAr], [c].[ThirdNameEn], [c].[Zipcode]
FROM [Customers] AS [c]
WHERE [c].[NationalId] = @__request_NationalId_0
2025-02-02 12:06:53.925 +03:00 [INF] Starting password verification for NationalId: 1064448614
2025-02-02 12:06:54.096 +03:00 [INF] Password verification result for NationalId 1064448614: Success
2025-02-02 12:06:54.099 +03:00 [INF] Executed DbCommand (2ms) [Parameters=[@__request_NationalId_0='?' (Size = 450), @__request_DeviceId_1='?' (Size = 450)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [c].[Id], [c].[BiometricEnabled], [c].[BiometricToken], [c].[CreatedAt], [c].[DeviceId], [c].[LastUsedAt], [c].[Manufacturer], [c].[Model], [c].[NationalId], [c].[OsVersion], [c].[Platform], [c].[Status]
FROM [Customer_Devices] AS [c]
WHERE [c].[NationalId] = @__request_NationalId_0 AND [c].[DeviceId] = @__request_DeviceId_1 AND [c].[Status] = N'active'
2025-02-02 12:06:54.111 +03:00 [INF] Executed DbCommand (9ms) [Parameters=[@p0='?' (Size = 4000), @p1='?' (DbType = DateTime2), @p2='?' (Size = 4000), @p3='?' (Size = 4000), @p4='?' (Size = 4000), @p5='?' (Size = 450), @p6='?' (Size = 4000), @p7='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SET IMPLICIT_TRANSACTIONS OFF;
SET NOCOUNT ON;
INSERT INTO [AuthLogs] ([AuthType], [CreatedAt], [DeviceId], [FailureReason], [IpAddress], [NationalId], [Status], [UserAgent])
OUTPUT INSERTED.[Id]
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7);
2025-02-02 12:06:54.114 +03:00 [INF] Executing ObjectResult, writing value of type '<>f__AnonymousType12`3[[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Object, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-02-02 12:06:54.116 +03:00 [INF] Executed action NayifatAPI.Controllers.AuthController.SignIn (NayifatAPI) in 203.6922ms
2025-02-02 12:06:54.119 +03:00 [INF] Executed endpoint 'NayifatAPI.Controllers.AuthController.SignIn (NayifatAPI)'
2025-02-02 12:06:54.122 +03:00 [INF] Request finished HTTP/1.1 POST http://07ca-46-152-255-232.ngrok-free.app/api/auth/signin - 401 null application/json; charset=utf-8 213.0748ms
2025-02-02 12:09:20.285 +03:00 [INF] Request starting HTTP/1.1 POST http://07ca-46-152-255-232.ngrok-free.app/api/notifications/list - application/json; charset=utf-8 47
2025-02-02 12:09:20.288 +03:00 [INF] Executing endpoint 'NayifatAPI.Controllers.NotificationsController.GetNotifications (NayifatAPI)'
2025-02-02 12:09:20.291 +03:00 [INF] Route matched with {action = "GetNotifications", controller = "Notifications"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetNotifications(NayifatAPI.Controllers.GetNotificationsRequest) on controller NayifatAPI.Controllers.NotificationsController (NayifatAPI).
2025-02-02 12:09:20.298 +03:00 [INF] Executed DbCommand (3ms) [Parameters=[@__providedApiKey_0='?' (Size = 255)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [a].[Key], [a].[CreatedAt], [a].[Description], [a].[ExpiresAt], [a].[IsActive], [a].[LastUsedAt]
FROM [ApiKeys] AS [a]
WHERE [a].[Key] = @__providedApiKey_0 AND [a].[IsActive] = CAST(1 AS bit)
2025-02-02 12:09:20.302 +03:00 [INF] Executed DbCommand (2ms) [Parameters=[@__request_NationalId_0='?' (Size = 450)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [u].[national_id], [u].[last_updated], [u].[notifications]
FROM [user_notifications] AS [u]
WHERE [u].[national_id] = @__request_NationalId_0
2025-02-02 12:09:20.310 +03:00 [INF] Executed DbCommand (4ms) [Parameters=[@__Parse_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [n].[Id], [n].[additional_data], [n].[Body], [n].[body_ar], [n].[body_en], [n].[created_at], [n].[expiry_at], [n].[Route], [n].[target_criteria], [n].[Title], [n].[title_ar], [n].[title_en]
FROM [notification_templates] AS [n]
WHERE [n].[Id] = @__Parse_0
2025-02-02 12:09:20.314 +03:00 [INF] Executed DbCommand (0ms) [Parameters=[@__Parse_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [n].[Id], [n].[additional_data], [n].[Body], [n].[body_ar], [n].[body_en], [n].[created_at], [n].[expiry_at], [n].[Route], [n].[target_criteria], [n].[Title], [n].[title_ar], [n].[title_en]
FROM [notification_templates] AS [n]
WHERE [n].[Id] = @__Parse_0
2025-02-02 12:09:20.394 +03:00 [INF] Executed DbCommand (77ms) [Parameters=[@p0='?' (Size = 4000), @p1='?' (DbType = DateTime2), @p2='?' (Size = 4000), @p3='?' (Size = 4000), @p4='?' (Size = 4000), @p5='?' (Size = 450), @p6='?' (Size = 4000), @p7='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SET IMPLICIT_TRANSACTIONS OFF;
SET NOCOUNT ON;
INSERT INTO [AuthLogs] ([AuthType], [CreatedAt], [DeviceId], [FailureReason], [IpAddress], [NationalId], [Status], [UserAgent])
OUTPUT INSERTED.[Id]
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7);
2025-02-02 12:09:20.397 +03:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType9`2[[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Object, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-02-02 12:09:20.401 +03:00 [INF] Executed action NayifatAPI.Controllers.NotificationsController.GetNotifications (NayifatAPI) in 107.3369ms
2025-02-02 12:09:20.402 +03:00 [INF] Executed endpoint 'NayifatAPI.Controllers.NotificationsController.GetNotifications (NayifatAPI)'
2025-02-02 12:09:20.403 +03:00 [INF] Request finished HTTP/1.1 POST http://07ca-46-152-255-232.ngrok-free.app/api/notifications/list - 200 null application/json; charset=utf-8 118.2657ms
2025-02-02 12:11:19.681 +03:00 [INF] Application is shutting down...
2025-02-02 12:11:35.567 +03:00 [INF] Starting web application
2025-02-02 12:11:35.726 +03:00 [INF] Now listening on: http://localhost:5264
2025-02-02 12:11:35.740 +03:00 [INF] Application started. Press Ctrl+C to shut down.
2025-02-02 12:11:35.741 +03:00 [INF] Hosting environment: Development
2025-02-02 12:11:35.742 +03:00 [INF] Content root path: C:\Users\yamta\StudioProjects\nayifat_app_2025_new\nayifatapi
2025-02-02 12:12:28.289 +03:00 [INF] Request starting HTTP/1.1 POST http://07ca-46-152-255-232.ngrok-free.app/api/notifications/list - application/json; charset=utf-8 47
2025-02-02 12:12:28.358 +03:00 [WRN] Failed to determine the https port for redirect.
2025-02-02 12:12:28.364 +03:00 [INF] Executing endpoint 'NayifatAPI.Controllers.NotificationsController.GetNotifications (NayifatAPI)'
2025-02-02 12:12:28.392 +03:00 [INF] Route matched with {action = "GetNotifications", controller = "Notifications"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetNotifications(NayifatAPI.Controllers.GetNotificationsRequest) on controller NayifatAPI.Controllers.NotificationsController (NayifatAPI).
2025-02-02 12:12:30.158 +03:00 [INF] Executed DbCommand (24ms) [Parameters=[@__providedApiKey_0='?' (Size = 255)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [a].[Key], [a].[CreatedAt], [a].[Description], [a].[ExpiresAt], [a].[IsActive], [a].[LastUsedAt]
FROM [ApiKeys] AS [a]
WHERE [a].[Key] = @__providedApiKey_0 AND [a].[IsActive] = CAST(1 AS bit)
2025-02-02 12:12:30.288 +03:00 [INF] Executed DbCommand (21ms) [Parameters=[@__request_NationalId_0='?' (Size = 450)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [u].[national_id], [u].[last_updated], [u].[notifications]
FROM [user_notifications] AS [u]
WHERE [u].[national_id] = @__request_NationalId_0
2025-02-02 12:12:30.366 +03:00 [INF] Executed DbCommand (4ms) [Parameters=[@__Parse_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [n].[Id], [n].[additional_data], [n].[Body], [n].[body_ar], [n].[body_en], [n].[created_at], [n].[expiry_at], [n].[Route], [n].[target_criteria], [n].[Title], [n].[title_ar], [n].[title_en]
FROM [notification_templates] AS [n]
WHERE [n].[Id] = @__Parse_0
2025-02-02 12:12:30.423 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@__Parse_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [n].[Id], [n].[additional_data], [n].[Body], [n].[body_ar], [n].[body_en], [n].[created_at], [n].[expiry_at], [n].[Route], [n].[target_criteria], [n].[Title], [n].[title_ar], [n].[title_en]
FROM [notification_templates] AS [n]
WHERE [n].[Id] = @__Parse_0
2025-02-02 12:12:30.797 +03:00 [INF] Executed DbCommand (79ms) [Parameters=[@p0='?' (Size = 4000), @p1='?' (DbType = DateTime2), @p2='?' (Size = 4000), @p3='?' (Size = 4000), @p4='?' (Size = 4000), @p5='?' (Size = 450), @p6='?' (Size = 4000), @p7='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SET IMPLICIT_TRANSACTIONS OFF;
SET NOCOUNT ON;
INSERT INTO [AuthLogs] ([AuthType], [CreatedAt], [DeviceId], [FailureReason], [IpAddress], [NationalId], [Status], [UserAgent])
OUTPUT INSERTED.[Id]
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7);
2025-02-02 12:12:30.835 +03:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType9`2[[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Object, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-02-02 12:12:30.876 +03:00 [INF] Executed action NayifatAPI.Controllers.NotificationsController.GetNotifications (NayifatAPI) in 2476.6565ms
2025-02-02 12:12:30.878 +03:00 [INF] Executed endpoint 'NayifatAPI.Controllers.NotificationsController.GetNotifications (NayifatAPI)'
2025-02-02 12:12:30.896 +03:00 [INF] Request finished HTTP/1.1 POST http://07ca-46-152-255-232.ngrok-free.app/api/notifications/list - 200 null application/json; charset=utf-8 2609.3665ms
2025-02-02 12:17:32.176 +03:00 [INF] Request starting HTTP/1.1 POST http://07ca-46-152-255-232.ngrok-free.app/api/notifications/list - application/json; charset=utf-8 47
2025-02-02 12:17:32.187 +03:00 [INF] Executing endpoint 'NayifatAPI.Controllers.NotificationsController.GetNotifications (NayifatAPI)'
2025-02-02 12:17:32.190 +03:00 [INF] Route matched with {action = "GetNotifications", controller = "Notifications"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetNotifications(NayifatAPI.Controllers.GetNotificationsRequest) on controller NayifatAPI.Controllers.NotificationsController (NayifatAPI).
2025-02-02 12:17:32.225 +03:00 [INF] Executed DbCommand (6ms) [Parameters=[@__providedApiKey_0='?' (Size = 255)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [a].[Key], [a].[CreatedAt], [a].[Description], [a].[ExpiresAt], [a].[IsActive], [a].[LastUsedAt]
FROM [ApiKeys] AS [a]
WHERE [a].[Key] = @__providedApiKey_0 AND [a].[IsActive] = CAST(1 AS bit)
2025-02-02 12:17:32.232 +03:00 [INF] Executed DbCommand (3ms) [Parameters=[@__request_NationalId_0='?' (Size = 450)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [u].[national_id], [u].[last_updated], [u].[notifications]
FROM [user_notifications] AS [u]
WHERE [u].[national_id] = @__request_NationalId_0
2025-02-02 12:17:32.240 +03:00 [INF] Executed DbCommand (3ms) [Parameters=[@__Parse_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [n].[Id], [n].[additional_data], [n].[Body], [n].[body_ar], [n].[body_en], [n].[created_at], [n].[expiry_at], [n].[Route], [n].[target_criteria], [n].[Title], [n].[title_ar], [n].[title_en]
FROM [notification_templates] AS [n]
WHERE [n].[Id] = @__Parse_0
2025-02-02 12:17:32.244 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@__Parse_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [n].[Id], [n].[additional_data], [n].[Body], [n].[body_ar], [n].[body_en], [n].[created_at], [n].[expiry_at], [n].[Route], [n].[target_criteria], [n].[Title], [n].[title_ar], [n].[title_en]
FROM [notification_templates] AS [n]
WHERE [n].[Id] = @__Parse_0
2025-02-02 12:17:32.328 +03:00 [INF] Executed DbCommand (77ms) [Parameters=[@p0='?' (Size = 4000), @p1='?' (DbType = DateTime2), @p2='?' (Size = 4000), @p3='?' (Size = 4000), @p4='?' (Size = 4000), @p5='?' (Size = 450), @p6='?' (Size = 4000), @p7='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SET IMPLICIT_TRANSACTIONS OFF;
SET NOCOUNT ON;
INSERT INTO [AuthLogs] ([AuthType], [CreatedAt], [DeviceId], [FailureReason], [IpAddress], [NationalId], [Status], [UserAgent])
OUTPUT INSERTED.[Id]
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7);
2025-02-02 12:17:32.333 +03:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType9`2[[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Object, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-02-02 12:17:32.336 +03:00 [INF] Executed action NayifatAPI.Controllers.NotificationsController.GetNotifications (NayifatAPI) in 143.9409ms
2025-02-02 12:17:32.339 +03:00 [INF] Executed endpoint 'NayifatAPI.Controllers.NotificationsController.GetNotifications (NayifatAPI)'
2025-02-02 12:17:32.341 +03:00 [INF] Request finished HTTP/1.1 POST http://07ca-46-152-255-232.ngrok-free.app/api/notifications/list - 200 null application/json; charset=utf-8 164.9687ms
2025-02-02 12:18:24.071 +03:00 [INF] Request starting HTTP/1.1 POST http://07ca-46-152-255-232.ngrok-free.app/api/notifications/list - application/json; charset=utf-8 47
2025-02-02 12:18:24.074 +03:00 [INF] Executing endpoint 'NayifatAPI.Controllers.NotificationsController.GetNotifications (NayifatAPI)'
2025-02-02 12:18:24.074 +03:00 [INF] Route matched with {action = "GetNotifications", controller = "Notifications"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetNotifications(NayifatAPI.Controllers.GetNotificationsRequest) on controller NayifatAPI.Controllers.NotificationsController (NayifatAPI).
2025-02-02 12:18:24.136 +03:00 [INF] Executed DbCommand (2ms) [Parameters=[@__providedApiKey_0='?' (Size = 255)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [a].[Key], [a].[CreatedAt], [a].[Description], [a].[ExpiresAt], [a].[IsActive], [a].[LastUsedAt]
FROM [ApiKeys] AS [a]
WHERE [a].[Key] = @__providedApiKey_0 AND [a].[IsActive] = CAST(1 AS bit)
2025-02-02 12:18:24.141 +03:00 [INF] Executed DbCommand (2ms) [Parameters=[@__request_NationalId_0='?' (Size = 450)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [u].[national_id], [u].[last_updated], [u].[notifications]
FROM [user_notifications] AS [u]
WHERE [u].[national_id] = @__request_NationalId_0
2025-02-02 12:18:24.146 +03:00 [INF] Executed DbCommand (2ms) [Parameters=[@__Parse_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [n].[Id], [n].[additional_data], [n].[Body], [n].[body_ar], [n].[body_en], [n].[created_at], [n].[expiry_at], [n].[Route], [n].[target_criteria], [n].[Title], [n].[title_ar], [n].[title_en]
FROM [notification_templates] AS [n]
WHERE [n].[Id] = @__Parse_0
2025-02-02 12:18:24.149 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@__Parse_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [n].[Id], [n].[additional_data], [n].[Body], [n].[body_ar], [n].[body_en], [n].[created_at], [n].[expiry_at], [n].[Route], [n].[target_criteria], [n].[Title], [n].[title_ar], [n].[title_en]
FROM [notification_templates] AS [n]
WHERE [n].[Id] = @__Parse_0
2025-02-02 12:18:24.159 +03:00 [INF] Executed DbCommand (8ms) [Parameters=[@p0='?' (Size = 4000), @p1='?' (DbType = DateTime2), @p2='?' (Size = 4000), @p3='?' (Size = 4000), @p4='?' (Size = 4000), @p5='?' (Size = 450), @p6='?' (Size = 4000), @p7='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SET IMPLICIT_TRANSACTIONS OFF;
SET NOCOUNT ON;
INSERT INTO [AuthLogs] ([AuthType], [CreatedAt], [DeviceId], [FailureReason], [IpAddress], [NationalId], [Status], [UserAgent])
OUTPUT INSERTED.[Id]
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7);
2025-02-02 12:18:24.162 +03:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType9`2[[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Object, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-02-02 12:18:24.164 +03:00 [INF] Executed action NayifatAPI.Controllers.NotificationsController.GetNotifications (NayifatAPI) in 87.8352ms
2025-02-02 12:18:24.165 +03:00 [INF] Executed endpoint 'NayifatAPI.Controllers.NotificationsController.GetNotifications (NayifatAPI)'
2025-02-02 12:18:24.166 +03:00 [INF] Request finished HTTP/1.1 POST http://07ca-46-152-255-232.ngrok-free.app/api/notifications/list - 200 null application/json; charset=utf-8 95.34ms
2025-02-02 12:33:07.717 +03:00 [INF] Request starting HTTP/1.1 POST http://07ca-46-152-255-232.ngrok-free.app/api/notifications/list - application/json; charset=utf-8 47
2025-02-02 12:33:09.321 +03:00 [INF] Executing endpoint 'NayifatAPI.Controllers.NotificationsController.GetNotifications (NayifatAPI)'
2025-02-02 12:33:09.330 +03:00 [INF] Route matched with {action = "GetNotifications", controller = "Notifications"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetNotifications(NayifatAPI.Controllers.GetNotificationsRequest) on controller NayifatAPI.Controllers.NotificationsController (NayifatAPI).
2025-02-02 12:33:09.761 +03:00 [INF] Executed DbCommand (136ms) [Parameters=[@__providedApiKey_0='?' (Size = 255)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [a].[Key], [a].[CreatedAt], [a].[Description], [a].[ExpiresAt], [a].[IsActive], [a].[LastUsedAt]
FROM [ApiKeys] AS [a]
WHERE [a].[Key] = @__providedApiKey_0 AND [a].[IsActive] = CAST(1 AS bit)
2025-02-02 12:33:11.118 +03:00 [INF] Executed DbCommand (157ms) [Parameters=[@__request_NationalId_0='?' (Size = 450)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [u].[national_id], [u].[last_updated], [u].[notifications]
FROM [user_notifications] AS [u]
WHERE [u].[national_id] = @__request_NationalId_0
2025-02-02 12:33:11.151 +03:00 [INF] Executed DbCommand (12ms) [Parameters=[@__Parse_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [n].[Id], [n].[additional_data], [n].[Body], [n].[body_ar], [n].[body_en], [n].[created_at], [n].[expiry_at], [n].[Route], [n].[target_criteria], [n].[Title], [n].[title_ar], [n].[title_en]
FROM [notification_templates] AS [n]
WHERE [n].[Id] = @__Parse_0
2025-02-02 12:33:11.158 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@__Parse_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [n].[Id], [n].[additional_data], [n].[Body], [n].[body_ar], [n].[body_en], [n].[created_at], [n].[expiry_at], [n].[Route], [n].[target_criteria], [n].[Title], [n].[title_ar], [n].[title_en]
FROM [notification_templates] AS [n]
WHERE [n].[Id] = @__Parse_0
2025-02-02 12:33:11.245 +03:00 [INF] Executed DbCommand (78ms) [Parameters=[@p0='?' (Size = 4000), @p1='?' (DbType = DateTime2), @p2='?' (Size = 4000), @p3='?' (Size = 4000), @p4='?' (Size = 4000), @p5='?' (Size = 450), @p6='?' (Size = 4000), @p7='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SET IMPLICIT_TRANSACTIONS OFF;
SET NOCOUNT ON;
INSERT INTO [AuthLogs] ([AuthType], [CreatedAt], [DeviceId], [FailureReason], [IpAddress], [NationalId], [Status], [UserAgent])
OUTPUT INSERTED.[Id]
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7);
2025-02-02 12:33:11.248 +03:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType9`2[[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Object, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-02-02 12:33:11.250 +03:00 [INF] Executed action NayifatAPI.Controllers.NotificationsController.GetNotifications (NayifatAPI) in 1897.5502ms
2025-02-02 12:33:11.253 +03:00 [INF] Executed endpoint 'NayifatAPI.Controllers.NotificationsController.GetNotifications (NayifatAPI)'
2025-02-02 12:33:11.255 +03:00 [INF] Request finished HTTP/1.1 POST http://07ca-46-152-255-232.ngrok-free.app/api/notifications/list - 200 null application/json; charset=utf-8 3537.7511ms
2025-02-02 12:33:24.811 +03:00 [INF] Request starting HTTP/1.1 POST http://07ca-46-152-255-232.ngrok-free.app/api/notifications/list - application/json; charset=utf-8 47
2025-02-02 12:33:24.813 +03:00 [INF] Executing endpoint 'NayifatAPI.Controllers.NotificationsController.GetNotifications (NayifatAPI)'
2025-02-02 12:33:24.815 +03:00 [INF] Route matched with {action = "GetNotifications", controller = "Notifications"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetNotifications(NayifatAPI.Controllers.GetNotificationsRequest) on controller NayifatAPI.Controllers.NotificationsController (NayifatAPI).
2025-02-02 12:33:24.821 +03:00 [INF] Executed DbCommand (2ms) [Parameters=[@__providedApiKey_0='?' (Size = 255)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [a].[Key], [a].[CreatedAt], [a].[Description], [a].[ExpiresAt], [a].[IsActive], [a].[LastUsedAt]
FROM [ApiKeys] AS [a]
WHERE [a].[Key] = @__providedApiKey_0 AND [a].[IsActive] = CAST(1 AS bit)
2025-02-02 12:33:24.910 +03:00 [INF] Executed DbCommand (86ms) [Parameters=[@__request_NationalId_0='?' (Size = 450)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [u].[national_id], [u].[last_updated], [u].[notifications]
FROM [user_notifications] AS [u]
WHERE [u].[national_id] = @__request_NationalId_0
2025-02-02 12:33:25.080 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@__Parse_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [n].[Id], [n].[additional_data], [n].[Body], [n].[body_ar], [n].[body_en], [n].[created_at], [n].[expiry_at], [n].[Route], [n].[target_criteria], [n].[Title], [n].[title_ar], [n].[title_en]
FROM [notification_templates] AS [n]
WHERE [n].[Id] = @__Parse_0
2025-02-02 12:33:25.176 +03:00 [INF] Executed DbCommand (92ms) [Parameters=[@__Parse_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [n].[Id], [n].[additional_data], [n].[Body], [n].[body_ar], [n].[body_en], [n].[created_at], [n].[expiry_at], [n].[Route], [n].[target_criteria], [n].[Title], [n].[title_ar], [n].[title_en]
FROM [notification_templates] AS [n]
WHERE [n].[Id] = @__Parse_0
2025-02-02 12:33:25.580 +03:00 [INF] Executed DbCommand (159ms) [Parameters=[@p0='?' (Size = 4000), @p1='?' (DbType = DateTime2), @p2='?' (Size = 4000), @p3='?' (Size = 4000), @p4='?' (Size = 4000), @p5='?' (Size = 450), @p6='?' (Size = 4000), @p7='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SET IMPLICIT_TRANSACTIONS OFF;
SET NOCOUNT ON;
INSERT INTO [AuthLogs] ([AuthType], [CreatedAt], [DeviceId], [FailureReason], [IpAddress], [NationalId], [Status], [UserAgent])
OUTPUT INSERTED.[Id]
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7);
2025-02-02 12:33:25.735 +03:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType9`2[[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Object, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-02-02 12:33:25.738 +03:00 [INF] Executed action NayifatAPI.Controllers.NotificationsController.GetNotifications (NayifatAPI) in 920.9044ms
2025-02-02 12:33:25.758 +03:00 [INF] Executed endpoint 'NayifatAPI.Controllers.NotificationsController.GetNotifications (NayifatAPI)'
2025-02-02 12:33:26.099 +03:00 [INF] Request finished HTTP/1.1 POST http://07ca-46-152-255-232.ngrok-free.app/api/notifications/list - 200 null application/json; charset=utf-8 1287.9757ms
2025-02-02 12:34:18.784 +03:00 [INF] Request starting HTTP/1.1 POST http://07ca-46-152-255-232.ngrok-free.app/api/notifications/list - application/json; charset=utf-8 47
2025-02-02 12:34:18.789 +03:00 [INF] Executing endpoint 'NayifatAPI.Controllers.NotificationsController.GetNotifications (NayifatAPI)'
2025-02-02 12:34:18.790 +03:00 [INF] Route matched with {action = "GetNotifications", controller = "Notifications"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetNotifications(NayifatAPI.Controllers.GetNotificationsRequest) on controller NayifatAPI.Controllers.NotificationsController (NayifatAPI).
2025-02-02 12:34:18.800 +03:00 [INF] Executed DbCommand (4ms) [Parameters=[@__providedApiKey_0='?' (Size = 255)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [a].[Key], [a].[CreatedAt], [a].[Description], [a].[ExpiresAt], [a].[IsActive], [a].[LastUsedAt]
FROM [ApiKeys] AS [a]
WHERE [a].[Key] = @__providedApiKey_0 AND [a].[IsActive] = CAST(1 AS bit)
2025-02-02 12:34:18.805 +03:00 [INF] Executed DbCommand (2ms) [Parameters=[@__request_NationalId_0='?' (Size = 450)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [u].[national_id], [u].[last_updated], [u].[notifications]
FROM [user_notifications] AS [u]
WHERE [u].[national_id] = @__request_NationalId_0
2025-02-02 12:34:18.811 +03:00 [INF] Executed DbCommand (2ms) [Parameters=[@__Parse_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [n].[Id], [n].[additional_data], [n].[Body], [n].[body_ar], [n].[body_en], [n].[created_at], [n].[expiry_at], [n].[Route], [n].[target_criteria], [n].[Title], [n].[title_ar], [n].[title_en]
FROM [notification_templates] AS [n]
WHERE [n].[Id] = @__Parse_0
2025-02-02 12:34:18.815 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@__Parse_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [n].[Id], [n].[additional_data], [n].[Body], [n].[body_ar], [n].[body_en], [n].[created_at], [n].[expiry_at], [n].[Route], [n].[target_criteria], [n].[Title], [n].[title_ar], [n].[title_en]
FROM [notification_templates] AS [n]
WHERE [n].[Id] = @__Parse_0
2025-02-02 12:34:18.894 +03:00 [INF] Executed DbCommand (75ms) [Parameters=[@p0='?' (Size = 4000), @p1='?' (DbType = DateTime2), @p2='?' (Size = 4000), @p3='?' (Size = 4000), @p4='?' (Size = 4000), @p5='?' (Size = 450), @p6='?' (Size = 4000), @p7='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SET IMPLICIT_TRANSACTIONS OFF;
SET NOCOUNT ON;
INSERT INTO [AuthLogs] ([AuthType], [CreatedAt], [DeviceId], [FailureReason], [IpAddress], [NationalId], [Status], [UserAgent])
OUTPUT INSERTED.[Id]
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7);
2025-02-02 12:34:18.898 +03:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType9`2[[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Object, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-02-02 12:34:18.901 +03:00 [INF] Executed action NayifatAPI.Controllers.NotificationsController.GetNotifications (NayifatAPI) in 107.8009ms
2025-02-02 12:34:18.905 +03:00 [INF] Executed endpoint 'NayifatAPI.Controllers.NotificationsController.GetNotifications (NayifatAPI)'
2025-02-02 12:34:18.907 +03:00 [INF] Request finished HTTP/1.1 POST http://07ca-46-152-255-232.ngrok-free.app/api/notifications/list - 200 null application/json; charset=utf-8 122.6628ms
2025-02-02 12:39:20.018 +03:00 [INF] Request starting HTTP/1.1 POST http://07ca-46-152-255-232.ngrok-free.app/api/notifications/list - application/json; charset=utf-8 47
2025-02-02 12:39:20.020 +03:00 [INF] Executing endpoint 'NayifatAPI.Controllers.NotificationsController.GetNotifications (NayifatAPI)'
2025-02-02 12:39:20.021 +03:00 [INF] Route matched with {action = "GetNotifications", controller = "Notifications"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetNotifications(NayifatAPI.Controllers.GetNotificationsRequest) on controller NayifatAPI.Controllers.NotificationsController (NayifatAPI).
2025-02-02 12:39:20.028 +03:00 [INF] Executed DbCommand (3ms) [Parameters=[@__providedApiKey_0='?' (Size = 255)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [a].[Key], [a].[CreatedAt], [a].[Description], [a].[ExpiresAt], [a].[IsActive], [a].[LastUsedAt]
FROM [ApiKeys] AS [a]
WHERE [a].[Key] = @__providedApiKey_0 AND [a].[IsActive] = CAST(1 AS bit)
2025-02-02 12:39:20.033 +03:00 [INF] Executed DbCommand (2ms) [Parameters=[@__request_NationalId_0='?' (Size = 450)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [u].[national_id], [u].[last_updated], [u].[notifications]
FROM [user_notifications] AS [u]
WHERE [u].[national_id] = @__request_NationalId_0
2025-02-02 12:39:20.038 +03:00 [INF] Executed DbCommand (2ms) [Parameters=[@__Parse_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [n].[Id], [n].[additional_data], [n].[Body], [n].[body_ar], [n].[body_en], [n].[created_at], [n].[expiry_at], [n].[Route], [n].[target_criteria], [n].[Title], [n].[title_ar], [n].[title_en]
FROM [notification_templates] AS [n]
WHERE [n].[Id] = @__Parse_0
2025-02-02 12:39:20.043 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@__Parse_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [n].[Id], [n].[additional_data], [n].[Body], [n].[body_ar], [n].[body_en], [n].[created_at], [n].[expiry_at], [n].[Route], [n].[target_criteria], [n].[Title], [n].[title_ar], [n].[title_en]
FROM [notification_templates] AS [n]
WHERE [n].[Id] = @__Parse_0
2025-02-02 12:39:20.122 +03:00 [INF] Executed DbCommand (76ms) [Parameters=[@p0='?' (Size = 4000), @p1='?' (DbType = DateTime2), @p2='?' (Size = 4000), @p3='?' (Size = 4000), @p4='?' (Size = 4000), @p5='?' (Size = 450), @p6='?' (Size = 4000), @p7='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SET IMPLICIT_TRANSACTIONS OFF;
SET NOCOUNT ON;
INSERT INTO [AuthLogs] ([AuthType], [CreatedAt], [DeviceId], [FailureReason], [IpAddress], [NationalId], [Status], [UserAgent])
OUTPUT INSERTED.[Id]
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7);
2025-02-02 12:39:20.130 +03:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType9`2[[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Object, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-02-02 12:39:20.132 +03:00 [INF] Executed action NayifatAPI.Controllers.NotificationsController.GetNotifications (NayifatAPI) in 109.6828ms
2025-02-02 12:39:20.134 +03:00 [INF] Executed endpoint 'NayifatAPI.Controllers.NotificationsController.GetNotifications (NayifatAPI)'
2025-02-02 12:39:20.137 +03:00 [INF] Request finished HTTP/1.1 POST http://07ca-46-152-255-232.ngrok-free.app/api/notifications/list - 200 null application/json; charset=utf-8 119.0845ms
2025-02-02 12:40:49.374 +03:00 [INF] Request starting HTTP/1.1 POST http://07ca-46-152-255-232.ngrok-free.app/api/auth/signin - application/json; charset=utf-8 224
2025-02-02 12:40:49.376 +03:00 [INF] Executing endpoint 'NayifatAPI.Controllers.AuthController.SignIn (NayifatAPI)'
2025-02-02 12:40:49.380 +03:00 [INF] Route matched with {action = "SignIn", controller = "Auth"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] SignIn(NayifatAPI.Controllers.SignInRequest) on controller NayifatAPI.Controllers.AuthController (NayifatAPI).
2025-02-02 12:40:49.392 +03:00 [INF] Executed DbCommand (2ms) [Parameters=[@__providedApiKey_0='?' (Size = 255)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [a].[Key], [a].[CreatedAt], [a].[Description], [a].[ExpiresAt], [a].[IsActive], [a].[LastUsedAt]
FROM [ApiKeys] AS [a]
WHERE [a].[Key] = @__providedApiKey_0 AND [a].[IsActive] = CAST(1 AS bit)
2025-02-02 12:40:49.410 +03:00 [INF] Executed DbCommand (4ms) [Parameters=[@__request_NationalId_0='?' (Size = 450)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [c].[NationalId], [c].[AddNo], [c].[BuildingNo], [c].[City], [c].[Consent], [c].[ConsentDate], [c].[DateOfBirth], [c].[Dependents], [c].[District], [c].[Email], [c].[Employer], [c].[FamilyNameAr], [c].[FamilyNameEn], [c].[FirstNameAr], [c].[FirstNameEn], [c].[Iban], [c].[IdExpiryDate], [c].[Los], [c].[Mpin], [c].[MpinEnabled], [c].[NafathStatus], [c].[NafathTimestamp], [c].[Password], [c].[Phone], [c].[RegistrationDate], [c].[SalaryCustomer], [c].[SalaryDakhli], [c].[SecondNameAr], [c].[SecondNameEn], [c].[Sector], [c].[Street], [c].[ThirdNameAr], [c].[ThirdNameEn], [c].[Zipcode]
FROM [Customers] AS [c]
WHERE [c].[NationalId] = @__request_NationalId_0
2025-02-02 12:40:49.492 +03:00 [INF] Starting password verification for NationalId: 1064448614
2025-02-02 12:40:49.889 +03:00 [INF] Password verification result for NationalId 1064448614: Success
2025-02-02 12:40:49.905 +03:00 [INF] Executed DbCommand (4ms) [Parameters=[@__request_NationalId_0='?' (Size = 450), @__request_DeviceId_1='?' (Size = 450)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [c].[Id], [c].[BiometricEnabled], [c].[BiometricToken], [c].[CreatedAt], [c].[DeviceId], [c].[LastUsedAt], [c].[Manufacturer], [c].[Model], [c].[NationalId], [c].[OsVersion], [c].[Platform], [c].[Status]
FROM [Customer_Devices] AS [c]
WHERE [c].[NationalId] = @__request_NationalId_0 AND [c].[DeviceId] = @__request_DeviceId_1 AND [c].[Status] = N'active'
2025-02-02 12:40:49.964 +03:00 [INF] Executed DbCommand (8ms) [Parameters=[@p0='?' (Size = 4000), @p1='?' (DbType = DateTime2), @p2='?' (Size = 4000), @p3='?' (Size = 4000), @p4='?' (Size = 4000), @p5='?' (Size = 450), @p6='?' (Size = 4000), @p7='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SET IMPLICIT_TRANSACTIONS OFF;
SET NOCOUNT ON;
INSERT INTO [AuthLogs] ([AuthType], [CreatedAt], [DeviceId], [FailureReason], [IpAddress], [NationalId], [Status], [UserAgent])
OUTPUT INSERTED.[Id]
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7);
2025-02-02 12:40:49.967 +03:00 [INF] Executing ObjectResult, writing value of type '<>f__AnonymousType12`3[[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Object, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-02-02 12:40:49.971 +03:00 [INF] Executed action NayifatAPI.Controllers.AuthController.SignIn (NayifatAPI) in 589.31ms
2025-02-02 12:40:49.973 +03:00 [INF] Executed endpoint 'NayifatAPI.Controllers.AuthController.SignIn (NayifatAPI)'
2025-02-02 12:40:49.974 +03:00 [INF] Request finished HTTP/1.1 POST http://07ca-46-152-255-232.ngrok-free.app/api/auth/signin - 401 null application/json; charset=utf-8 600.832ms
2025-02-02 12:44:20.250 +03:00 [INF] Request starting HTTP/1.1 POST http://07ca-46-152-255-232.ngrok-free.app/api/notifications/list - application/json; charset=utf-8 47
2025-02-02 12:44:20.255 +03:00 [INF] Executing endpoint 'NayifatAPI.Controllers.NotificationsController.GetNotifications (NayifatAPI)'
2025-02-02 12:44:20.257 +03:00 [INF] Route matched with {action = "GetNotifications", controller = "Notifications"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetNotifications(NayifatAPI.Controllers.GetNotificationsRequest) on controller NayifatAPI.Controllers.NotificationsController (NayifatAPI).
2025-02-02 12:44:20.264 +03:00 [INF] Executed DbCommand (3ms) [Parameters=[@__providedApiKey_0='?' (Size = 255)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [a].[Key], [a].[CreatedAt], [a].[Description], [a].[ExpiresAt], [a].[IsActive], [a].[LastUsedAt]
FROM [ApiKeys] AS [a]
WHERE [a].[Key] = @__providedApiKey_0 AND [a].[IsActive] = CAST(1 AS bit)
2025-02-02 12:44:20.270 +03:00 [INF] Executed DbCommand (4ms) [Parameters=[@__request_NationalId_0='?' (Size = 450)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [u].[national_id], [u].[last_updated], [u].[notifications]
FROM [user_notifications] AS [u]
WHERE [u].[national_id] = @__request_NationalId_0
2025-02-02 12:44:20.278 +03:00 [INF] Executed DbCommand (2ms) [Parameters=[@__Parse_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [n].[Id], [n].[additional_data], [n].[Body], [n].[body_ar], [n].[body_en], [n].[created_at], [n].[expiry_at], [n].[Route], [n].[target_criteria], [n].[Title], [n].[title_ar], [n].[title_en]
FROM [notification_templates] AS [n]
WHERE [n].[Id] = @__Parse_0
2025-02-02 12:44:20.282 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@__Parse_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [n].[Id], [n].[additional_data], [n].[Body], [n].[body_ar], [n].[body_en], [n].[created_at], [n].[expiry_at], [n].[Route], [n].[target_criteria], [n].[Title], [n].[title_ar], [n].[title_en]
FROM [notification_templates] AS [n]
WHERE [n].[Id] = @__Parse_0
2025-02-02 12:44:20.366 +03:00 [INF] Executed DbCommand (80ms) [Parameters=[@p0='?' (Size = 4000), @p1='?' (DbType = DateTime2), @p2='?' (Size = 4000), @p3='?' (Size = 4000), @p4='?' (Size = 4000), @p5='?' (Size = 450), @p6='?' (Size = 4000), @p7='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SET IMPLICIT_TRANSACTIONS OFF;
SET NOCOUNT ON;
INSERT INTO [AuthLogs] ([AuthType], [CreatedAt], [DeviceId], [FailureReason], [IpAddress], [NationalId], [Status], [UserAgent])
OUTPUT INSERTED.[Id]
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7);
2025-02-02 12:44:20.370 +03:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType9`2[[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Object, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-02-02 12:44:20.372 +03:00 [INF] Executed action NayifatAPI.Controllers.NotificationsController.GetNotifications (NayifatAPI) in 112.7701ms
2025-02-02 12:44:20.374 +03:00 [INF] Executed endpoint 'NayifatAPI.Controllers.NotificationsController.GetNotifications (NayifatAPI)'
2025-02-02 12:44:20.377 +03:00 [INF] Request finished HTTP/1.1 POST http://07ca-46-152-255-232.ngrok-free.app/api/notifications/list - 200 null application/json; charset=utf-8 126.7798ms
2025-02-02 12:49:19.539 +03:00 [INF] Request starting HTTP/1.1 POST http://07ca-46-152-255-232.ngrok-free.app/api/notifications/list - application/json; charset=utf-8 47
2025-02-02 12:49:19.589 +03:00 [INF] Executing endpoint 'NayifatAPI.Controllers.NotificationsController.GetNotifications (NayifatAPI)'
2025-02-02 12:49:19.601 +03:00 [INF] Route matched with {action = "GetNotifications", controller = "Notifications"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetNotifications(NayifatAPI.Controllers.GetNotificationsRequest) on controller NayifatAPI.Controllers.NotificationsController (NayifatAPI).
2025-02-02 12:49:19.610 +03:00 [INF] Executed DbCommand (4ms) [Parameters=[@__providedApiKey_0='?' (Size = 255)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [a].[Key], [a].[CreatedAt], [a].[Description], [a].[ExpiresAt], [a].[IsActive], [a].[LastUsedAt]
FROM [ApiKeys] AS [a]
WHERE [a].[Key] = @__providedApiKey_0 AND [a].[IsActive] = CAST(1 AS bit)
2025-02-02 12:49:19.617 +03:00 [INF] Executed DbCommand (2ms) [Parameters=[@__request_NationalId_0='?' (Size = 450)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [u].[national_id], [u].[last_updated], [u].[notifications]
FROM [user_notifications] AS [u]
WHERE [u].[national_id] = @__request_NationalId_0
2025-02-02 12:49:19.624 +03:00 [INF] Executed DbCommand (3ms) [Parameters=[@__Parse_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [n].[Id], [n].[additional_data], [n].[Body], [n].[body_ar], [n].[body_en], [n].[created_at], [n].[expiry_at], [n].[Route], [n].[target_criteria], [n].[Title], [n].[title_ar], [n].[title_en]
FROM [notification_templates] AS [n]
WHERE [n].[Id] = @__Parse_0
2025-02-02 12:49:19.628 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@__Parse_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [n].[Id], [n].[additional_data], [n].[Body], [n].[body_ar], [n].[body_en], [n].[created_at], [n].[expiry_at], [n].[Route], [n].[target_criteria], [n].[Title], [n].[title_ar], [n].[title_en]
FROM [notification_templates] AS [n]
WHERE [n].[Id] = @__Parse_0
2025-02-02 12:49:19.711 +03:00 [INF] Executed DbCommand (78ms) [Parameters=[@p0='?' (Size = 4000), @p1='?' (DbType = DateTime2), @p2='?' (Size = 4000), @p3='?' (Size = 4000), @p4='?' (Size = 4000), @p5='?' (Size = 450), @p6='?' (Size = 4000), @p7='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SET IMPLICIT_TRANSACTIONS OFF;
SET NOCOUNT ON;
INSERT INTO [AuthLogs] ([AuthType], [CreatedAt], [DeviceId], [FailureReason], [IpAddress], [NationalId], [Status], [UserAgent])
OUTPUT INSERTED.[Id]
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7);
2025-02-02 12:49:19.717 +03:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType9`2[[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Object, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-02-02 12:49:19.719 +03:00 [INF] Executed action NayifatAPI.Controllers.NotificationsController.GetNotifications (NayifatAPI) in 115.734ms
2025-02-02 12:49:19.723 +03:00 [INF] Executed endpoint 'NayifatAPI.Controllers.NotificationsController.GetNotifications (NayifatAPI)'
2025-02-02 12:49:19.724 +03:00 [INF] Request finished HTTP/1.1 POST http://07ca-46-152-255-232.ngrok-free.app/api/notifications/list - 200 null application/json; charset=utf-8 185.3007ms
2025-02-02 12:54:13.316 +03:00 [INF] Request starting HTTP/1.1 POST http://07ca-46-152-255-232.ngrok-free.app/api/notifications/list - application/json; charset=utf-8 47
2025-02-02 12:54:13.319 +03:00 [INF] Executing endpoint 'NayifatAPI.Controllers.NotificationsController.GetNotifications (NayifatAPI)'
2025-02-02 12:54:13.320 +03:00 [INF] Route matched with {action = "GetNotifications", controller = "Notifications"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetNotifications(NayifatAPI.Controllers.GetNotificationsRequest) on controller NayifatAPI.Controllers.NotificationsController (NayifatAPI).
2025-02-02 12:54:13.327 +03:00 [INF] Executed DbCommand (4ms) [Parameters=[@__providedApiKey_0='?' (Size = 255)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [a].[Key], [a].[CreatedAt], [a].[Description], [a].[ExpiresAt], [a].[IsActive], [a].[LastUsedAt]
FROM [ApiKeys] AS [a]
WHERE [a].[Key] = @__providedApiKey_0 AND [a].[IsActive] = CAST(1 AS bit)
2025-02-02 12:54:13.332 +03:00 [INF] Executed DbCommand (2ms) [Parameters=[@__request_NationalId_0='?' (Size = 450)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [u].[national_id], [u].[last_updated], [u].[notifications]
FROM [user_notifications] AS [u]
WHERE [u].[national_id] = @__request_NationalId_0
2025-02-02 12:54:13.339 +03:00 [INF] Executed DbCommand (4ms) [Parameters=[@__Parse_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [n].[Id], [n].[additional_data], [n].[Body], [n].[body_ar], [n].[body_en], [n].[created_at], [n].[expiry_at], [n].[Route], [n].[target_criteria], [n].[Title], [n].[title_ar], [n].[title_en]
FROM [notification_templates] AS [n]
WHERE [n].[Id] = @__Parse_0
2025-02-02 12:54:13.344 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@__Parse_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [n].[Id], [n].[additional_data], [n].[Body], [n].[body_ar], [n].[body_en], [n].[created_at], [n].[expiry_at], [n].[Route], [n].[target_criteria], [n].[Title], [n].[title_ar], [n].[title_en]
FROM [notification_templates] AS [n]
WHERE [n].[Id] = @__Parse_0
2025-02-02 12:54:13.424 +03:00 [INF] Executed DbCommand (78ms) [Parameters=[@p0='?' (Size = 4000), @p1='?' (DbType = DateTime2), @p2='?' (Size = 4000), @p3='?' (Size = 4000), @p4='?' (Size = 4000), @p5='?' (Size = 450), @p6='?' (Size = 4000), @p7='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SET IMPLICIT_TRANSACTIONS OFF;
SET NOCOUNT ON;
INSERT INTO [AuthLogs] ([AuthType], [CreatedAt], [DeviceId], [FailureReason], [IpAddress], [NationalId], [Status], [UserAgent])
OUTPUT INSERTED.[Id]
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7);
2025-02-02 12:54:13.427 +03:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType9`2[[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Object, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-02-02 12:54:13.428 +03:00 [INF] Executed action NayifatAPI.Controllers.NotificationsController.GetNotifications (NayifatAPI) in 107.0251ms
2025-02-02 12:54:13.429 +03:00 [INF] Executed endpoint 'NayifatAPI.Controllers.NotificationsController.GetNotifications (NayifatAPI)'
2025-02-02 12:54:13.430 +03:00 [INF] Request finished HTTP/1.1 POST http://07ca-46-152-255-232.ngrok-free.app/api/notifications/list - 200 null application/json; charset=utf-8 113.807ms
2025-02-02 12:54:39.379 +03:00 [INF] Request starting HTTP/1.1 POST http://07ca-46-152-255-232.ngrok-free.app/api/auth/signin - application/json; charset=utf-8 78
2025-02-02 12:54:39.382 +03:00 [INF] Executing endpoint 'NayifatAPI.Controllers.AuthController.SignIn (NayifatAPI)'
2025-02-02 12:54:39.384 +03:00 [INF] Route matched with {action = "SignIn", controller = "Auth"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] SignIn(NayifatAPI.Controllers.SignInRequest) on controller NayifatAPI.Controllers.AuthController (NayifatAPI).
2025-02-02 12:54:39.388 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@__providedApiKey_0='?' (Size = 255)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [a].[Key], [a].[CreatedAt], [a].[Description], [a].[ExpiresAt], [a].[IsActive], [a].[LastUsedAt]
FROM [ApiKeys] AS [a]
WHERE [a].[Key] = @__providedApiKey_0 AND [a].[IsActive] = CAST(1 AS bit)
2025-02-02 12:54:39.393 +03:00 [INF] Executed DbCommand (3ms) [Parameters=[@__request_NationalId_0='?' (Size = 450)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [c].[NationalId], [c].[AddNo], [c].[BuildingNo], [c].[City], [c].[Consent], [c].[ConsentDate], [c].[DateOfBirth], [c].[Dependents], [c].[District], [c].[Email], [c].[Employer], [c].[FamilyNameAr], [c].[FamilyNameEn], [c].[FirstNameAr], [c].[FirstNameEn], [c].[Iban], [c].[IdExpiryDate], [c].[Los], [c].[Mpin], [c].[MpinEnabled], [c].[NafathStatus], [c].[NafathTimestamp], [c].[Password], [c].[Phone], [c].[RegistrationDate], [c].[SalaryCustomer], [c].[SalaryDakhli], [c].[SecondNameAr], [c].[SecondNameEn], [c].[Sector], [c].[Street], [c].[ThirdNameAr], [c].[ThirdNameEn], [c].[Zipcode]
FROM [Customers] AS [c]
WHERE [c].[NationalId] = @__request_NationalId_0
2025-02-02 12:54:39.396 +03:00 [INF] Starting password verification for NationalId: 1064448614
2025-02-02 12:54:39.615 +03:00 [INF] Password verification result for NationalId 1064448614: Success
2025-02-02 12:54:39.619 +03:00 [INF] Executed DbCommand (3ms) [Parameters=[@__request_NationalId_0='?' (Size = 450), @__request_DeviceId_1='?' (Size = 450)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [c].[Id], [c].[BiometricEnabled], [c].[BiometricToken], [c].[CreatedAt], [c].[DeviceId], [c].[LastUsedAt], [c].[Manufacturer], [c].[Model], [c].[NationalId], [c].[OsVersion], [c].[Platform], [c].[Status]
FROM [Customer_Devices] AS [c]
WHERE [c].[NationalId] = @__request_NationalId_0 AND [c].[DeviceId] = @__request_DeviceId_1 AND [c].[Status] = N'active'
2025-02-02 12:54:39.700 +03:00 [INF] Executed DbCommand (77ms) [Parameters=[@p0='?' (Size = 4000), @p1='?' (DbType = DateTime2), @p2='?' (Size = 4000), @p3='?' (Size = 4000), @p4='?' (Size = 4000), @p5='?' (Size = 450), @p6='?' (Size = 4000), @p7='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SET IMPLICIT_TRANSACTIONS OFF;
SET NOCOUNT ON;
INSERT INTO [AuthLogs] ([AuthType], [CreatedAt], [DeviceId], [FailureReason], [IpAddress], [NationalId], [Status], [UserAgent])
OUTPUT INSERTED.[Id]
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7);
2025-02-02 12:54:39.703 +03:00 [INF] Executing ObjectResult, writing value of type '<>f__AnonymousType12`3[[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Object, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-02-02 12:54:39.704 +03:00 [INF] Executed action NayifatAPI.Controllers.AuthController.SignIn (NayifatAPI) in 318.5909ms
2025-02-02 12:54:39.706 +03:00 [INF] Executed endpoint 'NayifatAPI.Controllers.AuthController.SignIn (NayifatAPI)'
2025-02-02 12:54:39.707 +03:00 [INF] Request finished HTTP/1.1 POST http://07ca-46-152-255-232.ngrok-free.app/api/auth/signin - 401 null application/json; charset=utf-8 328.7484ms
2025-02-02 13:03:26.856 +03:00 [INF] Request starting HTTP/1.1 POST http://07ca-46-152-255-232.ngrok-free.app/api/notifications/list - application/json; charset=utf-8 47
2025-02-02 13:03:26.859 +03:00 [INF] Executing endpoint 'NayifatAPI.Controllers.NotificationsController.GetNotifications (NayifatAPI)'
2025-02-02 13:03:26.860 +03:00 [INF] Route matched with {action = "GetNotifications", controller = "Notifications"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetNotifications(NayifatAPI.Controllers.GetNotificationsRequest) on controller NayifatAPI.Controllers.NotificationsController (NayifatAPI).
2025-02-02 13:03:26.947 +03:00 [INF] Executed DbCommand (77ms) [Parameters=[@__providedApiKey_0='?' (Size = 255)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [a].[Key], [a].[CreatedAt], [a].[Description], [a].[ExpiresAt], [a].[IsActive], [a].[LastUsedAt]
FROM [ApiKeys] AS [a]
WHERE [a].[Key] = @__providedApiKey_0 AND [a].[IsActive] = CAST(1 AS bit)
2025-02-02 13:03:26.956 +03:00 [INF] Executed DbCommand (4ms) [Parameters=[@__request_NationalId_0='?' (Size = 450)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [u].[national_id], [u].[last_updated], [u].[notifications]
FROM [user_notifications] AS [u]
WHERE [u].[national_id] = @__request_NationalId_0
2025-02-02 13:03:26.963 +03:00 [INF] Executed DbCommand (3ms) [Parameters=[@__Parse_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [n].[Id], [n].[additional_data], [n].[Body], [n].[body_ar], [n].[body_en], [n].[created_at], [n].[expiry_at], [n].[Route], [n].[target_criteria], [n].[Title], [n].[title_ar], [n].[title_en]
FROM [notification_templates] AS [n]
WHERE [n].[Id] = @__Parse_0
2025-02-02 13:03:26.968 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@__Parse_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [n].[Id], [n].[additional_data], [n].[Body], [n].[body_ar], [n].[body_en], [n].[created_at], [n].[expiry_at], [n].[Route], [n].[target_criteria], [n].[Title], [n].[title_ar], [n].[title_en]
FROM [notification_templates] AS [n]
WHERE [n].[Id] = @__Parse_0
2025-02-02 13:03:26.974 +03:00 [INF] Executed DbCommand (3ms) [Parameters=[@p0='?' (Size = 4000), @p1='?' (DbType = DateTime2), @p2='?' (Size = 4000), @p3='?' (Size = 4000), @p4='?' (Size = 4000), @p5='?' (Size = 450), @p6='?' (Size = 4000), @p7='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SET IMPLICIT_TRANSACTIONS OFF;
SET NOCOUNT ON;
INSERT INTO [AuthLogs] ([AuthType], [CreatedAt], [DeviceId], [FailureReason], [IpAddress], [NationalId], [Status], [UserAgent])
OUTPUT INSERTED.[Id]
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7);
2025-02-02 13:03:26.976 +03:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType9`2[[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Object, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-02-02 13:03:26.978 +03:00 [INF] Executed action NayifatAPI.Controllers.NotificationsController.GetNotifications (NayifatAPI) in 116.0364ms
2025-02-02 13:03:26.979 +03:00 [INF] Executed endpoint 'NayifatAPI.Controllers.NotificationsController.GetNotifications (NayifatAPI)'
2025-02-02 13:03:26.981 +03:00 [INF] Request finished HTTP/1.1 POST http://07ca-46-152-255-232.ngrok-free.app/api/notifications/list - 200 null application/json; charset=utf-8 124.4545ms
2025-02-02 13:53:30.900 +03:00 [INF] Request starting HTTP/1.1 POST http://07ca-46-152-255-232.ngrok-free.app/api/notifications/list - application/json; charset=utf-8 47
2025-02-02 13:53:30.903 +03:00 [INF] Executing endpoint 'NayifatAPI.Controllers.NotificationsController.GetNotifications (NayifatAPI)'
2025-02-02 13:53:30.904 +03:00 [INF] Route matched with {action = "GetNotifications", controller = "Notifications"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetNotifications(NayifatAPI.Controllers.GetNotificationsRequest) on controller NayifatAPI.Controllers.NotificationsController (NayifatAPI).
2025-02-02 13:53:30.915 +03:00 [INF] Executed DbCommand (2ms) [Parameters=[@__providedApiKey_0='?' (Size = 255)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [a].[Key], [a].[CreatedAt], [a].[Description], [a].[ExpiresAt], [a].[IsActive], [a].[LastUsedAt]
FROM [ApiKeys] AS [a]
WHERE [a].[Key] = @__providedApiKey_0 AND [a].[IsActive] = CAST(1 AS bit)
2025-02-02 13:53:30.920 +03:00 [INF] Executed DbCommand (2ms) [Parameters=[@__request_NationalId_0='?' (Size = 450)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [u].[national_id], [u].[last_updated], [u].[notifications]
FROM [user_notifications] AS [u]
WHERE [u].[national_id] = @__request_NationalId_0
2025-02-02 13:53:30.925 +03:00 [INF] Executed DbCommand (2ms) [Parameters=[@__Parse_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [n].[Id], [n].[additional_data], [n].[Body], [n].[body_ar], [n].[body_en], [n].[created_at], [n].[expiry_at], [n].[Route], [n].[target_criteria], [n].[Title], [n].[title_ar], [n].[title_en]
FROM [notification_templates] AS [n]
WHERE [n].[Id] = @__Parse_0
2025-02-02 13:53:30.929 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@__Parse_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [n].[Id], [n].[additional_data], [n].[Body], [n].[body_ar], [n].[body_en], [n].[created_at], [n].[expiry_at], [n].[Route], [n].[target_criteria], [n].[Title], [n].[title_ar], [n].[title_en]
FROM [notification_templates] AS [n]
WHERE [n].[Id] = @__Parse_0
2025-02-02 13:53:31.007 +03:00 [INF] Executed DbCommand (75ms) [Parameters=[@p0='?' (Size = 4000), @p1='?' (DbType = DateTime2), @p2='?' (Size = 4000), @p3='?' (Size = 4000), @p4='?' (Size = 4000), @p5='?' (Size = 450), @p6='?' (Size = 4000), @p7='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SET IMPLICIT_TRANSACTIONS OFF;
SET NOCOUNT ON;
INSERT INTO [AuthLogs] ([AuthType], [CreatedAt], [DeviceId], [FailureReason], [IpAddress], [NationalId], [Status], [UserAgent])
OUTPUT INSERTED.[Id]
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7);
2025-02-02 13:53:31.010 +03:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType9`2[[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Object, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-02-02 13:53:31.011 +03:00 [INF] Executed action NayifatAPI.Controllers.NotificationsController.GetNotifications (NayifatAPI) in 105.3619ms
2025-02-02 13:53:31.013 +03:00 [INF] Executed endpoint 'NayifatAPI.Controllers.NotificationsController.GetNotifications (NayifatAPI)'
2025-02-02 13:53:31.015 +03:00 [INF] Request finished HTTP/1.1 POST http://07ca-46-152-255-232.ngrok-free.app/api/notifications/list - 200 null application/json; charset=utf-8 114.7881ms
2025-02-02 13:58:31.672 +03:00 [INF] Request starting HTTP/1.1 POST http://07ca-46-152-255-232.ngrok-free.app/api/notifications/list - application/json; charset=utf-8 47
2025-02-02 13:58:31.675 +03:00 [INF] Executing endpoint 'NayifatAPI.Controllers.NotificationsController.GetNotifications (NayifatAPI)'
2025-02-02 13:58:31.676 +03:00 [INF] Route matched with {action = "GetNotifications", controller = "Notifications"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetNotifications(NayifatAPI.Controllers.GetNotificationsRequest) on controller NayifatAPI.Controllers.NotificationsController (NayifatAPI).
2025-02-02 13:58:31.682 +03:00 [INF] Executed DbCommand (3ms) [Parameters=[@__providedApiKey_0='?' (Size = 255)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [a].[Key], [a].[CreatedAt], [a].[Description], [a].[ExpiresAt], [a].[IsActive], [a].[LastUsedAt]
FROM [ApiKeys] AS [a]
WHERE [a].[Key] = @__providedApiKey_0 AND [a].[IsActive] = CAST(1 AS bit)
2025-02-02 13:58:31.688 +03:00 [INF] Executed DbCommand (3ms) [Parameters=[@__request_NationalId_0='?' (Size = 450)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [u].[national_id], [u].[last_updated], [u].[notifications]
FROM [user_notifications] AS [u]
WHERE [u].[national_id] = @__request_NationalId_0
2025-02-02 13:58:31.692 +03:00 [INF] Executed DbCommand (2ms) [Parameters=[@__Parse_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [n].[Id], [n].[additional_data], [n].[Body], [n].[body_ar], [n].[body_en], [n].[created_at], [n].[expiry_at], [n].[Route], [n].[target_criteria], [n].[Title], [n].[title_ar], [n].[title_en]
FROM [notification_templates] AS [n]
WHERE [n].[Id] = @__Parse_0
2025-02-02 13:58:31.695 +03:00 [INF] Executed DbCommand (0ms) [Parameters=[@__Parse_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [n].[Id], [n].[additional_data], [n].[Body], [n].[body_ar], [n].[body_en], [n].[created_at], [n].[expiry_at], [n].[Route], [n].[target_criteria], [n].[Title], [n].[title_ar], [n].[title_en]
FROM [notification_templates] AS [n]
WHERE [n].[Id] = @__Parse_0
2025-02-02 13:58:31.776 +03:00 [INF] Executed DbCommand (77ms) [Parameters=[@p0='?' (Size = 4000), @p1='?' (DbType = DateTime2), @p2='?' (Size = 4000), @p3='?' (Size = 4000), @p4='?' (Size = 4000), @p5='?' (Size = 450), @p6='?' (Size = 4000), @p7='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SET IMPLICIT_TRANSACTIONS OFF;
SET NOCOUNT ON;
INSERT INTO [AuthLogs] ([AuthType], [CreatedAt], [DeviceId], [FailureReason], [IpAddress], [NationalId], [Status], [UserAgent])
OUTPUT INSERTED.[Id]
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7);
2025-02-02 13:58:31.779 +03:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType9`2[[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Object, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-02-02 13:58:31.780 +03:00 [INF] Executed action NayifatAPI.Controllers.NotificationsController.GetNotifications (NayifatAPI) in 103.1868ms
2025-02-02 13:58:31.784 +03:00 [INF] Executed endpoint 'NayifatAPI.Controllers.NotificationsController.GetNotifications (NayifatAPI)'
2025-02-02 13:58:31.786 +03:00 [INF] Request finished HTTP/1.1 POST http://07ca-46-152-255-232.ngrok-free.app/api/notifications/list - 200 null application/json; charset=utf-8 114.8709ms
2025-02-02 14:01:20.755 +03:00 [INF] Request starting HTTP/1.1 POST http://07ca-46-152-255-232.ngrok-free.app/api/notifications/list - application/json; charset=utf-8 47
2025-02-02 14:01:20.758 +03:00 [INF] Executing endpoint 'NayifatAPI.Controllers.NotificationsController.GetNotifications (NayifatAPI)'
2025-02-02 14:01:20.759 +03:00 [INF] Route matched with {action = "GetNotifications", controller = "Notifications"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetNotifications(NayifatAPI.Controllers.GetNotificationsRequest) on controller NayifatAPI.Controllers.NotificationsController (NayifatAPI).
2025-02-02 14:01:20.770 +03:00 [INF] Executed DbCommand (8ms) [Parameters=[@__providedApiKey_0='?' (Size = 255)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [a].[Key], [a].[CreatedAt], [a].[Description], [a].[ExpiresAt], [a].[IsActive], [a].[LastUsedAt]
FROM [ApiKeys] AS [a]
WHERE [a].[Key] = @__providedApiKey_0 AND [a].[IsActive] = CAST(1 AS bit)
2025-02-02 14:01:20.775 +03:00 [INF] Executed DbCommand (3ms) [Parameters=[@__request_NationalId_0='?' (Size = 450)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [u].[national_id], [u].[last_updated], [u].[notifications]
FROM [user_notifications] AS [u]
WHERE [u].[national_id] = @__request_NationalId_0
2025-02-02 14:01:20.782 +03:00 [INF] Executed DbCommand (4ms) [Parameters=[@__Parse_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [n].[Id], [n].[additional_data], [n].[Body], [n].[body_ar], [n].[body_en], [n].[created_at], [n].[expiry_at], [n].[Route], [n].[target_criteria], [n].[Title], [n].[title_ar], [n].[title_en]
FROM [notification_templates] AS [n]
WHERE [n].[Id] = @__Parse_0
2025-02-02 14:01:20.785 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@__Parse_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [n].[Id], [n].[additional_data], [n].[Body], [n].[body_ar], [n].[body_en], [n].[created_at], [n].[expiry_at], [n].[Route], [n].[target_criteria], [n].[Title], [n].[title_ar], [n].[title_en]
FROM [notification_templates] AS [n]
WHERE [n].[Id] = @__Parse_0
2025-02-02 14:01:20.795 +03:00 [INF] Executed DbCommand (7ms) [Parameters=[@p0='?' (Size = 4000), @p1='?' (DbType = DateTime2), @p2='?' (Size = 4000), @p3='?' (Size = 4000), @p4='?' (Size = 4000), @p5='?' (Size = 450), @p6='?' (Size = 4000), @p7='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SET IMPLICIT_TRANSACTIONS OFF;
SET NOCOUNT ON;
INSERT INTO [AuthLogs] ([AuthType], [CreatedAt], [DeviceId], [FailureReason], [IpAddress], [NationalId], [Status], [UserAgent])
OUTPUT INSERTED.[Id]
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7);
2025-02-02 14:01:20.801 +03:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType9`2[[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Object, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-02-02 14:01:20.804 +03:00 [INF] Executed action NayifatAPI.Controllers.NotificationsController.GetNotifications (NayifatAPI) in 43.3847ms
2025-02-02 14:01:20.807 +03:00 [INF] Executed endpoint 'NayifatAPI.Controllers.NotificationsController.GetNotifications (NayifatAPI)'
2025-02-02 14:01:20.817 +03:00 [INF] Request finished HTTP/1.1 POST http://07ca-46-152-255-232.ngrok-free.app/api/notifications/list - 200 null application/json; charset=utf-8 62.33ms
2025-02-02 14:01:52.500 +03:00 [INF] Request starting HTTP/1.1 POST http://07ca-46-152-255-232.ngrok-free.app/api/auth/signin - application/json; charset=utf-8 78
2025-02-02 14:01:52.502 +03:00 [INF] Executing endpoint 'NayifatAPI.Controllers.AuthController.SignIn (NayifatAPI)'
2025-02-02 14:01:52.503 +03:00 [INF] Route matched with {action = "SignIn", controller = "Auth"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] SignIn(NayifatAPI.Controllers.SignInRequest) on controller NayifatAPI.Controllers.AuthController (NayifatAPI).
2025-02-02 14:01:52.512 +03:00 [INF] Executed DbCommand (3ms) [Parameters=[@__providedApiKey_0='?' (Size = 255)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [a].[Key], [a].[CreatedAt], [a].[Description], [a].[ExpiresAt], [a].[IsActive], [a].[LastUsedAt]
FROM [ApiKeys] AS [a]
WHERE [a].[Key] = @__providedApiKey_0 AND [a].[IsActive] = CAST(1 AS bit)
2025-02-02 14:01:52.519 +03:00 [INF] Executed DbCommand (3ms) [Parameters=[@__request_NationalId_0='?' (Size = 450)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [c].[NationalId], [c].[AddNo], [c].[BuildingNo], [c].[City], [c].[Consent], [c].[ConsentDate], [c].[DateOfBirth], [c].[Dependents], [c].[District], [c].[Email], [c].[Employer], [c].[FamilyNameAr], [c].[FamilyNameEn], [c].[FirstNameAr], [c].[FirstNameEn], [c].[Iban], [c].[IdExpiryDate], [c].[Los], [c].[Mpin], [c].[MpinEnabled], [c].[NafathStatus], [c].[NafathTimestamp], [c].[Password], [c].[Phone], [c].[RegistrationDate], [c].[SalaryCustomer], [c].[SalaryDakhli], [c].[SecondNameAr], [c].[SecondNameEn], [c].[Sector], [c].[Street], [c].[ThirdNameAr], [c].[ThirdNameEn], [c].[Zipcode]
FROM [Customers] AS [c]
WHERE [c].[NationalId] = @__request_NationalId_0
2025-02-02 14:01:52.522 +03:00 [INF] Starting password verification for NationalId: 1064448614
2025-02-02 14:01:52.737 +03:00 [INF] Password verification result for NationalId 1064448614: Success
2025-02-02 14:01:52.742 +03:00 [INF] Executed DbCommand (3ms) [Parameters=[@__request_NationalId_0='?' (Size = 450), @__request_DeviceId_1='?' (Size = 450)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [c].[Id], [c].[BiometricEnabled], [c].[BiometricToken], [c].[CreatedAt], [c].[DeviceId], [c].[LastUsedAt], [c].[Manufacturer], [c].[Model], [c].[NationalId], [c].[OsVersion], [c].[Platform], [c].[Status]
FROM [Customer_Devices] AS [c]
WHERE [c].[NationalId] = @__request_NationalId_0 AND [c].[DeviceId] = @__request_DeviceId_1 AND [c].[Status] = N'active'
2025-02-02 14:01:52.822 +03:00 [INF] Executed DbCommand (76ms) [Parameters=[@p0='?' (Size = 4000), @p1='?' (DbType = DateTime2), @p2='?' (Size = 4000), @p3='?' (Size = 4000), @p4='?' (Size = 4000), @p5='?' (Size = 450), @p6='?' (Size = 4000), @p7='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SET IMPLICIT_TRANSACTIONS OFF;
SET NOCOUNT ON;
INSERT INTO [AuthLogs] ([AuthType], [CreatedAt], [DeviceId], [FailureReason], [IpAddress], [NationalId], [Status], [UserAgent])
OUTPUT INSERTED.[Id]
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7);
2025-02-02 14:01:52.828 +03:00 [INF] Executing ObjectResult, writing value of type '<>f__AnonymousType12`3[[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Object, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-02-02 14:01:52.829 +03:00 [INF] Executed action NayifatAPI.Controllers.AuthController.SignIn (NayifatAPI) in 321.4083ms
2025-02-02 14:01:52.830 +03:00 [INF] Executed endpoint 'NayifatAPI.Controllers.AuthController.SignIn (NayifatAPI)'
2025-02-02 14:01:52.832 +03:00 [INF] Request finished HTTP/1.1 POST http://07ca-46-152-255-232.ngrok-free.app/api/auth/signin - 401 null application/json; charset=utf-8 332.2931ms
2025-02-02 14:05:38.659 +03:00 [INF] Request starting HTTP/1.1 POST http://07ca-46-152-255-232.ngrok-free.app/api/auth/signin - application/json; charset=utf-8 100
2025-02-02 14:05:38.662 +03:00 [INF] Executing endpoint 'NayifatAPI.Controllers.AuthController.SignIn (NayifatAPI)'
2025-02-02 14:05:38.665 +03:00 [INF] Route matched with {action = "SignIn", controller = "Auth"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] SignIn(NayifatAPI.Controllers.SignInRequest) on controller NayifatAPI.Controllers.AuthController (NayifatAPI).
2025-02-02 14:05:38.783 +03:00 [INF] Executed DbCommand (4ms) [Parameters=[@__providedApiKey_0='?' (Size = 255)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [a].[Key], [a].[CreatedAt], [a].[Description], [a].[ExpiresAt], [a].[IsActive], [a].[LastUsedAt]
FROM [ApiKeys] AS [a]
WHERE [a].[Key] = @__providedApiKey_0 AND [a].[IsActive] = CAST(1 AS bit)
2025-02-02 14:05:38.807 +03:00 [INF] Executed DbCommand (22ms) [Parameters=[@__request_NationalId_0='?' (Size = 450)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [c].[NationalId], [c].[AddNo], [c].[BuildingNo], [c].[City], [c].[Consent], [c].[ConsentDate], [c].[DateOfBirth], [c].[Dependents], [c].[District], [c].[Email], [c].[Employer], [c].[FamilyNameAr], [c].[FamilyNameEn], [c].[FirstNameAr], [c].[FirstNameEn], [c].[Iban], [c].[IdExpiryDate], [c].[Los], [c].[Mpin], [c].[MpinEnabled], [c].[NafathStatus], [c].[NafathTimestamp], [c].[Password], [c].[Phone], [c].[RegistrationDate], [c].[SalaryCustomer], [c].[SalaryDakhli], [c].[SecondNameAr], [c].[SecondNameEn], [c].[Sector], [c].[Street], [c].[ThirdNameAr], [c].[ThirdNameEn], [c].[Zipcode]
FROM [Customers] AS [c]
WHERE [c].[NationalId] = @__request_NationalId_0
2025-02-02 14:05:38.843 +03:00 [INF] Starting password verification for NationalId: 1064448614
2025-02-02 14:05:39.159 +03:00 [INF] Password verification result for NationalId 1064448614: Success
2025-02-02 14:05:39.163 +03:00 [INF] Executed DbCommand (3ms) [Parameters=[@__request_NationalId_0='?' (Size = 450), @__request_DeviceId_1='?' (Size = 450)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [c].[Id], [c].[BiometricEnabled], [c].[BiometricToken], [c].[CreatedAt], [c].[DeviceId], [c].[LastUsedAt], [c].[Manufacturer], [c].[Model], [c].[NationalId], [c].[OsVersion], [c].[Platform], [c].[Status]
FROM [Customer_Devices] AS [c]
WHERE [c].[NationalId] = @__request_NationalId_0 AND [c].[DeviceId] = @__request_DeviceId_1 AND [c].[Status] = N'active'
2025-02-02 14:05:39.245 +03:00 [INF] Executed DbCommand (78ms) [Parameters=[@p0='?' (Size = 4000), @p1='?' (DbType = DateTime2), @p2='?' (Size = 4000), @p3='?' (Size = 4000), @p4='?' (Size = 4000), @p5='?' (Size = 450), @p6='?' (Size = 4000), @p7='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SET IMPLICIT_TRANSACTIONS OFF;
SET NOCOUNT ON;
INSERT INTO [AuthLogs] ([AuthType], [CreatedAt], [DeviceId], [FailureReason], [IpAddress], [NationalId], [Status], [UserAgent])
OUTPUT INSERTED.[Id]
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7);
2025-02-02 14:05:39.271 +03:00 [INF] Executing ObjectResult, writing value of type '<>f__AnonymousType12`3[[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Object, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-02-02 14:05:39.308 +03:00 [INF] Executed action NayifatAPI.Controllers.AuthController.SignIn (NayifatAPI) in 638.574ms
2025-02-02 14:05:39.328 +03:00 [INF] Executed endpoint 'NayifatAPI.Controllers.AuthController.SignIn (NayifatAPI)'
2025-02-02 14:05:39.341 +03:00 [INF] Request finished HTTP/1.1 POST http://07ca-46-152-255-232.ngrok-free.app/api/auth/signin - 401 null application/json; charset=utf-8 682.7026ms
2025-02-02 14:05:40.006 +03:00 [INF] Request starting HTTP/1.1 POST http://07ca-46-152-255-232.ngrok-free.app/api/device/unregister - application/json; charset=utf-8 174
2025-02-02 14:05:40.254 +03:00 [INF] Request finished HTTP/1.1 POST http://07ca-46-152-255-232.ngrok-free.app/api/device/unregister - 404 0 null 247.9306ms
2025-02-02 14:05:40.258 +03:00 [INF] Request reached the end of the middleware pipeline without being handled by application code. Request path: POST http://07ca-46-152-255-232.ngrok-free.app/api/device/unregister, Response status code: 404
2025-02-02 14:05:40.551 +03:00 [INF] Request starting HTTP/1.1 POST http://07ca-46-152-255-232.ngrok-free.app/api/device - application/json; charset=utf-8 185
2025-02-02 14:05:40.556 +03:00 [INF] Executing endpoint 'NayifatAPI.Controllers.DeviceController.RegisterDevice (NayifatAPI)'
2025-02-02 14:05:40.587 +03:00 [INF] Route matched with {action = "RegisterDevice", controller = "Device"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] RegisterDevice(NayifatAPI.Controllers.RegisterDeviceRequest) on controller NayifatAPI.Controllers.DeviceController (NayifatAPI).
2025-02-02 14:05:40.606 +03:00 [INF] Executing ObjectResult, writing value of type '<>f__AnonymousType11`2[[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-02-02 14:05:40.608 +03:00 [INF] Executed action NayifatAPI.Controllers.DeviceController.RegisterDevice (NayifatAPI) in 14.0794ms
2025-02-02 14:05:40.609 +03:00 [INF] Executed endpoint 'NayifatAPI.Controllers.DeviceController.RegisterDevice (NayifatAPI)'
2025-02-02 14:05:40.610 +03:00 [INF] Request finished HTTP/1.1 POST http://07ca-46-152-255-232.ngrok-free.app/api/device - 401 null application/json; charset=utf-8 59.5926ms
2025-02-02 14:05:40.960 +03:00 [INF] Request starting HTTP/1.1 POST http://07ca-46-152-255-232.ngrok-free.app/api/auth/signin - application/json; charset=utf-8 100
2025-02-02 14:05:40.971 +03:00 [INF] Executing endpoint 'NayifatAPI.Controllers.AuthController.SignIn (NayifatAPI)'
2025-02-02 14:05:40.986 +03:00 [INF] Route matched with {action = "SignIn", controller = "Auth"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] SignIn(NayifatAPI.Controllers.SignInRequest) on controller NayifatAPI.Controllers.AuthController (NayifatAPI).
2025-02-02 14:05:40.989 +03:00 [INF] Executed DbCommand (0ms) [Parameters=[@__providedApiKey_0='?' (Size = 255)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [a].[Key], [a].[CreatedAt], [a].[Description], [a].[ExpiresAt], [a].[IsActive], [a].[LastUsedAt]
FROM [ApiKeys] AS [a]
WHERE [a].[Key] = @__providedApiKey_0 AND [a].[IsActive] = CAST(1 AS bit)
2025-02-02 14:05:40.992 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@__request_NationalId_0='?' (Size = 450)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [c].[NationalId], [c].[AddNo], [c].[BuildingNo], [c].[City], [c].[Consent], [c].[ConsentDate], [c].[DateOfBirth], [c].[Dependents], [c].[District], [c].[Email], [c].[Employer], [c].[FamilyNameAr], [c].[FamilyNameEn], [c].[FirstNameAr], [c].[FirstNameEn], [c].[Iban], [c].[IdExpiryDate], [c].[Los], [c].[Mpin], [c].[MpinEnabled], [c].[NafathStatus], [c].[NafathTimestamp], [c].[Password], [c].[Phone], [c].[RegistrationDate], [c].[SalaryCustomer], [c].[SalaryDakhli], [c].[SecondNameAr], [c].[SecondNameEn], [c].[Sector], [c].[Street], [c].[ThirdNameAr], [c].[ThirdNameEn], [c].[Zipcode]
FROM [Customers] AS [c]
WHERE [c].[NationalId] = @__request_NationalId_0
2025-02-02 14:05:41.018 +03:00 [INF] Starting password verification for NationalId: 1064448614
2025-02-02 14:05:41.268 +03:00 [INF] Password verification result for NationalId 1064448614: Success
2025-02-02 14:05:41.270 +03:00 [INF] Executed DbCommand (0ms) [Parameters=[@__request_NationalId_0='?' (Size = 450), @__request_DeviceId_1='?' (Size = 450)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [c].[Id], [c].[BiometricEnabled], [c].[BiometricToken], [c].[CreatedAt], [c].[DeviceId], [c].[LastUsedAt], [c].[Manufacturer], [c].[Model], [c].[NationalId], [c].[OsVersion], [c].[Platform], [c].[Status]
FROM [Customer_Devices] AS [c]
WHERE [c].[NationalId] = @__request_NationalId_0 AND [c].[DeviceId] = @__request_DeviceId_1 AND [c].[Status] = N'active'
2025-02-02 14:05:41.278 +03:00 [INF] Executed DbCommand (6ms) [Parameters=[@p0='?' (Size = 4000), @p1='?' (DbType = DateTime2), @p2='?' (Size = 4000), @p3='?' (Size = 4000), @p4='?' (Size = 4000), @p5='?' (Size = 450), @p6='?' (Size = 4000), @p7='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SET IMPLICIT_TRANSACTIONS OFF;
SET NOCOUNT ON;
INSERT INTO [AuthLogs] ([AuthType], [CreatedAt], [DeviceId], [FailureReason], [IpAddress], [NationalId], [Status], [UserAgent])
OUTPUT INSERTED.[Id]
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7);
2025-02-02 14:05:41.281 +03:00 [INF] Executing ObjectResult, writing value of type '<>f__AnonymousType12`3[[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Object, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-02-02 14:05:41.282 +03:00 [INF] Executed action NayifatAPI.Controllers.AuthController.SignIn (NayifatAPI) in 294.4481ms
2025-02-02 14:05:41.283 +03:00 [INF] Executed endpoint 'NayifatAPI.Controllers.AuthController.SignIn (NayifatAPI)'
2025-02-02 14:05:41.284 +03:00 [INF] Request finished HTTP/1.1 POST http://07ca-46-152-255-232.ngrok-free.app/api/auth/signin - 401 null application/json; charset=utf-8 324.1278ms
2025-02-02 14:06:00.836 +03:00 [INF] Request starting HTTP/1.1 POST http://07ca-46-152-255-232.ngrok-free.app/api/notifications/list - application/json; charset=utf-8 47
2025-02-02 14:06:00.841 +03:00 [INF] Executing endpoint 'NayifatAPI.Controllers.NotificationsController.GetNotifications (NayifatAPI)'
2025-02-02 14:06:00.843 +03:00 [INF] Route matched with {action = "GetNotifications", controller = "Notifications"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetNotifications(NayifatAPI.Controllers.GetNotificationsRequest) on controller NayifatAPI.Controllers.NotificationsController (NayifatAPI).
2025-02-02 14:06:00.846 +03:00 [INF] Executed DbCommand (0ms) [Parameters=[@__providedApiKey_0='?' (Size = 255)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [a].[Key], [a].[CreatedAt], [a].[Description], [a].[ExpiresAt], [a].[IsActive], [a].[LastUsedAt]
FROM [ApiKeys] AS [a]
WHERE [a].[Key] = @__providedApiKey_0 AND [a].[IsActive] = CAST(1 AS bit)
2025-02-02 14:06:00.850 +03:00 [INF] Executed DbCommand (2ms) [Parameters=[@__request_NationalId_0='?' (Size = 450)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [u].[national_id], [u].[last_updated], [u].[notifications]
FROM [user_notifications] AS [u]
WHERE [u].[national_id] = @__request_NationalId_0
2025-02-02 14:06:00.854 +03:00 [INF] Executed DbCommand (2ms) [Parameters=[@__Parse_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [n].[Id], [n].[additional_data], [n].[Body], [n].[body_ar], [n].[body_en], [n].[created_at], [n].[expiry_at], [n].[Route], [n].[target_criteria], [n].[Title], [n].[title_ar], [n].[title_en]
FROM [notification_templates] AS [n]
WHERE [n].[Id] = @__Parse_0
2025-02-02 14:06:00.856 +03:00 [INF] Executed DbCommand (0ms) [Parameters=[@__Parse_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [n].[Id], [n].[additional_data], [n].[Body], [n].[body_ar], [n].[body_en], [n].[created_at], [n].[expiry_at], [n].[Route], [n].[target_criteria], [n].[Title], [n].[title_ar], [n].[title_en]
FROM [notification_templates] AS [n]
WHERE [n].[Id] = @__Parse_0
2025-02-02 14:06:00.866 +03:00 [INF] Executed DbCommand (6ms) [Parameters=[@p0='?' (Size = 4000), @p1='?' (DbType = DateTime2), @p2='?' (Size = 4000), @p3='?' (Size = 4000), @p4='?' (Size = 4000), @p5='?' (Size = 450), @p6='?' (Size = 4000), @p7='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SET IMPLICIT_TRANSACTIONS OFF;
SET NOCOUNT ON;
INSERT INTO [AuthLogs] ([AuthType], [CreatedAt], [DeviceId], [FailureReason], [IpAddress], [NationalId], [Status], [UserAgent])
OUTPUT INSERTED.[Id]
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7);
2025-02-02 14:06:00.868 +03:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType9`2[[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Object, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-02-02 14:06:00.869 +03:00 [INF] Executed action NayifatAPI.Controllers.NotificationsController.GetNotifications (NayifatAPI) in 23.9537ms
2025-02-02 14:06:00.870 +03:00 [INF] Executed endpoint 'NayifatAPI.Controllers.NotificationsController.GetNotifications (NayifatAPI)'
2025-02-02 14:06:00.871 +03:00 [INF] Request finished HTTP/1.1 POST http://07ca-46-152-255-232.ngrok-free.app/api/notifications/list - 200 null application/json; charset=utf-8 35.0468ms
2025-02-02 14:06:09.498 +03:00 [INF] Request starting HTTP/1.1 POST http://07ca-46-152-255-232.ngrok-free.app/api/device/unregister - application/json; charset=utf-8 174
2025-02-02 14:06:09.500 +03:00 [INF] Request finished HTTP/1.1 POST http://07ca-46-152-255-232.ngrok-free.app/api/device/unregister - 404 0 null 1.8896ms
2025-02-02 14:06:09.502 +03:00 [INF] Request reached the end of the middleware pipeline without being handled by application code. Request path: POST http://07ca-46-152-255-232.ngrok-free.app/api/device/unregister, Response status code: 404
2025-02-02 14:06:10.764 +03:00 [INF] Request starting HTTP/1.1 POST http://07ca-46-152-255-232.ngrok-free.app/api/notifications/list - application/json; charset=utf-8 47
2025-02-02 14:06:10.767 +03:00 [INF] Executing endpoint 'NayifatAPI.Controllers.NotificationsController.GetNotifications (NayifatAPI)'
2025-02-02 14:06:10.767 +03:00 [INF] Route matched with {action = "GetNotifications", controller = "Notifications"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetNotifications(NayifatAPI.Controllers.GetNotificationsRequest) on controller NayifatAPI.Controllers.NotificationsController (NayifatAPI).
2025-02-02 14:06:10.772 +03:00 [INF] Executed DbCommand (2ms) [Parameters=[@__providedApiKey_0='?' (Size = 255)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [a].[Key], [a].[CreatedAt], [a].[Description], [a].[ExpiresAt], [a].[IsActive], [a].[LastUsedAt]
FROM [ApiKeys] AS [a]
WHERE [a].[Key] = @__providedApiKey_0 AND [a].[IsActive] = CAST(1 AS bit)
2025-02-02 14:06:10.776 +03:00 [INF] Executed DbCommand (2ms) [Parameters=[@__request_NationalId_0='?' (Size = 450)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [u].[national_id], [u].[last_updated], [u].[notifications]
FROM [user_notifications] AS [u]
WHERE [u].[national_id] = @__request_NationalId_0
2025-02-02 14:06:10.780 +03:00 [INF] Executed DbCommand (2ms) [Parameters=[@__Parse_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [n].[Id], [n].[additional_data], [n].[Body], [n].[body_ar], [n].[body_en], [n].[created_at], [n].[expiry_at], [n].[Route], [n].[target_criteria], [n].[Title], [n].[title_ar], [n].[title_en]
FROM [notification_templates] AS [n]
WHERE [n].[Id] = @__Parse_0
2025-02-02 14:06:10.784 +03:00 [INF] Executed DbCommand (2ms) [Parameters=[@__Parse_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [n].[Id], [n].[additional_data], [n].[Body], [n].[body_ar], [n].[body_en], [n].[created_at], [n].[expiry_at], [n].[Route], [n].[target_criteria], [n].[Title], [n].[title_ar], [n].[title_en]
FROM [notification_templates] AS [n]
WHERE [n].[Id] = @__Parse_0
2025-02-02 14:06:10.796 +03:00 [INF] Executed DbCommand (9ms) [Parameters=[@p0='?' (Size = 4000), @p1='?' (DbType = DateTime2), @p2='?' (Size = 4000), @p3='?' (Size = 4000), @p4='?' (Size = 4000), @p5='?' (Size = 450), @p6='?' (Size = 4000), @p7='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SET IMPLICIT_TRANSACTIONS OFF;
SET NOCOUNT ON;
INSERT INTO [AuthLogs] ([AuthType], [CreatedAt], [DeviceId], [FailureReason], [IpAddress], [NationalId], [Status], [UserAgent])
OUTPUT INSERTED.[Id]
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7);
2025-02-02 14:06:10.799 +03:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType9`2[[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Object, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-02-02 14:06:10.800 +03:00 [INF] Executed action NayifatAPI.Controllers.NotificationsController.GetNotifications (NayifatAPI) in 31.6157ms
2025-02-02 14:06:10.801 +03:00 [INF] Executed endpoint 'NayifatAPI.Controllers.NotificationsController.GetNotifications (NayifatAPI)'
2025-02-02 14:06:10.802 +03:00 [INF] Request finished HTTP/1.1 POST http://07ca-46-152-255-232.ngrok-free.app/api/notifications/list - 200 null application/json; charset=utf-8 37.482ms
2025-02-02 14:06:26.185 +03:00 [INF] Request starting HTTP/1.1 POST http://07ca-46-152-255-232.ngrok-free.app/api/auth/signin - application/json; charset=utf-8 100
2025-02-02 14:06:26.188 +03:00 [INF] Executing endpoint 'NayifatAPI.Controllers.AuthController.SignIn (NayifatAPI)'
2025-02-02 14:06:26.189 +03:00 [INF] Route matched with {action = "SignIn", controller = "Auth"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] SignIn(NayifatAPI.Controllers.SignInRequest) on controller NayifatAPI.Controllers.AuthController (NayifatAPI).
2025-02-02 14:06:26.193 +03:00 [INF] Executed DbCommand (2ms) [Parameters=[@__providedApiKey_0='?' (Size = 255)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [a].[Key], [a].[CreatedAt], [a].[Description], [a].[ExpiresAt], [a].[IsActive], [a].[LastUsedAt]
FROM [ApiKeys] AS [a]
WHERE [a].[Key] = @__providedApiKey_0 AND [a].[IsActive] = CAST(1 AS bit)
2025-02-02 14:06:26.198 +03:00 [INF] Executed DbCommand (3ms) [Parameters=[@__request_NationalId_0='?' (Size = 450)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [c].[NationalId], [c].[AddNo], [c].[BuildingNo], [c].[City], [c].[Consent], [c].[ConsentDate], [c].[DateOfBirth], [c].[Dependents], [c].[District], [c].[Email], [c].[Employer], [c].[FamilyNameAr], [c].[FamilyNameEn], [c].[FirstNameAr], [c].[FirstNameEn], [c].[Iban], [c].[IdExpiryDate], [c].[Los], [c].[Mpin], [c].[MpinEnabled], [c].[NafathStatus], [c].[NafathTimestamp], [c].[Password], [c].[Phone], [c].[RegistrationDate], [c].[SalaryCustomer], [c].[SalaryDakhli], [c].[SecondNameAr], [c].[SecondNameEn], [c].[Sector], [c].[Street], [c].[ThirdNameAr], [c].[ThirdNameEn], [c].[Zipcode]
FROM [Customers] AS [c]
WHERE [c].[NationalId] = @__request_NationalId_0
2025-02-02 14:06:26.200 +03:00 [INF] Starting password verification for NationalId: 1064448614
2025-02-02 14:06:26.381 +03:00 [INF] Password verification result for NationalId 1064448614: Success
2025-02-02 14:06:26.384 +03:00 [INF] Executed DbCommand (3ms) [Parameters=[@__request_NationalId_0='?' (Size = 450), @__request_DeviceId_1='?' (Size = 450)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [c].[Id], [c].[BiometricEnabled], [c].[BiometricToken], [c].[CreatedAt], [c].[DeviceId], [c].[LastUsedAt], [c].[Manufacturer], [c].[Model], [c].[NationalId], [c].[OsVersion], [c].[Platform], [c].[Status]
FROM [Customer_Devices] AS [c]
WHERE [c].[NationalId] = @__request_NationalId_0 AND [c].[DeviceId] = @__request_DeviceId_1 AND [c].[Status] = N'active'
2025-02-02 14:06:26.463 +03:00 [INF] Executed DbCommand (75ms) [Parameters=[@p0='?' (Size = 4000), @p1='?' (DbType = DateTime2), @p2='?' (Size = 4000), @p3='?' (Size = 4000), @p4='?' (Size = 4000), @p5='?' (Size = 450), @p6='?' (Size = 4000), @p7='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SET IMPLICIT_TRANSACTIONS OFF;
SET NOCOUNT ON;
INSERT INTO [AuthLogs] ([AuthType], [CreatedAt], [DeviceId], [FailureReason], [IpAddress], [NationalId], [Status], [UserAgent])
OUTPUT INSERTED.[Id]
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7);
2025-02-02 14:06:26.465 +03:00 [INF] Executing ObjectResult, writing value of type '<>f__AnonymousType12`3[[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Object, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-02-02 14:06:26.467 +03:00 [INF] Executed action NayifatAPI.Controllers.AuthController.SignIn (NayifatAPI) in 276.8369ms
2025-02-02 14:06:26.471 +03:00 [INF] Executed endpoint 'NayifatAPI.Controllers.AuthController.SignIn (NayifatAPI)'
2025-02-02 14:06:26.472 +03:00 [INF] Request finished HTTP/1.1 POST http://07ca-46-152-255-232.ngrok-free.app/api/auth/signin - 401 null application/json; charset=utf-8 286.9003ms
2025-02-02 14:06:26.902 +03:00 [INF] Request starting HTTP/1.1 POST http://07ca-46-152-255-232.ngrok-free.app/api/device/unregister - application/json; charset=utf-8 174
2025-02-02 14:06:26.904 +03:00 [INF] Request finished HTTP/1.1 POST http://07ca-46-152-255-232.ngrok-free.app/api/device/unregister - 404 0 null 2.5376ms
2025-02-02 14:06:26.906 +03:00 [INF] Request reached the end of the middleware pipeline without being handled by application code. Request path: POST http://07ca-46-152-255-232.ngrok-free.app/api/device/unregister, Response status code: 404
2025-02-02 14:06:27.186 +03:00 [INF] Request starting HTTP/1.1 POST http://07ca-46-152-255-232.ngrok-free.app/api/device - application/json; charset=utf-8 185
2025-02-02 14:06:27.190 +03:00 [INF] Executing endpoint 'NayifatAPI.Controllers.DeviceController.RegisterDevice (NayifatAPI)'
2025-02-02 14:06:27.191 +03:00 [INF] Route matched with {action = "RegisterDevice", controller = "Device"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] RegisterDevice(NayifatAPI.Controllers.RegisterDeviceRequest) on controller NayifatAPI.Controllers.DeviceController (NayifatAPI).
2025-02-02 14:06:27.193 +03:00 [INF] Executing ObjectResult, writing value of type '<>f__AnonymousType11`2[[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-02-02 14:06:27.194 +03:00 [INF] Executed action NayifatAPI.Controllers.DeviceController.RegisterDevice (NayifatAPI) in 1.9672ms
2025-02-02 14:06:27.195 +03:00 [INF] Executed endpoint 'NayifatAPI.Controllers.DeviceController.RegisterDevice (NayifatAPI)'
2025-02-02 14:06:27.196 +03:00 [INF] Request finished HTTP/1.1 POST http://07ca-46-152-255-232.ngrok-free.app/api/device - 401 null application/json; charset=utf-8 9.9011ms
2025-02-02 14:06:27.570 +03:00 [INF] Request starting HTTP/1.1 POST http://07ca-46-152-255-232.ngrok-free.app/api/auth/signin - application/json; charset=utf-8 100
2025-02-02 14:06:27.572 +03:00 [INF] Executing endpoint 'NayifatAPI.Controllers.AuthController.SignIn (NayifatAPI)'
2025-02-02 14:06:27.573 +03:00 [INF] Route matched with {action = "SignIn", controller = "Auth"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] SignIn(NayifatAPI.Controllers.SignInRequest) on controller NayifatAPI.Controllers.AuthController (NayifatAPI).
2025-02-02 14:06:27.577 +03:00 [INF] Executed DbCommand (0ms) [Parameters=[@__providedApiKey_0='?' (Size = 255)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [a].[Key], [a].[CreatedAt], [a].[Description], [a].[ExpiresAt], [a].[IsActive], [a].[LastUsedAt]
FROM [ApiKeys] AS [a]
WHERE [a].[Key] = @__providedApiKey_0 AND [a].[IsActive] = CAST(1 AS bit)
2025-02-02 14:06:27.580 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@__request_NationalId_0='?' (Size = 450)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [c].[NationalId], [c].[AddNo], [c].[BuildingNo], [c].[City], [c].[Consent], [c].[ConsentDate], [c].[DateOfBirth], [c].[Dependents], [c].[District], [c].[Email], [c].[Employer], [c].[FamilyNameAr], [c].[FamilyNameEn], [c].[FirstNameAr], [c].[FirstNameEn], [c].[Iban], [c].[IdExpiryDate], [c].[Los], [c].[Mpin], [c].[MpinEnabled], [c].[NafathStatus], [c].[NafathTimestamp], [c].[Password], [c].[Phone], [c].[RegistrationDate], [c].[SalaryCustomer], [c].[SalaryDakhli], [c].[SecondNameAr], [c].[SecondNameEn], [c].[Sector], [c].[Street], [c].[ThirdNameAr], [c].[ThirdNameEn], [c].[Zipcode]
FROM [Customers] AS [c]
WHERE [c].[NationalId] = @__request_NationalId_0
2025-02-02 14:06:27.582 +03:00 [INF] Starting password verification for NationalId: 1064448614
2025-02-02 14:06:27.841 +03:00 [INF] Password verification result for NationalId 1064448614: Success
2025-02-02 14:06:27.842 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@__request_NationalId_0='?' (Size = 450), @__request_DeviceId_1='?' (Size = 450)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [c].[Id], [c].[BiometricEnabled], [c].[BiometricToken], [c].[CreatedAt], [c].[DeviceId], [c].[LastUsedAt], [c].[Manufacturer], [c].[Model], [c].[NationalId], [c].[OsVersion], [c].[Platform], [c].[Status]
FROM [Customer_Devices] AS [c]
WHERE [c].[NationalId] = @__request_NationalId_0 AND [c].[DeviceId] = @__request_DeviceId_1 AND [c].[Status] = N'active'
2025-02-02 14:06:27.851 +03:00 [INF] Executed DbCommand (6ms) [Parameters=[@p0='?' (Size = 4000), @p1='?' (DbType = DateTime2), @p2='?' (Size = 4000), @p3='?' (Size = 4000), @p4='?' (Size = 4000), @p5='?' (Size = 450), @p6='?' (Size = 4000), @p7='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SET IMPLICIT_TRANSACTIONS OFF;
SET NOCOUNT ON;
INSERT INTO [AuthLogs] ([AuthType], [CreatedAt], [DeviceId], [FailureReason], [IpAddress], [NationalId], [Status], [UserAgent])
OUTPUT INSERTED.[Id]
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7);
2025-02-02 14:06:27.854 +03:00 [INF] Executing ObjectResult, writing value of type '<>f__AnonymousType12`3[[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Object, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-02-02 14:06:27.855 +03:00 [INF] Executed action NayifatAPI.Controllers.AuthController.SignIn (NayifatAPI) in 280.336ms
2025-02-02 14:06:27.856 +03:00 [INF] Executed endpoint 'NayifatAPI.Controllers.AuthController.SignIn (NayifatAPI)'
2025-02-02 14:06:27.857 +03:00 [INF] Request finished HTTP/1.1 POST http://07ca-46-152-255-232.ngrok-free.app/api/auth/signin - 401 null application/json; charset=utf-8 287.3625ms
2025-02-02 14:07:52.817 +03:00 [INF] Request starting HTTP/1.1 POST http://07ca-46-152-255-232.ngrok-free.app/api/auth/signin - application/json; charset=utf-8 100
2025-02-02 14:07:52.822 +03:00 [INF] Executing endpoint 'NayifatAPI.Controllers.AuthController.SignIn (NayifatAPI)'
2025-02-02 14:07:52.824 +03:00 [INF] Route matched with {action = "SignIn", controller = "Auth"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] SignIn(NayifatAPI.Controllers.SignInRequest) on controller NayifatAPI.Controllers.AuthController (NayifatAPI).
2025-02-02 14:07:52.830 +03:00 [INF] Executed DbCommand (2ms) [Parameters=[@__providedApiKey_0='?' (Size = 255)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [a].[Key], [a].[CreatedAt], [a].[Description], [a].[ExpiresAt], [a].[IsActive], [a].[LastUsedAt]
FROM [ApiKeys] AS [a]
WHERE [a].[Key] = @__providedApiKey_0 AND [a].[IsActive] = CAST(1 AS bit)
2025-02-02 14:07:52.834 +03:00 [INF] Executed DbCommand (2ms) [Parameters=[@__request_NationalId_0='?' (Size = 450)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [c].[NationalId], [c].[AddNo], [c].[BuildingNo], [c].[City], [c].[Consent], [c].[ConsentDate], [c].[DateOfBirth], [c].[Dependents], [c].[District], [c].[Email], [c].[Employer], [c].[FamilyNameAr], [c].[FamilyNameEn], [c].[FirstNameAr], [c].[FirstNameEn], [c].[Iban], [c].[IdExpiryDate], [c].[Los], [c].[Mpin], [c].[MpinEnabled], [c].[NafathStatus], [c].[NafathTimestamp], [c].[Password], [c].[Phone], [c].[RegistrationDate], [c].[SalaryCustomer], [c].[SalaryDakhli], [c].[SecondNameAr], [c].[SecondNameEn], [c].[Sector], [c].[Street], [c].[ThirdNameAr], [c].[ThirdNameEn], [c].[Zipcode]
FROM [Customers] AS [c]
WHERE [c].[NationalId] = @__request_NationalId_0
2025-02-02 14:07:52.836 +03:00 [INF] Starting password verification for NationalId: 1064448614
2025-02-02 14:07:53.010 +03:00 [INF] Password verification result for NationalId 1064448614: Success
2025-02-02 14:07:53.015 +03:00 [INF] Executed DbCommand (4ms) [Parameters=[@__request_NationalId_0='?' (Size = 450), @__request_DeviceId_1='?' (Size = 450)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [c].[Id], [c].[BiometricEnabled], [c].[BiometricToken], [c].[CreatedAt], [c].[DeviceId], [c].[LastUsedAt], [c].[Manufacturer], [c].[Model], [c].[NationalId], [c].[OsVersion], [c].[Platform], [c].[Status]
FROM [Customer_Devices] AS [c]
WHERE [c].[NationalId] = @__request_NationalId_0 AND [c].[DeviceId] = @__request_DeviceId_1 AND [c].[Status] = N'active'
2025-02-02 14:07:53.093 +03:00 [INF] Executed DbCommand (75ms) [Parameters=[@p0='?' (Size = 4000), @p1='?' (DbType = DateTime2), @p2='?' (Size = 4000), @p3='?' (Size = 4000), @p4='?' (Size = 4000), @p5='?' (Size = 450), @p6='?' (Size = 4000), @p7='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SET IMPLICIT_TRANSACTIONS OFF;
SET NOCOUNT ON;
INSERT INTO [AuthLogs] ([AuthType], [CreatedAt], [DeviceId], [FailureReason], [IpAddress], [NationalId], [Status], [UserAgent])
OUTPUT INSERTED.[Id]
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7);
2025-02-02 14:07:53.096 +03:00 [INF] Executing ObjectResult, writing value of type '<>f__AnonymousType12`3[[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Object, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-02-02 14:07:53.097 +03:00 [INF] Executed action NayifatAPI.Controllers.AuthController.SignIn (NayifatAPI) in 270.5373ms
2025-02-02 14:07:53.099 +03:00 [INF] Executed endpoint 'NayifatAPI.Controllers.AuthController.SignIn (NayifatAPI)'
2025-02-02 14:07:53.100 +03:00 [INF] Request finished HTTP/1.1 POST http://07ca-46-152-255-232.ngrok-free.app/api/auth/signin - 401 null application/json; charset=utf-8 283.4707ms
2025-02-02 14:07:53.553 +03:00 [INF] Request starting HTTP/1.1 POST http://07ca-46-152-255-232.ngrok-free.app/api/device/unregister - application/json; charset=utf-8 174
2025-02-02 14:07:53.556 +03:00 [INF] Request finished HTTP/1.1 POST http://07ca-46-152-255-232.ngrok-free.app/api/device/unregister - 404 0 null 2.2671ms
2025-02-02 14:07:53.558 +03:00 [INF] Request reached the end of the middleware pipeline without being handled by application code. Request path: POST http://07ca-46-152-255-232.ngrok-free.app/api/device/unregister, Response status code: 404
2025-02-02 14:07:53.833 +03:00 [INF] Request starting HTTP/1.1 POST http://07ca-46-152-255-232.ngrok-free.app/api/device - application/json; charset=utf-8 185
2025-02-02 14:07:53.837 +03:00 [INF] Executing endpoint 'NayifatAPI.Controllers.DeviceController.RegisterDevice (NayifatAPI)'
2025-02-02 14:07:53.838 +03:00 [INF] Route matched with {action = "RegisterDevice", controller = "Device"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] RegisterDevice(NayifatAPI.Controllers.RegisterDeviceRequest) on controller NayifatAPI.Controllers.DeviceController (NayifatAPI).
2025-02-02 14:07:53.840 +03:00 [INF] Executing ObjectResult, writing value of type '<>f__AnonymousType11`2[[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-02-02 14:07:53.841 +03:00 [INF] Executed action NayifatAPI.Controllers.DeviceController.RegisterDevice (NayifatAPI) in 1.4344ms
2025-02-02 14:07:53.842 +03:00 [INF] Executed endpoint 'NayifatAPI.Controllers.DeviceController.RegisterDevice (NayifatAPI)'
2025-02-02 14:07:53.843 +03:00 [INF] Request finished HTTP/1.1 POST http://07ca-46-152-255-232.ngrok-free.app/api/device - 401 null application/json; charset=utf-8 10.017ms
2025-02-02 14:07:54.225 +03:00 [INF] Request starting HTTP/1.1 POST http://07ca-46-152-255-232.ngrok-free.app/api/auth/signin - application/json; charset=utf-8 100
2025-02-02 14:07:54.230 +03:00 [INF] Executing endpoint 'NayifatAPI.Controllers.AuthController.SignIn (NayifatAPI)'
2025-02-02 14:07:54.231 +03:00 [INF] Route matched with {action = "SignIn", controller = "Auth"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] SignIn(NayifatAPI.Controllers.SignInRequest) on controller NayifatAPI.Controllers.AuthController (NayifatAPI).
2025-02-02 14:07:54.234 +03:00 [INF] Executed DbCommand (0ms) [Parameters=[@__providedApiKey_0='?' (Size = 255)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [a].[Key], [a].[CreatedAt], [a].[Description], [a].[ExpiresAt], [a].[IsActive], [a].[LastUsedAt]
FROM [ApiKeys] AS [a]
WHERE [a].[Key] = @__providedApiKey_0 AND [a].[IsActive] = CAST(1 AS bit)
2025-02-02 14:07:54.236 +03:00 [INF] Executed DbCommand (0ms) [Parameters=[@__request_NationalId_0='?' (Size = 450)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [c].[NationalId], [c].[AddNo], [c].[BuildingNo], [c].[City], [c].[Consent], [c].[ConsentDate], [c].[DateOfBirth], [c].[Dependents], [c].[District], [c].[Email], [c].[Employer], [c].[FamilyNameAr], [c].[FamilyNameEn], [c].[FirstNameAr], [c].[FirstNameEn], [c].[Iban], [c].[IdExpiryDate], [c].[Los], [c].[Mpin], [c].[MpinEnabled], [c].[NafathStatus], [c].[NafathTimestamp], [c].[Password], [c].[Phone], [c].[RegistrationDate], [c].[SalaryCustomer], [c].[SalaryDakhli], [c].[SecondNameAr], [c].[SecondNameEn], [c].[Sector], [c].[Street], [c].[ThirdNameAr], [c].[ThirdNameEn], [c].[Zipcode]
FROM [Customers] AS [c]
WHERE [c].[NationalId] = @__request_NationalId_0
2025-02-02 14:07:54.239 +03:00 [INF] Starting password verification for NationalId: 1064448614
2025-02-02 14:07:54.411 +03:00 [INF] Password verification result for NationalId 1064448614: Success
2025-02-02 14:07:54.414 +03:00 [INF] Executed DbCommand (0ms) [Parameters=[@__request_NationalId_0='?' (Size = 450), @__request_DeviceId_1='?' (Size = 450)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [c].[Id], [c].[BiometricEnabled], [c].[BiometricToken], [c].[CreatedAt], [c].[DeviceId], [c].[LastUsedAt], [c].[Manufacturer], [c].[Model], [c].[NationalId], [c].[OsVersion], [c].[Platform], [c].[Status]
FROM [Customer_Devices] AS [c]
WHERE [c].[NationalId] = @__request_NationalId_0 AND [c].[DeviceId] = @__request_DeviceId_1 AND [c].[Status] = N'active'
2025-02-02 14:07:54.931 +03:00 [INF] Executed DbCommand (515ms) [Parameters=[@p0='?' (Size = 4000), @p1='?' (DbType = DateTime2), @p2='?' (Size = 4000), @p3='?' (Size = 4000), @p4='?' (Size = 4000), @p5='?' (Size = 450), @p6='?' (Size = 4000), @p7='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SET IMPLICIT_TRANSACTIONS OFF;
SET NOCOUNT ON;
INSERT INTO [AuthLogs] ([AuthType], [CreatedAt], [DeviceId], [FailureReason], [IpAddress], [NationalId], [Status], [UserAgent])
OUTPUT INSERTED.[Id]
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7);
2025-02-02 14:07:54.941 +03:00 [INF] Executing ObjectResult, writing value of type '<>f__AnonymousType12`3[[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Object, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-02-02 14:07:54.946 +03:00 [INF] Executed action NayifatAPI.Controllers.AuthController.SignIn (NayifatAPI) in 713.0993ms
2025-02-02 14:07:54.949 +03:00 [INF] Executed endpoint 'NayifatAPI.Controllers.AuthController.SignIn (NayifatAPI)'
2025-02-02 14:07:54.951 +03:00 [INF] Request finished HTTP/1.1 POST http://07ca-46-152-255-232.ngrok-free.app/api/auth/signin - 401 null application/json; charset=utf-8 726.1247ms
2025-02-02 14:09:21.234 +03:00 [INF] Request starting HTTP/1.1 POST http://07ca-46-152-255-232.ngrok-free.app/api/notifications/list - application/json; charset=utf-8 47
2025-02-02 14:09:21.238 +03:00 [INF] Executing endpoint 'NayifatAPI.Controllers.NotificationsController.GetNotifications (NayifatAPI)'
2025-02-02 14:09:21.239 +03:00 [INF] Route matched with {action = "GetNotifications", controller = "Notifications"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetNotifications(NayifatAPI.Controllers.GetNotificationsRequest) on controller NayifatAPI.Controllers.NotificationsController (NayifatAPI).
2025-02-02 14:09:21.243 +03:00 [INF] Executed DbCommand (2ms) [Parameters=[@__providedApiKey_0='?' (Size = 255)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [a].[Key], [a].[CreatedAt], [a].[Description], [a].[ExpiresAt], [a].[IsActive], [a].[LastUsedAt]
FROM [ApiKeys] AS [a]
WHERE [a].[Key] = @__providedApiKey_0 AND [a].[IsActive] = CAST(1 AS bit)
2025-02-02 14:09:21.248 +03:00 [INF] Executed DbCommand (2ms) [Parameters=[@__request_NationalId_0='?' (Size = 450)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [u].[national_id], [u].[last_updated], [u].[notifications]
FROM [user_notifications] AS [u]
WHERE [u].[national_id] = @__request_NationalId_0
2025-02-02 14:09:21.252 +03:00 [INF] Executed DbCommand (2ms) [Parameters=[@__Parse_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [n].[Id], [n].[additional_data], [n].[Body], [n].[body_ar], [n].[body_en], [n].[created_at], [n].[expiry_at], [n].[Route], [n].[target_criteria], [n].[Title], [n].[title_ar], [n].[title_en]
FROM [notification_templates] AS [n]
WHERE [n].[Id] = @__Parse_0
2025-02-02 14:09:21.254 +03:00 [INF] Executed DbCommand (0ms) [Parameters=[@__Parse_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [n].[Id], [n].[additional_data], [n].[Body], [n].[body_ar], [n].[body_en], [n].[created_at], [n].[expiry_at], [n].[Route], [n].[target_criteria], [n].[Title], [n].[title_ar], [n].[title_en]
FROM [notification_templates] AS [n]
WHERE [n].[Id] = @__Parse_0
2025-02-02 14:09:21.331 +03:00 [INF] Executed DbCommand (75ms) [Parameters=[@p0='?' (Size = 4000), @p1='?' (DbType = DateTime2), @p2='?' (Size = 4000), @p3='?' (Size = 4000), @p4='?' (Size = 4000), @p5='?' (Size = 450), @p6='?' (Size = 4000), @p7='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SET IMPLICIT_TRANSACTIONS OFF;
SET NOCOUNT ON;
INSERT INTO [AuthLogs] ([AuthType], [CreatedAt], [DeviceId], [FailureReason], [IpAddress], [NationalId], [Status], [UserAgent])
OUTPUT INSERTED.[Id]
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7);
2025-02-02 14:09:21.334 +03:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType9`2[[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Object, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-02-02 14:09:21.335 +03:00 [INF] Executed action NayifatAPI.Controllers.NotificationsController.GetNotifications (NayifatAPI) in 95.0232ms
2025-02-02 14:09:21.337 +03:00 [INF] Executed endpoint 'NayifatAPI.Controllers.NotificationsController.GetNotifications (NayifatAPI)'
2025-02-02 14:09:21.338 +03:00 [INF] Request finished HTTP/1.1 POST http://07ca-46-152-255-232.ngrok-free.app/api/notifications/list - 200 null application/json; charset=utf-8 103.4133ms
2025-02-02 14:09:53.106 +03:00 [INF] Request starting HTTP/1.1 POST http://07ca-46-152-255-232.ngrok-free.app/api/device/unregister - application/json; charset=utf-8 174
2025-02-02 14:09:53.109 +03:00 [INF] Request finished HTTP/1.1 POST http://07ca-46-152-255-232.ngrok-free.app/api/device/unregister - 404 0 null 2.291ms
2025-02-02 14:09:53.111 +03:00 [INF] Request reached the end of the middleware pipeline without being handled by application code. Request path: POST http://07ca-46-152-255-232.ngrok-free.app/api/device/unregister, Response status code: 404
2025-02-02 14:09:54.312 +03:00 [INF] Request starting HTTP/1.1 POST http://07ca-46-152-255-232.ngrok-free.app/api/notifications/list - application/json; charset=utf-8 47
2025-02-02 14:09:54.315 +03:00 [INF] Executing endpoint 'NayifatAPI.Controllers.NotificationsController.GetNotifications (NayifatAPI)'
2025-02-02 14:09:54.315 +03:00 [INF] Route matched with {action = "GetNotifications", controller = "Notifications"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetNotifications(NayifatAPI.Controllers.GetNotificationsRequest) on controller NayifatAPI.Controllers.NotificationsController (NayifatAPI).
2025-02-02 14:09:54.320 +03:00 [INF] Executed DbCommand (2ms) [Parameters=[@__providedApiKey_0='?' (Size = 255)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [a].[Key], [a].[CreatedAt], [a].[Description], [a].[ExpiresAt], [a].[IsActive], [a].[LastUsedAt]
FROM [ApiKeys] AS [a]
WHERE [a].[Key] = @__providedApiKey_0 AND [a].[IsActive] = CAST(1 AS bit)
2025-02-02 14:09:54.323 +03:00 [INF] Executed DbCommand (2ms) [Parameters=[@__request_NationalId_0='?' (Size = 450)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [u].[national_id], [u].[last_updated], [u].[notifications]
FROM [user_notifications] AS [u]
WHERE [u].[national_id] = @__request_NationalId_0
2025-02-02 14:09:54.327 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@__Parse_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [n].[Id], [n].[additional_data], [n].[Body], [n].[body_ar], [n].[body_en], [n].[created_at], [n].[expiry_at], [n].[Route], [n].[target_criteria], [n].[Title], [n].[title_ar], [n].[title_en]
FROM [notification_templates] AS [n]
WHERE [n].[Id] = @__Parse_0
2025-02-02 14:09:54.329 +03:00 [INF] Executed DbCommand (0ms) [Parameters=[@__Parse_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [n].[Id], [n].[additional_data], [n].[Body], [n].[body_ar], [n].[body_en], [n].[created_at], [n].[expiry_at], [n].[Route], [n].[target_criteria], [n].[Title], [n].[title_ar], [n].[title_en]
FROM [notification_templates] AS [n]
WHERE [n].[Id] = @__Parse_0
2025-02-02 14:09:54.406 +03:00 [INF] Executed DbCommand (75ms) [Parameters=[@p0='?' (Size = 4000), @p1='?' (DbType = DateTime2), @p2='?' (Size = 4000), @p3='?' (Size = 4000), @p4='?' (Size = 4000), @p5='?' (Size = 450), @p6='?' (Size = 4000), @p7='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SET IMPLICIT_TRANSACTIONS OFF;
SET NOCOUNT ON;
INSERT INTO [AuthLogs] ([AuthType], [CreatedAt], [DeviceId], [FailureReason], [IpAddress], [NationalId], [Status], [UserAgent])
OUTPUT INSERTED.[Id]
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7);
2025-02-02 14:09:54.408 +03:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType9`2[[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Object, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-02-02 14:09:54.409 +03:00 [INF] Executed action NayifatAPI.Controllers.NotificationsController.GetNotifications (NayifatAPI) in 92.8161ms
2025-02-02 14:09:54.410 +03:00 [INF] Executed endpoint 'NayifatAPI.Controllers.NotificationsController.GetNotifications (NayifatAPI)'
2025-02-02 14:09:54.411 +03:00 [INF] Request finished HTTP/1.1 POST http://07ca-46-152-255-232.ngrok-free.app/api/notifications/list - 200 null application/json; charset=utf-8 99.3634ms
2025-02-02 14:10:13.375 +03:00 [INF] Request starting HTTP/1.1 POST http://07ca-46-152-255-232.ngrok-free.app/api/auth/signin - application/json; charset=utf-8 103
2025-02-02 14:10:13.378 +03:00 [INF] Executing endpoint 'NayifatAPI.Controllers.AuthController.SignIn (NayifatAPI)'
2025-02-02 14:10:13.379 +03:00 [INF] Route matched with {action = "SignIn", controller = "Auth"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] SignIn(NayifatAPI.Controllers.SignInRequest) on controller NayifatAPI.Controllers.AuthController (NayifatAPI).
2025-02-02 14:10:13.384 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@__providedApiKey_0='?' (Size = 255)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [a].[Key], [a].[CreatedAt], [a].[Description], [a].[ExpiresAt], [a].[IsActive], [a].[LastUsedAt]
FROM [ApiKeys] AS [a]
WHERE [a].[Key] = @__providedApiKey_0 AND [a].[IsActive] = CAST(1 AS bit)
2025-02-02 14:10:13.391 +03:00 [INF] Executed DbCommand (2ms) [Parameters=[@__request_NationalId_0='?' (Size = 450)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [c].[NationalId], [c].[AddNo], [c].[BuildingNo], [c].[City], [c].[Consent], [c].[ConsentDate], [c].[DateOfBirth], [c].[Dependents], [c].[District], [c].[Email], [c].[Employer], [c].[FamilyNameAr], [c].[FamilyNameEn], [c].[FirstNameAr], [c].[FirstNameEn], [c].[Iban], [c].[IdExpiryDate], [c].[Los], [c].[Mpin], [c].[MpinEnabled], [c].[NafathStatus], [c].[NafathTimestamp], [c].[Password], [c].[Phone], [c].[RegistrationDate], [c].[SalaryCustomer], [c].[SalaryDakhli], [c].[SecondNameAr], [c].[SecondNameEn], [c].[Sector], [c].[Street], [c].[ThirdNameAr], [c].[ThirdNameEn], [c].[Zipcode]
FROM [Customers] AS [c]
WHERE [c].[NationalId] = @__request_NationalId_0
2025-02-02 14:10:13.395 +03:00 [INF] Starting password verification for NationalId: 1064448614
2025-02-02 14:10:13.625 +03:00 [INF] Password verification result for NationalId 1064448614: Success
2025-02-02 14:10:13.630 +03:00 [INF] Executed DbCommand (3ms) [Parameters=[@__request_NationalId_0='?' (Size = 450), @__request_DeviceId_1='?' (Size = 450)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [c].[Id], [c].[BiometricEnabled], [c].[BiometricToken], [c].[CreatedAt], [c].[DeviceId], [c].[LastUsedAt], [c].[Manufacturer], [c].[Model], [c].[NationalId], [c].[OsVersion], [c].[Platform], [c].[Status]
FROM [Customer_Devices] AS [c]
WHERE [c].[NationalId] = @__request_NationalId_0 AND [c].[DeviceId] = @__request_DeviceId_1 AND [c].[Status] = N'active'
2025-02-02 14:10:13.706 +03:00 [INF] Executed DbCommand (73ms) [Parameters=[@p0='?' (Size = 4000), @p1='?' (DbType = DateTime2), @p2='?' (Size = 4000), @p3='?' (Size = 4000), @p4='?' (Size = 4000), @p5='?' (Size = 450), @p6='?' (Size = 4000), @p7='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SET IMPLICIT_TRANSACTIONS OFF;
SET NOCOUNT ON;
INSERT INTO [AuthLogs] ([AuthType], [CreatedAt], [DeviceId], [FailureReason], [IpAddress], [NationalId], [Status], [UserAgent])
OUTPUT INSERTED.[Id]
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7);
2025-02-02 14:10:13.710 +03:00 [INF] Executing ObjectResult, writing value of type '<>f__AnonymousType12`3[[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Object, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-02-02 14:10:13.712 +03:00 [INF] Executed action NayifatAPI.Controllers.AuthController.SignIn (NayifatAPI) in 330.4972ms
2025-02-02 14:10:13.713 +03:00 [INF] Executed endpoint 'NayifatAPI.Controllers.AuthController.SignIn (NayifatAPI)'
2025-02-02 14:10:13.713 +03:00 [INF] Request finished HTTP/1.1 POST http://07ca-46-152-255-232.ngrok-free.app/api/auth/signin - 401 null application/json; charset=utf-8 338.6992ms
2025-02-02 14:12:43.841 +03:00 [INF] Request starting HTTP/1.1 POST http://07ca-46-152-255-232.ngrok-free.app/api/device - application/json; charset=utf-8 151
2025-02-02 14:12:43.842 +03:00 [INF] Executing endpoint 'NayifatAPI.Controllers.DeviceController.RegisterDevice (NayifatAPI)'
2025-02-02 14:12:43.843 +03:00 [INF] Route matched with {action = "RegisterDevice", controller = "Device"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] RegisterDevice(NayifatAPI.Controllers.RegisterDeviceRequest) on controller NayifatAPI.Controllers.DeviceController (NayifatAPI).
2025-02-02 14:12:43.849 +03:00 [INF] Executed DbCommand (3ms) [Parameters=[@__providedApiKey_0='?' (Size = 255)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [a].[Key], [a].[CreatedAt], [a].[Description], [a].[ExpiresAt], [a].[IsActive], [a].[LastUsedAt]
FROM [ApiKeys] AS [a]
WHERE [a].[Key] = @__providedApiKey_0 AND [a].[IsActive] = CAST(1 AS bit)
2025-02-02 14:12:43.880 +03:00 [INF] Executed DbCommand (3ms) [Parameters=[@__p_0='?' (Size = 450)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [c].[NationalId], [c].[AddNo], [c].[BuildingNo], [c].[City], [c].[Consent], [c].[ConsentDate], [c].[DateOfBirth], [c].[Dependents], [c].[District], [c].[Email], [c].[Employer], [c].[FamilyNameAr], [c].[FamilyNameEn], [c].[FirstNameAr], [c].[FirstNameEn], [c].[Iban], [c].[IdExpiryDate], [c].[Los], [c].[Mpin], [c].[MpinEnabled], [c].[NafathStatus], [c].[NafathTimestamp], [c].[Password], [c].[Phone], [c].[RegistrationDate], [c].[SalaryCustomer], [c].[SalaryDakhli], [c].[SecondNameAr], [c].[SecondNameEn], [c].[Sector], [c].[Street], [c].[ThirdNameAr], [c].[ThirdNameEn], [c].[Zipcode]
FROM [Customers] AS [c]
WHERE [c].[NationalId] = @__p_0
2025-02-02 14:12:43.918 +03:00 [INF] Executed DbCommand (14ms) [Parameters=[@__request_NationalId_0='?' (Size = 450)], CommandType='"Text"', CommandTimeout='30']
UPDATE [c]
SET [c].[LastUsedAt] = GETUTCDATE(),
    [c].[Status] = N'disabled'
FROM [Customer_Devices] AS [c]
WHERE [c].[NationalId] = @__request_NationalId_0
2025-02-02 14:12:43.967 +03:00 [INF] Executed DbCommand (6ms) [Parameters=[@p0='?' (Size = 4000), @p1='?' (DbType = DateTime2), @p2='?' (Size = 4000), @p3='?' (Size = 4000), @p4='?' (Size = 4000), @p5='?' (Size = 450), @p6='?' (Size = 4000), @p7='?' (Size = 4000), @p8='?' (DbType = Boolean), @p9='?' (Size = 4000), @p10='?' (DbType = DateTime2), @p11='?' (Size = 450), @p12='?' (DbType = DateTime2), @p13='?' (Size = 4000), @p14='?' (Size = 4000), @p15='?' (Size = 450), @p16='?' (Size = 4000), @p17='?' (Size = 4000), @p18='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SET NOCOUNT ON;
INSERT INTO [AuthLogs] ([AuthType], [CreatedAt], [DeviceId], [FailureReason], [IpAddress], [NationalId], [Status], [UserAgent])
OUTPUT INSERTED.[Id]
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7);
INSERT INTO [Customer_Devices] ([BiometricEnabled], [BiometricToken], [CreatedAt], [DeviceId], [LastUsedAt], [Manufacturer], [Model], [NationalId], [OsVersion], [Platform], [Status])
OUTPUT INSERTED.[Id]
VALUES (@p8, @p9, @p10, @p11, @p12, @p13, @p14, @p15, @p16, @p17, @p18);
2025-02-02 14:12:43.992 +03:00 [ERR] An exception occurred in the database while saving changes for context type 'NayifatAPI.Data.ApplicationDbContext'.
Microsoft.EntityFrameworkCore.DbUpdateException: An error occurred while saving the entity changes. See the inner exception for details.
 ---> Microsoft.Data.SqlClient.SqlException (0x80131904): Cannot insert duplicate key row in object 'dbo.Customer_Devices' with unique index 'IX_Customer_Devices_NationalId_DeviceId'. The duplicate key value is (1064448614, TP1A.220624.014).
   at Microsoft.Data.SqlClient.SqlConnection.OnError(SqlException exception, Boolean breakConnection, Action`1 wrapCloseInAction)
   at Microsoft.Data.SqlClient.SqlInternalConnection.OnError(SqlException exception, Boolean breakConnection, Action`1 wrapCloseInAction)
   at Microsoft.Data.SqlClient.TdsParser.ThrowExceptionAndWarning(TdsParserStateObject stateObj, Boolean callerHasConnectionLock, Boolean asyncClose)
   at Microsoft.Data.SqlClient.TdsParser.TryRun(RunBehavior runBehavior, SqlCommand cmdHandler, SqlDataReader dataStream, BulkCopySimpleResultSet bulkCopyHandler, TdsParserStateObject stateObj, Boolean& dataReady)
   at Microsoft.Data.SqlClient.SqlDataReader.TryHasMoreRows(Boolean& moreRows)
   at Microsoft.Data.SqlClient.SqlDataReader.TryReadInternal(Boolean setTimeout, Boolean& more)
   at Microsoft.Data.SqlClient.SqlDataReader.ReadAsyncExecute(Task task, Object state)
   at Microsoft.Data.SqlClient.SqlDataReader.InvokeAsyncCall[T](SqlDataReaderBaseAsyncCallContext`1 context)
--- End of stack trace from previous location ---
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeResultSetAsync(Int32 startCommandIndex, RelationalDataReader reader, CancellationToken cancellationToken)
ClientConnectionId:4450d9b6-abe6-4125-bc94-21b5a2236b77
Error Number:2601,State:1,Class:14
   --- End of inner exception stack trace ---
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeResultSetAsync(Int32 startCommandIndex, RelationalDataReader reader, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeAsync(RelationalDataReader reader, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Update.Internal.SqlServerModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(IList`1 entriesToSave, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(StateManager stateManager, Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Storage.Internal.SqlServerExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
Microsoft.EntityFrameworkCore.DbUpdateException: An error occurred while saving the entity changes. See the inner exception for details.
 ---> Microsoft.Data.SqlClient.SqlException (0x80131904): Cannot insert duplicate key row in object 'dbo.Customer_Devices' with unique index 'IX_Customer_Devices_NationalId_DeviceId'. The duplicate key value is (1064448614, TP1A.220624.014).
   at Microsoft.Data.SqlClient.SqlConnection.OnError(SqlException exception, Boolean breakConnection, Action`1 wrapCloseInAction)
   at Microsoft.Data.SqlClient.SqlInternalConnection.OnError(SqlException exception, Boolean breakConnection, Action`1 wrapCloseInAction)
   at Microsoft.Data.SqlClient.TdsParser.ThrowExceptionAndWarning(TdsParserStateObject stateObj, Boolean callerHasConnectionLock, Boolean asyncClose)
   at Microsoft.Data.SqlClient.TdsParser.TryRun(RunBehavior runBehavior, SqlCommand cmdHandler, SqlDataReader dataStream, BulkCopySimpleResultSet bulkCopyHandler, TdsParserStateObject stateObj, Boolean& dataReady)
   at Microsoft.Data.SqlClient.SqlDataReader.TryHasMoreRows(Boolean& moreRows)
   at Microsoft.Data.SqlClient.SqlDataReader.TryReadInternal(Boolean setTimeout, Boolean& more)
   at Microsoft.Data.SqlClient.SqlDataReader.ReadAsyncExecute(Task task, Object state)
   at Microsoft.Data.SqlClient.SqlDataReader.InvokeAsyncCall[T](SqlDataReaderBaseAsyncCallContext`1 context)
--- End of stack trace from previous location ---
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeResultSetAsync(Int32 startCommandIndex, RelationalDataReader reader, CancellationToken cancellationToken)
ClientConnectionId:4450d9b6-abe6-4125-bc94-21b5a2236b77
Error Number:2601,State:1,Class:14
   --- End of inner exception stack trace ---
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeResultSetAsync(Int32 startCommandIndex, RelationalDataReader reader, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeAsync(RelationalDataReader reader, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Update.Internal.SqlServerModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(IList`1 entriesToSave, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(StateManager stateManager, Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Storage.Internal.SqlServerExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
2025-02-02 14:12:44.006 +03:00 [ERR] Error registering device for National ID: 1064448614
Microsoft.EntityFrameworkCore.DbUpdateException: An error occurred while saving the entity changes. See the inner exception for details.
 ---> Microsoft.Data.SqlClient.SqlException (0x80131904): Cannot insert duplicate key row in object 'dbo.Customer_Devices' with unique index 'IX_Customer_Devices_NationalId_DeviceId'. The duplicate key value is (1064448614, TP1A.220624.014).
   at Microsoft.Data.SqlClient.SqlConnection.OnError(SqlException exception, Boolean breakConnection, Action`1 wrapCloseInAction)
   at Microsoft.Data.SqlClient.SqlInternalConnection.OnError(SqlException exception, Boolean breakConnection, Action`1 wrapCloseInAction)
   at Microsoft.Data.SqlClient.TdsParser.ThrowExceptionAndWarning(TdsParserStateObject stateObj, Boolean callerHasConnectionLock, Boolean asyncClose)
   at Microsoft.Data.SqlClient.TdsParser.TryRun(RunBehavior runBehavior, SqlCommand cmdHandler, SqlDataReader dataStream, BulkCopySimpleResultSet bulkCopyHandler, TdsParserStateObject stateObj, Boolean& dataReady)
   at Microsoft.Data.SqlClient.SqlDataReader.TryHasMoreRows(Boolean& moreRows)
   at Microsoft.Data.SqlClient.SqlDataReader.TryReadInternal(Boolean setTimeout, Boolean& more)
   at Microsoft.Data.SqlClient.SqlDataReader.ReadAsyncExecute(Task task, Object state)
   at Microsoft.Data.SqlClient.SqlDataReader.InvokeAsyncCall[T](SqlDataReaderBaseAsyncCallContext`1 context)
--- End of stack trace from previous location ---
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeResultSetAsync(Int32 startCommandIndex, RelationalDataReader reader, CancellationToken cancellationToken)
ClientConnectionId:4450d9b6-abe6-4125-bc94-21b5a2236b77
Error Number:2601,State:1,Class:14
   --- End of inner exception stack trace ---
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeResultSetAsync(Int32 startCommandIndex, RelationalDataReader reader, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeAsync(RelationalDataReader reader, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Update.Internal.SqlServerModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(IList`1 entriesToSave, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(StateManager stateManager, Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Storage.Internal.SqlServerExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at NayifatAPI.Controllers.DeviceController.RegisterDevice(RegisterDeviceRequest request) in C:\Users\yamta\StudioProjects\nayifat_app_2025_new\nayifatapi\Controllers\DeviceController.cs:line 78
2025-02-02 14:12:44.049 +03:00 [INF] Executed DbCommand (17ms) [Parameters=[@p0='?' (Size = 4000), @p1='?' (DbType = DateTime2), @p2='?' (Size = 4000), @p3='?' (Size = 4000), @p4='?' (Size = 4000), @p5='?' (Size = 450), @p6='?' (Size = 4000), @p7='?' (Size = 4000), @p8='?' (Size = 4000), @p9='?' (DbType = DateTime2), @p10='?' (Size = 4000), @p11='?' (Size = 4000), @p12='?' (Size = 4000), @p13='?' (Size = 450), @p14='?' (Size = 4000), @p15='?' (Size = 4000), @p16='?' (DbType = Boolean), @p17='?' (Size = 4000), @p18='?' (DbType = DateTime2), @p19='?' (Size = 450), @p20='?' (DbType = DateTime2), @p21='?' (Size = 4000), @p22='?' (Size = 4000), @p23='?' (Size = 450), @p24='?' (Size = 4000), @p25='?' (Size = 4000), @p26='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SET NOCOUNT ON;
MERGE [AuthLogs] USING (
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7, 0),
(@p8, @p9, @p10, @p11, @p12, @p13, @p14, @p15, 1)) AS i ([AuthType], [CreatedAt], [DeviceId], [FailureReason], [IpAddress], [NationalId], [Status], [UserAgent], _Position) ON 1=0
WHEN NOT MATCHED THEN
INSERT ([AuthType], [CreatedAt], [DeviceId], [FailureReason], [IpAddress], [NationalId], [Status], [UserAgent])
VALUES (i.[AuthType], i.[CreatedAt], i.[DeviceId], i.[FailureReason], i.[IpAddress], i.[NationalId], i.[Status], i.[UserAgent])
OUTPUT INSERTED.[Id], i._Position;
INSERT INTO [Customer_Devices] ([BiometricEnabled], [BiometricToken], [CreatedAt], [DeviceId], [LastUsedAt], [Manufacturer], [Model], [NationalId], [OsVersion], [Platform], [Status])
OUTPUT INSERTED.[Id]
VALUES (@p16, @p17, @p18, @p19, @p20, @p21, @p22, @p23, @p24, @p25, @p26);
2025-02-02 14:12:44.055 +03:00 [ERR] An exception occurred in the database while saving changes for context type 'NayifatAPI.Data.ApplicationDbContext'.
Microsoft.EntityFrameworkCore.DbUpdateException: An error occurred while saving the entity changes. See the inner exception for details.
 ---> Microsoft.Data.SqlClient.SqlException (0x80131904): Cannot insert duplicate key row in object 'dbo.Customer_Devices' with unique index 'IX_Customer_Devices_NationalId_DeviceId'. The duplicate key value is (1064448614, TP1A.220624.014).
   at Microsoft.Data.SqlClient.SqlConnection.OnError(SqlException exception, Boolean breakConnection, Action`1 wrapCloseInAction)
   at Microsoft.Data.SqlClient.SqlInternalConnection.OnError(SqlException exception, Boolean breakConnection, Action`1 wrapCloseInAction)
   at Microsoft.Data.SqlClient.TdsParser.ThrowExceptionAndWarning(TdsParserStateObject stateObj, Boolean callerHasConnectionLock, Boolean asyncClose)
   at Microsoft.Data.SqlClient.TdsParser.TryRun(RunBehavior runBehavior, SqlCommand cmdHandler, SqlDataReader dataStream, BulkCopySimpleResultSet bulkCopyHandler, TdsParserStateObject stateObj, Boolean& dataReady)
   at Microsoft.Data.SqlClient.SqlDataReader.TryHasMoreRows(Boolean& moreRows)
   at Microsoft.Data.SqlClient.SqlDataReader.TryReadInternal(Boolean setTimeout, Boolean& more)
   at Microsoft.Data.SqlClient.SqlDataReader.ReadAsyncExecute(Task task, Object state)
   at Microsoft.Data.SqlClient.SqlDataReader.InvokeAsyncCall[T](SqlDataReaderBaseAsyncCallContext`1 context)
--- End of stack trace from previous location ---
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeResultSetAsync(Int32 startCommandIndex, RelationalDataReader reader, CancellationToken cancellationToken)
ClientConnectionId:4450d9b6-abe6-4125-bc94-21b5a2236b77
Error Number:2601,State:1,Class:14
   --- End of inner exception stack trace ---
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeResultSetAsync(Int32 startCommandIndex, RelationalDataReader reader, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeAsync(RelationalDataReader reader, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Update.Internal.SqlServerModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(IList`1 entriesToSave, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(StateManager stateManager, Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Storage.Internal.SqlServerExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
Microsoft.EntityFrameworkCore.DbUpdateException: An error occurred while saving the entity changes. See the inner exception for details.
 ---> Microsoft.Data.SqlClient.SqlException (0x80131904): Cannot insert duplicate key row in object 'dbo.Customer_Devices' with unique index 'IX_Customer_Devices_NationalId_DeviceId'. The duplicate key value is (1064448614, TP1A.220624.014).
   at Microsoft.Data.SqlClient.SqlConnection.OnError(SqlException exception, Boolean breakConnection, Action`1 wrapCloseInAction)
   at Microsoft.Data.SqlClient.SqlInternalConnection.OnError(SqlException exception, Boolean breakConnection, Action`1 wrapCloseInAction)
   at Microsoft.Data.SqlClient.TdsParser.ThrowExceptionAndWarning(TdsParserStateObject stateObj, Boolean callerHasConnectionLock, Boolean asyncClose)
   at Microsoft.Data.SqlClient.TdsParser.TryRun(RunBehavior runBehavior, SqlCommand cmdHandler, SqlDataReader dataStream, BulkCopySimpleResultSet bulkCopyHandler, TdsParserStateObject stateObj, Boolean& dataReady)
   at Microsoft.Data.SqlClient.SqlDataReader.TryHasMoreRows(Boolean& moreRows)
   at Microsoft.Data.SqlClient.SqlDataReader.TryReadInternal(Boolean setTimeout, Boolean& more)
   at Microsoft.Data.SqlClient.SqlDataReader.ReadAsyncExecute(Task task, Object state)
   at Microsoft.Data.SqlClient.SqlDataReader.InvokeAsyncCall[T](SqlDataReaderBaseAsyncCallContext`1 context)
--- End of stack trace from previous location ---
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeResultSetAsync(Int32 startCommandIndex, RelationalDataReader reader, CancellationToken cancellationToken)
ClientConnectionId:4450d9b6-abe6-4125-bc94-21b5a2236b77
Error Number:2601,State:1,Class:14
   --- End of inner exception stack trace ---
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeResultSetAsync(Int32 startCommandIndex, RelationalDataReader reader, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeAsync(RelationalDataReader reader, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Update.Internal.SqlServerModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(IList`1 entriesToSave, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(StateManager stateManager, Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Storage.Internal.SqlServerExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
2025-02-02 14:12:44.070 +03:00 [INF] Executed action NayifatAPI.Controllers.DeviceController.RegisterDevice (NayifatAPI) in 225.5899ms
2025-02-02 14:12:44.071 +03:00 [INF] Executed endpoint 'NayifatAPI.Controllers.DeviceController.RegisterDevice (NayifatAPI)'
2025-02-02 14:12:44.073 +03:00 [ERR] Unhandled exception
Microsoft.EntityFrameworkCore.DbUpdateException: An error occurred while saving the entity changes. See the inner exception for details.
 ---> Microsoft.Data.SqlClient.SqlException (0x80131904): Cannot insert duplicate key row in object 'dbo.Customer_Devices' with unique index 'IX_Customer_Devices_NationalId_DeviceId'. The duplicate key value is (1064448614, TP1A.220624.014).
   at Microsoft.Data.SqlClient.SqlConnection.OnError(SqlException exception, Boolean breakConnection, Action`1 wrapCloseInAction)
   at Microsoft.Data.SqlClient.SqlInternalConnection.OnError(SqlException exception, Boolean breakConnection, Action`1 wrapCloseInAction)
   at Microsoft.Data.SqlClient.TdsParser.ThrowExceptionAndWarning(TdsParserStateObject stateObj, Boolean callerHasConnectionLock, Boolean asyncClose)
   at Microsoft.Data.SqlClient.TdsParser.TryRun(RunBehavior runBehavior, SqlCommand cmdHandler, SqlDataReader dataStream, BulkCopySimpleResultSet bulkCopyHandler, TdsParserStateObject stateObj, Boolean& dataReady)
   at Microsoft.Data.SqlClient.SqlDataReader.TryHasMoreRows(Boolean& moreRows)
   at Microsoft.Data.SqlClient.SqlDataReader.TryReadInternal(Boolean setTimeout, Boolean& more)
   at Microsoft.Data.SqlClient.SqlDataReader.ReadAsyncExecute(Task task, Object state)
   at Microsoft.Data.SqlClient.SqlDataReader.InvokeAsyncCall[T](SqlDataReaderBaseAsyncCallContext`1 context)
--- End of stack trace from previous location ---
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeResultSetAsync(Int32 startCommandIndex, RelationalDataReader reader, CancellationToken cancellationToken)
ClientConnectionId:4450d9b6-abe6-4125-bc94-21b5a2236b77
Error Number:2601,State:1,Class:14
   --- End of inner exception stack trace ---
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeResultSetAsync(Int32 startCommandIndex, RelationalDataReader reader, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeAsync(RelationalDataReader reader, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Update.Internal.SqlServerModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(IList`1 entriesToSave, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(StateManager stateManager, Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Storage.Internal.SqlServerExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at NayifatAPI.Controllers.DeviceController.RegisterDevice(RegisterDeviceRequest request) in C:\Users\yamta\StudioProjects\nayifat_app_2025_new\nayifatapi\Controllers\DeviceController.cs:line 105
   at Microsoft.AspNetCore.Mvc.Infrastructure.ActionMethodExecutor.TaskOfIActionResultExecutor.Execute(ActionContext actionContext, IActionResultTypeMapper mapper, ObjectMethodExecutor executor, Object controller, Object[] arguments)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.<InvokeActionMethodAsync>g__Awaited|12_0(ControllerActionInvoker invoker, ValueTask`1 actionResultValueTask)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.<InvokeNextActionFilterAsync>g__Awaited|10_0(ControllerActionInvoker invoker, Task lastTask, State next, Scope scope, Object state, Boolean isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.Rethrow(ActionExecutedContextSealed context)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.Next(State& next, Scope& scope, Object& state, Boolean& isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.<InvokeInnerFilterAsync>g__Awaited|13_0(ControllerActionInvoker invoker, Task lastTask, State next, Scope scope, Object state, Boolean isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeFilterPipelineAsync>g__Awaited|20_0(ResourceInvoker invoker, Task lastTask, State next, Scope scope, Object state, Boolean isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeAsync>g__Logged|17_1(ResourceInvoker invoker)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeAsync>g__Logged|17_1(ResourceInvoker invoker)
   at Microsoft.AspNetCore.Routing.EndpointMiddleware.<Invoke>g__AwaitRequestTask|7_0(Endpoint endpoint, Task requestTask, ILogger logger)
   at Microsoft.AspNetCore.Authorization.AuthorizationMiddleware.Invoke(HttpContext context)
   at Program.<>c.<<<Main>$>b__0_3>d.MoveNext() in C:\Users\yamta\StudioProjects\nayifat_app_2025_new\nayifatapi\Program.cs:line 85
2025-02-02 14:12:44.091 +03:00 [ERR] An unhandled exception has occurred while executing the request.
Microsoft.EntityFrameworkCore.DbUpdateException: An error occurred while saving the entity changes. See the inner exception for details.
 ---> Microsoft.Data.SqlClient.SqlException (0x80131904): Cannot insert duplicate key row in object 'dbo.Customer_Devices' with unique index 'IX_Customer_Devices_NationalId_DeviceId'. The duplicate key value is (1064448614, TP1A.220624.014).
   at Microsoft.Data.SqlClient.SqlConnection.OnError(SqlException exception, Boolean breakConnection, Action`1 wrapCloseInAction)
   at Microsoft.Data.SqlClient.SqlInternalConnection.OnError(SqlException exception, Boolean breakConnection, Action`1 wrapCloseInAction)
   at Microsoft.Data.SqlClient.TdsParser.ThrowExceptionAndWarning(TdsParserStateObject stateObj, Boolean callerHasConnectionLock, Boolean asyncClose)
   at Microsoft.Data.SqlClient.TdsParser.TryRun(RunBehavior runBehavior, SqlCommand cmdHandler, SqlDataReader dataStream, BulkCopySimpleResultSet bulkCopyHandler, TdsParserStateObject stateObj, Boolean& dataReady)
   at Microsoft.Data.SqlClient.SqlDataReader.TryHasMoreRows(Boolean& moreRows)
   at Microsoft.Data.SqlClient.SqlDataReader.TryReadInternal(Boolean setTimeout, Boolean& more)
   at Microsoft.Data.SqlClient.SqlDataReader.ReadAsyncExecute(Task task, Object state)
   at Microsoft.Data.SqlClient.SqlDataReader.InvokeAsyncCall[T](SqlDataReaderBaseAsyncCallContext`1 context)
--- End of stack trace from previous location ---
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeResultSetAsync(Int32 startCommandIndex, RelationalDataReader reader, CancellationToken cancellationToken)
ClientConnectionId:4450d9b6-abe6-4125-bc94-21b5a2236b77
Error Number:2601,State:1,Class:14
   --- End of inner exception stack trace ---
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeResultSetAsync(Int32 startCommandIndex, RelationalDataReader reader, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeAsync(RelationalDataReader reader, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Update.Internal.SqlServerModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(IList`1 entriesToSave, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(StateManager stateManager, Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Storage.Internal.SqlServerExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at NayifatAPI.Controllers.DeviceController.RegisterDevice(RegisterDeviceRequest request) in C:\Users\yamta\StudioProjects\nayifat_app_2025_new\nayifatapi\Controllers\DeviceController.cs:line 105
   at Microsoft.AspNetCore.Mvc.Infrastructure.ActionMethodExecutor.TaskOfIActionResultExecutor.Execute(ActionContext actionContext, IActionResultTypeMapper mapper, ObjectMethodExecutor executor, Object controller, Object[] arguments)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.<InvokeActionMethodAsync>g__Awaited|12_0(ControllerActionInvoker invoker, ValueTask`1 actionResultValueTask)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.<InvokeNextActionFilterAsync>g__Awaited|10_0(ControllerActionInvoker invoker, Task lastTask, State next, Scope scope, Object state, Boolean isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.Rethrow(ActionExecutedContextSealed context)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.Next(State& next, Scope& scope, Object& state, Boolean& isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.<InvokeInnerFilterAsync>g__Awaited|13_0(ControllerActionInvoker invoker, Task lastTask, State next, Scope scope, Object state, Boolean isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeFilterPipelineAsync>g__Awaited|20_0(ResourceInvoker invoker, Task lastTask, State next, Scope scope, Object state, Boolean isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeAsync>g__Logged|17_1(ResourceInvoker invoker)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeAsync>g__Logged|17_1(ResourceInvoker invoker)
   at Microsoft.AspNetCore.Routing.EndpointMiddleware.<Invoke>g__AwaitRequestTask|7_0(Endpoint endpoint, Task requestTask, ILogger logger)
   at Microsoft.AspNetCore.Authorization.AuthorizationMiddleware.Invoke(HttpContext context)
   at Program.<>c.<<<Main>$>b__0_3>d.MoveNext() in C:\Users\yamta\StudioProjects\nayifat_app_2025_new\nayifatapi\Program.cs:line 85
--- End of stack trace from previous location ---
   at Swashbuckle.AspNetCore.SwaggerUI.SwaggerUIMiddleware.Invoke(HttpContext httpContext)
   at Swashbuckle.AspNetCore.Swagger.SwaggerMiddleware.Invoke(HttpContext httpContext, ISwaggerProvider swaggerProvider)
   at Microsoft.AspNetCore.Authentication.AuthenticationMiddleware.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Diagnostics.DeveloperExceptionPageMiddlewareImpl.Invoke(HttpContext context)
2025-02-02 14:12:44.112 +03:00 [INF] Request finished HTTP/1.1 POST http://07ca-46-152-255-232.ngrok-free.app/api/device - 500 null text/plain; charset=utf-8 271.335ms
2025-02-02 14:12:44.708 +03:00 [INF] Request starting HTTP/1.1 POST http://07ca-46-152-255-232.ngrok-free.app/api/auth/signin - application/json; charset=utf-8 78
2025-02-02 14:12:44.710 +03:00 [INF] Executing endpoint 'NayifatAPI.Controllers.AuthController.SignIn (NayifatAPI)'
2025-02-02 14:12:44.711 +03:00 [INF] Route matched with {action = "SignIn", controller = "Auth"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] SignIn(NayifatAPI.Controllers.SignInRequest) on controller NayifatAPI.Controllers.AuthController (NayifatAPI).
2025-02-02 14:12:44.717 +03:00 [INF] Executed DbCommand (3ms) [Parameters=[@__providedApiKey_0='?' (Size = 255)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [a].[Key], [a].[CreatedAt], [a].[Description], [a].[ExpiresAt], [a].[IsActive], [a].[LastUsedAt]
FROM [ApiKeys] AS [a]
WHERE [a].[Key] = @__providedApiKey_0 AND [a].[IsActive] = CAST(1 AS bit)
2025-02-02 14:12:44.722 +03:00 [INF] Executed DbCommand (3ms) [Parameters=[@__request_NationalId_0='?' (Size = 450)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [c].[NationalId], [c].[AddNo], [c].[BuildingNo], [c].[City], [c].[Consent], [c].[ConsentDate], [c].[DateOfBirth], [c].[Dependents], [c].[District], [c].[Email], [c].[Employer], [c].[FamilyNameAr], [c].[FamilyNameEn], [c].[FirstNameAr], [c].[FirstNameEn], [c].[Iban], [c].[IdExpiryDate], [c].[Los], [c].[Mpin], [c].[MpinEnabled], [c].[NafathStatus], [c].[NafathTimestamp], [c].[Password], [c].[Phone], [c].[RegistrationDate], [c].[SalaryCustomer], [c].[SalaryDakhli], [c].[SecondNameAr], [c].[SecondNameEn], [c].[Sector], [c].[Street], [c].[ThirdNameAr], [c].[ThirdNameEn], [c].[Zipcode]
FROM [Customers] AS [c]
WHERE [c].[NationalId] = @__request_NationalId_0
2025-02-02 14:12:44.724 +03:00 [INF] Starting password verification for NationalId: 1064448614
2025-02-02 14:12:44.896 +03:00 [INF] Password verification result for NationalId 1064448614: Success
2025-02-02 14:12:44.901 +03:00 [INF] Executed DbCommand (3ms) [Parameters=[@__request_NationalId_0='?' (Size = 450), @__request_DeviceId_1='?' (Size = 450)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [c].[Id], [c].[BiometricEnabled], [c].[BiometricToken], [c].[CreatedAt], [c].[DeviceId], [c].[LastUsedAt], [c].[Manufacturer], [c].[Model], [c].[NationalId], [c].[OsVersion], [c].[Platform], [c].[Status]
FROM [Customer_Devices] AS [c]
WHERE [c].[NationalId] = @__request_NationalId_0 AND [c].[DeviceId] = @__request_DeviceId_1 AND [c].[Status] = N'active'
2025-02-02 14:12:44.912 +03:00 [INF] Executed DbCommand (8ms) [Parameters=[@p0='?' (Size = 4000), @p1='?' (DbType = DateTime2), @p2='?' (Size = 4000), @p3='?' (Size = 4000), @p4='?' (Size = 4000), @p5='?' (Size = 450), @p6='?' (Size = 4000), @p7='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SET IMPLICIT_TRANSACTIONS OFF;
SET NOCOUNT ON;
INSERT INTO [AuthLogs] ([AuthType], [CreatedAt], [DeviceId], [FailureReason], [IpAddress], [NationalId], [Status], [UserAgent])
OUTPUT INSERTED.[Id]
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7);
2025-02-02 14:12:44.914 +03:00 [INF] Executing ObjectResult, writing value of type '<>f__AnonymousType12`3[[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Object, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-02-02 14:12:44.915 +03:00 [INF] Executed action NayifatAPI.Controllers.AuthController.SignIn (NayifatAPI) in 202.556ms
2025-02-02 14:12:44.917 +03:00 [INF] Executed endpoint 'NayifatAPI.Controllers.AuthController.SignIn (NayifatAPI)'
2025-02-02 14:12:44.918 +03:00 [INF] Request finished HTTP/1.1 POST http://07ca-46-152-255-232.ngrok-free.app/api/auth/signin - 401 null application/json; charset=utf-8 210.5407ms
2025-02-02 14:14:14.032 +03:00 [INF] Request starting HTTP/1.1 POST http://07ca-46-152-255-232.ngrok-free.app/api/auth/signin - application/json; charset=utf-8 186
2025-02-02 14:14:14.035 +03:00 [INF] Executing endpoint 'NayifatAPI.Controllers.AuthController.SignIn (NayifatAPI)'
2025-02-02 14:14:14.037 +03:00 [INF] Route matched with {action = "SignIn", controller = "Auth"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] SignIn(NayifatAPI.Controllers.SignInRequest) on controller NayifatAPI.Controllers.AuthController (NayifatAPI).
2025-02-02 14:14:14.053 +03:00 [INF] Executed DbCommand (6ms) [Parameters=[@__providedApiKey_0='?' (Size = 255)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [a].[Key], [a].[CreatedAt], [a].[Description], [a].[ExpiresAt], [a].[IsActive], [a].[LastUsedAt]
FROM [ApiKeys] AS [a]
WHERE [a].[Key] = @__providedApiKey_0 AND [a].[IsActive] = CAST(1 AS bit)
2025-02-02 14:14:14.060 +03:00 [INF] Executed DbCommand (3ms) [Parameters=[@__request_NationalId_0='?' (Size = 450)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [c].[NationalId], [c].[AddNo], [c].[BuildingNo], [c].[City], [c].[Consent], [c].[ConsentDate], [c].[DateOfBirth], [c].[Dependents], [c].[District], [c].[Email], [c].[Employer], [c].[FamilyNameAr], [c].[FamilyNameEn], [c].[FirstNameAr], [c].[FirstNameEn], [c].[Iban], [c].[IdExpiryDate], [c].[Los], [c].[Mpin], [c].[MpinEnabled], [c].[NafathStatus], [c].[NafathTimestamp], [c].[Password], [c].[Phone], [c].[RegistrationDate], [c].[SalaryCustomer], [c].[SalaryDakhli], [c].[SecondNameAr], [c].[SecondNameEn], [c].[Sector], [c].[Street], [c].[ThirdNameAr], [c].[ThirdNameEn], [c].[Zipcode]
FROM [Customers] AS [c]
WHERE [c].[NationalId] = @__request_NationalId_0
2025-02-02 14:14:14.064 +03:00 [INF] Starting password verification for NationalId: 1064448614
2025-02-02 14:14:14.265 +03:00 [INF] Password verification result for NationalId 1064448614: Success
2025-02-02 14:14:14.268 +03:00 [INF] Executed DbCommand (2ms) [Parameters=[@__request_NationalId_0='?' (Size = 450), @__request_DeviceId_1='?' (Size = 450)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [c].[Id], [c].[BiometricEnabled], [c].[BiometricToken], [c].[CreatedAt], [c].[DeviceId], [c].[LastUsedAt], [c].[Manufacturer], [c].[Model], [c].[NationalId], [c].[OsVersion], [c].[Platform], [c].[Status]
FROM [Customer_Devices] AS [c]
WHERE [c].[NationalId] = @__request_NationalId_0 AND [c].[DeviceId] = @__request_DeviceId_1 AND [c].[Status] = N'active'
2025-02-02 14:14:14.347 +03:00 [INF] Executed DbCommand (75ms) [Parameters=[@p0='?' (Size = 4000), @p1='?' (DbType = DateTime2), @p2='?' (Size = 4000), @p3='?' (Size = 4000), @p4='?' (Size = 4000), @p5='?' (Size = 450), @p6='?' (Size = 4000), @p7='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SET IMPLICIT_TRANSACTIONS OFF;
SET NOCOUNT ON;
INSERT INTO [AuthLogs] ([AuthType], [CreatedAt], [DeviceId], [FailureReason], [IpAddress], [NationalId], [Status], [UserAgent])
OUTPUT INSERTED.[Id]
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7);
2025-02-02 14:14:14.350 +03:00 [INF] Executing ObjectResult, writing value of type '<>f__AnonymousType12`3[[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Object, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-02-02 14:14:14.352 +03:00 [INF] Executed action NayifatAPI.Controllers.AuthController.SignIn (NayifatAPI) in 307.5131ms
2025-02-02 14:14:14.353 +03:00 [INF] Executed endpoint 'NayifatAPI.Controllers.AuthController.SignIn (NayifatAPI)'
2025-02-02 14:14:14.355 +03:00 [INF] Request finished HTTP/1.1 POST http://07ca-46-152-255-232.ngrok-free.app/api/auth/signin - 401 null application/json; charset=utf-8 323.6686ms
2025-02-02 14:14:41.451 +03:00 [INF] Request starting HTTP/1.1 POST http://07ca-46-152-255-232.ngrok-free.app/api/notifications/list - application/json; charset=utf-8 47
2025-02-02 14:14:41.454 +03:00 [INF] Executing endpoint 'NayifatAPI.Controllers.NotificationsController.GetNotifications (NayifatAPI)'
2025-02-02 14:14:41.454 +03:00 [INF] Route matched with {action = "GetNotifications", controller = "Notifications"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetNotifications(NayifatAPI.Controllers.GetNotificationsRequest) on controller NayifatAPI.Controllers.NotificationsController (NayifatAPI).
2025-02-02 14:14:41.458 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@__providedApiKey_0='?' (Size = 255)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [a].[Key], [a].[CreatedAt], [a].[Description], [a].[ExpiresAt], [a].[IsActive], [a].[LastUsedAt]
FROM [ApiKeys] AS [a]
WHERE [a].[Key] = @__providedApiKey_0 AND [a].[IsActive] = CAST(1 AS bit)
2025-02-02 14:14:41.466 +03:00 [INF] Executed DbCommand (3ms) [Parameters=[@__request_NationalId_0='?' (Size = 450)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [u].[national_id], [u].[last_updated], [u].[notifications]
FROM [user_notifications] AS [u]
WHERE [u].[national_id] = @__request_NationalId_0
2025-02-02 14:14:41.470 +03:00 [INF] Executed DbCommand (2ms) [Parameters=[@__Parse_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [n].[Id], [n].[additional_data], [n].[Body], [n].[body_ar], [n].[body_en], [n].[created_at], [n].[expiry_at], [n].[Route], [n].[target_criteria], [n].[Title], [n].[title_ar], [n].[title_en]
FROM [notification_templates] AS [n]
WHERE [n].[Id] = @__Parse_0
2025-02-02 14:14:41.472 +03:00 [INF] Executed DbCommand (0ms) [Parameters=[@__Parse_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [n].[Id], [n].[additional_data], [n].[Body], [n].[body_ar], [n].[body_en], [n].[created_at], [n].[expiry_at], [n].[Route], [n].[target_criteria], [n].[Title], [n].[title_ar], [n].[title_en]
FROM [notification_templates] AS [n]
WHERE [n].[Id] = @__Parse_0
2025-02-02 14:14:41.548 +03:00 [INF] Executed DbCommand (73ms) [Parameters=[@p0='?' (Size = 4000), @p1='?' (DbType = DateTime2), @p2='?' (Size = 4000), @p3='?' (Size = 4000), @p4='?' (Size = 4000), @p5='?' (Size = 450), @p6='?' (Size = 4000), @p7='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SET IMPLICIT_TRANSACTIONS OFF;
SET NOCOUNT ON;
INSERT INTO [AuthLogs] ([AuthType], [CreatedAt], [DeviceId], [FailureReason], [IpAddress], [NationalId], [Status], [UserAgent])
OUTPUT INSERTED.[Id]
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7);
2025-02-02 14:14:41.550 +03:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType9`2[[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Object, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-02-02 14:14:41.552 +03:00 [INF] Executed action NayifatAPI.Controllers.NotificationsController.GetNotifications (NayifatAPI) in 95.5795ms
2025-02-02 14:14:41.553 +03:00 [INF] Executed endpoint 'NayifatAPI.Controllers.NotificationsController.GetNotifications (NayifatAPI)'
2025-02-02 14:14:41.554 +03:00 [INF] Request finished HTTP/1.1 POST http://07ca-46-152-255-232.ngrok-free.app/api/notifications/list - 200 null application/json; charset=utf-8 102.7826ms
2025-02-02 14:15:17.833 +03:00 [INF] Request starting HTTP/1.1 POST http://07ca-46-152-255-232.ngrok-free.app/api/auth/signin - application/json; charset=utf-8 78
2025-02-02 14:15:17.836 +03:00 [INF] Executing endpoint 'NayifatAPI.Controllers.AuthController.SignIn (NayifatAPI)'
2025-02-02 14:15:17.837 +03:00 [INF] Route matched with {action = "SignIn", controller = "Auth"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] SignIn(NayifatAPI.Controllers.SignInRequest) on controller NayifatAPI.Controllers.AuthController (NayifatAPI).
2025-02-02 14:15:17.841 +03:00 [INF] Executed DbCommand (2ms) [Parameters=[@__providedApiKey_0='?' (Size = 255)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [a].[Key], [a].[CreatedAt], [a].[Description], [a].[ExpiresAt], [a].[IsActive], [a].[LastUsedAt]
FROM [ApiKeys] AS [a]
WHERE [a].[Key] = @__providedApiKey_0 AND [a].[IsActive] = CAST(1 AS bit)
2025-02-02 14:15:17.846 +03:00 [INF] Executed DbCommand (3ms) [Parameters=[@__request_NationalId_0='?' (Size = 450)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [c].[NationalId], [c].[AddNo], [c].[BuildingNo], [c].[City], [c].[Consent], [c].[ConsentDate], [c].[DateOfBirth], [c].[Dependents], [c].[District], [c].[Email], [c].[Employer], [c].[FamilyNameAr], [c].[FamilyNameEn], [c].[FirstNameAr], [c].[FirstNameEn], [c].[Iban], [c].[IdExpiryDate], [c].[Los], [c].[Mpin], [c].[MpinEnabled], [c].[NafathStatus], [c].[NafathTimestamp], [c].[Password], [c].[Phone], [c].[RegistrationDate], [c].[SalaryCustomer], [c].[SalaryDakhli], [c].[SecondNameAr], [c].[SecondNameEn], [c].[Sector], [c].[Street], [c].[ThirdNameAr], [c].[ThirdNameEn], [c].[Zipcode]
FROM [Customers] AS [c]
WHERE [c].[NationalId] = @__request_NationalId_0
2025-02-02 14:15:17.848 +03:00 [INF] Starting password verification for NationalId: 1064448614
2025-02-02 14:15:18.017 +03:00 [INF] Password verification result for NationalId 1064448614: Success
2025-02-02 14:15:18.021 +03:00 [INF] Executed DbCommand (2ms) [Parameters=[@__request_NationalId_0='?' (Size = 450), @__request_DeviceId_1='?' (Size = 450)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [c].[Id], [c].[BiometricEnabled], [c].[BiometricToken], [c].[CreatedAt], [c].[DeviceId], [c].[LastUsedAt], [c].[Manufacturer], [c].[Model], [c].[NationalId], [c].[OsVersion], [c].[Platform], [c].[Status]
FROM [Customer_Devices] AS [c]
WHERE [c].[NationalId] = @__request_NationalId_0 AND [c].[DeviceId] = @__request_DeviceId_1 AND [c].[Status] = N'active'
2025-02-02 14:15:18.098 +03:00 [INF] Executed DbCommand (75ms) [Parameters=[@p0='?' (Size = 4000), @p1='?' (DbType = DateTime2), @p2='?' (Size = 4000), @p3='?' (Size = 4000), @p4='?' (Size = 4000), @p5='?' (Size = 450), @p6='?' (Size = 4000), @p7='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SET IMPLICIT_TRANSACTIONS OFF;
SET NOCOUNT ON;
INSERT INTO [AuthLogs] ([AuthType], [CreatedAt], [DeviceId], [FailureReason], [IpAddress], [NationalId], [Status], [UserAgent])
OUTPUT INSERTED.[Id]
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7);
2025-02-02 14:15:18.101 +03:00 [INF] Executing ObjectResult, writing value of type '<>f__AnonymousType12`3[[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Object, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-02-02 14:15:18.102 +03:00 [INF] Executed action NayifatAPI.Controllers.AuthController.SignIn (NayifatAPI) in 263.4007ms
2025-02-02 14:15:18.103 +03:00 [INF] Executed endpoint 'NayifatAPI.Controllers.AuthController.SignIn (NayifatAPI)'
2025-02-02 14:15:18.103 +03:00 [INF] Request finished HTTP/1.1 POST http://07ca-46-152-255-232.ngrok-free.app/api/auth/signin - 401 null application/json; charset=utf-8 270.5957ms
2025-02-02 14:19:42.255 +03:00 [INF] Request starting HTTP/1.1 POST http://07ca-46-152-255-232.ngrok-free.app/api/notifications/list - application/json; charset=utf-8 47
2025-02-02 14:19:42.258 +03:00 [INF] Executing endpoint 'NayifatAPI.Controllers.NotificationsController.GetNotifications (NayifatAPI)'
2025-02-02 14:19:42.410 +03:00 [INF] Route matched with {action = "GetNotifications", controller = "Notifications"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetNotifications(NayifatAPI.Controllers.GetNotificationsRequest) on controller NayifatAPI.Controllers.NotificationsController (NayifatAPI).
2025-02-02 14:19:42.625 +03:00 [INF] Executed DbCommand (4ms) [Parameters=[@__providedApiKey_0='?' (Size = 255)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [a].[Key], [a].[CreatedAt], [a].[Description], [a].[ExpiresAt], [a].[IsActive], [a].[LastUsedAt]
FROM [ApiKeys] AS [a]
WHERE [a].[Key] = @__providedApiKey_0 AND [a].[IsActive] = CAST(1 AS bit)
2025-02-02 14:19:42.629 +03:00 [INF] Executed DbCommand (2ms) [Parameters=[@__request_NationalId_0='?' (Size = 450)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [u].[national_id], [u].[last_updated], [u].[notifications]
FROM [user_notifications] AS [u]
WHERE [u].[national_id] = @__request_NationalId_0
2025-02-02 14:19:42.634 +03:00 [INF] Executed DbCommand (2ms) [Parameters=[@__Parse_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [n].[Id], [n].[additional_data], [n].[Body], [n].[body_ar], [n].[body_en], [n].[created_at], [n].[expiry_at], [n].[Route], [n].[target_criteria], [n].[Title], [n].[title_ar], [n].[title_en]
FROM [notification_templates] AS [n]
WHERE [n].[Id] = @__Parse_0
2025-02-02 14:19:42.637 +03:00 [INF] Executed DbCommand (0ms) [Parameters=[@__Parse_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [n].[Id], [n].[additional_data], [n].[Body], [n].[body_ar], [n].[body_en], [n].[created_at], [n].[expiry_at], [n].[Route], [n].[target_criteria], [n].[Title], [n].[title_ar], [n].[title_en]
FROM [notification_templates] AS [n]
WHERE [n].[Id] = @__Parse_0
2025-02-02 14:19:42.715 +03:00 [INF] Executed DbCommand (76ms) [Parameters=[@p0='?' (Size = 4000), @p1='?' (DbType = DateTime2), @p2='?' (Size = 4000), @p3='?' (Size = 4000), @p4='?' (Size = 4000), @p5='?' (Size = 450), @p6='?' (Size = 4000), @p7='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SET IMPLICIT_TRANSACTIONS OFF;
SET NOCOUNT ON;
INSERT INTO [AuthLogs] ([AuthType], [CreatedAt], [DeviceId], [FailureReason], [IpAddress], [NationalId], [Status], [UserAgent])
OUTPUT INSERTED.[Id]
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7);
2025-02-02 14:19:42.717 +03:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType9`2[[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Object, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-02-02 14:19:42.718 +03:00 [INF] Executed action NayifatAPI.Controllers.NotificationsController.GetNotifications (NayifatAPI) in 152.6709ms
2025-02-02 14:19:42.718 +03:00 [INF] Executed endpoint 'NayifatAPI.Controllers.NotificationsController.GetNotifications (NayifatAPI)'
2025-02-02 14:19:42.719 +03:00 [INF] Request finished HTTP/1.1 POST http://07ca-46-152-255-232.ngrok-free.app/api/notifications/list - 200 null application/json; charset=utf-8 464.7564ms
2025-02-02 14:22:29.232 +03:00 [INF] Request starting HTTP/1.1 POST http://07ca-46-152-255-232.ngrok-free.app/api/auth/signin - application/json; charset=utf-8 78
2025-02-02 14:22:29.235 +03:00 [INF] Executing endpoint 'NayifatAPI.Controllers.AuthController.SignIn (NayifatAPI)'
2025-02-02 14:22:29.235 +03:00 [INF] Route matched with {action = "SignIn", controller = "Auth"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] SignIn(NayifatAPI.Controllers.SignInRequest) on controller NayifatAPI.Controllers.AuthController (NayifatAPI).
2025-02-02 14:22:29.240 +03:00 [INF] Executed DbCommand (2ms) [Parameters=[@__providedApiKey_0='?' (Size = 255)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [a].[Key], [a].[CreatedAt], [a].[Description], [a].[ExpiresAt], [a].[IsActive], [a].[LastUsedAt]
FROM [ApiKeys] AS [a]
WHERE [a].[Key] = @__providedApiKey_0 AND [a].[IsActive] = CAST(1 AS bit)
2025-02-02 14:22:29.247 +03:00 [INF] Executed DbCommand (2ms) [Parameters=[@__request_NationalId_0='?' (Size = 450)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [c].[NationalId], [c].[AddNo], [c].[BuildingNo], [c].[City], [c].[Consent], [c].[ConsentDate], [c].[DateOfBirth], [c].[Dependents], [c].[District], [c].[Email], [c].[Employer], [c].[FamilyNameAr], [c].[FamilyNameEn], [c].[FirstNameAr], [c].[FirstNameEn], [c].[Iban], [c].[IdExpiryDate], [c].[Los], [c].[Mpin], [c].[MpinEnabled], [c].[NafathStatus], [c].[NafathTimestamp], [c].[Password], [c].[Phone], [c].[RegistrationDate], [c].[SalaryCustomer], [c].[SalaryDakhli], [c].[SecondNameAr], [c].[SecondNameEn], [c].[Sector], [c].[Street], [c].[ThirdNameAr], [c].[ThirdNameEn], [c].[Zipcode]
FROM [Customers] AS [c]
WHERE [c].[NationalId] = @__request_NationalId_0
2025-02-02 14:22:29.249 +03:00 [INF] Starting password verification for NationalId: 1064448614
2025-02-02 14:22:29.428 +03:00 [INF] Password verification result for NationalId 1064448614: Success
2025-02-02 14:22:29.431 +03:00 [INF] Executed DbCommand (2ms) [Parameters=[@__request_NationalId_0='?' (Size = 450), @__request_DeviceId_1='?' (Size = 450)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [c].[Id], [c].[BiometricEnabled], [c].[BiometricToken], [c].[CreatedAt], [c].[DeviceId], [c].[LastUsedAt], [c].[Manufacturer], [c].[Model], [c].[NationalId], [c].[OsVersion], [c].[Platform], [c].[Status]
FROM [Customer_Devices] AS [c]
WHERE [c].[NationalId] = @__request_NationalId_0 AND [c].[DeviceId] = @__request_DeviceId_1 AND [c].[Status] = N'active'
2025-02-02 14:22:29.508 +03:00 [INF] Executed DbCommand (75ms) [Parameters=[@p0='?' (Size = 4000), @p1='?' (DbType = DateTime2), @p2='?' (Size = 4000), @p3='?' (Size = 4000), @p4='?' (Size = 4000), @p5='?' (Size = 450), @p6='?' (Size = 4000), @p7='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SET IMPLICIT_TRANSACTIONS OFF;
SET NOCOUNT ON;
INSERT INTO [AuthLogs] ([AuthType], [CreatedAt], [DeviceId], [FailureReason], [IpAddress], [NationalId], [Status], [UserAgent])
OUTPUT INSERTED.[Id]
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7);
2025-02-02 14:22:29.511 +03:00 [INF] Executing ObjectResult, writing value of type '<>f__AnonymousType12`3[[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Object, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-02-02 14:22:29.512 +03:00 [INF] Executed action NayifatAPI.Controllers.AuthController.SignIn (NayifatAPI) in 275.2906ms
2025-02-02 14:22:29.513 +03:00 [INF] Executed endpoint 'NayifatAPI.Controllers.AuthController.SignIn (NayifatAPI)'
2025-02-02 14:22:29.514 +03:00 [INF] Request finished HTTP/1.1 POST http://07ca-46-152-255-232.ngrok-free.app/api/auth/signin - 401 null application/json; charset=utf-8 282.0365ms
2025-02-02 14:24:42.352 +03:00 [INF] Request starting HTTP/1.1 POST http://07ca-46-152-255-232.ngrok-free.app/api/notifications/list - application/json; charset=utf-8 47
2025-02-02 14:24:42.354 +03:00 [INF] Executing endpoint 'NayifatAPI.Controllers.NotificationsController.GetNotifications (NayifatAPI)'
2025-02-02 14:24:42.354 +03:00 [INF] Route matched with {action = "GetNotifications", controller = "Notifications"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetNotifications(NayifatAPI.Controllers.GetNotificationsRequest) on controller NayifatAPI.Controllers.NotificationsController (NayifatAPI).
2025-02-02 14:24:42.645 +03:00 [INF] Executed DbCommand (21ms) [Parameters=[@__providedApiKey_0='?' (Size = 255)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [a].[Key], [a].[CreatedAt], [a].[Description], [a].[ExpiresAt], [a].[IsActive], [a].[LastUsedAt]
FROM [ApiKeys] AS [a]
WHERE [a].[Key] = @__providedApiKey_0 AND [a].[IsActive] = CAST(1 AS bit)
2025-02-02 14:24:42.743 +03:00 [INF] Executed DbCommand (95ms) [Parameters=[@__request_NationalId_0='?' (Size = 450)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [u].[national_id], [u].[last_updated], [u].[notifications]
FROM [user_notifications] AS [u]
WHERE [u].[national_id] = @__request_NationalId_0
2025-02-02 14:24:42.920 +03:00 [INF] Executed DbCommand (3ms) [Parameters=[@__Parse_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [n].[Id], [n].[additional_data], [n].[Body], [n].[body_ar], [n].[body_en], [n].[created_at], [n].[expiry_at], [n].[Route], [n].[target_criteria], [n].[Title], [n].[title_ar], [n].[title_en]
FROM [notification_templates] AS [n]
WHERE [n].[Id] = @__Parse_0
2025-02-02 14:24:43.233 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@__Parse_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [n].[Id], [n].[additional_data], [n].[Body], [n].[body_ar], [n].[body_en], [n].[created_at], [n].[expiry_at], [n].[Route], [n].[target_criteria], [n].[Title], [n].[title_ar], [n].[title_en]
FROM [notification_templates] AS [n]
WHERE [n].[Id] = @__Parse_0
2025-02-02 14:24:43.735 +03:00 [INF] Executed DbCommand (231ms) [Parameters=[@p0='?' (Size = 4000), @p1='?' (DbType = DateTime2), @p2='?' (Size = 4000), @p3='?' (Size = 4000), @p4='?' (Size = 4000), @p5='?' (Size = 450), @p6='?' (Size = 4000), @p7='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SET IMPLICIT_TRANSACTIONS OFF;
SET NOCOUNT ON;
INSERT INTO [AuthLogs] ([AuthType], [CreatedAt], [DeviceId], [FailureReason], [IpAddress], [NationalId], [Status], [UserAgent])
OUTPUT INSERTED.[Id]
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7);
2025-02-02 14:24:43.769 +03:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType9`2[[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Object, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-02-02 14:24:43.771 +03:00 [INF] Executed action NayifatAPI.Controllers.NotificationsController.GetNotifications (NayifatAPI) in 1153.3933ms
2025-02-02 14:24:43.774 +03:00 [INF] Executed endpoint 'NayifatAPI.Controllers.NotificationsController.GetNotifications (NayifatAPI)'
2025-02-02 14:24:43.776 +03:00 [INF] Request finished HTTP/1.1 POST http://07ca-46-152-255-232.ngrok-free.app/api/notifications/list - 200 null application/json; charset=utf-8 1424.0559ms
2025-02-02 14:29:42.370 +03:00 [INF] Request starting HTTP/1.1 POST http://07ca-46-152-255-232.ngrok-free.app/api/notifications/list - application/json; charset=utf-8 47
2025-02-02 14:29:42.377 +03:00 [INF] Executing endpoint 'NayifatAPI.Controllers.NotificationsController.GetNotifications (NayifatAPI)'
2025-02-02 14:29:42.379 +03:00 [INF] Route matched with {action = "GetNotifications", controller = "Notifications"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetNotifications(NayifatAPI.Controllers.GetNotificationsRequest) on controller NayifatAPI.Controllers.NotificationsController (NayifatAPI).
2025-02-02 14:29:42.427 +03:00 [INF] Executed DbCommand (5ms) [Parameters=[@__providedApiKey_0='?' (Size = 255)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [a].[Key], [a].[CreatedAt], [a].[Description], [a].[ExpiresAt], [a].[IsActive], [a].[LastUsedAt]
FROM [ApiKeys] AS [a]
WHERE [a].[Key] = @__providedApiKey_0 AND [a].[IsActive] = CAST(1 AS bit)
2025-02-02 14:29:42.432 +03:00 [INF] Executed DbCommand (2ms) [Parameters=[@__request_NationalId_0='?' (Size = 450)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [u].[national_id], [u].[last_updated], [u].[notifications]
FROM [user_notifications] AS [u]
WHERE [u].[national_id] = @__request_NationalId_0
2025-02-02 14:29:42.439 +03:00 [INF] Executed DbCommand (4ms) [Parameters=[@__Parse_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [n].[Id], [n].[additional_data], [n].[Body], [n].[body_ar], [n].[body_en], [n].[created_at], [n].[expiry_at], [n].[Route], [n].[target_criteria], [n].[Title], [n].[title_ar], [n].[title_en]
FROM [notification_templates] AS [n]
WHERE [n].[Id] = @__Parse_0
2025-02-02 14:29:42.444 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@__Parse_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [n].[Id], [n].[additional_data], [n].[Body], [n].[body_ar], [n].[body_en], [n].[created_at], [n].[expiry_at], [n].[Route], [n].[target_criteria], [n].[Title], [n].[title_ar], [n].[title_en]
FROM [notification_templates] AS [n]
WHERE [n].[Id] = @__Parse_0
2025-02-02 14:29:42.523 +03:00 [INF] Executed DbCommand (77ms) [Parameters=[@p0='?' (Size = 4000), @p1='?' (DbType = DateTime2), @p2='?' (Size = 4000), @p3='?' (Size = 4000), @p4='?' (Size = 4000), @p5='?' (Size = 450), @p6='?' (Size = 4000), @p7='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SET IMPLICIT_TRANSACTIONS OFF;
SET NOCOUNT ON;
INSERT INTO [AuthLogs] ([AuthType], [CreatedAt], [DeviceId], [FailureReason], [IpAddress], [NationalId], [Status], [UserAgent])
OUTPUT INSERTED.[Id]
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7);
2025-02-02 14:29:42.528 +03:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType9`2[[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Object, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-02-02 14:29:42.529 +03:00 [INF] Executed action NayifatAPI.Controllers.NotificationsController.GetNotifications (NayifatAPI) in 141.6093ms
2025-02-02 14:29:42.531 +03:00 [INF] Executed endpoint 'NayifatAPI.Controllers.NotificationsController.GetNotifications (NayifatAPI)'
2025-02-02 14:29:42.533 +03:00 [INF] Request finished HTTP/1.1 POST http://07ca-46-152-255-232.ngrok-free.app/api/notifications/list - 200 null application/json; charset=utf-8 163.144ms
2025-02-02 14:30:17.030 +03:00 [INF] Request starting HTTP/1.1 POST http://07ca-46-152-255-232.ngrok-free.app/api/device - application/json, 243
2025-02-02 14:30:17.032 +03:00 [INF] Executing endpoint 'NayifatAPI.Controllers.DeviceController.RegisterDevice (NayifatAPI)'
2025-02-02 14:30:17.033 +03:00 [INF] Route matched with {action = "RegisterDevice", controller = "Device"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] RegisterDevice(NayifatAPI.Controllers.RegisterDeviceRequest) on controller NayifatAPI.Controllers.DeviceController (NayifatAPI).
2025-02-02 14:30:17.036 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@__providedApiKey_0='?' (Size = 255)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [a].[Key], [a].[CreatedAt], [a].[Description], [a].[ExpiresAt], [a].[IsActive], [a].[LastUsedAt]
FROM [ApiKeys] AS [a]
WHERE [a].[Key] = @__providedApiKey_0 AND [a].[IsActive] = CAST(1 AS bit)
2025-02-02 14:30:17.039 +03:00 [INF] Executing ObjectResult, writing value of type '<>f__AnonymousType11`2[[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-02-02 14:30:17.041 +03:00 [INF] Executed action NayifatAPI.Controllers.DeviceController.RegisterDevice (NayifatAPI) in 6.2918ms
2025-02-02 14:30:17.042 +03:00 [INF] Executed endpoint 'NayifatAPI.Controllers.DeviceController.RegisterDevice (NayifatAPI)'
2025-02-02 14:30:17.043 +03:00 [INF] Request finished HTTP/1.1 POST http://07ca-46-152-255-232.ngrok-free.app/api/device - 401 null application/json; charset=utf-8 12.9867ms
2025-02-02 14:30:40.164 +03:00 [INF] Request starting HTTP/1.1 POST http://07ca-46-152-255-232.ngrok-free.app/api/device - application/json, 243
2025-02-02 14:30:40.166 +03:00 [INF] Executing endpoint 'NayifatAPI.Controllers.DeviceController.RegisterDevice (NayifatAPI)'
2025-02-02 14:30:40.168 +03:00 [INF] Route matched with {action = "RegisterDevice", controller = "Device"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] RegisterDevice(NayifatAPI.Controllers.RegisterDeviceRequest) on controller NayifatAPI.Controllers.DeviceController (NayifatAPI).
2025-02-02 14:30:40.174 +03:00 [INF] Executed DbCommand (4ms) [Parameters=[@__providedApiKey_0='?' (Size = 255)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [a].[Key], [a].[CreatedAt], [a].[Description], [a].[ExpiresAt], [a].[IsActive], [a].[LastUsedAt]
FROM [ApiKeys] AS [a]
WHERE [a].[Key] = @__providedApiKey_0 AND [a].[IsActive] = CAST(1 AS bit)
2025-02-02 14:30:40.176 +03:00 [INF] Executing ObjectResult, writing value of type '<>f__AnonymousType11`2[[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-02-02 14:30:40.179 +03:00 [INF] Executed action NayifatAPI.Controllers.DeviceController.RegisterDevice (NayifatAPI) in 9.8645ms
2025-02-02 14:30:40.180 +03:00 [INF] Executed endpoint 'NayifatAPI.Controllers.DeviceController.RegisterDevice (NayifatAPI)'
2025-02-02 14:30:40.181 +03:00 [INF] Request finished HTTP/1.1 POST http://07ca-46-152-255-232.ngrok-free.app/api/device - 401 null application/json; charset=utf-8 17ms
2025-02-02 14:30:55.286 +03:00 [INF] Request starting HTTP/1.1 POST http://07ca-46-152-255-232.ngrok-free.app/api/device - application/json, 243
2025-02-02 14:30:55.289 +03:00 [INF] Executing endpoint 'NayifatAPI.Controllers.DeviceController.RegisterDevice (NayifatAPI)'
2025-02-02 14:30:55.291 +03:00 [INF] Route matched with {action = "RegisterDevice", controller = "Device"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] RegisterDevice(NayifatAPI.Controllers.RegisterDeviceRequest) on controller NayifatAPI.Controllers.DeviceController (NayifatAPI).
2025-02-02 14:30:55.294 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@__providedApiKey_0='?' (Size = 255)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [a].[Key], [a].[CreatedAt], [a].[Description], [a].[ExpiresAt], [a].[IsActive], [a].[LastUsedAt]
FROM [ApiKeys] AS [a]
WHERE [a].[Key] = @__providedApiKey_0 AND [a].[IsActive] = CAST(1 AS bit)
2025-02-02 14:30:55.297 +03:00 [INF] Executing ObjectResult, writing value of type '<>f__AnonymousType11`2[[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-02-02 14:30:55.299 +03:00 [INF] Executed action NayifatAPI.Controllers.DeviceController.RegisterDevice (NayifatAPI) in 6.9296ms
2025-02-02 14:30:55.300 +03:00 [INF] Executed endpoint 'NayifatAPI.Controllers.DeviceController.RegisterDevice (NayifatAPI)'
2025-02-02 14:30:55.302 +03:00 [INF] Request finished HTTP/1.1 POST http://07ca-46-152-255-232.ngrok-free.app/api/device - 401 null application/json; charset=utf-8 16.2476ms
2025-02-02 14:30:59.748 +03:00 [INF] Request starting HTTP/1.1 POST http://07ca-46-152-255-232.ngrok-free.app/api/device - application/json, 243
2025-02-02 14:30:59.755 +03:00 [INF] Executing endpoint 'NayifatAPI.Controllers.DeviceController.RegisterDevice (NayifatAPI)'
2025-02-02 14:30:59.757 +03:00 [INF] Route matched with {action = "RegisterDevice", controller = "Device"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] RegisterDevice(NayifatAPI.Controllers.RegisterDeviceRequest) on controller NayifatAPI.Controllers.DeviceController (NayifatAPI).
2025-02-02 14:30:59.762 +03:00 [INF] Executing ObjectResult, writing value of type '<>f__AnonymousType11`2[[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-02-02 14:30:59.775 +03:00 [INF] Executed action NayifatAPI.Controllers.DeviceController.RegisterDevice (NayifatAPI) in 13.4991ms
2025-02-02 14:30:59.778 +03:00 [INF] Executed endpoint 'NayifatAPI.Controllers.DeviceController.RegisterDevice (NayifatAPI)'
2025-02-02 14:30:59.779 +03:00 [INF] Request finished HTTP/1.1 POST http://07ca-46-152-255-232.ngrok-free.app/api/device - 401 null application/json; charset=utf-8 31.2622ms
2025-02-02 14:31:38.918 +03:00 [INF] Request starting HTTP/1.1 POST http://07ca-46-152-255-232.ngrok-free.app/api/device - application/json, 243
2025-02-02 14:31:39.236 +03:00 [INF] Executing endpoint 'NayifatAPI.Controllers.DeviceController.RegisterDevice (NayifatAPI)'
2025-02-02 14:31:39.238 +03:00 [INF] Route matched with {action = "RegisterDevice", controller = "Device"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] RegisterDevice(NayifatAPI.Controllers.RegisterDeviceRequest) on controller NayifatAPI.Controllers.DeviceController (NayifatAPI).
2025-02-02 14:31:39.530 +03:00 [INF] Executing ObjectResult, writing value of type '<>f__AnonymousType11`2[[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-02-02 14:31:39.535 +03:00 [INF] Executed action NayifatAPI.Controllers.DeviceController.RegisterDevice (NayifatAPI) in 5.8363ms
2025-02-02 14:31:39.537 +03:00 [INF] Executed endpoint 'NayifatAPI.Controllers.DeviceController.RegisterDevice (NayifatAPI)'
2025-02-02 14:31:39.538 +03:00 [INF] Request finished HTTP/1.1 POST http://07ca-46-152-255-232.ngrok-free.app/api/device - 401 null application/json; charset=utf-8 619.9963ms
2025-02-02 14:31:59.567 +03:00 [INF] Request starting HTTP/1.1 POST http://07ca-46-152-255-232.ngrok-free.app/api/device - application/json, 243
2025-02-02 14:31:59.572 +03:00 [INF] Executing endpoint 'NayifatAPI.Controllers.DeviceController.RegisterDevice (NayifatAPI)'
2025-02-02 14:31:59.573 +03:00 [INF] Route matched with {action = "RegisterDevice", controller = "Device"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] RegisterDevice(NayifatAPI.Controllers.RegisterDeviceRequest) on controller NayifatAPI.Controllers.DeviceController (NayifatAPI).
2025-02-02 14:31:59.575 +03:00 [INF] Executing ObjectResult, writing value of type '<>f__AnonymousType11`2[[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-02-02 14:31:59.577 +03:00 [INF] Executed action NayifatAPI.Controllers.DeviceController.RegisterDevice (NayifatAPI) in 1.8472ms
2025-02-02 14:31:59.577 +03:00 [INF] Executed endpoint 'NayifatAPI.Controllers.DeviceController.RegisterDevice (NayifatAPI)'
2025-02-02 14:31:59.578 +03:00 [INF] Request finished HTTP/1.1 POST http://07ca-46-152-255-232.ngrok-free.app/api/device - 401 null application/json; charset=utf-8 10.9529ms
2025-02-02 14:34:23.833 +03:00 [INF] Request starting HTTP/1.1 POST http://07ca-46-152-255-232.ngrok-free.app/api/device - application/json 243
2025-02-02 14:34:23.836 +03:00 [INF] Executing endpoint 'NayifatAPI.Controllers.DeviceController.RegisterDevice (NayifatAPI)'
2025-02-02 14:34:23.837 +03:00 [INF] Route matched with {action = "RegisterDevice", controller = "Device"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] RegisterDevice(NayifatAPI.Controllers.RegisterDeviceRequest) on controller NayifatAPI.Controllers.DeviceController (NayifatAPI).
2025-02-02 14:34:23.842 +03:00 [INF] Executed DbCommand (2ms) [Parameters=[@__providedApiKey_0='?' (Size = 255)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [a].[Key], [a].[CreatedAt], [a].[Description], [a].[ExpiresAt], [a].[IsActive], [a].[LastUsedAt]
FROM [ApiKeys] AS [a]
WHERE [a].[Key] = @__providedApiKey_0 AND [a].[IsActive] = CAST(1 AS bit)
2025-02-02 14:34:23.848 +03:00 [INF] Executed DbCommand (4ms) [Parameters=[@__p_0='?' (Size = 450)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [c].[NationalId], [c].[AddNo], [c].[BuildingNo], [c].[City], [c].[Consent], [c].[ConsentDate], [c].[DateOfBirth], [c].[Dependents], [c].[District], [c].[Email], [c].[Employer], [c].[FamilyNameAr], [c].[FamilyNameEn], [c].[FirstNameAr], [c].[FirstNameEn], [c].[Iban], [c].[IdExpiryDate], [c].[Los], [c].[Mpin], [c].[MpinEnabled], [c].[NafathStatus], [c].[NafathTimestamp], [c].[Password], [c].[Phone], [c].[RegistrationDate], [c].[SalaryCustomer], [c].[SalaryDakhli], [c].[SecondNameAr], [c].[SecondNameEn], [c].[Sector], [c].[Street], [c].[ThirdNameAr], [c].[ThirdNameEn], [c].[Zipcode]
FROM [Customers] AS [c]
WHERE [c].[NationalId] = @__p_0
2025-02-02 14:34:23.928 +03:00 [INF] Executed DbCommand (77ms) [Parameters=[@__request_NationalId_0='?' (Size = 450)], CommandType='"Text"', CommandTimeout='30']
UPDATE [c]
SET [c].[LastUsedAt] = GETUTCDATE(),
    [c].[Status] = N'disabled'
FROM [Customer_Devices] AS [c]
WHERE [c].[NationalId] = @__request_NationalId_0
2025-02-02 14:34:23.943 +03:00 [INF] Executed DbCommand (8ms) [Parameters=[@p0='?' (Size = 4000), @p1='?' (DbType = DateTime2), @p2='?' (Size = 4000), @p3='?' (Size = 4000), @p4='?' (Size = 4000), @p5='?' (Size = 450), @p6='?' (Size = 4000), @p7='?' (Size = 4000), @p8='?' (DbType = Boolean), @p9='?' (Size = 4000), @p10='?' (DbType = DateTime2), @p11='?' (Size = 450), @p12='?' (DbType = DateTime2), @p13='?' (Size = 4000), @p14='?' (Size = 4000), @p15='?' (Size = 450), @p16='?' (Size = 4000), @p17='?' (Size = 4000), @p18='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SET NOCOUNT ON;
INSERT INTO [AuthLogs] ([AuthType], [CreatedAt], [DeviceId], [FailureReason], [IpAddress], [NationalId], [Status], [UserAgent])
OUTPUT INSERTED.[Id]
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7);
INSERT INTO [Customer_Devices] ([BiometricEnabled], [BiometricToken], [CreatedAt], [DeviceId], [LastUsedAt], [Manufacturer], [Model], [NationalId], [OsVersion], [Platform], [Status])
OUTPUT INSERTED.[Id]
VALUES (@p8, @p9, @p10, @p11, @p12, @p13, @p14, @p15, @p16, @p17, @p18);
2025-02-02 14:34:23.951 +03:00 [ERR] An exception occurred in the database while saving changes for context type 'NayifatAPI.Data.ApplicationDbContext'.
Microsoft.EntityFrameworkCore.DbUpdateException: An error occurred while saving the entity changes. See the inner exception for details.
 ---> Microsoft.Data.SqlClient.SqlException (0x80131904): Cannot insert duplicate key row in object 'dbo.Customer_Devices' with unique index 'IX_Customer_Devices_NationalId_DeviceId'. The duplicate key value is (1064448614, TP1A.220624.014).
   at Microsoft.Data.SqlClient.SqlConnection.OnError(SqlException exception, Boolean breakConnection, Action`1 wrapCloseInAction)
   at Microsoft.Data.SqlClient.SqlInternalConnection.OnError(SqlException exception, Boolean breakConnection, Action`1 wrapCloseInAction)
   at Microsoft.Data.SqlClient.TdsParser.ThrowExceptionAndWarning(TdsParserStateObject stateObj, Boolean callerHasConnectionLock, Boolean asyncClose)
   at Microsoft.Data.SqlClient.TdsParser.TryRun(RunBehavior runBehavior, SqlCommand cmdHandler, SqlDataReader dataStream, BulkCopySimpleResultSet bulkCopyHandler, TdsParserStateObject stateObj, Boolean& dataReady)
   at Microsoft.Data.SqlClient.SqlDataReader.TryHasMoreRows(Boolean& moreRows)
   at Microsoft.Data.SqlClient.SqlDataReader.TryReadInternal(Boolean setTimeout, Boolean& more)
   at Microsoft.Data.SqlClient.SqlDataReader.ReadAsyncExecute(Task task, Object state)
   at Microsoft.Data.SqlClient.SqlDataReader.InvokeAsyncCall[T](SqlDataReaderBaseAsyncCallContext`1 context)
--- End of stack trace from previous location ---
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeResultSetAsync(Int32 startCommandIndex, RelationalDataReader reader, CancellationToken cancellationToken)
ClientConnectionId:0fab9114-c68a-4b80-8ea2-733d9105c5ba
Error Number:2601,State:1,Class:14
   --- End of inner exception stack trace ---
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeResultSetAsync(Int32 startCommandIndex, RelationalDataReader reader, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeAsync(RelationalDataReader reader, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Update.Internal.SqlServerModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(IList`1 entriesToSave, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(StateManager stateManager, Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Storage.Internal.SqlServerExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
Microsoft.EntityFrameworkCore.DbUpdateException: An error occurred while saving the entity changes. See the inner exception for details.
 ---> Microsoft.Data.SqlClient.SqlException (0x80131904): Cannot insert duplicate key row in object 'dbo.Customer_Devices' with unique index 'IX_Customer_Devices_NationalId_DeviceId'. The duplicate key value is (1064448614, TP1A.220624.014).
   at Microsoft.Data.SqlClient.SqlConnection.OnError(SqlException exception, Boolean breakConnection, Action`1 wrapCloseInAction)
   at Microsoft.Data.SqlClient.SqlInternalConnection.OnError(SqlException exception, Boolean breakConnection, Action`1 wrapCloseInAction)
   at Microsoft.Data.SqlClient.TdsParser.ThrowExceptionAndWarning(TdsParserStateObject stateObj, Boolean callerHasConnectionLock, Boolean asyncClose)
   at Microsoft.Data.SqlClient.TdsParser.TryRun(RunBehavior runBehavior, SqlCommand cmdHandler, SqlDataReader dataStream, BulkCopySimpleResultSet bulkCopyHandler, TdsParserStateObject stateObj, Boolean& dataReady)
   at Microsoft.Data.SqlClient.SqlDataReader.TryHasMoreRows(Boolean& moreRows)
   at Microsoft.Data.SqlClient.SqlDataReader.TryReadInternal(Boolean setTimeout, Boolean& more)
   at Microsoft.Data.SqlClient.SqlDataReader.ReadAsyncExecute(Task task, Object state)
   at Microsoft.Data.SqlClient.SqlDataReader.InvokeAsyncCall[T](SqlDataReaderBaseAsyncCallContext`1 context)
--- End of stack trace from previous location ---
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeResultSetAsync(Int32 startCommandIndex, RelationalDataReader reader, CancellationToken cancellationToken)
ClientConnectionId:0fab9114-c68a-4b80-8ea2-733d9105c5ba
Error Number:2601,State:1,Class:14
   --- End of inner exception stack trace ---
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeResultSetAsync(Int32 startCommandIndex, RelationalDataReader reader, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeAsync(RelationalDataReader reader, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Update.Internal.SqlServerModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(IList`1 entriesToSave, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(StateManager stateManager, Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Storage.Internal.SqlServerExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
2025-02-02 14:34:23.965 +03:00 [ERR] Error registering device for National ID: 1064448614
Microsoft.EntityFrameworkCore.DbUpdateException: An error occurred while saving the entity changes. See the inner exception for details.
 ---> Microsoft.Data.SqlClient.SqlException (0x80131904): Cannot insert duplicate key row in object 'dbo.Customer_Devices' with unique index 'IX_Customer_Devices_NationalId_DeviceId'. The duplicate key value is (1064448614, TP1A.220624.014).
   at Microsoft.Data.SqlClient.SqlConnection.OnError(SqlException exception, Boolean breakConnection, Action`1 wrapCloseInAction)
   at Microsoft.Data.SqlClient.SqlInternalConnection.OnError(SqlException exception, Boolean breakConnection, Action`1 wrapCloseInAction)
   at Microsoft.Data.SqlClient.TdsParser.ThrowExceptionAndWarning(TdsParserStateObject stateObj, Boolean callerHasConnectionLock, Boolean asyncClose)
   at Microsoft.Data.SqlClient.TdsParser.TryRun(RunBehavior runBehavior, SqlCommand cmdHandler, SqlDataReader dataStream, BulkCopySimpleResultSet bulkCopyHandler, TdsParserStateObject stateObj, Boolean& dataReady)
   at Microsoft.Data.SqlClient.SqlDataReader.TryHasMoreRows(Boolean& moreRows)
   at Microsoft.Data.SqlClient.SqlDataReader.TryReadInternal(Boolean setTimeout, Boolean& more)
   at Microsoft.Data.SqlClient.SqlDataReader.ReadAsyncExecute(Task task, Object state)
   at Microsoft.Data.SqlClient.SqlDataReader.InvokeAsyncCall[T](SqlDataReaderBaseAsyncCallContext`1 context)
--- End of stack trace from previous location ---
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeResultSetAsync(Int32 startCommandIndex, RelationalDataReader reader, CancellationToken cancellationToken)
ClientConnectionId:0fab9114-c68a-4b80-8ea2-733d9105c5ba
Error Number:2601,State:1,Class:14
   --- End of inner exception stack trace ---
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeResultSetAsync(Int32 startCommandIndex, RelationalDataReader reader, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeAsync(RelationalDataReader reader, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Update.Internal.SqlServerModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(IList`1 entriesToSave, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(StateManager stateManager, Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Storage.Internal.SqlServerExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at NayifatAPI.Controllers.DeviceController.RegisterDevice(RegisterDeviceRequest request) in C:\Users\yamta\StudioProjects\nayifat_app_2025_new\nayifatapi\Controllers\DeviceController.cs:line 78
2025-02-02 14:34:23.988 +03:00 [INF] Executed DbCommand (12ms) [Parameters=[@p0='?' (Size = 4000), @p1='?' (DbType = DateTime2), @p2='?' (Size = 4000), @p3='?' (Size = 4000), @p4='?' (Size = 4000), @p5='?' (Size = 450), @p6='?' (Size = 4000), @p7='?' (Size = 4000), @p8='?' (Size = 4000), @p9='?' (DbType = DateTime2), @p10='?' (Size = 4000), @p11='?' (Size = 4000), @p12='?' (Size = 4000), @p13='?' (Size = 450), @p14='?' (Size = 4000), @p15='?' (Size = 4000), @p16='?' (DbType = Boolean), @p17='?' (Size = 4000), @p18='?' (DbType = DateTime2), @p19='?' (Size = 450), @p20='?' (DbType = DateTime2), @p21='?' (Size = 4000), @p22='?' (Size = 4000), @p23='?' (Size = 450), @p24='?' (Size = 4000), @p25='?' (Size = 4000), @p26='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SET NOCOUNT ON;
MERGE [AuthLogs] USING (
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7, 0),
(@p8, @p9, @p10, @p11, @p12, @p13, @p14, @p15, 1)) AS i ([AuthType], [CreatedAt], [DeviceId], [FailureReason], [IpAddress], [NationalId], [Status], [UserAgent], _Position) ON 1=0
WHEN NOT MATCHED THEN
INSERT ([AuthType], [CreatedAt], [DeviceId], [FailureReason], [IpAddress], [NationalId], [Status], [UserAgent])
VALUES (i.[AuthType], i.[CreatedAt], i.[DeviceId], i.[FailureReason], i.[IpAddress], i.[NationalId], i.[Status], i.[UserAgent])
OUTPUT INSERTED.[Id], i._Position;
INSERT INTO [Customer_Devices] ([BiometricEnabled], [BiometricToken], [CreatedAt], [DeviceId], [LastUsedAt], [Manufacturer], [Model], [NationalId], [OsVersion], [Platform], [Status])
OUTPUT INSERTED.[Id]
VALUES (@p16, @p17, @p18, @p19, @p20, @p21, @p22, @p23, @p24, @p25, @p26);
2025-02-02 14:34:23.993 +03:00 [ERR] An exception occurred in the database while saving changes for context type 'NayifatAPI.Data.ApplicationDbContext'.
Microsoft.EntityFrameworkCore.DbUpdateException: An error occurred while saving the entity changes. See the inner exception for details.
 ---> Microsoft.Data.SqlClient.SqlException (0x80131904): Cannot insert duplicate key row in object 'dbo.Customer_Devices' with unique index 'IX_Customer_Devices_NationalId_DeviceId'. The duplicate key value is (1064448614, TP1A.220624.014).
   at Microsoft.Data.SqlClient.SqlConnection.OnError(SqlException exception, Boolean breakConnection, Action`1 wrapCloseInAction)
   at Microsoft.Data.SqlClient.SqlInternalConnection.OnError(SqlException exception, Boolean breakConnection, Action`1 wrapCloseInAction)
   at Microsoft.Data.SqlClient.TdsParser.ThrowExceptionAndWarning(TdsParserStateObject stateObj, Boolean callerHasConnectionLock, Boolean asyncClose)
   at Microsoft.Data.SqlClient.TdsParser.TryRun(RunBehavior runBehavior, SqlCommand cmdHandler, SqlDataReader dataStream, BulkCopySimpleResultSet bulkCopyHandler, TdsParserStateObject stateObj, Boolean& dataReady)
   at Microsoft.Data.SqlClient.SqlDataReader.TryHasMoreRows(Boolean& moreRows)
   at Microsoft.Data.SqlClient.SqlDataReader.TryReadInternal(Boolean setTimeout, Boolean& more)
   at Microsoft.Data.SqlClient.SqlDataReader.ReadAsyncExecute(Task task, Object state)
   at Microsoft.Data.SqlClient.SqlDataReader.InvokeAsyncCall[T](SqlDataReaderBaseAsyncCallContext`1 context)
--- End of stack trace from previous location ---
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeResultSetAsync(Int32 startCommandIndex, RelationalDataReader reader, CancellationToken cancellationToken)
ClientConnectionId:0fab9114-c68a-4b80-8ea2-733d9105c5ba
Error Number:2601,State:1,Class:14
   --- End of inner exception stack trace ---
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeResultSetAsync(Int32 startCommandIndex, RelationalDataReader reader, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeAsync(RelationalDataReader reader, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Update.Internal.SqlServerModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(IList`1 entriesToSave, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(StateManager stateManager, Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Storage.Internal.SqlServerExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
Microsoft.EntityFrameworkCore.DbUpdateException: An error occurred while saving the entity changes. See the inner exception for details.
 ---> Microsoft.Data.SqlClient.SqlException (0x80131904): Cannot insert duplicate key row in object 'dbo.Customer_Devices' with unique index 'IX_Customer_Devices_NationalId_DeviceId'. The duplicate key value is (1064448614, TP1A.220624.014).
   at Microsoft.Data.SqlClient.SqlConnection.OnError(SqlException exception, Boolean breakConnection, Action`1 wrapCloseInAction)
   at Microsoft.Data.SqlClient.SqlInternalConnection.OnError(SqlException exception, Boolean breakConnection, Action`1 wrapCloseInAction)
   at Microsoft.Data.SqlClient.TdsParser.ThrowExceptionAndWarning(TdsParserStateObject stateObj, Boolean callerHasConnectionLock, Boolean asyncClose)
   at Microsoft.Data.SqlClient.TdsParser.TryRun(RunBehavior runBehavior, SqlCommand cmdHandler, SqlDataReader dataStream, BulkCopySimpleResultSet bulkCopyHandler, TdsParserStateObject stateObj, Boolean& dataReady)
   at Microsoft.Data.SqlClient.SqlDataReader.TryHasMoreRows(Boolean& moreRows)
   at Microsoft.Data.SqlClient.SqlDataReader.TryReadInternal(Boolean setTimeout, Boolean& more)
   at Microsoft.Data.SqlClient.SqlDataReader.ReadAsyncExecute(Task task, Object state)
   at Microsoft.Data.SqlClient.SqlDataReader.InvokeAsyncCall[T](SqlDataReaderBaseAsyncCallContext`1 context)
--- End of stack trace from previous location ---
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeResultSetAsync(Int32 startCommandIndex, RelationalDataReader reader, CancellationToken cancellationToken)
ClientConnectionId:0fab9114-c68a-4b80-8ea2-733d9105c5ba
Error Number:2601,State:1,Class:14
   --- End of inner exception stack trace ---
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeResultSetAsync(Int32 startCommandIndex, RelationalDataReader reader, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeAsync(RelationalDataReader reader, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Update.Internal.SqlServerModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(IList`1 entriesToSave, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(StateManager stateManager, Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Storage.Internal.SqlServerExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
2025-02-02 14:34:24.007 +03:00 [INF] Executed action NayifatAPI.Controllers.DeviceController.RegisterDevice (NayifatAPI) in 169.2863ms
2025-02-02 14:34:24.008 +03:00 [INF] Executed endpoint 'NayifatAPI.Controllers.DeviceController.RegisterDevice (NayifatAPI)'
2025-02-02 14:34:24.009 +03:00 [ERR] Unhandled exception
Microsoft.EntityFrameworkCore.DbUpdateException: An error occurred while saving the entity changes. See the inner exception for details.
 ---> Microsoft.Data.SqlClient.SqlException (0x80131904): Cannot insert duplicate key row in object 'dbo.Customer_Devices' with unique index 'IX_Customer_Devices_NationalId_DeviceId'. The duplicate key value is (1064448614, TP1A.220624.014).
   at Microsoft.Data.SqlClient.SqlConnection.OnError(SqlException exception, Boolean breakConnection, Action`1 wrapCloseInAction)
   at Microsoft.Data.SqlClient.SqlInternalConnection.OnError(SqlException exception, Boolean breakConnection, Action`1 wrapCloseInAction)
   at Microsoft.Data.SqlClient.TdsParser.ThrowExceptionAndWarning(TdsParserStateObject stateObj, Boolean callerHasConnectionLock, Boolean asyncClose)
   at Microsoft.Data.SqlClient.TdsParser.TryRun(RunBehavior runBehavior, SqlCommand cmdHandler, SqlDataReader dataStream, BulkCopySimpleResultSet bulkCopyHandler, TdsParserStateObject stateObj, Boolean& dataReady)
   at Microsoft.Data.SqlClient.SqlDataReader.TryHasMoreRows(Boolean& moreRows)
   at Microsoft.Data.SqlClient.SqlDataReader.TryReadInternal(Boolean setTimeout, Boolean& more)
   at Microsoft.Data.SqlClient.SqlDataReader.ReadAsyncExecute(Task task, Object state)
   at Microsoft.Data.SqlClient.SqlDataReader.InvokeAsyncCall[T](SqlDataReaderBaseAsyncCallContext`1 context)
--- End of stack trace from previous location ---
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeResultSetAsync(Int32 startCommandIndex, RelationalDataReader reader, CancellationToken cancellationToken)
ClientConnectionId:0fab9114-c68a-4b80-8ea2-733d9105c5ba
Error Number:2601,State:1,Class:14
   --- End of inner exception stack trace ---
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeResultSetAsync(Int32 startCommandIndex, RelationalDataReader reader, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeAsync(RelationalDataReader reader, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Update.Internal.SqlServerModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(IList`1 entriesToSave, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(StateManager stateManager, Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Storage.Internal.SqlServerExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at NayifatAPI.Controllers.DeviceController.RegisterDevice(RegisterDeviceRequest request) in C:\Users\yamta\StudioProjects\nayifat_app_2025_new\nayifatapi\Controllers\DeviceController.cs:line 105
   at Microsoft.AspNetCore.Mvc.Infrastructure.ActionMethodExecutor.TaskOfIActionResultExecutor.Execute(ActionContext actionContext, IActionResultTypeMapper mapper, ObjectMethodExecutor executor, Object controller, Object[] arguments)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.<InvokeActionMethodAsync>g__Awaited|12_0(ControllerActionInvoker invoker, ValueTask`1 actionResultValueTask)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.<InvokeNextActionFilterAsync>g__Awaited|10_0(ControllerActionInvoker invoker, Task lastTask, State next, Scope scope, Object state, Boolean isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.Rethrow(ActionExecutedContextSealed context)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.Next(State& next, Scope& scope, Object& state, Boolean& isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.<InvokeInnerFilterAsync>g__Awaited|13_0(ControllerActionInvoker invoker, Task lastTask, State next, Scope scope, Object state, Boolean isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeFilterPipelineAsync>g__Awaited|20_0(ResourceInvoker invoker, Task lastTask, State next, Scope scope, Object state, Boolean isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeAsync>g__Logged|17_1(ResourceInvoker invoker)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeAsync>g__Logged|17_1(ResourceInvoker invoker)
   at Microsoft.AspNetCore.Routing.EndpointMiddleware.<Invoke>g__AwaitRequestTask|7_0(Endpoint endpoint, Task requestTask, ILogger logger)
   at Microsoft.AspNetCore.Authorization.AuthorizationMiddleware.Invoke(HttpContext context)
   at Program.<>c.<<<Main>$>b__0_3>d.MoveNext() in C:\Users\yamta\StudioProjects\nayifat_app_2025_new\nayifatapi\Program.cs:line 85
2025-02-02 14:34:24.023 +03:00 [ERR] An unhandled exception has occurred while executing the request.
Microsoft.EntityFrameworkCore.DbUpdateException: An error occurred while saving the entity changes. See the inner exception for details.
 ---> Microsoft.Data.SqlClient.SqlException (0x80131904): Cannot insert duplicate key row in object 'dbo.Customer_Devices' with unique index 'IX_Customer_Devices_NationalId_DeviceId'. The duplicate key value is (1064448614, TP1A.220624.014).
   at Microsoft.Data.SqlClient.SqlConnection.OnError(SqlException exception, Boolean breakConnection, Action`1 wrapCloseInAction)
   at Microsoft.Data.SqlClient.SqlInternalConnection.OnError(SqlException exception, Boolean breakConnection, Action`1 wrapCloseInAction)
   at Microsoft.Data.SqlClient.TdsParser.ThrowExceptionAndWarning(TdsParserStateObject stateObj, Boolean callerHasConnectionLock, Boolean asyncClose)
   at Microsoft.Data.SqlClient.TdsParser.TryRun(RunBehavior runBehavior, SqlCommand cmdHandler, SqlDataReader dataStream, BulkCopySimpleResultSet bulkCopyHandler, TdsParserStateObject stateObj, Boolean& dataReady)
   at Microsoft.Data.SqlClient.SqlDataReader.TryHasMoreRows(Boolean& moreRows)
   at Microsoft.Data.SqlClient.SqlDataReader.TryReadInternal(Boolean setTimeout, Boolean& more)
   at Microsoft.Data.SqlClient.SqlDataReader.ReadAsyncExecute(Task task, Object state)
   at Microsoft.Data.SqlClient.SqlDataReader.InvokeAsyncCall[T](SqlDataReaderBaseAsyncCallContext`1 context)
--- End of stack trace from previous location ---
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeResultSetAsync(Int32 startCommandIndex, RelationalDataReader reader, CancellationToken cancellationToken)
ClientConnectionId:0fab9114-c68a-4b80-8ea2-733d9105c5ba
Error Number:2601,State:1,Class:14
   --- End of inner exception stack trace ---
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeResultSetAsync(Int32 startCommandIndex, RelationalDataReader reader, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeAsync(RelationalDataReader reader, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Update.Internal.SqlServerModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(IList`1 entriesToSave, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(StateManager stateManager, Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Storage.Internal.SqlServerExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at NayifatAPI.Controllers.DeviceController.RegisterDevice(RegisterDeviceRequest request) in C:\Users\yamta\StudioProjects\nayifat_app_2025_new\nayifatapi\Controllers\DeviceController.cs:line 105
   at Microsoft.AspNetCore.Mvc.Infrastructure.ActionMethodExecutor.TaskOfIActionResultExecutor.Execute(ActionContext actionContext, IActionResultTypeMapper mapper, ObjectMethodExecutor executor, Object controller, Object[] arguments)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.<InvokeActionMethodAsync>g__Awaited|12_0(ControllerActionInvoker invoker, ValueTask`1 actionResultValueTask)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.<InvokeNextActionFilterAsync>g__Awaited|10_0(ControllerActionInvoker invoker, Task lastTask, State next, Scope scope, Object state, Boolean isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.Rethrow(ActionExecutedContextSealed context)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.Next(State& next, Scope& scope, Object& state, Boolean& isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.<InvokeInnerFilterAsync>g__Awaited|13_0(ControllerActionInvoker invoker, Task lastTask, State next, Scope scope, Object state, Boolean isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeFilterPipelineAsync>g__Awaited|20_0(ResourceInvoker invoker, Task lastTask, State next, Scope scope, Object state, Boolean isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeAsync>g__Logged|17_1(ResourceInvoker invoker)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeAsync>g__Logged|17_1(ResourceInvoker invoker)
   at Microsoft.AspNetCore.Routing.EndpointMiddleware.<Invoke>g__AwaitRequestTask|7_0(Endpoint endpoint, Task requestTask, ILogger logger)
   at Microsoft.AspNetCore.Authorization.AuthorizationMiddleware.Invoke(HttpContext context)
   at Program.<>c.<<<Main>$>b__0_3>d.MoveNext() in C:\Users\yamta\StudioProjects\nayifat_app_2025_new\nayifatapi\Program.cs:line 85
--- End of stack trace from previous location ---
   at Swashbuckle.AspNetCore.SwaggerUI.SwaggerUIMiddleware.Invoke(HttpContext httpContext)
   at Swashbuckle.AspNetCore.Swagger.SwaggerMiddleware.Invoke(HttpContext httpContext, ISwaggerProvider swaggerProvider)
   at Microsoft.AspNetCore.Authentication.AuthenticationMiddleware.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Diagnostics.DeveloperExceptionPageMiddlewareImpl.Invoke(HttpContext context)
2025-02-02 14:34:24.048 +03:00 [INF] Request finished HTTP/1.1 POST http://07ca-46-152-255-232.ngrok-free.app/api/device - 500 null text/plain; charset=utf-8 215.0381ms
2025-02-02 14:34:42.293 +03:00 [INF] Request starting HTTP/1.1 POST http://07ca-46-152-255-232.ngrok-free.app/api/notifications/list - application/json; charset=utf-8 47
2025-02-02 14:34:42.494 +03:00 [INF] Executing endpoint 'NayifatAPI.Controllers.NotificationsController.GetNotifications (NayifatAPI)'
2025-02-02 14:34:42.497 +03:00 [INF] Route matched with {action = "GetNotifications", controller = "Notifications"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetNotifications(NayifatAPI.Controllers.GetNotificationsRequest) on controller NayifatAPI.Controllers.NotificationsController (NayifatAPI).
2025-02-02 14:34:43.218 +03:00 [INF] Executed DbCommand (8ms) [Parameters=[@__providedApiKey_0='?' (Size = 255)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [a].[Key], [a].[CreatedAt], [a].[Description], [a].[ExpiresAt], [a].[IsActive], [a].[LastUsedAt]
FROM [ApiKeys] AS [a]
WHERE [a].[Key] = @__providedApiKey_0 AND [a].[IsActive] = CAST(1 AS bit)
2025-02-02 14:34:43.730 +03:00 [INF] Executed DbCommand (59ms) [Parameters=[@__request_NationalId_0='?' (Size = 450)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [u].[national_id], [u].[last_updated], [u].[notifications]
FROM [user_notifications] AS [u]
WHERE [u].[national_id] = @__request_NationalId_0
2025-02-02 14:34:44.330 +03:00 [INF] Executed DbCommand (91ms) [Parameters=[@__Parse_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [n].[Id], [n].[additional_data], [n].[Body], [n].[body_ar], [n].[body_en], [n].[created_at], [n].[expiry_at], [n].[Route], [n].[target_criteria], [n].[Title], [n].[title_ar], [n].[title_en]
FROM [notification_templates] AS [n]
WHERE [n].[Id] = @__Parse_0
2025-02-02 14:34:44.545 +03:00 [INF] Executed DbCommand (6ms) [Parameters=[@__Parse_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [n].[Id], [n].[additional_data], [n].[Body], [n].[body_ar], [n].[body_en], [n].[created_at], [n].[expiry_at], [n].[Route], [n].[target_criteria], [n].[Title], [n].[title_ar], [n].[title_en]
FROM [notification_templates] AS [n]
WHERE [n].[Id] = @__Parse_0
2025-02-02 14:34:44.750 +03:00 [INF] Executed DbCommand (200ms) [Parameters=[@p0='?' (Size = 4000), @p1='?' (DbType = DateTime2), @p2='?' (Size = 4000), @p3='?' (Size = 4000), @p4='?' (Size = 4000), @p5='?' (Size = 450), @p6='?' (Size = 4000), @p7='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SET IMPLICIT_TRANSACTIONS OFF;
SET NOCOUNT ON;
INSERT INTO [AuthLogs] ([AuthType], [CreatedAt], [DeviceId], [FailureReason], [IpAddress], [NationalId], [Status], [UserAgent])
OUTPUT INSERTED.[Id]
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7);
2025-02-02 14:34:44.776 +03:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType9`2[[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Object, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-02-02 14:34:44.777 +03:00 [INF] Executed action NayifatAPI.Controllers.NotificationsController.GetNotifications (NayifatAPI) in 1568.7967ms
2025-02-02 14:34:44.780 +03:00 [INF] Executed endpoint 'NayifatAPI.Controllers.NotificationsController.GetNotifications (NayifatAPI)'
2025-02-02 14:34:44.786 +03:00 [INF] Request finished HTTP/1.1 POST http://07ca-46-152-255-232.ngrok-free.app/api/notifications/list - 200 null application/json; charset=utf-8 2492.212ms
2025-02-02 14:35:14.051 +03:00 [INF] Request starting HTTP/1.1 POST http://07ca-46-152-255-232.ngrok-free.app/api/device - application/json 253
2025-02-02 14:35:14.055 +03:00 [INF] Executing endpoint 'NayifatAPI.Controllers.DeviceController.RegisterDevice (NayifatAPI)'
2025-02-02 14:35:14.060 +03:00 [INF] Route matched with {action = "RegisterDevice", controller = "Device"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] RegisterDevice(NayifatAPI.Controllers.RegisterDeviceRequest) on controller NayifatAPI.Controllers.DeviceController (NayifatAPI).
2025-02-02 14:35:14.069 +03:00 [INF] Executed DbCommand (5ms) [Parameters=[@__providedApiKey_0='?' (Size = 255)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [a].[Key], [a].[CreatedAt], [a].[Description], [a].[ExpiresAt], [a].[IsActive], [a].[LastUsedAt]
FROM [ApiKeys] AS [a]
WHERE [a].[Key] = @__providedApiKey_0 AND [a].[IsActive] = CAST(1 AS bit)
2025-02-02 14:35:14.078 +03:00 [INF] Executed DbCommand (4ms) [Parameters=[@__p_0='?' (Size = 450)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [c].[NationalId], [c].[AddNo], [c].[BuildingNo], [c].[City], [c].[Consent], [c].[ConsentDate], [c].[DateOfBirth], [c].[Dependents], [c].[District], [c].[Email], [c].[Employer], [c].[FamilyNameAr], [c].[FamilyNameEn], [c].[FirstNameAr], [c].[FirstNameEn], [c].[Iban], [c].[IdExpiryDate], [c].[Los], [c].[Mpin], [c].[MpinEnabled], [c].[NafathStatus], [c].[NafathTimestamp], [c].[Password], [c].[Phone], [c].[RegistrationDate], [c].[SalaryCustomer], [c].[SalaryDakhli], [c].[SecondNameAr], [c].[SecondNameEn], [c].[Sector], [c].[Street], [c].[ThirdNameAr], [c].[ThirdNameEn], [c].[Zipcode]
FROM [Customers] AS [c]
WHERE [c].[NationalId] = @__p_0
2025-02-02 14:35:14.158 +03:00 [INF] Executed DbCommand (77ms) [Parameters=[@__request_NationalId_0='?' (Size = 450)], CommandType='"Text"', CommandTimeout='30']
UPDATE [c]
SET [c].[LastUsedAt] = GETUTCDATE(),
    [c].[Status] = N'disabled'
FROM [Customer_Devices] AS [c]
WHERE [c].[NationalId] = @__request_NationalId_0
2025-02-02 14:35:14.167 +03:00 [INF] Executed DbCommand (5ms) [Parameters=[@p0='?' (Size = 4000), @p1='?' (DbType = DateTime2), @p2='?' (Size = 4000), @p3='?' (Size = 4000), @p4='?' (Size = 4000), @p5='?' (Size = 450), @p6='?' (Size = 4000), @p7='?' (Size = 4000), @p8='?' (DbType = Boolean), @p9='?' (Size = 4000), @p10='?' (DbType = DateTime2), @p11='?' (Size = 450), @p12='?' (DbType = DateTime2), @p13='?' (Size = 4000), @p14='?' (Size = 4000), @p15='?' (Size = 450), @p16='?' (Size = 4000), @p17='?' (Size = 4000), @p18='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SET NOCOUNT ON;
INSERT INTO [AuthLogs] ([AuthType], [CreatedAt], [DeviceId], [FailureReason], [IpAddress], [NationalId], [Status], [UserAgent])
OUTPUT INSERTED.[Id]
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7);
INSERT INTO [Customer_Devices] ([BiometricEnabled], [BiometricToken], [CreatedAt], [DeviceId], [LastUsedAt], [Manufacturer], [Model], [NationalId], [OsVersion], [Platform], [Status])
OUTPUT INSERTED.[Id]
VALUES (@p8, @p9, @p10, @p11, @p12, @p13, @p14, @p15, @p16, @p17, @p18);
2025-02-02 14:35:14.172 +03:00 [ERR] An exception occurred in the database while saving changes for context type 'NayifatAPI.Data.ApplicationDbContext'.
Microsoft.EntityFrameworkCore.DbUpdateException: An error occurred while saving the entity changes. See the inner exception for details.
 ---> Microsoft.Data.SqlClient.SqlException (0x80131904): Cannot insert duplicate key row in object 'dbo.Customer_Devices' with unique index 'IX_Customer_Devices_NationalId_DeviceId'. The duplicate key value is (1064448614, TP1A.220624.014).
   at Microsoft.Data.SqlClient.SqlConnection.OnError(SqlException exception, Boolean breakConnection, Action`1 wrapCloseInAction)
   at Microsoft.Data.SqlClient.SqlInternalConnection.OnError(SqlException exception, Boolean breakConnection, Action`1 wrapCloseInAction)
   at Microsoft.Data.SqlClient.TdsParser.ThrowExceptionAndWarning(TdsParserStateObject stateObj, Boolean callerHasConnectionLock, Boolean asyncClose)
   at Microsoft.Data.SqlClient.TdsParser.TryRun(RunBehavior runBehavior, SqlCommand cmdHandler, SqlDataReader dataStream, BulkCopySimpleResultSet bulkCopyHandler, TdsParserStateObject stateObj, Boolean& dataReady)
   at Microsoft.Data.SqlClient.SqlDataReader.TryHasMoreRows(Boolean& moreRows)
   at Microsoft.Data.SqlClient.SqlDataReader.TryReadInternal(Boolean setTimeout, Boolean& more)
   at Microsoft.Data.SqlClient.SqlDataReader.ReadAsyncExecute(Task task, Object state)
   at Microsoft.Data.SqlClient.SqlDataReader.InvokeAsyncCall[T](SqlDataReaderBaseAsyncCallContext`1 context)
--- End of stack trace from previous location ---
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeResultSetAsync(Int32 startCommandIndex, RelationalDataReader reader, CancellationToken cancellationToken)
ClientConnectionId:0fab9114-c68a-4b80-8ea2-733d9105c5ba
Error Number:2601,State:1,Class:14
   --- End of inner exception stack trace ---
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeResultSetAsync(Int32 startCommandIndex, RelationalDataReader reader, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeAsync(RelationalDataReader reader, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Update.Internal.SqlServerModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(IList`1 entriesToSave, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(StateManager stateManager, Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Storage.Internal.SqlServerExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
Microsoft.EntityFrameworkCore.DbUpdateException: An error occurred while saving the entity changes. See the inner exception for details.
 ---> Microsoft.Data.SqlClient.SqlException (0x80131904): Cannot insert duplicate key row in object 'dbo.Customer_Devices' with unique index 'IX_Customer_Devices_NationalId_DeviceId'. The duplicate key value is (1064448614, TP1A.220624.014).
   at Microsoft.Data.SqlClient.SqlConnection.OnError(SqlException exception, Boolean breakConnection, Action`1 wrapCloseInAction)
   at Microsoft.Data.SqlClient.SqlInternalConnection.OnError(SqlException exception, Boolean breakConnection, Action`1 wrapCloseInAction)
   at Microsoft.Data.SqlClient.TdsParser.ThrowExceptionAndWarning(TdsParserStateObject stateObj, Boolean callerHasConnectionLock, Boolean asyncClose)
   at Microsoft.Data.SqlClient.TdsParser.TryRun(RunBehavior runBehavior, SqlCommand cmdHandler, SqlDataReader dataStream, BulkCopySimpleResultSet bulkCopyHandler, TdsParserStateObject stateObj, Boolean& dataReady)
   at Microsoft.Data.SqlClient.SqlDataReader.TryHasMoreRows(Boolean& moreRows)
   at Microsoft.Data.SqlClient.SqlDataReader.TryReadInternal(Boolean setTimeout, Boolean& more)
   at Microsoft.Data.SqlClient.SqlDataReader.ReadAsyncExecute(Task task, Object state)
   at Microsoft.Data.SqlClient.SqlDataReader.InvokeAsyncCall[T](SqlDataReaderBaseAsyncCallContext`1 context)
--- End of stack trace from previous location ---
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeResultSetAsync(Int32 startCommandIndex, RelationalDataReader reader, CancellationToken cancellationToken)
ClientConnectionId:0fab9114-c68a-4b80-8ea2-733d9105c5ba
Error Number:2601,State:1,Class:14
   --- End of inner exception stack trace ---
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeResultSetAsync(Int32 startCommandIndex, RelationalDataReader reader, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeAsync(RelationalDataReader reader, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Update.Internal.SqlServerModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(IList`1 entriesToSave, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(StateManager stateManager, Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Storage.Internal.SqlServerExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
2025-02-02 14:35:14.190 +03:00 [ERR] Error registering device for National ID: 1064448614
Microsoft.EntityFrameworkCore.DbUpdateException: An error occurred while saving the entity changes. See the inner exception for details.
 ---> Microsoft.Data.SqlClient.SqlException (0x80131904): Cannot insert duplicate key row in object 'dbo.Customer_Devices' with unique index 'IX_Customer_Devices_NationalId_DeviceId'. The duplicate key value is (1064448614, TP1A.220624.014).
   at Microsoft.Data.SqlClient.SqlConnection.OnError(SqlException exception, Boolean breakConnection, Action`1 wrapCloseInAction)
   at Microsoft.Data.SqlClient.SqlInternalConnection.OnError(SqlException exception, Boolean breakConnection, Action`1 wrapCloseInAction)
   at Microsoft.Data.SqlClient.TdsParser.ThrowExceptionAndWarning(TdsParserStateObject stateObj, Boolean callerHasConnectionLock, Boolean asyncClose)
   at Microsoft.Data.SqlClient.TdsParser.TryRun(RunBehavior runBehavior, SqlCommand cmdHandler, SqlDataReader dataStream, BulkCopySimpleResultSet bulkCopyHandler, TdsParserStateObject stateObj, Boolean& dataReady)
   at Microsoft.Data.SqlClient.SqlDataReader.TryHasMoreRows(Boolean& moreRows)
   at Microsoft.Data.SqlClient.SqlDataReader.TryReadInternal(Boolean setTimeout, Boolean& more)
   at Microsoft.Data.SqlClient.SqlDataReader.ReadAsyncExecute(Task task, Object state)
   at Microsoft.Data.SqlClient.SqlDataReader.InvokeAsyncCall[T](SqlDataReaderBaseAsyncCallContext`1 context)
--- End of stack trace from previous location ---
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeResultSetAsync(Int32 startCommandIndex, RelationalDataReader reader, CancellationToken cancellationToken)
ClientConnectionId:0fab9114-c68a-4b80-8ea2-733d9105c5ba
Error Number:2601,State:1,Class:14
   --- End of inner exception stack trace ---
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeResultSetAsync(Int32 startCommandIndex, RelationalDataReader reader, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeAsync(RelationalDataReader reader, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Update.Internal.SqlServerModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(IList`1 entriesToSave, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(StateManager stateManager, Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Storage.Internal.SqlServerExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at NayifatAPI.Controllers.DeviceController.RegisterDevice(RegisterDeviceRequest request) in C:\Users\yamta\StudioProjects\nayifat_app_2025_new\nayifatapi\Controllers\DeviceController.cs:line 78
2025-02-02 14:35:14.222 +03:00 [INF] Executed DbCommand (16ms) [Parameters=[@p0='?' (Size = 4000), @p1='?' (DbType = DateTime2), @p2='?' (Size = 4000), @p3='?' (Size = 4000), @p4='?' (Size = 4000), @p5='?' (Size = 450), @p6='?' (Size = 4000), @p7='?' (Size = 4000), @p8='?' (Size = 4000), @p9='?' (DbType = DateTime2), @p10='?' (Size = 4000), @p11='?' (Size = 4000), @p12='?' (Size = 4000), @p13='?' (Size = 450), @p14='?' (Size = 4000), @p15='?' (Size = 4000), @p16='?' (DbType = Boolean), @p17='?' (Size = 4000), @p18='?' (DbType = DateTime2), @p19='?' (Size = 450), @p20='?' (DbType = DateTime2), @p21='?' (Size = 4000), @p22='?' (Size = 4000), @p23='?' (Size = 450), @p24='?' (Size = 4000), @p25='?' (Size = 4000), @p26='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SET NOCOUNT ON;
MERGE [AuthLogs] USING (
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7, 0),
(@p8, @p9, @p10, @p11, @p12, @p13, @p14, @p15, 1)) AS i ([AuthType], [CreatedAt], [DeviceId], [FailureReason], [IpAddress], [NationalId], [Status], [UserAgent], _Position) ON 1=0
WHEN NOT MATCHED THEN
INSERT ([AuthType], [CreatedAt], [DeviceId], [FailureReason], [IpAddress], [NationalId], [Status], [UserAgent])
VALUES (i.[AuthType], i.[CreatedAt], i.[DeviceId], i.[FailureReason], i.[IpAddress], i.[NationalId], i.[Status], i.[UserAgent])
OUTPUT INSERTED.[Id], i._Position;
INSERT INTO [Customer_Devices] ([BiometricEnabled], [BiometricToken], [CreatedAt], [DeviceId], [LastUsedAt], [Manufacturer], [Model], [NationalId], [OsVersion], [Platform], [Status])
OUTPUT INSERTED.[Id]
VALUES (@p16, @p17, @p18, @p19, @p20, @p21, @p22, @p23, @p24, @p25, @p26);
2025-02-02 14:35:14.229 +03:00 [ERR] An exception occurred in the database while saving changes for context type 'NayifatAPI.Data.ApplicationDbContext'.
Microsoft.EntityFrameworkCore.DbUpdateException: An error occurred while saving the entity changes. See the inner exception for details.
 ---> Microsoft.Data.SqlClient.SqlException (0x80131904): Cannot insert duplicate key row in object 'dbo.Customer_Devices' with unique index 'IX_Customer_Devices_NationalId_DeviceId'. The duplicate key value is (1064448614, TP1A.220624.014).
   at Microsoft.Data.SqlClient.SqlConnection.OnError(SqlException exception, Boolean breakConnection, Action`1 wrapCloseInAction)
   at Microsoft.Data.SqlClient.SqlInternalConnection.OnError(SqlException exception, Boolean breakConnection, Action`1 wrapCloseInAction)
   at Microsoft.Data.SqlClient.TdsParser.ThrowExceptionAndWarning(TdsParserStateObject stateObj, Boolean callerHasConnectionLock, Boolean asyncClose)
   at Microsoft.Data.SqlClient.TdsParser.TryRun(RunBehavior runBehavior, SqlCommand cmdHandler, SqlDataReader dataStream, BulkCopySimpleResultSet bulkCopyHandler, TdsParserStateObject stateObj, Boolean& dataReady)
   at Microsoft.Data.SqlClient.SqlDataReader.TryHasMoreRows(Boolean& moreRows)
   at Microsoft.Data.SqlClient.SqlDataReader.TryReadInternal(Boolean setTimeout, Boolean& more)
   at Microsoft.Data.SqlClient.SqlDataReader.ReadAsyncExecute(Task task, Object state)
   at Microsoft.Data.SqlClient.SqlDataReader.InvokeAsyncCall[T](SqlDataReaderBaseAsyncCallContext`1 context)
--- End of stack trace from previous location ---
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeResultSetAsync(Int32 startCommandIndex, RelationalDataReader reader, CancellationToken cancellationToken)
ClientConnectionId:0fab9114-c68a-4b80-8ea2-733d9105c5ba
Error Number:2601,State:1,Class:14
   --- End of inner exception stack trace ---
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeResultSetAsync(Int32 startCommandIndex, RelationalDataReader reader, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeAsync(RelationalDataReader reader, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Update.Internal.SqlServerModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(IList`1 entriesToSave, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(StateManager stateManager, Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Storage.Internal.SqlServerExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
Microsoft.EntityFrameworkCore.DbUpdateException: An error occurred while saving the entity changes. See the inner exception for details.
 ---> Microsoft.Data.SqlClient.SqlException (0x80131904): Cannot insert duplicate key row in object 'dbo.Customer_Devices' with unique index 'IX_Customer_Devices_NationalId_DeviceId'. The duplicate key value is (1064448614, TP1A.220624.014).
   at Microsoft.Data.SqlClient.SqlConnection.OnError(SqlException exception, Boolean breakConnection, Action`1 wrapCloseInAction)
   at Microsoft.Data.SqlClient.SqlInternalConnection.OnError(SqlException exception, Boolean breakConnection, Action`1 wrapCloseInAction)
   at Microsoft.Data.SqlClient.TdsParser.ThrowExceptionAndWarning(TdsParserStateObject stateObj, Boolean callerHasConnectionLock, Boolean asyncClose)
   at Microsoft.Data.SqlClient.TdsParser.TryRun(RunBehavior runBehavior, SqlCommand cmdHandler, SqlDataReader dataStream, BulkCopySimpleResultSet bulkCopyHandler, TdsParserStateObject stateObj, Boolean& dataReady)
   at Microsoft.Data.SqlClient.SqlDataReader.TryHasMoreRows(Boolean& moreRows)
   at Microsoft.Data.SqlClient.SqlDataReader.TryReadInternal(Boolean setTimeout, Boolean& more)
   at Microsoft.Data.SqlClient.SqlDataReader.ReadAsyncExecute(Task task, Object state)
   at Microsoft.Data.SqlClient.SqlDataReader.InvokeAsyncCall[T](SqlDataReaderBaseAsyncCallContext`1 context)
--- End of stack trace from previous location ---
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeResultSetAsync(Int32 startCommandIndex, RelationalDataReader reader, CancellationToken cancellationToken)
ClientConnectionId:0fab9114-c68a-4b80-8ea2-733d9105c5ba
Error Number:2601,State:1,Class:14
   --- End of inner exception stack trace ---
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeResultSetAsync(Int32 startCommandIndex, RelationalDataReader reader, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeAsync(RelationalDataReader reader, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Update.Internal.SqlServerModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(IList`1 entriesToSave, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(StateManager stateManager, Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Storage.Internal.SqlServerExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
2025-02-02 14:35:14.252 +03:00 [INF] Executed action NayifatAPI.Controllers.DeviceController.RegisterDevice (NayifatAPI) in 190.1611ms
2025-02-02 14:35:14.254 +03:00 [INF] Executed endpoint 'NayifatAPI.Controllers.DeviceController.RegisterDevice (NayifatAPI)'
2025-02-02 14:35:14.261 +03:00 [ERR] Unhandled exception
Microsoft.EntityFrameworkCore.DbUpdateException: An error occurred while saving the entity changes. See the inner exception for details.
 ---> Microsoft.Data.SqlClient.SqlException (0x80131904): Cannot insert duplicate key row in object 'dbo.Customer_Devices' with unique index 'IX_Customer_Devices_NationalId_DeviceId'. The duplicate key value is (1064448614, TP1A.220624.014).
   at Microsoft.Data.SqlClient.SqlConnection.OnError(SqlException exception, Boolean breakConnection, Action`1 wrapCloseInAction)
   at Microsoft.Data.SqlClient.SqlInternalConnection.OnError(SqlException exception, Boolean breakConnection, Action`1 wrapCloseInAction)
   at Microsoft.Data.SqlClient.TdsParser.ThrowExceptionAndWarning(TdsParserStateObject stateObj, Boolean callerHasConnectionLock, Boolean asyncClose)
   at Microsoft.Data.SqlClient.TdsParser.TryRun(RunBehavior runBehavior, SqlCommand cmdHandler, SqlDataReader dataStream, BulkCopySimpleResultSet bulkCopyHandler, TdsParserStateObject stateObj, Boolean& dataReady)
   at Microsoft.Data.SqlClient.SqlDataReader.TryHasMoreRows(Boolean& moreRows)
   at Microsoft.Data.SqlClient.SqlDataReader.TryReadInternal(Boolean setTimeout, Boolean& more)
   at Microsoft.Data.SqlClient.SqlDataReader.ReadAsyncExecute(Task task, Object state)
   at Microsoft.Data.SqlClient.SqlDataReader.InvokeAsyncCall[T](SqlDataReaderBaseAsyncCallContext`1 context)
--- End of stack trace from previous location ---
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeResultSetAsync(Int32 startCommandIndex, RelationalDataReader reader, CancellationToken cancellationToken)
ClientConnectionId:0fab9114-c68a-4b80-8ea2-733d9105c5ba
Error Number:2601,State:1,Class:14
   --- End of inner exception stack trace ---
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeResultSetAsync(Int32 startCommandIndex, RelationalDataReader reader, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeAsync(RelationalDataReader reader, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Update.Internal.SqlServerModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(IList`1 entriesToSave, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(StateManager stateManager, Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Storage.Internal.SqlServerExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at NayifatAPI.Controllers.DeviceController.RegisterDevice(RegisterDeviceRequest request) in C:\Users\yamta\StudioProjects\nayifat_app_2025_new\nayifatapi\Controllers\DeviceController.cs:line 105
   at Microsoft.AspNetCore.Mvc.Infrastructure.ActionMethodExecutor.TaskOfIActionResultExecutor.Execute(ActionContext actionContext, IActionResultTypeMapper mapper, ObjectMethodExecutor executor, Object controller, Object[] arguments)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.<InvokeActionMethodAsync>g__Awaited|12_0(ControllerActionInvoker invoker, ValueTask`1 actionResultValueTask)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.<InvokeNextActionFilterAsync>g__Awaited|10_0(ControllerActionInvoker invoker, Task lastTask, State next, Scope scope, Object state, Boolean isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.Rethrow(ActionExecutedContextSealed context)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.Next(State& next, Scope& scope, Object& state, Boolean& isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.<InvokeInnerFilterAsync>g__Awaited|13_0(ControllerActionInvoker invoker, Task lastTask, State next, Scope scope, Object state, Boolean isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeFilterPipelineAsync>g__Awaited|20_0(ResourceInvoker invoker, Task lastTask, State next, Scope scope, Object state, Boolean isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeAsync>g__Logged|17_1(ResourceInvoker invoker)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeAsync>g__Logged|17_1(ResourceInvoker invoker)
   at Microsoft.AspNetCore.Routing.EndpointMiddleware.<Invoke>g__AwaitRequestTask|7_0(Endpoint endpoint, Task requestTask, ILogger logger)
   at Microsoft.AspNetCore.Authorization.AuthorizationMiddleware.Invoke(HttpContext context)
   at Program.<>c.<<<Main>$>b__0_3>d.MoveNext() in C:\Users\yamta\StudioProjects\nayifat_app_2025_new\nayifatapi\Program.cs:line 85
2025-02-02 14:35:14.285 +03:00 [ERR] An unhandled exception has occurred while executing the request.
Microsoft.EntityFrameworkCore.DbUpdateException: An error occurred while saving the entity changes. See the inner exception for details.
 ---> Microsoft.Data.SqlClient.SqlException (0x80131904): Cannot insert duplicate key row in object 'dbo.Customer_Devices' with unique index 'IX_Customer_Devices_NationalId_DeviceId'. The duplicate key value is (1064448614, TP1A.220624.014).
   at Microsoft.Data.SqlClient.SqlConnection.OnError(SqlException exception, Boolean breakConnection, Action`1 wrapCloseInAction)
   at Microsoft.Data.SqlClient.SqlInternalConnection.OnError(SqlException exception, Boolean breakConnection, Action`1 wrapCloseInAction)
   at Microsoft.Data.SqlClient.TdsParser.ThrowExceptionAndWarning(TdsParserStateObject stateObj, Boolean callerHasConnectionLock, Boolean asyncClose)
   at Microsoft.Data.SqlClient.TdsParser.TryRun(RunBehavior runBehavior, SqlCommand cmdHandler, SqlDataReader dataStream, BulkCopySimpleResultSet bulkCopyHandler, TdsParserStateObject stateObj, Boolean& dataReady)
   at Microsoft.Data.SqlClient.SqlDataReader.TryHasMoreRows(Boolean& moreRows)
   at Microsoft.Data.SqlClient.SqlDataReader.TryReadInternal(Boolean setTimeout, Boolean& more)
   at Microsoft.Data.SqlClient.SqlDataReader.ReadAsyncExecute(Task task, Object state)
   at Microsoft.Data.SqlClient.SqlDataReader.InvokeAsyncCall[T](SqlDataReaderBaseAsyncCallContext`1 context)
--- End of stack trace from previous location ---
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeResultSetAsync(Int32 startCommandIndex, RelationalDataReader reader, CancellationToken cancellationToken)
ClientConnectionId:0fab9114-c68a-4b80-8ea2-733d9105c5ba
Error Number:2601,State:1,Class:14
   --- End of inner exception stack trace ---
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeResultSetAsync(Int32 startCommandIndex, RelationalDataReader reader, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeAsync(RelationalDataReader reader, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Update.Internal.SqlServerModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(IList`1 entriesToSave, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(StateManager stateManager, Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Storage.Internal.SqlServerExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at NayifatAPI.Controllers.DeviceController.RegisterDevice(RegisterDeviceRequest request) in C:\Users\yamta\StudioProjects\nayifat_app_2025_new\nayifatapi\Controllers\DeviceController.cs:line 105
   at Microsoft.AspNetCore.Mvc.Infrastructure.ActionMethodExecutor.TaskOfIActionResultExecutor.Execute(ActionContext actionContext, IActionResultTypeMapper mapper, ObjectMethodExecutor executor, Object controller, Object[] arguments)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.<InvokeActionMethodAsync>g__Awaited|12_0(ControllerActionInvoker invoker, ValueTask`1 actionResultValueTask)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.<InvokeNextActionFilterAsync>g__Awaited|10_0(ControllerActionInvoker invoker, Task lastTask, State next, Scope scope, Object state, Boolean isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.Rethrow(ActionExecutedContextSealed context)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.Next(State& next, Scope& scope, Object& state, Boolean& isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.<InvokeInnerFilterAsync>g__Awaited|13_0(ControllerActionInvoker invoker, Task lastTask, State next, Scope scope, Object state, Boolean isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeFilterPipelineAsync>g__Awaited|20_0(ResourceInvoker invoker, Task lastTask, State next, Scope scope, Object state, Boolean isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeAsync>g__Logged|17_1(ResourceInvoker invoker)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeAsync>g__Logged|17_1(ResourceInvoker invoker)
   at Microsoft.AspNetCore.Routing.EndpointMiddleware.<Invoke>g__AwaitRequestTask|7_0(Endpoint endpoint, Task requestTask, ILogger logger)
   at Microsoft.AspNetCore.Authorization.AuthorizationMiddleware.Invoke(HttpContext context)
   at Program.<>c.<<<Main>$>b__0_3>d.MoveNext() in C:\Users\yamta\StudioProjects\nayifat_app_2025_new\nayifatapi\Program.cs:line 85
--- End of stack trace from previous location ---
   at Swashbuckle.AspNetCore.SwaggerUI.SwaggerUIMiddleware.Invoke(HttpContext httpContext)
   at Swashbuckle.AspNetCore.Swagger.SwaggerMiddleware.Invoke(HttpContext httpContext, ISwaggerProvider swaggerProvider)
   at Microsoft.AspNetCore.Authentication.AuthenticationMiddleware.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Diagnostics.DeveloperExceptionPageMiddlewareImpl.Invoke(HttpContext context)
2025-02-02 14:35:14.309 +03:00 [INF] Request finished HTTP/1.1 POST http://07ca-46-152-255-232.ngrok-free.app/api/device - 500 null text/plain; charset=utf-8 258.0901ms
2025-02-02 14:37:40.297 +03:00 [INF] Request starting HTTP/1.1 POST http://07ca-46-152-255-232.ngrok-free.app/api/device/unregister - application/json 72
2025-02-02 14:37:40.300 +03:00 [INF] Request finished HTTP/1.1 POST http://07ca-46-152-255-232.ngrok-free.app/api/device/unregister - 404 0 null 3.1981ms
2025-02-02 14:37:40.302 +03:00 [INF] Request reached the end of the middleware pipeline without being handled by application code. Request path: POST http://07ca-46-152-255-232.ngrok-free.app/api/device/unregister, Response status code: 404
2025-02-02 14:37:55.133 +03:00 [INF] Request starting HTTP/1.1 POST http://07ca-46-152-255-232.ngrok-free.app/api/device/unregister - application/json 72
2025-02-02 14:37:55.139 +03:00 [INF] Request finished HTTP/1.1 POST http://07ca-46-152-255-232.ngrok-free.app/api/device/unregister - 404 0 null 5.9972ms
2025-02-02 14:37:55.142 +03:00 [INF] Request reached the end of the middleware pipeline without being handled by application code. Request path: POST http://07ca-46-152-255-232.ngrok-free.app/api/device/unregister, Response status code: 404
2025-02-02 14:38:51.789 +03:00 [INF] Request starting HTTP/1.1 POST http://07ca-46-152-255-232.ngrok-free.app/api/device - application/json 252
2025-02-02 14:38:51.791 +03:00 [INF] Executing endpoint 'NayifatAPI.Controllers.DeviceController.RegisterDevice (NayifatAPI)'
2025-02-02 14:38:51.793 +03:00 [INF] Route matched with {action = "RegisterDevice", controller = "Device"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] RegisterDevice(NayifatAPI.Controllers.RegisterDeviceRequest) on controller NayifatAPI.Controllers.DeviceController (NayifatAPI).
2025-02-02 14:38:51.804 +03:00 [INF] Executed DbCommand (8ms) [Parameters=[@__providedApiKey_0='?' (Size = 255)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [a].[Key], [a].[CreatedAt], [a].[Description], [a].[ExpiresAt], [a].[IsActive], [a].[LastUsedAt]
FROM [ApiKeys] AS [a]
WHERE [a].[Key] = @__providedApiKey_0 AND [a].[IsActive] = CAST(1 AS bit)
2025-02-02 14:38:51.811 +03:00 [INF] Executed DbCommand (4ms) [Parameters=[@__p_0='?' (Size = 450)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [c].[NationalId], [c].[AddNo], [c].[BuildingNo], [c].[City], [c].[Consent], [c].[ConsentDate], [c].[DateOfBirth], [c].[Dependents], [c].[District], [c].[Email], [c].[Employer], [c].[FamilyNameAr], [c].[FamilyNameEn], [c].[FirstNameAr], [c].[FirstNameEn], [c].[Iban], [c].[IdExpiryDate], [c].[Los], [c].[Mpin], [c].[MpinEnabled], [c].[NafathStatus], [c].[NafathTimestamp], [c].[Password], [c].[Phone], [c].[RegistrationDate], [c].[SalaryCustomer], [c].[SalaryDakhli], [c].[SecondNameAr], [c].[SecondNameEn], [c].[Sector], [c].[Street], [c].[ThirdNameAr], [c].[ThirdNameEn], [c].[Zipcode]
FROM [Customers] AS [c]
WHERE [c].[NationalId] = @__p_0
2025-02-02 14:38:51.823 +03:00 [INF] Executed DbCommand (8ms) [Parameters=[@__request_NationalId_0='?' (Size = 450)], CommandType='"Text"', CommandTimeout='30']
UPDATE [c]
SET [c].[LastUsedAt] = GETUTCDATE(),
    [c].[Status] = N'disabled'
FROM [Customer_Devices] AS [c]
WHERE [c].[NationalId] = @__request_NationalId_0
2025-02-02 14:38:51.843 +03:00 [INF] Executed DbCommand (14ms) [Parameters=[@p0='?' (Size = 4000), @p1='?' (DbType = DateTime2), @p2='?' (Size = 4000), @p3='?' (Size = 4000), @p4='?' (Size = 4000), @p5='?' (Size = 450), @p6='?' (Size = 4000), @p7='?' (Size = 4000), @p8='?' (DbType = Boolean), @p9='?' (Size = 4000), @p10='?' (DbType = DateTime2), @p11='?' (Size = 450), @p12='?' (DbType = DateTime2), @p13='?' (Size = 4000), @p14='?' (Size = 4000), @p15='?' (Size = 450), @p16='?' (Size = 4000), @p17='?' (Size = 4000), @p18='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SET NOCOUNT ON;
INSERT INTO [AuthLogs] ([AuthType], [CreatedAt], [DeviceId], [FailureReason], [IpAddress], [NationalId], [Status], [UserAgent])
OUTPUT INSERTED.[Id]
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7);
INSERT INTO [Customer_Devices] ([BiometricEnabled], [BiometricToken], [CreatedAt], [DeviceId], [LastUsedAt], [Manufacturer], [Model], [NationalId], [OsVersion], [Platform], [Status])
OUTPUT INSERTED.[Id]
VALUES (@p8, @p9, @p10, @p11, @p12, @p13, @p14, @p15, @p16, @p17, @p18);
2025-02-02 14:38:51.853 +03:00 [ERR] An exception occurred in the database while saving changes for context type 'NayifatAPI.Data.ApplicationDbContext'.
Microsoft.EntityFrameworkCore.DbUpdateException: An error occurred while saving the entity changes. See the inner exception for details.
 ---> Microsoft.Data.SqlClient.SqlException (0x80131904): Cannot insert duplicate key row in object 'dbo.Customer_Devices' with unique index 'IX_Customer_Devices_NationalId_DeviceId'. The duplicate key value is (1064448614, TP1A.220624.014).
   at Microsoft.Data.SqlClient.SqlConnection.OnError(SqlException exception, Boolean breakConnection, Action`1 wrapCloseInAction)
   at Microsoft.Data.SqlClient.SqlInternalConnection.OnError(SqlException exception, Boolean breakConnection, Action`1 wrapCloseInAction)
   at Microsoft.Data.SqlClient.TdsParser.ThrowExceptionAndWarning(TdsParserStateObject stateObj, Boolean callerHasConnectionLock, Boolean asyncClose)
   at Microsoft.Data.SqlClient.TdsParser.TryRun(RunBehavior runBehavior, SqlCommand cmdHandler, SqlDataReader dataStream, BulkCopySimpleResultSet bulkCopyHandler, TdsParserStateObject stateObj, Boolean& dataReady)
   at Microsoft.Data.SqlClient.SqlDataReader.TryHasMoreRows(Boolean& moreRows)
   at Microsoft.Data.SqlClient.SqlDataReader.TryReadInternal(Boolean setTimeout, Boolean& more)
   at Microsoft.Data.SqlClient.SqlDataReader.ReadAsyncExecute(Task task, Object state)
   at Microsoft.Data.SqlClient.SqlDataReader.InvokeAsyncCall[T](SqlDataReaderBaseAsyncCallContext`1 context)
--- End of stack trace from previous location ---
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeResultSetAsync(Int32 startCommandIndex, RelationalDataReader reader, CancellationToken cancellationToken)
ClientConnectionId:0fab9114-c68a-4b80-8ea2-733d9105c5ba
Error Number:2601,State:1,Class:14
   --- End of inner exception stack trace ---
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeResultSetAsync(Int32 startCommandIndex, RelationalDataReader reader, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeAsync(RelationalDataReader reader, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Update.Internal.SqlServerModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(IList`1 entriesToSave, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(StateManager stateManager, Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Storage.Internal.SqlServerExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
Microsoft.EntityFrameworkCore.DbUpdateException: An error occurred while saving the entity changes. See the inner exception for details.
 ---> Microsoft.Data.SqlClient.SqlException (0x80131904): Cannot insert duplicate key row in object 'dbo.Customer_Devices' with unique index 'IX_Customer_Devices_NationalId_DeviceId'. The duplicate key value is (1064448614, TP1A.220624.014).
   at Microsoft.Data.SqlClient.SqlConnection.OnError(SqlException exception, Boolean breakConnection, Action`1 wrapCloseInAction)
   at Microsoft.Data.SqlClient.SqlInternalConnection.OnError(SqlException exception, Boolean breakConnection, Action`1 wrapCloseInAction)
   at Microsoft.Data.SqlClient.TdsParser.ThrowExceptionAndWarning(TdsParserStateObject stateObj, Boolean callerHasConnectionLock, Boolean asyncClose)
   at Microsoft.Data.SqlClient.TdsParser.TryRun(RunBehavior runBehavior, SqlCommand cmdHandler, SqlDataReader dataStream, BulkCopySimpleResultSet bulkCopyHandler, TdsParserStateObject stateObj, Boolean& dataReady)
   at Microsoft.Data.SqlClient.SqlDataReader.TryHasMoreRows(Boolean& moreRows)
   at Microsoft.Data.SqlClient.SqlDataReader.TryReadInternal(Boolean setTimeout, Boolean& more)
   at Microsoft.Data.SqlClient.SqlDataReader.ReadAsyncExecute(Task task, Object state)
   at Microsoft.Data.SqlClient.SqlDataReader.InvokeAsyncCall[T](SqlDataReaderBaseAsyncCallContext`1 context)
--- End of stack trace from previous location ---
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeResultSetAsync(Int32 startCommandIndex, RelationalDataReader reader, CancellationToken cancellationToken)
ClientConnectionId:0fab9114-c68a-4b80-8ea2-733d9105c5ba
Error Number:2601,State:1,Class:14
   --- End of inner exception stack trace ---
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeResultSetAsync(Int32 startCommandIndex, RelationalDataReader reader, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeAsync(RelationalDataReader reader, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Update.Internal.SqlServerModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(IList`1 entriesToSave, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(StateManager stateManager, Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Storage.Internal.SqlServerExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
2025-02-02 14:38:51.872 +03:00 [ERR] Error registering device for National ID: 1064448614
Microsoft.EntityFrameworkCore.DbUpdateException: An error occurred while saving the entity changes. See the inner exception for details.
 ---> Microsoft.Data.SqlClient.SqlException (0x80131904): Cannot insert duplicate key row in object 'dbo.Customer_Devices' with unique index 'IX_Customer_Devices_NationalId_DeviceId'. The duplicate key value is (1064448614, TP1A.220624.014).
   at Microsoft.Data.SqlClient.SqlConnection.OnError(SqlException exception, Boolean breakConnection, Action`1 wrapCloseInAction)
   at Microsoft.Data.SqlClient.SqlInternalConnection.OnError(SqlException exception, Boolean breakConnection, Action`1 wrapCloseInAction)
   at Microsoft.Data.SqlClient.TdsParser.ThrowExceptionAndWarning(TdsParserStateObject stateObj, Boolean callerHasConnectionLock, Boolean asyncClose)
   at Microsoft.Data.SqlClient.TdsParser.TryRun(RunBehavior runBehavior, SqlCommand cmdHandler, SqlDataReader dataStream, BulkCopySimpleResultSet bulkCopyHandler, TdsParserStateObject stateObj, Boolean& dataReady)
   at Microsoft.Data.SqlClient.SqlDataReader.TryHasMoreRows(Boolean& moreRows)
   at Microsoft.Data.SqlClient.SqlDataReader.TryReadInternal(Boolean setTimeout, Boolean& more)
   at Microsoft.Data.SqlClient.SqlDataReader.ReadAsyncExecute(Task task, Object state)
   at Microsoft.Data.SqlClient.SqlDataReader.InvokeAsyncCall[T](SqlDataReaderBaseAsyncCallContext`1 context)
--- End of stack trace from previous location ---
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeResultSetAsync(Int32 startCommandIndex, RelationalDataReader reader, CancellationToken cancellationToken)
ClientConnectionId:0fab9114-c68a-4b80-8ea2-733d9105c5ba
Error Number:2601,State:1,Class:14
   --- End of inner exception stack trace ---
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeResultSetAsync(Int32 startCommandIndex, RelationalDataReader reader, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeAsync(RelationalDataReader reader, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Update.Internal.SqlServerModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(IList`1 entriesToSave, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(StateManager stateManager, Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Storage.Internal.SqlServerExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at NayifatAPI.Controllers.DeviceController.RegisterDevice(RegisterDeviceRequest request) in C:\Users\yamta\StudioProjects\nayifat_app_2025_new\nayifatapi\Controllers\DeviceController.cs:line 78
2025-02-02 14:38:51.899 +03:00 [INF] Executed DbCommand (14ms) [Parameters=[@p0='?' (Size = 4000), @p1='?' (DbType = DateTime2), @p2='?' (Size = 4000), @p3='?' (Size = 4000), @p4='?' (Size = 4000), @p5='?' (Size = 450), @p6='?' (Size = 4000), @p7='?' (Size = 4000), @p8='?' (Size = 4000), @p9='?' (DbType = DateTime2), @p10='?' (Size = 4000), @p11='?' (Size = 4000), @p12='?' (Size = 4000), @p13='?' (Size = 450), @p14='?' (Size = 4000), @p15='?' (Size = 4000), @p16='?' (DbType = Boolean), @p17='?' (Size = 4000), @p18='?' (DbType = DateTime2), @p19='?' (Size = 450), @p20='?' (DbType = DateTime2), @p21='?' (Size = 4000), @p22='?' (Size = 4000), @p23='?' (Size = 450), @p24='?' (Size = 4000), @p25='?' (Size = 4000), @p26='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SET NOCOUNT ON;
MERGE [AuthLogs] USING (
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7, 0),
(@p8, @p9, @p10, @p11, @p12, @p13, @p14, @p15, 1)) AS i ([AuthType], [CreatedAt], [DeviceId], [FailureReason], [IpAddress], [NationalId], [Status], [UserAgent], _Position) ON 1=0
WHEN NOT MATCHED THEN
INSERT ([AuthType], [CreatedAt], [DeviceId], [FailureReason], [IpAddress], [NationalId], [Status], [UserAgent])
VALUES (i.[AuthType], i.[CreatedAt], i.[DeviceId], i.[FailureReason], i.[IpAddress], i.[NationalId], i.[Status], i.[UserAgent])
OUTPUT INSERTED.[Id], i._Position;
INSERT INTO [Customer_Devices] ([BiometricEnabled], [BiometricToken], [CreatedAt], [DeviceId], [LastUsedAt], [Manufacturer], [Model], [NationalId], [OsVersion], [Platform], [Status])
OUTPUT INSERTED.[Id]
VALUES (@p16, @p17, @p18, @p19, @p20, @p21, @p22, @p23, @p24, @p25, @p26);
2025-02-02 14:38:51.906 +03:00 [ERR] An exception occurred in the database while saving changes for context type 'NayifatAPI.Data.ApplicationDbContext'.
Microsoft.EntityFrameworkCore.DbUpdateException: An error occurred while saving the entity changes. See the inner exception for details.
 ---> Microsoft.Data.SqlClient.SqlException (0x80131904): Cannot insert duplicate key row in object 'dbo.Customer_Devices' with unique index 'IX_Customer_Devices_NationalId_DeviceId'. The duplicate key value is (1064448614, TP1A.220624.014).
   at Microsoft.Data.SqlClient.SqlConnection.OnError(SqlException exception, Boolean breakConnection, Action`1 wrapCloseInAction)
   at Microsoft.Data.SqlClient.SqlInternalConnection.OnError(SqlException exception, Boolean breakConnection, Action`1 wrapCloseInAction)
   at Microsoft.Data.SqlClient.TdsParser.ThrowExceptionAndWarning(TdsParserStateObject stateObj, Boolean callerHasConnectionLock, Boolean asyncClose)
   at Microsoft.Data.SqlClient.TdsParser.TryRun(RunBehavior runBehavior, SqlCommand cmdHandler, SqlDataReader dataStream, BulkCopySimpleResultSet bulkCopyHandler, TdsParserStateObject stateObj, Boolean& dataReady)
   at Microsoft.Data.SqlClient.SqlDataReader.TryHasMoreRows(Boolean& moreRows)
   at Microsoft.Data.SqlClient.SqlDataReader.TryReadInternal(Boolean setTimeout, Boolean& more)
   at Microsoft.Data.SqlClient.SqlDataReader.ReadAsyncExecute(Task task, Object state)
   at Microsoft.Data.SqlClient.SqlDataReader.InvokeAsyncCall[T](SqlDataReaderBaseAsyncCallContext`1 context)
--- End of stack trace from previous location ---
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeResultSetAsync(Int32 startCommandIndex, RelationalDataReader reader, CancellationToken cancellationToken)
ClientConnectionId:0fab9114-c68a-4b80-8ea2-733d9105c5ba
Error Number:2601,State:1,Class:14
   --- End of inner exception stack trace ---
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeResultSetAsync(Int32 startCommandIndex, RelationalDataReader reader, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeAsync(RelationalDataReader reader, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Update.Internal.SqlServerModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(IList`1 entriesToSave, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(StateManager stateManager, Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Storage.Internal.SqlServerExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
Microsoft.EntityFrameworkCore.DbUpdateException: An error occurred while saving the entity changes. See the inner exception for details.
 ---> Microsoft.Data.SqlClient.SqlException (0x80131904): Cannot insert duplicate key row in object 'dbo.Customer_Devices' with unique index 'IX_Customer_Devices_NationalId_DeviceId'. The duplicate key value is (1064448614, TP1A.220624.014).
   at Microsoft.Data.SqlClient.SqlConnection.OnError(SqlException exception, Boolean breakConnection, Action`1 wrapCloseInAction)
   at Microsoft.Data.SqlClient.SqlInternalConnection.OnError(SqlException exception, Boolean breakConnection, Action`1 wrapCloseInAction)
   at Microsoft.Data.SqlClient.TdsParser.ThrowExceptionAndWarning(TdsParserStateObject stateObj, Boolean callerHasConnectionLock, Boolean asyncClose)
   at Microsoft.Data.SqlClient.TdsParser.TryRun(RunBehavior runBehavior, SqlCommand cmdHandler, SqlDataReader dataStream, BulkCopySimpleResultSet bulkCopyHandler, TdsParserStateObject stateObj, Boolean& dataReady)
   at Microsoft.Data.SqlClient.SqlDataReader.TryHasMoreRows(Boolean& moreRows)
   at Microsoft.Data.SqlClient.SqlDataReader.TryReadInternal(Boolean setTimeout, Boolean& more)
   at Microsoft.Data.SqlClient.SqlDataReader.ReadAsyncExecute(Task task, Object state)
   at Microsoft.Data.SqlClient.SqlDataReader.InvokeAsyncCall[T](SqlDataReaderBaseAsyncCallContext`1 context)
--- End of stack trace from previous location ---
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeResultSetAsync(Int32 startCommandIndex, RelationalDataReader reader, CancellationToken cancellationToken)
ClientConnectionId:0fab9114-c68a-4b80-8ea2-733d9105c5ba
Error Number:2601,State:1,Class:14
   --- End of inner exception stack trace ---
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeResultSetAsync(Int32 startCommandIndex, RelationalDataReader reader, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeAsync(RelationalDataReader reader, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Update.Internal.SqlServerModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(IList`1 entriesToSave, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(StateManager stateManager, Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Storage.Internal.SqlServerExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
2025-02-02 14:38:51.925 +03:00 [INF] Executed action NayifatAPI.Controllers.DeviceController.RegisterDevice (NayifatAPI) in 131.1724ms
2025-02-02 14:38:51.927 +03:00 [INF] Executed endpoint 'NayifatAPI.Controllers.DeviceController.RegisterDevice (NayifatAPI)'
2025-02-02 14:38:51.929 +03:00 [ERR] Unhandled exception
Microsoft.EntityFrameworkCore.DbUpdateException: An error occurred while saving the entity changes. See the inner exception for details.
 ---> Microsoft.Data.SqlClient.SqlException (0x80131904): Cannot insert duplicate key row in object 'dbo.Customer_Devices' with unique index 'IX_Customer_Devices_NationalId_DeviceId'. The duplicate key value is (1064448614, TP1A.220624.014).
   at Microsoft.Data.SqlClient.SqlConnection.OnError(SqlException exception, Boolean breakConnection, Action`1 wrapCloseInAction)
   at Microsoft.Data.SqlClient.SqlInternalConnection.OnError(SqlException exception, Boolean breakConnection, Action`1 wrapCloseInAction)
   at Microsoft.Data.SqlClient.TdsParser.ThrowExceptionAndWarning(TdsParserStateObject stateObj, Boolean callerHasConnectionLock, Boolean asyncClose)
   at Microsoft.Data.SqlClient.TdsParser.TryRun(RunBehavior runBehavior, SqlCommand cmdHandler, SqlDataReader dataStream, BulkCopySimpleResultSet bulkCopyHandler, TdsParserStateObject stateObj, Boolean& dataReady)
   at Microsoft.Data.SqlClient.SqlDataReader.TryHasMoreRows(Boolean& moreRows)
   at Microsoft.Data.SqlClient.SqlDataReader.TryReadInternal(Boolean setTimeout, Boolean& more)
   at Microsoft.Data.SqlClient.SqlDataReader.ReadAsyncExecute(Task task, Object state)
   at Microsoft.Data.SqlClient.SqlDataReader.InvokeAsyncCall[T](SqlDataReaderBaseAsyncCallContext`1 context)
--- End of stack trace from previous location ---
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeResultSetAsync(Int32 startCommandIndex, RelationalDataReader reader, CancellationToken cancellationToken)
ClientConnectionId:0fab9114-c68a-4b80-8ea2-733d9105c5ba
Error Number:2601,State:1,Class:14
   --- End of inner exception stack trace ---
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeResultSetAsync(Int32 startCommandIndex, RelationalDataReader reader, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeAsync(RelationalDataReader reader, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Update.Internal.SqlServerModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(IList`1 entriesToSave, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(StateManager stateManager, Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Storage.Internal.SqlServerExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at NayifatAPI.Controllers.DeviceController.RegisterDevice(RegisterDeviceRequest request) in C:\Users\yamta\StudioProjects\nayifat_app_2025_new\nayifatapi\Controllers\DeviceController.cs:line 105
   at Microsoft.AspNetCore.Mvc.Infrastructure.ActionMethodExecutor.TaskOfIActionResultExecutor.Execute(ActionContext actionContext, IActionResultTypeMapper mapper, ObjectMethodExecutor executor, Object controller, Object[] arguments)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.<InvokeActionMethodAsync>g__Awaited|12_0(ControllerActionInvoker invoker, ValueTask`1 actionResultValueTask)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.<InvokeNextActionFilterAsync>g__Awaited|10_0(ControllerActionInvoker invoker, Task lastTask, State next, Scope scope, Object state, Boolean isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.Rethrow(ActionExecutedContextSealed context)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.Next(State& next, Scope& scope, Object& state, Boolean& isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.<InvokeInnerFilterAsync>g__Awaited|13_0(ControllerActionInvoker invoker, Task lastTask, State next, Scope scope, Object state, Boolean isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeFilterPipelineAsync>g__Awaited|20_0(ResourceInvoker invoker, Task lastTask, State next, Scope scope, Object state, Boolean isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeAsync>g__Logged|17_1(ResourceInvoker invoker)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeAsync>g__Logged|17_1(ResourceInvoker invoker)
   at Microsoft.AspNetCore.Routing.EndpointMiddleware.<Invoke>g__AwaitRequestTask|7_0(Endpoint endpoint, Task requestTask, ILogger logger)
   at Microsoft.AspNetCore.Authorization.AuthorizationMiddleware.Invoke(HttpContext context)
   at Program.<>c.<<<Main>$>b__0_3>d.MoveNext() in C:\Users\yamta\StudioProjects\nayifat_app_2025_new\nayifatapi\Program.cs:line 85
2025-02-02 14:38:51.995 +03:00 [ERR] An unhandled exception has occurred while executing the request.
Microsoft.EntityFrameworkCore.DbUpdateException: An error occurred while saving the entity changes. See the inner exception for details.
 ---> Microsoft.Data.SqlClient.SqlException (0x80131904): Cannot insert duplicate key row in object 'dbo.Customer_Devices' with unique index 'IX_Customer_Devices_NationalId_DeviceId'. The duplicate key value is (1064448614, TP1A.220624.014).
   at Microsoft.Data.SqlClient.SqlConnection.OnError(SqlException exception, Boolean breakConnection, Action`1 wrapCloseInAction)
   at Microsoft.Data.SqlClient.SqlInternalConnection.OnError(SqlException exception, Boolean breakConnection, Action`1 wrapCloseInAction)
   at Microsoft.Data.SqlClient.TdsParser.ThrowExceptionAndWarning(TdsParserStateObject stateObj, Boolean callerHasConnectionLock, Boolean asyncClose)
   at Microsoft.Data.SqlClient.TdsParser.TryRun(RunBehavior runBehavior, SqlCommand cmdHandler, SqlDataReader dataStream, BulkCopySimpleResultSet bulkCopyHandler, TdsParserStateObject stateObj, Boolean& dataReady)
   at Microsoft.Data.SqlClient.SqlDataReader.TryHasMoreRows(Boolean& moreRows)
   at Microsoft.Data.SqlClient.SqlDataReader.TryReadInternal(Boolean setTimeout, Boolean& more)
   at Microsoft.Data.SqlClient.SqlDataReader.ReadAsyncExecute(Task task, Object state)
   at Microsoft.Data.SqlClient.SqlDataReader.InvokeAsyncCall[T](SqlDataReaderBaseAsyncCallContext`1 context)
--- End of stack trace from previous location ---
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeResultSetAsync(Int32 startCommandIndex, RelationalDataReader reader, CancellationToken cancellationToken)
ClientConnectionId:0fab9114-c68a-4b80-8ea2-733d9105c5ba
Error Number:2601,State:1,Class:14
   --- End of inner exception stack trace ---
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeResultSetAsync(Int32 startCommandIndex, RelationalDataReader reader, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeAsync(RelationalDataReader reader, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Update.Internal.SqlServerModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(IList`1 entriesToSave, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(StateManager stateManager, Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Storage.Internal.SqlServerExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at NayifatAPI.Controllers.DeviceController.RegisterDevice(RegisterDeviceRequest request) in C:\Users\yamta\StudioProjects\nayifat_app_2025_new\nayifatapi\Controllers\DeviceController.cs:line 105
   at Microsoft.AspNetCore.Mvc.Infrastructure.ActionMethodExecutor.TaskOfIActionResultExecutor.Execute(ActionContext actionContext, IActionResultTypeMapper mapper, ObjectMethodExecutor executor, Object controller, Object[] arguments)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.<InvokeActionMethodAsync>g__Awaited|12_0(ControllerActionInvoker invoker, ValueTask`1 actionResultValueTask)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.<InvokeNextActionFilterAsync>g__Awaited|10_0(ControllerActionInvoker invoker, Task lastTask, State next, Scope scope, Object state, Boolean isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.Rethrow(ActionExecutedContextSealed context)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.Next(State& next, Scope& scope, Object& state, Boolean& isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.<InvokeInnerFilterAsync>g__Awaited|13_0(ControllerActionInvoker invoker, Task lastTask, State next, Scope scope, Object state, Boolean isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeFilterPipelineAsync>g__Awaited|20_0(ResourceInvoker invoker, Task lastTask, State next, Scope scope, Object state, Boolean isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeAsync>g__Logged|17_1(ResourceInvoker invoker)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeAsync>g__Logged|17_1(ResourceInvoker invoker)
   at Microsoft.AspNetCore.Routing.EndpointMiddleware.<Invoke>g__AwaitRequestTask|7_0(Endpoint endpoint, Task requestTask, ILogger logger)
   at Microsoft.AspNetCore.Authorization.AuthorizationMiddleware.Invoke(HttpContext context)
   at Program.<>c.<<<Main>$>b__0_3>d.MoveNext() in C:\Users\yamta\StudioProjects\nayifat_app_2025_new\nayifatapi\Program.cs:line 85
--- End of stack trace from previous location ---
   at Swashbuckle.AspNetCore.SwaggerUI.SwaggerUIMiddleware.Invoke(HttpContext httpContext)
   at Swashbuckle.AspNetCore.Swagger.SwaggerMiddleware.Invoke(HttpContext httpContext, ISwaggerProvider swaggerProvider)
   at Microsoft.AspNetCore.Authentication.AuthenticationMiddleware.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Diagnostics.DeveloperExceptionPageMiddlewareImpl.Invoke(HttpContext context)
2025-02-02 14:38:52.031 +03:00 [INF] Request finished HTTP/1.1 POST http://07ca-46-152-255-232.ngrok-free.app/api/device - 500 null text/plain; charset=utf-8 242.0144ms
2025-02-02 14:39:42.194 +03:00 [INF] Request starting HTTP/1.1 POST http://07ca-46-152-255-232.ngrok-free.app/api/notifications/list - application/json; charset=utf-8 47
2025-02-02 14:39:42.197 +03:00 [INF] Executing endpoint 'NayifatAPI.Controllers.NotificationsController.GetNotifications (NayifatAPI)'
2025-02-02 14:39:42.198 +03:00 [INF] Route matched with {action = "GetNotifications", controller = "Notifications"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetNotifications(NayifatAPI.Controllers.GetNotificationsRequest) on controller NayifatAPI.Controllers.NotificationsController (NayifatAPI).
2025-02-02 14:39:42.207 +03:00 [INF] Executed DbCommand (6ms) [Parameters=[@__providedApiKey_0='?' (Size = 255)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [a].[Key], [a].[CreatedAt], [a].[Description], [a].[ExpiresAt], [a].[IsActive], [a].[LastUsedAt]
FROM [ApiKeys] AS [a]
WHERE [a].[Key] = @__providedApiKey_0 AND [a].[IsActive] = CAST(1 AS bit)
2025-02-02 14:39:42.231 +03:00 [INF] Executed DbCommand (15ms) [Parameters=[@__request_NationalId_0='?' (Size = 450)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [u].[national_id], [u].[last_updated], [u].[notifications]
FROM [user_notifications] AS [u]
WHERE [u].[national_id] = @__request_NationalId_0
2025-02-02 14:39:42.277 +03:00 [INF] Executed DbCommand (9ms) [Parameters=[@__Parse_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [n].[Id], [n].[additional_data], [n].[Body], [n].[body_ar], [n].[body_en], [n].[created_at], [n].[expiry_at], [n].[Route], [n].[target_criteria], [n].[Title], [n].[title_ar], [n].[title_en]
FROM [notification_templates] AS [n]
WHERE [n].[Id] = @__Parse_0
2025-02-02 14:39:42.312 +03:00 [INF] Executed DbCommand (5ms) [Parameters=[@__Parse_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [n].[Id], [n].[additional_data], [n].[Body], [n].[body_ar], [n].[body_en], [n].[created_at], [n].[expiry_at], [n].[Route], [n].[target_criteria], [n].[Title], [n].[title_ar], [n].[title_en]
FROM [notification_templates] AS [n]
WHERE [n].[Id] = @__Parse_0
2025-02-02 14:39:42.541 +03:00 [INF] Executed DbCommand (226ms) [Parameters=[@p0='?' (Size = 4000), @p1='?' (DbType = DateTime2), @p2='?' (Size = 4000), @p3='?' (Size = 4000), @p4='?' (Size = 4000), @p5='?' (Size = 450), @p6='?' (Size = 4000), @p7='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SET IMPLICIT_TRANSACTIONS OFF;
SET NOCOUNT ON;
INSERT INTO [AuthLogs] ([AuthType], [CreatedAt], [DeviceId], [FailureReason], [IpAddress], [NationalId], [Status], [UserAgent])
OUTPUT INSERTED.[Id]
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7);
2025-02-02 14:39:42.611 +03:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType9`2[[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Object, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-02-02 14:39:42.619 +03:00 [INF] Executed action NayifatAPI.Controllers.NotificationsController.GetNotifications (NayifatAPI) in 418.7945ms
2025-02-02 14:39:42.624 +03:00 [INF] Executed endpoint 'NayifatAPI.Controllers.NotificationsController.GetNotifications (NayifatAPI)'
2025-02-02 14:39:42.627 +03:00 [INF] Request finished HTTP/1.1 POST http://07ca-46-152-255-232.ngrok-free.app/api/notifications/list - 200 null application/json; charset=utf-8 432.5158ms
2025-02-02 14:44:09.661 +03:00 [INF] Application is shutting down...
2025-02-02 14:44:26.354 +03:00 [INF] Starting web application
2025-02-02 14:44:26.473 +03:00 [INF] Now listening on: http://localhost:5264
2025-02-02 14:44:26.598 +03:00 [INF] Application started. Press Ctrl+C to shut down.
2025-02-02 14:44:26.924 +03:00 [INF] Hosting environment: Development
2025-02-02 14:44:26.925 +03:00 [INF] Content root path: C:\Users\yamta\StudioProjects\nayifat_app_2025_new\nayifatapi
2025-02-02 14:44:42.539 +03:00 [INF] Request starting HTTP/1.1 POST http://07ca-46-152-255-232.ngrok-free.app/api/notifications/list - application/json; charset=utf-8 47
2025-02-02 14:44:42.836 +03:00 [WRN] Failed to determine the https port for redirect.
2025-02-02 14:44:43.167 +03:00 [INF] Executing endpoint 'NayifatAPI.Controllers.NotificationsController.GetNotifications (NayifatAPI)'
2025-02-02 14:44:43.298 +03:00 [INF] Route matched with {action = "GetNotifications", controller = "Notifications"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetNotifications(NayifatAPI.Controllers.GetNotificationsRequest) on controller NayifatAPI.Controllers.NotificationsController (NayifatAPI).
2025-02-02 14:44:44.903 +03:00 [INF] Executed DbCommand (25ms) [Parameters=[@__providedApiKey_0='?' (Size = 255)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [a].[Key], [a].[CreatedAt], [a].[Description], [a].[ExpiresAt], [a].[IsActive], [a].[LastUsedAt]
FROM [ApiKeys] AS [a]
WHERE [a].[Key] = @__providedApiKey_0 AND [a].[IsActive] = CAST(1 AS bit)
2025-02-02 14:44:45.017 +03:00 [INF] Executed DbCommand (16ms) [Parameters=[@__request_NationalId_0='?' (Size = 450)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [u].[national_id], [u].[last_updated], [u].[notifications]
FROM [user_notifications] AS [u]
WHERE [u].[national_id] = @__request_NationalId_0
2025-02-02 14:44:45.083 +03:00 [INF] Executed DbCommand (5ms) [Parameters=[@__Parse_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [n].[Id], [n].[additional_data], [n].[Body], [n].[body_ar], [n].[body_en], [n].[created_at], [n].[expiry_at], [n].[Route], [n].[target_criteria], [n].[Title], [n].[title_ar], [n].[title_en]
FROM [notification_templates] AS [n]
WHERE [n].[Id] = @__Parse_0
2025-02-02 14:44:45.135 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@__Parse_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [n].[Id], [n].[additional_data], [n].[Body], [n].[body_ar], [n].[body_en], [n].[created_at], [n].[expiry_at], [n].[Route], [n].[target_criteria], [n].[Title], [n].[title_ar], [n].[title_en]
FROM [notification_templates] AS [n]
WHERE [n].[Id] = @__Parse_0
2025-02-02 14:44:45.452 +03:00 [INF] Executed DbCommand (10ms) [Parameters=[@p0='?' (Size = 4000), @p1='?' (DbType = DateTime2), @p2='?' (Size = 4000), @p3='?' (Size = 4000), @p4='?' (Size = 4000), @p5='?' (Size = 450), @p6='?' (Size = 4000), @p7='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SET IMPLICIT_TRANSACTIONS OFF;
SET NOCOUNT ON;
INSERT INTO [AuthLogs] ([AuthType], [CreatedAt], [DeviceId], [FailureReason], [IpAddress], [NationalId], [Status], [UserAgent])
OUTPUT INSERTED.[Id]
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7);
2025-02-02 14:44:45.490 +03:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType9`2[[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Object, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-02-02 14:44:45.515 +03:00 [INF] Executed action NayifatAPI.Controllers.NotificationsController.GetNotifications (NayifatAPI) in 2211.447ms
2025-02-02 14:44:45.518 +03:00 [INF] Executed endpoint 'NayifatAPI.Controllers.NotificationsController.GetNotifications (NayifatAPI)'
2025-02-02 14:44:45.528 +03:00 [INF] Request finished HTTP/1.1 POST http://07ca-46-152-255-232.ngrok-free.app/api/notifications/list - 200 null application/json; charset=utf-8 2992.149ms
2025-02-02 14:44:53.580 +03:00 [INF] Request starting HTTP/1.1 POST http://07ca-46-152-255-232.ngrok-free.app/api/device - application/json 223
2025-02-02 14:44:53.590 +03:00 [INF] Executing endpoint 'NayifatAPI.Controllers.DeviceController.RegisterDevice (NayifatAPI)'
2025-02-02 14:44:53.608 +03:00 [INF] Route matched with {action = "RegisterDevice", controller = "Device"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] RegisterDevice(NayifatAPI.Controllers.RegisterDeviceRequest) on controller NayifatAPI.Controllers.DeviceController (NayifatAPI).
2025-02-02 14:44:53.732 +03:00 [INF] Executed DbCommand (4ms) [Parameters=[@__providedApiKey_0='?' (Size = 255)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [a].[Key], [a].[CreatedAt], [a].[Description], [a].[ExpiresAt], [a].[IsActive], [a].[LastUsedAt]
FROM [ApiKeys] AS [a]
WHERE [a].[Key] = @__providedApiKey_0 AND [a].[IsActive] = CAST(1 AS bit)
2025-02-02 14:44:53.825 +03:00 [INF] Executed DbCommand (5ms) [Parameters=[@__p_0='?' (Size = 450)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [c].[NationalId], [c].[AddNo], [c].[BuildingNo], [c].[City], [c].[Consent], [c].[ConsentDate], [c].[DateOfBirth], [c].[Dependents], [c].[District], [c].[Email], [c].[Employer], [c].[FamilyNameAr], [c].[FamilyNameEn], [c].[FirstNameAr], [c].[FirstNameEn], [c].[Iban], [c].[IdExpiryDate], [c].[Los], [c].[Mpin], [c].[MpinEnabled], [c].[NafathStatus], [c].[NafathTimestamp], [c].[Password], [c].[Phone], [c].[RegistrationDate], [c].[SalaryCustomer], [c].[SalaryDakhli], [c].[SecondNameAr], [c].[SecondNameEn], [c].[Sector], [c].[Street], [c].[ThirdNameAr], [c].[ThirdNameEn], [c].[Zipcode]
FROM [Customers] AS [c]
WHERE [c].[NationalId] = @__p_0
2025-02-02 14:44:54.089 +03:00 [INF] Executed DbCommand (21ms) [Parameters=[@__request_NationalId_0='?' (Size = 450)], CommandType='"Text"', CommandTimeout='30']
UPDATE [c]
SET [c].[LastUsedAt] = GETUTCDATE(),
    [c].[Status] = N'disabled'
FROM [Customer_Devices] AS [c]
WHERE [c].[NationalId] = @__request_NationalId_0
2025-02-02 14:44:54.257 +03:00 [INF] Executed DbCommand (7ms) [Parameters=[@p0='?' (Size = 4000), @p1='?' (DbType = DateTime2), @p2='?' (Size = 4000), @p3='?' (Size = 4000), @p4='?' (Size = 4000), @p5='?' (Size = 450), @p6='?' (Size = 4000), @p7='?' (Size = 4000), @p8='?' (DbType = Boolean), @p9='?' (Size = 4000), @p10='?' (DbType = DateTime2), @p11='?' (Size = 450), @p12='?' (DbType = DateTime2), @p13='?' (Size = 4000), @p14='?' (Size = 4000), @p15='?' (Size = 450), @p16='?' (Size = 4000), @p17='?' (Size = 4000), @p18='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SET NOCOUNT ON;
INSERT INTO [AuthLogs] ([AuthType], [CreatedAt], [DeviceId], [FailureReason], [IpAddress], [NationalId], [Status], [UserAgent])
OUTPUT INSERTED.[Id]
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7);
INSERT INTO [Customer_Devices] ([BiometricEnabled], [BiometricToken], [CreatedAt], [DeviceId], [LastUsedAt], [Manufacturer], [Model], [NationalId], [OsVersion], [Platform], [Status])
OUTPUT INSERTED.[Id]
VALUES (@p8, @p9, @p10, @p11, @p12, @p13, @p14, @p15, @p16, @p17, @p18);
2025-02-02 14:44:54.301 +03:00 [ERR] An exception occurred in the database while saving changes for context type 'NayifatAPI.Data.ApplicationDbContext'.
Microsoft.EntityFrameworkCore.DbUpdateException: An error occurred while saving the entity changes. See the inner exception for details.
 ---> Microsoft.Data.SqlClient.SqlException (0x80131904): Cannot insert duplicate key row in object 'dbo.Customer_Devices' with unique index 'IX_Customer_Devices_NationalId_DeviceId'. The duplicate key value is (1064448614, TP1A.220624.014).
   at Microsoft.Data.SqlClient.SqlConnection.OnError(SqlException exception, Boolean breakConnection, Action`1 wrapCloseInAction)
   at Microsoft.Data.SqlClient.SqlInternalConnection.OnError(SqlException exception, Boolean breakConnection, Action`1 wrapCloseInAction)
   at Microsoft.Data.SqlClient.TdsParser.ThrowExceptionAndWarning(TdsParserStateObject stateObj, Boolean callerHasConnectionLock, Boolean asyncClose)
   at Microsoft.Data.SqlClient.TdsParser.TryRun(RunBehavior runBehavior, SqlCommand cmdHandler, SqlDataReader dataStream, BulkCopySimpleResultSet bulkCopyHandler, TdsParserStateObject stateObj, Boolean& dataReady)
   at Microsoft.Data.SqlClient.SqlDataReader.TryHasMoreRows(Boolean& moreRows)
   at Microsoft.Data.SqlClient.SqlDataReader.TryReadInternal(Boolean setTimeout, Boolean& more)
   at Microsoft.Data.SqlClient.SqlDataReader.ReadAsyncExecute(Task task, Object state)
   at Microsoft.Data.SqlClient.SqlDataReader.InvokeAsyncCall[T](SqlDataReaderBaseAsyncCallContext`1 context)
--- End of stack trace from previous location ---
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeResultSetAsync(Int32 startCommandIndex, RelationalDataReader reader, CancellationToken cancellationToken)
ClientConnectionId:c6e293e3-d63c-4780-9be3-165a51dd1438
Error Number:2601,State:1,Class:14
   --- End of inner exception stack trace ---
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeResultSetAsync(Int32 startCommandIndex, RelationalDataReader reader, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeAsync(RelationalDataReader reader, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Update.Internal.SqlServerModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(IList`1 entriesToSave, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(StateManager stateManager, Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Storage.Internal.SqlServerExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
Microsoft.EntityFrameworkCore.DbUpdateException: An error occurred while saving the entity changes. See the inner exception for details.
 ---> Microsoft.Data.SqlClient.SqlException (0x80131904): Cannot insert duplicate key row in object 'dbo.Customer_Devices' with unique index 'IX_Customer_Devices_NationalId_DeviceId'. The duplicate key value is (1064448614, TP1A.220624.014).
   at Microsoft.Data.SqlClient.SqlConnection.OnError(SqlException exception, Boolean breakConnection, Action`1 wrapCloseInAction)
   at Microsoft.Data.SqlClient.SqlInternalConnection.OnError(SqlException exception, Boolean breakConnection, Action`1 wrapCloseInAction)
   at Microsoft.Data.SqlClient.TdsParser.ThrowExceptionAndWarning(TdsParserStateObject stateObj, Boolean callerHasConnectionLock, Boolean asyncClose)
   at Microsoft.Data.SqlClient.TdsParser.TryRun(RunBehavior runBehavior, SqlCommand cmdHandler, SqlDataReader dataStream, BulkCopySimpleResultSet bulkCopyHandler, TdsParserStateObject stateObj, Boolean& dataReady)
   at Microsoft.Data.SqlClient.SqlDataReader.TryHasMoreRows(Boolean& moreRows)
   at Microsoft.Data.SqlClient.SqlDataReader.TryReadInternal(Boolean setTimeout, Boolean& more)
   at Microsoft.Data.SqlClient.SqlDataReader.ReadAsyncExecute(Task task, Object state)
   at Microsoft.Data.SqlClient.SqlDataReader.InvokeAsyncCall[T](SqlDataReaderBaseAsyncCallContext`1 context)
--- End of stack trace from previous location ---
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeResultSetAsync(Int32 startCommandIndex, RelationalDataReader reader, CancellationToken cancellationToken)
ClientConnectionId:c6e293e3-d63c-4780-9be3-165a51dd1438
Error Number:2601,State:1,Class:14
   --- End of inner exception stack trace ---
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeResultSetAsync(Int32 startCommandIndex, RelationalDataReader reader, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeAsync(RelationalDataReader reader, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Update.Internal.SqlServerModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(IList`1 entriesToSave, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(StateManager stateManager, Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Storage.Internal.SqlServerExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
2025-02-02 14:44:54.329 +03:00 [ERR] Error registering device for National ID: 1064448614
Microsoft.EntityFrameworkCore.DbUpdateException: An error occurred while saving the entity changes. See the inner exception for details.
 ---> Microsoft.Data.SqlClient.SqlException (0x80131904): Cannot insert duplicate key row in object 'dbo.Customer_Devices' with unique index 'IX_Customer_Devices_NationalId_DeviceId'. The duplicate key value is (1064448614, TP1A.220624.014).
   at Microsoft.Data.SqlClient.SqlConnection.OnError(SqlException exception, Boolean breakConnection, Action`1 wrapCloseInAction)
   at Microsoft.Data.SqlClient.SqlInternalConnection.OnError(SqlException exception, Boolean breakConnection, Action`1 wrapCloseInAction)
   at Microsoft.Data.SqlClient.TdsParser.ThrowExceptionAndWarning(TdsParserStateObject stateObj, Boolean callerHasConnectionLock, Boolean asyncClose)
   at Microsoft.Data.SqlClient.TdsParser.TryRun(RunBehavior runBehavior, SqlCommand cmdHandler, SqlDataReader dataStream, BulkCopySimpleResultSet bulkCopyHandler, TdsParserStateObject stateObj, Boolean& dataReady)
   at Microsoft.Data.SqlClient.SqlDataReader.TryHasMoreRows(Boolean& moreRows)
   at Microsoft.Data.SqlClient.SqlDataReader.TryReadInternal(Boolean setTimeout, Boolean& more)
   at Microsoft.Data.SqlClient.SqlDataReader.ReadAsyncExecute(Task task, Object state)
   at Microsoft.Data.SqlClient.SqlDataReader.InvokeAsyncCall[T](SqlDataReaderBaseAsyncCallContext`1 context)
--- End of stack trace from previous location ---
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeResultSetAsync(Int32 startCommandIndex, RelationalDataReader reader, CancellationToken cancellationToken)
ClientConnectionId:c6e293e3-d63c-4780-9be3-165a51dd1438
Error Number:2601,State:1,Class:14
   --- End of inner exception stack trace ---
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeResultSetAsync(Int32 startCommandIndex, RelationalDataReader reader, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeAsync(RelationalDataReader reader, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Update.Internal.SqlServerModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(IList`1 entriesToSave, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(StateManager stateManager, Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Storage.Internal.SqlServerExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at NayifatAPI.Controllers.DeviceController.RegisterDevice(RegisterDeviceRequest request) in C:\Users\yamta\StudioProjects\nayifat_app_2025_new\nayifatapi\Controllers\DeviceController.cs:line 78
2025-02-02 14:44:54.413 +03:00 [INF] Executed DbCommand (15ms) [Parameters=[@p0='?' (Size = 4000), @p1='?' (DbType = DateTime2), @p2='?' (Size = 4000), @p3='?' (Size = 4000), @p4='?' (Size = 4000), @p5='?' (Size = 450), @p6='?' (Size = 4000), @p7='?' (Size = 4000), @p8='?' (Size = 4000), @p9='?' (DbType = DateTime2), @p10='?' (Size = 4000), @p11='?' (Size = 4000), @p12='?' (Size = 4000), @p13='?' (Size = 450), @p14='?' (Size = 4000), @p15='?' (Size = 4000), @p16='?' (DbType = Boolean), @p17='?' (Size = 4000), @p18='?' (DbType = DateTime2), @p19='?' (Size = 450), @p20='?' (DbType = DateTime2), @p21='?' (Size = 4000), @p22='?' (Size = 4000), @p23='?' (Size = 450), @p24='?' (Size = 4000), @p25='?' (Size = 4000), @p26='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SET NOCOUNT ON;
MERGE [AuthLogs] USING (
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7, 0),
(@p8, @p9, @p10, @p11, @p12, @p13, @p14, @p15, 1)) AS i ([AuthType], [CreatedAt], [DeviceId], [FailureReason], [IpAddress], [NationalId], [Status], [UserAgent], _Position) ON 1=0
WHEN NOT MATCHED THEN
INSERT ([AuthType], [CreatedAt], [DeviceId], [FailureReason], [IpAddress], [NationalId], [Status], [UserAgent])
VALUES (i.[AuthType], i.[CreatedAt], i.[DeviceId], i.[FailureReason], i.[IpAddress], i.[NationalId], i.[Status], i.[UserAgent])
OUTPUT INSERTED.[Id], i._Position;
INSERT INTO [Customer_Devices] ([BiometricEnabled], [BiometricToken], [CreatedAt], [DeviceId], [LastUsedAt], [Manufacturer], [Model], [NationalId], [OsVersion], [Platform], [Status])
OUTPUT INSERTED.[Id]
VALUES (@p16, @p17, @p18, @p19, @p20, @p21, @p22, @p23, @p24, @p25, @p26);
2025-02-02 14:44:54.423 +03:00 [ERR] An exception occurred in the database while saving changes for context type 'NayifatAPI.Data.ApplicationDbContext'.
Microsoft.EntityFrameworkCore.DbUpdateException: An error occurred while saving the entity changes. See the inner exception for details.
 ---> Microsoft.Data.SqlClient.SqlException (0x80131904): Cannot insert duplicate key row in object 'dbo.Customer_Devices' with unique index 'IX_Customer_Devices_NationalId_DeviceId'. The duplicate key value is (1064448614, TP1A.220624.014).
   at Microsoft.Data.SqlClient.SqlConnection.OnError(SqlException exception, Boolean breakConnection, Action`1 wrapCloseInAction)
   at Microsoft.Data.SqlClient.SqlInternalConnection.OnError(SqlException exception, Boolean breakConnection, Action`1 wrapCloseInAction)
   at Microsoft.Data.SqlClient.TdsParser.ThrowExceptionAndWarning(TdsParserStateObject stateObj, Boolean callerHasConnectionLock, Boolean asyncClose)
   at Microsoft.Data.SqlClient.TdsParser.TryRun(RunBehavior runBehavior, SqlCommand cmdHandler, SqlDataReader dataStream, BulkCopySimpleResultSet bulkCopyHandler, TdsParserStateObject stateObj, Boolean& dataReady)
   at Microsoft.Data.SqlClient.SqlDataReader.TryHasMoreRows(Boolean& moreRows)
   at Microsoft.Data.SqlClient.SqlDataReader.TryReadInternal(Boolean setTimeout, Boolean& more)
   at Microsoft.Data.SqlClient.SqlDataReader.ReadAsyncExecute(Task task, Object state)
   at Microsoft.Data.SqlClient.SqlDataReader.InvokeAsyncCall[T](SqlDataReaderBaseAsyncCallContext`1 context)
--- End of stack trace from previous location ---
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeResultSetAsync(Int32 startCommandIndex, RelationalDataReader reader, CancellationToken cancellationToken)
ClientConnectionId:c6e293e3-d63c-4780-9be3-165a51dd1438
Error Number:2601,State:1,Class:14
   --- End of inner exception stack trace ---
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeResultSetAsync(Int32 startCommandIndex, RelationalDataReader reader, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeAsync(RelationalDataReader reader, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Update.Internal.SqlServerModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(IList`1 entriesToSave, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(StateManager stateManager, Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Storage.Internal.SqlServerExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
Microsoft.EntityFrameworkCore.DbUpdateException: An error occurred while saving the entity changes. See the inner exception for details.
 ---> Microsoft.Data.SqlClient.SqlException (0x80131904): Cannot insert duplicate key row in object 'dbo.Customer_Devices' with unique index 'IX_Customer_Devices_NationalId_DeviceId'. The duplicate key value is (1064448614, TP1A.220624.014).
   at Microsoft.Data.SqlClient.SqlConnection.OnError(SqlException exception, Boolean breakConnection, Action`1 wrapCloseInAction)
   at Microsoft.Data.SqlClient.SqlInternalConnection.OnError(SqlException exception, Boolean breakConnection, Action`1 wrapCloseInAction)
   at Microsoft.Data.SqlClient.TdsParser.ThrowExceptionAndWarning(TdsParserStateObject stateObj, Boolean callerHasConnectionLock, Boolean asyncClose)
   at Microsoft.Data.SqlClient.TdsParser.TryRun(RunBehavior runBehavior, SqlCommand cmdHandler, SqlDataReader dataStream, BulkCopySimpleResultSet bulkCopyHandler, TdsParserStateObject stateObj, Boolean& dataReady)
   at Microsoft.Data.SqlClient.SqlDataReader.TryHasMoreRows(Boolean& moreRows)
   at Microsoft.Data.SqlClient.SqlDataReader.TryReadInternal(Boolean setTimeout, Boolean& more)
   at Microsoft.Data.SqlClient.SqlDataReader.ReadAsyncExecute(Task task, Object state)
   at Microsoft.Data.SqlClient.SqlDataReader.InvokeAsyncCall[T](SqlDataReaderBaseAsyncCallContext`1 context)
--- End of stack trace from previous location ---
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeResultSetAsync(Int32 startCommandIndex, RelationalDataReader reader, CancellationToken cancellationToken)
ClientConnectionId:c6e293e3-d63c-4780-9be3-165a51dd1438
Error Number:2601,State:1,Class:14
   --- End of inner exception stack trace ---
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeResultSetAsync(Int32 startCommandIndex, RelationalDataReader reader, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeAsync(RelationalDataReader reader, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Update.Internal.SqlServerModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(IList`1 entriesToSave, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(StateManager stateManager, Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Storage.Internal.SqlServerExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
2025-02-02 14:44:54.455 +03:00 [INF] Executed action NayifatAPI.Controllers.DeviceController.RegisterDevice (NayifatAPI) in 789.4246ms
2025-02-02 14:44:54.458 +03:00 [INF] Executed endpoint 'NayifatAPI.Controllers.DeviceController.RegisterDevice (NayifatAPI)'
2025-02-02 14:44:54.460 +03:00 [ERR] Unhandled exception
Microsoft.EntityFrameworkCore.DbUpdateException: An error occurred while saving the entity changes. See the inner exception for details.
 ---> Microsoft.Data.SqlClient.SqlException (0x80131904): Cannot insert duplicate key row in object 'dbo.Customer_Devices' with unique index 'IX_Customer_Devices_NationalId_DeviceId'. The duplicate key value is (1064448614, TP1A.220624.014).
   at Microsoft.Data.SqlClient.SqlConnection.OnError(SqlException exception, Boolean breakConnection, Action`1 wrapCloseInAction)
   at Microsoft.Data.SqlClient.SqlInternalConnection.OnError(SqlException exception, Boolean breakConnection, Action`1 wrapCloseInAction)
   at Microsoft.Data.SqlClient.TdsParser.ThrowExceptionAndWarning(TdsParserStateObject stateObj, Boolean callerHasConnectionLock, Boolean asyncClose)
   at Microsoft.Data.SqlClient.TdsParser.TryRun(RunBehavior runBehavior, SqlCommand cmdHandler, SqlDataReader dataStream, BulkCopySimpleResultSet bulkCopyHandler, TdsParserStateObject stateObj, Boolean& dataReady)
   at Microsoft.Data.SqlClient.SqlDataReader.TryHasMoreRows(Boolean& moreRows)
   at Microsoft.Data.SqlClient.SqlDataReader.TryReadInternal(Boolean setTimeout, Boolean& more)
   at Microsoft.Data.SqlClient.SqlDataReader.ReadAsyncExecute(Task task, Object state)
   at Microsoft.Data.SqlClient.SqlDataReader.InvokeAsyncCall[T](SqlDataReaderBaseAsyncCallContext`1 context)
--- End of stack trace from previous location ---
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeResultSetAsync(Int32 startCommandIndex, RelationalDataReader reader, CancellationToken cancellationToken)
ClientConnectionId:c6e293e3-d63c-4780-9be3-165a51dd1438
Error Number:2601,State:1,Class:14
   --- End of inner exception stack trace ---
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeResultSetAsync(Int32 startCommandIndex, RelationalDataReader reader, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeAsync(RelationalDataReader reader, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Update.Internal.SqlServerModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(IList`1 entriesToSave, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(StateManager stateManager, Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Storage.Internal.SqlServerExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at NayifatAPI.Controllers.DeviceController.RegisterDevice(RegisterDeviceRequest request) in C:\Users\yamta\StudioProjects\nayifat_app_2025_new\nayifatapi\Controllers\DeviceController.cs:line 105
   at Microsoft.AspNetCore.Mvc.Infrastructure.ActionMethodExecutor.TaskOfIActionResultExecutor.Execute(ActionContext actionContext, IActionResultTypeMapper mapper, ObjectMethodExecutor executor, Object controller, Object[] arguments)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.<InvokeActionMethodAsync>g__Awaited|12_0(ControllerActionInvoker invoker, ValueTask`1 actionResultValueTask)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.<InvokeNextActionFilterAsync>g__Awaited|10_0(ControllerActionInvoker invoker, Task lastTask, State next, Scope scope, Object state, Boolean isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.Rethrow(ActionExecutedContextSealed context)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.Next(State& next, Scope& scope, Object& state, Boolean& isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.<InvokeInnerFilterAsync>g__Awaited|13_0(ControllerActionInvoker invoker, Task lastTask, State next, Scope scope, Object state, Boolean isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeFilterPipelineAsync>g__Awaited|20_0(ResourceInvoker invoker, Task lastTask, State next, Scope scope, Object state, Boolean isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeAsync>g__Logged|17_1(ResourceInvoker invoker)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeAsync>g__Logged|17_1(ResourceInvoker invoker)
   at Microsoft.AspNetCore.Routing.EndpointMiddleware.<Invoke>g__AwaitRequestTask|7_0(Endpoint endpoint, Task requestTask, ILogger logger)
   at Microsoft.AspNetCore.Authorization.AuthorizationMiddleware.Invoke(HttpContext context)
   at Program.<>c.<<<Main>$>b__0_3>d.MoveNext() in C:\Users\yamta\StudioProjects\nayifat_app_2025_new\nayifatapi\Program.cs:line 85
2025-02-02 14:44:54.493 +03:00 [ERR] An unhandled exception has occurred while executing the request.
Microsoft.EntityFrameworkCore.DbUpdateException: An error occurred while saving the entity changes. See the inner exception for details.
 ---> Microsoft.Data.SqlClient.SqlException (0x80131904): Cannot insert duplicate key row in object 'dbo.Customer_Devices' with unique index 'IX_Customer_Devices_NationalId_DeviceId'. The duplicate key value is (1064448614, TP1A.220624.014).
   at Microsoft.Data.SqlClient.SqlConnection.OnError(SqlException exception, Boolean breakConnection, Action`1 wrapCloseInAction)
   at Microsoft.Data.SqlClient.SqlInternalConnection.OnError(SqlException exception, Boolean breakConnection, Action`1 wrapCloseInAction)
   at Microsoft.Data.SqlClient.TdsParser.ThrowExceptionAndWarning(TdsParserStateObject stateObj, Boolean callerHasConnectionLock, Boolean asyncClose)
   at Microsoft.Data.SqlClient.TdsParser.TryRun(RunBehavior runBehavior, SqlCommand cmdHandler, SqlDataReader dataStream, BulkCopySimpleResultSet bulkCopyHandler, TdsParserStateObject stateObj, Boolean& dataReady)
   at Microsoft.Data.SqlClient.SqlDataReader.TryHasMoreRows(Boolean& moreRows)
   at Microsoft.Data.SqlClient.SqlDataReader.TryReadInternal(Boolean setTimeout, Boolean& more)
   at Microsoft.Data.SqlClient.SqlDataReader.ReadAsyncExecute(Task task, Object state)
   at Microsoft.Data.SqlClient.SqlDataReader.InvokeAsyncCall[T](SqlDataReaderBaseAsyncCallContext`1 context)
--- End of stack trace from previous location ---
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeResultSetAsync(Int32 startCommandIndex, RelationalDataReader reader, CancellationToken cancellationToken)
ClientConnectionId:c6e293e3-d63c-4780-9be3-165a51dd1438
Error Number:2601,State:1,Class:14
   --- End of inner exception stack trace ---
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeResultSetAsync(Int32 startCommandIndex, RelationalDataReader reader, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeAsync(RelationalDataReader reader, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Update.Internal.SqlServerModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(IList`1 entriesToSave, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(StateManager stateManager, Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Storage.Internal.SqlServerExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at NayifatAPI.Controllers.DeviceController.RegisterDevice(RegisterDeviceRequest request) in C:\Users\yamta\StudioProjects\nayifat_app_2025_new\nayifatapi\Controllers\DeviceController.cs:line 105
   at Microsoft.AspNetCore.Mvc.Infrastructure.ActionMethodExecutor.TaskOfIActionResultExecutor.Execute(ActionContext actionContext, IActionResultTypeMapper mapper, ObjectMethodExecutor executor, Object controller, Object[] arguments)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.<InvokeActionMethodAsync>g__Awaited|12_0(ControllerActionInvoker invoker, ValueTask`1 actionResultValueTask)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.<InvokeNextActionFilterAsync>g__Awaited|10_0(ControllerActionInvoker invoker, Task lastTask, State next, Scope scope, Object state, Boolean isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.Rethrow(ActionExecutedContextSealed context)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.Next(State& next, Scope& scope, Object& state, Boolean& isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.<InvokeInnerFilterAsync>g__Awaited|13_0(ControllerActionInvoker invoker, Task lastTask, State next, Scope scope, Object state, Boolean isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeFilterPipelineAsync>g__Awaited|20_0(ResourceInvoker invoker, Task lastTask, State next, Scope scope, Object state, Boolean isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeAsync>g__Logged|17_1(ResourceInvoker invoker)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeAsync>g__Logged|17_1(ResourceInvoker invoker)
   at Microsoft.AspNetCore.Routing.EndpointMiddleware.<Invoke>g__AwaitRequestTask|7_0(Endpoint endpoint, Task requestTask, ILogger logger)
   at Microsoft.AspNetCore.Authorization.AuthorizationMiddleware.Invoke(HttpContext context)
   at Program.<>c.<<<Main>$>b__0_3>d.MoveNext() in C:\Users\yamta\StudioProjects\nayifat_app_2025_new\nayifatapi\Program.cs:line 85
--- End of stack trace from previous location ---
   at Swashbuckle.AspNetCore.SwaggerUI.SwaggerUIMiddleware.Invoke(HttpContext httpContext)
   at Swashbuckle.AspNetCore.Swagger.SwaggerMiddleware.Invoke(HttpContext httpContext, ISwaggerProvider swaggerProvider)
   at Microsoft.AspNetCore.Authentication.AuthenticationMiddleware.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Diagnostics.DeveloperExceptionPageMiddlewareImpl.Invoke(HttpContext context)
2025-02-02 14:44:54.529 +03:00 [INF] Request finished HTTP/1.1 POST http://07ca-46-152-255-232.ngrok-free.app/api/device - 500 null text/plain; charset=utf-8 949.9851ms
2025-02-02 14:45:27.694 +03:00 [INF] Request starting HTTP/1.1 POST http://07ca-46-152-255-232.ngrok-free.app/api/notifications/list - application/json; charset=utf-8 47
2025-02-02 14:45:27.701 +03:00 [INF] Executing endpoint 'NayifatAPI.Controllers.NotificationsController.GetNotifications (NayifatAPI)'
2025-02-02 14:45:27.704 +03:00 [INF] Route matched with {action = "GetNotifications", controller = "Notifications"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetNotifications(NayifatAPI.Controllers.GetNotificationsRequest) on controller NayifatAPI.Controllers.NotificationsController (NayifatAPI).
2025-02-02 14:45:27.843 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@__providedApiKey_0='?' (Size = 255)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [a].[Key], [a].[CreatedAt], [a].[Description], [a].[ExpiresAt], [a].[IsActive], [a].[LastUsedAt]
FROM [ApiKeys] AS [a]
WHERE [a].[Key] = @__providedApiKey_0 AND [a].[IsActive] = CAST(1 AS bit)
2025-02-02 14:45:27.848 +03:00 [INF] Executed DbCommand (2ms) [Parameters=[@__request_NationalId_0='?' (Size = 450)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [u].[national_id], [u].[last_updated], [u].[notifications]
FROM [user_notifications] AS [u]
WHERE [u].[national_id] = @__request_NationalId_0
2025-02-02 14:45:27.854 +03:00 [INF] Executed DbCommand (2ms) [Parameters=[@__Parse_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [n].[Id], [n].[additional_data], [n].[Body], [n].[body_ar], [n].[body_en], [n].[created_at], [n].[expiry_at], [n].[Route], [n].[target_criteria], [n].[Title], [n].[title_ar], [n].[title_en]
FROM [notification_templates] AS [n]
WHERE [n].[Id] = @__Parse_0
2025-02-02 14:45:27.858 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@__Parse_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [n].[Id], [n].[additional_data], [n].[Body], [n].[body_ar], [n].[body_en], [n].[created_at], [n].[expiry_at], [n].[Route], [n].[target_criteria], [n].[Title], [n].[title_ar], [n].[title_en]
FROM [notification_templates] AS [n]
WHERE [n].[Id] = @__Parse_0
2025-02-02 14:45:27.938 +03:00 [INF] Executed DbCommand (76ms) [Parameters=[@p0='?' (Size = 4000), @p1='?' (DbType = DateTime2), @p2='?' (Size = 4000), @p3='?' (Size = 4000), @p4='?' (Size = 4000), @p5='?' (Size = 450), @p6='?' (Size = 4000), @p7='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SET IMPLICIT_TRANSACTIONS OFF;
SET NOCOUNT ON;
INSERT INTO [AuthLogs] ([AuthType], [CreatedAt], [DeviceId], [FailureReason], [IpAddress], [NationalId], [Status], [UserAgent])
OUTPUT INSERTED.[Id]
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7);
2025-02-02 14:45:27.941 +03:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType9`2[[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Object, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-02-02 14:45:27.943 +03:00 [INF] Executed action NayifatAPI.Controllers.NotificationsController.GetNotifications (NayifatAPI) in 235.9087ms
2025-02-02 14:45:27.945 +03:00 [INF] Executed endpoint 'NayifatAPI.Controllers.NotificationsController.GetNotifications (NayifatAPI)'
2025-02-02 14:45:27.946 +03:00 [INF] Request finished HTTP/1.1 POST http://07ca-46-152-255-232.ngrok-free.app/api/notifications/list - 200 null application/json; charset=utf-8 252.0122ms
2025-02-02 14:45:51.352 +03:00 [INF] Request starting HTTP/1.1 POST http://07ca-46-152-255-232.ngrok-free.app/api/auth/signin - application/json; charset=utf-8 78
2025-02-02 14:45:51.354 +03:00 [INF] Executing endpoint 'NayifatAPI.Controllers.AuthController.SignIn (NayifatAPI)'
2025-02-02 14:45:51.360 +03:00 [INF] Route matched with {action = "SignIn", controller = "Auth"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] SignIn(NayifatAPI.Controllers.SignInRequest) on controller NayifatAPI.Controllers.AuthController (NayifatAPI).
2025-02-02 14:45:51.375 +03:00 [INF] Executed DbCommand (3ms) [Parameters=[@__providedApiKey_0='?' (Size = 255)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [a].[Key], [a].[CreatedAt], [a].[Description], [a].[ExpiresAt], [a].[IsActive], [a].[LastUsedAt]
FROM [ApiKeys] AS [a]
WHERE [a].[Key] = @__providedApiKey_0 AND [a].[IsActive] = CAST(1 AS bit)
2025-02-02 14:45:51.389 +03:00 [INF] Executed DbCommand (3ms) [Parameters=[@__request_NationalId_0='?' (Size = 450)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [c].[NationalId], [c].[AddNo], [c].[BuildingNo], [c].[City], [c].[Consent], [c].[ConsentDate], [c].[DateOfBirth], [c].[Dependents], [c].[District], [c].[Email], [c].[Employer], [c].[FamilyNameAr], [c].[FamilyNameEn], [c].[FirstNameAr], [c].[FirstNameEn], [c].[Iban], [c].[IdExpiryDate], [c].[Los], [c].[Mpin], [c].[MpinEnabled], [c].[NafathStatus], [c].[NafathTimestamp], [c].[Password], [c].[Phone], [c].[RegistrationDate], [c].[SalaryCustomer], [c].[SalaryDakhli], [c].[SecondNameAr], [c].[SecondNameEn], [c].[Sector], [c].[Street], [c].[ThirdNameAr], [c].[ThirdNameEn], [c].[Zipcode]
FROM [Customers] AS [c]
WHERE [c].[NationalId] = @__request_NationalId_0
2025-02-02 14:45:51.393 +03:00 [INF] Starting password verification for NationalId: 1064448614
2025-02-02 14:45:51.899 +03:00 [INF] Password verification result for NationalId 1064448614: Success
2025-02-02 14:45:51.913 +03:00 [INF] Executed DbCommand (3ms) [Parameters=[@__request_NationalId_0='?' (Size = 450), @__request_DeviceId_1='?' (Size = 450)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [c].[Id], [c].[BiometricEnabled], [c].[BiometricToken], [c].[CreatedAt], [c].[DeviceId], [c].[LastUsedAt], [c].[Manufacturer], [c].[Model], [c].[NationalId], [c].[OsVersion], [c].[Platform], [c].[Status]
FROM [Customer_Devices] AS [c]
WHERE [c].[NationalId] = @__request_NationalId_0 AND [c].[DeviceId] = @__request_DeviceId_1 AND [c].[Status] = N'active'
2025-02-02 14:45:51.915 +03:00 [INF] Device not registered. Automatically registering device for NationalId: 1064448614
2025-02-02 14:45:51.994 +03:00 [INF] Executed DbCommand (76ms) [Parameters=[@__request_NationalId_0='?' (Size = 450)], CommandType='"Text"', CommandTimeout='30']
UPDATE [c]
SET [c].[LastUsedAt] = GETUTCDATE(),
    [c].[Status] = N'disabled'
FROM [Customer_Devices] AS [c]
WHERE [c].[NationalId] = @__request_NationalId_0
2025-02-02 14:45:52.007 +03:00 [INF] Executed DbCommand (8ms) [Parameters=[@p0='?' (Size = 4000), @p1='?' (DbType = DateTime2), @p2='?' (Size = 4000), @p3='?' (Size = 4000), @p4='?' (Size = 4000), @p5='?' (Size = 450), @p6='?' (Size = 4000), @p7='?' (Size = 4000), @p8='?' (DbType = Boolean), @p9='?' (Size = 4000), @p10='?' (DbType = DateTime2), @p11='?' (Size = 450), @p12='?' (DbType = DateTime2), @p13='?' (Size = 4000), @p14='?' (Size = 4000), @p15='?' (Size = 450), @p16='?' (Size = 4000), @p17='?' (Size = 4000), @p18='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SET NOCOUNT ON;
INSERT INTO [AuthLogs] ([AuthType], [CreatedAt], [DeviceId], [FailureReason], [IpAddress], [NationalId], [Status], [UserAgent])
OUTPUT INSERTED.[Id]
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7);
INSERT INTO [Customer_Devices] ([BiometricEnabled], [BiometricToken], [CreatedAt], [DeviceId], [LastUsedAt], [Manufacturer], [Model], [NationalId], [OsVersion], [Platform], [Status])
OUTPUT INSERTED.[Id]
VALUES (@p8, @p9, @p10, @p11, @p12, @p13, @p14, @p15, @p16, @p17, @p18);
2025-02-02 14:45:52.013 +03:00 [ERR] An exception occurred in the database while saving changes for context type 'NayifatAPI.Data.ApplicationDbContext'.
Microsoft.EntityFrameworkCore.DbUpdateException: An error occurred while saving the entity changes. See the inner exception for details.
 ---> Microsoft.Data.SqlClient.SqlException (0x80131904): Cannot insert duplicate key row in object 'dbo.Customer_Devices' with unique index 'IX_Customer_Devices_NationalId_DeviceId'. The duplicate key value is (1064448614, TP1A.220624.014).
   at Microsoft.Data.SqlClient.SqlConnection.OnError(SqlException exception, Boolean breakConnection, Action`1 wrapCloseInAction)
   at Microsoft.Data.SqlClient.SqlInternalConnection.OnError(SqlException exception, Boolean breakConnection, Action`1 wrapCloseInAction)
   at Microsoft.Data.SqlClient.TdsParser.ThrowExceptionAndWarning(TdsParserStateObject stateObj, Boolean callerHasConnectionLock, Boolean asyncClose)
   at Microsoft.Data.SqlClient.TdsParser.TryRun(RunBehavior runBehavior, SqlCommand cmdHandler, SqlDataReader dataStream, BulkCopySimpleResultSet bulkCopyHandler, TdsParserStateObject stateObj, Boolean& dataReady)
   at Microsoft.Data.SqlClient.SqlDataReader.TryHasMoreRows(Boolean& moreRows)
   at Microsoft.Data.SqlClient.SqlDataReader.TryReadInternal(Boolean setTimeout, Boolean& more)
   at Microsoft.Data.SqlClient.SqlDataReader.ReadAsyncExecute(Task task, Object state)
   at Microsoft.Data.SqlClient.SqlDataReader.InvokeAsyncCall[T](SqlDataReaderBaseAsyncCallContext`1 context)
--- End of stack trace from previous location ---
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeResultSetAsync(Int32 startCommandIndex, RelationalDataReader reader, CancellationToken cancellationToken)
ClientConnectionId:c6e293e3-d63c-4780-9be3-165a51dd1438
Error Number:2601,State:1,Class:14
   --- End of inner exception stack trace ---
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeResultSetAsync(Int32 startCommandIndex, RelationalDataReader reader, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeAsync(RelationalDataReader reader, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Update.Internal.SqlServerModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(IList`1 entriesToSave, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(StateManager stateManager, Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Storage.Internal.SqlServerExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
Microsoft.EntityFrameworkCore.DbUpdateException: An error occurred while saving the entity changes. See the inner exception for details.
 ---> Microsoft.Data.SqlClient.SqlException (0x80131904): Cannot insert duplicate key row in object 'dbo.Customer_Devices' with unique index 'IX_Customer_Devices_NationalId_DeviceId'. The duplicate key value is (1064448614, TP1A.220624.014).
   at Microsoft.Data.SqlClient.SqlConnection.OnError(SqlException exception, Boolean breakConnection, Action`1 wrapCloseInAction)
   at Microsoft.Data.SqlClient.SqlInternalConnection.OnError(SqlException exception, Boolean breakConnection, Action`1 wrapCloseInAction)
   at Microsoft.Data.SqlClient.TdsParser.ThrowExceptionAndWarning(TdsParserStateObject stateObj, Boolean callerHasConnectionLock, Boolean asyncClose)
   at Microsoft.Data.SqlClient.TdsParser.TryRun(RunBehavior runBehavior, SqlCommand cmdHandler, SqlDataReader dataStream, BulkCopySimpleResultSet bulkCopyHandler, TdsParserStateObject stateObj, Boolean& dataReady)
   at Microsoft.Data.SqlClient.SqlDataReader.TryHasMoreRows(Boolean& moreRows)
   at Microsoft.Data.SqlClient.SqlDataReader.TryReadInternal(Boolean setTimeout, Boolean& more)
   at Microsoft.Data.SqlClient.SqlDataReader.ReadAsyncExecute(Task task, Object state)
   at Microsoft.Data.SqlClient.SqlDataReader.InvokeAsyncCall[T](SqlDataReaderBaseAsyncCallContext`1 context)
--- End of stack trace from previous location ---
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeResultSetAsync(Int32 startCommandIndex, RelationalDataReader reader, CancellationToken cancellationToken)
ClientConnectionId:c6e293e3-d63c-4780-9be3-165a51dd1438
Error Number:2601,State:1,Class:14
   --- End of inner exception stack trace ---
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeResultSetAsync(Int32 startCommandIndex, RelationalDataReader reader, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeAsync(RelationalDataReader reader, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Update.Internal.SqlServerModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(IList`1 entriesToSave, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(StateManager stateManager, Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Storage.Internal.SqlServerExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
2025-02-02 14:45:52.026 +03:00 [ERR] Error during sign in for National ID: 1064448614
Microsoft.EntityFrameworkCore.DbUpdateException: An error occurred while saving the entity changes. See the inner exception for details.
 ---> Microsoft.Data.SqlClient.SqlException (0x80131904): Cannot insert duplicate key row in object 'dbo.Customer_Devices' with unique index 'IX_Customer_Devices_NationalId_DeviceId'. The duplicate key value is (1064448614, TP1A.220624.014).
   at Microsoft.Data.SqlClient.SqlConnection.OnError(SqlException exception, Boolean breakConnection, Action`1 wrapCloseInAction)
   at Microsoft.Data.SqlClient.SqlInternalConnection.OnError(SqlException exception, Boolean breakConnection, Action`1 wrapCloseInAction)
   at Microsoft.Data.SqlClient.TdsParser.ThrowExceptionAndWarning(TdsParserStateObject stateObj, Boolean callerHasConnectionLock, Boolean asyncClose)
   at Microsoft.Data.SqlClient.TdsParser.TryRun(RunBehavior runBehavior, SqlCommand cmdHandler, SqlDataReader dataStream, BulkCopySimpleResultSet bulkCopyHandler, TdsParserStateObject stateObj, Boolean& dataReady)
   at Microsoft.Data.SqlClient.SqlDataReader.TryHasMoreRows(Boolean& moreRows)
   at Microsoft.Data.SqlClient.SqlDataReader.TryReadInternal(Boolean setTimeout, Boolean& more)
   at Microsoft.Data.SqlClient.SqlDataReader.ReadAsyncExecute(Task task, Object state)
   at Microsoft.Data.SqlClient.SqlDataReader.InvokeAsyncCall[T](SqlDataReaderBaseAsyncCallContext`1 context)
--- End of stack trace from previous location ---
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeResultSetAsync(Int32 startCommandIndex, RelationalDataReader reader, CancellationToken cancellationToken)
ClientConnectionId:c6e293e3-d63c-4780-9be3-165a51dd1438
Error Number:2601,State:1,Class:14
   --- End of inner exception stack trace ---
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeResultSetAsync(Int32 startCommandIndex, RelationalDataReader reader, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeAsync(RelationalDataReader reader, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Update.Internal.SqlServerModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(IList`1 entriesToSave, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(StateManager stateManager, Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Storage.Internal.SqlServerExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at NayifatAPI.Controllers.AuthController.SignIn(SignInRequest request) in C:\Users\yamta\StudioProjects\nayifat_app_2025_new\nayifatapi\Controllers\AuthController.cs:line 117
2025-02-02 14:45:52.050 +03:00 [INF] Executed DbCommand (13ms) [Parameters=[@p0='?' (Size = 4000), @p1='?' (DbType = DateTime2), @p2='?' (Size = 4000), @p3='?' (Size = 4000), @p4='?' (Size = 4000), @p5='?' (Size = 450), @p6='?' (Size = 4000), @p7='?' (Size = 4000), @p8='?' (Size = 4000), @p9='?' (DbType = DateTime2), @p10='?' (Size = 4000), @p11='?' (Size = 4000), @p12='?' (Size = 4000), @p13='?' (Size = 450), @p14='?' (Size = 4000), @p15='?' (Size = 4000), @p16='?' (DbType = Boolean), @p17='?' (Size = 4000), @p18='?' (DbType = DateTime2), @p19='?' (Size = 450), @p20='?' (DbType = DateTime2), @p21='?' (Size = 4000), @p22='?' (Size = 4000), @p23='?' (Size = 450), @p24='?' (Size = 4000), @p25='?' (Size = 4000), @p26='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SET NOCOUNT ON;
MERGE [AuthLogs] USING (
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7, 0),
(@p8, @p9, @p10, @p11, @p12, @p13, @p14, @p15, 1)) AS i ([AuthType], [CreatedAt], [DeviceId], [FailureReason], [IpAddress], [NationalId], [Status], [UserAgent], _Position) ON 1=0
WHEN NOT MATCHED THEN
INSERT ([AuthType], [CreatedAt], [DeviceId], [FailureReason], [IpAddress], [NationalId], [Status], [UserAgent])
VALUES (i.[AuthType], i.[CreatedAt], i.[DeviceId], i.[FailureReason], i.[IpAddress], i.[NationalId], i.[Status], i.[UserAgent])
OUTPUT INSERTED.[Id], i._Position;
INSERT INTO [Customer_Devices] ([BiometricEnabled], [BiometricToken], [CreatedAt], [DeviceId], [LastUsedAt], [Manufacturer], [Model], [NationalId], [OsVersion], [Platform], [Status])
OUTPUT INSERTED.[Id]
VALUES (@p16, @p17, @p18, @p19, @p20, @p21, @p22, @p23, @p24, @p25, @p26);
2025-02-02 14:45:52.056 +03:00 [ERR] An exception occurred in the database while saving changes for context type 'NayifatAPI.Data.ApplicationDbContext'.
Microsoft.EntityFrameworkCore.DbUpdateException: An error occurred while saving the entity changes. See the inner exception for details.
 ---> Microsoft.Data.SqlClient.SqlException (0x80131904): Cannot insert duplicate key row in object 'dbo.Customer_Devices' with unique index 'IX_Customer_Devices_NationalId_DeviceId'. The duplicate key value is (1064448614, TP1A.220624.014).
   at Microsoft.Data.SqlClient.SqlConnection.OnError(SqlException exception, Boolean breakConnection, Action`1 wrapCloseInAction)
   at Microsoft.Data.SqlClient.SqlInternalConnection.OnError(SqlException exception, Boolean breakConnection, Action`1 wrapCloseInAction)
   at Microsoft.Data.SqlClient.TdsParser.ThrowExceptionAndWarning(TdsParserStateObject stateObj, Boolean callerHasConnectionLock, Boolean asyncClose)
   at Microsoft.Data.SqlClient.TdsParser.TryRun(RunBehavior runBehavior, SqlCommand cmdHandler, SqlDataReader dataStream, BulkCopySimpleResultSet bulkCopyHandler, TdsParserStateObject stateObj, Boolean& dataReady)
   at Microsoft.Data.SqlClient.SqlDataReader.TryHasMoreRows(Boolean& moreRows)
   at Microsoft.Data.SqlClient.SqlDataReader.TryReadInternal(Boolean setTimeout, Boolean& more)
   at Microsoft.Data.SqlClient.SqlDataReader.ReadAsyncExecute(Task task, Object state)
   at Microsoft.Data.SqlClient.SqlDataReader.InvokeAsyncCall[T](SqlDataReaderBaseAsyncCallContext`1 context)
--- End of stack trace from previous location ---
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeResultSetAsync(Int32 startCommandIndex, RelationalDataReader reader, CancellationToken cancellationToken)
ClientConnectionId:c6e293e3-d63c-4780-9be3-165a51dd1438
Error Number:2601,State:1,Class:14
   --- End of inner exception stack trace ---
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeResultSetAsync(Int32 startCommandIndex, RelationalDataReader reader, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeAsync(RelationalDataReader reader, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Update.Internal.SqlServerModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(IList`1 entriesToSave, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(StateManager stateManager, Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Storage.Internal.SqlServerExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
Microsoft.EntityFrameworkCore.DbUpdateException: An error occurred while saving the entity changes. See the inner exception for details.
 ---> Microsoft.Data.SqlClient.SqlException (0x80131904): Cannot insert duplicate key row in object 'dbo.Customer_Devices' with unique index 'IX_Customer_Devices_NationalId_DeviceId'. The duplicate key value is (1064448614, TP1A.220624.014).
   at Microsoft.Data.SqlClient.SqlConnection.OnError(SqlException exception, Boolean breakConnection, Action`1 wrapCloseInAction)
   at Microsoft.Data.SqlClient.SqlInternalConnection.OnError(SqlException exception, Boolean breakConnection, Action`1 wrapCloseInAction)
   at Microsoft.Data.SqlClient.TdsParser.ThrowExceptionAndWarning(TdsParserStateObject stateObj, Boolean callerHasConnectionLock, Boolean asyncClose)
   at Microsoft.Data.SqlClient.TdsParser.TryRun(RunBehavior runBehavior, SqlCommand cmdHandler, SqlDataReader dataStream, BulkCopySimpleResultSet bulkCopyHandler, TdsParserStateObject stateObj, Boolean& dataReady)
   at Microsoft.Data.SqlClient.SqlDataReader.TryHasMoreRows(Boolean& moreRows)
   at Microsoft.Data.SqlClient.SqlDataReader.TryReadInternal(Boolean setTimeout, Boolean& more)
   at Microsoft.Data.SqlClient.SqlDataReader.ReadAsyncExecute(Task task, Object state)
   at Microsoft.Data.SqlClient.SqlDataReader.InvokeAsyncCall[T](SqlDataReaderBaseAsyncCallContext`1 context)
--- End of stack trace from previous location ---
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeResultSetAsync(Int32 startCommandIndex, RelationalDataReader reader, CancellationToken cancellationToken)
ClientConnectionId:c6e293e3-d63c-4780-9be3-165a51dd1438
Error Number:2601,State:1,Class:14
   --- End of inner exception stack trace ---
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeResultSetAsync(Int32 startCommandIndex, RelationalDataReader reader, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeAsync(RelationalDataReader reader, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Update.Internal.SqlServerModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(IList`1 entriesToSave, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(StateManager stateManager, Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Storage.Internal.SqlServerExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
2025-02-02 14:45:52.074 +03:00 [INF] Executed action NayifatAPI.Controllers.AuthController.SignIn (NayifatAPI) in 712.9486ms
2025-02-02 14:45:52.076 +03:00 [INF] Executed endpoint 'NayifatAPI.Controllers.AuthController.SignIn (NayifatAPI)'
2025-02-02 14:45:52.077 +03:00 [ERR] Unhandled exception
Microsoft.EntityFrameworkCore.DbUpdateException: An error occurred while saving the entity changes. See the inner exception for details.
 ---> Microsoft.Data.SqlClient.SqlException (0x80131904): Cannot insert duplicate key row in object 'dbo.Customer_Devices' with unique index 'IX_Customer_Devices_NationalId_DeviceId'. The duplicate key value is (1064448614, TP1A.220624.014).
   at Microsoft.Data.SqlClient.SqlConnection.OnError(SqlException exception, Boolean breakConnection, Action`1 wrapCloseInAction)
   at Microsoft.Data.SqlClient.SqlInternalConnection.OnError(SqlException exception, Boolean breakConnection, Action`1 wrapCloseInAction)
   at Microsoft.Data.SqlClient.TdsParser.ThrowExceptionAndWarning(TdsParserStateObject stateObj, Boolean callerHasConnectionLock, Boolean asyncClose)
   at Microsoft.Data.SqlClient.TdsParser.TryRun(RunBehavior runBehavior, SqlCommand cmdHandler, SqlDataReader dataStream, BulkCopySimpleResultSet bulkCopyHandler, TdsParserStateObject stateObj, Boolean& dataReady)
   at Microsoft.Data.SqlClient.SqlDataReader.TryHasMoreRows(Boolean& moreRows)
   at Microsoft.Data.SqlClient.SqlDataReader.TryReadInternal(Boolean setTimeout, Boolean& more)
   at Microsoft.Data.SqlClient.SqlDataReader.ReadAsyncExecute(Task task, Object state)
   at Microsoft.Data.SqlClient.SqlDataReader.InvokeAsyncCall[T](SqlDataReaderBaseAsyncCallContext`1 context)
--- End of stack trace from previous location ---
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeResultSetAsync(Int32 startCommandIndex, RelationalDataReader reader, CancellationToken cancellationToken)
ClientConnectionId:c6e293e3-d63c-4780-9be3-165a51dd1438
Error Number:2601,State:1,Class:14
   --- End of inner exception stack trace ---
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeResultSetAsync(Int32 startCommandIndex, RelationalDataReader reader, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeAsync(RelationalDataReader reader, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Update.Internal.SqlServerModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(IList`1 entriesToSave, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(StateManager stateManager, Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Storage.Internal.SqlServerExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at NayifatAPI.Controllers.AuthController.LogAuthAttempt(String nationalId, String deviceId, String status, String failureReason) in C:\Users\yamta\StudioProjects\nayifat_app_2025_new\nayifatapi\Controllers\AuthController.cs:line 421
   at NayifatAPI.Controllers.AuthController.SignIn(SignInRequest request) in C:\Users\yamta\StudioProjects\nayifat_app_2025_new\nayifatapi\Controllers\AuthController.cs:line 157
   at Microsoft.AspNetCore.Mvc.Infrastructure.ActionMethodExecutor.TaskOfIActionResultExecutor.Execute(ActionContext actionContext, IActionResultTypeMapper mapper, ObjectMethodExecutor executor, Object controller, Object[] arguments)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.<InvokeActionMethodAsync>g__Awaited|12_0(ControllerActionInvoker invoker, ValueTask`1 actionResultValueTask)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.<InvokeNextActionFilterAsync>g__Awaited|10_0(ControllerActionInvoker invoker, Task lastTask, State next, Scope scope, Object state, Boolean isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.Rethrow(ActionExecutedContextSealed context)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.Next(State& next, Scope& scope, Object& state, Boolean& isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.<InvokeInnerFilterAsync>g__Awaited|13_0(ControllerActionInvoker invoker, Task lastTask, State next, Scope scope, Object state, Boolean isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeFilterPipelineAsync>g__Awaited|20_0(ResourceInvoker invoker, Task lastTask, State next, Scope scope, Object state, Boolean isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeAsync>g__Logged|17_1(ResourceInvoker invoker)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeAsync>g__Logged|17_1(ResourceInvoker invoker)
   at Microsoft.AspNetCore.Routing.EndpointMiddleware.<Invoke>g__AwaitRequestTask|7_0(Endpoint endpoint, Task requestTask, ILogger logger)
   at Microsoft.AspNetCore.Authorization.AuthorizationMiddleware.Invoke(HttpContext context)
   at Program.<>c.<<<Main>$>b__0_3>d.MoveNext() in C:\Users\yamta\StudioProjects\nayifat_app_2025_new\nayifatapi\Program.cs:line 85
2025-02-02 14:45:52.099 +03:00 [ERR] An unhandled exception has occurred while executing the request.
Microsoft.EntityFrameworkCore.DbUpdateException: An error occurred while saving the entity changes. See the inner exception for details.
 ---> Microsoft.Data.SqlClient.SqlException (0x80131904): Cannot insert duplicate key row in object 'dbo.Customer_Devices' with unique index 'IX_Customer_Devices_NationalId_DeviceId'. The duplicate key value is (1064448614, TP1A.220624.014).
   at Microsoft.Data.SqlClient.SqlConnection.OnError(SqlException exception, Boolean breakConnection, Action`1 wrapCloseInAction)
   at Microsoft.Data.SqlClient.SqlInternalConnection.OnError(SqlException exception, Boolean breakConnection, Action`1 wrapCloseInAction)
   at Microsoft.Data.SqlClient.TdsParser.ThrowExceptionAndWarning(TdsParserStateObject stateObj, Boolean callerHasConnectionLock, Boolean asyncClose)
   at Microsoft.Data.SqlClient.TdsParser.TryRun(RunBehavior runBehavior, SqlCommand cmdHandler, SqlDataReader dataStream, BulkCopySimpleResultSet bulkCopyHandler, TdsParserStateObject stateObj, Boolean& dataReady)
   at Microsoft.Data.SqlClient.SqlDataReader.TryHasMoreRows(Boolean& moreRows)
   at Microsoft.Data.SqlClient.SqlDataReader.TryReadInternal(Boolean setTimeout, Boolean& more)
   at Microsoft.Data.SqlClient.SqlDataReader.ReadAsyncExecute(Task task, Object state)
   at Microsoft.Data.SqlClient.SqlDataReader.InvokeAsyncCall[T](SqlDataReaderBaseAsyncCallContext`1 context)
--- End of stack trace from previous location ---
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeResultSetAsync(Int32 startCommandIndex, RelationalDataReader reader, CancellationToken cancellationToken)
ClientConnectionId:c6e293e3-d63c-4780-9be3-165a51dd1438
Error Number:2601,State:1,Class:14
   --- End of inner exception stack trace ---
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeResultSetAsync(Int32 startCommandIndex, RelationalDataReader reader, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeAsync(RelationalDataReader reader, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Update.Internal.SqlServerModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(IList`1 entriesToSave, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(StateManager stateManager, Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Storage.Internal.SqlServerExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at NayifatAPI.Controllers.AuthController.LogAuthAttempt(String nationalId, String deviceId, String status, String failureReason) in C:\Users\yamta\StudioProjects\nayifat_app_2025_new\nayifatapi\Controllers\AuthController.cs:line 421
   at NayifatAPI.Controllers.AuthController.SignIn(SignInRequest request) in C:\Users\yamta\StudioProjects\nayifat_app_2025_new\nayifatapi\Controllers\AuthController.cs:line 157
   at Microsoft.AspNetCore.Mvc.Infrastructure.ActionMethodExecutor.TaskOfIActionResultExecutor.Execute(ActionContext actionContext, IActionResultTypeMapper mapper, ObjectMethodExecutor executor, Object controller, Object[] arguments)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.<InvokeActionMethodAsync>g__Awaited|12_0(ControllerActionInvoker invoker, ValueTask`1 actionResultValueTask)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.<InvokeNextActionFilterAsync>g__Awaited|10_0(ControllerActionInvoker invoker, Task lastTask, State next, Scope scope, Object state, Boolean isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.Rethrow(ActionExecutedContextSealed context)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.Next(State& next, Scope& scope, Object& state, Boolean& isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.<InvokeInnerFilterAsync>g__Awaited|13_0(ControllerActionInvoker invoker, Task lastTask, State next, Scope scope, Object state, Boolean isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeFilterPipelineAsync>g__Awaited|20_0(ResourceInvoker invoker, Task lastTask, State next, Scope scope, Object state, Boolean isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeAsync>g__Logged|17_1(ResourceInvoker invoker)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeAsync>g__Logged|17_1(ResourceInvoker invoker)
   at Microsoft.AspNetCore.Routing.EndpointMiddleware.<Invoke>g__AwaitRequestTask|7_0(Endpoint endpoint, Task requestTask, ILogger logger)
   at Microsoft.AspNetCore.Authorization.AuthorizationMiddleware.Invoke(HttpContext context)
   at Program.<>c.<<<Main>$>b__0_3>d.MoveNext() in C:\Users\yamta\StudioProjects\nayifat_app_2025_new\nayifatapi\Program.cs:line 85
--- End of stack trace from previous location ---
   at Swashbuckle.AspNetCore.SwaggerUI.SwaggerUIMiddleware.Invoke(HttpContext httpContext)
   at Swashbuckle.AspNetCore.Swagger.SwaggerMiddleware.Invoke(HttpContext httpContext, ISwaggerProvider swaggerProvider)
   at Microsoft.AspNetCore.Authentication.AuthenticationMiddleware.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Diagnostics.DeveloperExceptionPageMiddlewareImpl.Invoke(HttpContext context)
2025-02-02 14:45:52.130 +03:00 [INF] Request finished HTTP/1.1 POST http://07ca-46-152-255-232.ngrok-free.app/api/auth/signin - 500 null text/plain; charset=utf-8 778.5958ms
2025-02-02 14:46:21.091 +03:00 [INF] Request starting HTTP/1.1 POST http://07ca-46-152-255-232.ngrok-free.app/api/auth/signin - application/json; charset=utf-8 78
2025-02-02 14:46:21.189 +03:00 [INF] Executing endpoint 'NayifatAPI.Controllers.AuthController.SignIn (NayifatAPI)'
2025-02-02 14:46:21.190 +03:00 [INF] Route matched with {action = "SignIn", controller = "Auth"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] SignIn(NayifatAPI.Controllers.SignInRequest) on controller NayifatAPI.Controllers.AuthController (NayifatAPI).
2025-02-02 14:46:21.208 +03:00 [INF] Executed DbCommand (13ms) [Parameters=[@__providedApiKey_0='?' (Size = 255)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [a].[Key], [a].[CreatedAt], [a].[Description], [a].[ExpiresAt], [a].[IsActive], [a].[LastUsedAt]
FROM [ApiKeys] AS [a]
WHERE [a].[Key] = @__providedApiKey_0 AND [a].[IsActive] = CAST(1 AS bit)
2025-02-02 14:46:21.495 +03:00 [INF] Executed DbCommand (4ms) [Parameters=[@__request_NationalId_0='?' (Size = 450)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [c].[NationalId], [c].[AddNo], [c].[BuildingNo], [c].[City], [c].[Consent], [c].[ConsentDate], [c].[DateOfBirth], [c].[Dependents], [c].[District], [c].[Email], [c].[Employer], [c].[FamilyNameAr], [c].[FamilyNameEn], [c].[FirstNameAr], [c].[FirstNameEn], [c].[Iban], [c].[IdExpiryDate], [c].[Los], [c].[Mpin], [c].[MpinEnabled], [c].[NafathStatus], [c].[NafathTimestamp], [c].[Password], [c].[Phone], [c].[RegistrationDate], [c].[SalaryCustomer], [c].[SalaryDakhli], [c].[SecondNameAr], [c].[SecondNameEn], [c].[Sector], [c].[Street], [c].[ThirdNameAr], [c].[ThirdNameEn], [c].[Zipcode]
FROM [Customers] AS [c]
WHERE [c].[NationalId] = @__request_NationalId_0
2025-02-02 14:46:21.561 +03:00 [INF] Starting password verification for NationalId: 1064448614
2025-02-02 14:46:22.082 +03:00 [INF] Password verification result for NationalId 1064448614: Success
2025-02-02 14:46:22.332 +03:00 [INF] Executed DbCommand (6ms) [Parameters=[@__request_NationalId_0='?' (Size = 450), @__request_DeviceId_1='?' (Size = 450)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [c].[Id], [c].[BiometricEnabled], [c].[BiometricToken], [c].[CreatedAt], [c].[DeviceId], [c].[LastUsedAt], [c].[Manufacturer], [c].[Model], [c].[NationalId], [c].[OsVersion], [c].[Platform], [c].[Status]
FROM [Customer_Devices] AS [c]
WHERE [c].[NationalId] = @__request_NationalId_0 AND [c].[DeviceId] = @__request_DeviceId_1 AND [c].[Status] = N'active'
2025-02-02 14:46:22.338 +03:00 [INF] Device not registered. Automatically registering device for NationalId: 1064448614
2025-02-02 14:46:22.438 +03:00 [INF] Executed DbCommand (98ms) [Parameters=[@__request_NationalId_0='?' (Size = 450)], CommandType='"Text"', CommandTimeout='30']
UPDATE [c]
SET [c].[LastUsedAt] = GETUTCDATE(),
    [c].[Status] = N'disabled'
FROM [Customer_Devices] AS [c]
WHERE [c].[NationalId] = @__request_NationalId_0
2025-02-02 14:46:22.493 +03:00 [INF] Executed DbCommand (10ms) [Parameters=[@p0='?' (Size = 4000), @p1='?' (DbType = DateTime2), @p2='?' (Size = 4000), @p3='?' (Size = 4000), @p4='?' (Size = 4000), @p5='?' (Size = 450), @p6='?' (Size = 4000), @p7='?' (Size = 4000), @p8='?' (DbType = Boolean), @p9='?' (Size = 4000), @p10='?' (DbType = DateTime2), @p11='?' (Size = 450), @p12='?' (DbType = DateTime2), @p13='?' (Size = 4000), @p14='?' (Size = 4000), @p15='?' (Size = 450), @p16='?' (Size = 4000), @p17='?' (Size = 4000), @p18='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SET NOCOUNT ON;
INSERT INTO [AuthLogs] ([AuthType], [CreatedAt], [DeviceId], [FailureReason], [IpAddress], [NationalId], [Status], [UserAgent])
OUTPUT INSERTED.[Id]
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7);
INSERT INTO [Customer_Devices] ([BiometricEnabled], [BiometricToken], [CreatedAt], [DeviceId], [LastUsedAt], [Manufacturer], [Model], [NationalId], [OsVersion], [Platform], [Status])
OUTPUT INSERTED.[Id]
VALUES (@p8, @p9, @p10, @p11, @p12, @p13, @p14, @p15, @p16, @p17, @p18);
2025-02-02 14:46:22.652 +03:00 [ERR] An exception occurred in the database while saving changes for context type 'NayifatAPI.Data.ApplicationDbContext'.
Microsoft.EntityFrameworkCore.DbUpdateException: An error occurred while saving the entity changes. See the inner exception for details.
 ---> Microsoft.Data.SqlClient.SqlException (0x80131904): Cannot insert duplicate key row in object 'dbo.Customer_Devices' with unique index 'IX_Customer_Devices_NationalId_DeviceId'. The duplicate key value is (1064448614, TP1A.220624.014).
   at Microsoft.Data.SqlClient.SqlConnection.OnError(SqlException exception, Boolean breakConnection, Action`1 wrapCloseInAction)
   at Microsoft.Data.SqlClient.SqlInternalConnection.OnError(SqlException exception, Boolean breakConnection, Action`1 wrapCloseInAction)
   at Microsoft.Data.SqlClient.TdsParser.ThrowExceptionAndWarning(TdsParserStateObject stateObj, Boolean callerHasConnectionLock, Boolean asyncClose)
   at Microsoft.Data.SqlClient.TdsParser.TryRun(RunBehavior runBehavior, SqlCommand cmdHandler, SqlDataReader dataStream, BulkCopySimpleResultSet bulkCopyHandler, TdsParserStateObject stateObj, Boolean& dataReady)
   at Microsoft.Data.SqlClient.SqlDataReader.TryHasMoreRows(Boolean& moreRows)
   at Microsoft.Data.SqlClient.SqlDataReader.TryReadInternal(Boolean setTimeout, Boolean& more)
   at Microsoft.Data.SqlClient.SqlDataReader.ReadAsyncExecute(Task task, Object state)
   at Microsoft.Data.SqlClient.SqlDataReader.InvokeAsyncCall[T](SqlDataReaderBaseAsyncCallContext`1 context)
--- End of stack trace from previous location ---
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeResultSetAsync(Int32 startCommandIndex, RelationalDataReader reader, CancellationToken cancellationToken)
ClientConnectionId:c6e293e3-d63c-4780-9be3-165a51dd1438
Error Number:2601,State:1,Class:14
   --- End of inner exception stack trace ---
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeResultSetAsync(Int32 startCommandIndex, RelationalDataReader reader, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeAsync(RelationalDataReader reader, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Update.Internal.SqlServerModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(IList`1 entriesToSave, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(StateManager stateManager, Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Storage.Internal.SqlServerExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
Microsoft.EntityFrameworkCore.DbUpdateException: An error occurred while saving the entity changes. See the inner exception for details.
 ---> Microsoft.Data.SqlClient.SqlException (0x80131904): Cannot insert duplicate key row in object 'dbo.Customer_Devices' with unique index 'IX_Customer_Devices_NationalId_DeviceId'. The duplicate key value is (1064448614, TP1A.220624.014).
   at Microsoft.Data.SqlClient.SqlConnection.OnError(SqlException exception, Boolean breakConnection, Action`1 wrapCloseInAction)
   at Microsoft.Data.SqlClient.SqlInternalConnection.OnError(SqlException exception, Boolean breakConnection, Action`1 wrapCloseInAction)
   at Microsoft.Data.SqlClient.TdsParser.ThrowExceptionAndWarning(TdsParserStateObject stateObj, Boolean callerHasConnectionLock, Boolean asyncClose)
   at Microsoft.Data.SqlClient.TdsParser.TryRun(RunBehavior runBehavior, SqlCommand cmdHandler, SqlDataReader dataStream, BulkCopySimpleResultSet bulkCopyHandler, TdsParserStateObject stateObj, Boolean& dataReady)
   at Microsoft.Data.SqlClient.SqlDataReader.TryHasMoreRows(Boolean& moreRows)
   at Microsoft.Data.SqlClient.SqlDataReader.TryReadInternal(Boolean setTimeout, Boolean& more)
   at Microsoft.Data.SqlClient.SqlDataReader.ReadAsyncExecute(Task task, Object state)
   at Microsoft.Data.SqlClient.SqlDataReader.InvokeAsyncCall[T](SqlDataReaderBaseAsyncCallContext`1 context)
--- End of stack trace from previous location ---
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeResultSetAsync(Int32 startCommandIndex, RelationalDataReader reader, CancellationToken cancellationToken)
ClientConnectionId:c6e293e3-d63c-4780-9be3-165a51dd1438
Error Number:2601,State:1,Class:14
   --- End of inner exception stack trace ---
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeResultSetAsync(Int32 startCommandIndex, RelationalDataReader reader, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeAsync(RelationalDataReader reader, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Update.Internal.SqlServerModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(IList`1 entriesToSave, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(StateManager stateManager, Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Storage.Internal.SqlServerExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
2025-02-02 14:46:23.310 +03:00 [ERR] Error during sign in for National ID: 1064448614
Microsoft.EntityFrameworkCore.DbUpdateException: An error occurred while saving the entity changes. See the inner exception for details.
 ---> Microsoft.Data.SqlClient.SqlException (0x80131904): Cannot insert duplicate key row in object 'dbo.Customer_Devices' with unique index 'IX_Customer_Devices_NationalId_DeviceId'. The duplicate key value is (1064448614, TP1A.220624.014).
   at Microsoft.Data.SqlClient.SqlConnection.OnError(SqlException exception, Boolean breakConnection, Action`1 wrapCloseInAction)
   at Microsoft.Data.SqlClient.SqlInternalConnection.OnError(SqlException exception, Boolean breakConnection, Action`1 wrapCloseInAction)
   at Microsoft.Data.SqlClient.TdsParser.ThrowExceptionAndWarning(TdsParserStateObject stateObj, Boolean callerHasConnectionLock, Boolean asyncClose)
   at Microsoft.Data.SqlClient.TdsParser.TryRun(RunBehavior runBehavior, SqlCommand cmdHandler, SqlDataReader dataStream, BulkCopySimpleResultSet bulkCopyHandler, TdsParserStateObject stateObj, Boolean& dataReady)
   at Microsoft.Data.SqlClient.SqlDataReader.TryHasMoreRows(Boolean& moreRows)
   at Microsoft.Data.SqlClient.SqlDataReader.TryReadInternal(Boolean setTimeout, Boolean& more)
   at Microsoft.Data.SqlClient.SqlDataReader.ReadAsyncExecute(Task task, Object state)
   at Microsoft.Data.SqlClient.SqlDataReader.InvokeAsyncCall[T](SqlDataReaderBaseAsyncCallContext`1 context)
--- End of stack trace from previous location ---
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeResultSetAsync(Int32 startCommandIndex, RelationalDataReader reader, CancellationToken cancellationToken)
ClientConnectionId:c6e293e3-d63c-4780-9be3-165a51dd1438
Error Number:2601,State:1,Class:14
   --- End of inner exception stack trace ---
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeResultSetAsync(Int32 startCommandIndex, RelationalDataReader reader, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeAsync(RelationalDataReader reader, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Update.Internal.SqlServerModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(IList`1 entriesToSave, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(StateManager stateManager, Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Storage.Internal.SqlServerExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at NayifatAPI.Controllers.AuthController.SignIn(SignInRequest request) in C:\Users\yamta\StudioProjects\nayifat_app_2025_new\nayifatapi\Controllers\AuthController.cs:line 117
2025-02-02 14:46:23.672 +03:00 [INF] Executed DbCommand (14ms) [Parameters=[@p0='?' (Size = 4000), @p1='?' (DbType = DateTime2), @p2='?' (Size = 4000), @p3='?' (Size = 4000), @p4='?' (Size = 4000), @p5='?' (Size = 450), @p6='?' (Size = 4000), @p7='?' (Size = 4000), @p8='?' (Size = 4000), @p9='?' (DbType = DateTime2), @p10='?' (Size = 4000), @p11='?' (Size = 4000), @p12='?' (Size = 4000), @p13='?' (Size = 450), @p14='?' (Size = 4000), @p15='?' (Size = 4000), @p16='?' (DbType = Boolean), @p17='?' (Size = 4000), @p18='?' (DbType = DateTime2), @p19='?' (Size = 450), @p20='?' (DbType = DateTime2), @p21='?' (Size = 4000), @p22='?' (Size = 4000), @p23='?' (Size = 450), @p24='?' (Size = 4000), @p25='?' (Size = 4000), @p26='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SET NOCOUNT ON;
MERGE [AuthLogs] USING (
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7, 0),
(@p8, @p9, @p10, @p11, @p12, @p13, @p14, @p15, 1)) AS i ([AuthType], [CreatedAt], [DeviceId], [FailureReason], [IpAddress], [NationalId], [Status], [UserAgent], _Position) ON 1=0
WHEN NOT MATCHED THEN
INSERT ([AuthType], [CreatedAt], [DeviceId], [FailureReason], [IpAddress], [NationalId], [Status], [UserAgent])
VALUES (i.[AuthType], i.[CreatedAt], i.[DeviceId], i.[FailureReason], i.[IpAddress], i.[NationalId], i.[Status], i.[UserAgent])
OUTPUT INSERTED.[Id], i._Position;
INSERT INTO [Customer_Devices] ([BiometricEnabled], [BiometricToken], [CreatedAt], [DeviceId], [LastUsedAt], [Manufacturer], [Model], [NationalId], [OsVersion], [Platform], [Status])
OUTPUT INSERTED.[Id]
VALUES (@p16, @p17, @p18, @p19, @p20, @p21, @p22, @p23, @p24, @p25, @p26);
2025-02-02 14:46:23.711 +03:00 [ERR] An exception occurred in the database while saving changes for context type 'NayifatAPI.Data.ApplicationDbContext'.
Microsoft.EntityFrameworkCore.DbUpdateException: An error occurred while saving the entity changes. See the inner exception for details.
 ---> Microsoft.Data.SqlClient.SqlException (0x80131904): Cannot insert duplicate key row in object 'dbo.Customer_Devices' with unique index 'IX_Customer_Devices_NationalId_DeviceId'. The duplicate key value is (1064448614, TP1A.220624.014).
   at Microsoft.Data.SqlClient.SqlConnection.OnError(SqlException exception, Boolean breakConnection, Action`1 wrapCloseInAction)
   at Microsoft.Data.SqlClient.SqlInternalConnection.OnError(SqlException exception, Boolean breakConnection, Action`1 wrapCloseInAction)
   at Microsoft.Data.SqlClient.TdsParser.ThrowExceptionAndWarning(TdsParserStateObject stateObj, Boolean callerHasConnectionLock, Boolean asyncClose)
   at Microsoft.Data.SqlClient.TdsParser.TryRun(RunBehavior runBehavior, SqlCommand cmdHandler, SqlDataReader dataStream, BulkCopySimpleResultSet bulkCopyHandler, TdsParserStateObject stateObj, Boolean& dataReady)
   at Microsoft.Data.SqlClient.SqlDataReader.TryHasMoreRows(Boolean& moreRows)
   at Microsoft.Data.SqlClient.SqlDataReader.TryReadInternal(Boolean setTimeout, Boolean& more)
   at Microsoft.Data.SqlClient.SqlDataReader.ReadAsyncExecute(Task task, Object state)
   at Microsoft.Data.SqlClient.SqlDataReader.InvokeAsyncCall[T](SqlDataReaderBaseAsyncCallContext`1 context)
--- End of stack trace from previous location ---
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeResultSetAsync(Int32 startCommandIndex, RelationalDataReader reader, CancellationToken cancellationToken)
ClientConnectionId:c6e293e3-d63c-4780-9be3-165a51dd1438
Error Number:2601,State:1,Class:14
   --- End of inner exception stack trace ---
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeResultSetAsync(Int32 startCommandIndex, RelationalDataReader reader, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeAsync(RelationalDataReader reader, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Update.Internal.SqlServerModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(IList`1 entriesToSave, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(StateManager stateManager, Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Storage.Internal.SqlServerExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
Microsoft.EntityFrameworkCore.DbUpdateException: An error occurred while saving the entity changes. See the inner exception for details.
 ---> Microsoft.Data.SqlClient.SqlException (0x80131904): Cannot insert duplicate key row in object 'dbo.Customer_Devices' with unique index 'IX_Customer_Devices_NationalId_DeviceId'. The duplicate key value is (1064448614, TP1A.220624.014).
   at Microsoft.Data.SqlClient.SqlConnection.OnError(SqlException exception, Boolean breakConnection, Action`1 wrapCloseInAction)
   at Microsoft.Data.SqlClient.SqlInternalConnection.OnError(SqlException exception, Boolean breakConnection, Action`1 wrapCloseInAction)
   at Microsoft.Data.SqlClient.TdsParser.ThrowExceptionAndWarning(TdsParserStateObject stateObj, Boolean callerHasConnectionLock, Boolean asyncClose)
   at Microsoft.Data.SqlClient.TdsParser.TryRun(RunBehavior runBehavior, SqlCommand cmdHandler, SqlDataReader dataStream, BulkCopySimpleResultSet bulkCopyHandler, TdsParserStateObject stateObj, Boolean& dataReady)
   at Microsoft.Data.SqlClient.SqlDataReader.TryHasMoreRows(Boolean& moreRows)
   at Microsoft.Data.SqlClient.SqlDataReader.TryReadInternal(Boolean setTimeout, Boolean& more)
   at Microsoft.Data.SqlClient.SqlDataReader.ReadAsyncExecute(Task task, Object state)
   at Microsoft.Data.SqlClient.SqlDataReader.InvokeAsyncCall[T](SqlDataReaderBaseAsyncCallContext`1 context)
--- End of stack trace from previous location ---
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeResultSetAsync(Int32 startCommandIndex, RelationalDataReader reader, CancellationToken cancellationToken)
ClientConnectionId:c6e293e3-d63c-4780-9be3-165a51dd1438
Error Number:2601,State:1,Class:14
   --- End of inner exception stack trace ---
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeResultSetAsync(Int32 startCommandIndex, RelationalDataReader reader, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeAsync(RelationalDataReader reader, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Update.Internal.SqlServerModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(IList`1 entriesToSave, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(StateManager stateManager, Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Storage.Internal.SqlServerExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
2025-02-02 14:46:23.727 +03:00 [INF] Executed action NayifatAPI.Controllers.AuthController.SignIn (NayifatAPI) in 2535.1054ms
2025-02-02 14:46:23.729 +03:00 [INF] Executed endpoint 'NayifatAPI.Controllers.AuthController.SignIn (NayifatAPI)'
2025-02-02 14:46:24.033 +03:00 [ERR] Unhandled exception
Microsoft.EntityFrameworkCore.DbUpdateException: An error occurred while saving the entity changes. See the inner exception for details.
 ---> Microsoft.Data.SqlClient.SqlException (0x80131904): Cannot insert duplicate key row in object 'dbo.Customer_Devices' with unique index 'IX_Customer_Devices_NationalId_DeviceId'. The duplicate key value is (1064448614, TP1A.220624.014).
   at Microsoft.Data.SqlClient.SqlConnection.OnError(SqlException exception, Boolean breakConnection, Action`1 wrapCloseInAction)
   at Microsoft.Data.SqlClient.SqlInternalConnection.OnError(SqlException exception, Boolean breakConnection, Action`1 wrapCloseInAction)
   at Microsoft.Data.SqlClient.TdsParser.ThrowExceptionAndWarning(TdsParserStateObject stateObj, Boolean callerHasConnectionLock, Boolean asyncClose)
   at Microsoft.Data.SqlClient.TdsParser.TryRun(RunBehavior runBehavior, SqlCommand cmdHandler, SqlDataReader dataStream, BulkCopySimpleResultSet bulkCopyHandler, TdsParserStateObject stateObj, Boolean& dataReady)
   at Microsoft.Data.SqlClient.SqlDataReader.TryHasMoreRows(Boolean& moreRows)
   at Microsoft.Data.SqlClient.SqlDataReader.TryReadInternal(Boolean setTimeout, Boolean& more)
   at Microsoft.Data.SqlClient.SqlDataReader.ReadAsyncExecute(Task task, Object state)
   at Microsoft.Data.SqlClient.SqlDataReader.InvokeAsyncCall[T](SqlDataReaderBaseAsyncCallContext`1 context)
--- End of stack trace from previous location ---
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeResultSetAsync(Int32 startCommandIndex, RelationalDataReader reader, CancellationToken cancellationToken)
ClientConnectionId:c6e293e3-d63c-4780-9be3-165a51dd1438
Error Number:2601,State:1,Class:14
   --- End of inner exception stack trace ---
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeResultSetAsync(Int32 startCommandIndex, RelationalDataReader reader, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeAsync(RelationalDataReader reader, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Update.Internal.SqlServerModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(IList`1 entriesToSave, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(StateManager stateManager, Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Storage.Internal.SqlServerExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at NayifatAPI.Controllers.AuthController.LogAuthAttempt(String nationalId, String deviceId, String status, String failureReason) in C:\Users\yamta\StudioProjects\nayifat_app_2025_new\nayifatapi\Controllers\AuthController.cs:line 421
   at NayifatAPI.Controllers.AuthController.SignIn(SignInRequest request) in C:\Users\yamta\StudioProjects\nayifat_app_2025_new\nayifatapi\Controllers\AuthController.cs:line 157
   at Microsoft.AspNetCore.Mvc.Infrastructure.ActionMethodExecutor.TaskOfIActionResultExecutor.Execute(ActionContext actionContext, IActionResultTypeMapper mapper, ObjectMethodExecutor executor, Object controller, Object[] arguments)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.<InvokeActionMethodAsync>g__Awaited|12_0(ControllerActionInvoker invoker, ValueTask`1 actionResultValueTask)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.<InvokeNextActionFilterAsync>g__Awaited|10_0(ControllerActionInvoker invoker, Task lastTask, State next, Scope scope, Object state, Boolean isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.Rethrow(ActionExecutedContextSealed context)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.Next(State& next, Scope& scope, Object& state, Boolean& isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.<InvokeInnerFilterAsync>g__Awaited|13_0(ControllerActionInvoker invoker, Task lastTask, State next, Scope scope, Object state, Boolean isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeFilterPipelineAsync>g__Awaited|20_0(ResourceInvoker invoker, Task lastTask, State next, Scope scope, Object state, Boolean isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeAsync>g__Logged|17_1(ResourceInvoker invoker)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeAsync>g__Logged|17_1(ResourceInvoker invoker)
   at Microsoft.AspNetCore.Routing.EndpointMiddleware.<Invoke>g__AwaitRequestTask|7_0(Endpoint endpoint, Task requestTask, ILogger logger)
   at Microsoft.AspNetCore.Authorization.AuthorizationMiddleware.Invoke(HttpContext context)
   at Program.<>c.<<<Main>$>b__0_3>d.MoveNext() in C:\Users\yamta\StudioProjects\nayifat_app_2025_new\nayifatapi\Program.cs:line 85
2025-02-02 14:46:24.140 +03:00 [ERR] An unhandled exception has occurred while executing the request.
Microsoft.EntityFrameworkCore.DbUpdateException: An error occurred while saving the entity changes. See the inner exception for details.
 ---> Microsoft.Data.SqlClient.SqlException (0x80131904): Cannot insert duplicate key row in object 'dbo.Customer_Devices' with unique index 'IX_Customer_Devices_NationalId_DeviceId'. The duplicate key value is (1064448614, TP1A.220624.014).
   at Microsoft.Data.SqlClient.SqlConnection.OnError(SqlException exception, Boolean breakConnection, Action`1 wrapCloseInAction)
   at Microsoft.Data.SqlClient.SqlInternalConnection.OnError(SqlException exception, Boolean breakConnection, Action`1 wrapCloseInAction)
   at Microsoft.Data.SqlClient.TdsParser.ThrowExceptionAndWarning(TdsParserStateObject stateObj, Boolean callerHasConnectionLock, Boolean asyncClose)
   at Microsoft.Data.SqlClient.TdsParser.TryRun(RunBehavior runBehavior, SqlCommand cmdHandler, SqlDataReader dataStream, BulkCopySimpleResultSet bulkCopyHandler, TdsParserStateObject stateObj, Boolean& dataReady)
   at Microsoft.Data.SqlClient.SqlDataReader.TryHasMoreRows(Boolean& moreRows)
   at Microsoft.Data.SqlClient.SqlDataReader.TryReadInternal(Boolean setTimeout, Boolean& more)
   at Microsoft.Data.SqlClient.SqlDataReader.ReadAsyncExecute(Task task, Object state)
   at Microsoft.Data.SqlClient.SqlDataReader.InvokeAsyncCall[T](SqlDataReaderBaseAsyncCallContext`1 context)
--- End of stack trace from previous location ---
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeResultSetAsync(Int32 startCommandIndex, RelationalDataReader reader, CancellationToken cancellationToken)
ClientConnectionId:c6e293e3-d63c-4780-9be3-165a51dd1438
Error Number:2601,State:1,Class:14
   --- End of inner exception stack trace ---
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeResultSetAsync(Int32 startCommandIndex, RelationalDataReader reader, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeAsync(RelationalDataReader reader, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Update.Internal.SqlServerModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(IList`1 entriesToSave, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(StateManager stateManager, Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Storage.Internal.SqlServerExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at NayifatAPI.Controllers.AuthController.LogAuthAttempt(String nationalId, String deviceId, String status, String failureReason) in C:\Users\yamta\StudioProjects\nayifat_app_2025_new\nayifatapi\Controllers\AuthController.cs:line 421
   at NayifatAPI.Controllers.AuthController.SignIn(SignInRequest request) in C:\Users\yamta\StudioProjects\nayifat_app_2025_new\nayifatapi\Controllers\AuthController.cs:line 157
   at Microsoft.AspNetCore.Mvc.Infrastructure.ActionMethodExecutor.TaskOfIActionResultExecutor.Execute(ActionContext actionContext, IActionResultTypeMapper mapper, ObjectMethodExecutor executor, Object controller, Object[] arguments)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.<InvokeActionMethodAsync>g__Awaited|12_0(ControllerActionInvoker invoker, ValueTask`1 actionResultValueTask)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.<InvokeNextActionFilterAsync>g__Awaited|10_0(ControllerActionInvoker invoker, Task lastTask, State next, Scope scope, Object state, Boolean isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.Rethrow(ActionExecutedContextSealed context)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.Next(State& next, Scope& scope, Object& state, Boolean& isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.<InvokeInnerFilterAsync>g__Awaited|13_0(ControllerActionInvoker invoker, Task lastTask, State next, Scope scope, Object state, Boolean isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeFilterPipelineAsync>g__Awaited|20_0(ResourceInvoker invoker, Task lastTask, State next, Scope scope, Object state, Boolean isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeAsync>g__Logged|17_1(ResourceInvoker invoker)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeAsync>g__Logged|17_1(ResourceInvoker invoker)
   at Microsoft.AspNetCore.Routing.EndpointMiddleware.<Invoke>g__AwaitRequestTask|7_0(Endpoint endpoint, Task requestTask, ILogger logger)
   at Microsoft.AspNetCore.Authorization.AuthorizationMiddleware.Invoke(HttpContext context)
   at Program.<>c.<<<Main>$>b__0_3>d.MoveNext() in C:\Users\yamta\StudioProjects\nayifat_app_2025_new\nayifatapi\Program.cs:line 85
--- End of stack trace from previous location ---
   at Swashbuckle.AspNetCore.SwaggerUI.SwaggerUIMiddleware.Invoke(HttpContext httpContext)
   at Swashbuckle.AspNetCore.Swagger.SwaggerMiddleware.Invoke(HttpContext httpContext, ISwaggerProvider swaggerProvider)
   at Microsoft.AspNetCore.Authentication.AuthenticationMiddleware.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Diagnostics.DeveloperExceptionPageMiddlewareImpl.Invoke(HttpContext context)
2025-02-02 14:46:24.168 +03:00 [INF] Request finished HTTP/1.1 POST http://07ca-46-152-255-232.ngrok-free.app/api/auth/signin - 500 null text/plain; charset=utf-8 3077.2932ms
2025-02-02 14:48:15.289 +03:00 [INF] Application is shutting down...
2025-02-02 14:48:26.432 +03:00 [INF] Starting web application
2025-02-02 14:48:26.563 +03:00 [INF] Now listening on: http://localhost:5264
2025-02-02 14:48:26.569 +03:00 [INF] Application started. Press Ctrl+C to shut down.
2025-02-02 14:48:26.570 +03:00 [INF] Hosting environment: Development
2025-02-02 14:48:26.571 +03:00 [INF] Content root path: C:\Users\yamta\StudioProjects\nayifat_app_2025_new\nayifatapi
2025-02-02 14:49:13.057 +03:00 [INF] Request starting HTTP/1.1 POST http://07ca-46-152-255-232.ngrok-free.app/api/auth/signin - application/json; charset=utf-8 78
2025-02-02 14:49:13.092 +03:00 [WRN] Failed to determine the https port for redirect.
2025-02-02 14:49:13.096 +03:00 [INF] Executing endpoint 'NayifatAPI.Controllers.AuthController.SignIn (NayifatAPI)'
2025-02-02 14:49:13.112 +03:00 [INF] Route matched with {action = "SignIn", controller = "Auth"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] SignIn(NayifatAPI.Controllers.SignInRequest) on controller NayifatAPI.Controllers.AuthController (NayifatAPI).
2025-02-02 14:49:14.542 +03:00 [INF] Executed DbCommand (37ms) [Parameters=[@__providedApiKey_0='?' (Size = 255)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [a].[Key], [a].[CreatedAt], [a].[Description], [a].[ExpiresAt], [a].[IsActive], [a].[LastUsedAt]
FROM [ApiKeys] AS [a]
WHERE [a].[Key] = @__providedApiKey_0 AND [a].[IsActive] = CAST(1 AS bit)
2025-02-02 14:49:14.660 +03:00 [INF] Executed DbCommand (16ms) [Parameters=[@__request_NationalId_0='?' (Size = 450)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [c].[NationalId], [c].[AddNo], [c].[BuildingNo], [c].[City], [c].[Consent], [c].[ConsentDate], [c].[DateOfBirth], [c].[Dependents], [c].[District], [c].[Email], [c].[Employer], [c].[FamilyNameAr], [c].[FamilyNameEn], [c].[FirstNameAr], [c].[FirstNameEn], [c].[Iban], [c].[IdExpiryDate], [c].[Los], [c].[Mpin], [c].[MpinEnabled], [c].[NafathStatus], [c].[NafathTimestamp], [c].[Password], [c].[Phone], [c].[RegistrationDate], [c].[SalaryCustomer], [c].[SalaryDakhli], [c].[SecondNameAr], [c].[SecondNameEn], [c].[Sector], [c].[Street], [c].[ThirdNameAr], [c].[ThirdNameEn], [c].[Zipcode]
FROM [Customers] AS [c]
WHERE [c].[NationalId] = @__request_NationalId_0
2025-02-02 14:49:14.748 +03:00 [INF] Starting password verification for NationalId: 1064448614
2025-02-02 14:49:15.235 +03:00 [INF] Password verification result for NationalId 1064448614: Success
2025-02-02 14:49:15.250 +03:00 [INF] Executed DbCommand (3ms) [Parameters=[@__request_NationalId_0='?' (Size = 450), @__request_DeviceId_1='?' (Size = 450)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [c].[Id], [c].[BiometricEnabled], [c].[BiometricToken], [c].[CreatedAt], [c].[DeviceId], [c].[LastUsedAt], [c].[Manufacturer], [c].[Model], [c].[NationalId], [c].[OsVersion], [c].[Platform], [c].[Status]
FROM [Customer_Devices] AS [c]
WHERE [c].[NationalId] = @__request_NationalId_0 AND [c].[DeviceId] = @__request_DeviceId_1 AND [c].[Status] = N'active'
2025-02-02 14:49:15.252 +03:00 [INF] Device not registered. Automatically registering device for NationalId: 1064448614
2025-02-02 14:49:15.345 +03:00 [INF] Executed DbCommand (83ms) [Parameters=[@p0='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
UPDATE Customer_Devices SET Status = 'disabled', LastUsedAt = GETUTCDATE() WHERE NationalId = @p0
2025-02-02 14:49:15.467 +03:00 [INF] Executed DbCommand (5ms) [Parameters=[@p0='?' (DbType = Boolean), @p1='?' (Size = 4000), @p2='?' (DbType = DateTime2), @p3='?' (Size = 450), @p4='?' (DbType = DateTime2), @p5='?' (Size = 4000), @p6='?' (Size = 4000), @p7='?' (Size = 450), @p8='?' (Size = 4000), @p9='?' (Size = 4000), @p10='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SET IMPLICIT_TRANSACTIONS OFF;
SET NOCOUNT ON;
INSERT INTO [Customer_Devices] ([BiometricEnabled], [BiometricToken], [CreatedAt], [DeviceId], [LastUsedAt], [Manufacturer], [Model], [NationalId], [OsVersion], [Platform], [Status])
OUTPUT INSERTED.[Id]
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7, @p8, @p9, @p10);
2025-02-02 14:49:15.491 +03:00 [ERR] An exception occurred in the database while saving changes for context type 'NayifatAPI.Data.ApplicationDbContext'.
Microsoft.EntityFrameworkCore.DbUpdateException: An error occurred while saving the entity changes. See the inner exception for details.
 ---> Microsoft.Data.SqlClient.SqlException (0x80131904): Cannot insert duplicate key row in object 'dbo.Customer_Devices' with unique index 'IX_Customer_Devices_NationalId_DeviceId'. The duplicate key value is (1064448614, TP1A.220624.014).
   at Microsoft.Data.SqlClient.SqlConnection.OnError(SqlException exception, Boolean breakConnection, Action`1 wrapCloseInAction)
   at Microsoft.Data.SqlClient.SqlInternalConnection.OnError(SqlException exception, Boolean breakConnection, Action`1 wrapCloseInAction)
   at Microsoft.Data.SqlClient.TdsParser.ThrowExceptionAndWarning(TdsParserStateObject stateObj, Boolean callerHasConnectionLock, Boolean asyncClose)
   at Microsoft.Data.SqlClient.TdsParser.TryRun(RunBehavior runBehavior, SqlCommand cmdHandler, SqlDataReader dataStream, BulkCopySimpleResultSet bulkCopyHandler, TdsParserStateObject stateObj, Boolean& dataReady)
   at Microsoft.Data.SqlClient.SqlDataReader.TryHasMoreRows(Boolean& moreRows)
   at Microsoft.Data.SqlClient.SqlDataReader.TryReadInternal(Boolean setTimeout, Boolean& more)
   at Microsoft.Data.SqlClient.SqlDataReader.ReadAsyncExecute(Task task, Object state)
   at Microsoft.Data.SqlClient.SqlDataReader.InvokeAsyncCall[T](SqlDataReaderBaseAsyncCallContext`1 context)
--- End of stack trace from previous location ---
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeResultSetAsync(Int32 startCommandIndex, RelationalDataReader reader, CancellationToken cancellationToken)
ClientConnectionId:bfa36a07-439d-496e-9669-532b3de955fc
Error Number:2601,State:1,Class:14
   --- End of inner exception stack trace ---
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeResultSetAsync(Int32 startCommandIndex, RelationalDataReader reader, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeAsync(RelationalDataReader reader, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Update.Internal.SqlServerModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(IList`1 entriesToSave, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(StateManager stateManager, Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Storage.Internal.SqlServerExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
Microsoft.EntityFrameworkCore.DbUpdateException: An error occurred while saving the entity changes. See the inner exception for details.
 ---> Microsoft.Data.SqlClient.SqlException (0x80131904): Cannot insert duplicate key row in object 'dbo.Customer_Devices' with unique index 'IX_Customer_Devices_NationalId_DeviceId'. The duplicate key value is (1064448614, TP1A.220624.014).
   at Microsoft.Data.SqlClient.SqlConnection.OnError(SqlException exception, Boolean breakConnection, Action`1 wrapCloseInAction)
   at Microsoft.Data.SqlClient.SqlInternalConnection.OnError(SqlException exception, Boolean breakConnection, Action`1 wrapCloseInAction)
   at Microsoft.Data.SqlClient.TdsParser.ThrowExceptionAndWarning(TdsParserStateObject stateObj, Boolean callerHasConnectionLock, Boolean asyncClose)
   at Microsoft.Data.SqlClient.TdsParser.TryRun(RunBehavior runBehavior, SqlCommand cmdHandler, SqlDataReader dataStream, BulkCopySimpleResultSet bulkCopyHandler, TdsParserStateObject stateObj, Boolean& dataReady)
   at Microsoft.Data.SqlClient.SqlDataReader.TryHasMoreRows(Boolean& moreRows)
   at Microsoft.Data.SqlClient.SqlDataReader.TryReadInternal(Boolean setTimeout, Boolean& more)
   at Microsoft.Data.SqlClient.SqlDataReader.ReadAsyncExecute(Task task, Object state)
   at Microsoft.Data.SqlClient.SqlDataReader.InvokeAsyncCall[T](SqlDataReaderBaseAsyncCallContext`1 context)
--- End of stack trace from previous location ---
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeResultSetAsync(Int32 startCommandIndex, RelationalDataReader reader, CancellationToken cancellationToken)
ClientConnectionId:bfa36a07-439d-496e-9669-532b3de955fc
Error Number:2601,State:1,Class:14
   --- End of inner exception stack trace ---
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeResultSetAsync(Int32 startCommandIndex, RelationalDataReader reader, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeAsync(RelationalDataReader reader, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Update.Internal.SqlServerModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(IList`1 entriesToSave, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(StateManager stateManager, Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Storage.Internal.SqlServerExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
2025-02-02 14:49:15.502 +03:00 [ERR] Error during device registration for NationalId: 1064448614
Microsoft.EntityFrameworkCore.DbUpdateException: An error occurred while saving the entity changes. See the inner exception for details.
 ---> Microsoft.Data.SqlClient.SqlException (0x80131904): Cannot insert duplicate key row in object 'dbo.Customer_Devices' with unique index 'IX_Customer_Devices_NationalId_DeviceId'. The duplicate key value is (1064448614, TP1A.220624.014).
   at Microsoft.Data.SqlClient.SqlConnection.OnError(SqlException exception, Boolean breakConnection, Action`1 wrapCloseInAction)
   at Microsoft.Data.SqlClient.SqlInternalConnection.OnError(SqlException exception, Boolean breakConnection, Action`1 wrapCloseInAction)
   at Microsoft.Data.SqlClient.TdsParser.ThrowExceptionAndWarning(TdsParserStateObject stateObj, Boolean callerHasConnectionLock, Boolean asyncClose)
   at Microsoft.Data.SqlClient.TdsParser.TryRun(RunBehavior runBehavior, SqlCommand cmdHandler, SqlDataReader dataStream, BulkCopySimpleResultSet bulkCopyHandler, TdsParserStateObject stateObj, Boolean& dataReady)
   at Microsoft.Data.SqlClient.SqlDataReader.TryHasMoreRows(Boolean& moreRows)
   at Microsoft.Data.SqlClient.SqlDataReader.TryReadInternal(Boolean setTimeout, Boolean& more)
   at Microsoft.Data.SqlClient.SqlDataReader.ReadAsyncExecute(Task task, Object state)
   at Microsoft.Data.SqlClient.SqlDataReader.InvokeAsyncCall[T](SqlDataReaderBaseAsyncCallContext`1 context)
--- End of stack trace from previous location ---
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeResultSetAsync(Int32 startCommandIndex, RelationalDataReader reader, CancellationToken cancellationToken)
ClientConnectionId:bfa36a07-439d-496e-9669-532b3de955fc
Error Number:2601,State:1,Class:14
   --- End of inner exception stack trace ---
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeResultSetAsync(Int32 startCommandIndex, RelationalDataReader reader, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeAsync(RelationalDataReader reader, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Update.Internal.SqlServerModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(IList`1 entriesToSave, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(StateManager stateManager, Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Storage.Internal.SqlServerExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at NayifatAPI.Controllers.AuthController.SignIn(SignInRequest request) in C:\Users\yamta\StudioProjects\nayifat_app_2025_new\nayifatapi\Controllers\AuthController.cs:line 107
2025-02-02 14:49:15.516 +03:00 [ERR] Error during sign in for National ID: 1064448614
Microsoft.EntityFrameworkCore.DbUpdateException: An error occurred while saving the entity changes. See the inner exception for details.
 ---> Microsoft.Data.SqlClient.SqlException (0x80131904): Cannot insert duplicate key row in object 'dbo.Customer_Devices' with unique index 'IX_Customer_Devices_NationalId_DeviceId'. The duplicate key value is (1064448614, TP1A.220624.014).
   at Microsoft.Data.SqlClient.SqlConnection.OnError(SqlException exception, Boolean breakConnection, Action`1 wrapCloseInAction)
   at Microsoft.Data.SqlClient.SqlInternalConnection.OnError(SqlException exception, Boolean breakConnection, Action`1 wrapCloseInAction)
   at Microsoft.Data.SqlClient.TdsParser.ThrowExceptionAndWarning(TdsParserStateObject stateObj, Boolean callerHasConnectionLock, Boolean asyncClose)
   at Microsoft.Data.SqlClient.TdsParser.TryRun(RunBehavior runBehavior, SqlCommand cmdHandler, SqlDataReader dataStream, BulkCopySimpleResultSet bulkCopyHandler, TdsParserStateObject stateObj, Boolean& dataReady)
   at Microsoft.Data.SqlClient.SqlDataReader.TryHasMoreRows(Boolean& moreRows)
   at Microsoft.Data.SqlClient.SqlDataReader.TryReadInternal(Boolean setTimeout, Boolean& more)
   at Microsoft.Data.SqlClient.SqlDataReader.ReadAsyncExecute(Task task, Object state)
   at Microsoft.Data.SqlClient.SqlDataReader.InvokeAsyncCall[T](SqlDataReaderBaseAsyncCallContext`1 context)
--- End of stack trace from previous location ---
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeResultSetAsync(Int32 startCommandIndex, RelationalDataReader reader, CancellationToken cancellationToken)
ClientConnectionId:bfa36a07-439d-496e-9669-532b3de955fc
Error Number:2601,State:1,Class:14
   --- End of inner exception stack trace ---
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeResultSetAsync(Int32 startCommandIndex, RelationalDataReader reader, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeAsync(RelationalDataReader reader, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Update.Internal.SqlServerModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(IList`1 entriesToSave, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(StateManager stateManager, Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Storage.Internal.SqlServerExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at NayifatAPI.Controllers.AuthController.SignIn(SignInRequest request) in C:\Users\yamta\StudioProjects\nayifat_app_2025_new\nayifatapi\Controllers\AuthController.cs:line 107
2025-02-02 14:49:15.583 +03:00 [INF] Executed DbCommand (6ms) [Parameters=[@p0='?' (Size = 4000), @p1='?' (DbType = DateTime2), @p2='?' (Size = 4000), @p3='?' (Size = 4000), @p4='?' (Size = 4000), @p5='?' (Size = 450), @p6='?' (Size = 4000), @p7='?' (Size = 4000), @p8='?' (DbType = Boolean), @p9='?' (Size = 4000), @p10='?' (DbType = DateTime2), @p11='?' (Size = 450), @p12='?' (DbType = DateTime2), @p13='?' (Size = 4000), @p14='?' (Size = 4000), @p15='?' (Size = 450), @p16='?' (Size = 4000), @p17='?' (Size = 4000), @p18='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SET NOCOUNT ON;
INSERT INTO [AuthLogs] ([AuthType], [CreatedAt], [DeviceId], [FailureReason], [IpAddress], [NationalId], [Status], [UserAgent])
OUTPUT INSERTED.[Id]
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7);
INSERT INTO [Customer_Devices] ([BiometricEnabled], [BiometricToken], [CreatedAt], [DeviceId], [LastUsedAt], [Manufacturer], [Model], [NationalId], [OsVersion], [Platform], [Status])
OUTPUT INSERTED.[Id]
VALUES (@p8, @p9, @p10, @p11, @p12, @p13, @p14, @p15, @p16, @p17, @p18);
2025-02-02 14:49:15.598 +03:00 [ERR] An exception occurred in the database while saving changes for context type 'NayifatAPI.Data.ApplicationDbContext'.
Microsoft.EntityFrameworkCore.DbUpdateException: An error occurred while saving the entity changes. See the inner exception for details.
 ---> Microsoft.Data.SqlClient.SqlException (0x80131904): Cannot insert duplicate key row in object 'dbo.Customer_Devices' with unique index 'IX_Customer_Devices_NationalId_DeviceId'. The duplicate key value is (1064448614, TP1A.220624.014).
   at Microsoft.Data.SqlClient.SqlConnection.OnError(SqlException exception, Boolean breakConnection, Action`1 wrapCloseInAction)
   at Microsoft.Data.SqlClient.SqlInternalConnection.OnError(SqlException exception, Boolean breakConnection, Action`1 wrapCloseInAction)
   at Microsoft.Data.SqlClient.TdsParser.ThrowExceptionAndWarning(TdsParserStateObject stateObj, Boolean callerHasConnectionLock, Boolean asyncClose)
   at Microsoft.Data.SqlClient.TdsParser.TryRun(RunBehavior runBehavior, SqlCommand cmdHandler, SqlDataReader dataStream, BulkCopySimpleResultSet bulkCopyHandler, TdsParserStateObject stateObj, Boolean& dataReady)
   at Microsoft.Data.SqlClient.SqlDataReader.TryHasMoreRows(Boolean& moreRows)
   at Microsoft.Data.SqlClient.SqlDataReader.TryReadInternal(Boolean setTimeout, Boolean& more)
   at Microsoft.Data.SqlClient.SqlDataReader.ReadAsyncExecute(Task task, Object state)
   at Microsoft.Data.SqlClient.SqlDataReader.InvokeAsyncCall[T](SqlDataReaderBaseAsyncCallContext`1 context)
--- End of stack trace from previous location ---
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeResultSetAsync(Int32 startCommandIndex, RelationalDataReader reader, CancellationToken cancellationToken)
ClientConnectionId:bfa36a07-439d-496e-9669-532b3de955fc
Error Number:2601,State:1,Class:14
   --- End of inner exception stack trace ---
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeResultSetAsync(Int32 startCommandIndex, RelationalDataReader reader, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeAsync(RelationalDataReader reader, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Update.Internal.SqlServerModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(IList`1 entriesToSave, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(StateManager stateManager, Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Storage.Internal.SqlServerExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
Microsoft.EntityFrameworkCore.DbUpdateException: An error occurred while saving the entity changes. See the inner exception for details.
 ---> Microsoft.Data.SqlClient.SqlException (0x80131904): Cannot insert duplicate key row in object 'dbo.Customer_Devices' with unique index 'IX_Customer_Devices_NationalId_DeviceId'. The duplicate key value is (1064448614, TP1A.220624.014).
   at Microsoft.Data.SqlClient.SqlConnection.OnError(SqlException exception, Boolean breakConnection, Action`1 wrapCloseInAction)
   at Microsoft.Data.SqlClient.SqlInternalConnection.OnError(SqlException exception, Boolean breakConnection, Action`1 wrapCloseInAction)
   at Microsoft.Data.SqlClient.TdsParser.ThrowExceptionAndWarning(TdsParserStateObject stateObj, Boolean callerHasConnectionLock, Boolean asyncClose)
   at Microsoft.Data.SqlClient.TdsParser.TryRun(RunBehavior runBehavior, SqlCommand cmdHandler, SqlDataReader dataStream, BulkCopySimpleResultSet bulkCopyHandler, TdsParserStateObject stateObj, Boolean& dataReady)
   at Microsoft.Data.SqlClient.SqlDataReader.TryHasMoreRows(Boolean& moreRows)
   at Microsoft.Data.SqlClient.SqlDataReader.TryReadInternal(Boolean setTimeout, Boolean& more)
   at Microsoft.Data.SqlClient.SqlDataReader.ReadAsyncExecute(Task task, Object state)
   at Microsoft.Data.SqlClient.SqlDataReader.InvokeAsyncCall[T](SqlDataReaderBaseAsyncCallContext`1 context)
--- End of stack trace from previous location ---
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeResultSetAsync(Int32 startCommandIndex, RelationalDataReader reader, CancellationToken cancellationToken)
ClientConnectionId:bfa36a07-439d-496e-9669-532b3de955fc
Error Number:2601,State:1,Class:14
   --- End of inner exception stack trace ---
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeResultSetAsync(Int32 startCommandIndex, RelationalDataReader reader, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeAsync(RelationalDataReader reader, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Update.Internal.SqlServerModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(IList`1 entriesToSave, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(StateManager stateManager, Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Storage.Internal.SqlServerExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
2025-02-02 14:49:15.613 +03:00 [INF] Executed action NayifatAPI.Controllers.AuthController.SignIn (NayifatAPI) in 2495.3679ms
2025-02-02 14:49:15.615 +03:00 [INF] Executed endpoint 'NayifatAPI.Controllers.AuthController.SignIn (NayifatAPI)'
2025-02-02 14:49:15.616 +03:00 [ERR] Unhandled exception
Microsoft.EntityFrameworkCore.DbUpdateException: An error occurred while saving the entity changes. See the inner exception for details.
 ---> Microsoft.Data.SqlClient.SqlException (0x80131904): Cannot insert duplicate key row in object 'dbo.Customer_Devices' with unique index 'IX_Customer_Devices_NationalId_DeviceId'. The duplicate key value is (1064448614, TP1A.220624.014).
   at Microsoft.Data.SqlClient.SqlConnection.OnError(SqlException exception, Boolean breakConnection, Action`1 wrapCloseInAction)
   at Microsoft.Data.SqlClient.SqlInternalConnection.OnError(SqlException exception, Boolean breakConnection, Action`1 wrapCloseInAction)
   at Microsoft.Data.SqlClient.TdsParser.ThrowExceptionAndWarning(TdsParserStateObject stateObj, Boolean callerHasConnectionLock, Boolean asyncClose)
   at Microsoft.Data.SqlClient.TdsParser.TryRun(RunBehavior runBehavior, SqlCommand cmdHandler, SqlDataReader dataStream, BulkCopySimpleResultSet bulkCopyHandler, TdsParserStateObject stateObj, Boolean& dataReady)
   at Microsoft.Data.SqlClient.SqlDataReader.TryHasMoreRows(Boolean& moreRows)
   at Microsoft.Data.SqlClient.SqlDataReader.TryReadInternal(Boolean setTimeout, Boolean& more)
   at Microsoft.Data.SqlClient.SqlDataReader.ReadAsyncExecute(Task task, Object state)
   at Microsoft.Data.SqlClient.SqlDataReader.InvokeAsyncCall[T](SqlDataReaderBaseAsyncCallContext`1 context)
--- End of stack trace from previous location ---
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeResultSetAsync(Int32 startCommandIndex, RelationalDataReader reader, CancellationToken cancellationToken)
ClientConnectionId:bfa36a07-439d-496e-9669-532b3de955fc
Error Number:2601,State:1,Class:14
   --- End of inner exception stack trace ---
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeResultSetAsync(Int32 startCommandIndex, RelationalDataReader reader, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeAsync(RelationalDataReader reader, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Update.Internal.SqlServerModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(IList`1 entriesToSave, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(StateManager stateManager, Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Storage.Internal.SqlServerExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at NayifatAPI.Controllers.AuthController.LogAuthAttempt(String nationalId, String deviceId, String status, String failureReason) in C:\Users\yamta\StudioProjects\nayifat_app_2025_new\nayifatapi\Controllers\AuthController.cs:line 432
   at NayifatAPI.Controllers.AuthController.SignIn(SignInRequest request) in C:\Users\yamta\StudioProjects\nayifat_app_2025_new\nayifatapi\Controllers\AuthController.cs:line 168
   at Microsoft.AspNetCore.Mvc.Infrastructure.ActionMethodExecutor.TaskOfIActionResultExecutor.Execute(ActionContext actionContext, IActionResultTypeMapper mapper, ObjectMethodExecutor executor, Object controller, Object[] arguments)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.<InvokeActionMethodAsync>g__Awaited|12_0(ControllerActionInvoker invoker, ValueTask`1 actionResultValueTask)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.<InvokeNextActionFilterAsync>g__Awaited|10_0(ControllerActionInvoker invoker, Task lastTask, State next, Scope scope, Object state, Boolean isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.Rethrow(ActionExecutedContextSealed context)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.Next(State& next, Scope& scope, Object& state, Boolean& isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.<InvokeInnerFilterAsync>g__Awaited|13_0(ControllerActionInvoker invoker, Task lastTask, State next, Scope scope, Object state, Boolean isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeFilterPipelineAsync>g__Awaited|20_0(ResourceInvoker invoker, Task lastTask, State next, Scope scope, Object state, Boolean isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeAsync>g__Logged|17_1(ResourceInvoker invoker)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeAsync>g__Logged|17_1(ResourceInvoker invoker)
   at Microsoft.AspNetCore.Routing.EndpointMiddleware.<Invoke>g__AwaitRequestTask|7_0(Endpoint endpoint, Task requestTask, ILogger logger)
   at Microsoft.AspNetCore.Authorization.AuthorizationMiddleware.Invoke(HttpContext context)
   at Program.<>c.<<<Main>$>b__0_3>d.MoveNext() in C:\Users\yamta\StudioProjects\nayifat_app_2025_new\nayifatapi\Program.cs:line 85
2025-02-02 14:49:15.639 +03:00 [ERR] An unhandled exception has occurred while executing the request.
Microsoft.EntityFrameworkCore.DbUpdateException: An error occurred while saving the entity changes. See the inner exception for details.
 ---> Microsoft.Data.SqlClient.SqlException (0x80131904): Cannot insert duplicate key row in object 'dbo.Customer_Devices' with unique index 'IX_Customer_Devices_NationalId_DeviceId'. The duplicate key value is (1064448614, TP1A.220624.014).
   at Microsoft.Data.SqlClient.SqlConnection.OnError(SqlException exception, Boolean breakConnection, Action`1 wrapCloseInAction)
   at Microsoft.Data.SqlClient.SqlInternalConnection.OnError(SqlException exception, Boolean breakConnection, Action`1 wrapCloseInAction)
   at Microsoft.Data.SqlClient.TdsParser.ThrowExceptionAndWarning(TdsParserStateObject stateObj, Boolean callerHasConnectionLock, Boolean asyncClose)
   at Microsoft.Data.SqlClient.TdsParser.TryRun(RunBehavior runBehavior, SqlCommand cmdHandler, SqlDataReader dataStream, BulkCopySimpleResultSet bulkCopyHandler, TdsParserStateObject stateObj, Boolean& dataReady)
   at Microsoft.Data.SqlClient.SqlDataReader.TryHasMoreRows(Boolean& moreRows)
   at Microsoft.Data.SqlClient.SqlDataReader.TryReadInternal(Boolean setTimeout, Boolean& more)
   at Microsoft.Data.SqlClient.SqlDataReader.ReadAsyncExecute(Task task, Object state)
   at Microsoft.Data.SqlClient.SqlDataReader.InvokeAsyncCall[T](SqlDataReaderBaseAsyncCallContext`1 context)
--- End of stack trace from previous location ---
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeResultSetAsync(Int32 startCommandIndex, RelationalDataReader reader, CancellationToken cancellationToken)
ClientConnectionId:bfa36a07-439d-496e-9669-532b3de955fc
Error Number:2601,State:1,Class:14
   --- End of inner exception stack trace ---
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeResultSetAsync(Int32 startCommandIndex, RelationalDataReader reader, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeAsync(RelationalDataReader reader, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Update.Internal.SqlServerModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(IList`1 entriesToSave, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(StateManager stateManager, Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Storage.Internal.SqlServerExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at NayifatAPI.Controllers.AuthController.LogAuthAttempt(String nationalId, String deviceId, String status, String failureReason) in C:\Users\yamta\StudioProjects\nayifat_app_2025_new\nayifatapi\Controllers\AuthController.cs:line 432
   at NayifatAPI.Controllers.AuthController.SignIn(SignInRequest request) in C:\Users\yamta\StudioProjects\nayifat_app_2025_new\nayifatapi\Controllers\AuthController.cs:line 168
   at Microsoft.AspNetCore.Mvc.Infrastructure.ActionMethodExecutor.TaskOfIActionResultExecutor.Execute(ActionContext actionContext, IActionResultTypeMapper mapper, ObjectMethodExecutor executor, Object controller, Object[] arguments)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.<InvokeActionMethodAsync>g__Awaited|12_0(ControllerActionInvoker invoker, ValueTask`1 actionResultValueTask)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.<InvokeNextActionFilterAsync>g__Awaited|10_0(ControllerActionInvoker invoker, Task lastTask, State next, Scope scope, Object state, Boolean isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.Rethrow(ActionExecutedContextSealed context)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.Next(State& next, Scope& scope, Object& state, Boolean& isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.<InvokeInnerFilterAsync>g__Awaited|13_0(ControllerActionInvoker invoker, Task lastTask, State next, Scope scope, Object state, Boolean isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeFilterPipelineAsync>g__Awaited|20_0(ResourceInvoker invoker, Task lastTask, State next, Scope scope, Object state, Boolean isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeAsync>g__Logged|17_1(ResourceInvoker invoker)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeAsync>g__Logged|17_1(ResourceInvoker invoker)
   at Microsoft.AspNetCore.Routing.EndpointMiddleware.<Invoke>g__AwaitRequestTask|7_0(Endpoint endpoint, Task requestTask, ILogger logger)
   at Microsoft.AspNetCore.Authorization.AuthorizationMiddleware.Invoke(HttpContext context)
   at Program.<>c.<<<Main>$>b__0_3>d.MoveNext() in C:\Users\yamta\StudioProjects\nayifat_app_2025_new\nayifatapi\Program.cs:line 85
--- End of stack trace from previous location ---
   at Swashbuckle.AspNetCore.SwaggerUI.SwaggerUIMiddleware.Invoke(HttpContext httpContext)
   at Swashbuckle.AspNetCore.Swagger.SwaggerMiddleware.Invoke(HttpContext httpContext, ISwaggerProvider swaggerProvider)
   at Microsoft.AspNetCore.Authentication.AuthenticationMiddleware.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Diagnostics.DeveloperExceptionPageMiddlewareImpl.Invoke(HttpContext context)
2025-02-02 14:49:15.670 +03:00 [INF] Request finished HTTP/1.1 POST http://07ca-46-152-255-232.ngrok-free.app/api/auth/signin - 500 null text/plain; charset=utf-8 2613.9919ms
2025-02-02 14:50:28.585 +03:00 [INF] Request starting HTTP/1.1 POST http://07ca-46-152-255-232.ngrok-free.app/api/notifications/list - application/json; charset=utf-8 47
2025-02-02 14:50:28.592 +03:00 [INF] Executing endpoint 'NayifatAPI.Controllers.NotificationsController.GetNotifications (NayifatAPI)'
2025-02-02 14:50:28.600 +03:00 [INF] Route matched with {action = "GetNotifications", controller = "Notifications"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetNotifications(NayifatAPI.Controllers.GetNotificationsRequest) on controller NayifatAPI.Controllers.NotificationsController (NayifatAPI).
2025-02-02 14:50:28.646 +03:00 [INF] Executed DbCommand (3ms) [Parameters=[@__providedApiKey_0='?' (Size = 255)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [a].[Key], [a].[CreatedAt], [a].[Description], [a].[ExpiresAt], [a].[IsActive], [a].[LastUsedAt]
FROM [ApiKeys] AS [a]
WHERE [a].[Key] = @__providedApiKey_0 AND [a].[IsActive] = CAST(1 AS bit)
2025-02-02 14:50:28.658 +03:00 [INF] Executed DbCommand (3ms) [Parameters=[@__request_NationalId_0='?' (Size = 450)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [u].[national_id], [u].[last_updated], [u].[notifications]
FROM [user_notifications] AS [u]
WHERE [u].[national_id] = @__request_NationalId_0
2025-02-02 14:50:28.690 +03:00 [INF] Executed DbCommand (3ms) [Parameters=[@__Parse_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [n].[Id], [n].[additional_data], [n].[Body], [n].[body_ar], [n].[body_en], [n].[created_at], [n].[expiry_at], [n].[Route], [n].[target_criteria], [n].[Title], [n].[title_ar], [n].[title_en]
FROM [notification_templates] AS [n]
WHERE [n].[Id] = @__Parse_0
2025-02-02 14:50:28.722 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@__Parse_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [n].[Id], [n].[additional_data], [n].[Body], [n].[body_ar], [n].[body_en], [n].[created_at], [n].[expiry_at], [n].[Route], [n].[target_criteria], [n].[Title], [n].[title_ar], [n].[title_en]
FROM [notification_templates] AS [n]
WHERE [n].[Id] = @__Parse_0
2025-02-02 14:50:28.854 +03:00 [INF] Executed DbCommand (75ms) [Parameters=[@p0='?' (Size = 4000), @p1='?' (DbType = DateTime2), @p2='?' (Size = 4000), @p3='?' (Size = 4000), @p4='?' (Size = 4000), @p5='?' (Size = 450), @p6='?' (Size = 4000), @p7='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SET IMPLICIT_TRANSACTIONS OFF;
SET NOCOUNT ON;
INSERT INTO [AuthLogs] ([AuthType], [CreatedAt], [DeviceId], [FailureReason], [IpAddress], [NationalId], [Status], [UserAgent])
OUTPUT INSERTED.[Id]
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7);
2025-02-02 14:50:28.876 +03:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType9`2[[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Object, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-02-02 14:50:28.896 +03:00 [INF] Executed action NayifatAPI.Controllers.NotificationsController.GetNotifications (NayifatAPI) in 292.6029ms
2025-02-02 14:50:28.897 +03:00 [INF] Executed endpoint 'NayifatAPI.Controllers.NotificationsController.GetNotifications (NayifatAPI)'
2025-02-02 14:50:28.899 +03:00 [INF] Request finished HTTP/1.1 POST http://07ca-46-152-255-232.ngrok-free.app/api/notifications/list - 200 null application/json; charset=utf-8 313.5611ms
2025-02-02 14:52:23.690 +03:00 [INF] Request starting HTTP/1.1 POST http://07ca-46-152-255-232.ngrok-free.app/api/auth/signin - application/json; charset=utf-8 78
2025-02-02 14:52:23.701 +03:00 [INF] Executing endpoint 'NayifatAPI.Controllers.AuthController.SignIn (NayifatAPI)'
2025-02-02 14:52:23.752 +03:00 [INF] Route matched with {action = "SignIn", controller = "Auth"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] SignIn(NayifatAPI.Controllers.SignInRequest) on controller NayifatAPI.Controllers.AuthController (NayifatAPI).
2025-02-02 14:52:24.055 +03:00 [INF] Executed DbCommand (75ms) [Parameters=[@__providedApiKey_0='?' (Size = 255)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [a].[Key], [a].[CreatedAt], [a].[Description], [a].[ExpiresAt], [a].[IsActive], [a].[LastUsedAt]
FROM [ApiKeys] AS [a]
WHERE [a].[Key] = @__providedApiKey_0 AND [a].[IsActive] = CAST(1 AS bit)
2025-02-02 14:52:24.087 +03:00 [INF] Executed DbCommand (8ms) [Parameters=[@__request_NationalId_0='?' (Size = 450)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [c].[NationalId], [c].[AddNo], [c].[BuildingNo], [c].[City], [c].[Consent], [c].[ConsentDate], [c].[DateOfBirth], [c].[Dependents], [c].[District], [c].[Email], [c].[Employer], [c].[FamilyNameAr], [c].[FamilyNameEn], [c].[FirstNameAr], [c].[FirstNameEn], [c].[Iban], [c].[IdExpiryDate], [c].[Los], [c].[Mpin], [c].[MpinEnabled], [c].[NafathStatus], [c].[NafathTimestamp], [c].[Password], [c].[Phone], [c].[RegistrationDate], [c].[SalaryCustomer], [c].[SalaryDakhli], [c].[SecondNameAr], [c].[SecondNameEn], [c].[Sector], [c].[Street], [c].[ThirdNameAr], [c].[ThirdNameEn], [c].[Zipcode]
FROM [Customers] AS [c]
WHERE [c].[NationalId] = @__request_NationalId_0
2025-02-02 14:52:24.404 +03:00 [INF] Starting password verification for NationalId: 1064448614
2025-02-02 14:52:25.312 +03:00 [INF] Password verification result for NationalId 1064448614: Success
2025-02-02 14:52:25.736 +03:00 [INF] Executed DbCommand (3ms) [Parameters=[@__request_NationalId_0='?' (Size = 450), @__request_DeviceId_1='?' (Size = 450)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [c].[Id], [c].[BiometricEnabled], [c].[BiometricToken], [c].[CreatedAt], [c].[DeviceId], [c].[LastUsedAt], [c].[Manufacturer], [c].[Model], [c].[NationalId], [c].[OsVersion], [c].[Platform], [c].[Status]
FROM [Customer_Devices] AS [c]
WHERE [c].[NationalId] = @__request_NationalId_0 AND [c].[DeviceId] = @__request_DeviceId_1 AND [c].[Status] = N'active'
2025-02-02 14:52:25.739 +03:00 [INF] Device not registered. Automatically registering device for NationalId: 1064448614
2025-02-02 14:52:25.848 +03:00 [INF] Executed DbCommand (106ms) [Parameters=[@p0='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
UPDATE Customer_Devices SET Status = 'disabled', LastUsedAt = GETUTCDATE() WHERE NationalId = @p0
2025-02-02 14:52:26.128 +03:00 [INF] Executed DbCommand (5ms) [Parameters=[@p0='?' (DbType = Boolean), @p1='?' (Size = 4000), @p2='?' (DbType = DateTime2), @p3='?' (Size = 450), @p4='?' (DbType = DateTime2), @p5='?' (Size = 4000), @p6='?' (Size = 4000), @p7='?' (Size = 450), @p8='?' (Size = 4000), @p9='?' (Size = 4000), @p10='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SET IMPLICIT_TRANSACTIONS OFF;
SET NOCOUNT ON;
INSERT INTO [Customer_Devices] ([BiometricEnabled], [BiometricToken], [CreatedAt], [DeviceId], [LastUsedAt], [Manufacturer], [Model], [NationalId], [OsVersion], [Platform], [Status])
OUTPUT INSERTED.[Id]
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7, @p8, @p9, @p10);
2025-02-02 14:52:26.132 +03:00 [ERR] An exception occurred in the database while saving changes for context type 'NayifatAPI.Data.ApplicationDbContext'.
Microsoft.EntityFrameworkCore.DbUpdateException: An error occurred while saving the entity changes. See the inner exception for details.
 ---> Microsoft.Data.SqlClient.SqlException (0x80131904): Cannot insert duplicate key row in object 'dbo.Customer_Devices' with unique index 'IX_Customer_Devices_NationalId_DeviceId'. The duplicate key value is (1064448614, TP1A.220624.014).
   at Microsoft.Data.SqlClient.SqlConnection.OnError(SqlException exception, Boolean breakConnection, Action`1 wrapCloseInAction)
   at Microsoft.Data.SqlClient.SqlInternalConnection.OnError(SqlException exception, Boolean breakConnection, Action`1 wrapCloseInAction)
   at Microsoft.Data.SqlClient.TdsParser.ThrowExceptionAndWarning(TdsParserStateObject stateObj, Boolean callerHasConnectionLock, Boolean asyncClose)
   at Microsoft.Data.SqlClient.TdsParser.TryRun(RunBehavior runBehavior, SqlCommand cmdHandler, SqlDataReader dataStream, BulkCopySimpleResultSet bulkCopyHandler, TdsParserStateObject stateObj, Boolean& dataReady)
   at Microsoft.Data.SqlClient.SqlDataReader.TryHasMoreRows(Boolean& moreRows)
   at Microsoft.Data.SqlClient.SqlDataReader.TryReadInternal(Boolean setTimeout, Boolean& more)
   at Microsoft.Data.SqlClient.SqlDataReader.ReadAsyncExecute(Task task, Object state)
   at Microsoft.Data.SqlClient.SqlDataReader.InvokeAsyncCall[T](SqlDataReaderBaseAsyncCallContext`1 context)
--- End of stack trace from previous location ---
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeResultSetAsync(Int32 startCommandIndex, RelationalDataReader reader, CancellationToken cancellationToken)
ClientConnectionId:bfa36a07-439d-496e-9669-532b3de955fc
Error Number:2601,State:1,Class:14
   --- End of inner exception stack trace ---
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeResultSetAsync(Int32 startCommandIndex, RelationalDataReader reader, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeAsync(RelationalDataReader reader, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Update.Internal.SqlServerModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(IList`1 entriesToSave, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(StateManager stateManager, Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Storage.Internal.SqlServerExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
Microsoft.EntityFrameworkCore.DbUpdateException: An error occurred while saving the entity changes. See the inner exception for details.
 ---> Microsoft.Data.SqlClient.SqlException (0x80131904): Cannot insert duplicate key row in object 'dbo.Customer_Devices' with unique index 'IX_Customer_Devices_NationalId_DeviceId'. The duplicate key value is (1064448614, TP1A.220624.014).
   at Microsoft.Data.SqlClient.SqlConnection.OnError(SqlException exception, Boolean breakConnection, Action`1 wrapCloseInAction)
   at Microsoft.Data.SqlClient.SqlInternalConnection.OnError(SqlException exception, Boolean breakConnection, Action`1 wrapCloseInAction)
   at Microsoft.Data.SqlClient.TdsParser.ThrowExceptionAndWarning(TdsParserStateObject stateObj, Boolean callerHasConnectionLock, Boolean asyncClose)
   at Microsoft.Data.SqlClient.TdsParser.TryRun(RunBehavior runBehavior, SqlCommand cmdHandler, SqlDataReader dataStream, BulkCopySimpleResultSet bulkCopyHandler, TdsParserStateObject stateObj, Boolean& dataReady)
   at Microsoft.Data.SqlClient.SqlDataReader.TryHasMoreRows(Boolean& moreRows)
   at Microsoft.Data.SqlClient.SqlDataReader.TryReadInternal(Boolean setTimeout, Boolean& more)
   at Microsoft.Data.SqlClient.SqlDataReader.ReadAsyncExecute(Task task, Object state)
   at Microsoft.Data.SqlClient.SqlDataReader.InvokeAsyncCall[T](SqlDataReaderBaseAsyncCallContext`1 context)
--- End of stack trace from previous location ---
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeResultSetAsync(Int32 startCommandIndex, RelationalDataReader reader, CancellationToken cancellationToken)
ClientConnectionId:bfa36a07-439d-496e-9669-532b3de955fc
Error Number:2601,State:1,Class:14
   --- End of inner exception stack trace ---
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeResultSetAsync(Int32 startCommandIndex, RelationalDataReader reader, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeAsync(RelationalDataReader reader, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Update.Internal.SqlServerModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(IList`1 entriesToSave, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(StateManager stateManager, Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Storage.Internal.SqlServerExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
2025-02-02 14:52:26.149 +03:00 [ERR] Error during device registration for NationalId: 1064448614
Microsoft.EntityFrameworkCore.DbUpdateException: An error occurred while saving the entity changes. See the inner exception for details.
 ---> Microsoft.Data.SqlClient.SqlException (0x80131904): Cannot insert duplicate key row in object 'dbo.Customer_Devices' with unique index 'IX_Customer_Devices_NationalId_DeviceId'. The duplicate key value is (1064448614, TP1A.220624.014).
   at Microsoft.Data.SqlClient.SqlConnection.OnError(SqlException exception, Boolean breakConnection, Action`1 wrapCloseInAction)
   at Microsoft.Data.SqlClient.SqlInternalConnection.OnError(SqlException exception, Boolean breakConnection, Action`1 wrapCloseInAction)
   at Microsoft.Data.SqlClient.TdsParser.ThrowExceptionAndWarning(TdsParserStateObject stateObj, Boolean callerHasConnectionLock, Boolean asyncClose)
   at Microsoft.Data.SqlClient.TdsParser.TryRun(RunBehavior runBehavior, SqlCommand cmdHandler, SqlDataReader dataStream, BulkCopySimpleResultSet bulkCopyHandler, TdsParserStateObject stateObj, Boolean& dataReady)
   at Microsoft.Data.SqlClient.SqlDataReader.TryHasMoreRows(Boolean& moreRows)
   at Microsoft.Data.SqlClient.SqlDataReader.TryReadInternal(Boolean setTimeout, Boolean& more)
   at Microsoft.Data.SqlClient.SqlDataReader.ReadAsyncExecute(Task task, Object state)
   at Microsoft.Data.SqlClient.SqlDataReader.InvokeAsyncCall[T](SqlDataReaderBaseAsyncCallContext`1 context)
--- End of stack trace from previous location ---
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeResultSetAsync(Int32 startCommandIndex, RelationalDataReader reader, CancellationToken cancellationToken)
ClientConnectionId:bfa36a07-439d-496e-9669-532b3de955fc
Error Number:2601,State:1,Class:14
   --- End of inner exception stack trace ---
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeResultSetAsync(Int32 startCommandIndex, RelationalDataReader reader, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeAsync(RelationalDataReader reader, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Update.Internal.SqlServerModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(IList`1 entriesToSave, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(StateManager stateManager, Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Storage.Internal.SqlServerExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at NayifatAPI.Controllers.AuthController.SignIn(SignInRequest request) in C:\Users\yamta\StudioProjects\nayifat_app_2025_new\nayifatapi\Controllers\AuthController.cs:line 107
2025-02-02 14:52:26.165 +03:00 [ERR] Error during sign in for National ID: 1064448614
Microsoft.EntityFrameworkCore.DbUpdateException: An error occurred while saving the entity changes. See the inner exception for details.
 ---> Microsoft.Data.SqlClient.SqlException (0x80131904): Cannot insert duplicate key row in object 'dbo.Customer_Devices' with unique index 'IX_Customer_Devices_NationalId_DeviceId'. The duplicate key value is (1064448614, TP1A.220624.014).
   at Microsoft.Data.SqlClient.SqlConnection.OnError(SqlException exception, Boolean breakConnection, Action`1 wrapCloseInAction)
   at Microsoft.Data.SqlClient.SqlInternalConnection.OnError(SqlException exception, Boolean breakConnection, Action`1 wrapCloseInAction)
   at Microsoft.Data.SqlClient.TdsParser.ThrowExceptionAndWarning(TdsParserStateObject stateObj, Boolean callerHasConnectionLock, Boolean asyncClose)
   at Microsoft.Data.SqlClient.TdsParser.TryRun(RunBehavior runBehavior, SqlCommand cmdHandler, SqlDataReader dataStream, BulkCopySimpleResultSet bulkCopyHandler, TdsParserStateObject stateObj, Boolean& dataReady)
   at Microsoft.Data.SqlClient.SqlDataReader.TryHasMoreRows(Boolean& moreRows)
   at Microsoft.Data.SqlClient.SqlDataReader.TryReadInternal(Boolean setTimeout, Boolean& more)
   at Microsoft.Data.SqlClient.SqlDataReader.ReadAsyncExecute(Task task, Object state)
   at Microsoft.Data.SqlClient.SqlDataReader.InvokeAsyncCall[T](SqlDataReaderBaseAsyncCallContext`1 context)
--- End of stack trace from previous location ---
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeResultSetAsync(Int32 startCommandIndex, RelationalDataReader reader, CancellationToken cancellationToken)
ClientConnectionId:bfa36a07-439d-496e-9669-532b3de955fc
Error Number:2601,State:1,Class:14
   --- End of inner exception stack trace ---
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeResultSetAsync(Int32 startCommandIndex, RelationalDataReader reader, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeAsync(RelationalDataReader reader, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Update.Internal.SqlServerModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(IList`1 entriesToSave, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(StateManager stateManager, Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Storage.Internal.SqlServerExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at NayifatAPI.Controllers.AuthController.SignIn(SignInRequest request) in C:\Users\yamta\StudioProjects\nayifat_app_2025_new\nayifatapi\Controllers\AuthController.cs:line 107
2025-02-02 14:52:26.187 +03:00 [INF] Executed DbCommand (9ms) [Parameters=[@p0='?' (Size = 4000), @p1='?' (DbType = DateTime2), @p2='?' (Size = 4000), @p3='?' (Size = 4000), @p4='?' (Size = 4000), @p5='?' (Size = 450), @p6='?' (Size = 4000), @p7='?' (Size = 4000), @p8='?' (DbType = Boolean), @p9='?' (Size = 4000), @p10='?' (DbType = DateTime2), @p11='?' (Size = 450), @p12='?' (DbType = DateTime2), @p13='?' (Size = 4000), @p14='?' (Size = 4000), @p15='?' (Size = 450), @p16='?' (Size = 4000), @p17='?' (Size = 4000), @p18='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SET NOCOUNT ON;
INSERT INTO [AuthLogs] ([AuthType], [CreatedAt], [DeviceId], [FailureReason], [IpAddress], [NationalId], [Status], [UserAgent])
OUTPUT INSERTED.[Id]
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7);
INSERT INTO [Customer_Devices] ([BiometricEnabled], [BiometricToken], [CreatedAt], [DeviceId], [LastUsedAt], [Manufacturer], [Model], [NationalId], [OsVersion], [Platform], [Status])
OUTPUT INSERTED.[Id]
VALUES (@p8, @p9, @p10, @p11, @p12, @p13, @p14, @p15, @p16, @p17, @p18);
2025-02-02 14:52:26.192 +03:00 [ERR] An exception occurred in the database while saving changes for context type 'NayifatAPI.Data.ApplicationDbContext'.
Microsoft.EntityFrameworkCore.DbUpdateException: An error occurred while saving the entity changes. See the inner exception for details.
 ---> Microsoft.Data.SqlClient.SqlException (0x80131904): Cannot insert duplicate key row in object 'dbo.Customer_Devices' with unique index 'IX_Customer_Devices_NationalId_DeviceId'. The duplicate key value is (1064448614, TP1A.220624.014).
   at Microsoft.Data.SqlClient.SqlConnection.OnError(SqlException exception, Boolean breakConnection, Action`1 wrapCloseInAction)
   at Microsoft.Data.SqlClient.SqlInternalConnection.OnError(SqlException exception, Boolean breakConnection, Action`1 wrapCloseInAction)
   at Microsoft.Data.SqlClient.TdsParser.ThrowExceptionAndWarning(TdsParserStateObject stateObj, Boolean callerHasConnectionLock, Boolean asyncClose)
   at Microsoft.Data.SqlClient.TdsParser.TryRun(RunBehavior runBehavior, SqlCommand cmdHandler, SqlDataReader dataStream, BulkCopySimpleResultSet bulkCopyHandler, TdsParserStateObject stateObj, Boolean& dataReady)
   at Microsoft.Data.SqlClient.SqlDataReader.TryHasMoreRows(Boolean& moreRows)
   at Microsoft.Data.SqlClient.SqlDataReader.TryReadInternal(Boolean setTimeout, Boolean& more)
   at Microsoft.Data.SqlClient.SqlDataReader.ReadAsyncExecute(Task task, Object state)
   at Microsoft.Data.SqlClient.SqlDataReader.InvokeAsyncCall[T](SqlDataReaderBaseAsyncCallContext`1 context)
--- End of stack trace from previous location ---
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeResultSetAsync(Int32 startCommandIndex, RelationalDataReader reader, CancellationToken cancellationToken)
ClientConnectionId:bfa36a07-439d-496e-9669-532b3de955fc
Error Number:2601,State:1,Class:14
   --- End of inner exception stack trace ---
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeResultSetAsync(Int32 startCommandIndex, RelationalDataReader reader, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeAsync(RelationalDataReader reader, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Update.Internal.SqlServerModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(IList`1 entriesToSave, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(StateManager stateManager, Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Storage.Internal.SqlServerExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
Microsoft.EntityFrameworkCore.DbUpdateException: An error occurred while saving the entity changes. See the inner exception for details.
 ---> Microsoft.Data.SqlClient.SqlException (0x80131904): Cannot insert duplicate key row in object 'dbo.Customer_Devices' with unique index 'IX_Customer_Devices_NationalId_DeviceId'. The duplicate key value is (1064448614, TP1A.220624.014).
   at Microsoft.Data.SqlClient.SqlConnection.OnError(SqlException exception, Boolean breakConnection, Action`1 wrapCloseInAction)
   at Microsoft.Data.SqlClient.SqlInternalConnection.OnError(SqlException exception, Boolean breakConnection, Action`1 wrapCloseInAction)
   at Microsoft.Data.SqlClient.TdsParser.ThrowExceptionAndWarning(TdsParserStateObject stateObj, Boolean callerHasConnectionLock, Boolean asyncClose)
   at Microsoft.Data.SqlClient.TdsParser.TryRun(RunBehavior runBehavior, SqlCommand cmdHandler, SqlDataReader dataStream, BulkCopySimpleResultSet bulkCopyHandler, TdsParserStateObject stateObj, Boolean& dataReady)
   at Microsoft.Data.SqlClient.SqlDataReader.TryHasMoreRows(Boolean& moreRows)
   at Microsoft.Data.SqlClient.SqlDataReader.TryReadInternal(Boolean setTimeout, Boolean& more)
   at Microsoft.Data.SqlClient.SqlDataReader.ReadAsyncExecute(Task task, Object state)
   at Microsoft.Data.SqlClient.SqlDataReader.InvokeAsyncCall[T](SqlDataReaderBaseAsyncCallContext`1 context)
--- End of stack trace from previous location ---
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeResultSetAsync(Int32 startCommandIndex, RelationalDataReader reader, CancellationToken cancellationToken)
ClientConnectionId:bfa36a07-439d-496e-9669-532b3de955fc
Error Number:2601,State:1,Class:14
   --- End of inner exception stack trace ---
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeResultSetAsync(Int32 startCommandIndex, RelationalDataReader reader, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeAsync(RelationalDataReader reader, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Update.Internal.SqlServerModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(IList`1 entriesToSave, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(StateManager stateManager, Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Storage.Internal.SqlServerExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
2025-02-02 14:52:26.217 +03:00 [INF] Executed action NayifatAPI.Controllers.AuthController.SignIn (NayifatAPI) in 2398.6327ms
2025-02-02 14:52:26.218 +03:00 [INF] Executed endpoint 'NayifatAPI.Controllers.AuthController.SignIn (NayifatAPI)'
2025-02-02 14:52:26.219 +03:00 [ERR] Unhandled exception
Microsoft.EntityFrameworkCore.DbUpdateException: An error occurred while saving the entity changes. See the inner exception for details.
 ---> Microsoft.Data.SqlClient.SqlException (0x80131904): Cannot insert duplicate key row in object 'dbo.Customer_Devices' with unique index 'IX_Customer_Devices_NationalId_DeviceId'. The duplicate key value is (1064448614, TP1A.220624.014).
   at Microsoft.Data.SqlClient.SqlConnection.OnError(SqlException exception, Boolean breakConnection, Action`1 wrapCloseInAction)
   at Microsoft.Data.SqlClient.SqlInternalConnection.OnError(SqlException exception, Boolean breakConnection, Action`1 wrapCloseInAction)
   at Microsoft.Data.SqlClient.TdsParser.ThrowExceptionAndWarning(TdsParserStateObject stateObj, Boolean callerHasConnectionLock, Boolean asyncClose)
   at Microsoft.Data.SqlClient.TdsParser.TryRun(RunBehavior runBehavior, SqlCommand cmdHandler, SqlDataReader dataStream, BulkCopySimpleResultSet bulkCopyHandler, TdsParserStateObject stateObj, Boolean& dataReady)
   at Microsoft.Data.SqlClient.SqlDataReader.TryHasMoreRows(Boolean& moreRows)
   at Microsoft.Data.SqlClient.SqlDataReader.TryReadInternal(Boolean setTimeout, Boolean& more)
   at Microsoft.Data.SqlClient.SqlDataReader.ReadAsyncExecute(Task task, Object state)
   at Microsoft.Data.SqlClient.SqlDataReader.InvokeAsyncCall[T](SqlDataReaderBaseAsyncCallContext`1 context)
--- End of stack trace from previous location ---
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeResultSetAsync(Int32 startCommandIndex, RelationalDataReader reader, CancellationToken cancellationToken)
ClientConnectionId:bfa36a07-439d-496e-9669-532b3de955fc
Error Number:2601,State:1,Class:14
   --- End of inner exception stack trace ---
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeResultSetAsync(Int32 startCommandIndex, RelationalDataReader reader, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeAsync(RelationalDataReader reader, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Update.Internal.SqlServerModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(IList`1 entriesToSave, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(StateManager stateManager, Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Storage.Internal.SqlServerExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at NayifatAPI.Controllers.AuthController.LogAuthAttempt(String nationalId, String deviceId, String status, String failureReason) in C:\Users\yamta\StudioProjects\nayifat_app_2025_new\nayifatapi\Controllers\AuthController.cs:line 432
   at NayifatAPI.Controllers.AuthController.SignIn(SignInRequest request) in C:\Users\yamta\StudioProjects\nayifat_app_2025_new\nayifatapi\Controllers\AuthController.cs:line 168
   at Microsoft.AspNetCore.Mvc.Infrastructure.ActionMethodExecutor.TaskOfIActionResultExecutor.Execute(ActionContext actionContext, IActionResultTypeMapper mapper, ObjectMethodExecutor executor, Object controller, Object[] arguments)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.<InvokeActionMethodAsync>g__Awaited|12_0(ControllerActionInvoker invoker, ValueTask`1 actionResultValueTask)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.<InvokeNextActionFilterAsync>g__Awaited|10_0(ControllerActionInvoker invoker, Task lastTask, State next, Scope scope, Object state, Boolean isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.Rethrow(ActionExecutedContextSealed context)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.Next(State& next, Scope& scope, Object& state, Boolean& isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.<InvokeInnerFilterAsync>g__Awaited|13_0(ControllerActionInvoker invoker, Task lastTask, State next, Scope scope, Object state, Boolean isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeFilterPipelineAsync>g__Awaited|20_0(ResourceInvoker invoker, Task lastTask, State next, Scope scope, Object state, Boolean isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeAsync>g__Logged|17_1(ResourceInvoker invoker)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeAsync>g__Logged|17_1(ResourceInvoker invoker)
   at Microsoft.AspNetCore.Routing.EndpointMiddleware.<Invoke>g__AwaitRequestTask|7_0(Endpoint endpoint, Task requestTask, ILogger logger)
   at Microsoft.AspNetCore.Authorization.AuthorizationMiddleware.Invoke(HttpContext context)
   at Program.<>c.<<<Main>$>b__0_3>d.MoveNext() in C:\Users\yamta\StudioProjects\nayifat_app_2025_new\nayifatapi\Program.cs:line 85
2025-02-02 14:52:26.245 +03:00 [ERR] An unhandled exception has occurred while executing the request.
Microsoft.EntityFrameworkCore.DbUpdateException: An error occurred while saving the entity changes. See the inner exception for details.
 ---> Microsoft.Data.SqlClient.SqlException (0x80131904): Cannot insert duplicate key row in object 'dbo.Customer_Devices' with unique index 'IX_Customer_Devices_NationalId_DeviceId'. The duplicate key value is (1064448614, TP1A.220624.014).
   at Microsoft.Data.SqlClient.SqlConnection.OnError(SqlException exception, Boolean breakConnection, Action`1 wrapCloseInAction)
   at Microsoft.Data.SqlClient.SqlInternalConnection.OnError(SqlException exception, Boolean breakConnection, Action`1 wrapCloseInAction)
   at Microsoft.Data.SqlClient.TdsParser.ThrowExceptionAndWarning(TdsParserStateObject stateObj, Boolean callerHasConnectionLock, Boolean asyncClose)
   at Microsoft.Data.SqlClient.TdsParser.TryRun(RunBehavior runBehavior, SqlCommand cmdHandler, SqlDataReader dataStream, BulkCopySimpleResultSet bulkCopyHandler, TdsParserStateObject stateObj, Boolean& dataReady)
   at Microsoft.Data.SqlClient.SqlDataReader.TryHasMoreRows(Boolean& moreRows)
   at Microsoft.Data.SqlClient.SqlDataReader.TryReadInternal(Boolean setTimeout, Boolean& more)
   at Microsoft.Data.SqlClient.SqlDataReader.ReadAsyncExecute(Task task, Object state)
   at Microsoft.Data.SqlClient.SqlDataReader.InvokeAsyncCall[T](SqlDataReaderBaseAsyncCallContext`1 context)
--- End of stack trace from previous location ---
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeResultSetAsync(Int32 startCommandIndex, RelationalDataReader reader, CancellationToken cancellationToken)
ClientConnectionId:bfa36a07-439d-496e-9669-532b3de955fc
Error Number:2601,State:1,Class:14
   --- End of inner exception stack trace ---
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeResultSetAsync(Int32 startCommandIndex, RelationalDataReader reader, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeAsync(RelationalDataReader reader, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Update.Internal.SqlServerModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(IList`1 entriesToSave, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(StateManager stateManager, Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Storage.Internal.SqlServerExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at NayifatAPI.Controllers.AuthController.LogAuthAttempt(String nationalId, String deviceId, String status, String failureReason) in C:\Users\yamta\StudioProjects\nayifat_app_2025_new\nayifatapi\Controllers\AuthController.cs:line 432
   at NayifatAPI.Controllers.AuthController.SignIn(SignInRequest request) in C:\Users\yamta\StudioProjects\nayifat_app_2025_new\nayifatapi\Controllers\AuthController.cs:line 168
   at Microsoft.AspNetCore.Mvc.Infrastructure.ActionMethodExecutor.TaskOfIActionResultExecutor.Execute(ActionContext actionContext, IActionResultTypeMapper mapper, ObjectMethodExecutor executor, Object controller, Object[] arguments)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.<InvokeActionMethodAsync>g__Awaited|12_0(ControllerActionInvoker invoker, ValueTask`1 actionResultValueTask)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.<InvokeNextActionFilterAsync>g__Awaited|10_0(ControllerActionInvoker invoker, Task lastTask, State next, Scope scope, Object state, Boolean isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.Rethrow(ActionExecutedContextSealed context)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.Next(State& next, Scope& scope, Object& state, Boolean& isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.<InvokeInnerFilterAsync>g__Awaited|13_0(ControllerActionInvoker invoker, Task lastTask, State next, Scope scope, Object state, Boolean isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeFilterPipelineAsync>g__Awaited|20_0(ResourceInvoker invoker, Task lastTask, State next, Scope scope, Object state, Boolean isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeAsync>g__Logged|17_1(ResourceInvoker invoker)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeAsync>g__Logged|17_1(ResourceInvoker invoker)
   at Microsoft.AspNetCore.Routing.EndpointMiddleware.<Invoke>g__AwaitRequestTask|7_0(Endpoint endpoint, Task requestTask, ILogger logger)
   at Microsoft.AspNetCore.Authorization.AuthorizationMiddleware.Invoke(HttpContext context)
   at Program.<>c.<<<Main>$>b__0_3>d.MoveNext() in C:\Users\yamta\StudioProjects\nayifat_app_2025_new\nayifatapi\Program.cs:line 85
--- End of stack trace from previous location ---
   at Swashbuckle.AspNetCore.SwaggerUI.SwaggerUIMiddleware.Invoke(HttpContext httpContext)
   at Swashbuckle.AspNetCore.Swagger.SwaggerMiddleware.Invoke(HttpContext httpContext, ISwaggerProvider swaggerProvider)
   at Microsoft.AspNetCore.Authentication.AuthenticationMiddleware.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Diagnostics.DeveloperExceptionPageMiddlewareImpl.Invoke(HttpContext context)
2025-02-02 14:52:26.270 +03:00 [INF] Request finished HTTP/1.1 POST http://07ca-46-152-255-232.ngrok-free.app/api/auth/signin - 500 null text/plain; charset=utf-8 2581.0389ms
2025-02-02 14:55:28.623 +03:00 [INF] Request starting HTTP/1.1 POST http://07ca-46-152-255-232.ngrok-free.app/api/notifications/list - application/json; charset=utf-8 47
2025-02-02 14:55:28.628 +03:00 [INF] Executing endpoint 'NayifatAPI.Controllers.NotificationsController.GetNotifications (NayifatAPI)'
2025-02-02 14:55:28.629 +03:00 [INF] Route matched with {action = "GetNotifications", controller = "Notifications"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetNotifications(NayifatAPI.Controllers.GetNotificationsRequest) on controller NayifatAPI.Controllers.NotificationsController (NayifatAPI).
2025-02-02 14:55:28.637 +03:00 [INF] Executed DbCommand (3ms) [Parameters=[@__providedApiKey_0='?' (Size = 255)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [a].[Key], [a].[CreatedAt], [a].[Description], [a].[ExpiresAt], [a].[IsActive], [a].[LastUsedAt]
FROM [ApiKeys] AS [a]
WHERE [a].[Key] = @__providedApiKey_0 AND [a].[IsActive] = CAST(1 AS bit)
2025-02-02 14:55:28.643 +03:00 [INF] Executed DbCommand (3ms) [Parameters=[@__request_NationalId_0='?' (Size = 450)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [u].[national_id], [u].[last_updated], [u].[notifications]
FROM [user_notifications] AS [u]
WHERE [u].[national_id] = @__request_NationalId_0
2025-02-02 14:55:28.650 +03:00 [INF] Executed DbCommand (2ms) [Parameters=[@__Parse_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [n].[Id], [n].[additional_data], [n].[Body], [n].[body_ar], [n].[body_en], [n].[created_at], [n].[expiry_at], [n].[Route], [n].[target_criteria], [n].[Title], [n].[title_ar], [n].[title_en]
FROM [notification_templates] AS [n]
WHERE [n].[Id] = @__Parse_0
2025-02-02 14:55:28.656 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@__Parse_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [n].[Id], [n].[additional_data], [n].[Body], [n].[body_ar], [n].[body_en], [n].[created_at], [n].[expiry_at], [n].[Route], [n].[target_criteria], [n].[Title], [n].[title_ar], [n].[title_en]
FROM [notification_templates] AS [n]
WHERE [n].[Id] = @__Parse_0
2025-02-02 14:55:28.739 +03:00 [INF] Executed DbCommand (79ms) [Parameters=[@p0='?' (Size = 4000), @p1='?' (DbType = DateTime2), @p2='?' (Size = 4000), @p3='?' (Size = 4000), @p4='?' (Size = 4000), @p5='?' (Size = 450), @p6='?' (Size = 4000), @p7='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SET IMPLICIT_TRANSACTIONS OFF;
SET NOCOUNT ON;
INSERT INTO [AuthLogs] ([AuthType], [CreatedAt], [DeviceId], [FailureReason], [IpAddress], [NationalId], [Status], [UserAgent])
OUTPUT INSERTED.[Id]
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7);
2025-02-02 14:55:28.744 +03:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType9`2[[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Object, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-02-02 14:55:28.747 +03:00 [INF] Executed action NayifatAPI.Controllers.NotificationsController.GetNotifications (NayifatAPI) in 115.5419ms
2025-02-02 14:55:28.749 +03:00 [INF] Executed endpoint 'NayifatAPI.Controllers.NotificationsController.GetNotifications (NayifatAPI)'
2025-02-02 14:55:28.752 +03:00 [INF] Request finished HTTP/1.1 POST http://07ca-46-152-255-232.ngrok-free.app/api/notifications/list - 200 null application/json; charset=utf-8 128.3994ms
2025-02-02 14:57:58.105 +03:00 [INF] Application is shutting down...
2025-02-02 15:03:35.083 +03:00 [INF] Starting web application
2025-02-02 15:03:35.197 +03:00 [INF] Now listening on: http://localhost:5264
2025-02-02 15:03:35.205 +03:00 [INF] Application started. Press Ctrl+C to shut down.
2025-02-02 15:03:35.206 +03:00 [INF] Hosting environment: Development
2025-02-02 15:03:35.207 +03:00 [INF] Content root path: C:\Users\yamta\StudioProjects\nayifat_app_2025_new\nayifatapi
2025-02-02 15:05:28.753 +03:00 [INF] Request starting HTTP/1.1 POST http://07ca-46-152-255-232.ngrok-free.app/api/notifications/list - application/json; charset=utf-8 47
2025-02-02 15:05:28.802 +03:00 [WRN] Failed to determine the https port for redirect.
2025-02-02 15:05:28.806 +03:00 [INF] Executing endpoint 'NayifatAPI.Controllers.NotificationsController.GetNotifications (NayifatAPI)'
2025-02-02 15:05:28.829 +03:00 [INF] Route matched with {action = "GetNotifications", controller = "Notifications"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetNotifications(NayifatAPI.Controllers.GetNotificationsRequest) on controller NayifatAPI.Controllers.NotificationsController (NayifatAPI).
2025-02-02 15:05:30.264 +03:00 [INF] Executed DbCommand (106ms) [Parameters=[@__providedApiKey_0='?' (Size = 255)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [a].[Key], [a].[CreatedAt], [a].[Description], [a].[ExpiresAt], [a].[IsActive], [a].[LastUsedAt]
FROM [ApiKeys] AS [a]
WHERE [a].[Key] = @__providedApiKey_0 AND [a].[IsActive] = CAST(1 AS bit)
2025-02-02 15:05:30.366 +03:00 [INF] Executed DbCommand (12ms) [Parameters=[@__request_NationalId_0='?' (Size = 450)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [u].[national_id], [u].[last_updated], [u].[notifications]
FROM [user_notifications] AS [u]
WHERE [u].[national_id] = @__request_NationalId_0
2025-02-02 15:05:30.427 +03:00 [INF] Executed DbCommand (4ms) [Parameters=[@__Parse_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [n].[Id], [n].[additional_data], [n].[Body], [n].[body_ar], [n].[body_en], [n].[created_at], [n].[expiry_at], [n].[Route], [n].[target_criteria], [n].[Title], [n].[title_ar], [n].[title_en]
FROM [notification_templates] AS [n]
WHERE [n].[Id] = @__Parse_0
2025-02-02 15:05:30.453 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@__Parse_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [n].[Id], [n].[additional_data], [n].[Body], [n].[body_ar], [n].[body_en], [n].[created_at], [n].[expiry_at], [n].[Route], [n].[target_criteria], [n].[Title], [n].[title_ar], [n].[title_en]
FROM [notification_templates] AS [n]
WHERE [n].[Id] = @__Parse_0
2025-02-02 15:05:30.738 +03:00 [INF] Executed DbCommand (102ms) [Parameters=[@p0='?' (Size = 4000), @p1='?' (DbType = DateTime2), @p2='?' (Size = 4000), @p3='?' (Size = 4000), @p4='?' (Size = 4000), @p5='?' (Size = 450), @p6='?' (Size = 4000), @p7='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SET IMPLICIT_TRANSACTIONS OFF;
SET NOCOUNT ON;
INSERT INTO [AuthLogs] ([AuthType], [CreatedAt], [DeviceId], [FailureReason], [IpAddress], [NationalId], [Status], [UserAgent])
OUTPUT INSERTED.[Id]
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7);
2025-02-02 15:05:30.767 +03:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType9`2[[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Object, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-02-02 15:05:30.786 +03:00 [INF] Executed action NayifatAPI.Controllers.NotificationsController.GetNotifications (NayifatAPI) in 1950.5165ms
2025-02-02 15:05:30.790 +03:00 [INF] Executed endpoint 'NayifatAPI.Controllers.NotificationsController.GetNotifications (NayifatAPI)'
2025-02-02 15:05:30.805 +03:00 [INF] Request finished HTTP/1.1 POST http://07ca-46-152-255-232.ngrok-free.app/api/notifications/list - 200 null application/json; charset=utf-8 2053.9483ms
2025-02-02 15:09:08.600 +03:00 [INF] Application is shutting down...
2025-02-02 15:09:17.122 +03:00 [INF] Starting web application
2025-02-02 15:09:17.464 +03:00 [INF] Now listening on: http://localhost:5264
2025-02-02 15:09:17.473 +03:00 [INF] Application started. Press Ctrl+C to shut down.
2025-02-02 15:09:17.476 +03:00 [INF] Hosting environment: Development
2025-02-02 15:09:17.477 +03:00 [INF] Content root path: C:\Users\yamta\StudioProjects\nayifat_app_2025_new\nayifatapi
2025-02-02 15:09:30.256 +03:00 [INF] Request starting HTTP/1.1 POST http://07ca-46-152-255-232.ngrok-free.app/api/notifications/list - application/json; charset=utf-8 47
2025-02-02 15:09:30.295 +03:00 [WRN] Failed to determine the https port for redirect.
2025-02-02 15:09:30.300 +03:00 [INF] Executing endpoint 'NayifatAPI.Controllers.NotificationsController.GetNotifications (NayifatAPI)'
2025-02-02 15:09:30.319 +03:00 [INF] Route matched with {action = "GetNotifications", controller = "Notifications"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetNotifications(NayifatAPI.Controllers.GetNotificationsRequest) on controller NayifatAPI.Controllers.NotificationsController (NayifatAPI).
2025-02-02 15:09:31.433 +03:00 [INF] Executed DbCommand (22ms) [Parameters=[@__providedApiKey_0='?' (Size = 255)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [a].[Key], [a].[CreatedAt], [a].[Description], [a].[ExpiresAt], [a].[IsActive], [a].[LastUsedAt]
FROM [ApiKeys] AS [a]
WHERE [a].[Key] = @__providedApiKey_0 AND [a].[IsActive] = CAST(1 AS bit)
2025-02-02 15:09:31.522 +03:00 [INF] Executed DbCommand (12ms) [Parameters=[@__request_NationalId_0='?' (Size = 450)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [u].[national_id], [u].[last_updated], [u].[notifications]
FROM [user_notifications] AS [u]
WHERE [u].[national_id] = @__request_NationalId_0
2025-02-02 15:09:31.565 +03:00 [INF] Executed DbCommand (4ms) [Parameters=[@__Parse_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [n].[Id], [n].[additional_data], [n].[Body], [n].[body_ar], [n].[body_en], [n].[created_at], [n].[expiry_at], [n].[Route], [n].[target_criteria], [n].[Title], [n].[title_ar], [n].[title_en]
FROM [notification_templates] AS [n]
WHERE [n].[Id] = @__Parse_0
2025-02-02 15:09:31.597 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@__Parse_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [n].[Id], [n].[additional_data], [n].[Body], [n].[body_ar], [n].[body_en], [n].[created_at], [n].[expiry_at], [n].[Route], [n].[target_criteria], [n].[Title], [n].[title_ar], [n].[title_en]
FROM [notification_templates] AS [n]
WHERE [n].[Id] = @__Parse_0
2025-02-02 15:09:31.861 +03:00 [INF] Executed DbCommand (77ms) [Parameters=[@p0='?' (Size = 4000), @p1='?' (DbType = DateTime2), @p2='?' (Size = 4000), @p3='?' (Size = 4000), @p4='?' (Size = 4000), @p5='?' (Size = 450), @p6='?' (Size = 4000), @p7='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SET IMPLICIT_TRANSACTIONS OFF;
SET NOCOUNT ON;
INSERT INTO [AuthLogs] ([AuthType], [CreatedAt], [DeviceId], [FailureReason], [IpAddress], [NationalId], [Status], [UserAgent])
OUTPUT INSERTED.[Id]
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7);
2025-02-02 15:09:31.889 +03:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType9`2[[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Object, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-02-02 15:09:31.908 +03:00 [INF] Executed action NayifatAPI.Controllers.NotificationsController.GetNotifications (NayifatAPI) in 1582.5332ms
2025-02-02 15:09:31.910 +03:00 [INF] Executed endpoint 'NayifatAPI.Controllers.NotificationsController.GetNotifications (NayifatAPI)'
2025-02-02 15:09:31.921 +03:00 [INF] Request finished HTTP/1.1 POST http://07ca-46-152-255-232.ngrok-free.app/api/notifications/list - 200 null application/json; charset=utf-8 1665.2909ms
2025-02-02 15:14:32.517 +03:00 [INF] Request starting HTTP/1.1 POST http://07ca-46-152-255-232.ngrok-free.app/api/notifications/list - application/json; charset=utf-8 47
2025-02-02 15:14:32.523 +03:00 [INF] Executing endpoint 'NayifatAPI.Controllers.NotificationsController.GetNotifications (NayifatAPI)'
2025-02-02 15:14:32.525 +03:00 [INF] Route matched with {action = "GetNotifications", controller = "Notifications"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetNotifications(NayifatAPI.Controllers.GetNotificationsRequest) on controller NayifatAPI.Controllers.NotificationsController (NayifatAPI).
2025-02-02 15:14:32.552 +03:00 [INF] Executed DbCommand (7ms) [Parameters=[@__providedApiKey_0='?' (Size = 255)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [a].[Key], [a].[CreatedAt], [a].[Description], [a].[ExpiresAt], [a].[IsActive], [a].[LastUsedAt]
FROM [ApiKeys] AS [a]
WHERE [a].[Key] = @__providedApiKey_0 AND [a].[IsActive] = CAST(1 AS bit)
2025-02-02 15:14:32.557 +03:00 [INF] Executed DbCommand (2ms) [Parameters=[@__request_NationalId_0='?' (Size = 450)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [u].[national_id], [u].[last_updated], [u].[notifications]
FROM [user_notifications] AS [u]
WHERE [u].[national_id] = @__request_NationalId_0
2025-02-02 15:14:32.565 +03:00 [INF] Executed DbCommand (3ms) [Parameters=[@__Parse_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [n].[Id], [n].[additional_data], [n].[Body], [n].[body_ar], [n].[body_en], [n].[created_at], [n].[expiry_at], [n].[Route], [n].[target_criteria], [n].[Title], [n].[title_ar], [n].[title_en]
FROM [notification_templates] AS [n]
WHERE [n].[Id] = @__Parse_0
2025-02-02 15:14:32.569 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@__Parse_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [n].[Id], [n].[additional_data], [n].[Body], [n].[body_ar], [n].[body_en], [n].[created_at], [n].[expiry_at], [n].[Route], [n].[target_criteria], [n].[Title], [n].[title_ar], [n].[title_en]
FROM [notification_templates] AS [n]
WHERE [n].[Id] = @__Parse_0
2025-02-02 15:14:32.578 +03:00 [INF] Executed DbCommand (4ms) [Parameters=[@p0='?' (Size = 4000), @p1='?' (DbType = DateTime2), @p2='?' (Size = 4000), @p3='?' (Size = 4000), @p4='?' (Size = 4000), @p5='?' (Size = 450), @p6='?' (Size = 4000), @p7='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SET IMPLICIT_TRANSACTIONS OFF;
SET NOCOUNT ON;
INSERT INTO [AuthLogs] ([AuthType], [CreatedAt], [DeviceId], [FailureReason], [IpAddress], [NationalId], [Status], [UserAgent])
OUTPUT INSERTED.[Id]
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7);
2025-02-02 15:14:32.581 +03:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType9`2[[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Object, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-02-02 15:14:32.582 +03:00 [INF] Executed action NayifatAPI.Controllers.NotificationsController.GetNotifications (NayifatAPI) in 55.0873ms
2025-02-02 15:14:32.584 +03:00 [INF] Executed endpoint 'NayifatAPI.Controllers.NotificationsController.GetNotifications (NayifatAPI)'
2025-02-02 15:14:32.585 +03:00 [INF] Request finished HTTP/1.1 POST http://07ca-46-152-255-232.ngrok-free.app/api/notifications/list - 200 null application/json; charset=utf-8 69.1594ms
2025-02-02 15:15:01.645 +03:00 [INF] Request starting HTTP/1.1 POST http://07ca-46-152-255-232.ngrok-free.app/api/notifications/list - application/json; charset=utf-8 47
2025-02-02 15:15:01.651 +03:00 [INF] Executing endpoint 'NayifatAPI.Controllers.NotificationsController.GetNotifications (NayifatAPI)'
2025-02-02 15:15:01.653 +03:00 [INF] Route matched with {action = "GetNotifications", controller = "Notifications"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetNotifications(NayifatAPI.Controllers.GetNotificationsRequest) on controller NayifatAPI.Controllers.NotificationsController (NayifatAPI).
2025-02-02 15:15:01.777 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@__providedApiKey_0='?' (Size = 255)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [a].[Key], [a].[CreatedAt], [a].[Description], [a].[ExpiresAt], [a].[IsActive], [a].[LastUsedAt]
FROM [ApiKeys] AS [a]
WHERE [a].[Key] = @__providedApiKey_0 AND [a].[IsActive] = CAST(1 AS bit)
2025-02-02 15:15:01.780 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@__request_NationalId_0='?' (Size = 450)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [u].[national_id], [u].[last_updated], [u].[notifications]
FROM [user_notifications] AS [u]
WHERE [u].[national_id] = @__request_NationalId_0
2025-02-02 15:15:01.785 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@__Parse_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [n].[Id], [n].[additional_data], [n].[Body], [n].[body_ar], [n].[body_en], [n].[created_at], [n].[expiry_at], [n].[Route], [n].[target_criteria], [n].[Title], [n].[title_ar], [n].[title_en]
FROM [notification_templates] AS [n]
WHERE [n].[Id] = @__Parse_0
2025-02-02 15:15:01.791 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@__Parse_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [n].[Id], [n].[additional_data], [n].[Body], [n].[body_ar], [n].[body_en], [n].[created_at], [n].[expiry_at], [n].[Route], [n].[target_criteria], [n].[Title], [n].[title_ar], [n].[title_en]
FROM [notification_templates] AS [n]
WHERE [n].[Id] = @__Parse_0
2025-02-02 15:15:01.801 +03:00 [INF] Executed DbCommand (6ms) [Parameters=[@p0='?' (Size = 4000), @p1='?' (DbType = DateTime2), @p2='?' (Size = 4000), @p3='?' (Size = 4000), @p4='?' (Size = 4000), @p5='?' (Size = 450), @p6='?' (Size = 4000), @p7='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SET IMPLICIT_TRANSACTIONS OFF;
SET NOCOUNT ON;
INSERT INTO [AuthLogs] ([AuthType], [CreatedAt], [DeviceId], [FailureReason], [IpAddress], [NationalId], [Status], [UserAgent])
OUTPUT INSERTED.[Id]
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7);
2025-02-02 15:15:01.805 +03:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType9`2[[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Object, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-02-02 15:15:01.807 +03:00 [INF] Executed action NayifatAPI.Controllers.NotificationsController.GetNotifications (NayifatAPI) in 150.1242ms
2025-02-02 15:15:01.809 +03:00 [INF] Executed endpoint 'NayifatAPI.Controllers.NotificationsController.GetNotifications (NayifatAPI)'
2025-02-02 15:15:01.811 +03:00 [INF] Request finished HTTP/1.1 POST http://07ca-46-152-255-232.ngrok-free.app/api/notifications/list - 200 null application/json; charset=utf-8 165.9028ms
2025-02-02 15:15:35.947 +03:00 [INF] Request starting HTTP/1.1 POST http://07ca-46-152-255-232.ngrok-free.app/api/auth/signin - application/json; charset=utf-8 224
2025-02-02 15:15:35.949 +03:00 [INF] Executing endpoint 'NayifatAPI.Controllers.AuthController.SignIn (NayifatAPI)'
2025-02-02 15:15:35.955 +03:00 [INF] Route matched with {action = "SignIn", controller = "Auth"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] SignIn(NayifatAPI.Controllers.SignInRequest) on controller NayifatAPI.Controllers.AuthController (NayifatAPI).
2025-02-02 15:15:35.974 +03:00 [INF] Executed DbCommand (4ms) [Parameters=[@__providedApiKey_0='?' (Size = 255)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [a].[Key], [a].[CreatedAt], [a].[Description], [a].[ExpiresAt], [a].[IsActive], [a].[LastUsedAt]
FROM [ApiKeys] AS [a]
WHERE [a].[Key] = @__providedApiKey_0 AND [a].[IsActive] = CAST(1 AS bit)
2025-02-02 15:15:36.008 +03:00 [INF] Executed DbCommand (4ms) [Parameters=[@__request_NationalId_0='?' (Size = 450)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [c].[NationalId], [c].[AddNo], [c].[BuildingNo], [c].[City], [c].[Consent], [c].[ConsentDate], [c].[DateOfBirth], [c].[Dependents], [c].[District], [c].[Email], [c].[Employer], [c].[FamilyNameAr], [c].[FamilyNameEn], [c].[FirstNameAr], [c].[FirstNameEn], [c].[Iban], [c].[IdExpiryDate], [c].[Los], [c].[Mpin], [c].[MpinEnabled], [c].[NafathStatus], [c].[NafathTimestamp], [c].[Password], [c].[Phone], [c].[RegistrationDate], [c].[SalaryCustomer], [c].[SalaryDakhli], [c].[SecondNameAr], [c].[SecondNameEn], [c].[Sector], [c].[Street], [c].[ThirdNameAr], [c].[ThirdNameEn], [c].[Zipcode]
FROM [Customers] AS [c]
WHERE [c].[NationalId] = @__request_NationalId_0
2025-02-02 15:15:36.115 +03:00 [INF] Starting password verification for NationalId: 1064448614
2025-02-02 15:15:36.735 +03:00 [INF] Password verification result for NationalId 1064448614: Success
2025-02-02 15:15:37.008 +03:00 [INF] Executed DbCommand (51ms) [Parameters=[@__request_NationalId_0='?' (Size = 450), @__request_DeviceId_1='?' (Size = 450)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [c].[Id], [c].[BiometricEnabled], [c].[BiometricToken], [c].[CreatedAt], [c].[DeviceId], [c].[LastUsedAt], [c].[Manufacturer], [c].[Model], [c].[NationalId], [c].[OsVersion], [c].[Platform], [c].[Status]
FROM [Customer_Devices] AS [c]
WHERE [c].[NationalId] = @__request_NationalId_0 AND [c].[DeviceId] = @__request_DeviceId_1 AND [c].[Status] = N'active'
2025-02-02 15:15:37.578 +03:00 [INF] Executed DbCommand (180ms) [Parameters=[@p0='?' (Size = 4000), @p1='?' (DbType = DateTime2), @p2='?' (Size = 4000), @p3='?' (Size = 4000), @p4='?' (Size = 4000), @p5='?' (Size = 450), @p6='?' (Size = 4000), @p7='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SET IMPLICIT_TRANSACTIONS OFF;
SET NOCOUNT ON;
INSERT INTO [AuthLogs] ([AuthType], [CreatedAt], [DeviceId], [FailureReason], [IpAddress], [NationalId], [Status], [UserAgent])
OUTPUT INSERTED.[Id]
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7);
2025-02-02 15:15:37.630 +03:00 [INF] Executing ObjectResult, writing value of type '<>f__AnonymousType12`3[[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Object, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-02-02 15:15:37.650 +03:00 [INF] Executed action NayifatAPI.Controllers.AuthController.SignIn (NayifatAPI) in 1693.8735ms
2025-02-02 15:15:37.667 +03:00 [INF] Executed endpoint 'NayifatAPI.Controllers.AuthController.SignIn (NayifatAPI)'
2025-02-02 15:15:37.670 +03:00 [INF] Request finished HTTP/1.1 POST http://07ca-46-152-255-232.ngrok-free.app/api/auth/signin - 401 null application/json; charset=utf-8 1723.3896ms
2025-02-02 15:16:15.901 +03:00 [INF] Request starting HTTP/1.1 POST http://07ca-46-152-255-232.ngrok-free.app/api/auth/signin - application/json; charset=utf-8 224
2025-02-02 15:16:15.906 +03:00 [INF] Executing endpoint 'NayifatAPI.Controllers.AuthController.SignIn (NayifatAPI)'
2025-02-02 15:16:15.907 +03:00 [INF] Route matched with {action = "SignIn", controller = "Auth"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] SignIn(NayifatAPI.Controllers.SignInRequest) on controller NayifatAPI.Controllers.AuthController (NayifatAPI).
2025-02-02 15:16:15.912 +03:00 [INF] Executed DbCommand (3ms) [Parameters=[@__providedApiKey_0='?' (Size = 255)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [a].[Key], [a].[CreatedAt], [a].[Description], [a].[ExpiresAt], [a].[IsActive], [a].[LastUsedAt]
FROM [ApiKeys] AS [a]
WHERE [a].[Key] = @__providedApiKey_0 AND [a].[IsActive] = CAST(1 AS bit)
2025-02-02 15:16:15.919 +03:00 [INF] Executed DbCommand (4ms) [Parameters=[@__request_NationalId_0='?' (Size = 450)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [c].[NationalId], [c].[AddNo], [c].[BuildingNo], [c].[City], [c].[Consent], [c].[ConsentDate], [c].[DateOfBirth], [c].[Dependents], [c].[District], [c].[Email], [c].[Employer], [c].[FamilyNameAr], [c].[FamilyNameEn], [c].[FirstNameAr], [c].[FirstNameEn], [c].[Iban], [c].[IdExpiryDate], [c].[Los], [c].[Mpin], [c].[MpinEnabled], [c].[NafathStatus], [c].[NafathTimestamp], [c].[Password], [c].[Phone], [c].[RegistrationDate], [c].[SalaryCustomer], [c].[SalaryDakhli], [c].[SecondNameAr], [c].[SecondNameEn], [c].[Sector], [c].[Street], [c].[ThirdNameAr], [c].[ThirdNameEn], [c].[Zipcode]
FROM [Customers] AS [c]
WHERE [c].[NationalId] = @__request_NationalId_0
2025-02-02 15:16:15.922 +03:00 [INF] Starting password verification for NationalId: 1234567890
2025-02-02 15:16:16.111 +03:00 [INF] Password verification result for NationalId 1234567890: Failed
2025-02-02 15:16:16.119 +03:00 [INF] Executed DbCommand (6ms) [Parameters=[@p0='?' (Size = 4000), @p1='?' (DbType = DateTime2), @p2='?' (Size = 4000), @p3='?' (Size = 4000), @p4='?' (Size = 4000), @p5='?' (Size = 450), @p6='?' (Size = 4000), @p7='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SET IMPLICIT_TRANSACTIONS OFF;
SET NOCOUNT ON;
INSERT INTO [AuthLogs] ([AuthType], [CreatedAt], [DeviceId], [FailureReason], [IpAddress], [NationalId], [Status], [UserAgent])
OUTPUT INSERTED.[Id]
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7);
2025-02-02 15:16:16.122 +03:00 [INF] Executing ObjectResult, writing value of type '<>f__AnonymousType12`3[[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Object, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-02-02 15:16:16.123 +03:00 [INF] Executed action NayifatAPI.Controllers.AuthController.SignIn (NayifatAPI) in 214.8214ms
2025-02-02 15:16:16.125 +03:00 [INF] Executed endpoint 'NayifatAPI.Controllers.AuthController.SignIn (NayifatAPI)'
2025-02-02 15:16:16.126 +03:00 [INF] Request finished HTTP/1.1 POST http://07ca-46-152-255-232.ngrok-free.app/api/auth/signin - 401 null application/json; charset=utf-8 225.4539ms
2025-02-02 15:19:49.539 +03:00 [INF] Request starting HTTP/1.1 POST http://07ca-46-152-255-232.ngrok-free.app/api/auth/signin - application/json; charset=utf-8 224
2025-02-02 15:19:49.740 +03:00 [INF] Executing endpoint 'NayifatAPI.Controllers.AuthController.SignIn (NayifatAPI)'
2025-02-02 15:19:49.741 +03:00 [INF] Route matched with {action = "SignIn", controller = "Auth"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] SignIn(NayifatAPI.Controllers.SignInRequest) on controller NayifatAPI.Controllers.AuthController (NayifatAPI).
2025-02-02 15:19:49.779 +03:00 [INF] Executed DbCommand (9ms) [Parameters=[@__providedApiKey_0='?' (Size = 255)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [a].[Key], [a].[CreatedAt], [a].[Description], [a].[ExpiresAt], [a].[IsActive], [a].[LastUsedAt]
FROM [ApiKeys] AS [a]
WHERE [a].[Key] = @__providedApiKey_0 AND [a].[IsActive] = CAST(1 AS bit)
2025-02-02 15:19:49.881 +03:00 [INF] Executed DbCommand (76ms) [Parameters=[@__request_NationalId_0='?' (Size = 450)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [c].[NationalId], [c].[AddNo], [c].[BuildingNo], [c].[City], [c].[Consent], [c].[ConsentDate], [c].[DateOfBirth], [c].[Dependents], [c].[District], [c].[Email], [c].[Employer], [c].[FamilyNameAr], [c].[FamilyNameEn], [c].[FirstNameAr], [c].[FirstNameEn], [c].[Iban], [c].[IdExpiryDate], [c].[Los], [c].[Mpin], [c].[MpinEnabled], [c].[NafathStatus], [c].[NafathTimestamp], [c].[Password], [c].[Phone], [c].[RegistrationDate], [c].[SalaryCustomer], [c].[SalaryDakhli], [c].[SecondNameAr], [c].[SecondNameEn], [c].[Sector], [c].[Street], [c].[ThirdNameAr], [c].[ThirdNameEn], [c].[Zipcode]
FROM [Customers] AS [c]
WHERE [c].[NationalId] = @__request_NationalId_0
2025-02-02 15:19:50.064 +03:00 [INF] Starting password verification for NationalId: 1234567890
2025-02-02 15:19:50.799 +03:00 [INF] Password verification result for NationalId 1234567890: Success
2025-02-02 15:19:50.804 +03:00 [INF] Executed DbCommand (2ms) [Parameters=[@__request_NationalId_0='?' (Size = 450), @__request_DeviceId_1='?' (Size = 450)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [c].[Id], [c].[BiometricEnabled], [c].[BiometricToken], [c].[CreatedAt], [c].[DeviceId], [c].[LastUsedAt], [c].[Manufacturer], [c].[Model], [c].[NationalId], [c].[OsVersion], [c].[Platform], [c].[Status]
FROM [Customer_Devices] AS [c]
WHERE [c].[NationalId] = @__request_NationalId_0 AND [c].[DeviceId] = @__request_DeviceId_1 AND [c].[Status] = N'active'
2025-02-02 15:19:50.882 +03:00 [INF] Executed DbCommand (75ms) [Parameters=[@p0='?' (Size = 4000), @p1='?' (DbType = DateTime2), @p2='?' (Size = 4000), @p3='?' (Size = 4000), @p4='?' (Size = 4000), @p5='?' (Size = 450), @p6='?' (Size = 4000), @p7='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SET IMPLICIT_TRANSACTIONS OFF;
SET NOCOUNT ON;
INSERT INTO [AuthLogs] ([AuthType], [CreatedAt], [DeviceId], [FailureReason], [IpAddress], [NationalId], [Status], [UserAgent])
OUTPUT INSERTED.[Id]
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7);
2025-02-02 15:19:50.886 +03:00 [INF] Executing ObjectResult, writing value of type '<>f__AnonymousType12`3[[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Object, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-02-02 15:19:50.891 +03:00 [INF] Executed action NayifatAPI.Controllers.AuthController.SignIn (NayifatAPI) in 1146.528ms
2025-02-02 15:19:50.893 +03:00 [INF] Executed endpoint 'NayifatAPI.Controllers.AuthController.SignIn (NayifatAPI)'
2025-02-02 15:19:50.894 +03:00 [INF] Request finished HTTP/1.1 POST http://07ca-46-152-255-232.ngrok-free.app/api/auth/signin - 401 null application/json; charset=utf-8 1360.4074ms
2025-02-02 15:20:02.422 +03:00 [INF] Request starting HTTP/1.1 POST http://07ca-46-152-255-232.ngrok-free.app/api/notifications/list - application/json; charset=utf-8 47
2025-02-02 15:20:02.621 +03:00 [INF] Executing endpoint 'NayifatAPI.Controllers.NotificationsController.GetNotifications (NayifatAPI)'
2025-02-02 15:20:02.622 +03:00 [INF] Route matched with {action = "GetNotifications", controller = "Notifications"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetNotifications(NayifatAPI.Controllers.GetNotificationsRequest) on controller NayifatAPI.Controllers.NotificationsController (NayifatAPI).
2025-02-02 15:20:02.629 +03:00 [INF] Executed DbCommand (3ms) [Parameters=[@__providedApiKey_0='?' (Size = 255)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [a].[Key], [a].[CreatedAt], [a].[Description], [a].[ExpiresAt], [a].[IsActive], [a].[LastUsedAt]
FROM [ApiKeys] AS [a]
WHERE [a].[Key] = @__providedApiKey_0 AND [a].[IsActive] = CAST(1 AS bit)
2025-02-02 15:20:02.634 +03:00 [INF] Executed DbCommand (2ms) [Parameters=[@__request_NationalId_0='?' (Size = 450)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [u].[national_id], [u].[last_updated], [u].[notifications]
FROM [user_notifications] AS [u]
WHERE [u].[national_id] = @__request_NationalId_0
2025-02-02 15:20:02.655 +03:00 [INF] Executed DbCommand (11ms) [Parameters=[@__Parse_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [n].[Id], [n].[additional_data], [n].[Body], [n].[body_ar], [n].[body_en], [n].[created_at], [n].[expiry_at], [n].[Route], [n].[target_criteria], [n].[Title], [n].[title_ar], [n].[title_en]
FROM [notification_templates] AS [n]
WHERE [n].[Id] = @__Parse_0
2025-02-02 15:20:02.701 +03:00 [INF] Executed DbCommand (15ms) [Parameters=[@__Parse_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [n].[Id], [n].[additional_data], [n].[Body], [n].[body_ar], [n].[body_en], [n].[created_at], [n].[expiry_at], [n].[Route], [n].[target_criteria], [n].[Title], [n].[title_ar], [n].[title_en]
FROM [notification_templates] AS [n]
WHERE [n].[Id] = @__Parse_0
2025-02-02 15:20:02.849 +03:00 [INF] Executed DbCommand (130ms) [Parameters=[@p0='?' (Size = 4000), @p1='?' (DbType = DateTime2), @p2='?' (Size = 4000), @p3='?' (Size = 4000), @p4='?' (Size = 4000), @p5='?' (Size = 450), @p6='?' (Size = 4000), @p7='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SET IMPLICIT_TRANSACTIONS OFF;
SET NOCOUNT ON;
INSERT INTO [AuthLogs] ([AuthType], [CreatedAt], [DeviceId], [FailureReason], [IpAddress], [NationalId], [Status], [UserAgent])
OUTPUT INSERTED.[Id]
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7);
2025-02-02 15:20:02.919 +03:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType9`2[[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Object, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-02-02 15:20:02.921 +03:00 [INF] Executed action NayifatAPI.Controllers.NotificationsController.GetNotifications (NayifatAPI) in 296.0646ms
2025-02-02 15:20:02.923 +03:00 [INF] Executed endpoint 'NayifatAPI.Controllers.NotificationsController.GetNotifications (NayifatAPI)'
2025-02-02 15:20:02.925 +03:00 [INF] Request finished HTTP/1.1 POST http://07ca-46-152-255-232.ngrok-free.app/api/notifications/list - 200 null application/json; charset=utf-8 503.1987ms
2025-02-02 15:25:02.407 +03:00 [INF] Request starting HTTP/1.1 POST http://07ca-46-152-255-232.ngrok-free.app/api/notifications/list - application/json; charset=utf-8 47
2025-02-02 15:25:02.410 +03:00 [INF] Executing endpoint 'NayifatAPI.Controllers.NotificationsController.GetNotifications (NayifatAPI)'
2025-02-02 15:25:02.411 +03:00 [INF] Route matched with {action = "GetNotifications", controller = "Notifications"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetNotifications(NayifatAPI.Controllers.GetNotificationsRequest) on controller NayifatAPI.Controllers.NotificationsController (NayifatAPI).
2025-02-02 15:25:02.417 +03:00 [INF] Executed DbCommand (2ms) [Parameters=[@__providedApiKey_0='?' (Size = 255)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [a].[Key], [a].[CreatedAt], [a].[Description], [a].[ExpiresAt], [a].[IsActive], [a].[LastUsedAt]
FROM [ApiKeys] AS [a]
WHERE [a].[Key] = @__providedApiKey_0 AND [a].[IsActive] = CAST(1 AS bit)
2025-02-02 15:25:02.421 +03:00 [INF] Executed DbCommand (2ms) [Parameters=[@__request_NationalId_0='?' (Size = 450)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [u].[national_id], [u].[last_updated], [u].[notifications]
FROM [user_notifications] AS [u]
WHERE [u].[national_id] = @__request_NationalId_0
2025-02-02 15:25:02.425 +03:00 [INF] Executed DbCommand (2ms) [Parameters=[@__Parse_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [n].[Id], [n].[additional_data], [n].[Body], [n].[body_ar], [n].[body_en], [n].[created_at], [n].[expiry_at], [n].[Route], [n].[target_criteria], [n].[Title], [n].[title_ar], [n].[title_en]
FROM [notification_templates] AS [n]
WHERE [n].[Id] = @__Parse_0
2025-02-02 15:25:02.429 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@__Parse_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [n].[Id], [n].[additional_data], [n].[Body], [n].[body_ar], [n].[body_en], [n].[created_at], [n].[expiry_at], [n].[Route], [n].[target_criteria], [n].[Title], [n].[title_ar], [n].[title_en]
FROM [notification_templates] AS [n]
WHERE [n].[Id] = @__Parse_0
2025-02-02 15:25:02.507 +03:00 [INF] Executed DbCommand (75ms) [Parameters=[@p0='?' (Size = 4000), @p1='?' (DbType = DateTime2), @p2='?' (Size = 4000), @p3='?' (Size = 4000), @p4='?' (Size = 4000), @p5='?' (Size = 450), @p6='?' (Size = 4000), @p7='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SET IMPLICIT_TRANSACTIONS OFF;
SET NOCOUNT ON;
INSERT INTO [AuthLogs] ([AuthType], [CreatedAt], [DeviceId], [FailureReason], [IpAddress], [NationalId], [Status], [UserAgent])
OUTPUT INSERTED.[Id]
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7);
2025-02-02 15:25:02.510 +03:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType9`2[[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Object, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-02-02 15:25:02.511 +03:00 [INF] Executed action NayifatAPI.Controllers.NotificationsController.GetNotifications (NayifatAPI) in 98.1673ms
2025-02-02 15:25:02.512 +03:00 [INF] Executed endpoint 'NayifatAPI.Controllers.NotificationsController.GetNotifications (NayifatAPI)'
2025-02-02 15:25:02.513 +03:00 [INF] Request finished HTTP/1.1 POST http://07ca-46-152-255-232.ngrok-free.app/api/notifications/list - 200 null application/json; charset=utf-8 105.9409ms
2025-02-02 15:30:02.444 +03:00 [INF] Request starting HTTP/1.1 POST http://07ca-46-152-255-232.ngrok-free.app/api/notifications/list - application/json; charset=utf-8 47
2025-02-02 15:30:02.612 +03:00 [INF] Executing endpoint 'NayifatAPI.Controllers.NotificationsController.GetNotifications (NayifatAPI)'
2025-02-02 15:30:02.716 +03:00 [INF] Route matched with {action = "GetNotifications", controller = "Notifications"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetNotifications(NayifatAPI.Controllers.GetNotificationsRequest) on controller NayifatAPI.Controllers.NotificationsController (NayifatAPI).
2025-02-02 15:30:02.994 +03:00 [INF] Executed DbCommand (14ms) [Parameters=[@__providedApiKey_0='?' (Size = 255)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [a].[Key], [a].[CreatedAt], [a].[Description], [a].[ExpiresAt], [a].[IsActive], [a].[LastUsedAt]
FROM [ApiKeys] AS [a]
WHERE [a].[Key] = @__providedApiKey_0 AND [a].[IsActive] = CAST(1 AS bit)
2025-02-02 15:30:03.004 +03:00 [INF] Executed DbCommand (7ms) [Parameters=[@__request_NationalId_0='?' (Size = 450)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [u].[national_id], [u].[last_updated], [u].[notifications]
FROM [user_notifications] AS [u]
WHERE [u].[national_id] = @__request_NationalId_0
2025-02-02 15:30:03.037 +03:00 [INF] Executed DbCommand (14ms) [Parameters=[@__Parse_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [n].[Id], [n].[additional_data], [n].[Body], [n].[body_ar], [n].[body_en], [n].[created_at], [n].[expiry_at], [n].[Route], [n].[target_criteria], [n].[Title], [n].[title_ar], [n].[title_en]
FROM [notification_templates] AS [n]
WHERE [n].[Id] = @__Parse_0
2025-02-02 15:30:03.064 +03:00 [INF] Executed DbCommand (14ms) [Parameters=[@__Parse_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [n].[Id], [n].[additional_data], [n].[Body], [n].[body_ar], [n].[body_en], [n].[created_at], [n].[expiry_at], [n].[Route], [n].[target_criteria], [n].[Title], [n].[title_ar], [n].[title_en]
FROM [notification_templates] AS [n]
WHERE [n].[Id] = @__Parse_0
2025-02-02 15:30:03.191 +03:00 [INF] Executed DbCommand (112ms) [Parameters=[@p0='?' (Size = 4000), @p1='?' (DbType = DateTime2), @p2='?' (Size = 4000), @p3='?' (Size = 4000), @p4='?' (Size = 4000), @p5='?' (Size = 450), @p6='?' (Size = 4000), @p7='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SET IMPLICIT_TRANSACTIONS OFF;
SET NOCOUNT ON;
INSERT INTO [AuthLogs] ([AuthType], [CreatedAt], [DeviceId], [FailureReason], [IpAddress], [NationalId], [Status], [UserAgent])
OUTPUT INSERTED.[Id]
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7);
2025-02-02 15:30:03.217 +03:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType9`2[[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Object, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-02-02 15:30:03.234 +03:00 [INF] Executed action NayifatAPI.Controllers.NotificationsController.GetNotifications (NayifatAPI) in 309.4966ms
2025-02-02 15:30:03.264 +03:00 [INF] Executed endpoint 'NayifatAPI.Controllers.NotificationsController.GetNotifications (NayifatAPI)'
2025-02-02 15:30:03.300 +03:00 [INF] Request finished HTTP/1.1 POST http://07ca-46-152-255-232.ngrok-free.app/api/notifications/list - 200 null application/json; charset=utf-8 855.7523ms
2025-02-02 15:35:02.808 +03:00 [INF] Request starting HTTP/1.1 POST http://07ca-46-152-255-232.ngrok-free.app/api/notifications/list - application/json; charset=utf-8 47
2025-02-02 15:35:02.811 +03:00 [INF] Executing endpoint 'NayifatAPI.Controllers.NotificationsController.GetNotifications (NayifatAPI)'
2025-02-02 15:35:02.812 +03:00 [INF] Route matched with {action = "GetNotifications", controller = "Notifications"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetNotifications(NayifatAPI.Controllers.GetNotificationsRequest) on controller NayifatAPI.Controllers.NotificationsController (NayifatAPI).
2025-02-02 15:35:02.818 +03:00 [INF] Executed DbCommand (3ms) [Parameters=[@__providedApiKey_0='?' (Size = 255)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [a].[Key], [a].[CreatedAt], [a].[Description], [a].[ExpiresAt], [a].[IsActive], [a].[LastUsedAt]
FROM [ApiKeys] AS [a]
WHERE [a].[Key] = @__providedApiKey_0 AND [a].[IsActive] = CAST(1 AS bit)
2025-02-02 15:35:02.824 +03:00 [INF] Executed DbCommand (2ms) [Parameters=[@__request_NationalId_0='?' (Size = 450)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [u].[national_id], [u].[last_updated], [u].[notifications]
FROM [user_notifications] AS [u]
WHERE [u].[national_id] = @__request_NationalId_0
2025-02-02 15:35:02.827 +03:00 [INF] Executed DbCommand (2ms) [Parameters=[@__Parse_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [n].[Id], [n].[additional_data], [n].[Body], [n].[body_ar], [n].[body_en], [n].[created_at], [n].[expiry_at], [n].[Route], [n].[target_criteria], [n].[Title], [n].[title_ar], [n].[title_en]
FROM [notification_templates] AS [n]
WHERE [n].[Id] = @__Parse_0
2025-02-02 15:35:02.830 +03:00 [INF] Executed DbCommand (0ms) [Parameters=[@__Parse_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [n].[Id], [n].[additional_data], [n].[Body], [n].[body_ar], [n].[body_en], [n].[created_at], [n].[expiry_at], [n].[Route], [n].[target_criteria], [n].[Title], [n].[title_ar], [n].[title_en]
FROM [notification_templates] AS [n]
WHERE [n].[Id] = @__Parse_0
2025-02-02 15:35:02.842 +03:00 [INF] Executed DbCommand (11ms) [Parameters=[@p0='?' (Size = 4000), @p1='?' (DbType = DateTime2), @p2='?' (Size = 4000), @p3='?' (Size = 4000), @p4='?' (Size = 4000), @p5='?' (Size = 450), @p6='?' (Size = 4000), @p7='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SET IMPLICIT_TRANSACTIONS OFF;
SET NOCOUNT ON;
INSERT INTO [AuthLogs] ([AuthType], [CreatedAt], [DeviceId], [FailureReason], [IpAddress], [NationalId], [Status], [UserAgent])
OUTPUT INSERTED.[Id]
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7);
2025-02-02 15:35:02.845 +03:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType9`2[[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Object, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-02-02 15:35:02.846 +03:00 [INF] Executed action NayifatAPI.Controllers.NotificationsController.GetNotifications (NayifatAPI) in 33.2969ms
2025-02-02 15:35:02.847 +03:00 [INF] Executed endpoint 'NayifatAPI.Controllers.NotificationsController.GetNotifications (NayifatAPI)'
2025-02-02 15:35:02.848 +03:00 [INF] Request finished HTTP/1.1 POST http://07ca-46-152-255-232.ngrok-free.app/api/notifications/list - 200 null application/json; charset=utf-8 39.8943ms
2025-02-02 18:06:04.104 +03:00 [INF] Request starting HTTP/1.1 POST http://07ca-46-152-255-232.ngrok-free.app/api/notifications/list - application/json; charset=utf-8 47
2025-02-02 18:06:04.108 +03:00 [INF] Executing endpoint 'NayifatAPI.Controllers.NotificationsController.GetNotifications (NayifatAPI)'
2025-02-02 18:06:04.108 +03:00 [INF] Route matched with {action = "GetNotifications", controller = "Notifications"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetNotifications(NayifatAPI.Controllers.GetNotificationsRequest) on controller NayifatAPI.Controllers.NotificationsController (NayifatAPI).
2025-02-02 18:06:04.193 +03:00 [INF] Executed DbCommand (77ms) [Parameters=[@__providedApiKey_0='?' (Size = 255)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [a].[Key], [a].[CreatedAt], [a].[Description], [a].[ExpiresAt], [a].[IsActive], [a].[LastUsedAt]
FROM [ApiKeys] AS [a]
WHERE [a].[Key] = @__providedApiKey_0 AND [a].[IsActive] = CAST(1 AS bit)
2025-02-02 18:06:04.201 +03:00 [INF] Executed DbCommand (4ms) [Parameters=[@__request_NationalId_0='?' (Size = 450)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [u].[national_id], [u].[last_updated], [u].[notifications]
FROM [user_notifications] AS [u]
WHERE [u].[national_id] = @__request_NationalId_0
2025-02-02 18:06:04.213 +03:00 [INF] Executed DbCommand (2ms) [Parameters=[@__Parse_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [n].[Id], [n].[additional_data], [n].[Body], [n].[body_ar], [n].[body_en], [n].[created_at], [n].[expiry_at], [n].[Route], [n].[target_criteria], [n].[Title], [n].[title_ar], [n].[title_en]
FROM [notification_templates] AS [n]
WHERE [n].[Id] = @__Parse_0
2025-02-02 18:06:04.218 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@__Parse_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [n].[Id], [n].[additional_data], [n].[Body], [n].[body_ar], [n].[body_en], [n].[created_at], [n].[expiry_at], [n].[Route], [n].[target_criteria], [n].[Title], [n].[title_ar], [n].[title_en]
FROM [notification_templates] AS [n]
WHERE [n].[Id] = @__Parse_0
2025-02-02 18:06:04.226 +03:00 [INF] Executed DbCommand (5ms) [Parameters=[@p0='?' (Size = 4000), @p1='?' (DbType = DateTime2), @p2='?' (Size = 4000), @p3='?' (Size = 4000), @p4='?' (Size = 4000), @p5='?' (Size = 450), @p6='?' (Size = 4000), @p7='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SET IMPLICIT_TRANSACTIONS OFF;
SET NOCOUNT ON;
INSERT INTO [AuthLogs] ([AuthType], [CreatedAt], [DeviceId], [FailureReason], [IpAddress], [NationalId], [Status], [UserAgent])
OUTPUT INSERTED.[Id]
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7);
2025-02-02 18:06:04.233 +03:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType9`2[[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Object, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-02-02 18:06:04.235 +03:00 [INF] Executed action NayifatAPI.Controllers.NotificationsController.GetNotifications (NayifatAPI) in 125.0933ms
2025-02-02 18:06:04.237 +03:00 [INF] Executed endpoint 'NayifatAPI.Controllers.NotificationsController.GetNotifications (NayifatAPI)'
2025-02-02 18:06:04.240 +03:00 [INF] Request finished HTTP/1.1 POST http://07ca-46-152-255-232.ngrok-free.app/api/notifications/list - 200 null application/json; charset=utf-8 136.089ms
2025-02-02 18:21:05.354 +03:00 [INF] Request starting HTTP/1.1 POST http://07ca-46-152-255-232.ngrok-free.app/api/notifications/list - application/json; charset=utf-8 47
2025-02-02 18:21:05.357 +03:00 [INF] Executing endpoint 'NayifatAPI.Controllers.NotificationsController.GetNotifications (NayifatAPI)'
2025-02-02 18:21:05.358 +03:00 [INF] Route matched with {action = "GetNotifications", controller = "Notifications"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetNotifications(NayifatAPI.Controllers.GetNotificationsRequest) on controller NayifatAPI.Controllers.NotificationsController (NayifatAPI).
2025-02-02 18:21:05.375 +03:00 [INF] Executed DbCommand (8ms) [Parameters=[@__providedApiKey_0='?' (Size = 255)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [a].[Key], [a].[CreatedAt], [a].[Description], [a].[ExpiresAt], [a].[IsActive], [a].[LastUsedAt]
FROM [ApiKeys] AS [a]
WHERE [a].[Key] = @__providedApiKey_0 AND [a].[IsActive] = CAST(1 AS bit)
2025-02-02 18:21:05.402 +03:00 [INF] Executed DbCommand (25ms) [Parameters=[@__request_NationalId_0='?' (Size = 450)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [u].[national_id], [u].[last_updated], [u].[notifications]
FROM [user_notifications] AS [u]
WHERE [u].[national_id] = @__request_NationalId_0
2025-02-02 18:21:05.518 +03:00 [INF] Executed DbCommand (3ms) [Parameters=[@__Parse_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [n].[Id], [n].[additional_data], [n].[Body], [n].[body_ar], [n].[body_en], [n].[created_at], [n].[expiry_at], [n].[Route], [n].[target_criteria], [n].[Title], [n].[title_ar], [n].[title_en]
FROM [notification_templates] AS [n]
WHERE [n].[Id] = @__Parse_0
2025-02-02 18:21:05.638 +03:00 [INF] Executed DbCommand (97ms) [Parameters=[@__Parse_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [n].[Id], [n].[additional_data], [n].[Body], [n].[body_ar], [n].[body_en], [n].[created_at], [n].[expiry_at], [n].[Route], [n].[target_criteria], [n].[Title], [n].[title_ar], [n].[title_en]
FROM [notification_templates] AS [n]
WHERE [n].[Id] = @__Parse_0
2025-02-02 18:21:05.796 +03:00 [INF] Executed DbCommand (121ms) [Parameters=[@p0='?' (Size = 4000), @p1='?' (DbType = DateTime2), @p2='?' (Size = 4000), @p3='?' (Size = 4000), @p4='?' (Size = 4000), @p5='?' (Size = 450), @p6='?' (Size = 4000), @p7='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SET IMPLICIT_TRANSACTIONS OFF;
SET NOCOUNT ON;
INSERT INTO [AuthLogs] ([AuthType], [CreatedAt], [DeviceId], [FailureReason], [IpAddress], [NationalId], [Status], [UserAgent])
OUTPUT INSERTED.[Id]
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7);
2025-02-02 18:21:05.799 +03:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType9`2[[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Object, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-02-02 18:21:05.801 +03:00 [INF] Executed action NayifatAPI.Controllers.NotificationsController.GetNotifications (NayifatAPI) in 441.1761ms
2025-02-02 18:21:05.802 +03:00 [INF] Executed endpoint 'NayifatAPI.Controllers.NotificationsController.GetNotifications (NayifatAPI)'
2025-02-02 18:21:05.804 +03:00 [INF] Request finished HTTP/1.1 POST http://07ca-46-152-255-232.ngrok-free.app/api/notifications/list - 200 null application/json; charset=utf-8 449.3057ms
2025-02-02 18:34:48.254 +03:00 [INF] Request starting HTTP/1.1 POST http://07ca-46-152-255-232.ngrok-free.app/api/notifications/list - application/json; charset=utf-8 47
2025-02-02 18:34:48.258 +03:00 [INF] Executing endpoint 'NayifatAPI.Controllers.NotificationsController.GetNotifications (NayifatAPI)'
2025-02-02 18:34:48.259 +03:00 [INF] Route matched with {action = "GetNotifications", controller = "Notifications"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetNotifications(NayifatAPI.Controllers.GetNotificationsRequest) on controller NayifatAPI.Controllers.NotificationsController (NayifatAPI).
2025-02-02 18:34:48.277 +03:00 [INF] Executed DbCommand (3ms) [Parameters=[@__providedApiKey_0='?' (Size = 255)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [a].[Key], [a].[CreatedAt], [a].[Description], [a].[ExpiresAt], [a].[IsActive], [a].[LastUsedAt]
FROM [ApiKeys] AS [a]
WHERE [a].[Key] = @__providedApiKey_0 AND [a].[IsActive] = CAST(1 AS bit)
2025-02-02 18:34:48.282 +03:00 [INF] Executed DbCommand (2ms) [Parameters=[@__request_NationalId_0='?' (Size = 450)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [u].[national_id], [u].[last_updated], [u].[notifications]
FROM [user_notifications] AS [u]
WHERE [u].[national_id] = @__request_NationalId_0
2025-02-02 18:34:48.288 +03:00 [INF] Executed DbCommand (3ms) [Parameters=[@__Parse_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [n].[Id], [n].[additional_data], [n].[Body], [n].[body_ar], [n].[body_en], [n].[created_at], [n].[expiry_at], [n].[Route], [n].[target_criteria], [n].[Title], [n].[title_ar], [n].[title_en]
FROM [notification_templates] AS [n]
WHERE [n].[Id] = @__Parse_0
2025-02-02 18:34:48.291 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@__Parse_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [n].[Id], [n].[additional_data], [n].[Body], [n].[body_ar], [n].[body_en], [n].[created_at], [n].[expiry_at], [n].[Route], [n].[target_criteria], [n].[Title], [n].[title_ar], [n].[title_en]
FROM [notification_templates] AS [n]
WHERE [n].[Id] = @__Parse_0
2025-02-02 18:34:48.302 +03:00 [INF] Executed DbCommand (9ms) [Parameters=[@p0='?' (Size = 4000), @p1='?' (DbType = DateTime2), @p2='?' (Size = 4000), @p3='?' (Size = 4000), @p4='?' (Size = 4000), @p5='?' (Size = 450), @p6='?' (Size = 4000), @p7='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SET IMPLICIT_TRANSACTIONS OFF;
SET NOCOUNT ON;
INSERT INTO [AuthLogs] ([AuthType], [CreatedAt], [DeviceId], [FailureReason], [IpAddress], [NationalId], [Status], [UserAgent])
OUTPUT INSERTED.[Id]
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7);
2025-02-02 18:34:48.305 +03:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType9`2[[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Object, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-02-02 18:34:48.306 +03:00 [INF] Executed action NayifatAPI.Controllers.NotificationsController.GetNotifications (NayifatAPI) in 44.3295ms
2025-02-02 18:34:48.308 +03:00 [INF] Executed endpoint 'NayifatAPI.Controllers.NotificationsController.GetNotifications (NayifatAPI)'
2025-02-02 18:34:48.310 +03:00 [INF] Request finished HTTP/1.1 POST http://07ca-46-152-255-232.ngrok-free.app/api/notifications/list - 200 null application/json; charset=utf-8 56.3791ms
2025-02-02 18:35:44.546 +03:00 [INF] Request starting HTTP/1.1 POST http://07ca-46-152-255-232.ngrok-free.app/api/auth/signin - application/json; charset=utf-8 224
2025-02-02 18:35:44.548 +03:00 [INF] Executing endpoint 'NayifatAPI.Controllers.AuthController.SignIn (NayifatAPI)'
2025-02-02 18:35:44.549 +03:00 [INF] Route matched with {action = "SignIn", controller = "Auth"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] SignIn(NayifatAPI.Controllers.SignInRequest) on controller NayifatAPI.Controllers.AuthController (NayifatAPI).
2025-02-02 18:35:44.557 +03:00 [INF] Executed DbCommand (6ms) [Parameters=[@__providedApiKey_0='?' (Size = 255)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [a].[Key], [a].[CreatedAt], [a].[Description], [a].[ExpiresAt], [a].[IsActive], [a].[LastUsedAt]
FROM [ApiKeys] AS [a]
WHERE [a].[Key] = @__providedApiKey_0 AND [a].[IsActive] = CAST(1 AS bit)
2025-02-02 18:35:44.566 +03:00 [INF] Executed DbCommand (5ms) [Parameters=[@__request_NationalId_0='?' (Size = 450)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [c].[NationalId], [c].[AddNo], [c].[BuildingNo], [c].[City], [c].[Consent], [c].[ConsentDate], [c].[DateOfBirth], [c].[Dependents], [c].[District], [c].[Email], [c].[Employer], [c].[FamilyNameAr], [c].[FamilyNameEn], [c].[FirstNameAr], [c].[FirstNameEn], [c].[Iban], [c].[IdExpiryDate], [c].[Los], [c].[Mpin], [c].[MpinEnabled], [c].[NafathStatus], [c].[NafathTimestamp], [c].[Password], [c].[Phone], [c].[RegistrationDate], [c].[SalaryCustomer], [c].[SalaryDakhli], [c].[SecondNameAr], [c].[SecondNameEn], [c].[Sector], [c].[Street], [c].[ThirdNameAr], [c].[ThirdNameEn], [c].[Zipcode]
FROM [Customers] AS [c]
WHERE [c].[NationalId] = @__request_NationalId_0
2025-02-02 18:35:44.568 +03:00 [INF] Starting password verification for NationalId: 1064448614
2025-02-02 18:35:44.766 +03:00 [INF] Password verification result for NationalId 1064448614: Success
2025-02-02 18:35:44.770 +03:00 [INF] Executed DbCommand (3ms) [Parameters=[@__request_NationalId_0='?' (Size = 450), @__request_DeviceId_1='?' (Size = 450)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [c].[Id], [c].[BiometricEnabled], [c].[BiometricToken], [c].[CreatedAt], [c].[DeviceId], [c].[LastUsedAt], [c].[Manufacturer], [c].[Model], [c].[NationalId], [c].[OsVersion], [c].[Platform], [c].[Status]
FROM [Customer_Devices] AS [c]
WHERE [c].[NationalId] = @__request_NationalId_0 AND [c].[DeviceId] = @__request_DeviceId_1 AND [c].[Status] = N'active'
2025-02-02 18:35:44.851 +03:00 [INF] Executed DbCommand (78ms) [Parameters=[@p0='?' (Size = 4000), @p1='?' (DbType = DateTime2), @p2='?' (Size = 4000), @p3='?' (Size = 4000), @p4='?' (Size = 4000), @p5='?' (Size = 450), @p6='?' (Size = 4000), @p7='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SET IMPLICIT_TRANSACTIONS OFF;
SET NOCOUNT ON;
INSERT INTO [AuthLogs] ([AuthType], [CreatedAt], [DeviceId], [FailureReason], [IpAddress], [NationalId], [Status], [UserAgent])
OUTPUT INSERTED.[Id]
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7);
2025-02-02 18:35:44.854 +03:00 [INF] Executing ObjectResult, writing value of type '<>f__AnonymousType12`3[[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Object, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-02-02 18:35:44.856 +03:00 [INF] Executed action NayifatAPI.Controllers.AuthController.SignIn (NayifatAPI) in 305.2137ms
2025-02-02 18:35:44.857 +03:00 [INF] Executed endpoint 'NayifatAPI.Controllers.AuthController.SignIn (NayifatAPI)'
2025-02-02 18:35:44.859 +03:00 [INF] Request finished HTTP/1.1 POST http://07ca-46-152-255-232.ngrok-free.app/api/auth/signin - 401 null application/json; charset=utf-8 312.2559ms
2025-02-02 18:39:49.430 +03:00 [INF] Request starting HTTP/1.1 POST http://07ca-46-152-255-232.ngrok-free.app/api/notifications/list - application/json; charset=utf-8 47
2025-02-02 18:39:49.439 +03:00 [INF] Executing endpoint 'NayifatAPI.Controllers.NotificationsController.GetNotifications (NayifatAPI)'
2025-02-02 18:39:49.440 +03:00 [INF] Route matched with {action = "GetNotifications", controller = "Notifications"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetNotifications(NayifatAPI.Controllers.GetNotificationsRequest) on controller NayifatAPI.Controllers.NotificationsController (NayifatAPI).
2025-02-02 18:39:49.449 +03:00 [INF] Executed DbCommand (2ms) [Parameters=[@__providedApiKey_0='?' (Size = 255)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [a].[Key], [a].[CreatedAt], [a].[Description], [a].[ExpiresAt], [a].[IsActive], [a].[LastUsedAt]
FROM [ApiKeys] AS [a]
WHERE [a].[Key] = @__providedApiKey_0 AND [a].[IsActive] = CAST(1 AS bit)
2025-02-02 18:39:49.454 +03:00 [INF] Executed DbCommand (3ms) [Parameters=[@__request_NationalId_0='?' (Size = 450)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [u].[national_id], [u].[last_updated], [u].[notifications]
FROM [user_notifications] AS [u]
WHERE [u].[national_id] = @__request_NationalId_0
2025-02-02 18:39:49.459 +03:00 [INF] Executed DbCommand (2ms) [Parameters=[@__Parse_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [n].[Id], [n].[additional_data], [n].[Body], [n].[body_ar], [n].[body_en], [n].[created_at], [n].[expiry_at], [n].[Route], [n].[target_criteria], [n].[Title], [n].[title_ar], [n].[title_en]
FROM [notification_templates] AS [n]
WHERE [n].[Id] = @__Parse_0
2025-02-02 18:39:49.461 +03:00 [INF] Executed DbCommand (0ms) [Parameters=[@__Parse_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [n].[Id], [n].[additional_data], [n].[Body], [n].[body_ar], [n].[body_en], [n].[created_at], [n].[expiry_at], [n].[Route], [n].[target_criteria], [n].[Title], [n].[title_ar], [n].[title_en]
FROM [notification_templates] AS [n]
WHERE [n].[Id] = @__Parse_0
2025-02-02 18:39:49.539 +03:00 [INF] Executed DbCommand (75ms) [Parameters=[@p0='?' (Size = 4000), @p1='?' (DbType = DateTime2), @p2='?' (Size = 4000), @p3='?' (Size = 4000), @p4='?' (Size = 4000), @p5='?' (Size = 450), @p6='?' (Size = 4000), @p7='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SET IMPLICIT_TRANSACTIONS OFF;
SET NOCOUNT ON;
INSERT INTO [AuthLogs] ([AuthType], [CreatedAt], [DeviceId], [FailureReason], [IpAddress], [NationalId], [Status], [UserAgent])
OUTPUT INSERTED.[Id]
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7);
2025-02-02 18:39:49.542 +03:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType9`2[[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Object, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-02-02 18:39:49.543 +03:00 [INF] Executed action NayifatAPI.Controllers.NotificationsController.GetNotifications (NayifatAPI) in 101.2607ms
2025-02-02 18:39:49.544 +03:00 [INF] Executed endpoint 'NayifatAPI.Controllers.NotificationsController.GetNotifications (NayifatAPI)'
2025-02-02 18:39:49.546 +03:00 [INF] Request finished HTTP/1.1 POST http://07ca-46-152-255-232.ngrok-free.app/api/notifications/list - 200 null application/json; charset=utf-8 116.559ms
2025-02-02 18:44:49.504 +03:00 [INF] Request starting HTTP/1.1 POST http://07ca-46-152-255-232.ngrok-free.app/api/notifications/list - application/json; charset=utf-8 47
2025-02-02 18:44:49.510 +03:00 [INF] Executing endpoint 'NayifatAPI.Controllers.NotificationsController.GetNotifications (NayifatAPI)'
2025-02-02 18:44:49.512 +03:00 [INF] Route matched with {action = "GetNotifications", controller = "Notifications"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetNotifications(NayifatAPI.Controllers.GetNotificationsRequest) on controller NayifatAPI.Controllers.NotificationsController (NayifatAPI).
2025-02-02 18:44:49.651 +03:00 [INF] Executed DbCommand (39ms) [Parameters=[@__providedApiKey_0='?' (Size = 255)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [a].[Key], [a].[CreatedAt], [a].[Description], [a].[ExpiresAt], [a].[IsActive], [a].[LastUsedAt]
FROM [ApiKeys] AS [a]
WHERE [a].[Key] = @__providedApiKey_0 AND [a].[IsActive] = CAST(1 AS bit)
2025-02-02 18:44:49.710 +03:00 [INF] Executed DbCommand (55ms) [Parameters=[@__request_NationalId_0='?' (Size = 450)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [u].[national_id], [u].[last_updated], [u].[notifications]
FROM [user_notifications] AS [u]
WHERE [u].[national_id] = @__request_NationalId_0
2025-02-02 18:44:49.834 +03:00 [INF] Executed DbCommand (53ms) [Parameters=[@__Parse_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [n].[Id], [n].[additional_data], [n].[Body], [n].[body_ar], [n].[body_en], [n].[created_at], [n].[expiry_at], [n].[Route], [n].[target_criteria], [n].[Title], [n].[title_ar], [n].[title_en]
FROM [notification_templates] AS [n]
WHERE [n].[Id] = @__Parse_0
2025-02-02 18:44:49.841 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@__Parse_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [n].[Id], [n].[additional_data], [n].[Body], [n].[body_ar], [n].[body_en], [n].[created_at], [n].[expiry_at], [n].[Route], [n].[target_criteria], [n].[Title], [n].[title_ar], [n].[title_en]
FROM [notification_templates] AS [n]
WHERE [n].[Id] = @__Parse_0
2025-02-02 18:44:49.901 +03:00 [INF] Executed DbCommand (51ms) [Parameters=[@p0='?' (Size = 4000), @p1='?' (DbType = DateTime2), @p2='?' (Size = 4000), @p3='?' (Size = 4000), @p4='?' (Size = 4000), @p5='?' (Size = 450), @p6='?' (Size = 4000), @p7='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SET IMPLICIT_TRANSACTIONS OFF;
SET NOCOUNT ON;
INSERT INTO [AuthLogs] ([AuthType], [CreatedAt], [DeviceId], [FailureReason], [IpAddress], [NationalId], [Status], [UserAgent])
OUTPUT INSERTED.[Id]
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7);
2025-02-02 18:44:49.904 +03:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType9`2[[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Object, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-02-02 18:44:49.906 +03:00 [INF] Executed action NayifatAPI.Controllers.NotificationsController.GetNotifications (NayifatAPI) in 391.5997ms
2025-02-02 18:44:49.907 +03:00 [INF] Executed endpoint 'NayifatAPI.Controllers.NotificationsController.GetNotifications (NayifatAPI)'
2025-02-02 18:44:49.909 +03:00 [INF] Request finished HTTP/1.1 POST http://07ca-46-152-255-232.ngrok-free.app/api/notifications/list - 200 null application/json; charset=utf-8 404.1623ms
2025-02-02 18:49:49.864 +03:00 [INF] Request starting HTTP/1.1 POST http://07ca-46-152-255-232.ngrok-free.app/api/notifications/list - application/json; charset=utf-8 47
2025-02-02 18:49:49.866 +03:00 [INF] Executing endpoint 'NayifatAPI.Controllers.NotificationsController.GetNotifications (NayifatAPI)'
2025-02-02 18:49:49.867 +03:00 [INF] Route matched with {action = "GetNotifications", controller = "Notifications"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetNotifications(NayifatAPI.Controllers.GetNotificationsRequest) on controller NayifatAPI.Controllers.NotificationsController (NayifatAPI).
2025-02-02 18:49:49.872 +03:00 [INF] Executed DbCommand (2ms) [Parameters=[@__providedApiKey_0='?' (Size = 255)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [a].[Key], [a].[CreatedAt], [a].[Description], [a].[ExpiresAt], [a].[IsActive], [a].[LastUsedAt]
FROM [ApiKeys] AS [a]
WHERE [a].[Key] = @__providedApiKey_0 AND [a].[IsActive] = CAST(1 AS bit)
2025-02-02 18:49:49.879 +03:00 [INF] Executed DbCommand (3ms) [Parameters=[@__request_NationalId_0='?' (Size = 450)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [u].[national_id], [u].[last_updated], [u].[notifications]
FROM [user_notifications] AS [u]
WHERE [u].[national_id] = @__request_NationalId_0
2025-02-02 18:49:49.883 +03:00 [INF] Executed DbCommand (2ms) [Parameters=[@__Parse_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [n].[Id], [n].[additional_data], [n].[Body], [n].[body_ar], [n].[body_en], [n].[created_at], [n].[expiry_at], [n].[Route], [n].[target_criteria], [n].[Title], [n].[title_ar], [n].[title_en]
FROM [notification_templates] AS [n]
WHERE [n].[Id] = @__Parse_0
2025-02-02 18:49:49.886 +03:00 [INF] Executed DbCommand (0ms) [Parameters=[@__Parse_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [n].[Id], [n].[additional_data], [n].[Body], [n].[body_ar], [n].[body_en], [n].[created_at], [n].[expiry_at], [n].[Route], [n].[target_criteria], [n].[Title], [n].[title_ar], [n].[title_en]
FROM [notification_templates] AS [n]
WHERE [n].[Id] = @__Parse_0
2025-02-02 18:49:49.965 +03:00 [INF] Executed DbCommand (77ms) [Parameters=[@p0='?' (Size = 4000), @p1='?' (DbType = DateTime2), @p2='?' (Size = 4000), @p3='?' (Size = 4000), @p4='?' (Size = 4000), @p5='?' (Size = 450), @p6='?' (Size = 4000), @p7='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SET IMPLICIT_TRANSACTIONS OFF;
SET NOCOUNT ON;
INSERT INTO [AuthLogs] ([AuthType], [CreatedAt], [DeviceId], [FailureReason], [IpAddress], [NationalId], [Status], [UserAgent])
OUTPUT INSERTED.[Id]
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7);
2025-02-02 18:49:49.968 +03:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType9`2[[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Object, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-02-02 18:49:49.969 +03:00 [INF] Executed action NayifatAPI.Controllers.NotificationsController.GetNotifications (NayifatAPI) in 100.4954ms
2025-02-02 18:49:49.970 +03:00 [INF] Executed endpoint 'NayifatAPI.Controllers.NotificationsController.GetNotifications (NayifatAPI)'
2025-02-02 18:49:49.971 +03:00 [INF] Request finished HTTP/1.1 POST http://07ca-46-152-255-232.ngrok-free.app/api/notifications/list - 200 null application/json; charset=utf-8 106.9699ms
2025-02-02 18:54:49.886 +03:00 [INF] Request starting HTTP/1.1 POST http://07ca-46-152-255-232.ngrok-free.app/api/notifications/list - application/json; charset=utf-8 47
2025-02-02 18:54:49.894 +03:00 [INF] Executing endpoint 'NayifatAPI.Controllers.NotificationsController.GetNotifications (NayifatAPI)'
2025-02-02 18:54:49.896 +03:00 [INF] Route matched with {action = "GetNotifications", controller = "Notifications"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetNotifications(NayifatAPI.Controllers.GetNotificationsRequest) on controller NayifatAPI.Controllers.NotificationsController (NayifatAPI).
2025-02-02 18:54:49.903 +03:00 [INF] Executed DbCommand (4ms) [Parameters=[@__providedApiKey_0='?' (Size = 255)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [a].[Key], [a].[CreatedAt], [a].[Description], [a].[ExpiresAt], [a].[IsActive], [a].[LastUsedAt]
FROM [ApiKeys] AS [a]
WHERE [a].[Key] = @__providedApiKey_0 AND [a].[IsActive] = CAST(1 AS bit)
2025-02-02 18:54:49.908 +03:00 [INF] Executed DbCommand (2ms) [Parameters=[@__request_NationalId_0='?' (Size = 450)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [u].[national_id], [u].[last_updated], [u].[notifications]
FROM [user_notifications] AS [u]
WHERE [u].[national_id] = @__request_NationalId_0
2025-02-02 18:54:49.912 +03:00 [INF] Executed DbCommand (2ms) [Parameters=[@__Parse_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [n].[Id], [n].[additional_data], [n].[Body], [n].[body_ar], [n].[body_en], [n].[created_at], [n].[expiry_at], [n].[Route], [n].[target_criteria], [n].[Title], [n].[title_ar], [n].[title_en]
FROM [notification_templates] AS [n]
WHERE [n].[Id] = @__Parse_0
2025-02-02 18:54:49.915 +03:00 [INF] Executed DbCommand (0ms) [Parameters=[@__Parse_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [n].[Id], [n].[additional_data], [n].[Body], [n].[body_ar], [n].[body_en], [n].[created_at], [n].[expiry_at], [n].[Route], [n].[target_criteria], [n].[Title], [n].[title_ar], [n].[title_en]
FROM [notification_templates] AS [n]
WHERE [n].[Id] = @__Parse_0
2025-02-02 18:54:49.993 +03:00 [INF] Executed DbCommand (76ms) [Parameters=[@p0='?' (Size = 4000), @p1='?' (DbType = DateTime2), @p2='?' (Size = 4000), @p3='?' (Size = 4000), @p4='?' (Size = 4000), @p5='?' (Size = 450), @p6='?' (Size = 4000), @p7='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SET IMPLICIT_TRANSACTIONS OFF;
SET NOCOUNT ON;
INSERT INTO [AuthLogs] ([AuthType], [CreatedAt], [DeviceId], [FailureReason], [IpAddress], [NationalId], [Status], [UserAgent])
OUTPUT INSERTED.[Id]
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7);
2025-02-02 18:54:49.998 +03:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType9`2[[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Object, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-02-02 18:54:49.999 +03:00 [INF] Executed action NayifatAPI.Controllers.NotificationsController.GetNotifications (NayifatAPI) in 101.7043ms
2025-02-02 18:54:50.000 +03:00 [INF] Executed endpoint 'NayifatAPI.Controllers.NotificationsController.GetNotifications (NayifatAPI)'
2025-02-02 18:54:50.001 +03:00 [INF] Request finished HTTP/1.1 POST http://07ca-46-152-255-232.ngrok-free.app/api/notifications/list - 200 null application/json; charset=utf-8 115.0367ms
2025-02-02 18:59:49.529 +03:00 [INF] Request starting HTTP/1.1 POST http://07ca-46-152-255-232.ngrok-free.app/api/notifications/list - application/json; charset=utf-8 47
2025-02-02 18:59:49.534 +03:00 [INF] Executing endpoint 'NayifatAPI.Controllers.NotificationsController.GetNotifications (NayifatAPI)'
2025-02-02 18:59:49.535 +03:00 [INF] Route matched with {action = "GetNotifications", controller = "Notifications"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetNotifications(NayifatAPI.Controllers.GetNotificationsRequest) on controller NayifatAPI.Controllers.NotificationsController (NayifatAPI).
2025-02-02 18:59:49.543 +03:00 [INF] Executed DbCommand (2ms) [Parameters=[@__providedApiKey_0='?' (Size = 255)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [a].[Key], [a].[CreatedAt], [a].[Description], [a].[ExpiresAt], [a].[IsActive], [a].[LastUsedAt]
FROM [ApiKeys] AS [a]
WHERE [a].[Key] = @__providedApiKey_0 AND [a].[IsActive] = CAST(1 AS bit)
2025-02-02 18:59:49.550 +03:00 [INF] Executed DbCommand (2ms) [Parameters=[@__request_NationalId_0='?' (Size = 450)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [u].[national_id], [u].[last_updated], [u].[notifications]
FROM [user_notifications] AS [u]
WHERE [u].[national_id] = @__request_NationalId_0
2025-02-02 18:59:49.554 +03:00 [INF] Executed DbCommand (2ms) [Parameters=[@__Parse_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [n].[Id], [n].[additional_data], [n].[Body], [n].[body_ar], [n].[body_en], [n].[created_at], [n].[expiry_at], [n].[Route], [n].[target_criteria], [n].[Title], [n].[title_ar], [n].[title_en]
FROM [notification_templates] AS [n]
WHERE [n].[Id] = @__Parse_0
2025-02-02 18:59:49.556 +03:00 [INF] Executed DbCommand (0ms) [Parameters=[@__Parse_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [n].[Id], [n].[additional_data], [n].[Body], [n].[body_ar], [n].[body_en], [n].[created_at], [n].[expiry_at], [n].[Route], [n].[target_criteria], [n].[Title], [n].[title_ar], [n].[title_en]
FROM [notification_templates] AS [n]
WHERE [n].[Id] = @__Parse_0
2025-02-02 18:59:49.567 +03:00 [INF] Executed DbCommand (8ms) [Parameters=[@p0='?' (Size = 4000), @p1='?' (DbType = DateTime2), @p2='?' (Size = 4000), @p3='?' (Size = 4000), @p4='?' (Size = 4000), @p5='?' (Size = 450), @p6='?' (Size = 4000), @p7='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SET IMPLICIT_TRANSACTIONS OFF;
SET NOCOUNT ON;
INSERT INTO [AuthLogs] ([AuthType], [CreatedAt], [DeviceId], [FailureReason], [IpAddress], [NationalId], [Status], [UserAgent])
OUTPUT INSERTED.[Id]
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7);
2025-02-02 18:59:49.569 +03:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType9`2[[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Object, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-02-02 18:59:49.570 +03:00 [INF] Executed action NayifatAPI.Controllers.NotificationsController.GetNotifications (NayifatAPI) in 34.2359ms
2025-02-02 18:59:49.571 +03:00 [INF] Executed endpoint 'NayifatAPI.Controllers.NotificationsController.GetNotifications (NayifatAPI)'
2025-02-02 18:59:49.572 +03:00 [INF] Request finished HTTP/1.1 POST http://07ca-46-152-255-232.ngrok-free.app/api/notifications/list - 200 null application/json; charset=utf-8 42.6872ms
2025-02-02 19:04:49.716 +03:00 [INF] Request starting HTTP/1.1 POST http://07ca-46-152-255-232.ngrok-free.app/api/notifications/list - application/json; charset=utf-8 47
2025-02-02 19:04:49.718 +03:00 [INF] Executing endpoint 'NayifatAPI.Controllers.NotificationsController.GetNotifications (NayifatAPI)'
2025-02-02 19:04:49.719 +03:00 [INF] Route matched with {action = "GetNotifications", controller = "Notifications"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetNotifications(NayifatAPI.Controllers.GetNotificationsRequest) on controller NayifatAPI.Controllers.NotificationsController (NayifatAPI).
2025-02-02 19:04:49.879 +03:00 [INF] Executed DbCommand (154ms) [Parameters=[@__providedApiKey_0='?' (Size = 255)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [a].[Key], [a].[CreatedAt], [a].[Description], [a].[ExpiresAt], [a].[IsActive], [a].[LastUsedAt]
FROM [ApiKeys] AS [a]
WHERE [a].[Key] = @__providedApiKey_0 AND [a].[IsActive] = CAST(1 AS bit)
2025-02-02 19:04:49.986 +03:00 [INF] Executed DbCommand (2ms) [Parameters=[@__request_NationalId_0='?' (Size = 450)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [u].[national_id], [u].[last_updated], [u].[notifications]
FROM [user_notifications] AS [u]
WHERE [u].[national_id] = @__request_NationalId_0
2025-02-02 19:04:50.043 +03:00 [INF] Executed DbCommand (55ms) [Parameters=[@__Parse_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [n].[Id], [n].[additional_data], [n].[Body], [n].[body_ar], [n].[body_en], [n].[created_at], [n].[expiry_at], [n].[Route], [n].[target_criteria], [n].[Title], [n].[title_ar], [n].[title_en]
FROM [notification_templates] AS [n]
WHERE [n].[Id] = @__Parse_0
2025-02-02 19:04:50.244 +03:00 [INF] Executed DbCommand (0ms) [Parameters=[@__Parse_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [n].[Id], [n].[additional_data], [n].[Body], [n].[body_ar], [n].[body_en], [n].[created_at], [n].[expiry_at], [n].[Route], [n].[target_criteria], [n].[Title], [n].[title_ar], [n].[title_en]
FROM [notification_templates] AS [n]
WHERE [n].[Id] = @__Parse_0
2025-02-02 19:04:50.638 +03:00 [INF] Executed DbCommand (392ms) [Parameters=[@p0='?' (Size = 4000), @p1='?' (DbType = DateTime2), @p2='?' (Size = 4000), @p3='?' (Size = 4000), @p4='?' (Size = 4000), @p5='?' (Size = 450), @p6='?' (Size = 4000), @p7='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SET IMPLICIT_TRANSACTIONS OFF;
SET NOCOUNT ON;
INSERT INTO [AuthLogs] ([AuthType], [CreatedAt], [DeviceId], [FailureReason], [IpAddress], [NationalId], [Status], [UserAgent])
OUTPUT INSERTED.[Id]
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7);
2025-02-02 19:04:50.718 +03:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType9`2[[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Object, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-02-02 19:04:50.719 +03:00 [INF] Executed action NayifatAPI.Controllers.NotificationsController.GetNotifications (NayifatAPI) in 998.4719ms
2025-02-02 19:04:50.720 +03:00 [INF] Executed endpoint 'NayifatAPI.Controllers.NotificationsController.GetNotifications (NayifatAPI)'
2025-02-02 19:04:50.722 +03:00 [INF] Request finished HTTP/1.1 POST http://07ca-46-152-255-232.ngrok-free.app/api/notifications/list - 200 null application/json; charset=utf-8 1005.0969ms
2025-02-02 19:09:08.209 +03:00 [INF] Request starting HTTP/1.1 POST http://07ca-46-152-255-232.ngrok-free.app/api/notifications/list - application/json; charset=utf-8 47
2025-02-02 19:09:08.213 +03:00 [INF] Executing endpoint 'NayifatAPI.Controllers.NotificationsController.GetNotifications (NayifatAPI)'
2025-02-02 19:09:08.214 +03:00 [INF] Route matched with {action = "GetNotifications", controller = "Notifications"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetNotifications(NayifatAPI.Controllers.GetNotificationsRequest) on controller NayifatAPI.Controllers.NotificationsController (NayifatAPI).
2025-02-02 19:09:08.221 +03:00 [INF] Executed DbCommand (2ms) [Parameters=[@__providedApiKey_0='?' (Size = 255)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [a].[Key], [a].[CreatedAt], [a].[Description], [a].[ExpiresAt], [a].[IsActive], [a].[LastUsedAt]
FROM [ApiKeys] AS [a]
WHERE [a].[Key] = @__providedApiKey_0 AND [a].[IsActive] = CAST(1 AS bit)
2025-02-02 19:09:08.226 +03:00 [INF] Executed DbCommand (2ms) [Parameters=[@__request_NationalId_0='?' (Size = 450)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [u].[national_id], [u].[last_updated], [u].[notifications]
FROM [user_notifications] AS [u]
WHERE [u].[national_id] = @__request_NationalId_0
2025-02-02 19:09:08.231 +03:00 [INF] Executed DbCommand (2ms) [Parameters=[@__Parse_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [n].[Id], [n].[additional_data], [n].[Body], [n].[body_ar], [n].[body_en], [n].[created_at], [n].[expiry_at], [n].[Route], [n].[target_criteria], [n].[Title], [n].[title_ar], [n].[title_en]
FROM [notification_templates] AS [n]
WHERE [n].[Id] = @__Parse_0
2025-02-02 19:09:08.234 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@__Parse_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [n].[Id], [n].[additional_data], [n].[Body], [n].[body_ar], [n].[body_en], [n].[created_at], [n].[expiry_at], [n].[Route], [n].[target_criteria], [n].[Title], [n].[title_ar], [n].[title_en]
FROM [notification_templates] AS [n]
WHERE [n].[Id] = @__Parse_0
2025-02-02 19:09:08.313 +03:00 [INF] Executed DbCommand (76ms) [Parameters=[@p0='?' (Size = 4000), @p1='?' (DbType = DateTime2), @p2='?' (Size = 4000), @p3='?' (Size = 4000), @p4='?' (Size = 4000), @p5='?' (Size = 450), @p6='?' (Size = 4000), @p7='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SET IMPLICIT_TRANSACTIONS OFF;
SET NOCOUNT ON;
INSERT INTO [AuthLogs] ([AuthType], [CreatedAt], [DeviceId], [FailureReason], [IpAddress], [NationalId], [Status], [UserAgent])
OUTPUT INSERTED.[Id]
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7);
2025-02-02 19:09:08.316 +03:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType9`2[[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Object, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-02-02 19:09:08.318 +03:00 [INF] Executed action NayifatAPI.Controllers.NotificationsController.GetNotifications (NayifatAPI) in 100.0629ms
2025-02-02 19:09:08.319 +03:00 [INF] Executed endpoint 'NayifatAPI.Controllers.NotificationsController.GetNotifications (NayifatAPI)'
2025-02-02 19:09:08.320 +03:00 [INF] Request finished HTTP/1.1 POST http://07ca-46-152-255-232.ngrok-free.app/api/notifications/list - 200 null application/json; charset=utf-8 110.6014ms
2025-02-02 19:09:25.327 +03:00 [INF] Request starting HTTP/1.1 POST http://07ca-46-152-255-232.ngrok-free.app/api/auth/signin - application/json; charset=utf-8 50
2025-02-02 19:09:25.332 +03:00 [INF] Executing endpoint 'NayifatAPI.Controllers.AuthController.SignIn (NayifatAPI)'
2025-02-02 19:09:25.333 +03:00 [INF] Route matched with {action = "SignIn", controller = "Auth"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] SignIn(NayifatAPI.Controllers.SignInRequest) on controller NayifatAPI.Controllers.AuthController (NayifatAPI).
2025-02-02 19:09:25.345 +03:00 [INF] Executing BadRequestObjectResult, writing value of type 'Microsoft.AspNetCore.Mvc.ValidationProblemDetails'.
2025-02-02 19:09:25.366 +03:00 [INF] Executed action NayifatAPI.Controllers.AuthController.SignIn (NayifatAPI) in 31.3804ms
2025-02-02 19:09:25.368 +03:00 [INF] Executed endpoint 'NayifatAPI.Controllers.AuthController.SignIn (NayifatAPI)'
2025-02-02 19:09:25.369 +03:00 [INF] Request finished HTTP/1.1 POST http://07ca-46-152-255-232.ngrok-free.app/api/auth/signin - 400 null application/problem+json; charset=utf-8 41.9116ms
2025-02-02 19:12:13.619 +03:00 [INF] Request starting HTTP/1.1 POST http://07ca-46-152-255-232.ngrok-free.app/api/auth/signin - application/json; charset=utf-8 80
2025-02-02 19:12:13.622 +03:00 [INF] Executing endpoint 'NayifatAPI.Controllers.AuthController.SignIn (NayifatAPI)'
2025-02-02 19:12:13.627 +03:00 [INF] Route matched with {action = "SignIn", controller = "Auth"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] SignIn(NayifatAPI.Controllers.SignInRequest) on controller NayifatAPI.Controllers.AuthController (NayifatAPI).
2025-02-02 19:12:13.632 +03:00 [INF] Executing BadRequestObjectResult, writing value of type 'Microsoft.AspNetCore.Mvc.ValidationProblemDetails'.
2025-02-02 19:12:13.633 +03:00 [INF] Executed action NayifatAPI.Controllers.AuthController.SignIn (NayifatAPI) in 2.4347ms
2025-02-02 19:12:13.636 +03:00 [INF] Executed endpoint 'NayifatAPI.Controllers.AuthController.SignIn (NayifatAPI)'
2025-02-02 19:12:13.638 +03:00 [INF] Request finished HTTP/1.1 POST http://07ca-46-152-255-232.ngrok-free.app/api/auth/signin - 400 null application/problem+json; charset=utf-8 18.5676ms
2025-02-02 19:14:05.037 +03:00 [INF] Request starting HTTP/1.1 POST http://07ca-46-152-255-232.ngrok-free.app/api/auth/signin - application/json; charset=utf-8 80
2025-02-02 19:14:05.039 +03:00 [INF] Executing endpoint 'NayifatAPI.Controllers.AuthController.SignIn (NayifatAPI)'
2025-02-02 19:14:05.040 +03:00 [INF] Route matched with {action = "SignIn", controller = "Auth"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] SignIn(NayifatAPI.Controllers.SignInRequest) on controller NayifatAPI.Controllers.AuthController (NayifatAPI).
2025-02-02 19:14:05.042 +03:00 [INF] Executing BadRequestObjectResult, writing value of type 'Microsoft.AspNetCore.Mvc.ValidationProblemDetails'.
2025-02-02 19:14:05.043 +03:00 [INF] Executed action NayifatAPI.Controllers.AuthController.SignIn (NayifatAPI) in 1.837ms
2025-02-02 19:14:05.044 +03:00 [INF] Executed endpoint 'NayifatAPI.Controllers.AuthController.SignIn (NayifatAPI)'
2025-02-02 19:14:05.045 +03:00 [INF] Request finished HTTP/1.1 POST http://07ca-46-152-255-232.ngrok-free.app/api/auth/signin - 400 null application/problem+json; charset=utf-8 8.1765ms
2025-02-02 19:14:09.172 +03:00 [INF] Request starting HTTP/1.1 POST http://07ca-46-152-255-232.ngrok-free.app/api/notifications/list - application/json; charset=utf-8 47
2025-02-02 19:14:09.175 +03:00 [INF] Executing endpoint 'NayifatAPI.Controllers.NotificationsController.GetNotifications (NayifatAPI)'
2025-02-02 19:14:09.176 +03:00 [INF] Route matched with {action = "GetNotifications", controller = "Notifications"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetNotifications(NayifatAPI.Controllers.GetNotificationsRequest) on controller NayifatAPI.Controllers.NotificationsController (NayifatAPI).
2025-02-02 19:14:09.202 +03:00 [INF] Executed DbCommand (23ms) [Parameters=[@__providedApiKey_0='?' (Size = 255)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [a].[Key], [a].[CreatedAt], [a].[Description], [a].[ExpiresAt], [a].[IsActive], [a].[LastUsedAt]
FROM [ApiKeys] AS [a]
WHERE [a].[Key] = @__providedApiKey_0 AND [a].[IsActive] = CAST(1 AS bit)
2025-02-02 19:14:09.225 +03:00 [INF] Executed DbCommand (20ms) [Parameters=[@__request_NationalId_0='?' (Size = 450)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [u].[national_id], [u].[last_updated], [u].[notifications]
FROM [user_notifications] AS [u]
WHERE [u].[national_id] = @__request_NationalId_0
2025-02-02 19:14:09.233 +03:00 [INF] Executed DbCommand (3ms) [Parameters=[@__Parse_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [n].[Id], [n].[additional_data], [n].[Body], [n].[body_ar], [n].[body_en], [n].[created_at], [n].[expiry_at], [n].[Route], [n].[target_criteria], [n].[Title], [n].[title_ar], [n].[title_en]
FROM [notification_templates] AS [n]
WHERE [n].[Id] = @__Parse_0
2025-02-02 19:14:09.238 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@__Parse_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [n].[Id], [n].[additional_data], [n].[Body], [n].[body_ar], [n].[body_en], [n].[created_at], [n].[expiry_at], [n].[Route], [n].[target_criteria], [n].[Title], [n].[title_ar], [n].[title_en]
FROM [notification_templates] AS [n]
WHERE [n].[Id] = @__Parse_0
2025-02-02 19:14:09.316 +03:00 [INF] Executed DbCommand (76ms) [Parameters=[@p0='?' (Size = 4000), @p1='?' (DbType = DateTime2), @p2='?' (Size = 4000), @p3='?' (Size = 4000), @p4='?' (Size = 4000), @p5='?' (Size = 450), @p6='?' (Size = 4000), @p7='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SET IMPLICIT_TRANSACTIONS OFF;
SET NOCOUNT ON;
INSERT INTO [AuthLogs] ([AuthType], [CreatedAt], [DeviceId], [FailureReason], [IpAddress], [NationalId], [Status], [UserAgent])
OUTPUT INSERTED.[Id]
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7);
2025-02-02 19:14:09.319 +03:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType9`2[[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Object, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-02-02 19:14:09.320 +03:00 [INF] Executed action NayifatAPI.Controllers.NotificationsController.GetNotifications (NayifatAPI) in 142.1067ms
2025-02-02 19:14:09.321 +03:00 [INF] Executed endpoint 'NayifatAPI.Controllers.NotificationsController.GetNotifications (NayifatAPI)'
2025-02-02 19:14:09.322 +03:00 [INF] Request finished HTTP/1.1 POST http://07ca-46-152-255-232.ngrok-free.app/api/notifications/list - 200 null application/json; charset=utf-8 149.4839ms
2025-02-02 19:16:36.367 +03:00 [INF] Request starting HTTP/1.1 POST http://07ca-46-152-255-232.ngrok-free.app/api/auth/signin - application/x-www-form-urlencoded; charset=utf-8 88
2025-02-02 19:16:36.517 +03:00 [INF] Executing endpoint 'NayifatAPI.Controllers.AuthController.SignIn (NayifatAPI)'
2025-02-02 19:16:36.518 +03:00 [INF] Route matched with {action = "SignIn", controller = "Auth"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] SignIn(NayifatAPI.Controllers.SignInRequest) on controller NayifatAPI.Controllers.AuthController (NayifatAPI).
2025-02-02 19:16:36.531 +03:00 [INF] Executing ObjectResult, writing value of type 'Microsoft.AspNetCore.Mvc.ProblemDetails'.
2025-02-02 19:16:36.535 +03:00 [INF] Executed action NayifatAPI.Controllers.AuthController.SignIn (NayifatAPI) in 14.6871ms
2025-02-02 19:16:36.540 +03:00 [INF] Executed endpoint 'NayifatAPI.Controllers.AuthController.SignIn (NayifatAPI)'
2025-02-02 19:16:36.541 +03:00 [INF] Request finished HTTP/1.1 POST http://07ca-46-152-255-232.ngrok-free.app/api/auth/signin - 415 null application/problem+json; charset=utf-8 174.5561ms
2025-02-02 19:19:03.313 +03:00 [INF] Request starting HTTP/1.1 POST http://07ca-46-152-255-232.ngrok-free.app/api/auth/signin - application/x-www-form-urlencoded; charset=utf-8 88
2025-02-02 19:19:03.316 +03:00 [INF] Executing endpoint 'NayifatAPI.Controllers.AuthController.SignIn (NayifatAPI)'
2025-02-02 19:19:03.317 +03:00 [INF] Route matched with {action = "SignIn", controller = "Auth"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] SignIn(NayifatAPI.Controllers.SignInRequest) on controller NayifatAPI.Controllers.AuthController (NayifatAPI).
2025-02-02 19:19:03.319 +03:00 [INF] Executing ObjectResult, writing value of type 'Microsoft.AspNetCore.Mvc.ProblemDetails'.
2025-02-02 19:19:03.321 +03:00 [INF] Executed action NayifatAPI.Controllers.AuthController.SignIn (NayifatAPI) in 2.1148ms
2025-02-02 19:19:03.322 +03:00 [INF] Executed endpoint 'NayifatAPI.Controllers.AuthController.SignIn (NayifatAPI)'
2025-02-02 19:19:03.323 +03:00 [INF] Request finished HTTP/1.1 POST http://07ca-46-152-255-232.ngrok-free.app/api/auth/signin - 415 null application/problem+json; charset=utf-8 9.8973ms
2025-02-02 19:19:09.164 +03:00 [INF] Request starting HTTP/1.1 POST http://07ca-46-152-255-232.ngrok-free.app/api/notifications/list - application/json; charset=utf-8 47
2025-02-02 19:19:09.167 +03:00 [INF] Executing endpoint 'NayifatAPI.Controllers.NotificationsController.GetNotifications (NayifatAPI)'
2025-02-02 19:19:09.168 +03:00 [INF] Route matched with {action = "GetNotifications", controller = "Notifications"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetNotifications(NayifatAPI.Controllers.GetNotificationsRequest) on controller NayifatAPI.Controllers.NotificationsController (NayifatAPI).
2025-02-02 19:19:09.181 +03:00 [INF] Executed DbCommand (3ms) [Parameters=[@__providedApiKey_0='?' (Size = 255)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [a].[Key], [a].[CreatedAt], [a].[Description], [a].[ExpiresAt], [a].[IsActive], [a].[LastUsedAt]
FROM [ApiKeys] AS [a]
WHERE [a].[Key] = @__providedApiKey_0 AND [a].[IsActive] = CAST(1 AS bit)
2025-02-02 19:19:09.188 +03:00 [INF] Executed DbCommand (3ms) [Parameters=[@__request_NationalId_0='?' (Size = 450)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [u].[national_id], [u].[last_updated], [u].[notifications]
FROM [user_notifications] AS [u]
WHERE [u].[national_id] = @__request_NationalId_0
2025-02-02 19:19:09.192 +03:00 [INF] Executed DbCommand (2ms) [Parameters=[@__Parse_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [n].[Id], [n].[additional_data], [n].[Body], [n].[body_ar], [n].[body_en], [n].[created_at], [n].[expiry_at], [n].[Route], [n].[target_criteria], [n].[Title], [n].[title_ar], [n].[title_en]
FROM [notification_templates] AS [n]
WHERE [n].[Id] = @__Parse_0
2025-02-02 19:19:09.195 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@__Parse_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [n].[Id], [n].[additional_data], [n].[Body], [n].[body_ar], [n].[body_en], [n].[created_at], [n].[expiry_at], [n].[Route], [n].[target_criteria], [n].[Title], [n].[title_ar], [n].[title_en]
FROM [notification_templates] AS [n]
WHERE [n].[Id] = @__Parse_0
2025-02-02 19:19:09.275 +03:00 [INF] Executed DbCommand (77ms) [Parameters=[@p0='?' (Size = 4000), @p1='?' (DbType = DateTime2), @p2='?' (Size = 4000), @p3='?' (Size = 4000), @p4='?' (Size = 4000), @p5='?' (Size = 450), @p6='?' (Size = 4000), @p7='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SET IMPLICIT_TRANSACTIONS OFF;
SET NOCOUNT ON;
INSERT INTO [AuthLogs] ([AuthType], [CreatedAt], [DeviceId], [FailureReason], [IpAddress], [NationalId], [Status], [UserAgent])
OUTPUT INSERTED.[Id]
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7);
2025-02-02 19:19:09.279 +03:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType9`2[[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Object, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-02-02 19:19:09.280 +03:00 [INF] Executed action NayifatAPI.Controllers.NotificationsController.GetNotifications (NayifatAPI) in 107.4081ms
2025-02-02 19:19:09.281 +03:00 [INF] Executed endpoint 'NayifatAPI.Controllers.NotificationsController.GetNotifications (NayifatAPI)'
2025-02-02 19:19:09.282 +03:00 [INF] Request finished HTTP/1.1 POST http://07ca-46-152-255-232.ngrok-free.app/api/notifications/list - 200 null application/json; charset=utf-8 117.4189ms
2025-02-02 19:21:31.761 +03:00 [INF] Request starting HTTP/1.1 POST http://07ca-46-152-255-232.ngrok-free.app/api/auth/signin - application/json; charset=utf-8 78
2025-02-02 19:21:31.765 +03:00 [INF] Executing endpoint 'NayifatAPI.Controllers.AuthController.SignIn (NayifatAPI)'
2025-02-02 19:21:31.766 +03:00 [INF] Route matched with {action = "SignIn", controller = "Auth"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] SignIn(NayifatAPI.Controllers.SignInRequest) on controller NayifatAPI.Controllers.AuthController (NayifatAPI).
2025-02-02 19:21:31.772 +03:00 [INF] Executed DbCommand (2ms) [Parameters=[@__providedApiKey_0='?' (Size = 255)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [a].[Key], [a].[CreatedAt], [a].[Description], [a].[ExpiresAt], [a].[IsActive], [a].[LastUsedAt]
FROM [ApiKeys] AS [a]
WHERE [a].[Key] = @__providedApiKey_0 AND [a].[IsActive] = CAST(1 AS bit)
2025-02-02 19:21:31.778 +03:00 [INF] Executed DbCommand (3ms) [Parameters=[@__request_NationalId_0='?' (Size = 450)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [c].[NationalId], [c].[AddNo], [c].[BuildingNo], [c].[City], [c].[Consent], [c].[ConsentDate], [c].[DateOfBirth], [c].[Dependents], [c].[District], [c].[Email], [c].[Employer], [c].[FamilyNameAr], [c].[FamilyNameEn], [c].[FirstNameAr], [c].[FirstNameEn], [c].[Iban], [c].[IdExpiryDate], [c].[Los], [c].[Mpin], [c].[MpinEnabled], [c].[NafathStatus], [c].[NafathTimestamp], [c].[Password], [c].[Phone], [c].[RegistrationDate], [c].[SalaryCustomer], [c].[SalaryDakhli], [c].[SecondNameAr], [c].[SecondNameEn], [c].[Sector], [c].[Street], [c].[ThirdNameAr], [c].[ThirdNameEn], [c].[Zipcode]
FROM [Customers] AS [c]
WHERE [c].[NationalId] = @__request_NationalId_0
2025-02-02 19:21:31.782 +03:00 [INF] Starting password verification for NationalId: 1064448614
2025-02-02 19:21:31.966 +03:00 [INF] Password verification result for NationalId 1064448614: Success
2025-02-02 19:21:31.972 +03:00 [INF] Executed DbCommand (4ms) [Parameters=[@__request_NationalId_0='?' (Size = 450), @__request_DeviceId_1='?' (Size = 450)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [c].[Id], [c].[BiometricEnabled], [c].[BiometricToken], [c].[CreatedAt], [c].[DeviceId], [c].[LastUsedAt], [c].[Manufacturer], [c].[Model], [c].[NationalId], [c].[OsVersion], [c].[Platform], [c].[Status]
FROM [Customer_Devices] AS [c]
WHERE [c].[NationalId] = @__request_NationalId_0 AND [c].[DeviceId] = @__request_DeviceId_1 AND [c].[Status] = N'active'
2025-02-02 19:21:32.054 +03:00 [INF] Executed DbCommand (78ms) [Parameters=[@p0='?' (Size = 4000), @p1='?' (DbType = DateTime2), @p2='?' (Size = 4000), @p3='?' (Size = 4000), @p4='?' (Size = 4000), @p5='?' (Size = 450), @p6='?' (Size = 4000), @p7='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SET IMPLICIT_TRANSACTIONS OFF;
SET NOCOUNT ON;
INSERT INTO [AuthLogs] ([AuthType], [CreatedAt], [DeviceId], [FailureReason], [IpAddress], [NationalId], [Status], [UserAgent])
OUTPUT INSERTED.[Id]
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7);
2025-02-02 19:21:32.057 +03:00 [INF] Executing ObjectResult, writing value of type '<>f__AnonymousType12`3[[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Object, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-02-02 19:21:32.058 +03:00 [INF] Executed action NayifatAPI.Controllers.AuthController.SignIn (NayifatAPI) in 289.5526ms
2025-02-02 19:21:32.060 +03:00 [INF] Executed endpoint 'NayifatAPI.Controllers.AuthController.SignIn (NayifatAPI)'
2025-02-02 19:21:32.062 +03:00 [INF] Request finished HTTP/1.1 POST http://07ca-46-152-255-232.ngrok-free.app/api/auth/signin - 401 null application/json; charset=utf-8 300.4449ms
2025-02-02 19:24:09.655 +03:00 [INF] Request starting HTTP/1.1 POST http://07ca-46-152-255-232.ngrok-free.app/api/notifications/list - application/json; charset=utf-8 47
2025-02-02 19:24:09.658 +03:00 [INF] Executing endpoint 'NayifatAPI.Controllers.NotificationsController.GetNotifications (NayifatAPI)'
2025-02-02 19:24:09.659 +03:00 [INF] Route matched with {action = "GetNotifications", controller = "Notifications"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetNotifications(NayifatAPI.Controllers.GetNotificationsRequest) on controller NayifatAPI.Controllers.NotificationsController (NayifatAPI).
2025-02-02 19:24:09.665 +03:00 [INF] Executed DbCommand (3ms) [Parameters=[@__providedApiKey_0='?' (Size = 255)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [a].[Key], [a].[CreatedAt], [a].[Description], [a].[ExpiresAt], [a].[IsActive], [a].[LastUsedAt]
FROM [ApiKeys] AS [a]
WHERE [a].[Key] = @__providedApiKey_0 AND [a].[IsActive] = CAST(1 AS bit)
2025-02-02 19:24:09.668 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@__request_NationalId_0='?' (Size = 450)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [u].[national_id], [u].[last_updated], [u].[notifications]
FROM [user_notifications] AS [u]
WHERE [u].[national_id] = @__request_NationalId_0
2025-02-02 19:24:09.672 +03:00 [INF] Executed DbCommand (2ms) [Parameters=[@__Parse_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [n].[Id], [n].[additional_data], [n].[Body], [n].[body_ar], [n].[body_en], [n].[created_at], [n].[expiry_at], [n].[Route], [n].[target_criteria], [n].[Title], [n].[title_ar], [n].[title_en]
FROM [notification_templates] AS [n]
WHERE [n].[Id] = @__Parse_0
2025-02-02 19:24:09.675 +03:00 [INF] Executed DbCommand (0ms) [Parameters=[@__Parse_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [n].[Id], [n].[additional_data], [n].[Body], [n].[body_ar], [n].[body_en], [n].[created_at], [n].[expiry_at], [n].[Route], [n].[target_criteria], [n].[Title], [n].[title_ar], [n].[title_en]
FROM [notification_templates] AS [n]
WHERE [n].[Id] = @__Parse_0
2025-02-02 19:24:09.755 +03:00 [INF] Executed DbCommand (77ms) [Parameters=[@p0='?' (Size = 4000), @p1='?' (DbType = DateTime2), @p2='?' (Size = 4000), @p3='?' (Size = 4000), @p4='?' (Size = 4000), @p5='?' (Size = 450), @p6='?' (Size = 4000), @p7='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SET IMPLICIT_TRANSACTIONS OFF;
SET NOCOUNT ON;
INSERT INTO [AuthLogs] ([AuthType], [CreatedAt], [DeviceId], [FailureReason], [IpAddress], [NationalId], [Status], [UserAgent])
OUTPUT INSERTED.[Id]
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7);
2025-02-02 19:24:09.757 +03:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType9`2[[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Object, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-02-02 19:24:09.761 +03:00 [INF] Executed action NayifatAPI.Controllers.NotificationsController.GetNotifications (NayifatAPI) in 100.5603ms
2025-02-02 19:24:09.763 +03:00 [INF] Executed endpoint 'NayifatAPI.Controllers.NotificationsController.GetNotifications (NayifatAPI)'
2025-02-02 19:24:09.764 +03:00 [INF] Request finished HTTP/1.1 POST http://07ca-46-152-255-232.ngrok-free.app/api/notifications/list - 200 null application/json; charset=utf-8 108.8754ms
2025-02-02 19:24:18.355 +03:00 [INF] Request starting HTTP/1.1 POST http://07ca-46-152-255-232.ngrok-free.app/api/device - application/json; charset=utf-8 123
2025-02-02 19:24:18.445 +03:00 [INF] Executing endpoint 'NayifatAPI.Controllers.DeviceController.RegisterDevice (NayifatAPI)'
2025-02-02 19:24:18.729 +03:00 [INF] Route matched with {action = "RegisterDevice", controller = "Device"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] RegisterDevice(NayifatAPI.Controllers.RegisterDeviceRequest) on controller NayifatAPI.Controllers.DeviceController (NayifatAPI).
2025-02-02 19:24:19.027 +03:00 [INF] Executing BadRequestObjectResult, writing value of type 'Microsoft.AspNetCore.Mvc.ValidationProblemDetails'.
2025-02-02 19:24:19.029 +03:00 [INF] Executed action NayifatAPI.Controllers.DeviceController.RegisterDevice (NayifatAPI) in 6.4443ms
2025-02-02 19:24:19.031 +03:00 [INF] Executed endpoint 'NayifatAPI.Controllers.DeviceController.RegisterDevice (NayifatAPI)'
2025-02-02 19:24:19.032 +03:00 [INF] Request finished HTTP/1.1 POST http://07ca-46-152-255-232.ngrok-free.app/api/device - 400 null application/problem+json; charset=utf-8 676.1975ms
2025-02-02 19:26:54.877 +03:00 [INF] Request starting HTTP/1.1 POST http://07ca-46-152-255-232.ngrok-free.app/api/notifications/list - application/json; charset=utf-8 47
2025-02-02 19:26:54.879 +03:00 [INF] Executing endpoint 'NayifatAPI.Controllers.NotificationsController.GetNotifications (NayifatAPI)'
2025-02-02 19:26:54.881 +03:00 [INF] Route matched with {action = "GetNotifications", controller = "Notifications"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetNotifications(NayifatAPI.Controllers.GetNotificationsRequest) on controller NayifatAPI.Controllers.NotificationsController (NayifatAPI).
2025-02-02 19:26:54.913 +03:00 [INF] Executed DbCommand (27ms) [Parameters=[@__providedApiKey_0='?' (Size = 255)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [a].[Key], [a].[CreatedAt], [a].[Description], [a].[ExpiresAt], [a].[IsActive], [a].[LastUsedAt]
FROM [ApiKeys] AS [a]
WHERE [a].[Key] = @__providedApiKey_0 AND [a].[IsActive] = CAST(1 AS bit)
2025-02-02 19:26:55.219 +03:00 [INF] Executed DbCommand (3ms) [Parameters=[@__request_NationalId_0='?' (Size = 450)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [u].[national_id], [u].[last_updated], [u].[notifications]
FROM [user_notifications] AS [u]
WHERE [u].[national_id] = @__request_NationalId_0
2025-02-02 19:26:55.225 +03:00 [INF] Executed DbCommand (3ms) [Parameters=[@__Parse_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [n].[Id], [n].[additional_data], [n].[Body], [n].[body_ar], [n].[body_en], [n].[created_at], [n].[expiry_at], [n].[Route], [n].[target_criteria], [n].[Title], [n].[title_ar], [n].[title_en]
FROM [notification_templates] AS [n]
WHERE [n].[Id] = @__Parse_0
2025-02-02 19:26:55.228 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@__Parse_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [n].[Id], [n].[additional_data], [n].[Body], [n].[body_ar], [n].[body_en], [n].[created_at], [n].[expiry_at], [n].[Route], [n].[target_criteria], [n].[Title], [n].[title_ar], [n].[title_en]
FROM [notification_templates] AS [n]
WHERE [n].[Id] = @__Parse_0
2025-02-02 19:26:55.398 +03:00 [INF] Executed DbCommand (167ms) [Parameters=[@p0='?' (Size = 4000), @p1='?' (DbType = DateTime2), @p2='?' (Size = 4000), @p3='?' (Size = 4000), @p4='?' (Size = 4000), @p5='?' (Size = 450), @p6='?' (Size = 4000), @p7='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SET IMPLICIT_TRANSACTIONS OFF;
SET NOCOUNT ON;
INSERT INTO [AuthLogs] ([AuthType], [CreatedAt], [DeviceId], [FailureReason], [IpAddress], [NationalId], [Status], [UserAgent])
OUTPUT INSERTED.[Id]
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7);
2025-02-02 19:26:55.563 +03:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType9`2[[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Object, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-02-02 19:26:55.565 +03:00 [INF] Executed action NayifatAPI.Controllers.NotificationsController.GetNotifications (NayifatAPI) in 682.0451ms
2025-02-02 19:26:55.566 +03:00 [INF] Executed endpoint 'NayifatAPI.Controllers.NotificationsController.GetNotifications (NayifatAPI)'
2025-02-02 19:26:55.568 +03:00 [INF] Request finished HTTP/1.1 POST http://07ca-46-152-255-232.ngrok-free.app/api/notifications/list - 200 null application/json; charset=utf-8 691.4874ms
2025-02-02 19:27:13.270 +03:00 [INF] Request starting HTTP/1.1 POST http://07ca-46-152-255-232.ngrok-free.app/api/device - application/json; charset=utf-8 133
2025-02-02 19:27:13.272 +03:00 [INF] Executing endpoint 'NayifatAPI.Controllers.DeviceController.RegisterDevice (NayifatAPI)'
2025-02-02 19:27:13.274 +03:00 [INF] Route matched with {action = "RegisterDevice", controller = "Device"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] RegisterDevice(NayifatAPI.Controllers.RegisterDeviceRequest) on controller NayifatAPI.Controllers.DeviceController (NayifatAPI).
2025-02-02 19:27:13.276 +03:00 [INF] Executing BadRequestObjectResult, writing value of type 'Microsoft.AspNetCore.Mvc.ValidationProblemDetails'.
2025-02-02 19:27:13.277 +03:00 [INF] Executed action NayifatAPI.Controllers.DeviceController.RegisterDevice (NayifatAPI) in 1.703ms
2025-02-02 19:27:13.279 +03:00 [INF] Executed endpoint 'NayifatAPI.Controllers.DeviceController.RegisterDevice (NayifatAPI)'
2025-02-02 19:27:13.281 +03:00 [INF] Request finished HTTP/1.1 POST http://07ca-46-152-255-232.ngrok-free.app/api/device - 400 null application/problem+json; charset=utf-8 10.7588ms
2025-02-02 19:28:17.763 +03:00 [INF] Request starting HTTP/1.1 POST http://07ca-46-152-255-232.ngrok-free.app/api/notifications/list - application/json; charset=utf-8 47
2025-02-02 19:28:17.768 +03:00 [INF] Executing endpoint 'NayifatAPI.Controllers.NotificationsController.GetNotifications (NayifatAPI)'
2025-02-02 19:28:17.768 +03:00 [INF] Route matched with {action = "GetNotifications", controller = "Notifications"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetNotifications(NayifatAPI.Controllers.GetNotificationsRequest) on controller NayifatAPI.Controllers.NotificationsController (NayifatAPI).
2025-02-02 19:28:17.773 +03:00 [INF] Executed DbCommand (2ms) [Parameters=[@__providedApiKey_0='?' (Size = 255)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [a].[Key], [a].[CreatedAt], [a].[Description], [a].[ExpiresAt], [a].[IsActive], [a].[LastUsedAt]
FROM [ApiKeys] AS [a]
WHERE [a].[Key] = @__providedApiKey_0 AND [a].[IsActive] = CAST(1 AS bit)
2025-02-02 19:28:17.778 +03:00 [INF] Executed DbCommand (2ms) [Parameters=[@__request_NationalId_0='?' (Size = 450)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [u].[national_id], [u].[last_updated], [u].[notifications]
FROM [user_notifications] AS [u]
WHERE [u].[national_id] = @__request_NationalId_0
2025-02-02 19:28:17.784 +03:00 [INF] Executed DbCommand (2ms) [Parameters=[@__Parse_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [n].[Id], [n].[additional_data], [n].[Body], [n].[body_ar], [n].[body_en], [n].[created_at], [n].[expiry_at], [n].[Route], [n].[target_criteria], [n].[Title], [n].[title_ar], [n].[title_en]
FROM [notification_templates] AS [n]
WHERE [n].[Id] = @__Parse_0
2025-02-02 19:28:17.786 +03:00 [INF] Executed DbCommand (0ms) [Parameters=[@__Parse_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [n].[Id], [n].[additional_data], [n].[Body], [n].[body_ar], [n].[body_en], [n].[created_at], [n].[expiry_at], [n].[Route], [n].[target_criteria], [n].[Title], [n].[title_ar], [n].[title_en]
FROM [notification_templates] AS [n]
WHERE [n].[Id] = @__Parse_0
2025-02-02 19:28:17.863 +03:00 [INF] Executed DbCommand (75ms) [Parameters=[@p0='?' (Size = 4000), @p1='?' (DbType = DateTime2), @p2='?' (Size = 4000), @p3='?' (Size = 4000), @p4='?' (Size = 4000), @p5='?' (Size = 450), @p6='?' (Size = 4000), @p7='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SET IMPLICIT_TRANSACTIONS OFF;
SET NOCOUNT ON;
INSERT INTO [AuthLogs] ([AuthType], [CreatedAt], [DeviceId], [FailureReason], [IpAddress], [NationalId], [Status], [UserAgent])
OUTPUT INSERTED.[Id]
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7);
2025-02-02 19:28:17.871 +03:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType9`2[[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Object, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-02-02 19:28:17.878 +03:00 [INF] Executed action NayifatAPI.Controllers.NotificationsController.GetNotifications (NayifatAPI) in 108.5465ms
2025-02-02 19:28:17.880 +03:00 [INF] Executed endpoint 'NayifatAPI.Controllers.NotificationsController.GetNotifications (NayifatAPI)'
2025-02-02 19:28:17.883 +03:00 [INF] Request finished HTTP/1.1 POST http://07ca-46-152-255-232.ngrok-free.app/api/notifications/list - 200 null application/json; charset=utf-8 119.4217ms
2025-02-02 19:28:36.127 +03:00 [INF] Request starting HTTP/1.1 POST http://07ca-46-152-255-232.ngrok-free.app/api/device - application/json; charset=utf-8 133
2025-02-02 19:28:36.130 +03:00 [INF] Executing endpoint 'NayifatAPI.Controllers.DeviceController.RegisterDevice (NayifatAPI)'
2025-02-02 19:28:36.131 +03:00 [INF] Route matched with {action = "RegisterDevice", controller = "Device"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] RegisterDevice(NayifatAPI.Controllers.RegisterDeviceRequest) on controller NayifatAPI.Controllers.DeviceController (NayifatAPI).
2025-02-02 19:28:36.133 +03:00 [INF] Executing BadRequestObjectResult, writing value of type 'Microsoft.AspNetCore.Mvc.ValidationProblemDetails'.
2025-02-02 19:28:36.134 +03:00 [INF] Executed action NayifatAPI.Controllers.DeviceController.RegisterDevice (NayifatAPI) in 1.9807ms
2025-02-02 19:28:36.135 +03:00 [INF] Executed endpoint 'NayifatAPI.Controllers.DeviceController.RegisterDevice (NayifatAPI)'
2025-02-02 19:28:36.137 +03:00 [INF] Request finished HTTP/1.1 POST http://07ca-46-152-255-232.ngrok-free.app/api/device - 400 null application/problem+json; charset=utf-8 9.5879ms
2025-02-02 19:31:18.169 +03:00 [INF] Request starting HTTP/1.1 POST http://07ca-46-152-255-232.ngrok-free.app/api/device - application/json; charset=utf-8 121
2025-02-02 19:31:18.172 +03:00 [INF] Executing endpoint 'NayifatAPI.Controllers.DeviceController.RegisterDevice (NayifatAPI)'
2025-02-02 19:31:18.174 +03:00 [INF] Route matched with {action = "RegisterDevice", controller = "Device"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] RegisterDevice(NayifatAPI.Controllers.RegisterDeviceRequest) on controller NayifatAPI.Controllers.DeviceController (NayifatAPI).
2025-02-02 19:31:18.284 +03:00 [INF] Executed DbCommand (80ms) [Parameters=[@__providedApiKey_0='?' (Size = 255)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [a].[Key], [a].[CreatedAt], [a].[Description], [a].[ExpiresAt], [a].[IsActive], [a].[LastUsedAt]
FROM [ApiKeys] AS [a]
WHERE [a].[Key] = @__providedApiKey_0 AND [a].[IsActive] = CAST(1 AS bit)
2025-02-02 19:31:18.517 +03:00 [INF] Executed DbCommand (153ms) [Parameters=[@__p_0='?' (Size = 450)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [c].[NationalId], [c].[AddNo], [c].[BuildingNo], [c].[City], [c].[Consent], [c].[ConsentDate], [c].[DateOfBirth], [c].[Dependents], [c].[District], [c].[Email], [c].[Employer], [c].[FamilyNameAr], [c].[FamilyNameEn], [c].[FirstNameAr], [c].[FirstNameEn], [c].[Iban], [c].[IdExpiryDate], [c].[Los], [c].[Mpin], [c].[MpinEnabled], [c].[NafathStatus], [c].[NafathTimestamp], [c].[Password], [c].[Phone], [c].[RegistrationDate], [c].[SalaryCustomer], [c].[SalaryDakhli], [c].[SecondNameAr], [c].[SecondNameEn], [c].[Sector], [c].[Street], [c].[ThirdNameAr], [c].[ThirdNameEn], [c].[Zipcode]
FROM [Customers] AS [c]
WHERE [c].[NationalId] = @__p_0
2025-02-02 19:31:19.085 +03:00 [INF] Executed DbCommand (277ms) [Parameters=[@__request_NationalId_0='?' (Size = 450)], CommandType='"Text"', CommandTimeout='30']
UPDATE [c]
SET [c].[LastUsedAt] = GETUTCDATE(),
    [c].[Status] = N'disabled'
FROM [Customer_Devices] AS [c]
WHERE [c].[NationalId] = @__request_NationalId_0
2025-02-02 19:31:19.248 +03:00 [INF] Executed DbCommand (7ms) [Parameters=[@p0='?' (Size = 4000), @p1='?' (DbType = DateTime2), @p2='?' (Size = 4000), @p3='?' (Size = 4000), @p4='?' (Size = 4000), @p5='?' (Size = 450), @p6='?' (Size = 4000), @p7='?' (Size = 4000), @p8='?' (DbType = Boolean), @p9='?' (Size = 4000), @p10='?' (DbType = DateTime2), @p11='?' (Size = 450), @p12='?' (DbType = DateTime2), @p13='?' (Size = 4000), @p14='?' (Size = 4000), @p15='?' (Size = 450), @p16='?' (Size = 4000), @p17='?' (Size = 4000), @p18='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SET NOCOUNT ON;
INSERT INTO [AuthLogs] ([AuthType], [CreatedAt], [DeviceId], [FailureReason], [IpAddress], [NationalId], [Status], [UserAgent])
OUTPUT INSERTED.[Id]
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7);
INSERT INTO [Customer_Devices] ([BiometricEnabled], [BiometricToken], [CreatedAt], [DeviceId], [LastUsedAt], [Manufacturer], [Model], [NationalId], [OsVersion], [Platform], [Status])
OUTPUT INSERTED.[Id]
VALUES (@p8, @p9, @p10, @p11, @p12, @p13, @p14, @p15, @p16, @p17, @p18);
2025-02-02 19:31:19.286 +03:00 [ERR] An exception occurred in the database while saving changes for context type 'NayifatAPI.Data.ApplicationDbContext'.
Microsoft.EntityFrameworkCore.DbUpdateException: An error occurred while saving the entity changes. See the inner exception for details.
 ---> Microsoft.Data.SqlClient.SqlException (0x80131904): Cannot insert duplicate key row in object 'dbo.Customer_Devices' with unique index 'IX_Customer_Devices_NationalId_DeviceId'. The duplicate key value is (1064448614, TP1A.220624.014).
   at Microsoft.Data.SqlClient.SqlConnection.OnError(SqlException exception, Boolean breakConnection, Action`1 wrapCloseInAction)
   at Microsoft.Data.SqlClient.SqlInternalConnection.OnError(SqlException exception, Boolean breakConnection, Action`1 wrapCloseInAction)
   at Microsoft.Data.SqlClient.TdsParser.ThrowExceptionAndWarning(TdsParserStateObject stateObj, Boolean callerHasConnectionLock, Boolean asyncClose)
   at Microsoft.Data.SqlClient.TdsParser.TryRun(RunBehavior runBehavior, SqlCommand cmdHandler, SqlDataReader dataStream, BulkCopySimpleResultSet bulkCopyHandler, TdsParserStateObject stateObj, Boolean& dataReady)
   at Microsoft.Data.SqlClient.SqlDataReader.TryHasMoreRows(Boolean& moreRows)
   at Microsoft.Data.SqlClient.SqlDataReader.TryReadInternal(Boolean setTimeout, Boolean& more)
   at Microsoft.Data.SqlClient.SqlDataReader.ReadAsyncExecute(Task task, Object state)
   at Microsoft.Data.SqlClient.SqlDataReader.InvokeAsyncCall[T](SqlDataReaderBaseAsyncCallContext`1 context)
--- End of stack trace from previous location ---
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeResultSetAsync(Int32 startCommandIndex, RelationalDataReader reader, CancellationToken cancellationToken)
ClientConnectionId:70f6f670-0785-41dd-959c-aea958544bc8
Error Number:2601,State:1,Class:14
   --- End of inner exception stack trace ---
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeResultSetAsync(Int32 startCommandIndex, RelationalDataReader reader, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeAsync(RelationalDataReader reader, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Update.Internal.SqlServerModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(IList`1 entriesToSave, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(StateManager stateManager, Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Storage.Internal.SqlServerExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
Microsoft.EntityFrameworkCore.DbUpdateException: An error occurred while saving the entity changes. See the inner exception for details.
 ---> Microsoft.Data.SqlClient.SqlException (0x80131904): Cannot insert duplicate key row in object 'dbo.Customer_Devices' with unique index 'IX_Customer_Devices_NationalId_DeviceId'. The duplicate key value is (1064448614, TP1A.220624.014).
   at Microsoft.Data.SqlClient.SqlConnection.OnError(SqlException exception, Boolean breakConnection, Action`1 wrapCloseInAction)
   at Microsoft.Data.SqlClient.SqlInternalConnection.OnError(SqlException exception, Boolean breakConnection, Action`1 wrapCloseInAction)
   at Microsoft.Data.SqlClient.TdsParser.ThrowExceptionAndWarning(TdsParserStateObject stateObj, Boolean callerHasConnectionLock, Boolean asyncClose)
   at Microsoft.Data.SqlClient.TdsParser.TryRun(RunBehavior runBehavior, SqlCommand cmdHandler, SqlDataReader dataStream, BulkCopySimpleResultSet bulkCopyHandler, TdsParserStateObject stateObj, Boolean& dataReady)
   at Microsoft.Data.SqlClient.SqlDataReader.TryHasMoreRows(Boolean& moreRows)
   at Microsoft.Data.SqlClient.SqlDataReader.TryReadInternal(Boolean setTimeout, Boolean& more)
   at Microsoft.Data.SqlClient.SqlDataReader.ReadAsyncExecute(Task task, Object state)
   at Microsoft.Data.SqlClient.SqlDataReader.InvokeAsyncCall[T](SqlDataReaderBaseAsyncCallContext`1 context)
--- End of stack trace from previous location ---
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeResultSetAsync(Int32 startCommandIndex, RelationalDataReader reader, CancellationToken cancellationToken)
ClientConnectionId:70f6f670-0785-41dd-959c-aea958544bc8
Error Number:2601,State:1,Class:14
   --- End of inner exception stack trace ---
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeResultSetAsync(Int32 startCommandIndex, RelationalDataReader reader, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeAsync(RelationalDataReader reader, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Update.Internal.SqlServerModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(IList`1 entriesToSave, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(StateManager stateManager, Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Storage.Internal.SqlServerExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
2025-02-02 19:31:19.317 +03:00 [ERR] Error registering device for National ID: 1064448614
Microsoft.EntityFrameworkCore.DbUpdateException: An error occurred while saving the entity changes. See the inner exception for details.
 ---> Microsoft.Data.SqlClient.SqlException (0x80131904): Cannot insert duplicate key row in object 'dbo.Customer_Devices' with unique index 'IX_Customer_Devices_NationalId_DeviceId'. The duplicate key value is (1064448614, TP1A.220624.014).
   at Microsoft.Data.SqlClient.SqlConnection.OnError(SqlException exception, Boolean breakConnection, Action`1 wrapCloseInAction)
   at Microsoft.Data.SqlClient.SqlInternalConnection.OnError(SqlException exception, Boolean breakConnection, Action`1 wrapCloseInAction)
   at Microsoft.Data.SqlClient.TdsParser.ThrowExceptionAndWarning(TdsParserStateObject stateObj, Boolean callerHasConnectionLock, Boolean asyncClose)
   at Microsoft.Data.SqlClient.TdsParser.TryRun(RunBehavior runBehavior, SqlCommand cmdHandler, SqlDataReader dataStream, BulkCopySimpleResultSet bulkCopyHandler, TdsParserStateObject stateObj, Boolean& dataReady)
   at Microsoft.Data.SqlClient.SqlDataReader.TryHasMoreRows(Boolean& moreRows)
   at Microsoft.Data.SqlClient.SqlDataReader.TryReadInternal(Boolean setTimeout, Boolean& more)
   at Microsoft.Data.SqlClient.SqlDataReader.ReadAsyncExecute(Task task, Object state)
   at Microsoft.Data.SqlClient.SqlDataReader.InvokeAsyncCall[T](SqlDataReaderBaseAsyncCallContext`1 context)
--- End of stack trace from previous location ---
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeResultSetAsync(Int32 startCommandIndex, RelationalDataReader reader, CancellationToken cancellationToken)
ClientConnectionId:70f6f670-0785-41dd-959c-aea958544bc8
Error Number:2601,State:1,Class:14
   --- End of inner exception stack trace ---
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeResultSetAsync(Int32 startCommandIndex, RelationalDataReader reader, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeAsync(RelationalDataReader reader, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Update.Internal.SqlServerModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(IList`1 entriesToSave, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(StateManager stateManager, Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Storage.Internal.SqlServerExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at NayifatAPI.Controllers.DeviceController.RegisterDevice(RegisterDeviceRequest request) in C:\Users\yamta\StudioProjects\nayifat_app_2025_new\nayifatapi\Controllers\DeviceController.cs:line 78
2025-02-02 19:31:19.363 +03:00 [INF] Executed DbCommand (13ms) [Parameters=[@p0='?' (Size = 4000), @p1='?' (DbType = DateTime2), @p2='?' (Size = 4000), @p3='?' (Size = 4000), @p4='?' (Size = 4000), @p5='?' (Size = 450), @p6='?' (Size = 4000), @p7='?' (Size = 4000), @p8='?' (Size = 4000), @p9='?' (DbType = DateTime2), @p10='?' (Size = 4000), @p11='?' (Size = 4000), @p12='?' (Size = 4000), @p13='?' (Size = 450), @p14='?' (Size = 4000), @p15='?' (Size = 4000), @p16='?' (DbType = Boolean), @p17='?' (Size = 4000), @p18='?' (DbType = DateTime2), @p19='?' (Size = 450), @p20='?' (DbType = DateTime2), @p21='?' (Size = 4000), @p22='?' (Size = 4000), @p23='?' (Size = 450), @p24='?' (Size = 4000), @p25='?' (Size = 4000), @p26='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SET NOCOUNT ON;
MERGE [AuthLogs] USING (
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7, 0),
(@p8, @p9, @p10, @p11, @p12, @p13, @p14, @p15, 1)) AS i ([AuthType], [CreatedAt], [DeviceId], [FailureReason], [IpAddress], [NationalId], [Status], [UserAgent], _Position) ON 1=0
WHEN NOT MATCHED THEN
INSERT ([AuthType], [CreatedAt], [DeviceId], [FailureReason], [IpAddress], [NationalId], [Status], [UserAgent])
VALUES (i.[AuthType], i.[CreatedAt], i.[DeviceId], i.[FailureReason], i.[IpAddress], i.[NationalId], i.[Status], i.[UserAgent])
OUTPUT INSERTED.[Id], i._Position;
INSERT INTO [Customer_Devices] ([BiometricEnabled], [BiometricToken], [CreatedAt], [DeviceId], [LastUsedAt], [Manufacturer], [Model], [NationalId], [OsVersion], [Platform], [Status])
OUTPUT INSERTED.[Id]
VALUES (@p16, @p17, @p18, @p19, @p20, @p21, @p22, @p23, @p24, @p25, @p26);
2025-02-02 19:31:19.369 +03:00 [ERR] An exception occurred in the database while saving changes for context type 'NayifatAPI.Data.ApplicationDbContext'.
Microsoft.EntityFrameworkCore.DbUpdateException: An error occurred while saving the entity changes. See the inner exception for details.
 ---> Microsoft.Data.SqlClient.SqlException (0x80131904): Cannot insert duplicate key row in object 'dbo.Customer_Devices' with unique index 'IX_Customer_Devices_NationalId_DeviceId'. The duplicate key value is (1064448614, TP1A.220624.014).
   at Microsoft.Data.SqlClient.SqlConnection.OnError(SqlException exception, Boolean breakConnection, Action`1 wrapCloseInAction)
   at Microsoft.Data.SqlClient.SqlInternalConnection.OnError(SqlException exception, Boolean breakConnection, Action`1 wrapCloseInAction)
   at Microsoft.Data.SqlClient.TdsParser.ThrowExceptionAndWarning(TdsParserStateObject stateObj, Boolean callerHasConnectionLock, Boolean asyncClose)
   at Microsoft.Data.SqlClient.TdsParser.TryRun(RunBehavior runBehavior, SqlCommand cmdHandler, SqlDataReader dataStream, BulkCopySimpleResultSet bulkCopyHandler, TdsParserStateObject stateObj, Boolean& dataReady)
   at Microsoft.Data.SqlClient.SqlDataReader.TryHasMoreRows(Boolean& moreRows)
   at Microsoft.Data.SqlClient.SqlDataReader.TryReadInternal(Boolean setTimeout, Boolean& more)
   at Microsoft.Data.SqlClient.SqlDataReader.ReadAsyncExecute(Task task, Object state)
   at Microsoft.Data.SqlClient.SqlDataReader.InvokeAsyncCall[T](SqlDataReaderBaseAsyncCallContext`1 context)
--- End of stack trace from previous location ---
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeResultSetAsync(Int32 startCommandIndex, RelationalDataReader reader, CancellationToken cancellationToken)
ClientConnectionId:70f6f670-0785-41dd-959c-aea958544bc8
Error Number:2601,State:1,Class:14
   --- End of inner exception stack trace ---
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeResultSetAsync(Int32 startCommandIndex, RelationalDataReader reader, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeAsync(RelationalDataReader reader, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Update.Internal.SqlServerModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(IList`1 entriesToSave, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(StateManager stateManager, Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Storage.Internal.SqlServerExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
Microsoft.EntityFrameworkCore.DbUpdateException: An error occurred while saving the entity changes. See the inner exception for details.
 ---> Microsoft.Data.SqlClient.SqlException (0x80131904): Cannot insert duplicate key row in object 'dbo.Customer_Devices' with unique index 'IX_Customer_Devices_NationalId_DeviceId'. The duplicate key value is (1064448614, TP1A.220624.014).
   at Microsoft.Data.SqlClient.SqlConnection.OnError(SqlException exception, Boolean breakConnection, Action`1 wrapCloseInAction)
   at Microsoft.Data.SqlClient.SqlInternalConnection.OnError(SqlException exception, Boolean breakConnection, Action`1 wrapCloseInAction)
   at Microsoft.Data.SqlClient.TdsParser.ThrowExceptionAndWarning(TdsParserStateObject stateObj, Boolean callerHasConnectionLock, Boolean asyncClose)
   at Microsoft.Data.SqlClient.TdsParser.TryRun(RunBehavior runBehavior, SqlCommand cmdHandler, SqlDataReader dataStream, BulkCopySimpleResultSet bulkCopyHandler, TdsParserStateObject stateObj, Boolean& dataReady)
   at Microsoft.Data.SqlClient.SqlDataReader.TryHasMoreRows(Boolean& moreRows)
   at Microsoft.Data.SqlClient.SqlDataReader.TryReadInternal(Boolean setTimeout, Boolean& more)
   at Microsoft.Data.SqlClient.SqlDataReader.ReadAsyncExecute(Task task, Object state)
   at Microsoft.Data.SqlClient.SqlDataReader.InvokeAsyncCall[T](SqlDataReaderBaseAsyncCallContext`1 context)
--- End of stack trace from previous location ---
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeResultSetAsync(Int32 startCommandIndex, RelationalDataReader reader, CancellationToken cancellationToken)
ClientConnectionId:70f6f670-0785-41dd-959c-aea958544bc8
Error Number:2601,State:1,Class:14
   --- End of inner exception stack trace ---
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeResultSetAsync(Int32 startCommandIndex, RelationalDataReader reader, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeAsync(RelationalDataReader reader, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Update.Internal.SqlServerModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(IList`1 entriesToSave, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(StateManager stateManager, Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Storage.Internal.SqlServerExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
2025-02-02 19:31:19.387 +03:00 [INF] Executed action NayifatAPI.Controllers.DeviceController.RegisterDevice (NayifatAPI) in 1211.6708ms
2025-02-02 19:31:19.390 +03:00 [INF] Executed endpoint 'NayifatAPI.Controllers.DeviceController.RegisterDevice (NayifatAPI)'
2025-02-02 19:31:19.392 +03:00 [ERR] Unhandled exception
Microsoft.EntityFrameworkCore.DbUpdateException: An error occurred while saving the entity changes. See the inner exception for details.
 ---> Microsoft.Data.SqlClient.SqlException (0x80131904): Cannot insert duplicate key row in object 'dbo.Customer_Devices' with unique index 'IX_Customer_Devices_NationalId_DeviceId'. The duplicate key value is (1064448614, TP1A.220624.014).
   at Microsoft.Data.SqlClient.SqlConnection.OnError(SqlException exception, Boolean breakConnection, Action`1 wrapCloseInAction)
   at Microsoft.Data.SqlClient.SqlInternalConnection.OnError(SqlException exception, Boolean breakConnection, Action`1 wrapCloseInAction)
   at Microsoft.Data.SqlClient.TdsParser.ThrowExceptionAndWarning(TdsParserStateObject stateObj, Boolean callerHasConnectionLock, Boolean asyncClose)
   at Microsoft.Data.SqlClient.TdsParser.TryRun(RunBehavior runBehavior, SqlCommand cmdHandler, SqlDataReader dataStream, BulkCopySimpleResultSet bulkCopyHandler, TdsParserStateObject stateObj, Boolean& dataReady)
   at Microsoft.Data.SqlClient.SqlDataReader.TryHasMoreRows(Boolean& moreRows)
   at Microsoft.Data.SqlClient.SqlDataReader.TryReadInternal(Boolean setTimeout, Boolean& more)
   at Microsoft.Data.SqlClient.SqlDataReader.ReadAsyncExecute(Task task, Object state)
   at Microsoft.Data.SqlClient.SqlDataReader.InvokeAsyncCall[T](SqlDataReaderBaseAsyncCallContext`1 context)
--- End of stack trace from previous location ---
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeResultSetAsync(Int32 startCommandIndex, RelationalDataReader reader, CancellationToken cancellationToken)
ClientConnectionId:70f6f670-0785-41dd-959c-aea958544bc8
Error Number:2601,State:1,Class:14
   --- End of inner exception stack trace ---
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeResultSetAsync(Int32 startCommandIndex, RelationalDataReader reader, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeAsync(RelationalDataReader reader, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Update.Internal.SqlServerModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(IList`1 entriesToSave, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(StateManager stateManager, Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Storage.Internal.SqlServerExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at NayifatAPI.Controllers.DeviceController.RegisterDevice(RegisterDeviceRequest request) in C:\Users\yamta\StudioProjects\nayifat_app_2025_new\nayifatapi\Controllers\DeviceController.cs:line 105
   at Microsoft.AspNetCore.Mvc.Infrastructure.ActionMethodExecutor.TaskOfIActionResultExecutor.Execute(ActionContext actionContext, IActionResultTypeMapper mapper, ObjectMethodExecutor executor, Object controller, Object[] arguments)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.<InvokeActionMethodAsync>g__Awaited|12_0(ControllerActionInvoker invoker, ValueTask`1 actionResultValueTask)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.<InvokeNextActionFilterAsync>g__Awaited|10_0(ControllerActionInvoker invoker, Task lastTask, State next, Scope scope, Object state, Boolean isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.Rethrow(ActionExecutedContextSealed context)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.Next(State& next, Scope& scope, Object& state, Boolean& isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.<InvokeInnerFilterAsync>g__Awaited|13_0(ControllerActionInvoker invoker, Task lastTask, State next, Scope scope, Object state, Boolean isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeFilterPipelineAsync>g__Awaited|20_0(ResourceInvoker invoker, Task lastTask, State next, Scope scope, Object state, Boolean isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeAsync>g__Logged|17_1(ResourceInvoker invoker)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeAsync>g__Logged|17_1(ResourceInvoker invoker)
   at Microsoft.AspNetCore.Routing.EndpointMiddleware.<Invoke>g__AwaitRequestTask|7_0(Endpoint endpoint, Task requestTask, ILogger logger)
   at Microsoft.AspNetCore.Authorization.AuthorizationMiddleware.Invoke(HttpContext context)
   at Program.<>c.<<<Main>$>b__0_3>d.MoveNext() in C:\Users\yamta\StudioProjects\nayifat_app_2025_new\nayifatapi\Program.cs:line 85
2025-02-02 19:31:19.415 +03:00 [ERR] An unhandled exception has occurred while executing the request.
Microsoft.EntityFrameworkCore.DbUpdateException: An error occurred while saving the entity changes. See the inner exception for details.
 ---> Microsoft.Data.SqlClient.SqlException (0x80131904): Cannot insert duplicate key row in object 'dbo.Customer_Devices' with unique index 'IX_Customer_Devices_NationalId_DeviceId'. The duplicate key value is (1064448614, TP1A.220624.014).
   at Microsoft.Data.SqlClient.SqlConnection.OnError(SqlException exception, Boolean breakConnection, Action`1 wrapCloseInAction)
   at Microsoft.Data.SqlClient.SqlInternalConnection.OnError(SqlException exception, Boolean breakConnection, Action`1 wrapCloseInAction)
   at Microsoft.Data.SqlClient.TdsParser.ThrowExceptionAndWarning(TdsParserStateObject stateObj, Boolean callerHasConnectionLock, Boolean asyncClose)
   at Microsoft.Data.SqlClient.TdsParser.TryRun(RunBehavior runBehavior, SqlCommand cmdHandler, SqlDataReader dataStream, BulkCopySimpleResultSet bulkCopyHandler, TdsParserStateObject stateObj, Boolean& dataReady)
   at Microsoft.Data.SqlClient.SqlDataReader.TryHasMoreRows(Boolean& moreRows)
   at Microsoft.Data.SqlClient.SqlDataReader.TryReadInternal(Boolean setTimeout, Boolean& more)
   at Microsoft.Data.SqlClient.SqlDataReader.ReadAsyncExecute(Task task, Object state)
   at Microsoft.Data.SqlClient.SqlDataReader.InvokeAsyncCall[T](SqlDataReaderBaseAsyncCallContext`1 context)
--- End of stack trace from previous location ---
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeResultSetAsync(Int32 startCommandIndex, RelationalDataReader reader, CancellationToken cancellationToken)
ClientConnectionId:70f6f670-0785-41dd-959c-aea958544bc8
Error Number:2601,State:1,Class:14
   --- End of inner exception stack trace ---
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeResultSetAsync(Int32 startCommandIndex, RelationalDataReader reader, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeAsync(RelationalDataReader reader, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Update.Internal.SqlServerModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(IList`1 entriesToSave, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(StateManager stateManager, Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Storage.Internal.SqlServerExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at NayifatAPI.Controllers.DeviceController.RegisterDevice(RegisterDeviceRequest request) in C:\Users\yamta\StudioProjects\nayifat_app_2025_new\nayifatapi\Controllers\DeviceController.cs:line 105
   at Microsoft.AspNetCore.Mvc.Infrastructure.ActionMethodExecutor.TaskOfIActionResultExecutor.Execute(ActionContext actionContext, IActionResultTypeMapper mapper, ObjectMethodExecutor executor, Object controller, Object[] arguments)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.<InvokeActionMethodAsync>g__Awaited|12_0(ControllerActionInvoker invoker, ValueTask`1 actionResultValueTask)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.<InvokeNextActionFilterAsync>g__Awaited|10_0(ControllerActionInvoker invoker, Task lastTask, State next, Scope scope, Object state, Boolean isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.Rethrow(ActionExecutedContextSealed context)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.Next(State& next, Scope& scope, Object& state, Boolean& isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.<InvokeInnerFilterAsync>g__Awaited|13_0(ControllerActionInvoker invoker, Task lastTask, State next, Scope scope, Object state, Boolean isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeFilterPipelineAsync>g__Awaited|20_0(ResourceInvoker invoker, Task lastTask, State next, Scope scope, Object state, Boolean isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeAsync>g__Logged|17_1(ResourceInvoker invoker)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeAsync>g__Logged|17_1(ResourceInvoker invoker)
   at Microsoft.AspNetCore.Routing.EndpointMiddleware.<Invoke>g__AwaitRequestTask|7_0(Endpoint endpoint, Task requestTask, ILogger logger)
   at Microsoft.AspNetCore.Authorization.AuthorizationMiddleware.Invoke(HttpContext context)
   at Program.<>c.<<<Main>$>b__0_3>d.MoveNext() in C:\Users\yamta\StudioProjects\nayifat_app_2025_new\nayifatapi\Program.cs:line 85
--- End of stack trace from previous location ---
   at Swashbuckle.AspNetCore.SwaggerUI.SwaggerUIMiddleware.Invoke(HttpContext httpContext)
   at Swashbuckle.AspNetCore.Swagger.SwaggerMiddleware.Invoke(HttpContext httpContext, ISwaggerProvider swaggerProvider)
   at Microsoft.AspNetCore.Authentication.AuthenticationMiddleware.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Diagnostics.DeveloperExceptionPageMiddlewareImpl.Invoke(HttpContext context)
2025-02-02 19:31:19.447 +03:00 [INF] Request finished HTTP/1.1 POST http://07ca-46-152-255-232.ngrok-free.app/api/device - 500 null text/plain; charset=utf-8 1278.7345ms
2025-02-02 19:31:56.618 +03:00 [INF] Request starting HTTP/1.1 POST http://07ca-46-152-255-232.ngrok-free.app/api/notifications/list - application/json; charset=utf-8 47
2025-02-02 19:31:56.719 +03:00 [INF] Executing endpoint 'NayifatAPI.Controllers.NotificationsController.GetNotifications (NayifatAPI)'
2025-02-02 19:31:56.723 +03:00 [INF] Route matched with {action = "GetNotifications", controller = "Notifications"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetNotifications(NayifatAPI.Controllers.GetNotificationsRequest) on controller NayifatAPI.Controllers.NotificationsController (NayifatAPI).
2025-02-02 19:31:56.756 +03:00 [INF] Executed DbCommand (24ms) [Parameters=[@__providedApiKey_0='?' (Size = 255)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [a].[Key], [a].[CreatedAt], [a].[Description], [a].[ExpiresAt], [a].[IsActive], [a].[LastUsedAt]
FROM [ApiKeys] AS [a]
WHERE [a].[Key] = @__providedApiKey_0 AND [a].[IsActive] = CAST(1 AS bit)
2025-02-02 19:31:56.770 +03:00 [INF] Executed DbCommand (10ms) [Parameters=[@__request_NationalId_0='?' (Size = 450)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [u].[national_id], [u].[last_updated], [u].[notifications]
FROM [user_notifications] AS [u]
WHERE [u].[national_id] = @__request_NationalId_0
2025-02-02 19:31:56.807 +03:00 [INF] Executed DbCommand (3ms) [Parameters=[@__Parse_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [n].[Id], [n].[additional_data], [n].[Body], [n].[body_ar], [n].[body_en], [n].[created_at], [n].[expiry_at], [n].[Route], [n].[target_criteria], [n].[Title], [n].[title_ar], [n].[title_en]
FROM [notification_templates] AS [n]
WHERE [n].[Id] = @__Parse_0
2025-02-02 19:31:56.811 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@__Parse_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [n].[Id], [n].[additional_data], [n].[Body], [n].[body_ar], [n].[body_en], [n].[created_at], [n].[expiry_at], [n].[Route], [n].[target_criteria], [n].[Title], [n].[title_ar], [n].[title_en]
FROM [notification_templates] AS [n]
WHERE [n].[Id] = @__Parse_0
2025-02-02 19:31:56.894 +03:00 [INF] Executed DbCommand (79ms) [Parameters=[@p0='?' (Size = 4000), @p1='?' (DbType = DateTime2), @p2='?' (Size = 4000), @p3='?' (Size = 4000), @p4='?' (Size = 4000), @p5='?' (Size = 450), @p6='?' (Size = 4000), @p7='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SET IMPLICIT_TRANSACTIONS OFF;
SET NOCOUNT ON;
INSERT INTO [AuthLogs] ([AuthType], [CreatedAt], [DeviceId], [FailureReason], [IpAddress], [NationalId], [Status], [UserAgent])
OUTPUT INSERTED.[Id]
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7);
2025-02-02 19:31:56.898 +03:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType9`2[[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Object, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-02-02 19:31:56.899 +03:00 [INF] Executed action NayifatAPI.Controllers.NotificationsController.GetNotifications (NayifatAPI) in 171.3496ms
2025-02-02 19:31:56.900 +03:00 [INF] Executed endpoint 'NayifatAPI.Controllers.NotificationsController.GetNotifications (NayifatAPI)'
2025-02-02 19:31:56.902 +03:00 [INF] Request finished HTTP/1.1 POST http://07ca-46-152-255-232.ngrok-free.app/api/notifications/list - 200 null application/json; charset=utf-8 283.5557ms
2025-02-02 19:33:19.054 +03:00 [INF] Request starting HTTP/1.1 POST http://07ca-46-152-255-232.ngrok-free.app/api/notifications/list - application/json; charset=utf-8 47
2025-02-02 19:33:19.062 +03:00 [INF] Executing endpoint 'NayifatAPI.Controllers.NotificationsController.GetNotifications (NayifatAPI)'
2025-02-02 19:33:19.063 +03:00 [INF] Route matched with {action = "GetNotifications", controller = "Notifications"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetNotifications(NayifatAPI.Controllers.GetNotificationsRequest) on controller NayifatAPI.Controllers.NotificationsController (NayifatAPI).
2025-02-02 19:33:19.067 +03:00 [INF] Executed DbCommand (2ms) [Parameters=[@__providedApiKey_0='?' (Size = 255)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [a].[Key], [a].[CreatedAt], [a].[Description], [a].[ExpiresAt], [a].[IsActive], [a].[LastUsedAt]
FROM [ApiKeys] AS [a]
WHERE [a].[Key] = @__providedApiKey_0 AND [a].[IsActive] = CAST(1 AS bit)
2025-02-02 19:33:19.071 +03:00 [INF] Executed DbCommand (2ms) [Parameters=[@__request_NationalId_0='?' (Size = 450)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [u].[national_id], [u].[last_updated], [u].[notifications]
FROM [user_notifications] AS [u]
WHERE [u].[national_id] = @__request_NationalId_0
2025-02-02 19:33:19.079 +03:00 [INF] Executed DbCommand (2ms) [Parameters=[@__Parse_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [n].[Id], [n].[additional_data], [n].[Body], [n].[body_ar], [n].[body_en], [n].[created_at], [n].[expiry_at], [n].[Route], [n].[target_criteria], [n].[Title], [n].[title_ar], [n].[title_en]
FROM [notification_templates] AS [n]
WHERE [n].[Id] = @__Parse_0
2025-02-02 19:33:19.082 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@__Parse_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [n].[Id], [n].[additional_data], [n].[Body], [n].[body_ar], [n].[body_en], [n].[created_at], [n].[expiry_at], [n].[Route], [n].[target_criteria], [n].[Title], [n].[title_ar], [n].[title_en]
FROM [notification_templates] AS [n]
WHERE [n].[Id] = @__Parse_0
2025-02-02 19:33:19.161 +03:00 [INF] Executed DbCommand (76ms) [Parameters=[@p0='?' (Size = 4000), @p1='?' (DbType = DateTime2), @p2='?' (Size = 4000), @p3='?' (Size = 4000), @p4='?' (Size = 4000), @p5='?' (Size = 450), @p6='?' (Size = 4000), @p7='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SET IMPLICIT_TRANSACTIONS OFF;
SET NOCOUNT ON;
INSERT INTO [AuthLogs] ([AuthType], [CreatedAt], [DeviceId], [FailureReason], [IpAddress], [NationalId], [Status], [UserAgent])
OUTPUT INSERTED.[Id]
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7);
2025-02-02 19:33:19.164 +03:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType9`2[[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Object, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-02-02 19:33:19.165 +03:00 [INF] Executed action NayifatAPI.Controllers.NotificationsController.GetNotifications (NayifatAPI) in 101.7275ms
2025-02-02 19:33:19.167 +03:00 [INF] Executed endpoint 'NayifatAPI.Controllers.NotificationsController.GetNotifications (NayifatAPI)'
2025-02-02 19:33:19.168 +03:00 [INF] Request finished HTTP/1.1 POST http://07ca-46-152-255-232.ngrok-free.app/api/notifications/list - 200 null application/json; charset=utf-8 113.7604ms
2025-02-02 19:33:30.210 +03:00 [INF] Request starting HTTP/1.1 POST http://07ca-46-152-255-232.ngrok-free.app/api/auth/signin - application/json; charset=utf-8 78
2025-02-02 19:33:30.216 +03:00 [INF] Executing endpoint 'NayifatAPI.Controllers.AuthController.SignIn (NayifatAPI)'
2025-02-02 19:33:30.218 +03:00 [INF] Route matched with {action = "SignIn", controller = "Auth"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] SignIn(NayifatAPI.Controllers.SignInRequest) on controller NayifatAPI.Controllers.AuthController (NayifatAPI).
2025-02-02 19:33:30.222 +03:00 [INF] Executed DbCommand (0ms) [Parameters=[@__providedApiKey_0='?' (Size = 255)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [a].[Key], [a].[CreatedAt], [a].[Description], [a].[ExpiresAt], [a].[IsActive], [a].[LastUsedAt]
FROM [ApiKeys] AS [a]
WHERE [a].[Key] = @__providedApiKey_0 AND [a].[IsActive] = CAST(1 AS bit)
2025-02-02 19:33:30.227 +03:00 [INF] Executed DbCommand (2ms) [Parameters=[@__request_NationalId_0='?' (Size = 450)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [c].[NationalId], [c].[AddNo], [c].[BuildingNo], [c].[City], [c].[Consent], [c].[ConsentDate], [c].[DateOfBirth], [c].[Dependents], [c].[District], [c].[Email], [c].[Employer], [c].[FamilyNameAr], [c].[FamilyNameEn], [c].[FirstNameAr], [c].[FirstNameEn], [c].[Iban], [c].[IdExpiryDate], [c].[Los], [c].[Mpin], [c].[MpinEnabled], [c].[NafathStatus], [c].[NafathTimestamp], [c].[Password], [c].[Phone], [c].[RegistrationDate], [c].[SalaryCustomer], [c].[SalaryDakhli], [c].[SecondNameAr], [c].[SecondNameEn], [c].[Sector], [c].[Street], [c].[ThirdNameAr], [c].[ThirdNameEn], [c].[Zipcode]
FROM [Customers] AS [c]
WHERE [c].[NationalId] = @__request_NationalId_0
2025-02-02 19:33:30.230 +03:00 [INF] Starting password verification for NationalId: 1064448614
2025-02-02 19:33:30.406 +03:00 [INF] Password verification result for NationalId 1064448614: Success
2025-02-02 19:33:30.411 +03:00 [INF] Executed DbCommand (3ms) [Parameters=[@__request_NationalId_0='?' (Size = 450), @__request_DeviceId_1='?' (Size = 450)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [c].[Id], [c].[BiometricEnabled], [c].[BiometricToken], [c].[CreatedAt], [c].[DeviceId], [c].[LastUsedAt], [c].[Manufacturer], [c].[Model], [c].[NationalId], [c].[OsVersion], [c].[Platform], [c].[Status]
FROM [Customer_Devices] AS [c]
WHERE [c].[NationalId] = @__request_NationalId_0 AND [c].[DeviceId] = @__request_DeviceId_1 AND [c].[Status] = N'active'
2025-02-02 19:33:30.488 +03:00 [INF] Executed DbCommand (74ms) [Parameters=[@p0='?' (Size = 4000), @p1='?' (DbType = DateTime2), @p2='?' (Size = 4000), @p3='?' (Size = 4000), @p4='?' (Size = 4000), @p5='?' (Size = 450), @p6='?' (Size = 4000), @p7='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SET IMPLICIT_TRANSACTIONS OFF;
SET NOCOUNT ON;
INSERT INTO [AuthLogs] ([AuthType], [CreatedAt], [DeviceId], [FailureReason], [IpAddress], [NationalId], [Status], [UserAgent])
OUTPUT INSERTED.[Id]
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7);
2025-02-02 19:33:30.492 +03:00 [INF] Executing ObjectResult, writing value of type '<>f__AnonymousType12`3[[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Object, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-02-02 19:33:30.493 +03:00 [INF] Executed action NayifatAPI.Controllers.AuthController.SignIn (NayifatAPI) in 273.5735ms
2025-02-02 19:33:30.494 +03:00 [INF] Executed endpoint 'NayifatAPI.Controllers.AuthController.SignIn (NayifatAPI)'
2025-02-02 19:33:30.495 +03:00 [INF] Request finished HTTP/1.1 POST http://07ca-46-152-255-232.ngrok-free.app/api/auth/signin - 401 null application/json; charset=utf-8 284.8368ms
2025-02-02 19:34:41.608 +03:00 [INF] Request starting HTTP/1.1 POST http://localhost:5264/api/auth/signin - application/json 288
2025-02-02 19:34:41.610 +03:00 [INF] Executing endpoint 'NayifatAPI.Controllers.AuthController.SignIn (NayifatAPI)'
2025-02-02 19:34:41.610 +03:00 [INF] Route matched with {action = "SignIn", controller = "Auth"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] SignIn(NayifatAPI.Controllers.SignInRequest) on controller NayifatAPI.Controllers.AuthController (NayifatAPI).
2025-02-02 19:34:41.617 +03:00 [INF] Executed DbCommand (3ms) [Parameters=[@__providedApiKey_0='?' (Size = 255)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [a].[Key], [a].[CreatedAt], [a].[Description], [a].[ExpiresAt], [a].[IsActive], [a].[LastUsedAt]
FROM [ApiKeys] AS [a]
WHERE [a].[Key] = @__providedApiKey_0 AND [a].[IsActive] = CAST(1 AS bit)
2025-02-02 19:34:41.622 +03:00 [INF] Executed DbCommand (3ms) [Parameters=[@__request_NationalId_0='?' (Size = 450)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [c].[NationalId], [c].[AddNo], [c].[BuildingNo], [c].[City], [c].[Consent], [c].[ConsentDate], [c].[DateOfBirth], [c].[Dependents], [c].[District], [c].[Email], [c].[Employer], [c].[FamilyNameAr], [c].[FamilyNameEn], [c].[FirstNameAr], [c].[FirstNameEn], [c].[Iban], [c].[IdExpiryDate], [c].[Los], [c].[Mpin], [c].[MpinEnabled], [c].[NafathStatus], [c].[NafathTimestamp], [c].[Password], [c].[Phone], [c].[RegistrationDate], [c].[SalaryCustomer], [c].[SalaryDakhli], [c].[SecondNameAr], [c].[SecondNameEn], [c].[Sector], [c].[Street], [c].[ThirdNameAr], [c].[ThirdNameEn], [c].[Zipcode]
FROM [Customers] AS [c]
WHERE [c].[NationalId] = @__request_NationalId_0
2025-02-02 19:34:41.625 +03:00 [INF] Starting password verification for NationalId: 1064448614
2025-02-02 19:34:41.813 +03:00 [INF] Password verification result for NationalId 1064448614: Failed
2025-02-02 19:34:41.827 +03:00 [INF] Executed DbCommand (11ms) [Parameters=[@p0='?' (Size = 4000), @p1='?' (DbType = DateTime2), @p2='?' (Size = 4000), @p3='?' (Size = 4000), @p4='?' (Size = 4000), @p5='?' (Size = 450), @p6='?' (Size = 4000), @p7='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SET IMPLICIT_TRANSACTIONS OFF;
SET NOCOUNT ON;
INSERT INTO [AuthLogs] ([AuthType], [CreatedAt], [DeviceId], [FailureReason], [IpAddress], [NationalId], [Status], [UserAgent])
OUTPUT INSERTED.[Id]
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7);
2025-02-02 19:34:41.831 +03:00 [INF] Executing ObjectResult, writing value of type '<>f__AnonymousType12`3[[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Object, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-02-02 19:34:41.832 +03:00 [INF] Executed action NayifatAPI.Controllers.AuthController.SignIn (NayifatAPI) in 220.7033ms
2025-02-02 19:34:41.835 +03:00 [INF] Executed endpoint 'NayifatAPI.Controllers.AuthController.SignIn (NayifatAPI)'
2025-02-02 19:34:41.837 +03:00 [INF] Request finished HTTP/1.1 POST http://localhost:5264/api/auth/signin - 401 null application/json; charset=utf-8 228.6863ms
2025-02-02 19:34:57.884 +03:00 [INF] Request starting HTTP/1.1 POST http://localhost:5264/api/auth/signin - application/json 236
2025-02-02 19:34:57.954 +03:00 [INF] Executing endpoint 'NayifatAPI.Controllers.AuthController.SignIn (NayifatAPI)'
2025-02-02 19:34:57.955 +03:00 [INF] Route matched with {action = "SignIn", controller = "Auth"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] SignIn(NayifatAPI.Controllers.SignInRequest) on controller NayifatAPI.Controllers.AuthController (NayifatAPI).
2025-02-02 19:34:58.025 +03:00 [INF] Executed DbCommand (59ms) [Parameters=[@__providedApiKey_0='?' (Size = 255)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [a].[Key], [a].[CreatedAt], [a].[Description], [a].[ExpiresAt], [a].[IsActive], [a].[LastUsedAt]
FROM [ApiKeys] AS [a]
WHERE [a].[Key] = @__providedApiKey_0 AND [a].[IsActive] = CAST(1 AS bit)
2025-02-02 19:34:58.041 +03:00 [INF] Executed DbCommand (13ms) [Parameters=[@__request_NationalId_0='?' (Size = 450)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [c].[NationalId], [c].[AddNo], [c].[BuildingNo], [c].[City], [c].[Consent], [c].[ConsentDate], [c].[DateOfBirth], [c].[Dependents], [c].[District], [c].[Email], [c].[Employer], [c].[FamilyNameAr], [c].[FamilyNameEn], [c].[FirstNameAr], [c].[FirstNameEn], [c].[Iban], [c].[IdExpiryDate], [c].[Los], [c].[Mpin], [c].[MpinEnabled], [c].[NafathStatus], [c].[NafathTimestamp], [c].[Password], [c].[Phone], [c].[RegistrationDate], [c].[SalaryCustomer], [c].[SalaryDakhli], [c].[SecondNameAr], [c].[SecondNameEn], [c].[Sector], [c].[Street], [c].[ThirdNameAr], [c].[ThirdNameEn], [c].[Zipcode]
FROM [Customers] AS [c]
WHERE [c].[NationalId] = @__request_NationalId_0
2025-02-02 19:34:58.121 +03:00 [INF] Starting password verification for NationalId: 1064448614
2025-02-02 19:34:58.433 +03:00 [INF] Password verification result for NationalId 1064448614: Success
2025-02-02 19:34:58.538 +03:00 [INF] Executed DbCommand (76ms) [Parameters=[@__request_NationalId_0='?' (Size = 450), @__request_DeviceId_1='?' (Size = 450)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [c].[Id], [c].[BiometricEnabled], [c].[BiometricToken], [c].[CreatedAt], [c].[DeviceId], [c].[LastUsedAt], [c].[Manufacturer], [c].[Model], [c].[NationalId], [c].[OsVersion], [c].[Platform], [c].[Status]
FROM [Customer_Devices] AS [c]
WHERE [c].[NationalId] = @__request_NationalId_0 AND [c].[DeviceId] = @__request_DeviceId_1 AND [c].[Status] = N'active'
2025-02-02 19:34:58.793 +03:00 [INF] Executed DbCommand (173ms) [Parameters=[@p0='?' (Size = 4000), @p1='?' (DbType = DateTime2), @p2='?' (Size = 4000), @p3='?' (Size = 4000), @p4='?' (Size = 4000), @p5='?' (Size = 450), @p6='?' (Size = 4000), @p7='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SET IMPLICIT_TRANSACTIONS OFF;
SET NOCOUNT ON;
INSERT INTO [AuthLogs] ([AuthType], [CreatedAt], [DeviceId], [FailureReason], [IpAddress], [NationalId], [Status], [UserAgent])
OUTPUT INSERTED.[Id]
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7);
2025-02-02 19:34:58.826 +03:00 [INF] Executing ObjectResult, writing value of type '<>f__AnonymousType12`3[[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Object, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-02-02 19:34:58.828 +03:00 [INF] Executed action NayifatAPI.Controllers.AuthController.SignIn (NayifatAPI) in 865.307ms
2025-02-02 19:34:58.829 +03:00 [INF] Executed endpoint 'NayifatAPI.Controllers.AuthController.SignIn (NayifatAPI)'
2025-02-02 19:34:58.847 +03:00 [INF] Request finished HTTP/1.1 POST http://localhost:5264/api/auth/signin - 401 null application/json; charset=utf-8 962.8933ms
2025-02-02 19:36:21.278 +03:00 [INF] Application is shutting down...
2025-02-02 19:36:44.849 +03:00 [INF] Starting web application
2025-02-02 19:36:44.982 +03:00 [INF] Now listening on: http://localhost:5264
2025-02-02 19:36:44.987 +03:00 [INF] Application started. Press Ctrl+C to shut down.
2025-02-02 19:36:44.988 +03:00 [INF] Hosting environment: Development
2025-02-02 19:36:44.989 +03:00 [INF] Content root path: C:\Users\yamta\StudioProjects\nayifat_app_2025_new\nayifatapi
2025-02-02 19:36:56.846 +03:00 [INF] Request starting HTTP/1.1 POST http://07ca-46-152-255-232.ngrok-free.app/api/notifications/list - application/json; charset=utf-8 47
2025-02-02 19:36:56.965 +03:00 [WRN] Failed to determine the https port for redirect.
2025-02-02 19:36:56.974 +03:00 [INF] Executing endpoint 'NayifatAPI.Controllers.NotificationsController.GetNotifications (NayifatAPI)'
2025-02-02 19:36:57.036 +03:00 [INF] Route matched with {action = "GetNotifications", controller = "Notifications"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetNotifications(NayifatAPI.Controllers.GetNotificationsRequest) on controller NayifatAPI.Controllers.NotificationsController (NayifatAPI).
2025-02-02 19:36:59.117 +03:00 [INF] Executed DbCommand (29ms) [Parameters=[@__providedApiKey_0='?' (Size = 255)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [a].[Key], [a].[CreatedAt], [a].[Description], [a].[ExpiresAt], [a].[IsActive], [a].[LastUsedAt]
FROM [ApiKeys] AS [a]
WHERE [a].[Key] = @__providedApiKey_0 AND [a].[IsActive] = CAST(1 AS bit)
2025-02-02 19:36:59.221 +03:00 [INF] Executed DbCommand (14ms) [Parameters=[@__request_NationalId_0='?' (Size = 450)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [u].[national_id], [u].[last_updated], [u].[notifications]
FROM [user_notifications] AS [u]
WHERE [u].[national_id] = @__request_NationalId_0
2025-02-02 19:36:59.265 +03:00 [INF] Executed DbCommand (3ms) [Parameters=[@__Parse_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [n].[Id], [n].[additional_data], [n].[Body], [n].[body_ar], [n].[body_en], [n].[created_at], [n].[expiry_at], [n].[Route], [n].[target_criteria], [n].[Title], [n].[title_ar], [n].[title_en]
FROM [notification_templates] AS [n]
WHERE [n].[Id] = @__Parse_0
2025-02-02 19:36:59.302 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@__Parse_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [n].[Id], [n].[additional_data], [n].[Body], [n].[body_ar], [n].[body_en], [n].[created_at], [n].[expiry_at], [n].[Route], [n].[target_criteria], [n].[Title], [n].[title_ar], [n].[title_en]
FROM [notification_templates] AS [n]
WHERE [n].[Id] = @__Parse_0
2025-02-02 19:36:59.538 +03:00 [INF] Executed DbCommand (78ms) [Parameters=[@p0='?' (Size = 4000), @p1='?' (DbType = DateTime2), @p2='?' (Size = 4000), @p3='?' (Size = 4000), @p4='?' (Size = 4000), @p5='?' (Size = 450), @p6='?' (Size = 4000), @p7='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SET IMPLICIT_TRANSACTIONS OFF;
SET NOCOUNT ON;
INSERT INTO [AuthLogs] ([AuthType], [CreatedAt], [DeviceId], [FailureReason], [IpAddress], [NationalId], [Status], [UserAgent])
OUTPUT INSERTED.[Id]
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7);
2025-02-02 19:36:59.568 +03:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType9`2[[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Object, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-02-02 19:36:59.589 +03:00 [INF] Executed action NayifatAPI.Controllers.NotificationsController.GetNotifications (NayifatAPI) in 2520.9079ms
2025-02-02 19:36:59.592 +03:00 [INF] Executed endpoint 'NayifatAPI.Controllers.NotificationsController.GetNotifications (NayifatAPI)'
2025-02-02 19:36:59.601 +03:00 [INF] Request finished HTTP/1.1 POST http://07ca-46-152-255-232.ngrok-free.app/api/notifications/list - 200 null application/json; charset=utf-8 2757.0853ms
2025-02-02 19:37:07.797 +03:00 [INF] Request starting HTTP/1.1 POST http://07ca-46-152-255-232.ngrok-free.app/api/auth/signin - application/json; charset=utf-8 78
2025-02-02 19:37:07.804 +03:00 [INF] Executing endpoint 'NayifatAPI.Controllers.AuthController.SignIn (NayifatAPI)'
2025-02-02 19:37:07.813 +03:00 [INF] Route matched with {action = "SignIn", controller = "Auth"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] SignIn(NayifatAPI.Controllers.SignInRequest) on controller NayifatAPI.Controllers.AuthController (NayifatAPI).
2025-02-02 19:37:07.841 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@__providedApiKey_0='?' (Size = 255)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [a].[Key], [a].[CreatedAt], [a].[Description], [a].[ExpiresAt], [a].[IsActive], [a].[LastUsedAt]
FROM [ApiKeys] AS [a]
WHERE [a].[Key] = @__providedApiKey_0 AND [a].[IsActive] = CAST(1 AS bit)
2025-02-02 19:37:07.860 +03:00 [INF] Executed DbCommand (3ms) [Parameters=[@__request_NationalId_0='?' (Size = 450)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [c].[NationalId], [c].[AddNo], [c].[BuildingNo], [c].[City], [c].[Consent], [c].[ConsentDate], [c].[DateOfBirth], [c].[Dependents], [c].[District], [c].[Email], [c].[Employer], [c].[FamilyNameAr], [c].[FamilyNameEn], [c].[FirstNameAr], [c].[FirstNameEn], [c].[Iban], [c].[IdExpiryDate], [c].[Los], [c].[Mpin], [c].[MpinEnabled], [c].[NafathStatus], [c].[NafathTimestamp], [c].[Password], [c].[Phone], [c].[RegistrationDate], [c].[SalaryCustomer], [c].[SalaryDakhli], [c].[SecondNameAr], [c].[SecondNameEn], [c].[Sector], [c].[Street], [c].[ThirdNameAr], [c].[ThirdNameEn], [c].[Zipcode]
FROM [Customers] AS [c]
WHERE [c].[NationalId] = @__request_NationalId_0
2025-02-02 19:37:07.930 +03:00 [INF] Starting password verification for NationalId: 1064448614
2025-02-02 19:37:08.284 +03:00 [INF] Password verification result for NationalId 1064448614: Success
2025-02-02 19:37:08.340 +03:00 [INF] Executed DbCommand (10ms) [Parameters=[@p0='?' (Size = 4000), @p1='?' (DbType = DateTime2), @p2='?' (Size = 4000), @p3='?' (Size = 4000), @p4='?' (Size = 4000), @p5='?' (Size = 450), @p6='?' (Size = 4000), @p7='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SET IMPLICIT_TRANSACTIONS OFF;
SET NOCOUNT ON;
INSERT INTO [AuthLogs] ([AuthType], [CreatedAt], [DeviceId], [FailureReason], [IpAddress], [NationalId], [Status], [UserAgent])
OUTPUT INSERTED.[Id]
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7);
2025-02-02 19:37:08.343 +03:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType9`2[[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Object, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-02-02 19:37:08.347 +03:00 [INF] Executed action NayifatAPI.Controllers.AuthController.SignIn (NayifatAPI) in 532.5925ms
2025-02-02 19:37:08.349 +03:00 [INF] Executed endpoint 'NayifatAPI.Controllers.AuthController.SignIn (NayifatAPI)'
2025-02-02 19:37:08.351 +03:00 [INF] Request finished HTTP/1.1 POST http://07ca-46-152-255-232.ngrok-free.app/api/auth/signin - 200 null application/json; charset=utf-8 553.41ms
2025-02-02 19:37:09.159 +03:00 [INF] Request starting HTTP/1.1 POST http://07ca-46-152-255-232.ngrok-free.app/api/proxy/forward?url=https://icreditdept.com/api/testasp/test_local_generate_otp.php - application/json; charset=utf-8 84
2025-02-02 19:37:09.228 +03:00 [INF] Executing endpoint 'NayifatAPI.Controllers.ProxyController.ForwardRequest (NayifatAPI)'
2025-02-02 19:37:09.233 +03:00 [INF] Route matched with {action = "ForwardRequest", controller = "Proxy"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] ForwardRequest() on controller NayifatAPI.Controllers.ProxyController (NayifatAPI).
2025-02-02 19:37:09.264 +03:00 [INF] Start processing HTTP request POST https://icreditdept.com/api/testasp/test_local_generate_otp.php
2025-02-02 19:37:09.399 +03:00 [INF] Sending HTTP request POST https://icreditdept.com/api/testasp/test_local_generate_otp.php
2025-02-02 19:37:11.603 +03:00 [INF] Received HTTP response headers after 2079.6209ms - 200
2025-02-02 19:37:11.720 +03:00 [INF] End processing HTTP request after 2458.3812ms - 200
2025-02-02 19:37:11.780 +03:00 [INF] Raw response length: 200
2025-02-02 19:37:11.781 +03:00 [INF] Response content: {"success":true,"errors":[],"result":{"nationalId":"1064448614","otp":574707,"expiryDate":"2025-02-02 19:42:11","successMsg":"Success","errCode":0,"errMsg":null},"type":"N","message":null,"code":null}
2025-02-02 19:37:11.787 +03:00 [INF] Executing ContentResult with HTTP Response ContentType of application/json
2025-02-02 19:37:11.789 +03:00 [INF] Executed action NayifatAPI.Controllers.ProxyController.ForwardRequest (NayifatAPI) in 2554.364ms
2025-02-02 19:37:11.798 +03:00 [INF] Executed endpoint 'NayifatAPI.Controllers.ProxyController.ForwardRequest (NayifatAPI)'
2025-02-02 19:37:11.799 +03:00 [INF] Request finished HTTP/1.1 POST http://07ca-46-152-255-232.ngrok-free.app/api/proxy/forward?url=https://icreditdept.com/api/testasp/test_local_generate_otp.php - 200 200 application/json 2639.9525ms
2025-02-02 19:37:33.496 +03:00 [INF] Request starting HTTP/1.1 POST http://07ca-46-152-255-232.ngrok-free.app/api/proxy/forward?url=https://icreditdept.com/api/testasp/test_local_verify_otp.php - application/json; charset=utf-8 53
2025-02-02 19:37:33.498 +03:00 [INF] Executing endpoint 'NayifatAPI.Controllers.ProxyController.ForwardRequest (NayifatAPI)'
2025-02-02 19:37:33.499 +03:00 [INF] Route matched with {action = "ForwardRequest", controller = "Proxy"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] ForwardRequest() on controller NayifatAPI.Controllers.ProxyController (NayifatAPI).
2025-02-02 19:37:33.501 +03:00 [INF] Start processing HTTP request POST https://icreditdept.com/api/testasp/test_local_verify_otp.php
2025-02-02 19:37:33.502 +03:00 [INF] Sending HTTP request POST https://icreditdept.com/api/testasp/test_local_verify_otp.php
2025-02-02 19:37:34.829 +03:00 [INF] Received HTTP response headers after 1325.4109ms - 200
2025-02-02 19:37:34.836 +03:00 [INF] End processing HTTP request after 1334.4881ms - 200
2025-02-02 19:37:34.840 +03:00 [INF] Raw response length: 202
2025-02-02 19:37:34.842 +03:00 [INF] Response content: {"success":true,"errors":[],"result":{"nationalId":"1064448614","otp":"574707","verifiedFlag":true,"successMsg":"Verified successfully.","errCode":0,"errMsg":null},"type":"N","message":null,"code":null}
2025-02-02 19:37:34.843 +03:00 [INF] Executing ContentResult with HTTP Response ContentType of application/json
2025-02-02 19:37:34.844 +03:00 [INF] Executed action NayifatAPI.Controllers.ProxyController.ForwardRequest (NayifatAPI) in 1343.4416ms
2025-02-02 19:37:34.845 +03:00 [INF] Executed endpoint 'NayifatAPI.Controllers.ProxyController.ForwardRequest (NayifatAPI)'
2025-02-02 19:37:34.846 +03:00 [INF] Request finished HTTP/1.1 POST http://07ca-46-152-255-232.ngrok-free.app/api/proxy/forward?url=https://icreditdept.com/api/testasp/test_local_verify_otp.php - 200 202 application/json 1350.392ms
2025-02-02 19:37:35.671 +03:00 [INF] Request starting HTTP/1.1 POST http://07ca-46-152-255-232.ngrok-free.app/api/auth/signin - application/json; charset=utf-8 49
2025-02-02 19:37:35.676 +03:00 [INF] Executing endpoint 'NayifatAPI.Controllers.AuthController.SignIn (NayifatAPI)'
2025-02-02 19:37:35.678 +03:00 [INF] Route matched with {action = "SignIn", controller = "Auth"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] SignIn(NayifatAPI.Controllers.SignInRequest) on controller NayifatAPI.Controllers.AuthController (NayifatAPI).
2025-02-02 19:37:35.684 +03:00 [INF] Executing BadRequestObjectResult, writing value of type 'Microsoft.AspNetCore.Mvc.ValidationProblemDetails'.
2025-02-02 19:37:35.699 +03:00 [INF] Executed action NayifatAPI.Controllers.AuthController.SignIn (NayifatAPI) in 20.0265ms
2025-02-02 19:37:35.702 +03:00 [INF] Executed endpoint 'NayifatAPI.Controllers.AuthController.SignIn (NayifatAPI)'
2025-02-02 19:37:35.705 +03:00 [INF] Request finished HTTP/1.1 POST http://07ca-46-152-255-232.ngrok-free.app/api/auth/signin - 400 null application/problem+json; charset=utf-8 33.7383ms
2025-02-02 19:38:48.938 +03:00 [INF] Request starting HTTP/1.1 POST http://07ca-46-152-255-232.ngrok-free.app/api/notifications/list - application/json; charset=utf-8 47
2025-02-02 19:38:48.941 +03:00 [INF] Executing endpoint 'NayifatAPI.Controllers.NotificationsController.GetNotifications (NayifatAPI)'
2025-02-02 19:38:48.942 +03:00 [INF] Route matched with {action = "GetNotifications", controller = "Notifications"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetNotifications(NayifatAPI.Controllers.GetNotificationsRequest) on controller NayifatAPI.Controllers.NotificationsController (NayifatAPI).
2025-02-02 19:38:49.016 +03:00 [INF] Executed DbCommand (4ms) [Parameters=[@__providedApiKey_0='?' (Size = 255)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [a].[Key], [a].[CreatedAt], [a].[Description], [a].[ExpiresAt], [a].[IsActive], [a].[LastUsedAt]
FROM [ApiKeys] AS [a]
WHERE [a].[Key] = @__providedApiKey_0 AND [a].[IsActive] = CAST(1 AS bit)
2025-02-02 19:38:49.022 +03:00 [INF] Executed DbCommand (3ms) [Parameters=[@__request_NationalId_0='?' (Size = 450)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [u].[national_id], [u].[last_updated], [u].[notifications]
FROM [user_notifications] AS [u]
WHERE [u].[national_id] = @__request_NationalId_0
2025-02-02 19:38:49.029 +03:00 [INF] Executed DbCommand (3ms) [Parameters=[@__Parse_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [n].[Id], [n].[additional_data], [n].[Body], [n].[body_ar], [n].[body_en], [n].[created_at], [n].[expiry_at], [n].[Route], [n].[target_criteria], [n].[Title], [n].[title_ar], [n].[title_en]
FROM [notification_templates] AS [n]
WHERE [n].[Id] = @__Parse_0
2025-02-02 19:38:49.034 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@__Parse_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [n].[Id], [n].[additional_data], [n].[Body], [n].[body_ar], [n].[body_en], [n].[created_at], [n].[expiry_at], [n].[Route], [n].[target_criteria], [n].[Title], [n].[title_ar], [n].[title_en]
FROM [notification_templates] AS [n]
WHERE [n].[Id] = @__Parse_0
2025-02-02 19:38:49.119 +03:00 [INF] Executed DbCommand (81ms) [Parameters=[@p0='?' (Size = 4000), @p1='?' (DbType = DateTime2), @p2='?' (Size = 4000), @p3='?' (Size = 4000), @p4='?' (Size = 4000), @p5='?' (Size = 450), @p6='?' (Size = 4000), @p7='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SET IMPLICIT_TRANSACTIONS OFF;
SET NOCOUNT ON;
INSERT INTO [AuthLogs] ([AuthType], [CreatedAt], [DeviceId], [FailureReason], [IpAddress], [NationalId], [Status], [UserAgent])
OUTPUT INSERTED.[Id]
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7);
2025-02-02 19:38:49.122 +03:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType9`2[[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Object, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-02-02 19:38:49.123 +03:00 [INF] Executed action NayifatAPI.Controllers.NotificationsController.GetNotifications (NayifatAPI) in 176.7893ms
2025-02-02 19:38:49.125 +03:00 [INF] Executed endpoint 'NayifatAPI.Controllers.NotificationsController.GetNotifications (NayifatAPI)'
2025-02-02 19:38:49.126 +03:00 [INF] Request finished HTTP/1.1 POST http://07ca-46-152-255-232.ngrok-free.app/api/notifications/list - 200 null application/json; charset=utf-8 188.4972ms
2025-02-02 19:38:50.534 +03:00 [INF] Request starting HTTP/1.1 POST http://localhost:5264/api/auth/signin - application/json 236
2025-02-02 19:38:50.536 +03:00 [INF] Executing endpoint 'NayifatAPI.Controllers.AuthController.SignIn (NayifatAPI)'
2025-02-02 19:38:50.537 +03:00 [INF] Route matched with {action = "SignIn", controller = "Auth"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] SignIn(NayifatAPI.Controllers.SignInRequest) on controller NayifatAPI.Controllers.AuthController (NayifatAPI).
2025-02-02 19:38:50.542 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@__providedApiKey_0='?' (Size = 255)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [a].[Key], [a].[CreatedAt], [a].[Description], [a].[ExpiresAt], [a].[IsActive], [a].[LastUsedAt]
FROM [ApiKeys] AS [a]
WHERE [a].[Key] = @__providedApiKey_0 AND [a].[IsActive] = CAST(1 AS bit)
2025-02-02 19:38:50.549 +03:00 [INF] Executed DbCommand (4ms) [Parameters=[@__request_NationalId_0='?' (Size = 450)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [c].[NationalId], [c].[AddNo], [c].[BuildingNo], [c].[City], [c].[Consent], [c].[ConsentDate], [c].[DateOfBirth], [c].[Dependents], [c].[District], [c].[Email], [c].[Employer], [c].[FamilyNameAr], [c].[FamilyNameEn], [c].[FirstNameAr], [c].[FirstNameEn], [c].[Iban], [c].[IdExpiryDate], [c].[Los], [c].[Mpin], [c].[MpinEnabled], [c].[NafathStatus], [c].[NafathTimestamp], [c].[Password], [c].[Phone], [c].[RegistrationDate], [c].[SalaryCustomer], [c].[SalaryDakhli], [c].[SecondNameAr], [c].[SecondNameEn], [c].[Sector], [c].[Street], [c].[ThirdNameAr], [c].[ThirdNameEn], [c].[Zipcode]
FROM [Customers] AS [c]
WHERE [c].[NationalId] = @__request_NationalId_0
2025-02-02 19:38:50.552 +03:00 [INF] Starting password verification for NationalId: 1064448614
2025-02-02 19:38:50.874 +03:00 [INF] Password verification result for NationalId 1064448614: Success
2025-02-02 19:38:50.882 +03:00 [INF] Executed DbCommand (7ms) [Parameters=[@p0='?' (Size = 4000), @p1='?' (DbType = DateTime2), @p2='?' (Size = 4000), @p3='?' (Size = 4000), @p4='?' (Size = 4000), @p5='?' (Size = 450), @p6='?' (Size = 4000), @p7='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SET IMPLICIT_TRANSACTIONS OFF;
SET NOCOUNT ON;
INSERT INTO [AuthLogs] ([AuthType], [CreatedAt], [DeviceId], [FailureReason], [IpAddress], [NationalId], [Status], [UserAgent])
OUTPUT INSERTED.[Id]
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7);
2025-02-02 19:38:50.887 +03:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType9`2[[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Object, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-02-02 19:38:50.888 +03:00 [INF] Executed action NayifatAPI.Controllers.AuthController.SignIn (NayifatAPI) in 350.127ms
2025-02-02 19:38:50.889 +03:00 [INF] Executed endpoint 'NayifatAPI.Controllers.AuthController.SignIn (NayifatAPI)'
2025-02-02 19:38:50.890 +03:00 [INF] Request finished HTTP/1.1 POST http://localhost:5264/api/auth/signin - 200 null application/json; charset=utf-8 356.6896ms
2025-02-02 19:39:13.685 +03:00 [INF] Application is shutting down...
2025-02-02 19:39:26.711 +03:00 [INF] Starting web application
2025-02-02 19:39:26.835 +03:00 [INF] Now listening on: http://localhost:5264
2025-02-02 19:39:26.842 +03:00 [INF] Application started. Press Ctrl+C to shut down.
2025-02-02 19:39:26.843 +03:00 [INF] Hosting environment: Development
2025-02-02 19:39:26.844 +03:00 [INF] Content root path: C:\Users\yamta\StudioProjects\nayifat_app_2025_new\nayifatapi
2025-02-02 19:39:42.110 +03:00 [INF] Request starting HTTP/1.1 POST http://07ca-46-152-255-232.ngrok-free.app/api/auth/signin - application/json; charset=utf-8 78
2025-02-02 19:39:42.274 +03:00 [WRN] Failed to determine the https port for redirect.
2025-02-02 19:39:42.320 +03:00 [INF] Executing endpoint 'NayifatAPI.Controllers.AuthController.SignIn (NayifatAPI)'
2025-02-02 19:39:42.376 +03:00 [INF] Route matched with {action = "SignIn", controller = "Auth"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] SignIn(NayifatAPI.Controllers.SignInRequest) on controller NayifatAPI.Controllers.AuthController (NayifatAPI).
2025-02-02 19:39:44.850 +03:00 [INF] Executed DbCommand (28ms) [Parameters=[@__providedApiKey_0='?' (Size = 255)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [a].[Key], [a].[CreatedAt], [a].[Description], [a].[ExpiresAt], [a].[IsActive], [a].[LastUsedAt]
FROM [ApiKeys] AS [a]
WHERE [a].[Key] = @__providedApiKey_0 AND [a].[IsActive] = CAST(1 AS bit)
2025-02-02 19:39:44.948 +03:00 [INF] Executed DbCommand (14ms) [Parameters=[@__request_NationalId_0='?' (Size = 450)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [c].[NationalId], [c].[AddNo], [c].[BuildingNo], [c].[City], [c].[Consent], [c].[ConsentDate], [c].[DateOfBirth], [c].[Dependents], [c].[District], [c].[Email], [c].[Employer], [c].[FamilyNameAr], [c].[FamilyNameEn], [c].[FirstNameAr], [c].[FirstNameEn], [c].[Iban], [c].[IdExpiryDate], [c].[Los], [c].[Mpin], [c].[MpinEnabled], [c].[NafathStatus], [c].[NafathTimestamp], [c].[Password], [c].[Phone], [c].[RegistrationDate], [c].[SalaryCustomer], [c].[SalaryDakhli], [c].[SecondNameAr], [c].[SecondNameEn], [c].[Sector], [c].[Street], [c].[ThirdNameAr], [c].[ThirdNameEn], [c].[Zipcode]
FROM [Customers] AS [c]
WHERE [c].[NationalId] = @__request_NationalId_0
2025-02-02 19:39:45.046 +03:00 [INF] Starting password verification for NationalId: 1064448614
2025-02-02 19:39:45.378 +03:00 [INF] Password verification result for NationalId 1064448614: Success
2025-02-02 19:39:45.637 +03:00 [INF] Executed DbCommand (76ms) [Parameters=[@p0='?' (Size = 4000), @p1='?' (DbType = DateTime2), @p2='?' (Size = 4000), @p3='?' (Size = 4000), @p4='?' (Size = 4000), @p5='?' (Size = 450), @p6='?' (Size = 4000), @p7='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SET IMPLICIT_TRANSACTIONS OFF;
SET NOCOUNT ON;
INSERT INTO [AuthLogs] ([AuthType], [CreatedAt], [DeviceId], [FailureReason], [IpAddress], [NationalId], [Status], [UserAgent])
OUTPUT INSERTED.[Id]
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7);
2025-02-02 19:39:45.670 +03:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType9`2[[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Object, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-02-02 19:39:45.687 +03:00 [INF] Executed action NayifatAPI.Controllers.AuthController.SignIn (NayifatAPI) in 3029.5009ms
2025-02-02 19:39:45.691 +03:00 [INF] Executed endpoint 'NayifatAPI.Controllers.AuthController.SignIn (NayifatAPI)'
2025-02-02 19:39:45.699 +03:00 [INF] Request finished HTTP/1.1 POST http://07ca-46-152-255-232.ngrok-free.app/api/auth/signin - 200 null application/json; charset=utf-8 3592.2405ms
2025-02-02 19:39:46.595 +03:00 [INF] Request starting HTTP/1.1 POST http://07ca-46-152-255-232.ngrok-free.app/api/proxy/forward?url=https://icreditdept.com/api/testasp/test_local_generate_otp.php - application/json; charset=utf-8 84
2025-02-02 19:39:46.605 +03:00 [INF] Executing endpoint 'NayifatAPI.Controllers.ProxyController.ForwardRequest (NayifatAPI)'
2025-02-02 19:39:46.611 +03:00 [INF] Route matched with {action = "ForwardRequest", controller = "Proxy"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] ForwardRequest() on controller NayifatAPI.Controllers.ProxyController (NayifatAPI).
2025-02-02 19:39:46.634 +03:00 [INF] Start processing HTTP request POST https://icreditdept.com/api/testasp/test_local_generate_otp.php
2025-02-02 19:39:46.636 +03:00 [INF] Sending HTTP request POST https://icreditdept.com/api/testasp/test_local_generate_otp.php
2025-02-02 19:39:48.001 +03:00 [INF] Received HTTP response headers after 1360.0052ms - 200
2025-02-02 19:39:48.003 +03:00 [INF] End processing HTTP request after 1371.3901ms - 200
2025-02-02 19:39:48.010 +03:00 [INF] Raw response length: 200
2025-02-02 19:39:48.011 +03:00 [INF] Response content: {"success":true,"errors":[],"result":{"nationalId":"1064448614","otp":833625,"expiryDate":"2025-02-02 19:44:48","successMsg":"Success","errCode":0,"errMsg":null},"type":"N","message":null,"code":null}
2025-02-02 19:39:48.013 +03:00 [INF] Executing ContentResult with HTTP Response ContentType of application/json
2025-02-02 19:39:48.016 +03:00 [INF] Executed action NayifatAPI.Controllers.ProxyController.ForwardRequest (NayifatAPI) in 1403.1096ms
2025-02-02 19:39:48.018 +03:00 [INF] Executed endpoint 'NayifatAPI.Controllers.ProxyController.ForwardRequest (NayifatAPI)'
2025-02-02 19:39:48.021 +03:00 [INF] Request finished HTTP/1.1 POST http://07ca-46-152-255-232.ngrok-free.app/api/proxy/forward?url=https://icreditdept.com/api/testasp/test_local_generate_otp.php - 200 200 application/json 1425.5037ms
2025-02-02 19:40:04.931 +03:00 [INF] Request starting HTTP/1.1 POST http://07ca-46-152-255-232.ngrok-free.app/api/proxy/forward?url=https://icreditdept.com/api/testasp/test_local_verify_otp.php - application/json; charset=utf-8 53
2025-02-02 19:40:04.936 +03:00 [INF] Executing endpoint 'NayifatAPI.Controllers.ProxyController.ForwardRequest (NayifatAPI)'
2025-02-02 19:40:04.937 +03:00 [INF] Route matched with {action = "ForwardRequest", controller = "Proxy"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] ForwardRequest() on controller NayifatAPI.Controllers.ProxyController (NayifatAPI).
2025-02-02 19:40:04.940 +03:00 [INF] Start processing HTTP request POST https://icreditdept.com/api/testasp/test_local_verify_otp.php
2025-02-02 19:40:04.941 +03:00 [INF] Sending HTTP request POST https://icreditdept.com/api/testasp/test_local_verify_otp.php
2025-02-02 19:40:05.642 +03:00 [INF] Received HTTP response headers after 698.8935ms - 200
2025-02-02 19:40:05.643 +03:00 [INF] End processing HTTP request after 702.4617ms - 200
2025-02-02 19:40:05.645 +03:00 [INF] Raw response length: 202
2025-02-02 19:40:05.645 +03:00 [INF] Response content: {"success":true,"errors":[],"result":{"nationalId":"1064448614","otp":"833625","verifiedFlag":true,"successMsg":"Verified successfully.","errCode":0,"errMsg":null},"type":"N","message":null,"code":null}
2025-02-02 19:40:05.646 +03:00 [INF] Executing ContentResult with HTTP Response ContentType of application/json
2025-02-02 19:40:05.647 +03:00 [INF] Executed action NayifatAPI.Controllers.ProxyController.ForwardRequest (NayifatAPI) in 708.6555ms
2025-02-02 19:40:05.649 +03:00 [INF] Executed endpoint 'NayifatAPI.Controllers.ProxyController.ForwardRequest (NayifatAPI)'
2025-02-02 19:40:05.651 +03:00 [INF] Request finished HTTP/1.1 POST http://07ca-46-152-255-232.ngrok-free.app/api/proxy/forward?url=https://icreditdept.com/api/testasp/test_local_verify_otp.php - 200 202 application/json 719.2197ms
2025-02-02 19:40:06.336 +03:00 [INF] Request starting HTTP/1.1 POST http://07ca-46-152-255-232.ngrok-free.app/api/auth/signin - application/json; charset=utf-8 49
2025-02-02 19:40:06.342 +03:00 [INF] Executing endpoint 'NayifatAPI.Controllers.AuthController.SignIn (NayifatAPI)'
2025-02-02 19:40:06.343 +03:00 [INF] Route matched with {action = "SignIn", controller = "Auth"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] SignIn(NayifatAPI.Controllers.SignInRequest) on controller NayifatAPI.Controllers.AuthController (NayifatAPI).
2025-02-02 19:40:06.346 +03:00 [INF] Executing BadRequestObjectResult, writing value of type 'Microsoft.AspNetCore.Mvc.ValidationProblemDetails'.
2025-02-02 19:40:06.365 +03:00 [INF] Executed action NayifatAPI.Controllers.AuthController.SignIn (NayifatAPI) in 21.1279ms
2025-02-02 19:40:06.368 +03:00 [INF] Executed endpoint 'NayifatAPI.Controllers.AuthController.SignIn (NayifatAPI)'
2025-02-02 19:40:06.369 +03:00 [INF] Request finished HTTP/1.1 POST http://07ca-46-152-255-232.ngrok-free.app/api/auth/signin - 400 null application/problem+json; charset=utf-8 32.5543ms
2025-02-02 19:41:57.062 +03:00 [INF] Request starting HTTP/1.1 POST http://07ca-46-152-255-232.ngrok-free.app/api/notifications/list - application/json; charset=utf-8 47
2025-02-02 19:41:57.180 +03:00 [INF] Executing endpoint 'NayifatAPI.Controllers.NotificationsController.GetNotifications (NayifatAPI)'
2025-02-02 19:41:57.188 +03:00 [INF] Route matched with {action = "GetNotifications", controller = "Notifications"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetNotifications(NayifatAPI.Controllers.GetNotificationsRequest) on controller NayifatAPI.Controllers.NotificationsController (NayifatAPI).
2025-02-02 19:41:57.390 +03:00 [INF] Executed DbCommand (15ms) [Parameters=[@__providedApiKey_0='?' (Size = 255)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [a].[Key], [a].[CreatedAt], [a].[Description], [a].[ExpiresAt], [a].[IsActive], [a].[LastUsedAt]
FROM [ApiKeys] AS [a]
WHERE [a].[Key] = @__providedApiKey_0 AND [a].[IsActive] = CAST(1 AS bit)
2025-02-02 19:41:57.406 +03:00 [INF] Executed DbCommand (2ms) [Parameters=[@__request_NationalId_0='?' (Size = 450)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [u].[national_id], [u].[last_updated], [u].[notifications]
FROM [user_notifications] AS [u]
WHERE [u].[national_id] = @__request_NationalId_0
2025-02-02 19:41:57.426 +03:00 [INF] Executed DbCommand (2ms) [Parameters=[@__Parse_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [n].[Id], [n].[additional_data], [n].[Body], [n].[body_ar], [n].[body_en], [n].[created_at], [n].[expiry_at], [n].[Route], [n].[target_criteria], [n].[Title], [n].[title_ar], [n].[title_en]
FROM [notification_templates] AS [n]
WHERE [n].[Id] = @__Parse_0
2025-02-02 19:41:57.450 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@__Parse_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [n].[Id], [n].[additional_data], [n].[Body], [n].[body_ar], [n].[body_en], [n].[created_at], [n].[expiry_at], [n].[Route], [n].[target_criteria], [n].[Title], [n].[title_ar], [n].[title_en]
FROM [notification_templates] AS [n]
WHERE [n].[Id] = @__Parse_0
2025-02-02 19:41:57.572 +03:00 [INF] Executed DbCommand (77ms) [Parameters=[@p0='?' (Size = 4000), @p1='?' (DbType = DateTime2), @p2='?' (Size = 4000), @p3='?' (Size = 4000), @p4='?' (Size = 4000), @p5='?' (Size = 450), @p6='?' (Size = 4000), @p7='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SET IMPLICIT_TRANSACTIONS OFF;
SET NOCOUNT ON;
INSERT INTO [AuthLogs] ([AuthType], [CreatedAt], [DeviceId], [FailureReason], [IpAddress], [NationalId], [Status], [UserAgent])
OUTPUT INSERTED.[Id]
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7);
2025-02-02 19:41:57.579 +03:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType9`2[[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Object, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-02-02 19:41:57.587 +03:00 [INF] Executed action NayifatAPI.Controllers.NotificationsController.GetNotifications (NayifatAPI) in 283.4972ms
2025-02-02 19:41:57.590 +03:00 [INF] Executed endpoint 'NayifatAPI.Controllers.NotificationsController.GetNotifications (NayifatAPI)'
2025-02-02 19:41:57.593 +03:00 [INF] Request finished HTTP/1.1 POST http://07ca-46-152-255-232.ngrok-free.app/api/notifications/list - 200 null application/json; charset=utf-8 530.5518ms
2025-02-02 19:43:19.123 +03:00 [INF] Request starting HTTP/1.1 POST http://07ca-46-152-255-232.ngrok-free.app/api/notifications/list - application/json; charset=utf-8 47
2025-02-02 19:43:19.128 +03:00 [INF] Executing endpoint 'NayifatAPI.Controllers.NotificationsController.GetNotifications (NayifatAPI)'
2025-02-02 19:43:19.129 +03:00 [INF] Route matched with {action = "GetNotifications", controller = "Notifications"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetNotifications(NayifatAPI.Controllers.GetNotificationsRequest) on controller NayifatAPI.Controllers.NotificationsController (NayifatAPI).
2025-02-02 19:43:19.239 +03:00 [INF] Executed DbCommand (7ms) [Parameters=[@__providedApiKey_0='?' (Size = 255)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [a].[Key], [a].[CreatedAt], [a].[Description], [a].[ExpiresAt], [a].[IsActive], [a].[LastUsedAt]
FROM [ApiKeys] AS [a]
WHERE [a].[Key] = @__providedApiKey_0 AND [a].[IsActive] = CAST(1 AS bit)
2025-02-02 19:43:19.246 +03:00 [INF] Executed DbCommand (3ms) [Parameters=[@__request_NationalId_0='?' (Size = 450)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [u].[national_id], [u].[last_updated], [u].[notifications]
FROM [user_notifications] AS [u]
WHERE [u].[national_id] = @__request_NationalId_0
2025-02-02 19:43:19.253 +03:00 [INF] Executed DbCommand (3ms) [Parameters=[@__Parse_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [n].[Id], [n].[additional_data], [n].[Body], [n].[body_ar], [n].[body_en], [n].[created_at], [n].[expiry_at], [n].[Route], [n].[target_criteria], [n].[Title], [n].[title_ar], [n].[title_en]
FROM [notification_templates] AS [n]
WHERE [n].[Id] = @__Parse_0
2025-02-02 19:43:19.264 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@__Parse_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [n].[Id], [n].[additional_data], [n].[Body], [n].[body_ar], [n].[body_en], [n].[created_at], [n].[expiry_at], [n].[Route], [n].[target_criteria], [n].[Title], [n].[title_ar], [n].[title_en]
FROM [notification_templates] AS [n]
WHERE [n].[Id] = @__Parse_0
2025-02-02 19:43:19.351 +03:00 [INF] Executed DbCommand (79ms) [Parameters=[@p0='?' (Size = 4000), @p1='?' (DbType = DateTime2), @p2='?' (Size = 4000), @p3='?' (Size = 4000), @p4='?' (Size = 4000), @p5='?' (Size = 450), @p6='?' (Size = 4000), @p7='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SET IMPLICIT_TRANSACTIONS OFF;
SET NOCOUNT ON;
INSERT INTO [AuthLogs] ([AuthType], [CreatedAt], [DeviceId], [FailureReason], [IpAddress], [NationalId], [Status], [UserAgent])
OUTPUT INSERTED.[Id]
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7);
2025-02-02 19:43:19.358 +03:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType9`2[[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Object, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-02-02 19:43:19.360 +03:00 [INF] Executed action NayifatAPI.Controllers.NotificationsController.GetNotifications (NayifatAPI) in 228.864ms
2025-02-02 19:43:19.363 +03:00 [INF] Executed endpoint 'NayifatAPI.Controllers.NotificationsController.GetNotifications (NayifatAPI)'
2025-02-02 19:43:19.365 +03:00 [INF] Request finished HTTP/1.1 POST http://07ca-46-152-255-232.ngrok-free.app/api/notifications/list - 200 null application/json; charset=utf-8 241.9923ms
2025-02-02 19:46:57.127 +03:00 [INF] Request starting HTTP/1.1 POST http://07ca-46-152-255-232.ngrok-free.app/api/notifications/list - application/json; charset=utf-8 47
2025-02-02 19:46:57.152 +03:00 [INF] Executing endpoint 'NayifatAPI.Controllers.NotificationsController.GetNotifications (NayifatAPI)'
2025-02-02 19:46:57.153 +03:00 [INF] Route matched with {action = "GetNotifications", controller = "Notifications"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetNotifications(NayifatAPI.Controllers.GetNotificationsRequest) on controller NayifatAPI.Controllers.NotificationsController (NayifatAPI).
2025-02-02 19:46:57.163 +03:00 [INF] Executed DbCommand (4ms) [Parameters=[@__providedApiKey_0='?' (Size = 255)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [a].[Key], [a].[CreatedAt], [a].[Description], [a].[ExpiresAt], [a].[IsActive], [a].[LastUsedAt]
FROM [ApiKeys] AS [a]
WHERE [a].[Key] = @__providedApiKey_0 AND [a].[IsActive] = CAST(1 AS bit)
2025-02-02 19:46:57.169 +03:00 [INF] Executed DbCommand (2ms) [Parameters=[@__request_NationalId_0='?' (Size = 450)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [u].[national_id], [u].[last_updated], [u].[notifications]
FROM [user_notifications] AS [u]
WHERE [u].[national_id] = @__request_NationalId_0
2025-02-02 19:46:57.174 +03:00 [INF] Executed DbCommand (3ms) [Parameters=[@__Parse_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [n].[Id], [n].[additional_data], [n].[Body], [n].[body_ar], [n].[body_en], [n].[created_at], [n].[expiry_at], [n].[Route], [n].[target_criteria], [n].[Title], [n].[title_ar], [n].[title_en]
FROM [notification_templates] AS [n]
WHERE [n].[Id] = @__Parse_0
2025-02-02 19:46:57.177 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@__Parse_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [n].[Id], [n].[additional_data], [n].[Body], [n].[body_ar], [n].[body_en], [n].[created_at], [n].[expiry_at], [n].[Route], [n].[target_criteria], [n].[Title], [n].[title_ar], [n].[title_en]
FROM [notification_templates] AS [n]
WHERE [n].[Id] = @__Parse_0
2025-02-02 19:46:57.258 +03:00 [INF] Executed DbCommand (78ms) [Parameters=[@p0='?' (Size = 4000), @p1='?' (DbType = DateTime2), @p2='?' (Size = 4000), @p3='?' (Size = 4000), @p4='?' (Size = 4000), @p5='?' (Size = 450), @p6='?' (Size = 4000), @p7='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SET IMPLICIT_TRANSACTIONS OFF;
SET NOCOUNT ON;
INSERT INTO [AuthLogs] ([AuthType], [CreatedAt], [DeviceId], [FailureReason], [IpAddress], [NationalId], [Status], [UserAgent])
OUTPUT INSERTED.[Id]
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7);
2025-02-02 19:46:57.260 +03:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType9`2[[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Object, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-02-02 19:46:57.262 +03:00 [INF] Executed action NayifatAPI.Controllers.NotificationsController.GetNotifications (NayifatAPI) in 105.865ms
2025-02-02 19:46:57.264 +03:00 [INF] Executed endpoint 'NayifatAPI.Controllers.NotificationsController.GetNotifications (NayifatAPI)'
2025-02-02 19:46:57.265 +03:00 [INF] Request finished HTTP/1.1 POST http://07ca-46-152-255-232.ngrok-free.app/api/notifications/list - 200 null application/json; charset=utf-8 137.9568ms
2025-02-02 19:48:48.811 +03:00 [INF] Request starting HTTP/1.1 POST http://07ca-46-152-255-232.ngrok-free.app/api/notifications/list - application/json; charset=utf-8 47
2025-02-02 19:48:48.815 +03:00 [INF] Executing endpoint 'NayifatAPI.Controllers.NotificationsController.GetNotifications (NayifatAPI)'
2025-02-02 19:48:48.816 +03:00 [INF] Route matched with {action = "GetNotifications", controller = "Notifications"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetNotifications(NayifatAPI.Controllers.GetNotificationsRequest) on controller NayifatAPI.Controllers.NotificationsController (NayifatAPI).
2025-02-02 19:48:48.824 +03:00 [INF] Executed DbCommand (5ms) [Parameters=[@__providedApiKey_0='?' (Size = 255)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [a].[Key], [a].[CreatedAt], [a].[Description], [a].[ExpiresAt], [a].[IsActive], [a].[LastUsedAt]
FROM [ApiKeys] AS [a]
WHERE [a].[Key] = @__providedApiKey_0 AND [a].[IsActive] = CAST(1 AS bit)
2025-02-02 19:48:48.828 +03:00 [INF] Executed DbCommand (2ms) [Parameters=[@__request_NationalId_0='?' (Size = 450)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [u].[national_id], [u].[last_updated], [u].[notifications]
FROM [user_notifications] AS [u]
WHERE [u].[national_id] = @__request_NationalId_0
2025-02-02 19:48:48.832 +03:00 [INF] Executed DbCommand (2ms) [Parameters=[@__Parse_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [n].[Id], [n].[additional_data], [n].[Body], [n].[body_ar], [n].[body_en], [n].[created_at], [n].[expiry_at], [n].[Route], [n].[target_criteria], [n].[Title], [n].[title_ar], [n].[title_en]
FROM [notification_templates] AS [n]
WHERE [n].[Id] = @__Parse_0
2025-02-02 19:48:48.835 +03:00 [INF] Executed DbCommand (0ms) [Parameters=[@__Parse_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [n].[Id], [n].[additional_data], [n].[Body], [n].[body_ar], [n].[body_en], [n].[created_at], [n].[expiry_at], [n].[Route], [n].[target_criteria], [n].[Title], [n].[title_ar], [n].[title_en]
FROM [notification_templates] AS [n]
WHERE [n].[Id] = @__Parse_0
2025-02-02 19:48:49.489 +03:00 [INF] Executed DbCommand (650ms) [Parameters=[@p0='?' (Size = 4000), @p1='?' (DbType = DateTime2), @p2='?' (Size = 4000), @p3='?' (Size = 4000), @p4='?' (Size = 4000), @p5='?' (Size = 450), @p6='?' (Size = 4000), @p7='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SET IMPLICIT_TRANSACTIONS OFF;
SET NOCOUNT ON;
INSERT INTO [AuthLogs] ([AuthType], [CreatedAt], [DeviceId], [FailureReason], [IpAddress], [NationalId], [Status], [UserAgent])
OUTPUT INSERTED.[Id]
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7);
2025-02-02 19:48:49.491 +03:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType9`2[[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Object, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-02-02 19:48:49.492 +03:00 [INF] Executed action NayifatAPI.Controllers.NotificationsController.GetNotifications (NayifatAPI) in 674.4146ms
2025-02-02 19:48:49.493 +03:00 [INF] Executed endpoint 'NayifatAPI.Controllers.NotificationsController.GetNotifications (NayifatAPI)'
2025-02-02 19:48:49.495 +03:00 [INF] Request finished HTTP/1.1 POST http://07ca-46-152-255-232.ngrok-free.app/api/notifications/list - 200 null application/json; charset=utf-8 683.5654ms
2025-02-02 19:49:55.145 +03:00 [INF] Request starting HTTP/1.1 POST http://07ca-46-152-255-232.ngrok-free.app/api/notifications/list - application/json; charset=utf-8 47
2025-02-02 19:49:55.148 +03:00 [INF] Executing endpoint 'NayifatAPI.Controllers.NotificationsController.GetNotifications (NayifatAPI)'
2025-02-02 19:49:55.149 +03:00 [INF] Route matched with {action = "GetNotifications", controller = "Notifications"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetNotifications(NayifatAPI.Controllers.GetNotificationsRequest) on controller NayifatAPI.Controllers.NotificationsController (NayifatAPI).
2025-02-02 19:49:55.153 +03:00 [INF] Executed DbCommand (2ms) [Parameters=[@__providedApiKey_0='?' (Size = 255)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [a].[Key], [a].[CreatedAt], [a].[Description], [a].[ExpiresAt], [a].[IsActive], [a].[LastUsedAt]
FROM [ApiKeys] AS [a]
WHERE [a].[Key] = @__providedApiKey_0 AND [a].[IsActive] = CAST(1 AS bit)
2025-02-02 19:49:55.157 +03:00 [INF] Executed DbCommand (2ms) [Parameters=[@__request_NationalId_0='?' (Size = 450)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [u].[national_id], [u].[last_updated], [u].[notifications]
FROM [user_notifications] AS [u]
WHERE [u].[national_id] = @__request_NationalId_0
2025-02-02 19:49:55.163 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@__Parse_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [n].[Id], [n].[additional_data], [n].[Body], [n].[body_ar], [n].[body_en], [n].[created_at], [n].[expiry_at], [n].[Route], [n].[target_criteria], [n].[Title], [n].[title_ar], [n].[title_en]
FROM [notification_templates] AS [n]
WHERE [n].[Id] = @__Parse_0
2025-02-02 19:49:55.166 +03:00 [INF] Executed DbCommand (0ms) [Parameters=[@__Parse_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [n].[Id], [n].[additional_data], [n].[Body], [n].[body_ar], [n].[body_en], [n].[created_at], [n].[expiry_at], [n].[Route], [n].[target_criteria], [n].[Title], [n].[title_ar], [n].[title_en]
FROM [notification_templates] AS [n]
WHERE [n].[Id] = @__Parse_0
2025-02-02 19:49:55.244 +03:00 [INF] Executed DbCommand (75ms) [Parameters=[@p0='?' (Size = 4000), @p1='?' (DbType = DateTime2), @p2='?' (Size = 4000), @p3='?' (Size = 4000), @p4='?' (Size = 4000), @p5='?' (Size = 450), @p6='?' (Size = 4000), @p7='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SET IMPLICIT_TRANSACTIONS OFF;
SET NOCOUNT ON;
INSERT INTO [AuthLogs] ([AuthType], [CreatedAt], [DeviceId], [FailureReason], [IpAddress], [NationalId], [Status], [UserAgent])
OUTPUT INSERTED.[Id]
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7);
2025-02-02 19:49:55.250 +03:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType9`2[[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Object, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-02-02 19:49:55.252 +03:00 [INF] Executed action NayifatAPI.Controllers.NotificationsController.GetNotifications (NayifatAPI) in 102.3648ms
2025-02-02 19:49:55.253 +03:00 [INF] Executed endpoint 'NayifatAPI.Controllers.NotificationsController.GetNotifications (NayifatAPI)'
2025-02-02 19:49:55.255 +03:00 [INF] Request finished HTTP/1.1 POST http://07ca-46-152-255-232.ngrok-free.app/api/notifications/list - 200 null application/json; charset=utf-8 110.3304ms
2025-02-02 19:51:39.293 +03:00 [INF] Request starting HTTP/1.1 POST http://07ca-46-152-255-232.ngrok-free.app/api/notifications/list - application/json; charset=utf-8 47
2025-02-02 19:51:39.475 +03:00 [INF] Executing endpoint 'NayifatAPI.Controllers.NotificationsController.GetNotifications (NayifatAPI)'
2025-02-02 19:51:39.477 +03:00 [INF] Route matched with {action = "GetNotifications", controller = "Notifications"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetNotifications(NayifatAPI.Controllers.GetNotificationsRequest) on controller NayifatAPI.Controllers.NotificationsController (NayifatAPI).
2025-02-02 19:51:39.500 +03:00 [INF] Executed DbCommand (19ms) [Parameters=[@__providedApiKey_0='?' (Size = 255)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [a].[Key], [a].[CreatedAt], [a].[Description], [a].[ExpiresAt], [a].[IsActive], [a].[LastUsedAt]
FROM [ApiKeys] AS [a]
WHERE [a].[Key] = @__providedApiKey_0 AND [a].[IsActive] = CAST(1 AS bit)
2025-02-02 19:51:39.787 +03:00 [INF] Executed DbCommand (4ms) [Parameters=[@__request_NationalId_0='?' (Size = 450)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [u].[national_id], [u].[last_updated], [u].[notifications]
FROM [user_notifications] AS [u]
WHERE [u].[national_id] = @__request_NationalId_0
2025-02-02 19:51:39.802 +03:00 [INF] Executed DbCommand (4ms) [Parameters=[@__Parse_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [n].[Id], [n].[additional_data], [n].[Body], [n].[body_ar], [n].[body_en], [n].[created_at], [n].[expiry_at], [n].[Route], [n].[target_criteria], [n].[Title], [n].[title_ar], [n].[title_en]
FROM [notification_templates] AS [n]
WHERE [n].[Id] = @__Parse_0
2025-02-02 19:51:39.868 +03:00 [INF] Executed DbCommand (61ms) [Parameters=[@__Parse_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [n].[Id], [n].[additional_data], [n].[Body], [n].[body_ar], [n].[body_en], [n].[created_at], [n].[expiry_at], [n].[Route], [n].[target_criteria], [n].[Title], [n].[title_ar], [n].[title_en]
FROM [notification_templates] AS [n]
WHERE [n].[Id] = @__Parse_0
2025-02-02 19:51:40.046 +03:00 [INF] Executed DbCommand (77ms) [Parameters=[@p0='?' (Size = 4000), @p1='?' (DbType = DateTime2), @p2='?' (Size = 4000), @p3='?' (Size = 4000), @p4='?' (Size = 4000), @p5='?' (Size = 450), @p6='?' (Size = 4000), @p7='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SET IMPLICIT_TRANSACTIONS OFF;
SET NOCOUNT ON;
INSERT INTO [AuthLogs] ([AuthType], [CreatedAt], [DeviceId], [FailureReason], [IpAddress], [NationalId], [Status], [UserAgent])
OUTPUT INSERTED.[Id]
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7);
2025-02-02 19:51:40.049 +03:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType9`2[[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Object, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-02-02 19:51:40.050 +03:00 [INF] Executed action NayifatAPI.Controllers.NotificationsController.GetNotifications (NayifatAPI) in 570.9861ms
2025-02-02 19:51:40.051 +03:00 [INF] Executed endpoint 'NayifatAPI.Controllers.NotificationsController.GetNotifications (NayifatAPI)'
2025-02-02 19:51:40.053 +03:00 [INF] Request finished HTTP/1.1 POST http://07ca-46-152-255-232.ngrok-free.app/api/notifications/list - 200 null application/json; charset=utf-8 759.9504ms
2025-02-02 19:52:13.854 +03:00 [INF] Request starting HTTP/1.1 POST http://07ca-46-152-255-232.ngrok-free.app/api/notifications/list - application/json; charset=utf-8 47
2025-02-02 19:52:13.858 +03:00 [INF] Executing endpoint 'NayifatAPI.Controllers.NotificationsController.GetNotifications (NayifatAPI)'
2025-02-02 19:52:13.859 +03:00 [INF] Route matched with {action = "GetNotifications", controller = "Notifications"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetNotifications(NayifatAPI.Controllers.GetNotificationsRequest) on controller NayifatAPI.Controllers.NotificationsController (NayifatAPI).
2025-02-02 19:52:13.862 +03:00 [INF] Executed DbCommand (0ms) [Parameters=[@__providedApiKey_0='?' (Size = 255)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [a].[Key], [a].[CreatedAt], [a].[Description], [a].[ExpiresAt], [a].[IsActive], [a].[LastUsedAt]
FROM [ApiKeys] AS [a]
WHERE [a].[Key] = @__providedApiKey_0 AND [a].[IsActive] = CAST(1 AS bit)
2025-02-02 19:52:13.864 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@__request_NationalId_0='?' (Size = 450)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [u].[national_id], [u].[last_updated], [u].[notifications]
FROM [user_notifications] AS [u]
WHERE [u].[national_id] = @__request_NationalId_0
2025-02-02 19:52:13.868 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@__Parse_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [n].[Id], [n].[additional_data], [n].[Body], [n].[body_ar], [n].[body_en], [n].[created_at], [n].[expiry_at], [n].[Route], [n].[target_criteria], [n].[Title], [n].[title_ar], [n].[title_en]
FROM [notification_templates] AS [n]
WHERE [n].[Id] = @__Parse_0
2025-02-02 19:52:13.870 +03:00 [INF] Executed DbCommand (0ms) [Parameters=[@__Parse_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [n].[Id], [n].[additional_data], [n].[Body], [n].[body_ar], [n].[body_en], [n].[created_at], [n].[expiry_at], [n].[Route], [n].[target_criteria], [n].[Title], [n].[title_ar], [n].[title_en]
FROM [notification_templates] AS [n]
WHERE [n].[Id] = @__Parse_0
2025-02-02 19:52:13.946 +03:00 [INF] Executed DbCommand (73ms) [Parameters=[@p0='?' (Size = 4000), @p1='?' (DbType = DateTime2), @p2='?' (Size = 4000), @p3='?' (Size = 4000), @p4='?' (Size = 4000), @p5='?' (Size = 450), @p6='?' (Size = 4000), @p7='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SET IMPLICIT_TRANSACTIONS OFF;
SET NOCOUNT ON;
INSERT INTO [AuthLogs] ([AuthType], [CreatedAt], [DeviceId], [FailureReason], [IpAddress], [NationalId], [Status], [UserAgent])
OUTPUT INSERTED.[Id]
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7);
2025-02-02 19:52:13.949 +03:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType9`2[[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Object, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-02-02 19:52:13.950 +03:00 [INF] Executed action NayifatAPI.Controllers.NotificationsController.GetNotifications (NayifatAPI) in 90.0692ms
2025-02-02 19:52:13.951 +03:00 [INF] Executed endpoint 'NayifatAPI.Controllers.NotificationsController.GetNotifications (NayifatAPI)'
2025-02-02 19:52:13.953 +03:00 [INF] Request finished HTTP/1.1 POST http://07ca-46-152-255-232.ngrok-free.app/api/notifications/list - 200 null application/json; charset=utf-8 98.387ms
2025-02-02 19:54:44.123 +03:00 [INF] Request starting HTTP/1.1 POST http://07ca-46-152-255-232.ngrok-free.app/api/notifications/list - application/json; charset=utf-8 47
2025-02-02 19:54:44.127 +03:00 [INF] Executing endpoint 'NayifatAPI.Controllers.NotificationsController.GetNotifications (NayifatAPI)'
2025-02-02 19:54:44.129 +03:00 [INF] Route matched with {action = "GetNotifications", controller = "Notifications"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetNotifications(NayifatAPI.Controllers.GetNotificationsRequest) on controller NayifatAPI.Controllers.NotificationsController (NayifatAPI).
2025-02-02 19:54:44.140 +03:00 [INF] Executed DbCommand (4ms) [Parameters=[@__providedApiKey_0='?' (Size = 255)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [a].[Key], [a].[CreatedAt], [a].[Description], [a].[ExpiresAt], [a].[IsActive], [a].[LastUsedAt]
FROM [ApiKeys] AS [a]
WHERE [a].[Key] = @__providedApiKey_0 AND [a].[IsActive] = CAST(1 AS bit)
2025-02-02 19:54:44.147 +03:00 [INF] Executed DbCommand (4ms) [Parameters=[@__request_NationalId_0='?' (Size = 450)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [u].[national_id], [u].[last_updated], [u].[notifications]
FROM [user_notifications] AS [u]
WHERE [u].[national_id] = @__request_NationalId_0
2025-02-02 19:54:44.153 +03:00 [INF] Executed DbCommand (2ms) [Parameters=[@__Parse_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [n].[Id], [n].[additional_data], [n].[Body], [n].[body_ar], [n].[body_en], [n].[created_at], [n].[expiry_at], [n].[Route], [n].[target_criteria], [n].[Title], [n].[title_ar], [n].[title_en]
FROM [notification_templates] AS [n]
WHERE [n].[Id] = @__Parse_0
2025-02-02 19:54:44.156 +03:00 [INF] Executed DbCommand (0ms) [Parameters=[@__Parse_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [n].[Id], [n].[additional_data], [n].[Body], [n].[body_ar], [n].[body_en], [n].[created_at], [n].[expiry_at], [n].[Route], [n].[target_criteria], [n].[Title], [n].[title_ar], [n].[title_en]
FROM [notification_templates] AS [n]
WHERE [n].[Id] = @__Parse_0
2025-02-02 19:54:44.166 +03:00 [INF] Executed DbCommand (7ms) [Parameters=[@p0='?' (Size = 4000), @p1='?' (DbType = DateTime2), @p2='?' (Size = 4000), @p3='?' (Size = 4000), @p4='?' (Size = 4000), @p5='?' (Size = 450), @p6='?' (Size = 4000), @p7='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SET IMPLICIT_TRANSACTIONS OFF;
SET NOCOUNT ON;
INSERT INTO [AuthLogs] ([AuthType], [CreatedAt], [DeviceId], [FailureReason], [IpAddress], [NationalId], [Status], [UserAgent])
OUTPUT INSERTED.[Id]
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7);
2025-02-02 19:54:44.168 +03:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType9`2[[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Object, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-02-02 19:54:44.170 +03:00 [INF] Executed action NayifatAPI.Controllers.NotificationsController.GetNotifications (NayifatAPI) in 35.5125ms
2025-02-02 19:54:44.171 +03:00 [INF] Executed endpoint 'NayifatAPI.Controllers.NotificationsController.GetNotifications (NayifatAPI)'
2025-02-02 19:54:44.172 +03:00 [INF] Request finished HTTP/1.1 POST http://07ca-46-152-255-232.ngrok-free.app/api/notifications/list - 200 null application/json; charset=utf-8 48.1036ms
2025-02-02 19:55:02.782 +03:00 [INF] Request starting HTTP/1.1 POST http://07ca-46-152-255-232.ngrok-free.app/api/auth/signin - application/json; charset=utf-8 78
2025-02-02 19:55:02.788 +03:00 [INF] Executing endpoint 'NayifatAPI.Controllers.AuthController.SignIn (NayifatAPI)'
2025-02-02 19:55:02.789 +03:00 [INF] Route matched with {action = "SignIn", controller = "Auth"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] SignIn(NayifatAPI.Controllers.SignInRequest) on controller NayifatAPI.Controllers.AuthController (NayifatAPI).
2025-02-02 19:55:02.794 +03:00 [INF] Executed DbCommand (2ms) [Parameters=[@__providedApiKey_0='?' (Size = 255)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [a].[Key], [a].[CreatedAt], [a].[Description], [a].[ExpiresAt], [a].[IsActive], [a].[LastUsedAt]
FROM [ApiKeys] AS [a]
WHERE [a].[Key] = @__providedApiKey_0 AND [a].[IsActive] = CAST(1 AS bit)
2025-02-02 19:55:03.086 +03:00 [INF] Executed DbCommand (3ms) [Parameters=[@__request_NationalId_0='?' (Size = 450)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [c].[NationalId], [c].[AddNo], [c].[BuildingNo], [c].[City], [c].[Consent], [c].[ConsentDate], [c].[DateOfBirth], [c].[Dependents], [c].[District], [c].[Email], [c].[Employer], [c].[FamilyNameAr], [c].[FamilyNameEn], [c].[FirstNameAr], [c].[FirstNameEn], [c].[Iban], [c].[IdExpiryDate], [c].[Los], [c].[Mpin], [c].[MpinEnabled], [c].[NafathStatus], [c].[NafathTimestamp], [c].[Password], [c].[Phone], [c].[RegistrationDate], [c].[SalaryCustomer], [c].[SalaryDakhli], [c].[SecondNameAr], [c].[SecondNameEn], [c].[Sector], [c].[Street], [c].[ThirdNameAr], [c].[ThirdNameEn], [c].[Zipcode]
FROM [Customers] AS [c]
WHERE [c].[NationalId] = @__request_NationalId_0
2025-02-02 19:55:03.111 +03:00 [INF] Starting password verification for NationalId: 1064448614
2025-02-02 19:55:03.677 +03:00 [INF] Password verification result for NationalId 1064448614: Success
2025-02-02 19:55:03.856 +03:00 [INF] Executed DbCommand (124ms) [Parameters=[@p0='?' (Size = 4000), @p1='?' (DbType = DateTime2), @p2='?' (Size = 4000), @p3='?' (Size = 4000), @p4='?' (Size = 4000), @p5='?' (Size = 450), @p6='?' (Size = 4000), @p7='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SET IMPLICIT_TRANSACTIONS OFF;
SET NOCOUNT ON;
INSERT INTO [AuthLogs] ([AuthType], [CreatedAt], [DeviceId], [FailureReason], [IpAddress], [NationalId], [Status], [UserAgent])
OUTPUT INSERTED.[Id]
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7);
2025-02-02 19:55:04.022 +03:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType9`2[[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Object, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-02-02 19:55:04.023 +03:00 [INF] Executed action NayifatAPI.Controllers.AuthController.SignIn (NayifatAPI) in 1232.4256ms
2025-02-02 19:55:04.024 +03:00 [INF] Executed endpoint 'NayifatAPI.Controllers.AuthController.SignIn (NayifatAPI)'
2025-02-02 19:55:04.026 +03:00 [INF] Request finished HTTP/1.1 POST http://07ca-46-152-255-232.ngrok-free.app/api/auth/signin - 200 null application/json; charset=utf-8 1243.5018ms
2025-02-02 19:55:04.973 +03:00 [INF] Request starting HTTP/1.1 POST http://07ca-46-152-255-232.ngrok-free.app/api/proxy/forward?url=https://icreditdept.com/api/testasp/test_local_generate_otp.php - application/json; charset=utf-8 84
2025-02-02 19:55:04.977 +03:00 [INF] Executing endpoint 'NayifatAPI.Controllers.ProxyController.ForwardRequest (NayifatAPI)'
2025-02-02 19:55:04.980 +03:00 [INF] Route matched with {action = "ForwardRequest", controller = "Proxy"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] ForwardRequest() on controller NayifatAPI.Controllers.ProxyController (NayifatAPI).
2025-02-02 19:55:04.983 +03:00 [INF] Start processing HTTP request POST https://icreditdept.com/api/testasp/test_local_generate_otp.php
2025-02-02 19:55:04.985 +03:00 [INF] Sending HTTP request POST https://icreditdept.com/api/testasp/test_local_generate_otp.php
2025-02-02 19:55:06.258 +03:00 [INF] Received HTTP response headers after 1271.9555ms - 200
2025-02-02 19:55:06.262 +03:00 [INF] End processing HTTP request after 1279.1542ms - 200
2025-02-02 19:55:06.267 +03:00 [INF] Raw response length: 200
2025-02-02 19:55:06.268 +03:00 [INF] Response content: {"success":true,"errors":[],"result":{"nationalId":"1064448614","otp":296682,"expiryDate":"2025-02-02 20:00:06","successMsg":"Success","errCode":0,"errMsg":null},"type":"N","message":null,"code":null}
2025-02-02 19:55:06.270 +03:00 [INF] Executing ContentResult with HTTP Response ContentType of application/json
2025-02-02 19:55:06.272 +03:00 [INF] Executed action NayifatAPI.Controllers.ProxyController.ForwardRequest (NayifatAPI) in 1289.7021ms
2025-02-02 19:55:06.273 +03:00 [INF] Executed endpoint 'NayifatAPI.Controllers.ProxyController.ForwardRequest (NayifatAPI)'
2025-02-02 19:55:06.274 +03:00 [INF] Request finished HTTP/1.1 POST http://07ca-46-152-255-232.ngrok-free.app/api/proxy/forward?url=https://icreditdept.com/api/testasp/test_local_generate_otp.php - 200 200 application/json 1301.2616ms
2025-02-02 19:55:24.140 +03:00 [INF] Request starting HTTP/1.1 POST http://07ca-46-152-255-232.ngrok-free.app/api/proxy/forward?url=https://icreditdept.com/api/testasp/test_local_verify_otp.php - application/json; charset=utf-8 53
2025-02-02 19:55:24.143 +03:00 [INF] Executing endpoint 'NayifatAPI.Controllers.ProxyController.ForwardRequest (NayifatAPI)'
2025-02-02 19:55:24.144 +03:00 [INF] Route matched with {action = "ForwardRequest", controller = "Proxy"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] ForwardRequest() on controller NayifatAPI.Controllers.ProxyController (NayifatAPI).
2025-02-02 19:55:24.146 +03:00 [INF] Start processing HTTP request POST https://icreditdept.com/api/testasp/test_local_verify_otp.php
2025-02-02 19:55:24.146 +03:00 [INF] Sending HTTP request POST https://icreditdept.com/api/testasp/test_local_verify_otp.php
2025-02-02 19:55:24.746 +03:00 [INF] Received HTTP response headers after 598.8302ms - 200
2025-02-02 19:55:24.748 +03:00 [INF] End processing HTTP request after 602.4073ms - 200
2025-02-02 19:55:24.751 +03:00 [INF] Raw response length: 202
2025-02-02 19:55:24.753 +03:00 [INF] Response content: {"success":true,"errors":[],"result":{"nationalId":"1064448614","otp":"296682","verifiedFlag":true,"successMsg":"Verified successfully.","errCode":0,"errMsg":null},"type":"N","message":null,"code":null}
2025-02-02 19:55:24.756 +03:00 [INF] Executing ContentResult with HTTP Response ContentType of application/json
2025-02-02 19:55:24.757 +03:00 [INF] Executed action NayifatAPI.Controllers.ProxyController.ForwardRequest (NayifatAPI) in 611.731ms
2025-02-02 19:55:24.758 +03:00 [INF] Executed endpoint 'NayifatAPI.Controllers.ProxyController.ForwardRequest (NayifatAPI)'
2025-02-02 19:55:24.760 +03:00 [INF] Request finished HTTP/1.1 POST http://07ca-46-152-255-232.ngrok-free.app/api/proxy/forward?url=https://icreditdept.com/api/testasp/test_local_verify_otp.php - 200 202 application/json 619.9391ms
2025-02-02 19:55:25.738 +03:00 [INF] Request starting HTTP/1.1 POST http://07ca-46-152-255-232.ngrok-free.app/api/auth/signin - application/json; charset=utf-8 49
2025-02-02 19:55:25.745 +03:00 [INF] Executing endpoint 'NayifatAPI.Controllers.AuthController.SignIn (NayifatAPI)'
2025-02-02 19:55:25.746 +03:00 [INF] Route matched with {action = "SignIn", controller = "Auth"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] SignIn(NayifatAPI.Controllers.SignInRequest) on controller NayifatAPI.Controllers.AuthController (NayifatAPI).
2025-02-02 19:55:25.749 +03:00 [INF] Executing BadRequestObjectResult, writing value of type 'Microsoft.AspNetCore.Mvc.ValidationProblemDetails'.
2025-02-02 19:55:25.750 +03:00 [INF] Executed action NayifatAPI.Controllers.AuthController.SignIn (NayifatAPI) in 2.5983ms
2025-02-02 19:55:25.753 +03:00 [INF] Executed endpoint 'NayifatAPI.Controllers.AuthController.SignIn (NayifatAPI)'
2025-02-02 19:55:25.754 +03:00 [INF] Request finished HTTP/1.1 POST http://07ca-46-152-255-232.ngrok-free.app/api/auth/signin - 400 null application/problem+json; charset=utf-8 16.6288ms
2025-02-02 19:56:50.395 +03:00 [INF] Request starting HTTP/1.1 POST http://07ca-46-152-255-232.ngrok-free.app/api/auth/signin - application/json; charset=utf-8 78
2025-02-02 19:56:50.471 +03:00 [INF] Executing endpoint 'NayifatAPI.Controllers.AuthController.SignIn (NayifatAPI)'
2025-02-02 19:56:50.472 +03:00 [INF] Route matched with {action = "SignIn", controller = "Auth"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] SignIn(NayifatAPI.Controllers.SignInRequest) on controller NayifatAPI.Controllers.AuthController (NayifatAPI).
2025-02-02 19:56:50.480 +03:00 [INF] Executed DbCommand (5ms) [Parameters=[@__providedApiKey_0='?' (Size = 255)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [a].[Key], [a].[CreatedAt], [a].[Description], [a].[ExpiresAt], [a].[IsActive], [a].[LastUsedAt]
FROM [ApiKeys] AS [a]
WHERE [a].[Key] = @__providedApiKey_0 AND [a].[IsActive] = CAST(1 AS bit)
2025-02-02 19:56:50.795 +03:00 [INF] Executed DbCommand (5ms) [Parameters=[@__request_NationalId_0='?' (Size = 450)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [c].[NationalId], [c].[AddNo], [c].[BuildingNo], [c].[City], [c].[Consent], [c].[ConsentDate], [c].[DateOfBirth], [c].[Dependents], [c].[District], [c].[Email], [c].[Employer], [c].[FamilyNameAr], [c].[FamilyNameEn], [c].[FirstNameAr], [c].[FirstNameEn], [c].[Iban], [c].[IdExpiryDate], [c].[Los], [c].[Mpin], [c].[MpinEnabled], [c].[NafathStatus], [c].[NafathTimestamp], [c].[Password], [c].[Phone], [c].[RegistrationDate], [c].[SalaryCustomer], [c].[SalaryDakhli], [c].[SecondNameAr], [c].[SecondNameEn], [c].[Sector], [c].[Street], [c].[ThirdNameAr], [c].[ThirdNameEn], [c].[Zipcode]
FROM [Customers] AS [c]
WHERE [c].[NationalId] = @__request_NationalId_0
2025-02-02 19:56:50.800 +03:00 [INF] Starting password verification for NationalId: 1064448614
2025-02-02 19:56:51.447 +03:00 [INF] Password verification result for NationalId 1064448614: Success
2025-02-02 19:56:51.612 +03:00 [INF] Executed DbCommand (76ms) [Parameters=[@p0='?' (Size = 4000), @p1='?' (DbType = DateTime2), @p2='?' (Size = 4000), @p3='?' (Size = 4000), @p4='?' (Size = 4000), @p5='?' (Size = 450), @p6='?' (Size = 4000), @p7='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SET IMPLICIT_TRANSACTIONS OFF;
SET NOCOUNT ON;
INSERT INTO [AuthLogs] ([AuthType], [CreatedAt], [DeviceId], [FailureReason], [IpAddress], [NationalId], [Status], [UserAgent])
OUTPUT INSERTED.[Id]
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7);
2025-02-02 19:56:51.615 +03:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType9`2[[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Object, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-02-02 19:56:51.616 +03:00 [INF] Executed action NayifatAPI.Controllers.AuthController.SignIn (NayifatAPI) in 1142.0778ms
2025-02-02 19:56:51.617 +03:00 [INF] Executed endpoint 'NayifatAPI.Controllers.AuthController.SignIn (NayifatAPI)'
2025-02-02 19:56:51.619 +03:00 [INF] Request finished HTTP/1.1 POST http://07ca-46-152-255-232.ngrok-free.app/api/auth/signin - 200 null application/json; charset=utf-8 1223.6148ms
2025-02-02 19:56:52.426 +03:00 [INF] Request starting HTTP/1.1 POST http://07ca-46-152-255-232.ngrok-free.app/api/proxy/forward?url=https://icreditdept.com/api/testasp/test_local_generate_otp.php - application/json; charset=utf-8 84
2025-02-02 19:56:52.431 +03:00 [INF] Executing endpoint 'NayifatAPI.Controllers.ProxyController.ForwardRequest (NayifatAPI)'
2025-02-02 19:56:52.432 +03:00 [INF] Route matched with {action = "ForwardRequest", controller = "Proxy"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] ForwardRequest() on controller NayifatAPI.Controllers.ProxyController (NayifatAPI).
2025-02-02 19:56:52.434 +03:00 [INF] Start processing HTTP request POST https://icreditdept.com/api/testasp/test_local_generate_otp.php
2025-02-02 19:56:52.434 +03:00 [INF] Sending HTTP request POST https://icreditdept.com/api/testasp/test_local_generate_otp.php
2025-02-02 19:56:53.107 +03:00 [INF] Received HTTP response headers after 671.7192ms - 200
2025-02-02 19:56:53.111 +03:00 [INF] End processing HTTP request after 677.4968ms - 200
2025-02-02 19:56:53.112 +03:00 [INF] Raw response length: 200
2025-02-02 19:56:53.112 +03:00 [INF] Response content: {"success":true,"errors":[],"result":{"nationalId":"1064448614","otp":128145,"expiryDate":"2025-02-02 20:01:53","successMsg":"Success","errCode":0,"errMsg":null},"type":"N","message":null,"code":null}
2025-02-02 19:56:53.113 +03:00 [INF] Executing ContentResult with HTTP Response ContentType of application/json
2025-02-02 19:56:53.114 +03:00 [INF] Executed action NayifatAPI.Controllers.ProxyController.ForwardRequest (NayifatAPI) in 680.8577ms
2025-02-02 19:56:53.115 +03:00 [INF] Executed endpoint 'NayifatAPI.Controllers.ProxyController.ForwardRequest (NayifatAPI)'
2025-02-02 19:56:53.116 +03:00 [INF] Request finished HTTP/1.1 POST http://07ca-46-152-255-232.ngrok-free.app/api/proxy/forward?url=https://icreditdept.com/api/testasp/test_local_generate_otp.php - 200 200 application/json 690.0502ms
2025-02-02 19:57:09.825 +03:00 [INF] Request starting HTTP/1.1 POST http://07ca-46-152-255-232.ngrok-free.app/api/auth/signin - application/json; charset=utf-8 78
2025-02-02 19:57:09.829 +03:00 [INF] Executing endpoint 'NayifatAPI.Controllers.AuthController.SignIn (NayifatAPI)'
2025-02-02 19:57:09.830 +03:00 [INF] Route matched with {action = "SignIn", controller = "Auth"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] SignIn(NayifatAPI.Controllers.SignInRequest) on controller NayifatAPI.Controllers.AuthController (NayifatAPI).
2025-02-02 19:57:09.836 +03:00 [INF] Executed DbCommand (2ms) [Parameters=[@__providedApiKey_0='?' (Size = 255)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [a].[Key], [a].[CreatedAt], [a].[Description], [a].[ExpiresAt], [a].[IsActive], [a].[LastUsedAt]
FROM [ApiKeys] AS [a]
WHERE [a].[Key] = @__providedApiKey_0 AND [a].[IsActive] = CAST(1 AS bit)
2025-02-02 19:57:09.842 +03:00 [INF] Executed DbCommand (3ms) [Parameters=[@__request_NationalId_0='?' (Size = 450)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [c].[NationalId], [c].[AddNo], [c].[BuildingNo], [c].[City], [c].[Consent], [c].[ConsentDate], [c].[DateOfBirth], [c].[Dependents], [c].[District], [c].[Email], [c].[Employer], [c].[FamilyNameAr], [c].[FamilyNameEn], [c].[FirstNameAr], [c].[FirstNameEn], [c].[Iban], [c].[IdExpiryDate], [c].[Los], [c].[Mpin], [c].[MpinEnabled], [c].[NafathStatus], [c].[NafathTimestamp], [c].[Password], [c].[Phone], [c].[RegistrationDate], [c].[SalaryCustomer], [c].[SalaryDakhli], [c].[SecondNameAr], [c].[SecondNameEn], [c].[Sector], [c].[Street], [c].[ThirdNameAr], [c].[ThirdNameEn], [c].[Zipcode]
FROM [Customers] AS [c]
WHERE [c].[NationalId] = @__request_NationalId_0
2025-02-02 19:57:09.845 +03:00 [INF] Starting password verification for NationalId: 1064448614
2025-02-02 19:57:10.015 +03:00 [INF] Password verification result for NationalId 1064448614: Success
2025-02-02 19:57:10.095 +03:00 [INF] Executed DbCommand (76ms) [Parameters=[@p0='?' (Size = 4000), @p1='?' (DbType = DateTime2), @p2='?' (Size = 4000), @p3='?' (Size = 4000), @p4='?' (Size = 4000), @p5='?' (Size = 450), @p6='?' (Size = 4000), @p7='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SET IMPLICIT_TRANSACTIONS OFF;
SET NOCOUNT ON;
INSERT INTO [AuthLogs] ([AuthType], [CreatedAt], [DeviceId], [FailureReason], [IpAddress], [NationalId], [Status], [UserAgent])
OUTPUT INSERTED.[Id]
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7);
2025-02-02 19:57:10.100 +03:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType9`2[[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Object, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-02-02 19:57:10.102 +03:00 [INF] Executed action NayifatAPI.Controllers.AuthController.SignIn (NayifatAPI) in 269.1424ms
2025-02-02 19:57:10.103 +03:00 [INF] Executed endpoint 'NayifatAPI.Controllers.AuthController.SignIn (NayifatAPI)'
2025-02-02 19:57:10.104 +03:00 [INF] Request finished HTTP/1.1 POST http://07ca-46-152-255-232.ngrok-free.app/api/auth/signin - 200 null application/json; charset=utf-8 279.511ms
2025-02-02 19:57:12.876 +03:00 [INF] Request starting HTTP/1.1 POST http://07ca-46-152-255-232.ngrok-free.app/api/proxy/forward?url=https://icreditdept.com/api/testasp/test_local_generate_otp.php - application/json; charset=utf-8 84
2025-02-02 19:57:12.882 +03:00 [INF] Executing endpoint 'NayifatAPI.Controllers.ProxyController.ForwardRequest (NayifatAPI)'
2025-02-02 19:57:12.884 +03:00 [INF] Route matched with {action = "ForwardRequest", controller = "Proxy"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] ForwardRequest() on controller NayifatAPI.Controllers.ProxyController (NayifatAPI).
2025-02-02 19:57:12.888 +03:00 [INF] Start processing HTTP request POST https://icreditdept.com/api/testasp/test_local_generate_otp.php
2025-02-02 19:57:12.890 +03:00 [INF] Sending HTTP request POST https://icreditdept.com/api/testasp/test_local_generate_otp.php
2025-02-02 19:57:15.093 +03:00 [INF] Received HTTP response headers after 2202.8615ms - 200
2025-02-02 19:57:15.096 +03:00 [INF] End processing HTTP request after 2208.028ms - 200
2025-02-02 19:57:15.098 +03:00 [INF] Raw response length: 200
2025-02-02 19:57:15.100 +03:00 [INF] Response content: {"success":true,"errors":[],"result":{"nationalId":"1064448614","otp":138707,"expiryDate":"2025-02-02 20:02:15","successMsg":"Success","errCode":0,"errMsg":null},"type":"N","message":null,"code":null}
2025-02-02 19:57:15.102 +03:00 [INF] Executing ContentResult with HTTP Response ContentType of application/json
2025-02-02 19:57:15.104 +03:00 [INF] Executed action NayifatAPI.Controllers.ProxyController.ForwardRequest (NayifatAPI) in 2216.3699ms
2025-02-02 19:57:15.106 +03:00 [INF] Executed endpoint 'NayifatAPI.Controllers.ProxyController.ForwardRequest (NayifatAPI)'
2025-02-02 19:57:15.109 +03:00 [INF] Request finished HTTP/1.1 POST http://07ca-46-152-255-232.ngrok-free.app/api/proxy/forward?url=https://icreditdept.com/api/testasp/test_local_generate_otp.php - 200 200 application/json 2233.3916ms
2025-02-02 19:57:32.249 +03:00 [INF] Request starting HTTP/1.1 POST http://07ca-46-152-255-232.ngrok-free.app/api/proxy/forward?url=https://icreditdept.com/api/testasp/test_local_verify_otp.php - application/json; charset=utf-8 53
2025-02-02 19:57:32.251 +03:00 [INF] Executing endpoint 'NayifatAPI.Controllers.ProxyController.ForwardRequest (NayifatAPI)'
2025-02-02 19:57:32.252 +03:00 [INF] Route matched with {action = "ForwardRequest", controller = "Proxy"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] ForwardRequest() on controller NayifatAPI.Controllers.ProxyController (NayifatAPI).
2025-02-02 19:57:32.255 +03:00 [INF] Start processing HTTP request POST https://icreditdept.com/api/testasp/test_local_verify_otp.php
2025-02-02 19:57:32.256 +03:00 [INF] Sending HTTP request POST https://icreditdept.com/api/testasp/test_local_verify_otp.php
2025-02-02 19:57:32.885 +03:00 [INF] Received HTTP response headers after 628.4204ms - 200
2025-02-02 19:57:32.891 +03:00 [INF] End processing HTTP request after 636.034ms - 200
2025-02-02 19:57:32.892 +03:00 [INF] Raw response length: 202
2025-02-02 19:57:32.893 +03:00 [INF] Response content: {"success":true,"errors":[],"result":{"nationalId":"1064448614","otp":"138707","verifiedFlag":true,"successMsg":"Verified successfully.","errCode":0,"errMsg":null},"type":"N","message":null,"code":null}
2025-02-02 19:57:32.894 +03:00 [INF] Executing ContentResult with HTTP Response ContentType of application/json
2025-02-02 19:57:32.895 +03:00 [INF] Executed action NayifatAPI.Controllers.ProxyController.ForwardRequest (NayifatAPI) in 641.1397ms
2025-02-02 19:57:32.896 +03:00 [INF] Executed endpoint 'NayifatAPI.Controllers.ProxyController.ForwardRequest (NayifatAPI)'
2025-02-02 19:57:32.899 +03:00 [INF] Request finished HTTP/1.1 POST http://07ca-46-152-255-232.ngrok-free.app/api/proxy/forward?url=https://icreditdept.com/api/testasp/test_local_verify_otp.php - 200 202 application/json 650.3891ms
2025-02-02 19:59:45.322 +03:00 [INF] Request starting HTTP/1.1 POST http://07ca-46-152-255-232.ngrok-free.app/api/notifications/list - application/json; charset=utf-8 47
2025-02-02 19:59:45.470 +03:00 [INF] Executing endpoint 'NayifatAPI.Controllers.NotificationsController.GetNotifications (NayifatAPI)'
2025-02-02 19:59:45.472 +03:00 [INF] Route matched with {action = "GetNotifications", controller = "Notifications"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetNotifications(NayifatAPI.Controllers.GetNotificationsRequest) on controller NayifatAPI.Controllers.NotificationsController (NayifatAPI).
2025-02-02 19:59:45.477 +03:00 [INF] Executed DbCommand (2ms) [Parameters=[@__providedApiKey_0='?' (Size = 255)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [a].[Key], [a].[CreatedAt], [a].[Description], [a].[ExpiresAt], [a].[IsActive], [a].[LastUsedAt]
FROM [ApiKeys] AS [a]
WHERE [a].[Key] = @__providedApiKey_0 AND [a].[IsActive] = CAST(1 AS bit)
2025-02-02 19:59:45.482 +03:00 [INF] Executed DbCommand (2ms) [Parameters=[@__request_NationalId_0='?' (Size = 450)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [u].[national_id], [u].[last_updated], [u].[notifications]
FROM [user_notifications] AS [u]
WHERE [u].[national_id] = @__request_NationalId_0
2025-02-02 19:59:45.486 +03:00 [INF] Executed DbCommand (2ms) [Parameters=[@__Parse_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [n].[Id], [n].[additional_data], [n].[Body], [n].[body_ar], [n].[body_en], [n].[created_at], [n].[expiry_at], [n].[Route], [n].[target_criteria], [n].[Title], [n].[title_ar], [n].[title_en]
FROM [notification_templates] AS [n]
WHERE [n].[Id] = @__Parse_0
2025-02-02 19:59:45.703 +03:00 [INF] Executed DbCommand (32ms) [Parameters=[@__Parse_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [n].[Id], [n].[additional_data], [n].[Body], [n].[body_ar], [n].[body_en], [n].[created_at], [n].[expiry_at], [n].[Route], [n].[target_criteria], [n].[Title], [n].[title_ar], [n].[title_en]
FROM [notification_templates] AS [n]
WHERE [n].[Id] = @__Parse_0
2025-02-02 19:59:45.914 +03:00 [INF] Executed DbCommand (145ms) [Parameters=[@p0='?' (Size = 4000), @p1='?' (DbType = DateTime2), @p2='?' (Size = 4000), @p3='?' (Size = 4000), @p4='?' (Size = 4000), @p5='?' (Size = 450), @p6='?' (Size = 4000), @p7='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SET IMPLICIT_TRANSACTIONS OFF;
SET NOCOUNT ON;
INSERT INTO [AuthLogs] ([AuthType], [CreatedAt], [DeviceId], [FailureReason], [IpAddress], [NationalId], [Status], [UserAgent])
OUTPUT INSERTED.[Id]
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7);
2025-02-02 19:59:46.122 +03:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType9`2[[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Object, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-02-02 19:59:46.124 +03:00 [INF] Executed action NayifatAPI.Controllers.NotificationsController.GetNotifications (NayifatAPI) in 650.6624ms
2025-02-02 19:59:46.126 +03:00 [INF] Executed endpoint 'NayifatAPI.Controllers.NotificationsController.GetNotifications (NayifatAPI)'
2025-02-02 19:59:46.128 +03:00 [INF] Request finished HTTP/1.1 POST http://07ca-46-152-255-232.ngrok-free.app/api/notifications/list - 200 null application/json; charset=utf-8 806.2245ms
2025-02-02 20:05:05.879 +03:00 [INF] Request starting HTTP/1.1 POST http://07ca-46-152-255-232.ngrok-free.app/api/notifications/list - application/json; charset=utf-8 47
2025-02-02 20:05:05.884 +03:00 [INF] Executing endpoint 'NayifatAPI.Controllers.NotificationsController.GetNotifications (NayifatAPI)'
2025-02-02 20:05:05.886 +03:00 [INF] Route matched with {action = "GetNotifications", controller = "Notifications"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetNotifications(NayifatAPI.Controllers.GetNotificationsRequest) on controller NayifatAPI.Controllers.NotificationsController (NayifatAPI).
2025-02-02 20:05:05.974 +03:00 [INF] Executed DbCommand (77ms) [Parameters=[@__providedApiKey_0='?' (Size = 255)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [a].[Key], [a].[CreatedAt], [a].[Description], [a].[ExpiresAt], [a].[IsActive], [a].[LastUsedAt]
FROM [ApiKeys] AS [a]
WHERE [a].[Key] = @__providedApiKey_0 AND [a].[IsActive] = CAST(1 AS bit)
2025-02-02 20:05:05.979 +03:00 [INF] Executed DbCommand (3ms) [Parameters=[@__request_NationalId_0='?' (Size = 450)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [u].[national_id], [u].[last_updated], [u].[notifications]
FROM [user_notifications] AS [u]
WHERE [u].[national_id] = @__request_NationalId_0
2025-02-02 20:05:05.984 +03:00 [INF] Executed DbCommand (3ms) [Parameters=[@__Parse_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [n].[Id], [n].[additional_data], [n].[Body], [n].[body_ar], [n].[body_en], [n].[created_at], [n].[expiry_at], [n].[Route], [n].[target_criteria], [n].[Title], [n].[title_ar], [n].[title_en]
FROM [notification_templates] AS [n]
WHERE [n].[Id] = @__Parse_0
2025-02-02 20:05:05.988 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@__Parse_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [n].[Id], [n].[additional_data], [n].[Body], [n].[body_ar], [n].[body_en], [n].[created_at], [n].[expiry_at], [n].[Route], [n].[target_criteria], [n].[Title], [n].[title_ar], [n].[title_en]
FROM [notification_templates] AS [n]
WHERE [n].[Id] = @__Parse_0
2025-02-02 20:05:05.995 +03:00 [INF] Executed DbCommand (4ms) [Parameters=[@p0='?' (Size = 4000), @p1='?' (DbType = DateTime2), @p2='?' (Size = 4000), @p3='?' (Size = 4000), @p4='?' (Size = 4000), @p5='?' (Size = 450), @p6='?' (Size = 4000), @p7='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SET IMPLICIT_TRANSACTIONS OFF;
SET NOCOUNT ON;
INSERT INTO [AuthLogs] ([AuthType], [CreatedAt], [DeviceId], [FailureReason], [IpAddress], [NationalId], [Status], [UserAgent])
OUTPUT INSERTED.[Id]
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7);
2025-02-02 20:05:05.998 +03:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType9`2[[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Object, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-02-02 20:05:05.999 +03:00 [INF] Executed action NayifatAPI.Controllers.NotificationsController.GetNotifications (NayifatAPI) in 110.9917ms
2025-02-02 20:05:06.000 +03:00 [INF] Executed endpoint 'NayifatAPI.Controllers.NotificationsController.GetNotifications (NayifatAPI)'
2025-02-02 20:05:06.001 +03:00 [INF] Request finished HTTP/1.1 POST http://07ca-46-152-255-232.ngrok-free.app/api/notifications/list - 200 null application/json; charset=utf-8 121.9988ms
2025-02-02 20:05:10.089 +03:00 [INF] Request starting HTTP/1.1 POST http://07ca-46-152-255-232.ngrok-free.app/api/notifications/list - application/json; charset=utf-8 47
2025-02-02 20:05:10.104 +03:00 [INF] Executing endpoint 'NayifatAPI.Controllers.NotificationsController.GetNotifications (NayifatAPI)'
2025-02-02 20:05:10.125 +03:00 [INF] Route matched with {action = "GetNotifications", controller = "Notifications"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetNotifications(NayifatAPI.Controllers.GetNotificationsRequest) on controller NayifatAPI.Controllers.NotificationsController (NayifatAPI).
2025-02-02 20:05:10.173 +03:00 [INF] Executed DbCommand (2ms) [Parameters=[@__providedApiKey_0='?' (Size = 255)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [a].[Key], [a].[CreatedAt], [a].[Description], [a].[ExpiresAt], [a].[IsActive], [a].[LastUsedAt]
FROM [ApiKeys] AS [a]
WHERE [a].[Key] = @__providedApiKey_0 AND [a].[IsActive] = CAST(1 AS bit)
2025-02-02 20:05:10.176 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@__request_NationalId_0='?' (Size = 450)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [u].[national_id], [u].[last_updated], [u].[notifications]
FROM [user_notifications] AS [u]
WHERE [u].[national_id] = @__request_NationalId_0
2025-02-02 20:05:10.249 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@__Parse_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [n].[Id], [n].[additional_data], [n].[Body], [n].[body_ar], [n].[body_en], [n].[created_at], [n].[expiry_at], [n].[Route], [n].[target_criteria], [n].[Title], [n].[title_ar], [n].[title_en]
FROM [notification_templates] AS [n]
WHERE [n].[Id] = @__Parse_0
2025-02-02 20:05:10.301 +03:00 [INF] Executed DbCommand (2ms) [Parameters=[@__Parse_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [n].[Id], [n].[additional_data], [n].[Body], [n].[body_ar], [n].[body_en], [n].[created_at], [n].[expiry_at], [n].[Route], [n].[target_criteria], [n].[Title], [n].[title_ar], [n].[title_en]
FROM [notification_templates] AS [n]
WHERE [n].[Id] = @__Parse_0
2025-02-02 20:05:10.350 +03:00 [INF] Executed DbCommand (6ms) [Parameters=[@p0='?' (Size = 4000), @p1='?' (DbType = DateTime2), @p2='?' (Size = 4000), @p3='?' (Size = 4000), @p4='?' (Size = 4000), @p5='?' (Size = 450), @p6='?' (Size = 4000), @p7='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SET IMPLICIT_TRANSACTIONS OFF;
SET NOCOUNT ON;
INSERT INTO [AuthLogs] ([AuthType], [CreatedAt], [DeviceId], [FailureReason], [IpAddress], [NationalId], [Status], [UserAgent])
OUTPUT INSERTED.[Id]
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7);
2025-02-02 20:05:10.352 +03:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType9`2[[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Object, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-02-02 20:05:10.354 +03:00 [INF] Executed action NayifatAPI.Controllers.NotificationsController.GetNotifications (NayifatAPI) in 185.9216ms
2025-02-02 20:05:10.355 +03:00 [INF] Executed endpoint 'NayifatAPI.Controllers.NotificationsController.GetNotifications (NayifatAPI)'
2025-02-02 20:05:10.357 +03:00 [INF] Request finished HTTP/1.1 POST http://07ca-46-152-255-232.ngrok-free.app/api/notifications/list - 200 null application/json; charset=utf-8 267.9741ms
2025-02-02 20:05:32.856 +03:00 [INF] Request starting HTTP/1.1 POST http://07ca-46-152-255-232.ngrok-free.app/api/auth/signin - application/json; charset=utf-8 78
2025-02-02 20:05:32.861 +03:00 [INF] Executing endpoint 'NayifatAPI.Controllers.AuthController.SignIn (NayifatAPI)'
2025-02-02 20:05:32.862 +03:00 [INF] Route matched with {action = "SignIn", controller = "Auth"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] SignIn(NayifatAPI.Controllers.SignInRequest) on controller NayifatAPI.Controllers.AuthController (NayifatAPI).
2025-02-02 20:05:32.867 +03:00 [INF] Executed DbCommand (2ms) [Parameters=[@__providedApiKey_0='?' (Size = 255)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [a].[Key], [a].[CreatedAt], [a].[Description], [a].[ExpiresAt], [a].[IsActive], [a].[LastUsedAt]
FROM [ApiKeys] AS [a]
WHERE [a].[Key] = @__providedApiKey_0 AND [a].[IsActive] = CAST(1 AS bit)
2025-02-02 20:05:32.871 +03:00 [INF] Executed DbCommand (2ms) [Parameters=[@__request_NationalId_0='?' (Size = 450)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [c].[NationalId], [c].[AddNo], [c].[BuildingNo], [c].[City], [c].[Consent], [c].[ConsentDate], [c].[DateOfBirth], [c].[Dependents], [c].[District], [c].[Email], [c].[Employer], [c].[FamilyNameAr], [c].[FamilyNameEn], [c].[FirstNameAr], [c].[FirstNameEn], [c].[Iban], [c].[IdExpiryDate], [c].[Los], [c].[Mpin], [c].[MpinEnabled], [c].[NafathStatus], [c].[NafathTimestamp], [c].[Password], [c].[Phone], [c].[RegistrationDate], [c].[SalaryCustomer], [c].[SalaryDakhli], [c].[SecondNameAr], [c].[SecondNameEn], [c].[Sector], [c].[Street], [c].[ThirdNameAr], [c].[ThirdNameEn], [c].[Zipcode]
FROM [Customers] AS [c]
WHERE [c].[NationalId] = @__request_NationalId_0
2025-02-02 20:05:32.874 +03:00 [INF] Starting password verification for NationalId: 1064448614
2025-02-02 20:05:33.038 +03:00 [INF] Password verification result for NationalId 1064448614: Success
2025-02-02 20:05:33.049 +03:00 [INF] Executed DbCommand (8ms) [Parameters=[@p0='?' (Size = 4000), @p1='?' (DbType = DateTime2), @p2='?' (Size = 4000), @p3='?' (Size = 4000), @p4='?' (Size = 4000), @p5='?' (Size = 450), @p6='?' (Size = 4000), @p7='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SET IMPLICIT_TRANSACTIONS OFF;
SET NOCOUNT ON;
INSERT INTO [AuthLogs] ([AuthType], [CreatedAt], [DeviceId], [FailureReason], [IpAddress], [NationalId], [Status], [UserAgent])
OUTPUT INSERTED.[Id]
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7);
2025-02-02 20:05:33.055 +03:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType9`2[[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Object, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-02-02 20:05:33.056 +03:00 [INF] Executed action NayifatAPI.Controllers.AuthController.SignIn (NayifatAPI) in 192.4792ms
2025-02-02 20:05:33.057 +03:00 [INF] Executed endpoint 'NayifatAPI.Controllers.AuthController.SignIn (NayifatAPI)'
2025-02-02 20:05:33.058 +03:00 [INF] Request finished HTTP/1.1 POST http://07ca-46-152-255-232.ngrok-free.app/api/auth/signin - 200 null application/json; charset=utf-8 202.4341ms
2025-02-02 20:05:34.032 +03:00 [INF] Request starting HTTP/1.1 POST http://07ca-46-152-255-232.ngrok-free.app/api/proxy/forward?url=https://icreditdept.com/api/testasp/test_local_generate_otp.php - application/json; charset=utf-8 84
2025-02-02 20:05:34.037 +03:00 [INF] Executing endpoint 'NayifatAPI.Controllers.ProxyController.ForwardRequest (NayifatAPI)'
2025-02-02 20:05:34.039 +03:00 [INF] Route matched with {action = "ForwardRequest", controller = "Proxy"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] ForwardRequest() on controller NayifatAPI.Controllers.ProxyController (NayifatAPI).
2025-02-02 20:05:34.041 +03:00 [INF] Start processing HTTP request POST https://icreditdept.com/api/testasp/test_local_generate_otp.php
2025-02-02 20:05:34.043 +03:00 [INF] Sending HTTP request POST https://icreditdept.com/api/testasp/test_local_generate_otp.php
2025-02-02 20:05:35.477 +03:00 [INF] Received HTTP response headers after 1432.9316ms - 200
2025-02-02 20:05:35.478 +03:00 [INF] End processing HTTP request after 1437.2001ms - 200
2025-02-02 20:05:35.480 +03:00 [INF] Raw response length: 200
2025-02-02 20:05:35.480 +03:00 [INF] Response content: {"success":true,"errors":[],"result":{"nationalId":"1064448614","otp":503649,"expiryDate":"2025-02-02 20:10:35","successMsg":"Success","errCode":0,"errMsg":null},"type":"N","message":null,"code":null}
2025-02-02 20:05:35.481 +03:00 [INF] Executing ContentResult with HTTP Response ContentType of application/json
2025-02-02 20:05:35.482 +03:00 [INF] Executed action NayifatAPI.Controllers.ProxyController.ForwardRequest (NayifatAPI) in 1441.2945ms
2025-02-02 20:05:35.484 +03:00 [INF] Executed endpoint 'NayifatAPI.Controllers.ProxyController.ForwardRequest (NayifatAPI)'
2025-02-02 20:05:35.487 +03:00 [INF] Request finished HTTP/1.1 POST http://07ca-46-152-255-232.ngrok-free.app/api/proxy/forward?url=https://icreditdept.com/api/testasp/test_local_generate_otp.php - 200 200 application/json 1454.3396ms
2025-02-02 20:08:10.724 +03:00 [INF] Request starting HTTP/1.1 POST http://07ca-46-152-255-232.ngrok-free.app/api/auth/signin - application/json; charset=utf-8 78
2025-02-02 20:08:10.731 +03:00 [INF] Executing endpoint 'NayifatAPI.Controllers.AuthController.SignIn (NayifatAPI)'
2025-02-02 20:08:10.734 +03:00 [INF] Route matched with {action = "SignIn", controller = "Auth"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] SignIn(NayifatAPI.Controllers.SignInRequest) on controller NayifatAPI.Controllers.AuthController (NayifatAPI).
2025-02-02 20:08:10.741 +03:00 [INF] Executed DbCommand (3ms) [Parameters=[@__providedApiKey_0='?' (Size = 255)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [a].[Key], [a].[CreatedAt], [a].[Description], [a].[ExpiresAt], [a].[IsActive], [a].[LastUsedAt]
FROM [ApiKeys] AS [a]
WHERE [a].[Key] = @__providedApiKey_0 AND [a].[IsActive] = CAST(1 AS bit)
2025-02-02 20:08:10.748 +03:00 [INF] Executed DbCommand (3ms) [Parameters=[@__request_NationalId_0='?' (Size = 450)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [c].[NationalId], [c].[AddNo], [c].[BuildingNo], [c].[City], [c].[Consent], [c].[ConsentDate], [c].[DateOfBirth], [c].[Dependents], [c].[District], [c].[Email], [c].[Employer], [c].[FamilyNameAr], [c].[FamilyNameEn], [c].[FirstNameAr], [c].[FirstNameEn], [c].[Iban], [c].[IdExpiryDate], [c].[Los], [c].[Mpin], [c].[MpinEnabled], [c].[NafathStatus], [c].[NafathTimestamp], [c].[Password], [c].[Phone], [c].[RegistrationDate], [c].[SalaryCustomer], [c].[SalaryDakhli], [c].[SecondNameAr], [c].[SecondNameEn], [c].[Sector], [c].[Street], [c].[ThirdNameAr], [c].[ThirdNameEn], [c].[Zipcode]
FROM [Customers] AS [c]
WHERE [c].[NationalId] = @__request_NationalId_0
2025-02-02 20:08:10.752 +03:00 [INF] Starting password verification for NationalId: 1064448614
2025-02-02 20:08:10.925 +03:00 [INF] Password verification result for NationalId 1064448614: Success
2025-02-02 20:08:11.006 +03:00 [INF] Executed DbCommand (78ms) [Parameters=[@p0='?' (Size = 4000), @p1='?' (DbType = DateTime2), @p2='?' (Size = 4000), @p3='?' (Size = 4000), @p4='?' (Size = 4000), @p5='?' (Size = 450), @p6='?' (Size = 4000), @p7='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SET IMPLICIT_TRANSACTIONS OFF;
SET NOCOUNT ON;
INSERT INTO [AuthLogs] ([AuthType], [CreatedAt], [DeviceId], [FailureReason], [IpAddress], [NationalId], [Status], [UserAgent])
OUTPUT INSERTED.[Id]
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7);
2025-02-02 20:08:11.015 +03:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType9`2[[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Object, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-02-02 20:08:11.019 +03:00 [INF] Executed action NayifatAPI.Controllers.AuthController.SignIn (NayifatAPI) in 281.9198ms
2025-02-02 20:08:11.022 +03:00 [INF] Executed endpoint 'NayifatAPI.Controllers.AuthController.SignIn (NayifatAPI)'
2025-02-02 20:08:11.023 +03:00 [INF] Request finished HTTP/1.1 POST http://07ca-46-152-255-232.ngrok-free.app/api/auth/signin - 200 null application/json; charset=utf-8 298.8084ms
2025-02-02 20:08:11.919 +03:00 [INF] Request starting HTTP/1.1 POST http://07ca-46-152-255-232.ngrok-free.app/api/proxy/forward?url=https://icreditdept.com/api/testasp/test_local_generate_otp.php - application/json; charset=utf-8 84
2025-02-02 20:08:11.921 +03:00 [INF] Executing endpoint 'NayifatAPI.Controllers.ProxyController.ForwardRequest (NayifatAPI)'
2025-02-02 20:08:11.923 +03:00 [INF] Route matched with {action = "ForwardRequest", controller = "Proxy"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] ForwardRequest() on controller NayifatAPI.Controllers.ProxyController (NayifatAPI).
2025-02-02 20:08:11.925 +03:00 [INF] Start processing HTTP request POST https://icreditdept.com/api/testasp/test_local_generate_otp.php
2025-02-02 20:08:11.926 +03:00 [INF] Sending HTTP request POST https://icreditdept.com/api/testasp/test_local_generate_otp.php
2025-02-02 20:08:13.247 +03:00 [INF] Received HTTP response headers after 1319.7655ms - 200
2025-02-02 20:08:13.248 +03:00 [INF] End processing HTTP request after 1323.6154ms - 200
2025-02-02 20:08:13.250 +03:00 [INF] Raw response length: 200
2025-02-02 20:08:13.251 +03:00 [INF] Response content: {"success":true,"errors":[],"result":{"nationalId":"1064448614","otp":353727,"expiryDate":"2025-02-02 20:13:13","successMsg":"Success","errCode":0,"errMsg":null},"type":"N","message":null,"code":null}
2025-02-02 20:08:13.253 +03:00 [INF] Executing ContentResult with HTTP Response ContentType of application/json
2025-02-02 20:08:13.254 +03:00 [INF] Executed action NayifatAPI.Controllers.ProxyController.ForwardRequest (NayifatAPI) in 1329.5289ms
2025-02-02 20:08:13.527 +03:00 [INF] Executed endpoint 'NayifatAPI.Controllers.ProxyController.ForwardRequest (NayifatAPI)'
2025-02-02 20:08:13.529 +03:00 [INF] Request finished HTTP/1.1 POST http://07ca-46-152-255-232.ngrok-free.app/api/proxy/forward?url=https://icreditdept.com/api/testasp/test_local_generate_otp.php - 200 200 application/json 1610.7523ms
2025-02-02 20:08:23.095 +03:00 [INF] Request starting HTTP/1.1 POST http://07ca-46-152-255-232.ngrok-free.app/api/proxy/forward?url=https://icreditdept.com/api/testasp/test_local_verify_otp.php - application/json; charset=utf-8 53
2025-02-02 20:08:23.097 +03:00 [INF] Executing endpoint 'NayifatAPI.Controllers.ProxyController.ForwardRequest (NayifatAPI)'
2025-02-02 20:08:23.097 +03:00 [INF] Route matched with {action = "ForwardRequest", controller = "Proxy"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] ForwardRequest() on controller NayifatAPI.Controllers.ProxyController (NayifatAPI).
2025-02-02 20:08:23.099 +03:00 [INF] Start processing HTTP request POST https://icreditdept.com/api/testasp/test_local_verify_otp.php
2025-02-02 20:08:23.100 +03:00 [INF] Sending HTTP request POST https://icreditdept.com/api/testasp/test_local_verify_otp.php
2025-02-02 20:08:23.587 +03:00 [INF] Received HTTP response headers after 485.4854ms - 200
2025-02-02 20:08:23.587 +03:00 [INF] End processing HTTP request after 488.122ms - 200
2025-02-02 20:08:23.588 +03:00 [INF] Raw response length: 202
2025-02-02 20:08:23.589 +03:00 [INF] Response content: {"success":true,"errors":[],"result":{"nationalId":"1064448614","otp":"353727","verifiedFlag":true,"successMsg":"Verified successfully.","errCode":0,"errMsg":null},"type":"N","message":null,"code":null}
2025-02-02 20:08:23.592 +03:00 [INF] Executing ContentResult with HTTP Response ContentType of application/json
2025-02-02 20:08:23.594 +03:00 [INF] Executed action NayifatAPI.Controllers.ProxyController.ForwardRequest (NayifatAPI) in 494.685ms
2025-02-02 20:08:23.595 +03:00 [INF] Executed endpoint 'NayifatAPI.Controllers.ProxyController.ForwardRequest (NayifatAPI)'
2025-02-02 20:08:23.597 +03:00 [INF] Request finished HTTP/1.1 POST http://07ca-46-152-255-232.ngrok-free.app/api/proxy/forward?url=https://icreditdept.com/api/testasp/test_local_verify_otp.php - 200 202 application/json 502.6953ms
2025-02-02 20:09:45.544 +03:00 [INF] Request starting HTTP/1.1 POST http://07ca-46-152-255-232.ngrok-free.app/api/notifications/list - application/json; charset=utf-8 47
2025-02-02 20:09:45.547 +03:00 [INF] Executing endpoint 'NayifatAPI.Controllers.NotificationsController.GetNotifications (NayifatAPI)'
2025-02-02 20:09:45.548 +03:00 [INF] Route matched with {action = "GetNotifications", controller = "Notifications"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetNotifications(NayifatAPI.Controllers.GetNotificationsRequest) on controller NayifatAPI.Controllers.NotificationsController (NayifatAPI).
2025-02-02 20:09:45.558 +03:00 [INF] Executed DbCommand (3ms) [Parameters=[@__providedApiKey_0='?' (Size = 255)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [a].[Key], [a].[CreatedAt], [a].[Description], [a].[ExpiresAt], [a].[IsActive], [a].[LastUsedAt]
FROM [ApiKeys] AS [a]
WHERE [a].[Key] = @__providedApiKey_0 AND [a].[IsActive] = CAST(1 AS bit)
2025-02-02 20:09:45.563 +03:00 [INF] Executed DbCommand (2ms) [Parameters=[@__request_NationalId_0='?' (Size = 450)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [u].[national_id], [u].[last_updated], [u].[notifications]
FROM [user_notifications] AS [u]
WHERE [u].[national_id] = @__request_NationalId_0
2025-02-02 20:09:45.569 +03:00 [INF] Executed DbCommand (3ms) [Parameters=[@__Parse_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [n].[Id], [n].[additional_data], [n].[Body], [n].[body_ar], [n].[body_en], [n].[created_at], [n].[expiry_at], [n].[Route], [n].[target_criteria], [n].[Title], [n].[title_ar], [n].[title_en]
FROM [notification_templates] AS [n]
WHERE [n].[Id] = @__Parse_0
2025-02-02 20:09:45.573 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@__Parse_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [n].[Id], [n].[additional_data], [n].[Body], [n].[body_ar], [n].[body_en], [n].[created_at], [n].[expiry_at], [n].[Route], [n].[target_criteria], [n].[Title], [n].[title_ar], [n].[title_en]
FROM [notification_templates] AS [n]
WHERE [n].[Id] = @__Parse_0
2025-02-02 20:09:45.654 +03:00 [INF] Executed DbCommand (76ms) [Parameters=[@p0='?' (Size = 4000), @p1='?' (DbType = DateTime2), @p2='?' (Size = 4000), @p3='?' (Size = 4000), @p4='?' (Size = 4000), @p5='?' (Size = 450), @p6='?' (Size = 4000), @p7='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SET IMPLICIT_TRANSACTIONS OFF;
SET NOCOUNT ON;
INSERT INTO [AuthLogs] ([AuthType], [CreatedAt], [DeviceId], [FailureReason], [IpAddress], [NationalId], [Status], [UserAgent])
OUTPUT INSERTED.[Id]
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7);
2025-02-02 20:09:45.657 +03:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType9`2[[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Object, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-02-02 20:09:45.659 +03:00 [INF] Executed action NayifatAPI.Controllers.NotificationsController.GetNotifications (NayifatAPI) in 105.2721ms
2025-02-02 20:09:45.660 +03:00 [INF] Executed endpoint 'NayifatAPI.Controllers.NotificationsController.GetNotifications (NayifatAPI)'
2025-02-02 20:09:45.661 +03:00 [INF] Request finished HTTP/1.1 POST http://07ca-46-152-255-232.ngrok-free.app/api/notifications/list - 200 null application/json; charset=utf-8 116.1493ms
2025-02-02 20:10:11.385 +03:00 [INF] Request starting HTTP/1.1 POST http://07ca-46-152-255-232.ngrok-free.app/api/notifications/list - application/json; charset=utf-8 47
2025-02-02 20:10:11.395 +03:00 [INF] Executing endpoint 'NayifatAPI.Controllers.NotificationsController.GetNotifications (NayifatAPI)'
2025-02-02 20:10:11.396 +03:00 [INF] Route matched with {action = "GetNotifications", controller = "Notifications"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetNotifications(NayifatAPI.Controllers.GetNotificationsRequest) on controller NayifatAPI.Controllers.NotificationsController (NayifatAPI).
2025-02-02 20:10:11.403 +03:00 [INF] Executed DbCommand (3ms) [Parameters=[@__providedApiKey_0='?' (Size = 255)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [a].[Key], [a].[CreatedAt], [a].[Description], [a].[ExpiresAt], [a].[IsActive], [a].[LastUsedAt]
FROM [ApiKeys] AS [a]
WHERE [a].[Key] = @__providedApiKey_0 AND [a].[IsActive] = CAST(1 AS bit)
2025-02-02 20:10:11.409 +03:00 [INF] Executed DbCommand (3ms) [Parameters=[@__request_NationalId_0='?' (Size = 450)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [u].[national_id], [u].[last_updated], [u].[notifications]
FROM [user_notifications] AS [u]
WHERE [u].[national_id] = @__request_NationalId_0
2025-02-02 20:10:11.416 +03:00 [INF] Executed DbCommand (4ms) [Parameters=[@__Parse_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [n].[Id], [n].[additional_data], [n].[Body], [n].[body_ar], [n].[body_en], [n].[created_at], [n].[expiry_at], [n].[Route], [n].[target_criteria], [n].[Title], [n].[title_ar], [n].[title_en]
FROM [notification_templates] AS [n]
WHERE [n].[Id] = @__Parse_0
2025-02-02 20:10:11.420 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@__Parse_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [n].[Id], [n].[additional_data], [n].[Body], [n].[body_ar], [n].[body_en], [n].[created_at], [n].[expiry_at], [n].[Route], [n].[target_criteria], [n].[Title], [n].[title_ar], [n].[title_en]
FROM [notification_templates] AS [n]
WHERE [n].[Id] = @__Parse_0
2025-02-02 20:10:11.500 +03:00 [INF] Executed DbCommand (78ms) [Parameters=[@p0='?' (Size = 4000), @p1='?' (DbType = DateTime2), @p2='?' (Size = 4000), @p3='?' (Size = 4000), @p4='?' (Size = 4000), @p5='?' (Size = 450), @p6='?' (Size = 4000), @p7='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SET IMPLICIT_TRANSACTIONS OFF;
SET NOCOUNT ON;
INSERT INTO [AuthLogs] ([AuthType], [CreatedAt], [DeviceId], [FailureReason], [IpAddress], [NationalId], [Status], [UserAgent])
OUTPUT INSERTED.[Id]
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7);
2025-02-02 20:10:11.503 +03:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType9`2[[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Object, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-02-02 20:10:11.504 +03:00 [INF] Executed action NayifatAPI.Controllers.NotificationsController.GetNotifications (NayifatAPI) in 106.1029ms
2025-02-02 20:10:11.507 +03:00 [INF] Executed endpoint 'NayifatAPI.Controllers.NotificationsController.GetNotifications (NayifatAPI)'
2025-02-02 20:10:11.509 +03:00 [INF] Request finished HTTP/1.1 POST http://07ca-46-152-255-232.ngrok-free.app/api/notifications/list - 200 null application/json; charset=utf-8 123.3097ms
2025-02-02 20:11:37.098 +03:00 [INF] Request starting HTTP/1.1 POST http://07ca-46-152-255-232.ngrok-free.app/api/notifications/list - application/json; charset=utf-8 47
2025-02-02 20:11:37.112 +03:00 [INF] Executing endpoint 'NayifatAPI.Controllers.NotificationsController.GetNotifications (NayifatAPI)'
2025-02-02 20:11:37.117 +03:00 [INF] Route matched with {action = "GetNotifications", controller = "Notifications"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetNotifications(NayifatAPI.Controllers.GetNotificationsRequest) on controller NayifatAPI.Controllers.NotificationsController (NayifatAPI).
2025-02-02 20:11:37.126 +03:00 [INF] Executed DbCommand (4ms) [Parameters=[@__providedApiKey_0='?' (Size = 255)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [a].[Key], [a].[CreatedAt], [a].[Description], [a].[ExpiresAt], [a].[IsActive], [a].[LastUsedAt]
FROM [ApiKeys] AS [a]
WHERE [a].[Key] = @__providedApiKey_0 AND [a].[IsActive] = CAST(1 AS bit)
2025-02-02 20:11:37.132 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@__request_NationalId_0='?' (Size = 450)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [u].[national_id], [u].[last_updated], [u].[notifications]
FROM [user_notifications] AS [u]
WHERE [u].[national_id] = @__request_NationalId_0
2025-02-02 20:11:37.135 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@__Parse_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [n].[Id], [n].[additional_data], [n].[Body], [n].[body_ar], [n].[body_en], [n].[created_at], [n].[expiry_at], [n].[Route], [n].[target_criteria], [n].[Title], [n].[title_ar], [n].[title_en]
FROM [notification_templates] AS [n]
WHERE [n].[Id] = @__Parse_0
2025-02-02 20:11:37.139 +03:00 [INF] Executed DbCommand (0ms) [Parameters=[@__Parse_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [n].[Id], [n].[additional_data], [n].[Body], [n].[body_ar], [n].[body_en], [n].[created_at], [n].[expiry_at], [n].[Route], [n].[target_criteria], [n].[Title], [n].[title_ar], [n].[title_en]
FROM [notification_templates] AS [n]
WHERE [n].[Id] = @__Parse_0
2025-02-02 20:11:37.217 +03:00 [INF] Executed DbCommand (76ms) [Parameters=[@p0='?' (Size = 4000), @p1='?' (DbType = DateTime2), @p2='?' (Size = 4000), @p3='?' (Size = 4000), @p4='?' (Size = 4000), @p5='?' (Size = 450), @p6='?' (Size = 4000), @p7='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SET IMPLICIT_TRANSACTIONS OFF;
SET NOCOUNT ON;
INSERT INTO [AuthLogs] ([AuthType], [CreatedAt], [DeviceId], [FailureReason], [IpAddress], [NationalId], [Status], [UserAgent])
OUTPUT INSERTED.[Id]
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7);
2025-02-02 20:11:37.221 +03:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType9`2[[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Object, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-02-02 20:11:37.222 +03:00 [INF] Executed action NayifatAPI.Controllers.NotificationsController.GetNotifications (NayifatAPI) in 101.1906ms
2025-02-02 20:11:37.223 +03:00 [INF] Executed endpoint 'NayifatAPI.Controllers.NotificationsController.GetNotifications (NayifatAPI)'
2025-02-02 20:11:37.224 +03:00 [INF] Request finished HTTP/1.1 POST http://07ca-46-152-255-232.ngrok-free.app/api/notifications/list - 200 null application/json; charset=utf-8 126.0346ms
2025-02-02 20:11:54.408 +03:00 [INF] Request starting HTTP/1.1 POST http://07ca-46-152-255-232.ngrok-free.app/api/auth/signin - application/json; charset=utf-8 78
2025-02-02 20:11:54.414 +03:00 [INF] Executing endpoint 'NayifatAPI.Controllers.AuthController.SignIn (NayifatAPI)'
2025-02-02 20:11:54.415 +03:00 [INF] Route matched with {action = "SignIn", controller = "Auth"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] SignIn(NayifatAPI.Controllers.SignInRequest) on controller NayifatAPI.Controllers.AuthController (NayifatAPI).
2025-02-02 20:11:54.418 +03:00 [INF] Executed DbCommand (0ms) [Parameters=[@__providedApiKey_0='?' (Size = 255)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [a].[Key], [a].[CreatedAt], [a].[Description], [a].[ExpiresAt], [a].[IsActive], [a].[LastUsedAt]
FROM [ApiKeys] AS [a]
WHERE [a].[Key] = @__providedApiKey_0 AND [a].[IsActive] = CAST(1 AS bit)
2025-02-02 20:11:54.422 +03:00 [INF] Executed DbCommand (2ms) [Parameters=[@__request_NationalId_0='?' (Size = 450)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [c].[NationalId], [c].[AddNo], [c].[BuildingNo], [c].[City], [c].[Consent], [c].[ConsentDate], [c].[DateOfBirth], [c].[Dependents], [c].[District], [c].[Email], [c].[Employer], [c].[FamilyNameAr], [c].[FamilyNameEn], [c].[FirstNameAr], [c].[FirstNameEn], [c].[Iban], [c].[IdExpiryDate], [c].[Los], [c].[Mpin], [c].[MpinEnabled], [c].[NafathStatus], [c].[NafathTimestamp], [c].[Password], [c].[Phone], [c].[RegistrationDate], [c].[SalaryCustomer], [c].[SalaryDakhli], [c].[SecondNameAr], [c].[SecondNameEn], [c].[Sector], [c].[Street], [c].[ThirdNameAr], [c].[ThirdNameEn], [c].[Zipcode]
FROM [Customers] AS [c]
WHERE [c].[NationalId] = @__request_NationalId_0
2025-02-02 20:11:54.425 +03:00 [INF] Starting password verification for NationalId: 1064448614
2025-02-02 20:11:54.595 +03:00 [INF] Password verification result for NationalId 1064448614: Success
2025-02-02 20:11:54.672 +03:00 [INF] Executed DbCommand (74ms) [Parameters=[@p0='?' (Size = 4000), @p1='?' (DbType = DateTime2), @p2='?' (Size = 4000), @p3='?' (Size = 4000), @p4='?' (Size = 4000), @p5='?' (Size = 450), @p6='?' (Size = 4000), @p7='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SET IMPLICIT_TRANSACTIONS OFF;
SET NOCOUNT ON;
INSERT INTO [AuthLogs] ([AuthType], [CreatedAt], [DeviceId], [FailureReason], [IpAddress], [NationalId], [Status], [UserAgent])
OUTPUT INSERTED.[Id]
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7);
2025-02-02 20:11:54.674 +03:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType9`2[[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Object, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-02-02 20:11:54.675 +03:00 [INF] Executed action NayifatAPI.Controllers.AuthController.SignIn (NayifatAPI) in 258.7864ms
2025-02-02 20:11:54.676 +03:00 [INF] Executed endpoint 'NayifatAPI.Controllers.AuthController.SignIn (NayifatAPI)'
2025-02-02 20:11:54.677 +03:00 [INF] Request finished HTTP/1.1 POST http://07ca-46-152-255-232.ngrok-free.app/api/auth/signin - 200 null application/json; charset=utf-8 269.684ms
2025-02-02 20:11:55.564 +03:00 [INF] Request starting HTTP/1.1 POST http://07ca-46-152-255-232.ngrok-free.app/api/proxy/forward?url=https://icreditdept.com/api/testasp/test_local_generate_otp.php - application/json; charset=utf-8 84
2025-02-02 20:11:55.574 +03:00 [INF] Executing endpoint 'NayifatAPI.Controllers.ProxyController.ForwardRequest (NayifatAPI)'
2025-02-02 20:11:55.577 +03:00 [INF] Route matched with {action = "ForwardRequest", controller = "Proxy"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] ForwardRequest() on controller NayifatAPI.Controllers.ProxyController (NayifatAPI).
2025-02-02 20:11:55.580 +03:00 [INF] Start processing HTTP request POST https://icreditdept.com/api/testasp/test_local_generate_otp.php
2025-02-02 20:11:55.581 +03:00 [INF] Sending HTTP request POST https://icreditdept.com/api/testasp/test_local_generate_otp.php
2025-02-02 20:11:56.538 +03:00 [INF] Received HTTP response headers after 956.018ms - 200
2025-02-02 20:11:56.539 +03:00 [INF] End processing HTTP request after 958.5574ms - 200
2025-02-02 20:11:56.540 +03:00 [INF] Raw response length: 200
2025-02-02 20:11:56.541 +03:00 [INF] Response content: {"success":true,"errors":[],"result":{"nationalId":"1064448614","otp":302471,"expiryDate":"2025-02-02 20:16:56","successMsg":"Success","errCode":0,"errMsg":null},"type":"N","message":null,"code":null}
2025-02-02 20:11:56.542 +03:00 [INF] Executing ContentResult with HTTP Response ContentType of application/json
2025-02-02 20:11:56.543 +03:00 [INF] Executed action NayifatAPI.Controllers.ProxyController.ForwardRequest (NayifatAPI) in 962.8ms
2025-02-02 20:11:56.544 +03:00 [INF] Executed endpoint 'NayifatAPI.Controllers.ProxyController.ForwardRequest (NayifatAPI)'
2025-02-02 20:11:56.545 +03:00 [INF] Request finished HTTP/1.1 POST http://07ca-46-152-255-232.ngrok-free.app/api/proxy/forward?url=https://icreditdept.com/api/testasp/test_local_generate_otp.php - 200 200 application/json 980.2688ms
2025-02-02 20:12:37.034 +03:00 [INF] Request starting HTTP/1.1 POST http://07ca-46-152-255-232.ngrok-free.app/api/proxy/forward?url=https://icreditdept.com/api/testasp/test_local_verify_otp.php - application/json; charset=utf-8 53
2025-02-02 20:12:37.039 +03:00 [INF] Executing endpoint 'NayifatAPI.Controllers.ProxyController.ForwardRequest (NayifatAPI)'
2025-02-02 20:12:37.040 +03:00 [INF] Route matched with {action = "ForwardRequest", controller = "Proxy"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] ForwardRequest() on controller NayifatAPI.Controllers.ProxyController (NayifatAPI).
2025-02-02 20:12:37.042 +03:00 [INF] Start processing HTTP request POST https://icreditdept.com/api/testasp/test_local_verify_otp.php
2025-02-02 20:12:37.043 +03:00 [INF] Sending HTTP request POST https://icreditdept.com/api/testasp/test_local_verify_otp.php
2025-02-02 20:12:37.457 +03:00 [INF] Received HTTP response headers after 413.4667ms - 200
2025-02-02 20:12:37.458 +03:00 [INF] End processing HTTP request after 416.5249ms - 200
2025-02-02 20:12:37.460 +03:00 [INF] Raw response length: 202
2025-02-02 20:12:37.461 +03:00 [INF] Response content: {"success":true,"errors":[],"result":{"nationalId":"1064448614","otp":"302471","verifiedFlag":true,"successMsg":"Verified successfully.","errCode":0,"errMsg":null},"type":"N","message":null,"code":null}
2025-02-02 20:12:37.462 +03:00 [INF] Executing ContentResult with HTTP Response ContentType of application/json
2025-02-02 20:12:37.462 +03:00 [INF] Executed action NayifatAPI.Controllers.ProxyController.ForwardRequest (NayifatAPI) in 420.7785ms
2025-02-02 20:12:37.464 +03:00 [INF] Executed endpoint 'NayifatAPI.Controllers.ProxyController.ForwardRequest (NayifatAPI)'
2025-02-02 20:12:37.466 +03:00 [INF] Request finished HTTP/1.1 POST http://07ca-46-152-255-232.ngrok-free.app/api/proxy/forward?url=https://icreditdept.com/api/testasp/test_local_verify_otp.php - 200 202 application/json 431.5878ms
2025-02-02 20:12:41.770 +03:00 [INF] Request starting HTTP/1.1 POST http://07ca-46-152-255-232.ngrok-free.app/api/proxy/forward?url=https://icreditdept.com/api/testasp/test_local_verify_otp.php - application/json; charset=utf-8 53
2025-02-02 20:12:41.772 +03:00 [INF] Executing endpoint 'NayifatAPI.Controllers.ProxyController.ForwardRequest (NayifatAPI)'
2025-02-02 20:12:41.773 +03:00 [INF] Route matched with {action = "ForwardRequest", controller = "Proxy"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] ForwardRequest() on controller NayifatAPI.Controllers.ProxyController (NayifatAPI).
2025-02-02 20:12:41.775 +03:00 [INF] Start processing HTTP request POST https://icreditdept.com/api/testasp/test_local_verify_otp.php
2025-02-02 20:12:41.776 +03:00 [INF] Sending HTTP request POST https://icreditdept.com/api/testasp/test_local_verify_otp.php
2025-02-02 20:12:42.049 +03:00 [INF] Received HTTP response headers after 272.6883ms - 200
2025-02-02 20:12:42.051 +03:00 [INF] End processing HTTP request after 276.4587ms - 200
2025-02-02 20:12:42.056 +03:00 [INF] Raw response length: 43
2025-02-02 20:12:42.056 +03:00 [INF] Response content: {"success":false,"message":"Incorrect OTP"}
2025-02-02 20:12:42.058 +03:00 [INF] Executing ContentResult with HTTP Response ContentType of application/json
2025-02-02 20:12:42.059 +03:00 [INF] Executed action NayifatAPI.Controllers.ProxyController.ForwardRequest (NayifatAPI) in 283.8737ms
2025-02-02 20:12:42.060 +03:00 [INF] Executed endpoint 'NayifatAPI.Controllers.ProxyController.ForwardRequest (NayifatAPI)'
2025-02-02 20:12:42.062 +03:00 [INF] Request finished HTTP/1.1 POST http://07ca-46-152-255-232.ngrok-free.app/api/proxy/forward?url=https://icreditdept.com/api/testasp/test_local_verify_otp.php - 200 43 application/json 291.8604ms
2025-02-02 20:12:44.564 +03:00 [INF] Request starting HTTP/1.1 POST http://07ca-46-152-255-232.ngrok-free.app/api/proxy/forward?url=https://icreditdept.com/api/testasp/test_local_verify_otp.php - application/json; charset=utf-8 53
2025-02-02 20:12:44.620 +03:00 [INF] Executing endpoint 'NayifatAPI.Controllers.ProxyController.ForwardRequest (NayifatAPI)'
2025-02-02 20:12:44.622 +03:00 [INF] Route matched with {action = "ForwardRequest", controller = "Proxy"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] ForwardRequest() on controller NayifatAPI.Controllers.ProxyController (NayifatAPI).
2025-02-02 20:12:44.625 +03:00 [INF] Start processing HTTP request POST https://icreditdept.com/api/testasp/test_local_verify_otp.php
2025-02-02 20:12:44.627 +03:00 [INF] Sending HTTP request POST https://icreditdept.com/api/testasp/test_local_verify_otp.php
2025-02-02 20:12:45.004 +03:00 [INF] Received HTTP response headers after 374.9863ms - 200
2025-02-02 20:12:45.031 +03:00 [INF] End processing HTTP request after 405.4321ms - 200
2025-02-02 20:12:45.062 +03:00 [INF] Raw response length: 43
2025-02-02 20:12:45.159 +03:00 [INF] Response content: {"success":false,"message":"Incorrect OTP"}
2025-02-02 20:12:45.160 +03:00 [INF] Executing ContentResult with HTTP Response ContentType of application/json
2025-02-02 20:12:45.160 +03:00 [INF] Executed action NayifatAPI.Controllers.ProxyController.ForwardRequest (NayifatAPI) in 535.5523ms
2025-02-02 20:12:45.162 +03:00 [INF] Executed endpoint 'NayifatAPI.Controllers.ProxyController.ForwardRequest (NayifatAPI)'
2025-02-02 20:12:45.163 +03:00 [INF] Request finished HTTP/1.1 POST http://07ca-46-152-255-232.ngrok-free.app/api/proxy/forward?url=https://icreditdept.com/api/testasp/test_local_verify_otp.php - 200 43 application/json 598.7962ms
2025-02-02 20:13:17.908 +03:00 [INF] Request starting HTTP/1.1 POST http://07ca-46-152-255-232.ngrok-free.app/api/proxy/forward?url=https://icreditdept.com/api/testasp/test_local_verify_otp.php - application/json; charset=utf-8 53
2025-02-02 20:13:17.911 +03:00 [INF] Executing endpoint 'NayifatAPI.Controllers.ProxyController.ForwardRequest (NayifatAPI)'
2025-02-02 20:13:17.911 +03:00 [INF] Route matched with {action = "ForwardRequest", controller = "Proxy"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] ForwardRequest() on controller NayifatAPI.Controllers.ProxyController (NayifatAPI).
2025-02-02 20:13:17.913 +03:00 [INF] Start processing HTTP request POST https://icreditdept.com/api/testasp/test_local_verify_otp.php
2025-02-02 20:13:17.913 +03:00 [INF] Sending HTTP request POST https://icreditdept.com/api/testasp/test_local_verify_otp.php
2025-02-02 20:13:18.326 +03:00 [INF] Received HTTP response headers after 412.3176ms - 200
2025-02-02 20:13:18.331 +03:00 [INF] End processing HTTP request after 418.3337ms - 200
2025-02-02 20:13:18.332 +03:00 [INF] Raw response length: 43
2025-02-02 20:13:18.333 +03:00 [INF] Response content: {"success":false,"message":"Incorrect OTP"}
2025-02-02 20:13:18.334 +03:00 [INF] Executing ContentResult with HTTP Response ContentType of application/json
2025-02-02 20:13:18.334 +03:00 [INF] Executed action NayifatAPI.Controllers.ProxyController.ForwardRequest (NayifatAPI) in 422.2066ms
2025-02-02 20:13:18.337 +03:00 [INF] Executed endpoint 'NayifatAPI.Controllers.ProxyController.ForwardRequest (NayifatAPI)'
2025-02-02 20:13:18.340 +03:00 [INF] Request finished HTTP/1.1 POST http://07ca-46-152-255-232.ngrok-free.app/api/proxy/forward?url=https://icreditdept.com/api/testasp/test_local_verify_otp.php - 200 43 application/json 432.1033ms
2025-02-02 20:13:59.166 +03:00 [INF] Request starting HTTP/1.1 POST http://07ca-46-152-255-232.ngrok-free.app/api/proxy/forward?url=https://icreditdept.com/api/testasp/test_local_generate_otp.php - application/json; charset=utf-8 84
2025-02-02 20:13:59.172 +03:00 [INF] Executing endpoint 'NayifatAPI.Controllers.ProxyController.ForwardRequest (NayifatAPI)'
2025-02-02 20:13:59.177 +03:00 [INF] Route matched with {action = "ForwardRequest", controller = "Proxy"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] ForwardRequest() on controller NayifatAPI.Controllers.ProxyController (NayifatAPI).
2025-02-02 20:13:59.179 +03:00 [INF] Start processing HTTP request POST https://icreditdept.com/api/testasp/test_local_generate_otp.php
2025-02-02 20:13:59.180 +03:00 [INF] Sending HTTP request POST https://icreditdept.com/api/testasp/test_local_generate_otp.php
2025-02-02 20:13:59.844 +03:00 [INF] Received HTTP response headers after 662.9034ms - 200
2025-02-02 20:13:59.845 +03:00 [INF] End processing HTTP request after 666.0962ms - 200
2025-02-02 20:13:59.847 +03:00 [INF] Raw response length: 200
2025-02-02 20:13:59.847 +03:00 [INF] Response content: {"success":true,"errors":[],"result":{"nationalId":"1064448614","otp":639587,"expiryDate":"2025-02-02 20:19:00","successMsg":"Success","errCode":0,"errMsg":null},"type":"N","message":null,"code":null}
2025-02-02 20:13:59.849 +03:00 [INF] Executing ContentResult with HTTP Response ContentType of application/json
2025-02-02 20:13:59.849 +03:00 [INF] Executed action NayifatAPI.Controllers.ProxyController.ForwardRequest (NayifatAPI) in 670.6765ms
2025-02-02 20:13:59.850 +03:00 [INF] Executed endpoint 'NayifatAPI.Controllers.ProxyController.ForwardRequest (NayifatAPI)'
2025-02-02 20:13:59.853 +03:00 [INF] Request finished HTTP/1.1 POST http://07ca-46-152-255-232.ngrok-free.app/api/proxy/forward?url=https://icreditdept.com/api/testasp/test_local_generate_otp.php - 200 200 application/json 686.6055ms
2025-02-02 20:15:17.602 +03:00 [INF] Request starting HTTP/1.1 POST http://07ca-46-152-255-232.ngrok-free.app/api/proxy/forward?url=https://icreditdept.com/api/testasp/test_local_generate_otp.php - application/json; charset=utf-8 84
2025-02-02 20:15:17.606 +03:00 [INF] Executing endpoint 'NayifatAPI.Controllers.ProxyController.ForwardRequest (NayifatAPI)'
2025-02-02 20:15:17.607 +03:00 [INF] Route matched with {action = "ForwardRequest", controller = "Proxy"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] ForwardRequest() on controller NayifatAPI.Controllers.ProxyController (NayifatAPI).
2025-02-02 20:15:17.609 +03:00 [INF] Start processing HTTP request POST https://icreditdept.com/api/testasp/test_local_generate_otp.php
2025-02-02 20:15:17.610 +03:00 [INF] Sending HTTP request POST https://icreditdept.com/api/testasp/test_local_generate_otp.php
2025-02-02 20:15:20.476 +03:00 [INF] Received HTTP response headers after 2865.1256ms - 200
2025-02-02 20:15:20.478 +03:00 [INF] End processing HTTP request after 2869.7527ms - 200
2025-02-02 20:15:20.480 +03:00 [INF] Raw response length: 200
2025-02-02 20:15:20.482 +03:00 [INF] Response content: {"success":true,"errors":[],"result":{"nationalId":"1064448614","otp":220075,"expiryDate":"2025-02-02 20:20:20","successMsg":"Success","errCode":0,"errMsg":null},"type":"N","message":null,"code":null}
2025-02-02 20:15:20.483 +03:00 [INF] Executing ContentResult with HTTP Response ContentType of application/json
2025-02-02 20:15:20.484 +03:00 [INF] Executed action NayifatAPI.Controllers.ProxyController.ForwardRequest (NayifatAPI) in 2875.5783ms
2025-02-02 20:15:20.486 +03:00 [INF] Executed endpoint 'NayifatAPI.Controllers.ProxyController.ForwardRequest (NayifatAPI)'
2025-02-02 20:15:20.488 +03:00 [INF] Request finished HTTP/1.1 POST http://07ca-46-152-255-232.ngrok-free.app/api/proxy/forward?url=https://icreditdept.com/api/testasp/test_local_generate_otp.php - 200 200 application/json 2886.1465ms
2025-02-02 20:16:38.618 +03:00 [INF] Request starting HTTP/1.1 POST http://07ca-46-152-255-232.ngrok-free.app/api/notifications/list - application/json; charset=utf-8 47
2025-02-02 20:16:38.681 +03:00 [INF] Executing endpoint 'NayifatAPI.Controllers.NotificationsController.GetNotifications (NayifatAPI)'
2025-02-02 20:16:38.682 +03:00 [INF] Route matched with {action = "GetNotifications", controller = "Notifications"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetNotifications(NayifatAPI.Controllers.GetNotificationsRequest) on controller NayifatAPI.Controllers.NotificationsController (NayifatAPI).
2025-02-02 20:16:38.705 +03:00 [INF] Executed DbCommand (19ms) [Parameters=[@__providedApiKey_0='?' (Size = 255)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [a].[Key], [a].[CreatedAt], [a].[Description], [a].[ExpiresAt], [a].[IsActive], [a].[LastUsedAt]
FROM [ApiKeys] AS [a]
WHERE [a].[Key] = @__providedApiKey_0 AND [a].[IsActive] = CAST(1 AS bit)
2025-02-02 20:16:39.013 +03:00 [INF] Executed DbCommand (3ms) [Parameters=[@__request_NationalId_0='?' (Size = 450)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [u].[national_id], [u].[last_updated], [u].[notifications]
FROM [user_notifications] AS [u]
WHERE [u].[national_id] = @__request_NationalId_0
2025-02-02 20:16:39.025 +03:00 [INF] Executed DbCommand (7ms) [Parameters=[@__Parse_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [n].[Id], [n].[additional_data], [n].[Body], [n].[body_ar], [n].[body_en], [n].[created_at], [n].[expiry_at], [n].[Route], [n].[target_criteria], [n].[Title], [n].[title_ar], [n].[title_en]
FROM [notification_templates] AS [n]
WHERE [n].[Id] = @__Parse_0
2025-02-02 20:16:39.328 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@__Parse_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [n].[Id], [n].[additional_data], [n].[Body], [n].[body_ar], [n].[body_en], [n].[created_at], [n].[expiry_at], [n].[Route], [n].[target_criteria], [n].[Title], [n].[title_ar], [n].[title_en]
FROM [notification_templates] AS [n]
WHERE [n].[Id] = @__Parse_0
2025-02-02 20:16:39.512 +03:00 [INF] Executed DbCommand (176ms) [Parameters=[@p0='?' (Size = 4000), @p1='?' (DbType = DateTime2), @p2='?' (Size = 4000), @p3='?' (Size = 4000), @p4='?' (Size = 4000), @p5='?' (Size = 450), @p6='?' (Size = 4000), @p7='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SET IMPLICIT_TRANSACTIONS OFF;
SET NOCOUNT ON;
INSERT INTO [AuthLogs] ([AuthType], [CreatedAt], [DeviceId], [FailureReason], [IpAddress], [NationalId], [Status], [UserAgent])
OUTPUT INSERTED.[Id]
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7);
2025-02-02 20:16:39.562 +03:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType9`2[[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Object, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-02-02 20:16:39.564 +03:00 [INF] Executed action NayifatAPI.Controllers.NotificationsController.GetNotifications (NayifatAPI) in 879.5428ms
2025-02-02 20:16:39.566 +03:00 [INF] Executed endpoint 'NayifatAPI.Controllers.NotificationsController.GetNotifications (NayifatAPI)'
2025-02-02 20:16:39.567 +03:00 [INF] Request finished HTTP/1.1 POST http://07ca-46-152-255-232.ngrok-free.app/api/notifications/list - 200 null application/json; charset=utf-8 949.0632ms
2025-02-02 20:17:43.107 +03:00 [INF] Request starting HTTP/1.1 POST http://07ca-46-152-255-232.ngrok-free.app/api/auth/signin - application/json; charset=utf-8 78
2025-02-02 20:17:43.110 +03:00 [INF] Executing endpoint 'NayifatAPI.Controllers.AuthController.SignIn (NayifatAPI)'
2025-02-02 20:17:43.111 +03:00 [INF] Route matched with {action = "SignIn", controller = "Auth"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] SignIn(NayifatAPI.Controllers.SignInRequest) on controller NayifatAPI.Controllers.AuthController (NayifatAPI).
2025-02-02 20:17:43.115 +03:00 [INF] Executed DbCommand (2ms) [Parameters=[@__providedApiKey_0='?' (Size = 255)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [a].[Key], [a].[CreatedAt], [a].[Description], [a].[ExpiresAt], [a].[IsActive], [a].[LastUsedAt]
FROM [ApiKeys] AS [a]
WHERE [a].[Key] = @__providedApiKey_0 AND [a].[IsActive] = CAST(1 AS bit)
2025-02-02 20:17:43.121 +03:00 [INF] Executed DbCommand (3ms) [Parameters=[@__request_NationalId_0='?' (Size = 450)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [c].[NationalId], [c].[AddNo], [c].[BuildingNo], [c].[City], [c].[Consent], [c].[ConsentDate], [c].[DateOfBirth], [c].[Dependents], [c].[District], [c].[Email], [c].[Employer], [c].[FamilyNameAr], [c].[FamilyNameEn], [c].[FirstNameAr], [c].[FirstNameEn], [c].[Iban], [c].[IdExpiryDate], [c].[Los], [c].[Mpin], [c].[MpinEnabled], [c].[NafathStatus], [c].[NafathTimestamp], [c].[Password], [c].[Phone], [c].[RegistrationDate], [c].[SalaryCustomer], [c].[SalaryDakhli], [c].[SecondNameAr], [c].[SecondNameEn], [c].[Sector], [c].[Street], [c].[ThirdNameAr], [c].[ThirdNameEn], [c].[Zipcode]
FROM [Customers] AS [c]
WHERE [c].[NationalId] = @__request_NationalId_0
2025-02-02 20:17:43.125 +03:00 [INF] Starting password verification for NationalId: 1064448614
2025-02-02 20:17:43.298 +03:00 [INF] Password verification result for NationalId 1064448614: Success
2025-02-02 20:17:43.375 +03:00 [INF] Executed DbCommand (76ms) [Parameters=[@p0='?' (Size = 4000), @p1='?' (DbType = DateTime2), @p2='?' (Size = 4000), @p3='?' (Size = 4000), @p4='?' (Size = 4000), @p5='?' (Size = 450), @p6='?' (Size = 4000), @p7='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SET IMPLICIT_TRANSACTIONS OFF;
SET NOCOUNT ON;
INSERT INTO [AuthLogs] ([AuthType], [CreatedAt], [DeviceId], [FailureReason], [IpAddress], [NationalId], [Status], [UserAgent])
OUTPUT INSERTED.[Id]
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7);
2025-02-02 20:17:43.377 +03:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType9`2[[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Object, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-02-02 20:17:43.379 +03:00 [INF] Executed action NayifatAPI.Controllers.AuthController.SignIn (NayifatAPI) in 266.6922ms
2025-02-02 20:17:43.380 +03:00 [INF] Executed endpoint 'NayifatAPI.Controllers.AuthController.SignIn (NayifatAPI)'
2025-02-02 20:17:43.381 +03:00 [INF] Request finished HTTP/1.1 POST http://07ca-46-152-255-232.ngrok-free.app/api/auth/signin - 200 null application/json; charset=utf-8 274.5013ms
2025-02-02 20:17:44.428 +03:00 [INF] Request starting HTTP/1.1 POST http://07ca-46-152-255-232.ngrok-free.app/api/proxy/forward?url=https://icreditdept.com/api/testasp/test_local_generate_otp.php - application/json; charset=utf-8 84
2025-02-02 20:17:44.431 +03:00 [INF] Executing endpoint 'NayifatAPI.Controllers.ProxyController.ForwardRequest (NayifatAPI)'
2025-02-02 20:17:44.432 +03:00 [INF] Route matched with {action = "ForwardRequest", controller = "Proxy"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] ForwardRequest() on controller NayifatAPI.Controllers.ProxyController (NayifatAPI).
2025-02-02 20:17:44.433 +03:00 [INF] Start processing HTTP request POST https://icreditdept.com/api/testasp/test_local_generate_otp.php
2025-02-02 20:17:44.434 +03:00 [INF] Sending HTTP request POST https://icreditdept.com/api/testasp/test_local_generate_otp.php
2025-02-02 20:17:45.728 +03:00 [INF] Received HTTP response headers after 1292.8801ms - 200
2025-02-02 20:17:45.730 +03:00 [INF] End processing HTTP request after 1296.6961ms - 200
2025-02-02 20:17:45.731 +03:00 [INF] Raw response length: 200
2025-02-02 20:17:45.733 +03:00 [INF] Response content: {"success":true,"errors":[],"result":{"nationalId":"1064448614","otp":461218,"expiryDate":"2025-02-02 20:22:46","successMsg":"Success","errCode":0,"errMsg":null},"type":"N","message":null,"code":null}
2025-02-02 20:17:45.734 +03:00 [INF] Executing ContentResult with HTTP Response ContentType of application/json
2025-02-02 20:17:45.735 +03:00 [INF] Executed action NayifatAPI.Controllers.ProxyController.ForwardRequest (NayifatAPI) in 1301.7426ms
2025-02-02 20:17:45.737 +03:00 [INF] Executed endpoint 'NayifatAPI.Controllers.ProxyController.ForwardRequest (NayifatAPI)'
2025-02-02 20:17:45.738 +03:00 [INF] Request finished HTTP/1.1 POST http://07ca-46-152-255-232.ngrok-free.app/api/proxy/forward?url=https://icreditdept.com/api/testasp/test_local_generate_otp.php - 200 200 application/json 1310.4445ms
2025-02-02 20:17:56.741 +03:00 [INF] Request starting HTTP/1.1 POST http://07ca-46-152-255-232.ngrok-free.app/api/proxy/forward?url=https://icreditdept.com/api/testasp/test_local_verify_otp.php - application/json; charset=utf-8 53
2025-02-02 20:17:56.743 +03:00 [INF] Executing endpoint 'NayifatAPI.Controllers.ProxyController.ForwardRequest (NayifatAPI)'
2025-02-02 20:17:56.744 +03:00 [INF] Route matched with {action = "ForwardRequest", controller = "Proxy"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] ForwardRequest() on controller NayifatAPI.Controllers.ProxyController (NayifatAPI).
2025-02-02 20:17:56.746 +03:00 [INF] Start processing HTTP request POST https://icreditdept.com/api/testasp/test_local_verify_otp.php
2025-02-02 20:17:56.747 +03:00 [INF] Sending HTTP request POST https://icreditdept.com/api/testasp/test_local_verify_otp.php
2025-02-02 20:17:57.160 +03:00 [INF] Received HTTP response headers after 411.7728ms - 200
2025-02-02 20:17:57.167 +03:00 [INF] End processing HTTP request after 420.8943ms - 200
2025-02-02 20:17:57.174 +03:00 [INF] Raw response length: 202
2025-02-02 20:17:57.179 +03:00 [INF] Response content: {"success":true,"errors":[],"result":{"nationalId":"1064448614","otp":"461218","verifiedFlag":true,"successMsg":"Verified successfully.","errCode":0,"errMsg":null},"type":"N","message":null,"code":null}
2025-02-02 20:17:57.185 +03:00 [INF] Executing ContentResult with HTTP Response ContentType of application/json
2025-02-02 20:17:57.187 +03:00 [INF] Executed action NayifatAPI.Controllers.ProxyController.ForwardRequest (NayifatAPI) in 440.7017ms
2025-02-02 20:17:57.188 +03:00 [INF] Executed endpoint 'NayifatAPI.Controllers.ProxyController.ForwardRequest (NayifatAPI)'
2025-02-02 20:17:57.189 +03:00 [INF] Request finished HTTP/1.1 POST http://07ca-46-152-255-232.ngrok-free.app/api/proxy/forward?url=https://icreditdept.com/api/testasp/test_local_verify_otp.php - 200 202 application/json 447.8444ms
2025-02-02 20:18:05.954 +03:00 [INF] Request starting HTTP/1.1 POST http://07ca-46-152-255-232.ngrok-free.app/api/auth/signin - application/json; charset=utf-8 78
2025-02-02 20:18:05.991 +03:00 [INF] Executing endpoint 'NayifatAPI.Controllers.AuthController.SignIn (NayifatAPI)'
2025-02-02 20:18:06.011 +03:00 [INF] Route matched with {action = "SignIn", controller = "Auth"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] SignIn(NayifatAPI.Controllers.SignInRequest) on controller NayifatAPI.Controllers.AuthController (NayifatAPI).
2025-02-02 20:18:06.089 +03:00 [INF] Executed DbCommand (6ms) [Parameters=[@__providedApiKey_0='?' (Size = 255)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [a].[Key], [a].[CreatedAt], [a].[Description], [a].[ExpiresAt], [a].[IsActive], [a].[LastUsedAt]
FROM [ApiKeys] AS [a]
WHERE [a].[Key] = @__providedApiKey_0 AND [a].[IsActive] = CAST(1 AS bit)
2025-02-02 20:18:06.104 +03:00 [INF] Executed DbCommand (6ms) [Parameters=[@__request_NationalId_0='?' (Size = 450)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [c].[NationalId], [c].[AddNo], [c].[BuildingNo], [c].[City], [c].[Consent], [c].[ConsentDate], [c].[DateOfBirth], [c].[Dependents], [c].[District], [c].[Email], [c].[Employer], [c].[FamilyNameAr], [c].[FamilyNameEn], [c].[FirstNameAr], [c].[FirstNameEn], [c].[Iban], [c].[IdExpiryDate], [c].[Los], [c].[Mpin], [c].[MpinEnabled], [c].[NafathStatus], [c].[NafathTimestamp], [c].[Password], [c].[Phone], [c].[RegistrationDate], [c].[SalaryCustomer], [c].[SalaryDakhli], [c].[SecondNameAr], [c].[SecondNameEn], [c].[Sector], [c].[Street], [c].[ThirdNameAr], [c].[ThirdNameEn], [c].[Zipcode]
FROM [Customers] AS [c]
WHERE [c].[NationalId] = @__request_NationalId_0
2025-02-02 20:18:06.107 +03:00 [INF] Starting password verification for NationalId: 1064448614
2025-02-02 20:18:06.348 +03:00 [INF] Password verification result for NationalId 1064448614: Success
2025-02-02 20:18:06.428 +03:00 [INF] Executed DbCommand (78ms) [Parameters=[@p0='?' (Size = 4000), @p1='?' (DbType = DateTime2), @p2='?' (Size = 4000), @p3='?' (Size = 4000), @p4='?' (Size = 4000), @p5='?' (Size = 450), @p6='?' (Size = 4000), @p7='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SET IMPLICIT_TRANSACTIONS OFF;
SET NOCOUNT ON;
INSERT INTO [AuthLogs] ([AuthType], [CreatedAt], [DeviceId], [FailureReason], [IpAddress], [NationalId], [Status], [UserAgent])
OUTPUT INSERTED.[Id]
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7);
2025-02-02 20:18:06.432 +03:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType9`2[[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Object, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-02-02 20:18:06.434 +03:00 [INF] Executed action NayifatAPI.Controllers.AuthController.SignIn (NayifatAPI) in 354.2125ms
2025-02-02 20:18:06.436 +03:00 [INF] Executed endpoint 'NayifatAPI.Controllers.AuthController.SignIn (NayifatAPI)'
2025-02-02 20:18:06.437 +03:00 [INF] Request finished HTTP/1.1 POST http://07ca-46-152-255-232.ngrok-free.app/api/auth/signin - 200 null application/json; charset=utf-8 483.6356ms
2025-02-02 20:18:07.270 +03:00 [INF] Request starting HTTP/1.1 POST http://07ca-46-152-255-232.ngrok-free.app/api/proxy/forward?url=https://icreditdept.com/api/testasp/test_local_generate_otp.php - application/json; charset=utf-8 84
2025-02-02 20:18:07.273 +03:00 [INF] Executing endpoint 'NayifatAPI.Controllers.ProxyController.ForwardRequest (NayifatAPI)'
2025-02-02 20:18:07.274 +03:00 [INF] Route matched with {action = "ForwardRequest", controller = "Proxy"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] ForwardRequest() on controller NayifatAPI.Controllers.ProxyController (NayifatAPI).
2025-02-02 20:18:07.279 +03:00 [INF] Start processing HTTP request POST https://icreditdept.com/api/testasp/test_local_generate_otp.php
2025-02-02 20:18:07.280 +03:00 [INF] Sending HTTP request POST https://icreditdept.com/api/testasp/test_local_generate_otp.php
2025-02-02 20:18:07.699 +03:00 [INF] Received HTTP response headers after 418.312ms - 200
2025-02-02 20:18:07.706 +03:00 [INF] End processing HTTP request after 427.0172ms - 200
2025-02-02 20:18:07.712 +03:00 [INF] Raw response length: 200
2025-02-02 20:18:07.714 +03:00 [INF] Response content: {"success":true,"errors":[],"result":{"nationalId":"1064448614","otp":253541,"expiryDate":"2025-02-02 20:23:08","successMsg":"Success","errCode":0,"errMsg":null},"type":"N","message":null,"code":null}
2025-02-02 20:18:07.717 +03:00 [INF] Executing ContentResult with HTTP Response ContentType of application/json
2025-02-02 20:18:07.719 +03:00 [INF] Executed action NayifatAPI.Controllers.ProxyController.ForwardRequest (NayifatAPI) in 440.3558ms
2025-02-02 20:18:07.721 +03:00 [INF] Executed endpoint 'NayifatAPI.Controllers.ProxyController.ForwardRequest (NayifatAPI)'
2025-02-02 20:18:07.724 +03:00 [INF] Request finished HTTP/1.1 POST http://07ca-46-152-255-232.ngrok-free.app/api/proxy/forward?url=https://icreditdept.com/api/testasp/test_local_generate_otp.php - 200 200 application/json 453.2086ms
2025-02-02 20:22:01.522 +03:00 [INF] Request starting HTTP/1.1 POST http://07ca-46-152-255-232.ngrok-free.app/api/proxy/forward?url=https://icreditdept.com/api/testasp/test_local_generate_otp.php - application/json; charset=utf-8 84
2025-02-02 20:22:01.525 +03:00 [INF] Executing endpoint 'NayifatAPI.Controllers.ProxyController.ForwardRequest (NayifatAPI)'
2025-02-02 20:22:01.526 +03:00 [INF] Route matched with {action = "ForwardRequest", controller = "Proxy"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] ForwardRequest() on controller NayifatAPI.Controllers.ProxyController (NayifatAPI).
2025-02-02 20:22:01.528 +03:00 [INF] Start processing HTTP request POST https://icreditdept.com/api/testasp/test_local_generate_otp.php
2025-02-02 20:22:01.529 +03:00 [INF] Sending HTTP request POST https://icreditdept.com/api/testasp/test_local_generate_otp.php
2025-02-02 20:22:02.189 +03:00 [INF] Received HTTP response headers after 657.597ms - 200
2025-02-02 20:22:02.191 +03:00 [INF] End processing HTTP request after 663.4579ms - 200
2025-02-02 20:22:02.194 +03:00 [INF] Raw response length: 200
2025-02-02 20:22:02.194 +03:00 [INF] Response content: {"success":true,"errors":[],"result":{"nationalId":"1064448614","otp":439499,"expiryDate":"2025-02-02 20:27:02","successMsg":"Success","errCode":0,"errMsg":null},"type":"N","message":null,"code":null}
2025-02-02 20:22:02.195 +03:00 [INF] Executing ContentResult with HTTP Response ContentType of application/json
2025-02-02 20:22:02.196 +03:00 [INF] Executed action NayifatAPI.Controllers.ProxyController.ForwardRequest (NayifatAPI) in 668.3035ms
2025-02-02 20:22:02.197 +03:00 [INF] Executed endpoint 'NayifatAPI.Controllers.ProxyController.ForwardRequest (NayifatAPI)'
2025-02-02 20:22:02.199 +03:00 [INF] Request finished HTTP/1.1 POST http://07ca-46-152-255-232.ngrok-free.app/api/proxy/forward?url=https://icreditdept.com/api/testasp/test_local_generate_otp.php - 200 200 application/json 677.7599ms
2025-02-02 20:22:10.052 +03:00 [INF] Request starting HTTP/1.1 POST http://07ca-46-152-255-232.ngrok-free.app/api/proxy/forward?url=https://icreditdept.com/api/testasp/test_local_verify_otp.php - application/json; charset=utf-8 53
2025-02-02 20:22:10.260 +03:00 [INF] Executing endpoint 'NayifatAPI.Controllers.ProxyController.ForwardRequest (NayifatAPI)'
2025-02-02 20:22:10.262 +03:00 [INF] Route matched with {action = "ForwardRequest", controller = "Proxy"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] ForwardRequest() on controller NayifatAPI.Controllers.ProxyController (NayifatAPI).
2025-02-02 20:22:10.264 +03:00 [INF] Start processing HTTP request POST https://icreditdept.com/api/testasp/test_local_verify_otp.php
2025-02-02 20:22:10.265 +03:00 [INF] Sending HTTP request POST https://icreditdept.com/api/testasp/test_local_verify_otp.php
2025-02-02 20:22:10.781 +03:00 [INF] Received HTTP response headers after 515.4689ms - 200
2025-02-02 20:22:10.784 +03:00 [INF] End processing HTTP request after 520.2482ms - 200
2025-02-02 20:22:10.785 +03:00 [INF] Raw response length: 202
2025-02-02 20:22:10.785 +03:00 [INF] Response content: {"success":true,"errors":[],"result":{"nationalId":"1064448614","otp":"439499","verifiedFlag":true,"successMsg":"Verified successfully.","errCode":0,"errMsg":null},"type":"N","message":null,"code":null}
2025-02-02 20:22:10.786 +03:00 [INF] Executing ContentResult with HTTP Response ContentType of application/json
2025-02-02 20:22:10.787 +03:00 [INF] Executed action NayifatAPI.Controllers.ProxyController.ForwardRequest (NayifatAPI) in 523.6951ms
2025-02-02 20:22:10.788 +03:00 [INF] Executed endpoint 'NayifatAPI.Controllers.ProxyController.ForwardRequest (NayifatAPI)'
2025-02-02 20:22:10.789 +03:00 [INF] Request finished HTTP/1.1 POST http://07ca-46-152-255-232.ngrok-free.app/api/proxy/forward?url=https://icreditdept.com/api/testasp/test_local_verify_otp.php - 200 202 application/json 737.1075ms
2025-02-02 20:28:10.124 +03:00 [INF] Request starting HTTP/1.1 POST http://07ca-46-152-255-232.ngrok-free.app/api/notifications/list - application/json; charset=utf-8 47
2025-02-02 20:28:10.126 +03:00 [INF] Executing endpoint 'NayifatAPI.Controllers.NotificationsController.GetNotifications (NayifatAPI)'
2025-02-02 20:28:10.127 +03:00 [INF] Route matched with {action = "GetNotifications", controller = "Notifications"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetNotifications(NayifatAPI.Controllers.GetNotificationsRequest) on controller NayifatAPI.Controllers.NotificationsController (NayifatAPI).
2025-02-02 20:28:10.138 +03:00 [INF] Executed DbCommand (2ms) [Parameters=[@__providedApiKey_0='?' (Size = 255)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [a].[Key], [a].[CreatedAt], [a].[Description], [a].[ExpiresAt], [a].[IsActive], [a].[LastUsedAt]
FROM [ApiKeys] AS [a]
WHERE [a].[Key] = @__providedApiKey_0 AND [a].[IsActive] = CAST(1 AS bit)
2025-02-02 20:28:10.143 +03:00 [INF] Executed DbCommand (2ms) [Parameters=[@__request_NationalId_0='?' (Size = 450)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [u].[national_id], [u].[last_updated], [u].[notifications]
FROM [user_notifications] AS [u]
WHERE [u].[national_id] = @__request_NationalId_0
2025-02-02 20:28:10.148 +03:00 [INF] Executed DbCommand (4ms) [Parameters=[@__Parse_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [n].[Id], [n].[additional_data], [n].[Body], [n].[body_ar], [n].[body_en], [n].[created_at], [n].[expiry_at], [n].[Route], [n].[target_criteria], [n].[Title], [n].[title_ar], [n].[title_en]
FROM [notification_templates] AS [n]
WHERE [n].[Id] = @__Parse_0
2025-02-02 20:28:10.151 +03:00 [INF] Executed DbCommand (0ms) [Parameters=[@__Parse_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [n].[Id], [n].[additional_data], [n].[Body], [n].[body_ar], [n].[body_en], [n].[created_at], [n].[expiry_at], [n].[Route], [n].[target_criteria], [n].[Title], [n].[title_ar], [n].[title_en]
FROM [notification_templates] AS [n]
WHERE [n].[Id] = @__Parse_0
2025-02-02 20:28:10.228 +03:00 [INF] Executed DbCommand (75ms) [Parameters=[@p0='?' (Size = 4000), @p1='?' (DbType = DateTime2), @p2='?' (Size = 4000), @p3='?' (Size = 4000), @p4='?' (Size = 4000), @p5='?' (Size = 450), @p6='?' (Size = 4000), @p7='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SET IMPLICIT_TRANSACTIONS OFF;
SET NOCOUNT ON;
INSERT INTO [AuthLogs] ([AuthType], [CreatedAt], [DeviceId], [FailureReason], [IpAddress], [NationalId], [Status], [UserAgent])
OUTPUT INSERTED.[Id]
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7);
2025-02-02 20:28:10.231 +03:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType9`2[[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Object, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-02-02 20:28:10.233 +03:00 [INF] Executed action NayifatAPI.Controllers.NotificationsController.GetNotifications (NayifatAPI) in 104.0409ms
2025-02-02 20:28:10.234 +03:00 [INF] Executed endpoint 'NayifatAPI.Controllers.NotificationsController.GetNotifications (NayifatAPI)'
2025-02-02 20:28:10.236 +03:00 [INF] Request finished HTTP/1.1 POST http://07ca-46-152-255-232.ngrok-free.app/api/notifications/list - 200 null application/json; charset=utf-8 112.0384ms
2025-02-02 20:28:14.902 +03:00 [INF] Request starting HTTP/1.1 POST http://07ca-46-152-255-232.ngrok-free.app/api/notifications/list - application/json; charset=utf-8 47
2025-02-02 20:28:14.905 +03:00 [INF] Executing endpoint 'NayifatAPI.Controllers.NotificationsController.GetNotifications (NayifatAPI)'
2025-02-02 20:28:14.907 +03:00 [INF] Route matched with {action = "GetNotifications", controller = "Notifications"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetNotifications(NayifatAPI.Controllers.GetNotificationsRequest) on controller NayifatAPI.Controllers.NotificationsController (NayifatAPI).
2025-02-02 20:28:14.911 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@__providedApiKey_0='?' (Size = 255)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [a].[Key], [a].[CreatedAt], [a].[Description], [a].[ExpiresAt], [a].[IsActive], [a].[LastUsedAt]
FROM [ApiKeys] AS [a]
WHERE [a].[Key] = @__providedApiKey_0 AND [a].[IsActive] = CAST(1 AS bit)
2025-02-02 20:28:14.915 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@__request_NationalId_0='?' (Size = 450)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [u].[national_id], [u].[last_updated], [u].[notifications]
FROM [user_notifications] AS [u]
WHERE [u].[national_id] = @__request_NationalId_0
2025-02-02 20:28:14.918 +03:00 [INF] Executed DbCommand (0ms) [Parameters=[@__Parse_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [n].[Id], [n].[additional_data], [n].[Body], [n].[body_ar], [n].[body_en], [n].[created_at], [n].[expiry_at], [n].[Route], [n].[target_criteria], [n].[Title], [n].[title_ar], [n].[title_en]
FROM [notification_templates] AS [n]
WHERE [n].[Id] = @__Parse_0
2025-02-02 20:28:14.921 +03:00 [INF] Executed DbCommand (0ms) [Parameters=[@__Parse_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [n].[Id], [n].[additional_data], [n].[Body], [n].[body_ar], [n].[body_en], [n].[created_at], [n].[expiry_at], [n].[Route], [n].[target_criteria], [n].[Title], [n].[title_ar], [n].[title_en]
FROM [notification_templates] AS [n]
WHERE [n].[Id] = @__Parse_0
2025-02-02 20:28:14.930 +03:00 [INF] Executed DbCommand (6ms) [Parameters=[@p0='?' (Size = 4000), @p1='?' (DbType = DateTime2), @p2='?' (Size = 4000), @p3='?' (Size = 4000), @p4='?' (Size = 4000), @p5='?' (Size = 450), @p6='?' (Size = 4000), @p7='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SET IMPLICIT_TRANSACTIONS OFF;
SET NOCOUNT ON;
INSERT INTO [AuthLogs] ([AuthType], [CreatedAt], [DeviceId], [FailureReason], [IpAddress], [NationalId], [Status], [UserAgent])
OUTPUT INSERTED.[Id]
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7);
2025-02-02 20:28:14.933 +03:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType9`2[[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Object, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-02-02 20:28:14.935 +03:00 [INF] Executed action NayifatAPI.Controllers.NotificationsController.GetNotifications (NayifatAPI) in 26.0095ms
2025-02-02 20:28:14.936 +03:00 [INF] Executed endpoint 'NayifatAPI.Controllers.NotificationsController.GetNotifications (NayifatAPI)'
2025-02-02 20:28:14.938 +03:00 [INF] Request finished HTTP/1.1 POST http://07ca-46-152-255-232.ngrok-free.app/api/notifications/list - 200 null application/json; charset=utf-8 35.8981ms
2025-02-02 20:28:23.901 +03:00 [INF] Request starting HTTP/1.1 POST http://07ca-46-152-255-232.ngrok-free.app/api/auth/signin - application/json; charset=utf-8 78
2025-02-02 20:28:23.904 +03:00 [INF] Executing endpoint 'NayifatAPI.Controllers.AuthController.SignIn (NayifatAPI)'
2025-02-02 20:28:23.907 +03:00 [INF] Route matched with {action = "SignIn", controller = "Auth"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] SignIn(NayifatAPI.Controllers.SignInRequest) on controller NayifatAPI.Controllers.AuthController (NayifatAPI).
2025-02-02 20:28:23.910 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@__providedApiKey_0='?' (Size = 255)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [a].[Key], [a].[CreatedAt], [a].[Description], [a].[ExpiresAt], [a].[IsActive], [a].[LastUsedAt]
FROM [ApiKeys] AS [a]
WHERE [a].[Key] = @__providedApiKey_0 AND [a].[IsActive] = CAST(1 AS bit)
2025-02-02 20:28:23.914 +03:00 [INF] Executed DbCommand (2ms) [Parameters=[@__request_NationalId_0='?' (Size = 450)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [c].[NationalId], [c].[AddNo], [c].[BuildingNo], [c].[City], [c].[Consent], [c].[ConsentDate], [c].[DateOfBirth], [c].[Dependents], [c].[District], [c].[Email], [c].[Employer], [c].[FamilyNameAr], [c].[FamilyNameEn], [c].[FirstNameAr], [c].[FirstNameEn], [c].[Iban], [c].[IdExpiryDate], [c].[Los], [c].[Mpin], [c].[MpinEnabled], [c].[NafathStatus], [c].[NafathTimestamp], [c].[Password], [c].[Phone], [c].[RegistrationDate], [c].[SalaryCustomer], [c].[SalaryDakhli], [c].[SecondNameAr], [c].[SecondNameEn], [c].[Sector], [c].[Street], [c].[ThirdNameAr], [c].[ThirdNameEn], [c].[Zipcode]
FROM [Customers] AS [c]
WHERE [c].[NationalId] = @__request_NationalId_0
2025-02-02 20:28:23.916 +03:00 [INF] Starting password verification for NationalId: 1064448614
2025-02-02 20:28:24.087 +03:00 [INF] Password verification result for NationalId 1064448614: Success
2025-02-02 20:28:24.095 +03:00 [INF] Executed DbCommand (6ms) [Parameters=[@p0='?' (Size = 4000), @p1='?' (DbType = DateTime2), @p2='?' (Size = 4000), @p3='?' (Size = 4000), @p4='?' (Size = 4000), @p5='?' (Size = 450), @p6='?' (Size = 4000), @p7='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SET IMPLICIT_TRANSACTIONS OFF;
SET NOCOUNT ON;
INSERT INTO [AuthLogs] ([AuthType], [CreatedAt], [DeviceId], [FailureReason], [IpAddress], [NationalId], [Status], [UserAgent])
OUTPUT INSERTED.[Id]
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7);
2025-02-02 20:28:24.098 +03:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType9`2[[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Object, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-02-02 20:28:24.100 +03:00 [INF] Executed action NayifatAPI.Controllers.AuthController.SignIn (NayifatAPI) in 191.2709ms
2025-02-02 20:28:24.101 +03:00 [INF] Executed endpoint 'NayifatAPI.Controllers.AuthController.SignIn (NayifatAPI)'
2025-02-02 20:28:24.102 +03:00 [INF] Request finished HTTP/1.1 POST http://07ca-46-152-255-232.ngrok-free.app/api/auth/signin - 200 null application/json; charset=utf-8 200.9531ms
2025-02-02 20:28:24.849 +03:00 [INF] Request starting HTTP/1.1 POST http://07ca-46-152-255-232.ngrok-free.app/api/proxy/forward?url=https://icreditdept.com/api/testasp/test_local_generate_otp.php - application/json; charset=utf-8 84
2025-02-02 20:28:24.851 +03:00 [INF] Executing endpoint 'NayifatAPI.Controllers.ProxyController.ForwardRequest (NayifatAPI)'
2025-02-02 20:28:24.854 +03:00 [INF] Route matched with {action = "ForwardRequest", controller = "Proxy"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] ForwardRequest() on controller NayifatAPI.Controllers.ProxyController (NayifatAPI).
2025-02-02 20:28:24.856 +03:00 [INF] Start processing HTTP request POST https://icreditdept.com/api/testasp/test_local_generate_otp.php
2025-02-02 20:28:24.857 +03:00 [INF] Sending HTTP request POST https://icreditdept.com/api/testasp/test_local_generate_otp.php
2025-02-02 20:28:25.743 +03:00 [INF] Received HTTP response headers after 884.2889ms - 200
2025-02-02 20:28:25.744 +03:00 [INF] End processing HTTP request after 888.1165ms - 200
2025-02-02 20:28:25.748 +03:00 [INF] Raw response length: 200
2025-02-02 20:28:25.748 +03:00 [INF] Response content: {"success":true,"errors":[],"result":{"nationalId":"1064448614","otp":264154,"expiryDate":"2025-02-02 20:33:26","successMsg":"Success","errCode":0,"errMsg":null},"type":"N","message":null,"code":null}
2025-02-02 20:28:25.749 +03:00 [INF] Executing ContentResult with HTTP Response ContentType of application/json
2025-02-02 20:28:25.750 +03:00 [INF] Executed action NayifatAPI.Controllers.ProxyController.ForwardRequest (NayifatAPI) in 894.1284ms
2025-02-02 20:28:25.751 +03:00 [INF] Executed endpoint 'NayifatAPI.Controllers.ProxyController.ForwardRequest (NayifatAPI)'
2025-02-02 20:28:25.752 +03:00 [INF] Request finished HTTP/1.1 POST http://07ca-46-152-255-232.ngrok-free.app/api/proxy/forward?url=https://icreditdept.com/api/testasp/test_local_generate_otp.php - 200 200 application/json 903.4517ms
2025-02-02 20:28:39.161 +03:00 [INF] Request starting HTTP/1.1 POST http://07ca-46-152-255-232.ngrok-free.app/api/proxy/forward?url=https://icreditdept.com/api/testasp/test_local_verify_otp.php - application/json; charset=utf-8 53
2025-02-02 20:28:39.164 +03:00 [INF] Executing endpoint 'NayifatAPI.Controllers.ProxyController.ForwardRequest (NayifatAPI)'
2025-02-02 20:28:39.165 +03:00 [INF] Route matched with {action = "ForwardRequest", controller = "Proxy"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] ForwardRequest() on controller NayifatAPI.Controllers.ProxyController (NayifatAPI).
2025-02-02 20:28:39.167 +03:00 [INF] Start processing HTTP request POST https://icreditdept.com/api/testasp/test_local_verify_otp.php
2025-02-02 20:28:39.168 +03:00 [INF] Sending HTTP request POST https://icreditdept.com/api/testasp/test_local_verify_otp.php
2025-02-02 20:28:39.600 +03:00 [INF] Received HTTP response headers after 430.0021ms - 200
2025-02-02 20:28:39.604 +03:00 [INF] End processing HTTP request after 437.4081ms - 200
2025-02-02 20:28:39.608 +03:00 [INF] Raw response length: 202
2025-02-02 20:28:39.611 +03:00 [INF] Response content: {"success":true,"errors":[],"result":{"nationalId":"1064448614","otp":"264154","verifiedFlag":true,"successMsg":"Verified successfully.","errCode":0,"errMsg":null},"type":"N","message":null,"code":null}
2025-02-02 20:28:39.614 +03:00 [INF] Executing ContentResult with HTTP Response ContentType of application/json
2025-02-02 20:28:39.615 +03:00 [INF] Executed action NayifatAPI.Controllers.ProxyController.ForwardRequest (NayifatAPI) in 448.8327ms
2025-02-02 20:28:39.619 +03:00 [INF] Executed endpoint 'NayifatAPI.Controllers.ProxyController.ForwardRequest (NayifatAPI)'
2025-02-02 20:28:39.621 +03:00 [INF] Request finished HTTP/1.1 POST http://07ca-46-152-255-232.ngrok-free.app/api/proxy/forward?url=https://icreditdept.com/api/testasp/test_local_verify_otp.php - 200 202 application/json 459.8605ms
2025-02-02 20:32:06.074 +03:00 [INF] Request starting HTTP/1.1 POST http://07ca-46-152-255-232.ngrok-free.app/api/notifications/list - application/json; charset=utf-8 47
2025-02-02 20:32:06.079 +03:00 [INF] Executing endpoint 'NayifatAPI.Controllers.NotificationsController.GetNotifications (NayifatAPI)'
2025-02-02 20:32:06.081 +03:00 [INF] Route matched with {action = "GetNotifications", controller = "Notifications"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetNotifications(NayifatAPI.Controllers.GetNotificationsRequest) on controller NayifatAPI.Controllers.NotificationsController (NayifatAPI).
2025-02-02 20:32:06.088 +03:00 [INF] Executed DbCommand (2ms) [Parameters=[@__providedApiKey_0='?' (Size = 255)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [a].[Key], [a].[CreatedAt], [a].[Description], [a].[ExpiresAt], [a].[IsActive], [a].[LastUsedAt]
FROM [ApiKeys] AS [a]
WHERE [a].[Key] = @__providedApiKey_0 AND [a].[IsActive] = CAST(1 AS bit)
2025-02-02 20:32:06.091 +03:00 [INF] Executed DbCommand (2ms) [Parameters=[@__request_NationalId_0='?' (Size = 450)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [u].[national_id], [u].[last_updated], [u].[notifications]
FROM [user_notifications] AS [u]
WHERE [u].[national_id] = @__request_NationalId_0
2025-02-02 20:32:06.094 +03:00 [INF] Executed DbCommand (2ms) [Parameters=[@__Parse_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [n].[Id], [n].[additional_data], [n].[Body], [n].[body_ar], [n].[body_en], [n].[created_at], [n].[expiry_at], [n].[Route], [n].[target_criteria], [n].[Title], [n].[title_ar], [n].[title_en]
FROM [notification_templates] AS [n]
WHERE [n].[Id] = @__Parse_0
2025-02-02 20:32:06.097 +03:00 [INF] Executed DbCommand (0ms) [Parameters=[@__Parse_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [n].[Id], [n].[additional_data], [n].[Body], [n].[body_ar], [n].[body_en], [n].[created_at], [n].[expiry_at], [n].[Route], [n].[target_criteria], [n].[Title], [n].[title_ar], [n].[title_en]
FROM [notification_templates] AS [n]
WHERE [n].[Id] = @__Parse_0
2025-02-02 20:32:06.174 +03:00 [INF] Executed DbCommand (76ms) [Parameters=[@p0='?' (Size = 4000), @p1='?' (DbType = DateTime2), @p2='?' (Size = 4000), @p3='?' (Size = 4000), @p4='?' (Size = 4000), @p5='?' (Size = 450), @p6='?' (Size = 4000), @p7='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SET IMPLICIT_TRANSACTIONS OFF;
SET NOCOUNT ON;
INSERT INTO [AuthLogs] ([AuthType], [CreatedAt], [DeviceId], [FailureReason], [IpAddress], [NationalId], [Status], [UserAgent])
OUTPUT INSERTED.[Id]
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7);
2025-02-02 20:32:06.178 +03:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType9`2[[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Object, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-02-02 20:32:06.179 +03:00 [INF] Executed action NayifatAPI.Controllers.NotificationsController.GetNotifications (NayifatAPI) in 96.024ms
2025-02-02 20:32:06.181 +03:00 [INF] Executed endpoint 'NayifatAPI.Controllers.NotificationsController.GetNotifications (NayifatAPI)'
2025-02-02 20:32:06.182 +03:00 [INF] Request finished HTTP/1.1 POST http://07ca-46-152-255-232.ngrok-free.app/api/notifications/list - 200 null application/json; charset=utf-8 108.3395ms
2025-02-02 20:32:22.368 +03:00 [INF] Request starting HTTP/1.1 POST http://07ca-46-152-255-232.ngrok-free.app/api/auth/signin - application/json; charset=utf-8 78
2025-02-02 20:32:22.380 +03:00 [INF] Executing endpoint 'NayifatAPI.Controllers.AuthController.SignIn (NayifatAPI)'
2025-02-02 20:32:22.383 +03:00 [INF] Route matched with {action = "SignIn", controller = "Auth"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] SignIn(NayifatAPI.Controllers.SignInRequest) on controller NayifatAPI.Controllers.AuthController (NayifatAPI).
2025-02-02 20:32:22.392 +03:00 [INF] Executed DbCommand (2ms) [Parameters=[@__providedApiKey_0='?' (Size = 255)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [a].[Key], [a].[CreatedAt], [a].[Description], [a].[ExpiresAt], [a].[IsActive], [a].[LastUsedAt]
FROM [ApiKeys] AS [a]
WHERE [a].[Key] = @__providedApiKey_0 AND [a].[IsActive] = CAST(1 AS bit)
2025-02-02 20:32:22.397 +03:00 [INF] Executed DbCommand (2ms) [Parameters=[@__request_NationalId_0='?' (Size = 450)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [c].[NationalId], [c].[AddNo], [c].[BuildingNo], [c].[City], [c].[Consent], [c].[ConsentDate], [c].[DateOfBirth], [c].[Dependents], [c].[District], [c].[Email], [c].[Employer], [c].[FamilyNameAr], [c].[FamilyNameEn], [c].[FirstNameAr], [c].[FirstNameEn], [c].[Iban], [c].[IdExpiryDate], [c].[Los], [c].[Mpin], [c].[MpinEnabled], [c].[NafathStatus], [c].[NafathTimestamp], [c].[Password], [c].[Phone], [c].[RegistrationDate], [c].[SalaryCustomer], [c].[SalaryDakhli], [c].[SecondNameAr], [c].[SecondNameEn], [c].[Sector], [c].[Street], [c].[ThirdNameAr], [c].[ThirdNameEn], [c].[Zipcode]
FROM [Customers] AS [c]
WHERE [c].[NationalId] = @__request_NationalId_0
2025-02-02 20:32:22.400 +03:00 [INF] Starting password verification for NationalId: 1064448614
2025-02-02 20:32:22.564 +03:00 [INF] Password verification result for NationalId 1064448614: Success
2025-02-02 20:32:22.593 +03:00 [INF] Executed DbCommand (8ms) [Parameters=[@p0='?' (Size = 4000), @p1='?' (DbType = DateTime2), @p2='?' (Size = 4000), @p3='?' (Size = 4000), @p4='?' (Size = 4000), @p5='?' (Size = 450), @p6='?' (Size = 4000), @p7='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SET IMPLICIT_TRANSACTIONS OFF;
SET NOCOUNT ON;
INSERT INTO [AuthLogs] ([AuthType], [CreatedAt], [DeviceId], [FailureReason], [IpAddress], [NationalId], [Status], [UserAgent])
OUTPUT INSERTED.[Id]
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7);
2025-02-02 20:32:22.595 +03:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType9`2[[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Object, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-02-02 20:32:22.596 +03:00 [INF] Executed action NayifatAPI.Controllers.AuthController.SignIn (NayifatAPI) in 209.2108ms
2025-02-02 20:32:22.597 +03:00 [INF] Executed endpoint 'NayifatAPI.Controllers.AuthController.SignIn (NayifatAPI)'
2025-02-02 20:32:22.598 +03:00 [INF] Request finished HTTP/1.1 POST http://07ca-46-152-255-232.ngrok-free.app/api/auth/signin - 200 null application/json; charset=utf-8 230.3045ms
2025-02-02 20:32:23.613 +03:00 [INF] Request starting HTTP/1.1 POST http://07ca-46-152-255-232.ngrok-free.app/api/proxy/forward?url=https://icreditdept.com/api/testasp/test_local_generate_otp.php - application/json; charset=utf-8 84
2025-02-02 20:32:23.623 +03:00 [INF] Executing endpoint 'NayifatAPI.Controllers.ProxyController.ForwardRequest (NayifatAPI)'
2025-02-02 20:32:23.623 +03:00 [INF] Route matched with {action = "ForwardRequest", controller = "Proxy"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] ForwardRequest() on controller NayifatAPI.Controllers.ProxyController (NayifatAPI).
2025-02-02 20:32:23.625 +03:00 [INF] Start processing HTTP request POST https://icreditdept.com/api/testasp/test_local_generate_otp.php
2025-02-02 20:32:23.627 +03:00 [INF] Sending HTTP request POST https://icreditdept.com/api/testasp/test_local_generate_otp.php
2025-02-02 20:32:24.911 +03:00 [INF] Received HTTP response headers after 1282.7163ms - 200
2025-02-02 20:32:24.925 +03:00 [INF] End processing HTTP request after 1299.298ms - 200
2025-02-02 20:32:24.942 +03:00 [INF] Raw response length: 200
2025-02-02 20:32:24.954 +03:00 [INF] Response content: {"success":true,"errors":[],"result":{"nationalId":"1064448614","otp":838076,"expiryDate":"2025-02-02 20:37:25","successMsg":"Success","errCode":0,"errMsg":null},"type":"N","message":null,"code":null}
2025-02-02 20:32:24.978 +03:00 [INF] Executing ContentResult with HTTP Response ContentType of application/json
2025-02-02 20:32:24.996 +03:00 [INF] Executed action NayifatAPI.Controllers.ProxyController.ForwardRequest (NayifatAPI) in 1371.2304ms
2025-02-02 20:32:25.011 +03:00 [INF] Executed endpoint 'NayifatAPI.Controllers.ProxyController.ForwardRequest (NayifatAPI)'
2025-02-02 20:32:25.019 +03:00 [INF] Request finished HTTP/1.1 POST http://07ca-46-152-255-232.ngrok-free.app/api/proxy/forward?url=https://icreditdept.com/api/testasp/test_local_generate_otp.php - 200 200 application/json 1405.7643ms
2025-02-02 20:32:32.361 +03:00 [INF] Request starting HTTP/1.1 POST http://07ca-46-152-255-232.ngrok-free.app/api/proxy/forward?url=https://icreditdept.com/api/testasp/test_local_verify_otp.php - application/json; charset=utf-8 53
2025-02-02 20:32:32.363 +03:00 [INF] Executing endpoint 'NayifatAPI.Controllers.ProxyController.ForwardRequest (NayifatAPI)'
2025-02-02 20:32:32.364 +03:00 [INF] Route matched with {action = "ForwardRequest", controller = "Proxy"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] ForwardRequest() on controller NayifatAPI.Controllers.ProxyController (NayifatAPI).
2025-02-02 20:32:32.366 +03:00 [INF] Start processing HTTP request POST https://icreditdept.com/api/testasp/test_local_verify_otp.php
2025-02-02 20:32:32.367 +03:00 [INF] Sending HTTP request POST https://icreditdept.com/api/testasp/test_local_verify_otp.php
2025-02-02 20:32:32.792 +03:00 [INF] Received HTTP response headers after 424.5462ms - 200
2025-02-02 20:32:32.794 +03:00 [INF] End processing HTTP request after 427.4783ms - 200
2025-02-02 20:32:32.796 +03:00 [INF] Raw response length: 202
2025-02-02 20:32:32.797 +03:00 [INF] Response content: {"success":true,"errors":[],"result":{"nationalId":"1064448614","otp":"838076","verifiedFlag":true,"successMsg":"Verified successfully.","errCode":0,"errMsg":null},"type":"N","message":null,"code":null}
2025-02-02 20:32:32.799 +03:00 [INF] Executing ContentResult with HTTP Response ContentType of application/json
2025-02-02 20:32:32.800 +03:00 [INF] Executed action NayifatAPI.Controllers.ProxyController.ForwardRequest (NayifatAPI) in 434.2956ms
2025-02-02 20:32:32.804 +03:00 [INF] Executed endpoint 'NayifatAPI.Controllers.ProxyController.ForwardRequest (NayifatAPI)'
2025-02-02 20:32:32.806 +03:00 [INF] Request finished HTTP/1.1 POST http://07ca-46-152-255-232.ngrok-free.app/api/proxy/forward?url=https://icreditdept.com/api/testasp/test_local_verify_otp.php - 200 202 application/json 444.987ms
2025-02-02 20:35:11.606 +03:00 [INF] Request starting HTTP/1.1 POST http://07ca-46-152-255-232.ngrok-free.app/api/notifications/list - application/json; charset=utf-8 47
2025-02-02 20:35:11.610 +03:00 [INF] Executing endpoint 'NayifatAPI.Controllers.NotificationsController.GetNotifications (NayifatAPI)'
2025-02-02 20:35:11.612 +03:00 [INF] Route matched with {action = "GetNotifications", controller = "Notifications"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetNotifications(NayifatAPI.Controllers.GetNotificationsRequest) on controller NayifatAPI.Controllers.NotificationsController (NayifatAPI).
2025-02-02 20:35:11.620 +03:00 [INF] Executed DbCommand (4ms) [Parameters=[@__providedApiKey_0='?' (Size = 255)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [a].[Key], [a].[CreatedAt], [a].[Description], [a].[ExpiresAt], [a].[IsActive], [a].[LastUsedAt]
FROM [ApiKeys] AS [a]
WHERE [a].[Key] = @__providedApiKey_0 AND [a].[IsActive] = CAST(1 AS bit)
2025-02-02 20:35:11.626 +03:00 [INF] Executed DbCommand (2ms) [Parameters=[@__request_NationalId_0='?' (Size = 450)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [u].[national_id], [u].[last_updated], [u].[notifications]
FROM [user_notifications] AS [u]
WHERE [u].[national_id] = @__request_NationalId_0
2025-02-02 20:35:11.630 +03:00 [INF] Executed DbCommand (2ms) [Parameters=[@__Parse_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [n].[Id], [n].[additional_data], [n].[Body], [n].[body_ar], [n].[body_en], [n].[created_at], [n].[expiry_at], [n].[Route], [n].[target_criteria], [n].[Title], [n].[title_ar], [n].[title_en]
FROM [notification_templates] AS [n]
WHERE [n].[Id] = @__Parse_0
2025-02-02 20:35:11.634 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@__Parse_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [n].[Id], [n].[additional_data], [n].[Body], [n].[body_ar], [n].[body_en], [n].[created_at], [n].[expiry_at], [n].[Route], [n].[target_criteria], [n].[Title], [n].[title_ar], [n].[title_en]
FROM [notification_templates] AS [n]
WHERE [n].[Id] = @__Parse_0
2025-02-02 20:35:11.711 +03:00 [INF] Executed DbCommand (75ms) [Parameters=[@p0='?' (Size = 4000), @p1='?' (DbType = DateTime2), @p2='?' (Size = 4000), @p3='?' (Size = 4000), @p4='?' (Size = 4000), @p5='?' (Size = 450), @p6='?' (Size = 4000), @p7='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SET IMPLICIT_TRANSACTIONS OFF;
SET NOCOUNT ON;
INSERT INTO [AuthLogs] ([AuthType], [CreatedAt], [DeviceId], [FailureReason], [IpAddress], [NationalId], [Status], [UserAgent])
OUTPUT INSERTED.[Id]
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7);
2025-02-02 20:35:11.713 +03:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType9`2[[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Object, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-02-02 20:35:11.714 +03:00 [INF] Executed action NayifatAPI.Controllers.NotificationsController.GetNotifications (NayifatAPI) in 100.5731ms
2025-02-02 20:35:11.716 +03:00 [INF] Executed endpoint 'NayifatAPI.Controllers.NotificationsController.GetNotifications (NayifatAPI)'
2025-02-02 20:35:11.717 +03:00 [INF] Request finished HTTP/1.1 POST http://07ca-46-152-255-232.ngrok-free.app/api/notifications/list - 200 null application/json; charset=utf-8 110.96ms
2025-02-02 20:36:18.380 +03:00 [INF] Request starting HTTP/1.1 POST http://07ca-46-152-255-232.ngrok-free.app/api/auth/signin - application/json; charset=utf-8 78
2025-02-02 20:36:18.383 +03:00 [INF] Executing endpoint 'NayifatAPI.Controllers.AuthController.SignIn (NayifatAPI)'
2025-02-02 20:36:18.384 +03:00 [INF] Route matched with {action = "SignIn", controller = "Auth"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] SignIn(NayifatAPI.Controllers.SignInRequest) on controller NayifatAPI.Controllers.AuthController (NayifatAPI).
2025-02-02 20:36:18.392 +03:00 [INF] Executed DbCommand (3ms) [Parameters=[@__providedApiKey_0='?' (Size = 255)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [a].[Key], [a].[CreatedAt], [a].[Description], [a].[ExpiresAt], [a].[IsActive], [a].[LastUsedAt]
FROM [ApiKeys] AS [a]
WHERE [a].[Key] = @__providedApiKey_0 AND [a].[IsActive] = CAST(1 AS bit)
2025-02-02 20:36:18.402 +03:00 [INF] Executed DbCommand (5ms) [Parameters=[@__request_NationalId_0='?' (Size = 450)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [c].[NationalId], [c].[AddNo], [c].[BuildingNo], [c].[City], [c].[Consent], [c].[ConsentDate], [c].[DateOfBirth], [c].[Dependents], [c].[District], [c].[Email], [c].[Employer], [c].[FamilyNameAr], [c].[FamilyNameEn], [c].[FirstNameAr], [c].[FirstNameEn], [c].[Iban], [c].[IdExpiryDate], [c].[Los], [c].[Mpin], [c].[MpinEnabled], [c].[NafathStatus], [c].[NafathTimestamp], [c].[Password], [c].[Phone], [c].[RegistrationDate], [c].[SalaryCustomer], [c].[SalaryDakhli], [c].[SecondNameAr], [c].[SecondNameEn], [c].[Sector], [c].[Street], [c].[ThirdNameAr], [c].[ThirdNameEn], [c].[Zipcode]
FROM [Customers] AS [c]
WHERE [c].[NationalId] = @__request_NationalId_0
2025-02-02 20:36:18.405 +03:00 [INF] Starting password verification for NationalId: 1064448614
2025-02-02 20:36:18.581 +03:00 [INF] Password verification result for NationalId 1064448614: Success
2025-02-02 20:36:18.659 +03:00 [INF] Executed DbCommand (76ms) [Parameters=[@p0='?' (Size = 4000), @p1='?' (DbType = DateTime2), @p2='?' (Size = 4000), @p3='?' (Size = 4000), @p4='?' (Size = 4000), @p5='?' (Size = 450), @p6='?' (Size = 4000), @p7='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SET IMPLICIT_TRANSACTIONS OFF;
SET NOCOUNT ON;
INSERT INTO [AuthLogs] ([AuthType], [CreatedAt], [DeviceId], [FailureReason], [IpAddress], [NationalId], [Status], [UserAgent])
OUTPUT INSERTED.[Id]
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7);
2025-02-02 20:36:18.662 +03:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType9`2[[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Object, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-02-02 20:36:18.663 +03:00 [INF] Executed action NayifatAPI.Controllers.AuthController.SignIn (NayifatAPI) in 276.766ms
2025-02-02 20:36:18.665 +03:00 [INF] Executed endpoint 'NayifatAPI.Controllers.AuthController.SignIn (NayifatAPI)'
2025-02-02 20:36:18.667 +03:00 [INF] Request finished HTTP/1.1 POST http://07ca-46-152-255-232.ngrok-free.app/api/auth/signin - 200 null application/json; charset=utf-8 286.339ms
2025-02-02 20:36:19.434 +03:00 [INF] Request starting HTTP/1.1 POST http://07ca-46-152-255-232.ngrok-free.app/api/proxy/forward?url=https://icreditdept.com/api/testasp/test_local_generate_otp.php - application/json; charset=utf-8 84
2025-02-02 20:36:19.438 +03:00 [INF] Executing endpoint 'NayifatAPI.Controllers.ProxyController.ForwardRequest (NayifatAPI)'
2025-02-02 20:36:19.439 +03:00 [INF] Route matched with {action = "ForwardRequest", controller = "Proxy"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] ForwardRequest() on controller NayifatAPI.Controllers.ProxyController (NayifatAPI).
2025-02-02 20:36:19.440 +03:00 [INF] Start processing HTTP request POST https://icreditdept.com/api/testasp/test_local_generate_otp.php
2025-02-02 20:36:19.442 +03:00 [INF] Sending HTTP request POST https://icreditdept.com/api/testasp/test_local_generate_otp.php
2025-02-02 20:36:20.217 +03:00 [INF] Received HTTP response headers after 773.341ms - 200
2025-02-02 20:36:20.218 +03:00 [INF] End processing HTTP request after 777.8038ms - 200
2025-02-02 20:36:20.219 +03:00 [INF] Raw response length: 200
2025-02-02 20:36:20.219 +03:00 [INF] Response content: {"success":true,"errors":[],"result":{"nationalId":"1064448614","otp":448931,"expiryDate":"2025-02-02 20:41:20","successMsg":"Success","errCode":0,"errMsg":null},"type":"N","message":null,"code":null}
2025-02-02 20:36:20.220 +03:00 [INF] Executing ContentResult with HTTP Response ContentType of application/json
2025-02-02 20:36:20.221 +03:00 [INF] Executed action NayifatAPI.Controllers.ProxyController.ForwardRequest (NayifatAPI) in 781.1019ms
2025-02-02 20:36:20.222 +03:00 [INF] Executed endpoint 'NayifatAPI.Controllers.ProxyController.ForwardRequest (NayifatAPI)'
2025-02-02 20:36:20.223 +03:00 [INF] Request finished HTTP/1.1 POST http://07ca-46-152-255-232.ngrok-free.app/api/proxy/forward?url=https://icreditdept.com/api/testasp/test_local_generate_otp.php - 200 200 application/json 789.0976ms
2025-02-02 20:36:27.821 +03:00 [INF] Request starting HTTP/1.1 POST http://07ca-46-152-255-232.ngrok-free.app/api/proxy/forward?url=https://icreditdept.com/api/testasp/test_local_verify_otp.php - application/json; charset=utf-8 53
2025-02-02 20:36:27.824 +03:00 [INF] Executing endpoint 'NayifatAPI.Controllers.ProxyController.ForwardRequest (NayifatAPI)'
2025-02-02 20:36:27.825 +03:00 [INF] Route matched with {action = "ForwardRequest", controller = "Proxy"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] ForwardRequest() on controller NayifatAPI.Controllers.ProxyController (NayifatAPI).
2025-02-02 20:36:27.827 +03:00 [INF] Start processing HTTP request POST https://icreditdept.com/api/testasp/test_local_verify_otp.php
2025-02-02 20:36:27.828 +03:00 [INF] Sending HTTP request POST https://icreditdept.com/api/testasp/test_local_verify_otp.php
2025-02-02 20:36:28.261 +03:00 [INF] Received HTTP response headers after 432.1539ms - 200
2025-02-02 20:36:28.262 +03:00 [INF] End processing HTTP request after 434.9506ms - 200
2025-02-02 20:36:28.263 +03:00 [INF] Raw response length: 202
2025-02-02 20:36:28.264 +03:00 [INF] Response content: {"success":true,"errors":[],"result":{"nationalId":"1064448614","otp":"448931","verifiedFlag":true,"successMsg":"Verified successfully.","errCode":0,"errMsg":null},"type":"N","message":null,"code":null}
2025-02-02 20:36:28.265 +03:00 [INF] Executing ContentResult with HTTP Response ContentType of application/json
2025-02-02 20:36:28.266 +03:00 [INF] Executed action NayifatAPI.Controllers.ProxyController.ForwardRequest (NayifatAPI) in 439.4405ms
2025-02-02 20:36:28.269 +03:00 [INF] Executed endpoint 'NayifatAPI.Controllers.ProxyController.ForwardRequest (NayifatAPI)'
2025-02-02 20:36:28.270 +03:00 [INF] Request finished HTTP/1.1 POST http://07ca-46-152-255-232.ngrok-free.app/api/proxy/forward?url=https://icreditdept.com/api/testasp/test_local_verify_otp.php - 200 202 application/json 449.2852ms
2025-02-02 20:51:53.085 +03:00 [INF] Request starting HTTP/1.1 POST http://07ca-46-152-255-232.ngrok-free.app/api/notifications/list - application/json; charset=utf-8 47
2025-02-02 20:51:53.088 +03:00 [INF] Executing endpoint 'NayifatAPI.Controllers.NotificationsController.GetNotifications (NayifatAPI)'
2025-02-02 20:51:53.089 +03:00 [INF] Route matched with {action = "GetNotifications", controller = "Notifications"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetNotifications(NayifatAPI.Controllers.GetNotificationsRequest) on controller NayifatAPI.Controllers.NotificationsController (NayifatAPI).
2025-02-02 20:51:53.098 +03:00 [INF] Executed DbCommand (2ms) [Parameters=[@__providedApiKey_0='?' (Size = 255)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [a].[Key], [a].[CreatedAt], [a].[Description], [a].[ExpiresAt], [a].[IsActive], [a].[LastUsedAt]
FROM [ApiKeys] AS [a]
WHERE [a].[Key] = @__providedApiKey_0 AND [a].[IsActive] = CAST(1 AS bit)
2025-02-02 20:51:53.102 +03:00 [INF] Executed DbCommand (2ms) [Parameters=[@__request_NationalId_0='?' (Size = 450)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [u].[national_id], [u].[last_updated], [u].[notifications]
FROM [user_notifications] AS [u]
WHERE [u].[national_id] = @__request_NationalId_0
2025-02-02 20:51:53.108 +03:00 [INF] Executed DbCommand (3ms) [Parameters=[@__Parse_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [n].[Id], [n].[additional_data], [n].[Body], [n].[body_ar], [n].[body_en], [n].[created_at], [n].[expiry_at], [n].[Route], [n].[target_criteria], [n].[Title], [n].[title_ar], [n].[title_en]
FROM [notification_templates] AS [n]
WHERE [n].[Id] = @__Parse_0
2025-02-02 20:51:53.112 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@__Parse_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [n].[Id], [n].[additional_data], [n].[Body], [n].[body_ar], [n].[body_en], [n].[created_at], [n].[expiry_at], [n].[Route], [n].[target_criteria], [n].[Title], [n].[title_ar], [n].[title_en]
FROM [notification_templates] AS [n]
WHERE [n].[Id] = @__Parse_0
2025-02-02 20:51:53.191 +03:00 [INF] Executed DbCommand (76ms) [Parameters=[@p0='?' (Size = 4000), @p1='?' (DbType = DateTime2), @p2='?' (Size = 4000), @p3='?' (Size = 4000), @p4='?' (Size = 4000), @p5='?' (Size = 450), @p6='?' (Size = 4000), @p7='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SET IMPLICIT_TRANSACTIONS OFF;
SET NOCOUNT ON;
INSERT INTO [AuthLogs] ([AuthType], [CreatedAt], [DeviceId], [FailureReason], [IpAddress], [NationalId], [Status], [UserAgent])
OUTPUT INSERTED.[Id]
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7);
2025-02-02 20:51:53.194 +03:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType9`2[[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Object, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-02-02 20:51:53.196 +03:00 [INF] Executed action NayifatAPI.Controllers.NotificationsController.GetNotifications (NayifatAPI) in 105.6643ms
2025-02-02 20:51:53.197 +03:00 [INF] Executed endpoint 'NayifatAPI.Controllers.NotificationsController.GetNotifications (NayifatAPI)'
2025-02-02 20:51:53.198 +03:00 [INF] Request finished HTTP/1.1 POST http://07ca-46-152-255-232.ngrok-free.app/api/notifications/list - 200 null application/json; charset=utf-8 113.0981ms
2025-02-02 20:52:07.333 +03:00 [INF] Request starting HTTP/1.1 POST http://07ca-46-152-255-232.ngrok-free.app/api/auth/signin - application/json; charset=utf-8 78
2025-02-02 20:52:07.337 +03:00 [INF] Executing endpoint 'NayifatAPI.Controllers.AuthController.SignIn (NayifatAPI)'
2025-02-02 20:52:07.340 +03:00 [INF] Route matched with {action = "SignIn", controller = "Auth"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] SignIn(NayifatAPI.Controllers.SignInRequest) on controller NayifatAPI.Controllers.AuthController (NayifatAPI).
2025-02-02 20:52:07.346 +03:00 [INF] Executed DbCommand (2ms) [Parameters=[@__providedApiKey_0='?' (Size = 255)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [a].[Key], [a].[CreatedAt], [a].[Description], [a].[ExpiresAt], [a].[IsActive], [a].[LastUsedAt]
FROM [ApiKeys] AS [a]
WHERE [a].[Key] = @__providedApiKey_0 AND [a].[IsActive] = CAST(1 AS bit)
2025-02-02 20:52:07.352 +03:00 [INF] Executed DbCommand (3ms) [Parameters=[@__request_NationalId_0='?' (Size = 450)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [c].[NationalId], [c].[AddNo], [c].[BuildingNo], [c].[City], [c].[Consent], [c].[ConsentDate], [c].[DateOfBirth], [c].[Dependents], [c].[District], [c].[Email], [c].[Employer], [c].[FamilyNameAr], [c].[FamilyNameEn], [c].[FirstNameAr], [c].[FirstNameEn], [c].[Iban], [c].[IdExpiryDate], [c].[Los], [c].[Mpin], [c].[MpinEnabled], [c].[NafathStatus], [c].[NafathTimestamp], [c].[Password], [c].[Phone], [c].[RegistrationDate], [c].[SalaryCustomer], [c].[SalaryDakhli], [c].[SecondNameAr], [c].[SecondNameEn], [c].[Sector], [c].[Street], [c].[ThirdNameAr], [c].[ThirdNameEn], [c].[Zipcode]
FROM [Customers] AS [c]
WHERE [c].[NationalId] = @__request_NationalId_0
2025-02-02 20:52:07.356 +03:00 [INF] Starting password verification for NationalId: 1064448614
2025-02-02 20:52:07.527 +03:00 [INF] Password verification result for NationalId 1064448614: Success
2025-02-02 20:52:07.604 +03:00 [INF] Executed DbCommand (75ms) [Parameters=[@p0='?' (Size = 4000), @p1='?' (DbType = DateTime2), @p2='?' (Size = 4000), @p3='?' (Size = 4000), @p4='?' (Size = 4000), @p5='?' (Size = 450), @p6='?' (Size = 4000), @p7='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SET IMPLICIT_TRANSACTIONS OFF;
SET NOCOUNT ON;
INSERT INTO [AuthLogs] ([AuthType], [CreatedAt], [DeviceId], [FailureReason], [IpAddress], [NationalId], [Status], [UserAgent])
OUTPUT INSERTED.[Id]
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7);
2025-02-02 20:52:07.609 +03:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType9`2[[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Object, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-02-02 20:52:07.610 +03:00 [INF] Executed action NayifatAPI.Controllers.AuthController.SignIn (NayifatAPI) in 267.539ms
2025-02-02 20:52:07.611 +03:00 [INF] Executed endpoint 'NayifatAPI.Controllers.AuthController.SignIn (NayifatAPI)'
2025-02-02 20:52:07.613 +03:00 [INF] Request finished HTTP/1.1 POST http://07ca-46-152-255-232.ngrok-free.app/api/auth/signin - 200 null application/json; charset=utf-8 279.3403ms
2025-02-02 20:52:08.322 +03:00 [INF] Request starting HTTP/1.1 POST http://07ca-46-152-255-232.ngrok-free.app/api/proxy/forward?url=https://icreditdept.com/api/testasp/test_local_generate_otp.php - application/json; charset=utf-8 84
2025-02-02 20:52:08.327 +03:00 [INF] Executing endpoint 'NayifatAPI.Controllers.ProxyController.ForwardRequest (NayifatAPI)'
2025-02-02 20:52:08.329 +03:00 [INF] Route matched with {action = "ForwardRequest", controller = "Proxy"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] ForwardRequest() on controller NayifatAPI.Controllers.ProxyController (NayifatAPI).
2025-02-02 20:52:08.333 +03:00 [INF] Start processing HTTP request POST https://icreditdept.com/api/testasp/test_local_generate_otp.php
2025-02-02 20:52:08.335 +03:00 [INF] Sending HTTP request POST https://icreditdept.com/api/testasp/test_local_generate_otp.php
2025-02-02 20:52:09.190 +03:00 [INF] Received HTTP response headers after 852.9131ms - 200
2025-02-02 20:52:09.194 +03:00 [INF] End processing HTTP request after 861.2262ms - 200
2025-02-02 20:52:09.199 +03:00 [INF] Raw response length: 200
2025-02-02 20:52:09.200 +03:00 [INF] Response content: {"success":true,"errors":[],"result":{"nationalId":"1064448614","otp":643524,"expiryDate":"2025-02-02 20:57:09","successMsg":"Success","errCode":0,"errMsg":null},"type":"N","message":null,"code":null}
2025-02-02 20:52:09.202 +03:00 [INF] Executing ContentResult with HTTP Response ContentType of application/json
2025-02-02 20:52:09.204 +03:00 [INF] Executed action NayifatAPI.Controllers.ProxyController.ForwardRequest (NayifatAPI) in 871.7144ms
2025-02-02 20:52:09.205 +03:00 [INF] Executed endpoint 'NayifatAPI.Controllers.ProxyController.ForwardRequest (NayifatAPI)'
2025-02-02 20:52:09.206 +03:00 [INF] Request finished HTTP/1.1 POST http://07ca-46-152-255-232.ngrok-free.app/api/proxy/forward?url=https://icreditdept.com/api/testasp/test_local_generate_otp.php - 200 200 application/json 884.7598ms
2025-02-02 20:52:18.957 +03:00 [INF] Request starting HTTP/1.1 POST http://07ca-46-152-255-232.ngrok-free.app/api/proxy/forward?url=https://icreditdept.com/api/testasp/test_local_verify_otp.php - application/json; charset=utf-8 53
2025-02-02 20:52:18.961 +03:00 [INF] Executing endpoint 'NayifatAPI.Controllers.ProxyController.ForwardRequest (NayifatAPI)'
2025-02-02 20:52:18.962 +03:00 [INF] Route matched with {action = "ForwardRequest", controller = "Proxy"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] ForwardRequest() on controller NayifatAPI.Controllers.ProxyController (NayifatAPI).
2025-02-02 20:52:18.964 +03:00 [INF] Start processing HTTP request POST https://icreditdept.com/api/testasp/test_local_verify_otp.php
2025-02-02 20:52:18.965 +03:00 [INF] Sending HTTP request POST https://icreditdept.com/api/testasp/test_local_verify_otp.php
2025-02-02 20:52:19.398 +03:00 [INF] Received HTTP response headers after 432.4005ms - 200
2025-02-02 20:52:19.399 +03:00 [INF] End processing HTTP request after 435.4931ms - 200
2025-02-02 20:52:19.401 +03:00 [INF] Raw response length: 202
2025-02-02 20:52:19.402 +03:00 [INF] Response content: {"success":true,"errors":[],"result":{"nationalId":"1064448614","otp":"643524","verifiedFlag":true,"successMsg":"Verified successfully.","errCode":0,"errMsg":null},"type":"N","message":null,"code":null}
2025-02-02 20:52:19.403 +03:00 [INF] Executing ContentResult with HTTP Response ContentType of application/json
2025-02-02 20:52:19.404 +03:00 [INF] Executed action NayifatAPI.Controllers.ProxyController.ForwardRequest (NayifatAPI) in 440.7198ms
2025-02-02 20:52:19.406 +03:00 [INF] Executed endpoint 'NayifatAPI.Controllers.ProxyController.ForwardRequest (NayifatAPI)'
2025-02-02 20:52:19.407 +03:00 [INF] Request finished HTTP/1.1 POST http://07ca-46-152-255-232.ngrok-free.app/api/proxy/forward?url=https://icreditdept.com/api/testasp/test_local_verify_otp.php - 200 202 application/json 450.712ms
2025-02-02 20:56:54.369 +03:00 [INF] Request starting HTTP/1.1 POST http://07ca-46-152-255-232.ngrok-free.app/api/notifications/list - application/json; charset=utf-8 47
2025-02-02 20:56:54.379 +03:00 [INF] Executing endpoint 'NayifatAPI.Controllers.NotificationsController.GetNotifications (NayifatAPI)'
2025-02-02 20:56:54.383 +03:00 [INF] Route matched with {action = "GetNotifications", controller = "Notifications"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetNotifications(NayifatAPI.Controllers.GetNotificationsRequest) on controller NayifatAPI.Controllers.NotificationsController (NayifatAPI).
2025-02-02 20:56:54.389 +03:00 [INF] Executed DbCommand (2ms) [Parameters=[@__providedApiKey_0='?' (Size = 255)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [a].[Key], [a].[CreatedAt], [a].[Description], [a].[ExpiresAt], [a].[IsActive], [a].[LastUsedAt]
FROM [ApiKeys] AS [a]
WHERE [a].[Key] = @__providedApiKey_0 AND [a].[IsActive] = CAST(1 AS bit)
2025-02-02 20:56:54.393 +03:00 [INF] Executed DbCommand (2ms) [Parameters=[@__request_NationalId_0='?' (Size = 450)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [u].[national_id], [u].[last_updated], [u].[notifications]
FROM [user_notifications] AS [u]
WHERE [u].[national_id] = @__request_NationalId_0
2025-02-02 20:56:54.400 +03:00 [INF] Executed DbCommand (2ms) [Parameters=[@__Parse_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [n].[Id], [n].[additional_data], [n].[Body], [n].[body_ar], [n].[body_en], [n].[created_at], [n].[expiry_at], [n].[Route], [n].[target_criteria], [n].[Title], [n].[title_ar], [n].[title_en]
FROM [notification_templates] AS [n]
WHERE [n].[Id] = @__Parse_0
2025-02-02 20:56:54.404 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@__Parse_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [n].[Id], [n].[additional_data], [n].[Body], [n].[body_ar], [n].[body_en], [n].[created_at], [n].[expiry_at], [n].[Route], [n].[target_criteria], [n].[Title], [n].[title_ar], [n].[title_en]
FROM [notification_templates] AS [n]
WHERE [n].[Id] = @__Parse_0
2025-02-02 20:56:54.483 +03:00 [INF] Executed DbCommand (77ms) [Parameters=[@p0='?' (Size = 4000), @p1='?' (DbType = DateTime2), @p2='?' (Size = 4000), @p3='?' (Size = 4000), @p4='?' (Size = 4000), @p5='?' (Size = 450), @p6='?' (Size = 4000), @p7='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SET IMPLICIT_TRANSACTIONS OFF;
SET NOCOUNT ON;
INSERT INTO [AuthLogs] ([AuthType], [CreatedAt], [DeviceId], [FailureReason], [IpAddress], [NationalId], [Status], [UserAgent])
OUTPUT INSERTED.[Id]
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7);
2025-02-02 20:56:54.496 +03:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType9`2[[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Object, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-02-02 20:56:54.499 +03:00 [INF] Executed action NayifatAPI.Controllers.NotificationsController.GetNotifications (NayifatAPI) in 113.9769ms
2025-02-02 20:56:54.501 +03:00 [INF] Executed endpoint 'NayifatAPI.Controllers.NotificationsController.GetNotifications (NayifatAPI)'
2025-02-02 20:56:54.503 +03:00 [INF] Request finished HTTP/1.1 POST http://07ca-46-152-255-232.ngrok-free.app/api/notifications/list - 200 null application/json; charset=utf-8 134.0239ms
2025-02-02 21:01:54.287 +03:00 [INF] Request starting HTTP/1.1 POST http://07ca-46-152-255-232.ngrok-free.app/api/notifications/list - application/json; charset=utf-8 47
2025-02-02 21:01:54.290 +03:00 [INF] Executing endpoint 'NayifatAPI.Controllers.NotificationsController.GetNotifications (NayifatAPI)'
2025-02-02 21:01:54.290 +03:00 [INF] Route matched with {action = "GetNotifications", controller = "Notifications"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetNotifications(NayifatAPI.Controllers.GetNotificationsRequest) on controller NayifatAPI.Controllers.NotificationsController (NayifatAPI).
2025-02-02 21:01:54.372 +03:00 [INF] Executed DbCommand (76ms) [Parameters=[@__providedApiKey_0='?' (Size = 255)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [a].[Key], [a].[CreatedAt], [a].[Description], [a].[ExpiresAt], [a].[IsActive], [a].[LastUsedAt]
FROM [ApiKeys] AS [a]
WHERE [a].[Key] = @__providedApiKey_0 AND [a].[IsActive] = CAST(1 AS bit)
2025-02-02 21:01:54.380 +03:00 [INF] Executed DbCommand (3ms) [Parameters=[@__request_NationalId_0='?' (Size = 450)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [u].[national_id], [u].[last_updated], [u].[notifications]
FROM [user_notifications] AS [u]
WHERE [u].[national_id] = @__request_NationalId_0
2025-02-02 21:01:54.387 +03:00 [INF] Executed DbCommand (3ms) [Parameters=[@__Parse_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [n].[Id], [n].[additional_data], [n].[Body], [n].[body_ar], [n].[body_en], [n].[created_at], [n].[expiry_at], [n].[Route], [n].[target_criteria], [n].[Title], [n].[title_ar], [n].[title_en]
FROM [notification_templates] AS [n]
WHERE [n].[Id] = @__Parse_0
2025-02-02 21:01:54.390 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@__Parse_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [n].[Id], [n].[additional_data], [n].[Body], [n].[body_ar], [n].[body_en], [n].[created_at], [n].[expiry_at], [n].[Route], [n].[target_criteria], [n].[Title], [n].[title_ar], [n].[title_en]
FROM [notification_templates] AS [n]
WHERE [n].[Id] = @__Parse_0
2025-02-02 21:01:54.397 +03:00 [INF] Executed DbCommand (4ms) [Parameters=[@p0='?' (Size = 4000), @p1='?' (DbType = DateTime2), @p2='?' (Size = 4000), @p3='?' (Size = 4000), @p4='?' (Size = 4000), @p5='?' (Size = 450), @p6='?' (Size = 4000), @p7='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SET IMPLICIT_TRANSACTIONS OFF;
SET NOCOUNT ON;
INSERT INTO [AuthLogs] ([AuthType], [CreatedAt], [DeviceId], [FailureReason], [IpAddress], [NationalId], [Status], [UserAgent])
OUTPUT INSERTED.[Id]
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7);
2025-02-02 21:01:54.401 +03:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType9`2[[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Object, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-02-02 21:01:54.402 +03:00 [INF] Executed action NayifatAPI.Controllers.NotificationsController.GetNotifications (NayifatAPI) in 110.4534ms
2025-02-02 21:01:54.403 +03:00 [INF] Executed endpoint 'NayifatAPI.Controllers.NotificationsController.GetNotifications (NayifatAPI)'
2025-02-02 21:01:54.405 +03:00 [INF] Request finished HTTP/1.1 POST http://07ca-46-152-255-232.ngrok-free.app/api/notifications/list - 200 null application/json; charset=utf-8 117.941ms
2025-02-02 21:06:54.551 +03:00 [INF] Request starting HTTP/1.1 POST http://07ca-46-152-255-232.ngrok-free.app/api/notifications/list - application/json; charset=utf-8 47
2025-02-02 21:06:54.798 +03:00 [INF] Executing endpoint 'NayifatAPI.Controllers.NotificationsController.GetNotifications (NayifatAPI)'
2025-02-02 21:06:54.799 +03:00 [INF] Route matched with {action = "GetNotifications", controller = "Notifications"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetNotifications(NayifatAPI.Controllers.GetNotificationsRequest) on controller NayifatAPI.Controllers.NotificationsController (NayifatAPI).
2025-02-02 21:06:54.804 +03:00 [INF] Executed DbCommand (2ms) [Parameters=[@__providedApiKey_0='?' (Size = 255)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [a].[Key], [a].[CreatedAt], [a].[Description], [a].[ExpiresAt], [a].[IsActive], [a].[LastUsedAt]
FROM [ApiKeys] AS [a]
WHERE [a].[Key] = @__providedApiKey_0 AND [a].[IsActive] = CAST(1 AS bit)
2025-02-02 21:06:54.809 +03:00 [INF] Executed DbCommand (2ms) [Parameters=[@__request_NationalId_0='?' (Size = 450)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [u].[national_id], [u].[last_updated], [u].[notifications]
FROM [user_notifications] AS [u]
WHERE [u].[national_id] = @__request_NationalId_0
2025-02-02 21:06:54.814 +03:00 [INF] Executed DbCommand (3ms) [Parameters=[@__Parse_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [n].[Id], [n].[additional_data], [n].[Body], [n].[body_ar], [n].[body_en], [n].[created_at], [n].[expiry_at], [n].[Route], [n].[target_criteria], [n].[Title], [n].[title_ar], [n].[title_en]
FROM [notification_templates] AS [n]
WHERE [n].[Id] = @__Parse_0
2025-02-02 21:06:54.878 +03:00 [INF] Executed DbCommand (60ms) [Parameters=[@__Parse_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [n].[Id], [n].[additional_data], [n].[Body], [n].[body_ar], [n].[body_en], [n].[created_at], [n].[expiry_at], [n].[Route], [n].[target_criteria], [n].[Title], [n].[title_ar], [n].[title_en]
FROM [notification_templates] AS [n]
WHERE [n].[Id] = @__Parse_0
2025-02-02 21:06:54.999 +03:00 [INF] Executed DbCommand (104ms) [Parameters=[@p0='?' (Size = 4000), @p1='?' (DbType = DateTime2), @p2='?' (Size = 4000), @p3='?' (Size = 4000), @p4='?' (Size = 4000), @p5='?' (Size = 450), @p6='?' (Size = 4000), @p7='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SET IMPLICIT_TRANSACTIONS OFF;
SET NOCOUNT ON;
INSERT INTO [AuthLogs] ([AuthType], [CreatedAt], [DeviceId], [FailureReason], [IpAddress], [NationalId], [Status], [UserAgent])
OUTPUT INSERTED.[Id]
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7);
2025-02-02 21:06:55.045 +03:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType9`2[[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Object, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-02-02 21:06:55.068 +03:00 [INF] Executed action NayifatAPI.Controllers.NotificationsController.GetNotifications (NayifatAPI) in 267.3976ms
2025-02-02 21:06:55.070 +03:00 [INF] Executed endpoint 'NayifatAPI.Controllers.NotificationsController.GetNotifications (NayifatAPI)'
2025-02-02 21:06:55.072 +03:00 [INF] Request finished HTTP/1.1 POST http://07ca-46-152-255-232.ngrok-free.app/api/notifications/list - 200 null application/json; charset=utf-8 520.6491ms
2025-02-02 21:08:57.488 +03:00 [INF] Request starting HTTP/1.1 POST http://07ca-46-152-255-232.ngrok-free.app/api/notifications/list - application/json; charset=utf-8 47
2025-02-02 21:08:57.492 +03:00 [INF] Executing endpoint 'NayifatAPI.Controllers.NotificationsController.GetNotifications (NayifatAPI)'
2025-02-02 21:08:57.493 +03:00 [INF] Route matched with {action = "GetNotifications", controller = "Notifications"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetNotifications(NayifatAPI.Controllers.GetNotificationsRequest) on controller NayifatAPI.Controllers.NotificationsController (NayifatAPI).
2025-02-02 21:08:57.497 +03:00 [INF] Executed DbCommand (3ms) [Parameters=[@__providedApiKey_0='?' (Size = 255)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [a].[Key], [a].[CreatedAt], [a].[Description], [a].[ExpiresAt], [a].[IsActive], [a].[LastUsedAt]
FROM [ApiKeys] AS [a]
WHERE [a].[Key] = @__providedApiKey_0 AND [a].[IsActive] = CAST(1 AS bit)
2025-02-02 21:08:57.502 +03:00 [INF] Executed DbCommand (2ms) [Parameters=[@__request_NationalId_0='?' (Size = 450)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [u].[national_id], [u].[last_updated], [u].[notifications]
FROM [user_notifications] AS [u]
WHERE [u].[national_id] = @__request_NationalId_0
2025-02-02 21:08:57.506 +03:00 [INF] Executed DbCommand (2ms) [Parameters=[@__Parse_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [n].[Id], [n].[additional_data], [n].[Body], [n].[body_ar], [n].[body_en], [n].[created_at], [n].[expiry_at], [n].[Route], [n].[target_criteria], [n].[Title], [n].[title_ar], [n].[title_en]
FROM [notification_templates] AS [n]
WHERE [n].[Id] = @__Parse_0
2025-02-02 21:08:57.509 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@__Parse_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [n].[Id], [n].[additional_data], [n].[Body], [n].[body_ar], [n].[body_en], [n].[created_at], [n].[expiry_at], [n].[Route], [n].[target_criteria], [n].[Title], [n].[title_ar], [n].[title_en]
FROM [notification_templates] AS [n]
WHERE [n].[Id] = @__Parse_0
2025-02-02 21:08:57.523 +03:00 [INF] Executed DbCommand (10ms) [Parameters=[@p0='?' (Size = 4000), @p1='?' (DbType = DateTime2), @p2='?' (Size = 4000), @p3='?' (Size = 4000), @p4='?' (Size = 4000), @p5='?' (Size = 450), @p6='?' (Size = 4000), @p7='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SET IMPLICIT_TRANSACTIONS OFF;
SET NOCOUNT ON;
INSERT INTO [AuthLogs] ([AuthType], [CreatedAt], [DeviceId], [FailureReason], [IpAddress], [NationalId], [Status], [UserAgent])
OUTPUT INSERTED.[Id]
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7);
2025-02-02 21:08:57.526 +03:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType9`2[[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Object, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-02-02 21:08:57.527 +03:00 [INF] Executed action NayifatAPI.Controllers.NotificationsController.GetNotifications (NayifatAPI) in 32.7948ms
2025-02-02 21:08:57.528 +03:00 [INF] Executed endpoint 'NayifatAPI.Controllers.NotificationsController.GetNotifications (NayifatAPI)'
2025-02-02 21:08:57.529 +03:00 [INF] Request finished HTTP/1.1 POST http://07ca-46-152-255-232.ngrok-free.app/api/notifications/list - 200 null application/json; charset=utf-8 41.4726ms
2025-02-02 21:09:08.615 +03:00 [INF] Request starting HTTP/1.1 POST http://07ca-46-152-255-232.ngrok-free.app/api/auth/signin - application/json; charset=utf-8 78
2025-02-02 21:09:08.618 +03:00 [INF] Executing endpoint 'NayifatAPI.Controllers.AuthController.SignIn (NayifatAPI)'
2025-02-02 21:09:08.619 +03:00 [INF] Route matched with {action = "SignIn", controller = "Auth"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] SignIn(NayifatAPI.Controllers.SignInRequest) on controller NayifatAPI.Controllers.AuthController (NayifatAPI).
2025-02-02 21:09:08.622 +03:00 [INF] Executed DbCommand (0ms) [Parameters=[@__providedApiKey_0='?' (Size = 255)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [a].[Key], [a].[CreatedAt], [a].[Description], [a].[ExpiresAt], [a].[IsActive], [a].[LastUsedAt]
FROM [ApiKeys] AS [a]
WHERE [a].[Key] = @__providedApiKey_0 AND [a].[IsActive] = CAST(1 AS bit)
2025-02-02 21:09:08.627 +03:00 [INF] Executed DbCommand (2ms) [Parameters=[@__request_NationalId_0='?' (Size = 450)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [c].[NationalId], [c].[AddNo], [c].[BuildingNo], [c].[City], [c].[Consent], [c].[ConsentDate], [c].[DateOfBirth], [c].[Dependents], [c].[District], [c].[Email], [c].[Employer], [c].[FamilyNameAr], [c].[FamilyNameEn], [c].[FirstNameAr], [c].[FirstNameEn], [c].[Iban], [c].[IdExpiryDate], [c].[Los], [c].[Mpin], [c].[MpinEnabled], [c].[NafathStatus], [c].[NafathTimestamp], [c].[Password], [c].[Phone], [c].[RegistrationDate], [c].[SalaryCustomer], [c].[SalaryDakhli], [c].[SecondNameAr], [c].[SecondNameEn], [c].[Sector], [c].[Street], [c].[ThirdNameAr], [c].[ThirdNameEn], [c].[Zipcode]
FROM [Customers] AS [c]
WHERE [c].[NationalId] = @__request_NationalId_0
2025-02-02 21:09:08.631 +03:00 [INF] Starting password verification for NationalId: 1064448614
2025-02-02 21:09:08.816 +03:00 [INF] Password verification result for NationalId 1064448614: Success
2025-02-02 21:09:08.891 +03:00 [INF] Executed DbCommand (73ms) [Parameters=[@p0='?' (Size = 4000), @p1='?' (DbType = DateTime2), @p2='?' (Size = 4000), @p3='?' (Size = 4000), @p4='?' (Size = 4000), @p5='?' (Size = 450), @p6='?' (Size = 4000), @p7='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SET IMPLICIT_TRANSACTIONS OFF;
SET NOCOUNT ON;
INSERT INTO [AuthLogs] ([AuthType], [CreatedAt], [DeviceId], [FailureReason], [IpAddress], [NationalId], [Status], [UserAgent])
OUTPUT INSERTED.[Id]
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7);
2025-02-02 21:09:08.893 +03:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType9`2[[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Object, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-02-02 21:09:08.895 +03:00 [INF] Executed action NayifatAPI.Controllers.AuthController.SignIn (NayifatAPI) in 274.8452ms
2025-02-02 21:09:08.896 +03:00 [INF] Executed endpoint 'NayifatAPI.Controllers.AuthController.SignIn (NayifatAPI)'
2025-02-02 21:09:08.897 +03:00 [INF] Request finished HTTP/1.1 POST http://07ca-46-152-255-232.ngrok-free.app/api/auth/signin - 200 null application/json; charset=utf-8 281.9539ms
2025-02-02 21:09:09.708 +03:00 [INF] Request starting HTTP/1.1 POST http://07ca-46-152-255-232.ngrok-free.app/api/proxy/forward?url=https://icreditdept.com/api/testasp/test_local_generate_otp.php - application/json; charset=utf-8 84
2025-02-02 21:09:09.711 +03:00 [INF] Executing endpoint 'NayifatAPI.Controllers.ProxyController.ForwardRequest (NayifatAPI)'
2025-02-02 21:09:09.712 +03:00 [INF] Route matched with {action = "ForwardRequest", controller = "Proxy"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] ForwardRequest() on controller NayifatAPI.Controllers.ProxyController (NayifatAPI).
2025-02-02 21:09:09.714 +03:00 [INF] Start processing HTTP request POST https://icreditdept.com/api/testasp/test_local_generate_otp.php
2025-02-02 21:09:09.715 +03:00 [INF] Sending HTTP request POST https://icreditdept.com/api/testasp/test_local_generate_otp.php
2025-02-02 21:09:10.522 +03:00 [INF] Received HTTP response headers after 806.7005ms - 200
2025-02-02 21:09:10.524 +03:00 [INF] End processing HTTP request after 810.2595ms - 200
2025-02-02 21:09:10.525 +03:00 [INF] Raw response length: 200
2025-02-02 21:09:10.526 +03:00 [INF] Response content: {"success":true,"errors":[],"result":{"nationalId":"1064448614","otp":507858,"expiryDate":"2025-02-02 21:14:10","successMsg":"Success","errCode":0,"errMsg":null},"type":"N","message":null,"code":null}
2025-02-02 21:09:10.528 +03:00 [INF] Executing ContentResult with HTTP Response ContentType of application/json
2025-02-02 21:09:10.528 +03:00 [INF] Executed action NayifatAPI.Controllers.ProxyController.ForwardRequest (NayifatAPI) in 815.2556ms
2025-02-02 21:09:10.530 +03:00 [INF] Executed endpoint 'NayifatAPI.Controllers.ProxyController.ForwardRequest (NayifatAPI)'
2025-02-02 21:09:10.532 +03:00 [INF] Request finished HTTP/1.1 POST http://07ca-46-152-255-232.ngrok-free.app/api/proxy/forward?url=https://icreditdept.com/api/testasp/test_local_generate_otp.php - 200 200 application/json 823.4479ms
2025-02-02 21:09:23.247 +03:00 [INF] Request starting HTTP/1.1 POST http://07ca-46-152-255-232.ngrok-free.app/api/proxy/forward?url=https://icreditdept.com/api/testasp/test_local_verify_otp.php - application/json; charset=utf-8 53
2025-02-02 21:09:23.251 +03:00 [INF] Executing endpoint 'NayifatAPI.Controllers.ProxyController.ForwardRequest (NayifatAPI)'
2025-02-02 21:09:23.252 +03:00 [INF] Route matched with {action = "ForwardRequest", controller = "Proxy"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] ForwardRequest() on controller NayifatAPI.Controllers.ProxyController (NayifatAPI).
2025-02-02 21:09:23.253 +03:00 [INF] Start processing HTTP request POST https://icreditdept.com/api/testasp/test_local_verify_otp.php
2025-02-02 21:09:23.254 +03:00 [INF] Sending HTTP request POST https://icreditdept.com/api/testasp/test_local_verify_otp.php
2025-02-02 21:09:23.679 +03:00 [INF] Received HTTP response headers after 423.4978ms - 200
2025-02-02 21:09:23.683 +03:00 [INF] End processing HTTP request after 429.4621ms - 200
2025-02-02 21:09:23.684 +03:00 [INF] Raw response length: 202
2025-02-02 21:09:23.684 +03:00 [INF] Response content: {"success":true,"errors":[],"result":{"nationalId":"1064448614","otp":"507858","verifiedFlag":true,"successMsg":"Verified successfully.","errCode":0,"errMsg":null},"type":"N","message":null,"code":null}
2025-02-02 21:09:23.685 +03:00 [INF] Executing ContentResult with HTTP Response ContentType of application/json
2025-02-02 21:09:23.686 +03:00 [INF] Executed action NayifatAPI.Controllers.ProxyController.ForwardRequest (NayifatAPI) in 432.6457ms
2025-02-02 21:09:23.687 +03:00 [INF] Executed endpoint 'NayifatAPI.Controllers.ProxyController.ForwardRequest (NayifatAPI)'
2025-02-02 21:09:23.688 +03:00 [INF] Request finished HTTP/1.1 POST http://07ca-46-152-255-232.ngrok-free.app/api/proxy/forward?url=https://icreditdept.com/api/testasp/test_local_verify_otp.php - 200 202 application/json 441.8951ms
2025-02-02 21:09:29.997 +03:00 [INF] Request starting HTTP/1.1 POST http://07ca-46-152-255-232.ngrok-free.app/api/device - application/json; charset=utf-8 121
2025-02-02 21:09:30.001 +03:00 [INF] Executing endpoint 'NayifatAPI.Controllers.DeviceController.RegisterDevice (NayifatAPI)'
2025-02-02 21:09:30.006 +03:00 [INF] Route matched with {action = "RegisterDevice", controller = "Device"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] RegisterDevice(NayifatAPI.Controllers.RegisterDeviceRequest) on controller NayifatAPI.Controllers.DeviceController (NayifatAPI).
2025-02-02 21:09:30.033 +03:00 [INF] Executed DbCommand (10ms) [Parameters=[@__providedApiKey_0='?' (Size = 255)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [a].[Key], [a].[CreatedAt], [a].[Description], [a].[ExpiresAt], [a].[IsActive], [a].[LastUsedAt]
FROM [ApiKeys] AS [a]
WHERE [a].[Key] = @__providedApiKey_0 AND [a].[IsActive] = CAST(1 AS bit)
2025-02-02 21:09:30.150 +03:00 [INF] Executed DbCommand (37ms) [Parameters=[@__p_0='?' (Size = 450)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [c].[NationalId], [c].[AddNo], [c].[BuildingNo], [c].[City], [c].[Consent], [c].[ConsentDate], [c].[DateOfBirth], [c].[Dependents], [c].[District], [c].[Email], [c].[Employer], [c].[FamilyNameAr], [c].[FamilyNameEn], [c].[FirstNameAr], [c].[FirstNameEn], [c].[Iban], [c].[IdExpiryDate], [c].[Los], [c].[Mpin], [c].[MpinEnabled], [c].[NafathStatus], [c].[NafathTimestamp], [c].[Password], [c].[Phone], [c].[RegistrationDate], [c].[SalaryCustomer], [c].[SalaryDakhli], [c].[SecondNameAr], [c].[SecondNameEn], [c].[Sector], [c].[Street], [c].[ThirdNameAr], [c].[ThirdNameEn], [c].[Zipcode]
FROM [Customers] AS [c]
WHERE [c].[NationalId] = @__p_0
2025-02-02 21:09:30.531 +03:00 [INF] Executed DbCommand (152ms) [Parameters=[@__request_NationalId_0='?' (Size = 450)], CommandType='"Text"', CommandTimeout='30']
UPDATE [c]
SET [c].[LastUsedAt] = GETUTCDATE(),
    [c].[Status] = N'disabled'
FROM [Customer_Devices] AS [c]
WHERE [c].[NationalId] = @__request_NationalId_0
2025-02-02 21:09:30.782 +03:00 [INF] Executed DbCommand (29ms) [Parameters=[@p0='?' (Size = 4000), @p1='?' (DbType = DateTime2), @p2='?' (Size = 4000), @p3='?' (Size = 4000), @p4='?' (Size = 4000), @p5='?' (Size = 450), @p6='?' (Size = 4000), @p7='?' (Size = 4000), @p8='?' (DbType = Boolean), @p9='?' (Size = 4000), @p10='?' (DbType = DateTime2), @p11='?' (Size = 450), @p12='?' (DbType = DateTime2), @p13='?' (Size = 4000), @p14='?' (Size = 4000), @p15='?' (Size = 450), @p16='?' (Size = 4000), @p17='?' (Size = 4000), @p18='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SET NOCOUNT ON;
INSERT INTO [AuthLogs] ([AuthType], [CreatedAt], [DeviceId], [FailureReason], [IpAddress], [NationalId], [Status], [UserAgent])
OUTPUT INSERTED.[Id]
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7);
INSERT INTO [Customer_Devices] ([BiometricEnabled], [BiometricToken], [CreatedAt], [DeviceId], [LastUsedAt], [Manufacturer], [Model], [NationalId], [OsVersion], [Platform], [Status])
OUTPUT INSERTED.[Id]
VALUES (@p8, @p9, @p10, @p11, @p12, @p13, @p14, @p15, @p16, @p17, @p18);
2025-02-02 21:09:30.966 +03:00 [ERR] An exception occurred in the database while saving changes for context type 'NayifatAPI.Data.ApplicationDbContext'.
Microsoft.EntityFrameworkCore.DbUpdateException: An error occurred while saving the entity changes. See the inner exception for details.
 ---> Microsoft.Data.SqlClient.SqlException (0x80131904): Cannot insert duplicate key row in object 'dbo.Customer_Devices' with unique index 'IX_Customer_Devices_NationalId_DeviceId'. The duplicate key value is (1064448614, TP1A.220624.014).
   at Microsoft.Data.SqlClient.SqlConnection.OnError(SqlException exception, Boolean breakConnection, Action`1 wrapCloseInAction)
   at Microsoft.Data.SqlClient.SqlInternalConnection.OnError(SqlException exception, Boolean breakConnection, Action`1 wrapCloseInAction)
   at Microsoft.Data.SqlClient.TdsParser.ThrowExceptionAndWarning(TdsParserStateObject stateObj, Boolean callerHasConnectionLock, Boolean asyncClose)
   at Microsoft.Data.SqlClient.TdsParser.TryRun(RunBehavior runBehavior, SqlCommand cmdHandler, SqlDataReader dataStream, BulkCopySimpleResultSet bulkCopyHandler, TdsParserStateObject stateObj, Boolean& dataReady)
   at Microsoft.Data.SqlClient.SqlDataReader.TryHasMoreRows(Boolean& moreRows)
   at Microsoft.Data.SqlClient.SqlDataReader.TryReadInternal(Boolean setTimeout, Boolean& more)
   at Microsoft.Data.SqlClient.SqlDataReader.ReadAsyncExecute(Task task, Object state)
   at Microsoft.Data.SqlClient.SqlDataReader.InvokeAsyncCall[T](SqlDataReaderBaseAsyncCallContext`1 context)
--- End of stack trace from previous location ---
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeResultSetAsync(Int32 startCommandIndex, RelationalDataReader reader, CancellationToken cancellationToken)
ClientConnectionId:b8b48f52-0013-4846-8724-6485018d8584
Error Number:2601,State:1,Class:14
   --- End of inner exception stack trace ---
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeResultSetAsync(Int32 startCommandIndex, RelationalDataReader reader, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeAsync(RelationalDataReader reader, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Update.Internal.SqlServerModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(IList`1 entriesToSave, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(StateManager stateManager, Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Storage.Internal.SqlServerExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
Microsoft.EntityFrameworkCore.DbUpdateException: An error occurred while saving the entity changes. See the inner exception for details.
 ---> Microsoft.Data.SqlClient.SqlException (0x80131904): Cannot insert duplicate key row in object 'dbo.Customer_Devices' with unique index 'IX_Customer_Devices_NationalId_DeviceId'. The duplicate key value is (1064448614, TP1A.220624.014).
   at Microsoft.Data.SqlClient.SqlConnection.OnError(SqlException exception, Boolean breakConnection, Action`1 wrapCloseInAction)
   at Microsoft.Data.SqlClient.SqlInternalConnection.OnError(SqlException exception, Boolean breakConnection, Action`1 wrapCloseInAction)
   at Microsoft.Data.SqlClient.TdsParser.ThrowExceptionAndWarning(TdsParserStateObject stateObj, Boolean callerHasConnectionLock, Boolean asyncClose)
   at Microsoft.Data.SqlClient.TdsParser.TryRun(RunBehavior runBehavior, SqlCommand cmdHandler, SqlDataReader dataStream, BulkCopySimpleResultSet bulkCopyHandler, TdsParserStateObject stateObj, Boolean& dataReady)
   at Microsoft.Data.SqlClient.SqlDataReader.TryHasMoreRows(Boolean& moreRows)
   at Microsoft.Data.SqlClient.SqlDataReader.TryReadInternal(Boolean setTimeout, Boolean& more)
   at Microsoft.Data.SqlClient.SqlDataReader.ReadAsyncExecute(Task task, Object state)
   at Microsoft.Data.SqlClient.SqlDataReader.InvokeAsyncCall[T](SqlDataReaderBaseAsyncCallContext`1 context)
--- End of stack trace from previous location ---
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeResultSetAsync(Int32 startCommandIndex, RelationalDataReader reader, CancellationToken cancellationToken)
ClientConnectionId:b8b48f52-0013-4846-8724-6485018d8584
Error Number:2601,State:1,Class:14
   --- End of inner exception stack trace ---
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeResultSetAsync(Int32 startCommandIndex, RelationalDataReader reader, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeAsync(RelationalDataReader reader, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Update.Internal.SqlServerModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(IList`1 entriesToSave, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(StateManager stateManager, Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Storage.Internal.SqlServerExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
2025-02-02 21:09:31.650 +03:00 [ERR] Error registering device for National ID: 1064448614
Microsoft.EntityFrameworkCore.DbUpdateException: An error occurred while saving the entity changes. See the inner exception for details.
 ---> Microsoft.Data.SqlClient.SqlException (0x80131904): Cannot insert duplicate key row in object 'dbo.Customer_Devices' with unique index 'IX_Customer_Devices_NationalId_DeviceId'. The duplicate key value is (1064448614, TP1A.220624.014).
   at Microsoft.Data.SqlClient.SqlConnection.OnError(SqlException exception, Boolean breakConnection, Action`1 wrapCloseInAction)
   at Microsoft.Data.SqlClient.SqlInternalConnection.OnError(SqlException exception, Boolean breakConnection, Action`1 wrapCloseInAction)
   at Microsoft.Data.SqlClient.TdsParser.ThrowExceptionAndWarning(TdsParserStateObject stateObj, Boolean callerHasConnectionLock, Boolean asyncClose)
   at Microsoft.Data.SqlClient.TdsParser.TryRun(RunBehavior runBehavior, SqlCommand cmdHandler, SqlDataReader dataStream, BulkCopySimpleResultSet bulkCopyHandler, TdsParserStateObject stateObj, Boolean& dataReady)
   at Microsoft.Data.SqlClient.SqlDataReader.TryHasMoreRows(Boolean& moreRows)
   at Microsoft.Data.SqlClient.SqlDataReader.TryReadInternal(Boolean setTimeout, Boolean& more)
   at Microsoft.Data.SqlClient.SqlDataReader.ReadAsyncExecute(Task task, Object state)
   at Microsoft.Data.SqlClient.SqlDataReader.InvokeAsyncCall[T](SqlDataReaderBaseAsyncCallContext`1 context)
--- End of stack trace from previous location ---
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeResultSetAsync(Int32 startCommandIndex, RelationalDataReader reader, CancellationToken cancellationToken)
ClientConnectionId:b8b48f52-0013-4846-8724-6485018d8584
Error Number:2601,State:1,Class:14
   --- End of inner exception stack trace ---
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeResultSetAsync(Int32 startCommandIndex, RelationalDataReader reader, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeAsync(RelationalDataReader reader, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Update.Internal.SqlServerModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(IList`1 entriesToSave, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(StateManager stateManager, Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Storage.Internal.SqlServerExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at NayifatAPI.Controllers.DeviceController.RegisterDevice(RegisterDeviceRequest request) in C:\Users\yamta\StudioProjects\nayifat_app_2025_new\nayifatapi\Controllers\DeviceController.cs:line 78
2025-02-02 21:09:31.689 +03:00 [INF] Executed DbCommand (14ms) [Parameters=[@p0='?' (Size = 4000), @p1='?' (DbType = DateTime2), @p2='?' (Size = 4000), @p3='?' (Size = 4000), @p4='?' (Size = 4000), @p5='?' (Size = 450), @p6='?' (Size = 4000), @p7='?' (Size = 4000), @p8='?' (Size = 4000), @p9='?' (DbType = DateTime2), @p10='?' (Size = 4000), @p11='?' (Size = 4000), @p12='?' (Size = 4000), @p13='?' (Size = 450), @p14='?' (Size = 4000), @p15='?' (Size = 4000), @p16='?' (DbType = Boolean), @p17='?' (Size = 4000), @p18='?' (DbType = DateTime2), @p19='?' (Size = 450), @p20='?' (DbType = DateTime2), @p21='?' (Size = 4000), @p22='?' (Size = 4000), @p23='?' (Size = 450), @p24='?' (Size = 4000), @p25='?' (Size = 4000), @p26='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SET NOCOUNT ON;
MERGE [AuthLogs] USING (
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7, 0),
(@p8, @p9, @p10, @p11, @p12, @p13, @p14, @p15, 1)) AS i ([AuthType], [CreatedAt], [DeviceId], [FailureReason], [IpAddress], [NationalId], [Status], [UserAgent], _Position) ON 1=0
WHEN NOT MATCHED THEN
INSERT ([AuthType], [CreatedAt], [DeviceId], [FailureReason], [IpAddress], [NationalId], [Status], [UserAgent])
VALUES (i.[AuthType], i.[CreatedAt], i.[DeviceId], i.[FailureReason], i.[IpAddress], i.[NationalId], i.[Status], i.[UserAgent])
OUTPUT INSERTED.[Id], i._Position;
INSERT INTO [Customer_Devices] ([BiometricEnabled], [BiometricToken], [CreatedAt], [DeviceId], [LastUsedAt], [Manufacturer], [Model], [NationalId], [OsVersion], [Platform], [Status])
OUTPUT INSERTED.[Id]
VALUES (@p16, @p17, @p18, @p19, @p20, @p21, @p22, @p23, @p24, @p25, @p26);
2025-02-02 21:09:31.700 +03:00 [ERR] An exception occurred in the database while saving changes for context type 'NayifatAPI.Data.ApplicationDbContext'.
Microsoft.EntityFrameworkCore.DbUpdateException: An error occurred while saving the entity changes. See the inner exception for details.
 ---> Microsoft.Data.SqlClient.SqlException (0x80131904): Cannot insert duplicate key row in object 'dbo.Customer_Devices' with unique index 'IX_Customer_Devices_NationalId_DeviceId'. The duplicate key value is (1064448614, TP1A.220624.014).
   at Microsoft.Data.SqlClient.SqlConnection.OnError(SqlException exception, Boolean breakConnection, Action`1 wrapCloseInAction)
   at Microsoft.Data.SqlClient.SqlInternalConnection.OnError(SqlException exception, Boolean breakConnection, Action`1 wrapCloseInAction)
   at Microsoft.Data.SqlClient.TdsParser.ThrowExceptionAndWarning(TdsParserStateObject stateObj, Boolean callerHasConnectionLock, Boolean asyncClose)
   at Microsoft.Data.SqlClient.TdsParser.TryRun(RunBehavior runBehavior, SqlCommand cmdHandler, SqlDataReader dataStream, BulkCopySimpleResultSet bulkCopyHandler, TdsParserStateObject stateObj, Boolean& dataReady)
   at Microsoft.Data.SqlClient.SqlDataReader.TryHasMoreRows(Boolean& moreRows)
   at Microsoft.Data.SqlClient.SqlDataReader.TryReadInternal(Boolean setTimeout, Boolean& more)
   at Microsoft.Data.SqlClient.SqlDataReader.ReadAsyncExecute(Task task, Object state)
   at Microsoft.Data.SqlClient.SqlDataReader.InvokeAsyncCall[T](SqlDataReaderBaseAsyncCallContext`1 context)
--- End of stack trace from previous location ---
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeResultSetAsync(Int32 startCommandIndex, RelationalDataReader reader, CancellationToken cancellationToken)
ClientConnectionId:b8b48f52-0013-4846-8724-6485018d8584
Error Number:2601,State:1,Class:14
   --- End of inner exception stack trace ---
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeResultSetAsync(Int32 startCommandIndex, RelationalDataReader reader, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeAsync(RelationalDataReader reader, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Update.Internal.SqlServerModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(IList`1 entriesToSave, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(StateManager stateManager, Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Storage.Internal.SqlServerExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
Microsoft.EntityFrameworkCore.DbUpdateException: An error occurred while saving the entity changes. See the inner exception for details.
 ---> Microsoft.Data.SqlClient.SqlException (0x80131904): Cannot insert duplicate key row in object 'dbo.Customer_Devices' with unique index 'IX_Customer_Devices_NationalId_DeviceId'. The duplicate key value is (1064448614, TP1A.220624.014).
   at Microsoft.Data.SqlClient.SqlConnection.OnError(SqlException exception, Boolean breakConnection, Action`1 wrapCloseInAction)
   at Microsoft.Data.SqlClient.SqlInternalConnection.OnError(SqlException exception, Boolean breakConnection, Action`1 wrapCloseInAction)
   at Microsoft.Data.SqlClient.TdsParser.ThrowExceptionAndWarning(TdsParserStateObject stateObj, Boolean callerHasConnectionLock, Boolean asyncClose)
   at Microsoft.Data.SqlClient.TdsParser.TryRun(RunBehavior runBehavior, SqlCommand cmdHandler, SqlDataReader dataStream, BulkCopySimpleResultSet bulkCopyHandler, TdsParserStateObject stateObj, Boolean& dataReady)
   at Microsoft.Data.SqlClient.SqlDataReader.TryHasMoreRows(Boolean& moreRows)
   at Microsoft.Data.SqlClient.SqlDataReader.TryReadInternal(Boolean setTimeout, Boolean& more)
   at Microsoft.Data.SqlClient.SqlDataReader.ReadAsyncExecute(Task task, Object state)
   at Microsoft.Data.SqlClient.SqlDataReader.InvokeAsyncCall[T](SqlDataReaderBaseAsyncCallContext`1 context)
--- End of stack trace from previous location ---
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeResultSetAsync(Int32 startCommandIndex, RelationalDataReader reader, CancellationToken cancellationToken)
ClientConnectionId:b8b48f52-0013-4846-8724-6485018d8584
Error Number:2601,State:1,Class:14
   --- End of inner exception stack trace ---
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeResultSetAsync(Int32 startCommandIndex, RelationalDataReader reader, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeAsync(RelationalDataReader reader, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Update.Internal.SqlServerModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(IList`1 entriesToSave, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(StateManager stateManager, Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Storage.Internal.SqlServerExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
2025-02-02 21:09:31.714 +03:00 [INF] Executed action NayifatAPI.Controllers.DeviceController.RegisterDevice (NayifatAPI) in 1705.9872ms
2025-02-02 21:09:31.715 +03:00 [INF] Executed endpoint 'NayifatAPI.Controllers.DeviceController.RegisterDevice (NayifatAPI)'
2025-02-02 21:09:31.716 +03:00 [ERR] Unhandled exception
Microsoft.EntityFrameworkCore.DbUpdateException: An error occurred while saving the entity changes. See the inner exception for details.
 ---> Microsoft.Data.SqlClient.SqlException (0x80131904): Cannot insert duplicate key row in object 'dbo.Customer_Devices' with unique index 'IX_Customer_Devices_NationalId_DeviceId'. The duplicate key value is (1064448614, TP1A.220624.014).
   at Microsoft.Data.SqlClient.SqlConnection.OnError(SqlException exception, Boolean breakConnection, Action`1 wrapCloseInAction)
   at Microsoft.Data.SqlClient.SqlInternalConnection.OnError(SqlException exception, Boolean breakConnection, Action`1 wrapCloseInAction)
   at Microsoft.Data.SqlClient.TdsParser.ThrowExceptionAndWarning(TdsParserStateObject stateObj, Boolean callerHasConnectionLock, Boolean asyncClose)
   at Microsoft.Data.SqlClient.TdsParser.TryRun(RunBehavior runBehavior, SqlCommand cmdHandler, SqlDataReader dataStream, BulkCopySimpleResultSet bulkCopyHandler, TdsParserStateObject stateObj, Boolean& dataReady)
   at Microsoft.Data.SqlClient.SqlDataReader.TryHasMoreRows(Boolean& moreRows)
   at Microsoft.Data.SqlClient.SqlDataReader.TryReadInternal(Boolean setTimeout, Boolean& more)
   at Microsoft.Data.SqlClient.SqlDataReader.ReadAsyncExecute(Task task, Object state)
   at Microsoft.Data.SqlClient.SqlDataReader.InvokeAsyncCall[T](SqlDataReaderBaseAsyncCallContext`1 context)
--- End of stack trace from previous location ---
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeResultSetAsync(Int32 startCommandIndex, RelationalDataReader reader, CancellationToken cancellationToken)
ClientConnectionId:b8b48f52-0013-4846-8724-6485018d8584
Error Number:2601,State:1,Class:14
   --- End of inner exception stack trace ---
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeResultSetAsync(Int32 startCommandIndex, RelationalDataReader reader, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeAsync(RelationalDataReader reader, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Update.Internal.SqlServerModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(IList`1 entriesToSave, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(StateManager stateManager, Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Storage.Internal.SqlServerExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at NayifatAPI.Controllers.DeviceController.RegisterDevice(RegisterDeviceRequest request) in C:\Users\yamta\StudioProjects\nayifat_app_2025_new\nayifatapi\Controllers\DeviceController.cs:line 105
   at Microsoft.AspNetCore.Mvc.Infrastructure.ActionMethodExecutor.TaskOfIActionResultExecutor.Execute(ActionContext actionContext, IActionResultTypeMapper mapper, ObjectMethodExecutor executor, Object controller, Object[] arguments)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.<InvokeActionMethodAsync>g__Awaited|12_0(ControllerActionInvoker invoker, ValueTask`1 actionResultValueTask)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.<InvokeNextActionFilterAsync>g__Awaited|10_0(ControllerActionInvoker invoker, Task lastTask, State next, Scope scope, Object state, Boolean isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.Rethrow(ActionExecutedContextSealed context)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.Next(State& next, Scope& scope, Object& state, Boolean& isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.<InvokeInnerFilterAsync>g__Awaited|13_0(ControllerActionInvoker invoker, Task lastTask, State next, Scope scope, Object state, Boolean isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeFilterPipelineAsync>g__Awaited|20_0(ResourceInvoker invoker, Task lastTask, State next, Scope scope, Object state, Boolean isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeAsync>g__Logged|17_1(ResourceInvoker invoker)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeAsync>g__Logged|17_1(ResourceInvoker invoker)
   at Microsoft.AspNetCore.Routing.EndpointMiddleware.<Invoke>g__AwaitRequestTask|7_0(Endpoint endpoint, Task requestTask, ILogger logger)
   at Microsoft.AspNetCore.Authorization.AuthorizationMiddleware.Invoke(HttpContext context)
   at Program.<>c.<<<Main>$>b__0_3>d.MoveNext() in C:\Users\yamta\StudioProjects\nayifat_app_2025_new\nayifatapi\Program.cs:line 85
2025-02-02 21:09:31.735 +03:00 [ERR] An unhandled exception has occurred while executing the request.
Microsoft.EntityFrameworkCore.DbUpdateException: An error occurred while saving the entity changes. See the inner exception for details.
 ---> Microsoft.Data.SqlClient.SqlException (0x80131904): Cannot insert duplicate key row in object 'dbo.Customer_Devices' with unique index 'IX_Customer_Devices_NationalId_DeviceId'. The duplicate key value is (1064448614, TP1A.220624.014).
   at Microsoft.Data.SqlClient.SqlConnection.OnError(SqlException exception, Boolean breakConnection, Action`1 wrapCloseInAction)
   at Microsoft.Data.SqlClient.SqlInternalConnection.OnError(SqlException exception, Boolean breakConnection, Action`1 wrapCloseInAction)
   at Microsoft.Data.SqlClient.TdsParser.ThrowExceptionAndWarning(TdsParserStateObject stateObj, Boolean callerHasConnectionLock, Boolean asyncClose)
   at Microsoft.Data.SqlClient.TdsParser.TryRun(RunBehavior runBehavior, SqlCommand cmdHandler, SqlDataReader dataStream, BulkCopySimpleResultSet bulkCopyHandler, TdsParserStateObject stateObj, Boolean& dataReady)
   at Microsoft.Data.SqlClient.SqlDataReader.TryHasMoreRows(Boolean& moreRows)
   at Microsoft.Data.SqlClient.SqlDataReader.TryReadInternal(Boolean setTimeout, Boolean& more)
   at Microsoft.Data.SqlClient.SqlDataReader.ReadAsyncExecute(Task task, Object state)
   at Microsoft.Data.SqlClient.SqlDataReader.InvokeAsyncCall[T](SqlDataReaderBaseAsyncCallContext`1 context)
--- End of stack trace from previous location ---
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeResultSetAsync(Int32 startCommandIndex, RelationalDataReader reader, CancellationToken cancellationToken)
ClientConnectionId:b8b48f52-0013-4846-8724-6485018d8584
Error Number:2601,State:1,Class:14
   --- End of inner exception stack trace ---
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeResultSetAsync(Int32 startCommandIndex, RelationalDataReader reader, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeAsync(RelationalDataReader reader, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Update.Internal.SqlServerModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(IList`1 entriesToSave, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(StateManager stateManager, Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Storage.Internal.SqlServerExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at NayifatAPI.Controllers.DeviceController.RegisterDevice(RegisterDeviceRequest request) in C:\Users\yamta\StudioProjects\nayifat_app_2025_new\nayifatapi\Controllers\DeviceController.cs:line 105
   at Microsoft.AspNetCore.Mvc.Infrastructure.ActionMethodExecutor.TaskOfIActionResultExecutor.Execute(ActionContext actionContext, IActionResultTypeMapper mapper, ObjectMethodExecutor executor, Object controller, Object[] arguments)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.<InvokeActionMethodAsync>g__Awaited|12_0(ControllerActionInvoker invoker, ValueTask`1 actionResultValueTask)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.<InvokeNextActionFilterAsync>g__Awaited|10_0(ControllerActionInvoker invoker, Task lastTask, State next, Scope scope, Object state, Boolean isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.Rethrow(ActionExecutedContextSealed context)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.Next(State& next, Scope& scope, Object& state, Boolean& isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.<InvokeInnerFilterAsync>g__Awaited|13_0(ControllerActionInvoker invoker, Task lastTask, State next, Scope scope, Object state, Boolean isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeFilterPipelineAsync>g__Awaited|20_0(ResourceInvoker invoker, Task lastTask, State next, Scope scope, Object state, Boolean isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeAsync>g__Logged|17_1(ResourceInvoker invoker)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeAsync>g__Logged|17_1(ResourceInvoker invoker)
   at Microsoft.AspNetCore.Routing.EndpointMiddleware.<Invoke>g__AwaitRequestTask|7_0(Endpoint endpoint, Task requestTask, ILogger logger)
   at Microsoft.AspNetCore.Authorization.AuthorizationMiddleware.Invoke(HttpContext context)
   at Program.<>c.<<<Main>$>b__0_3>d.MoveNext() in C:\Users\yamta\StudioProjects\nayifat_app_2025_new\nayifatapi\Program.cs:line 85
--- End of stack trace from previous location ---
   at Swashbuckle.AspNetCore.SwaggerUI.SwaggerUIMiddleware.Invoke(HttpContext httpContext)
   at Swashbuckle.AspNetCore.Swagger.SwaggerMiddleware.Invoke(HttpContext httpContext, ISwaggerProvider swaggerProvider)
   at Microsoft.AspNetCore.Authentication.AuthenticationMiddleware.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Diagnostics.DeveloperExceptionPageMiddlewareImpl.Invoke(HttpContext context)
2025-02-02 21:09:31.753 +03:00 [INF] Request finished HTTP/1.1 POST http://07ca-46-152-255-232.ngrok-free.app/api/device - 500 null text/plain; charset=utf-8 1756.5777ms
2025-02-02 21:09:50.690 +03:00 [INF] Request starting HTTP/1.1 POST http://07ca-46-152-255-232.ngrok-free.app/api/notifications/list - application/json; charset=utf-8 47
2025-02-02 21:09:50.697 +03:00 [INF] Executing endpoint 'NayifatAPI.Controllers.NotificationsController.GetNotifications (NayifatAPI)'
2025-02-02 21:09:50.698 +03:00 [INF] Route matched with {action = "GetNotifications", controller = "Notifications"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetNotifications(NayifatAPI.Controllers.GetNotificationsRequest) on controller NayifatAPI.Controllers.NotificationsController (NayifatAPI).
2025-02-02 21:09:50.705 +03:00 [INF] Executed DbCommand (3ms) [Parameters=[@__providedApiKey_0='?' (Size = 255)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [a].[Key], [a].[CreatedAt], [a].[Description], [a].[ExpiresAt], [a].[IsActive], [a].[LastUsedAt]
FROM [ApiKeys] AS [a]
WHERE [a].[Key] = @__providedApiKey_0 AND [a].[IsActive] = CAST(1 AS bit)
2025-02-02 21:09:50.709 +03:00 [INF] Executed DbCommand (2ms) [Parameters=[@__request_NationalId_0='?' (Size = 450)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [u].[national_id], [u].[last_updated], [u].[notifications]
FROM [user_notifications] AS [u]
WHERE [u].[national_id] = @__request_NationalId_0
2025-02-02 21:09:50.713 +03:00 [INF] Executed DbCommand (2ms) [Parameters=[@__Parse_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [n].[Id], [n].[additional_data], [n].[Body], [n].[body_ar], [n].[body_en], [n].[created_at], [n].[expiry_at], [n].[Route], [n].[target_criteria], [n].[Title], [n].[title_ar], [n].[title_en]
FROM [notification_templates] AS [n]
WHERE [n].[Id] = @__Parse_0
2025-02-02 21:09:50.716 +03:00 [INF] Executed DbCommand (0ms) [Parameters=[@__Parse_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [n].[Id], [n].[additional_data], [n].[Body], [n].[body_ar], [n].[body_en], [n].[created_at], [n].[expiry_at], [n].[Route], [n].[target_criteria], [n].[Title], [n].[title_ar], [n].[title_en]
FROM [notification_templates] AS [n]
WHERE [n].[Id] = @__Parse_0
2025-02-02 21:09:50.794 +03:00 [INF] Executed DbCommand (77ms) [Parameters=[@p0='?' (Size = 4000), @p1='?' (DbType = DateTime2), @p2='?' (Size = 4000), @p3='?' (Size = 4000), @p4='?' (Size = 4000), @p5='?' (Size = 450), @p6='?' (Size = 4000), @p7='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SET IMPLICIT_TRANSACTIONS OFF;
SET NOCOUNT ON;
INSERT INTO [AuthLogs] ([AuthType], [CreatedAt], [DeviceId], [FailureReason], [IpAddress], [NationalId], [Status], [UserAgent])
OUTPUT INSERTED.[Id]
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7);
2025-02-02 21:09:50.798 +03:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType9`2[[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Object, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-02-02 21:09:50.799 +03:00 [INF] Executed action NayifatAPI.Controllers.NotificationsController.GetNotifications (NayifatAPI) in 98.7612ms
2025-02-02 21:09:50.800 +03:00 [INF] Executed endpoint 'NayifatAPI.Controllers.NotificationsController.GetNotifications (NayifatAPI)'
2025-02-02 21:09:50.801 +03:00 [INF] Request finished HTTP/1.1 POST http://07ca-46-152-255-232.ngrok-free.app/api/notifications/list - 200 null application/json; charset=utf-8 110.8712ms
2025-02-02 21:11:38.953 +03:00 [INF] Request starting HTTP/1.1 POST http://07ca-46-152-255-232.ngrok-free.app/api/notifications/list - application/json; charset=utf-8 47
2025-02-02 21:11:38.955 +03:00 [INF] Executing endpoint 'NayifatAPI.Controllers.NotificationsController.GetNotifications (NayifatAPI)'
2025-02-02 21:11:38.957 +03:00 [INF] Route matched with {action = "GetNotifications", controller = "Notifications"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetNotifications(NayifatAPI.Controllers.GetNotificationsRequest) on controller NayifatAPI.Controllers.NotificationsController (NayifatAPI).
2025-02-02 21:11:38.961 +03:00 [INF] Executed DbCommand (2ms) [Parameters=[@__providedApiKey_0='?' (Size = 255)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [a].[Key], [a].[CreatedAt], [a].[Description], [a].[ExpiresAt], [a].[IsActive], [a].[LastUsedAt]
FROM [ApiKeys] AS [a]
WHERE [a].[Key] = @__providedApiKey_0 AND [a].[IsActive] = CAST(1 AS bit)
2025-02-02 21:11:38.965 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@__request_NationalId_0='?' (Size = 450)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [u].[national_id], [u].[last_updated], [u].[notifications]
FROM [user_notifications] AS [u]
WHERE [u].[national_id] = @__request_NationalId_0
2025-02-02 21:11:38.973 +03:00 [INF] Executed DbCommand (3ms) [Parameters=[@__Parse_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [n].[Id], [n].[additional_data], [n].[Body], [n].[body_ar], [n].[body_en], [n].[created_at], [n].[expiry_at], [n].[Route], [n].[target_criteria], [n].[Title], [n].[title_ar], [n].[title_en]
FROM [notification_templates] AS [n]
WHERE [n].[Id] = @__Parse_0
2025-02-02 21:11:38.977 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@__Parse_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [n].[Id], [n].[additional_data], [n].[Body], [n].[body_ar], [n].[body_en], [n].[created_at], [n].[expiry_at], [n].[Route], [n].[target_criteria], [n].[Title], [n].[title_ar], [n].[title_en]
FROM [notification_templates] AS [n]
WHERE [n].[Id] = @__Parse_0
2025-02-02 21:11:38.989 +03:00 [INF] Executed DbCommand (8ms) [Parameters=[@p0='?' (Size = 4000), @p1='?' (DbType = DateTime2), @p2='?' (Size = 4000), @p3='?' (Size = 4000), @p4='?' (Size = 4000), @p5='?' (Size = 450), @p6='?' (Size = 4000), @p7='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SET IMPLICIT_TRANSACTIONS OFF;
SET NOCOUNT ON;
INSERT INTO [AuthLogs] ([AuthType], [CreatedAt], [DeviceId], [FailureReason], [IpAddress], [NationalId], [Status], [UserAgent])
OUTPUT INSERTED.[Id]
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7);
2025-02-02 21:11:38.993 +03:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType9`2[[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Object, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-02-02 21:11:38.994 +03:00 [INF] Executed action NayifatAPI.Controllers.NotificationsController.GetNotifications (NayifatAPI) in 35.5765ms
2025-02-02 21:11:38.996 +03:00 [INF] Executed endpoint 'NayifatAPI.Controllers.NotificationsController.GetNotifications (NayifatAPI)'
2025-02-02 21:11:38.998 +03:00 [INF] Request finished HTTP/1.1 POST http://07ca-46-152-255-232.ngrok-free.app/api/notifications/list - 200 null application/json; charset=utf-8 44.9461ms
2025-02-02 21:13:23.802 +03:00 [INF] Request starting HTTP/1.1 POST http://07ca-46-152-255-232.ngrok-free.app/api/auth/signin - application/json; charset=utf-8 78
2025-02-02 21:13:23.807 +03:00 [INF] Executing endpoint 'NayifatAPI.Controllers.AuthController.SignIn (NayifatAPI)'
2025-02-02 21:13:23.808 +03:00 [INF] Route matched with {action = "SignIn", controller = "Auth"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] SignIn(NayifatAPI.Controllers.SignInRequest) on controller NayifatAPI.Controllers.AuthController (NayifatAPI).
2025-02-02 21:13:23.812 +03:00 [INF] Executed DbCommand (2ms) [Parameters=[@__providedApiKey_0='?' (Size = 255)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [a].[Key], [a].[CreatedAt], [a].[Description], [a].[ExpiresAt], [a].[IsActive], [a].[LastUsedAt]
FROM [ApiKeys] AS [a]
WHERE [a].[Key] = @__providedApiKey_0 AND [a].[IsActive] = CAST(1 AS bit)
2025-02-02 21:13:23.818 +03:00 [INF] Executed DbCommand (3ms) [Parameters=[@__request_NationalId_0='?' (Size = 450)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [c].[NationalId], [c].[AddNo], [c].[BuildingNo], [c].[City], [c].[Consent], [c].[ConsentDate], [c].[DateOfBirth], [c].[Dependents], [c].[District], [c].[Email], [c].[Employer], [c].[FamilyNameAr], [c].[FamilyNameEn], [c].[FirstNameAr], [c].[FirstNameEn], [c].[Iban], [c].[IdExpiryDate], [c].[Los], [c].[Mpin], [c].[MpinEnabled], [c].[NafathStatus], [c].[NafathTimestamp], [c].[Password], [c].[Phone], [c].[RegistrationDate], [c].[SalaryCustomer], [c].[SalaryDakhli], [c].[SecondNameAr], [c].[SecondNameEn], [c].[Sector], [c].[Street], [c].[ThirdNameAr], [c].[ThirdNameEn], [c].[Zipcode]
FROM [Customers] AS [c]
WHERE [c].[NationalId] = @__request_NationalId_0
2025-02-02 21:13:23.821 +03:00 [INF] Starting password verification for NationalId: 1064448614
2025-02-02 21:13:23.991 +03:00 [INF] Password verification result for NationalId 1064448614: Success
2025-02-02 21:13:24.070 +03:00 [INF] Executed DbCommand (76ms) [Parameters=[@p0='?' (Size = 4000), @p1='?' (DbType = DateTime2), @p2='?' (Size = 4000), @p3='?' (Size = 4000), @p4='?' (Size = 4000), @p5='?' (Size = 450), @p6='?' (Size = 4000), @p7='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SET IMPLICIT_TRANSACTIONS OFF;
SET NOCOUNT ON;
INSERT INTO [AuthLogs] ([AuthType], [CreatedAt], [DeviceId], [FailureReason], [IpAddress], [NationalId], [Status], [UserAgent])
OUTPUT INSERTED.[Id]
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7);
2025-02-02 21:13:24.072 +03:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType9`2[[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Object, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-02-02 21:13:24.073 +03:00 [INF] Executed action NayifatAPI.Controllers.AuthController.SignIn (NayifatAPI) in 263.8181ms
2025-02-02 21:13:24.074 +03:00 [INF] Executed endpoint 'NayifatAPI.Controllers.AuthController.SignIn (NayifatAPI)'
2025-02-02 21:13:24.075 +03:00 [INF] Request finished HTTP/1.1 POST http://07ca-46-152-255-232.ngrok-free.app/api/auth/signin - 200 null application/json; charset=utf-8 272.7868ms
2025-02-02 21:13:24.790 +03:00 [INF] Request starting HTTP/1.1 POST http://07ca-46-152-255-232.ngrok-free.app/api/proxy/forward?url=https://icreditdept.com/api/testasp/test_local_generate_otp.php - application/json; charset=utf-8 84
2025-02-02 21:13:24.798 +03:00 [INF] Executing endpoint 'NayifatAPI.Controllers.ProxyController.ForwardRequest (NayifatAPI)'
2025-02-02 21:13:24.798 +03:00 [INF] Route matched with {action = "ForwardRequest", controller = "Proxy"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] ForwardRequest() on controller NayifatAPI.Controllers.ProxyController (NayifatAPI).
2025-02-02 21:13:24.800 +03:00 [INF] Start processing HTTP request POST https://icreditdept.com/api/testasp/test_local_generate_otp.php
2025-02-02 21:13:24.801 +03:00 [INF] Sending HTTP request POST https://icreditdept.com/api/testasp/test_local_generate_otp.php
2025-02-02 21:13:25.455 +03:00 [INF] Received HTTP response headers after 653.7711ms - 200
2025-02-02 21:13:25.457 +03:00 [INF] End processing HTTP request after 657.0481ms - 200
2025-02-02 21:13:25.458 +03:00 [INF] Raw response length: 200
2025-02-02 21:13:25.458 +03:00 [INF] Response content: {"success":true,"errors":[],"result":{"nationalId":"1064448614","otp":758026,"expiryDate":"2025-02-02 21:18:25","successMsg":"Success","errCode":0,"errMsg":null},"type":"N","message":null,"code":null}
2025-02-02 21:13:25.459 +03:00 [INF] Executing ContentResult with HTTP Response ContentType of application/json
2025-02-02 21:13:25.460 +03:00 [INF] Executed action NayifatAPI.Controllers.ProxyController.ForwardRequest (NayifatAPI) in 660.2565ms
2025-02-02 21:13:25.461 +03:00 [INF] Executed endpoint 'NayifatAPI.Controllers.ProxyController.ForwardRequest (NayifatAPI)'
2025-02-02 21:13:25.462 +03:00 [INF] Request finished HTTP/1.1 POST http://07ca-46-152-255-232.ngrok-free.app/api/proxy/forward?url=https://icreditdept.com/api/testasp/test_local_generate_otp.php - 200 200 application/json 672.1526ms
2025-02-02 21:13:36.918 +03:00 [INF] Request starting HTTP/1.1 POST http://07ca-46-152-255-232.ngrok-free.app/api/proxy/forward?url=https://icreditdept.com/api/testasp/test_local_verify_otp.php - application/json; charset=utf-8 53
2025-02-02 21:13:36.921 +03:00 [INF] Executing endpoint 'NayifatAPI.Controllers.ProxyController.ForwardRequest (NayifatAPI)'
2025-02-02 21:13:36.922 +03:00 [INF] Route matched with {action = "ForwardRequest", controller = "Proxy"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] ForwardRequest() on controller NayifatAPI.Controllers.ProxyController (NayifatAPI).
2025-02-02 21:13:36.923 +03:00 [INF] Start processing HTTP request POST https://icreditdept.com/api/testasp/test_local_verify_otp.php
2025-02-02 21:13:36.924 +03:00 [INF] Sending HTTP request POST https://icreditdept.com/api/testasp/test_local_verify_otp.php
2025-02-02 21:13:37.364 +03:00 [INF] Received HTTP response headers after 438.6503ms - 200
2025-02-02 21:13:37.368 +03:00 [INF] End processing HTTP request after 444.4166ms - 200
2025-02-02 21:13:37.369 +03:00 [INF] Raw response length: 202
2025-02-02 21:13:37.370 +03:00 [INF] Response content: {"success":true,"errors":[],"result":{"nationalId":"1064448614","otp":"758026","verifiedFlag":true,"successMsg":"Verified successfully.","errCode":0,"errMsg":null},"type":"N","message":null,"code":null}
2025-02-02 21:13:37.371 +03:00 [INF] Executing ContentResult with HTTP Response ContentType of application/json
2025-02-02 21:13:37.372 +03:00 [INF] Executed action NayifatAPI.Controllers.ProxyController.ForwardRequest (NayifatAPI) in 448.3754ms
2025-02-02 21:13:37.374 +03:00 [INF] Executed endpoint 'NayifatAPI.Controllers.ProxyController.ForwardRequest (NayifatAPI)'
2025-02-02 21:13:37.375 +03:00 [INF] Request finished HTTP/1.1 POST http://07ca-46-152-255-232.ngrok-free.app/api/proxy/forward?url=https://icreditdept.com/api/testasp/test_local_verify_otp.php - 200 202 application/json 456.7984ms
2025-02-02 21:17:06.534 +03:00 [INF] Request starting HTTP/1.1 POST http://07ca-46-152-255-232.ngrok-free.app/api/notifications/list - application/json; charset=utf-8 47
2025-02-02 21:17:06.546 +03:00 [INF] Executing endpoint 'NayifatAPI.Controllers.NotificationsController.GetNotifications (NayifatAPI)'
2025-02-02 21:17:06.547 +03:00 [INF] Route matched with {action = "GetNotifications", controller = "Notifications"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetNotifications(NayifatAPI.Controllers.GetNotificationsRequest) on controller NayifatAPI.Controllers.NotificationsController (NayifatAPI).
2025-02-02 21:17:06.552 +03:00 [INF] Executed DbCommand (2ms) [Parameters=[@__providedApiKey_0='?' (Size = 255)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [a].[Key], [a].[CreatedAt], [a].[Description], [a].[ExpiresAt], [a].[IsActive], [a].[LastUsedAt]
FROM [ApiKeys] AS [a]
WHERE [a].[Key] = @__providedApiKey_0 AND [a].[IsActive] = CAST(1 AS bit)
2025-02-02 21:17:06.555 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@__request_NationalId_0='?' (Size = 450)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [u].[national_id], [u].[last_updated], [u].[notifications]
FROM [user_notifications] AS [u]
WHERE [u].[national_id] = @__request_NationalId_0
2025-02-02 21:17:06.559 +03:00 [INF] Executed DbCommand (2ms) [Parameters=[@__Parse_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [n].[Id], [n].[additional_data], [n].[Body], [n].[body_ar], [n].[body_en], [n].[created_at], [n].[expiry_at], [n].[Route], [n].[target_criteria], [n].[Title], [n].[title_ar], [n].[title_en]
FROM [notification_templates] AS [n]
WHERE [n].[Id] = @__Parse_0
2025-02-02 21:17:06.562 +03:00 [INF] Executed DbCommand (0ms) [Parameters=[@__Parse_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [n].[Id], [n].[additional_data], [n].[Body], [n].[body_ar], [n].[body_en], [n].[created_at], [n].[expiry_at], [n].[Route], [n].[target_criteria], [n].[Title], [n].[title_ar], [n].[title_en]
FROM [notification_templates] AS [n]
WHERE [n].[Id] = @__Parse_0
2025-02-02 21:17:06.640 +03:00 [INF] Executed DbCommand (76ms) [Parameters=[@p0='?' (Size = 4000), @p1='?' (DbType = DateTime2), @p2='?' (Size = 4000), @p3='?' (Size = 4000), @p4='?' (Size = 4000), @p5='?' (Size = 450), @p6='?' (Size = 4000), @p7='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SET IMPLICIT_TRANSACTIONS OFF;
SET NOCOUNT ON;
INSERT INTO [AuthLogs] ([AuthType], [CreatedAt], [DeviceId], [FailureReason], [IpAddress], [NationalId], [Status], [UserAgent])
OUTPUT INSERTED.[Id]
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7);
2025-02-02 21:17:06.643 +03:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType9`2[[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Object, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-02-02 21:17:06.644 +03:00 [INF] Executed action NayifatAPI.Controllers.NotificationsController.GetNotifications (NayifatAPI) in 96.0037ms
2025-02-02 21:17:06.645 +03:00 [INF] Executed endpoint 'NayifatAPI.Controllers.NotificationsController.GetNotifications (NayifatAPI)'
2025-02-02 21:17:06.646 +03:00 [INF] Request finished HTTP/1.1 POST http://07ca-46-152-255-232.ngrok-free.app/api/notifications/list - 200 null application/json; charset=utf-8 111.9345ms
2025-02-02 21:22:07.822 +03:00 [INF] Request starting HTTP/1.1 POST http://07ca-46-152-255-232.ngrok-free.app/api/notifications/list - application/json; charset=utf-8 47
2025-02-02 21:22:07.825 +03:00 [INF] Executing endpoint 'NayifatAPI.Controllers.NotificationsController.GetNotifications (NayifatAPI)'
2025-02-02 21:22:07.825 +03:00 [INF] Route matched with {action = "GetNotifications", controller = "Notifications"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetNotifications(NayifatAPI.Controllers.GetNotificationsRequest) on controller NayifatAPI.Controllers.NotificationsController (NayifatAPI).
2025-02-02 21:22:07.836 +03:00 [INF] Executed DbCommand (2ms) [Parameters=[@__providedApiKey_0='?' (Size = 255)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [a].[Key], [a].[CreatedAt], [a].[Description], [a].[ExpiresAt], [a].[IsActive], [a].[LastUsedAt]
FROM [ApiKeys] AS [a]
WHERE [a].[Key] = @__providedApiKey_0 AND [a].[IsActive] = CAST(1 AS bit)
2025-02-02 21:22:07.839 +03:00 [INF] Executed DbCommand (2ms) [Parameters=[@__request_NationalId_0='?' (Size = 450)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [u].[national_id], [u].[last_updated], [u].[notifications]
FROM [user_notifications] AS [u]
WHERE [u].[national_id] = @__request_NationalId_0
2025-02-02 21:22:07.846 +03:00 [INF] Executed DbCommand (4ms) [Parameters=[@__Parse_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [n].[Id], [n].[additional_data], [n].[Body], [n].[body_ar], [n].[body_en], [n].[created_at], [n].[expiry_at], [n].[Route], [n].[target_criteria], [n].[Title], [n].[title_ar], [n].[title_en]
FROM [notification_templates] AS [n]
WHERE [n].[Id] = @__Parse_0
2025-02-02 21:22:07.850 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@__Parse_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [n].[Id], [n].[additional_data], [n].[Body], [n].[body_ar], [n].[body_en], [n].[created_at], [n].[expiry_at], [n].[Route], [n].[target_criteria], [n].[Title], [n].[title_ar], [n].[title_en]
FROM [notification_templates] AS [n]
WHERE [n].[Id] = @__Parse_0
2025-02-02 21:22:07.932 +03:00 [INF] Executed DbCommand (78ms) [Parameters=[@p0='?' (Size = 4000), @p1='?' (DbType = DateTime2), @p2='?' (Size = 4000), @p3='?' (Size = 4000), @p4='?' (Size = 4000), @p5='?' (Size = 450), @p6='?' (Size = 4000), @p7='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SET IMPLICIT_TRANSACTIONS OFF;
SET NOCOUNT ON;
INSERT INTO [AuthLogs] ([AuthType], [CreatedAt], [DeviceId], [FailureReason], [IpAddress], [NationalId], [Status], [UserAgent])
OUTPUT INSERTED.[Id]
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7);
2025-02-02 21:22:07.934 +03:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType9`2[[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Object, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-02-02 21:22:07.935 +03:00 [INF] Executed action NayifatAPI.Controllers.NotificationsController.GetNotifications (NayifatAPI) in 107.7196ms
2025-02-02 21:22:07.938 +03:00 [INF] Executed endpoint 'NayifatAPI.Controllers.NotificationsController.GetNotifications (NayifatAPI)'
2025-02-02 21:22:07.939 +03:00 [INF] Request finished HTTP/1.1 POST http://07ca-46-152-255-232.ngrok-free.app/api/notifications/list - 200 null application/json; charset=utf-8 116.9691ms
2025-02-02 21:27:07.961 +03:00 [INF] Request starting HTTP/1.1 POST http://07ca-46-152-255-232.ngrok-free.app/api/notifications/list - application/json; charset=utf-8 47
2025-02-02 21:27:07.966 +03:00 [INF] Executing endpoint 'NayifatAPI.Controllers.NotificationsController.GetNotifications (NayifatAPI)'
2025-02-02 21:27:07.967 +03:00 [INF] Route matched with {action = "GetNotifications", controller = "Notifications"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetNotifications(NayifatAPI.Controllers.GetNotificationsRequest) on controller NayifatAPI.Controllers.NotificationsController (NayifatAPI).
2025-02-02 21:27:07.976 +03:00 [INF] Executed DbCommand (2ms) [Parameters=[@__providedApiKey_0='?' (Size = 255)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [a].[Key], [a].[CreatedAt], [a].[Description], [a].[ExpiresAt], [a].[IsActive], [a].[LastUsedAt]
FROM [ApiKeys] AS [a]
WHERE [a].[Key] = @__providedApiKey_0 AND [a].[IsActive] = CAST(1 AS bit)
2025-02-02 21:27:07.980 +03:00 [INF] Executed DbCommand (2ms) [Parameters=[@__request_NationalId_0='?' (Size = 450)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [u].[national_id], [u].[last_updated], [u].[notifications]
FROM [user_notifications] AS [u]
WHERE [u].[national_id] = @__request_NationalId_0
2025-02-02 21:27:07.984 +03:00 [INF] Executed DbCommand (3ms) [Parameters=[@__Parse_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [n].[Id], [n].[additional_data], [n].[Body], [n].[body_ar], [n].[body_en], [n].[created_at], [n].[expiry_at], [n].[Route], [n].[target_criteria], [n].[Title], [n].[title_ar], [n].[title_en]
FROM [notification_templates] AS [n]
WHERE [n].[Id] = @__Parse_0
2025-02-02 21:27:07.989 +03:00 [INF] Executed DbCommand (0ms) [Parameters=[@__Parse_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [n].[Id], [n].[additional_data], [n].[Body], [n].[body_ar], [n].[body_en], [n].[created_at], [n].[expiry_at], [n].[Route], [n].[target_criteria], [n].[Title], [n].[title_ar], [n].[title_en]
FROM [notification_templates] AS [n]
WHERE [n].[Id] = @__Parse_0
2025-02-02 21:27:08.067 +03:00 [INF] Executed DbCommand (76ms) [Parameters=[@p0='?' (Size = 4000), @p1='?' (DbType = DateTime2), @p2='?' (Size = 4000), @p3='?' (Size = 4000), @p4='?' (Size = 4000), @p5='?' (Size = 450), @p6='?' (Size = 4000), @p7='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SET IMPLICIT_TRANSACTIONS OFF;
SET NOCOUNT ON;
INSERT INTO [AuthLogs] ([AuthType], [CreatedAt], [DeviceId], [FailureReason], [IpAddress], [NationalId], [Status], [UserAgent])
OUTPUT INSERTED.[Id]
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7);
2025-02-02 21:27:08.074 +03:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType9`2[[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Object, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-02-02 21:27:08.079 +03:00 [INF] Executed action NayifatAPI.Controllers.NotificationsController.GetNotifications (NayifatAPI) in 110.1229ms
2025-02-02 21:27:08.080 +03:00 [INF] Executed endpoint 'NayifatAPI.Controllers.NotificationsController.GetNotifications (NayifatAPI)'
2025-02-02 21:27:08.081 +03:00 [INF] Request finished HTTP/1.1 POST http://07ca-46-152-255-232.ngrok-free.app/api/notifications/list - 200 null application/json; charset=utf-8 119.2957ms
2025-02-02 21:32:07.844 +03:00 [INF] Request starting HTTP/1.1 POST http://07ca-46-152-255-232.ngrok-free.app/api/notifications/list - application/json; charset=utf-8 47
2025-02-02 21:32:07.846 +03:00 [INF] Executing endpoint 'NayifatAPI.Controllers.NotificationsController.GetNotifications (NayifatAPI)'
2025-02-02 21:32:07.847 +03:00 [INF] Route matched with {action = "GetNotifications", controller = "Notifications"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetNotifications(NayifatAPI.Controllers.GetNotificationsRequest) on controller NayifatAPI.Controllers.NotificationsController (NayifatAPI).
2025-02-02 21:32:07.857 +03:00 [INF] Executed DbCommand (3ms) [Parameters=[@__providedApiKey_0='?' (Size = 255)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [a].[Key], [a].[CreatedAt], [a].[Description], [a].[ExpiresAt], [a].[IsActive], [a].[LastUsedAt]
FROM [ApiKeys] AS [a]
WHERE [a].[Key] = @__providedApiKey_0 AND [a].[IsActive] = CAST(1 AS bit)
2025-02-02 21:32:07.862 +03:00 [INF] Executed DbCommand (2ms) [Parameters=[@__request_NationalId_0='?' (Size = 450)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [u].[national_id], [u].[last_updated], [u].[notifications]
FROM [user_notifications] AS [u]
WHERE [u].[national_id] = @__request_NationalId_0
2025-02-02 21:32:07.869 +03:00 [INF] Executed DbCommand (3ms) [Parameters=[@__Parse_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [n].[Id], [n].[additional_data], [n].[Body], [n].[body_ar], [n].[body_en], [n].[created_at], [n].[expiry_at], [n].[Route], [n].[target_criteria], [n].[Title], [n].[title_ar], [n].[title_en]
FROM [notification_templates] AS [n]
WHERE [n].[Id] = @__Parse_0
2025-02-02 21:32:07.873 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@__Parse_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [n].[Id], [n].[additional_data], [n].[Body], [n].[body_ar], [n].[body_en], [n].[created_at], [n].[expiry_at], [n].[Route], [n].[target_criteria], [n].[Title], [n].[title_ar], [n].[title_en]
FROM [notification_templates] AS [n]
WHERE [n].[Id] = @__Parse_0
2025-02-02 21:32:07.953 +03:00 [INF] Executed DbCommand (77ms) [Parameters=[@p0='?' (Size = 4000), @p1='?' (DbType = DateTime2), @p2='?' (Size = 4000), @p3='?' (Size = 4000), @p4='?' (Size = 4000), @p5='?' (Size = 450), @p6='?' (Size = 4000), @p7='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SET IMPLICIT_TRANSACTIONS OFF;
SET NOCOUNT ON;
INSERT INTO [AuthLogs] ([AuthType], [CreatedAt], [DeviceId], [FailureReason], [IpAddress], [NationalId], [Status], [UserAgent])
OUTPUT INSERTED.[Id]
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7);
2025-02-02 21:32:07.956 +03:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType9`2[[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Object, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-02-02 21:32:07.958 +03:00 [INF] Executed action NayifatAPI.Controllers.NotificationsController.GetNotifications (NayifatAPI) in 109.0522ms
2025-02-02 21:32:07.959 +03:00 [INF] Executed endpoint 'NayifatAPI.Controllers.NotificationsController.GetNotifications (NayifatAPI)'
2025-02-02 21:32:07.960 +03:00 [INF] Request finished HTTP/1.1 POST http://07ca-46-152-255-232.ngrok-free.app/api/notifications/list - 200 null application/json; charset=utf-8 116.787ms
2025-02-02 21:38:23.485 +03:00 [INF] Request starting HTTP/1.1 POST http://07ca-46-152-255-232.ngrok-free.app/api/notifications/list - application/json; charset=utf-8 47
2025-02-02 21:38:23.488 +03:00 [INF] Executing endpoint 'NayifatAPI.Controllers.NotificationsController.GetNotifications (NayifatAPI)'
2025-02-02 21:38:23.489 +03:00 [INF] Route matched with {action = "GetNotifications", controller = "Notifications"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetNotifications(NayifatAPI.Controllers.GetNotificationsRequest) on controller NayifatAPI.Controllers.NotificationsController (NayifatAPI).
2025-02-02 21:38:23.494 +03:00 [INF] Executed DbCommand (2ms) [Parameters=[@__providedApiKey_0='?' (Size = 255)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [a].[Key], [a].[CreatedAt], [a].[Description], [a].[ExpiresAt], [a].[IsActive], [a].[LastUsedAt]
FROM [ApiKeys] AS [a]
WHERE [a].[Key] = @__providedApiKey_0 AND [a].[IsActive] = CAST(1 AS bit)
2025-02-02 21:38:23.499 +03:00 [INF] Executed DbCommand (2ms) [Parameters=[@__request_NationalId_0='?' (Size = 450)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [u].[national_id], [u].[last_updated], [u].[notifications]
FROM [user_notifications] AS [u]
WHERE [u].[national_id] = @__request_NationalId_0
2025-02-02 21:38:23.504 +03:00 [INF] Executed DbCommand (3ms) [Parameters=[@__Parse_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [n].[Id], [n].[additional_data], [n].[Body], [n].[body_ar], [n].[body_en], [n].[created_at], [n].[expiry_at], [n].[Route], [n].[target_criteria], [n].[Title], [n].[title_ar], [n].[title_en]
FROM [notification_templates] AS [n]
WHERE [n].[Id] = @__Parse_0
2025-02-02 21:38:23.507 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@__Parse_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [n].[Id], [n].[additional_data], [n].[Body], [n].[body_ar], [n].[body_en], [n].[created_at], [n].[expiry_at], [n].[Route], [n].[target_criteria], [n].[Title], [n].[title_ar], [n].[title_en]
FROM [notification_templates] AS [n]
WHERE [n].[Id] = @__Parse_0
2025-02-02 21:38:23.586 +03:00 [INF] Executed DbCommand (76ms) [Parameters=[@p0='?' (Size = 4000), @p1='?' (DbType = DateTime2), @p2='?' (Size = 4000), @p3='?' (Size = 4000), @p4='?' (Size = 4000), @p5='?' (Size = 450), @p6='?' (Size = 4000), @p7='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SET IMPLICIT_TRANSACTIONS OFF;
SET NOCOUNT ON;
INSERT INTO [AuthLogs] ([AuthType], [CreatedAt], [DeviceId], [FailureReason], [IpAddress], [NationalId], [Status], [UserAgent])
OUTPUT INSERTED.[Id]
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7);
2025-02-02 21:38:23.587 +03:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType9`2[[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Object, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-02-02 21:38:23.589 +03:00 [INF] Executed action NayifatAPI.Controllers.NotificationsController.GetNotifications (NayifatAPI) in 97.708ms
2025-02-02 21:38:23.591 +03:00 [INF] Executed endpoint 'NayifatAPI.Controllers.NotificationsController.GetNotifications (NayifatAPI)'
2025-02-02 21:38:23.592 +03:00 [INF] Request finished HTTP/1.1 POST http://07ca-46-152-255-232.ngrok-free.app/api/notifications/list - 200 null application/json; charset=utf-8 107.2621ms
2025-02-02 21:38:40.550 +03:00 [INF] Request starting HTTP/1.1 POST http://07ca-46-152-255-232.ngrok-free.app/api/auth/signin - application/json; charset=utf-8 78
2025-02-02 21:38:40.553 +03:00 [INF] Executing endpoint 'NayifatAPI.Controllers.AuthController.SignIn (NayifatAPI)'
2025-02-02 21:38:40.554 +03:00 [INF] Route matched with {action = "SignIn", controller = "Auth"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] SignIn(NayifatAPI.Controllers.SignInRequest) on controller NayifatAPI.Controllers.AuthController (NayifatAPI).
2025-02-02 21:38:40.557 +03:00 [INF] Executed DbCommand (0ms) [Parameters=[@__providedApiKey_0='?' (Size = 255)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [a].[Key], [a].[CreatedAt], [a].[Description], [a].[ExpiresAt], [a].[IsActive], [a].[LastUsedAt]
FROM [ApiKeys] AS [a]
WHERE [a].[Key] = @__providedApiKey_0 AND [a].[IsActive] = CAST(1 AS bit)
2025-02-02 21:38:40.562 +03:00 [INF] Executed DbCommand (3ms) [Parameters=[@__request_NationalId_0='?' (Size = 450)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [c].[NationalId], [c].[AddNo], [c].[BuildingNo], [c].[City], [c].[Consent], [c].[ConsentDate], [c].[DateOfBirth], [c].[Dependents], [c].[District], [c].[Email], [c].[Employer], [c].[FamilyNameAr], [c].[FamilyNameEn], [c].[FirstNameAr], [c].[FirstNameEn], [c].[Iban], [c].[IdExpiryDate], [c].[Los], [c].[Mpin], [c].[MpinEnabled], [c].[NafathStatus], [c].[NafathTimestamp], [c].[Password], [c].[Phone], [c].[RegistrationDate], [c].[SalaryCustomer], [c].[SalaryDakhli], [c].[SecondNameAr], [c].[SecondNameEn], [c].[Sector], [c].[Street], [c].[ThirdNameAr], [c].[ThirdNameEn], [c].[Zipcode]
FROM [Customers] AS [c]
WHERE [c].[NationalId] = @__request_NationalId_0
2025-02-02 21:38:40.565 +03:00 [INF] Starting password verification for NationalId: 1064448614
2025-02-02 21:38:40.730 +03:00 [INF] Password verification result for NationalId 1064448614: Success
2025-02-02 21:38:40.737 +03:00 [INF] Executed DbCommand (6ms) [Parameters=[@p0='?' (Size = 4000), @p1='?' (DbType = DateTime2), @p2='?' (Size = 4000), @p3='?' (Size = 4000), @p4='?' (Size = 4000), @p5='?' (Size = 450), @p6='?' (Size = 4000), @p7='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SET IMPLICIT_TRANSACTIONS OFF;
SET NOCOUNT ON;
INSERT INTO [AuthLogs] ([AuthType], [CreatedAt], [DeviceId], [FailureReason], [IpAddress], [NationalId], [Status], [UserAgent])
OUTPUT INSERTED.[Id]
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7);
2025-02-02 21:38:40.740 +03:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType9`2[[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Object, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-02-02 21:38:40.741 +03:00 [INF] Executed action NayifatAPI.Controllers.AuthController.SignIn (NayifatAPI) in 185.4761ms
2025-02-02 21:38:40.742 +03:00 [INF] Executed endpoint 'NayifatAPI.Controllers.AuthController.SignIn (NayifatAPI)'
2025-02-02 21:38:40.743 +03:00 [INF] Request finished HTTP/1.1 POST http://07ca-46-152-255-232.ngrok-free.app/api/auth/signin - 200 null application/json; charset=utf-8 193.3221ms
2025-02-02 21:38:41.718 +03:00 [INF] Request starting HTTP/1.1 POST http://07ca-46-152-255-232.ngrok-free.app/api/proxy/forward?url=https://icreditdept.com/api/testasp/test_local_generate_otp.php - application/json; charset=utf-8 84
2025-02-02 21:38:41.723 +03:00 [INF] Executing endpoint 'NayifatAPI.Controllers.ProxyController.ForwardRequest (NayifatAPI)'
2025-02-02 21:38:41.724 +03:00 [INF] Route matched with {action = "ForwardRequest", controller = "Proxy"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] ForwardRequest() on controller NayifatAPI.Controllers.ProxyController (NayifatAPI).
2025-02-02 21:38:41.725 +03:00 [INF] Start processing HTTP request POST https://icreditdept.com/api/testasp/test_local_generate_otp.php
2025-02-02 21:38:41.726 +03:00 [INF] Sending HTTP request POST https://icreditdept.com/api/testasp/test_local_generate_otp.php
2025-02-02 21:38:43.148 +03:00 [INF] Received HTTP response headers after 1420.8921ms - 200
2025-02-02 21:38:43.149 +03:00 [INF] End processing HTTP request after 1423.5774ms - 200
2025-02-02 21:38:43.149 +03:00 [INF] Raw response length: 200
2025-02-02 21:38:43.150 +03:00 [INF] Response content: {"success":true,"errors":[],"result":{"nationalId":"1064448614","otp":931225,"expiryDate":"2025-02-02 21:43:43","successMsg":"Success","errCode":0,"errMsg":null},"type":"N","message":null,"code":null}
2025-02-02 21:38:43.151 +03:00 [INF] Executing ContentResult with HTTP Response ContentType of application/json
2025-02-02 21:38:43.152 +03:00 [INF] Executed action NayifatAPI.Controllers.ProxyController.ForwardRequest (NayifatAPI) in 1426.7082ms
2025-02-02 21:38:43.153 +03:00 [INF] Executed endpoint 'NayifatAPI.Controllers.ProxyController.ForwardRequest (NayifatAPI)'
2025-02-02 21:38:43.155 +03:00 [INF] Request finished HTTP/1.1 POST http://07ca-46-152-255-232.ngrok-free.app/api/proxy/forward?url=https://icreditdept.com/api/testasp/test_local_generate_otp.php - 200 200 application/json 1436.9113ms
2025-02-02 21:38:54.398 +03:00 [INF] Request starting HTTP/1.1 POST http://07ca-46-152-255-232.ngrok-free.app/api/proxy/forward?url=https://icreditdept.com/api/testasp/test_local_verify_otp.php - application/json; charset=utf-8 53
2025-02-02 21:38:54.405 +03:00 [INF] Executing endpoint 'NayifatAPI.Controllers.ProxyController.ForwardRequest (NayifatAPI)'
2025-02-02 21:38:54.407 +03:00 [INF] Route matched with {action = "ForwardRequest", controller = "Proxy"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] ForwardRequest() on controller NayifatAPI.Controllers.ProxyController (NayifatAPI).
2025-02-02 21:38:54.410 +03:00 [INF] Start processing HTTP request POST https://icreditdept.com/api/testasp/test_local_verify_otp.php
2025-02-02 21:38:54.412 +03:00 [INF] Sending HTTP request POST https://icreditdept.com/api/testasp/test_local_verify_otp.php
2025-02-02 21:38:54.854 +03:00 [INF] Received HTTP response headers after 440.3734ms - 200
2025-02-02 21:38:54.859 +03:00 [INF] End processing HTTP request after 448.3839ms - 200
2025-02-02 21:38:54.866 +03:00 [INF] Raw response length: 202
2025-02-02 21:38:54.868 +03:00 [INF] Response content: {"success":true,"errors":[],"result":{"nationalId":"1064448614","otp":"931225","verifiedFlag":true,"successMsg":"Verified successfully.","errCode":0,"errMsg":null},"type":"N","message":null,"code":null}
2025-02-02 21:38:54.869 +03:00 [INF] Executing ContentResult with HTTP Response ContentType of application/json
2025-02-02 21:38:54.870 +03:00 [INF] Executed action NayifatAPI.Controllers.ProxyController.ForwardRequest (NayifatAPI) in 460.5384ms
2025-02-02 21:38:54.873 +03:00 [INF] Executed endpoint 'NayifatAPI.Controllers.ProxyController.ForwardRequest (NayifatAPI)'
2025-02-02 21:38:54.874 +03:00 [INF] Request finished HTTP/1.1 POST http://07ca-46-152-255-232.ngrok-free.app/api/proxy/forward?url=https://icreditdept.com/api/testasp/test_local_verify_otp.php - 200 202 application/json 476.2668ms
2025-02-02 21:42:34.878 +03:00 [INF] Request starting HTTP/1.1 POST http://07ca-46-152-255-232.ngrok-free.app/api/auth/signin - application/json; charset=utf-8 78
2025-02-02 21:42:34.882 +03:00 [INF] Executing endpoint 'NayifatAPI.Controllers.AuthController.SignIn (NayifatAPI)'
2025-02-02 21:42:34.883 +03:00 [INF] Route matched with {action = "SignIn", controller = "Auth"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] SignIn(NayifatAPI.Controllers.SignInRequest) on controller NayifatAPI.Controllers.AuthController (NayifatAPI).
2025-02-02 21:42:34.887 +03:00 [INF] Executed DbCommand (2ms) [Parameters=[@__providedApiKey_0='?' (Size = 255)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [a].[Key], [a].[CreatedAt], [a].[Description], [a].[ExpiresAt], [a].[IsActive], [a].[LastUsedAt]
FROM [ApiKeys] AS [a]
WHERE [a].[Key] = @__providedApiKey_0 AND [a].[IsActive] = CAST(1 AS bit)
2025-02-02 21:42:34.893 +03:00 [INF] Executed DbCommand (4ms) [Parameters=[@__request_NationalId_0='?' (Size = 450)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [c].[NationalId], [c].[AddNo], [c].[BuildingNo], [c].[City], [c].[Consent], [c].[ConsentDate], [c].[DateOfBirth], [c].[Dependents], [c].[District], [c].[Email], [c].[Employer], [c].[FamilyNameAr], [c].[FamilyNameEn], [c].[FirstNameAr], [c].[FirstNameEn], [c].[Iban], [c].[IdExpiryDate], [c].[Los], [c].[Mpin], [c].[MpinEnabled], [c].[NafathStatus], [c].[NafathTimestamp], [c].[Password], [c].[Phone], [c].[RegistrationDate], [c].[SalaryCustomer], [c].[SalaryDakhli], [c].[SecondNameAr], [c].[SecondNameEn], [c].[Sector], [c].[Street], [c].[ThirdNameAr], [c].[ThirdNameEn], [c].[Zipcode]
FROM [Customers] AS [c]
WHERE [c].[NationalId] = @__request_NationalId_0
2025-02-02 21:42:34.896 +03:00 [INF] Starting password verification for NationalId: 1064448614
2025-02-02 21:42:35.070 +03:00 [INF] Password verification result for NationalId 1064448614: Success
2025-02-02 21:42:35.084 +03:00 [INF] Executed DbCommand (11ms) [Parameters=[@p0='?' (Size = 4000), @p1='?' (DbType = DateTime2), @p2='?' (Size = 4000), @p3='?' (Size = 4000), @p4='?' (Size = 4000), @p5='?' (Size = 450), @p6='?' (Size = 4000), @p7='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SET IMPLICIT_TRANSACTIONS OFF;
SET NOCOUNT ON;
INSERT INTO [AuthLogs] ([AuthType], [CreatedAt], [DeviceId], [FailureReason], [IpAddress], [NationalId], [Status], [UserAgent])
OUTPUT INSERTED.[Id]
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7);
2025-02-02 21:42:35.086 +03:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType9`2[[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Object, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-02-02 21:42:35.087 +03:00 [INF] Executed action NayifatAPI.Controllers.AuthController.SignIn (NayifatAPI) in 202.9334ms
2025-02-02 21:42:35.088 +03:00 [INF] Executed endpoint 'NayifatAPI.Controllers.AuthController.SignIn (NayifatAPI)'
2025-02-02 21:42:35.089 +03:00 [INF] Request finished HTTP/1.1 POST http://07ca-46-152-255-232.ngrok-free.app/api/auth/signin - 200 null application/json; charset=utf-8 210.5205ms
2025-02-02 21:42:35.777 +03:00 [INF] Request starting HTTP/1.1 POST http://07ca-46-152-255-232.ngrok-free.app/api/proxy/forward?url=https://icreditdept.com/api/testasp/test_local_generate_otp.php - application/json; charset=utf-8 84
2025-02-02 21:42:35.779 +03:00 [INF] Executing endpoint 'NayifatAPI.Controllers.ProxyController.ForwardRequest (NayifatAPI)'
2025-02-02 21:42:35.781 +03:00 [INF] Route matched with {action = "ForwardRequest", controller = "Proxy"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] ForwardRequest() on controller NayifatAPI.Controllers.ProxyController (NayifatAPI).
2025-02-02 21:42:35.782 +03:00 [INF] Start processing HTTP request POST https://icreditdept.com/api/testasp/test_local_generate_otp.php
2025-02-02 21:42:35.783 +03:00 [INF] Sending HTTP request POST https://icreditdept.com/api/testasp/test_local_generate_otp.php
2025-02-02 21:42:48.905 +03:00 [INF] Received HTTP response headers after 13120.897ms - 200
2025-02-02 21:42:48.910 +03:00 [INF] End processing HTTP request after 13127.1947ms - 200
2025-02-02 21:42:48.912 +03:00 [INF] Raw response length: 200
2025-02-02 21:42:48.913 +03:00 [INF] Response content: {"success":true,"errors":[],"result":{"nationalId":"1064448614","otp":425250,"expiryDate":"2025-02-02 21:47:39","successMsg":"Success","errCode":0,"errMsg":null},"type":"N","message":null,"code":null}
2025-02-02 21:42:48.914 +03:00 [INF] Executing ContentResult with HTTP Response ContentType of application/json
2025-02-02 21:42:48.915 +03:00 [INF] Executed action NayifatAPI.Controllers.ProxyController.ForwardRequest (NayifatAPI) in 13132.9296ms
2025-02-02 21:42:48.916 +03:00 [INF] Executed endpoint 'NayifatAPI.Controllers.ProxyController.ForwardRequest (NayifatAPI)'
2025-02-02 21:42:48.917 +03:00 [INF] Request finished HTTP/1.1 POST http://07ca-46-152-255-232.ngrok-free.app/api/proxy/forward?url=https://icreditdept.com/api/testasp/test_local_generate_otp.php - 200 200 application/json 13140.669ms
2025-02-02 21:42:58.783 +03:00 [INF] Request starting HTTP/1.1 POST http://07ca-46-152-255-232.ngrok-free.app/api/proxy/forward?url=https://icreditdept.com/api/testasp/test_local_verify_otp.php - application/json; charset=utf-8 53
2025-02-02 21:42:58.788 +03:00 [INF] Executing endpoint 'NayifatAPI.Controllers.ProxyController.ForwardRequest (NayifatAPI)'
2025-02-02 21:42:58.789 +03:00 [INF] Route matched with {action = "ForwardRequest", controller = "Proxy"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] ForwardRequest() on controller NayifatAPI.Controllers.ProxyController (NayifatAPI).
2025-02-02 21:42:58.790 +03:00 [INF] Start processing HTTP request POST https://icreditdept.com/api/testasp/test_local_verify_otp.php
2025-02-02 21:42:58.791 +03:00 [INF] Sending HTTP request POST https://icreditdept.com/api/testasp/test_local_verify_otp.php
2025-02-02 21:43:00.729 +03:00 [INF] Received HTTP response headers after 1937.0498ms - 200
2025-02-02 21:43:00.730 +03:00 [INF] End processing HTTP request after 1939.7411ms - 200
2025-02-02 21:43:00.731 +03:00 [INF] Raw response length: 202
2025-02-02 21:43:00.731 +03:00 [INF] Response content: {"success":true,"errors":[],"result":{"nationalId":"1064448614","otp":"425250","verifiedFlag":true,"successMsg":"Verified successfully.","errCode":0,"errMsg":null},"type":"N","message":null,"code":null}
2025-02-02 21:43:00.732 +03:00 [INF] Executing ContentResult with HTTP Response ContentType of application/json
2025-02-02 21:43:00.733 +03:00 [INF] Executed action NayifatAPI.Controllers.ProxyController.ForwardRequest (NayifatAPI) in 1942.9509ms
2025-02-02 21:43:00.734 +03:00 [INF] Executed endpoint 'NayifatAPI.Controllers.ProxyController.ForwardRequest (NayifatAPI)'
2025-02-02 21:43:00.735 +03:00 [INF] Request finished HTTP/1.1 POST http://07ca-46-152-255-232.ngrok-free.app/api/proxy/forward?url=https://icreditdept.com/api/testasp/test_local_verify_otp.php - 200 202 application/json 1952.0513ms
2025-02-02 21:43:09.771 +03:00 [INF] Request starting HTTP/1.1 POST http://07ca-46-152-255-232.ngrok-free.app/api/notifications/list - application/json; charset=utf-8 47
2025-02-02 21:43:09.773 +03:00 [INF] Executing endpoint 'NayifatAPI.Controllers.NotificationsController.GetNotifications (NayifatAPI)'
2025-02-02 21:43:09.774 +03:00 [INF] Route matched with {action = "GetNotifications", controller = "Notifications"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetNotifications(NayifatAPI.Controllers.GetNotificationsRequest) on controller NayifatAPI.Controllers.NotificationsController (NayifatAPI).
2025-02-02 21:43:09.779 +03:00 [INF] Executed DbCommand (2ms) [Parameters=[@__providedApiKey_0='?' (Size = 255)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [a].[Key], [a].[CreatedAt], [a].[Description], [a].[ExpiresAt], [a].[IsActive], [a].[LastUsedAt]
FROM [ApiKeys] AS [a]
WHERE [a].[Key] = @__providedApiKey_0 AND [a].[IsActive] = CAST(1 AS bit)
2025-02-02 21:43:09.783 +03:00 [INF] Executed DbCommand (2ms) [Parameters=[@__request_NationalId_0='?' (Size = 450)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [u].[national_id], [u].[last_updated], [u].[notifications]
FROM [user_notifications] AS [u]
WHERE [u].[national_id] = @__request_NationalId_0
2025-02-02 21:43:09.789 +03:00 [INF] Executed DbCommand (2ms) [Parameters=[@__Parse_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [n].[Id], [n].[additional_data], [n].[Body], [n].[body_ar], [n].[body_en], [n].[created_at], [n].[expiry_at], [n].[Route], [n].[target_criteria], [n].[Title], [n].[title_ar], [n].[title_en]
FROM [notification_templates] AS [n]
WHERE [n].[Id] = @__Parse_0
2025-02-02 21:43:09.793 +03:00 [INF] Executed DbCommand (0ms) [Parameters=[@__Parse_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [n].[Id], [n].[additional_data], [n].[Body], [n].[body_ar], [n].[body_en], [n].[created_at], [n].[expiry_at], [n].[Route], [n].[target_criteria], [n].[Title], [n].[title_ar], [n].[title_en]
FROM [notification_templates] AS [n]
WHERE [n].[Id] = @__Parse_0
2025-02-02 21:43:09.871 +03:00 [INF] Executed DbCommand (75ms) [Parameters=[@p0='?' (Size = 4000), @p1='?' (DbType = DateTime2), @p2='?' (Size = 4000), @p3='?' (Size = 4000), @p4='?' (Size = 4000), @p5='?' (Size = 450), @p6='?' (Size = 4000), @p7='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SET IMPLICIT_TRANSACTIONS OFF;
SET NOCOUNT ON;
INSERT INTO [AuthLogs] ([AuthType], [CreatedAt], [DeviceId], [FailureReason], [IpAddress], [NationalId], [Status], [UserAgent])
OUTPUT INSERTED.[Id]
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7);
2025-02-02 21:43:09.873 +03:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType9`2[[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Object, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-02-02 21:43:09.875 +03:00 [INF] Executed action NayifatAPI.Controllers.NotificationsController.GetNotifications (NayifatAPI) in 99.4501ms
2025-02-02 21:43:09.876 +03:00 [INF] Executed endpoint 'NayifatAPI.Controllers.NotificationsController.GetNotifications (NayifatAPI)'
2025-02-02 21:43:09.877 +03:00 [INF] Request finished HTTP/1.1 POST http://07ca-46-152-255-232.ngrok-free.app/api/notifications/list - 200 null application/json; charset=utf-8 106.2675ms
2025-02-02 21:43:30.260 +03:00 [INF] Request starting HTTP/1.1 POST http://07ca-46-152-255-232.ngrok-free.app/api/notifications/list - application/json; charset=utf-8 47
2025-02-02 21:43:30.264 +03:00 [INF] Executing endpoint 'NayifatAPI.Controllers.NotificationsController.GetNotifications (NayifatAPI)'
2025-02-02 21:43:30.265 +03:00 [INF] Route matched with {action = "GetNotifications", controller = "Notifications"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetNotifications(NayifatAPI.Controllers.GetNotificationsRequest) on controller NayifatAPI.Controllers.NotificationsController (NayifatAPI).
2025-02-02 21:43:30.270 +03:00 [INF] Executed DbCommand (2ms) [Parameters=[@__providedApiKey_0='?' (Size = 255)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [a].[Key], [a].[CreatedAt], [a].[Description], [a].[ExpiresAt], [a].[IsActive], [a].[LastUsedAt]
FROM [ApiKeys] AS [a]
WHERE [a].[Key] = @__providedApiKey_0 AND [a].[IsActive] = CAST(1 AS bit)
2025-02-02 21:43:30.275 +03:00 [INF] Executed DbCommand (3ms) [Parameters=[@__request_NationalId_0='?' (Size = 450)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [u].[national_id], [u].[last_updated], [u].[notifications]
FROM [user_notifications] AS [u]
WHERE [u].[national_id] = @__request_NationalId_0
2025-02-02 21:43:30.281 +03:00 [INF] Executed DbCommand (2ms) [Parameters=[@__Parse_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [n].[Id], [n].[additional_data], [n].[Body], [n].[body_ar], [n].[body_en], [n].[created_at], [n].[expiry_at], [n].[Route], [n].[target_criteria], [n].[Title], [n].[title_ar], [n].[title_en]
FROM [notification_templates] AS [n]
WHERE [n].[Id] = @__Parse_0
2025-02-02 21:43:30.284 +03:00 [INF] Executed DbCommand (0ms) [Parameters=[@__Parse_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [n].[Id], [n].[additional_data], [n].[Body], [n].[body_ar], [n].[body_en], [n].[created_at], [n].[expiry_at], [n].[Route], [n].[target_criteria], [n].[Title], [n].[title_ar], [n].[title_en]
FROM [notification_templates] AS [n]
WHERE [n].[Id] = @__Parse_0
2025-02-02 21:43:30.362 +03:00 [INF] Executed DbCommand (75ms) [Parameters=[@p0='?' (Size = 4000), @p1='?' (DbType = DateTime2), @p2='?' (Size = 4000), @p3='?' (Size = 4000), @p4='?' (Size = 4000), @p5='?' (Size = 450), @p6='?' (Size = 4000), @p7='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SET IMPLICIT_TRANSACTIONS OFF;
SET NOCOUNT ON;
INSERT INTO [AuthLogs] ([AuthType], [CreatedAt], [DeviceId], [FailureReason], [IpAddress], [NationalId], [Status], [UserAgent])
OUTPUT INSERTED.[Id]
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7);
2025-02-02 21:43:30.369 +03:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType9`2[[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Object, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-02-02 21:43:30.370 +03:00 [INF] Executed action NayifatAPI.Controllers.NotificationsController.GetNotifications (NayifatAPI) in 103.0475ms
2025-02-02 21:43:30.371 +03:00 [INF] Executed endpoint 'NayifatAPI.Controllers.NotificationsController.GetNotifications (NayifatAPI)'
2025-02-02 21:43:30.372 +03:00 [INF] Request finished HTTP/1.1 POST http://07ca-46-152-255-232.ngrok-free.app/api/notifications/list - 200 null application/json; charset=utf-8 111.7272ms
2025-02-02 21:43:56.797 +03:00 [INF] Request starting HTTP/1.1 POST http://07ca-46-152-255-232.ngrok-free.app/api/auth/signin - application/json; charset=utf-8 78
2025-02-02 21:43:56.801 +03:00 [INF] Executing endpoint 'NayifatAPI.Controllers.AuthController.SignIn (NayifatAPI)'
2025-02-02 21:43:56.801 +03:00 [INF] Route matched with {action = "SignIn", controller = "Auth"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] SignIn(NayifatAPI.Controllers.SignInRequest) on controller NayifatAPI.Controllers.AuthController (NayifatAPI).
2025-02-02 21:43:56.806 +03:00 [INF] Executed DbCommand (2ms) [Parameters=[@__providedApiKey_0='?' (Size = 255)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [a].[Key], [a].[CreatedAt], [a].[Description], [a].[ExpiresAt], [a].[IsActive], [a].[LastUsedAt]
FROM [ApiKeys] AS [a]
WHERE [a].[Key] = @__providedApiKey_0 AND [a].[IsActive] = CAST(1 AS bit)
2025-02-02 21:43:56.810 +03:00 [INF] Executed DbCommand (2ms) [Parameters=[@__request_NationalId_0='?' (Size = 450)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [c].[NationalId], [c].[AddNo], [c].[BuildingNo], [c].[City], [c].[Consent], [c].[ConsentDate], [c].[DateOfBirth], [c].[Dependents], [c].[District], [c].[Email], [c].[Employer], [c].[FamilyNameAr], [c].[FamilyNameEn], [c].[FirstNameAr], [c].[FirstNameEn], [c].[Iban], [c].[IdExpiryDate], [c].[Los], [c].[Mpin], [c].[MpinEnabled], [c].[NafathStatus], [c].[NafathTimestamp], [c].[Password], [c].[Phone], [c].[RegistrationDate], [c].[SalaryCustomer], [c].[SalaryDakhli], [c].[SecondNameAr], [c].[SecondNameEn], [c].[Sector], [c].[Street], [c].[ThirdNameAr], [c].[ThirdNameEn], [c].[Zipcode]
FROM [Customers] AS [c]
WHERE [c].[NationalId] = @__request_NationalId_0
2025-02-02 21:43:56.813 +03:00 [INF] Starting password verification for NationalId: 1064448614
2025-02-02 21:43:56.983 +03:00 [INF] Password verification result for NationalId 1064448614: Success
2025-02-02 21:43:56.992 +03:00 [INF] Executed DbCommand (8ms) [Parameters=[@p0='?' (Size = 4000), @p1='?' (DbType = DateTime2), @p2='?' (Size = 4000), @p3='?' (Size = 4000), @p4='?' (Size = 4000), @p5='?' (Size = 450), @p6='?' (Size = 4000), @p7='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SET IMPLICIT_TRANSACTIONS OFF;
SET NOCOUNT ON;
INSERT INTO [AuthLogs] ([AuthType], [CreatedAt], [DeviceId], [FailureReason], [IpAddress], [NationalId], [Status], [UserAgent])
OUTPUT INSERTED.[Id]
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7);
2025-02-02 21:43:56.995 +03:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType9`2[[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Object, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-02-02 21:43:56.996 +03:00 [INF] Executed action NayifatAPI.Controllers.AuthController.SignIn (NayifatAPI) in 192.9696ms
2025-02-02 21:43:56.997 +03:00 [INF] Executed endpoint 'NayifatAPI.Controllers.AuthController.SignIn (NayifatAPI)'
2025-02-02 21:43:56.998 +03:00 [INF] Request finished HTTP/1.1 POST http://07ca-46-152-255-232.ngrok-free.app/api/auth/signin - 200 null application/json; charset=utf-8 200.6733ms
2025-02-02 21:43:59.672 +03:00 [INF] Request starting HTTP/1.1 POST http://07ca-46-152-255-232.ngrok-free.app/api/proxy/forward?url=https://icreditdept.com/api/testasp/test_local_generate_otp.php - application/json; charset=utf-8 84
2025-02-02 21:43:59.674 +03:00 [INF] Executing endpoint 'NayifatAPI.Controllers.ProxyController.ForwardRequest (NayifatAPI)'
2025-02-02 21:43:59.675 +03:00 [INF] Route matched with {action = "ForwardRequest", controller = "Proxy"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] ForwardRequest() on controller NayifatAPI.Controllers.ProxyController (NayifatAPI).
2025-02-02 21:43:59.677 +03:00 [INF] Start processing HTTP request POST https://icreditdept.com/api/testasp/test_local_generate_otp.php
2025-02-02 21:43:59.678 +03:00 [INF] Sending HTTP request POST https://icreditdept.com/api/testasp/test_local_generate_otp.php
2025-02-02 21:44:20.409 +03:00 [INF] Received HTTP response headers after 20729.4347ms - 200
2025-02-02 21:44:20.413 +03:00 [INF] End processing HTTP request after 20735.9936ms - 200
2025-02-02 21:44:20.414 +03:00 [INF] Raw response length: 200
2025-02-02 21:44:20.415 +03:00 [INF] Response content: {"success":true,"errors":[],"result":{"nationalId":"1064448614","otp":314253,"expiryDate":"2025-02-02 21:49:01","successMsg":"Success","errCode":0,"errMsg":null},"type":"N","message":null,"code":null}
2025-02-02 21:44:20.416 +03:00 [INF] Executing ContentResult with HTTP Response ContentType of application/json
2025-02-02 21:44:20.416 +03:00 [INF] Executed action NayifatAPI.Controllers.ProxyController.ForwardRequest (NayifatAPI) in 20740.1911ms
2025-02-02 21:44:20.418 +03:00 [INF] Executed endpoint 'NayifatAPI.Controllers.ProxyController.ForwardRequest (NayifatAPI)'
2025-02-02 21:44:20.420 +03:00 [INF] Request finished HTTP/1.1 POST http://07ca-46-152-255-232.ngrok-free.app/api/proxy/forward?url=https://icreditdept.com/api/testasp/test_local_generate_otp.php - 200 200 application/json 20748.5256ms
2025-02-02 21:44:29.471 +03:00 [INF] Request starting HTTP/1.1 POST http://07ca-46-152-255-232.ngrok-free.app/api/proxy/forward?url=https://icreditdept.com/api/testasp/test_local_verify_otp.php - application/json; charset=utf-8 53
2025-02-02 21:44:29.474 +03:00 [INF] Executing endpoint 'NayifatAPI.Controllers.ProxyController.ForwardRequest (NayifatAPI)'
2025-02-02 21:44:29.475 +03:00 [INF] Route matched with {action = "ForwardRequest", controller = "Proxy"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] ForwardRequest() on controller NayifatAPI.Controllers.ProxyController (NayifatAPI).
2025-02-02 21:44:29.476 +03:00 [INF] Start processing HTTP request POST https://icreditdept.com/api/testasp/test_local_verify_otp.php
2025-02-02 21:44:29.477 +03:00 [INF] Sending HTTP request POST https://icreditdept.com/api/testasp/test_local_verify_otp.php
2025-02-02 21:44:30.223 +03:00 [INF] Received HTTP response headers after 744.5924ms - 200
2025-02-02 21:44:30.224 +03:00 [INF] End processing HTTP request after 747.5498ms - 200
2025-02-02 21:44:30.225 +03:00 [INF] Raw response length: 202
2025-02-02 21:44:30.226 +03:00 [INF] Response content: {"success":true,"errors":[],"result":{"nationalId":"1064448614","otp":"314253","verifiedFlag":true,"successMsg":"Verified successfully.","errCode":0,"errMsg":null},"type":"N","message":null,"code":null}
2025-02-02 21:44:30.227 +03:00 [INF] Executing ContentResult with HTTP Response ContentType of application/json
2025-02-02 21:44:30.227 +03:00 [INF] Executed action NayifatAPI.Controllers.ProxyController.ForwardRequest (NayifatAPI) in 751.0925ms
2025-02-02 21:44:30.229 +03:00 [INF] Executed endpoint 'NayifatAPI.Controllers.ProxyController.ForwardRequest (NayifatAPI)'
2025-02-02 21:44:30.230 +03:00 [INF] Request finished HTTP/1.1 POST http://07ca-46-152-255-232.ngrok-free.app/api/proxy/forward?url=https://icreditdept.com/api/testasp/test_local_verify_otp.php - 200 202 application/json 758.982ms
2025-02-02 21:44:41.130 +03:00 [INF] Request starting HTTP/1.1 POST http://07ca-46-152-255-232.ngrok-free.app/api/notifications/list - application/json; charset=utf-8 47
2025-02-02 21:44:41.134 +03:00 [INF] Executing endpoint 'NayifatAPI.Controllers.NotificationsController.GetNotifications (NayifatAPI)'
2025-02-02 21:44:41.135 +03:00 [INF] Route matched with {action = "GetNotifications", controller = "Notifications"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetNotifications(NayifatAPI.Controllers.GetNotificationsRequest) on controller NayifatAPI.Controllers.NotificationsController (NayifatAPI).
2025-02-02 21:44:41.141 +03:00 [INF] Executed DbCommand (3ms) [Parameters=[@__providedApiKey_0='?' (Size = 255)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [a].[Key], [a].[CreatedAt], [a].[Description], [a].[ExpiresAt], [a].[IsActive], [a].[LastUsedAt]
FROM [ApiKeys] AS [a]
WHERE [a].[Key] = @__providedApiKey_0 AND [a].[IsActive] = CAST(1 AS bit)
2025-02-02 21:44:41.145 +03:00 [INF] Executed DbCommand (2ms) [Parameters=[@__request_NationalId_0='?' (Size = 450)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [u].[national_id], [u].[last_updated], [u].[notifications]
FROM [user_notifications] AS [u]
WHERE [u].[national_id] = @__request_NationalId_0
2025-02-02 21:44:41.149 +03:00 [INF] Executed DbCommand (2ms) [Parameters=[@__Parse_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [n].[Id], [n].[additional_data], [n].[Body], [n].[body_ar], [n].[body_en], [n].[created_at], [n].[expiry_at], [n].[Route], [n].[target_criteria], [n].[Title], [n].[title_ar], [n].[title_en]
FROM [notification_templates] AS [n]
WHERE [n].[Id] = @__Parse_0
2025-02-02 21:44:41.152 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@__Parse_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [n].[Id], [n].[additional_data], [n].[Body], [n].[body_ar], [n].[body_en], [n].[created_at], [n].[expiry_at], [n].[Route], [n].[target_criteria], [n].[Title], [n].[title_ar], [n].[title_en]
FROM [notification_templates] AS [n]
WHERE [n].[Id] = @__Parse_0
2025-02-02 21:44:41.163 +03:00 [INF] Executed DbCommand (8ms) [Parameters=[@p0='?' (Size = 4000), @p1='?' (DbType = DateTime2), @p2='?' (Size = 4000), @p3='?' (Size = 4000), @p4='?' (Size = 4000), @p5='?' (Size = 450), @p6='?' (Size = 4000), @p7='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SET IMPLICIT_TRANSACTIONS OFF;
SET NOCOUNT ON;
INSERT INTO [AuthLogs] ([AuthType], [CreatedAt], [DeviceId], [FailureReason], [IpAddress], [NationalId], [Status], [UserAgent])
OUTPUT INSERTED.[Id]
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7);
2025-02-02 21:44:41.166 +03:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType9`2[[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Object, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-02-02 21:44:41.167 +03:00 [INF] Executed action NayifatAPI.Controllers.NotificationsController.GetNotifications (NayifatAPI) in 30.6442ms
2025-02-02 21:44:41.168 +03:00 [INF] Executed endpoint 'NayifatAPI.Controllers.NotificationsController.GetNotifications (NayifatAPI)'
2025-02-02 21:44:41.170 +03:00 [INF] Request finished HTTP/1.1 POST http://07ca-46-152-255-232.ngrok-free.app/api/notifications/list - 200 null application/json; charset=utf-8 39.1389ms
2025-02-02 21:45:05.073 +03:00 [INF] Request starting HTTP/1.1 POST http://07ca-46-152-255-232.ngrok-free.app/api/notifications/list - application/json; charset=utf-8 47
2025-02-02 21:45:05.076 +03:00 [INF] Executing endpoint 'NayifatAPI.Controllers.NotificationsController.GetNotifications (NayifatAPI)'
2025-02-02 21:45:05.078 +03:00 [INF] Route matched with {action = "GetNotifications", controller = "Notifications"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetNotifications(NayifatAPI.Controllers.GetNotificationsRequest) on controller NayifatAPI.Controllers.NotificationsController (NayifatAPI).
2025-02-02 21:45:05.084 +03:00 [INF] Executed DbCommand (3ms) [Parameters=[@__providedApiKey_0='?' (Size = 255)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [a].[Key], [a].[CreatedAt], [a].[Description], [a].[ExpiresAt], [a].[IsActive], [a].[LastUsedAt]
FROM [ApiKeys] AS [a]
WHERE [a].[Key] = @__providedApiKey_0 AND [a].[IsActive] = CAST(1 AS bit)
2025-02-02 21:45:05.088 +03:00 [INF] Executed DbCommand (2ms) [Parameters=[@__request_NationalId_0='?' (Size = 450)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [u].[national_id], [u].[last_updated], [u].[notifications]
FROM [user_notifications] AS [u]
WHERE [u].[national_id] = @__request_NationalId_0
2025-02-02 21:45:05.093 +03:00 [INF] Executed DbCommand (2ms) [Parameters=[@__Parse_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [n].[Id], [n].[additional_data], [n].[Body], [n].[body_ar], [n].[body_en], [n].[created_at], [n].[expiry_at], [n].[Route], [n].[target_criteria], [n].[Title], [n].[title_ar], [n].[title_en]
FROM [notification_templates] AS [n]
WHERE [n].[Id] = @__Parse_0
2025-02-02 21:45:05.097 +03:00 [INF] Executed DbCommand (0ms) [Parameters=[@__Parse_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [n].[Id], [n].[additional_data], [n].[Body], [n].[body_ar], [n].[body_en], [n].[created_at], [n].[expiry_at], [n].[Route], [n].[target_criteria], [n].[Title], [n].[title_ar], [n].[title_en]
FROM [notification_templates] AS [n]
WHERE [n].[Id] = @__Parse_0
2025-02-02 21:45:05.107 +03:00 [INF] Executed DbCommand (8ms) [Parameters=[@p0='?' (Size = 4000), @p1='?' (DbType = DateTime2), @p2='?' (Size = 4000), @p3='?' (Size = 4000), @p4='?' (Size = 4000), @p5='?' (Size = 450), @p6='?' (Size = 4000), @p7='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SET IMPLICIT_TRANSACTIONS OFF;
SET NOCOUNT ON;
INSERT INTO [AuthLogs] ([AuthType], [CreatedAt], [DeviceId], [FailureReason], [IpAddress], [NationalId], [Status], [UserAgent])
OUTPUT INSERTED.[Id]
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7);
2025-02-02 21:45:05.110 +03:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType9`2[[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Object, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-02-02 21:45:05.112 +03:00 [INF] Executed action NayifatAPI.Controllers.NotificationsController.GetNotifications (NayifatAPI) in 31.9966ms
2025-02-02 21:45:05.113 +03:00 [INF] Executed endpoint 'NayifatAPI.Controllers.NotificationsController.GetNotifications (NayifatAPI)'
2025-02-02 21:45:05.114 +03:00 [INF] Request finished HTTP/1.1 POST http://07ca-46-152-255-232.ngrok-free.app/api/notifications/list - 200 null application/json; charset=utf-8 41.433ms
2025-02-02 21:45:09.141 +03:00 [INF] Request starting HTTP/1.1 POST http://07ca-46-152-255-232.ngrok-free.app/api/notifications/list - application/json; charset=utf-8 47
2025-02-02 21:45:09.149 +03:00 [INF] Executing endpoint 'NayifatAPI.Controllers.NotificationsController.GetNotifications (NayifatAPI)'
2025-02-02 21:45:09.150 +03:00 [INF] Route matched with {action = "GetNotifications", controller = "Notifications"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetNotifications(NayifatAPI.Controllers.GetNotificationsRequest) on controller NayifatAPI.Controllers.NotificationsController (NayifatAPI).
2025-02-02 21:45:09.152 +03:00 [INF] Executed DbCommand (0ms) [Parameters=[@__providedApiKey_0='?' (Size = 255)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [a].[Key], [a].[CreatedAt], [a].[Description], [a].[ExpiresAt], [a].[IsActive], [a].[LastUsedAt]
FROM [ApiKeys] AS [a]
WHERE [a].[Key] = @__providedApiKey_0 AND [a].[IsActive] = CAST(1 AS bit)
2025-02-02 21:45:09.155 +03:00 [INF] Executed DbCommand (0ms) [Parameters=[@__request_NationalId_0='?' (Size = 450)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [u].[national_id], [u].[last_updated], [u].[notifications]
FROM [user_notifications] AS [u]
WHERE [u].[national_id] = @__request_NationalId_0
2025-02-02 21:45:09.158 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@__Parse_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [n].[Id], [n].[additional_data], [n].[Body], [n].[body_ar], [n].[body_en], [n].[created_at], [n].[expiry_at], [n].[Route], [n].[target_criteria], [n].[Title], [n].[title_ar], [n].[title_en]
FROM [notification_templates] AS [n]
WHERE [n].[Id] = @__Parse_0
2025-02-02 21:45:09.163 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@__Parse_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [n].[Id], [n].[additional_data], [n].[Body], [n].[body_ar], [n].[body_en], [n].[created_at], [n].[expiry_at], [n].[Route], [n].[target_criteria], [n].[Title], [n].[title_ar], [n].[title_en]
FROM [notification_templates] AS [n]
WHERE [n].[Id] = @__Parse_0
2025-02-02 21:45:09.238 +03:00 [INF] Executed DbCommand (73ms) [Parameters=[@p0='?' (Size = 4000), @p1='?' (DbType = DateTime2), @p2='?' (Size = 4000), @p3='?' (Size = 4000), @p4='?' (Size = 4000), @p5='?' (Size = 450), @p6='?' (Size = 4000), @p7='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SET IMPLICIT_TRANSACTIONS OFF;
SET NOCOUNT ON;
INSERT INTO [AuthLogs] ([AuthType], [CreatedAt], [DeviceId], [FailureReason], [IpAddress], [NationalId], [Status], [UserAgent])
OUTPUT INSERTED.[Id]
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7);
2025-02-02 21:45:09.241 +03:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType9`2[[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Object, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-02-02 21:45:09.242 +03:00 [INF] Executed action NayifatAPI.Controllers.NotificationsController.GetNotifications (NayifatAPI) in 91.5058ms
2025-02-02 21:45:09.244 +03:00 [INF] Executed endpoint 'NayifatAPI.Controllers.NotificationsController.GetNotifications (NayifatAPI)'
2025-02-02 21:45:09.245 +03:00 [INF] Request finished HTTP/1.1 POST http://07ca-46-152-255-232.ngrok-free.app/api/notifications/list - 200 null application/json; charset=utf-8 103.9101ms
2025-02-02 21:46:19.677 +03:00 [INF] Request starting HTTP/1.1 POST http://07ca-46-152-255-232.ngrok-free.app/api/notifications/list - application/json; charset=utf-8 47
2025-02-02 21:46:19.681 +03:00 [INF] Executing endpoint 'NayifatAPI.Controllers.NotificationsController.GetNotifications (NayifatAPI)'
2025-02-02 21:46:19.682 +03:00 [INF] Route matched with {action = "GetNotifications", controller = "Notifications"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetNotifications(NayifatAPI.Controllers.GetNotificationsRequest) on controller NayifatAPI.Controllers.NotificationsController (NayifatAPI).
2025-02-02 21:46:19.686 +03:00 [INF] Executed DbCommand (2ms) [Parameters=[@__providedApiKey_0='?' (Size = 255)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [a].[Key], [a].[CreatedAt], [a].[Description], [a].[ExpiresAt], [a].[IsActive], [a].[LastUsedAt]
FROM [ApiKeys] AS [a]
WHERE [a].[Key] = @__providedApiKey_0 AND [a].[IsActive] = CAST(1 AS bit)
2025-02-02 21:46:19.690 +03:00 [INF] Executed DbCommand (2ms) [Parameters=[@__request_NationalId_0='?' (Size = 450)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [u].[national_id], [u].[last_updated], [u].[notifications]
FROM [user_notifications] AS [u]
WHERE [u].[national_id] = @__request_NationalId_0
2025-02-02 21:46:19.694 +03:00 [INF] Executed DbCommand (2ms) [Parameters=[@__Parse_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [n].[Id], [n].[additional_data], [n].[Body], [n].[body_ar], [n].[body_en], [n].[created_at], [n].[expiry_at], [n].[Route], [n].[target_criteria], [n].[Title], [n].[title_ar], [n].[title_en]
FROM [notification_templates] AS [n]
WHERE [n].[Id] = @__Parse_0
2025-02-02 21:46:19.697 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@__Parse_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [n].[Id], [n].[additional_data], [n].[Body], [n].[body_ar], [n].[body_en], [n].[created_at], [n].[expiry_at], [n].[Route], [n].[target_criteria], [n].[Title], [n].[title_ar], [n].[title_en]
FROM [notification_templates] AS [n]
WHERE [n].[Id] = @__Parse_0
2025-02-02 21:46:19.775 +03:00 [INF] Executed DbCommand (76ms) [Parameters=[@p0='?' (Size = 4000), @p1='?' (DbType = DateTime2), @p2='?' (Size = 4000), @p3='?' (Size = 4000), @p4='?' (Size = 4000), @p5='?' (Size = 450), @p6='?' (Size = 4000), @p7='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SET IMPLICIT_TRANSACTIONS OFF;
SET NOCOUNT ON;
INSERT INTO [AuthLogs] ([AuthType], [CreatedAt], [DeviceId], [FailureReason], [IpAddress], [NationalId], [Status], [UserAgent])
OUTPUT INSERTED.[Id]
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7);
2025-02-02 21:46:19.777 +03:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType9`2[[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Object, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-02-02 21:46:19.777 +03:00 [INF] Executed action NayifatAPI.Controllers.NotificationsController.GetNotifications (NayifatAPI) in 94.4387ms
2025-02-02 21:46:19.778 +03:00 [INF] Executed endpoint 'NayifatAPI.Controllers.NotificationsController.GetNotifications (NayifatAPI)'
2025-02-02 21:46:19.779 +03:00 [INF] Request finished HTTP/1.1 POST http://07ca-46-152-255-232.ngrok-free.app/api/notifications/list - 200 null application/json; charset=utf-8 101.8487ms
2025-02-02 21:47:35.984 +03:00 [INF] Request starting HTTP/1.1 POST http://07ca-46-152-255-232.ngrok-free.app/api/notifications/list - application/json; charset=utf-8 47
2025-02-02 21:47:36.051 +03:00 [INF] Executing endpoint 'NayifatAPI.Controllers.NotificationsController.GetNotifications (NayifatAPI)'
2025-02-02 21:47:36.086 +03:00 [INF] Route matched with {action = "GetNotifications", controller = "Notifications"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetNotifications(NayifatAPI.Controllers.GetNotificationsRequest) on controller NayifatAPI.Controllers.NotificationsController (NayifatAPI).
2025-02-02 21:47:36.152 +03:00 [INF] Executed DbCommand (4ms) [Parameters=[@__providedApiKey_0='?' (Size = 255)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [a].[Key], [a].[CreatedAt], [a].[Description], [a].[ExpiresAt], [a].[IsActive], [a].[LastUsedAt]
FROM [ApiKeys] AS [a]
WHERE [a].[Key] = @__providedApiKey_0 AND [a].[IsActive] = CAST(1 AS bit)
2025-02-02 21:47:36.163 +03:00 [INF] Executed DbCommand (8ms) [Parameters=[@__request_NationalId_0='?' (Size = 450)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [u].[national_id], [u].[last_updated], [u].[notifications]
FROM [user_notifications] AS [u]
WHERE [u].[national_id] = @__request_NationalId_0
2025-02-02 21:47:36.170 +03:00 [INF] Executed DbCommand (4ms) [Parameters=[@__Parse_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [n].[Id], [n].[additional_data], [n].[Body], [n].[body_ar], [n].[body_en], [n].[created_at], [n].[expiry_at], [n].[Route], [n].[target_criteria], [n].[Title], [n].[title_ar], [n].[title_en]
FROM [notification_templates] AS [n]
WHERE [n].[Id] = @__Parse_0
2025-02-02 21:47:36.175 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@__Parse_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [n].[Id], [n].[additional_data], [n].[Body], [n].[body_ar], [n].[body_en], [n].[created_at], [n].[expiry_at], [n].[Route], [n].[target_criteria], [n].[Title], [n].[title_ar], [n].[title_en]
FROM [notification_templates] AS [n]
WHERE [n].[Id] = @__Parse_0
2025-02-02 21:47:36.286 +03:00 [INF] Executed DbCommand (107ms) [Parameters=[@p0='?' (Size = 4000), @p1='?' (DbType = DateTime2), @p2='?' (Size = 4000), @p3='?' (Size = 4000), @p4='?' (Size = 4000), @p5='?' (Size = 450), @p6='?' (Size = 4000), @p7='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SET IMPLICIT_TRANSACTIONS OFF;
SET NOCOUNT ON;
INSERT INTO [AuthLogs] ([AuthType], [CreatedAt], [DeviceId], [FailureReason], [IpAddress], [NationalId], [Status], [UserAgent])
OUTPUT INSERTED.[Id]
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7);
2025-02-02 21:47:36.599 +03:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType9`2[[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Object, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-02-02 21:47:36.602 +03:00 [INF] Executed action NayifatAPI.Controllers.NotificationsController.GetNotifications (NayifatAPI) in 456.626ms
2025-02-02 21:47:36.604 +03:00 [INF] Executed endpoint 'NayifatAPI.Controllers.NotificationsController.GetNotifications (NayifatAPI)'
2025-02-02 21:47:36.606 +03:00 [INF] Request finished HTTP/1.1 POST http://07ca-46-152-255-232.ngrok-free.app/api/notifications/list - 200 null application/json; charset=utf-8 621.2966ms
2025-02-02 21:47:45.961 +03:00 [INF] Request starting HTTP/1.1 POST http://07ca-46-152-255-232.ngrok-free.app/api/auth/signin - application/json; charset=utf-8 78
2025-02-02 21:47:45.965 +03:00 [INF] Executing endpoint 'NayifatAPI.Controllers.AuthController.SignIn (NayifatAPI)'
2025-02-02 21:47:45.965 +03:00 [INF] Route matched with {action = "SignIn", controller = "Auth"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] SignIn(NayifatAPI.Controllers.SignInRequest) on controller NayifatAPI.Controllers.AuthController (NayifatAPI).
2025-02-02 21:47:45.969 +03:00 [INF] Executed DbCommand (0ms) [Parameters=[@__providedApiKey_0='?' (Size = 255)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [a].[Key], [a].[CreatedAt], [a].[Description], [a].[ExpiresAt], [a].[IsActive], [a].[LastUsedAt]
FROM [ApiKeys] AS [a]
WHERE [a].[Key] = @__providedApiKey_0 AND [a].[IsActive] = CAST(1 AS bit)
2025-02-02 21:47:45.973 +03:00 [INF] Executed DbCommand (2ms) [Parameters=[@__request_NationalId_0='?' (Size = 450)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [c].[NationalId], [c].[AddNo], [c].[BuildingNo], [c].[City], [c].[Consent], [c].[ConsentDate], [c].[DateOfBirth], [c].[Dependents], [c].[District], [c].[Email], [c].[Employer], [c].[FamilyNameAr], [c].[FamilyNameEn], [c].[FirstNameAr], [c].[FirstNameEn], [c].[Iban], [c].[IdExpiryDate], [c].[Los], [c].[Mpin], [c].[MpinEnabled], [c].[NafathStatus], [c].[NafathTimestamp], [c].[Password], [c].[Phone], [c].[RegistrationDate], [c].[SalaryCustomer], [c].[SalaryDakhli], [c].[SecondNameAr], [c].[SecondNameEn], [c].[Sector], [c].[Street], [c].[ThirdNameAr], [c].[ThirdNameEn], [c].[Zipcode]
FROM [Customers] AS [c]
WHERE [c].[NationalId] = @__request_NationalId_0
2025-02-02 21:47:45.975 +03:00 [INF] Starting password verification for NationalId: 1064448614
2025-02-02 21:47:46.159 +03:00 [INF] Password verification result for NationalId 1064448614: Success
2025-02-02 21:47:46.166 +03:00 [INF] Executed DbCommand (6ms) [Parameters=[@p0='?' (Size = 4000), @p1='?' (DbType = DateTime2), @p2='?' (Size = 4000), @p3='?' (Size = 4000), @p4='?' (Size = 4000), @p5='?' (Size = 450), @p6='?' (Size = 4000), @p7='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SET IMPLICIT_TRANSACTIONS OFF;
SET NOCOUNT ON;
INSERT INTO [AuthLogs] ([AuthType], [CreatedAt], [DeviceId], [FailureReason], [IpAddress], [NationalId], [Status], [UserAgent])
OUTPUT INSERTED.[Id]
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7);
2025-02-02 21:47:46.169 +03:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType9`2[[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Object, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-02-02 21:47:46.170 +03:00 [INF] Executed action NayifatAPI.Controllers.AuthController.SignIn (NayifatAPI) in 203.0459ms
2025-02-02 21:47:46.171 +03:00 [INF] Executed endpoint 'NayifatAPI.Controllers.AuthController.SignIn (NayifatAPI)'
2025-02-02 21:47:46.172 +03:00 [INF] Request finished HTTP/1.1 POST http://07ca-46-152-255-232.ngrok-free.app/api/auth/signin - 200 null application/json; charset=utf-8 211.1009ms
2025-02-02 21:47:47.121 +03:00 [INF] Request starting HTTP/1.1 POST http://07ca-46-152-255-232.ngrok-free.app/api/proxy/forward?url=https://icreditdept.com/api/testasp/test_local_generate_otp.php - application/json; charset=utf-8 84
2025-02-02 21:47:47.124 +03:00 [INF] Executing endpoint 'NayifatAPI.Controllers.ProxyController.ForwardRequest (NayifatAPI)'
2025-02-02 21:47:47.125 +03:00 [INF] Route matched with {action = "ForwardRequest", controller = "Proxy"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] ForwardRequest() on controller NayifatAPI.Controllers.ProxyController (NayifatAPI).
2025-02-02 21:47:47.126 +03:00 [INF] Start processing HTTP request POST https://icreditdept.com/api/testasp/test_local_generate_otp.php
2025-02-02 21:47:47.127 +03:00 [INF] Sending HTTP request POST https://icreditdept.com/api/testasp/test_local_generate_otp.php
2025-02-02 21:47:47.882 +03:00 [INF] Received HTTP response headers after 753.9087ms - 200
2025-02-02 21:47:47.883 +03:00 [INF] End processing HTTP request after 756.571ms - 200
2025-02-02 21:47:47.884 +03:00 [INF] Raw response length: 200
2025-02-02 21:47:47.885 +03:00 [INF] Response content: {"success":true,"errors":[],"result":{"nationalId":"1064448614","otp":430359,"expiryDate":"2025-02-02 21:52:48","successMsg":"Success","errCode":0,"errMsg":null},"type":"N","message":null,"code":null}
2025-02-02 21:47:47.887 +03:00 [INF] Executing ContentResult with HTTP Response ContentType of application/json
2025-02-02 21:47:47.889 +03:00 [INF] Executed action NayifatAPI.Controllers.ProxyController.ForwardRequest (NayifatAPI) in 762.2521ms
2025-02-02 21:47:47.890 +03:00 [INF] Executed endpoint 'NayifatAPI.Controllers.ProxyController.ForwardRequest (NayifatAPI)'
2025-02-02 21:47:47.891 +03:00 [INF] Request finished HTTP/1.1 POST http://07ca-46-152-255-232.ngrok-free.app/api/proxy/forward?url=https://icreditdept.com/api/testasp/test_local_generate_otp.php - 200 200 application/json 770.4439ms
2025-02-02 21:47:55.992 +03:00 [INF] Request starting HTTP/1.1 POST http://07ca-46-152-255-232.ngrok-free.app/api/proxy/forward?url=https://icreditdept.com/api/testasp/test_local_verify_otp.php - application/json; charset=utf-8 53
2025-02-02 21:47:56.001 +03:00 [INF] Executing endpoint 'NayifatAPI.Controllers.ProxyController.ForwardRequest (NayifatAPI)'
2025-02-02 21:47:56.001 +03:00 [INF] Route matched with {action = "ForwardRequest", controller = "Proxy"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] ForwardRequest() on controller NayifatAPI.Controllers.ProxyController (NayifatAPI).
2025-02-02 21:47:56.003 +03:00 [INF] Start processing HTTP request POST https://icreditdept.com/api/testasp/test_local_verify_otp.php
2025-02-02 21:47:56.004 +03:00 [INF] Sending HTTP request POST https://icreditdept.com/api/testasp/test_local_verify_otp.php
2025-02-02 21:47:56.433 +03:00 [INF] Received HTTP response headers after 427.3832ms - 200
2025-02-02 21:47:56.435 +03:00 [INF] End processing HTTP request after 431.5632ms - 200
2025-02-02 21:47:56.436 +03:00 [INF] Raw response length: 202
2025-02-02 21:47:56.436 +03:00 [INF] Response content: {"success":true,"errors":[],"result":{"nationalId":"1064448614","otp":"430359","verifiedFlag":true,"successMsg":"Verified successfully.","errCode":0,"errMsg":null},"type":"N","message":null,"code":null}
2025-02-02 21:47:56.437 +03:00 [INF] Executing ContentResult with HTTP Response ContentType of application/json
2025-02-02 21:47:56.439 +03:00 [INF] Executed action NayifatAPI.Controllers.ProxyController.ForwardRequest (NayifatAPI) in 436.0064ms
2025-02-02 21:47:56.443 +03:00 [INF] Executed endpoint 'NayifatAPI.Controllers.ProxyController.ForwardRequest (NayifatAPI)'
2025-02-02 21:47:56.444 +03:00 [INF] Request finished HTTP/1.1 POST http://07ca-46-152-255-232.ngrok-free.app/api/proxy/forward?url=https://icreditdept.com/api/testasp/test_local_verify_otp.php - 200 202 application/json 451.1833ms
2025-02-02 21:48:04.616 +03:00 [INF] Request starting HTTP/1.1 POST http://07ca-46-152-255-232.ngrok-free.app/api/notifications/list - application/json; charset=utf-8 47
2025-02-02 21:48:04.872 +03:00 [INF] Executing endpoint 'NayifatAPI.Controllers.NotificationsController.GetNotifications (NayifatAPI)'
2025-02-02 21:48:04.873 +03:00 [INF] Route matched with {action = "GetNotifications", controller = "Notifications"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetNotifications(NayifatAPI.Controllers.GetNotificationsRequest) on controller NayifatAPI.Controllers.NotificationsController (NayifatAPI).
2025-02-02 21:48:04.880 +03:00 [INF] Executed DbCommand (3ms) [Parameters=[@__providedApiKey_0='?' (Size = 255)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [a].[Key], [a].[CreatedAt], [a].[Description], [a].[ExpiresAt], [a].[IsActive], [a].[LastUsedAt]
FROM [ApiKeys] AS [a]
WHERE [a].[Key] = @__providedApiKey_0 AND [a].[IsActive] = CAST(1 AS bit)
2025-02-02 21:48:04.885 +03:00 [INF] Executed DbCommand (3ms) [Parameters=[@__request_NationalId_0='?' (Size = 450)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [u].[national_id], [u].[last_updated], [u].[notifications]
FROM [user_notifications] AS [u]
WHERE [u].[national_id] = @__request_NationalId_0
2025-02-02 21:48:05.128 +03:00 [INF] Executed DbCommand (21ms) [Parameters=[@__Parse_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [n].[Id], [n].[additional_data], [n].[Body], [n].[body_ar], [n].[body_en], [n].[created_at], [n].[expiry_at], [n].[Route], [n].[target_criteria], [n].[Title], [n].[title_ar], [n].[title_en]
FROM [notification_templates] AS [n]
WHERE [n].[Id] = @__Parse_0
2025-02-02 21:48:05.203 +03:00 [INF] Executed DbCommand (4ms) [Parameters=[@__Parse_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [n].[Id], [n].[additional_data], [n].[Body], [n].[body_ar], [n].[body_en], [n].[created_at], [n].[expiry_at], [n].[Route], [n].[target_criteria], [n].[Title], [n].[title_ar], [n].[title_en]
FROM [notification_templates] AS [n]
WHERE [n].[Id] = @__Parse_0
2025-02-02 21:48:05.326 +03:00 [INF] Executed DbCommand (121ms) [Parameters=[@p0='?' (Size = 4000), @p1='?' (DbType = DateTime2), @p2='?' (Size = 4000), @p3='?' (Size = 4000), @p4='?' (Size = 4000), @p5='?' (Size = 450), @p6='?' (Size = 4000), @p7='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SET IMPLICIT_TRANSACTIONS OFF;
SET NOCOUNT ON;
INSERT INTO [AuthLogs] ([AuthType], [CreatedAt], [DeviceId], [FailureReason], [IpAddress], [NationalId], [Status], [UserAgent])
OUTPUT INSERTED.[Id]
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7);
2025-02-02 21:48:05.570 +03:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType9`2[[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Object, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-02-02 21:48:05.572 +03:00 [INF] Executed action NayifatAPI.Controllers.NotificationsController.GetNotifications (NayifatAPI) in 696.9309ms
2025-02-02 21:48:05.573 +03:00 [INF] Executed endpoint 'NayifatAPI.Controllers.NotificationsController.GetNotifications (NayifatAPI)'
2025-02-02 21:48:05.574 +03:00 [INF] Request finished HTTP/1.1 POST http://07ca-46-152-255-232.ngrok-free.app/api/notifications/list - 200 null application/json; charset=utf-8 958.0046ms
2025-02-02 21:50:39.902 +03:00 [INF] Request starting HTTP/1.1 POST http://07ca-46-152-255-232.ngrok-free.app/api/notifications/list - application/json; charset=utf-8 47
2025-02-02 21:50:39.941 +03:00 [INF] Executing endpoint 'NayifatAPI.Controllers.NotificationsController.GetNotifications (NayifatAPI)'
2025-02-02 21:50:39.942 +03:00 [INF] Route matched with {action = "GetNotifications", controller = "Notifications"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetNotifications(NayifatAPI.Controllers.GetNotificationsRequest) on controller NayifatAPI.Controllers.NotificationsController (NayifatAPI).
2025-02-02 21:50:39.949 +03:00 [INF] Executed DbCommand (3ms) [Parameters=[@__providedApiKey_0='?' (Size = 255)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [a].[Key], [a].[CreatedAt], [a].[Description], [a].[ExpiresAt], [a].[IsActive], [a].[LastUsedAt]
FROM [ApiKeys] AS [a]
WHERE [a].[Key] = @__providedApiKey_0 AND [a].[IsActive] = CAST(1 AS bit)
2025-02-02 21:50:39.954 +03:00 [INF] Executed DbCommand (2ms) [Parameters=[@__request_NationalId_0='?' (Size = 450)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [u].[national_id], [u].[last_updated], [u].[notifications]
FROM [user_notifications] AS [u]
WHERE [u].[national_id] = @__request_NationalId_0
2025-02-02 21:50:39.959 +03:00 [INF] Executed DbCommand (2ms) [Parameters=[@__Parse_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [n].[Id], [n].[additional_data], [n].[Body], [n].[body_ar], [n].[body_en], [n].[created_at], [n].[expiry_at], [n].[Route], [n].[target_criteria], [n].[Title], [n].[title_ar], [n].[title_en]
FROM [notification_templates] AS [n]
WHERE [n].[Id] = @__Parse_0
2025-02-02 21:50:39.962 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@__Parse_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [n].[Id], [n].[additional_data], [n].[Body], [n].[body_ar], [n].[body_en], [n].[created_at], [n].[expiry_at], [n].[Route], [n].[target_criteria], [n].[Title], [n].[title_ar], [n].[title_en]
FROM [notification_templates] AS [n]
WHERE [n].[Id] = @__Parse_0
2025-02-02 21:50:39.975 +03:00 [INF] Executed DbCommand (10ms) [Parameters=[@p0='?' (Size = 4000), @p1='?' (DbType = DateTime2), @p2='?' (Size = 4000), @p3='?' (Size = 4000), @p4='?' (Size = 4000), @p5='?' (Size = 450), @p6='?' (Size = 4000), @p7='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SET IMPLICIT_TRANSACTIONS OFF;
SET NOCOUNT ON;
INSERT INTO [AuthLogs] ([AuthType], [CreatedAt], [DeviceId], [FailureReason], [IpAddress], [NationalId], [Status], [UserAgent])
OUTPUT INSERTED.[Id]
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7);
2025-02-02 21:50:39.977 +03:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType9`2[[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Object, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-02-02 21:50:39.978 +03:00 [INF] Executed action NayifatAPI.Controllers.NotificationsController.GetNotifications (NayifatAPI) in 34.1377ms
2025-02-02 21:50:39.980 +03:00 [INF] Executed endpoint 'NayifatAPI.Controllers.NotificationsController.GetNotifications (NayifatAPI)'
2025-02-02 21:50:39.981 +03:00 [INF] Request finished HTTP/1.1 POST http://07ca-46-152-255-232.ngrok-free.app/api/notifications/list - 200 null application/json; charset=utf-8 78.8006ms
2025-02-02 21:50:51.230 +03:00 [INF] Request starting HTTP/1.1 POST http://07ca-46-152-255-232.ngrok-free.app/api/auth/signin - application/json; charset=utf-8 78
2025-02-02 21:50:51.545 +03:00 [INF] Executing endpoint 'NayifatAPI.Controllers.AuthController.SignIn (NayifatAPI)'
2025-02-02 21:50:51.546 +03:00 [INF] Route matched with {action = "SignIn", controller = "Auth"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] SignIn(NayifatAPI.Controllers.SignInRequest) on controller NayifatAPI.Controllers.AuthController (NayifatAPI).
2025-02-02 21:50:51.549 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@__providedApiKey_0='?' (Size = 255)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [a].[Key], [a].[CreatedAt], [a].[Description], [a].[ExpiresAt], [a].[IsActive], [a].[LastUsedAt]
FROM [ApiKeys] AS [a]
WHERE [a].[Key] = @__providedApiKey_0 AND [a].[IsActive] = CAST(1 AS bit)
2025-02-02 21:50:51.555 +03:00 [INF] Executed DbCommand (4ms) [Parameters=[@__request_NationalId_0='?' (Size = 450)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [c].[NationalId], [c].[AddNo], [c].[BuildingNo], [c].[City], [c].[Consent], [c].[ConsentDate], [c].[DateOfBirth], [c].[Dependents], [c].[District], [c].[Email], [c].[Employer], [c].[FamilyNameAr], [c].[FamilyNameEn], [c].[FirstNameAr], [c].[FirstNameEn], [c].[Iban], [c].[IdExpiryDate], [c].[Los], [c].[Mpin], [c].[MpinEnabled], [c].[NafathStatus], [c].[NafathTimestamp], [c].[Password], [c].[Phone], [c].[RegistrationDate], [c].[SalaryCustomer], [c].[SalaryDakhli], [c].[SecondNameAr], [c].[SecondNameEn], [c].[Sector], [c].[Street], [c].[ThirdNameAr], [c].[ThirdNameEn], [c].[Zipcode]
FROM [Customers] AS [c]
WHERE [c].[NationalId] = @__request_NationalId_0
2025-02-02 21:50:51.559 +03:00 [INF] Starting password verification for NationalId: 1064448614
2025-02-02 21:50:52.004 +03:00 [INF] Password verification result for NationalId 1064448614: Success
2025-02-02 21:50:52.248 +03:00 [INF] Executed DbCommand (116ms) [Parameters=[@p0='?' (Size = 4000), @p1='?' (DbType = DateTime2), @p2='?' (Size = 4000), @p3='?' (Size = 4000), @p4='?' (Size = 4000), @p5='?' (Size = 450), @p6='?' (Size = 4000), @p7='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SET IMPLICIT_TRANSACTIONS OFF;
SET NOCOUNT ON;
INSERT INTO [AuthLogs] ([AuthType], [CreatedAt], [DeviceId], [FailureReason], [IpAddress], [NationalId], [Status], [UserAgent])
OUTPUT INSERTED.[Id]
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7);
2025-02-02 21:50:52.427 +03:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType9`2[[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Object, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-02-02 21:50:52.428 +03:00 [INF] Executed action NayifatAPI.Controllers.AuthController.SignIn (NayifatAPI) in 880.9375ms
2025-02-02 21:50:52.430 +03:00 [INF] Executed endpoint 'NayifatAPI.Controllers.AuthController.SignIn (NayifatAPI)'
2025-02-02 21:50:52.432 +03:00 [INF] Request finished HTTP/1.1 POST http://07ca-46-152-255-232.ngrok-free.app/api/auth/signin - 200 null application/json; charset=utf-8 1202.1987ms
2025-02-02 21:50:53.222 +03:00 [INF] Request starting HTTP/1.1 POST http://07ca-46-152-255-232.ngrok-free.app/api/proxy/forward?url=https://icreditdept.com/api/testasp/test_local_generate_otp.php - application/json; charset=utf-8 84
2025-02-02 21:50:53.225 +03:00 [INF] Executing endpoint 'NayifatAPI.Controllers.ProxyController.ForwardRequest (NayifatAPI)'
2025-02-02 21:50:53.226 +03:00 [INF] Route matched with {action = "ForwardRequest", controller = "Proxy"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] ForwardRequest() on controller NayifatAPI.Controllers.ProxyController (NayifatAPI).
2025-02-02 21:50:53.228 +03:00 [INF] Start processing HTTP request POST https://icreditdept.com/api/testasp/test_local_generate_otp.php
2025-02-02 21:50:53.229 +03:00 [INF] Sending HTTP request POST https://icreditdept.com/api/testasp/test_local_generate_otp.php
2025-02-02 21:50:54.388 +03:00 [INF] Received HTTP response headers after 1157.4664ms - 200
2025-02-02 21:50:54.389 +03:00 [INF] End processing HTTP request after 1161.5003ms - 200
2025-02-02 21:50:54.391 +03:00 [INF] Raw response length: 200
2025-02-02 21:50:54.391 +03:00 [INF] Response content: {"success":true,"errors":[],"result":{"nationalId":"1064448614","otp":693466,"expiryDate":"2025-02-02 21:55:54","successMsg":"Success","errCode":0,"errMsg":null},"type":"N","message":null,"code":null}
2025-02-02 21:50:54.392 +03:00 [INF] Executing ContentResult with HTTP Response ContentType of application/json
2025-02-02 21:50:54.393 +03:00 [INF] Executed action NayifatAPI.Controllers.ProxyController.ForwardRequest (NayifatAPI) in 1165.9765ms
2025-02-02 21:50:54.396 +03:00 [INF] Executed endpoint 'NayifatAPI.Controllers.ProxyController.ForwardRequest (NayifatAPI)'
2025-02-02 21:50:54.399 +03:00 [INF] Request finished HTTP/1.1 POST http://07ca-46-152-255-232.ngrok-free.app/api/proxy/forward?url=https://icreditdept.com/api/testasp/test_local_generate_otp.php - 200 200 application/json 1176.489ms
2025-02-02 21:51:05.033 +03:00 [INF] Request starting HTTP/1.1 POST http://07ca-46-152-255-232.ngrok-free.app/api/proxy/forward?url=https://icreditdept.com/api/testasp/test_local_verify_otp.php - application/json; charset=utf-8 53
2025-02-02 21:51:05.047 +03:00 [INF] Executing endpoint 'NayifatAPI.Controllers.ProxyController.ForwardRequest (NayifatAPI)'
2025-02-02 21:51:05.048 +03:00 [INF] Route matched with {action = "ForwardRequest", controller = "Proxy"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] ForwardRequest() on controller NayifatAPI.Controllers.ProxyController (NayifatAPI).
2025-02-02 21:51:05.050 +03:00 [INF] Start processing HTTP request POST https://icreditdept.com/api/testasp/test_local_verify_otp.php
2025-02-02 21:51:05.051 +03:00 [INF] Sending HTTP request POST https://icreditdept.com/api/testasp/test_local_verify_otp.php
2025-02-02 21:51:05.496 +03:00 [INF] Received HTTP response headers after 444.1036ms - 200
2025-02-02 21:51:05.605 +03:00 [INF] End processing HTTP request after 555.1242ms - 200
2025-02-02 21:51:05.607 +03:00 [INF] Raw response length: 202
2025-02-02 21:51:05.608 +03:00 [INF] Response content: {"success":true,"errors":[],"result":{"nationalId":"1064448614","otp":"693466","verifiedFlag":true,"successMsg":"Verified successfully.","errCode":0,"errMsg":null},"type":"N","message":null,"code":null}
2025-02-02 21:51:05.610 +03:00 [INF] Executing ContentResult with HTTP Response ContentType of application/json
2025-02-02 21:51:05.611 +03:00 [INF] Executed action NayifatAPI.Controllers.ProxyController.ForwardRequest (NayifatAPI) in 561.0182ms
2025-02-02 21:51:05.614 +03:00 [INF] Executed endpoint 'NayifatAPI.Controllers.ProxyController.ForwardRequest (NayifatAPI)'
2025-02-02 21:51:05.617 +03:00 [INF] Request finished HTTP/1.1 POST http://07ca-46-152-255-232.ngrok-free.app/api/proxy/forward?url=https://icreditdept.com/api/testasp/test_local_verify_otp.php - 200 202 application/json 582.8798ms
2025-02-02 21:51:35.753 +03:00 [INF] Request starting HTTP/1.1 POST http://07ca-46-152-255-232.ngrok-free.app/api/notifications/list - application/json; charset=utf-8 47
2025-02-02 21:51:35.758 +03:00 [INF] Executing endpoint 'NayifatAPI.Controllers.NotificationsController.GetNotifications (NayifatAPI)'
2025-02-02 21:51:35.759 +03:00 [INF] Route matched with {action = "GetNotifications", controller = "Notifications"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetNotifications(NayifatAPI.Controllers.GetNotificationsRequest) on controller NayifatAPI.Controllers.NotificationsController (NayifatAPI).
2025-02-02 21:51:35.765 +03:00 [INF] Executed DbCommand (3ms) [Parameters=[@__providedApiKey_0='?' (Size = 255)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [a].[Key], [a].[CreatedAt], [a].[Description], [a].[ExpiresAt], [a].[IsActive], [a].[LastUsedAt]
FROM [ApiKeys] AS [a]
WHERE [a].[Key] = @__providedApiKey_0 AND [a].[IsActive] = CAST(1 AS bit)
2025-02-02 21:51:35.771 +03:00 [INF] Executed DbCommand (2ms) [Parameters=[@__request_NationalId_0='?' (Size = 450)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [u].[national_id], [u].[last_updated], [u].[notifications]
FROM [user_notifications] AS [u]
WHERE [u].[national_id] = @__request_NationalId_0
2025-02-02 21:51:35.776 +03:00 [INF] Executed DbCommand (2ms) [Parameters=[@__Parse_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [n].[Id], [n].[additional_data], [n].[Body], [n].[body_ar], [n].[body_en], [n].[created_at], [n].[expiry_at], [n].[Route], [n].[target_criteria], [n].[Title], [n].[title_ar], [n].[title_en]
FROM [notification_templates] AS [n]
WHERE [n].[Id] = @__Parse_0
2025-02-02 21:51:35.778 +03:00 [INF] Executed DbCommand (0ms) [Parameters=[@__Parse_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [n].[Id], [n].[additional_data], [n].[Body], [n].[body_ar], [n].[body_en], [n].[created_at], [n].[expiry_at], [n].[Route], [n].[target_criteria], [n].[Title], [n].[title_ar], [n].[title_en]
FROM [notification_templates] AS [n]
WHERE [n].[Id] = @__Parse_0
2025-02-02 21:51:35.858 +03:00 [INF] Executed DbCommand (77ms) [Parameters=[@p0='?' (Size = 4000), @p1='?' (DbType = DateTime2), @p2='?' (Size = 4000), @p3='?' (Size = 4000), @p4='?' (Size = 4000), @p5='?' (Size = 450), @p6='?' (Size = 4000), @p7='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SET IMPLICIT_TRANSACTIONS OFF;
SET NOCOUNT ON;
INSERT INTO [AuthLogs] ([AuthType], [CreatedAt], [DeviceId], [FailureReason], [IpAddress], [NationalId], [Status], [UserAgent])
OUTPUT INSERTED.[Id]
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7);
2025-02-02 21:51:35.862 +03:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType9`2[[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Object, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-02-02 21:51:35.863 +03:00 [INF] Executed action NayifatAPI.Controllers.NotificationsController.GetNotifications (NayifatAPI) in 102.5928ms
2025-02-02 21:51:35.864 +03:00 [INF] Executed endpoint 'NayifatAPI.Controllers.NotificationsController.GetNotifications (NayifatAPI)'
2025-02-02 21:51:35.866 +03:00 [INF] Request finished HTTP/1.1 POST http://07ca-46-152-255-232.ngrok-free.app/api/notifications/list - 200 null application/json; charset=utf-8 112.2963ms
2025-02-02 21:54:23.555 +03:00 [INF] Request starting HTTP/1.1 POST http://07ca-46-152-255-232.ngrok-free.app/api/notifications/list - application/json; charset=utf-8 47
2025-02-02 21:54:23.558 +03:00 [INF] Executing endpoint 'NayifatAPI.Controllers.NotificationsController.GetNotifications (NayifatAPI)'
2025-02-02 21:54:23.558 +03:00 [INF] Route matched with {action = "GetNotifications", controller = "Notifications"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetNotifications(NayifatAPI.Controllers.GetNotificationsRequest) on controller NayifatAPI.Controllers.NotificationsController (NayifatAPI).
2025-02-02 21:54:23.564 +03:00 [INF] Executed DbCommand (2ms) [Parameters=[@__providedApiKey_0='?' (Size = 255)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [a].[Key], [a].[CreatedAt], [a].[Description], [a].[ExpiresAt], [a].[IsActive], [a].[LastUsedAt]
FROM [ApiKeys] AS [a]
WHERE [a].[Key] = @__providedApiKey_0 AND [a].[IsActive] = CAST(1 AS bit)
2025-02-02 21:54:23.568 +03:00 [INF] Executed DbCommand (2ms) [Parameters=[@__request_NationalId_0='?' (Size = 450)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [u].[national_id], [u].[last_updated], [u].[notifications]
FROM [user_notifications] AS [u]
WHERE [u].[national_id] = @__request_NationalId_0
2025-02-02 21:54:23.573 +03:00 [INF] Executed DbCommand (2ms) [Parameters=[@__Parse_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [n].[Id], [n].[additional_data], [n].[Body], [n].[body_ar], [n].[body_en], [n].[created_at], [n].[expiry_at], [n].[Route], [n].[target_criteria], [n].[Title], [n].[title_ar], [n].[title_en]
FROM [notification_templates] AS [n]
WHERE [n].[Id] = @__Parse_0
2025-02-02 21:54:23.576 +03:00 [INF] Executed DbCommand (0ms) [Parameters=[@__Parse_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [n].[Id], [n].[additional_data], [n].[Body], [n].[body_ar], [n].[body_en], [n].[created_at], [n].[expiry_at], [n].[Route], [n].[target_criteria], [n].[Title], [n].[title_ar], [n].[title_en]
FROM [notification_templates] AS [n]
WHERE [n].[Id] = @__Parse_0
2025-02-02 21:54:23.656 +03:00 [INF] Executed DbCommand (77ms) [Parameters=[@p0='?' (Size = 4000), @p1='?' (DbType = DateTime2), @p2='?' (Size = 4000), @p3='?' (Size = 4000), @p4='?' (Size = 4000), @p5='?' (Size = 450), @p6='?' (Size = 4000), @p7='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SET IMPLICIT_TRANSACTIONS OFF;
SET NOCOUNT ON;
INSERT INTO [AuthLogs] ([AuthType], [CreatedAt], [DeviceId], [FailureReason], [IpAddress], [NationalId], [Status], [UserAgent])
OUTPUT INSERTED.[Id]
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7);
2025-02-02 21:54:23.661 +03:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType9`2[[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Object, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-02-02 21:54:23.662 +03:00 [INF] Executed action NayifatAPI.Controllers.NotificationsController.GetNotifications (NayifatAPI) in 102.3802ms
2025-02-02 21:54:23.663 +03:00 [INF] Executed endpoint 'NayifatAPI.Controllers.NotificationsController.GetNotifications (NayifatAPI)'
2025-02-02 21:54:23.666 +03:00 [INF] Request finished HTTP/1.1 POST http://07ca-46-152-255-232.ngrok-free.app/api/notifications/list - 200 null application/json; charset=utf-8 110.9826ms
2025-02-02 21:56:31.059 +03:00 [INF] Request starting HTTP/1.1 POST http://07ca-46-152-255-232.ngrok-free.app/api/notifications/list - application/json; charset=utf-8 47
2025-02-02 21:56:31.061 +03:00 [INF] Executing endpoint 'NayifatAPI.Controllers.NotificationsController.GetNotifications (NayifatAPI)'
2025-02-02 21:56:31.062 +03:00 [INF] Route matched with {action = "GetNotifications", controller = "Notifications"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetNotifications(NayifatAPI.Controllers.GetNotificationsRequest) on controller NayifatAPI.Controllers.NotificationsController (NayifatAPI).
2025-02-02 21:56:31.117 +03:00 [INF] Executed DbCommand (52ms) [Parameters=[@__providedApiKey_0='?' (Size = 255)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [a].[Key], [a].[CreatedAt], [a].[Description], [a].[ExpiresAt], [a].[IsActive], [a].[LastUsedAt]
FROM [ApiKeys] AS [a]
WHERE [a].[Key] = @__providedApiKey_0 AND [a].[IsActive] = CAST(1 AS bit)
2025-02-02 21:56:31.360 +03:00 [INF] Executed DbCommand (2ms) [Parameters=[@__request_NationalId_0='?' (Size = 450)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [u].[national_id], [u].[last_updated], [u].[notifications]
FROM [user_notifications] AS [u]
WHERE [u].[national_id] = @__request_NationalId_0
2025-02-02 21:56:31.366 +03:00 [INF] Executed DbCommand (2ms) [Parameters=[@__Parse_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [n].[Id], [n].[additional_data], [n].[Body], [n].[body_ar], [n].[body_en], [n].[created_at], [n].[expiry_at], [n].[Route], [n].[target_criteria], [n].[Title], [n].[title_ar], [n].[title_en]
FROM [notification_templates] AS [n]
WHERE [n].[Id] = @__Parse_0
2025-02-02 21:56:31.669 +03:00 [INF] Executed DbCommand (0ms) [Parameters=[@__Parse_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [n].[Id], [n].[additional_data], [n].[Body], [n].[body_ar], [n].[body_en], [n].[created_at], [n].[expiry_at], [n].[Route], [n].[target_criteria], [n].[Title], [n].[title_ar], [n].[title_en]
FROM [notification_templates] AS [n]
WHERE [n].[Id] = @__Parse_0
2025-02-02 21:56:31.837 +03:00 [INF] Executed DbCommand (165ms) [Parameters=[@p0='?' (Size = 4000), @p1='?' (DbType = DateTime2), @p2='?' (Size = 4000), @p3='?' (Size = 4000), @p4='?' (Size = 4000), @p5='?' (Size = 450), @p6='?' (Size = 4000), @p7='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SET IMPLICIT_TRANSACTIONS OFF;
SET NOCOUNT ON;
INSERT INTO [AuthLogs] ([AuthType], [CreatedAt], [DeviceId], [FailureReason], [IpAddress], [NationalId], [Status], [UserAgent])
OUTPUT INSERTED.[Id]
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7);
2025-02-02 21:56:31.953 +03:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType9`2[[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Object, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-02-02 21:56:31.954 +03:00 [INF] Executed action NayifatAPI.Controllers.NotificationsController.GetNotifications (NayifatAPI) in 890.9212ms
2025-02-02 21:56:31.956 +03:00 [INF] Executed endpoint 'NayifatAPI.Controllers.NotificationsController.GetNotifications (NayifatAPI)'
2025-02-02 21:56:31.957 +03:00 [INF] Request finished HTTP/1.1 POST http://07ca-46-152-255-232.ngrok-free.app/api/notifications/list - 200 null application/json; charset=utf-8 898.2493ms
2025-02-02 21:56:40.836 +03:00 [INF] Request starting HTTP/1.1 POST http://07ca-46-152-255-232.ngrok-free.app/api/auth/signin - application/json; charset=utf-8 78
2025-02-02 21:56:40.846 +03:00 [INF] Executing endpoint 'NayifatAPI.Controllers.AuthController.SignIn (NayifatAPI)'
2025-02-02 21:56:40.847 +03:00 [INF] Route matched with {action = "SignIn", controller = "Auth"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] SignIn(NayifatAPI.Controllers.SignInRequest) on controller NayifatAPI.Controllers.AuthController (NayifatAPI).
2025-02-02 21:56:40.852 +03:00 [INF] Executed DbCommand (3ms) [Parameters=[@__providedApiKey_0='?' (Size = 255)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [a].[Key], [a].[CreatedAt], [a].[Description], [a].[ExpiresAt], [a].[IsActive], [a].[LastUsedAt]
FROM [ApiKeys] AS [a]
WHERE [a].[Key] = @__providedApiKey_0 AND [a].[IsActive] = CAST(1 AS bit)
2025-02-02 21:56:40.857 +03:00 [INF] Executed DbCommand (2ms) [Parameters=[@__request_NationalId_0='?' (Size = 450)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [c].[NationalId], [c].[AddNo], [c].[BuildingNo], [c].[City], [c].[Consent], [c].[ConsentDate], [c].[DateOfBirth], [c].[Dependents], [c].[District], [c].[Email], [c].[Employer], [c].[FamilyNameAr], [c].[FamilyNameEn], [c].[FirstNameAr], [c].[FirstNameEn], [c].[Iban], [c].[IdExpiryDate], [c].[Los], [c].[Mpin], [c].[MpinEnabled], [c].[NafathStatus], [c].[NafathTimestamp], [c].[Password], [c].[Phone], [c].[RegistrationDate], [c].[SalaryCustomer], [c].[SalaryDakhli], [c].[SecondNameAr], [c].[SecondNameEn], [c].[Sector], [c].[Street], [c].[ThirdNameAr], [c].[ThirdNameEn], [c].[Zipcode]
FROM [Customers] AS [c]
WHERE [c].[NationalId] = @__request_NationalId_0
2025-02-02 21:56:40.859 +03:00 [INF] Starting password verification for NationalId: 1064448614
2025-02-02 21:56:41.030 +03:00 [INF] Password verification result for NationalId 1064448614: Success
2025-02-02 21:56:41.040 +03:00 [INF] Executed DbCommand (8ms) [Parameters=[@p0='?' (Size = 4000), @p1='?' (DbType = DateTime2), @p2='?' (Size = 4000), @p3='?' (Size = 4000), @p4='?' (Size = 4000), @p5='?' (Size = 450), @p6='?' (Size = 4000), @p7='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SET IMPLICIT_TRANSACTIONS OFF;
SET NOCOUNT ON;
INSERT INTO [AuthLogs] ([AuthType], [CreatedAt], [DeviceId], [FailureReason], [IpAddress], [NationalId], [Status], [UserAgent])
OUTPUT INSERTED.[Id]
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7);
2025-02-02 21:56:41.043 +03:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType9`2[[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Object, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-02-02 21:56:41.044 +03:00 [INF] Executed action NayifatAPI.Controllers.AuthController.SignIn (NayifatAPI) in 195.6349ms
2025-02-02 21:56:41.045 +03:00 [INF] Executed endpoint 'NayifatAPI.Controllers.AuthController.SignIn (NayifatAPI)'
2025-02-02 21:56:41.046 +03:00 [INF] Request finished HTTP/1.1 POST http://07ca-46-152-255-232.ngrok-free.app/api/auth/signin - 200 null application/json; charset=utf-8 209.5615ms
2025-02-02 21:56:41.944 +03:00 [INF] Request starting HTTP/1.1 POST http://07ca-46-152-255-232.ngrok-free.app/api/proxy/forward?url=https://icreditdept.com/api/testasp/test_local_generate_otp.php - application/json; charset=utf-8 84
2025-02-02 21:56:41.950 +03:00 [INF] Executing endpoint 'NayifatAPI.Controllers.ProxyController.ForwardRequest (NayifatAPI)'
2025-02-02 21:56:41.951 +03:00 [INF] Route matched with {action = "ForwardRequest", controller = "Proxy"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] ForwardRequest() on controller NayifatAPI.Controllers.ProxyController (NayifatAPI).
2025-02-02 21:56:41.953 +03:00 [INF] Start processing HTTP request POST https://icreditdept.com/api/testasp/test_local_generate_otp.php
2025-02-02 21:56:41.953 +03:00 [INF] Sending HTTP request POST https://icreditdept.com/api/testasp/test_local_generate_otp.php
2025-02-02 21:56:43.243 +03:00 [INF] Received HTTP response headers after 1288.8067ms - 200
2025-02-02 21:56:43.244 +03:00 [INF] End processing HTTP request after 1291.49ms - 200
2025-02-02 21:56:43.245 +03:00 [INF] Raw response length: 200
2025-02-02 21:56:43.246 +03:00 [INF] Response content: {"success":true,"errors":[],"result":{"nationalId":"1064448614","otp":290107,"expiryDate":"2025-02-02 22:01:43","successMsg":"Success","errCode":0,"errMsg":null},"type":"N","message":null,"code":null}
2025-02-02 21:56:43.246 +03:00 [INF] Executing ContentResult with HTTP Response ContentType of application/json
2025-02-02 21:56:43.247 +03:00 [INF] Executed action NayifatAPI.Controllers.ProxyController.ForwardRequest (NayifatAPI) in 1294.73ms
2025-02-02 21:56:43.248 +03:00 [INF] Executed endpoint 'NayifatAPI.Controllers.ProxyController.ForwardRequest (NayifatAPI)'
2025-02-02 21:56:43.249 +03:00 [INF] Request finished HTTP/1.1 POST http://07ca-46-152-255-232.ngrok-free.app/api/proxy/forward?url=https://icreditdept.com/api/testasp/test_local_generate_otp.php - 200 200 application/json 1304.9788ms
2025-02-02 21:56:51.678 +03:00 [INF] Request starting HTTP/1.1 POST http://07ca-46-152-255-232.ngrok-free.app/api/proxy/forward?url=https://icreditdept.com/api/testasp/test_local_verify_otp.php - application/json; charset=utf-8 53
2025-02-02 21:56:51.681 +03:00 [INF] Executing endpoint 'NayifatAPI.Controllers.ProxyController.ForwardRequest (NayifatAPI)'
2025-02-02 21:56:51.682 +03:00 [INF] Route matched with {action = "ForwardRequest", controller = "Proxy"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] ForwardRequest() on controller NayifatAPI.Controllers.ProxyController (NayifatAPI).
2025-02-02 21:56:51.683 +03:00 [INF] Start processing HTTP request POST https://icreditdept.com/api/testasp/test_local_verify_otp.php
2025-02-02 21:56:51.684 +03:00 [INF] Sending HTTP request POST https://icreditdept.com/api/testasp/test_local_verify_otp.php
2025-02-02 21:56:52.096 +03:00 [INF] Received HTTP response headers after 411.2434ms - 200
2025-02-02 21:56:52.101 +03:00 [INF] End processing HTTP request after 417.6457ms - 200
2025-02-02 21:56:52.102 +03:00 [INF] Raw response length: 202
2025-02-02 21:56:52.103 +03:00 [INF] Response content: {"success":true,"errors":[],"result":{"nationalId":"1064448614","otp":"290107","verifiedFlag":true,"successMsg":"Verified successfully.","errCode":0,"errMsg":null},"type":"N","message":null,"code":null}
2025-02-02 21:56:52.104 +03:00 [INF] Executing ContentResult with HTTP Response ContentType of application/json
2025-02-02 21:56:52.104 +03:00 [INF] Executed action NayifatAPI.Controllers.ProxyController.ForwardRequest (NayifatAPI) in 421.0923ms
2025-02-02 21:56:52.106 +03:00 [INF] Executed endpoint 'NayifatAPI.Controllers.ProxyController.ForwardRequest (NayifatAPI)'
2025-02-02 21:56:52.108 +03:00 [INF] Request finished HTTP/1.1 POST http://07ca-46-152-255-232.ngrok-free.app/api/proxy/forward?url=https://icreditdept.com/api/testasp/test_local_verify_otp.php - 200 202 application/json 430.2803ms
2025-02-02 21:57:04.065 +03:00 [INF] Request starting HTTP/1.1 POST http://07ca-46-152-255-232.ngrok-free.app/api/notifications/list - application/json; charset=utf-8 47
2025-02-02 21:57:04.068 +03:00 [INF] Executing endpoint 'NayifatAPI.Controllers.NotificationsController.GetNotifications (NayifatAPI)'
2025-02-02 21:57:04.069 +03:00 [INF] Route matched with {action = "GetNotifications", controller = "Notifications"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetNotifications(NayifatAPI.Controllers.GetNotificationsRequest) on controller NayifatAPI.Controllers.NotificationsController (NayifatAPI).
2025-02-02 21:57:04.075 +03:00 [INF] Executed DbCommand (3ms) [Parameters=[@__providedApiKey_0='?' (Size = 255)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [a].[Key], [a].[CreatedAt], [a].[Description], [a].[ExpiresAt], [a].[IsActive], [a].[LastUsedAt]
FROM [ApiKeys] AS [a]
WHERE [a].[Key] = @__providedApiKey_0 AND [a].[IsActive] = CAST(1 AS bit)
2025-02-02 21:57:04.079 +03:00 [INF] Executed DbCommand (2ms) [Parameters=[@__request_NationalId_0='?' (Size = 450)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [u].[national_id], [u].[last_updated], [u].[notifications]
FROM [user_notifications] AS [u]
WHERE [u].[national_id] = @__request_NationalId_0
2025-02-02 21:57:04.083 +03:00 [INF] Executed DbCommand (2ms) [Parameters=[@__Parse_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [n].[Id], [n].[additional_data], [n].[Body], [n].[body_ar], [n].[body_en], [n].[created_at], [n].[expiry_at], [n].[Route], [n].[target_criteria], [n].[Title], [n].[title_ar], [n].[title_en]
FROM [notification_templates] AS [n]
WHERE [n].[Id] = @__Parse_0
2025-02-02 21:57:04.086 +03:00 [INF] Executed DbCommand (0ms) [Parameters=[@__Parse_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [n].[Id], [n].[additional_data], [n].[Body], [n].[body_ar], [n].[body_en], [n].[created_at], [n].[expiry_at], [n].[Route], [n].[target_criteria], [n].[Title], [n].[title_ar], [n].[title_en]
FROM [notification_templates] AS [n]
WHERE [n].[Id] = @__Parse_0
2025-02-02 21:57:04.164 +03:00 [INF] Executed DbCommand (76ms) [Parameters=[@p0='?' (Size = 4000), @p1='?' (DbType = DateTime2), @p2='?' (Size = 4000), @p3='?' (Size = 4000), @p4='?' (Size = 4000), @p5='?' (Size = 450), @p6='?' (Size = 4000), @p7='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SET IMPLICIT_TRANSACTIONS OFF;
SET NOCOUNT ON;
INSERT INTO [AuthLogs] ([AuthType], [CreatedAt], [DeviceId], [FailureReason], [IpAddress], [NationalId], [Status], [UserAgent])
OUTPUT INSERTED.[Id]
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7);
2025-02-02 21:57:04.167 +03:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType9`2[[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Object, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-02-02 21:57:04.168 +03:00 [INF] Executed action NayifatAPI.Controllers.NotificationsController.GetNotifications (NayifatAPI) in 98.1297ms
2025-02-02 21:57:04.170 +03:00 [INF] Executed endpoint 'NayifatAPI.Controllers.NotificationsController.GetNotifications (NayifatAPI)'
2025-02-02 21:57:04.171 +03:00 [INF] Request finished HTTP/1.1 POST http://07ca-46-152-255-232.ngrok-free.app/api/notifications/list - 200 null application/json; charset=utf-8 106.5225ms
2025-02-02 21:58:10.541 +03:00 [INF] Request starting HTTP/1.1 POST http://07ca-46-152-255-232.ngrok-free.app/api/notifications/list - application/json; charset=utf-8 47
2025-02-02 21:58:10.543 +03:00 [INF] Executing endpoint 'NayifatAPI.Controllers.NotificationsController.GetNotifications (NayifatAPI)'
2025-02-02 21:58:10.543 +03:00 [INF] Route matched with {action = "GetNotifications", controller = "Notifications"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetNotifications(NayifatAPI.Controllers.GetNotificationsRequest) on controller NayifatAPI.Controllers.NotificationsController (NayifatAPI).
2025-02-02 21:58:10.548 +03:00 [INF] Executed DbCommand (2ms) [Parameters=[@__providedApiKey_0='?' (Size = 255)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [a].[Key], [a].[CreatedAt], [a].[Description], [a].[ExpiresAt], [a].[IsActive], [a].[LastUsedAt]
FROM [ApiKeys] AS [a]
WHERE [a].[Key] = @__providedApiKey_0 AND [a].[IsActive] = CAST(1 AS bit)
2025-02-02 21:58:10.551 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@__request_NationalId_0='?' (Size = 450)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [u].[national_id], [u].[last_updated], [u].[notifications]
FROM [user_notifications] AS [u]
WHERE [u].[national_id] = @__request_NationalId_0
2025-02-02 21:58:10.556 +03:00 [INF] Executed DbCommand (2ms) [Parameters=[@__Parse_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [n].[Id], [n].[additional_data], [n].[Body], [n].[body_ar], [n].[body_en], [n].[created_at], [n].[expiry_at], [n].[Route], [n].[target_criteria], [n].[Title], [n].[title_ar], [n].[title_en]
FROM [notification_templates] AS [n]
WHERE [n].[Id] = @__Parse_0
2025-02-02 21:58:10.558 +03:00 [INF] Executed DbCommand (0ms) [Parameters=[@__Parse_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [n].[Id], [n].[additional_data], [n].[Body], [n].[body_ar], [n].[body_en], [n].[created_at], [n].[expiry_at], [n].[Route], [n].[target_criteria], [n].[Title], [n].[title_ar], [n].[title_en]
FROM [notification_templates] AS [n]
WHERE [n].[Id] = @__Parse_0
2025-02-02 21:58:10.635 +03:00 [INF] Executed DbCommand (76ms) [Parameters=[@p0='?' (Size = 4000), @p1='?' (DbType = DateTime2), @p2='?' (Size = 4000), @p3='?' (Size = 4000), @p4='?' (Size = 4000), @p5='?' (Size = 450), @p6='?' (Size = 4000), @p7='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SET IMPLICIT_TRANSACTIONS OFF;
SET NOCOUNT ON;
INSERT INTO [AuthLogs] ([AuthType], [CreatedAt], [DeviceId], [FailureReason], [IpAddress], [NationalId], [Status], [UserAgent])
OUTPUT INSERTED.[Id]
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7);
2025-02-02 21:58:10.648 +03:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType9`2[[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Object, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-02-02 21:58:10.654 +03:00 [INF] Executed action NayifatAPI.Controllers.NotificationsController.GetNotifications (NayifatAPI) in 108.9298ms
2025-02-02 21:58:10.658 +03:00 [INF] Executed endpoint 'NayifatAPI.Controllers.NotificationsController.GetNotifications (NayifatAPI)'
2025-02-02 21:58:10.661 +03:00 [INF] Request finished HTTP/1.1 POST http://07ca-46-152-255-232.ngrok-free.app/api/notifications/list - 200 null application/json; charset=utf-8 120.0645ms
2025-02-02 21:58:36.405 +03:00 [INF] Request starting HTTP/1.1 POST http://07ca-46-152-255-232.ngrok-free.app/api/notifications/list - application/json; charset=utf-8 47
2025-02-02 21:58:36.454 +03:00 [INF] Executing endpoint 'NayifatAPI.Controllers.NotificationsController.GetNotifications (NayifatAPI)'
2025-02-02 21:58:36.463 +03:00 [INF] Route matched with {action = "GetNotifications", controller = "Notifications"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetNotifications(NayifatAPI.Controllers.GetNotificationsRequest) on controller NayifatAPI.Controllers.NotificationsController (NayifatAPI).
2025-02-02 21:58:36.478 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@__providedApiKey_0='?' (Size = 255)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [a].[Key], [a].[CreatedAt], [a].[Description], [a].[ExpiresAt], [a].[IsActive], [a].[LastUsedAt]
FROM [ApiKeys] AS [a]
WHERE [a].[Key] = @__providedApiKey_0 AND [a].[IsActive] = CAST(1 AS bit)
2025-02-02 21:58:36.481 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@__request_NationalId_0='?' (Size = 450)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [u].[national_id], [u].[last_updated], [u].[notifications]
FROM [user_notifications] AS [u]
WHERE [u].[national_id] = @__request_NationalId_0
2025-02-02 21:58:36.593 +03:00 [INF] Executed DbCommand (43ms) [Parameters=[@__Parse_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [n].[Id], [n].[additional_data], [n].[Body], [n].[body_ar], [n].[body_en], [n].[created_at], [n].[expiry_at], [n].[Route], [n].[target_criteria], [n].[Title], [n].[title_ar], [n].[title_en]
FROM [notification_templates] AS [n]
WHERE [n].[Id] = @__Parse_0
2025-02-02 21:58:36.598 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@__Parse_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [n].[Id], [n].[additional_data], [n].[Body], [n].[body_ar], [n].[body_en], [n].[created_at], [n].[expiry_at], [n].[Route], [n].[target_criteria], [n].[Title], [n].[title_ar], [n].[title_en]
FROM [notification_templates] AS [n]
WHERE [n].[Id] = @__Parse_0
2025-02-02 21:58:36.607 +03:00 [INF] Executed DbCommand (6ms) [Parameters=[@p0='?' (Size = 4000), @p1='?' (DbType = DateTime2), @p2='?' (Size = 4000), @p3='?' (Size = 4000), @p4='?' (Size = 4000), @p5='?' (Size = 450), @p6='?' (Size = 4000), @p7='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SET IMPLICIT_TRANSACTIONS OFF;
SET NOCOUNT ON;
INSERT INTO [AuthLogs] ([AuthType], [CreatedAt], [DeviceId], [FailureReason], [IpAddress], [NationalId], [Status], [UserAgent])
OUTPUT INSERTED.[Id]
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7);
2025-02-02 21:58:36.609 +03:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType9`2[[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Object, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-02-02 21:58:36.610 +03:00 [INF] Executed action NayifatAPI.Controllers.NotificationsController.GetNotifications (NayifatAPI) in 133.9256ms
2025-02-02 21:58:36.611 +03:00 [INF] Executed endpoint 'NayifatAPI.Controllers.NotificationsController.GetNotifications (NayifatAPI)'
2025-02-02 21:58:36.613 +03:00 [INF] Request finished HTTP/1.1 POST http://07ca-46-152-255-232.ngrok-free.app/api/notifications/list - 200 null application/json; charset=utf-8 208.2596ms
2025-02-02 21:58:46.738 +03:00 [INF] Request starting HTTP/1.1 POST http://07ca-46-152-255-232.ngrok-free.app/api/auth/signin - application/json; charset=utf-8 78
2025-02-02 21:58:46.742 +03:00 [INF] Executing endpoint 'NayifatAPI.Controllers.AuthController.SignIn (NayifatAPI)'
2025-02-02 21:58:46.743 +03:00 [INF] Route matched with {action = "SignIn", controller = "Auth"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] SignIn(NayifatAPI.Controllers.SignInRequest) on controller NayifatAPI.Controllers.AuthController (NayifatAPI).
2025-02-02 21:58:46.751 +03:00 [INF] Executed DbCommand (5ms) [Parameters=[@__providedApiKey_0='?' (Size = 255)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [a].[Key], [a].[CreatedAt], [a].[Description], [a].[ExpiresAt], [a].[IsActive], [a].[LastUsedAt]
FROM [ApiKeys] AS [a]
WHERE [a].[Key] = @__providedApiKey_0 AND [a].[IsActive] = CAST(1 AS bit)
2025-02-02 21:58:46.758 +03:00 [INF] Executed DbCommand (4ms) [Parameters=[@__request_NationalId_0='?' (Size = 450)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [c].[NationalId], [c].[AddNo], [c].[BuildingNo], [c].[City], [c].[Consent], [c].[ConsentDate], [c].[DateOfBirth], [c].[Dependents], [c].[District], [c].[Email], [c].[Employer], [c].[FamilyNameAr], [c].[FamilyNameEn], [c].[FirstNameAr], [c].[FirstNameEn], [c].[Iban], [c].[IdExpiryDate], [c].[Los], [c].[Mpin], [c].[MpinEnabled], [c].[NafathStatus], [c].[NafathTimestamp], [c].[Password], [c].[Phone], [c].[RegistrationDate], [c].[SalaryCustomer], [c].[SalaryDakhli], [c].[SecondNameAr], [c].[SecondNameEn], [c].[Sector], [c].[Street], [c].[ThirdNameAr], [c].[ThirdNameEn], [c].[Zipcode]
FROM [Customers] AS [c]
WHERE [c].[NationalId] = @__request_NationalId_0
2025-02-02 21:58:46.761 +03:00 [INF] Starting password verification for NationalId: 1064448614
2025-02-02 21:58:46.956 +03:00 [INF] Password verification result for NationalId 1064448614: Success
2025-02-02 21:58:46.989 +03:00 [INF] Executed DbCommand (32ms) [Parameters=[@p0='?' (Size = 4000), @p1='?' (DbType = DateTime2), @p2='?' (Size = 4000), @p3='?' (Size = 4000), @p4='?' (Size = 4000), @p5='?' (Size = 450), @p6='?' (Size = 4000), @p7='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SET IMPLICIT_TRANSACTIONS OFF;
SET NOCOUNT ON;
INSERT INTO [AuthLogs] ([AuthType], [CreatedAt], [DeviceId], [FailureReason], [IpAddress], [NationalId], [Status], [UserAgent])
OUTPUT INSERTED.[Id]
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7);
2025-02-02 21:58:46.992 +03:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType9`2[[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Object, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-02-02 21:58:46.993 +03:00 [INF] Executed action NayifatAPI.Controllers.AuthController.SignIn (NayifatAPI) in 247.786ms
2025-02-02 21:58:46.995 +03:00 [INF] Executed endpoint 'NayifatAPI.Controllers.AuthController.SignIn (NayifatAPI)'
2025-02-02 21:58:46.997 +03:00 [INF] Request finished HTTP/1.1 POST http://07ca-46-152-255-232.ngrok-free.app/api/auth/signin - 200 null application/json; charset=utf-8 258.1516ms
2025-02-02 21:58:49.048 +03:00 [INF] Request starting HTTP/1.1 POST http://07ca-46-152-255-232.ngrok-free.app/api/proxy/forward?url=https://icreditdept.com/api/testasp/test_local_generate_otp.php - application/json; charset=utf-8 84
2025-02-02 21:58:49.129 +03:00 [INF] Executing endpoint 'NayifatAPI.Controllers.ProxyController.ForwardRequest (NayifatAPI)'
2025-02-02 21:58:49.130 +03:00 [INF] Route matched with {action = "ForwardRequest", controller = "Proxy"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] ForwardRequest() on controller NayifatAPI.Controllers.ProxyController (NayifatAPI).
2025-02-02 21:58:49.132 +03:00 [INF] Start processing HTTP request POST https://icreditdept.com/api/testasp/test_local_generate_otp.php
2025-02-02 21:58:49.134 +03:00 [INF] Sending HTTP request POST https://icreditdept.com/api/testasp/test_local_generate_otp.php
2025-02-02 21:58:49.803 +03:00 [INF] Received HTTP response headers after 668.2676ms - 200
2025-02-02 21:58:49.812 +03:00 [INF] End processing HTTP request after 680.0185ms - 200
2025-02-02 21:58:49.814 +03:00 [INF] Raw response length: 200
2025-02-02 21:58:49.814 +03:00 [INF] Response content: {"success":true,"errors":[],"result":{"nationalId":"1064448614","otp":369654,"expiryDate":"2025-02-02 22:03:50","successMsg":"Success","errCode":0,"errMsg":null},"type":"N","message":null,"code":null}
2025-02-02 21:58:49.816 +03:00 [INF] Executing ContentResult with HTTP Response ContentType of application/json
2025-02-02 21:58:49.817 +03:00 [INF] Executed action NayifatAPI.Controllers.ProxyController.ForwardRequest (NayifatAPI) in 684.6912ms
2025-02-02 21:58:49.818 +03:00 [INF] Executed endpoint 'NayifatAPI.Controllers.ProxyController.ForwardRequest (NayifatAPI)'
2025-02-02 21:58:49.819 +03:00 [INF] Request finished HTTP/1.1 POST http://07ca-46-152-255-232.ngrok-free.app/api/proxy/forward?url=https://icreditdept.com/api/testasp/test_local_generate_otp.php - 200 200 application/json 771.3737ms
2025-02-02 21:58:58.222 +03:00 [INF] Request starting HTTP/1.1 POST http://07ca-46-152-255-232.ngrok-free.app/api/proxy/forward?url=https://icreditdept.com/api/testasp/test_local_verify_otp.php - application/json; charset=utf-8 53
2025-02-02 21:58:58.226 +03:00 [INF] Executing endpoint 'NayifatAPI.Controllers.ProxyController.ForwardRequest (NayifatAPI)'
2025-02-02 21:58:58.227 +03:00 [INF] Route matched with {action = "ForwardRequest", controller = "Proxy"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] ForwardRequest() on controller NayifatAPI.Controllers.ProxyController (NayifatAPI).
2025-02-02 21:58:58.229 +03:00 [INF] Start processing HTTP request POST https://icreditdept.com/api/testasp/test_local_verify_otp.php
2025-02-02 21:58:58.230 +03:00 [INF] Sending HTTP request POST https://icreditdept.com/api/testasp/test_local_verify_otp.php
2025-02-02 21:58:58.661 +03:00 [INF] Received HTTP response headers after 430.5955ms - 200
2025-02-02 21:58:58.664 +03:00 [INF] End processing HTTP request after 435.0826ms - 200
2025-02-02 21:58:58.665 +03:00 [INF] Raw response length: 202
2025-02-02 21:58:58.665 +03:00 [INF] Response content: {"success":true,"errors":[],"result":{"nationalId":"1064448614","otp":"369654","verifiedFlag":true,"successMsg":"Verified successfully.","errCode":0,"errMsg":null},"type":"N","message":null,"code":null}
2025-02-02 21:58:58.666 +03:00 [INF] Executing ContentResult with HTTP Response ContentType of application/json
2025-02-02 21:58:58.666 +03:00 [INF] Executed action NayifatAPI.Controllers.ProxyController.ForwardRequest (NayifatAPI) in 437.7789ms
2025-02-02 21:58:58.667 +03:00 [INF] Executed endpoint 'NayifatAPI.Controllers.ProxyController.ForwardRequest (NayifatAPI)'
2025-02-02 21:58:58.668 +03:00 [INF] Request finished HTTP/1.1 POST http://07ca-46-152-255-232.ngrok-free.app/api/proxy/forward?url=https://icreditdept.com/api/testasp/test_local_verify_otp.php - 200 202 application/json 445.7545ms
2025-02-02 21:59:12.696 +03:00 [INF] Request starting HTTP/1.1 POST http://07ca-46-152-255-232.ngrok-free.app/api/notifications/list - application/json; charset=utf-8 47
2025-02-02 21:59:12.699 +03:00 [INF] Executing endpoint 'NayifatAPI.Controllers.NotificationsController.GetNotifications (NayifatAPI)'
2025-02-02 21:59:12.700 +03:00 [INF] Route matched with {action = "GetNotifications", controller = "Notifications"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetNotifications(NayifatAPI.Controllers.GetNotificationsRequest) on controller NayifatAPI.Controllers.NotificationsController (NayifatAPI).
2025-02-02 21:59:12.704 +03:00 [INF] Executed DbCommand (2ms) [Parameters=[@__providedApiKey_0='?' (Size = 255)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [a].[Key], [a].[CreatedAt], [a].[Description], [a].[ExpiresAt], [a].[IsActive], [a].[LastUsedAt]
FROM [ApiKeys] AS [a]
WHERE [a].[Key] = @__providedApiKey_0 AND [a].[IsActive] = CAST(1 AS bit)
2025-02-02 21:59:12.708 +03:00 [INF] Executed DbCommand (2ms) [Parameters=[@__request_NationalId_0='?' (Size = 450)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [u].[national_id], [u].[last_updated], [u].[notifications]
FROM [user_notifications] AS [u]
WHERE [u].[national_id] = @__request_NationalId_0
2025-02-02 21:59:12.712 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@__Parse_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [n].[Id], [n].[additional_data], [n].[Body], [n].[body_ar], [n].[body_en], [n].[created_at], [n].[expiry_at], [n].[Route], [n].[target_criteria], [n].[Title], [n].[title_ar], [n].[title_en]
FROM [notification_templates] AS [n]
WHERE [n].[Id] = @__Parse_0
2025-02-02 21:59:12.714 +03:00 [INF] Executed DbCommand (0ms) [Parameters=[@__Parse_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [n].[Id], [n].[additional_data], [n].[Body], [n].[body_ar], [n].[body_en], [n].[created_at], [n].[expiry_at], [n].[Route], [n].[target_criteria], [n].[Title], [n].[title_ar], [n].[title_en]
FROM [notification_templates] AS [n]
WHERE [n].[Id] = @__Parse_0
2025-02-02 21:59:12.792 +03:00 [INF] Executed DbCommand (75ms) [Parameters=[@p0='?' (Size = 4000), @p1='?' (DbType = DateTime2), @p2='?' (Size = 4000), @p3='?' (Size = 4000), @p4='?' (Size = 4000), @p5='?' (Size = 450), @p6='?' (Size = 4000), @p7='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SET IMPLICIT_TRANSACTIONS OFF;
SET NOCOUNT ON;
INSERT INTO [AuthLogs] ([AuthType], [CreatedAt], [DeviceId], [FailureReason], [IpAddress], [NationalId], [Status], [UserAgent])
OUTPUT INSERTED.[Id]
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7);
2025-02-02 21:59:12.795 +03:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType9`2[[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Object, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-02-02 21:59:12.796 +03:00 [INF] Executed action NayifatAPI.Controllers.NotificationsController.GetNotifications (NayifatAPI) in 94.4927ms
2025-02-02 21:59:12.797 +03:00 [INF] Executed endpoint 'NayifatAPI.Controllers.NotificationsController.GetNotifications (NayifatAPI)'
2025-02-02 21:59:12.798 +03:00 [INF] Request finished HTTP/1.1 POST http://07ca-46-152-255-232.ngrok-free.app/api/notifications/list - 200 null application/json; charset=utf-8 101.9886ms
2025-02-02 22:04:42.473 +03:00 [INF] Request starting HTTP/1.1 POST http://07ca-46-152-255-232.ngrok-free.app/api/notifications/list - application/json; charset=utf-8 47
2025-02-02 22:04:42.479 +03:00 [INF] Executing endpoint 'NayifatAPI.Controllers.NotificationsController.GetNotifications (NayifatAPI)'
2025-02-02 22:04:42.480 +03:00 [INF] Route matched with {action = "GetNotifications", controller = "Notifications"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetNotifications(NayifatAPI.Controllers.GetNotificationsRequest) on controller NayifatAPI.Controllers.NotificationsController (NayifatAPI).
2025-02-02 22:04:42.491 +03:00 [INF] Executed DbCommand (8ms) [Parameters=[@__providedApiKey_0='?' (Size = 255)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [a].[Key], [a].[CreatedAt], [a].[Description], [a].[ExpiresAt], [a].[IsActive], [a].[LastUsedAt]
FROM [ApiKeys] AS [a]
WHERE [a].[Key] = @__providedApiKey_0 AND [a].[IsActive] = CAST(1 AS bit)
2025-02-02 22:04:42.496 +03:00 [INF] Executed DbCommand (2ms) [Parameters=[@__request_NationalId_0='?' (Size = 450)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [u].[national_id], [u].[last_updated], [u].[notifications]
FROM [user_notifications] AS [u]
WHERE [u].[national_id] = @__request_NationalId_0
2025-02-02 22:04:42.500 +03:00 [INF] Executed DbCommand (2ms) [Parameters=[@__Parse_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [n].[Id], [n].[additional_data], [n].[Body], [n].[body_ar], [n].[body_en], [n].[created_at], [n].[expiry_at], [n].[Route], [n].[target_criteria], [n].[Title], [n].[title_ar], [n].[title_en]
FROM [notification_templates] AS [n]
WHERE [n].[Id] = @__Parse_0
2025-02-02 22:04:42.505 +03:00 [INF] Executed DbCommand (0ms) [Parameters=[@__Parse_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [n].[Id], [n].[additional_data], [n].[Body], [n].[body_ar], [n].[body_en], [n].[created_at], [n].[expiry_at], [n].[Route], [n].[target_criteria], [n].[Title], [n].[title_ar], [n].[title_en]
FROM [notification_templates] AS [n]
WHERE [n].[Id] = @__Parse_0
2025-02-02 22:04:42.511 +03:00 [INF] Executed DbCommand (4ms) [Parameters=[@p0='?' (Size = 4000), @p1='?' (DbType = DateTime2), @p2='?' (Size = 4000), @p3='?' (Size = 4000), @p4='?' (Size = 4000), @p5='?' (Size = 450), @p6='?' (Size = 4000), @p7='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SET IMPLICIT_TRANSACTIONS OFF;
SET NOCOUNT ON;
INSERT INTO [AuthLogs] ([AuthType], [CreatedAt], [DeviceId], [FailureReason], [IpAddress], [NationalId], [Status], [UserAgent])
OUTPUT INSERTED.[Id]
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7);
2025-02-02 22:04:42.513 +03:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType9`2[[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Object, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-02-02 22:04:42.515 +03:00 [INF] Executed action NayifatAPI.Controllers.NotificationsController.GetNotifications (NayifatAPI) in 33.4218ms
2025-02-02 22:04:42.516 +03:00 [INF] Executed endpoint 'NayifatAPI.Controllers.NotificationsController.GetNotifications (NayifatAPI)'
2025-02-02 22:04:42.518 +03:00 [INF] Request finished HTTP/1.1 POST http://07ca-46-152-255-232.ngrok-free.app/api/notifications/list - 200 null application/json; charset=utf-8 45.1425ms
2025-02-02 22:04:54.357 +03:00 [INF] Request starting HTTP/1.1 POST http://07ca-46-152-255-232.ngrok-free.app/api/auth/signin - application/json; charset=utf-8 78
2025-02-02 22:04:54.360 +03:00 [INF] Executing endpoint 'NayifatAPI.Controllers.AuthController.SignIn (NayifatAPI)'
2025-02-02 22:04:54.361 +03:00 [INF] Route matched with {action = "SignIn", controller = "Auth"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] SignIn(NayifatAPI.Controllers.SignInRequest) on controller NayifatAPI.Controllers.AuthController (NayifatAPI).
2025-02-02 22:04:54.367 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@__providedApiKey_0='?' (Size = 255)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [a].[Key], [a].[CreatedAt], [a].[Description], [a].[ExpiresAt], [a].[IsActive], [a].[LastUsedAt]
FROM [ApiKeys] AS [a]
WHERE [a].[Key] = @__providedApiKey_0 AND [a].[IsActive] = CAST(1 AS bit)
2025-02-02 22:04:54.374 +03:00 [INF] Executed DbCommand (3ms) [Parameters=[@__request_NationalId_0='?' (Size = 450)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [c].[NationalId], [c].[AddNo], [c].[BuildingNo], [c].[City], [c].[Consent], [c].[ConsentDate], [c].[DateOfBirth], [c].[Dependents], [c].[District], [c].[Email], [c].[Employer], [c].[FamilyNameAr], [c].[FamilyNameEn], [c].[FirstNameAr], [c].[FirstNameEn], [c].[Iban], [c].[IdExpiryDate], [c].[Los], [c].[Mpin], [c].[MpinEnabled], [c].[NafathStatus], [c].[NafathTimestamp], [c].[Password], [c].[Phone], [c].[RegistrationDate], [c].[SalaryCustomer], [c].[SalaryDakhli], [c].[SecondNameAr], [c].[SecondNameEn], [c].[Sector], [c].[Street], [c].[ThirdNameAr], [c].[ThirdNameEn], [c].[Zipcode]
FROM [Customers] AS [c]
WHERE [c].[NationalId] = @__request_NationalId_0
2025-02-02 22:04:54.377 +03:00 [INF] Starting password verification for NationalId: 1064448614
2025-02-02 22:04:54.572 +03:00 [INF] Password verification result for NationalId 1064448614: Success
2025-02-02 22:04:54.647 +03:00 [INF] Executed DbCommand (74ms) [Parameters=[@p0='?' (Size = 4000), @p1='?' (DbType = DateTime2), @p2='?' (Size = 4000), @p3='?' (Size = 4000), @p4='?' (Size = 4000), @p5='?' (Size = 450), @p6='?' (Size = 4000), @p7='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SET IMPLICIT_TRANSACTIONS OFF;
SET NOCOUNT ON;
INSERT INTO [AuthLogs] ([AuthType], [CreatedAt], [DeviceId], [FailureReason], [IpAddress], [NationalId], [Status], [UserAgent])
OUTPUT INSERTED.[Id]
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7);
2025-02-02 22:04:54.653 +03:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType9`2[[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Object, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-02-02 22:04:54.655 +03:00 [INF] Executed action NayifatAPI.Controllers.AuthController.SignIn (NayifatAPI) in 291.7451ms
2025-02-02 22:04:54.657 +03:00 [INF] Executed endpoint 'NayifatAPI.Controllers.AuthController.SignIn (NayifatAPI)'
2025-02-02 22:04:54.659 +03:00 [INF] Request finished HTTP/1.1 POST http://07ca-46-152-255-232.ngrok-free.app/api/auth/signin - 200 null application/json; charset=utf-8 302.2264ms
2025-02-02 22:04:55.542 +03:00 [INF] Request starting HTTP/1.1 POST http://07ca-46-152-255-232.ngrok-free.app/api/proxy/forward?url=https://icreditdept.com/api/testasp/test_local_generate_otp.php - application/json; charset=utf-8 84
2025-02-02 22:04:55.546 +03:00 [INF] Executing endpoint 'NayifatAPI.Controllers.ProxyController.ForwardRequest (NayifatAPI)'
2025-02-02 22:04:55.546 +03:00 [INF] Route matched with {action = "ForwardRequest", controller = "Proxy"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] ForwardRequest() on controller NayifatAPI.Controllers.ProxyController (NayifatAPI).
2025-02-02 22:04:55.549 +03:00 [INF] Start processing HTTP request POST https://icreditdept.com/api/testasp/test_local_generate_otp.php
2025-02-02 22:04:55.550 +03:00 [INF] Sending HTTP request POST https://icreditdept.com/api/testasp/test_local_generate_otp.php
2025-02-02 22:04:56.802 +03:00 [INF] Received HTTP response headers after 1250.1563ms - 200
2025-02-02 22:04:56.805 +03:00 [INF] End processing HTTP request after 1255.6126ms - 200
2025-02-02 22:04:56.806 +03:00 [INF] Raw response length: 200
2025-02-02 22:04:56.807 +03:00 [INF] Response content: {"success":true,"errors":[],"result":{"nationalId":"1064448614","otp":425094,"expiryDate":"2025-02-02 22:09:57","successMsg":"Success","errCode":0,"errMsg":null},"type":"N","message":null,"code":null}
2025-02-02 22:04:56.809 +03:00 [INF] Executing ContentResult with HTTP Response ContentType of application/json
2025-02-02 22:04:56.811 +03:00 [INF] Executed action NayifatAPI.Controllers.ProxyController.ForwardRequest (NayifatAPI) in 1262.3828ms
2025-02-02 22:04:56.813 +03:00 [INF] Executed endpoint 'NayifatAPI.Controllers.ProxyController.ForwardRequest (NayifatAPI)'
2025-02-02 22:04:56.814 +03:00 [INF] Request finished HTTP/1.1 POST http://07ca-46-152-255-232.ngrok-free.app/api/proxy/forward?url=https://icreditdept.com/api/testasp/test_local_generate_otp.php - 200 200 application/json 1271.9126ms
2025-02-02 22:05:06.726 +03:00 [INF] Request starting HTTP/1.1 POST http://07ca-46-152-255-232.ngrok-free.app/api/proxy/forward?url=https://icreditdept.com/api/testasp/test_local_verify_otp.php - application/json; charset=utf-8 53
2025-02-02 22:05:06.730 +03:00 [INF] Executing endpoint 'NayifatAPI.Controllers.ProxyController.ForwardRequest (NayifatAPI)'
2025-02-02 22:05:06.731 +03:00 [INF] Route matched with {action = "ForwardRequest", controller = "Proxy"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] ForwardRequest() on controller NayifatAPI.Controllers.ProxyController (NayifatAPI).
2025-02-02 22:05:06.734 +03:00 [INF] Start processing HTTP request POST https://icreditdept.com/api/testasp/test_local_verify_otp.php
2025-02-02 22:05:06.735 +03:00 [INF] Sending HTTP request POST https://icreditdept.com/api/testasp/test_local_verify_otp.php
2025-02-02 22:05:07.171 +03:00 [INF] Received HTTP response headers after 430.3311ms - 200
2025-02-02 22:05:07.173 +03:00 [INF] End processing HTTP request after 438.9316ms - 200
2025-02-02 22:05:07.174 +03:00 [INF] Raw response length: 202
2025-02-02 22:05:07.175 +03:00 [INF] Response content: {"success":true,"errors":[],"result":{"nationalId":"1064448614","otp":"425094","verifiedFlag":true,"successMsg":"Verified successfully.","errCode":0,"errMsg":null},"type":"N","message":null,"code":null}
2025-02-02 22:05:07.176 +03:00 [INF] Executing ContentResult with HTTP Response ContentType of application/json
2025-02-02 22:05:07.177 +03:00 [INF] Executed action NayifatAPI.Controllers.ProxyController.ForwardRequest (NayifatAPI) in 443.486ms
2025-02-02 22:05:07.178 +03:00 [INF] Executed endpoint 'NayifatAPI.Controllers.ProxyController.ForwardRequest (NayifatAPI)'
2025-02-02 22:05:07.179 +03:00 [INF] Request finished HTTP/1.1 POST http://07ca-46-152-255-232.ngrok-free.app/api/proxy/forward?url=https://icreditdept.com/api/testasp/test_local_verify_otp.php - 200 202 application/json 453.0336ms
2025-02-02 22:05:21.550 +03:00 [INF] Request starting HTTP/1.1 POST http://07ca-46-152-255-232.ngrok-free.app/api/notifications/list - application/json; charset=utf-8 47
2025-02-02 22:05:21.624 +03:00 [INF] Executing endpoint 'NayifatAPI.Controllers.NotificationsController.GetNotifications (NayifatAPI)'
2025-02-02 22:05:21.625 +03:00 [INF] Route matched with {action = "GetNotifications", controller = "Notifications"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetNotifications(NayifatAPI.Controllers.GetNotificationsRequest) on controller NayifatAPI.Controllers.NotificationsController (NayifatAPI).
2025-02-02 22:05:21.628 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@__providedApiKey_0='?' (Size = 255)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [a].[Key], [a].[CreatedAt], [a].[Description], [a].[ExpiresAt], [a].[IsActive], [a].[LastUsedAt]
FROM [ApiKeys] AS [a]
WHERE [a].[Key] = @__providedApiKey_0 AND [a].[IsActive] = CAST(1 AS bit)
2025-02-02 22:05:21.631 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@__request_NationalId_0='?' (Size = 450)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [u].[national_id], [u].[last_updated], [u].[notifications]
FROM [user_notifications] AS [u]
WHERE [u].[national_id] = @__request_NationalId_0
2025-02-02 22:05:21.634 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@__Parse_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [n].[Id], [n].[additional_data], [n].[Body], [n].[body_ar], [n].[body_en], [n].[created_at], [n].[expiry_at], [n].[Route], [n].[target_criteria], [n].[Title], [n].[title_ar], [n].[title_en]
FROM [notification_templates] AS [n]
WHERE [n].[Id] = @__Parse_0
2025-02-02 22:05:21.638 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@__Parse_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [n].[Id], [n].[additional_data], [n].[Body], [n].[body_ar], [n].[body_en], [n].[created_at], [n].[expiry_at], [n].[Route], [n].[target_criteria], [n].[Title], [n].[title_ar], [n].[title_en]
FROM [notification_templates] AS [n]
WHERE [n].[Id] = @__Parse_0
2025-02-02 22:05:21.714 +03:00 [INF] Executed DbCommand (74ms) [Parameters=[@p0='?' (Size = 4000), @p1='?' (DbType = DateTime2), @p2='?' (Size = 4000), @p3='?' (Size = 4000), @p4='?' (Size = 4000), @p5='?' (Size = 450), @p6='?' (Size = 4000), @p7='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SET IMPLICIT_TRANSACTIONS OFF;
SET NOCOUNT ON;
INSERT INTO [AuthLogs] ([AuthType], [CreatedAt], [DeviceId], [FailureReason], [IpAddress], [NationalId], [Status], [UserAgent])
OUTPUT INSERTED.[Id]
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7);
2025-02-02 22:05:21.717 +03:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType9`2[[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Object, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-02-02 22:05:21.718 +03:00 [INF] Executed action NayifatAPI.Controllers.NotificationsController.GetNotifications (NayifatAPI) in 91.2351ms
2025-02-02 22:05:21.719 +03:00 [INF] Executed endpoint 'NayifatAPI.Controllers.NotificationsController.GetNotifications (NayifatAPI)'
2025-02-02 22:05:21.721 +03:00 [INF] Request finished HTTP/1.1 POST http://07ca-46-152-255-232.ngrok-free.app/api/notifications/list - 200 null application/json; charset=utf-8 170.542ms
2025-02-02 22:10:23.059 +03:00 [INF] Request starting HTTP/1.1 POST http://07ca-46-152-255-232.ngrok-free.app/api/notifications/list - application/json; charset=utf-8 47
2025-02-02 22:10:23.078 +03:00 [INF] Executing endpoint 'NayifatAPI.Controllers.NotificationsController.GetNotifications (NayifatAPI)'
2025-02-02 22:10:23.079 +03:00 [INF] Route matched with {action = "GetNotifications", controller = "Notifications"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetNotifications(NayifatAPI.Controllers.GetNotificationsRequest) on controller NayifatAPI.Controllers.NotificationsController (NayifatAPI).
2025-02-02 22:10:23.189 +03:00 [INF] Executed DbCommand (94ms) [Parameters=[@__providedApiKey_0='?' (Size = 255)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [a].[Key], [a].[CreatedAt], [a].[Description], [a].[ExpiresAt], [a].[IsActive], [a].[LastUsedAt]
FROM [ApiKeys] AS [a]
WHERE [a].[Key] = @__providedApiKey_0 AND [a].[IsActive] = CAST(1 AS bit)
2025-02-02 22:10:23.370 +03:00 [INF] Executed DbCommand (2ms) [Parameters=[@__request_NationalId_0='?' (Size = 450)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [u].[national_id], [u].[last_updated], [u].[notifications]
FROM [user_notifications] AS [u]
WHERE [u].[national_id] = @__request_NationalId_0
2025-02-02 22:10:23.374 +03:00 [INF] Executed DbCommand (2ms) [Parameters=[@__Parse_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [n].[Id], [n].[additional_data], [n].[Body], [n].[body_ar], [n].[body_en], [n].[created_at], [n].[expiry_at], [n].[Route], [n].[target_criteria], [n].[Title], [n].[title_ar], [n].[title_en]
FROM [notification_templates] AS [n]
WHERE [n].[Id] = @__Parse_0
2025-02-02 22:10:23.708 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@__Parse_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [n].[Id], [n].[additional_data], [n].[Body], [n].[body_ar], [n].[body_en], [n].[created_at], [n].[expiry_at], [n].[Route], [n].[target_criteria], [n].[Title], [n].[title_ar], [n].[title_en]
FROM [notification_templates] AS [n]
WHERE [n].[Id] = @__Parse_0
2025-02-02 22:10:23.900 +03:00 [INF] Executed DbCommand (188ms) [Parameters=[@p0='?' (Size = 4000), @p1='?' (DbType = DateTime2), @p2='?' (Size = 4000), @p3='?' (Size = 4000), @p4='?' (Size = 4000), @p5='?' (Size = 450), @p6='?' (Size = 4000), @p7='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SET IMPLICIT_TRANSACTIONS OFF;
SET NOCOUNT ON;
INSERT INTO [AuthLogs] ([AuthType], [CreatedAt], [DeviceId], [FailureReason], [IpAddress], [NationalId], [Status], [UserAgent])
OUTPUT INSERTED.[Id]
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7);
2025-02-02 22:10:24.015 +03:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType9`2[[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Object, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-02-02 22:10:24.018 +03:00 [INF] Executed action NayifatAPI.Controllers.NotificationsController.GetNotifications (NayifatAPI) in 937.5663ms
2025-02-02 22:10:24.020 +03:00 [INF] Executed endpoint 'NayifatAPI.Controllers.NotificationsController.GetNotifications (NayifatAPI)'
2025-02-02 22:10:24.022 +03:00 [INF] Request finished HTTP/1.1 POST http://07ca-46-152-255-232.ngrok-free.app/api/notifications/list - 200 null application/json; charset=utf-8 963.3899ms
2025-02-02 22:15:17.854 +03:00 [INF] Request starting HTTP/1.1 POST http://07ca-46-152-255-232.ngrok-free.app/api/notifications/list - application/json; charset=utf-8 47
2025-02-02 22:15:17.910 +03:00 [INF] Executing endpoint 'NayifatAPI.Controllers.NotificationsController.GetNotifications (NayifatAPI)'
2025-02-02 22:15:17.912 +03:00 [INF] Route matched with {action = "GetNotifications", controller = "Notifications"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetNotifications(NayifatAPI.Controllers.GetNotificationsRequest) on controller NayifatAPI.Controllers.NotificationsController (NayifatAPI).
2025-02-02 22:15:17.919 +03:00 [INF] Executed DbCommand (3ms) [Parameters=[@__providedApiKey_0='?' (Size = 255)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [a].[Key], [a].[CreatedAt], [a].[Description], [a].[ExpiresAt], [a].[IsActive], [a].[LastUsedAt]
FROM [ApiKeys] AS [a]
WHERE [a].[Key] = @__providedApiKey_0 AND [a].[IsActive] = CAST(1 AS bit)
2025-02-02 22:15:17.925 +03:00 [INF] Executed DbCommand (3ms) [Parameters=[@__request_NationalId_0='?' (Size = 450)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [u].[national_id], [u].[last_updated], [u].[notifications]
FROM [user_notifications] AS [u]
WHERE [u].[national_id] = @__request_NationalId_0
2025-02-02 22:15:18.238 +03:00 [INF] Executed DbCommand (44ms) [Parameters=[@__Parse_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [n].[Id], [n].[additional_data], [n].[Body], [n].[body_ar], [n].[body_en], [n].[created_at], [n].[expiry_at], [n].[Route], [n].[target_criteria], [n].[Title], [n].[title_ar], [n].[title_en]
FROM [notification_templates] AS [n]
WHERE [n].[Id] = @__Parse_0
2025-02-02 22:15:18.246 +03:00 [INF] Executed DbCommand (3ms) [Parameters=[@__Parse_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [n].[Id], [n].[additional_data], [n].[Body], [n].[body_ar], [n].[body_en], [n].[created_at], [n].[expiry_at], [n].[Route], [n].[target_criteria], [n].[Title], [n].[title_ar], [n].[title_en]
FROM [notification_templates] AS [n]
WHERE [n].[Id] = @__Parse_0
2025-02-02 22:15:18.913 +03:00 [INF] Executed DbCommand (324ms) [Parameters=[@p0='?' (Size = 4000), @p1='?' (DbType = DateTime2), @p2='?' (Size = 4000), @p3='?' (Size = 4000), @p4='?' (Size = 4000), @p5='?' (Size = 450), @p6='?' (Size = 4000), @p7='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SET IMPLICIT_TRANSACTIONS OFF;
SET NOCOUNT ON;
INSERT INTO [AuthLogs] ([AuthType], [CreatedAt], [DeviceId], [FailureReason], [IpAddress], [NationalId], [Status], [UserAgent])
OUTPUT INSERTED.[Id]
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7);
2025-02-02 22:15:18.921 +03:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType9`2[[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Object, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-02-02 22:15:18.923 +03:00 [INF] Executed action NayifatAPI.Controllers.NotificationsController.GetNotifications (NayifatAPI) in 1008.4576ms
2025-02-02 22:15:18.927 +03:00 [INF] Executed endpoint 'NayifatAPI.Controllers.NotificationsController.GetNotifications (NayifatAPI)'
2025-02-02 22:15:19.019 +03:00 [INF] Request finished HTTP/1.1 POST http://07ca-46-152-255-232.ngrok-free.app/api/notifications/list - 200 null application/json; charset=utf-8 1164.4769ms
2025-02-02 22:17:20.789 +03:00 [INF] Request starting HTTP/1.1 POST http://07ca-46-152-255-232.ngrok-free.app/api/auth/signin - application/json; charset=utf-8 78
2025-02-02 22:17:20.791 +03:00 [INF] Executing endpoint 'NayifatAPI.Controllers.AuthController.SignIn (NayifatAPI)'
2025-02-02 22:17:20.791 +03:00 [INF] Route matched with {action = "SignIn", controller = "Auth"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] SignIn(NayifatAPI.Controllers.SignInRequest) on controller NayifatAPI.Controllers.AuthController (NayifatAPI).
2025-02-02 22:17:20.796 +03:00 [INF] Executed DbCommand (3ms) [Parameters=[@__providedApiKey_0='?' (Size = 255)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [a].[Key], [a].[CreatedAt], [a].[Description], [a].[ExpiresAt], [a].[IsActive], [a].[LastUsedAt]
FROM [ApiKeys] AS [a]
WHERE [a].[Key] = @__providedApiKey_0 AND [a].[IsActive] = CAST(1 AS bit)
2025-02-02 22:17:20.801 +03:00 [INF] Executed DbCommand (2ms) [Parameters=[@__request_NationalId_0='?' (Size = 450)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [c].[NationalId], [c].[AddNo], [c].[BuildingNo], [c].[City], [c].[Consent], [c].[ConsentDate], [c].[DateOfBirth], [c].[Dependents], [c].[District], [c].[Email], [c].[Employer], [c].[FamilyNameAr], [c].[FamilyNameEn], [c].[FirstNameAr], [c].[FirstNameEn], [c].[Iban], [c].[IdExpiryDate], [c].[Los], [c].[Mpin], [c].[MpinEnabled], [c].[NafathStatus], [c].[NafathTimestamp], [c].[Password], [c].[Phone], [c].[RegistrationDate], [c].[SalaryCustomer], [c].[SalaryDakhli], [c].[SecondNameAr], [c].[SecondNameEn], [c].[Sector], [c].[Street], [c].[ThirdNameAr], [c].[ThirdNameEn], [c].[Zipcode]
FROM [Customers] AS [c]
WHERE [c].[NationalId] = @__request_NationalId_0
2025-02-02 22:17:20.803 +03:00 [INF] Starting password verification for NationalId: 1064448614
2025-02-02 22:17:20.979 +03:00 [INF] Password verification result for NationalId 1064448614: Success
2025-02-02 22:17:20.983 +03:00 [INF] Executed DbCommand (2ms) [Parameters=[@p0='?' (Size = 4000), @p1='?' (DbType = DateTime2), @p2='?' (Size = 4000), @p3='?' (Size = 4000), @p4='?' (Size = 4000), @p5='?' (Size = 450), @p6='?' (Size = 4000), @p7='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SET IMPLICIT_TRANSACTIONS OFF;
SET NOCOUNT ON;
INSERT INTO [AuthLogs] ([AuthType], [CreatedAt], [DeviceId], [FailureReason], [IpAddress], [NationalId], [Status], [UserAgent])
OUTPUT INSERTED.[Id]
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7);
2025-02-02 22:17:20.985 +03:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType9`2[[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Object, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-02-02 22:17:20.987 +03:00 [INF] Executed action NayifatAPI.Controllers.AuthController.SignIn (NayifatAPI) in 194.0258ms
2025-02-02 22:17:20.988 +03:00 [INF] Executed endpoint 'NayifatAPI.Controllers.AuthController.SignIn (NayifatAPI)'
2025-02-02 22:17:20.988 +03:00 [INF] Request finished HTTP/1.1 POST http://07ca-46-152-255-232.ngrok-free.app/api/auth/signin - 200 null application/json; charset=utf-8 199.3744ms
2025-02-02 22:17:22.016 +03:00 [INF] Request starting HTTP/1.1 POST http://07ca-46-152-255-232.ngrok-free.app/api/proxy/forward?url=https://icreditdept.com/api/testasp/test_local_generate_otp.php - application/json; charset=utf-8 84
2025-02-02 22:17:22.024 +03:00 [INF] Executing endpoint 'NayifatAPI.Controllers.ProxyController.ForwardRequest (NayifatAPI)'
2025-02-02 22:17:22.025 +03:00 [INF] Route matched with {action = "ForwardRequest", controller = "Proxy"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] ForwardRequest() on controller NayifatAPI.Controllers.ProxyController (NayifatAPI).
2025-02-02 22:17:22.027 +03:00 [INF] Start processing HTTP request POST https://icreditdept.com/api/testasp/test_local_generate_otp.php
2025-02-02 22:17:22.027 +03:00 [INF] Sending HTTP request POST https://icreditdept.com/api/testasp/test_local_generate_otp.php
2025-02-02 22:17:22.763 +03:00 [INF] Received HTTP response headers after 734.9474ms - 200
2025-02-02 22:17:22.766 +03:00 [INF] End processing HTTP request after 739.2161ms - 200
2025-02-02 22:17:22.767 +03:00 [INF] Raw response length: 200
2025-02-02 22:17:22.767 +03:00 [INF] Response content: {"success":true,"errors":[],"result":{"nationalId":"1064448614","otp":252195,"expiryDate":"2025-02-02 22:22:23","successMsg":"Success","errCode":0,"errMsg":null},"type":"N","message":null,"code":null}
2025-02-02 22:17:22.768 +03:00 [INF] Executing ContentResult with HTTP Response ContentType of application/json
2025-02-02 22:17:22.769 +03:00 [INF] Executed action NayifatAPI.Controllers.ProxyController.ForwardRequest (NayifatAPI) in 742.3492ms
2025-02-02 22:17:22.770 +03:00 [INF] Executed endpoint 'NayifatAPI.Controllers.ProxyController.ForwardRequest (NayifatAPI)'
2025-02-02 22:17:22.771 +03:00 [INF] Request finished HTTP/1.1 POST http://07ca-46-152-255-232.ngrok-free.app/api/proxy/forward?url=https://icreditdept.com/api/testasp/test_local_generate_otp.php - 200 200 application/json 754.7826ms
2025-02-02 22:17:31.185 +03:00 [INF] Request starting HTTP/1.1 POST http://07ca-46-152-255-232.ngrok-free.app/api/proxy/forward?url=https://icreditdept.com/api/testasp/test_local_verify_otp.php - application/json; charset=utf-8 53
2025-02-02 22:17:31.189 +03:00 [INF] Executing endpoint 'NayifatAPI.Controllers.ProxyController.ForwardRequest (NayifatAPI)'
2025-02-02 22:17:31.189 +03:00 [INF] Route matched with {action = "ForwardRequest", controller = "Proxy"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] ForwardRequest() on controller NayifatAPI.Controllers.ProxyController (NayifatAPI).
2025-02-02 22:17:31.191 +03:00 [INF] Start processing HTTP request POST https://icreditdept.com/api/testasp/test_local_verify_otp.php
2025-02-02 22:17:31.191 +03:00 [INF] Sending HTTP request POST https://icreditdept.com/api/testasp/test_local_verify_otp.php
2025-02-02 22:17:31.623 +03:00 [INF] Received HTTP response headers after 430.8965ms - 200
2025-02-02 22:17:31.625 +03:00 [INF] End processing HTTP request after 434.1994ms - 200
2025-02-02 22:17:31.627 +03:00 [INF] Raw response length: 202
2025-02-02 22:17:31.627 +03:00 [INF] Response content: {"success":true,"errors":[],"result":{"nationalId":"1064448614","otp":"252195","verifiedFlag":true,"successMsg":"Verified successfully.","errCode":0,"errMsg":null},"type":"N","message":null,"code":null}
2025-02-02 22:17:31.628 +03:00 [INF] Executing ContentResult with HTTP Response ContentType of application/json
2025-02-02 22:17:31.629 +03:00 [INF] Executed action NayifatAPI.Controllers.ProxyController.ForwardRequest (NayifatAPI) in 438.3014ms
2025-02-02 22:17:31.631 +03:00 [INF] Executed endpoint 'NayifatAPI.Controllers.ProxyController.ForwardRequest (NayifatAPI)'
2025-02-02 22:17:31.632 +03:00 [INF] Request finished HTTP/1.1 POST http://07ca-46-152-255-232.ngrok-free.app/api/proxy/forward?url=https://icreditdept.com/api/testasp/test_local_verify_otp.php - 200 202 application/json 446.4169ms
2025-02-02 22:17:44.980 +03:00 [INF] Request starting HTTP/1.1 POST http://07ca-46-152-255-232.ngrok-free.app/api/notifications/list - application/json; charset=utf-8 47
2025-02-02 22:17:44.983 +03:00 [INF] Executing endpoint 'NayifatAPI.Controllers.NotificationsController.GetNotifications (NayifatAPI)'
2025-02-02 22:17:44.984 +03:00 [INF] Route matched with {action = "GetNotifications", controller = "Notifications"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetNotifications(NayifatAPI.Controllers.GetNotificationsRequest) on controller NayifatAPI.Controllers.NotificationsController (NayifatAPI).
2025-02-02 22:17:44.992 +03:00 [INF] Executed DbCommand (4ms) [Parameters=[@__providedApiKey_0='?' (Size = 255)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [a].[Key], [a].[CreatedAt], [a].[Description], [a].[ExpiresAt], [a].[IsActive], [a].[LastUsedAt]
FROM [ApiKeys] AS [a]
WHERE [a].[Key] = @__providedApiKey_0 AND [a].[IsActive] = CAST(1 AS bit)
2025-02-02 22:17:44.998 +03:00 [INF] Executed DbCommand (2ms) [Parameters=[@__request_NationalId_0='?' (Size = 450)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [u].[national_id], [u].[last_updated], [u].[notifications]
FROM [user_notifications] AS [u]
WHERE [u].[national_id] = @__request_NationalId_0
2025-02-02 22:17:45.002 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@__Parse_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [n].[Id], [n].[additional_data], [n].[Body], [n].[body_ar], [n].[body_en], [n].[created_at], [n].[expiry_at], [n].[Route], [n].[target_criteria], [n].[Title], [n].[title_ar], [n].[title_en]
FROM [notification_templates] AS [n]
WHERE [n].[Id] = @__Parse_0
2025-02-02 22:17:45.005 +03:00 [INF] Executed DbCommand (0ms) [Parameters=[@__Parse_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [n].[Id], [n].[additional_data], [n].[Body], [n].[body_ar], [n].[body_en], [n].[created_at], [n].[expiry_at], [n].[Route], [n].[target_criteria], [n].[Title], [n].[title_ar], [n].[title_en]
FROM [notification_templates] AS [n]
WHERE [n].[Id] = @__Parse_0
2025-02-02 22:17:45.084 +03:00 [INF] Executed DbCommand (77ms) [Parameters=[@p0='?' (Size = 4000), @p1='?' (DbType = DateTime2), @p2='?' (Size = 4000), @p3='?' (Size = 4000), @p4='?' (Size = 4000), @p5='?' (Size = 450), @p6='?' (Size = 4000), @p7='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SET IMPLICIT_TRANSACTIONS OFF;
SET NOCOUNT ON;
INSERT INTO [AuthLogs] ([AuthType], [CreatedAt], [DeviceId], [FailureReason], [IpAddress], [NationalId], [Status], [UserAgent])
OUTPUT INSERTED.[Id]
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7);
2025-02-02 22:17:45.087 +03:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType9`2[[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Object, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-02-02 22:17:45.087 +03:00 [INF] Executed action NayifatAPI.Controllers.NotificationsController.GetNotifications (NayifatAPI) in 99.5587ms
2025-02-02 22:17:45.088 +03:00 [INF] Executed endpoint 'NayifatAPI.Controllers.NotificationsController.GetNotifications (NayifatAPI)'
2025-02-02 22:17:45.089 +03:00 [INF] Request finished HTTP/1.1 POST http://07ca-46-152-255-232.ngrok-free.app/api/notifications/list - 200 null application/json; charset=utf-8 108.8769ms
2025-02-02 22:19:08.052 +03:00 [INF] Request starting HTTP/1.1 POST http://07ca-46-152-255-232.ngrok-free.app/api/auth/signin - application/json; charset=utf-8 78
2025-02-02 22:19:08.056 +03:00 [INF] Executing endpoint 'NayifatAPI.Controllers.AuthController.SignIn (NayifatAPI)'
2025-02-02 22:19:08.056 +03:00 [INF] Route matched with {action = "SignIn", controller = "Auth"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] SignIn(NayifatAPI.Controllers.SignInRequest) on controller NayifatAPI.Controllers.AuthController (NayifatAPI).
2025-02-02 22:19:08.063 +03:00 [INF] Executed DbCommand (3ms) [Parameters=[@__providedApiKey_0='?' (Size = 255)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [a].[Key], [a].[CreatedAt], [a].[Description], [a].[ExpiresAt], [a].[IsActive], [a].[LastUsedAt]
FROM [ApiKeys] AS [a]
WHERE [a].[Key] = @__providedApiKey_0 AND [a].[IsActive] = CAST(1 AS bit)
2025-02-02 22:19:08.070 +03:00 [INF] Executed DbCommand (2ms) [Parameters=[@__request_NationalId_0='?' (Size = 450)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [c].[NationalId], [c].[AddNo], [c].[BuildingNo], [c].[City], [c].[Consent], [c].[ConsentDate], [c].[DateOfBirth], [c].[Dependents], [c].[District], [c].[Email], [c].[Employer], [c].[FamilyNameAr], [c].[FamilyNameEn], [c].[FirstNameAr], [c].[FirstNameEn], [c].[Iban], [c].[IdExpiryDate], [c].[Los], [c].[Mpin], [c].[MpinEnabled], [c].[NafathStatus], [c].[NafathTimestamp], [c].[Password], [c].[Phone], [c].[RegistrationDate], [c].[SalaryCustomer], [c].[SalaryDakhli], [c].[SecondNameAr], [c].[SecondNameEn], [c].[Sector], [c].[Street], [c].[ThirdNameAr], [c].[ThirdNameEn], [c].[Zipcode]
FROM [Customers] AS [c]
WHERE [c].[NationalId] = @__request_NationalId_0
2025-02-02 22:19:08.073 +03:00 [INF] Starting password verification for NationalId: 1064448614
2025-02-02 22:19:08.240 +03:00 [INF] Password verification result for NationalId 1064448614: Success
2025-02-02 22:19:08.342 +03:00 [INF] Executed DbCommand (97ms) [Parameters=[@p0='?' (Size = 4000), @p1='?' (DbType = DateTime2), @p2='?' (Size = 4000), @p3='?' (Size = 4000), @p4='?' (Size = 4000), @p5='?' (Size = 450), @p6='?' (Size = 4000), @p7='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SET IMPLICIT_TRANSACTIONS OFF;
SET NOCOUNT ON;
INSERT INTO [AuthLogs] ([AuthType], [CreatedAt], [DeviceId], [FailureReason], [IpAddress], [NationalId], [Status], [UserAgent])
OUTPUT INSERTED.[Id]
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7);
2025-02-02 22:19:08.360 +03:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType9`2[[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Object, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-02-02 22:19:08.377 +03:00 [INF] Executed action NayifatAPI.Controllers.AuthController.SignIn (NayifatAPI) in 317.8988ms
2025-02-02 22:19:08.400 +03:00 [INF] Executed endpoint 'NayifatAPI.Controllers.AuthController.SignIn (NayifatAPI)'
2025-02-02 22:19:08.417 +03:00 [INF] Request finished HTTP/1.1 POST http://07ca-46-152-255-232.ngrok-free.app/api/auth/signin - 200 null application/json; charset=utf-8 365.0414ms
2025-02-02 22:19:09.175 +03:00 [INF] Request starting HTTP/1.1 POST http://07ca-46-152-255-232.ngrok-free.app/api/proxy/forward?url=https://icreditdept.com/api/testasp/test_local_generate_otp.php - application/json; charset=utf-8 84
2025-02-02 22:19:09.279 +03:00 [INF] Executing endpoint 'NayifatAPI.Controllers.ProxyController.ForwardRequest (NayifatAPI)'
2025-02-02 22:19:09.283 +03:00 [INF] Route matched with {action = "ForwardRequest", controller = "Proxy"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] ForwardRequest() on controller NayifatAPI.Controllers.ProxyController (NayifatAPI).
2025-02-02 22:19:09.327 +03:00 [INF] Start processing HTTP request POST https://icreditdept.com/api/testasp/test_local_generate_otp.php
2025-02-02 22:19:09.456 +03:00 [INF] Sending HTTP request POST https://icreditdept.com/api/testasp/test_local_generate_otp.php
2025-02-02 22:19:10.538 +03:00 [INF] Received HTTP response headers after 1080.3368ms - 200
2025-02-02 22:19:10.539 +03:00 [INF] End processing HTTP request after 1211.8096ms - 200
2025-02-02 22:19:10.540 +03:00 [INF] Raw response length: 200
2025-02-02 22:19:10.541 +03:00 [INF] Response content: {"success":true,"errors":[],"result":{"nationalId":"1064448614","otp":399575,"expiryDate":"2025-02-02 22:24:10","successMsg":"Success","errCode":0,"errMsg":null},"type":"N","message":null,"code":null}
2025-02-02 22:19:10.543 +03:00 [INF] Executing ContentResult with HTTP Response ContentType of application/json
2025-02-02 22:19:10.543 +03:00 [INF] Executed action NayifatAPI.Controllers.ProxyController.ForwardRequest (NayifatAPI) in 1216.7014ms
2025-02-02 22:19:10.545 +03:00 [INF] Executed endpoint 'NayifatAPI.Controllers.ProxyController.ForwardRequest (NayifatAPI)'
2025-02-02 22:19:10.549 +03:00 [INF] Request finished HTTP/1.1 POST http://07ca-46-152-255-232.ngrok-free.app/api/proxy/forward?url=https://icreditdept.com/api/testasp/test_local_generate_otp.php - 200 200 application/json 1374.4793ms
2025-02-02 22:21:26.161 +03:00 [INF] Request starting HTTP/1.1 POST http://07ca-46-152-255-232.ngrok-free.app/api/proxy/forward?url=https://icreditdept.com/api/testasp/test_local_verify_otp.php - application/json; charset=utf-8 53
2025-02-02 22:21:26.166 +03:00 [INF] Executing endpoint 'NayifatAPI.Controllers.ProxyController.ForwardRequest (NayifatAPI)'
2025-02-02 22:21:26.167 +03:00 [INF] Route matched with {action = "ForwardRequest", controller = "Proxy"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] ForwardRequest() on controller NayifatAPI.Controllers.ProxyController (NayifatAPI).
2025-02-02 22:21:26.168 +03:00 [INF] Start processing HTTP request POST https://icreditdept.com/api/testasp/test_local_verify_otp.php
2025-02-02 22:21:26.169 +03:00 [INF] Sending HTTP request POST https://icreditdept.com/api/testasp/test_local_verify_otp.php
2025-02-02 22:21:26.824 +03:00 [INF] Received HTTP response headers after 654.3614ms - 200
2025-02-02 22:21:26.825 +03:00 [INF] End processing HTTP request after 657.0162ms - 200
2025-02-02 22:21:26.827 +03:00 [INF] Raw response length: 202
2025-02-02 22:21:26.828 +03:00 [INF] Response content: {"success":true,"errors":[],"result":{"nationalId":"1064448614","otp":"399575","verifiedFlag":true,"successMsg":"Verified successfully.","errCode":0,"errMsg":null},"type":"N","message":null,"code":null}
2025-02-02 22:21:26.829 +03:00 [INF] Executing ContentResult with HTTP Response ContentType of application/json
2025-02-02 22:21:26.832 +03:00 [INF] Executed action NayifatAPI.Controllers.ProxyController.ForwardRequest (NayifatAPI) in 663.675ms
2025-02-02 22:21:26.835 +03:00 [INF] Executed endpoint 'NayifatAPI.Controllers.ProxyController.ForwardRequest (NayifatAPI)'
2025-02-02 22:21:26.837 +03:00 [INF] Request finished HTTP/1.1 POST http://07ca-46-152-255-232.ngrok-free.app/api/proxy/forward?url=https://icreditdept.com/api/testasp/test_local_verify_otp.php - 200 202 application/json 676.0667ms
2025-02-02 22:21:41.448 +03:00 [INF] Request starting HTTP/1.1 POST http://07ca-46-152-255-232.ngrok-free.app/api/notifications/list - application/json; charset=utf-8 47
2025-02-02 22:21:41.450 +03:00 [INF] Executing endpoint 'NayifatAPI.Controllers.NotificationsController.GetNotifications (NayifatAPI)'
2025-02-02 22:21:41.451 +03:00 [INF] Route matched with {action = "GetNotifications", controller = "Notifications"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetNotifications(NayifatAPI.Controllers.GetNotificationsRequest) on controller NayifatAPI.Controllers.NotificationsController (NayifatAPI).
2025-02-02 22:21:41.456 +03:00 [INF] Executed DbCommand (3ms) [Parameters=[@__providedApiKey_0='?' (Size = 255)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [a].[Key], [a].[CreatedAt], [a].[Description], [a].[ExpiresAt], [a].[IsActive], [a].[LastUsedAt]
FROM [ApiKeys] AS [a]
WHERE [a].[Key] = @__providedApiKey_0 AND [a].[IsActive] = CAST(1 AS bit)
2025-02-02 22:21:41.459 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@__request_NationalId_0='?' (Size = 450)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [u].[national_id], [u].[last_updated], [u].[notifications]
FROM [user_notifications] AS [u]
WHERE [u].[national_id] = @__request_NationalId_0
2025-02-02 22:21:41.463 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@__Parse_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [n].[Id], [n].[additional_data], [n].[Body], [n].[body_ar], [n].[body_en], [n].[created_at], [n].[expiry_at], [n].[Route], [n].[target_criteria], [n].[Title], [n].[title_ar], [n].[title_en]
FROM [notification_templates] AS [n]
WHERE [n].[Id] = @__Parse_0
2025-02-02 22:21:41.465 +03:00 [INF] Executed DbCommand (0ms) [Parameters=[@__Parse_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [n].[Id], [n].[additional_data], [n].[Body], [n].[body_ar], [n].[body_en], [n].[created_at], [n].[expiry_at], [n].[Route], [n].[target_criteria], [n].[Title], [n].[title_ar], [n].[title_en]
FROM [notification_templates] AS [n]
WHERE [n].[Id] = @__Parse_0
2025-02-02 22:21:41.545 +03:00 [INF] Executed DbCommand (78ms) [Parameters=[@p0='?' (Size = 4000), @p1='?' (DbType = DateTime2), @p2='?' (Size = 4000), @p3='?' (Size = 4000), @p4='?' (Size = 4000), @p5='?' (Size = 450), @p6='?' (Size = 4000), @p7='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SET IMPLICIT_TRANSACTIONS OFF;
SET NOCOUNT ON;
INSERT INTO [AuthLogs] ([AuthType], [CreatedAt], [DeviceId], [FailureReason], [IpAddress], [NationalId], [Status], [UserAgent])
OUTPUT INSERTED.[Id]
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7);
2025-02-02 22:21:41.549 +03:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType9`2[[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Object, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-02-02 22:21:41.551 +03:00 [INF] Executed action NayifatAPI.Controllers.NotificationsController.GetNotifications (NayifatAPI) in 99.1384ms
2025-02-02 22:21:41.553 +03:00 [INF] Executed endpoint 'NayifatAPI.Controllers.NotificationsController.GetNotifications (NayifatAPI)'
2025-02-02 22:21:41.554 +03:00 [INF] Request finished HTTP/1.1 POST http://07ca-46-152-255-232.ngrok-free.app/api/notifications/list - 200 null application/json; charset=utf-8 106.5987ms
2025-02-02 22:26:43.022 +03:00 [INF] Request starting HTTP/1.1 POST http://07ca-46-152-255-232.ngrok-free.app/api/notifications/list - application/json; charset=utf-8 47
2025-02-02 22:26:43.088 +03:00 [INF] Executing endpoint 'NayifatAPI.Controllers.NotificationsController.GetNotifications (NayifatAPI)'
2025-02-02 22:26:43.089 +03:00 [INF] Route matched with {action = "GetNotifications", controller = "Notifications"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetNotifications(NayifatAPI.Controllers.GetNotificationsRequest) on controller NayifatAPI.Controllers.NotificationsController (NayifatAPI).
2025-02-02 22:26:43.107 +03:00 [INF] Executed DbCommand (15ms) [Parameters=[@__providedApiKey_0='?' (Size = 255)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [a].[Key], [a].[CreatedAt], [a].[Description], [a].[ExpiresAt], [a].[IsActive], [a].[LastUsedAt]
FROM [ApiKeys] AS [a]
WHERE [a].[Key] = @__providedApiKey_0 AND [a].[IsActive] = CAST(1 AS bit)
2025-02-02 22:26:43.158 +03:00 [INF] Executed DbCommand (48ms) [Parameters=[@__request_NationalId_0='?' (Size = 450)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [u].[national_id], [u].[last_updated], [u].[notifications]
FROM [user_notifications] AS [u]
WHERE [u].[national_id] = @__request_NationalId_0
2025-02-02 22:26:43.407 +03:00 [INF] Executed DbCommand (2ms) [Parameters=[@__Parse_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [n].[Id], [n].[additional_data], [n].[Body], [n].[body_ar], [n].[body_en], [n].[created_at], [n].[expiry_at], [n].[Route], [n].[target_criteria], [n].[Title], [n].[title_ar], [n].[title_en]
FROM [notification_templates] AS [n]
WHERE [n].[Id] = @__Parse_0
2025-02-02 22:26:43.411 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@__Parse_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [n].[Id], [n].[additional_data], [n].[Body], [n].[body_ar], [n].[body_en], [n].[created_at], [n].[expiry_at], [n].[Route], [n].[target_criteria], [n].[Title], [n].[title_ar], [n].[title_en]
FROM [notification_templates] AS [n]
WHERE [n].[Id] = @__Parse_0
2025-02-02 22:26:43.760 +03:00 [INF] Executed DbCommand (30ms) [Parameters=[@p0='?' (Size = 4000), @p1='?' (DbType = DateTime2), @p2='?' (Size = 4000), @p3='?' (Size = 4000), @p4='?' (Size = 4000), @p5='?' (Size = 450), @p6='?' (Size = 4000), @p7='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SET IMPLICIT_TRANSACTIONS OFF;
SET NOCOUNT ON;
INSERT INTO [AuthLogs] ([AuthType], [CreatedAt], [DeviceId], [FailureReason], [IpAddress], [NationalId], [Status], [UserAgent])
OUTPUT INSERTED.[Id]
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7);
2025-02-02 22:26:44.039 +03:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType9`2[[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Object, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-02-02 22:26:44.041 +03:00 [INF] Executed action NayifatAPI.Controllers.NotificationsController.GetNotifications (NayifatAPI) in 950.1983ms
2025-02-02 22:26:44.042 +03:00 [INF] Executed endpoint 'NayifatAPI.Controllers.NotificationsController.GetNotifications (NayifatAPI)'
2025-02-02 22:26:44.044 +03:00 [INF] Request finished HTTP/1.1 POST http://07ca-46-152-255-232.ngrok-free.app/api/notifications/list - 200 null application/json; charset=utf-8 1022.6298ms
2025-02-02 22:28:45.203 +03:00 [INF] Request starting HTTP/1.1 POST http://07ca-46-152-255-232.ngrok-free.app/api/notifications/list - application/json; charset=utf-8 47
2025-02-02 22:28:45.208 +03:00 [INF] Executing endpoint 'NayifatAPI.Controllers.NotificationsController.GetNotifications (NayifatAPI)'
2025-02-02 22:28:45.209 +03:00 [INF] Route matched with {action = "GetNotifications", controller = "Notifications"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetNotifications(NayifatAPI.Controllers.GetNotificationsRequest) on controller NayifatAPI.Controllers.NotificationsController (NayifatAPI).
2025-02-02 22:28:45.214 +03:00 [INF] Executed DbCommand (2ms) [Parameters=[@__providedApiKey_0='?' (Size = 255)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [a].[Key], [a].[CreatedAt], [a].[Description], [a].[ExpiresAt], [a].[IsActive], [a].[LastUsedAt]
FROM [ApiKeys] AS [a]
WHERE [a].[Key] = @__providedApiKey_0 AND [a].[IsActive] = CAST(1 AS bit)
2025-02-02 22:28:45.218 +03:00 [INF] Executed DbCommand (2ms) [Parameters=[@__request_NationalId_0='?' (Size = 450)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [u].[national_id], [u].[last_updated], [u].[notifications]
FROM [user_notifications] AS [u]
WHERE [u].[national_id] = @__request_NationalId_0
2025-02-02 22:28:45.224 +03:00 [INF] Executed DbCommand (3ms) [Parameters=[@__Parse_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [n].[Id], [n].[additional_data], [n].[Body], [n].[body_ar], [n].[body_en], [n].[created_at], [n].[expiry_at], [n].[Route], [n].[target_criteria], [n].[Title], [n].[title_ar], [n].[title_en]
FROM [notification_templates] AS [n]
WHERE [n].[Id] = @__Parse_0
2025-02-02 22:28:45.229 +03:00 [INF] Executed DbCommand (2ms) [Parameters=[@__Parse_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [n].[Id], [n].[additional_data], [n].[Body], [n].[body_ar], [n].[body_en], [n].[created_at], [n].[expiry_at], [n].[Route], [n].[target_criteria], [n].[Title], [n].[title_ar], [n].[title_en]
FROM [notification_templates] AS [n]
WHERE [n].[Id] = @__Parse_0
2025-02-02 22:28:45.241 +03:00 [INF] Executed DbCommand (9ms) [Parameters=[@p0='?' (Size = 4000), @p1='?' (DbType = DateTime2), @p2='?' (Size = 4000), @p3='?' (Size = 4000), @p4='?' (Size = 4000), @p5='?' (Size = 450), @p6='?' (Size = 4000), @p7='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SET IMPLICIT_TRANSACTIONS OFF;
SET NOCOUNT ON;
INSERT INTO [AuthLogs] ([AuthType], [CreatedAt], [DeviceId], [FailureReason], [IpAddress], [NationalId], [Status], [UserAgent])
OUTPUT INSERTED.[Id]
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7);
2025-02-02 22:28:45.244 +03:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType9`2[[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Object, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-02-02 22:28:45.245 +03:00 [INF] Executed action NayifatAPI.Controllers.NotificationsController.GetNotifications (NayifatAPI) in 35.1507ms
2025-02-02 22:28:45.246 +03:00 [INF] Executed endpoint 'NayifatAPI.Controllers.NotificationsController.GetNotifications (NayifatAPI)'
2025-02-02 22:28:45.248 +03:00 [INF] Request finished HTTP/1.1 POST http://07ca-46-152-255-232.ngrok-free.app/api/notifications/list - 200 null application/json; charset=utf-8 44.6785ms
2025-02-02 22:30:32.387 +03:00 [INF] Request starting HTTP/1.1 POST http://07ca-46-152-255-232.ngrok-free.app/api/auth/signin - application/json; charset=utf-8 78
2025-02-02 22:30:32.390 +03:00 [INF] Executing endpoint 'NayifatAPI.Controllers.AuthController.SignIn (NayifatAPI)'
2025-02-02 22:30:32.390 +03:00 [INF] Route matched with {action = "SignIn", controller = "Auth"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] SignIn(NayifatAPI.Controllers.SignInRequest) on controller NayifatAPI.Controllers.AuthController (NayifatAPI).
2025-02-02 22:30:32.398 +03:00 [INF] Executed DbCommand (4ms) [Parameters=[@__providedApiKey_0='?' (Size = 255)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [a].[Key], [a].[CreatedAt], [a].[Description], [a].[ExpiresAt], [a].[IsActive], [a].[LastUsedAt]
FROM [ApiKeys] AS [a]
WHERE [a].[Key] = @__providedApiKey_0 AND [a].[IsActive] = CAST(1 AS bit)
2025-02-02 22:30:32.405 +03:00 [INF] Executed DbCommand (4ms) [Parameters=[@__request_NationalId_0='?' (Size = 450)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [c].[NationalId], [c].[AddNo], [c].[BuildingNo], [c].[City], [c].[Consent], [c].[ConsentDate], [c].[DateOfBirth], [c].[Dependents], [c].[District], [c].[Email], [c].[Employer], [c].[FamilyNameAr], [c].[FamilyNameEn], [c].[FirstNameAr], [c].[FirstNameEn], [c].[Iban], [c].[IdExpiryDate], [c].[Los], [c].[Mpin], [c].[MpinEnabled], [c].[NafathStatus], [c].[NafathTimestamp], [c].[Password], [c].[Phone], [c].[RegistrationDate], [c].[SalaryCustomer], [c].[SalaryDakhli], [c].[SecondNameAr], [c].[SecondNameEn], [c].[Sector], [c].[Street], [c].[ThirdNameAr], [c].[ThirdNameEn], [c].[Zipcode]
FROM [Customers] AS [c]
WHERE [c].[NationalId] = @__request_NationalId_0
2025-02-02 22:30:32.410 +03:00 [INF] Starting password verification for NationalId: 1064448614
2025-02-02 22:30:32.622 +03:00 [INF] Password verification result for NationalId 1064448614: Success
2025-02-02 22:30:32.633 +03:00 [INF] Executed DbCommand (9ms) [Parameters=[@p0='?' (Size = 4000), @p1='?' (DbType = DateTime2), @p2='?' (Size = 4000), @p3='?' (Size = 4000), @p4='?' (Size = 4000), @p5='?' (Size = 450), @p6='?' (Size = 4000), @p7='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SET IMPLICIT_TRANSACTIONS OFF;
SET NOCOUNT ON;
INSERT INTO [AuthLogs] ([AuthType], [CreatedAt], [DeviceId], [FailureReason], [IpAddress], [NationalId], [Status], [UserAgent])
OUTPUT INSERTED.[Id]
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7);
2025-02-02 22:30:32.635 +03:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType9`2[[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Object, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-02-02 22:30:32.636 +03:00 [INF] Executed action NayifatAPI.Controllers.AuthController.SignIn (NayifatAPI) in 242.486ms
2025-02-02 22:30:32.637 +03:00 [INF] Executed endpoint 'NayifatAPI.Controllers.AuthController.SignIn (NayifatAPI)'
2025-02-02 22:30:32.638 +03:00 [INF] Request finished HTTP/1.1 POST http://07ca-46-152-255-232.ngrok-free.app/api/auth/signin - 200 null application/json; charset=utf-8 250.3924ms
2025-02-02 22:30:33.380 +03:00 [INF] Request starting HTTP/1.1 POST http://07ca-46-152-255-232.ngrok-free.app/api/proxy/forward?url=https://icreditdept.com/api/testasp/test_local_generate_otp.php - application/json; charset=utf-8 84
2025-02-02 22:30:33.383 +03:00 [INF] Executing endpoint 'NayifatAPI.Controllers.ProxyController.ForwardRequest (NayifatAPI)'
2025-02-02 22:30:33.384 +03:00 [INF] Route matched with {action = "ForwardRequest", controller = "Proxy"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] ForwardRequest() on controller NayifatAPI.Controllers.ProxyController (NayifatAPI).
2025-02-02 22:30:33.386 +03:00 [INF] Start processing HTTP request POST https://icreditdept.com/api/testasp/test_local_generate_otp.php
2025-02-02 22:30:33.387 +03:00 [INF] Sending HTTP request POST https://icreditdept.com/api/testasp/test_local_generate_otp.php
2025-02-02 22:30:34.148 +03:00 [INF] Received HTTP response headers after 760.1315ms - 200
2025-02-02 22:30:34.150 +03:00 [INF] End processing HTTP request after 763.5183ms - 200
2025-02-02 22:30:34.151 +03:00 [INF] Raw response length: 200
2025-02-02 22:30:34.151 +03:00 [INF] Response content: {"success":true,"errors":[],"result":{"nationalId":"1064448614","otp":324164,"expiryDate":"2025-02-02 22:35:34","successMsg":"Success","errCode":0,"errMsg":null},"type":"N","message":null,"code":null}
2025-02-02 22:30:34.152 +03:00 [INF] Executing ContentResult with HTTP Response ContentType of application/json
2025-02-02 22:30:34.153 +03:00 [INF] Executed action NayifatAPI.Controllers.ProxyController.ForwardRequest (NayifatAPI) in 767.343ms
2025-02-02 22:30:34.154 +03:00 [INF] Executed endpoint 'NayifatAPI.Controllers.ProxyController.ForwardRequest (NayifatAPI)'
2025-02-02 22:30:34.155 +03:00 [INF] Request finished HTTP/1.1 POST http://07ca-46-152-255-232.ngrok-free.app/api/proxy/forward?url=https://icreditdept.com/api/testasp/test_local_generate_otp.php - 200 200 application/json 775.6018ms
2025-02-02 22:30:42.561 +03:00 [INF] Request starting HTTP/1.1 POST http://07ca-46-152-255-232.ngrok-free.app/api/proxy/forward?url=https://icreditdept.com/api/testasp/test_local_verify_otp.php - application/json; charset=utf-8 53
2025-02-02 22:30:42.564 +03:00 [INF] Executing endpoint 'NayifatAPI.Controllers.ProxyController.ForwardRequest (NayifatAPI)'
2025-02-02 22:30:42.565 +03:00 [INF] Route matched with {action = "ForwardRequest", controller = "Proxy"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] ForwardRequest() on controller NayifatAPI.Controllers.ProxyController (NayifatAPI).
2025-02-02 22:30:42.567 +03:00 [INF] Start processing HTTP request POST https://icreditdept.com/api/testasp/test_local_verify_otp.php
2025-02-02 22:30:42.569 +03:00 [INF] Sending HTTP request POST https://icreditdept.com/api/testasp/test_local_verify_otp.php
2025-02-02 22:30:42.977 +03:00 [INF] Received HTTP response headers after 406.5297ms - 200
2025-02-02 22:30:42.978 +03:00 [INF] End processing HTTP request after 410.3317ms - 200
2025-02-02 22:30:42.978 +03:00 [INF] Raw response length: 202
2025-02-02 22:30:42.979 +03:00 [INF] Response content: {"success":true,"errors":[],"result":{"nationalId":"1064448614","otp":"324164","verifiedFlag":true,"successMsg":"Verified successfully.","errCode":0,"errMsg":null},"type":"N","message":null,"code":null}
2025-02-02 22:30:42.980 +03:00 [INF] Executing ContentResult with HTTP Response ContentType of application/json
2025-02-02 22:30:42.980 +03:00 [INF] Executed action NayifatAPI.Controllers.ProxyController.ForwardRequest (NayifatAPI) in 413.2884ms
2025-02-02 22:30:42.981 +03:00 [INF] Executed endpoint 'NayifatAPI.Controllers.ProxyController.ForwardRequest (NayifatAPI)'
2025-02-02 22:30:42.983 +03:00 [INF] Request finished HTTP/1.1 POST http://07ca-46-152-255-232.ngrok-free.app/api/proxy/forward?url=https://icreditdept.com/api/testasp/test_local_verify_otp.php - 200 202 application/json 421.8441ms
2025-02-02 22:30:53.087 +03:00 [INF] Request starting HTTP/1.1 POST http://07ca-46-152-255-232.ngrok-free.app/api/notifications/list - application/json; charset=utf-8 47
2025-02-02 22:30:53.090 +03:00 [INF] Executing endpoint 'NayifatAPI.Controllers.NotificationsController.GetNotifications (NayifatAPI)'
2025-02-02 22:30:53.091 +03:00 [INF] Route matched with {action = "GetNotifications", controller = "Notifications"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetNotifications(NayifatAPI.Controllers.GetNotificationsRequest) on controller NayifatAPI.Controllers.NotificationsController (NayifatAPI).
2025-02-02 22:30:53.095 +03:00 [INF] Executed DbCommand (3ms) [Parameters=[@__providedApiKey_0='?' (Size = 255)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [a].[Key], [a].[CreatedAt], [a].[Description], [a].[ExpiresAt], [a].[IsActive], [a].[LastUsedAt]
FROM [ApiKeys] AS [a]
WHERE [a].[Key] = @__providedApiKey_0 AND [a].[IsActive] = CAST(1 AS bit)
2025-02-02 22:30:53.100 +03:00 [INF] Executed DbCommand (3ms) [Parameters=[@__request_NationalId_0='?' (Size = 450)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [u].[national_id], [u].[last_updated], [u].[notifications]
FROM [user_notifications] AS [u]
WHERE [u].[national_id] = @__request_NationalId_0
2025-02-02 22:30:53.105 +03:00 [INF] Executed DbCommand (3ms) [Parameters=[@__Parse_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [n].[Id], [n].[additional_data], [n].[Body], [n].[body_ar], [n].[body_en], [n].[created_at], [n].[expiry_at], [n].[Route], [n].[target_criteria], [n].[Title], [n].[title_ar], [n].[title_en]
FROM [notification_templates] AS [n]
WHERE [n].[Id] = @__Parse_0
2025-02-02 22:30:53.108 +03:00 [INF] Executed DbCommand (0ms) [Parameters=[@__Parse_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [n].[Id], [n].[additional_data], [n].[Body], [n].[body_ar], [n].[body_en], [n].[created_at], [n].[expiry_at], [n].[Route], [n].[target_criteria], [n].[Title], [n].[title_ar], [n].[title_en]
FROM [notification_templates] AS [n]
WHERE [n].[Id] = @__Parse_0
2025-02-02 22:30:53.120 +03:00 [INF] Executed DbCommand (10ms) [Parameters=[@p0='?' (Size = 4000), @p1='?' (DbType = DateTime2), @p2='?' (Size = 4000), @p3='?' (Size = 4000), @p4='?' (Size = 4000), @p5='?' (Size = 450), @p6='?' (Size = 4000), @p7='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SET IMPLICIT_TRANSACTIONS OFF;
SET NOCOUNT ON;
INSERT INTO [AuthLogs] ([AuthType], [CreatedAt], [DeviceId], [FailureReason], [IpAddress], [NationalId], [Status], [UserAgent])
OUTPUT INSERTED.[Id]
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7);
2025-02-02 22:30:53.123 +03:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType9`2[[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Object, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-02-02 22:30:53.124 +03:00 [INF] Executed action NayifatAPI.Controllers.NotificationsController.GetNotifications (NayifatAPI) in 31.718ms
2025-02-02 22:30:53.125 +03:00 [INF] Executed endpoint 'NayifatAPI.Controllers.NotificationsController.GetNotifications (NayifatAPI)'
2025-02-02 22:30:53.128 +03:00 [INF] Request finished HTTP/1.1 POST http://07ca-46-152-255-232.ngrok-free.app/api/notifications/list - 200 null application/json; charset=utf-8 41.15ms
2025-02-02 22:31:10.727 +03:00 [INF] Request starting HTTP/1.1 POST http://07ca-46-152-255-232.ngrok-free.app/api/notifications/list - application/json; charset=utf-8 47
2025-02-02 22:31:10.729 +03:00 [INF] Executing endpoint 'NayifatAPI.Controllers.NotificationsController.GetNotifications (NayifatAPI)'
2025-02-02 22:31:10.730 +03:00 [INF] Route matched with {action = "GetNotifications", controller = "Notifications"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetNotifications(NayifatAPI.Controllers.GetNotificationsRequest) on controller NayifatAPI.Controllers.NotificationsController (NayifatAPI).
2025-02-02 22:31:10.736 +03:00 [INF] Executed DbCommand (3ms) [Parameters=[@__providedApiKey_0='?' (Size = 255)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [a].[Key], [a].[CreatedAt], [a].[Description], [a].[ExpiresAt], [a].[IsActive], [a].[LastUsedAt]
FROM [ApiKeys] AS [a]
WHERE [a].[Key] = @__providedApiKey_0 AND [a].[IsActive] = CAST(1 AS bit)
2025-02-02 22:31:10.740 +03:00 [INF] Executed DbCommand (2ms) [Parameters=[@__request_NationalId_0='?' (Size = 450)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [u].[national_id], [u].[last_updated], [u].[notifications]
FROM [user_notifications] AS [u]
WHERE [u].[national_id] = @__request_NationalId_0
2025-02-02 22:31:10.745 +03:00 [INF] Executed DbCommand (2ms) [Parameters=[@__Parse_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [n].[Id], [n].[additional_data], [n].[Body], [n].[body_ar], [n].[body_en], [n].[created_at], [n].[expiry_at], [n].[Route], [n].[target_criteria], [n].[Title], [n].[title_ar], [n].[title_en]
FROM [notification_templates] AS [n]
WHERE [n].[Id] = @__Parse_0
2025-02-02 22:31:10.748 +03:00 [INF] Executed DbCommand (0ms) [Parameters=[@__Parse_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [n].[Id], [n].[additional_data], [n].[Body], [n].[body_ar], [n].[body_en], [n].[created_at], [n].[expiry_at], [n].[Route], [n].[target_criteria], [n].[Title], [n].[title_ar], [n].[title_en]
FROM [notification_templates] AS [n]
WHERE [n].[Id] = @__Parse_0
2025-02-02 22:31:10.831 +03:00 [INF] Executed DbCommand (76ms) [Parameters=[@p0='?' (Size = 4000), @p1='?' (DbType = DateTime2), @p2='?' (Size = 4000), @p3='?' (Size = 4000), @p4='?' (Size = 4000), @p5='?' (Size = 450), @p6='?' (Size = 4000), @p7='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SET IMPLICIT_TRANSACTIONS OFF;
SET NOCOUNT ON;
INSERT INTO [AuthLogs] ([AuthType], [CreatedAt], [DeviceId], [FailureReason], [IpAddress], [NationalId], [Status], [UserAgent])
OUTPUT INSERTED.[Id]
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7);
2025-02-02 22:31:10.834 +03:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType9`2[[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Object, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-02-02 22:31:10.836 +03:00 [INF] Executed action NayifatAPI.Controllers.NotificationsController.GetNotifications (NayifatAPI) in 103.9126ms
2025-02-02 22:31:10.837 +03:00 [INF] Executed endpoint 'NayifatAPI.Controllers.NotificationsController.GetNotifications (NayifatAPI)'
2025-02-02 22:31:10.839 +03:00 [INF] Request finished HTTP/1.1 POST http://07ca-46-152-255-232.ngrok-free.app/api/notifications/list - 200 null application/json; charset=utf-8 111.6451ms
2025-02-02 22:31:25.536 +03:00 [INF] Request starting HTTP/1.1 POST http://07ca-46-152-255-232.ngrok-free.app/api/auth/signin - application/json; charset=utf-8 78
2025-02-02 22:31:25.538 +03:00 [INF] Executing endpoint 'NayifatAPI.Controllers.AuthController.SignIn (NayifatAPI)'
2025-02-02 22:31:25.539 +03:00 [INF] Route matched with {action = "SignIn", controller = "Auth"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] SignIn(NayifatAPI.Controllers.SignInRequest) on controller NayifatAPI.Controllers.AuthController (NayifatAPI).
2025-02-02 22:31:25.542 +03:00 [INF] Executed DbCommand (0ms) [Parameters=[@__providedApiKey_0='?' (Size = 255)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [a].[Key], [a].[CreatedAt], [a].[Description], [a].[ExpiresAt], [a].[IsActive], [a].[LastUsedAt]
FROM [ApiKeys] AS [a]
WHERE [a].[Key] = @__providedApiKey_0 AND [a].[IsActive] = CAST(1 AS bit)
2025-02-02 22:31:25.547 +03:00 [INF] Executed DbCommand (4ms) [Parameters=[@__request_NationalId_0='?' (Size = 450)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [c].[NationalId], [c].[AddNo], [c].[BuildingNo], [c].[City], [c].[Consent], [c].[ConsentDate], [c].[DateOfBirth], [c].[Dependents], [c].[District], [c].[Email], [c].[Employer], [c].[FamilyNameAr], [c].[FamilyNameEn], [c].[FirstNameAr], [c].[FirstNameEn], [c].[Iban], [c].[IdExpiryDate], [c].[Los], [c].[Mpin], [c].[MpinEnabled], [c].[NafathStatus], [c].[NafathTimestamp], [c].[Password], [c].[Phone], [c].[RegistrationDate], [c].[SalaryCustomer], [c].[SalaryDakhli], [c].[SecondNameAr], [c].[SecondNameEn], [c].[Sector], [c].[Street], [c].[ThirdNameAr], [c].[ThirdNameEn], [c].[Zipcode]
FROM [Customers] AS [c]
WHERE [c].[NationalId] = @__request_NationalId_0
2025-02-02 22:31:25.550 +03:00 [INF] Starting password verification for NationalId: 1064448614
2025-02-02 22:31:25.769 +03:00 [INF] Password verification result for NationalId 1064448614: Success
2025-02-02 22:31:25.844 +03:00 [INF] Executed DbCommand (74ms) [Parameters=[@p0='?' (Size = 4000), @p1='?' (DbType = DateTime2), @p2='?' (Size = 4000), @p3='?' (Size = 4000), @p4='?' (Size = 4000), @p5='?' (Size = 450), @p6='?' (Size = 4000), @p7='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SET IMPLICIT_TRANSACTIONS OFF;
SET NOCOUNT ON;
INSERT INTO [AuthLogs] ([AuthType], [CreatedAt], [DeviceId], [FailureReason], [IpAddress], [NationalId], [Status], [UserAgent])
OUTPUT INSERTED.[Id]
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7);
2025-02-02 22:31:25.847 +03:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType9`2[[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Object, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-02-02 22:31:25.849 +03:00 [INF] Executed action NayifatAPI.Controllers.AuthController.SignIn (NayifatAPI) in 308.5979ms
2025-02-02 22:31:25.850 +03:00 [INF] Executed endpoint 'NayifatAPI.Controllers.AuthController.SignIn (NayifatAPI)'
2025-02-02 22:31:25.851 +03:00 [INF] Request finished HTTP/1.1 POST http://07ca-46-152-255-232.ngrok-free.app/api/auth/signin - 200 null application/json; charset=utf-8 315.3689ms
2025-02-02 22:31:26.727 +03:00 [INF] Request starting HTTP/1.1 POST http://07ca-46-152-255-232.ngrok-free.app/api/proxy/forward?url=https://icreditdept.com/api/testasp/test_local_generate_otp.php - application/json; charset=utf-8 84
2025-02-02 22:31:26.732 +03:00 [INF] Executing endpoint 'NayifatAPI.Controllers.ProxyController.ForwardRequest (NayifatAPI)'
2025-02-02 22:31:26.732 +03:00 [INF] Route matched with {action = "ForwardRequest", controller = "Proxy"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] ForwardRequest() on controller NayifatAPI.Controllers.ProxyController (NayifatAPI).
2025-02-02 22:31:26.734 +03:00 [INF] Start processing HTTP request POST https://icreditdept.com/api/testasp/test_local_generate_otp.php
2025-02-02 22:31:26.735 +03:00 [INF] Sending HTTP request POST https://icreditdept.com/api/testasp/test_local_generate_otp.php
2025-02-02 22:31:27.147 +03:00 [INF] Received HTTP response headers after 411.501ms - 200
2025-02-02 22:31:27.148 +03:00 [INF] End processing HTTP request after 414.2691ms - 200
2025-02-02 22:31:27.149 +03:00 [INF] Raw response length: 200
2025-02-02 22:31:27.150 +03:00 [INF] Response content: {"success":true,"errors":[],"result":{"nationalId":"1064448614","otp":237368,"expiryDate":"2025-02-02 22:36:27","successMsg":"Success","errCode":0,"errMsg":null},"type":"N","message":null,"code":null}
2025-02-02 22:31:27.151 +03:00 [INF] Executing ContentResult with HTTP Response ContentType of application/json
2025-02-02 22:31:27.152 +03:00 [INF] Executed action NayifatAPI.Controllers.ProxyController.ForwardRequest (NayifatAPI) in 418.1531ms
2025-02-02 22:31:27.153 +03:00 [INF] Executed endpoint 'NayifatAPI.Controllers.ProxyController.ForwardRequest (NayifatAPI)'
2025-02-02 22:31:27.155 +03:00 [INF] Request finished HTTP/1.1 POST http://07ca-46-152-255-232.ngrok-free.app/api/proxy/forward?url=https://icreditdept.com/api/testasp/test_local_generate_otp.php - 200 200 application/json 427.5846ms
2025-02-02 22:31:37.016 +03:00 [INF] Request starting HTTP/1.1 POST http://07ca-46-152-255-232.ngrok-free.app/api/proxy/forward?url=https://icreditdept.com/api/testasp/test_local_verify_otp.php - application/json; charset=utf-8 53
2025-02-02 22:31:38.037 +03:00 [INF] Executing endpoint 'NayifatAPI.Controllers.ProxyController.ForwardRequest (NayifatAPI)'
2025-02-02 22:31:38.482 +03:00 [INF] Route matched with {action = "ForwardRequest", controller = "Proxy"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] ForwardRequest() on controller NayifatAPI.Controllers.ProxyController (NayifatAPI).
2025-02-02 22:31:38.485 +03:00 [INF] Start processing HTTP request POST https://icreditdept.com/api/testasp/test_local_verify_otp.php
2025-02-02 22:31:38.954 +03:00 [INF] Sending HTTP request POST https://icreditdept.com/api/testasp/test_local_verify_otp.php
2025-02-02 22:31:39.410 +03:00 [INF] Received HTTP response headers after 438.8546ms - 200
2025-02-02 22:31:39.414 +03:00 [INF] End processing HTTP request after 929.4767ms - 200
2025-02-02 22:31:39.416 +03:00 [INF] Raw response length: 202
2025-02-02 22:31:39.417 +03:00 [INF] Response content: {"success":true,"errors":[],"result":{"nationalId":"1064448614","otp":"237368","verifiedFlag":true,"successMsg":"Verified successfully.","errCode":0,"errMsg":null},"type":"N","message":null,"code":null}
2025-02-02 22:31:39.418 +03:00 [INF] Executing ContentResult with HTTP Response ContentType of application/json
2025-02-02 22:31:39.419 +03:00 [INF] Executed action NayifatAPI.Controllers.ProxyController.ForwardRequest (NayifatAPI) in 935.0142ms
2025-02-02 22:31:39.520 +03:00 [INF] Executed endpoint 'NayifatAPI.Controllers.ProxyController.ForwardRequest (NayifatAPI)'
2025-02-02 22:31:39.526 +03:00 [INF] Request finished HTTP/1.1 POST http://07ca-46-152-255-232.ngrok-free.app/api/proxy/forward?url=https://icreditdept.com/api/testasp/test_local_verify_otp.php - 200 202 application/json 2509.1323ms
2025-02-02 22:31:47.046 +03:00 [INF] Request starting HTTP/1.1 POST http://07ca-46-152-255-232.ngrok-free.app/api/notifications/list - application/json; charset=utf-8 47
2025-02-02 22:31:47.048 +03:00 [INF] Executing endpoint 'NayifatAPI.Controllers.NotificationsController.GetNotifications (NayifatAPI)'
2025-02-02 22:31:47.050 +03:00 [INF] Route matched with {action = "GetNotifications", controller = "Notifications"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetNotifications(NayifatAPI.Controllers.GetNotificationsRequest) on controller NayifatAPI.Controllers.NotificationsController (NayifatAPI).
2025-02-02 22:31:47.057 +03:00 [INF] Executed DbCommand (3ms) [Parameters=[@__providedApiKey_0='?' (Size = 255)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [a].[Key], [a].[CreatedAt], [a].[Description], [a].[ExpiresAt], [a].[IsActive], [a].[LastUsedAt]
FROM [ApiKeys] AS [a]
WHERE [a].[Key] = @__providedApiKey_0 AND [a].[IsActive] = CAST(1 AS bit)
2025-02-02 22:31:47.063 +03:00 [INF] Executed DbCommand (2ms) [Parameters=[@__request_NationalId_0='?' (Size = 450)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [u].[national_id], [u].[last_updated], [u].[notifications]
FROM [user_notifications] AS [u]
WHERE [u].[national_id] = @__request_NationalId_0
2025-02-02 22:31:47.069 +03:00 [INF] Executed DbCommand (3ms) [Parameters=[@__Parse_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [n].[Id], [n].[additional_data], [n].[Body], [n].[body_ar], [n].[body_en], [n].[created_at], [n].[expiry_at], [n].[Route], [n].[target_criteria], [n].[Title], [n].[title_ar], [n].[title_en]
FROM [notification_templates] AS [n]
WHERE [n].[Id] = @__Parse_0
2025-02-02 22:31:47.073 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@__Parse_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [n].[Id], [n].[additional_data], [n].[Body], [n].[body_ar], [n].[body_en], [n].[created_at], [n].[expiry_at], [n].[Route], [n].[target_criteria], [n].[Title], [n].[title_ar], [n].[title_en]
FROM [notification_templates] AS [n]
WHERE [n].[Id] = @__Parse_0
2025-02-02 22:31:47.155 +03:00 [INF] Executed DbCommand (78ms) [Parameters=[@p0='?' (Size = 4000), @p1='?' (DbType = DateTime2), @p2='?' (Size = 4000), @p3='?' (Size = 4000), @p4='?' (Size = 4000), @p5='?' (Size = 450), @p6='?' (Size = 4000), @p7='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SET IMPLICIT_TRANSACTIONS OFF;
SET NOCOUNT ON;
INSERT INTO [AuthLogs] ([AuthType], [CreatedAt], [DeviceId], [FailureReason], [IpAddress], [NationalId], [Status], [UserAgent])
OUTPUT INSERTED.[Id]
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7);
2025-02-02 22:31:47.160 +03:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType9`2[[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Object, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-02-02 22:31:47.163 +03:00 [INF] Executed action NayifatAPI.Controllers.NotificationsController.GetNotifications (NayifatAPI) in 110.7908ms
2025-02-02 22:31:47.170 +03:00 [INF] Executed endpoint 'NayifatAPI.Controllers.NotificationsController.GetNotifications (NayifatAPI)'
2025-02-02 22:31:47.172 +03:00 [INF] Request finished HTTP/1.1 POST http://07ca-46-152-255-232.ngrok-free.app/api/notifications/list - 200 null application/json; charset=utf-8 125.955ms
2025-02-02 22:32:10.195 +03:00 [INF] Request starting HTTP/1.1 POST http://07ca-46-152-255-232.ngrok-free.app/api/auth/signin - application/json; charset=utf-8 78
2025-02-02 22:32:10.197 +03:00 [INF] Executing endpoint 'NayifatAPI.Controllers.AuthController.SignIn (NayifatAPI)'
2025-02-02 22:32:10.198 +03:00 [INF] Route matched with {action = "SignIn", controller = "Auth"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] SignIn(NayifatAPI.Controllers.SignInRequest) on controller NayifatAPI.Controllers.AuthController (NayifatAPI).
2025-02-02 22:32:10.204 +03:00 [INF] Executed DbCommand (3ms) [Parameters=[@__providedApiKey_0='?' (Size = 255)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [a].[Key], [a].[CreatedAt], [a].[Description], [a].[ExpiresAt], [a].[IsActive], [a].[LastUsedAt]
FROM [ApiKeys] AS [a]
WHERE [a].[Key] = @__providedApiKey_0 AND [a].[IsActive] = CAST(1 AS bit)
2025-02-02 22:32:10.210 +03:00 [INF] Executed DbCommand (4ms) [Parameters=[@__request_NationalId_0='?' (Size = 450)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [c].[NationalId], [c].[AddNo], [c].[BuildingNo], [c].[City], [c].[Consent], [c].[ConsentDate], [c].[DateOfBirth], [c].[Dependents], [c].[District], [c].[Email], [c].[Employer], [c].[FamilyNameAr], [c].[FamilyNameEn], [c].[FirstNameAr], [c].[FirstNameEn], [c].[Iban], [c].[IdExpiryDate], [c].[Los], [c].[Mpin], [c].[MpinEnabled], [c].[NafathStatus], [c].[NafathTimestamp], [c].[Password], [c].[Phone], [c].[RegistrationDate], [c].[SalaryCustomer], [c].[SalaryDakhli], [c].[SecondNameAr], [c].[SecondNameEn], [c].[Sector], [c].[Street], [c].[ThirdNameAr], [c].[ThirdNameEn], [c].[Zipcode]
FROM [Customers] AS [c]
WHERE [c].[NationalId] = @__request_NationalId_0
2025-02-02 22:32:10.213 +03:00 [INF] Starting password verification for NationalId: 1064448614
2025-02-02 22:32:10.400 +03:00 [INF] Password verification result for NationalId 1064448614: Success
2025-02-02 22:32:10.477 +03:00 [INF] Executed DbCommand (76ms) [Parameters=[@p0='?' (Size = 4000), @p1='?' (DbType = DateTime2), @p2='?' (Size = 4000), @p3='?' (Size = 4000), @p4='?' (Size = 4000), @p5='?' (Size = 450), @p6='?' (Size = 4000), @p7='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SET IMPLICIT_TRANSACTIONS OFF;
SET NOCOUNT ON;
INSERT INTO [AuthLogs] ([AuthType], [CreatedAt], [DeviceId], [FailureReason], [IpAddress], [NationalId], [Status], [UserAgent])
OUTPUT INSERTED.[Id]
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7);
2025-02-02 22:32:10.480 +03:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType9`2[[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Object, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-02-02 22:32:10.481 +03:00 [INF] Executed action NayifatAPI.Controllers.AuthController.SignIn (NayifatAPI) in 281.4031ms
2025-02-02 22:32:10.482 +03:00 [INF] Executed endpoint 'NayifatAPI.Controllers.AuthController.SignIn (NayifatAPI)'
2025-02-02 22:32:10.483 +03:00 [INF] Request finished HTTP/1.1 POST http://07ca-46-152-255-232.ngrok-free.app/api/auth/signin - 200 null application/json; charset=utf-8 288.2588ms
2025-02-02 22:32:11.565 +03:00 [INF] Request starting HTTP/1.1 POST http://07ca-46-152-255-232.ngrok-free.app/api/proxy/forward?url=https://icreditdept.com/api/testasp/test_local_generate_otp.php - application/json; charset=utf-8 84
2025-02-02 22:32:11.774 +03:00 [INF] Executing endpoint 'NayifatAPI.Controllers.ProxyController.ForwardRequest (NayifatAPI)'
2025-02-02 22:32:11.775 +03:00 [INF] Route matched with {action = "ForwardRequest", controller = "Proxy"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] ForwardRequest() on controller NayifatAPI.Controllers.ProxyController (NayifatAPI).
2025-02-02 22:32:12.132 +03:00 [INF] Start processing HTTP request POST https://icreditdept.com/api/testasp/test_local_generate_otp.php
2025-02-02 22:32:12.136 +03:00 [INF] Sending HTTP request POST https://icreditdept.com/api/testasp/test_local_generate_otp.php
2025-02-02 22:32:12.898 +03:00 [INF] Received HTTP response headers after 457.2675ms - 200
2025-02-02 22:32:12.906 +03:00 [INF] End processing HTTP request after 773.949ms - 200
2025-02-02 22:32:12.910 +03:00 [INF] Raw response length: 200
2025-02-02 22:32:12.911 +03:00 [INF] Response content: {"success":true,"errors":[],"result":{"nationalId":"1064448614","otp":612538,"expiryDate":"2025-02-02 22:37:13","successMsg":"Success","errCode":0,"errMsg":null},"type":"N","message":null,"code":null}
2025-02-02 22:32:12.915 +03:00 [INF] Executing ContentResult with HTTP Response ContentType of application/json
2025-02-02 22:32:12.917 +03:00 [INF] Executed action NayifatAPI.Controllers.ProxyController.ForwardRequest (NayifatAPI) in 785.7748ms
2025-02-02 22:32:13.120 +03:00 [INF] Executed endpoint 'NayifatAPI.Controllers.ProxyController.ForwardRequest (NayifatAPI)'
2025-02-02 22:32:13.122 +03:00 [INF] Request finished HTTP/1.1 POST http://07ca-46-152-255-232.ngrok-free.app/api/proxy/forward?url=https://icreditdept.com/api/testasp/test_local_generate_otp.php - 200 200 application/json 1556.8093ms
2025-02-02 22:34:31.459 +03:00 [INF] Request starting HTTP/1.1 POST http://07ca-46-152-255-232.ngrok-free.app/api/proxy/forward?url=https://icreditdept.com/api/testasp/test_local_verify_otp.php - application/json; charset=utf-8 53
2025-02-02 22:34:31.793 +03:00 [INF] Executing endpoint 'NayifatAPI.Controllers.ProxyController.ForwardRequest (NayifatAPI)'
2025-02-02 22:34:31.795 +03:00 [INF] Route matched with {action = "ForwardRequest", controller = "Proxy"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] ForwardRequest() on controller NayifatAPI.Controllers.ProxyController (NayifatAPI).
2025-02-02 22:34:32.264 +03:00 [INF] Start processing HTTP request POST https://icreditdept.com/api/testasp/test_local_verify_otp.php
2025-02-02 22:34:32.276 +03:00 [INF] Sending HTTP request POST https://icreditdept.com/api/testasp/test_local_verify_otp.php
2025-02-02 22:34:33.523 +03:00 [INF] Received HTTP response headers after 1240.1118ms - 200
2025-02-02 22:34:33.524 +03:00 [INF] End processing HTTP request after 1260.0388ms - 200
2025-02-02 22:34:33.525 +03:00 [INF] Raw response length: 202
2025-02-02 22:34:33.525 +03:00 [INF] Response content: {"success":true,"errors":[],"result":{"nationalId":"1064448614","otp":"612538","verifiedFlag":true,"successMsg":"Verified successfully.","errCode":0,"errMsg":null},"type":"N","message":null,"code":null}
2025-02-02 22:34:33.527 +03:00 [INF] Executing ContentResult with HTTP Response ContentType of application/json
2025-02-02 22:34:33.528 +03:00 [INF] Executed action NayifatAPI.Controllers.ProxyController.ForwardRequest (NayifatAPI) in 1264.555ms
2025-02-02 22:34:33.529 +03:00 [INF] Executed endpoint 'NayifatAPI.Controllers.ProxyController.ForwardRequest (NayifatAPI)'
2025-02-02 22:34:33.531 +03:00 [INF] Request finished HTTP/1.1 POST http://07ca-46-152-255-232.ngrok-free.app/api/proxy/forward?url=https://icreditdept.com/api/testasp/test_local_verify_otp.php - 200 202 application/json 2072.1121ms
2025-02-02 22:34:41.488 +03:00 [INF] Request starting HTTP/1.1 POST http://07ca-46-152-255-232.ngrok-free.app/api/notifications/list - application/json; charset=utf-8 47
2025-02-02 22:34:41.492 +03:00 [INF] Executing endpoint 'NayifatAPI.Controllers.NotificationsController.GetNotifications (NayifatAPI)'
2025-02-02 22:34:41.495 +03:00 [INF] Route matched with {action = "GetNotifications", controller = "Notifications"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetNotifications(NayifatAPI.Controllers.GetNotificationsRequest) on controller NayifatAPI.Controllers.NotificationsController (NayifatAPI).
2025-02-02 22:34:41.505 +03:00 [INF] Executed DbCommand (3ms) [Parameters=[@__providedApiKey_0='?' (Size = 255)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [a].[Key], [a].[CreatedAt], [a].[Description], [a].[ExpiresAt], [a].[IsActive], [a].[LastUsedAt]
FROM [ApiKeys] AS [a]
WHERE [a].[Key] = @__providedApiKey_0 AND [a].[IsActive] = CAST(1 AS bit)
2025-02-02 22:34:41.511 +03:00 [INF] Executed DbCommand (2ms) [Parameters=[@__request_NationalId_0='?' (Size = 450)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [u].[national_id], [u].[last_updated], [u].[notifications]
FROM [user_notifications] AS [u]
WHERE [u].[national_id] = @__request_NationalId_0
2025-02-02 22:34:41.523 +03:00 [INF] Executed DbCommand (4ms) [Parameters=[@__Parse_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [n].[Id], [n].[additional_data], [n].[Body], [n].[body_ar], [n].[body_en], [n].[created_at], [n].[expiry_at], [n].[Route], [n].[target_criteria], [n].[Title], [n].[title_ar], [n].[title_en]
FROM [notification_templates] AS [n]
WHERE [n].[Id] = @__Parse_0
2025-02-02 22:34:41.629 +03:00 [INF] Executed DbCommand (14ms) [Parameters=[@__Parse_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [n].[Id], [n].[additional_data], [n].[Body], [n].[body_ar], [n].[body_en], [n].[created_at], [n].[expiry_at], [n].[Route], [n].[target_criteria], [n].[Title], [n].[title_ar], [n].[title_en]
FROM [notification_templates] AS [n]
WHERE [n].[Id] = @__Parse_0
2025-02-02 22:34:41.691 +03:00 [INF] Executed DbCommand (48ms) [Parameters=[@p0='?' (Size = 4000), @p1='?' (DbType = DateTime2), @p2='?' (Size = 4000), @p3='?' (Size = 4000), @p4='?' (Size = 4000), @p5='?' (Size = 450), @p6='?' (Size = 4000), @p7='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SET IMPLICIT_TRANSACTIONS OFF;
SET NOCOUNT ON;
INSERT INTO [AuthLogs] ([AuthType], [CreatedAt], [DeviceId], [FailureReason], [IpAddress], [NationalId], [Status], [UserAgent])
OUTPUT INSERTED.[Id]
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7);
2025-02-02 22:34:41.697 +03:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType9`2[[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Object, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-02-02 22:34:41.708 +03:00 [INF] Executed action NayifatAPI.Controllers.NotificationsController.GetNotifications (NayifatAPI) in 210.156ms
2025-02-02 22:34:41.744 +03:00 [INF] Executed endpoint 'NayifatAPI.Controllers.NotificationsController.GetNotifications (NayifatAPI)'
2025-02-02 22:34:41.747 +03:00 [INF] Request finished HTTP/1.1 POST http://07ca-46-152-255-232.ngrok-free.app/api/notifications/list - 200 null application/json; charset=utf-8 258.8735ms
2025-02-02 22:39:00.975 +03:00 [INF] Request starting HTTP/1.1 POST http://07ca-46-152-255-232.ngrok-free.app/api/notifications/list - application/json; charset=utf-8 47
2025-02-02 22:39:00.979 +03:00 [INF] Executing endpoint 'NayifatAPI.Controllers.NotificationsController.GetNotifications (NayifatAPI)'
2025-02-02 22:39:00.979 +03:00 [INF] Route matched with {action = "GetNotifications", controller = "Notifications"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetNotifications(NayifatAPI.Controllers.GetNotificationsRequest) on controller NayifatAPI.Controllers.NotificationsController (NayifatAPI).
2025-02-02 22:39:00.985 +03:00 [INF] Executed DbCommand (3ms) [Parameters=[@__providedApiKey_0='?' (Size = 255)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [a].[Key], [a].[CreatedAt], [a].[Description], [a].[ExpiresAt], [a].[IsActive], [a].[LastUsedAt]
FROM [ApiKeys] AS [a]
WHERE [a].[Key] = @__providedApiKey_0 AND [a].[IsActive] = CAST(1 AS bit)
2025-02-02 22:39:00.989 +03:00 [INF] Executed DbCommand (2ms) [Parameters=[@__request_NationalId_0='?' (Size = 450)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [u].[national_id], [u].[last_updated], [u].[notifications]
FROM [user_notifications] AS [u]
WHERE [u].[national_id] = @__request_NationalId_0
2025-02-02 22:39:00.994 +03:00 [INF] Executed DbCommand (2ms) [Parameters=[@__Parse_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [n].[Id], [n].[additional_data], [n].[Body], [n].[body_ar], [n].[body_en], [n].[created_at], [n].[expiry_at], [n].[Route], [n].[target_criteria], [n].[Title], [n].[title_ar], [n].[title_en]
FROM [notification_templates] AS [n]
WHERE [n].[Id] = @__Parse_0
2025-02-02 22:39:00.997 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@__Parse_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [n].[Id], [n].[additional_data], [n].[Body], [n].[body_ar], [n].[body_en], [n].[created_at], [n].[expiry_at], [n].[Route], [n].[target_criteria], [n].[Title], [n].[title_ar], [n].[title_en]
FROM [notification_templates] AS [n]
WHERE [n].[Id] = @__Parse_0
2025-02-02 22:39:01.076 +03:00 [INF] Executed DbCommand (75ms) [Parameters=[@p0='?' (Size = 4000), @p1='?' (DbType = DateTime2), @p2='?' (Size = 4000), @p3='?' (Size = 4000), @p4='?' (Size = 4000), @p5='?' (Size = 450), @p6='?' (Size = 4000), @p7='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SET IMPLICIT_TRANSACTIONS OFF;
SET NOCOUNT ON;
INSERT INTO [AuthLogs] ([AuthType], [CreatedAt], [DeviceId], [FailureReason], [IpAddress], [NationalId], [Status], [UserAgent])
OUTPUT INSERTED.[Id]
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7);
2025-02-02 22:39:01.079 +03:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType9`2[[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Object, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-02-02 22:39:01.080 +03:00 [INF] Executed action NayifatAPI.Controllers.NotificationsController.GetNotifications (NayifatAPI) in 99.0326ms
2025-02-02 22:39:01.081 +03:00 [INF] Executed endpoint 'NayifatAPI.Controllers.NotificationsController.GetNotifications (NayifatAPI)'
2025-02-02 22:39:01.082 +03:00 [INF] Request finished HTTP/1.1 POST http://07ca-46-152-255-232.ngrok-free.app/api/notifications/list - 200 null application/json; charset=utf-8 107.108ms
2025-02-02 22:39:23.691 +03:00 [INF] Request starting HTTP/1.1 POST http://07ca-46-152-255-232.ngrok-free.app/api/auth/signin - application/json; charset=utf-8 78
2025-02-02 22:39:24.243 +03:00 [INF] Executing endpoint 'NayifatAPI.Controllers.AuthController.SignIn (NayifatAPI)'
2025-02-02 22:39:24.244 +03:00 [INF] Route matched with {action = "SignIn", controller = "Auth"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] SignIn(NayifatAPI.Controllers.SignInRequest) on controller NayifatAPI.Controllers.AuthController (NayifatAPI).
2025-02-02 22:39:24.250 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@__providedApiKey_0='?' (Size = 255)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [a].[Key], [a].[CreatedAt], [a].[Description], [a].[ExpiresAt], [a].[IsActive], [a].[LastUsedAt]
FROM [ApiKeys] AS [a]
WHERE [a].[Key] = @__providedApiKey_0 AND [a].[IsActive] = CAST(1 AS bit)
2025-02-02 22:39:24.468 +03:00 [INF] Executed DbCommand (161ms) [Parameters=[@__request_NationalId_0='?' (Size = 450)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [c].[NationalId], [c].[AddNo], [c].[BuildingNo], [c].[City], [c].[Consent], [c].[ConsentDate], [c].[DateOfBirth], [c].[Dependents], [c].[District], [c].[Email], [c].[Employer], [c].[FamilyNameAr], [c].[FamilyNameEn], [c].[FirstNameAr], [c].[FirstNameEn], [c].[Iban], [c].[IdExpiryDate], [c].[Los], [c].[Mpin], [c].[MpinEnabled], [c].[NafathStatus], [c].[NafathTimestamp], [c].[Password], [c].[Phone], [c].[RegistrationDate], [c].[SalaryCustomer], [c].[SalaryDakhli], [c].[SecondNameAr], [c].[SecondNameEn], [c].[Sector], [c].[Street], [c].[ThirdNameAr], [c].[ThirdNameEn], [c].[Zipcode]
FROM [Customers] AS [c]
WHERE [c].[NationalId] = @__request_NationalId_0
2025-02-02 22:39:24.585 +03:00 [INF] Starting password verification for NationalId: 1064448614
2025-02-02 22:39:25.179 +03:00 [INF] Password verification result for NationalId 1064448614: Success
2025-02-02 22:39:25.343 +03:00 [INF] Executed DbCommand (95ms) [Parameters=[@p0='?' (Size = 4000), @p1='?' (DbType = DateTime2), @p2='?' (Size = 4000), @p3='?' (Size = 4000), @p4='?' (Size = 4000), @p5='?' (Size = 450), @p6='?' (Size = 4000), @p7='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SET IMPLICIT_TRANSACTIONS OFF;
SET NOCOUNT ON;
INSERT INTO [AuthLogs] ([AuthType], [CreatedAt], [DeviceId], [FailureReason], [IpAddress], [NationalId], [Status], [UserAgent])
OUTPUT INSERTED.[Id]
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7);
2025-02-02 22:39:25.436 +03:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType9`2[[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Object, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-02-02 22:39:25.438 +03:00 [INF] Executed action NayifatAPI.Controllers.AuthController.SignIn (NayifatAPI) in 1190.6487ms
2025-02-02 22:39:25.439 +03:00 [INF] Executed endpoint 'NayifatAPI.Controllers.AuthController.SignIn (NayifatAPI)'
2025-02-02 22:39:25.440 +03:00 [INF] Request finished HTTP/1.1 POST http://07ca-46-152-255-232.ngrok-free.app/api/auth/signin - 200 null application/json; charset=utf-8 1749.0155ms
2025-02-02 22:39:27.184 +03:00 [INF] Request starting HTTP/1.1 POST http://07ca-46-152-255-232.ngrok-free.app/api/proxy/forward?url=https://icreditdept.com/api/testasp/test_local_generate_otp.php - application/json; charset=utf-8 84
2025-02-02 22:39:27.189 +03:00 [INF] Executing endpoint 'NayifatAPI.Controllers.ProxyController.ForwardRequest (NayifatAPI)'
2025-02-02 22:39:27.190 +03:00 [INF] Route matched with {action = "ForwardRequest", controller = "Proxy"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] ForwardRequest() on controller NayifatAPI.Controllers.ProxyController (NayifatAPI).
2025-02-02 22:39:27.192 +03:00 [INF] Start processing HTTP request POST https://icreditdept.com/api/testasp/test_local_generate_otp.php
2025-02-02 22:39:27.193 +03:00 [INF] Sending HTTP request POST https://icreditdept.com/api/testasp/test_local_generate_otp.php
2025-02-02 22:39:29.218 +03:00 [INF] Received HTTP response headers after 2023.6479ms - 200
2025-02-02 22:39:29.219 +03:00 [INF] End processing HTTP request after 2027.2962ms - 200
2025-02-02 22:39:29.221 +03:00 [INF] Raw response length: 200
2025-02-02 22:39:29.222 +03:00 [INF] Response content: {"success":true,"errors":[],"result":{"nationalId":"1064448614","otp":702826,"expiryDate":"2025-02-02 22:44:29","successMsg":"Success","errCode":0,"errMsg":null},"type":"N","message":null,"code":null}
2025-02-02 22:39:29.223 +03:00 [INF] Executing ContentResult with HTTP Response ContentType of application/json
2025-02-02 22:39:29.224 +03:00 [INF] Executed action NayifatAPI.Controllers.ProxyController.ForwardRequest (NayifatAPI) in 2033.1607ms
2025-02-02 22:39:29.226 +03:00 [INF] Executed endpoint 'NayifatAPI.Controllers.ProxyController.ForwardRequest (NayifatAPI)'
2025-02-02 22:39:29.230 +03:00 [INF] Request finished HTTP/1.1 POST http://07ca-46-152-255-232.ngrok-free.app/api/proxy/forward?url=https://icreditdept.com/api/testasp/test_local_generate_otp.php - 200 200 application/json 2045.7328ms
2025-02-02 22:39:50.391 +03:00 [INF] Request starting HTTP/1.1 POST http://07ca-46-152-255-232.ngrok-free.app/api/proxy/forward?url=https://icreditdept.com/api/testasp/test_local_generate_otp.php - application/json; charset=utf-8 84
2025-02-02 22:39:50.400 +03:00 [INF] Executing endpoint 'NayifatAPI.Controllers.ProxyController.ForwardRequest (NayifatAPI)'
2025-02-02 22:39:50.402 +03:00 [INF] Route matched with {action = "ForwardRequest", controller = "Proxy"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] ForwardRequest() on controller NayifatAPI.Controllers.ProxyController (NayifatAPI).
2025-02-02 22:39:50.403 +03:00 [INF] Start processing HTTP request POST https://icreditdept.com/api/testasp/test_local_generate_otp.php
2025-02-02 22:39:50.405 +03:00 [INF] Sending HTTP request POST https://icreditdept.com/api/testasp/test_local_generate_otp.php
2025-02-02 22:39:51.064 +03:00 [INF] Received HTTP response headers after 658.0268ms - 200
2025-02-02 22:39:51.067 +03:00 [INF] End processing HTTP request after 663.4329ms - 200
2025-02-02 22:39:51.069 +03:00 [INF] Raw response length: 200
2025-02-02 22:39:51.070 +03:00 [INF] Response content: {"success":true,"errors":[],"result":{"nationalId":"1064448614","otp":750371,"expiryDate":"2025-02-02 22:44:51","successMsg":"Success","errCode":0,"errMsg":null},"type":"N","message":null,"code":null}
2025-02-02 22:39:51.071 +03:00 [INF] Executing ContentResult with HTTP Response ContentType of application/json
2025-02-02 22:39:51.072 +03:00 [INF] Executed action NayifatAPI.Controllers.ProxyController.ForwardRequest (NayifatAPI) in 668.6117ms
2025-02-02 22:39:51.073 +03:00 [INF] Executed endpoint 'NayifatAPI.Controllers.ProxyController.ForwardRequest (NayifatAPI)'
2025-02-02 22:39:51.074 +03:00 [INF] Request finished HTTP/1.1 POST http://07ca-46-152-255-232.ngrok-free.app/api/proxy/forward?url=https://icreditdept.com/api/testasp/test_local_generate_otp.php - 200 200 application/json 683.4622ms
2025-02-02 22:39:59.957 +03:00 [INF] Request starting HTTP/1.1 POST http://07ca-46-152-255-232.ngrok-free.app/api/proxy/forward?url=https://icreditdept.com/api/testasp/test_local_verify_otp.php - application/json; charset=utf-8 53
2025-02-02 22:39:59.962 +03:00 [INF] Executing endpoint 'NayifatAPI.Controllers.ProxyController.ForwardRequest (NayifatAPI)'
2025-02-02 22:39:59.963 +03:00 [INF] Route matched with {action = "ForwardRequest", controller = "Proxy"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] ForwardRequest() on controller NayifatAPI.Controllers.ProxyController (NayifatAPI).
2025-02-02 22:39:59.965 +03:00 [INF] Start processing HTTP request POST https://icreditdept.com/api/testasp/test_local_verify_otp.php
2025-02-02 22:39:59.965 +03:00 [INF] Sending HTTP request POST https://icreditdept.com/api/testasp/test_local_verify_otp.php
2025-02-02 22:40:00.515 +03:00 [INF] Received HTTP response headers after 549.2621ms - 200
2025-02-02 22:40:00.518 +03:00 [INF] End processing HTTP request after 553.6763ms - 200
2025-02-02 22:40:00.520 +03:00 [INF] Raw response length: 202
2025-02-02 22:40:00.521 +03:00 [INF] Response content: {"success":true,"errors":[],"result":{"nationalId":"1064448614","otp":"750371","verifiedFlag":true,"successMsg":"Verified successfully.","errCode":0,"errMsg":null},"type":"N","message":null,"code":null}
2025-02-02 22:40:00.522 +03:00 [INF] Executing ContentResult with HTTP Response ContentType of application/json
2025-02-02 22:40:00.523 +03:00 [INF] Executed action NayifatAPI.Controllers.ProxyController.ForwardRequest (NayifatAPI) in 558.7751ms
2025-02-02 22:40:00.525 +03:00 [INF] Executed endpoint 'NayifatAPI.Controllers.ProxyController.ForwardRequest (NayifatAPI)'
2025-02-02 22:40:00.527 +03:00 [INF] Request finished HTTP/1.1 POST http://07ca-46-152-255-232.ngrok-free.app/api/proxy/forward?url=https://icreditdept.com/api/testasp/test_local_verify_otp.php - 200 202 application/json 569.0752ms
2025-02-02 22:40:13.507 +03:00 [INF] Request starting HTTP/1.1 POST http://07ca-46-152-255-232.ngrok-free.app/api/notifications/list - application/json; charset=utf-8 47
2025-02-02 22:40:13.655 +03:00 [INF] Executing endpoint 'NayifatAPI.Controllers.NotificationsController.GetNotifications (NayifatAPI)'
2025-02-02 22:40:13.657 +03:00 [INF] Route matched with {action = "GetNotifications", controller = "Notifications"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetNotifications(NayifatAPI.Controllers.GetNotificationsRequest) on controller NayifatAPI.Controllers.NotificationsController (NayifatAPI).
2025-02-02 22:40:13.674 +03:00 [INF] Executed DbCommand (6ms) [Parameters=[@__providedApiKey_0='?' (Size = 255)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [a].[Key], [a].[CreatedAt], [a].[Description], [a].[ExpiresAt], [a].[IsActive], [a].[LastUsedAt]
FROM [ApiKeys] AS [a]
WHERE [a].[Key] = @__providedApiKey_0 AND [a].[IsActive] = CAST(1 AS bit)
2025-02-02 22:40:14.085 +03:00 [INF] Executed DbCommand (3ms) [Parameters=[@__request_NationalId_0='?' (Size = 450)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [u].[national_id], [u].[last_updated], [u].[notifications]
FROM [user_notifications] AS [u]
WHERE [u].[national_id] = @__request_NationalId_0
2025-02-02 22:40:14.148 +03:00 [INF] Executed DbCommand (3ms) [Parameters=[@__Parse_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [n].[Id], [n].[additional_data], [n].[Body], [n].[body_ar], [n].[body_en], [n].[created_at], [n].[expiry_at], [n].[Route], [n].[target_criteria], [n].[Title], [n].[title_ar], [n].[title_en]
FROM [notification_templates] AS [n]
WHERE [n].[Id] = @__Parse_0
2025-02-02 22:40:14.152 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@__Parse_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [n].[Id], [n].[additional_data], [n].[Body], [n].[body_ar], [n].[body_en], [n].[created_at], [n].[expiry_at], [n].[Route], [n].[target_criteria], [n].[Title], [n].[title_ar], [n].[title_en]
FROM [notification_templates] AS [n]
WHERE [n].[Id] = @__Parse_0
2025-02-02 22:40:14.235 +03:00 [INF] Executed DbCommand (77ms) [Parameters=[@p0='?' (Size = 4000), @p1='?' (DbType = DateTime2), @p2='?' (Size = 4000), @p3='?' (Size = 4000), @p4='?' (Size = 4000), @p5='?' (Size = 450), @p6='?' (Size = 4000), @p7='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SET IMPLICIT_TRANSACTIONS OFF;
SET NOCOUNT ON;
INSERT INTO [AuthLogs] ([AuthType], [CreatedAt], [DeviceId], [FailureReason], [IpAddress], [NationalId], [Status], [UserAgent])
OUTPUT INSERTED.[Id]
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7);
2025-02-02 22:40:14.237 +03:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType9`2[[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Object, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-02-02 22:40:14.238 +03:00 [INF] Executed action NayifatAPI.Controllers.NotificationsController.GetNotifications (NayifatAPI) in 571.9415ms
2025-02-02 22:40:14.239 +03:00 [INF] Executed endpoint 'NayifatAPI.Controllers.NotificationsController.GetNotifications (NayifatAPI)'
2025-02-02 22:40:14.240 +03:00 [INF] Request finished HTTP/1.1 POST http://07ca-46-152-255-232.ngrok-free.app/api/notifications/list - 200 null application/json; charset=utf-8 733.5504ms
2025-02-02 22:42:20.361 +03:00 [INF] Request starting HTTP/1.1 POST http://07ca-46-152-255-232.ngrok-free.app/api/auth/signin - application/json; charset=utf-8 78
2025-02-02 22:42:20.467 +03:00 [INF] Executing endpoint 'NayifatAPI.Controllers.AuthController.SignIn (NayifatAPI)'
2025-02-02 22:42:20.468 +03:00 [INF] Route matched with {action = "SignIn", controller = "Auth"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] SignIn(NayifatAPI.Controllers.SignInRequest) on controller NayifatAPI.Controllers.AuthController (NayifatAPI).
2025-02-02 22:42:20.476 +03:00 [INF] Executed DbCommand (5ms) [Parameters=[@__providedApiKey_0='?' (Size = 255)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [a].[Key], [a].[CreatedAt], [a].[Description], [a].[ExpiresAt], [a].[IsActive], [a].[LastUsedAt]
FROM [ApiKeys] AS [a]
WHERE [a].[Key] = @__providedApiKey_0 AND [a].[IsActive] = CAST(1 AS bit)
2025-02-02 22:42:20.486 +03:00 [INF] Executed DbCommand (6ms) [Parameters=[@__request_NationalId_0='?' (Size = 450)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [c].[NationalId], [c].[AddNo], [c].[BuildingNo], [c].[City], [c].[Consent], [c].[ConsentDate], [c].[DateOfBirth], [c].[Dependents], [c].[District], [c].[Email], [c].[Employer], [c].[FamilyNameAr], [c].[FamilyNameEn], [c].[FirstNameAr], [c].[FirstNameEn], [c].[Iban], [c].[IdExpiryDate], [c].[Los], [c].[Mpin], [c].[MpinEnabled], [c].[NafathStatus], [c].[NafathTimestamp], [c].[Password], [c].[Phone], [c].[RegistrationDate], [c].[SalaryCustomer], [c].[SalaryDakhli], [c].[SecondNameAr], [c].[SecondNameEn], [c].[Sector], [c].[Street], [c].[ThirdNameAr], [c].[ThirdNameEn], [c].[Zipcode]
FROM [Customers] AS [c]
WHERE [c].[NationalId] = @__request_NationalId_0
2025-02-02 22:42:20.544 +03:00 [INF] Starting password verification for NationalId: 1064448614
2025-02-02 22:42:20.838 +03:00 [INF] Password verification result for NationalId 1064448614: Success
2025-02-02 22:42:20.922 +03:00 [INF] Executed DbCommand (79ms) [Parameters=[@p0='?' (Size = 4000), @p1='?' (DbType = DateTime2), @p2='?' (Size = 4000), @p3='?' (Size = 4000), @p4='?' (Size = 4000), @p5='?' (Size = 450), @p6='?' (Size = 4000), @p7='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SET IMPLICIT_TRANSACTIONS OFF;
SET NOCOUNT ON;
INSERT INTO [AuthLogs] ([AuthType], [CreatedAt], [DeviceId], [FailureReason], [IpAddress], [NationalId], [Status], [UserAgent])
OUTPUT INSERTED.[Id]
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7);
2025-02-02 22:42:21.026 +03:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType9`2[[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Object, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-02-02 22:42:21.175 +03:00 [INF] Executed action NayifatAPI.Controllers.AuthController.SignIn (NayifatAPI) in 705.6474ms
2025-02-02 22:42:21.176 +03:00 [INF] Executed endpoint 'NayifatAPI.Controllers.AuthController.SignIn (NayifatAPI)'
2025-02-02 22:42:21.177 +03:00 [INF] Request finished HTTP/1.1 POST http://07ca-46-152-255-232.ngrok-free.app/api/auth/signin - 200 null application/json; charset=utf-8 816.5313ms
2025-02-02 22:42:22.485 +03:00 [INF] Request starting HTTP/1.1 POST http://07ca-46-152-255-232.ngrok-free.app/api/proxy/forward?url=https://icreditdept.com/api/testasp/test_local_generate_otp.php - application/json; charset=utf-8 84
2025-02-02 22:42:22.491 +03:00 [INF] Executing endpoint 'NayifatAPI.Controllers.ProxyController.ForwardRequest (NayifatAPI)'
2025-02-02 22:42:22.493 +03:00 [INF] Route matched with {action = "ForwardRequest", controller = "Proxy"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] ForwardRequest() on controller NayifatAPI.Controllers.ProxyController (NayifatAPI).
2025-02-02 22:42:22.497 +03:00 [INF] Start processing HTTP request POST https://icreditdept.com/api/testasp/test_local_generate_otp.php
2025-02-02 22:42:22.499 +03:00 [INF] Sending HTTP request POST https://icreditdept.com/api/testasp/test_local_generate_otp.php
2025-02-02 22:42:24.023 +03:00 [INF] Received HTTP response headers after 1523.5254ms - 200
2025-02-02 22:42:24.024 +03:00 [INF] End processing HTTP request after 1527.043ms - 200
2025-02-02 22:42:24.026 +03:00 [INF] Raw response length: 200
2025-02-02 22:42:24.026 +03:00 [INF] Response content: {"success":true,"errors":[],"result":{"nationalId":"1064448614","otp":763665,"expiryDate":"2025-02-02 22:47:24","successMsg":"Success","errCode":0,"errMsg":null},"type":"N","message":null,"code":null}
2025-02-02 22:42:24.027 +03:00 [INF] Executing ContentResult with HTTP Response ContentType of application/json
2025-02-02 22:42:24.028 +03:00 [INF] Executed action NayifatAPI.Controllers.ProxyController.ForwardRequest (NayifatAPI) in 1530.7861ms
2025-02-02 22:42:24.030 +03:00 [INF] Executed endpoint 'NayifatAPI.Controllers.ProxyController.ForwardRequest (NayifatAPI)'
2025-02-02 22:42:24.031 +03:00 [INF] Request finished HTTP/1.1 POST http://07ca-46-152-255-232.ngrok-free.app/api/proxy/forward?url=https://icreditdept.com/api/testasp/test_local_generate_otp.php - 200 200 application/json 1546.4168ms
2025-02-02 22:45:15.696 +03:00 [INF] Request starting HTTP/1.1 POST http://07ca-46-152-255-232.ngrok-free.app/api/notifications/list - application/json; charset=utf-8 47
2025-02-02 22:45:15.699 +03:00 [INF] Executing endpoint 'NayifatAPI.Controllers.NotificationsController.GetNotifications (NayifatAPI)'
2025-02-02 22:45:15.700 +03:00 [INF] Route matched with {action = "GetNotifications", controller = "Notifications"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetNotifications(NayifatAPI.Controllers.GetNotificationsRequest) on controller NayifatAPI.Controllers.NotificationsController (NayifatAPI).
2025-02-02 22:45:15.707 +03:00 [INF] Executed DbCommand (3ms) [Parameters=[@__providedApiKey_0='?' (Size = 255)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [a].[Key], [a].[CreatedAt], [a].[Description], [a].[ExpiresAt], [a].[IsActive], [a].[LastUsedAt]
FROM [ApiKeys] AS [a]
WHERE [a].[Key] = @__providedApiKey_0 AND [a].[IsActive] = CAST(1 AS bit)
2025-02-02 22:45:15.711 +03:00 [INF] Executed DbCommand (2ms) [Parameters=[@__request_NationalId_0='?' (Size = 450)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [u].[national_id], [u].[last_updated], [u].[notifications]
FROM [user_notifications] AS [u]
WHERE [u].[national_id] = @__request_NationalId_0
2025-02-02 22:45:15.718 +03:00 [INF] Executed DbCommand (2ms) [Parameters=[@__Parse_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [n].[Id], [n].[additional_data], [n].[Body], [n].[body_ar], [n].[body_en], [n].[created_at], [n].[expiry_at], [n].[Route], [n].[target_criteria], [n].[Title], [n].[title_ar], [n].[title_en]
FROM [notification_templates] AS [n]
WHERE [n].[Id] = @__Parse_0
2025-02-02 22:45:15.721 +03:00 [INF] Executed DbCommand (0ms) [Parameters=[@__Parse_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [n].[Id], [n].[additional_data], [n].[Body], [n].[body_ar], [n].[body_en], [n].[created_at], [n].[expiry_at], [n].[Route], [n].[target_criteria], [n].[Title], [n].[title_ar], [n].[title_en]
FROM [notification_templates] AS [n]
WHERE [n].[Id] = @__Parse_0
2025-02-02 22:45:15.799 +03:00 [INF] Executed DbCommand (75ms) [Parameters=[@p0='?' (Size = 4000), @p1='?' (DbType = DateTime2), @p2='?' (Size = 4000), @p3='?' (Size = 4000), @p4='?' (Size = 4000), @p5='?' (Size = 450), @p6='?' (Size = 4000), @p7='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SET IMPLICIT_TRANSACTIONS OFF;
SET NOCOUNT ON;
INSERT INTO [AuthLogs] ([AuthType], [CreatedAt], [DeviceId], [FailureReason], [IpAddress], [NationalId], [Status], [UserAgent])
OUTPUT INSERTED.[Id]
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7);
2025-02-02 22:45:15.802 +03:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType9`2[[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Object, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-02-02 22:45:15.803 +03:00 [INF] Executed action NayifatAPI.Controllers.NotificationsController.GetNotifications (NayifatAPI) in 101.6944ms
2025-02-02 22:45:15.805 +03:00 [INF] Executed endpoint 'NayifatAPI.Controllers.NotificationsController.GetNotifications (NayifatAPI)'
2025-02-02 22:45:15.806 +03:00 [INF] Request finished HTTP/1.1 POST http://07ca-46-152-255-232.ngrok-free.app/api/notifications/list - 200 null application/json; charset=utf-8 110.7528ms
2025-02-02 22:50:16.139 +03:00 [INF] Request starting HTTP/1.1 POST http://07ca-46-152-255-232.ngrok-free.app/api/notifications/list - application/json; charset=utf-8 47
2025-02-02 22:50:16.144 +03:00 [INF] Executing endpoint 'NayifatAPI.Controllers.NotificationsController.GetNotifications (NayifatAPI)'
2025-02-02 22:50:16.146 +03:00 [INF] Route matched with {action = "GetNotifications", controller = "Notifications"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetNotifications(NayifatAPI.Controllers.GetNotificationsRequest) on controller NayifatAPI.Controllers.NotificationsController (NayifatAPI).
2025-02-02 22:50:16.171 +03:00 [INF] Executed DbCommand (5ms) [Parameters=[@__providedApiKey_0='?' (Size = 255)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [a].[Key], [a].[CreatedAt], [a].[Description], [a].[ExpiresAt], [a].[IsActive], [a].[LastUsedAt]
FROM [ApiKeys] AS [a]
WHERE [a].[Key] = @__providedApiKey_0 AND [a].[IsActive] = CAST(1 AS bit)
2025-02-02 22:50:16.179 +03:00 [INF] Executed DbCommand (4ms) [Parameters=[@__request_NationalId_0='?' (Size = 450)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [u].[national_id], [u].[last_updated], [u].[notifications]
FROM [user_notifications] AS [u]
WHERE [u].[national_id] = @__request_NationalId_0
2025-02-02 22:50:16.189 +03:00 [INF] Executed DbCommand (4ms) [Parameters=[@__Parse_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [n].[Id], [n].[additional_data], [n].[Body], [n].[body_ar], [n].[body_en], [n].[created_at], [n].[expiry_at], [n].[Route], [n].[target_criteria], [n].[Title], [n].[title_ar], [n].[title_en]
FROM [notification_templates] AS [n]
WHERE [n].[Id] = @__Parse_0
2025-02-02 22:50:16.197 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@__Parse_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [n].[Id], [n].[additional_data], [n].[Body], [n].[body_ar], [n].[body_en], [n].[created_at], [n].[expiry_at], [n].[Route], [n].[target_criteria], [n].[Title], [n].[title_ar], [n].[title_en]
FROM [notification_templates] AS [n]
WHERE [n].[Id] = @__Parse_0
2025-02-02 22:50:16.281 +03:00 [INF] Executed DbCommand (79ms) [Parameters=[@p0='?' (Size = 4000), @p1='?' (DbType = DateTime2), @p2='?' (Size = 4000), @p3='?' (Size = 4000), @p4='?' (Size = 4000), @p5='?' (Size = 450), @p6='?' (Size = 4000), @p7='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SET IMPLICIT_TRANSACTIONS OFF;
SET NOCOUNT ON;
INSERT INTO [AuthLogs] ([AuthType], [CreatedAt], [DeviceId], [FailureReason], [IpAddress], [NationalId], [Status], [UserAgent])
OUTPUT INSERTED.[Id]
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7);
2025-02-02 22:50:16.287 +03:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType9`2[[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Object, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-02-02 22:50:16.290 +03:00 [INF] Executed action NayifatAPI.Controllers.NotificationsController.GetNotifications (NayifatAPI) in 139.3618ms
2025-02-02 22:50:16.295 +03:00 [INF] Executed endpoint 'NayifatAPI.Controllers.NotificationsController.GetNotifications (NayifatAPI)'
2025-02-02 22:50:16.298 +03:00 [INF] Request finished HTTP/1.1 POST http://07ca-46-152-255-232.ngrok-free.app/api/notifications/list - 200 null application/json; charset=utf-8 158.3505ms
2025-02-02 22:52:10.721 +03:00 [INF] Request starting HTTP/1.1 POST http://07ca-46-152-255-232.ngrok-free.app/api/notifications/list - application/json; charset=utf-8 47
2025-02-02 22:52:10.726 +03:00 [INF] Executing endpoint 'NayifatAPI.Controllers.NotificationsController.GetNotifications (NayifatAPI)'
2025-02-02 22:52:10.729 +03:00 [INF] Route matched with {action = "GetNotifications", controller = "Notifications"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetNotifications(NayifatAPI.Controllers.GetNotificationsRequest) on controller NayifatAPI.Controllers.NotificationsController (NayifatAPI).
2025-02-02 22:52:10.741 +03:00 [INF] Executed DbCommand (7ms) [Parameters=[@__providedApiKey_0='?' (Size = 255)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [a].[Key], [a].[CreatedAt], [a].[Description], [a].[ExpiresAt], [a].[IsActive], [a].[LastUsedAt]
FROM [ApiKeys] AS [a]
WHERE [a].[Key] = @__providedApiKey_0 AND [a].[IsActive] = CAST(1 AS bit)
2025-02-02 22:52:10.749 +03:00 [INF] Executed DbCommand (3ms) [Parameters=[@__request_NationalId_0='?' (Size = 450)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [u].[national_id], [u].[last_updated], [u].[notifications]
FROM [user_notifications] AS [u]
WHERE [u].[national_id] = @__request_NationalId_0
2025-02-02 22:52:10.755 +03:00 [INF] Executed DbCommand (3ms) [Parameters=[@__Parse_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [n].[Id], [n].[additional_data], [n].[Body], [n].[body_ar], [n].[body_en], [n].[created_at], [n].[expiry_at], [n].[Route], [n].[target_criteria], [n].[Title], [n].[title_ar], [n].[title_en]
FROM [notification_templates] AS [n]
WHERE [n].[Id] = @__Parse_0
2025-02-02 22:52:10.761 +03:00 [INF] Executed DbCommand (0ms) [Parameters=[@__Parse_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [n].[Id], [n].[additional_data], [n].[Body], [n].[body_ar], [n].[body_en], [n].[created_at], [n].[expiry_at], [n].[Route], [n].[target_criteria], [n].[Title], [n].[title_ar], [n].[title_en]
FROM [notification_templates] AS [n]
WHERE [n].[Id] = @__Parse_0
2025-02-02 22:52:10.775 +03:00 [INF] Executed DbCommand (10ms) [Parameters=[@p0='?' (Size = 4000), @p1='?' (DbType = DateTime2), @p2='?' (Size = 4000), @p3='?' (Size = 4000), @p4='?' (Size = 4000), @p5='?' (Size = 450), @p6='?' (Size = 4000), @p7='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SET IMPLICIT_TRANSACTIONS OFF;
SET NOCOUNT ON;
INSERT INTO [AuthLogs] ([AuthType], [CreatedAt], [DeviceId], [FailureReason], [IpAddress], [NationalId], [Status], [UserAgent])
OUTPUT INSERTED.[Id]
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7);
2025-02-02 22:52:10.780 +03:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType9`2[[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Object, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-02-02 22:52:10.785 +03:00 [INF] Executed action NayifatAPI.Controllers.NotificationsController.GetNotifications (NayifatAPI) in 51.6683ms
2025-02-02 22:52:10.787 +03:00 [INF] Executed endpoint 'NayifatAPI.Controllers.NotificationsController.GetNotifications (NayifatAPI)'
2025-02-02 22:52:10.789 +03:00 [INF] Request finished HTTP/1.1 POST http://07ca-46-152-255-232.ngrok-free.app/api/notifications/list - 200 null application/json; charset=utf-8 67.6767ms
2025-02-02 22:52:23.171 +03:00 [INF] Request starting HTTP/1.1 POST http://07ca-46-152-255-232.ngrok-free.app/api/auth/signin - application/json; charset=utf-8 78
2025-02-02 22:52:23.175 +03:00 [INF] Executing endpoint 'NayifatAPI.Controllers.AuthController.SignIn (NayifatAPI)'
2025-02-02 22:52:23.177 +03:00 [INF] Route matched with {action = "SignIn", controller = "Auth"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] SignIn(NayifatAPI.Controllers.SignInRequest) on controller NayifatAPI.Controllers.AuthController (NayifatAPI).
2025-02-02 22:52:23.180 +03:00 [INF] Executed DbCommand (0ms) [Parameters=[@__providedApiKey_0='?' (Size = 255)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [a].[Key], [a].[CreatedAt], [a].[Description], [a].[ExpiresAt], [a].[IsActive], [a].[LastUsedAt]
FROM [ApiKeys] AS [a]
WHERE [a].[Key] = @__providedApiKey_0 AND [a].[IsActive] = CAST(1 AS bit)
2025-02-02 22:52:23.188 +03:00 [INF] Executed DbCommand (4ms) [Parameters=[@__request_NationalId_0='?' (Size = 450)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [c].[NationalId], [c].[AddNo], [c].[BuildingNo], [c].[City], [c].[Consent], [c].[ConsentDate], [c].[DateOfBirth], [c].[Dependents], [c].[District], [c].[Email], [c].[Employer], [c].[FamilyNameAr], [c].[FamilyNameEn], [c].[FirstNameAr], [c].[FirstNameEn], [c].[Iban], [c].[IdExpiryDate], [c].[Los], [c].[Mpin], [c].[MpinEnabled], [c].[NafathStatus], [c].[NafathTimestamp], [c].[Password], [c].[Phone], [c].[RegistrationDate], [c].[SalaryCustomer], [c].[SalaryDakhli], [c].[SecondNameAr], [c].[SecondNameEn], [c].[Sector], [c].[Street], [c].[ThirdNameAr], [c].[ThirdNameEn], [c].[Zipcode]
FROM [Customers] AS [c]
WHERE [c].[NationalId] = @__request_NationalId_0
2025-02-02 22:52:23.193 +03:00 [INF] Starting password verification for NationalId: 1064448614
2025-02-02 22:52:23.356 +03:00 [INF] Password verification result for NationalId 1064448614: Success
2025-02-02 22:52:23.367 +03:00 [INF] Executed DbCommand (6ms) [Parameters=[@p0='?' (Size = 4000), @p1='?' (DbType = DateTime2), @p2='?' (Size = 4000), @p3='?' (Size = 4000), @p4='?' (Size = 4000), @p5='?' (Size = 450), @p6='?' (Size = 4000), @p7='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SET IMPLICIT_TRANSACTIONS OFF;
SET NOCOUNT ON;
INSERT INTO [AuthLogs] ([AuthType], [CreatedAt], [DeviceId], [FailureReason], [IpAddress], [NationalId], [Status], [UserAgent])
OUTPUT INSERTED.[Id]
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7);
2025-02-02 22:52:23.373 +03:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType9`2[[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Object, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-02-02 22:52:23.376 +03:00 [INF] Executed action NayifatAPI.Controllers.AuthController.SignIn (NayifatAPI) in 196.3168ms
2025-02-02 22:52:23.378 +03:00 [INF] Executed endpoint 'NayifatAPI.Controllers.AuthController.SignIn (NayifatAPI)'
2025-02-02 22:52:23.379 +03:00 [INF] Request finished HTTP/1.1 POST http://07ca-46-152-255-232.ngrok-free.app/api/auth/signin - 200 null application/json; charset=utf-8 208.6933ms
2025-02-02 22:52:24.478 +03:00 [INF] Request starting HTTP/1.1 POST http://07ca-46-152-255-232.ngrok-free.app/api/proxy/forward?url=https://icreditdept.com/api/testasp/test_local_generate_otp.php - application/json; charset=utf-8 84
2025-02-02 22:52:24.484 +03:00 [INF] Executing endpoint 'NayifatAPI.Controllers.ProxyController.ForwardRequest (NayifatAPI)'
2025-02-02 22:52:24.488 +03:00 [INF] Route matched with {action = "ForwardRequest", controller = "Proxy"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] ForwardRequest() on controller NayifatAPI.Controllers.ProxyController (NayifatAPI).
2025-02-02 22:52:24.490 +03:00 [INF] Start processing HTTP request POST https://icreditdept.com/api/testasp/test_local_generate_otp.php
2025-02-02 22:52:24.492 +03:00 [INF] Sending HTTP request POST https://icreditdept.com/api/testasp/test_local_generate_otp.php
2025-02-02 22:52:25.745 +03:00 [INF] Received HTTP response headers after 1250.3786ms - 200
2025-02-02 22:52:25.746 +03:00 [INF] End processing HTTP request after 1256.2208ms - 200
2025-02-02 22:52:25.747 +03:00 [INF] Raw response length: 200
2025-02-02 22:52:25.748 +03:00 [INF] Response content: {"success":true,"errors":[],"result":{"nationalId":"1064448614","otp":551852,"expiryDate":"2025-02-02 22:57:26","successMsg":"Success","errCode":0,"errMsg":null},"type":"N","message":null,"code":null}
2025-02-02 22:52:25.752 +03:00 [INF] Executing ContentResult with HTTP Response ContentType of application/json
2025-02-02 22:52:25.766 +03:00 [INF] Executed action NayifatAPI.Controllers.ProxyController.ForwardRequest (NayifatAPI) in 1276.0883ms
2025-02-02 22:52:25.767 +03:00 [INF] Executed endpoint 'NayifatAPI.Controllers.ProxyController.ForwardRequest (NayifatAPI)'
2025-02-02 22:52:25.769 +03:00 [INF] Request finished HTTP/1.1 POST http://07ca-46-152-255-232.ngrok-free.app/api/proxy/forward?url=https://icreditdept.com/api/testasp/test_local_generate_otp.php - 200 200 application/json 1290.8824ms
2025-02-02 22:52:35.471 +03:00 [INF] Request starting HTTP/1.1 POST http://07ca-46-152-255-232.ngrok-free.app/api/proxy/forward?url=https://icreditdept.com/api/testasp/test_local_verify_otp.php - application/json; charset=utf-8 53
2025-02-02 22:52:35.478 +03:00 [INF] Executing endpoint 'NayifatAPI.Controllers.ProxyController.ForwardRequest (NayifatAPI)'
2025-02-02 22:52:35.479 +03:00 [INF] Route matched with {action = "ForwardRequest", controller = "Proxy"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] ForwardRequest() on controller NayifatAPI.Controllers.ProxyController (NayifatAPI).
2025-02-02 22:52:35.481 +03:00 [INF] Start processing HTTP request POST https://icreditdept.com/api/testasp/test_local_verify_otp.php
2025-02-02 22:52:35.485 +03:00 [INF] Sending HTTP request POST https://icreditdept.com/api/testasp/test_local_verify_otp.php
2025-02-02 22:52:35.946 +03:00 [INF] Received HTTP response headers after 458.6578ms - 200
2025-02-02 22:52:35.953 +03:00 [INF] End processing HTTP request after 466.9387ms - 200
2025-02-02 22:52:35.954 +03:00 [INF] Raw response length: 202
2025-02-02 22:52:35.955 +03:00 [INF] Response content: {"success":true,"errors":[],"result":{"nationalId":"1064448614","otp":"551852","verifiedFlag":true,"successMsg":"Verified successfully.","errCode":0,"errMsg":null},"type":"N","message":null,"code":null}
2025-02-02 22:52:35.956 +03:00 [INF] Executing ContentResult with HTTP Response ContentType of application/json
2025-02-02 22:52:35.957 +03:00 [INF] Executed action NayifatAPI.Controllers.ProxyController.ForwardRequest (NayifatAPI) in 475.7862ms
2025-02-02 22:52:35.960 +03:00 [INF] Executed endpoint 'NayifatAPI.Controllers.ProxyController.ForwardRequest (NayifatAPI)'
2025-02-02 22:52:35.963 +03:00 [INF] Request finished HTTP/1.1 POST http://07ca-46-152-255-232.ngrok-free.app/api/proxy/forward?url=https://icreditdept.com/api/testasp/test_local_verify_otp.php - 200 202 application/json 492.5394ms
2025-02-02 22:52:44.292 +03:00 [INF] Request starting HTTP/1.1 POST http://07ca-46-152-255-232.ngrok-free.app/api/notifications/list - application/json; charset=utf-8 47
2025-02-02 22:52:44.295 +03:00 [INF] Executing endpoint 'NayifatAPI.Controllers.NotificationsController.GetNotifications (NayifatAPI)'
2025-02-02 22:52:44.297 +03:00 [INF] Route matched with {action = "GetNotifications", controller = "Notifications"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetNotifications(NayifatAPI.Controllers.GetNotificationsRequest) on controller NayifatAPI.Controllers.NotificationsController (NayifatAPI).
2025-02-02 22:52:44.304 +03:00 [INF] Executed DbCommand (6ms) [Parameters=[@__providedApiKey_0='?' (Size = 255)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [a].[Key], [a].[CreatedAt], [a].[Description], [a].[ExpiresAt], [a].[IsActive], [a].[LastUsedAt]
FROM [ApiKeys] AS [a]
WHERE [a].[Key] = @__providedApiKey_0 AND [a].[IsActive] = CAST(1 AS bit)
2025-02-02 22:52:44.313 +03:00 [INF] Executed DbCommand (3ms) [Parameters=[@__request_NationalId_0='?' (Size = 450)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [u].[national_id], [u].[last_updated], [u].[notifications]
FROM [user_notifications] AS [u]
WHERE [u].[national_id] = @__request_NationalId_0
2025-02-02 22:52:44.323 +03:00 [INF] Executed DbCommand (4ms) [Parameters=[@__Parse_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [n].[Id], [n].[additional_data], [n].[Body], [n].[body_ar], [n].[body_en], [n].[created_at], [n].[expiry_at], [n].[Route], [n].[target_criteria], [n].[Title], [n].[title_ar], [n].[title_en]
FROM [notification_templates] AS [n]
WHERE [n].[Id] = @__Parse_0
2025-02-02 22:52:44.328 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@__Parse_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [n].[Id], [n].[additional_data], [n].[Body], [n].[body_ar], [n].[body_en], [n].[created_at], [n].[expiry_at], [n].[Route], [n].[target_criteria], [n].[Title], [n].[title_ar], [n].[title_en]
FROM [notification_templates] AS [n]
WHERE [n].[Id] = @__Parse_0
2025-02-02 22:52:44.407 +03:00 [INF] Executed DbCommand (77ms) [Parameters=[@p0='?' (Size = 4000), @p1='?' (DbType = DateTime2), @p2='?' (Size = 4000), @p3='?' (Size = 4000), @p4='?' (Size = 4000), @p5='?' (Size = 450), @p6='?' (Size = 4000), @p7='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SET IMPLICIT_TRANSACTIONS OFF;
SET NOCOUNT ON;
INSERT INTO [AuthLogs] ([AuthType], [CreatedAt], [DeviceId], [FailureReason], [IpAddress], [NationalId], [Status], [UserAgent])
OUTPUT INSERTED.[Id]
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7);
2025-02-02 22:52:44.413 +03:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType9`2[[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Object, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-02-02 22:52:44.415 +03:00 [INF] Executed action NayifatAPI.Controllers.NotificationsController.GetNotifications (NayifatAPI) in 116.8389ms
2025-02-02 22:52:44.418 +03:00 [INF] Executed endpoint 'NayifatAPI.Controllers.NotificationsController.GetNotifications (NayifatAPI)'
2025-02-02 22:52:44.421 +03:00 [INF] Request finished HTTP/1.1 POST http://07ca-46-152-255-232.ngrok-free.app/api/notifications/list - 200 null application/json; charset=utf-8 128.8509ms
2025-02-02 22:52:55.787 +03:00 [INF] Request starting HTTP/1.1 POST http://07ca-46-152-255-232.ngrok-free.app/api/notifications/list - application/json; charset=utf-8 47
2025-02-02 22:52:55.792 +03:00 [INF] Executing endpoint 'NayifatAPI.Controllers.NotificationsController.GetNotifications (NayifatAPI)'
2025-02-02 22:52:55.794 +03:00 [INF] Route matched with {action = "GetNotifications", controller = "Notifications"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetNotifications(NayifatAPI.Controllers.GetNotificationsRequest) on controller NayifatAPI.Controllers.NotificationsController (NayifatAPI).
2025-02-02 22:52:55.800 +03:00 [INF] Executed DbCommand (4ms) [Parameters=[@__providedApiKey_0='?' (Size = 255)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [a].[Key], [a].[CreatedAt], [a].[Description], [a].[ExpiresAt], [a].[IsActive], [a].[LastUsedAt]
FROM [ApiKeys] AS [a]
WHERE [a].[Key] = @__providedApiKey_0 AND [a].[IsActive] = CAST(1 AS bit)
2025-02-02 22:52:55.805 +03:00 [INF] Executed DbCommand (2ms) [Parameters=[@__request_NationalId_0='?' (Size = 450)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [u].[national_id], [u].[last_updated], [u].[notifications]
FROM [user_notifications] AS [u]
WHERE [u].[national_id] = @__request_NationalId_0
2025-02-02 22:52:55.813 +03:00 [INF] Executed DbCommand (3ms) [Parameters=[@__Parse_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [n].[Id], [n].[additional_data], [n].[Body], [n].[body_ar], [n].[body_en], [n].[created_at], [n].[expiry_at], [n].[Route], [n].[target_criteria], [n].[Title], [n].[title_ar], [n].[title_en]
FROM [notification_templates] AS [n]
WHERE [n].[Id] = @__Parse_0
2025-02-02 22:52:55.817 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@__Parse_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [n].[Id], [n].[additional_data], [n].[Body], [n].[body_ar], [n].[body_en], [n].[created_at], [n].[expiry_at], [n].[Route], [n].[target_criteria], [n].[Title], [n].[title_ar], [n].[title_en]
FROM [notification_templates] AS [n]
WHERE [n].[Id] = @__Parse_0
2025-02-02 22:52:55.898 +03:00 [INF] Executed DbCommand (78ms) [Parameters=[@p0='?' (Size = 4000), @p1='?' (DbType = DateTime2), @p2='?' (Size = 4000), @p3='?' (Size = 4000), @p4='?' (Size = 4000), @p5='?' (Size = 450), @p6='?' (Size = 4000), @p7='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SET IMPLICIT_TRANSACTIONS OFF;
SET NOCOUNT ON;
INSERT INTO [AuthLogs] ([AuthType], [CreatedAt], [DeviceId], [FailureReason], [IpAddress], [NationalId], [Status], [UserAgent])
OUTPUT INSERTED.[Id]
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7);
2025-02-02 22:52:55.901 +03:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType9`2[[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Object, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-02-02 22:52:55.902 +03:00 [INF] Executed action NayifatAPI.Controllers.NotificationsController.GetNotifications (NayifatAPI) in 106.8258ms
2025-02-02 22:52:55.907 +03:00 [INF] Executed endpoint 'NayifatAPI.Controllers.NotificationsController.GetNotifications (NayifatAPI)'
2025-02-02 22:52:55.907 +03:00 [INF] Request finished HTTP/1.1 POST http://07ca-46-152-255-232.ngrok-free.app/api/notifications/list - 200 null application/json; charset=utf-8 119.9331ms
2025-02-02 22:53:08.615 +03:00 [INF] Request starting HTTP/1.1 POST http://07ca-46-152-255-232.ngrok-free.app/api/auth/signin - application/json; charset=utf-8 78
2025-02-02 22:53:08.619 +03:00 [INF] Executing endpoint 'NayifatAPI.Controllers.AuthController.SignIn (NayifatAPI)'
2025-02-02 22:53:08.620 +03:00 [INF] Route matched with {action = "SignIn", controller = "Auth"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] SignIn(NayifatAPI.Controllers.SignInRequest) on controller NayifatAPI.Controllers.AuthController (NayifatAPI).
2025-02-02 22:53:08.630 +03:00 [INF] Executed DbCommand (4ms) [Parameters=[@__providedApiKey_0='?' (Size = 255)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [a].[Key], [a].[CreatedAt], [a].[Description], [a].[ExpiresAt], [a].[IsActive], [a].[LastUsedAt]
FROM [ApiKeys] AS [a]
WHERE [a].[Key] = @__providedApiKey_0 AND [a].[IsActive] = CAST(1 AS bit)
2025-02-02 22:53:08.637 +03:00 [INF] Executed DbCommand (4ms) [Parameters=[@__request_NationalId_0='?' (Size = 450)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [c].[NationalId], [c].[AddNo], [c].[BuildingNo], [c].[City], [c].[Consent], [c].[ConsentDate], [c].[DateOfBirth], [c].[Dependents], [c].[District], [c].[Email], [c].[Employer], [c].[FamilyNameAr], [c].[FamilyNameEn], [c].[FirstNameAr], [c].[FirstNameEn], [c].[Iban], [c].[IdExpiryDate], [c].[Los], [c].[Mpin], [c].[MpinEnabled], [c].[NafathStatus], [c].[NafathTimestamp], [c].[Password], [c].[Phone], [c].[RegistrationDate], [c].[SalaryCustomer], [c].[SalaryDakhli], [c].[SecondNameAr], [c].[SecondNameEn], [c].[Sector], [c].[Street], [c].[ThirdNameAr], [c].[ThirdNameEn], [c].[Zipcode]
FROM [Customers] AS [c]
WHERE [c].[NationalId] = @__request_NationalId_0
2025-02-02 22:53:08.641 +03:00 [INF] Starting password verification for NationalId: 1064448614
2025-02-02 22:53:08.837 +03:00 [INF] Password verification result for NationalId 1064448614: Success
2025-02-02 22:53:08.916 +03:00 [INF] Executed DbCommand (77ms) [Parameters=[@p0='?' (Size = 4000), @p1='?' (DbType = DateTime2), @p2='?' (Size = 4000), @p3='?' (Size = 4000), @p4='?' (Size = 4000), @p5='?' (Size = 450), @p6='?' (Size = 4000), @p7='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SET IMPLICIT_TRANSACTIONS OFF;
SET NOCOUNT ON;
INSERT INTO [AuthLogs] ([AuthType], [CreatedAt], [DeviceId], [FailureReason], [IpAddress], [NationalId], [Status], [UserAgent])
OUTPUT INSERTED.[Id]
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7);
2025-02-02 22:53:08.921 +03:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType9`2[[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Object, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-02-02 22:53:08.923 +03:00 [INF] Executed action NayifatAPI.Controllers.AuthController.SignIn (NayifatAPI) in 300.8733ms
2025-02-02 22:53:08.926 +03:00 [INF] Executed endpoint 'NayifatAPI.Controllers.AuthController.SignIn (NayifatAPI)'
2025-02-02 22:53:08.928 +03:00 [INF] Request finished HTTP/1.1 POST http://07ca-46-152-255-232.ngrok-free.app/api/auth/signin - 200 null application/json; charset=utf-8 313.743ms
2025-02-02 22:53:10.615 +03:00 [INF] Request starting HTTP/1.1 POST http://07ca-46-152-255-232.ngrok-free.app/api/proxy/forward?url=https://icreditdept.com/api/testasp/test_local_generate_otp.php - application/json; charset=utf-8 84
2025-02-02 22:53:10.621 +03:00 [INF] Executing endpoint 'NayifatAPI.Controllers.ProxyController.ForwardRequest (NayifatAPI)'
2025-02-02 22:53:10.622 +03:00 [INF] Route matched with {action = "ForwardRequest", controller = "Proxy"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] ForwardRequest() on controller NayifatAPI.Controllers.ProxyController (NayifatAPI).
2025-02-02 22:53:10.624 +03:00 [INF] Start processing HTTP request POST https://icreditdept.com/api/testasp/test_local_generate_otp.php
2025-02-02 22:53:10.626 +03:00 [INF] Sending HTTP request POST https://icreditdept.com/api/testasp/test_local_generate_otp.php
2025-02-02 22:53:11.152 +03:00 [INF] Received HTTP response headers after 524.3813ms - 200
2025-02-02 22:53:11.154 +03:00 [INF] End processing HTTP request after 530.5078ms - 200
2025-02-02 22:53:11.156 +03:00 [INF] Raw response length: 200
2025-02-02 22:53:11.158 +03:00 [INF] Response content: {"success":true,"errors":[],"result":{"nationalId":"1064448614","otp":535297,"expiryDate":"2025-02-02 22:58:11","successMsg":"Success","errCode":0,"errMsg":null},"type":"N","message":null,"code":null}
2025-02-02 22:53:11.162 +03:00 [INF] Executing ContentResult with HTTP Response ContentType of application/json
2025-02-02 22:53:11.164 +03:00 [INF] Executed action NayifatAPI.Controllers.ProxyController.ForwardRequest (NayifatAPI) in 540.3684ms
2025-02-02 22:53:11.170 +03:00 [INF] Executed endpoint 'NayifatAPI.Controllers.ProxyController.ForwardRequest (NayifatAPI)'
2025-02-02 22:53:11.171 +03:00 [INF] Request finished HTTP/1.1 POST http://07ca-46-152-255-232.ngrok-free.app/api/proxy/forward?url=https://icreditdept.com/api/testasp/test_local_generate_otp.php - 200 200 application/json 556.568ms
2025-02-02 22:53:20.249 +03:00 [INF] Request starting HTTP/1.1 POST http://07ca-46-152-255-232.ngrok-free.app/api/proxy/forward?url=https://icreditdept.com/api/testasp/test_local_verify_otp.php - application/json; charset=utf-8 53
2025-02-02 22:53:20.251 +03:00 [INF] Executing endpoint 'NayifatAPI.Controllers.ProxyController.ForwardRequest (NayifatAPI)'
2025-02-02 22:53:20.252 +03:00 [INF] Route matched with {action = "ForwardRequest", controller = "Proxy"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] ForwardRequest() on controller NayifatAPI.Controllers.ProxyController (NayifatAPI).
2025-02-02 22:53:20.253 +03:00 [INF] Start processing HTTP request POST https://icreditdept.com/api/testasp/test_local_verify_otp.php
2025-02-02 22:53:20.254 +03:00 [INF] Sending HTTP request POST https://icreditdept.com/api/testasp/test_local_verify_otp.php
2025-02-02 22:53:20.667 +03:00 [INF] Received HTTP response headers after 412.0654ms - 200
2025-02-02 22:53:20.670 +03:00 [INF] End processing HTTP request after 416.2846ms - 200
2025-02-02 22:53:20.673 +03:00 [INF] Raw response length: 202
2025-02-02 22:53:20.679 +03:00 [INF] Response content: {"success":true,"errors":[],"result":{"nationalId":"1064448614","otp":"535297","verifiedFlag":true,"successMsg":"Verified successfully.","errCode":0,"errMsg":null},"type":"N","message":null,"code":null}
2025-02-02 22:53:20.682 +03:00 [INF] Executing ContentResult with HTTP Response ContentType of application/json
2025-02-02 22:53:20.687 +03:00 [INF] Executed action NayifatAPI.Controllers.ProxyController.ForwardRequest (NayifatAPI) in 433.6247ms
2025-02-02 22:53:20.689 +03:00 [INF] Executed endpoint 'NayifatAPI.Controllers.ProxyController.ForwardRequest (NayifatAPI)'
2025-02-02 22:53:20.691 +03:00 [INF] Request finished HTTP/1.1 POST http://07ca-46-152-255-232.ngrok-free.app/api/proxy/forward?url=https://icreditdept.com/api/testasp/test_local_verify_otp.php - 200 202 application/json 441.4176ms
2025-02-02 22:53:33.573 +03:00 [INF] Request starting HTTP/1.1 POST http://07ca-46-152-255-232.ngrok-free.app/api/notifications/list - application/json; charset=utf-8 47
2025-02-02 22:53:33.577 +03:00 [INF] Executing endpoint 'NayifatAPI.Controllers.NotificationsController.GetNotifications (NayifatAPI)'
2025-02-02 22:53:33.581 +03:00 [INF] Route matched with {action = "GetNotifications", controller = "Notifications"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetNotifications(NayifatAPI.Controllers.GetNotificationsRequest) on controller NayifatAPI.Controllers.NotificationsController (NayifatAPI).
2025-02-02 22:53:33.584 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@__providedApiKey_0='?' (Size = 255)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [a].[Key], [a].[CreatedAt], [a].[Description], [a].[ExpiresAt], [a].[IsActive], [a].[LastUsedAt]
FROM [ApiKeys] AS [a]
WHERE [a].[Key] = @__providedApiKey_0 AND [a].[IsActive] = CAST(1 AS bit)
2025-02-02 22:53:33.595 +03:00 [INF] Executed DbCommand (3ms) [Parameters=[@__request_NationalId_0='?' (Size = 450)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [u].[national_id], [u].[last_updated], [u].[notifications]
FROM [user_notifications] AS [u]
WHERE [u].[national_id] = @__request_NationalId_0
2025-02-02 22:53:33.604 +03:00 [INF] Executed DbCommand (3ms) [Parameters=[@__Parse_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [n].[Id], [n].[additional_data], [n].[Body], [n].[body_ar], [n].[body_en], [n].[created_at], [n].[expiry_at], [n].[Route], [n].[target_criteria], [n].[Title], [n].[title_ar], [n].[title_en]
FROM [notification_templates] AS [n]
WHERE [n].[Id] = @__Parse_0
2025-02-02 22:53:33.609 +03:00 [INF] Executed DbCommand (0ms) [Parameters=[@__Parse_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [n].[Id], [n].[additional_data], [n].[Body], [n].[body_ar], [n].[body_en], [n].[created_at], [n].[expiry_at], [n].[Route], [n].[target_criteria], [n].[Title], [n].[title_ar], [n].[title_en]
FROM [notification_templates] AS [n]
WHERE [n].[Id] = @__Parse_0
2025-02-02 22:53:33.688 +03:00 [INF] Executed DbCommand (74ms) [Parameters=[@p0='?' (Size = 4000), @p1='?' (DbType = DateTime2), @p2='?' (Size = 4000), @p3='?' (Size = 4000), @p4='?' (Size = 4000), @p5='?' (Size = 450), @p6='?' (Size = 4000), @p7='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SET IMPLICIT_TRANSACTIONS OFF;
SET NOCOUNT ON;
INSERT INTO [AuthLogs] ([AuthType], [CreatedAt], [DeviceId], [FailureReason], [IpAddress], [NationalId], [Status], [UserAgent])
OUTPUT INSERTED.[Id]
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7);
2025-02-02 22:53:33.695 +03:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType9`2[[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Object, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-02-02 22:53:33.701 +03:00 [INF] Executed action NayifatAPI.Controllers.NotificationsController.GetNotifications (NayifatAPI) in 118.1706ms
2025-02-02 22:53:33.706 +03:00 [INF] Executed endpoint 'NayifatAPI.Controllers.NotificationsController.GetNotifications (NayifatAPI)'
2025-02-02 22:53:33.708 +03:00 [INF] Request finished HTTP/1.1 POST http://07ca-46-152-255-232.ngrok-free.app/api/notifications/list - 200 null application/json; charset=utf-8 134.3002ms
2025-02-02 22:53:59.369 +03:00 [INF] Request starting HTTP/1.1 POST http://07ca-46-152-255-232.ngrok-free.app/api/auth/signin - application/json; charset=utf-8 78
2025-02-02 22:53:59.372 +03:00 [INF] Executing endpoint 'NayifatAPI.Controllers.AuthController.SignIn (NayifatAPI)'
2025-02-02 22:53:59.374 +03:00 [INF] Route matched with {action = "SignIn", controller = "Auth"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] SignIn(NayifatAPI.Controllers.SignInRequest) on controller NayifatAPI.Controllers.AuthController (NayifatAPI).
2025-02-02 22:53:59.382 +03:00 [INF] Executed DbCommand (4ms) [Parameters=[@__providedApiKey_0='?' (Size = 255)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [a].[Key], [a].[CreatedAt], [a].[Description], [a].[ExpiresAt], [a].[IsActive], [a].[LastUsedAt]
FROM [ApiKeys] AS [a]
WHERE [a].[Key] = @__providedApiKey_0 AND [a].[IsActive] = CAST(1 AS bit)
2025-02-02 22:53:59.391 +03:00 [INF] Executed DbCommand (5ms) [Parameters=[@__request_NationalId_0='?' (Size = 450)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [c].[NationalId], [c].[AddNo], [c].[BuildingNo], [c].[City], [c].[Consent], [c].[ConsentDate], [c].[DateOfBirth], [c].[Dependents], [c].[District], [c].[Email], [c].[Employer], [c].[FamilyNameAr], [c].[FamilyNameEn], [c].[FirstNameAr], [c].[FirstNameEn], [c].[Iban], [c].[IdExpiryDate], [c].[Los], [c].[Mpin], [c].[MpinEnabled], [c].[NafathStatus], [c].[NafathTimestamp], [c].[Password], [c].[Phone], [c].[RegistrationDate], [c].[SalaryCustomer], [c].[SalaryDakhli], [c].[SecondNameAr], [c].[SecondNameEn], [c].[Sector], [c].[Street], [c].[ThirdNameAr], [c].[ThirdNameEn], [c].[Zipcode]
FROM [Customers] AS [c]
WHERE [c].[NationalId] = @__request_NationalId_0
2025-02-02 22:53:59.396 +03:00 [INF] Starting password verification for NationalId: 1064448614
2025-02-02 22:53:59.561 +03:00 [INF] Password verification result for NationalId 1064448614: Success
2025-02-02 22:53:59.573 +03:00 [INF] Executed DbCommand (10ms) [Parameters=[@p0='?' (Size = 4000), @p1='?' (DbType = DateTime2), @p2='?' (Size = 4000), @p3='?' (Size = 4000), @p4='?' (Size = 4000), @p5='?' (Size = 450), @p6='?' (Size = 4000), @p7='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SET IMPLICIT_TRANSACTIONS OFF;
SET NOCOUNT ON;
INSERT INTO [AuthLogs] ([AuthType], [CreatedAt], [DeviceId], [FailureReason], [IpAddress], [NationalId], [Status], [UserAgent])
OUTPUT INSERTED.[Id]
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7);
2025-02-02 22:53:59.578 +03:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType9`2[[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Object, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-02-02 22:53:59.582 +03:00 [INF] Executed action NayifatAPI.Controllers.AuthController.SignIn (NayifatAPI) in 204.8473ms
2025-02-02 22:53:59.584 +03:00 [INF] Executed endpoint 'NayifatAPI.Controllers.AuthController.SignIn (NayifatAPI)'
2025-02-02 22:53:59.585 +03:00 [INF] Request finished HTTP/1.1 POST http://07ca-46-152-255-232.ngrok-free.app/api/auth/signin - 200 null application/json; charset=utf-8 215.9286ms
2025-02-02 22:54:01.034 +03:00 [INF] Request starting HTTP/1.1 POST http://07ca-46-152-255-232.ngrok-free.app/api/proxy/forward?url=https://icreditdept.com/api/testasp/test_local_generate_otp.php - application/json; charset=utf-8 84
2025-02-02 22:54:01.043 +03:00 [INF] Executing endpoint 'NayifatAPI.Controllers.ProxyController.ForwardRequest (NayifatAPI)'
2025-02-02 22:54:01.045 +03:00 [INF] Route matched with {action = "ForwardRequest", controller = "Proxy"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] ForwardRequest() on controller NayifatAPI.Controllers.ProxyController (NayifatAPI).
2025-02-02 22:54:01.048 +03:00 [INF] Start processing HTTP request POST https://icreditdept.com/api/testasp/test_local_generate_otp.php
2025-02-02 22:54:01.049 +03:00 [INF] Sending HTTP request POST https://icreditdept.com/api/testasp/test_local_generate_otp.php
2025-02-02 22:54:01.491 +03:00 [INF] Received HTTP response headers after 441.527ms - 200
2025-02-02 22:54:01.493 +03:00 [INF] End processing HTTP request after 444.9337ms - 200
2025-02-02 22:54:01.494 +03:00 [INF] Raw response length: 200
2025-02-02 22:54:01.494 +03:00 [INF] Response content: {"success":true,"errors":[],"result":{"nationalId":"1064448614","otp":324590,"expiryDate":"2025-02-02 22:59:01","successMsg":"Success","errCode":0,"errMsg":null},"type":"N","message":null,"code":null}
2025-02-02 22:54:01.495 +03:00 [INF] Executing ContentResult with HTTP Response ContentType of application/json
2025-02-02 22:54:01.496 +03:00 [INF] Executed action NayifatAPI.Controllers.ProxyController.ForwardRequest (NayifatAPI) in 448.4256ms
2025-02-02 22:54:01.508 +03:00 [INF] Executed endpoint 'NayifatAPI.Controllers.ProxyController.ForwardRequest (NayifatAPI)'
2025-02-02 22:54:01.510 +03:00 [INF] Request finished HTTP/1.1 POST http://07ca-46-152-255-232.ngrok-free.app/api/proxy/forward?url=https://icreditdept.com/api/testasp/test_local_generate_otp.php - 200 200 application/json 475.4799ms
2025-02-02 22:54:09.914 +03:00 [INF] Request starting HTTP/1.1 POST http://07ca-46-152-255-232.ngrok-free.app/api/proxy/forward?url=https://icreditdept.com/api/testasp/test_local_verify_otp.php - application/json; charset=utf-8 53
2025-02-02 22:54:09.919 +03:00 [INF] Executing endpoint 'NayifatAPI.Controllers.ProxyController.ForwardRequest (NayifatAPI)'
2025-02-02 22:54:09.920 +03:00 [INF] Route matched with {action = "ForwardRequest", controller = "Proxy"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] ForwardRequest() on controller NayifatAPI.Controllers.ProxyController (NayifatAPI).
2025-02-02 22:54:09.923 +03:00 [INF] Start processing HTTP request POST https://icreditdept.com/api/testasp/test_local_verify_otp.php
2025-02-02 22:54:09.923 +03:00 [INF] Sending HTTP request POST https://icreditdept.com/api/testasp/test_local_verify_otp.php
2025-02-02 22:54:10.349 +03:00 [INF] Received HTTP response headers after 424.253ms - 200
2025-02-02 22:54:10.352 +03:00 [INF] End processing HTTP request after 429.6542ms - 200
2025-02-02 22:54:10.354 +03:00 [INF] Raw response length: 202
2025-02-02 22:54:10.354 +03:00 [INF] Response content: {"success":true,"errors":[],"result":{"nationalId":"1064448614","otp":"324590","verifiedFlag":true,"successMsg":"Verified successfully.","errCode":0,"errMsg":null},"type":"N","message":null,"code":null}
2025-02-02 22:54:10.356 +03:00 [INF] Executing ContentResult with HTTP Response ContentType of application/json
2025-02-02 22:54:10.357 +03:00 [INF] Executed action NayifatAPI.Controllers.ProxyController.ForwardRequest (NayifatAPI) in 434.3833ms
2025-02-02 22:54:10.361 +03:00 [INF] Executed endpoint 'NayifatAPI.Controllers.ProxyController.ForwardRequest (NayifatAPI)'
2025-02-02 22:54:10.364 +03:00 [INF] Request finished HTTP/1.1 POST http://07ca-46-152-255-232.ngrok-free.app/api/proxy/forward?url=https://icreditdept.com/api/testasp/test_local_verify_otp.php - 200 202 application/json 450.2391ms
2025-02-02 22:54:19.812 +03:00 [INF] Request starting HTTP/1.1 POST http://07ca-46-152-255-232.ngrok-free.app/api/notifications/list - application/json; charset=utf-8 47
2025-02-02 22:54:19.818 +03:00 [INF] Executing endpoint 'NayifatAPI.Controllers.NotificationsController.GetNotifications (NayifatAPI)'
2025-02-02 22:54:19.819 +03:00 [INF] Route matched with {action = "GetNotifications", controller = "Notifications"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetNotifications(NayifatAPI.Controllers.GetNotificationsRequest) on controller NayifatAPI.Controllers.NotificationsController (NayifatAPI).
2025-02-02 22:54:19.827 +03:00 [INF] Executed DbCommand (5ms) [Parameters=[@__providedApiKey_0='?' (Size = 255)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [a].[Key], [a].[CreatedAt], [a].[Description], [a].[ExpiresAt], [a].[IsActive], [a].[LastUsedAt]
FROM [ApiKeys] AS [a]
WHERE [a].[Key] = @__providedApiKey_0 AND [a].[IsActive] = CAST(1 AS bit)
2025-02-02 22:54:19.835 +03:00 [INF] Executed DbCommand (3ms) [Parameters=[@__request_NationalId_0='?' (Size = 450)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [u].[national_id], [u].[last_updated], [u].[notifications]
FROM [user_notifications] AS [u]
WHERE [u].[national_id] = @__request_NationalId_0
2025-02-02 22:54:19.843 +03:00 [INF] Executed DbCommand (4ms) [Parameters=[@__Parse_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [n].[Id], [n].[additional_data], [n].[Body], [n].[body_ar], [n].[body_en], [n].[created_at], [n].[expiry_at], [n].[Route], [n].[target_criteria], [n].[Title], [n].[title_ar], [n].[title_en]
FROM [notification_templates] AS [n]
WHERE [n].[Id] = @__Parse_0
2025-02-02 22:54:19.850 +03:00 [INF] Executed DbCommand (2ms) [Parameters=[@__Parse_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [n].[Id], [n].[additional_data], [n].[Body], [n].[body_ar], [n].[body_en], [n].[created_at], [n].[expiry_at], [n].[Route], [n].[target_criteria], [n].[Title], [n].[title_ar], [n].[title_en]
FROM [notification_templates] AS [n]
WHERE [n].[Id] = @__Parse_0
2025-02-02 22:54:19.935 +03:00 [INF] Executed DbCommand (80ms) [Parameters=[@p0='?' (Size = 4000), @p1='?' (DbType = DateTime2), @p2='?' (Size = 4000), @p3='?' (Size = 4000), @p4='?' (Size = 4000), @p5='?' (Size = 450), @p6='?' (Size = 4000), @p7='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SET IMPLICIT_TRANSACTIONS OFF;
SET NOCOUNT ON;
INSERT INTO [AuthLogs] ([AuthType], [CreatedAt], [DeviceId], [FailureReason], [IpAddress], [NationalId], [Status], [UserAgent])
OUTPUT INSERTED.[Id]
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7);
2025-02-02 22:54:19.943 +03:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType9`2[[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Object, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-02-02 22:54:19.945 +03:00 [INF] Executed action NayifatAPI.Controllers.NotificationsController.GetNotifications (NayifatAPI) in 123.8515ms
2025-02-02 22:54:19.947 +03:00 [INF] Executed endpoint 'NayifatAPI.Controllers.NotificationsController.GetNotifications (NayifatAPI)'
2025-02-02 22:54:19.949 +03:00 [INF] Request finished HTTP/1.1 POST http://07ca-46-152-255-232.ngrok-free.app/api/notifications/list - 200 null application/json; charset=utf-8 136.4385ms
2025-02-02 22:57:59.612 +03:00 [INF] Request starting HTTP/1.1 POST http://07ca-46-152-255-232.ngrok-free.app/api/notifications/list - application/json; charset=utf-8 47
2025-02-02 22:57:59.620 +03:00 [INF] Executing endpoint 'NayifatAPI.Controllers.NotificationsController.GetNotifications (NayifatAPI)'
2025-02-02 22:57:59.625 +03:00 [INF] Route matched with {action = "GetNotifications", controller = "Notifications"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetNotifications(NayifatAPI.Controllers.GetNotificationsRequest) on controller NayifatAPI.Controllers.NotificationsController (NayifatAPI).
2025-02-02 22:57:59.643 +03:00 [INF] Executed DbCommand (8ms) [Parameters=[@__providedApiKey_0='?' (Size = 255)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [a].[Key], [a].[CreatedAt], [a].[Description], [a].[ExpiresAt], [a].[IsActive], [a].[LastUsedAt]
FROM [ApiKeys] AS [a]
WHERE [a].[Key] = @__providedApiKey_0 AND [a].[IsActive] = CAST(1 AS bit)
2025-02-02 22:57:59.713 +03:00 [INF] Executed DbCommand (6ms) [Parameters=[@__request_NationalId_0='?' (Size = 450)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [u].[national_id], [u].[last_updated], [u].[notifications]
FROM [user_notifications] AS [u]
WHERE [u].[national_id] = @__request_NationalId_0
2025-02-02 22:57:59.755 +03:00 [INF] Executed DbCommand (6ms) [Parameters=[@__Parse_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [n].[Id], [n].[additional_data], [n].[Body], [n].[body_ar], [n].[body_en], [n].[created_at], [n].[expiry_at], [n].[Route], [n].[target_criteria], [n].[Title], [n].[title_ar], [n].[title_en]
FROM [notification_templates] AS [n]
WHERE [n].[Id] = @__Parse_0
2025-02-02 22:57:59.772 +03:00 [INF] Executed DbCommand (2ms) [Parameters=[@__Parse_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [n].[Id], [n].[additional_data], [n].[Body], [n].[body_ar], [n].[body_en], [n].[created_at], [n].[expiry_at], [n].[Route], [n].[target_criteria], [n].[Title], [n].[title_ar], [n].[title_en]
FROM [notification_templates] AS [n]
WHERE [n].[Id] = @__Parse_0
2025-02-02 22:57:59.860 +03:00 [INF] Executed DbCommand (81ms) [Parameters=[@p0='?' (Size = 4000), @p1='?' (DbType = DateTime2), @p2='?' (Size = 4000), @p3='?' (Size = 4000), @p4='?' (Size = 4000), @p5='?' (Size = 450), @p6='?' (Size = 4000), @p7='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SET IMPLICIT_TRANSACTIONS OFF;
SET NOCOUNT ON;
INSERT INTO [AuthLogs] ([AuthType], [CreatedAt], [DeviceId], [FailureReason], [IpAddress], [NationalId], [Status], [UserAgent])
OUTPUT INSERTED.[Id]
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7);
2025-02-02 22:57:59.874 +03:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType9`2[[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Object, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-02-02 22:57:59.877 +03:00 [INF] Executed action NayifatAPI.Controllers.NotificationsController.GetNotifications (NayifatAPI) in 244.5652ms
2025-02-02 22:57:59.881 +03:00 [INF] Executed endpoint 'NayifatAPI.Controllers.NotificationsController.GetNotifications (NayifatAPI)'
2025-02-02 22:57:59.884 +03:00 [INF] Request finished HTTP/1.1 POST http://07ca-46-152-255-232.ngrok-free.app/api/notifications/list - 200 null application/json; charset=utf-8 272.0737ms
2025-02-02 22:59:21.402 +03:00 [INF] Request starting HTTP/1.1 POST http://07ca-46-152-255-232.ngrok-free.app/api/notifications/list - application/json; charset=utf-8 47
2025-02-02 22:59:21.425 +03:00 [INF] Executing endpoint 'NayifatAPI.Controllers.NotificationsController.GetNotifications (NayifatAPI)'
2025-02-02 22:59:21.669 +03:00 [INF] Route matched with {action = "GetNotifications", controller = "Notifications"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetNotifications(NayifatAPI.Controllers.GetNotificationsRequest) on controller NayifatAPI.Controllers.NotificationsController (NayifatAPI).
2025-02-02 22:59:21.758 +03:00 [INF] Executed DbCommand (11ms) [Parameters=[@__providedApiKey_0='?' (Size = 255)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [a].[Key], [a].[CreatedAt], [a].[Description], [a].[ExpiresAt], [a].[IsActive], [a].[LastUsedAt]
FROM [ApiKeys] AS [a]
WHERE [a].[Key] = @__providedApiKey_0 AND [a].[IsActive] = CAST(1 AS bit)
2025-02-02 22:59:21.772 +03:00 [INF] Executed DbCommand (4ms) [Parameters=[@__request_NationalId_0='?' (Size = 450)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [u].[national_id], [u].[last_updated], [u].[notifications]
FROM [user_notifications] AS [u]
WHERE [u].[national_id] = @__request_NationalId_0
2025-02-02 22:59:21.782 +03:00 [INF] Executed DbCommand (4ms) [Parameters=[@__Parse_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [n].[Id], [n].[additional_data], [n].[Body], [n].[body_ar], [n].[body_en], [n].[created_at], [n].[expiry_at], [n].[Route], [n].[target_criteria], [n].[Title], [n].[title_ar], [n].[title_en]
FROM [notification_templates] AS [n]
WHERE [n].[Id] = @__Parse_0
2025-02-02 22:59:21.788 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@__Parse_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [n].[Id], [n].[additional_data], [n].[Body], [n].[body_ar], [n].[body_en], [n].[created_at], [n].[expiry_at], [n].[Route], [n].[target_criteria], [n].[Title], [n].[title_ar], [n].[title_en]
FROM [notification_templates] AS [n]
WHERE [n].[Id] = @__Parse_0
2025-02-02 22:59:21.820 +03:00 [INF] Executed DbCommand (16ms) [Parameters=[@p0='?' (Size = 4000), @p1='?' (DbType = DateTime2), @p2='?' (Size = 4000), @p3='?' (Size = 4000), @p4='?' (Size = 4000), @p5='?' (Size = 450), @p6='?' (Size = 4000), @p7='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SET IMPLICIT_TRANSACTIONS OFF;
SET NOCOUNT ON;
INSERT INTO [AuthLogs] ([AuthType], [CreatedAt], [DeviceId], [FailureReason], [IpAddress], [NationalId], [Status], [UserAgent])
OUTPUT INSERTED.[Id]
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7);
2025-02-02 22:59:21.849 +03:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType9`2[[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Object, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-02-02 22:59:21.856 +03:00 [INF] Executed action NayifatAPI.Controllers.NotificationsController.GetNotifications (NayifatAPI) in 112.3214ms
2025-02-02 22:59:21.960 +03:00 [INF] Executed endpoint 'NayifatAPI.Controllers.NotificationsController.GetNotifications (NayifatAPI)'
2025-02-02 22:59:22.046 +03:00 [INF] Request finished HTTP/1.1 POST http://07ca-46-152-255-232.ngrok-free.app/api/notifications/list - 200 null application/json; charset=utf-8 643.4918ms
2025-02-02 23:01:54.002 +03:00 [INF] Request starting HTTP/1.1 POST http://07ca-46-152-255-232.ngrok-free.app/api/notifications/list - application/json; charset=utf-8 47
2025-02-02 23:01:54.007 +03:00 [INF] Executing endpoint 'NayifatAPI.Controllers.NotificationsController.GetNotifications (NayifatAPI)'
2025-02-02 23:01:54.010 +03:00 [INF] Route matched with {action = "GetNotifications", controller = "Notifications"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetNotifications(NayifatAPI.Controllers.GetNotificationsRequest) on controller NayifatAPI.Controllers.NotificationsController (NayifatAPI).
2025-02-02 23:01:54.100 +03:00 [INF] Executed DbCommand (82ms) [Parameters=[@__providedApiKey_0='?' (Size = 255)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [a].[Key], [a].[CreatedAt], [a].[Description], [a].[ExpiresAt], [a].[IsActive], [a].[LastUsedAt]
FROM [ApiKeys] AS [a]
WHERE [a].[Key] = @__providedApiKey_0 AND [a].[IsActive] = CAST(1 AS bit)
2025-02-02 23:01:54.115 +03:00 [INF] Executed DbCommand (6ms) [Parameters=[@__request_NationalId_0='?' (Size = 450)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [u].[national_id], [u].[last_updated], [u].[notifications]
FROM [user_notifications] AS [u]
WHERE [u].[national_id] = @__request_NationalId_0
2025-02-02 23:01:54.129 +03:00 [INF] Executed DbCommand (4ms) [Parameters=[@__Parse_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [n].[Id], [n].[additional_data], [n].[Body], [n].[body_ar], [n].[body_en], [n].[created_at], [n].[expiry_at], [n].[Route], [n].[target_criteria], [n].[Title], [n].[title_ar], [n].[title_en]
FROM [notification_templates] AS [n]
WHERE [n].[Id] = @__Parse_0
2025-02-02 23:01:54.143 +03:00 [INF] Executed DbCommand (5ms) [Parameters=[@__Parse_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [n].[Id], [n].[additional_data], [n].[Body], [n].[body_ar], [n].[body_en], [n].[created_at], [n].[expiry_at], [n].[Route], [n].[target_criteria], [n].[Title], [n].[title_ar], [n].[title_en]
FROM [notification_templates] AS [n]
WHERE [n].[Id] = @__Parse_0
2025-02-02 23:01:54.433 +03:00 [INF] Executed DbCommand (281ms) [Parameters=[@p0='?' (Size = 4000), @p1='?' (DbType = DateTime2), @p2='?' (Size = 4000), @p3='?' (Size = 4000), @p4='?' (Size = 4000), @p5='?' (Size = 450), @p6='?' (Size = 4000), @p7='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SET IMPLICIT_TRANSACTIONS OFF;
SET NOCOUNT ON;
INSERT INTO [AuthLogs] ([AuthType], [CreatedAt], [DeviceId], [FailureReason], [IpAddress], [NationalId], [Status], [UserAgent])
OUTPUT INSERTED.[Id]
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7);
2025-02-02 23:01:54.439 +03:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType9`2[[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Object, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-02-02 23:01:54.442 +03:00 [INF] Executed action NayifatAPI.Controllers.NotificationsController.GetNotifications (NayifatAPI) in 426.6598ms
2025-02-02 23:01:54.446 +03:00 [INF] Executed endpoint 'NayifatAPI.Controllers.NotificationsController.GetNotifications (NayifatAPI)'
2025-02-02 23:01:54.449 +03:00 [INF] Request finished HTTP/1.1 POST http://07ca-46-152-255-232.ngrok-free.app/api/notifications/list - 200 null application/json; charset=utf-8 446.4143ms
2025-02-02 23:04:01.547 +03:00 [INF] Request starting HTTP/1.1 POST http://07ca-46-152-255-232.ngrok-free.app/api/auth/signin - application/json; charset=utf-8 78
2025-02-02 23:04:01.550 +03:00 [INF] Executing endpoint 'NayifatAPI.Controllers.AuthController.SignIn (NayifatAPI)'
2025-02-02 23:04:01.552 +03:00 [INF] Route matched with {action = "SignIn", controller = "Auth"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] SignIn(NayifatAPI.Controllers.SignInRequest) on controller NayifatAPI.Controllers.AuthController (NayifatAPI).
2025-02-02 23:04:01.562 +03:00 [INF] Executed DbCommand (5ms) [Parameters=[@__providedApiKey_0='?' (Size = 255)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [a].[Key], [a].[CreatedAt], [a].[Description], [a].[ExpiresAt], [a].[IsActive], [a].[LastUsedAt]
FROM [ApiKeys] AS [a]
WHERE [a].[Key] = @__providedApiKey_0 AND [a].[IsActive] = CAST(1 AS bit)
2025-02-02 23:04:01.569 +03:00 [INF] Executed DbCommand (3ms) [Parameters=[@__request_NationalId_0='?' (Size = 450)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [c].[NationalId], [c].[AddNo], [c].[BuildingNo], [c].[City], [c].[Consent], [c].[ConsentDate], [c].[DateOfBirth], [c].[Dependents], [c].[District], [c].[Email], [c].[Employer], [c].[FamilyNameAr], [c].[FamilyNameEn], [c].[FirstNameAr], [c].[FirstNameEn], [c].[Iban], [c].[IdExpiryDate], [c].[Los], [c].[Mpin], [c].[MpinEnabled], [c].[NafathStatus], [c].[NafathTimestamp], [c].[Password], [c].[Phone], [c].[RegistrationDate], [c].[SalaryCustomer], [c].[SalaryDakhli], [c].[SecondNameAr], [c].[SecondNameEn], [c].[Sector], [c].[Street], [c].[ThirdNameAr], [c].[ThirdNameEn], [c].[Zipcode]
FROM [Customers] AS [c]
WHERE [c].[NationalId] = @__request_NationalId_0
2025-02-02 23:04:01.574 +03:00 [INF] Starting password verification for NationalId: 1064448614
2025-02-02 23:04:01.836 +03:00 [INF] Password verification result for NationalId 1064448614: Success
2025-02-02 23:04:01.852 +03:00 [INF] Executed DbCommand (10ms) [Parameters=[@p0='?' (Size = 4000), @p1='?' (DbType = DateTime2), @p2='?' (Size = 4000), @p3='?' (Size = 4000), @p4='?' (Size = 4000), @p5='?' (Size = 450), @p6='?' (Size = 4000), @p7='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SET IMPLICIT_TRANSACTIONS OFF;
SET NOCOUNT ON;
INSERT INTO [AuthLogs] ([AuthType], [CreatedAt], [DeviceId], [FailureReason], [IpAddress], [NationalId], [Status], [UserAgent])
OUTPUT INSERTED.[Id]
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7);
2025-02-02 23:04:01.856 +03:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType9`2[[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Object, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-02-02 23:04:01.859 +03:00 [INF] Executed action NayifatAPI.Controllers.AuthController.SignIn (NayifatAPI) in 303.0862ms
2025-02-02 23:04:01.860 +03:00 [INF] Executed endpoint 'NayifatAPI.Controllers.AuthController.SignIn (NayifatAPI)'
2025-02-02 23:04:01.862 +03:00 [INF] Request finished HTTP/1.1 POST http://07ca-46-152-255-232.ngrok-free.app/api/auth/signin - 200 null application/json; charset=utf-8 314.402ms
2025-02-02 23:04:02.618 +03:00 [INF] Request starting HTTP/1.1 POST http://07ca-46-152-255-232.ngrok-free.app/api/proxy/forward?url=https://icreditdept.com/api/testasp/test_local_generate_otp.php - application/json; charset=utf-8 84
2025-02-02 23:04:02.625 +03:00 [INF] Executing endpoint 'NayifatAPI.Controllers.ProxyController.ForwardRequest (NayifatAPI)'
2025-02-02 23:04:02.627 +03:00 [INF] Route matched with {action = "ForwardRequest", controller = "Proxy"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] ForwardRequest() on controller NayifatAPI.Controllers.ProxyController (NayifatAPI).
2025-02-02 23:04:02.628 +03:00 [INF] Start processing HTTP request POST https://icreditdept.com/api/testasp/test_local_generate_otp.php
2025-02-02 23:04:02.629 +03:00 [INF] Sending HTTP request POST https://icreditdept.com/api/testasp/test_local_generate_otp.php
2025-02-02 23:04:07.635 +03:00 [INF] Received HTTP response headers after 5004.6826ms - 200
2025-02-02 23:04:07.637 +03:00 [INF] End processing HTTP request after 5008.6403ms - 200
2025-02-02 23:04:07.640 +03:00 [INF] Raw response length: 200
2025-02-02 23:04:07.643 +03:00 [INF] Response content: {"success":true,"errors":[],"result":{"nationalId":"1064448614","otp":566077,"expiryDate":"2025-02-02 23:09:08","successMsg":"Success","errCode":0,"errMsg":null},"type":"N","message":null,"code":null}
2025-02-02 23:04:07.645 +03:00 [INF] Executing ContentResult with HTTP Response ContentType of application/json
2025-02-02 23:04:07.649 +03:00 [INF] Executed action NayifatAPI.Controllers.ProxyController.ForwardRequest (NayifatAPI) in 5021.1623ms
2025-02-02 23:04:07.651 +03:00 [INF] Executed endpoint 'NayifatAPI.Controllers.ProxyController.ForwardRequest (NayifatAPI)'
2025-02-02 23:04:07.653 +03:00 [INF] Request finished HTTP/1.1 POST http://07ca-46-152-255-232.ngrok-free.app/api/proxy/forward?url=https://icreditdept.com/api/testasp/test_local_generate_otp.php - 200 200 application/json 5034.5647ms
2025-02-02 23:04:18.492 +03:00 [INF] Request starting HTTP/1.1 POST http://07ca-46-152-255-232.ngrok-free.app/api/proxy/forward?url=https://icreditdept.com/api/testasp/test_local_verify_otp.php - application/json; charset=utf-8 53
2025-02-02 23:04:18.496 +03:00 [INF] Executing endpoint 'NayifatAPI.Controllers.ProxyController.ForwardRequest (NayifatAPI)'
2025-02-02 23:04:18.498 +03:00 [INF] Route matched with {action = "ForwardRequest", controller = "Proxy"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] ForwardRequest() on controller NayifatAPI.Controllers.ProxyController (NayifatAPI).
2025-02-02 23:04:18.505 +03:00 [INF] Start processing HTTP request POST https://icreditdept.com/api/testasp/test_local_verify_otp.php
2025-02-02 23:04:18.507 +03:00 [INF] Sending HTTP request POST https://icreditdept.com/api/testasp/test_local_verify_otp.php
2025-02-02 23:04:18.929 +03:00 [INF] Received HTTP response headers after 419.7497ms - 200
2025-02-02 23:04:18.932 +03:00 [INF] End processing HTTP request after 426.5769ms - 200
2025-02-02 23:04:18.935 +03:00 [INF] Raw response length: 43
2025-02-02 23:04:18.940 +03:00 [INF] Response content: {"success":false,"message":"Incorrect OTP"}
2025-02-02 23:04:18.941 +03:00 [INF] Executing ContentResult with HTTP Response ContentType of application/json
2025-02-02 23:04:18.943 +03:00 [INF] Executed action NayifatAPI.Controllers.ProxyController.ForwardRequest (NayifatAPI) in 437.6409ms
2025-02-02 23:04:18.945 +03:00 [INF] Executed endpoint 'NayifatAPI.Controllers.ProxyController.ForwardRequest (NayifatAPI)'
2025-02-02 23:04:18.947 +03:00 [INF] Request finished HTTP/1.1 POST http://07ca-46-152-255-232.ngrok-free.app/api/proxy/forward?url=https://icreditdept.com/api/testasp/test_local_verify_otp.php - 200 43 application/json 454.7429ms
2025-02-02 23:04:24.253 +03:00 [INF] Request starting HTTP/1.1 POST http://07ca-46-152-255-232.ngrok-free.app/api/proxy/forward?url=https://icreditdept.com/api/testasp/test_local_verify_otp.php - application/json; charset=utf-8 53
2025-02-02 23:04:24.262 +03:00 [INF] Executing endpoint 'NayifatAPI.Controllers.ProxyController.ForwardRequest (NayifatAPI)'
2025-02-02 23:04:24.263 +03:00 [INF] Route matched with {action = "ForwardRequest", controller = "Proxy"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] ForwardRequest() on controller NayifatAPI.Controllers.ProxyController (NayifatAPI).
2025-02-02 23:04:24.271 +03:00 [INF] Start processing HTTP request POST https://icreditdept.com/api/testasp/test_local_verify_otp.php
2025-02-02 23:04:24.272 +03:00 [INF] Sending HTTP request POST https://icreditdept.com/api/testasp/test_local_verify_otp.php
2025-02-02 23:04:25.019 +03:00 [INF] Received HTTP response headers after 744.7616ms - 200
2025-02-02 23:04:25.051 +03:00 [INF] End processing HTTP request after 779.5991ms - 200
2025-02-02 23:04:25.055 +03:00 [INF] Raw response length: 202
2025-02-02 23:04:25.056 +03:00 [INF] Response content: {"success":true,"errors":[],"result":{"nationalId":"1064448614","otp":"566077","verifiedFlag":true,"successMsg":"Verified successfully.","errCode":0,"errMsg":null},"type":"N","message":null,"code":null}
2025-02-02 23:04:25.059 +03:00 [INF] Executing ContentResult with HTTP Response ContentType of application/json
2025-02-02 23:04:25.063 +03:00 [INF] Executed action NayifatAPI.Controllers.ProxyController.ForwardRequest (NayifatAPI) in 792.4544ms
2025-02-02 23:04:25.064 +03:00 [INF] Executed endpoint 'NayifatAPI.Controllers.ProxyController.ForwardRequest (NayifatAPI)'
2025-02-02 23:04:25.068 +03:00 [INF] Request finished HTTP/1.1 POST http://07ca-46-152-255-232.ngrok-free.app/api/proxy/forward?url=https://icreditdept.com/api/testasp/test_local_verify_otp.php - 200 202 application/json 815.5485ms
2025-02-02 23:04:49.840 +03:00 [INF] Request starting HTTP/1.1 POST http://07ca-46-152-255-232.ngrok-free.app/api/notifications/list - application/json; charset=utf-8 47
2025-02-02 23:04:49.846 +03:00 [INF] Executing endpoint 'NayifatAPI.Controllers.NotificationsController.GetNotifications (NayifatAPI)'
2025-02-02 23:04:49.848 +03:00 [INF] Route matched with {action = "GetNotifications", controller = "Notifications"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetNotifications(NayifatAPI.Controllers.GetNotificationsRequest) on controller NayifatAPI.Controllers.NotificationsController (NayifatAPI).
2025-02-02 23:04:49.856 +03:00 [INF] Executed DbCommand (5ms) [Parameters=[@__providedApiKey_0='?' (Size = 255)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [a].[Key], [a].[CreatedAt], [a].[Description], [a].[ExpiresAt], [a].[IsActive], [a].[LastUsedAt]
FROM [ApiKeys] AS [a]
WHERE [a].[Key] = @__providedApiKey_0 AND [a].[IsActive] = CAST(1 AS bit)
2025-02-02 23:04:49.864 +03:00 [INF] Executed DbCommand (4ms) [Parameters=[@__request_NationalId_0='?' (Size = 450)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [u].[national_id], [u].[last_updated], [u].[notifications]
FROM [user_notifications] AS [u]
WHERE [u].[national_id] = @__request_NationalId_0
2025-02-02 23:04:49.874 +03:00 [INF] Executed DbCommand (4ms) [Parameters=[@__Parse_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [n].[Id], [n].[additional_data], [n].[Body], [n].[body_ar], [n].[body_en], [n].[created_at], [n].[expiry_at], [n].[Route], [n].[target_criteria], [n].[Title], [n].[title_ar], [n].[title_en]
FROM [notification_templates] AS [n]
WHERE [n].[Id] = @__Parse_0
2025-02-02 23:04:49.881 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@__Parse_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [n].[Id], [n].[additional_data], [n].[Body], [n].[body_ar], [n].[body_en], [n].[created_at], [n].[expiry_at], [n].[Route], [n].[target_criteria], [n].[Title], [n].[title_ar], [n].[title_en]
FROM [notification_templates] AS [n]
WHERE [n].[Id] = @__Parse_0
2025-02-02 23:04:49.988 +03:00 [INF] Executed DbCommand (102ms) [Parameters=[@p0='?' (Size = 4000), @p1='?' (DbType = DateTime2), @p2='?' (Size = 4000), @p3='?' (Size = 4000), @p4='?' (Size = 4000), @p5='?' (Size = 450), @p6='?' (Size = 4000), @p7='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SET IMPLICIT_TRANSACTIONS OFF;
SET NOCOUNT ON;
INSERT INTO [AuthLogs] ([AuthType], [CreatedAt], [DeviceId], [FailureReason], [IpAddress], [NationalId], [Status], [UserAgent])
OUTPUT INSERTED.[Id]
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7);
2025-02-02 23:04:50.006 +03:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType9`2[[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Object, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-02-02 23:04:50.013 +03:00 [INF] Executed action NayifatAPI.Controllers.NotificationsController.GetNotifications (NayifatAPI) in 163.6631ms
2025-02-02 23:04:50.017 +03:00 [INF] Executed endpoint 'NayifatAPI.Controllers.NotificationsController.GetNotifications (NayifatAPI)'
2025-02-02 23:04:50.019 +03:00 [INF] Request finished HTTP/1.1 POST http://07ca-46-152-255-232.ngrok-free.app/api/notifications/list - 200 null application/json; charset=utf-8 179.2761ms
2025-02-02 23:04:53.162 +03:00 [INF] Request starting HTTP/1.1 POST http://07ca-46-152-255-232.ngrok-free.app/api/notifications/list - application/json; charset=utf-8 47
2025-02-02 23:04:53.166 +03:00 [INF] Executing endpoint 'NayifatAPI.Controllers.NotificationsController.GetNotifications (NayifatAPI)'
2025-02-02 23:04:53.167 +03:00 [INF] Route matched with {action = "GetNotifications", controller = "Notifications"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetNotifications(NayifatAPI.Controllers.GetNotificationsRequest) on controller NayifatAPI.Controllers.NotificationsController (NayifatAPI).
2025-02-02 23:04:53.170 +03:00 [INF] Executed DbCommand (0ms) [Parameters=[@__providedApiKey_0='?' (Size = 255)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [a].[Key], [a].[CreatedAt], [a].[Description], [a].[ExpiresAt], [a].[IsActive], [a].[LastUsedAt]
FROM [ApiKeys] AS [a]
WHERE [a].[Key] = @__providedApiKey_0 AND [a].[IsActive] = CAST(1 AS bit)
2025-02-02 23:04:53.173 +03:00 [INF] Executed DbCommand (0ms) [Parameters=[@__request_NationalId_0='?' (Size = 450)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [u].[national_id], [u].[last_updated], [u].[notifications]
FROM [user_notifications] AS [u]
WHERE [u].[national_id] = @__request_NationalId_0
2025-02-02 23:04:53.181 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@__Parse_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [n].[Id], [n].[additional_data], [n].[Body], [n].[body_ar], [n].[body_en], [n].[created_at], [n].[expiry_at], [n].[Route], [n].[target_criteria], [n].[Title], [n].[title_ar], [n].[title_en]
FROM [notification_templates] AS [n]
WHERE [n].[Id] = @__Parse_0
2025-02-02 23:04:53.184 +03:00 [INF] Executed DbCommand (0ms) [Parameters=[@__Parse_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [n].[Id], [n].[additional_data], [n].[Body], [n].[body_ar], [n].[body_en], [n].[created_at], [n].[expiry_at], [n].[Route], [n].[target_criteria], [n].[Title], [n].[title_ar], [n].[title_en]
FROM [notification_templates] AS [n]
WHERE [n].[Id] = @__Parse_0
2025-02-02 23:04:53.196 +03:00 [INF] Executed DbCommand (10ms) [Parameters=[@p0='?' (Size = 4000), @p1='?' (DbType = DateTime2), @p2='?' (Size = 4000), @p3='?' (Size = 4000), @p4='?' (Size = 4000), @p5='?' (Size = 450), @p6='?' (Size = 4000), @p7='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SET IMPLICIT_TRANSACTIONS OFF;
SET NOCOUNT ON;
INSERT INTO [AuthLogs] ([AuthType], [CreatedAt], [DeviceId], [FailureReason], [IpAddress], [NationalId], [Status], [UserAgent])
OUTPUT INSERTED.[Id]
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7);
2025-02-02 23:04:53.199 +03:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType9`2[[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Object, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-02-02 23:04:53.201 +03:00 [INF] Executed action NayifatAPI.Controllers.NotificationsController.GetNotifications (NayifatAPI) in 31.9608ms
2025-02-02 23:04:53.204 +03:00 [INF] Executed endpoint 'NayifatAPI.Controllers.NotificationsController.GetNotifications (NayifatAPI)'
2025-02-02 23:04:53.206 +03:00 [INF] Request finished HTTP/1.1 POST http://07ca-46-152-255-232.ngrok-free.app/api/notifications/list - 200 null application/json; charset=utf-8 44.1706ms
2025-02-02 23:04:57.847 +03:00 [INF] Request starting HTTP/1.1 POST http://07ca-46-152-255-232.ngrok-free.app/api/notifications/list - application/json; charset=utf-8 47
2025-02-02 23:04:57.852 +03:00 [INF] Executing endpoint 'NayifatAPI.Controllers.NotificationsController.GetNotifications (NayifatAPI)'
2025-02-02 23:04:57.854 +03:00 [INF] Route matched with {action = "GetNotifications", controller = "Notifications"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetNotifications(NayifatAPI.Controllers.GetNotificationsRequest) on controller NayifatAPI.Controllers.NotificationsController (NayifatAPI).
2025-02-02 23:04:57.860 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@__providedApiKey_0='?' (Size = 255)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [a].[Key], [a].[CreatedAt], [a].[Description], [a].[ExpiresAt], [a].[IsActive], [a].[LastUsedAt]
FROM [ApiKeys] AS [a]
WHERE [a].[Key] = @__providedApiKey_0 AND [a].[IsActive] = CAST(1 AS bit)
2025-02-02 23:04:57.864 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@__request_NationalId_0='?' (Size = 450)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [u].[national_id], [u].[last_updated], [u].[notifications]
FROM [user_notifications] AS [u]
WHERE [u].[national_id] = @__request_NationalId_0
2025-02-02 23:04:57.870 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@__Parse_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [n].[Id], [n].[additional_data], [n].[Body], [n].[body_ar], [n].[body_en], [n].[created_at], [n].[expiry_at], [n].[Route], [n].[target_criteria], [n].[Title], [n].[title_ar], [n].[title_en]
FROM [notification_templates] AS [n]
WHERE [n].[Id] = @__Parse_0
2025-02-02 23:04:57.876 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@__Parse_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [n].[Id], [n].[additional_data], [n].[Body], [n].[body_ar], [n].[body_en], [n].[created_at], [n].[expiry_at], [n].[Route], [n].[target_criteria], [n].[Title], [n].[title_ar], [n].[title_en]
FROM [notification_templates] AS [n]
WHERE [n].[Id] = @__Parse_0
2025-02-02 23:04:57.886 +03:00 [INF] Executed DbCommand (6ms) [Parameters=[@p0='?' (Size = 4000), @p1='?' (DbType = DateTime2), @p2='?' (Size = 4000), @p3='?' (Size = 4000), @p4='?' (Size = 4000), @p5='?' (Size = 450), @p6='?' (Size = 4000), @p7='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SET IMPLICIT_TRANSACTIONS OFF;
SET NOCOUNT ON;
INSERT INTO [AuthLogs] ([AuthType], [CreatedAt], [DeviceId], [FailureReason], [IpAddress], [NationalId], [Status], [UserAgent])
OUTPUT INSERTED.[Id]
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7);
2025-02-02 23:04:57.891 +03:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType9`2[[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Object, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-02-02 23:04:57.897 +03:00 [INF] Executed action NayifatAPI.Controllers.NotificationsController.GetNotifications (NayifatAPI) in 39.3268ms
2025-02-02 23:04:57.902 +03:00 [INF] Executed endpoint 'NayifatAPI.Controllers.NotificationsController.GetNotifications (NayifatAPI)'
2025-02-02 23:04:57.905 +03:00 [INF] Request finished HTTP/1.1 POST http://07ca-46-152-255-232.ngrok-free.app/api/notifications/list - 200 null application/json; charset=utf-8 57.7893ms
2025-02-02 23:06:37.076 +03:00 [INF] Request starting HTTP/1.1 POST http://07ca-46-152-255-232.ngrok-free.app/api/auth/signin - application/json; charset=utf-8 78
2025-02-02 23:06:37.084 +03:00 [INF] Executing endpoint 'NayifatAPI.Controllers.AuthController.SignIn (NayifatAPI)'
2025-02-02 23:06:37.087 +03:00 [INF] Route matched with {action = "SignIn", controller = "Auth"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] SignIn(NayifatAPI.Controllers.SignInRequest) on controller NayifatAPI.Controllers.AuthController (NayifatAPI).
2025-02-02 23:06:37.099 +03:00 [INF] Executed DbCommand (7ms) [Parameters=[@__providedApiKey_0='?' (Size = 255)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [a].[Key], [a].[CreatedAt], [a].[Description], [a].[ExpiresAt], [a].[IsActive], [a].[LastUsedAt]
FROM [ApiKeys] AS [a]
WHERE [a].[Key] = @__providedApiKey_0 AND [a].[IsActive] = CAST(1 AS bit)
2025-02-02 23:06:37.108 +03:00 [INF] Executed DbCommand (3ms) [Parameters=[@__request_NationalId_0='?' (Size = 450)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [c].[NationalId], [c].[AddNo], [c].[BuildingNo], [c].[City], [c].[Consent], [c].[ConsentDate], [c].[DateOfBirth], [c].[Dependents], [c].[District], [c].[Email], [c].[Employer], [c].[FamilyNameAr], [c].[FamilyNameEn], [c].[FirstNameAr], [c].[FirstNameEn], [c].[Iban], [c].[IdExpiryDate], [c].[Los], [c].[Mpin], [c].[MpinEnabled], [c].[NafathStatus], [c].[NafathTimestamp], [c].[Password], [c].[Phone], [c].[RegistrationDate], [c].[SalaryCustomer], [c].[SalaryDakhli], [c].[SecondNameAr], [c].[SecondNameEn], [c].[Sector], [c].[Street], [c].[ThirdNameAr], [c].[ThirdNameEn], [c].[Zipcode]
FROM [Customers] AS [c]
WHERE [c].[NationalId] = @__request_NationalId_0
2025-02-02 23:06:37.114 +03:00 [INF] Starting password verification for NationalId: 1064448614
2025-02-02 23:06:37.356 +03:00 [INF] Password verification result for NationalId 1064448614: Success
2025-02-02 23:06:37.369 +03:00 [INF] Executed DbCommand (11ms) [Parameters=[@p0='?' (Size = 4000), @p1='?' (DbType = DateTime2), @p2='?' (Size = 4000), @p3='?' (Size = 4000), @p4='?' (Size = 4000), @p5='?' (Size = 450), @p6='?' (Size = 4000), @p7='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SET IMPLICIT_TRANSACTIONS OFF;
SET NOCOUNT ON;
INSERT INTO [AuthLogs] ([AuthType], [CreatedAt], [DeviceId], [FailureReason], [IpAddress], [NationalId], [Status], [UserAgent])
OUTPUT INSERTED.[Id]
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7);
2025-02-02 23:06:37.377 +03:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType9`2[[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Object, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-02-02 23:06:37.379 +03:00 [INF] Executed action NayifatAPI.Controllers.AuthController.SignIn (NayifatAPI) in 288.1404ms
2025-02-02 23:06:37.382 +03:00 [INF] Executed endpoint 'NayifatAPI.Controllers.AuthController.SignIn (NayifatAPI)'
2025-02-02 23:06:37.385 +03:00 [INF] Request finished HTTP/1.1 POST http://07ca-46-152-255-232.ngrok-free.app/api/auth/signin - 200 null application/json; charset=utf-8 309.1679ms
2025-02-02 23:06:38.366 +03:00 [INF] Request starting HTTP/1.1 POST http://07ca-46-152-255-232.ngrok-free.app/api/proxy/forward?url=https://icreditdept.com/api/testasp/test_local_generate_otp.php - application/json; charset=utf-8 84
2025-02-02 23:06:38.372 +03:00 [INF] Executing endpoint 'NayifatAPI.Controllers.ProxyController.ForwardRequest (NayifatAPI)'
2025-02-02 23:06:38.373 +03:00 [INF] Route matched with {action = "ForwardRequest", controller = "Proxy"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] ForwardRequest() on controller NayifatAPI.Controllers.ProxyController (NayifatAPI).
2025-02-02 23:06:38.375 +03:00 [INF] Start processing HTTP request POST https://icreditdept.com/api/testasp/test_local_generate_otp.php
2025-02-02 23:06:38.378 +03:00 [INF] Sending HTTP request POST https://icreditdept.com/api/testasp/test_local_generate_otp.php
2025-02-02 23:06:42.232 +03:00 [INF] Received HTTP response headers after 3849.0955ms - 200
2025-02-02 23:06:42.237 +03:00 [INF] End processing HTTP request after 3861.1272ms - 200
2025-02-02 23:06:42.238 +03:00 [INF] Raw response length: 200
2025-02-02 23:06:42.239 +03:00 [INF] Response content: {"success":true,"errors":[],"result":{"nationalId":"1064448614","otp":587007,"expiryDate":"2025-02-02 23:11:42","successMsg":"Success","errCode":0,"errMsg":null},"type":"N","message":null,"code":null}
2025-02-02 23:06:42.240 +03:00 [INF] Executing ContentResult with HTTP Response ContentType of application/json
2025-02-02 23:06:42.241 +03:00 [INF] Executed action NayifatAPI.Controllers.ProxyController.ForwardRequest (NayifatAPI) in 3866.0615ms
2025-02-02 23:06:42.242 +03:00 [INF] Executed endpoint 'NayifatAPI.Controllers.ProxyController.ForwardRequest (NayifatAPI)'
2025-02-02 23:06:42.243 +03:00 [INF] Request finished HTTP/1.1 POST http://07ca-46-152-255-232.ngrok-free.app/api/proxy/forward?url=https://icreditdept.com/api/testasp/test_local_generate_otp.php - 200 200 application/json 3877.1709ms
2025-02-02 23:06:47.981 +03:00 [INF] Request starting HTTP/1.1 POST http://07ca-46-152-255-232.ngrok-free.app/api/proxy/forward?url=https://icreditdept.com/api/testasp/test_local_verify_otp.php - application/json; charset=utf-8 53
2025-02-02 23:06:47.987 +03:00 [INF] Executing endpoint 'NayifatAPI.Controllers.ProxyController.ForwardRequest (NayifatAPI)'
2025-02-02 23:06:47.988 +03:00 [INF] Route matched with {action = "ForwardRequest", controller = "Proxy"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] ForwardRequest() on controller NayifatAPI.Controllers.ProxyController (NayifatAPI).
2025-02-02 23:06:47.990 +03:00 [INF] Start processing HTTP request POST https://icreditdept.com/api/testasp/test_local_verify_otp.php
2025-02-02 23:06:47.991 +03:00 [INF] Sending HTTP request POST https://icreditdept.com/api/testasp/test_local_verify_otp.php
2025-02-02 23:06:53.248 +03:00 [INF] Received HTTP response headers after 5255.0591ms - 200
2025-02-02 23:06:53.251 +03:00 [INF] End processing HTTP request after 5261.5146ms - 200
2025-02-02 23:06:53.254 +03:00 [INF] Raw response length: 202
2025-02-02 23:06:53.255 +03:00 [INF] Response content: {"success":true,"errors":[],"result":{"nationalId":"1064448614","otp":"587007","verifiedFlag":true,"successMsg":"Verified successfully.","errCode":0,"errMsg":null},"type":"N","message":null,"code":null}
2025-02-02 23:06:53.256 +03:00 [INF] Executing ContentResult with HTTP Response ContentType of application/json
2025-02-02 23:06:53.258 +03:00 [INF] Executed action NayifatAPI.Controllers.ProxyController.ForwardRequest (NayifatAPI) in 5268.3446ms
2025-02-02 23:06:53.260 +03:00 [INF] Executed endpoint 'NayifatAPI.Controllers.ProxyController.ForwardRequest (NayifatAPI)'
2025-02-02 23:06:53.261 +03:00 [INF] Request finished HTTP/1.1 POST http://07ca-46-152-255-232.ngrok-free.app/api/proxy/forward?url=https://icreditdept.com/api/testasp/test_local_verify_otp.php - 200 202 application/json 5280.2068ms
2025-02-02 23:07:00.442 +03:00 [INF] Request starting HTTP/1.1 POST http://07ca-46-152-255-232.ngrok-free.app/api/notifications/list - application/json; charset=utf-8 47
2025-02-02 23:07:00.444 +03:00 [INF] Executing endpoint 'NayifatAPI.Controllers.NotificationsController.GetNotifications (NayifatAPI)'
2025-02-02 23:07:00.450 +03:00 [INF] Route matched with {action = "GetNotifications", controller = "Notifications"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetNotifications(NayifatAPI.Controllers.GetNotificationsRequest) on controller NayifatAPI.Controllers.NotificationsController (NayifatAPI).
2025-02-02 23:07:00.454 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@__providedApiKey_0='?' (Size = 255)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [a].[Key], [a].[CreatedAt], [a].[Description], [a].[ExpiresAt], [a].[IsActive], [a].[LastUsedAt]
FROM [ApiKeys] AS [a]
WHERE [a].[Key] = @__providedApiKey_0 AND [a].[IsActive] = CAST(1 AS bit)
2025-02-02 23:07:00.460 +03:00 [INF] Executed DbCommand (2ms) [Parameters=[@__request_NationalId_0='?' (Size = 450)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [u].[national_id], [u].[last_updated], [u].[notifications]
FROM [user_notifications] AS [u]
WHERE [u].[national_id] = @__request_NationalId_0
2025-02-02 23:07:00.473 +03:00 [INF] Executed DbCommand (5ms) [Parameters=[@__Parse_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [n].[Id], [n].[additional_data], [n].[Body], [n].[body_ar], [n].[body_en], [n].[created_at], [n].[expiry_at], [n].[Route], [n].[target_criteria], [n].[Title], [n].[title_ar], [n].[title_en]
FROM [notification_templates] AS [n]
WHERE [n].[Id] = @__Parse_0
2025-02-02 23:07:00.480 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@__Parse_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [n].[Id], [n].[additional_data], [n].[Body], [n].[body_ar], [n].[body_en], [n].[created_at], [n].[expiry_at], [n].[Route], [n].[target_criteria], [n].[Title], [n].[title_ar], [n].[title_en]
FROM [notification_templates] AS [n]
WHERE [n].[Id] = @__Parse_0
2025-02-02 23:07:00.566 +03:00 [INF] Executed DbCommand (75ms) [Parameters=[@p0='?' (Size = 4000), @p1='?' (DbType = DateTime2), @p2='?' (Size = 4000), @p3='?' (Size = 4000), @p4='?' (Size = 4000), @p5='?' (Size = 450), @p6='?' (Size = 4000), @p7='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SET IMPLICIT_TRANSACTIONS OFF;
SET NOCOUNT ON;
INSERT INTO [AuthLogs] ([AuthType], [CreatedAt], [DeviceId], [FailureReason], [IpAddress], [NationalId], [Status], [UserAgent])
OUTPUT INSERTED.[Id]
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7);
2025-02-02 23:07:00.573 +03:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType9`2[[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Object, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-02-02 23:07:00.575 +03:00 [INF] Executed action NayifatAPI.Controllers.NotificationsController.GetNotifications (NayifatAPI) in 122.7555ms
2025-02-02 23:07:00.582 +03:00 [INF] Executed endpoint 'NayifatAPI.Controllers.NotificationsController.GetNotifications (NayifatAPI)'
2025-02-02 23:07:00.586 +03:00 [INF] Request finished HTTP/1.1 POST http://07ca-46-152-255-232.ngrok-free.app/api/notifications/list - 200 null application/json; charset=utf-8 143.4831ms
2025-02-02 23:10:53.068 +03:00 [INF] Request starting HTTP/1.1 POST http://07ca-46-152-255-232.ngrok-free.app/api/notifications/list - application/json; charset=utf-8 47
2025-02-02 23:10:53.072 +03:00 [INF] Executing endpoint 'NayifatAPI.Controllers.NotificationsController.GetNotifications (NayifatAPI)'
2025-02-02 23:10:53.078 +03:00 [INF] Route matched with {action = "GetNotifications", controller = "Notifications"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetNotifications(NayifatAPI.Controllers.GetNotificationsRequest) on controller NayifatAPI.Controllers.NotificationsController (NayifatAPI).
2025-02-02 23:10:53.086 +03:00 [INF] Executed DbCommand (6ms) [Parameters=[@__providedApiKey_0='?' (Size = 255)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [a].[Key], [a].[CreatedAt], [a].[Description], [a].[ExpiresAt], [a].[IsActive], [a].[LastUsedAt]
FROM [ApiKeys] AS [a]
WHERE [a].[Key] = @__providedApiKey_0 AND [a].[IsActive] = CAST(1 AS bit)
2025-02-02 23:10:53.093 +03:00 [INF] Executed DbCommand (3ms) [Parameters=[@__request_NationalId_0='?' (Size = 450)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [u].[national_id], [u].[last_updated], [u].[notifications]
FROM [user_notifications] AS [u]
WHERE [u].[national_id] = @__request_NationalId_0
2025-02-02 23:10:53.099 +03:00 [INF] Executed DbCommand (3ms) [Parameters=[@__Parse_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [n].[Id], [n].[additional_data], [n].[Body], [n].[body_ar], [n].[body_en], [n].[created_at], [n].[expiry_at], [n].[Route], [n].[target_criteria], [n].[Title], [n].[title_ar], [n].[title_en]
FROM [notification_templates] AS [n]
WHERE [n].[Id] = @__Parse_0
2025-02-02 23:10:53.103 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@__Parse_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [n].[Id], [n].[additional_data], [n].[Body], [n].[body_ar], [n].[body_en], [n].[created_at], [n].[expiry_at], [n].[Route], [n].[target_criteria], [n].[Title], [n].[title_ar], [n].[title_en]
FROM [notification_templates] AS [n]
WHERE [n].[Id] = @__Parse_0
2025-02-02 23:10:53.186 +03:00 [INF] Executed DbCommand (81ms) [Parameters=[@p0='?' (Size = 4000), @p1='?' (DbType = DateTime2), @p2='?' (Size = 4000), @p3='?' (Size = 4000), @p4='?' (Size = 4000), @p5='?' (Size = 450), @p6='?' (Size = 4000), @p7='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SET IMPLICIT_TRANSACTIONS OFF;
SET NOCOUNT ON;
INSERT INTO [AuthLogs] ([AuthType], [CreatedAt], [DeviceId], [FailureReason], [IpAddress], [NationalId], [Status], [UserAgent])
OUTPUT INSERTED.[Id]
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7);
2025-02-02 23:10:53.195 +03:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType9`2[[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Object, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-02-02 23:10:53.197 +03:00 [INF] Executed action NayifatAPI.Controllers.NotificationsController.GetNotifications (NayifatAPI) in 117.8896ms
2025-02-02 23:10:53.199 +03:00 [INF] Executed endpoint 'NayifatAPI.Controllers.NotificationsController.GetNotifications (NayifatAPI)'
2025-02-02 23:10:53.201 +03:00 [INF] Request finished HTTP/1.1 POST http://07ca-46-152-255-232.ngrok-free.app/api/notifications/list - 200 null application/json; charset=utf-8 133.1422ms
2025-02-02 23:11:19.038 +03:00 [INF] Request starting HTTP/1.1 POST http://07ca-46-152-255-232.ngrok-free.app/api/auth/signin - application/json; charset=utf-8 78
2025-02-02 23:11:19.041 +03:00 [INF] Executing endpoint 'NayifatAPI.Controllers.AuthController.SignIn (NayifatAPI)'
2025-02-02 23:11:19.042 +03:00 [INF] Route matched with {action = "SignIn", controller = "Auth"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] SignIn(NayifatAPI.Controllers.SignInRequest) on controller NayifatAPI.Controllers.AuthController (NayifatAPI).
2025-02-02 23:11:19.044 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@__providedApiKey_0='?' (Size = 255)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [a].[Key], [a].[CreatedAt], [a].[Description], [a].[ExpiresAt], [a].[IsActive], [a].[LastUsedAt]
FROM [ApiKeys] AS [a]
WHERE [a].[Key] = @__providedApiKey_0 AND [a].[IsActive] = CAST(1 AS bit)
2025-02-02 23:11:19.049 +03:00 [INF] Executed DbCommand (2ms) [Parameters=[@__request_NationalId_0='?' (Size = 450)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [c].[NationalId], [c].[AddNo], [c].[BuildingNo], [c].[City], [c].[Consent], [c].[ConsentDate], [c].[DateOfBirth], [c].[Dependents], [c].[District], [c].[Email], [c].[Employer], [c].[FamilyNameAr], [c].[FamilyNameEn], [c].[FirstNameAr], [c].[FirstNameEn], [c].[Iban], [c].[IdExpiryDate], [c].[Los], [c].[Mpin], [c].[MpinEnabled], [c].[NafathStatus], [c].[NafathTimestamp], [c].[Password], [c].[Phone], [c].[RegistrationDate], [c].[SalaryCustomer], [c].[SalaryDakhli], [c].[SecondNameAr], [c].[SecondNameEn], [c].[Sector], [c].[Street], [c].[ThirdNameAr], [c].[ThirdNameEn], [c].[Zipcode]
FROM [Customers] AS [c]
WHERE [c].[NationalId] = @__request_NationalId_0
2025-02-02 23:11:19.056 +03:00 [INF] Starting password verification for NationalId: 1064448614
2025-02-02 23:11:19.244 +03:00 [INF] Password verification result for NationalId 1064448614: Success
2025-02-02 23:11:19.321 +03:00 [INF] Executed DbCommand (74ms) [Parameters=[@p0='?' (Size = 4000), @p1='?' (DbType = DateTime2), @p2='?' (Size = 4000), @p3='?' (Size = 4000), @p4='?' (Size = 4000), @p5='?' (Size = 450), @p6='?' (Size = 4000), @p7='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SET IMPLICIT_TRANSACTIONS OFF;
SET NOCOUNT ON;
INSERT INTO [AuthLogs] ([AuthType], [CreatedAt], [DeviceId], [FailureReason], [IpAddress], [NationalId], [Status], [UserAgent])
OUTPUT INSERTED.[Id]
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7);
2025-02-02 23:11:19.327 +03:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType9`2[[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Object, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-02-02 23:11:19.328 +03:00 [INF] Executed action NayifatAPI.Controllers.AuthController.SignIn (NayifatAPI) in 285.2744ms
2025-02-02 23:11:19.331 +03:00 [INF] Executed endpoint 'NayifatAPI.Controllers.AuthController.SignIn (NayifatAPI)'
2025-02-02 23:11:19.333 +03:00 [INF] Request finished HTTP/1.1 POST http://07ca-46-152-255-232.ngrok-free.app/api/auth/signin - 200 null application/json; charset=utf-8 294.5337ms
2025-02-02 23:11:20.550 +03:00 [INF] Request starting HTTP/1.1 POST http://07ca-46-152-255-232.ngrok-free.app/api/proxy/forward?url=https://icreditdept.com/api/testasp/test_local_generate_otp.php - application/json; charset=utf-8 84
2025-02-02 23:11:20.557 +03:00 [INF] Executing endpoint 'NayifatAPI.Controllers.ProxyController.ForwardRequest (NayifatAPI)'
2025-02-02 23:11:20.558 +03:00 [INF] Route matched with {action = "ForwardRequest", controller = "Proxy"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] ForwardRequest() on controller NayifatAPI.Controllers.ProxyController (NayifatAPI).
2025-02-02 23:11:20.562 +03:00 [INF] Start processing HTTP request POST https://icreditdept.com/api/testasp/test_local_generate_otp.php
2025-02-02 23:11:20.565 +03:00 [INF] Sending HTTP request POST https://icreditdept.com/api/testasp/test_local_generate_otp.php
2025-02-02 23:11:21.870 +03:00 [INF] Received HTTP response headers after 1300.1567ms - 200
2025-02-02 23:11:21.871 +03:00 [INF] End processing HTTP request after 1308.6901ms - 200
2025-02-02 23:11:21.872 +03:00 [INF] Raw response length: 200
2025-02-02 23:11:21.873 +03:00 [INF] Response content: {"success":true,"errors":[],"result":{"nationalId":"1064448614","otp":216984,"expiryDate":"2025-02-02 23:16:22","successMsg":"Success","errCode":0,"errMsg":null},"type":"N","message":null,"code":null}
2025-02-02 23:11:21.874 +03:00 [INF] Executing ContentResult with HTTP Response ContentType of application/json
2025-02-02 23:11:21.875 +03:00 [INF] Executed action NayifatAPI.Controllers.ProxyController.ForwardRequest (NayifatAPI) in 1312.691ms
2025-02-02 23:11:21.878 +03:00 [INF] Executed endpoint 'NayifatAPI.Controllers.ProxyController.ForwardRequest (NayifatAPI)'
2025-02-02 23:11:21.880 +03:00 [INF] Request finished HTTP/1.1 POST http://07ca-46-152-255-232.ngrok-free.app/api/proxy/forward?url=https://icreditdept.com/api/testasp/test_local_generate_otp.php - 200 200 application/json 1329.6972ms
2025-02-02 23:11:31.016 +03:00 [INF] Request starting HTTP/1.1 POST http://07ca-46-152-255-232.ngrok-free.app/api/proxy/forward?url=https://icreditdept.com/api/testasp/test_local_verify_otp.php - application/json; charset=utf-8 53
2025-02-02 23:11:31.020 +03:00 [INF] Executing endpoint 'NayifatAPI.Controllers.ProxyController.ForwardRequest (NayifatAPI)'
2025-02-02 23:11:31.021 +03:00 [INF] Route matched with {action = "ForwardRequest", controller = "Proxy"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] ForwardRequest() on controller NayifatAPI.Controllers.ProxyController (NayifatAPI).
2025-02-02 23:11:31.022 +03:00 [INF] Start processing HTTP request POST https://icreditdept.com/api/testasp/test_local_verify_otp.php
2025-02-02 23:11:31.023 +03:00 [INF] Sending HTTP request POST https://icreditdept.com/api/testasp/test_local_verify_otp.php
2025-02-02 23:11:31.434 +03:00 [INF] Received HTTP response headers after 410.2215ms - 200
2025-02-02 23:11:31.437 +03:00 [INF] End processing HTTP request after 414.3254ms - 200
2025-02-02 23:11:31.438 +03:00 [INF] Raw response length: 202
2025-02-02 23:11:31.440 +03:00 [INF] Response content: {"success":true,"errors":[],"result":{"nationalId":"1064448614","otp":"216984","verifiedFlag":true,"successMsg":"Verified successfully.","errCode":0,"errMsg":null},"type":"N","message":null,"code":null}
2025-02-02 23:11:31.451 +03:00 [INF] Executing ContentResult with HTTP Response ContentType of application/json
2025-02-02 23:11:31.453 +03:00 [INF] Executed action NayifatAPI.Controllers.ProxyController.ForwardRequest (NayifatAPI) in 430.8826ms
2025-02-02 23:11:31.455 +03:00 [INF] Executed endpoint 'NayifatAPI.Controllers.ProxyController.ForwardRequest (NayifatAPI)'
2025-02-02 23:11:31.457 +03:00 [INF] Request finished HTTP/1.1 POST http://07ca-46-152-255-232.ngrok-free.app/api/proxy/forward?url=https://icreditdept.com/api/testasp/test_local_verify_otp.php - 200 202 application/json 441.1139ms
2025-02-02 23:11:42.154 +03:00 [INF] Request starting HTTP/1.1 POST http://07ca-46-152-255-232.ngrok-free.app/api/notifications/list - application/json; charset=utf-8 47
2025-02-02 23:11:42.158 +03:00 [INF] Executing endpoint 'NayifatAPI.Controllers.NotificationsController.GetNotifications (NayifatAPI)'
2025-02-02 23:11:42.159 +03:00 [INF] Route matched with {action = "GetNotifications", controller = "Notifications"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetNotifications(NayifatAPI.Controllers.GetNotificationsRequest) on controller NayifatAPI.Controllers.NotificationsController (NayifatAPI).
2025-02-02 23:11:42.168 +03:00 [INF] Executed DbCommand (4ms) [Parameters=[@__providedApiKey_0='?' (Size = 255)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [a].[Key], [a].[CreatedAt], [a].[Description], [a].[ExpiresAt], [a].[IsActive], [a].[LastUsedAt]
FROM [ApiKeys] AS [a]
WHERE [a].[Key] = @__providedApiKey_0 AND [a].[IsActive] = CAST(1 AS bit)
2025-02-02 23:11:42.172 +03:00 [INF] Executed DbCommand (2ms) [Parameters=[@__request_NationalId_0='?' (Size = 450)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [u].[national_id], [u].[last_updated], [u].[notifications]
FROM [user_notifications] AS [u]
WHERE [u].[national_id] = @__request_NationalId_0
2025-02-02 23:11:42.179 +03:00 [INF] Executed DbCommand (4ms) [Parameters=[@__Parse_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [n].[Id], [n].[additional_data], [n].[Body], [n].[body_ar], [n].[body_en], [n].[created_at], [n].[expiry_at], [n].[Route], [n].[target_criteria], [n].[Title], [n].[title_ar], [n].[title_en]
FROM [notification_templates] AS [n]
WHERE [n].[Id] = @__Parse_0
2025-02-02 23:11:42.185 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@__Parse_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [n].[Id], [n].[additional_data], [n].[Body], [n].[body_ar], [n].[body_en], [n].[created_at], [n].[expiry_at], [n].[Route], [n].[target_criteria], [n].[Title], [n].[title_ar], [n].[title_en]
FROM [notification_templates] AS [n]
WHERE [n].[Id] = @__Parse_0
2025-02-02 23:11:42.271 +03:00 [INF] Executed DbCommand (81ms) [Parameters=[@p0='?' (Size = 4000), @p1='?' (DbType = DateTime2), @p2='?' (Size = 4000), @p3='?' (Size = 4000), @p4='?' (Size = 4000), @p5='?' (Size = 450), @p6='?' (Size = 4000), @p7='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SET IMPLICIT_TRANSACTIONS OFF;
SET NOCOUNT ON;
INSERT INTO [AuthLogs] ([AuthType], [CreatedAt], [DeviceId], [FailureReason], [IpAddress], [NationalId], [Status], [UserAgent])
OUTPUT INSERTED.[Id]
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7);
2025-02-02 23:11:42.279 +03:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType9`2[[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Object, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-02-02 23:11:42.283 +03:00 [INF] Executed action NayifatAPI.Controllers.NotificationsController.GetNotifications (NayifatAPI) in 123.0925ms
2025-02-02 23:11:42.284 +03:00 [INF] Executed endpoint 'NayifatAPI.Controllers.NotificationsController.GetNotifications (NayifatAPI)'
2025-02-02 23:11:42.286 +03:00 [INF] Request finished HTTP/1.1 POST http://07ca-46-152-255-232.ngrok-free.app/api/notifications/list - 200 null application/json; charset=utf-8 131.7986ms
2025-02-02 23:17:13.736 +03:00 [INF] Request starting HTTP/1.1 POST http://07ca-46-152-255-232.ngrok-free.app/api/notifications/list - application/json; charset=utf-8 47
2025-02-02 23:17:13.741 +03:00 [INF] Executing endpoint 'NayifatAPI.Controllers.NotificationsController.GetNotifications (NayifatAPI)'
2025-02-02 23:17:13.742 +03:00 [INF] Route matched with {action = "GetNotifications", controller = "Notifications"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetNotifications(NayifatAPI.Controllers.GetNotificationsRequest) on controller NayifatAPI.Controllers.NotificationsController (NayifatAPI).
2025-02-02 23:17:13.756 +03:00 [INF] Executed DbCommand (3ms) [Parameters=[@__providedApiKey_0='?' (Size = 255)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [a].[Key], [a].[CreatedAt], [a].[Description], [a].[ExpiresAt], [a].[IsActive], [a].[LastUsedAt]
FROM [ApiKeys] AS [a]
WHERE [a].[Key] = @__providedApiKey_0 AND [a].[IsActive] = CAST(1 AS bit)
2025-02-02 23:17:13.764 +03:00 [INF] Executed DbCommand (6ms) [Parameters=[@__request_NationalId_0='?' (Size = 450)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [u].[national_id], [u].[last_updated], [u].[notifications]
FROM [user_notifications] AS [u]
WHERE [u].[national_id] = @__request_NationalId_0
2025-02-02 23:17:13.772 +03:00 [INF] Executed DbCommand (2ms) [Parameters=[@__Parse_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [n].[Id], [n].[additional_data], [n].[Body], [n].[body_ar], [n].[body_en], [n].[created_at], [n].[expiry_at], [n].[Route], [n].[target_criteria], [n].[Title], [n].[title_ar], [n].[title_en]
FROM [notification_templates] AS [n]
WHERE [n].[Id] = @__Parse_0
2025-02-02 23:17:13.776 +03:00 [INF] Executed DbCommand (0ms) [Parameters=[@__Parse_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [n].[Id], [n].[additional_data], [n].[Body], [n].[body_ar], [n].[body_en], [n].[created_at], [n].[expiry_at], [n].[Route], [n].[target_criteria], [n].[Title], [n].[title_ar], [n].[title_en]
FROM [notification_templates] AS [n]
WHERE [n].[Id] = @__Parse_0
2025-02-02 23:17:13.861 +03:00 [INF] Executed DbCommand (81ms) [Parameters=[@p0='?' (Size = 4000), @p1='?' (DbType = DateTime2), @p2='?' (Size = 4000), @p3='?' (Size = 4000), @p4='?' (Size = 4000), @p5='?' (Size = 450), @p6='?' (Size = 4000), @p7='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SET IMPLICIT_TRANSACTIONS OFF;
SET NOCOUNT ON;
INSERT INTO [AuthLogs] ([AuthType], [CreatedAt], [DeviceId], [FailureReason], [IpAddress], [NationalId], [Status], [UserAgent])
OUTPUT INSERTED.[Id]
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7);
2025-02-02 23:17:13.870 +03:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType9`2[[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Object, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-02-02 23:17:13.874 +03:00 [INF] Executed action NayifatAPI.Controllers.NotificationsController.GetNotifications (NayifatAPI) in 130.9032ms
2025-02-02 23:17:13.876 +03:00 [INF] Executed endpoint 'NayifatAPI.Controllers.NotificationsController.GetNotifications (NayifatAPI)'
2025-02-02 23:17:13.878 +03:00 [INF] Request finished HTTP/1.1 POST http://07ca-46-152-255-232.ngrok-free.app/api/notifications/list - 200 null application/json; charset=utf-8 141.8734ms
2025-02-02 23:21:43.507 +03:00 [INF] Request starting HTTP/1.1 POST http://07ca-46-152-255-232.ngrok-free.app/api/notifications/list - application/json; charset=utf-8 47
2025-02-02 23:21:43.512 +03:00 [INF] Executing endpoint 'NayifatAPI.Controllers.NotificationsController.GetNotifications (NayifatAPI)'
2025-02-02 23:21:43.513 +03:00 [INF] Route matched with {action = "GetNotifications", controller = "Notifications"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetNotifications(NayifatAPI.Controllers.GetNotificationsRequest) on controller NayifatAPI.Controllers.NotificationsController (NayifatAPI).
2025-02-02 23:21:43.528 +03:00 [INF] Executed DbCommand (8ms) [Parameters=[@__providedApiKey_0='?' (Size = 255)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [a].[Key], [a].[CreatedAt], [a].[Description], [a].[ExpiresAt], [a].[IsActive], [a].[LastUsedAt]
FROM [ApiKeys] AS [a]
WHERE [a].[Key] = @__providedApiKey_0 AND [a].[IsActive] = CAST(1 AS bit)
2025-02-02 23:21:43.542 +03:00 [INF] Executed DbCommand (7ms) [Parameters=[@__request_NationalId_0='?' (Size = 450)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [u].[national_id], [u].[last_updated], [u].[notifications]
FROM [user_notifications] AS [u]
WHERE [u].[national_id] = @__request_NationalId_0
2025-02-02 23:21:43.551 +03:00 [INF] Executed DbCommand (5ms) [Parameters=[@__Parse_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [n].[Id], [n].[additional_data], [n].[Body], [n].[body_ar], [n].[body_en], [n].[created_at], [n].[expiry_at], [n].[Route], [n].[target_criteria], [n].[Title], [n].[title_ar], [n].[title_en]
FROM [notification_templates] AS [n]
WHERE [n].[Id] = @__Parse_0
2025-02-02 23:21:43.558 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@__Parse_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [n].[Id], [n].[additional_data], [n].[Body], [n].[body_ar], [n].[body_en], [n].[created_at], [n].[expiry_at], [n].[Route], [n].[target_criteria], [n].[Title], [n].[title_ar], [n].[title_en]
FROM [notification_templates] AS [n]
WHERE [n].[Id] = @__Parse_0
2025-02-02 23:21:43.643 +03:00 [INF] Executed DbCommand (81ms) [Parameters=[@p0='?' (Size = 4000), @p1='?' (DbType = DateTime2), @p2='?' (Size = 4000), @p3='?' (Size = 4000), @p4='?' (Size = 4000), @p5='?' (Size = 450), @p6='?' (Size = 4000), @p7='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SET IMPLICIT_TRANSACTIONS OFF;
SET NOCOUNT ON;
INSERT INTO [AuthLogs] ([AuthType], [CreatedAt], [DeviceId], [FailureReason], [IpAddress], [NationalId], [Status], [UserAgent])
OUTPUT INSERTED.[Id]
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7);
2025-02-02 23:21:43.648 +03:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType9`2[[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Object, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-02-02 23:21:43.651 +03:00 [INF] Executed action NayifatAPI.Controllers.NotificationsController.GetNotifications (NayifatAPI) in 134.2812ms
2025-02-02 23:21:43.657 +03:00 [INF] Executed endpoint 'NayifatAPI.Controllers.NotificationsController.GetNotifications (NayifatAPI)'
2025-02-02 23:21:43.659 +03:00 [INF] Request finished HTTP/1.1 POST http://07ca-46-152-255-232.ngrok-free.app/api/notifications/list - 200 null application/json; charset=utf-8 152.3777ms
2025-02-02 23:26:43.548 +03:00 [INF] Request starting HTTP/1.1 POST http://07ca-46-152-255-232.ngrok-free.app/api/notifications/list - application/json; charset=utf-8 47
2025-02-02 23:26:43.559 +03:00 [INF] Executing endpoint 'NayifatAPI.Controllers.NotificationsController.GetNotifications (NayifatAPI)'
2025-02-02 23:26:43.562 +03:00 [INF] Route matched with {action = "GetNotifications", controller = "Notifications"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetNotifications(NayifatAPI.Controllers.GetNotificationsRequest) on controller NayifatAPI.Controllers.NotificationsController (NayifatAPI).
2025-02-02 23:26:43.576 +03:00 [INF] Executed DbCommand (6ms) [Parameters=[@__providedApiKey_0='?' (Size = 255)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [a].[Key], [a].[CreatedAt], [a].[Description], [a].[ExpiresAt], [a].[IsActive], [a].[LastUsedAt]
FROM [ApiKeys] AS [a]
WHERE [a].[Key] = @__providedApiKey_0 AND [a].[IsActive] = CAST(1 AS bit)
2025-02-02 23:26:43.587 +03:00 [INF] Executed DbCommand (4ms) [Parameters=[@__request_NationalId_0='?' (Size = 450)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [u].[national_id], [u].[last_updated], [u].[notifications]
FROM [user_notifications] AS [u]
WHERE [u].[national_id] = @__request_NationalId_0
2025-02-02 23:26:43.596 +03:00 [INF] Executed DbCommand (4ms) [Parameters=[@__Parse_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [n].[Id], [n].[additional_data], [n].[Body], [n].[body_ar], [n].[body_en], [n].[created_at], [n].[expiry_at], [n].[Route], [n].[target_criteria], [n].[Title], [n].[title_ar], [n].[title_en]
FROM [notification_templates] AS [n]
WHERE [n].[Id] = @__Parse_0
2025-02-02 23:26:43.601 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@__Parse_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [n].[Id], [n].[additional_data], [n].[Body], [n].[body_ar], [n].[body_en], [n].[created_at], [n].[expiry_at], [n].[Route], [n].[target_criteria], [n].[Title], [n].[title_ar], [n].[title_en]
FROM [notification_templates] AS [n]
WHERE [n].[Id] = @__Parse_0
2025-02-02 23:26:43.614 +03:00 [INF] Executed DbCommand (9ms) [Parameters=[@p0='?' (Size = 4000), @p1='?' (DbType = DateTime2), @p2='?' (Size = 4000), @p3='?' (Size = 4000), @p4='?' (Size = 4000), @p5='?' (Size = 450), @p6='?' (Size = 4000), @p7='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SET IMPLICIT_TRANSACTIONS OFF;
SET NOCOUNT ON;
INSERT INTO [AuthLogs] ([AuthType], [CreatedAt], [DeviceId], [FailureReason], [IpAddress], [NationalId], [Status], [UserAgent])
OUTPUT INSERTED.[Id]
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7);
2025-02-02 23:26:43.622 +03:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType9`2[[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Object, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-02-02 23:26:43.626 +03:00 [INF] Executed action NayifatAPI.Controllers.NotificationsController.GetNotifications (NayifatAPI) in 58.2638ms
2025-02-02 23:26:43.635 +03:00 [INF] Executed endpoint 'NayifatAPI.Controllers.NotificationsController.GetNotifications (NayifatAPI)'
2025-02-02 23:26:43.660 +03:00 [INF] Request finished HTTP/1.1 POST http://07ca-46-152-255-232.ngrok-free.app/api/notifications/list - 200 null application/json; charset=utf-8 111.9763ms
2025-02-02 23:31:21.715 +03:00 [INF] Request starting HTTP/1.1 POST http://07ca-46-152-255-232.ngrok-free.app/api/notifications/list - application/json; charset=utf-8 47
2025-02-02 23:31:21.720 +03:00 [INF] Executing endpoint 'NayifatAPI.Controllers.NotificationsController.GetNotifications (NayifatAPI)'
2025-02-02 23:31:21.723 +03:00 [INF] Route matched with {action = "GetNotifications", controller = "Notifications"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetNotifications(NayifatAPI.Controllers.GetNotificationsRequest) on controller NayifatAPI.Controllers.NotificationsController (NayifatAPI).
2025-02-02 23:31:21.757 +03:00 [INF] Executed DbCommand (6ms) [Parameters=[@__providedApiKey_0='?' (Size = 255)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [a].[Key], [a].[CreatedAt], [a].[Description], [a].[ExpiresAt], [a].[IsActive], [a].[LastUsedAt]
FROM [ApiKeys] AS [a]
WHERE [a].[Key] = @__providedApiKey_0 AND [a].[IsActive] = CAST(1 AS bit)
2025-02-02 23:31:21.770 +03:00 [INF] Executed DbCommand (8ms) [Parameters=[@__request_NationalId_0='?' (Size = 450)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [u].[national_id], [u].[last_updated], [u].[notifications]
FROM [user_notifications] AS [u]
WHERE [u].[national_id] = @__request_NationalId_0
2025-02-02 23:31:21.779 +03:00 [INF] Executed DbCommand (5ms) [Parameters=[@__Parse_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [n].[Id], [n].[additional_data], [n].[Body], [n].[body_ar], [n].[body_en], [n].[created_at], [n].[expiry_at], [n].[Route], [n].[target_criteria], [n].[Title], [n].[title_ar], [n].[title_en]
FROM [notification_templates] AS [n]
WHERE [n].[Id] = @__Parse_0
2025-02-02 23:31:21.789 +03:00 [INF] Executed DbCommand (3ms) [Parameters=[@__Parse_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [n].[Id], [n].[additional_data], [n].[Body], [n].[body_ar], [n].[body_en], [n].[created_at], [n].[expiry_at], [n].[Route], [n].[target_criteria], [n].[Title], [n].[title_ar], [n].[title_en]
FROM [notification_templates] AS [n]
WHERE [n].[Id] = @__Parse_0
2025-02-02 23:31:21.805 +03:00 [INF] Executed DbCommand (12ms) [Parameters=[@p0='?' (Size = 4000), @p1='?' (DbType = DateTime2), @p2='?' (Size = 4000), @p3='?' (Size = 4000), @p4='?' (Size = 4000), @p5='?' (Size = 450), @p6='?' (Size = 4000), @p7='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SET IMPLICIT_TRANSACTIONS OFF;
SET NOCOUNT ON;
INSERT INTO [AuthLogs] ([AuthType], [CreatedAt], [DeviceId], [FailureReason], [IpAddress], [NationalId], [Status], [UserAgent])
OUTPUT INSERTED.[Id]
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7);
2025-02-02 23:31:21.808 +03:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType9`2[[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Object, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-02-02 23:31:21.810 +03:00 [INF] Executed action NayifatAPI.Controllers.NotificationsController.GetNotifications (NayifatAPI) in 82.5512ms
2025-02-02 23:31:21.812 +03:00 [INF] Executed endpoint 'NayifatAPI.Controllers.NotificationsController.GetNotifications (NayifatAPI)'
2025-02-02 23:31:21.817 +03:00 [INF] Request finished HTTP/1.1 POST http://07ca-46-152-255-232.ngrok-free.app/api/notifications/list - 200 null application/json; charset=utf-8 101.7402ms
2025-02-02 23:31:55.154 +03:00 [INF] Request starting HTTP/1.1 POST http://07ca-46-152-255-232.ngrok-free.app/api/auth/signin - application/json; charset=utf-8 78
2025-02-02 23:31:55.159 +03:00 [INF] Executing endpoint 'NayifatAPI.Controllers.AuthController.SignIn (NayifatAPI)'
2025-02-02 23:31:55.161 +03:00 [INF] Route matched with {action = "SignIn", controller = "Auth"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] SignIn(NayifatAPI.Controllers.SignInRequest) on controller NayifatAPI.Controllers.AuthController (NayifatAPI).
2025-02-02 23:31:55.171 +03:00 [INF] Executed DbCommand (5ms) [Parameters=[@__providedApiKey_0='?' (Size = 255)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [a].[Key], [a].[CreatedAt], [a].[Description], [a].[ExpiresAt], [a].[IsActive], [a].[LastUsedAt]
FROM [ApiKeys] AS [a]
WHERE [a].[Key] = @__providedApiKey_0 AND [a].[IsActive] = CAST(1 AS bit)
2025-02-02 23:31:55.180 +03:00 [INF] Executed DbCommand (6ms) [Parameters=[@__request_NationalId_0='?' (Size = 450)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [c].[NationalId], [c].[AddNo], [c].[BuildingNo], [c].[City], [c].[Consent], [c].[ConsentDate], [c].[DateOfBirth], [c].[Dependents], [c].[District], [c].[Email], [c].[Employer], [c].[FamilyNameAr], [c].[FamilyNameEn], [c].[FirstNameAr], [c].[FirstNameEn], [c].[Iban], [c].[IdExpiryDate], [c].[Los], [c].[Mpin], [c].[MpinEnabled], [c].[NafathStatus], [c].[NafathTimestamp], [c].[Password], [c].[Phone], [c].[RegistrationDate], [c].[SalaryCustomer], [c].[SalaryDakhli], [c].[SecondNameAr], [c].[SecondNameEn], [c].[Sector], [c].[Street], [c].[ThirdNameAr], [c].[ThirdNameEn], [c].[Zipcode]
FROM [Customers] AS [c]
WHERE [c].[NationalId] = @__request_NationalId_0
2025-02-02 23:31:55.185 +03:00 [INF] Starting password verification for NationalId: 1064448614
2025-02-02 23:31:55.407 +03:00 [INF] Password verification result for NationalId 1064448614: Success
2025-02-02 23:31:55.420 +03:00 [INF] Executed DbCommand (11ms) [Parameters=[@p0='?' (Size = 4000), @p1='?' (DbType = DateTime2), @p2='?' (Size = 4000), @p3='?' (Size = 4000), @p4='?' (Size = 4000), @p5='?' (Size = 450), @p6='?' (Size = 4000), @p7='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SET IMPLICIT_TRANSACTIONS OFF;
SET NOCOUNT ON;
INSERT INTO [AuthLogs] ([AuthType], [CreatedAt], [DeviceId], [FailureReason], [IpAddress], [NationalId], [Status], [UserAgent])
OUTPUT INSERTED.[Id]
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7);
2025-02-02 23:31:55.424 +03:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType9`2[[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Object, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-02-02 23:31:55.426 +03:00 [INF] Executed action NayifatAPI.Controllers.AuthController.SignIn (NayifatAPI) in 262.3416ms
2025-02-02 23:31:55.428 +03:00 [INF] Executed endpoint 'NayifatAPI.Controllers.AuthController.SignIn (NayifatAPI)'
2025-02-02 23:31:55.430 +03:00 [INF] Request finished HTTP/1.1 POST http://07ca-46-152-255-232.ngrok-free.app/api/auth/signin - 200 null application/json; charset=utf-8 276.1836ms
2025-02-02 23:31:56.590 +03:00 [INF] Request starting HTTP/1.1 POST http://07ca-46-152-255-232.ngrok-free.app/api/proxy/forward?url=https://icreditdept.com/api/testasp/test_local_generate_otp.php - application/json; charset=utf-8 84
2025-02-02 23:31:56.597 +03:00 [INF] Executing endpoint 'NayifatAPI.Controllers.ProxyController.ForwardRequest (NayifatAPI)'
2025-02-02 23:31:56.600 +03:00 [INF] Route matched with {action = "ForwardRequest", controller = "Proxy"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] ForwardRequest() on controller NayifatAPI.Controllers.ProxyController (NayifatAPI).
2025-02-02 23:31:56.614 +03:00 [INF] Start processing HTTP request POST https://icreditdept.com/api/testasp/test_local_generate_otp.php
2025-02-02 23:31:56.621 +03:00 [INF] Sending HTTP request POST https://icreditdept.com/api/testasp/test_local_generate_otp.php
2025-02-02 23:31:57.612 +03:00 [INF] Received HTTP response headers after 988.2958ms - 200
2025-02-02 23:31:57.615 +03:00 [INF] End processing HTTP request after 1001.2666ms - 200
2025-02-02 23:31:57.618 +03:00 [INF] Raw response length: 200
2025-02-02 23:31:57.622 +03:00 [INF] Response content: {"success":true,"errors":[],"result":{"nationalId":"1064448614","otp":964698,"expiryDate":"2025-02-02 23:36:57","successMsg":"Success","errCode":0,"errMsg":null},"type":"N","message":null,"code":null}
2025-02-02 23:31:57.628 +03:00 [INF] Executing ContentResult with HTTP Response ContentType of application/json
2025-02-02 23:31:57.630 +03:00 [INF] Executed action NayifatAPI.Controllers.ProxyController.ForwardRequest (NayifatAPI) in 1016.6953ms
2025-02-02 23:31:57.635 +03:00 [INF] Executed endpoint 'NayifatAPI.Controllers.ProxyController.ForwardRequest (NayifatAPI)'
2025-02-02 23:31:57.638 +03:00 [INF] Request finished HTTP/1.1 POST http://07ca-46-152-255-232.ngrok-free.app/api/proxy/forward?url=https://icreditdept.com/api/testasp/test_local_generate_otp.php - 200 200 application/json 1047.4363ms
2025-02-02 23:32:41.017 +03:00 [INF] Request starting HTTP/1.1 POST http://07ca-46-152-255-232.ngrok-free.app/api/proxy/forward?url=https://icreditdept.com/api/testasp/test_local_generate_otp.php - application/json; charset=utf-8 84
2025-02-02 23:32:41.021 +03:00 [INF] Executing endpoint 'NayifatAPI.Controllers.ProxyController.ForwardRequest (NayifatAPI)'
2025-02-02 23:32:41.024 +03:00 [INF] Route matched with {action = "ForwardRequest", controller = "Proxy"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] ForwardRequest() on controller NayifatAPI.Controllers.ProxyController (NayifatAPI).
2025-02-02 23:32:41.029 +03:00 [INF] Start processing HTTP request POST https://icreditdept.com/api/testasp/test_local_generate_otp.php
2025-02-02 23:32:41.031 +03:00 [INF] Sending HTTP request POST https://icreditdept.com/api/testasp/test_local_generate_otp.php
2025-02-02 23:32:41.486 +03:00 [INF] Received HTTP response headers after 452.5569ms - 200
2025-02-02 23:32:41.490 +03:00 [INF] End processing HTTP request after 461.1977ms - 200
2025-02-02 23:32:41.495 +03:00 [INF] Raw response length: 200
2025-02-02 23:32:41.497 +03:00 [INF] Response content: {"success":true,"errors":[],"result":{"nationalId":"1064448614","otp":554460,"expiryDate":"2025-02-02 23:37:41","successMsg":"Success","errCode":0,"errMsg":null},"type":"N","message":null,"code":null}
2025-02-02 23:32:41.500 +03:00 [INF] Executing ContentResult with HTTP Response ContentType of application/json
2025-02-02 23:32:41.501 +03:00 [INF] Executed action NayifatAPI.Controllers.ProxyController.ForwardRequest (NayifatAPI) in 472.795ms
2025-02-02 23:32:41.505 +03:00 [INF] Executed endpoint 'NayifatAPI.Controllers.ProxyController.ForwardRequest (NayifatAPI)'
2025-02-02 23:32:41.509 +03:00 [INF] Request finished HTTP/1.1 POST http://07ca-46-152-255-232.ngrok-free.app/api/proxy/forward?url=https://icreditdept.com/api/testasp/test_local_generate_otp.php - 200 200 application/json 491.6546ms
2025-02-02 23:32:50.866 +03:00 [INF] Request starting HTTP/1.1 POST http://07ca-46-152-255-232.ngrok-free.app/api/proxy/forward?url=https://icreditdept.com/api/testasp/test_local_verify_otp.php - application/json; charset=utf-8 53
2025-02-02 23:32:50.872 +03:00 [INF] Executing endpoint 'NayifatAPI.Controllers.ProxyController.ForwardRequest (NayifatAPI)'
2025-02-02 23:32:50.875 +03:00 [INF] Route matched with {action = "ForwardRequest", controller = "Proxy"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] ForwardRequest() on controller NayifatAPI.Controllers.ProxyController (NayifatAPI).
2025-02-02 23:32:50.880 +03:00 [INF] Start processing HTTP request POST https://icreditdept.com/api/testasp/test_local_verify_otp.php
2025-02-02 23:32:50.882 +03:00 [INF] Sending HTTP request POST https://icreditdept.com/api/testasp/test_local_verify_otp.php
2025-02-02 23:32:51.321 +03:00 [INF] Received HTTP response headers after 436.5805ms - 200
2025-02-02 23:32:51.326 +03:00 [INF] End processing HTTP request after 445.8183ms - 200
2025-02-02 23:32:51.328 +03:00 [INF] Raw response length: 202
2025-02-02 23:32:51.330 +03:00 [INF] Response content: {"success":true,"errors":[],"result":{"nationalId":"1064448614","otp":"554460","verifiedFlag":true,"successMsg":"Verified successfully.","errCode":0,"errMsg":null},"type":"N","message":null,"code":null}
2025-02-02 23:32:51.340 +03:00 [INF] Executing ContentResult with HTTP Response ContentType of application/json
2025-02-02 23:32:51.344 +03:00 [INF] Executed action NayifatAPI.Controllers.ProxyController.ForwardRequest (NayifatAPI) in 463.5885ms
2025-02-02 23:32:51.347 +03:00 [INF] Executed endpoint 'NayifatAPI.Controllers.ProxyController.ForwardRequest (NayifatAPI)'
2025-02-02 23:32:51.348 +03:00 [INF] Request finished HTTP/1.1 POST http://07ca-46-152-255-232.ngrok-free.app/api/proxy/forward?url=https://icreditdept.com/api/testasp/test_local_verify_otp.php - 200 202 application/json 482.2866ms
2025-02-02 23:32:59.737 +03:00 [INF] Request starting HTTP/1.1 POST http://07ca-46-152-255-232.ngrok-free.app/api/notifications/list - application/json; charset=utf-8 47
2025-02-02 23:32:59.748 +03:00 [INF] Executing endpoint 'NayifatAPI.Controllers.NotificationsController.GetNotifications (NayifatAPI)'
2025-02-02 23:32:59.751 +03:00 [INF] Route matched with {action = "GetNotifications", controller = "Notifications"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetNotifications(NayifatAPI.Controllers.GetNotificationsRequest) on controller NayifatAPI.Controllers.NotificationsController (NayifatAPI).
2025-02-02 23:32:59.765 +03:00 [INF] Executed DbCommand (7ms) [Parameters=[@__providedApiKey_0='?' (Size = 255)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [a].[Key], [a].[CreatedAt], [a].[Description], [a].[ExpiresAt], [a].[IsActive], [a].[LastUsedAt]
FROM [ApiKeys] AS [a]
WHERE [a].[Key] = @__providedApiKey_0 AND [a].[IsActive] = CAST(1 AS bit)
2025-02-02 23:32:59.774 +03:00 [INF] Executed DbCommand (3ms) [Parameters=[@__request_NationalId_0='?' (Size = 450)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [u].[national_id], [u].[last_updated], [u].[notifications]
FROM [user_notifications] AS [u]
WHERE [u].[national_id] = @__request_NationalId_0
2025-02-02 23:32:59.781 +03:00 [INF] Executed DbCommand (3ms) [Parameters=[@__Parse_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [n].[Id], [n].[additional_data], [n].[Body], [n].[body_ar], [n].[body_en], [n].[created_at], [n].[expiry_at], [n].[Route], [n].[target_criteria], [n].[Title], [n].[title_ar], [n].[title_en]
FROM [notification_templates] AS [n]
WHERE [n].[Id] = @__Parse_0
2025-02-02 23:32:59.788 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@__Parse_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [n].[Id], [n].[additional_data], [n].[Body], [n].[body_ar], [n].[body_en], [n].[created_at], [n].[expiry_at], [n].[Route], [n].[target_criteria], [n].[Title], [n].[title_ar], [n].[title_en]
FROM [notification_templates] AS [n]
WHERE [n].[Id] = @__Parse_0
2025-02-02 23:32:59.874 +03:00 [INF] Executed DbCommand (79ms) [Parameters=[@p0='?' (Size = 4000), @p1='?' (DbType = DateTime2), @p2='?' (Size = 4000), @p3='?' (Size = 4000), @p4='?' (Size = 4000), @p5='?' (Size = 450), @p6='?' (Size = 4000), @p7='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SET IMPLICIT_TRANSACTIONS OFF;
SET NOCOUNT ON;
INSERT INTO [AuthLogs] ([AuthType], [CreatedAt], [DeviceId], [FailureReason], [IpAddress], [NationalId], [Status], [UserAgent])
OUTPUT INSERTED.[Id]
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7);
2025-02-02 23:32:59.879 +03:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType9`2[[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Object, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-02-02 23:32:59.881 +03:00 [INF] Executed action NayifatAPI.Controllers.NotificationsController.GetNotifications (NayifatAPI) in 124.2262ms
2025-02-02 23:32:59.884 +03:00 [INF] Executed endpoint 'NayifatAPI.Controllers.NotificationsController.GetNotifications (NayifatAPI)'
2025-02-02 23:32:59.888 +03:00 [INF] Request finished HTTP/1.1 POST http://07ca-46-152-255-232.ngrok-free.app/api/notifications/list - 200 null application/json; charset=utf-8 151.0233ms
2025-02-02 23:35:35.502 +03:00 [INF] Request starting HTTP/1.1 POST http://07ca-46-152-255-232.ngrok-free.app/api/auth/signin - application/json; charset=utf-8 69
2025-02-02 23:35:35.505 +03:00 [INF] Executing endpoint 'NayifatAPI.Controllers.AuthController.SignIn (NayifatAPI)'
2025-02-02 23:35:35.506 +03:00 [INF] Route matched with {action = "SignIn", controller = "Auth"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] SignIn(NayifatAPI.Controllers.SignInRequest) on controller NayifatAPI.Controllers.AuthController (NayifatAPI).
2025-02-02 23:35:35.510 +03:00 [INF] Executed DbCommand (2ms) [Parameters=[@__providedApiKey_0='?' (Size = 255)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [a].[Key], [a].[CreatedAt], [a].[Description], [a].[ExpiresAt], [a].[IsActive], [a].[LastUsedAt]
FROM [ApiKeys] AS [a]
WHERE [a].[Key] = @__providedApiKey_0 AND [a].[IsActive] = CAST(1 AS bit)
2025-02-02 23:35:35.517 +03:00 [INF] Executed DbCommand (4ms) [Parameters=[@__request_NationalId_0='?' (Size = 450)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [c].[NationalId], [c].[AddNo], [c].[BuildingNo], [c].[City], [c].[Consent], [c].[ConsentDate], [c].[DateOfBirth], [c].[Dependents], [c].[District], [c].[Email], [c].[Employer], [c].[FamilyNameAr], [c].[FamilyNameEn], [c].[FirstNameAr], [c].[FirstNameEn], [c].[Iban], [c].[IdExpiryDate], [c].[Los], [c].[Mpin], [c].[MpinEnabled], [c].[NafathStatus], [c].[NafathTimestamp], [c].[Password], [c].[Phone], [c].[RegistrationDate], [c].[SalaryCustomer], [c].[SalaryDakhli], [c].[SecondNameAr], [c].[SecondNameEn], [c].[Sector], [c].[Street], [c].[ThirdNameAr], [c].[ThirdNameEn], [c].[Zipcode]
FROM [Customers] AS [c]
WHERE [c].[NationalId] = @__request_NationalId_0
2025-02-02 23:35:35.606 +03:00 [INF] Executed DbCommand (85ms) [Parameters=[@p0='?' (Size = 4000), @p1='?' (DbType = DateTime2), @p2='?' (Size = 4000), @p3='?' (Size = 4000), @p4='?' (Size = 4000), @p5='?' (Size = 450), @p6='?' (Size = 4000), @p7='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SET IMPLICIT_TRANSACTIONS OFF;
SET NOCOUNT ON;
INSERT INTO [AuthLogs] ([AuthType], [CreatedAt], [DeviceId], [FailureReason], [IpAddress], [NationalId], [Status], [UserAgent])
OUTPUT INSERTED.[Id]
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7);
2025-02-02 23:35:35.611 +03:00 [ERR] An exception occurred in the database while saving changes for context type 'NayifatAPI.Data.ApplicationDbContext'.
Microsoft.EntityFrameworkCore.DbUpdateException: An error occurred while saving the entity changes. See the inner exception for details.
 ---> Microsoft.Data.SqlClient.SqlException (0x80131904): The INSERT statement conflicted with the FOREIGN KEY constraint "FK_AuthLogs_Customers_NationalId". The conflict occurred in database "NayifatApp", table "dbo.Customers", column 'NationalId'.
   at Microsoft.Data.SqlClient.SqlConnection.OnError(SqlException exception, Boolean breakConnection, Action`1 wrapCloseInAction)
   at Microsoft.Data.SqlClient.SqlInternalConnection.OnError(SqlException exception, Boolean breakConnection, Action`1 wrapCloseInAction)
   at Microsoft.Data.SqlClient.TdsParser.ThrowExceptionAndWarning(TdsParserStateObject stateObj, Boolean callerHasConnectionLock, Boolean asyncClose)
   at Microsoft.Data.SqlClient.TdsParser.TryRun(RunBehavior runBehavior, SqlCommand cmdHandler, SqlDataReader dataStream, BulkCopySimpleResultSet bulkCopyHandler, TdsParserStateObject stateObj, Boolean& dataReady)
   at Microsoft.Data.SqlClient.SqlDataReader.TryHasMoreRows(Boolean& moreRows)
   at Microsoft.Data.SqlClient.SqlDataReader.TryReadInternal(Boolean setTimeout, Boolean& more)
   at Microsoft.Data.SqlClient.SqlDataReader.ReadAsyncExecute(Task task, Object state)
   at Microsoft.Data.SqlClient.SqlDataReader.InvokeAsyncCall[T](SqlDataReaderBaseAsyncCallContext`1 context)
--- End of stack trace from previous location ---
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeResultSetAsync(Int32 startCommandIndex, RelationalDataReader reader, CancellationToken cancellationToken)
ClientConnectionId:20e2460a-ecb1-48bb-bb7f-cd9effff34c3
Error Number:547,State:0,Class:16
   --- End of inner exception stack trace ---
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeResultSetAsync(Int32 startCommandIndex, RelationalDataReader reader, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeAsync(RelationalDataReader reader, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Update.Internal.SqlServerModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(IList`1 entriesToSave, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(StateManager stateManager, Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Storage.Internal.SqlServerExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
Microsoft.EntityFrameworkCore.DbUpdateException: An error occurred while saving the entity changes. See the inner exception for details.
 ---> Microsoft.Data.SqlClient.SqlException (0x80131904): The INSERT statement conflicted with the FOREIGN KEY constraint "FK_AuthLogs_Customers_NationalId". The conflict occurred in database "NayifatApp", table "dbo.Customers", column 'NationalId'.
   at Microsoft.Data.SqlClient.SqlConnection.OnError(SqlException exception, Boolean breakConnection, Action`1 wrapCloseInAction)
   at Microsoft.Data.SqlClient.SqlInternalConnection.OnError(SqlException exception, Boolean breakConnection, Action`1 wrapCloseInAction)
   at Microsoft.Data.SqlClient.TdsParser.ThrowExceptionAndWarning(TdsParserStateObject stateObj, Boolean callerHasConnectionLock, Boolean asyncClose)
   at Microsoft.Data.SqlClient.TdsParser.TryRun(RunBehavior runBehavior, SqlCommand cmdHandler, SqlDataReader dataStream, BulkCopySimpleResultSet bulkCopyHandler, TdsParserStateObject stateObj, Boolean& dataReady)
   at Microsoft.Data.SqlClient.SqlDataReader.TryHasMoreRows(Boolean& moreRows)
   at Microsoft.Data.SqlClient.SqlDataReader.TryReadInternal(Boolean setTimeout, Boolean& more)
   at Microsoft.Data.SqlClient.SqlDataReader.ReadAsyncExecute(Task task, Object state)
   at Microsoft.Data.SqlClient.SqlDataReader.InvokeAsyncCall[T](SqlDataReaderBaseAsyncCallContext`1 context)
--- End of stack trace from previous location ---
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeResultSetAsync(Int32 startCommandIndex, RelationalDataReader reader, CancellationToken cancellationToken)
ClientConnectionId:20e2460a-ecb1-48bb-bb7f-cd9effff34c3
Error Number:547,State:0,Class:16
   --- End of inner exception stack trace ---
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeResultSetAsync(Int32 startCommandIndex, RelationalDataReader reader, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeAsync(RelationalDataReader reader, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Update.Internal.SqlServerModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(IList`1 entriesToSave, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(StateManager stateManager, Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Storage.Internal.SqlServerExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
2025-02-02 23:35:35.624 +03:00 [ERR] Error during sign in for National ID: 11111
Microsoft.EntityFrameworkCore.DbUpdateException: An error occurred while saving the entity changes. See the inner exception for details.
 ---> Microsoft.Data.SqlClient.SqlException (0x80131904): The INSERT statement conflicted with the FOREIGN KEY constraint "FK_AuthLogs_Customers_NationalId". The conflict occurred in database "NayifatApp", table "dbo.Customers", column 'NationalId'.
   at Microsoft.Data.SqlClient.SqlConnection.OnError(SqlException exception, Boolean breakConnection, Action`1 wrapCloseInAction)
   at Microsoft.Data.SqlClient.SqlInternalConnection.OnError(SqlException exception, Boolean breakConnection, Action`1 wrapCloseInAction)
   at Microsoft.Data.SqlClient.TdsParser.ThrowExceptionAndWarning(TdsParserStateObject stateObj, Boolean callerHasConnectionLock, Boolean asyncClose)
   at Microsoft.Data.SqlClient.TdsParser.TryRun(RunBehavior runBehavior, SqlCommand cmdHandler, SqlDataReader dataStream, BulkCopySimpleResultSet bulkCopyHandler, TdsParserStateObject stateObj, Boolean& dataReady)
   at Microsoft.Data.SqlClient.SqlDataReader.TryHasMoreRows(Boolean& moreRows)
   at Microsoft.Data.SqlClient.SqlDataReader.TryReadInternal(Boolean setTimeout, Boolean& more)
   at Microsoft.Data.SqlClient.SqlDataReader.ReadAsyncExecute(Task task, Object state)
   at Microsoft.Data.SqlClient.SqlDataReader.InvokeAsyncCall[T](SqlDataReaderBaseAsyncCallContext`1 context)
--- End of stack trace from previous location ---
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeResultSetAsync(Int32 startCommandIndex, RelationalDataReader reader, CancellationToken cancellationToken)
ClientConnectionId:20e2460a-ecb1-48bb-bb7f-cd9effff34c3
Error Number:547,State:0,Class:16
   --- End of inner exception stack trace ---
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeResultSetAsync(Int32 startCommandIndex, RelationalDataReader reader, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeAsync(RelationalDataReader reader, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Update.Internal.SqlServerModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(IList`1 entriesToSave, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(StateManager stateManager, Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Storage.Internal.SqlServerExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at NayifatAPI.Controllers.AuthController.LogAuthAttempt(String nationalId, String deviceId, String status, String failureReason) in C:\Users\yamta\StudioProjects\nayifat_app_2025_new\nayifatapi\Controllers\AuthController.cs:line 367
   at NayifatAPI.Controllers.AuthController.SignIn(SignInRequest request) in C:\Users\yamta\StudioProjects\nayifat_app_2025_new\nayifatapi\Controllers\AuthController.cs:line 41
2025-02-02 23:35:35.645 +03:00 [INF] Executed DbCommand (9ms) [Parameters=[@p0='?' (Size = 4000), @p1='?' (DbType = DateTime2), @p2='?' (Size = 4000), @p3='?' (Size = 4000), @p4='?' (Size = 4000), @p5='?' (Size = 450), @p6='?' (Size = 4000), @p7='?' (Size = 4000), @p8='?' (Size = 4000), @p9='?' (DbType = DateTime2), @p10='?' (Size = 4000), @p11='?' (Size = 4000), @p12='?' (Size = 4000), @p13='?' (Size = 450), @p14='?' (Size = 4000), @p15='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SET IMPLICIT_TRANSACTIONS OFF;
SET NOCOUNT ON;
MERGE [AuthLogs] USING (
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7, 0),
(@p8, @p9, @p10, @p11, @p12, @p13, @p14, @p15, 1)) AS i ([AuthType], [CreatedAt], [DeviceId], [FailureReason], [IpAddress], [NationalId], [Status], [UserAgent], _Position) ON 1=0
WHEN NOT MATCHED THEN
INSERT ([AuthType], [CreatedAt], [DeviceId], [FailureReason], [IpAddress], [NationalId], [Status], [UserAgent])
VALUES (i.[AuthType], i.[CreatedAt], i.[DeviceId], i.[FailureReason], i.[IpAddress], i.[NationalId], i.[Status], i.[UserAgent])
OUTPUT INSERTED.[Id], i._Position;
2025-02-02 23:35:35.649 +03:00 [ERR] An exception occurred in the database while saving changes for context type 'NayifatAPI.Data.ApplicationDbContext'.
Microsoft.EntityFrameworkCore.DbUpdateException: An error occurred while saving the entity changes. See the inner exception for details.
 ---> Microsoft.Data.SqlClient.SqlException (0x80131904): The MERGE statement conflicted with the FOREIGN KEY constraint "FK_AuthLogs_Customers_NationalId". The conflict occurred in database "NayifatApp", table "dbo.Customers", column 'NationalId'.
   at Microsoft.Data.SqlClient.SqlConnection.OnError(SqlException exception, Boolean breakConnection, Action`1 wrapCloseInAction)
   at Microsoft.Data.SqlClient.SqlInternalConnection.OnError(SqlException exception, Boolean breakConnection, Action`1 wrapCloseInAction)
   at Microsoft.Data.SqlClient.TdsParser.ThrowExceptionAndWarning(TdsParserStateObject stateObj, Boolean callerHasConnectionLock, Boolean asyncClose)
   at Microsoft.Data.SqlClient.TdsParser.TryRun(RunBehavior runBehavior, SqlCommand cmdHandler, SqlDataReader dataStream, BulkCopySimpleResultSet bulkCopyHandler, TdsParserStateObject stateObj, Boolean& dataReady)
   at Microsoft.Data.SqlClient.SqlDataReader.TryHasMoreRows(Boolean& moreRows)
   at Microsoft.Data.SqlClient.SqlDataReader.TryReadInternal(Boolean setTimeout, Boolean& more)
   at Microsoft.Data.SqlClient.SqlDataReader.ReadAsyncExecute(Task task, Object state)
   at Microsoft.Data.SqlClient.SqlDataReader.InvokeAsyncCall[T](SqlDataReaderBaseAsyncCallContext`1 context)
--- End of stack trace from previous location ---
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeResultSetAsync(Int32 startCommandIndex, RelationalDataReader reader, CancellationToken cancellationToken)
ClientConnectionId:20e2460a-ecb1-48bb-bb7f-cd9effff34c3
Error Number:547,State:0,Class:16
   --- End of inner exception stack trace ---
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeResultSetAsync(Int32 startCommandIndex, RelationalDataReader reader, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeAsync(RelationalDataReader reader, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Update.Internal.SqlServerModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(IList`1 entriesToSave, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(StateManager stateManager, Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Storage.Internal.SqlServerExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
Microsoft.EntityFrameworkCore.DbUpdateException: An error occurred while saving the entity changes. See the inner exception for details.
 ---> Microsoft.Data.SqlClient.SqlException (0x80131904): The MERGE statement conflicted with the FOREIGN KEY constraint "FK_AuthLogs_Customers_NationalId". The conflict occurred in database "NayifatApp", table "dbo.Customers", column 'NationalId'.
   at Microsoft.Data.SqlClient.SqlConnection.OnError(SqlException exception, Boolean breakConnection, Action`1 wrapCloseInAction)
   at Microsoft.Data.SqlClient.SqlInternalConnection.OnError(SqlException exception, Boolean breakConnection, Action`1 wrapCloseInAction)
   at Microsoft.Data.SqlClient.TdsParser.ThrowExceptionAndWarning(TdsParserStateObject stateObj, Boolean callerHasConnectionLock, Boolean asyncClose)
   at Microsoft.Data.SqlClient.TdsParser.TryRun(RunBehavior runBehavior, SqlCommand cmdHandler, SqlDataReader dataStream, BulkCopySimpleResultSet bulkCopyHandler, TdsParserStateObject stateObj, Boolean& dataReady)
   at Microsoft.Data.SqlClient.SqlDataReader.TryHasMoreRows(Boolean& moreRows)
   at Microsoft.Data.SqlClient.SqlDataReader.TryReadInternal(Boolean setTimeout, Boolean& more)
   at Microsoft.Data.SqlClient.SqlDataReader.ReadAsyncExecute(Task task, Object state)
   at Microsoft.Data.SqlClient.SqlDataReader.InvokeAsyncCall[T](SqlDataReaderBaseAsyncCallContext`1 context)
--- End of stack trace from previous location ---
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeResultSetAsync(Int32 startCommandIndex, RelationalDataReader reader, CancellationToken cancellationToken)
ClientConnectionId:20e2460a-ecb1-48bb-bb7f-cd9effff34c3
Error Number:547,State:0,Class:16
   --- End of inner exception stack trace ---
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeResultSetAsync(Int32 startCommandIndex, RelationalDataReader reader, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeAsync(RelationalDataReader reader, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Update.Internal.SqlServerModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(IList`1 entriesToSave, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(StateManager stateManager, Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Storage.Internal.SqlServerExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
2025-02-02 23:35:35.669 +03:00 [INF] Executed action NayifatAPI.Controllers.AuthController.SignIn (NayifatAPI) in 161.0695ms
2025-02-02 23:35:35.670 +03:00 [INF] Executed endpoint 'NayifatAPI.Controllers.AuthController.SignIn (NayifatAPI)'
2025-02-02 23:35:35.671 +03:00 [ERR] Unhandled exception
Microsoft.EntityFrameworkCore.DbUpdateException: An error occurred while saving the entity changes. See the inner exception for details.
 ---> Microsoft.Data.SqlClient.SqlException (0x80131904): The MERGE statement conflicted with the FOREIGN KEY constraint "FK_AuthLogs_Customers_NationalId". The conflict occurred in database "NayifatApp", table "dbo.Customers", column 'NationalId'.
   at Microsoft.Data.SqlClient.SqlConnection.OnError(SqlException exception, Boolean breakConnection, Action`1 wrapCloseInAction)
   at Microsoft.Data.SqlClient.SqlInternalConnection.OnError(SqlException exception, Boolean breakConnection, Action`1 wrapCloseInAction)
   at Microsoft.Data.SqlClient.TdsParser.ThrowExceptionAndWarning(TdsParserStateObject stateObj, Boolean callerHasConnectionLock, Boolean asyncClose)
   at Microsoft.Data.SqlClient.TdsParser.TryRun(RunBehavior runBehavior, SqlCommand cmdHandler, SqlDataReader dataStream, BulkCopySimpleResultSet bulkCopyHandler, TdsParserStateObject stateObj, Boolean& dataReady)
   at Microsoft.Data.SqlClient.SqlDataReader.TryHasMoreRows(Boolean& moreRows)
   at Microsoft.Data.SqlClient.SqlDataReader.TryReadInternal(Boolean setTimeout, Boolean& more)
   at Microsoft.Data.SqlClient.SqlDataReader.ReadAsyncExecute(Task task, Object state)
   at Microsoft.Data.SqlClient.SqlDataReader.InvokeAsyncCall[T](SqlDataReaderBaseAsyncCallContext`1 context)
--- End of stack trace from previous location ---
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeResultSetAsync(Int32 startCommandIndex, RelationalDataReader reader, CancellationToken cancellationToken)
ClientConnectionId:20e2460a-ecb1-48bb-bb7f-cd9effff34c3
Error Number:547,State:0,Class:16
   --- End of inner exception stack trace ---
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeResultSetAsync(Int32 startCommandIndex, RelationalDataReader reader, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeAsync(RelationalDataReader reader, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Update.Internal.SqlServerModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(IList`1 entriesToSave, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(StateManager stateManager, Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Storage.Internal.SqlServerExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at NayifatAPI.Controllers.AuthController.LogAuthAttempt(String nationalId, String deviceId, String status, String failureReason) in C:\Users\yamta\StudioProjects\nayifat_app_2025_new\nayifatapi\Controllers\AuthController.cs:line 367
   at NayifatAPI.Controllers.AuthController.SignIn(SignInRequest request) in C:\Users\yamta\StudioProjects\nayifat_app_2025_new\nayifatapi\Controllers\AuthController.cs:line 103
   at Microsoft.AspNetCore.Mvc.Infrastructure.ActionMethodExecutor.TaskOfIActionResultExecutor.Execute(ActionContext actionContext, IActionResultTypeMapper mapper, ObjectMethodExecutor executor, Object controller, Object[] arguments)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.<InvokeActionMethodAsync>g__Awaited|12_0(ControllerActionInvoker invoker, ValueTask`1 actionResultValueTask)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.<InvokeNextActionFilterAsync>g__Awaited|10_0(ControllerActionInvoker invoker, Task lastTask, State next, Scope scope, Object state, Boolean isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.Rethrow(ActionExecutedContextSealed context)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.Next(State& next, Scope& scope, Object& state, Boolean& isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.<InvokeInnerFilterAsync>g__Awaited|13_0(ControllerActionInvoker invoker, Task lastTask, State next, Scope scope, Object state, Boolean isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeFilterPipelineAsync>g__Awaited|20_0(ResourceInvoker invoker, Task lastTask, State next, Scope scope, Object state, Boolean isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeAsync>g__Logged|17_1(ResourceInvoker invoker)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeAsync>g__Logged|17_1(ResourceInvoker invoker)
   at Microsoft.AspNetCore.Routing.EndpointMiddleware.<Invoke>g__AwaitRequestTask|7_0(Endpoint endpoint, Task requestTask, ILogger logger)
   at Microsoft.AspNetCore.Authorization.AuthorizationMiddleware.Invoke(HttpContext context)
   at Program.<>c.<<<Main>$>b__0_3>d.MoveNext() in C:\Users\yamta\StudioProjects\nayifat_app_2025_new\nayifatapi\Program.cs:line 85
2025-02-02 23:35:35.689 +03:00 [ERR] An unhandled exception has occurred while executing the request.
Microsoft.EntityFrameworkCore.DbUpdateException: An error occurred while saving the entity changes. See the inner exception for details.
 ---> Microsoft.Data.SqlClient.SqlException (0x80131904): The MERGE statement conflicted with the FOREIGN KEY constraint "FK_AuthLogs_Customers_NationalId". The conflict occurred in database "NayifatApp", table "dbo.Customers", column 'NationalId'.
   at Microsoft.Data.SqlClient.SqlConnection.OnError(SqlException exception, Boolean breakConnection, Action`1 wrapCloseInAction)
   at Microsoft.Data.SqlClient.SqlInternalConnection.OnError(SqlException exception, Boolean breakConnection, Action`1 wrapCloseInAction)
   at Microsoft.Data.SqlClient.TdsParser.ThrowExceptionAndWarning(TdsParserStateObject stateObj, Boolean callerHasConnectionLock, Boolean asyncClose)
   at Microsoft.Data.SqlClient.TdsParser.TryRun(RunBehavior runBehavior, SqlCommand cmdHandler, SqlDataReader dataStream, BulkCopySimpleResultSet bulkCopyHandler, TdsParserStateObject stateObj, Boolean& dataReady)
   at Microsoft.Data.SqlClient.SqlDataReader.TryHasMoreRows(Boolean& moreRows)
   at Microsoft.Data.SqlClient.SqlDataReader.TryReadInternal(Boolean setTimeout, Boolean& more)
   at Microsoft.Data.SqlClient.SqlDataReader.ReadAsyncExecute(Task task, Object state)
   at Microsoft.Data.SqlClient.SqlDataReader.InvokeAsyncCall[T](SqlDataReaderBaseAsyncCallContext`1 context)
--- End of stack trace from previous location ---
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeResultSetAsync(Int32 startCommandIndex, RelationalDataReader reader, CancellationToken cancellationToken)
ClientConnectionId:20e2460a-ecb1-48bb-bb7f-cd9effff34c3
Error Number:547,State:0,Class:16
   --- End of inner exception stack trace ---
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeResultSetAsync(Int32 startCommandIndex, RelationalDataReader reader, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeAsync(RelationalDataReader reader, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Update.Internal.SqlServerModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(IList`1 entriesToSave, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(StateManager stateManager, Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Storage.Internal.SqlServerExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at NayifatAPI.Controllers.AuthController.LogAuthAttempt(String nationalId, String deviceId, String status, String failureReason) in C:\Users\yamta\StudioProjects\nayifat_app_2025_new\nayifatapi\Controllers\AuthController.cs:line 367
   at NayifatAPI.Controllers.AuthController.SignIn(SignInRequest request) in C:\Users\yamta\StudioProjects\nayifat_app_2025_new\nayifatapi\Controllers\AuthController.cs:line 103
   at Microsoft.AspNetCore.Mvc.Infrastructure.ActionMethodExecutor.TaskOfIActionResultExecutor.Execute(ActionContext actionContext, IActionResultTypeMapper mapper, ObjectMethodExecutor executor, Object controller, Object[] arguments)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.<InvokeActionMethodAsync>g__Awaited|12_0(ControllerActionInvoker invoker, ValueTask`1 actionResultValueTask)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.<InvokeNextActionFilterAsync>g__Awaited|10_0(ControllerActionInvoker invoker, Task lastTask, State next, Scope scope, Object state, Boolean isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.Rethrow(ActionExecutedContextSealed context)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.Next(State& next, Scope& scope, Object& state, Boolean& isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.<InvokeInnerFilterAsync>g__Awaited|13_0(ControllerActionInvoker invoker, Task lastTask, State next, Scope scope, Object state, Boolean isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeFilterPipelineAsync>g__Awaited|20_0(ResourceInvoker invoker, Task lastTask, State next, Scope scope, Object state, Boolean isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeAsync>g__Logged|17_1(ResourceInvoker invoker)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeAsync>g__Logged|17_1(ResourceInvoker invoker)
   at Microsoft.AspNetCore.Routing.EndpointMiddleware.<Invoke>g__AwaitRequestTask|7_0(Endpoint endpoint, Task requestTask, ILogger logger)
   at Microsoft.AspNetCore.Authorization.AuthorizationMiddleware.Invoke(HttpContext context)
   at Program.<>c.<<<Main>$>b__0_3>d.MoveNext() in C:\Users\yamta\StudioProjects\nayifat_app_2025_new\nayifatapi\Program.cs:line 85
--- End of stack trace from previous location ---
   at Swashbuckle.AspNetCore.SwaggerUI.SwaggerUIMiddleware.Invoke(HttpContext httpContext)
   at Swashbuckle.AspNetCore.Swagger.SwaggerMiddleware.Invoke(HttpContext httpContext, ISwaggerProvider swaggerProvider)
   at Microsoft.AspNetCore.Authentication.AuthenticationMiddleware.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Diagnostics.DeveloperExceptionPageMiddlewareImpl.Invoke(HttpContext context)
2025-02-02 23:35:35.709 +03:00 [INF] Request finished HTTP/1.1 POST http://07ca-46-152-255-232.ngrok-free.app/api/auth/signin - 500 null text/plain; charset=utf-8 206.7167ms
2025-02-02 23:35:40.108 +03:00 [INF] Request starting HTTP/1.1 POST http://07ca-46-152-255-232.ngrok-free.app/api/auth/signin - application/json; charset=utf-8 70
2025-02-02 23:35:40.112 +03:00 [INF] Executing endpoint 'NayifatAPI.Controllers.AuthController.SignIn (NayifatAPI)'
2025-02-02 23:35:40.114 +03:00 [INF] Route matched with {action = "SignIn", controller = "Auth"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] SignIn(NayifatAPI.Controllers.SignInRequest) on controller NayifatAPI.Controllers.AuthController (NayifatAPI).
2025-02-02 23:35:40.116 +03:00 [INF] Executed DbCommand (0ms) [Parameters=[@__providedApiKey_0='?' (Size = 255)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [a].[Key], [a].[CreatedAt], [a].[Description], [a].[ExpiresAt], [a].[IsActive], [a].[LastUsedAt]
FROM [ApiKeys] AS [a]
WHERE [a].[Key] = @__providedApiKey_0 AND [a].[IsActive] = CAST(1 AS bit)
2025-02-02 23:35:40.118 +03:00 [INF] Executed DbCommand (0ms) [Parameters=[@__request_NationalId_0='?' (Size = 450)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [c].[NationalId], [c].[AddNo], [c].[BuildingNo], [c].[City], [c].[Consent], [c].[ConsentDate], [c].[DateOfBirth], [c].[Dependents], [c].[District], [c].[Email], [c].[Employer], [c].[FamilyNameAr], [c].[FamilyNameEn], [c].[FirstNameAr], [c].[FirstNameEn], [c].[Iban], [c].[IdExpiryDate], [c].[Los], [c].[Mpin], [c].[MpinEnabled], [c].[NafathStatus], [c].[NafathTimestamp], [c].[Password], [c].[Phone], [c].[RegistrationDate], [c].[SalaryCustomer], [c].[SalaryDakhli], [c].[SecondNameAr], [c].[SecondNameEn], [c].[Sector], [c].[Street], [c].[ThirdNameAr], [c].[ThirdNameEn], [c].[Zipcode]
FROM [Customers] AS [c]
WHERE [c].[NationalId] = @__request_NationalId_0
2025-02-02 23:35:40.121 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@p0='?' (Size = 4000), @p1='?' (DbType = DateTime2), @p2='?' (Size = 4000), @p3='?' (Size = 4000), @p4='?' (Size = 4000), @p5='?' (Size = 450), @p6='?' (Size = 4000), @p7='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SET IMPLICIT_TRANSACTIONS OFF;
SET NOCOUNT ON;
INSERT INTO [AuthLogs] ([AuthType], [CreatedAt], [DeviceId], [FailureReason], [IpAddress], [NationalId], [Status], [UserAgent])
OUTPUT INSERTED.[Id]
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7);
2025-02-02 23:35:40.123 +03:00 [ERR] An exception occurred in the database while saving changes for context type 'NayifatAPI.Data.ApplicationDbContext'.
Microsoft.EntityFrameworkCore.DbUpdateException: An error occurred while saving the entity changes. See the inner exception for details.
 ---> Microsoft.Data.SqlClient.SqlException (0x80131904): The INSERT statement conflicted with the FOREIGN KEY constraint "FK_AuthLogs_Customers_NationalId". The conflict occurred in database "NayifatApp", table "dbo.Customers", column 'NationalId'.
   at Microsoft.Data.SqlClient.SqlConnection.OnError(SqlException exception, Boolean breakConnection, Action`1 wrapCloseInAction)
   at Microsoft.Data.SqlClient.SqlInternalConnection.OnError(SqlException exception, Boolean breakConnection, Action`1 wrapCloseInAction)
   at Microsoft.Data.SqlClient.TdsParser.ThrowExceptionAndWarning(TdsParserStateObject stateObj, Boolean callerHasConnectionLock, Boolean asyncClose)
   at Microsoft.Data.SqlClient.TdsParser.TryRun(RunBehavior runBehavior, SqlCommand cmdHandler, SqlDataReader dataStream, BulkCopySimpleResultSet bulkCopyHandler, TdsParserStateObject stateObj, Boolean& dataReady)
   at Microsoft.Data.SqlClient.SqlDataReader.TryHasMoreRows(Boolean& moreRows)
   at Microsoft.Data.SqlClient.SqlDataReader.TryReadInternal(Boolean setTimeout, Boolean& more)
   at Microsoft.Data.SqlClient.SqlDataReader.ReadAsyncExecute(Task task, Object state)
   at Microsoft.Data.SqlClient.SqlDataReader.InvokeAsyncCall[T](SqlDataReaderBaseAsyncCallContext`1 context)
--- End of stack trace from previous location ---
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeResultSetAsync(Int32 startCommandIndex, RelationalDataReader reader, CancellationToken cancellationToken)
ClientConnectionId:20e2460a-ecb1-48bb-bb7f-cd9effff34c3
Error Number:547,State:0,Class:16
   --- End of inner exception stack trace ---
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeResultSetAsync(Int32 startCommandIndex, RelationalDataReader reader, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeAsync(RelationalDataReader reader, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Update.Internal.SqlServerModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(IList`1 entriesToSave, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(StateManager stateManager, Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Storage.Internal.SqlServerExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
Microsoft.EntityFrameworkCore.DbUpdateException: An error occurred while saving the entity changes. See the inner exception for details.
 ---> Microsoft.Data.SqlClient.SqlException (0x80131904): The INSERT statement conflicted with the FOREIGN KEY constraint "FK_AuthLogs_Customers_NationalId". The conflict occurred in database "NayifatApp", table "dbo.Customers", column 'NationalId'.
   at Microsoft.Data.SqlClient.SqlConnection.OnError(SqlException exception, Boolean breakConnection, Action`1 wrapCloseInAction)
   at Microsoft.Data.SqlClient.SqlInternalConnection.OnError(SqlException exception, Boolean breakConnection, Action`1 wrapCloseInAction)
   at Microsoft.Data.SqlClient.TdsParser.ThrowExceptionAndWarning(TdsParserStateObject stateObj, Boolean callerHasConnectionLock, Boolean asyncClose)
   at Microsoft.Data.SqlClient.TdsParser.TryRun(RunBehavior runBehavior, SqlCommand cmdHandler, SqlDataReader dataStream, BulkCopySimpleResultSet bulkCopyHandler, TdsParserStateObject stateObj, Boolean& dataReady)
   at Microsoft.Data.SqlClient.SqlDataReader.TryHasMoreRows(Boolean& moreRows)
   at Microsoft.Data.SqlClient.SqlDataReader.TryReadInternal(Boolean setTimeout, Boolean& more)
   at Microsoft.Data.SqlClient.SqlDataReader.ReadAsyncExecute(Task task, Object state)
   at Microsoft.Data.SqlClient.SqlDataReader.InvokeAsyncCall[T](SqlDataReaderBaseAsyncCallContext`1 context)
--- End of stack trace from previous location ---
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeResultSetAsync(Int32 startCommandIndex, RelationalDataReader reader, CancellationToken cancellationToken)
ClientConnectionId:20e2460a-ecb1-48bb-bb7f-cd9effff34c3
Error Number:547,State:0,Class:16
   --- End of inner exception stack trace ---
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeResultSetAsync(Int32 startCommandIndex, RelationalDataReader reader, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeAsync(RelationalDataReader reader, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Update.Internal.SqlServerModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(IList`1 entriesToSave, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(StateManager stateManager, Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Storage.Internal.SqlServerExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
2025-02-02 23:35:40.138 +03:00 [ERR] Error during sign in for National ID: 5555552
Microsoft.EntityFrameworkCore.DbUpdateException: An error occurred while saving the entity changes. See the inner exception for details.
 ---> Microsoft.Data.SqlClient.SqlException (0x80131904): The INSERT statement conflicted with the FOREIGN KEY constraint "FK_AuthLogs_Customers_NationalId". The conflict occurred in database "NayifatApp", table "dbo.Customers", column 'NationalId'.
   at Microsoft.Data.SqlClient.SqlConnection.OnError(SqlException exception, Boolean breakConnection, Action`1 wrapCloseInAction)
   at Microsoft.Data.SqlClient.SqlInternalConnection.OnError(SqlException exception, Boolean breakConnection, Action`1 wrapCloseInAction)
   at Microsoft.Data.SqlClient.TdsParser.ThrowExceptionAndWarning(TdsParserStateObject stateObj, Boolean callerHasConnectionLock, Boolean asyncClose)
   at Microsoft.Data.SqlClient.TdsParser.TryRun(RunBehavior runBehavior, SqlCommand cmdHandler, SqlDataReader dataStream, BulkCopySimpleResultSet bulkCopyHandler, TdsParserStateObject stateObj, Boolean& dataReady)
   at Microsoft.Data.SqlClient.SqlDataReader.TryHasMoreRows(Boolean& moreRows)
   at Microsoft.Data.SqlClient.SqlDataReader.TryReadInternal(Boolean setTimeout, Boolean& more)
   at Microsoft.Data.SqlClient.SqlDataReader.ReadAsyncExecute(Task task, Object state)
   at Microsoft.Data.SqlClient.SqlDataReader.InvokeAsyncCall[T](SqlDataReaderBaseAsyncCallContext`1 context)
--- End of stack trace from previous location ---
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeResultSetAsync(Int32 startCommandIndex, RelationalDataReader reader, CancellationToken cancellationToken)
ClientConnectionId:20e2460a-ecb1-48bb-bb7f-cd9effff34c3
Error Number:547,State:0,Class:16
   --- End of inner exception stack trace ---
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeResultSetAsync(Int32 startCommandIndex, RelationalDataReader reader, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeAsync(RelationalDataReader reader, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Update.Internal.SqlServerModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(IList`1 entriesToSave, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(StateManager stateManager, Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Storage.Internal.SqlServerExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at NayifatAPI.Controllers.AuthController.LogAuthAttempt(String nationalId, String deviceId, String status, String failureReason) in C:\Users\yamta\StudioProjects\nayifat_app_2025_new\nayifatapi\Controllers\AuthController.cs:line 367
   at NayifatAPI.Controllers.AuthController.SignIn(SignInRequest request) in C:\Users\yamta\StudioProjects\nayifat_app_2025_new\nayifatapi\Controllers\AuthController.cs:line 41
2025-02-02 23:35:40.148 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@p0='?' (Size = 4000), @p1='?' (DbType = DateTime2), @p2='?' (Size = 4000), @p3='?' (Size = 4000), @p4='?' (Size = 4000), @p5='?' (Size = 450), @p6='?' (Size = 4000), @p7='?' (Size = 4000), @p8='?' (Size = 4000), @p9='?' (DbType = DateTime2), @p10='?' (Size = 4000), @p11='?' (Size = 4000), @p12='?' (Size = 4000), @p13='?' (Size = 450), @p14='?' (Size = 4000), @p15='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SET IMPLICIT_TRANSACTIONS OFF;
SET NOCOUNT ON;
MERGE [AuthLogs] USING (
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7, 0),
(@p8, @p9, @p10, @p11, @p12, @p13, @p14, @p15, 1)) AS i ([AuthType], [CreatedAt], [DeviceId], [FailureReason], [IpAddress], [NationalId], [Status], [UserAgent], _Position) ON 1=0
WHEN NOT MATCHED THEN
INSERT ([AuthType], [CreatedAt], [DeviceId], [FailureReason], [IpAddress], [NationalId], [Status], [UserAgent])
VALUES (i.[AuthType], i.[CreatedAt], i.[DeviceId], i.[FailureReason], i.[IpAddress], i.[NationalId], i.[Status], i.[UserAgent])
OUTPUT INSERTED.[Id], i._Position;
2025-02-02 23:35:40.152 +03:00 [ERR] An exception occurred in the database while saving changes for context type 'NayifatAPI.Data.ApplicationDbContext'.
Microsoft.EntityFrameworkCore.DbUpdateException: An error occurred while saving the entity changes. See the inner exception for details.
 ---> Microsoft.Data.SqlClient.SqlException (0x80131904): The MERGE statement conflicted with the FOREIGN KEY constraint "FK_AuthLogs_Customers_NationalId". The conflict occurred in database "NayifatApp", table "dbo.Customers", column 'NationalId'.
   at Microsoft.Data.SqlClient.SqlConnection.OnError(SqlException exception, Boolean breakConnection, Action`1 wrapCloseInAction)
   at Microsoft.Data.SqlClient.SqlInternalConnection.OnError(SqlException exception, Boolean breakConnection, Action`1 wrapCloseInAction)
   at Microsoft.Data.SqlClient.TdsParser.ThrowExceptionAndWarning(TdsParserStateObject stateObj, Boolean callerHasConnectionLock, Boolean asyncClose)
   at Microsoft.Data.SqlClient.TdsParser.TryRun(RunBehavior runBehavior, SqlCommand cmdHandler, SqlDataReader dataStream, BulkCopySimpleResultSet bulkCopyHandler, TdsParserStateObject stateObj, Boolean& dataReady)
   at Microsoft.Data.SqlClient.SqlDataReader.TryHasMoreRows(Boolean& moreRows)
   at Microsoft.Data.SqlClient.SqlDataReader.TryReadInternal(Boolean setTimeout, Boolean& more)
   at Microsoft.Data.SqlClient.SqlDataReader.ReadAsyncExecute(Task task, Object state)
   at Microsoft.Data.SqlClient.SqlDataReader.InvokeAsyncCall[T](SqlDataReaderBaseAsyncCallContext`1 context)
--- End of stack trace from previous location ---
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeResultSetAsync(Int32 startCommandIndex, RelationalDataReader reader, CancellationToken cancellationToken)
ClientConnectionId:20e2460a-ecb1-48bb-bb7f-cd9effff34c3
Error Number:547,State:0,Class:16
   --- End of inner exception stack trace ---
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeResultSetAsync(Int32 startCommandIndex, RelationalDataReader reader, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeAsync(RelationalDataReader reader, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Update.Internal.SqlServerModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(IList`1 entriesToSave, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(StateManager stateManager, Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Storage.Internal.SqlServerExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
Microsoft.EntityFrameworkCore.DbUpdateException: An error occurred while saving the entity changes. See the inner exception for details.
 ---> Microsoft.Data.SqlClient.SqlException (0x80131904): The MERGE statement conflicted with the FOREIGN KEY constraint "FK_AuthLogs_Customers_NationalId". The conflict occurred in database "NayifatApp", table "dbo.Customers", column 'NationalId'.
   at Microsoft.Data.SqlClient.SqlConnection.OnError(SqlException exception, Boolean breakConnection, Action`1 wrapCloseInAction)
   at Microsoft.Data.SqlClient.SqlInternalConnection.OnError(SqlException exception, Boolean breakConnection, Action`1 wrapCloseInAction)
   at Microsoft.Data.SqlClient.TdsParser.ThrowExceptionAndWarning(TdsParserStateObject stateObj, Boolean callerHasConnectionLock, Boolean asyncClose)
   at Microsoft.Data.SqlClient.TdsParser.TryRun(RunBehavior runBehavior, SqlCommand cmdHandler, SqlDataReader dataStream, BulkCopySimpleResultSet bulkCopyHandler, TdsParserStateObject stateObj, Boolean& dataReady)
   at Microsoft.Data.SqlClient.SqlDataReader.TryHasMoreRows(Boolean& moreRows)
   at Microsoft.Data.SqlClient.SqlDataReader.TryReadInternal(Boolean setTimeout, Boolean& more)
   at Microsoft.Data.SqlClient.SqlDataReader.ReadAsyncExecute(Task task, Object state)
   at Microsoft.Data.SqlClient.SqlDataReader.InvokeAsyncCall[T](SqlDataReaderBaseAsyncCallContext`1 context)
--- End of stack trace from previous location ---
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeResultSetAsync(Int32 startCommandIndex, RelationalDataReader reader, CancellationToken cancellationToken)
ClientConnectionId:20e2460a-ecb1-48bb-bb7f-cd9effff34c3
Error Number:547,State:0,Class:16
   --- End of inner exception stack trace ---
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeResultSetAsync(Int32 startCommandIndex, RelationalDataReader reader, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeAsync(RelationalDataReader reader, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Update.Internal.SqlServerModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(IList`1 entriesToSave, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(StateManager stateManager, Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Storage.Internal.SqlServerExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
2025-02-02 23:35:40.168 +03:00 [INF] Executed action NayifatAPI.Controllers.AuthController.SignIn (NayifatAPI) in 52.7862ms
2025-02-02 23:35:40.169 +03:00 [INF] Executed endpoint 'NayifatAPI.Controllers.AuthController.SignIn (NayifatAPI)'
2025-02-02 23:35:40.169 +03:00 [ERR] Unhandled exception
Microsoft.EntityFrameworkCore.DbUpdateException: An error occurred while saving the entity changes. See the inner exception for details.
 ---> Microsoft.Data.SqlClient.SqlException (0x80131904): The MERGE statement conflicted with the FOREIGN KEY constraint "FK_AuthLogs_Customers_NationalId". The conflict occurred in database "NayifatApp", table "dbo.Customers", column 'NationalId'.
   at Microsoft.Data.SqlClient.SqlConnection.OnError(SqlException exception, Boolean breakConnection, Action`1 wrapCloseInAction)
   at Microsoft.Data.SqlClient.SqlInternalConnection.OnError(SqlException exception, Boolean breakConnection, Action`1 wrapCloseInAction)
   at Microsoft.Data.SqlClient.TdsParser.ThrowExceptionAndWarning(TdsParserStateObject stateObj, Boolean callerHasConnectionLock, Boolean asyncClose)
   at Microsoft.Data.SqlClient.TdsParser.TryRun(RunBehavior runBehavior, SqlCommand cmdHandler, SqlDataReader dataStream, BulkCopySimpleResultSet bulkCopyHandler, TdsParserStateObject stateObj, Boolean& dataReady)
   at Microsoft.Data.SqlClient.SqlDataReader.TryHasMoreRows(Boolean& moreRows)
   at Microsoft.Data.SqlClient.SqlDataReader.TryReadInternal(Boolean setTimeout, Boolean& more)
   at Microsoft.Data.SqlClient.SqlDataReader.ReadAsyncExecute(Task task, Object state)
   at Microsoft.Data.SqlClient.SqlDataReader.InvokeAsyncCall[T](SqlDataReaderBaseAsyncCallContext`1 context)
--- End of stack trace from previous location ---
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeResultSetAsync(Int32 startCommandIndex, RelationalDataReader reader, CancellationToken cancellationToken)
ClientConnectionId:20e2460a-ecb1-48bb-bb7f-cd9effff34c3
Error Number:547,State:0,Class:16
   --- End of inner exception stack trace ---
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeResultSetAsync(Int32 startCommandIndex, RelationalDataReader reader, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeAsync(RelationalDataReader reader, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Update.Internal.SqlServerModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(IList`1 entriesToSave, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(StateManager stateManager, Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Storage.Internal.SqlServerExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at NayifatAPI.Controllers.AuthController.LogAuthAttempt(String nationalId, String deviceId, String status, String failureReason) in C:\Users\yamta\StudioProjects\nayifat_app_2025_new\nayifatapi\Controllers\AuthController.cs:line 367
   at NayifatAPI.Controllers.AuthController.SignIn(SignInRequest request) in C:\Users\yamta\StudioProjects\nayifat_app_2025_new\nayifatapi\Controllers\AuthController.cs:line 103
   at Microsoft.AspNetCore.Mvc.Infrastructure.ActionMethodExecutor.TaskOfIActionResultExecutor.Execute(ActionContext actionContext, IActionResultTypeMapper mapper, ObjectMethodExecutor executor, Object controller, Object[] arguments)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.<InvokeActionMethodAsync>g__Awaited|12_0(ControllerActionInvoker invoker, ValueTask`1 actionResultValueTask)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.<InvokeNextActionFilterAsync>g__Awaited|10_0(ControllerActionInvoker invoker, Task lastTask, State next, Scope scope, Object state, Boolean isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.Rethrow(ActionExecutedContextSealed context)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.Next(State& next, Scope& scope, Object& state, Boolean& isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.<InvokeInnerFilterAsync>g__Awaited|13_0(ControllerActionInvoker invoker, Task lastTask, State next, Scope scope, Object state, Boolean isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeFilterPipelineAsync>g__Awaited|20_0(ResourceInvoker invoker, Task lastTask, State next, Scope scope, Object state, Boolean isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeAsync>g__Logged|17_1(ResourceInvoker invoker)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeAsync>g__Logged|17_1(ResourceInvoker invoker)
   at Microsoft.AspNetCore.Routing.EndpointMiddleware.<Invoke>g__AwaitRequestTask|7_0(Endpoint endpoint, Task requestTask, ILogger logger)
   at Microsoft.AspNetCore.Authorization.AuthorizationMiddleware.Invoke(HttpContext context)
   at Program.<>c.<<<Main>$>b__0_3>d.MoveNext() in C:\Users\yamta\StudioProjects\nayifat_app_2025_new\nayifatapi\Program.cs:line 85
2025-02-02 23:35:40.186 +03:00 [ERR] An unhandled exception has occurred while executing the request.
Microsoft.EntityFrameworkCore.DbUpdateException: An error occurred while saving the entity changes. See the inner exception for details.
 ---> Microsoft.Data.SqlClient.SqlException (0x80131904): The MERGE statement conflicted with the FOREIGN KEY constraint "FK_AuthLogs_Customers_NationalId". The conflict occurred in database "NayifatApp", table "dbo.Customers", column 'NationalId'.
   at Microsoft.Data.SqlClient.SqlConnection.OnError(SqlException exception, Boolean breakConnection, Action`1 wrapCloseInAction)
   at Microsoft.Data.SqlClient.SqlInternalConnection.OnError(SqlException exception, Boolean breakConnection, Action`1 wrapCloseInAction)
   at Microsoft.Data.SqlClient.TdsParser.ThrowExceptionAndWarning(TdsParserStateObject stateObj, Boolean callerHasConnectionLock, Boolean asyncClose)
   at Microsoft.Data.SqlClient.TdsParser.TryRun(RunBehavior runBehavior, SqlCommand cmdHandler, SqlDataReader dataStream, BulkCopySimpleResultSet bulkCopyHandler, TdsParserStateObject stateObj, Boolean& dataReady)
   at Microsoft.Data.SqlClient.SqlDataReader.TryHasMoreRows(Boolean& moreRows)
   at Microsoft.Data.SqlClient.SqlDataReader.TryReadInternal(Boolean setTimeout, Boolean& more)
   at Microsoft.Data.SqlClient.SqlDataReader.ReadAsyncExecute(Task task, Object state)
   at Microsoft.Data.SqlClient.SqlDataReader.InvokeAsyncCall[T](SqlDataReaderBaseAsyncCallContext`1 context)
--- End of stack trace from previous location ---
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeResultSetAsync(Int32 startCommandIndex, RelationalDataReader reader, CancellationToken cancellationToken)
ClientConnectionId:20e2460a-ecb1-48bb-bb7f-cd9effff34c3
Error Number:547,State:0,Class:16
   --- End of inner exception stack trace ---
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeResultSetAsync(Int32 startCommandIndex, RelationalDataReader reader, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeAsync(RelationalDataReader reader, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Update.Internal.SqlServerModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(IList`1 entriesToSave, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(StateManager stateManager, Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Storage.Internal.SqlServerExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at NayifatAPI.Controllers.AuthController.LogAuthAttempt(String nationalId, String deviceId, String status, String failureReason) in C:\Users\yamta\StudioProjects\nayifat_app_2025_new\nayifatapi\Controllers\AuthController.cs:line 367
   at NayifatAPI.Controllers.AuthController.SignIn(SignInRequest request) in C:\Users\yamta\StudioProjects\nayifat_app_2025_new\nayifatapi\Controllers\AuthController.cs:line 103
   at Microsoft.AspNetCore.Mvc.Infrastructure.ActionMethodExecutor.TaskOfIActionResultExecutor.Execute(ActionContext actionContext, IActionResultTypeMapper mapper, ObjectMethodExecutor executor, Object controller, Object[] arguments)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.<InvokeActionMethodAsync>g__Awaited|12_0(ControllerActionInvoker invoker, ValueTask`1 actionResultValueTask)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.<InvokeNextActionFilterAsync>g__Awaited|10_0(ControllerActionInvoker invoker, Task lastTask, State next, Scope scope, Object state, Boolean isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.Rethrow(ActionExecutedContextSealed context)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.Next(State& next, Scope& scope, Object& state, Boolean& isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.<InvokeInnerFilterAsync>g__Awaited|13_0(ControllerActionInvoker invoker, Task lastTask, State next, Scope scope, Object state, Boolean isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeFilterPipelineAsync>g__Awaited|20_0(ResourceInvoker invoker, Task lastTask, State next, Scope scope, Object state, Boolean isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeAsync>g__Logged|17_1(ResourceInvoker invoker)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeAsync>g__Logged|17_1(ResourceInvoker invoker)
   at Microsoft.AspNetCore.Routing.EndpointMiddleware.<Invoke>g__AwaitRequestTask|7_0(Endpoint endpoint, Task requestTask, ILogger logger)
   at Microsoft.AspNetCore.Authorization.AuthorizationMiddleware.Invoke(HttpContext context)
   at Program.<>c.<<<Main>$>b__0_3>d.MoveNext() in C:\Users\yamta\StudioProjects\nayifat_app_2025_new\nayifatapi\Program.cs:line 85
--- End of stack trace from previous location ---
   at Swashbuckle.AspNetCore.SwaggerUI.SwaggerUIMiddleware.Invoke(HttpContext httpContext)
   at Swashbuckle.AspNetCore.Swagger.SwaggerMiddleware.Invoke(HttpContext httpContext, ISwaggerProvider swaggerProvider)
   at Microsoft.AspNetCore.Authentication.AuthenticationMiddleware.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Diagnostics.DeveloperExceptionPageMiddlewareImpl.Invoke(HttpContext context)
2025-02-02 23:35:40.207 +03:00 [INF] Request finished HTTP/1.1 POST http://07ca-46-152-255-232.ngrok-free.app/api/auth/signin - 500 null text/plain; charset=utf-8 98.8474ms
2025-02-02 23:35:55.822 +03:00 [INF] Request starting HTTP/1.1 POST http://07ca-46-152-255-232.ngrok-free.app/api/notifications/list - application/json; charset=utf-8 47
2025-02-02 23:35:55.823 +03:00 [INF] Executing endpoint 'NayifatAPI.Controllers.NotificationsController.GetNotifications (NayifatAPI)'
2025-02-02 23:35:55.824 +03:00 [INF] Route matched with {action = "GetNotifications", controller = "Notifications"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetNotifications(NayifatAPI.Controllers.GetNotificationsRequest) on controller NayifatAPI.Controllers.NotificationsController (NayifatAPI).
2025-02-02 23:35:55.829 +03:00 [INF] Executed DbCommand (2ms) [Parameters=[@__providedApiKey_0='?' (Size = 255)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [a].[Key], [a].[CreatedAt], [a].[Description], [a].[ExpiresAt], [a].[IsActive], [a].[LastUsedAt]
FROM [ApiKeys] AS [a]
WHERE [a].[Key] = @__providedApiKey_0 AND [a].[IsActive] = CAST(1 AS bit)
2025-02-02 23:35:55.833 +03:00 [INF] Executed DbCommand (2ms) [Parameters=[@__request_NationalId_0='?' (Size = 450)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [u].[national_id], [u].[last_updated], [u].[notifications]
FROM [user_notifications] AS [u]
WHERE [u].[national_id] = @__request_NationalId_0
2025-02-02 23:35:55.836 +03:00 [INF] Executed DbCommand (2ms) [Parameters=[@__Parse_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [n].[Id], [n].[additional_data], [n].[Body], [n].[body_ar], [n].[body_en], [n].[created_at], [n].[expiry_at], [n].[Route], [n].[target_criteria], [n].[Title], [n].[title_ar], [n].[title_en]
FROM [notification_templates] AS [n]
WHERE [n].[Id] = @__Parse_0
2025-02-02 23:35:55.839 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@__Parse_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [n].[Id], [n].[additional_data], [n].[Body], [n].[body_ar], [n].[body_en], [n].[created_at], [n].[expiry_at], [n].[Route], [n].[target_criteria], [n].[Title], [n].[title_ar], [n].[title_en]
FROM [notification_templates] AS [n]
WHERE [n].[Id] = @__Parse_0
2025-02-02 23:35:55.917 +03:00 [INF] Executed DbCommand (77ms) [Parameters=[@p0='?' (Size = 4000), @p1='?' (DbType = DateTime2), @p2='?' (Size = 4000), @p3='?' (Size = 4000), @p4='?' (Size = 4000), @p5='?' (Size = 450), @p6='?' (Size = 4000), @p7='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SET IMPLICIT_TRANSACTIONS OFF;
SET NOCOUNT ON;
INSERT INTO [AuthLogs] ([AuthType], [CreatedAt], [DeviceId], [FailureReason], [IpAddress], [NationalId], [Status], [UserAgent])
OUTPUT INSERTED.[Id]
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7);
2025-02-02 23:35:55.920 +03:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType9`2[[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Object, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-02-02 23:35:55.921 +03:00 [INF] Executed action NayifatAPI.Controllers.NotificationsController.GetNotifications (NayifatAPI) in 94.8386ms
2025-02-02 23:35:55.922 +03:00 [INF] Executed endpoint 'NayifatAPI.Controllers.NotificationsController.GetNotifications (NayifatAPI)'
2025-02-02 23:35:55.922 +03:00 [INF] Request finished HTTP/1.1 POST http://07ca-46-152-255-232.ngrok-free.app/api/notifications/list - 200 null application/json; charset=utf-8 100.77ms
2025-02-02 23:36:05.344 +03:00 [INF] Request starting HTTP/1.1 POST http://07ca-46-152-255-232.ngrok-free.app/api/auth/signin - application/json; charset=utf-8 70
2025-02-02 23:36:05.346 +03:00 [INF] Executing endpoint 'NayifatAPI.Controllers.AuthController.SignIn (NayifatAPI)'
2025-02-02 23:36:05.347 +03:00 [INF] Route matched with {action = "SignIn", controller = "Auth"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] SignIn(NayifatAPI.Controllers.SignInRequest) on controller NayifatAPI.Controllers.AuthController (NayifatAPI).
2025-02-02 23:36:05.352 +03:00 [INF] Executed DbCommand (4ms) [Parameters=[@__providedApiKey_0='?' (Size = 255)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [a].[Key], [a].[CreatedAt], [a].[Description], [a].[ExpiresAt], [a].[IsActive], [a].[LastUsedAt]
FROM [ApiKeys] AS [a]
WHERE [a].[Key] = @__providedApiKey_0 AND [a].[IsActive] = CAST(1 AS bit)
2025-02-02 23:36:05.358 +03:00 [INF] Executed DbCommand (3ms) [Parameters=[@__request_NationalId_0='?' (Size = 450)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [c].[NationalId], [c].[AddNo], [c].[BuildingNo], [c].[City], [c].[Consent], [c].[ConsentDate], [c].[DateOfBirth], [c].[Dependents], [c].[District], [c].[Email], [c].[Employer], [c].[FamilyNameAr], [c].[FamilyNameEn], [c].[FirstNameAr], [c].[FirstNameEn], [c].[Iban], [c].[IdExpiryDate], [c].[Los], [c].[Mpin], [c].[MpinEnabled], [c].[NafathStatus], [c].[NafathTimestamp], [c].[Password], [c].[Phone], [c].[RegistrationDate], [c].[SalaryCustomer], [c].[SalaryDakhli], [c].[SecondNameAr], [c].[SecondNameEn], [c].[Sector], [c].[Street], [c].[ThirdNameAr], [c].[ThirdNameEn], [c].[Zipcode]
FROM [Customers] AS [c]
WHERE [c].[NationalId] = @__request_NationalId_0
2025-02-02 23:36:05.363 +03:00 [INF] Executed DbCommand (3ms) [Parameters=[@p0='?' (Size = 4000), @p1='?' (DbType = DateTime2), @p2='?' (Size = 4000), @p3='?' (Size = 4000), @p4='?' (Size = 4000), @p5='?' (Size = 450), @p6='?' (Size = 4000), @p7='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SET IMPLICIT_TRANSACTIONS OFF;
SET NOCOUNT ON;
INSERT INTO [AuthLogs] ([AuthType], [CreatedAt], [DeviceId], [FailureReason], [IpAddress], [NationalId], [Status], [UserAgent])
OUTPUT INSERTED.[Id]
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7);
2025-02-02 23:36:05.366 +03:00 [ERR] An exception occurred in the database while saving changes for context type 'NayifatAPI.Data.ApplicationDbContext'.
Microsoft.EntityFrameworkCore.DbUpdateException: An error occurred while saving the entity changes. See the inner exception for details.
 ---> Microsoft.Data.SqlClient.SqlException (0x80131904): The INSERT statement conflicted with the FOREIGN KEY constraint "FK_AuthLogs_Customers_NationalId". The conflict occurred in database "NayifatApp", table "dbo.Customers", column 'NationalId'.
   at Microsoft.Data.SqlClient.SqlConnection.OnError(SqlException exception, Boolean breakConnection, Action`1 wrapCloseInAction)
   at Microsoft.Data.SqlClient.SqlInternalConnection.OnError(SqlException exception, Boolean breakConnection, Action`1 wrapCloseInAction)
   at Microsoft.Data.SqlClient.TdsParser.ThrowExceptionAndWarning(TdsParserStateObject stateObj, Boolean callerHasConnectionLock, Boolean asyncClose)
   at Microsoft.Data.SqlClient.TdsParser.TryRun(RunBehavior runBehavior, SqlCommand cmdHandler, SqlDataReader dataStream, BulkCopySimpleResultSet bulkCopyHandler, TdsParserStateObject stateObj, Boolean& dataReady)
   at Microsoft.Data.SqlClient.SqlDataReader.TryHasMoreRows(Boolean& moreRows)
   at Microsoft.Data.SqlClient.SqlDataReader.TryReadInternal(Boolean setTimeout, Boolean& more)
   at Microsoft.Data.SqlClient.SqlDataReader.ReadAsyncExecute(Task task, Object state)
   at Microsoft.Data.SqlClient.SqlDataReader.InvokeAsyncCall[T](SqlDataReaderBaseAsyncCallContext`1 context)
--- End of stack trace from previous location ---
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeResultSetAsync(Int32 startCommandIndex, RelationalDataReader reader, CancellationToken cancellationToken)
ClientConnectionId:20e2460a-ecb1-48bb-bb7f-cd9effff34c3
Error Number:547,State:0,Class:16
   --- End of inner exception stack trace ---
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeResultSetAsync(Int32 startCommandIndex, RelationalDataReader reader, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeAsync(RelationalDataReader reader, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Update.Internal.SqlServerModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(IList`1 entriesToSave, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(StateManager stateManager, Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Storage.Internal.SqlServerExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
Microsoft.EntityFrameworkCore.DbUpdateException: An error occurred while saving the entity changes. See the inner exception for details.
 ---> Microsoft.Data.SqlClient.SqlException (0x80131904): The INSERT statement conflicted with the FOREIGN KEY constraint "FK_AuthLogs_Customers_NationalId". The conflict occurred in database "NayifatApp", table "dbo.Customers", column 'NationalId'.
   at Microsoft.Data.SqlClient.SqlConnection.OnError(SqlException exception, Boolean breakConnection, Action`1 wrapCloseInAction)
   at Microsoft.Data.SqlClient.SqlInternalConnection.OnError(SqlException exception, Boolean breakConnection, Action`1 wrapCloseInAction)
   at Microsoft.Data.SqlClient.TdsParser.ThrowExceptionAndWarning(TdsParserStateObject stateObj, Boolean callerHasConnectionLock, Boolean asyncClose)
   at Microsoft.Data.SqlClient.TdsParser.TryRun(RunBehavior runBehavior, SqlCommand cmdHandler, SqlDataReader dataStream, BulkCopySimpleResultSet bulkCopyHandler, TdsParserStateObject stateObj, Boolean& dataReady)
   at Microsoft.Data.SqlClient.SqlDataReader.TryHasMoreRows(Boolean& moreRows)
   at Microsoft.Data.SqlClient.SqlDataReader.TryReadInternal(Boolean setTimeout, Boolean& more)
   at Microsoft.Data.SqlClient.SqlDataReader.ReadAsyncExecute(Task task, Object state)
   at Microsoft.Data.SqlClient.SqlDataReader.InvokeAsyncCall[T](SqlDataReaderBaseAsyncCallContext`1 context)
--- End of stack trace from previous location ---
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeResultSetAsync(Int32 startCommandIndex, RelationalDataReader reader, CancellationToken cancellationToken)
ClientConnectionId:20e2460a-ecb1-48bb-bb7f-cd9effff34c3
Error Number:547,State:0,Class:16
   --- End of inner exception stack trace ---
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeResultSetAsync(Int32 startCommandIndex, RelationalDataReader reader, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeAsync(RelationalDataReader reader, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Update.Internal.SqlServerModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(IList`1 entriesToSave, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(StateManager stateManager, Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Storage.Internal.SqlServerExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
2025-02-02 23:36:05.380 +03:00 [ERR] Error during sign in for National ID: 5555552
Microsoft.EntityFrameworkCore.DbUpdateException: An error occurred while saving the entity changes. See the inner exception for details.
 ---> Microsoft.Data.SqlClient.SqlException (0x80131904): The INSERT statement conflicted with the FOREIGN KEY constraint "FK_AuthLogs_Customers_NationalId". The conflict occurred in database "NayifatApp", table "dbo.Customers", column 'NationalId'.
   at Microsoft.Data.SqlClient.SqlConnection.OnError(SqlException exception, Boolean breakConnection, Action`1 wrapCloseInAction)
   at Microsoft.Data.SqlClient.SqlInternalConnection.OnError(SqlException exception, Boolean breakConnection, Action`1 wrapCloseInAction)
   at Microsoft.Data.SqlClient.TdsParser.ThrowExceptionAndWarning(TdsParserStateObject stateObj, Boolean callerHasConnectionLock, Boolean asyncClose)
   at Microsoft.Data.SqlClient.TdsParser.TryRun(RunBehavior runBehavior, SqlCommand cmdHandler, SqlDataReader dataStream, BulkCopySimpleResultSet bulkCopyHandler, TdsParserStateObject stateObj, Boolean& dataReady)
   at Microsoft.Data.SqlClient.SqlDataReader.TryHasMoreRows(Boolean& moreRows)
   at Microsoft.Data.SqlClient.SqlDataReader.TryReadInternal(Boolean setTimeout, Boolean& more)
   at Microsoft.Data.SqlClient.SqlDataReader.ReadAsyncExecute(Task task, Object state)
   at Microsoft.Data.SqlClient.SqlDataReader.InvokeAsyncCall[T](SqlDataReaderBaseAsyncCallContext`1 context)
--- End of stack trace from previous location ---
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeResultSetAsync(Int32 startCommandIndex, RelationalDataReader reader, CancellationToken cancellationToken)
ClientConnectionId:20e2460a-ecb1-48bb-bb7f-cd9effff34c3
Error Number:547,State:0,Class:16
   --- End of inner exception stack trace ---
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeResultSetAsync(Int32 startCommandIndex, RelationalDataReader reader, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeAsync(RelationalDataReader reader, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Update.Internal.SqlServerModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(IList`1 entriesToSave, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(StateManager stateManager, Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Storage.Internal.SqlServerExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at NayifatAPI.Controllers.AuthController.LogAuthAttempt(String nationalId, String deviceId, String status, String failureReason) in C:\Users\yamta\StudioProjects\nayifat_app_2025_new\nayifatapi\Controllers\AuthController.cs:line 367
   at NayifatAPI.Controllers.AuthController.SignIn(SignInRequest request) in C:\Users\yamta\StudioProjects\nayifat_app_2025_new\nayifatapi\Controllers\AuthController.cs:line 41
2025-02-02 23:36:05.397 +03:00 [INF] Executed DbCommand (8ms) [Parameters=[@p0='?' (Size = 4000), @p1='?' (DbType = DateTime2), @p2='?' (Size = 4000), @p3='?' (Size = 4000), @p4='?' (Size = 4000), @p5='?' (Size = 450), @p6='?' (Size = 4000), @p7='?' (Size = 4000), @p8='?' (Size = 4000), @p9='?' (DbType = DateTime2), @p10='?' (Size = 4000), @p11='?' (Size = 4000), @p12='?' (Size = 4000), @p13='?' (Size = 450), @p14='?' (Size = 4000), @p15='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SET IMPLICIT_TRANSACTIONS OFF;
SET NOCOUNT ON;
MERGE [AuthLogs] USING (
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7, 0),
(@p8, @p9, @p10, @p11, @p12, @p13, @p14, @p15, 1)) AS i ([AuthType], [CreatedAt], [DeviceId], [FailureReason], [IpAddress], [NationalId], [Status], [UserAgent], _Position) ON 1=0
WHEN NOT MATCHED THEN
INSERT ([AuthType], [CreatedAt], [DeviceId], [FailureReason], [IpAddress], [NationalId], [Status], [UserAgent])
VALUES (i.[AuthType], i.[CreatedAt], i.[DeviceId], i.[FailureReason], i.[IpAddress], i.[NationalId], i.[Status], i.[UserAgent])
OUTPUT INSERTED.[Id], i._Position;
2025-02-02 23:36:05.407 +03:00 [ERR] An exception occurred in the database while saving changes for context type 'NayifatAPI.Data.ApplicationDbContext'.
Microsoft.EntityFrameworkCore.DbUpdateException: An error occurred while saving the entity changes. See the inner exception for details.
 ---> Microsoft.Data.SqlClient.SqlException (0x80131904): The MERGE statement conflicted with the FOREIGN KEY constraint "FK_AuthLogs_Customers_NationalId". The conflict occurred in database "NayifatApp", table "dbo.Customers", column 'NationalId'.
   at Microsoft.Data.SqlClient.SqlConnection.OnError(SqlException exception, Boolean breakConnection, Action`1 wrapCloseInAction)
   at Microsoft.Data.SqlClient.SqlInternalConnection.OnError(SqlException exception, Boolean breakConnection, Action`1 wrapCloseInAction)
   at Microsoft.Data.SqlClient.TdsParser.ThrowExceptionAndWarning(TdsParserStateObject stateObj, Boolean callerHasConnectionLock, Boolean asyncClose)
   at Microsoft.Data.SqlClient.TdsParser.TryRun(RunBehavior runBehavior, SqlCommand cmdHandler, SqlDataReader dataStream, BulkCopySimpleResultSet bulkCopyHandler, TdsParserStateObject stateObj, Boolean& dataReady)
   at Microsoft.Data.SqlClient.SqlDataReader.TryHasMoreRows(Boolean& moreRows)
   at Microsoft.Data.SqlClient.SqlDataReader.TryReadInternal(Boolean setTimeout, Boolean& more)
   at Microsoft.Data.SqlClient.SqlDataReader.ReadAsyncExecute(Task task, Object state)
   at Microsoft.Data.SqlClient.SqlDataReader.InvokeAsyncCall[T](SqlDataReaderBaseAsyncCallContext`1 context)
--- End of stack trace from previous location ---
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeResultSetAsync(Int32 startCommandIndex, RelationalDataReader reader, CancellationToken cancellationToken)
ClientConnectionId:20e2460a-ecb1-48bb-bb7f-cd9effff34c3
Error Number:547,State:0,Class:16
   --- End of inner exception stack trace ---
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeResultSetAsync(Int32 startCommandIndex, RelationalDataReader reader, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeAsync(RelationalDataReader reader, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Update.Internal.SqlServerModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(IList`1 entriesToSave, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(StateManager stateManager, Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Storage.Internal.SqlServerExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
Microsoft.EntityFrameworkCore.DbUpdateException: An error occurred while saving the entity changes. See the inner exception for details.
 ---> Microsoft.Data.SqlClient.SqlException (0x80131904): The MERGE statement conflicted with the FOREIGN KEY constraint "FK_AuthLogs_Customers_NationalId". The conflict occurred in database "NayifatApp", table "dbo.Customers", column 'NationalId'.
   at Microsoft.Data.SqlClient.SqlConnection.OnError(SqlException exception, Boolean breakConnection, Action`1 wrapCloseInAction)
   at Microsoft.Data.SqlClient.SqlInternalConnection.OnError(SqlException exception, Boolean breakConnection, Action`1 wrapCloseInAction)
   at Microsoft.Data.SqlClient.TdsParser.ThrowExceptionAndWarning(TdsParserStateObject stateObj, Boolean callerHasConnectionLock, Boolean asyncClose)
   at Microsoft.Data.SqlClient.TdsParser.TryRun(RunBehavior runBehavior, SqlCommand cmdHandler, SqlDataReader dataStream, BulkCopySimpleResultSet bulkCopyHandler, TdsParserStateObject stateObj, Boolean& dataReady)
   at Microsoft.Data.SqlClient.SqlDataReader.TryHasMoreRows(Boolean& moreRows)
   at Microsoft.Data.SqlClient.SqlDataReader.TryReadInternal(Boolean setTimeout, Boolean& more)
   at Microsoft.Data.SqlClient.SqlDataReader.ReadAsyncExecute(Task task, Object state)
   at Microsoft.Data.SqlClient.SqlDataReader.InvokeAsyncCall[T](SqlDataReaderBaseAsyncCallContext`1 context)
--- End of stack trace from previous location ---
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeResultSetAsync(Int32 startCommandIndex, RelationalDataReader reader, CancellationToken cancellationToken)
ClientConnectionId:20e2460a-ecb1-48bb-bb7f-cd9effff34c3
Error Number:547,State:0,Class:16
   --- End of inner exception stack trace ---
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeResultSetAsync(Int32 startCommandIndex, RelationalDataReader reader, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeAsync(RelationalDataReader reader, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Update.Internal.SqlServerModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(IList`1 entriesToSave, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(StateManager stateManager, Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Storage.Internal.SqlServerExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
2025-02-02 23:36:05.419 +03:00 [INF] Executed action NayifatAPI.Controllers.AuthController.SignIn (NayifatAPI) in 71.3792ms
2025-02-02 23:36:05.420 +03:00 [INF] Executed endpoint 'NayifatAPI.Controllers.AuthController.SignIn (NayifatAPI)'
2025-02-02 23:36:05.421 +03:00 [ERR] Unhandled exception
Microsoft.EntityFrameworkCore.DbUpdateException: An error occurred while saving the entity changes. See the inner exception for details.
 ---> Microsoft.Data.SqlClient.SqlException (0x80131904): The MERGE statement conflicted with the FOREIGN KEY constraint "FK_AuthLogs_Customers_NationalId". The conflict occurred in database "NayifatApp", table "dbo.Customers", column 'NationalId'.
   at Microsoft.Data.SqlClient.SqlConnection.OnError(SqlException exception, Boolean breakConnection, Action`1 wrapCloseInAction)
   at Microsoft.Data.SqlClient.SqlInternalConnection.OnError(SqlException exception, Boolean breakConnection, Action`1 wrapCloseInAction)
   at Microsoft.Data.SqlClient.TdsParser.ThrowExceptionAndWarning(TdsParserStateObject stateObj, Boolean callerHasConnectionLock, Boolean asyncClose)
   at Microsoft.Data.SqlClient.TdsParser.TryRun(RunBehavior runBehavior, SqlCommand cmdHandler, SqlDataReader dataStream, BulkCopySimpleResultSet bulkCopyHandler, TdsParserStateObject stateObj, Boolean& dataReady)
   at Microsoft.Data.SqlClient.SqlDataReader.TryHasMoreRows(Boolean& moreRows)
   at Microsoft.Data.SqlClient.SqlDataReader.TryReadInternal(Boolean setTimeout, Boolean& more)
   at Microsoft.Data.SqlClient.SqlDataReader.ReadAsyncExecute(Task task, Object state)
   at Microsoft.Data.SqlClient.SqlDataReader.InvokeAsyncCall[T](SqlDataReaderBaseAsyncCallContext`1 context)
--- End of stack trace from previous location ---
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeResultSetAsync(Int32 startCommandIndex, RelationalDataReader reader, CancellationToken cancellationToken)
ClientConnectionId:20e2460a-ecb1-48bb-bb7f-cd9effff34c3
Error Number:547,State:0,Class:16
   --- End of inner exception stack trace ---
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeResultSetAsync(Int32 startCommandIndex, RelationalDataReader reader, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeAsync(RelationalDataReader reader, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Update.Internal.SqlServerModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(IList`1 entriesToSave, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(StateManager stateManager, Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Storage.Internal.SqlServerExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at NayifatAPI.Controllers.AuthController.LogAuthAttempt(String nationalId, String deviceId, String status, String failureReason) in C:\Users\yamta\StudioProjects\nayifat_app_2025_new\nayifatapi\Controllers\AuthController.cs:line 367
   at NayifatAPI.Controllers.AuthController.SignIn(SignInRequest request) in C:\Users\yamta\StudioProjects\nayifat_app_2025_new\nayifatapi\Controllers\AuthController.cs:line 103
   at Microsoft.AspNetCore.Mvc.Infrastructure.ActionMethodExecutor.TaskOfIActionResultExecutor.Execute(ActionContext actionContext, IActionResultTypeMapper mapper, ObjectMethodExecutor executor, Object controller, Object[] arguments)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.<InvokeActionMethodAsync>g__Awaited|12_0(ControllerActionInvoker invoker, ValueTask`1 actionResultValueTask)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.<InvokeNextActionFilterAsync>g__Awaited|10_0(ControllerActionInvoker invoker, Task lastTask, State next, Scope scope, Object state, Boolean isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.Rethrow(ActionExecutedContextSealed context)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.Next(State& next, Scope& scope, Object& state, Boolean& isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.<InvokeInnerFilterAsync>g__Awaited|13_0(ControllerActionInvoker invoker, Task lastTask, State next, Scope scope, Object state, Boolean isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeFilterPipelineAsync>g__Awaited|20_0(ResourceInvoker invoker, Task lastTask, State next, Scope scope, Object state, Boolean isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeAsync>g__Logged|17_1(ResourceInvoker invoker)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeAsync>g__Logged|17_1(ResourceInvoker invoker)
   at Microsoft.AspNetCore.Routing.EndpointMiddleware.<Invoke>g__AwaitRequestTask|7_0(Endpoint endpoint, Task requestTask, ILogger logger)
   at Microsoft.AspNetCore.Authorization.AuthorizationMiddleware.Invoke(HttpContext context)
   at Program.<>c.<<<Main>$>b__0_3>d.MoveNext() in C:\Users\yamta\StudioProjects\nayifat_app_2025_new\nayifatapi\Program.cs:line 85
2025-02-02 23:36:05.437 +03:00 [ERR] An unhandled exception has occurred while executing the request.
Microsoft.EntityFrameworkCore.DbUpdateException: An error occurred while saving the entity changes. See the inner exception for details.
 ---> Microsoft.Data.SqlClient.SqlException (0x80131904): The MERGE statement conflicted with the FOREIGN KEY constraint "FK_AuthLogs_Customers_NationalId". The conflict occurred in database "NayifatApp", table "dbo.Customers", column 'NationalId'.
   at Microsoft.Data.SqlClient.SqlConnection.OnError(SqlException exception, Boolean breakConnection, Action`1 wrapCloseInAction)
   at Microsoft.Data.SqlClient.SqlInternalConnection.OnError(SqlException exception, Boolean breakConnection, Action`1 wrapCloseInAction)
   at Microsoft.Data.SqlClient.TdsParser.ThrowExceptionAndWarning(TdsParserStateObject stateObj, Boolean callerHasConnectionLock, Boolean asyncClose)
   at Microsoft.Data.SqlClient.TdsParser.TryRun(RunBehavior runBehavior, SqlCommand cmdHandler, SqlDataReader dataStream, BulkCopySimpleResultSet bulkCopyHandler, TdsParserStateObject stateObj, Boolean& dataReady)
   at Microsoft.Data.SqlClient.SqlDataReader.TryHasMoreRows(Boolean& moreRows)
   at Microsoft.Data.SqlClient.SqlDataReader.TryReadInternal(Boolean setTimeout, Boolean& more)
   at Microsoft.Data.SqlClient.SqlDataReader.ReadAsyncExecute(Task task, Object state)
   at Microsoft.Data.SqlClient.SqlDataReader.InvokeAsyncCall[T](SqlDataReaderBaseAsyncCallContext`1 context)
--- End of stack trace from previous location ---
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeResultSetAsync(Int32 startCommandIndex, RelationalDataReader reader, CancellationToken cancellationToken)
ClientConnectionId:20e2460a-ecb1-48bb-bb7f-cd9effff34c3
Error Number:547,State:0,Class:16
   --- End of inner exception stack trace ---
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeResultSetAsync(Int32 startCommandIndex, RelationalDataReader reader, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeAsync(RelationalDataReader reader, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Update.Internal.SqlServerModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(IList`1 entriesToSave, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(StateManager stateManager, Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Storage.Internal.SqlServerExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at NayifatAPI.Controllers.AuthController.LogAuthAttempt(String nationalId, String deviceId, String status, String failureReason) in C:\Users\yamta\StudioProjects\nayifat_app_2025_new\nayifatapi\Controllers\AuthController.cs:line 367
   at NayifatAPI.Controllers.AuthController.SignIn(SignInRequest request) in C:\Users\yamta\StudioProjects\nayifat_app_2025_new\nayifatapi\Controllers\AuthController.cs:line 103
   at Microsoft.AspNetCore.Mvc.Infrastructure.ActionMethodExecutor.TaskOfIActionResultExecutor.Execute(ActionContext actionContext, IActionResultTypeMapper mapper, ObjectMethodExecutor executor, Object controller, Object[] arguments)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.<InvokeActionMethodAsync>g__Awaited|12_0(ControllerActionInvoker invoker, ValueTask`1 actionResultValueTask)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.<InvokeNextActionFilterAsync>g__Awaited|10_0(ControllerActionInvoker invoker, Task lastTask, State next, Scope scope, Object state, Boolean isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.Rethrow(ActionExecutedContextSealed context)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.Next(State& next, Scope& scope, Object& state, Boolean& isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.<InvokeInnerFilterAsync>g__Awaited|13_0(ControllerActionInvoker invoker, Task lastTask, State next, Scope scope, Object state, Boolean isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeFilterPipelineAsync>g__Awaited|20_0(ResourceInvoker invoker, Task lastTask, State next, Scope scope, Object state, Boolean isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeAsync>g__Logged|17_1(ResourceInvoker invoker)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeAsync>g__Logged|17_1(ResourceInvoker invoker)
   at Microsoft.AspNetCore.Routing.EndpointMiddleware.<Invoke>g__AwaitRequestTask|7_0(Endpoint endpoint, Task requestTask, ILogger logger)
   at Microsoft.AspNetCore.Authorization.AuthorizationMiddleware.Invoke(HttpContext context)
   at Program.<>c.<<<Main>$>b__0_3>d.MoveNext() in C:\Users\yamta\StudioProjects\nayifat_app_2025_new\nayifatapi\Program.cs:line 85
--- End of stack trace from previous location ---
   at Swashbuckle.AspNetCore.SwaggerUI.SwaggerUIMiddleware.Invoke(HttpContext httpContext)
   at Swashbuckle.AspNetCore.Swagger.SwaggerMiddleware.Invoke(HttpContext httpContext, ISwaggerProvider swaggerProvider)
   at Microsoft.AspNetCore.Authentication.AuthenticationMiddleware.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Diagnostics.DeveloperExceptionPageMiddlewareImpl.Invoke(HttpContext context)
2025-02-02 23:36:05.453 +03:00 [INF] Request finished HTTP/1.1 POST http://07ca-46-152-255-232.ngrok-free.app/api/auth/signin - 500 null text/plain; charset=utf-8 109.0983ms
2025-02-02 23:36:45.892 +03:00 [INF] Request starting HTTP/1.1 POST http://07ca-46-152-255-232.ngrok-free.app/api/auth/signin - application/json; charset=utf-8 70
2025-02-02 23:36:45.895 +03:00 [INF] Executing endpoint 'NayifatAPI.Controllers.AuthController.SignIn (NayifatAPI)'
2025-02-02 23:36:45.896 +03:00 [INF] Route matched with {action = "SignIn", controller = "Auth"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] SignIn(NayifatAPI.Controllers.SignInRequest) on controller NayifatAPI.Controllers.AuthController (NayifatAPI).
2025-02-02 23:36:45.899 +03:00 [INF] Executed DbCommand (0ms) [Parameters=[@__providedApiKey_0='?' (Size = 255)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [a].[Key], [a].[CreatedAt], [a].[Description], [a].[ExpiresAt], [a].[IsActive], [a].[LastUsedAt]
FROM [ApiKeys] AS [a]
WHERE [a].[Key] = @__providedApiKey_0 AND [a].[IsActive] = CAST(1 AS bit)
2025-02-02 23:36:45.901 +03:00 [INF] Executed DbCommand (0ms) [Parameters=[@__request_NationalId_0='?' (Size = 450)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [c].[NationalId], [c].[AddNo], [c].[BuildingNo], [c].[City], [c].[Consent], [c].[ConsentDate], [c].[DateOfBirth], [c].[Dependents], [c].[District], [c].[Email], [c].[Employer], [c].[FamilyNameAr], [c].[FamilyNameEn], [c].[FirstNameAr], [c].[FirstNameEn], [c].[Iban], [c].[IdExpiryDate], [c].[Los], [c].[Mpin], [c].[MpinEnabled], [c].[NafathStatus], [c].[NafathTimestamp], [c].[Password], [c].[Phone], [c].[RegistrationDate], [c].[SalaryCustomer], [c].[SalaryDakhli], [c].[SecondNameAr], [c].[SecondNameEn], [c].[Sector], [c].[Street], [c].[ThirdNameAr], [c].[ThirdNameEn], [c].[Zipcode]
FROM [Customers] AS [c]
WHERE [c].[NationalId] = @__request_NationalId_0
2025-02-02 23:36:45.903 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@p0='?' (Size = 4000), @p1='?' (DbType = DateTime2), @p2='?' (Size = 4000), @p3='?' (Size = 4000), @p4='?' (Size = 4000), @p5='?' (Size = 450), @p6='?' (Size = 4000), @p7='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SET IMPLICIT_TRANSACTIONS OFF;
SET NOCOUNT ON;
INSERT INTO [AuthLogs] ([AuthType], [CreatedAt], [DeviceId], [FailureReason], [IpAddress], [NationalId], [Status], [UserAgent])
OUTPUT INSERTED.[Id]
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7);
2025-02-02 23:36:45.906 +03:00 [ERR] An exception occurred in the database while saving changes for context type 'NayifatAPI.Data.ApplicationDbContext'.
Microsoft.EntityFrameworkCore.DbUpdateException: An error occurred while saving the entity changes. See the inner exception for details.
 ---> Microsoft.Data.SqlClient.SqlException (0x80131904): The INSERT statement conflicted with the FOREIGN KEY constraint "FK_AuthLogs_Customers_NationalId". The conflict occurred in database "NayifatApp", table "dbo.Customers", column 'NationalId'.
   at Microsoft.Data.SqlClient.SqlConnection.OnError(SqlException exception, Boolean breakConnection, Action`1 wrapCloseInAction)
   at Microsoft.Data.SqlClient.SqlInternalConnection.OnError(SqlException exception, Boolean breakConnection, Action`1 wrapCloseInAction)
   at Microsoft.Data.SqlClient.TdsParser.ThrowExceptionAndWarning(TdsParserStateObject stateObj, Boolean callerHasConnectionLock, Boolean asyncClose)
   at Microsoft.Data.SqlClient.TdsParser.TryRun(RunBehavior runBehavior, SqlCommand cmdHandler, SqlDataReader dataStream, BulkCopySimpleResultSet bulkCopyHandler, TdsParserStateObject stateObj, Boolean& dataReady)
   at Microsoft.Data.SqlClient.SqlDataReader.TryHasMoreRows(Boolean& moreRows)
   at Microsoft.Data.SqlClient.SqlDataReader.TryReadInternal(Boolean setTimeout, Boolean& more)
   at Microsoft.Data.SqlClient.SqlDataReader.ReadAsyncExecute(Task task, Object state)
   at Microsoft.Data.SqlClient.SqlDataReader.InvokeAsyncCall[T](SqlDataReaderBaseAsyncCallContext`1 context)
--- End of stack trace from previous location ---
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeResultSetAsync(Int32 startCommandIndex, RelationalDataReader reader, CancellationToken cancellationToken)
ClientConnectionId:20e2460a-ecb1-48bb-bb7f-cd9effff34c3
Error Number:547,State:0,Class:16
   --- End of inner exception stack trace ---
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeResultSetAsync(Int32 startCommandIndex, RelationalDataReader reader, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeAsync(RelationalDataReader reader, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Update.Internal.SqlServerModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(IList`1 entriesToSave, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(StateManager stateManager, Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Storage.Internal.SqlServerExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
Microsoft.EntityFrameworkCore.DbUpdateException: An error occurred while saving the entity changes. See the inner exception for details.
 ---> Microsoft.Data.SqlClient.SqlException (0x80131904): The INSERT statement conflicted with the FOREIGN KEY constraint "FK_AuthLogs_Customers_NationalId". The conflict occurred in database "NayifatApp", table "dbo.Customers", column 'NationalId'.
   at Microsoft.Data.SqlClient.SqlConnection.OnError(SqlException exception, Boolean breakConnection, Action`1 wrapCloseInAction)
   at Microsoft.Data.SqlClient.SqlInternalConnection.OnError(SqlException exception, Boolean breakConnection, Action`1 wrapCloseInAction)
   at Microsoft.Data.SqlClient.TdsParser.ThrowExceptionAndWarning(TdsParserStateObject stateObj, Boolean callerHasConnectionLock, Boolean asyncClose)
   at Microsoft.Data.SqlClient.TdsParser.TryRun(RunBehavior runBehavior, SqlCommand cmdHandler, SqlDataReader dataStream, BulkCopySimpleResultSet bulkCopyHandler, TdsParserStateObject stateObj, Boolean& dataReady)
   at Microsoft.Data.SqlClient.SqlDataReader.TryHasMoreRows(Boolean& moreRows)
   at Microsoft.Data.SqlClient.SqlDataReader.TryReadInternal(Boolean setTimeout, Boolean& more)
   at Microsoft.Data.SqlClient.SqlDataReader.ReadAsyncExecute(Task task, Object state)
   at Microsoft.Data.SqlClient.SqlDataReader.InvokeAsyncCall[T](SqlDataReaderBaseAsyncCallContext`1 context)
--- End of stack trace from previous location ---
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeResultSetAsync(Int32 startCommandIndex, RelationalDataReader reader, CancellationToken cancellationToken)
ClientConnectionId:20e2460a-ecb1-48bb-bb7f-cd9effff34c3
Error Number:547,State:0,Class:16
   --- End of inner exception stack trace ---
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeResultSetAsync(Int32 startCommandIndex, RelationalDataReader reader, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeAsync(RelationalDataReader reader, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Update.Internal.SqlServerModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(IList`1 entriesToSave, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(StateManager stateManager, Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Storage.Internal.SqlServerExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
2025-02-02 23:36:45.915 +03:00 [ERR] Error during sign in for National ID: 1555552
Microsoft.EntityFrameworkCore.DbUpdateException: An error occurred while saving the entity changes. See the inner exception for details.
 ---> Microsoft.Data.SqlClient.SqlException (0x80131904): The INSERT statement conflicted with the FOREIGN KEY constraint "FK_AuthLogs_Customers_NationalId". The conflict occurred in database "NayifatApp", table "dbo.Customers", column 'NationalId'.
   at Microsoft.Data.SqlClient.SqlConnection.OnError(SqlException exception, Boolean breakConnection, Action`1 wrapCloseInAction)
   at Microsoft.Data.SqlClient.SqlInternalConnection.OnError(SqlException exception, Boolean breakConnection, Action`1 wrapCloseInAction)
   at Microsoft.Data.SqlClient.TdsParser.ThrowExceptionAndWarning(TdsParserStateObject stateObj, Boolean callerHasConnectionLock, Boolean asyncClose)
   at Microsoft.Data.SqlClient.TdsParser.TryRun(RunBehavior runBehavior, SqlCommand cmdHandler, SqlDataReader dataStream, BulkCopySimpleResultSet bulkCopyHandler, TdsParserStateObject stateObj, Boolean& dataReady)
   at Microsoft.Data.SqlClient.SqlDataReader.TryHasMoreRows(Boolean& moreRows)
   at Microsoft.Data.SqlClient.SqlDataReader.TryReadInternal(Boolean setTimeout, Boolean& more)
   at Microsoft.Data.SqlClient.SqlDataReader.ReadAsyncExecute(Task task, Object state)
   at Microsoft.Data.SqlClient.SqlDataReader.InvokeAsyncCall[T](SqlDataReaderBaseAsyncCallContext`1 context)
--- End of stack trace from previous location ---
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeResultSetAsync(Int32 startCommandIndex, RelationalDataReader reader, CancellationToken cancellationToken)
ClientConnectionId:20e2460a-ecb1-48bb-bb7f-cd9effff34c3
Error Number:547,State:0,Class:16
   --- End of inner exception stack trace ---
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeResultSetAsync(Int32 startCommandIndex, RelationalDataReader reader, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeAsync(RelationalDataReader reader, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Update.Internal.SqlServerModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(IList`1 entriesToSave, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(StateManager stateManager, Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Storage.Internal.SqlServerExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at NayifatAPI.Controllers.AuthController.LogAuthAttempt(String nationalId, String deviceId, String status, String failureReason) in C:\Users\yamta\StudioProjects\nayifat_app_2025_new\nayifatapi\Controllers\AuthController.cs:line 367
   at NayifatAPI.Controllers.AuthController.SignIn(SignInRequest request) in C:\Users\yamta\StudioProjects\nayifat_app_2025_new\nayifatapi\Controllers\AuthController.cs:line 41
2025-02-02 23:36:45.925 +03:00 [INF] Executed DbCommand (2ms) [Parameters=[@p0='?' (Size = 4000), @p1='?' (DbType = DateTime2), @p2='?' (Size = 4000), @p3='?' (Size = 4000), @p4='?' (Size = 4000), @p5='?' (Size = 450), @p6='?' (Size = 4000), @p7='?' (Size = 4000), @p8='?' (Size = 4000), @p9='?' (DbType = DateTime2), @p10='?' (Size = 4000), @p11='?' (Size = 4000), @p12='?' (Size = 4000), @p13='?' (Size = 450), @p14='?' (Size = 4000), @p15='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SET IMPLICIT_TRANSACTIONS OFF;
SET NOCOUNT ON;
MERGE [AuthLogs] USING (
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7, 0),
(@p8, @p9, @p10, @p11, @p12, @p13, @p14, @p15, 1)) AS i ([AuthType], [CreatedAt], [DeviceId], [FailureReason], [IpAddress], [NationalId], [Status], [UserAgent], _Position) ON 1=0
WHEN NOT MATCHED THEN
INSERT ([AuthType], [CreatedAt], [DeviceId], [FailureReason], [IpAddress], [NationalId], [Status], [UserAgent])
VALUES (i.[AuthType], i.[CreatedAt], i.[DeviceId], i.[FailureReason], i.[IpAddress], i.[NationalId], i.[Status], i.[UserAgent])
OUTPUT INSERTED.[Id], i._Position;
2025-02-02 23:36:45.929 +03:00 [ERR] An exception occurred in the database while saving changes for context type 'NayifatAPI.Data.ApplicationDbContext'.
Microsoft.EntityFrameworkCore.DbUpdateException: An error occurred while saving the entity changes. See the inner exception for details.
 ---> Microsoft.Data.SqlClient.SqlException (0x80131904): The MERGE statement conflicted with the FOREIGN KEY constraint "FK_AuthLogs_Customers_NationalId". The conflict occurred in database "NayifatApp", table "dbo.Customers", column 'NationalId'.
   at Microsoft.Data.SqlClient.SqlConnection.OnError(SqlException exception, Boolean breakConnection, Action`1 wrapCloseInAction)
   at Microsoft.Data.SqlClient.SqlInternalConnection.OnError(SqlException exception, Boolean breakConnection, Action`1 wrapCloseInAction)
   at Microsoft.Data.SqlClient.TdsParser.ThrowExceptionAndWarning(TdsParserStateObject stateObj, Boolean callerHasConnectionLock, Boolean asyncClose)
   at Microsoft.Data.SqlClient.TdsParser.TryRun(RunBehavior runBehavior, SqlCommand cmdHandler, SqlDataReader dataStream, BulkCopySimpleResultSet bulkCopyHandler, TdsParserStateObject stateObj, Boolean& dataReady)
   at Microsoft.Data.SqlClient.SqlDataReader.TryHasMoreRows(Boolean& moreRows)
   at Microsoft.Data.SqlClient.SqlDataReader.TryReadInternal(Boolean setTimeout, Boolean& more)
   at Microsoft.Data.SqlClient.SqlDataReader.ReadAsyncExecute(Task task, Object state)
   at Microsoft.Data.SqlClient.SqlDataReader.InvokeAsyncCall[T](SqlDataReaderBaseAsyncCallContext`1 context)
--- End of stack trace from previous location ---
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeResultSetAsync(Int32 startCommandIndex, RelationalDataReader reader, CancellationToken cancellationToken)
ClientConnectionId:20e2460a-ecb1-48bb-bb7f-cd9effff34c3
Error Number:547,State:0,Class:16
   --- End of inner exception stack trace ---
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeResultSetAsync(Int32 startCommandIndex, RelationalDataReader reader, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeAsync(RelationalDataReader reader, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Update.Internal.SqlServerModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(IList`1 entriesToSave, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(StateManager stateManager, Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Storage.Internal.SqlServerExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
Microsoft.EntityFrameworkCore.DbUpdateException: An error occurred while saving the entity changes. See the inner exception for details.
 ---> Microsoft.Data.SqlClient.SqlException (0x80131904): The MERGE statement conflicted with the FOREIGN KEY constraint "FK_AuthLogs_Customers_NationalId". The conflict occurred in database "NayifatApp", table "dbo.Customers", column 'NationalId'.
   at Microsoft.Data.SqlClient.SqlConnection.OnError(SqlException exception, Boolean breakConnection, Action`1 wrapCloseInAction)
   at Microsoft.Data.SqlClient.SqlInternalConnection.OnError(SqlException exception, Boolean breakConnection, Action`1 wrapCloseInAction)
   at Microsoft.Data.SqlClient.TdsParser.ThrowExceptionAndWarning(TdsParserStateObject stateObj, Boolean callerHasConnectionLock, Boolean asyncClose)
   at Microsoft.Data.SqlClient.TdsParser.TryRun(RunBehavior runBehavior, SqlCommand cmdHandler, SqlDataReader dataStream, BulkCopySimpleResultSet bulkCopyHandler, TdsParserStateObject stateObj, Boolean& dataReady)
   at Microsoft.Data.SqlClient.SqlDataReader.TryHasMoreRows(Boolean& moreRows)
   at Microsoft.Data.SqlClient.SqlDataReader.TryReadInternal(Boolean setTimeout, Boolean& more)
   at Microsoft.Data.SqlClient.SqlDataReader.ReadAsyncExecute(Task task, Object state)
   at Microsoft.Data.SqlClient.SqlDataReader.InvokeAsyncCall[T](SqlDataReaderBaseAsyncCallContext`1 context)
--- End of stack trace from previous location ---
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeResultSetAsync(Int32 startCommandIndex, RelationalDataReader reader, CancellationToken cancellationToken)
ClientConnectionId:20e2460a-ecb1-48bb-bb7f-cd9effff34c3
Error Number:547,State:0,Class:16
   --- End of inner exception stack trace ---
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeResultSetAsync(Int32 startCommandIndex, RelationalDataReader reader, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeAsync(RelationalDataReader reader, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Update.Internal.SqlServerModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(IList`1 entriesToSave, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(StateManager stateManager, Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Storage.Internal.SqlServerExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
2025-02-02 23:36:45.942 +03:00 [INF] Executed action NayifatAPI.Controllers.AuthController.SignIn (NayifatAPI) in 44.7516ms
2025-02-02 23:36:45.944 +03:00 [INF] Executed endpoint 'NayifatAPI.Controllers.AuthController.SignIn (NayifatAPI)'
2025-02-02 23:36:45.944 +03:00 [ERR] Unhandled exception
Microsoft.EntityFrameworkCore.DbUpdateException: An error occurred while saving the entity changes. See the inner exception for details.
 ---> Microsoft.Data.SqlClient.SqlException (0x80131904): The MERGE statement conflicted with the FOREIGN KEY constraint "FK_AuthLogs_Customers_NationalId". The conflict occurred in database "NayifatApp", table "dbo.Customers", column 'NationalId'.
   at Microsoft.Data.SqlClient.SqlConnection.OnError(SqlException exception, Boolean breakConnection, Action`1 wrapCloseInAction)
   at Microsoft.Data.SqlClient.SqlInternalConnection.OnError(SqlException exception, Boolean breakConnection, Action`1 wrapCloseInAction)
   at Microsoft.Data.SqlClient.TdsParser.ThrowExceptionAndWarning(TdsParserStateObject stateObj, Boolean callerHasConnectionLock, Boolean asyncClose)
   at Microsoft.Data.SqlClient.TdsParser.TryRun(RunBehavior runBehavior, SqlCommand cmdHandler, SqlDataReader dataStream, BulkCopySimpleResultSet bulkCopyHandler, TdsParserStateObject stateObj, Boolean& dataReady)
   at Microsoft.Data.SqlClient.SqlDataReader.TryHasMoreRows(Boolean& moreRows)
   at Microsoft.Data.SqlClient.SqlDataReader.TryReadInternal(Boolean setTimeout, Boolean& more)
   at Microsoft.Data.SqlClient.SqlDataReader.ReadAsyncExecute(Task task, Object state)
   at Microsoft.Data.SqlClient.SqlDataReader.InvokeAsyncCall[T](SqlDataReaderBaseAsyncCallContext`1 context)
--- End of stack trace from previous location ---
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeResultSetAsync(Int32 startCommandIndex, RelationalDataReader reader, CancellationToken cancellationToken)
ClientConnectionId:20e2460a-ecb1-48bb-bb7f-cd9effff34c3
Error Number:547,State:0,Class:16
   --- End of inner exception stack trace ---
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeResultSetAsync(Int32 startCommandIndex, RelationalDataReader reader, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeAsync(RelationalDataReader reader, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Update.Internal.SqlServerModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(IList`1 entriesToSave, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(StateManager stateManager, Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Storage.Internal.SqlServerExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at NayifatAPI.Controllers.AuthController.LogAuthAttempt(String nationalId, String deviceId, String status, String failureReason) in C:\Users\yamta\StudioProjects\nayifat_app_2025_new\nayifatapi\Controllers\AuthController.cs:line 367
   at NayifatAPI.Controllers.AuthController.SignIn(SignInRequest request) in C:\Users\yamta\StudioProjects\nayifat_app_2025_new\nayifatapi\Controllers\AuthController.cs:line 103
   at Microsoft.AspNetCore.Mvc.Infrastructure.ActionMethodExecutor.TaskOfIActionResultExecutor.Execute(ActionContext actionContext, IActionResultTypeMapper mapper, ObjectMethodExecutor executor, Object controller, Object[] arguments)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.<InvokeActionMethodAsync>g__Awaited|12_0(ControllerActionInvoker invoker, ValueTask`1 actionResultValueTask)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.<InvokeNextActionFilterAsync>g__Awaited|10_0(ControllerActionInvoker invoker, Task lastTask, State next, Scope scope, Object state, Boolean isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.Rethrow(ActionExecutedContextSealed context)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.Next(State& next, Scope& scope, Object& state, Boolean& isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.<InvokeInnerFilterAsync>g__Awaited|13_0(ControllerActionInvoker invoker, Task lastTask, State next, Scope scope, Object state, Boolean isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeFilterPipelineAsync>g__Awaited|20_0(ResourceInvoker invoker, Task lastTask, State next, Scope scope, Object state, Boolean isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeAsync>g__Logged|17_1(ResourceInvoker invoker)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeAsync>g__Logged|17_1(ResourceInvoker invoker)
   at Microsoft.AspNetCore.Routing.EndpointMiddleware.<Invoke>g__AwaitRequestTask|7_0(Endpoint endpoint, Task requestTask, ILogger logger)
   at Microsoft.AspNetCore.Authorization.AuthorizationMiddleware.Invoke(HttpContext context)
   at Program.<>c.<<<Main>$>b__0_3>d.MoveNext() in C:\Users\yamta\StudioProjects\nayifat_app_2025_new\nayifatapi\Program.cs:line 85
2025-02-02 23:36:45.960 +03:00 [ERR] An unhandled exception has occurred while executing the request.
Microsoft.EntityFrameworkCore.DbUpdateException: An error occurred while saving the entity changes. See the inner exception for details.
 ---> Microsoft.Data.SqlClient.SqlException (0x80131904): The MERGE statement conflicted with the FOREIGN KEY constraint "FK_AuthLogs_Customers_NationalId". The conflict occurred in database "NayifatApp", table "dbo.Customers", column 'NationalId'.
   at Microsoft.Data.SqlClient.SqlConnection.OnError(SqlException exception, Boolean breakConnection, Action`1 wrapCloseInAction)
   at Microsoft.Data.SqlClient.SqlInternalConnection.OnError(SqlException exception, Boolean breakConnection, Action`1 wrapCloseInAction)
   at Microsoft.Data.SqlClient.TdsParser.ThrowExceptionAndWarning(TdsParserStateObject stateObj, Boolean callerHasConnectionLock, Boolean asyncClose)
   at Microsoft.Data.SqlClient.TdsParser.TryRun(RunBehavior runBehavior, SqlCommand cmdHandler, SqlDataReader dataStream, BulkCopySimpleResultSet bulkCopyHandler, TdsParserStateObject stateObj, Boolean& dataReady)
   at Microsoft.Data.SqlClient.SqlDataReader.TryHasMoreRows(Boolean& moreRows)
   at Microsoft.Data.SqlClient.SqlDataReader.TryReadInternal(Boolean setTimeout, Boolean& more)
   at Microsoft.Data.SqlClient.SqlDataReader.ReadAsyncExecute(Task task, Object state)
   at Microsoft.Data.SqlClient.SqlDataReader.InvokeAsyncCall[T](SqlDataReaderBaseAsyncCallContext`1 context)
--- End of stack trace from previous location ---
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeResultSetAsync(Int32 startCommandIndex, RelationalDataReader reader, CancellationToken cancellationToken)
ClientConnectionId:20e2460a-ecb1-48bb-bb7f-cd9effff34c3
Error Number:547,State:0,Class:16
   --- End of inner exception stack trace ---
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeResultSetAsync(Int32 startCommandIndex, RelationalDataReader reader, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeAsync(RelationalDataReader reader, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Update.Internal.SqlServerModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(IList`1 entriesToSave, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(StateManager stateManager, Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Storage.Internal.SqlServerExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at NayifatAPI.Controllers.AuthController.LogAuthAttempt(String nationalId, String deviceId, String status, String failureReason) in C:\Users\yamta\StudioProjects\nayifat_app_2025_new\nayifatapi\Controllers\AuthController.cs:line 367
   at NayifatAPI.Controllers.AuthController.SignIn(SignInRequest request) in C:\Users\yamta\StudioProjects\nayifat_app_2025_new\nayifatapi\Controllers\AuthController.cs:line 103
   at Microsoft.AspNetCore.Mvc.Infrastructure.ActionMethodExecutor.TaskOfIActionResultExecutor.Execute(ActionContext actionContext, IActionResultTypeMapper mapper, ObjectMethodExecutor executor, Object controller, Object[] arguments)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.<InvokeActionMethodAsync>g__Awaited|12_0(ControllerActionInvoker invoker, ValueTask`1 actionResultValueTask)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.<InvokeNextActionFilterAsync>g__Awaited|10_0(ControllerActionInvoker invoker, Task lastTask, State next, Scope scope, Object state, Boolean isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.Rethrow(ActionExecutedContextSealed context)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.Next(State& next, Scope& scope, Object& state, Boolean& isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.<InvokeInnerFilterAsync>g__Awaited|13_0(ControllerActionInvoker invoker, Task lastTask, State next, Scope scope, Object state, Boolean isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeFilterPipelineAsync>g__Awaited|20_0(ResourceInvoker invoker, Task lastTask, State next, Scope scope, Object state, Boolean isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeAsync>g__Logged|17_1(ResourceInvoker invoker)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeAsync>g__Logged|17_1(ResourceInvoker invoker)
   at Microsoft.AspNetCore.Routing.EndpointMiddleware.<Invoke>g__AwaitRequestTask|7_0(Endpoint endpoint, Task requestTask, ILogger logger)
   at Microsoft.AspNetCore.Authorization.AuthorizationMiddleware.Invoke(HttpContext context)
   at Program.<>c.<<<Main>$>b__0_3>d.MoveNext() in C:\Users\yamta\StudioProjects\nayifat_app_2025_new\nayifatapi\Program.cs:line 85
--- End of stack trace from previous location ---
   at Swashbuckle.AspNetCore.SwaggerUI.SwaggerUIMiddleware.Invoke(HttpContext httpContext)
   at Swashbuckle.AspNetCore.Swagger.SwaggerMiddleware.Invoke(HttpContext httpContext, ISwaggerProvider swaggerProvider)
   at Microsoft.AspNetCore.Authentication.AuthenticationMiddleware.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Diagnostics.DeveloperExceptionPageMiddlewareImpl.Invoke(HttpContext context)
2025-02-02 23:36:45.977 +03:00 [INF] Request finished HTTP/1.1 POST http://07ca-46-152-255-232.ngrok-free.app/api/auth/signin - 500 null text/plain; charset=utf-8 84.5937ms
2025-02-02 23:37:01.406 +03:00 [INF] Request starting HTTP/1.1 POST http://07ca-46-152-255-232.ngrok-free.app/api/auth/signin - application/json; charset=utf-8 70
2025-02-02 23:37:01.409 +03:00 [INF] Executing endpoint 'NayifatAPI.Controllers.AuthController.SignIn (NayifatAPI)'
2025-02-02 23:37:01.410 +03:00 [INF] Route matched with {action = "SignIn", controller = "Auth"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] SignIn(NayifatAPI.Controllers.SignInRequest) on controller NayifatAPI.Controllers.AuthController (NayifatAPI).
2025-02-02 23:37:01.419 +03:00 [INF] Executed DbCommand (4ms) [Parameters=[@__providedApiKey_0='?' (Size = 255)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [a].[Key], [a].[CreatedAt], [a].[Description], [a].[ExpiresAt], [a].[IsActive], [a].[LastUsedAt]
FROM [ApiKeys] AS [a]
WHERE [a].[Key] = @__providedApiKey_0 AND [a].[IsActive] = CAST(1 AS bit)
2025-02-02 23:37:01.429 +03:00 [INF] Executed DbCommand (7ms) [Parameters=[@__request_NationalId_0='?' (Size = 450)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [c].[NationalId], [c].[AddNo], [c].[BuildingNo], [c].[City], [c].[Consent], [c].[ConsentDate], [c].[DateOfBirth], [c].[Dependents], [c].[District], [c].[Email], [c].[Employer], [c].[FamilyNameAr], [c].[FamilyNameEn], [c].[FirstNameAr], [c].[FirstNameEn], [c].[Iban], [c].[IdExpiryDate], [c].[Los], [c].[Mpin], [c].[MpinEnabled], [c].[NafathStatus], [c].[NafathTimestamp], [c].[Password], [c].[Phone], [c].[RegistrationDate], [c].[SalaryCustomer], [c].[SalaryDakhli], [c].[SecondNameAr], [c].[SecondNameEn], [c].[Sector], [c].[Street], [c].[ThirdNameAr], [c].[ThirdNameEn], [c].[Zipcode]
FROM [Customers] AS [c]
WHERE [c].[NationalId] = @__request_NationalId_0
2025-02-02 23:37:01.460 +03:00 [INF] Executed DbCommand (4ms) [Parameters=[@p0='?' (Size = 4000), @p1='?' (DbType = DateTime2), @p2='?' (Size = 4000), @p3='?' (Size = 4000), @p4='?' (Size = 4000), @p5='?' (Size = 450), @p6='?' (Size = 4000), @p7='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SET IMPLICIT_TRANSACTIONS OFF;
SET NOCOUNT ON;
INSERT INTO [AuthLogs] ([AuthType], [CreatedAt], [DeviceId], [FailureReason], [IpAddress], [NationalId], [Status], [UserAgent])
OUTPUT INSERTED.[Id]
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7);
2025-02-02 23:37:01.464 +03:00 [ERR] An exception occurred in the database while saving changes for context type 'NayifatAPI.Data.ApplicationDbContext'.
Microsoft.EntityFrameworkCore.DbUpdateException: An error occurred while saving the entity changes. See the inner exception for details.
 ---> Microsoft.Data.SqlClient.SqlException (0x80131904): The INSERT statement conflicted with the FOREIGN KEY constraint "FK_AuthLogs_Customers_NationalId". The conflict occurred in database "NayifatApp", table "dbo.Customers", column 'NationalId'.
   at Microsoft.Data.SqlClient.SqlConnection.OnError(SqlException exception, Boolean breakConnection, Action`1 wrapCloseInAction)
   at Microsoft.Data.SqlClient.SqlInternalConnection.OnError(SqlException exception, Boolean breakConnection, Action`1 wrapCloseInAction)
   at Microsoft.Data.SqlClient.TdsParser.ThrowExceptionAndWarning(TdsParserStateObject stateObj, Boolean callerHasConnectionLock, Boolean asyncClose)
   at Microsoft.Data.SqlClient.TdsParser.TryRun(RunBehavior runBehavior, SqlCommand cmdHandler, SqlDataReader dataStream, BulkCopySimpleResultSet bulkCopyHandler, TdsParserStateObject stateObj, Boolean& dataReady)
   at Microsoft.Data.SqlClient.SqlDataReader.TryHasMoreRows(Boolean& moreRows)
   at Microsoft.Data.SqlClient.SqlDataReader.TryReadInternal(Boolean setTimeout, Boolean& more)
   at Microsoft.Data.SqlClient.SqlDataReader.ReadAsyncExecute(Task task, Object state)
   at Microsoft.Data.SqlClient.SqlDataReader.InvokeAsyncCall[T](SqlDataReaderBaseAsyncCallContext`1 context)
--- End of stack trace from previous location ---
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeResultSetAsync(Int32 startCommandIndex, RelationalDataReader reader, CancellationToken cancellationToken)
ClientConnectionId:20e2460a-ecb1-48bb-bb7f-cd9effff34c3
Error Number:547,State:0,Class:16
   --- End of inner exception stack trace ---
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeResultSetAsync(Int32 startCommandIndex, RelationalDataReader reader, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeAsync(RelationalDataReader reader, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Update.Internal.SqlServerModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(IList`1 entriesToSave, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(StateManager stateManager, Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Storage.Internal.SqlServerExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
Microsoft.EntityFrameworkCore.DbUpdateException: An error occurred while saving the entity changes. See the inner exception for details.
 ---> Microsoft.Data.SqlClient.SqlException (0x80131904): The INSERT statement conflicted with the FOREIGN KEY constraint "FK_AuthLogs_Customers_NationalId". The conflict occurred in database "NayifatApp", table "dbo.Customers", column 'NationalId'.
   at Microsoft.Data.SqlClient.SqlConnection.OnError(SqlException exception, Boolean breakConnection, Action`1 wrapCloseInAction)
   at Microsoft.Data.SqlClient.SqlInternalConnection.OnError(SqlException exception, Boolean breakConnection, Action`1 wrapCloseInAction)
   at Microsoft.Data.SqlClient.TdsParser.ThrowExceptionAndWarning(TdsParserStateObject stateObj, Boolean callerHasConnectionLock, Boolean asyncClose)
   at Microsoft.Data.SqlClient.TdsParser.TryRun(RunBehavior runBehavior, SqlCommand cmdHandler, SqlDataReader dataStream, BulkCopySimpleResultSet bulkCopyHandler, TdsParserStateObject stateObj, Boolean& dataReady)
   at Microsoft.Data.SqlClient.SqlDataReader.TryHasMoreRows(Boolean& moreRows)
   at Microsoft.Data.SqlClient.SqlDataReader.TryReadInternal(Boolean setTimeout, Boolean& more)
   at Microsoft.Data.SqlClient.SqlDataReader.ReadAsyncExecute(Task task, Object state)
   at Microsoft.Data.SqlClient.SqlDataReader.InvokeAsyncCall[T](SqlDataReaderBaseAsyncCallContext`1 context)
--- End of stack trace from previous location ---
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeResultSetAsync(Int32 startCommandIndex, RelationalDataReader reader, CancellationToken cancellationToken)
ClientConnectionId:20e2460a-ecb1-48bb-bb7f-cd9effff34c3
Error Number:547,State:0,Class:16
   --- End of inner exception stack trace ---
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeResultSetAsync(Int32 startCommandIndex, RelationalDataReader reader, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeAsync(RelationalDataReader reader, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Update.Internal.SqlServerModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(IList`1 entriesToSave, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(StateManager stateManager, Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Storage.Internal.SqlServerExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
2025-02-02 23:37:01.480 +03:00 [ERR] Error during sign in for National ID: 1555552
Microsoft.EntityFrameworkCore.DbUpdateException: An error occurred while saving the entity changes. See the inner exception for details.
 ---> Microsoft.Data.SqlClient.SqlException (0x80131904): The INSERT statement conflicted with the FOREIGN KEY constraint "FK_AuthLogs_Customers_NationalId". The conflict occurred in database "NayifatApp", table "dbo.Customers", column 'NationalId'.
   at Microsoft.Data.SqlClient.SqlConnection.OnError(SqlException exception, Boolean breakConnection, Action`1 wrapCloseInAction)
   at Microsoft.Data.SqlClient.SqlInternalConnection.OnError(SqlException exception, Boolean breakConnection, Action`1 wrapCloseInAction)
   at Microsoft.Data.SqlClient.TdsParser.ThrowExceptionAndWarning(TdsParserStateObject stateObj, Boolean callerHasConnectionLock, Boolean asyncClose)
   at Microsoft.Data.SqlClient.TdsParser.TryRun(RunBehavior runBehavior, SqlCommand cmdHandler, SqlDataReader dataStream, BulkCopySimpleResultSet bulkCopyHandler, TdsParserStateObject stateObj, Boolean& dataReady)
   at Microsoft.Data.SqlClient.SqlDataReader.TryHasMoreRows(Boolean& moreRows)
   at Microsoft.Data.SqlClient.SqlDataReader.TryReadInternal(Boolean setTimeout, Boolean& more)
   at Microsoft.Data.SqlClient.SqlDataReader.ReadAsyncExecute(Task task, Object state)
   at Microsoft.Data.SqlClient.SqlDataReader.InvokeAsyncCall[T](SqlDataReaderBaseAsyncCallContext`1 context)
--- End of stack trace from previous location ---
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeResultSetAsync(Int32 startCommandIndex, RelationalDataReader reader, CancellationToken cancellationToken)
ClientConnectionId:20e2460a-ecb1-48bb-bb7f-cd9effff34c3
Error Number:547,State:0,Class:16
   --- End of inner exception stack trace ---
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeResultSetAsync(Int32 startCommandIndex, RelationalDataReader reader, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeAsync(RelationalDataReader reader, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Update.Internal.SqlServerModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(IList`1 entriesToSave, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(StateManager stateManager, Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Storage.Internal.SqlServerExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at NayifatAPI.Controllers.AuthController.LogAuthAttempt(String nationalId, String deviceId, String status, String failureReason) in C:\Users\yamta\StudioProjects\nayifat_app_2025_new\nayifatapi\Controllers\AuthController.cs:line 367
   at NayifatAPI.Controllers.AuthController.SignIn(SignInRequest request) in C:\Users\yamta\StudioProjects\nayifat_app_2025_new\nayifatapi\Controllers\AuthController.cs:line 41
2025-02-02 23:37:01.500 +03:00 [INF] Executed DbCommand (8ms) [Parameters=[@p0='?' (Size = 4000), @p1='?' (DbType = DateTime2), @p2='?' (Size = 4000), @p3='?' (Size = 4000), @p4='?' (Size = 4000), @p5='?' (Size = 450), @p6='?' (Size = 4000), @p7='?' (Size = 4000), @p8='?' (Size = 4000), @p9='?' (DbType = DateTime2), @p10='?' (Size = 4000), @p11='?' (Size = 4000), @p12='?' (Size = 4000), @p13='?' (Size = 450), @p14='?' (Size = 4000), @p15='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SET IMPLICIT_TRANSACTIONS OFF;
SET NOCOUNT ON;
MERGE [AuthLogs] USING (
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7, 0),
(@p8, @p9, @p10, @p11, @p12, @p13, @p14, @p15, 1)) AS i ([AuthType], [CreatedAt], [DeviceId], [FailureReason], [IpAddress], [NationalId], [Status], [UserAgent], _Position) ON 1=0
WHEN NOT MATCHED THEN
INSERT ([AuthType], [CreatedAt], [DeviceId], [FailureReason], [IpAddress], [NationalId], [Status], [UserAgent])
VALUES (i.[AuthType], i.[CreatedAt], i.[DeviceId], i.[FailureReason], i.[IpAddress], i.[NationalId], i.[Status], i.[UserAgent])
OUTPUT INSERTED.[Id], i._Position;
2025-02-02 23:37:01.505 +03:00 [ERR] An exception occurred in the database while saving changes for context type 'NayifatAPI.Data.ApplicationDbContext'.
Microsoft.EntityFrameworkCore.DbUpdateException: An error occurred while saving the entity changes. See the inner exception for details.
 ---> Microsoft.Data.SqlClient.SqlException (0x80131904): The MERGE statement conflicted with the FOREIGN KEY constraint "FK_AuthLogs_Customers_NationalId". The conflict occurred in database "NayifatApp", table "dbo.Customers", column 'NationalId'.
   at Microsoft.Data.SqlClient.SqlConnection.OnError(SqlException exception, Boolean breakConnection, Action`1 wrapCloseInAction)
   at Microsoft.Data.SqlClient.SqlInternalConnection.OnError(SqlException exception, Boolean breakConnection, Action`1 wrapCloseInAction)
   at Microsoft.Data.SqlClient.TdsParser.ThrowExceptionAndWarning(TdsParserStateObject stateObj, Boolean callerHasConnectionLock, Boolean asyncClose)
   at Microsoft.Data.SqlClient.TdsParser.TryRun(RunBehavior runBehavior, SqlCommand cmdHandler, SqlDataReader dataStream, BulkCopySimpleResultSet bulkCopyHandler, TdsParserStateObject stateObj, Boolean& dataReady)
   at Microsoft.Data.SqlClient.SqlDataReader.TryHasMoreRows(Boolean& moreRows)
   at Microsoft.Data.SqlClient.SqlDataReader.TryReadInternal(Boolean setTimeout, Boolean& more)
   at Microsoft.Data.SqlClient.SqlDataReader.ReadAsyncExecute(Task task, Object state)
   at Microsoft.Data.SqlClient.SqlDataReader.InvokeAsyncCall[T](SqlDataReaderBaseAsyncCallContext`1 context)
--- End of stack trace from previous location ---
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeResultSetAsync(Int32 startCommandIndex, RelationalDataReader reader, CancellationToken cancellationToken)
ClientConnectionId:20e2460a-ecb1-48bb-bb7f-cd9effff34c3
Error Number:547,State:0,Class:16
   --- End of inner exception stack trace ---
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeResultSetAsync(Int32 startCommandIndex, RelationalDataReader reader, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeAsync(RelationalDataReader reader, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Update.Internal.SqlServerModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(IList`1 entriesToSave, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(StateManager stateManager, Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Storage.Internal.SqlServerExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
Microsoft.EntityFrameworkCore.DbUpdateException: An error occurred while saving the entity changes. See the inner exception for details.
 ---> Microsoft.Data.SqlClient.SqlException (0x80131904): The MERGE statement conflicted with the FOREIGN KEY constraint "FK_AuthLogs_Customers_NationalId". The conflict occurred in database "NayifatApp", table "dbo.Customers", column 'NationalId'.
   at Microsoft.Data.SqlClient.SqlConnection.OnError(SqlException exception, Boolean breakConnection, Action`1 wrapCloseInAction)
   at Microsoft.Data.SqlClient.SqlInternalConnection.OnError(SqlException exception, Boolean breakConnection, Action`1 wrapCloseInAction)
   at Microsoft.Data.SqlClient.TdsParser.ThrowExceptionAndWarning(TdsParserStateObject stateObj, Boolean callerHasConnectionLock, Boolean asyncClose)
   at Microsoft.Data.SqlClient.TdsParser.TryRun(RunBehavior runBehavior, SqlCommand cmdHandler, SqlDataReader dataStream, BulkCopySimpleResultSet bulkCopyHandler, TdsParserStateObject stateObj, Boolean& dataReady)
   at Microsoft.Data.SqlClient.SqlDataReader.TryHasMoreRows(Boolean& moreRows)
   at Microsoft.Data.SqlClient.SqlDataReader.TryReadInternal(Boolean setTimeout, Boolean& more)
   at Microsoft.Data.SqlClient.SqlDataReader.ReadAsyncExecute(Task task, Object state)
   at Microsoft.Data.SqlClient.SqlDataReader.InvokeAsyncCall[T](SqlDataReaderBaseAsyncCallContext`1 context)
--- End of stack trace from previous location ---
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeResultSetAsync(Int32 startCommandIndex, RelationalDataReader reader, CancellationToken cancellationToken)
ClientConnectionId:20e2460a-ecb1-48bb-bb7f-cd9effff34c3
Error Number:547,State:0,Class:16
   --- End of inner exception stack trace ---
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeResultSetAsync(Int32 startCommandIndex, RelationalDataReader reader, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeAsync(RelationalDataReader reader, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Update.Internal.SqlServerModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(IList`1 entriesToSave, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(StateManager stateManager, Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Storage.Internal.SqlServerExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
2025-02-02 23:37:01.523 +03:00 [INF] Executed action NayifatAPI.Controllers.AuthController.SignIn (NayifatAPI) in 110.1503ms
2025-02-02 23:37:01.524 +03:00 [INF] Executed endpoint 'NayifatAPI.Controllers.AuthController.SignIn (NayifatAPI)'
2025-02-02 23:37:01.525 +03:00 [ERR] Unhandled exception
Microsoft.EntityFrameworkCore.DbUpdateException: An error occurred while saving the entity changes. See the inner exception for details.
 ---> Microsoft.Data.SqlClient.SqlException (0x80131904): The MERGE statement conflicted with the FOREIGN KEY constraint "FK_AuthLogs_Customers_NationalId". The conflict occurred in database "NayifatApp", table "dbo.Customers", column 'NationalId'.
   at Microsoft.Data.SqlClient.SqlConnection.OnError(SqlException exception, Boolean breakConnection, Action`1 wrapCloseInAction)
   at Microsoft.Data.SqlClient.SqlInternalConnection.OnError(SqlException exception, Boolean breakConnection, Action`1 wrapCloseInAction)
   at Microsoft.Data.SqlClient.TdsParser.ThrowExceptionAndWarning(TdsParserStateObject stateObj, Boolean callerHasConnectionLock, Boolean asyncClose)
   at Microsoft.Data.SqlClient.TdsParser.TryRun(RunBehavior runBehavior, SqlCommand cmdHandler, SqlDataReader dataStream, BulkCopySimpleResultSet bulkCopyHandler, TdsParserStateObject stateObj, Boolean& dataReady)
   at Microsoft.Data.SqlClient.SqlDataReader.TryHasMoreRows(Boolean& moreRows)
   at Microsoft.Data.SqlClient.SqlDataReader.TryReadInternal(Boolean setTimeout, Boolean& more)
   at Microsoft.Data.SqlClient.SqlDataReader.ReadAsyncExecute(Task task, Object state)
   at Microsoft.Data.SqlClient.SqlDataReader.InvokeAsyncCall[T](SqlDataReaderBaseAsyncCallContext`1 context)
--- End of stack trace from previous location ---
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeResultSetAsync(Int32 startCommandIndex, RelationalDataReader reader, CancellationToken cancellationToken)
ClientConnectionId:20e2460a-ecb1-48bb-bb7f-cd9effff34c3
Error Number:547,State:0,Class:16
   --- End of inner exception stack trace ---
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeResultSetAsync(Int32 startCommandIndex, RelationalDataReader reader, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeAsync(RelationalDataReader reader, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Update.Internal.SqlServerModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(IList`1 entriesToSave, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(StateManager stateManager, Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Storage.Internal.SqlServerExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at NayifatAPI.Controllers.AuthController.LogAuthAttempt(String nationalId, String deviceId, String status, String failureReason) in C:\Users\yamta\StudioProjects\nayifat_app_2025_new\nayifatapi\Controllers\AuthController.cs:line 367
   at NayifatAPI.Controllers.AuthController.SignIn(SignInRequest request) in C:\Users\yamta\StudioProjects\nayifat_app_2025_new\nayifatapi\Controllers\AuthController.cs:line 103
   at Microsoft.AspNetCore.Mvc.Infrastructure.ActionMethodExecutor.TaskOfIActionResultExecutor.Execute(ActionContext actionContext, IActionResultTypeMapper mapper, ObjectMethodExecutor executor, Object controller, Object[] arguments)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.<InvokeActionMethodAsync>g__Awaited|12_0(ControllerActionInvoker invoker, ValueTask`1 actionResultValueTask)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.<InvokeNextActionFilterAsync>g__Awaited|10_0(ControllerActionInvoker invoker, Task lastTask, State next, Scope scope, Object state, Boolean isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.Rethrow(ActionExecutedContextSealed context)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.Next(State& next, Scope& scope, Object& state, Boolean& isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.<InvokeInnerFilterAsync>g__Awaited|13_0(ControllerActionInvoker invoker, Task lastTask, State next, Scope scope, Object state, Boolean isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeFilterPipelineAsync>g__Awaited|20_0(ResourceInvoker invoker, Task lastTask, State next, Scope scope, Object state, Boolean isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeAsync>g__Logged|17_1(ResourceInvoker invoker)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeAsync>g__Logged|17_1(ResourceInvoker invoker)
   at Microsoft.AspNetCore.Routing.EndpointMiddleware.<Invoke>g__AwaitRequestTask|7_0(Endpoint endpoint, Task requestTask, ILogger logger)
   at Microsoft.AspNetCore.Authorization.AuthorizationMiddleware.Invoke(HttpContext context)
   at Program.<>c.<<<Main>$>b__0_3>d.MoveNext() in C:\Users\yamta\StudioProjects\nayifat_app_2025_new\nayifatapi\Program.cs:line 85
2025-02-02 23:37:01.540 +03:00 [ERR] An unhandled exception has occurred while executing the request.
Microsoft.EntityFrameworkCore.DbUpdateException: An error occurred while saving the entity changes. See the inner exception for details.
 ---> Microsoft.Data.SqlClient.SqlException (0x80131904): The MERGE statement conflicted with the FOREIGN KEY constraint "FK_AuthLogs_Customers_NationalId". The conflict occurred in database "NayifatApp", table "dbo.Customers", column 'NationalId'.
   at Microsoft.Data.SqlClient.SqlConnection.OnError(SqlException exception, Boolean breakConnection, Action`1 wrapCloseInAction)
   at Microsoft.Data.SqlClient.SqlInternalConnection.OnError(SqlException exception, Boolean breakConnection, Action`1 wrapCloseInAction)
   at Microsoft.Data.SqlClient.TdsParser.ThrowExceptionAndWarning(TdsParserStateObject stateObj, Boolean callerHasConnectionLock, Boolean asyncClose)
   at Microsoft.Data.SqlClient.TdsParser.TryRun(RunBehavior runBehavior, SqlCommand cmdHandler, SqlDataReader dataStream, BulkCopySimpleResultSet bulkCopyHandler, TdsParserStateObject stateObj, Boolean& dataReady)
   at Microsoft.Data.SqlClient.SqlDataReader.TryHasMoreRows(Boolean& moreRows)
   at Microsoft.Data.SqlClient.SqlDataReader.TryReadInternal(Boolean setTimeout, Boolean& more)
   at Microsoft.Data.SqlClient.SqlDataReader.ReadAsyncExecute(Task task, Object state)
   at Microsoft.Data.SqlClient.SqlDataReader.InvokeAsyncCall[T](SqlDataReaderBaseAsyncCallContext`1 context)
--- End of stack trace from previous location ---
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeResultSetAsync(Int32 startCommandIndex, RelationalDataReader reader, CancellationToken cancellationToken)
ClientConnectionId:20e2460a-ecb1-48bb-bb7f-cd9effff34c3
Error Number:547,State:0,Class:16
   --- End of inner exception stack trace ---
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeResultSetAsync(Int32 startCommandIndex, RelationalDataReader reader, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeAsync(RelationalDataReader reader, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Update.Internal.SqlServerModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(IList`1 entriesToSave, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(StateManager stateManager, Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Storage.Internal.SqlServerExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at NayifatAPI.Controllers.AuthController.LogAuthAttempt(String nationalId, String deviceId, String status, String failureReason) in C:\Users\yamta\StudioProjects\nayifat_app_2025_new\nayifatapi\Controllers\AuthController.cs:line 367
   at NayifatAPI.Controllers.AuthController.SignIn(SignInRequest request) in C:\Users\yamta\StudioProjects\nayifat_app_2025_new\nayifatapi\Controllers\AuthController.cs:line 103
   at Microsoft.AspNetCore.Mvc.Infrastructure.ActionMethodExecutor.TaskOfIActionResultExecutor.Execute(ActionContext actionContext, IActionResultTypeMapper mapper, ObjectMethodExecutor executor, Object controller, Object[] arguments)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.<InvokeActionMethodAsync>g__Awaited|12_0(ControllerActionInvoker invoker, ValueTask`1 actionResultValueTask)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.<InvokeNextActionFilterAsync>g__Awaited|10_0(ControllerActionInvoker invoker, Task lastTask, State next, Scope scope, Object state, Boolean isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.Rethrow(ActionExecutedContextSealed context)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.Next(State& next, Scope& scope, Object& state, Boolean& isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.<InvokeInnerFilterAsync>g__Awaited|13_0(ControllerActionInvoker invoker, Task lastTask, State next, Scope scope, Object state, Boolean isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeFilterPipelineAsync>g__Awaited|20_0(ResourceInvoker invoker, Task lastTask, State next, Scope scope, Object state, Boolean isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeAsync>g__Logged|17_1(ResourceInvoker invoker)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeAsync>g__Logged|17_1(ResourceInvoker invoker)
   at Microsoft.AspNetCore.Routing.EndpointMiddleware.<Invoke>g__AwaitRequestTask|7_0(Endpoint endpoint, Task requestTask, ILogger logger)
   at Microsoft.AspNetCore.Authorization.AuthorizationMiddleware.Invoke(HttpContext context)
   at Program.<>c.<<<Main>$>b__0_3>d.MoveNext() in C:\Users\yamta\StudioProjects\nayifat_app_2025_new\nayifatapi\Program.cs:line 85
--- End of stack trace from previous location ---
   at Swashbuckle.AspNetCore.SwaggerUI.SwaggerUIMiddleware.Invoke(HttpContext httpContext)
   at Swashbuckle.AspNetCore.Swagger.SwaggerMiddleware.Invoke(HttpContext httpContext, ISwaggerProvider swaggerProvider)
   at Microsoft.AspNetCore.Authentication.AuthenticationMiddleware.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Diagnostics.DeveloperExceptionPageMiddlewareImpl.Invoke(HttpContext context)
2025-02-02 23:37:01.561 +03:00 [INF] Request finished HTTP/1.1 POST http://07ca-46-152-255-232.ngrok-free.app/api/auth/signin - 500 null text/plain; charset=utf-8 155.1303ms
2025-02-02 23:37:20.648 +03:00 [INF] Request starting HTTP/1.1 POST http://07ca-46-152-255-232.ngrok-free.app/api/auth/signin - application/json; charset=utf-8 70
2025-02-02 23:37:20.651 +03:00 [INF] Executing endpoint 'NayifatAPI.Controllers.AuthController.SignIn (NayifatAPI)'
2025-02-02 23:37:20.652 +03:00 [INF] Route matched with {action = "SignIn", controller = "Auth"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] SignIn(NayifatAPI.Controllers.SignInRequest) on controller NayifatAPI.Controllers.AuthController (NayifatAPI).
2025-02-02 23:37:20.659 +03:00 [INF] Executed DbCommand (4ms) [Parameters=[@__providedApiKey_0='?' (Size = 255)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [a].[Key], [a].[CreatedAt], [a].[Description], [a].[ExpiresAt], [a].[IsActive], [a].[LastUsedAt]
FROM [ApiKeys] AS [a]
WHERE [a].[Key] = @__providedApiKey_0 AND [a].[IsActive] = CAST(1 AS bit)
2025-02-02 23:37:20.664 +03:00 [INF] Executed DbCommand (3ms) [Parameters=[@__request_NationalId_0='?' (Size = 450)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [c].[NationalId], [c].[AddNo], [c].[BuildingNo], [c].[City], [c].[Consent], [c].[ConsentDate], [c].[DateOfBirth], [c].[Dependents], [c].[District], [c].[Email], [c].[Employer], [c].[FamilyNameAr], [c].[FamilyNameEn], [c].[FirstNameAr], [c].[FirstNameEn], [c].[Iban], [c].[IdExpiryDate], [c].[Los], [c].[Mpin], [c].[MpinEnabled], [c].[NafathStatus], [c].[NafathTimestamp], [c].[Password], [c].[Phone], [c].[RegistrationDate], [c].[SalaryCustomer], [c].[SalaryDakhli], [c].[SecondNameAr], [c].[SecondNameEn], [c].[Sector], [c].[Street], [c].[ThirdNameAr], [c].[ThirdNameEn], [c].[Zipcode]
FROM [Customers] AS [c]
WHERE [c].[NationalId] = @__request_NationalId_0
2025-02-02 23:37:20.671 +03:00 [INF] Executed DbCommand (3ms) [Parameters=[@p0='?' (Size = 4000), @p1='?' (DbType = DateTime2), @p2='?' (Size = 4000), @p3='?' (Size = 4000), @p4='?' (Size = 4000), @p5='?' (Size = 450), @p6='?' (Size = 4000), @p7='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SET IMPLICIT_TRANSACTIONS OFF;
SET NOCOUNT ON;
INSERT INTO [AuthLogs] ([AuthType], [CreatedAt], [DeviceId], [FailureReason], [IpAddress], [NationalId], [Status], [UserAgent])
OUTPUT INSERTED.[Id]
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7);
2025-02-02 23:37:20.679 +03:00 [ERR] An exception occurred in the database while saving changes for context type 'NayifatAPI.Data.ApplicationDbContext'.
Microsoft.EntityFrameworkCore.DbUpdateException: An error occurred while saving the entity changes. See the inner exception for details.
 ---> Microsoft.Data.SqlClient.SqlException (0x80131904): The INSERT statement conflicted with the FOREIGN KEY constraint "FK_AuthLogs_Customers_NationalId". The conflict occurred in database "NayifatApp", table "dbo.Customers", column 'NationalId'.
   at Microsoft.Data.SqlClient.SqlConnection.OnError(SqlException exception, Boolean breakConnection, Action`1 wrapCloseInAction)
   at Microsoft.Data.SqlClient.SqlInternalConnection.OnError(SqlException exception, Boolean breakConnection, Action`1 wrapCloseInAction)
   at Microsoft.Data.SqlClient.TdsParser.ThrowExceptionAndWarning(TdsParserStateObject stateObj, Boolean callerHasConnectionLock, Boolean asyncClose)
   at Microsoft.Data.SqlClient.TdsParser.TryRun(RunBehavior runBehavior, SqlCommand cmdHandler, SqlDataReader dataStream, BulkCopySimpleResultSet bulkCopyHandler, TdsParserStateObject stateObj, Boolean& dataReady)
   at Microsoft.Data.SqlClient.SqlDataReader.TryHasMoreRows(Boolean& moreRows)
   at Microsoft.Data.SqlClient.SqlDataReader.TryReadInternal(Boolean setTimeout, Boolean& more)
   at Microsoft.Data.SqlClient.SqlDataReader.ReadAsyncExecute(Task task, Object state)
   at Microsoft.Data.SqlClient.SqlDataReader.InvokeAsyncCall[T](SqlDataReaderBaseAsyncCallContext`1 context)
--- End of stack trace from previous location ---
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeResultSetAsync(Int32 startCommandIndex, RelationalDataReader reader, CancellationToken cancellationToken)
ClientConnectionId:20e2460a-ecb1-48bb-bb7f-cd9effff34c3
Error Number:547,State:0,Class:16
   --- End of inner exception stack trace ---
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeResultSetAsync(Int32 startCommandIndex, RelationalDataReader reader, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeAsync(RelationalDataReader reader, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Update.Internal.SqlServerModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(IList`1 entriesToSave, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(StateManager stateManager, Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Storage.Internal.SqlServerExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
Microsoft.EntityFrameworkCore.DbUpdateException: An error occurred while saving the entity changes. See the inner exception for details.
 ---> Microsoft.Data.SqlClient.SqlException (0x80131904): The INSERT statement conflicted with the FOREIGN KEY constraint "FK_AuthLogs_Customers_NationalId". The conflict occurred in database "NayifatApp", table "dbo.Customers", column 'NationalId'.
   at Microsoft.Data.SqlClient.SqlConnection.OnError(SqlException exception, Boolean breakConnection, Action`1 wrapCloseInAction)
   at Microsoft.Data.SqlClient.SqlInternalConnection.OnError(SqlException exception, Boolean breakConnection, Action`1 wrapCloseInAction)
   at Microsoft.Data.SqlClient.TdsParser.ThrowExceptionAndWarning(TdsParserStateObject stateObj, Boolean callerHasConnectionLock, Boolean asyncClose)
   at Microsoft.Data.SqlClient.TdsParser.TryRun(RunBehavior runBehavior, SqlCommand cmdHandler, SqlDataReader dataStream, BulkCopySimpleResultSet bulkCopyHandler, TdsParserStateObject stateObj, Boolean& dataReady)
   at Microsoft.Data.SqlClient.SqlDataReader.TryHasMoreRows(Boolean& moreRows)
   at Microsoft.Data.SqlClient.SqlDataReader.TryReadInternal(Boolean setTimeout, Boolean& more)
   at Microsoft.Data.SqlClient.SqlDataReader.ReadAsyncExecute(Task task, Object state)
   at Microsoft.Data.SqlClient.SqlDataReader.InvokeAsyncCall[T](SqlDataReaderBaseAsyncCallContext`1 context)
--- End of stack trace from previous location ---
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeResultSetAsync(Int32 startCommandIndex, RelationalDataReader reader, CancellationToken cancellationToken)
ClientConnectionId:20e2460a-ecb1-48bb-bb7f-cd9effff34c3
Error Number:547,State:0,Class:16
   --- End of inner exception stack trace ---
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeResultSetAsync(Int32 startCommandIndex, RelationalDataReader reader, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeAsync(RelationalDataReader reader, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Update.Internal.SqlServerModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(IList`1 entriesToSave, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(StateManager stateManager, Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Storage.Internal.SqlServerExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
2025-02-02 23:37:20.700 +03:00 [ERR] Error during sign in for National ID: 1555552
Microsoft.EntityFrameworkCore.DbUpdateException: An error occurred while saving the entity changes. See the inner exception for details.
 ---> Microsoft.Data.SqlClient.SqlException (0x80131904): The INSERT statement conflicted with the FOREIGN KEY constraint "FK_AuthLogs_Customers_NationalId". The conflict occurred in database "NayifatApp", table "dbo.Customers", column 'NationalId'.
   at Microsoft.Data.SqlClient.SqlConnection.OnError(SqlException exception, Boolean breakConnection, Action`1 wrapCloseInAction)
   at Microsoft.Data.SqlClient.SqlInternalConnection.OnError(SqlException exception, Boolean breakConnection, Action`1 wrapCloseInAction)
   at Microsoft.Data.SqlClient.TdsParser.ThrowExceptionAndWarning(TdsParserStateObject stateObj, Boolean callerHasConnectionLock, Boolean asyncClose)
   at Microsoft.Data.SqlClient.TdsParser.TryRun(RunBehavior runBehavior, SqlCommand cmdHandler, SqlDataReader dataStream, BulkCopySimpleResultSet bulkCopyHandler, TdsParserStateObject stateObj, Boolean& dataReady)
   at Microsoft.Data.SqlClient.SqlDataReader.TryHasMoreRows(Boolean& moreRows)
   at Microsoft.Data.SqlClient.SqlDataReader.TryReadInternal(Boolean setTimeout, Boolean& more)
   at Microsoft.Data.SqlClient.SqlDataReader.ReadAsyncExecute(Task task, Object state)
   at Microsoft.Data.SqlClient.SqlDataReader.InvokeAsyncCall[T](SqlDataReaderBaseAsyncCallContext`1 context)
--- End of stack trace from previous location ---
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeResultSetAsync(Int32 startCommandIndex, RelationalDataReader reader, CancellationToken cancellationToken)
ClientConnectionId:20e2460a-ecb1-48bb-bb7f-cd9effff34c3
Error Number:547,State:0,Class:16
   --- End of inner exception stack trace ---
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeResultSetAsync(Int32 startCommandIndex, RelationalDataReader reader, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeAsync(RelationalDataReader reader, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Update.Internal.SqlServerModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(IList`1 entriesToSave, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(StateManager stateManager, Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Storage.Internal.SqlServerExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at NayifatAPI.Controllers.AuthController.LogAuthAttempt(String nationalId, String deviceId, String status, String failureReason) in C:\Users\yamta\StudioProjects\nayifat_app_2025_new\nayifatapi\Controllers\AuthController.cs:line 367
   at NayifatAPI.Controllers.AuthController.SignIn(SignInRequest request) in C:\Users\yamta\StudioProjects\nayifat_app_2025_new\nayifatapi\Controllers\AuthController.cs:line 41
2025-02-02 23:37:20.720 +03:00 [INF] Executed DbCommand (7ms) [Parameters=[@p0='?' (Size = 4000), @p1='?' (DbType = DateTime2), @p2='?' (Size = 4000), @p3='?' (Size = 4000), @p4='?' (Size = 4000), @p5='?' (Size = 450), @p6='?' (Size = 4000), @p7='?' (Size = 4000), @p8='?' (Size = 4000), @p9='?' (DbType = DateTime2), @p10='?' (Size = 4000), @p11='?' (Size = 4000), @p12='?' (Size = 4000), @p13='?' (Size = 450), @p14='?' (Size = 4000), @p15='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SET IMPLICIT_TRANSACTIONS OFF;
SET NOCOUNT ON;
MERGE [AuthLogs] USING (
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7, 0),
(@p8, @p9, @p10, @p11, @p12, @p13, @p14, @p15, 1)) AS i ([AuthType], [CreatedAt], [DeviceId], [FailureReason], [IpAddress], [NationalId], [Status], [UserAgent], _Position) ON 1=0
WHEN NOT MATCHED THEN
INSERT ([AuthType], [CreatedAt], [DeviceId], [FailureReason], [IpAddress], [NationalId], [Status], [UserAgent])
VALUES (i.[AuthType], i.[CreatedAt], i.[DeviceId], i.[FailureReason], i.[IpAddress], i.[NationalId], i.[Status], i.[UserAgent])
OUTPUT INSERTED.[Id], i._Position;
2025-02-02 23:37:20.725 +03:00 [ERR] An exception occurred in the database while saving changes for context type 'NayifatAPI.Data.ApplicationDbContext'.
Microsoft.EntityFrameworkCore.DbUpdateException: An error occurred while saving the entity changes. See the inner exception for details.
 ---> Microsoft.Data.SqlClient.SqlException (0x80131904): The MERGE statement conflicted with the FOREIGN KEY constraint "FK_AuthLogs_Customers_NationalId". The conflict occurred in database "NayifatApp", table "dbo.Customers", column 'NationalId'.
   at Microsoft.Data.SqlClient.SqlConnection.OnError(SqlException exception, Boolean breakConnection, Action`1 wrapCloseInAction)
   at Microsoft.Data.SqlClient.SqlInternalConnection.OnError(SqlException exception, Boolean breakConnection, Action`1 wrapCloseInAction)
   at Microsoft.Data.SqlClient.TdsParser.ThrowExceptionAndWarning(TdsParserStateObject stateObj, Boolean callerHasConnectionLock, Boolean asyncClose)
   at Microsoft.Data.SqlClient.TdsParser.TryRun(RunBehavior runBehavior, SqlCommand cmdHandler, SqlDataReader dataStream, BulkCopySimpleResultSet bulkCopyHandler, TdsParserStateObject stateObj, Boolean& dataReady)
   at Microsoft.Data.SqlClient.SqlDataReader.TryHasMoreRows(Boolean& moreRows)
   at Microsoft.Data.SqlClient.SqlDataReader.TryReadInternal(Boolean setTimeout, Boolean& more)
   at Microsoft.Data.SqlClient.SqlDataReader.ReadAsyncExecute(Task task, Object state)
   at Microsoft.Data.SqlClient.SqlDataReader.InvokeAsyncCall[T](SqlDataReaderBaseAsyncCallContext`1 context)
--- End of stack trace from previous location ---
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeResultSetAsync(Int32 startCommandIndex, RelationalDataReader reader, CancellationToken cancellationToken)
ClientConnectionId:20e2460a-ecb1-48bb-bb7f-cd9effff34c3
Error Number:547,State:0,Class:16
   --- End of inner exception stack trace ---
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeResultSetAsync(Int32 startCommandIndex, RelationalDataReader reader, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeAsync(RelationalDataReader reader, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Update.Internal.SqlServerModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(IList`1 entriesToSave, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(StateManager stateManager, Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Storage.Internal.SqlServerExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
Microsoft.EntityFrameworkCore.DbUpdateException: An error occurred while saving the entity changes. See the inner exception for details.
 ---> Microsoft.Data.SqlClient.SqlException (0x80131904): The MERGE statement conflicted with the FOREIGN KEY constraint "FK_AuthLogs_Customers_NationalId". The conflict occurred in database "NayifatApp", table "dbo.Customers", column 'NationalId'.
   at Microsoft.Data.SqlClient.SqlConnection.OnError(SqlException exception, Boolean breakConnection, Action`1 wrapCloseInAction)
   at Microsoft.Data.SqlClient.SqlInternalConnection.OnError(SqlException exception, Boolean breakConnection, Action`1 wrapCloseInAction)
   at Microsoft.Data.SqlClient.TdsParser.ThrowExceptionAndWarning(TdsParserStateObject stateObj, Boolean callerHasConnectionLock, Boolean asyncClose)
   at Microsoft.Data.SqlClient.TdsParser.TryRun(RunBehavior runBehavior, SqlCommand cmdHandler, SqlDataReader dataStream, BulkCopySimpleResultSet bulkCopyHandler, TdsParserStateObject stateObj, Boolean& dataReady)
   at Microsoft.Data.SqlClient.SqlDataReader.TryHasMoreRows(Boolean& moreRows)
   at Microsoft.Data.SqlClient.SqlDataReader.TryReadInternal(Boolean setTimeout, Boolean& more)
   at Microsoft.Data.SqlClient.SqlDataReader.ReadAsyncExecute(Task task, Object state)
   at Microsoft.Data.SqlClient.SqlDataReader.InvokeAsyncCall[T](SqlDataReaderBaseAsyncCallContext`1 context)
--- End of stack trace from previous location ---
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeResultSetAsync(Int32 startCommandIndex, RelationalDataReader reader, CancellationToken cancellationToken)
ClientConnectionId:20e2460a-ecb1-48bb-bb7f-cd9effff34c3
Error Number:547,State:0,Class:16
   --- End of inner exception stack trace ---
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeResultSetAsync(Int32 startCommandIndex, RelationalDataReader reader, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeAsync(RelationalDataReader reader, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Update.Internal.SqlServerModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(IList`1 entriesToSave, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(StateManager stateManager, Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Storage.Internal.SqlServerExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
2025-02-02 23:37:20.737 +03:00 [INF] Executed action NayifatAPI.Controllers.AuthController.SignIn (NayifatAPI) in 83.5377ms
2025-02-02 23:37:20.739 +03:00 [INF] Executed endpoint 'NayifatAPI.Controllers.AuthController.SignIn (NayifatAPI)'
2025-02-02 23:37:20.740 +03:00 [ERR] Unhandled exception
Microsoft.EntityFrameworkCore.DbUpdateException: An error occurred while saving the entity changes. See the inner exception for details.
 ---> Microsoft.Data.SqlClient.SqlException (0x80131904): The MERGE statement conflicted with the FOREIGN KEY constraint "FK_AuthLogs_Customers_NationalId". The conflict occurred in database "NayifatApp", table "dbo.Customers", column 'NationalId'.
   at Microsoft.Data.SqlClient.SqlConnection.OnError(SqlException exception, Boolean breakConnection, Action`1 wrapCloseInAction)
   at Microsoft.Data.SqlClient.SqlInternalConnection.OnError(SqlException exception, Boolean breakConnection, Action`1 wrapCloseInAction)
   at Microsoft.Data.SqlClient.TdsParser.ThrowExceptionAndWarning(TdsParserStateObject stateObj, Boolean callerHasConnectionLock, Boolean asyncClose)
   at Microsoft.Data.SqlClient.TdsParser.TryRun(RunBehavior runBehavior, SqlCommand cmdHandler, SqlDataReader dataStream, BulkCopySimpleResultSet bulkCopyHandler, TdsParserStateObject stateObj, Boolean& dataReady)
   at Microsoft.Data.SqlClient.SqlDataReader.TryHasMoreRows(Boolean& moreRows)
   at Microsoft.Data.SqlClient.SqlDataReader.TryReadInternal(Boolean setTimeout, Boolean& more)
   at Microsoft.Data.SqlClient.SqlDataReader.ReadAsyncExecute(Task task, Object state)
   at Microsoft.Data.SqlClient.SqlDataReader.InvokeAsyncCall[T](SqlDataReaderBaseAsyncCallContext`1 context)
--- End of stack trace from previous location ---
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeResultSetAsync(Int32 startCommandIndex, RelationalDataReader reader, CancellationToken cancellationToken)
ClientConnectionId:20e2460a-ecb1-48bb-bb7f-cd9effff34c3
Error Number:547,State:0,Class:16
   --- End of inner exception stack trace ---
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeResultSetAsync(Int32 startCommandIndex, RelationalDataReader reader, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeAsync(RelationalDataReader reader, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Update.Internal.SqlServerModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(IList`1 entriesToSave, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(StateManager stateManager, Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Storage.Internal.SqlServerExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at NayifatAPI.Controllers.AuthController.LogAuthAttempt(String nationalId, String deviceId, String status, String failureReason) in C:\Users\yamta\StudioProjects\nayifat_app_2025_new\nayifatapi\Controllers\AuthController.cs:line 367
   at NayifatAPI.Controllers.AuthController.SignIn(SignInRequest request) in C:\Users\yamta\StudioProjects\nayifat_app_2025_new\nayifatapi\Controllers\AuthController.cs:line 103
   at Microsoft.AspNetCore.Mvc.Infrastructure.ActionMethodExecutor.TaskOfIActionResultExecutor.Execute(ActionContext actionContext, IActionResultTypeMapper mapper, ObjectMethodExecutor executor, Object controller, Object[] arguments)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.<InvokeActionMethodAsync>g__Awaited|12_0(ControllerActionInvoker invoker, ValueTask`1 actionResultValueTask)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.<InvokeNextActionFilterAsync>g__Awaited|10_0(ControllerActionInvoker invoker, Task lastTask, State next, Scope scope, Object state, Boolean isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.Rethrow(ActionExecutedContextSealed context)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.Next(State& next, Scope& scope, Object& state, Boolean& isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.<InvokeInnerFilterAsync>g__Awaited|13_0(ControllerActionInvoker invoker, Task lastTask, State next, Scope scope, Object state, Boolean isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeFilterPipelineAsync>g__Awaited|20_0(ResourceInvoker invoker, Task lastTask, State next, Scope scope, Object state, Boolean isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeAsync>g__Logged|17_1(ResourceInvoker invoker)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeAsync>g__Logged|17_1(ResourceInvoker invoker)
   at Microsoft.AspNetCore.Routing.EndpointMiddleware.<Invoke>g__AwaitRequestTask|7_0(Endpoint endpoint, Task requestTask, ILogger logger)
   at Microsoft.AspNetCore.Authorization.AuthorizationMiddleware.Invoke(HttpContext context)
   at Program.<>c.<<<Main>$>b__0_3>d.MoveNext() in C:\Users\yamta\StudioProjects\nayifat_app_2025_new\nayifatapi\Program.cs:line 85
2025-02-02 23:37:20.753 +03:00 [ERR] An unhandled exception has occurred while executing the request.
Microsoft.EntityFrameworkCore.DbUpdateException: An error occurred while saving the entity changes. See the inner exception for details.
 ---> Microsoft.Data.SqlClient.SqlException (0x80131904): The MERGE statement conflicted with the FOREIGN KEY constraint "FK_AuthLogs_Customers_NationalId". The conflict occurred in database "NayifatApp", table "dbo.Customers", column 'NationalId'.
   at Microsoft.Data.SqlClient.SqlConnection.OnError(SqlException exception, Boolean breakConnection, Action`1 wrapCloseInAction)
   at Microsoft.Data.SqlClient.SqlInternalConnection.OnError(SqlException exception, Boolean breakConnection, Action`1 wrapCloseInAction)
   at Microsoft.Data.SqlClient.TdsParser.ThrowExceptionAndWarning(TdsParserStateObject stateObj, Boolean callerHasConnectionLock, Boolean asyncClose)
   at Microsoft.Data.SqlClient.TdsParser.TryRun(RunBehavior runBehavior, SqlCommand cmdHandler, SqlDataReader dataStream, BulkCopySimpleResultSet bulkCopyHandler, TdsParserStateObject stateObj, Boolean& dataReady)
   at Microsoft.Data.SqlClient.SqlDataReader.TryHasMoreRows(Boolean& moreRows)
   at Microsoft.Data.SqlClient.SqlDataReader.TryReadInternal(Boolean setTimeout, Boolean& more)
   at Microsoft.Data.SqlClient.SqlDataReader.ReadAsyncExecute(Task task, Object state)
   at Microsoft.Data.SqlClient.SqlDataReader.InvokeAsyncCall[T](SqlDataReaderBaseAsyncCallContext`1 context)
--- End of stack trace from previous location ---
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeResultSetAsync(Int32 startCommandIndex, RelationalDataReader reader, CancellationToken cancellationToken)
ClientConnectionId:20e2460a-ecb1-48bb-bb7f-cd9effff34c3
Error Number:547,State:0,Class:16
   --- End of inner exception stack trace ---
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeResultSetAsync(Int32 startCommandIndex, RelationalDataReader reader, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeAsync(RelationalDataReader reader, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Update.Internal.SqlServerModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(IList`1 entriesToSave, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(StateManager stateManager, Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Storage.Internal.SqlServerExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at NayifatAPI.Controllers.AuthController.LogAuthAttempt(String nationalId, String deviceId, String status, String failureReason) in C:\Users\yamta\StudioProjects\nayifat_app_2025_new\nayifatapi\Controllers\AuthController.cs:line 367
   at NayifatAPI.Controllers.AuthController.SignIn(SignInRequest request) in C:\Users\yamta\StudioProjects\nayifat_app_2025_new\nayifatapi\Controllers\AuthController.cs:line 103
   at Microsoft.AspNetCore.Mvc.Infrastructure.ActionMethodExecutor.TaskOfIActionResultExecutor.Execute(ActionContext actionContext, IActionResultTypeMapper mapper, ObjectMethodExecutor executor, Object controller, Object[] arguments)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.<InvokeActionMethodAsync>g__Awaited|12_0(ControllerActionInvoker invoker, ValueTask`1 actionResultValueTask)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.<InvokeNextActionFilterAsync>g__Awaited|10_0(ControllerActionInvoker invoker, Task lastTask, State next, Scope scope, Object state, Boolean isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.Rethrow(ActionExecutedContextSealed context)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.Next(State& next, Scope& scope, Object& state, Boolean& isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.<InvokeInnerFilterAsync>g__Awaited|13_0(ControllerActionInvoker invoker, Task lastTask, State next, Scope scope, Object state, Boolean isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeFilterPipelineAsync>g__Awaited|20_0(ResourceInvoker invoker, Task lastTask, State next, Scope scope, Object state, Boolean isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeAsync>g__Logged|17_1(ResourceInvoker invoker)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeAsync>g__Logged|17_1(ResourceInvoker invoker)
   at Microsoft.AspNetCore.Routing.EndpointMiddleware.<Invoke>g__AwaitRequestTask|7_0(Endpoint endpoint, Task requestTask, ILogger logger)
   at Microsoft.AspNetCore.Authorization.AuthorizationMiddleware.Invoke(HttpContext context)
   at Program.<>c.<<<Main>$>b__0_3>d.MoveNext() in C:\Users\yamta\StudioProjects\nayifat_app_2025_new\nayifatapi\Program.cs:line 85
--- End of stack trace from previous location ---
   at Swashbuckle.AspNetCore.SwaggerUI.SwaggerUIMiddleware.Invoke(HttpContext httpContext)
   at Swashbuckle.AspNetCore.Swagger.SwaggerMiddleware.Invoke(HttpContext httpContext, ISwaggerProvider swaggerProvider)
   at Microsoft.AspNetCore.Authentication.AuthenticationMiddleware.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Diagnostics.DeveloperExceptionPageMiddlewareImpl.Invoke(HttpContext context)
2025-02-02 23:37:20.769 +03:00 [INF] Request finished HTTP/1.1 POST http://07ca-46-152-255-232.ngrok-free.app/api/auth/signin - 500 null text/plain; charset=utf-8 121.1741ms
2025-02-02 23:38:01.252 +03:00 [INF] Request starting HTTP/1.1 POST http://07ca-46-152-255-232.ngrok-free.app/api/notifications/list - application/json; charset=utf-8 47
2025-02-02 23:38:01.254 +03:00 [INF] Executing endpoint 'NayifatAPI.Controllers.NotificationsController.GetNotifications (NayifatAPI)'
2025-02-02 23:38:01.255 +03:00 [INF] Route matched with {action = "GetNotifications", controller = "Notifications"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetNotifications(NayifatAPI.Controllers.GetNotificationsRequest) on controller NayifatAPI.Controllers.NotificationsController (NayifatAPI).
2025-02-02 23:38:01.259 +03:00 [INF] Executed DbCommand (2ms) [Parameters=[@__providedApiKey_0='?' (Size = 255)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [a].[Key], [a].[CreatedAt], [a].[Description], [a].[ExpiresAt], [a].[IsActive], [a].[LastUsedAt]
FROM [ApiKeys] AS [a]
WHERE [a].[Key] = @__providedApiKey_0 AND [a].[IsActive] = CAST(1 AS bit)
2025-02-02 23:38:01.264 +03:00 [INF] Executed DbCommand (3ms) [Parameters=[@__request_NationalId_0='?' (Size = 450)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [u].[national_id], [u].[last_updated], [u].[notifications]
FROM [user_notifications] AS [u]
WHERE [u].[national_id] = @__request_NationalId_0
2025-02-02 23:38:01.268 +03:00 [INF] Executed DbCommand (2ms) [Parameters=[@__Parse_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [n].[Id], [n].[additional_data], [n].[Body], [n].[body_ar], [n].[body_en], [n].[created_at], [n].[expiry_at], [n].[Route], [n].[target_criteria], [n].[Title], [n].[title_ar], [n].[title_en]
FROM [notification_templates] AS [n]
WHERE [n].[Id] = @__Parse_0
2025-02-02 23:38:01.273 +03:00 [INF] Executed DbCommand (2ms) [Parameters=[@__Parse_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [n].[Id], [n].[additional_data], [n].[Body], [n].[body_ar], [n].[body_en], [n].[created_at], [n].[expiry_at], [n].[Route], [n].[target_criteria], [n].[Title], [n].[title_ar], [n].[title_en]
FROM [notification_templates] AS [n]
WHERE [n].[Id] = @__Parse_0
2025-02-02 23:38:01.286 +03:00 [INF] Executed DbCommand (11ms) [Parameters=[@p0='?' (Size = 4000), @p1='?' (DbType = DateTime2), @p2='?' (Size = 4000), @p3='?' (Size = 4000), @p4='?' (Size = 4000), @p5='?' (Size = 450), @p6='?' (Size = 4000), @p7='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SET IMPLICIT_TRANSACTIONS OFF;
SET NOCOUNT ON;
INSERT INTO [AuthLogs] ([AuthType], [CreatedAt], [DeviceId], [FailureReason], [IpAddress], [NationalId], [Status], [UserAgent])
OUTPUT INSERTED.[Id]
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7);
2025-02-02 23:38:01.289 +03:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType9`2[[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Object, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-02-02 23:38:01.291 +03:00 [INF] Executed action NayifatAPI.Controllers.NotificationsController.GetNotifications (NayifatAPI) in 34.1402ms
2025-02-02 23:38:01.292 +03:00 [INF] Executed endpoint 'NayifatAPI.Controllers.NotificationsController.GetNotifications (NayifatAPI)'
2025-02-02 23:38:01.293 +03:00 [INF] Request finished HTTP/1.1 POST http://07ca-46-152-255-232.ngrok-free.app/api/notifications/list - 200 null application/json; charset=utf-8 41.4634ms
2025-02-02 23:38:21.117 +03:00 [INF] Request starting HTTP/1.1 POST http://07ca-46-152-255-232.ngrok-free.app/api/auth/signin - application/json; charset=utf-8 73
2025-02-02 23:38:21.119 +03:00 [INF] Executing endpoint 'NayifatAPI.Controllers.AuthController.SignIn (NayifatAPI)'
2025-02-02 23:38:21.120 +03:00 [INF] Route matched with {action = "SignIn", controller = "Auth"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] SignIn(NayifatAPI.Controllers.SignInRequest) on controller NayifatAPI.Controllers.AuthController (NayifatAPI).
2025-02-02 23:38:21.124 +03:00 [INF] Executed DbCommand (2ms) [Parameters=[@__providedApiKey_0='?' (Size = 255)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [a].[Key], [a].[CreatedAt], [a].[Description], [a].[ExpiresAt], [a].[IsActive], [a].[LastUsedAt]
FROM [ApiKeys] AS [a]
WHERE [a].[Key] = @__providedApiKey_0 AND [a].[IsActive] = CAST(1 AS bit)
2025-02-02 23:38:21.129 +03:00 [INF] Executed DbCommand (2ms) [Parameters=[@__request_NationalId_0='?' (Size = 450)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [c].[NationalId], [c].[AddNo], [c].[BuildingNo], [c].[City], [c].[Consent], [c].[ConsentDate], [c].[DateOfBirth], [c].[Dependents], [c].[District], [c].[Email], [c].[Employer], [c].[FamilyNameAr], [c].[FamilyNameEn], [c].[FirstNameAr], [c].[FirstNameEn], [c].[Iban], [c].[IdExpiryDate], [c].[Los], [c].[Mpin], [c].[MpinEnabled], [c].[NafathStatus], [c].[NafathTimestamp], [c].[Password], [c].[Phone], [c].[RegistrationDate], [c].[SalaryCustomer], [c].[SalaryDakhli], [c].[SecondNameAr], [c].[SecondNameEn], [c].[Sector], [c].[Street], [c].[ThirdNameAr], [c].[ThirdNameEn], [c].[Zipcode]
FROM [Customers] AS [c]
WHERE [c].[NationalId] = @__request_NationalId_0
2025-02-02 23:38:21.134 +03:00 [INF] Executed DbCommand (2ms) [Parameters=[@p0='?' (Size = 4000), @p1='?' (DbType = DateTime2), @p2='?' (Size = 4000), @p3='?' (Size = 4000), @p4='?' (Size = 4000), @p5='?' (Size = 450), @p6='?' (Size = 4000), @p7='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SET IMPLICIT_TRANSACTIONS OFF;
SET NOCOUNT ON;
INSERT INTO [AuthLogs] ([AuthType], [CreatedAt], [DeviceId], [FailureReason], [IpAddress], [NationalId], [Status], [UserAgent])
OUTPUT INSERTED.[Id]
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7);
2025-02-02 23:38:21.136 +03:00 [ERR] An exception occurred in the database while saving changes for context type 'NayifatAPI.Data.ApplicationDbContext'.
Microsoft.EntityFrameworkCore.DbUpdateException: An error occurred while saving the entity changes. See the inner exception for details.
 ---> Microsoft.Data.SqlClient.SqlException (0x80131904): The INSERT statement conflicted with the FOREIGN KEY constraint "FK_AuthLogs_Customers_NationalId". The conflict occurred in database "NayifatApp", table "dbo.Customers", column 'NationalId'.
   at Microsoft.Data.SqlClient.SqlConnection.OnError(SqlException exception, Boolean breakConnection, Action`1 wrapCloseInAction)
   at Microsoft.Data.SqlClient.SqlInternalConnection.OnError(SqlException exception, Boolean breakConnection, Action`1 wrapCloseInAction)
   at Microsoft.Data.SqlClient.TdsParser.ThrowExceptionAndWarning(TdsParserStateObject stateObj, Boolean callerHasConnectionLock, Boolean asyncClose)
   at Microsoft.Data.SqlClient.TdsParser.TryRun(RunBehavior runBehavior, SqlCommand cmdHandler, SqlDataReader dataStream, BulkCopySimpleResultSet bulkCopyHandler, TdsParserStateObject stateObj, Boolean& dataReady)
   at Microsoft.Data.SqlClient.SqlDataReader.TryHasMoreRows(Boolean& moreRows)
   at Microsoft.Data.SqlClient.SqlDataReader.TryReadInternal(Boolean setTimeout, Boolean& more)
   at Microsoft.Data.SqlClient.SqlDataReader.ReadAsyncExecute(Task task, Object state)
   at Microsoft.Data.SqlClient.SqlDataReader.InvokeAsyncCall[T](SqlDataReaderBaseAsyncCallContext`1 context)
--- End of stack trace from previous location ---
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeResultSetAsync(Int32 startCommandIndex, RelationalDataReader reader, CancellationToken cancellationToken)
ClientConnectionId:20e2460a-ecb1-48bb-bb7f-cd9effff34c3
Error Number:547,State:0,Class:16
   --- End of inner exception stack trace ---
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeResultSetAsync(Int32 startCommandIndex, RelationalDataReader reader, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeAsync(RelationalDataReader reader, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Update.Internal.SqlServerModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(IList`1 entriesToSave, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(StateManager stateManager, Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Storage.Internal.SqlServerExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
Microsoft.EntityFrameworkCore.DbUpdateException: An error occurred while saving the entity changes. See the inner exception for details.
 ---> Microsoft.Data.SqlClient.SqlException (0x80131904): The INSERT statement conflicted with the FOREIGN KEY constraint "FK_AuthLogs_Customers_NationalId". The conflict occurred in database "NayifatApp", table "dbo.Customers", column 'NationalId'.
   at Microsoft.Data.SqlClient.SqlConnection.OnError(SqlException exception, Boolean breakConnection, Action`1 wrapCloseInAction)
   at Microsoft.Data.SqlClient.SqlInternalConnection.OnError(SqlException exception, Boolean breakConnection, Action`1 wrapCloseInAction)
   at Microsoft.Data.SqlClient.TdsParser.ThrowExceptionAndWarning(TdsParserStateObject stateObj, Boolean callerHasConnectionLock, Boolean asyncClose)
   at Microsoft.Data.SqlClient.TdsParser.TryRun(RunBehavior runBehavior, SqlCommand cmdHandler, SqlDataReader dataStream, BulkCopySimpleResultSet bulkCopyHandler, TdsParserStateObject stateObj, Boolean& dataReady)
   at Microsoft.Data.SqlClient.SqlDataReader.TryHasMoreRows(Boolean& moreRows)
   at Microsoft.Data.SqlClient.SqlDataReader.TryReadInternal(Boolean setTimeout, Boolean& more)
   at Microsoft.Data.SqlClient.SqlDataReader.ReadAsyncExecute(Task task, Object state)
   at Microsoft.Data.SqlClient.SqlDataReader.InvokeAsyncCall[T](SqlDataReaderBaseAsyncCallContext`1 context)
--- End of stack trace from previous location ---
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeResultSetAsync(Int32 startCommandIndex, RelationalDataReader reader, CancellationToken cancellationToken)
ClientConnectionId:20e2460a-ecb1-48bb-bb7f-cd9effff34c3
Error Number:547,State:0,Class:16
   --- End of inner exception stack trace ---
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeResultSetAsync(Int32 startCommandIndex, RelationalDataReader reader, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeAsync(RelationalDataReader reader, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Update.Internal.SqlServerModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(IList`1 entriesToSave, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(StateManager stateManager, Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Storage.Internal.SqlServerExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
2025-02-02 23:38:21.149 +03:00 [ERR] Error during sign in for National ID: 1111111111
Microsoft.EntityFrameworkCore.DbUpdateException: An error occurred while saving the entity changes. See the inner exception for details.
 ---> Microsoft.Data.SqlClient.SqlException (0x80131904): The INSERT statement conflicted with the FOREIGN KEY constraint "FK_AuthLogs_Customers_NationalId". The conflict occurred in database "NayifatApp", table "dbo.Customers", column 'NationalId'.
   at Microsoft.Data.SqlClient.SqlConnection.OnError(SqlException exception, Boolean breakConnection, Action`1 wrapCloseInAction)
   at Microsoft.Data.SqlClient.SqlInternalConnection.OnError(SqlException exception, Boolean breakConnection, Action`1 wrapCloseInAction)
   at Microsoft.Data.SqlClient.TdsParser.ThrowExceptionAndWarning(TdsParserStateObject stateObj, Boolean callerHasConnectionLock, Boolean asyncClose)
   at Microsoft.Data.SqlClient.TdsParser.TryRun(RunBehavior runBehavior, SqlCommand cmdHandler, SqlDataReader dataStream, BulkCopySimpleResultSet bulkCopyHandler, TdsParserStateObject stateObj, Boolean& dataReady)
   at Microsoft.Data.SqlClient.SqlDataReader.TryHasMoreRows(Boolean& moreRows)
   at Microsoft.Data.SqlClient.SqlDataReader.TryReadInternal(Boolean setTimeout, Boolean& more)
   at Microsoft.Data.SqlClient.SqlDataReader.ReadAsyncExecute(Task task, Object state)
   at Microsoft.Data.SqlClient.SqlDataReader.InvokeAsyncCall[T](SqlDataReaderBaseAsyncCallContext`1 context)
--- End of stack trace from previous location ---
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeResultSetAsync(Int32 startCommandIndex, RelationalDataReader reader, CancellationToken cancellationToken)
ClientConnectionId:20e2460a-ecb1-48bb-bb7f-cd9effff34c3
Error Number:547,State:0,Class:16
   --- End of inner exception stack trace ---
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeResultSetAsync(Int32 startCommandIndex, RelationalDataReader reader, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeAsync(RelationalDataReader reader, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Update.Internal.SqlServerModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(IList`1 entriesToSave, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(StateManager stateManager, Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Storage.Internal.SqlServerExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at NayifatAPI.Controllers.AuthController.LogAuthAttempt(String nationalId, String deviceId, String status, String failureReason) in C:\Users\yamta\StudioProjects\nayifat_app_2025_new\nayifatapi\Controllers\AuthController.cs:line 367
   at NayifatAPI.Controllers.AuthController.SignIn(SignInRequest request) in C:\Users\yamta\StudioProjects\nayifat_app_2025_new\nayifatapi\Controllers\AuthController.cs:line 41
2025-02-02 23:38:21.172 +03:00 [INF] Executed DbCommand (10ms) [Parameters=[@p0='?' (Size = 4000), @p1='?' (DbType = DateTime2), @p2='?' (Size = 4000), @p3='?' (Size = 4000), @p4='?' (Size = 4000), @p5='?' (Size = 450), @p6='?' (Size = 4000), @p7='?' (Size = 4000), @p8='?' (Size = 4000), @p9='?' (DbType = DateTime2), @p10='?' (Size = 4000), @p11='?' (Size = 4000), @p12='?' (Size = 4000), @p13='?' (Size = 450), @p14='?' (Size = 4000), @p15='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SET IMPLICIT_TRANSACTIONS OFF;
SET NOCOUNT ON;
MERGE [AuthLogs] USING (
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7, 0),
(@p8, @p9, @p10, @p11, @p12, @p13, @p14, @p15, 1)) AS i ([AuthType], [CreatedAt], [DeviceId], [FailureReason], [IpAddress], [NationalId], [Status], [UserAgent], _Position) ON 1=0
WHEN NOT MATCHED THEN
INSERT ([AuthType], [CreatedAt], [DeviceId], [FailureReason], [IpAddress], [NationalId], [Status], [UserAgent])
VALUES (i.[AuthType], i.[CreatedAt], i.[DeviceId], i.[FailureReason], i.[IpAddress], i.[NationalId], i.[Status], i.[UserAgent])
OUTPUT INSERTED.[Id], i._Position;
2025-02-02 23:38:21.178 +03:00 [ERR] An exception occurred in the database while saving changes for context type 'NayifatAPI.Data.ApplicationDbContext'.
Microsoft.EntityFrameworkCore.DbUpdateException: An error occurred while saving the entity changes. See the inner exception for details.
 ---> Microsoft.Data.SqlClient.SqlException (0x80131904): The MERGE statement conflicted with the FOREIGN KEY constraint "FK_AuthLogs_Customers_NationalId". The conflict occurred in database "NayifatApp", table "dbo.Customers", column 'NationalId'.
   at Microsoft.Data.SqlClient.SqlConnection.OnError(SqlException exception, Boolean breakConnection, Action`1 wrapCloseInAction)
   at Microsoft.Data.SqlClient.SqlInternalConnection.OnError(SqlException exception, Boolean breakConnection, Action`1 wrapCloseInAction)
   at Microsoft.Data.SqlClient.TdsParser.ThrowExceptionAndWarning(TdsParserStateObject stateObj, Boolean callerHasConnectionLock, Boolean asyncClose)
   at Microsoft.Data.SqlClient.TdsParser.TryRun(RunBehavior runBehavior, SqlCommand cmdHandler, SqlDataReader dataStream, BulkCopySimpleResultSet bulkCopyHandler, TdsParserStateObject stateObj, Boolean& dataReady)
   at Microsoft.Data.SqlClient.SqlDataReader.TryHasMoreRows(Boolean& moreRows)
   at Microsoft.Data.SqlClient.SqlDataReader.TryReadInternal(Boolean setTimeout, Boolean& more)
   at Microsoft.Data.SqlClient.SqlDataReader.ReadAsyncExecute(Task task, Object state)
   at Microsoft.Data.SqlClient.SqlDataReader.InvokeAsyncCall[T](SqlDataReaderBaseAsyncCallContext`1 context)
--- End of stack trace from previous location ---
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeResultSetAsync(Int32 startCommandIndex, RelationalDataReader reader, CancellationToken cancellationToken)
ClientConnectionId:20e2460a-ecb1-48bb-bb7f-cd9effff34c3
Error Number:547,State:0,Class:16
   --- End of inner exception stack trace ---
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeResultSetAsync(Int32 startCommandIndex, RelationalDataReader reader, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeAsync(RelationalDataReader reader, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Update.Internal.SqlServerModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(IList`1 entriesToSave, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(StateManager stateManager, Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Storage.Internal.SqlServerExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
Microsoft.EntityFrameworkCore.DbUpdateException: An error occurred while saving the entity changes. See the inner exception for details.
 ---> Microsoft.Data.SqlClient.SqlException (0x80131904): The MERGE statement conflicted with the FOREIGN KEY constraint "FK_AuthLogs_Customers_NationalId". The conflict occurred in database "NayifatApp", table "dbo.Customers", column 'NationalId'.
   at Microsoft.Data.SqlClient.SqlConnection.OnError(SqlException exception, Boolean breakConnection, Action`1 wrapCloseInAction)
   at Microsoft.Data.SqlClient.SqlInternalConnection.OnError(SqlException exception, Boolean breakConnection, Action`1 wrapCloseInAction)
   at Microsoft.Data.SqlClient.TdsParser.ThrowExceptionAndWarning(TdsParserStateObject stateObj, Boolean callerHasConnectionLock, Boolean asyncClose)
   at Microsoft.Data.SqlClient.TdsParser.TryRun(RunBehavior runBehavior, SqlCommand cmdHandler, SqlDataReader dataStream, BulkCopySimpleResultSet bulkCopyHandler, TdsParserStateObject stateObj, Boolean& dataReady)
   at Microsoft.Data.SqlClient.SqlDataReader.TryHasMoreRows(Boolean& moreRows)
   at Microsoft.Data.SqlClient.SqlDataReader.TryReadInternal(Boolean setTimeout, Boolean& more)
   at Microsoft.Data.SqlClient.SqlDataReader.ReadAsyncExecute(Task task, Object state)
   at Microsoft.Data.SqlClient.SqlDataReader.InvokeAsyncCall[T](SqlDataReaderBaseAsyncCallContext`1 context)
--- End of stack trace from previous location ---
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeResultSetAsync(Int32 startCommandIndex, RelationalDataReader reader, CancellationToken cancellationToken)
ClientConnectionId:20e2460a-ecb1-48bb-bb7f-cd9effff34c3
Error Number:547,State:0,Class:16
   --- End of inner exception stack trace ---
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeResultSetAsync(Int32 startCommandIndex, RelationalDataReader reader, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeAsync(RelationalDataReader reader, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Update.Internal.SqlServerModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(IList`1 entriesToSave, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(StateManager stateManager, Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Storage.Internal.SqlServerExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
2025-02-02 23:38:21.197 +03:00 [INF] Executed action NayifatAPI.Controllers.AuthController.SignIn (NayifatAPI) in 75.1868ms
2025-02-02 23:38:21.198 +03:00 [INF] Executed endpoint 'NayifatAPI.Controllers.AuthController.SignIn (NayifatAPI)'
2025-02-02 23:38:21.200 +03:00 [ERR] Unhandled exception
Microsoft.EntityFrameworkCore.DbUpdateException: An error occurred while saving the entity changes. See the inner exception for details.
 ---> Microsoft.Data.SqlClient.SqlException (0x80131904): The MERGE statement conflicted with the FOREIGN KEY constraint "FK_AuthLogs_Customers_NationalId". The conflict occurred in database "NayifatApp", table "dbo.Customers", column 'NationalId'.
   at Microsoft.Data.SqlClient.SqlConnection.OnError(SqlException exception, Boolean breakConnection, Action`1 wrapCloseInAction)
   at Microsoft.Data.SqlClient.SqlInternalConnection.OnError(SqlException exception, Boolean breakConnection, Action`1 wrapCloseInAction)
   at Microsoft.Data.SqlClient.TdsParser.ThrowExceptionAndWarning(TdsParserStateObject stateObj, Boolean callerHasConnectionLock, Boolean asyncClose)
   at Microsoft.Data.SqlClient.TdsParser.TryRun(RunBehavior runBehavior, SqlCommand cmdHandler, SqlDataReader dataStream, BulkCopySimpleResultSet bulkCopyHandler, TdsParserStateObject stateObj, Boolean& dataReady)
   at Microsoft.Data.SqlClient.SqlDataReader.TryHasMoreRows(Boolean& moreRows)
   at Microsoft.Data.SqlClient.SqlDataReader.TryReadInternal(Boolean setTimeout, Boolean& more)
   at Microsoft.Data.SqlClient.SqlDataReader.ReadAsyncExecute(Task task, Object state)
   at Microsoft.Data.SqlClient.SqlDataReader.InvokeAsyncCall[T](SqlDataReaderBaseAsyncCallContext`1 context)
--- End of stack trace from previous location ---
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeResultSetAsync(Int32 startCommandIndex, RelationalDataReader reader, CancellationToken cancellationToken)
ClientConnectionId:20e2460a-ecb1-48bb-bb7f-cd9effff34c3
Error Number:547,State:0,Class:16
   --- End of inner exception stack trace ---
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeResultSetAsync(Int32 startCommandIndex, RelationalDataReader reader, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeAsync(RelationalDataReader reader, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Update.Internal.SqlServerModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(IList`1 entriesToSave, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(StateManager stateManager, Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Storage.Internal.SqlServerExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at NayifatAPI.Controllers.AuthController.LogAuthAttempt(String nationalId, String deviceId, String status, String failureReason) in C:\Users\yamta\StudioProjects\nayifat_app_2025_new\nayifatapi\Controllers\AuthController.cs:line 367
   at NayifatAPI.Controllers.AuthController.SignIn(SignInRequest request) in C:\Users\yamta\StudioProjects\nayifat_app_2025_new\nayifatapi\Controllers\AuthController.cs:line 103
   at Microsoft.AspNetCore.Mvc.Infrastructure.ActionMethodExecutor.TaskOfIActionResultExecutor.Execute(ActionContext actionContext, IActionResultTypeMapper mapper, ObjectMethodExecutor executor, Object controller, Object[] arguments)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.<InvokeActionMethodAsync>g__Awaited|12_0(ControllerActionInvoker invoker, ValueTask`1 actionResultValueTask)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.<InvokeNextActionFilterAsync>g__Awaited|10_0(ControllerActionInvoker invoker, Task lastTask, State next, Scope scope, Object state, Boolean isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.Rethrow(ActionExecutedContextSealed context)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.Next(State& next, Scope& scope, Object& state, Boolean& isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.<InvokeInnerFilterAsync>g__Awaited|13_0(ControllerActionInvoker invoker, Task lastTask, State next, Scope scope, Object state, Boolean isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeFilterPipelineAsync>g__Awaited|20_0(ResourceInvoker invoker, Task lastTask, State next, Scope scope, Object state, Boolean isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeAsync>g__Logged|17_1(ResourceInvoker invoker)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeAsync>g__Logged|17_1(ResourceInvoker invoker)
   at Microsoft.AspNetCore.Routing.EndpointMiddleware.<Invoke>g__AwaitRequestTask|7_0(Endpoint endpoint, Task requestTask, ILogger logger)
   at Microsoft.AspNetCore.Authorization.AuthorizationMiddleware.Invoke(HttpContext context)
   at Program.<>c.<<<Main>$>b__0_3>d.MoveNext() in C:\Users\yamta\StudioProjects\nayifat_app_2025_new\nayifatapi\Program.cs:line 85
2025-02-02 23:38:21.220 +03:00 [ERR] An unhandled exception has occurred while executing the request.
Microsoft.EntityFrameworkCore.DbUpdateException: An error occurred while saving the entity changes. See the inner exception for details.
 ---> Microsoft.Data.SqlClient.SqlException (0x80131904): The MERGE statement conflicted with the FOREIGN KEY constraint "FK_AuthLogs_Customers_NationalId". The conflict occurred in database "NayifatApp", table "dbo.Customers", column 'NationalId'.
   at Microsoft.Data.SqlClient.SqlConnection.OnError(SqlException exception, Boolean breakConnection, Action`1 wrapCloseInAction)
   at Microsoft.Data.SqlClient.SqlInternalConnection.OnError(SqlException exception, Boolean breakConnection, Action`1 wrapCloseInAction)
   at Microsoft.Data.SqlClient.TdsParser.ThrowExceptionAndWarning(TdsParserStateObject stateObj, Boolean callerHasConnectionLock, Boolean asyncClose)
   at Microsoft.Data.SqlClient.TdsParser.TryRun(RunBehavior runBehavior, SqlCommand cmdHandler, SqlDataReader dataStream, BulkCopySimpleResultSet bulkCopyHandler, TdsParserStateObject stateObj, Boolean& dataReady)
   at Microsoft.Data.SqlClient.SqlDataReader.TryHasMoreRows(Boolean& moreRows)
   at Microsoft.Data.SqlClient.SqlDataReader.TryReadInternal(Boolean setTimeout, Boolean& more)
   at Microsoft.Data.SqlClient.SqlDataReader.ReadAsyncExecute(Task task, Object state)
   at Microsoft.Data.SqlClient.SqlDataReader.InvokeAsyncCall[T](SqlDataReaderBaseAsyncCallContext`1 context)
--- End of stack trace from previous location ---
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeResultSetAsync(Int32 startCommandIndex, RelationalDataReader reader, CancellationToken cancellationToken)
ClientConnectionId:20e2460a-ecb1-48bb-bb7f-cd9effff34c3
Error Number:547,State:0,Class:16
   --- End of inner exception stack trace ---
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeResultSetAsync(Int32 startCommandIndex, RelationalDataReader reader, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeAsync(RelationalDataReader reader, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Update.Internal.SqlServerModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(IList`1 entriesToSave, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(StateManager stateManager, Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Storage.Internal.SqlServerExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at NayifatAPI.Controllers.AuthController.LogAuthAttempt(String nationalId, String deviceId, String status, String failureReason) in C:\Users\yamta\StudioProjects\nayifat_app_2025_new\nayifatapi\Controllers\AuthController.cs:line 367
   at NayifatAPI.Controllers.AuthController.SignIn(SignInRequest request) in C:\Users\yamta\StudioProjects\nayifat_app_2025_new\nayifatapi\Controllers\AuthController.cs:line 103
   at Microsoft.AspNetCore.Mvc.Infrastructure.ActionMethodExecutor.TaskOfIActionResultExecutor.Execute(ActionContext actionContext, IActionResultTypeMapper mapper, ObjectMethodExecutor executor, Object controller, Object[] arguments)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.<InvokeActionMethodAsync>g__Awaited|12_0(ControllerActionInvoker invoker, ValueTask`1 actionResultValueTask)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.<InvokeNextActionFilterAsync>g__Awaited|10_0(ControllerActionInvoker invoker, Task lastTask, State next, Scope scope, Object state, Boolean isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.Rethrow(ActionExecutedContextSealed context)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.Next(State& next, Scope& scope, Object& state, Boolean& isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.<InvokeInnerFilterAsync>g__Awaited|13_0(ControllerActionInvoker invoker, Task lastTask, State next, Scope scope, Object state, Boolean isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeFilterPipelineAsync>g__Awaited|20_0(ResourceInvoker invoker, Task lastTask, State next, Scope scope, Object state, Boolean isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeAsync>g__Logged|17_1(ResourceInvoker invoker)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeAsync>g__Logged|17_1(ResourceInvoker invoker)
   at Microsoft.AspNetCore.Routing.EndpointMiddleware.<Invoke>g__AwaitRequestTask|7_0(Endpoint endpoint, Task requestTask, ILogger logger)
   at Microsoft.AspNetCore.Authorization.AuthorizationMiddleware.Invoke(HttpContext context)
   at Program.<>c.<<<Main>$>b__0_3>d.MoveNext() in C:\Users\yamta\StudioProjects\nayifat_app_2025_new\nayifatapi\Program.cs:line 85
--- End of stack trace from previous location ---
   at Swashbuckle.AspNetCore.SwaggerUI.SwaggerUIMiddleware.Invoke(HttpContext httpContext)
   at Swashbuckle.AspNetCore.Swagger.SwaggerMiddleware.Invoke(HttpContext httpContext, ISwaggerProvider swaggerProvider)
   at Microsoft.AspNetCore.Authentication.AuthenticationMiddleware.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Diagnostics.DeveloperExceptionPageMiddlewareImpl.Invoke(HttpContext context)
2025-02-02 23:38:21.264 +03:00 [INF] Request finished HTTP/1.1 POST http://07ca-46-152-255-232.ngrok-free.app/api/auth/signin - 500 null text/plain; charset=utf-8 147.0702ms
2025-02-02 23:40:57.719 +03:00 [INF] Request starting HTTP/1.1 POST http://07ca-46-152-255-232.ngrok-free.app/api/notifications/list - application/json; charset=utf-8 47
2025-02-02 23:40:57.723 +03:00 [INF] Executing endpoint 'NayifatAPI.Controllers.NotificationsController.GetNotifications (NayifatAPI)'
2025-02-02 23:40:57.725 +03:00 [INF] Route matched with {action = "GetNotifications", controller = "Notifications"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetNotifications(NayifatAPI.Controllers.GetNotificationsRequest) on controller NayifatAPI.Controllers.NotificationsController (NayifatAPI).
2025-02-02 23:40:57.733 +03:00 [INF] Executed DbCommand (5ms) [Parameters=[@__providedApiKey_0='?' (Size = 255)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [a].[Key], [a].[CreatedAt], [a].[Description], [a].[ExpiresAt], [a].[IsActive], [a].[LastUsedAt]
FROM [ApiKeys] AS [a]
WHERE [a].[Key] = @__providedApiKey_0 AND [a].[IsActive] = CAST(1 AS bit)
2025-02-02 23:40:57.738 +03:00 [INF] Executed DbCommand (2ms) [Parameters=[@__request_NationalId_0='?' (Size = 450)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [u].[national_id], [u].[last_updated], [u].[notifications]
FROM [user_notifications] AS [u]
WHERE [u].[national_id] = @__request_NationalId_0
2025-02-02 23:40:57.742 +03:00 [INF] Executed DbCommand (2ms) [Parameters=[@__Parse_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [n].[Id], [n].[additional_data], [n].[Body], [n].[body_ar], [n].[body_en], [n].[created_at], [n].[expiry_at], [n].[Route], [n].[target_criteria], [n].[Title], [n].[title_ar], [n].[title_en]
FROM [notification_templates] AS [n]
WHERE [n].[Id] = @__Parse_0
2025-02-02 23:40:57.745 +03:00 [INF] Executed DbCommand (0ms) [Parameters=[@__Parse_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [n].[Id], [n].[additional_data], [n].[Body], [n].[body_ar], [n].[body_en], [n].[created_at], [n].[expiry_at], [n].[Route], [n].[target_criteria], [n].[Title], [n].[title_ar], [n].[title_en]
FROM [notification_templates] AS [n]
WHERE [n].[Id] = @__Parse_0
2025-02-02 23:40:57.822 +03:00 [INF] Executed DbCommand (76ms) [Parameters=[@p0='?' (Size = 4000), @p1='?' (DbType = DateTime2), @p2='?' (Size = 4000), @p3='?' (Size = 4000), @p4='?' (Size = 4000), @p5='?' (Size = 450), @p6='?' (Size = 4000), @p7='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SET IMPLICIT_TRANSACTIONS OFF;
SET NOCOUNT ON;
INSERT INTO [AuthLogs] ([AuthType], [CreatedAt], [DeviceId], [FailureReason], [IpAddress], [NationalId], [Status], [UserAgent])
OUTPUT INSERTED.[Id]
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7);
2025-02-02 23:40:57.825 +03:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType9`2[[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Object, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-02-02 23:40:57.825 +03:00 [INF] Executed action NayifatAPI.Controllers.NotificationsController.GetNotifications (NayifatAPI) in 98.9136ms
2025-02-02 23:40:57.827 +03:00 [INF] Executed endpoint 'NayifatAPI.Controllers.NotificationsController.GetNotifications (NayifatAPI)'
2025-02-02 23:40:57.829 +03:00 [INF] Request finished HTTP/1.1 POST http://07ca-46-152-255-232.ngrok-free.app/api/notifications/list - 200 null application/json; charset=utf-8 109.6809ms
2025-02-02 23:42:12.381 +03:00 [INF] Request starting HTTP/1.1 POST http://07ca-46-152-255-232.ngrok-free.app/api/auth/signin - application/json; charset=utf-8 73
2025-02-02 23:42:12.385 +03:00 [INF] Executing endpoint 'NayifatAPI.Controllers.AuthController.SignIn (NayifatAPI)'
2025-02-02 23:42:12.387 +03:00 [INF] Route matched with {action = "SignIn", controller = "Auth"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] SignIn(NayifatAPI.Controllers.SignInRequest) on controller NayifatAPI.Controllers.AuthController (NayifatAPI).
2025-02-02 23:42:12.392 +03:00 [INF] Executed DbCommand (2ms) [Parameters=[@__providedApiKey_0='?' (Size = 255)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [a].[Key], [a].[CreatedAt], [a].[Description], [a].[ExpiresAt], [a].[IsActive], [a].[LastUsedAt]
FROM [ApiKeys] AS [a]
WHERE [a].[Key] = @__providedApiKey_0 AND [a].[IsActive] = CAST(1 AS bit)
2025-02-02 23:42:12.397 +03:00 [INF] Executed DbCommand (2ms) [Parameters=[@__request_NationalId_0='?' (Size = 450)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [c].[NationalId], [c].[AddNo], [c].[BuildingNo], [c].[City], [c].[Consent], [c].[ConsentDate], [c].[DateOfBirth], [c].[Dependents], [c].[District], [c].[Email], [c].[Employer], [c].[FamilyNameAr], [c].[FamilyNameEn], [c].[FirstNameAr], [c].[FirstNameEn], [c].[Iban], [c].[IdExpiryDate], [c].[Los], [c].[Mpin], [c].[MpinEnabled], [c].[NafathStatus], [c].[NafathTimestamp], [c].[Password], [c].[Phone], [c].[RegistrationDate], [c].[SalaryCustomer], [c].[SalaryDakhli], [c].[SecondNameAr], [c].[SecondNameEn], [c].[Sector], [c].[Street], [c].[ThirdNameAr], [c].[ThirdNameEn], [c].[Zipcode]
FROM [Customers] AS [c]
WHERE [c].[NationalId] = @__request_NationalId_0
2025-02-02 23:42:12.402 +03:00 [INF] Executed DbCommand (2ms) [Parameters=[@p0='?' (Size = 4000), @p1='?' (DbType = DateTime2), @p2='?' (Size = 4000), @p3='?' (Size = 4000), @p4='?' (Size = 4000), @p5='?' (Size = 450), @p6='?' (Size = 4000), @p7='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SET IMPLICIT_TRANSACTIONS OFF;
SET NOCOUNT ON;
INSERT INTO [AuthLogs] ([AuthType], [CreatedAt], [DeviceId], [FailureReason], [IpAddress], [NationalId], [Status], [UserAgent])
OUTPUT INSERTED.[Id]
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7);
2025-02-02 23:42:12.405 +03:00 [ERR] An exception occurred in the database while saving changes for context type 'NayifatAPI.Data.ApplicationDbContext'.
Microsoft.EntityFrameworkCore.DbUpdateException: An error occurred while saving the entity changes. See the inner exception for details.
 ---> Microsoft.Data.SqlClient.SqlException (0x80131904): The INSERT statement conflicted with the FOREIGN KEY constraint "FK_AuthLogs_Customers_NationalId". The conflict occurred in database "NayifatApp", table "dbo.Customers", column 'NationalId'.
   at Microsoft.Data.SqlClient.SqlConnection.OnError(SqlException exception, Boolean breakConnection, Action`1 wrapCloseInAction)
   at Microsoft.Data.SqlClient.SqlInternalConnection.OnError(SqlException exception, Boolean breakConnection, Action`1 wrapCloseInAction)
   at Microsoft.Data.SqlClient.TdsParser.ThrowExceptionAndWarning(TdsParserStateObject stateObj, Boolean callerHasConnectionLock, Boolean asyncClose)
   at Microsoft.Data.SqlClient.TdsParser.TryRun(RunBehavior runBehavior, SqlCommand cmdHandler, SqlDataReader dataStream, BulkCopySimpleResultSet bulkCopyHandler, TdsParserStateObject stateObj, Boolean& dataReady)
   at Microsoft.Data.SqlClient.SqlDataReader.TryHasMoreRows(Boolean& moreRows)
   at Microsoft.Data.SqlClient.SqlDataReader.TryReadInternal(Boolean setTimeout, Boolean& more)
   at Microsoft.Data.SqlClient.SqlDataReader.ReadAsyncExecute(Task task, Object state)
   at Microsoft.Data.SqlClient.SqlDataReader.InvokeAsyncCall[T](SqlDataReaderBaseAsyncCallContext`1 context)
--- End of stack trace from previous location ---
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeResultSetAsync(Int32 startCommandIndex, RelationalDataReader reader, CancellationToken cancellationToken)
ClientConnectionId:20e2460a-ecb1-48bb-bb7f-cd9effff34c3
Error Number:547,State:0,Class:16
   --- End of inner exception stack trace ---
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeResultSetAsync(Int32 startCommandIndex, RelationalDataReader reader, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeAsync(RelationalDataReader reader, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Update.Internal.SqlServerModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(IList`1 entriesToSave, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(StateManager stateManager, Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Storage.Internal.SqlServerExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
Microsoft.EntityFrameworkCore.DbUpdateException: An error occurred while saving the entity changes. See the inner exception for details.
 ---> Microsoft.Data.SqlClient.SqlException (0x80131904): The INSERT statement conflicted with the FOREIGN KEY constraint "FK_AuthLogs_Customers_NationalId". The conflict occurred in database "NayifatApp", table "dbo.Customers", column 'NationalId'.
   at Microsoft.Data.SqlClient.SqlConnection.OnError(SqlException exception, Boolean breakConnection, Action`1 wrapCloseInAction)
   at Microsoft.Data.SqlClient.SqlInternalConnection.OnError(SqlException exception, Boolean breakConnection, Action`1 wrapCloseInAction)
   at Microsoft.Data.SqlClient.TdsParser.ThrowExceptionAndWarning(TdsParserStateObject stateObj, Boolean callerHasConnectionLock, Boolean asyncClose)
   at Microsoft.Data.SqlClient.TdsParser.TryRun(RunBehavior runBehavior, SqlCommand cmdHandler, SqlDataReader dataStream, BulkCopySimpleResultSet bulkCopyHandler, TdsParserStateObject stateObj, Boolean& dataReady)
   at Microsoft.Data.SqlClient.SqlDataReader.TryHasMoreRows(Boolean& moreRows)
   at Microsoft.Data.SqlClient.SqlDataReader.TryReadInternal(Boolean setTimeout, Boolean& more)
   at Microsoft.Data.SqlClient.SqlDataReader.ReadAsyncExecute(Task task, Object state)
   at Microsoft.Data.SqlClient.SqlDataReader.InvokeAsyncCall[T](SqlDataReaderBaseAsyncCallContext`1 context)
--- End of stack trace from previous location ---
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeResultSetAsync(Int32 startCommandIndex, RelationalDataReader reader, CancellationToken cancellationToken)
ClientConnectionId:20e2460a-ecb1-48bb-bb7f-cd9effff34c3
Error Number:547,State:0,Class:16
   --- End of inner exception stack trace ---
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeResultSetAsync(Int32 startCommandIndex, RelationalDataReader reader, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeAsync(RelationalDataReader reader, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Update.Internal.SqlServerModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(IList`1 entriesToSave, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(StateManager stateManager, Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Storage.Internal.SqlServerExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
2025-02-02 23:42:12.414 +03:00 [ERR] Error during sign in for National ID: 1111111111
Microsoft.EntityFrameworkCore.DbUpdateException: An error occurred while saving the entity changes. See the inner exception for details.
 ---> Microsoft.Data.SqlClient.SqlException (0x80131904): The INSERT statement conflicted with the FOREIGN KEY constraint "FK_AuthLogs_Customers_NationalId". The conflict occurred in database "NayifatApp", table "dbo.Customers", column 'NationalId'.
   at Microsoft.Data.SqlClient.SqlConnection.OnError(SqlException exception, Boolean breakConnection, Action`1 wrapCloseInAction)
   at Microsoft.Data.SqlClient.SqlInternalConnection.OnError(SqlException exception, Boolean breakConnection, Action`1 wrapCloseInAction)
   at Microsoft.Data.SqlClient.TdsParser.ThrowExceptionAndWarning(TdsParserStateObject stateObj, Boolean callerHasConnectionLock, Boolean asyncClose)
   at Microsoft.Data.SqlClient.TdsParser.TryRun(RunBehavior runBehavior, SqlCommand cmdHandler, SqlDataReader dataStream, BulkCopySimpleResultSet bulkCopyHandler, TdsParserStateObject stateObj, Boolean& dataReady)
   at Microsoft.Data.SqlClient.SqlDataReader.TryHasMoreRows(Boolean& moreRows)
   at Microsoft.Data.SqlClient.SqlDataReader.TryReadInternal(Boolean setTimeout, Boolean& more)
   at Microsoft.Data.SqlClient.SqlDataReader.ReadAsyncExecute(Task task, Object state)
   at Microsoft.Data.SqlClient.SqlDataReader.InvokeAsyncCall[T](SqlDataReaderBaseAsyncCallContext`1 context)
--- End of stack trace from previous location ---
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeResultSetAsync(Int32 startCommandIndex, RelationalDataReader reader, CancellationToken cancellationToken)
ClientConnectionId:20e2460a-ecb1-48bb-bb7f-cd9effff34c3
Error Number:547,State:0,Class:16
   --- End of inner exception stack trace ---
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeResultSetAsync(Int32 startCommandIndex, RelationalDataReader reader, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeAsync(RelationalDataReader reader, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Update.Internal.SqlServerModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(IList`1 entriesToSave, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(StateManager stateManager, Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Storage.Internal.SqlServerExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at NayifatAPI.Controllers.AuthController.LogAuthAttempt(String nationalId, String deviceId, String status, String failureReason) in C:\Users\yamta\StudioProjects\nayifat_app_2025_new\nayifatapi\Controllers\AuthController.cs:line 367
   at NayifatAPI.Controllers.AuthController.SignIn(SignInRequest request) in C:\Users\yamta\StudioProjects\nayifat_app_2025_new\nayifatapi\Controllers\AuthController.cs:line 41
2025-02-02 23:42:12.428 +03:00 [INF] Executed DbCommand (6ms) [Parameters=[@p0='?' (Size = 4000), @p1='?' (DbType = DateTime2), @p2='?' (Size = 4000), @p3='?' (Size = 4000), @p4='?' (Size = 4000), @p5='?' (Size = 450), @p6='?' (Size = 4000), @p7='?' (Size = 4000), @p8='?' (Size = 4000), @p9='?' (DbType = DateTime2), @p10='?' (Size = 4000), @p11='?' (Size = 4000), @p12='?' (Size = 4000), @p13='?' (Size = 450), @p14='?' (Size = 4000), @p15='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SET IMPLICIT_TRANSACTIONS OFF;
SET NOCOUNT ON;
MERGE [AuthLogs] USING (
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7, 0),
(@p8, @p9, @p10, @p11, @p12, @p13, @p14, @p15, 1)) AS i ([AuthType], [CreatedAt], [DeviceId], [FailureReason], [IpAddress], [NationalId], [Status], [UserAgent], _Position) ON 1=0
WHEN NOT MATCHED THEN
INSERT ([AuthType], [CreatedAt], [DeviceId], [FailureReason], [IpAddress], [NationalId], [Status], [UserAgent])
VALUES (i.[AuthType], i.[CreatedAt], i.[DeviceId], i.[FailureReason], i.[IpAddress], i.[NationalId], i.[Status], i.[UserAgent])
OUTPUT INSERTED.[Id], i._Position;
2025-02-02 23:42:12.431 +03:00 [ERR] An exception occurred in the database while saving changes for context type 'NayifatAPI.Data.ApplicationDbContext'.
Microsoft.EntityFrameworkCore.DbUpdateException: An error occurred while saving the entity changes. See the inner exception for details.
 ---> Microsoft.Data.SqlClient.SqlException (0x80131904): The MERGE statement conflicted with the FOREIGN KEY constraint "FK_AuthLogs_Customers_NationalId". The conflict occurred in database "NayifatApp", table "dbo.Customers", column 'NationalId'.
   at Microsoft.Data.SqlClient.SqlConnection.OnError(SqlException exception, Boolean breakConnection, Action`1 wrapCloseInAction)
   at Microsoft.Data.SqlClient.SqlInternalConnection.OnError(SqlException exception, Boolean breakConnection, Action`1 wrapCloseInAction)
   at Microsoft.Data.SqlClient.TdsParser.ThrowExceptionAndWarning(TdsParserStateObject stateObj, Boolean callerHasConnectionLock, Boolean asyncClose)
   at Microsoft.Data.SqlClient.TdsParser.TryRun(RunBehavior runBehavior, SqlCommand cmdHandler, SqlDataReader dataStream, BulkCopySimpleResultSet bulkCopyHandler, TdsParserStateObject stateObj, Boolean& dataReady)
   at Microsoft.Data.SqlClient.SqlDataReader.TryHasMoreRows(Boolean& moreRows)
   at Microsoft.Data.SqlClient.SqlDataReader.TryReadInternal(Boolean setTimeout, Boolean& more)
   at Microsoft.Data.SqlClient.SqlDataReader.ReadAsyncExecute(Task task, Object state)
   at Microsoft.Data.SqlClient.SqlDataReader.InvokeAsyncCall[T](SqlDataReaderBaseAsyncCallContext`1 context)
--- End of stack trace from previous location ---
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeResultSetAsync(Int32 startCommandIndex, RelationalDataReader reader, CancellationToken cancellationToken)
ClientConnectionId:20e2460a-ecb1-48bb-bb7f-cd9effff34c3
Error Number:547,State:0,Class:16
   --- End of inner exception stack trace ---
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeResultSetAsync(Int32 startCommandIndex, RelationalDataReader reader, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeAsync(RelationalDataReader reader, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Update.Internal.SqlServerModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(IList`1 entriesToSave, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(StateManager stateManager, Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Storage.Internal.SqlServerExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
Microsoft.EntityFrameworkCore.DbUpdateException: An error occurred while saving the entity changes. See the inner exception for details.
 ---> Microsoft.Data.SqlClient.SqlException (0x80131904): The MERGE statement conflicted with the FOREIGN KEY constraint "FK_AuthLogs_Customers_NationalId". The conflict occurred in database "NayifatApp", table "dbo.Customers", column 'NationalId'.
   at Microsoft.Data.SqlClient.SqlConnection.OnError(SqlException exception, Boolean breakConnection, Action`1 wrapCloseInAction)
   at Microsoft.Data.SqlClient.SqlInternalConnection.OnError(SqlException exception, Boolean breakConnection, Action`1 wrapCloseInAction)
   at Microsoft.Data.SqlClient.TdsParser.ThrowExceptionAndWarning(TdsParserStateObject stateObj, Boolean callerHasConnectionLock, Boolean asyncClose)
   at Microsoft.Data.SqlClient.TdsParser.TryRun(RunBehavior runBehavior, SqlCommand cmdHandler, SqlDataReader dataStream, BulkCopySimpleResultSet bulkCopyHandler, TdsParserStateObject stateObj, Boolean& dataReady)
   at Microsoft.Data.SqlClient.SqlDataReader.TryHasMoreRows(Boolean& moreRows)
   at Microsoft.Data.SqlClient.SqlDataReader.TryReadInternal(Boolean setTimeout, Boolean& more)
   at Microsoft.Data.SqlClient.SqlDataReader.ReadAsyncExecute(Task task, Object state)
   at Microsoft.Data.SqlClient.SqlDataReader.InvokeAsyncCall[T](SqlDataReaderBaseAsyncCallContext`1 context)
--- End of stack trace from previous location ---
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeResultSetAsync(Int32 startCommandIndex, RelationalDataReader reader, CancellationToken cancellationToken)
ClientConnectionId:20e2460a-ecb1-48bb-bb7f-cd9effff34c3
Error Number:547,State:0,Class:16
   --- End of inner exception stack trace ---
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeResultSetAsync(Int32 startCommandIndex, RelationalDataReader reader, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeAsync(RelationalDataReader reader, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Update.Internal.SqlServerModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(IList`1 entriesToSave, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(StateManager stateManager, Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Storage.Internal.SqlServerExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
2025-02-02 23:42:12.439 +03:00 [INF] Executed action NayifatAPI.Controllers.AuthController.SignIn (NayifatAPI) in 49.6507ms
2025-02-02 23:42:12.440 +03:00 [INF] Executed endpoint 'NayifatAPI.Controllers.AuthController.SignIn (NayifatAPI)'
2025-02-02 23:42:12.440 +03:00 [ERR] Unhandled exception
Microsoft.EntityFrameworkCore.DbUpdateException: An error occurred while saving the entity changes. See the inner exception for details.
 ---> Microsoft.Data.SqlClient.SqlException (0x80131904): The MERGE statement conflicted with the FOREIGN KEY constraint "FK_AuthLogs_Customers_NationalId". The conflict occurred in database "NayifatApp", table "dbo.Customers", column 'NationalId'.
   at Microsoft.Data.SqlClient.SqlConnection.OnError(SqlException exception, Boolean breakConnection, Action`1 wrapCloseInAction)
   at Microsoft.Data.SqlClient.SqlInternalConnection.OnError(SqlException exception, Boolean breakConnection, Action`1 wrapCloseInAction)
   at Microsoft.Data.SqlClient.TdsParser.ThrowExceptionAndWarning(TdsParserStateObject stateObj, Boolean callerHasConnectionLock, Boolean asyncClose)
   at Microsoft.Data.SqlClient.TdsParser.TryRun(RunBehavior runBehavior, SqlCommand cmdHandler, SqlDataReader dataStream, BulkCopySimpleResultSet bulkCopyHandler, TdsParserStateObject stateObj, Boolean& dataReady)
   at Microsoft.Data.SqlClient.SqlDataReader.TryHasMoreRows(Boolean& moreRows)
   at Microsoft.Data.SqlClient.SqlDataReader.TryReadInternal(Boolean setTimeout, Boolean& more)
   at Microsoft.Data.SqlClient.SqlDataReader.ReadAsyncExecute(Task task, Object state)
   at Microsoft.Data.SqlClient.SqlDataReader.InvokeAsyncCall[T](SqlDataReaderBaseAsyncCallContext`1 context)
--- End of stack trace from previous location ---
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeResultSetAsync(Int32 startCommandIndex, RelationalDataReader reader, CancellationToken cancellationToken)
ClientConnectionId:20e2460a-ecb1-48bb-bb7f-cd9effff34c3
Error Number:547,State:0,Class:16
   --- End of inner exception stack trace ---
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeResultSetAsync(Int32 startCommandIndex, RelationalDataReader reader, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeAsync(RelationalDataReader reader, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Update.Internal.SqlServerModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(IList`1 entriesToSave, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(StateManager stateManager, Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Storage.Internal.SqlServerExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at NayifatAPI.Controllers.AuthController.LogAuthAttempt(String nationalId, String deviceId, String status, String failureReason) in C:\Users\yamta\StudioProjects\nayifat_app_2025_new\nayifatapi\Controllers\AuthController.cs:line 367
   at NayifatAPI.Controllers.AuthController.SignIn(SignInRequest request) in C:\Users\yamta\StudioProjects\nayifat_app_2025_new\nayifatapi\Controllers\AuthController.cs:line 103
   at Microsoft.AspNetCore.Mvc.Infrastructure.ActionMethodExecutor.TaskOfIActionResultExecutor.Execute(ActionContext actionContext, IActionResultTypeMapper mapper, ObjectMethodExecutor executor, Object controller, Object[] arguments)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.<InvokeActionMethodAsync>g__Awaited|12_0(ControllerActionInvoker invoker, ValueTask`1 actionResultValueTask)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.<InvokeNextActionFilterAsync>g__Awaited|10_0(ControllerActionInvoker invoker, Task lastTask, State next, Scope scope, Object state, Boolean isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.Rethrow(ActionExecutedContextSealed context)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.Next(State& next, Scope& scope, Object& state, Boolean& isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.<InvokeInnerFilterAsync>g__Awaited|13_0(ControllerActionInvoker invoker, Task lastTask, State next, Scope scope, Object state, Boolean isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeFilterPipelineAsync>g__Awaited|20_0(ResourceInvoker invoker, Task lastTask, State next, Scope scope, Object state, Boolean isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeAsync>g__Logged|17_1(ResourceInvoker invoker)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeAsync>g__Logged|17_1(ResourceInvoker invoker)
   at Microsoft.AspNetCore.Routing.EndpointMiddleware.<Invoke>g__AwaitRequestTask|7_0(Endpoint endpoint, Task requestTask, ILogger logger)
   at Microsoft.AspNetCore.Authorization.AuthorizationMiddleware.Invoke(HttpContext context)
   at Program.<>c.<<<Main>$>b__0_3>d.MoveNext() in C:\Users\yamta\StudioProjects\nayifat_app_2025_new\nayifatapi\Program.cs:line 85
2025-02-02 23:42:12.449 +03:00 [ERR] An unhandled exception has occurred while executing the request.
Microsoft.EntityFrameworkCore.DbUpdateException: An error occurred while saving the entity changes. See the inner exception for details.
 ---> Microsoft.Data.SqlClient.SqlException (0x80131904): The MERGE statement conflicted with the FOREIGN KEY constraint "FK_AuthLogs_Customers_NationalId". The conflict occurred in database "NayifatApp", table "dbo.Customers", column 'NationalId'.
   at Microsoft.Data.SqlClient.SqlConnection.OnError(SqlException exception, Boolean breakConnection, Action`1 wrapCloseInAction)
   at Microsoft.Data.SqlClient.SqlInternalConnection.OnError(SqlException exception, Boolean breakConnection, Action`1 wrapCloseInAction)
   at Microsoft.Data.SqlClient.TdsParser.ThrowExceptionAndWarning(TdsParserStateObject stateObj, Boolean callerHasConnectionLock, Boolean asyncClose)
   at Microsoft.Data.SqlClient.TdsParser.TryRun(RunBehavior runBehavior, SqlCommand cmdHandler, SqlDataReader dataStream, BulkCopySimpleResultSet bulkCopyHandler, TdsParserStateObject stateObj, Boolean& dataReady)
   at Microsoft.Data.SqlClient.SqlDataReader.TryHasMoreRows(Boolean& moreRows)
   at Microsoft.Data.SqlClient.SqlDataReader.TryReadInternal(Boolean setTimeout, Boolean& more)
   at Microsoft.Data.SqlClient.SqlDataReader.ReadAsyncExecute(Task task, Object state)
   at Microsoft.Data.SqlClient.SqlDataReader.InvokeAsyncCall[T](SqlDataReaderBaseAsyncCallContext`1 context)
--- End of stack trace from previous location ---
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeResultSetAsync(Int32 startCommandIndex, RelationalDataReader reader, CancellationToken cancellationToken)
ClientConnectionId:20e2460a-ecb1-48bb-bb7f-cd9effff34c3
Error Number:547,State:0,Class:16
   --- End of inner exception stack trace ---
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeResultSetAsync(Int32 startCommandIndex, RelationalDataReader reader, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeAsync(RelationalDataReader reader, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Update.Internal.SqlServerModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(IList`1 entriesToSave, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(StateManager stateManager, Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Storage.Internal.SqlServerExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at NayifatAPI.Controllers.AuthController.LogAuthAttempt(String nationalId, String deviceId, String status, String failureReason) in C:\Users\yamta\StudioProjects\nayifat_app_2025_new\nayifatapi\Controllers\AuthController.cs:line 367
   at NayifatAPI.Controllers.AuthController.SignIn(SignInRequest request) in C:\Users\yamta\StudioProjects\nayifat_app_2025_new\nayifatapi\Controllers\AuthController.cs:line 103
   at Microsoft.AspNetCore.Mvc.Infrastructure.ActionMethodExecutor.TaskOfIActionResultExecutor.Execute(ActionContext actionContext, IActionResultTypeMapper mapper, ObjectMethodExecutor executor, Object controller, Object[] arguments)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.<InvokeActionMethodAsync>g__Awaited|12_0(ControllerActionInvoker invoker, ValueTask`1 actionResultValueTask)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.<InvokeNextActionFilterAsync>g__Awaited|10_0(ControllerActionInvoker invoker, Task lastTask, State next, Scope scope, Object state, Boolean isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.Rethrow(ActionExecutedContextSealed context)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.Next(State& next, Scope& scope, Object& state, Boolean& isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.<InvokeInnerFilterAsync>g__Awaited|13_0(ControllerActionInvoker invoker, Task lastTask, State next, Scope scope, Object state, Boolean isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeFilterPipelineAsync>g__Awaited|20_0(ResourceInvoker invoker, Task lastTask, State next, Scope scope, Object state, Boolean isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeAsync>g__Logged|17_1(ResourceInvoker invoker)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeAsync>g__Logged|17_1(ResourceInvoker invoker)
   at Microsoft.AspNetCore.Routing.EndpointMiddleware.<Invoke>g__AwaitRequestTask|7_0(Endpoint endpoint, Task requestTask, ILogger logger)
   at Microsoft.AspNetCore.Authorization.AuthorizationMiddleware.Invoke(HttpContext context)
   at Program.<>c.<<<Main>$>b__0_3>d.MoveNext() in C:\Users\yamta\StudioProjects\nayifat_app_2025_new\nayifatapi\Program.cs:line 85
--- End of stack trace from previous location ---
   at Swashbuckle.AspNetCore.SwaggerUI.SwaggerUIMiddleware.Invoke(HttpContext httpContext)
   at Swashbuckle.AspNetCore.Swagger.SwaggerMiddleware.Invoke(HttpContext httpContext, ISwaggerProvider swaggerProvider)
   at Microsoft.AspNetCore.Authentication.AuthenticationMiddleware.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Diagnostics.DeveloperExceptionPageMiddlewareImpl.Invoke(HttpContext context)
2025-02-02 23:42:12.460 +03:00 [INF] Request finished HTTP/1.1 POST http://07ca-46-152-255-232.ngrok-free.app/api/auth/signin - 500 null text/plain; charset=utf-8 79.0099ms
2025-02-02 23:42:41.080 +03:00 [INF] Request starting HTTP/1.1 POST http://07ca-46-152-255-232.ngrok-free.app/api/notifications/list - application/json; charset=utf-8 47
2025-02-02 23:42:41.083 +03:00 [INF] Executing endpoint 'NayifatAPI.Controllers.NotificationsController.GetNotifications (NayifatAPI)'
2025-02-02 23:42:41.084 +03:00 [INF] Route matched with {action = "GetNotifications", controller = "Notifications"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetNotifications(NayifatAPI.Controllers.GetNotificationsRequest) on controller NayifatAPI.Controllers.NotificationsController (NayifatAPI).
2025-02-02 23:42:41.087 +03:00 [INF] Executed DbCommand (2ms) [Parameters=[@__providedApiKey_0='?' (Size = 255)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [a].[Key], [a].[CreatedAt], [a].[Description], [a].[ExpiresAt], [a].[IsActive], [a].[LastUsedAt]
FROM [ApiKeys] AS [a]
WHERE [a].[Key] = @__providedApiKey_0 AND [a].[IsActive] = CAST(1 AS bit)
2025-02-02 23:42:41.091 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@__request_NationalId_0='?' (Size = 450)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [u].[national_id], [u].[last_updated], [u].[notifications]
FROM [user_notifications] AS [u]
WHERE [u].[national_id] = @__request_NationalId_0
2025-02-02 23:42:41.095 +03:00 [INF] Executed DbCommand (2ms) [Parameters=[@__Parse_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [n].[Id], [n].[additional_data], [n].[Body], [n].[body_ar], [n].[body_en], [n].[created_at], [n].[expiry_at], [n].[Route], [n].[target_criteria], [n].[Title], [n].[title_ar], [n].[title_en]
FROM [notification_templates] AS [n]
WHERE [n].[Id] = @__Parse_0
2025-02-02 23:42:41.097 +03:00 [INF] Executed DbCommand (0ms) [Parameters=[@__Parse_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [n].[Id], [n].[additional_data], [n].[Body], [n].[body_ar], [n].[body_en], [n].[created_at], [n].[expiry_at], [n].[Route], [n].[target_criteria], [n].[Title], [n].[title_ar], [n].[title_en]
FROM [notification_templates] AS [n]
WHERE [n].[Id] = @__Parse_0
2025-02-02 23:42:41.106 +03:00 [INF] Executed DbCommand (8ms) [Parameters=[@p0='?' (Size = 4000), @p1='?' (DbType = DateTime2), @p2='?' (Size = 4000), @p3='?' (Size = 4000), @p4='?' (Size = 4000), @p5='?' (Size = 450), @p6='?' (Size = 4000), @p7='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SET IMPLICIT_TRANSACTIONS OFF;
SET NOCOUNT ON;
INSERT INTO [AuthLogs] ([AuthType], [CreatedAt], [DeviceId], [FailureReason], [IpAddress], [NationalId], [Status], [UserAgent])
OUTPUT INSERTED.[Id]
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7);
2025-02-02 23:42:41.108 +03:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType9`2[[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Object, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-02-02 23:42:41.109 +03:00 [INF] Executed action NayifatAPI.Controllers.NotificationsController.GetNotifications (NayifatAPI) in 24.2397ms
2025-02-02 23:42:41.110 +03:00 [INF] Executed endpoint 'NayifatAPI.Controllers.NotificationsController.GetNotifications (NayifatAPI)'
2025-02-02 23:42:41.111 +03:00 [INF] Request finished HTTP/1.1 POST http://07ca-46-152-255-232.ngrok-free.app/api/notifications/list - 200 null application/json; charset=utf-8 30.8773ms
2025-02-02 23:42:57.045 +03:00 [INF] Request starting HTTP/1.1 POST http://07ca-46-152-255-232.ngrok-free.app/api/auth/signin - application/json; charset=utf-8 70
2025-02-02 23:42:57.049 +03:00 [INF] Executing endpoint 'NayifatAPI.Controllers.AuthController.SignIn (NayifatAPI)'
2025-02-02 23:42:57.049 +03:00 [INF] Route matched with {action = "SignIn", controller = "Auth"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] SignIn(NayifatAPI.Controllers.SignInRequest) on controller NayifatAPI.Controllers.AuthController (NayifatAPI).
2025-02-02 23:42:57.051 +03:00 [INF] Executed DbCommand (0ms) [Parameters=[@__providedApiKey_0='?' (Size = 255)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [a].[Key], [a].[CreatedAt], [a].[Description], [a].[ExpiresAt], [a].[IsActive], [a].[LastUsedAt]
FROM [ApiKeys] AS [a]
WHERE [a].[Key] = @__providedApiKey_0 AND [a].[IsActive] = CAST(1 AS bit)
2025-02-02 23:42:57.056 +03:00 [INF] Executed DbCommand (3ms) [Parameters=[@__request_NationalId_0='?' (Size = 450)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [c].[NationalId], [c].[AddNo], [c].[BuildingNo], [c].[City], [c].[Consent], [c].[ConsentDate], [c].[DateOfBirth], [c].[Dependents], [c].[District], [c].[Email], [c].[Employer], [c].[FamilyNameAr], [c].[FamilyNameEn], [c].[FirstNameAr], [c].[FirstNameEn], [c].[Iban], [c].[IdExpiryDate], [c].[Los], [c].[Mpin], [c].[MpinEnabled], [c].[NafathStatus], [c].[NafathTimestamp], [c].[Password], [c].[Phone], [c].[RegistrationDate], [c].[SalaryCustomer], [c].[SalaryDakhli], [c].[SecondNameAr], [c].[SecondNameEn], [c].[Sector], [c].[Street], [c].[ThirdNameAr], [c].[ThirdNameEn], [c].[Zipcode]
FROM [Customers] AS [c]
WHERE [c].[NationalId] = @__request_NationalId_0
2025-02-02 23:42:57.058 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@p0='?' (Size = 4000), @p1='?' (DbType = DateTime2), @p2='?' (Size = 4000), @p3='?' (Size = 4000), @p4='?' (Size = 4000), @p5='?' (Size = 450), @p6='?' (Size = 4000), @p7='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SET IMPLICIT_TRANSACTIONS OFF;
SET NOCOUNT ON;
INSERT INTO [AuthLogs] ([AuthType], [CreatedAt], [DeviceId], [FailureReason], [IpAddress], [NationalId], [Status], [UserAgent])
OUTPUT INSERTED.[Id]
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7);
2025-02-02 23:42:57.061 +03:00 [ERR] An exception occurred in the database while saving changes for context type 'NayifatAPI.Data.ApplicationDbContext'.
Microsoft.EntityFrameworkCore.DbUpdateException: An error occurred while saving the entity changes. See the inner exception for details.
 ---> Microsoft.Data.SqlClient.SqlException (0x80131904): The INSERT statement conflicted with the FOREIGN KEY constraint "FK_AuthLogs_Customers_NationalId". The conflict occurred in database "NayifatApp", table "dbo.Customers", column 'NationalId'.
   at Microsoft.Data.SqlClient.SqlConnection.OnError(SqlException exception, Boolean breakConnection, Action`1 wrapCloseInAction)
   at Microsoft.Data.SqlClient.SqlInternalConnection.OnError(SqlException exception, Boolean breakConnection, Action`1 wrapCloseInAction)
   at Microsoft.Data.SqlClient.TdsParser.ThrowExceptionAndWarning(TdsParserStateObject stateObj, Boolean callerHasConnectionLock, Boolean asyncClose)
   at Microsoft.Data.SqlClient.TdsParser.TryRun(RunBehavior runBehavior, SqlCommand cmdHandler, SqlDataReader dataStream, BulkCopySimpleResultSet bulkCopyHandler, TdsParserStateObject stateObj, Boolean& dataReady)
   at Microsoft.Data.SqlClient.SqlDataReader.TryHasMoreRows(Boolean& moreRows)
   at Microsoft.Data.SqlClient.SqlDataReader.TryReadInternal(Boolean setTimeout, Boolean& more)
   at Microsoft.Data.SqlClient.SqlDataReader.ReadAsyncExecute(Task task, Object state)
   at Microsoft.Data.SqlClient.SqlDataReader.InvokeAsyncCall[T](SqlDataReaderBaseAsyncCallContext`1 context)
--- End of stack trace from previous location ---
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeResultSetAsync(Int32 startCommandIndex, RelationalDataReader reader, CancellationToken cancellationToken)
ClientConnectionId:20e2460a-ecb1-48bb-bb7f-cd9effff34c3
Error Number:547,State:0,Class:16
   --- End of inner exception stack trace ---
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeResultSetAsync(Int32 startCommandIndex, RelationalDataReader reader, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeAsync(RelationalDataReader reader, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Update.Internal.SqlServerModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(IList`1 entriesToSave, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(StateManager stateManager, Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Storage.Internal.SqlServerExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
Microsoft.EntityFrameworkCore.DbUpdateException: An error occurred while saving the entity changes. See the inner exception for details.
 ---> Microsoft.Data.SqlClient.SqlException (0x80131904): The INSERT statement conflicted with the FOREIGN KEY constraint "FK_AuthLogs_Customers_NationalId". The conflict occurred in database "NayifatApp", table "dbo.Customers", column 'NationalId'.
   at Microsoft.Data.SqlClient.SqlConnection.OnError(SqlException exception, Boolean breakConnection, Action`1 wrapCloseInAction)
   at Microsoft.Data.SqlClient.SqlInternalConnection.OnError(SqlException exception, Boolean breakConnection, Action`1 wrapCloseInAction)
   at Microsoft.Data.SqlClient.TdsParser.ThrowExceptionAndWarning(TdsParserStateObject stateObj, Boolean callerHasConnectionLock, Boolean asyncClose)
   at Microsoft.Data.SqlClient.TdsParser.TryRun(RunBehavior runBehavior, SqlCommand cmdHandler, SqlDataReader dataStream, BulkCopySimpleResultSet bulkCopyHandler, TdsParserStateObject stateObj, Boolean& dataReady)
   at Microsoft.Data.SqlClient.SqlDataReader.TryHasMoreRows(Boolean& moreRows)
   at Microsoft.Data.SqlClient.SqlDataReader.TryReadInternal(Boolean setTimeout, Boolean& more)
   at Microsoft.Data.SqlClient.SqlDataReader.ReadAsyncExecute(Task task, Object state)
   at Microsoft.Data.SqlClient.SqlDataReader.InvokeAsyncCall[T](SqlDataReaderBaseAsyncCallContext`1 context)
--- End of stack trace from previous location ---
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeResultSetAsync(Int32 startCommandIndex, RelationalDataReader reader, CancellationToken cancellationToken)
ClientConnectionId:20e2460a-ecb1-48bb-bb7f-cd9effff34c3
Error Number:547,State:0,Class:16
   --- End of inner exception stack trace ---
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeResultSetAsync(Int32 startCommandIndex, RelationalDataReader reader, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeAsync(RelationalDataReader reader, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Update.Internal.SqlServerModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(IList`1 entriesToSave, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(StateManager stateManager, Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Storage.Internal.SqlServerExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
2025-02-02 23:42:57.071 +03:00 [ERR] Error during sign in for National ID: 1111111
Microsoft.EntityFrameworkCore.DbUpdateException: An error occurred while saving the entity changes. See the inner exception for details.
 ---> Microsoft.Data.SqlClient.SqlException (0x80131904): The INSERT statement conflicted with the FOREIGN KEY constraint "FK_AuthLogs_Customers_NationalId". The conflict occurred in database "NayifatApp", table "dbo.Customers", column 'NationalId'.
   at Microsoft.Data.SqlClient.SqlConnection.OnError(SqlException exception, Boolean breakConnection, Action`1 wrapCloseInAction)
   at Microsoft.Data.SqlClient.SqlInternalConnection.OnError(SqlException exception, Boolean breakConnection, Action`1 wrapCloseInAction)
   at Microsoft.Data.SqlClient.TdsParser.ThrowExceptionAndWarning(TdsParserStateObject stateObj, Boolean callerHasConnectionLock, Boolean asyncClose)
   at Microsoft.Data.SqlClient.TdsParser.TryRun(RunBehavior runBehavior, SqlCommand cmdHandler, SqlDataReader dataStream, BulkCopySimpleResultSet bulkCopyHandler, TdsParserStateObject stateObj, Boolean& dataReady)
   at Microsoft.Data.SqlClient.SqlDataReader.TryHasMoreRows(Boolean& moreRows)
   at Microsoft.Data.SqlClient.SqlDataReader.TryReadInternal(Boolean setTimeout, Boolean& more)
   at Microsoft.Data.SqlClient.SqlDataReader.ReadAsyncExecute(Task task, Object state)
   at Microsoft.Data.SqlClient.SqlDataReader.InvokeAsyncCall[T](SqlDataReaderBaseAsyncCallContext`1 context)
--- End of stack trace from previous location ---
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeResultSetAsync(Int32 startCommandIndex, RelationalDataReader reader, CancellationToken cancellationToken)
ClientConnectionId:20e2460a-ecb1-48bb-bb7f-cd9effff34c3
Error Number:547,State:0,Class:16
   --- End of inner exception stack trace ---
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeResultSetAsync(Int32 startCommandIndex, RelationalDataReader reader, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeAsync(RelationalDataReader reader, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Update.Internal.SqlServerModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(IList`1 entriesToSave, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(StateManager stateManager, Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Storage.Internal.SqlServerExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at NayifatAPI.Controllers.AuthController.LogAuthAttempt(String nationalId, String deviceId, String status, String failureReason) in C:\Users\yamta\StudioProjects\nayifat_app_2025_new\nayifatapi\Controllers\AuthController.cs:line 367
   at NayifatAPI.Controllers.AuthController.SignIn(SignInRequest request) in C:\Users\yamta\StudioProjects\nayifat_app_2025_new\nayifatapi\Controllers\AuthController.cs:line 41
2025-02-02 23:42:57.083 +03:00 [INF] Executed DbCommand (5ms) [Parameters=[@p0='?' (Size = 4000), @p1='?' (DbType = DateTime2), @p2='?' (Size = 4000), @p3='?' (Size = 4000), @p4='?' (Size = 4000), @p5='?' (Size = 450), @p6='?' (Size = 4000), @p7='?' (Size = 4000), @p8='?' (Size = 4000), @p9='?' (DbType = DateTime2), @p10='?' (Size = 4000), @p11='?' (Size = 4000), @p12='?' (Size = 4000), @p13='?' (Size = 450), @p14='?' (Size = 4000), @p15='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SET IMPLICIT_TRANSACTIONS OFF;
SET NOCOUNT ON;
MERGE [AuthLogs] USING (
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7, 0),
(@p8, @p9, @p10, @p11, @p12, @p13, @p14, @p15, 1)) AS i ([AuthType], [CreatedAt], [DeviceId], [FailureReason], [IpAddress], [NationalId], [Status], [UserAgent], _Position) ON 1=0
WHEN NOT MATCHED THEN
INSERT ([AuthType], [CreatedAt], [DeviceId], [FailureReason], [IpAddress], [NationalId], [Status], [UserAgent])
VALUES (i.[AuthType], i.[CreatedAt], i.[DeviceId], i.[FailureReason], i.[IpAddress], i.[NationalId], i.[Status], i.[UserAgent])
OUTPUT INSERTED.[Id], i._Position;
2025-02-02 23:42:57.086 +03:00 [ERR] An exception occurred in the database while saving changes for context type 'NayifatAPI.Data.ApplicationDbContext'.
Microsoft.EntityFrameworkCore.DbUpdateException: An error occurred while saving the entity changes. See the inner exception for details.
 ---> Microsoft.Data.SqlClient.SqlException (0x80131904): The MERGE statement conflicted with the FOREIGN KEY constraint "FK_AuthLogs_Customers_NationalId". The conflict occurred in database "NayifatApp", table "dbo.Customers", column 'NationalId'.
   at Microsoft.Data.SqlClient.SqlConnection.OnError(SqlException exception, Boolean breakConnection, Action`1 wrapCloseInAction)
   at Microsoft.Data.SqlClient.SqlInternalConnection.OnError(SqlException exception, Boolean breakConnection, Action`1 wrapCloseInAction)
   at Microsoft.Data.SqlClient.TdsParser.ThrowExceptionAndWarning(TdsParserStateObject stateObj, Boolean callerHasConnectionLock, Boolean asyncClose)
   at Microsoft.Data.SqlClient.TdsParser.TryRun(RunBehavior runBehavior, SqlCommand cmdHandler, SqlDataReader dataStream, BulkCopySimpleResultSet bulkCopyHandler, TdsParserStateObject stateObj, Boolean& dataReady)
   at Microsoft.Data.SqlClient.SqlDataReader.TryHasMoreRows(Boolean& moreRows)
   at Microsoft.Data.SqlClient.SqlDataReader.TryReadInternal(Boolean setTimeout, Boolean& more)
   at Microsoft.Data.SqlClient.SqlDataReader.ReadAsyncExecute(Task task, Object state)
   at Microsoft.Data.SqlClient.SqlDataReader.InvokeAsyncCall[T](SqlDataReaderBaseAsyncCallContext`1 context)
--- End of stack trace from previous location ---
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeResultSetAsync(Int32 startCommandIndex, RelationalDataReader reader, CancellationToken cancellationToken)
ClientConnectionId:20e2460a-ecb1-48bb-bb7f-cd9effff34c3
Error Number:547,State:0,Class:16
   --- End of inner exception stack trace ---
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeResultSetAsync(Int32 startCommandIndex, RelationalDataReader reader, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeAsync(RelationalDataReader reader, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Update.Internal.SqlServerModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(IList`1 entriesToSave, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(StateManager stateManager, Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Storage.Internal.SqlServerExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
Microsoft.EntityFrameworkCore.DbUpdateException: An error occurred while saving the entity changes. See the inner exception for details.
 ---> Microsoft.Data.SqlClient.SqlException (0x80131904): The MERGE statement conflicted with the FOREIGN KEY constraint "FK_AuthLogs_Customers_NationalId". The conflict occurred in database "NayifatApp", table "dbo.Customers", column 'NationalId'.
   at Microsoft.Data.SqlClient.SqlConnection.OnError(SqlException exception, Boolean breakConnection, Action`1 wrapCloseInAction)
   at Microsoft.Data.SqlClient.SqlInternalConnection.OnError(SqlException exception, Boolean breakConnection, Action`1 wrapCloseInAction)
   at Microsoft.Data.SqlClient.TdsParser.ThrowExceptionAndWarning(TdsParserStateObject stateObj, Boolean callerHasConnectionLock, Boolean asyncClose)
   at Microsoft.Data.SqlClient.TdsParser.TryRun(RunBehavior runBehavior, SqlCommand cmdHandler, SqlDataReader dataStream, BulkCopySimpleResultSet bulkCopyHandler, TdsParserStateObject stateObj, Boolean& dataReady)
   at Microsoft.Data.SqlClient.SqlDataReader.TryHasMoreRows(Boolean& moreRows)
   at Microsoft.Data.SqlClient.SqlDataReader.TryReadInternal(Boolean setTimeout, Boolean& more)
   at Microsoft.Data.SqlClient.SqlDataReader.ReadAsyncExecute(Task task, Object state)
   at Microsoft.Data.SqlClient.SqlDataReader.InvokeAsyncCall[T](SqlDataReaderBaseAsyncCallContext`1 context)
--- End of stack trace from previous location ---
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeResultSetAsync(Int32 startCommandIndex, RelationalDataReader reader, CancellationToken cancellationToken)
ClientConnectionId:20e2460a-ecb1-48bb-bb7f-cd9effff34c3
Error Number:547,State:0,Class:16
   --- End of inner exception stack trace ---
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeResultSetAsync(Int32 startCommandIndex, RelationalDataReader reader, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeAsync(RelationalDataReader reader, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Update.Internal.SqlServerModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(IList`1 entriesToSave, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(StateManager stateManager, Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Storage.Internal.SqlServerExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
2025-02-02 23:42:57.096 +03:00 [INF] Executed action NayifatAPI.Controllers.AuthController.SignIn (NayifatAPI) in 45.936ms
2025-02-02 23:42:57.097 +03:00 [INF] Executed endpoint 'NayifatAPI.Controllers.AuthController.SignIn (NayifatAPI)'
2025-02-02 23:42:57.098 +03:00 [ERR] Unhandled exception
Microsoft.EntityFrameworkCore.DbUpdateException: An error occurred while saving the entity changes. See the inner exception for details.
 ---> Microsoft.Data.SqlClient.SqlException (0x80131904): The MERGE statement conflicted with the FOREIGN KEY constraint "FK_AuthLogs_Customers_NationalId". The conflict occurred in database "NayifatApp", table "dbo.Customers", column 'NationalId'.
   at Microsoft.Data.SqlClient.SqlConnection.OnError(SqlException exception, Boolean breakConnection, Action`1 wrapCloseInAction)
   at Microsoft.Data.SqlClient.SqlInternalConnection.OnError(SqlException exception, Boolean breakConnection, Action`1 wrapCloseInAction)
   at Microsoft.Data.SqlClient.TdsParser.ThrowExceptionAndWarning(TdsParserStateObject stateObj, Boolean callerHasConnectionLock, Boolean asyncClose)
   at Microsoft.Data.SqlClient.TdsParser.TryRun(RunBehavior runBehavior, SqlCommand cmdHandler, SqlDataReader dataStream, BulkCopySimpleResultSet bulkCopyHandler, TdsParserStateObject stateObj, Boolean& dataReady)
   at Microsoft.Data.SqlClient.SqlDataReader.TryHasMoreRows(Boolean& moreRows)
   at Microsoft.Data.SqlClient.SqlDataReader.TryReadInternal(Boolean setTimeout, Boolean& more)
   at Microsoft.Data.SqlClient.SqlDataReader.ReadAsyncExecute(Task task, Object state)
   at Microsoft.Data.SqlClient.SqlDataReader.InvokeAsyncCall[T](SqlDataReaderBaseAsyncCallContext`1 context)
--- End of stack trace from previous location ---
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeResultSetAsync(Int32 startCommandIndex, RelationalDataReader reader, CancellationToken cancellationToken)
ClientConnectionId:20e2460a-ecb1-48bb-bb7f-cd9effff34c3
Error Number:547,State:0,Class:16
   --- End of inner exception stack trace ---
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeResultSetAsync(Int32 startCommandIndex, RelationalDataReader reader, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeAsync(RelationalDataReader reader, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Update.Internal.SqlServerModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(IList`1 entriesToSave, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(StateManager stateManager, Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Storage.Internal.SqlServerExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at NayifatAPI.Controllers.AuthController.LogAuthAttempt(String nationalId, String deviceId, String status, String failureReason) in C:\Users\yamta\StudioProjects\nayifat_app_2025_new\nayifatapi\Controllers\AuthController.cs:line 367
   at NayifatAPI.Controllers.AuthController.SignIn(SignInRequest request) in C:\Users\yamta\StudioProjects\nayifat_app_2025_new\nayifatapi\Controllers\AuthController.cs:line 103
   at Microsoft.AspNetCore.Mvc.Infrastructure.ActionMethodExecutor.TaskOfIActionResultExecutor.Execute(ActionContext actionContext, IActionResultTypeMapper mapper, ObjectMethodExecutor executor, Object controller, Object[] arguments)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.<InvokeActionMethodAsync>g__Awaited|12_0(ControllerActionInvoker invoker, ValueTask`1 actionResultValueTask)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.<InvokeNextActionFilterAsync>g__Awaited|10_0(ControllerActionInvoker invoker, Task lastTask, State next, Scope scope, Object state, Boolean isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.Rethrow(ActionExecutedContextSealed context)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.Next(State& next, Scope& scope, Object& state, Boolean& isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.<InvokeInnerFilterAsync>g__Awaited|13_0(ControllerActionInvoker invoker, Task lastTask, State next, Scope scope, Object state, Boolean isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeFilterPipelineAsync>g__Awaited|20_0(ResourceInvoker invoker, Task lastTask, State next, Scope scope, Object state, Boolean isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeAsync>g__Logged|17_1(ResourceInvoker invoker)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeAsync>g__Logged|17_1(ResourceInvoker invoker)
   at Microsoft.AspNetCore.Routing.EndpointMiddleware.<Invoke>g__AwaitRequestTask|7_0(Endpoint endpoint, Task requestTask, ILogger logger)
   at Microsoft.AspNetCore.Authorization.AuthorizationMiddleware.Invoke(HttpContext context)
   at Program.<>c.<<<Main>$>b__0_3>d.MoveNext() in C:\Users\yamta\StudioProjects\nayifat_app_2025_new\nayifatapi\Program.cs:line 85
2025-02-02 23:42:57.107 +03:00 [ERR] An unhandled exception has occurred while executing the request.
Microsoft.EntityFrameworkCore.DbUpdateException: An error occurred while saving the entity changes. See the inner exception for details.
 ---> Microsoft.Data.SqlClient.SqlException (0x80131904): The MERGE statement conflicted with the FOREIGN KEY constraint "FK_AuthLogs_Customers_NationalId". The conflict occurred in database "NayifatApp", table "dbo.Customers", column 'NationalId'.
   at Microsoft.Data.SqlClient.SqlConnection.OnError(SqlException exception, Boolean breakConnection, Action`1 wrapCloseInAction)
   at Microsoft.Data.SqlClient.SqlInternalConnection.OnError(SqlException exception, Boolean breakConnection, Action`1 wrapCloseInAction)
   at Microsoft.Data.SqlClient.TdsParser.ThrowExceptionAndWarning(TdsParserStateObject stateObj, Boolean callerHasConnectionLock, Boolean asyncClose)
   at Microsoft.Data.SqlClient.TdsParser.TryRun(RunBehavior runBehavior, SqlCommand cmdHandler, SqlDataReader dataStream, BulkCopySimpleResultSet bulkCopyHandler, TdsParserStateObject stateObj, Boolean& dataReady)
   at Microsoft.Data.SqlClient.SqlDataReader.TryHasMoreRows(Boolean& moreRows)
   at Microsoft.Data.SqlClient.SqlDataReader.TryReadInternal(Boolean setTimeout, Boolean& more)
   at Microsoft.Data.SqlClient.SqlDataReader.ReadAsyncExecute(Task task, Object state)
   at Microsoft.Data.SqlClient.SqlDataReader.InvokeAsyncCall[T](SqlDataReaderBaseAsyncCallContext`1 context)
--- End of stack trace from previous location ---
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeResultSetAsync(Int32 startCommandIndex, RelationalDataReader reader, CancellationToken cancellationToken)
ClientConnectionId:20e2460a-ecb1-48bb-bb7f-cd9effff34c3
Error Number:547,State:0,Class:16
   --- End of inner exception stack trace ---
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeResultSetAsync(Int32 startCommandIndex, RelationalDataReader reader, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeAsync(RelationalDataReader reader, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Update.Internal.SqlServerModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(IList`1 entriesToSave, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(StateManager stateManager, Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Storage.Internal.SqlServerExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at NayifatAPI.Controllers.AuthController.LogAuthAttempt(String nationalId, String deviceId, String status, String failureReason) in C:\Users\yamta\StudioProjects\nayifat_app_2025_new\nayifatapi\Controllers\AuthController.cs:line 367
   at NayifatAPI.Controllers.AuthController.SignIn(SignInRequest request) in C:\Users\yamta\StudioProjects\nayifat_app_2025_new\nayifatapi\Controllers\AuthController.cs:line 103
   at Microsoft.AspNetCore.Mvc.Infrastructure.ActionMethodExecutor.TaskOfIActionResultExecutor.Execute(ActionContext actionContext, IActionResultTypeMapper mapper, ObjectMethodExecutor executor, Object controller, Object[] arguments)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.<InvokeActionMethodAsync>g__Awaited|12_0(ControllerActionInvoker invoker, ValueTask`1 actionResultValueTask)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.<InvokeNextActionFilterAsync>g__Awaited|10_0(ControllerActionInvoker invoker, Task lastTask, State next, Scope scope, Object state, Boolean isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.Rethrow(ActionExecutedContextSealed context)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.Next(State& next, Scope& scope, Object& state, Boolean& isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.<InvokeInnerFilterAsync>g__Awaited|13_0(ControllerActionInvoker invoker, Task lastTask, State next, Scope scope, Object state, Boolean isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeFilterPipelineAsync>g__Awaited|20_0(ResourceInvoker invoker, Task lastTask, State next, Scope scope, Object state, Boolean isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeAsync>g__Logged|17_1(ResourceInvoker invoker)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeAsync>g__Logged|17_1(ResourceInvoker invoker)
   at Microsoft.AspNetCore.Routing.EndpointMiddleware.<Invoke>g__AwaitRequestTask|7_0(Endpoint endpoint, Task requestTask, ILogger logger)
   at Microsoft.AspNetCore.Authorization.AuthorizationMiddleware.Invoke(HttpContext context)
   at Program.<>c.<<<Main>$>b__0_3>d.MoveNext() in C:\Users\yamta\StudioProjects\nayifat_app_2025_new\nayifatapi\Program.cs:line 85
--- End of stack trace from previous location ---
   at Swashbuckle.AspNetCore.SwaggerUI.SwaggerUIMiddleware.Invoke(HttpContext httpContext)
   at Swashbuckle.AspNetCore.Swagger.SwaggerMiddleware.Invoke(HttpContext httpContext, ISwaggerProvider swaggerProvider)
   at Microsoft.AspNetCore.Authentication.AuthenticationMiddleware.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Diagnostics.DeveloperExceptionPageMiddlewareImpl.Invoke(HttpContext context)
2025-02-02 23:42:57.118 +03:00 [INF] Request finished HTTP/1.1 POST http://07ca-46-152-255-232.ngrok-free.app/api/auth/signin - 500 null text/plain; charset=utf-8 72.9484ms
2025-02-02 23:43:13.696 +03:00 [INF] Application is shutting down...
2025-02-02 23:43:26.810 +03:00 [INF] Starting web application
2025-02-02 23:43:26.899 +03:00 [INF] Now listening on: http://localhost:5264
2025-02-02 23:43:26.904 +03:00 [INF] Application started. Press Ctrl+C to shut down.
2025-02-02 23:43:26.905 +03:00 [INF] Hosting environment: Development
2025-02-02 23:43:26.906 +03:00 [INF] Content root path: C:\Users\yamta\StudioProjects\nayifat_app_2025_new\nayifatapi
2025-02-02 23:43:56.273 +03:00 [INF] Request starting HTTP/1.1 POST http://07ca-46-152-255-232.ngrok-free.app/api/auth/signin - application/json; charset=utf-8 70
2025-02-02 23:43:56.310 +03:00 [WRN] Failed to determine the https port for redirect.
2025-02-02 23:43:56.316 +03:00 [INF] Executing endpoint 'NayifatAPI.Controllers.AuthController.SignIn (NayifatAPI)'
2025-02-02 23:43:56.337 +03:00 [INF] Route matched with {action = "SignIn", controller = "Auth"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] SignIn(NayifatAPI.Controllers.SignInRequest) on controller NayifatAPI.Controllers.AuthController (NayifatAPI).
2025-02-02 23:43:57.446 +03:00 [INF] Executed DbCommand (27ms) [Parameters=[@__providedApiKey_0='?' (Size = 255)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [a].[Key], [a].[CreatedAt], [a].[Description], [a].[ExpiresAt], [a].[IsActive], [a].[LastUsedAt]
FROM [ApiKeys] AS [a]
WHERE [a].[Key] = @__providedApiKey_0 AND [a].[IsActive] = CAST(1 AS bit)
2025-02-02 23:43:57.533 +03:00 [INF] Executed DbCommand (11ms) [Parameters=[@__request_NationalId_0='?' (Size = 450)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [c].[NationalId], [c].[AddNo], [c].[BuildingNo], [c].[City], [c].[Consent], [c].[ConsentDate], [c].[DateOfBirth], [c].[Dependents], [c].[District], [c].[Email], [c].[Employer], [c].[FamilyNameAr], [c].[FamilyNameEn], [c].[FirstNameAr], [c].[FirstNameEn], [c].[Iban], [c].[IdExpiryDate], [c].[Los], [c].[Mpin], [c].[MpinEnabled], [c].[NafathStatus], [c].[NafathTimestamp], [c].[Password], [c].[Phone], [c].[RegistrationDate], [c].[SalaryCustomer], [c].[SalaryDakhli], [c].[SecondNameAr], [c].[SecondNameEn], [c].[Sector], [c].[Street], [c].[ThirdNameAr], [c].[ThirdNameEn], [c].[Zipcode]
FROM [Customers] AS [c]
WHERE [c].[NationalId] = @__request_NationalId_0
2025-02-02 23:43:57.555 +03:00 [INF] Executing ObjectResult, writing value of type '<>f__AnonymousType12`3[[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Object, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-02-02 23:43:57.573 +03:00 [INF] Executed action NayifatAPI.Controllers.AuthController.SignIn (NayifatAPI) in 1229.4597ms
2025-02-02 23:43:57.575 +03:00 [INF] Executed endpoint 'NayifatAPI.Controllers.AuthController.SignIn (NayifatAPI)'
2025-02-02 23:43:57.586 +03:00 [INF] Request finished HTTP/1.1 POST http://07ca-46-152-255-232.ngrok-free.app/api/auth/signin - 401 null application/json; charset=utf-8 1314.1569ms
2025-02-02 23:45:58.397 +03:00 [INF] Request starting HTTP/1.1 POST http://07ca-46-152-255-232.ngrok-free.app/api/auth/signin - application/json; charset=utf-8 70
2025-02-02 23:45:58.403 +03:00 [INF] Executing endpoint 'NayifatAPI.Controllers.AuthController.SignIn (NayifatAPI)'
2025-02-02 23:45:58.404 +03:00 [INF] Route matched with {action = "SignIn", controller = "Auth"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] SignIn(NayifatAPI.Controllers.SignInRequest) on controller NayifatAPI.Controllers.AuthController (NayifatAPI).
2025-02-02 23:45:58.425 +03:00 [INF] Executed DbCommand (2ms) [Parameters=[@__providedApiKey_0='?' (Size = 255)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [a].[Key], [a].[CreatedAt], [a].[Description], [a].[ExpiresAt], [a].[IsActive], [a].[LastUsedAt]
FROM [ApiKeys] AS [a]
WHERE [a].[Key] = @__providedApiKey_0 AND [a].[IsActive] = CAST(1 AS bit)
2025-02-02 23:45:58.432 +03:00 [INF] Executed DbCommand (2ms) [Parameters=[@__request_NationalId_0='?' (Size = 450)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [c].[NationalId], [c].[AddNo], [c].[BuildingNo], [c].[City], [c].[Consent], [c].[ConsentDate], [c].[DateOfBirth], [c].[Dependents], [c].[District], [c].[Email], [c].[Employer], [c].[FamilyNameAr], [c].[FamilyNameEn], [c].[FirstNameAr], [c].[FirstNameEn], [c].[Iban], [c].[IdExpiryDate], [c].[Los], [c].[Mpin], [c].[MpinEnabled], [c].[NafathStatus], [c].[NafathTimestamp], [c].[Password], [c].[Phone], [c].[RegistrationDate], [c].[SalaryCustomer], [c].[SalaryDakhli], [c].[SecondNameAr], [c].[SecondNameEn], [c].[Sector], [c].[Street], [c].[ThirdNameAr], [c].[ThirdNameEn], [c].[Zipcode]
FROM [Customers] AS [c]
WHERE [c].[NationalId] = @__request_NationalId_0
2025-02-02 23:45:58.434 +03:00 [INF] Executing ObjectResult, writing value of type '<>f__AnonymousType12`3[[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Object, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-02-02 23:45:58.436 +03:00 [INF] Executed action NayifatAPI.Controllers.AuthController.SignIn (NayifatAPI) in 29.9721ms
2025-02-02 23:45:58.437 +03:00 [INF] Executed endpoint 'NayifatAPI.Controllers.AuthController.SignIn (NayifatAPI)'
2025-02-02 23:45:58.439 +03:00 [INF] Request finished HTTP/1.1 POST http://07ca-46-152-255-232.ngrok-free.app/api/auth/signin - 401 null application/json; charset=utf-8 41.4282ms
2025-02-02 23:46:07.532 +03:00 [INF] Request starting HTTP/1.1 POST http://07ca-46-152-255-232.ngrok-free.app/api/auth/signin - application/json; charset=utf-8 66
2025-02-02 23:46:07.539 +03:00 [INF] Executing endpoint 'NayifatAPI.Controllers.AuthController.SignIn (NayifatAPI)'
2025-02-02 23:46:07.540 +03:00 [INF] Route matched with {action = "SignIn", controller = "Auth"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] SignIn(NayifatAPI.Controllers.SignInRequest) on controller NayifatAPI.Controllers.AuthController (NayifatAPI).
2025-02-02 23:46:07.590 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@__providedApiKey_0='?' (Size = 255)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [a].[Key], [a].[CreatedAt], [a].[Description], [a].[ExpiresAt], [a].[IsActive], [a].[LastUsedAt]
FROM [ApiKeys] AS [a]
WHERE [a].[Key] = @__providedApiKey_0 AND [a].[IsActive] = CAST(1 AS bit)
2025-02-02 23:46:07.594 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@__request_NationalId_0='?' (Size = 450)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [c].[NationalId], [c].[AddNo], [c].[BuildingNo], [c].[City], [c].[Consent], [c].[ConsentDate], [c].[DateOfBirth], [c].[Dependents], [c].[District], [c].[Email], [c].[Employer], [c].[FamilyNameAr], [c].[FamilyNameEn], [c].[FirstNameAr], [c].[FirstNameEn], [c].[Iban], [c].[IdExpiryDate], [c].[Los], [c].[Mpin], [c].[MpinEnabled], [c].[NafathStatus], [c].[NafathTimestamp], [c].[Password], [c].[Phone], [c].[RegistrationDate], [c].[SalaryCustomer], [c].[SalaryDakhli], [c].[SecondNameAr], [c].[SecondNameEn], [c].[Sector], [c].[Street], [c].[ThirdNameAr], [c].[ThirdNameEn], [c].[Zipcode]
FROM [Customers] AS [c]
WHERE [c].[NationalId] = @__request_NationalId_0
2025-02-02 23:46:07.596 +03:00 [INF] Executing ObjectResult, writing value of type '<>f__AnonymousType12`3[[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Object, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-02-02 23:46:07.597 +03:00 [INF] Executed action NayifatAPI.Controllers.AuthController.SignIn (NayifatAPI) in 55.6746ms
2025-02-02 23:46:07.598 +03:00 [INF] Executed endpoint 'NayifatAPI.Controllers.AuthController.SignIn (NayifatAPI)'
2025-02-02 23:46:07.599 +03:00 [INF] Request finished HTTP/1.1 POST http://07ca-46-152-255-232.ngrok-free.app/api/auth/signin - 401 null application/json; charset=utf-8 66.96ms
2025-02-02 23:46:20.576 +03:00 [INF] Application is shutting down...
2025-02-02 23:47:52.247 +03:00 [INF] Starting web application
2025-02-02 23:47:52.387 +03:00 [INF] Now listening on: http://localhost:5264
2025-02-02 23:47:52.394 +03:00 [INF] Application started. Press Ctrl+C to shut down.
2025-02-02 23:47:52.398 +03:00 [INF] Hosting environment: Development
2025-02-02 23:47:52.400 +03:00 [INF] Content root path: C:\Users\yamta\StudioProjects\nayifat_app_2025_new\nayifatapi
2025-02-02 23:48:20.797 +03:00 [INF] Request starting HTTP/1.1 POST http://07ca-46-152-255-232.ngrok-free.app/api/auth/signin - application/json; charset=utf-8 66
2025-02-02 23:48:20.831 +03:00 [WRN] Failed to determine the https port for redirect.
2025-02-02 23:48:20.836 +03:00 [INF] Executing endpoint 'NayifatAPI.Controllers.AuthController.SignIn (NayifatAPI)'
2025-02-02 23:48:20.852 +03:00 [INF] Route matched with {action = "SignIn", controller = "Auth"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] SignIn(NayifatAPI.Controllers.SignInRequest) on controller NayifatAPI.Controllers.AuthController (NayifatAPI).
2025-02-02 23:48:21.834 +03:00 [INF] Executed DbCommand (28ms) [Parameters=[@__providedApiKey_0='?' (Size = 255)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [a].[Key], [a].[CreatedAt], [a].[Description], [a].[ExpiresAt], [a].[IsActive], [a].[LastUsedAt]
FROM [ApiKeys] AS [a]
WHERE [a].[Key] = @__providedApiKey_0 AND [a].[IsActive] = CAST(1 AS bit)
2025-02-02 23:48:21.914 +03:00 [INF] Executed DbCommand (11ms) [Parameters=[@__request_NationalId_0='?' (Size = 450)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [c].[NationalId], [c].[AddNo], [c].[BuildingNo], [c].[City], [c].[Consent], [c].[ConsentDate], [c].[DateOfBirth], [c].[Dependents], [c].[District], [c].[Email], [c].[Employer], [c].[FamilyNameAr], [c].[FamilyNameEn], [c].[FirstNameAr], [c].[FirstNameEn], [c].[Iban], [c].[IdExpiryDate], [c].[Los], [c].[Mpin], [c].[MpinEnabled], [c].[NafathStatus], [c].[NafathTimestamp], [c].[Password], [c].[Phone], [c].[RegistrationDate], [c].[SalaryCustomer], [c].[SalaryDakhli], [c].[SecondNameAr], [c].[SecondNameEn], [c].[Sector], [c].[Street], [c].[ThirdNameAr], [c].[ThirdNameEn], [c].[Zipcode]
FROM [Customers] AS [c]
WHERE [c].[NationalId] = @__request_NationalId_0
2025-02-02 23:48:21.936 +03:00 [INF] Executing ObjectResult, writing value of type '<>f__AnonymousType13`3[[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Object, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-02-02 23:48:21.950 +03:00 [INF] Executed action NayifatAPI.Controllers.AuthController.SignIn (NayifatAPI) in 1094.137ms
2025-02-02 23:48:21.953 +03:00 [INF] Executed endpoint 'NayifatAPI.Controllers.AuthController.SignIn (NayifatAPI)'
2025-02-02 23:48:21.964 +03:00 [INF] Request finished HTTP/1.1 POST http://07ca-46-152-255-232.ngrok-free.app/api/auth/signin - 401 null application/json; charset=utf-8 1168.1244ms
2025-02-02 23:49:00.296 +03:00 [INF] Request starting HTTP/1.1 POST http://07ca-46-152-255-232.ngrok-free.app/api/auth/signin - application/json; charset=utf-8 66
2025-02-02 23:49:00.303 +03:00 [INF] Executing endpoint 'NayifatAPI.Controllers.AuthController.SignIn (NayifatAPI)'
2025-02-02 23:49:00.305 +03:00 [INF] Route matched with {action = "SignIn", controller = "Auth"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] SignIn(NayifatAPI.Controllers.SignInRequest) on controller NayifatAPI.Controllers.AuthController (NayifatAPI).
2025-02-02 23:49:00.323 +03:00 [INF] Executed DbCommand (2ms) [Parameters=[@__providedApiKey_0='?' (Size = 255)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [a].[Key], [a].[CreatedAt], [a].[Description], [a].[ExpiresAt], [a].[IsActive], [a].[LastUsedAt]
FROM [ApiKeys] AS [a]
WHERE [a].[Key] = @__providedApiKey_0 AND [a].[IsActive] = CAST(1 AS bit)
2025-02-02 23:49:00.329 +03:00 [INF] Executed DbCommand (2ms) [Parameters=[@__request_NationalId_0='?' (Size = 450)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [c].[NationalId], [c].[AddNo], [c].[BuildingNo], [c].[City], [c].[Consent], [c].[ConsentDate], [c].[DateOfBirth], [c].[Dependents], [c].[District], [c].[Email], [c].[Employer], [c].[FamilyNameAr], [c].[FamilyNameEn], [c].[FirstNameAr], [c].[FirstNameEn], [c].[Iban], [c].[IdExpiryDate], [c].[Los], [c].[Mpin], [c].[MpinEnabled], [c].[NafathStatus], [c].[NafathTimestamp], [c].[Password], [c].[Phone], [c].[RegistrationDate], [c].[SalaryCustomer], [c].[SalaryDakhli], [c].[SecondNameAr], [c].[SecondNameEn], [c].[Sector], [c].[Street], [c].[ThirdNameAr], [c].[ThirdNameEn], [c].[Zipcode]
FROM [Customers] AS [c]
WHERE [c].[NationalId] = @__request_NationalId_0
2025-02-02 23:49:00.332 +03:00 [INF] Executing ObjectResult, writing value of type '<>f__AnonymousType13`3[[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Object, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-02-02 23:49:00.333 +03:00 [INF] Executed action NayifatAPI.Controllers.AuthController.SignIn (NayifatAPI) in 27.2156ms
2025-02-02 23:49:00.334 +03:00 [INF] Executed endpoint 'NayifatAPI.Controllers.AuthController.SignIn (NayifatAPI)'
2025-02-02 23:49:00.335 +03:00 [INF] Request finished HTTP/1.1 POST http://07ca-46-152-255-232.ngrok-free.app/api/auth/signin - 401 null application/json; charset=utf-8 38.8876ms
2025-02-02 23:50:54.052 +03:00 [INF] Request starting HTTP/1.1 POST http://07ca-46-152-255-232.ngrok-free.app/api/auth/signin - application/json; charset=utf-8 66
2025-02-02 23:50:54.059 +03:00 [INF] Executing endpoint 'NayifatAPI.Controllers.AuthController.SignIn (NayifatAPI)'
2025-02-02 23:50:54.060 +03:00 [INF] Route matched with {action = "SignIn", controller = "Auth"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] SignIn(NayifatAPI.Controllers.SignInRequest) on controller NayifatAPI.Controllers.AuthController (NayifatAPI).
2025-02-02 23:50:54.111 +03:00 [INF] Executed DbCommand (4ms) [Parameters=[@__providedApiKey_0='?' (Size = 255)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [a].[Key], [a].[CreatedAt], [a].[Description], [a].[ExpiresAt], [a].[IsActive], [a].[LastUsedAt]
FROM [ApiKeys] AS [a]
WHERE [a].[Key] = @__providedApiKey_0 AND [a].[IsActive] = CAST(1 AS bit)
2025-02-02 23:50:54.118 +03:00 [INF] Executed DbCommand (2ms) [Parameters=[@__request_NationalId_0='?' (Size = 450)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [c].[NationalId], [c].[AddNo], [c].[BuildingNo], [c].[City], [c].[Consent], [c].[ConsentDate], [c].[DateOfBirth], [c].[Dependents], [c].[District], [c].[Email], [c].[Employer], [c].[FamilyNameAr], [c].[FamilyNameEn], [c].[FirstNameAr], [c].[FirstNameEn], [c].[Iban], [c].[IdExpiryDate], [c].[Los], [c].[Mpin], [c].[MpinEnabled], [c].[NafathStatus], [c].[NafathTimestamp], [c].[Password], [c].[Phone], [c].[RegistrationDate], [c].[SalaryCustomer], [c].[SalaryDakhli], [c].[SecondNameAr], [c].[SecondNameEn], [c].[Sector], [c].[Street], [c].[ThirdNameAr], [c].[ThirdNameEn], [c].[Zipcode]
FROM [Customers] AS [c]
WHERE [c].[NationalId] = @__request_NationalId_0
2025-02-02 23:50:54.121 +03:00 [INF] Executing ObjectResult, writing value of type '<>f__AnonymousType13`3[[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Object, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-02-02 23:50:54.122 +03:00 [INF] Executed action NayifatAPI.Controllers.AuthController.SignIn (NayifatAPI) in 60.2224ms
2025-02-02 23:50:54.123 +03:00 [INF] Executed endpoint 'NayifatAPI.Controllers.AuthController.SignIn (NayifatAPI)'
2025-02-02 23:50:54.124 +03:00 [INF] Request finished HTTP/1.1 POST http://07ca-46-152-255-232.ngrok-free.app/api/auth/signin - 401 null application/json; charset=utf-8 71.5091ms
2025-02-02 23:52:43.665 +03:00 [INF] Request starting HTTP/1.1 POST http://07ca-46-152-255-232.ngrok-free.app/api/notifications/list - application/json; charset=utf-8 47
2025-02-02 23:52:43.670 +03:00 [INF] Executing endpoint 'NayifatAPI.Controllers.NotificationsController.GetNotifications (NayifatAPI)'
2025-02-02 23:52:43.680 +03:00 [INF] Route matched with {action = "GetNotifications", controller = "Notifications"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetNotifications(NayifatAPI.Controllers.GetNotificationsRequest) on controller NayifatAPI.Controllers.NotificationsController (NayifatAPI).
2025-02-02 23:52:43.698 +03:00 [INF] Executed DbCommand (2ms) [Parameters=[@__providedApiKey_0='?' (Size = 255)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [a].[Key], [a].[CreatedAt], [a].[Description], [a].[ExpiresAt], [a].[IsActive], [a].[LastUsedAt]
FROM [ApiKeys] AS [a]
WHERE [a].[Key] = @__providedApiKey_0 AND [a].[IsActive] = CAST(1 AS bit)
2025-02-02 23:52:43.712 +03:00 [INF] Executed DbCommand (2ms) [Parameters=[@__request_NationalId_0='?' (Size = 450)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [u].[national_id], [u].[last_updated], [u].[notifications]
FROM [user_notifications] AS [u]
WHERE [u].[national_id] = @__request_NationalId_0
2025-02-02 23:52:43.752 +03:00 [INF] Executed DbCommand (3ms) [Parameters=[@__Parse_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [n].[Id], [n].[additional_data], [n].[Body], [n].[body_ar], [n].[body_en], [n].[created_at], [n].[expiry_at], [n].[Route], [n].[target_criteria], [n].[Title], [n].[title_ar], [n].[title_en]
FROM [notification_templates] AS [n]
WHERE [n].[Id] = @__Parse_0
2025-02-02 23:52:43.779 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@__Parse_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [n].[Id], [n].[additional_data], [n].[Body], [n].[body_ar], [n].[body_en], [n].[created_at], [n].[expiry_at], [n].[Route], [n].[target_criteria], [n].[Title], [n].[title_ar], [n].[title_en]
FROM [notification_templates] AS [n]
WHERE [n].[Id] = @__Parse_0
2025-02-02 23:52:43.930 +03:00 [INF] Executed DbCommand (10ms) [Parameters=[@p0='?' (Size = 4000), @p1='?' (DbType = DateTime2), @p2='?' (Size = 4000), @p3='?' (Size = 4000), @p4='?' (Size = 4000), @p5='?' (Size = 450), @p6='?' (Size = 4000), @p7='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SET IMPLICIT_TRANSACTIONS OFF;
SET NOCOUNT ON;
INSERT INTO [AuthLogs] ([AuthType], [CreatedAt], [DeviceId], [FailureReason], [IpAddress], [NationalId], [Status], [UserAgent])
OUTPUT INSERTED.[Id]
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7);
2025-02-02 23:52:43.956 +03:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType10`2[[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Object, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-02-02 23:52:43.964 +03:00 [INF] Executed action NayifatAPI.Controllers.NotificationsController.GetNotifications (NayifatAPI) in 282.3411ms
2025-02-02 23:52:43.969 +03:00 [INF] Executed endpoint 'NayifatAPI.Controllers.NotificationsController.GetNotifications (NayifatAPI)'
2025-02-02 23:52:43.971 +03:00 [INF] Request finished HTTP/1.1 POST http://07ca-46-152-255-232.ngrok-free.app/api/notifications/list - 200 null application/json; charset=utf-8 305.9794ms
2025-02-02 23:55:51.199 +03:00 [INF] Request starting HTTP/1.1 POST http://07ca-46-152-255-232.ngrok-free.app/api/notifications/list - application/json; charset=utf-8 47
2025-02-02 23:55:51.204 +03:00 [INF] Executing endpoint 'NayifatAPI.Controllers.NotificationsController.GetNotifications (NayifatAPI)'
2025-02-02 23:55:51.206 +03:00 [INF] Route matched with {action = "GetNotifications", controller = "Notifications"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetNotifications(NayifatAPI.Controllers.GetNotificationsRequest) on controller NayifatAPI.Controllers.NotificationsController (NayifatAPI).
2025-02-02 23:55:51.211 +03:00 [INF] Executed DbCommand (2ms) [Parameters=[@__providedApiKey_0='?' (Size = 255)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [a].[Key], [a].[CreatedAt], [a].[Description], [a].[ExpiresAt], [a].[IsActive], [a].[LastUsedAt]
FROM [ApiKeys] AS [a]
WHERE [a].[Key] = @__providedApiKey_0 AND [a].[IsActive] = CAST(1 AS bit)
2025-02-02 23:55:51.215 +03:00 [INF] Executed DbCommand (2ms) [Parameters=[@__request_NationalId_0='?' (Size = 450)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [u].[national_id], [u].[last_updated], [u].[notifications]
FROM [user_notifications] AS [u]
WHERE [u].[national_id] = @__request_NationalId_0
2025-02-02 23:55:51.219 +03:00 [INF] Executed DbCommand (2ms) [Parameters=[@__Parse_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [n].[Id], [n].[additional_data], [n].[Body], [n].[body_ar], [n].[body_en], [n].[created_at], [n].[expiry_at], [n].[Route], [n].[target_criteria], [n].[Title], [n].[title_ar], [n].[title_en]
FROM [notification_templates] AS [n]
WHERE [n].[Id] = @__Parse_0
2025-02-02 23:55:51.222 +03:00 [INF] Executed DbCommand (0ms) [Parameters=[@__Parse_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [n].[Id], [n].[additional_data], [n].[Body], [n].[body_ar], [n].[body_en], [n].[created_at], [n].[expiry_at], [n].[Route], [n].[target_criteria], [n].[Title], [n].[title_ar], [n].[title_en]
FROM [notification_templates] AS [n]
WHERE [n].[Id] = @__Parse_0
2025-02-02 23:55:51.301 +03:00 [INF] Executed DbCommand (76ms) [Parameters=[@p0='?' (Size = 4000), @p1='?' (DbType = DateTime2), @p2='?' (Size = 4000), @p3='?' (Size = 4000), @p4='?' (Size = 4000), @p5='?' (Size = 450), @p6='?' (Size = 4000), @p7='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SET IMPLICIT_TRANSACTIONS OFF;
SET NOCOUNT ON;
INSERT INTO [AuthLogs] ([AuthType], [CreatedAt], [DeviceId], [FailureReason], [IpAddress], [NationalId], [Status], [UserAgent])
OUTPUT INSERTED.[Id]
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7);
2025-02-02 23:55:51.307 +03:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType10`2[[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Object, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-02-02 23:55:51.309 +03:00 [INF] Executed action NayifatAPI.Controllers.NotificationsController.GetNotifications (NayifatAPI) in 102.6783ms
2025-02-02 23:55:51.311 +03:00 [INF] Executed endpoint 'NayifatAPI.Controllers.NotificationsController.GetNotifications (NayifatAPI)'
2025-02-02 23:55:51.313 +03:00 [INF] Request finished HTTP/1.1 POST http://07ca-46-152-255-232.ngrok-free.app/api/notifications/list - 200 null application/json; charset=utf-8 113.7327ms
2025-02-02 23:56:11.216 +03:00 [INF] Request starting HTTP/1.1 POST http://07ca-46-152-255-232.ngrok-free.app/api/auth/signin - application/json; charset=utf-8 65
2025-02-02 23:56:11.220 +03:00 [INF] Executing endpoint 'NayifatAPI.Controllers.AuthController.SignIn (NayifatAPI)'
2025-02-02 23:56:11.221 +03:00 [INF] Route matched with {action = "SignIn", controller = "Auth"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] SignIn(NayifatAPI.Controllers.SignInRequest) on controller NayifatAPI.Controllers.AuthController (NayifatAPI).
2025-02-02 23:56:11.224 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@__providedApiKey_0='?' (Size = 255)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [a].[Key], [a].[CreatedAt], [a].[Description], [a].[ExpiresAt], [a].[IsActive], [a].[LastUsedAt]
FROM [ApiKeys] AS [a]
WHERE [a].[Key] = @__providedApiKey_0 AND [a].[IsActive] = CAST(1 AS bit)
2025-02-02 23:56:11.229 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@__request_NationalId_0='?' (Size = 450)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [c].[NationalId], [c].[AddNo], [c].[BuildingNo], [c].[City], [c].[Consent], [c].[ConsentDate], [c].[DateOfBirth], [c].[Dependents], [c].[District], [c].[Email], [c].[Employer], [c].[FamilyNameAr], [c].[FamilyNameEn], [c].[FirstNameAr], [c].[FirstNameEn], [c].[Iban], [c].[IdExpiryDate], [c].[Los], [c].[Mpin], [c].[MpinEnabled], [c].[NafathStatus], [c].[NafathTimestamp], [c].[Password], [c].[Phone], [c].[RegistrationDate], [c].[SalaryCustomer], [c].[SalaryDakhli], [c].[SecondNameAr], [c].[SecondNameEn], [c].[Sector], [c].[Street], [c].[ThirdNameAr], [c].[ThirdNameEn], [c].[Zipcode]
FROM [Customers] AS [c]
WHERE [c].[NationalId] = @__request_NationalId_0
2025-02-02 23:56:11.230 +03:00 [INF] Executing ObjectResult, writing value of type '<>f__AnonymousType13`3[[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Object, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-02-02 23:56:11.232 +03:00 [INF] Executed action NayifatAPI.Controllers.AuthController.SignIn (NayifatAPI) in 9.6357ms
2025-02-02 23:56:11.233 +03:00 [INF] Executed endpoint 'NayifatAPI.Controllers.AuthController.SignIn (NayifatAPI)'
2025-02-02 23:56:11.234 +03:00 [INF] Request finished HTTP/1.1 POST http://07ca-46-152-255-232.ngrok-free.app/api/auth/signin - 401 null application/json; charset=utf-8 17.7709ms
2025-02-02 23:56:22.410 +03:00 [INF] Request starting HTTP/1.1 POST http://07ca-46-152-255-232.ngrok-free.app/api/notifications/list - application/json; charset=utf-8 47
2025-02-02 23:56:22.414 +03:00 [INF] Executing endpoint 'NayifatAPI.Controllers.NotificationsController.GetNotifications (NayifatAPI)'
2025-02-02 23:56:22.415 +03:00 [INF] Route matched with {action = "GetNotifications", controller = "Notifications"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetNotifications(NayifatAPI.Controllers.GetNotificationsRequest) on controller NayifatAPI.Controllers.NotificationsController (NayifatAPI).
2025-02-02 23:56:22.421 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@__providedApiKey_0='?' (Size = 255)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [a].[Key], [a].[CreatedAt], [a].[Description], [a].[ExpiresAt], [a].[IsActive], [a].[LastUsedAt]
FROM [ApiKeys] AS [a]
WHERE [a].[Key] = @__providedApiKey_0 AND [a].[IsActive] = CAST(1 AS bit)
2025-02-02 23:56:22.424 +03:00 [INF] Executed DbCommand (0ms) [Parameters=[@__request_NationalId_0='?' (Size = 450)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [u].[national_id], [u].[last_updated], [u].[notifications]
FROM [user_notifications] AS [u]
WHERE [u].[national_id] = @__request_NationalId_0
2025-02-02 23:56:22.426 +03:00 [INF] Executed DbCommand (0ms) [Parameters=[@__Parse_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [n].[Id], [n].[additional_data], [n].[Body], [n].[body_ar], [n].[body_en], [n].[created_at], [n].[expiry_at], [n].[Route], [n].[target_criteria], [n].[Title], [n].[title_ar], [n].[title_en]
FROM [notification_templates] AS [n]
WHERE [n].[Id] = @__Parse_0
2025-02-02 23:56:22.429 +03:00 [INF] Executed DbCommand (0ms) [Parameters=[@__Parse_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [n].[Id], [n].[additional_data], [n].[Body], [n].[body_ar], [n].[body_en], [n].[created_at], [n].[expiry_at], [n].[Route], [n].[target_criteria], [n].[Title], [n].[title_ar], [n].[title_en]
FROM [notification_templates] AS [n]
WHERE [n].[Id] = @__Parse_0
2025-02-02 23:56:22.505 +03:00 [INF] Executed DbCommand (74ms) [Parameters=[@p0='?' (Size = 4000), @p1='?' (DbType = DateTime2), @p2='?' (Size = 4000), @p3='?' (Size = 4000), @p4='?' (Size = 4000), @p5='?' (Size = 450), @p6='?' (Size = 4000), @p7='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SET IMPLICIT_TRANSACTIONS OFF;
SET NOCOUNT ON;
INSERT INTO [AuthLogs] ([AuthType], [CreatedAt], [DeviceId], [FailureReason], [IpAddress], [NationalId], [Status], [UserAgent])
OUTPUT INSERTED.[Id]
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7);
2025-02-02 23:56:22.513 +03:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType10`2[[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Object, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-02-02 23:56:22.515 +03:00 [INF] Executed action NayifatAPI.Controllers.NotificationsController.GetNotifications (NayifatAPI) in 96.4301ms
2025-02-02 23:56:22.516 +03:00 [INF] Executed endpoint 'NayifatAPI.Controllers.NotificationsController.GetNotifications (NayifatAPI)'
2025-02-02 23:56:22.518 +03:00 [INF] Request finished HTTP/1.1 POST http://07ca-46-152-255-232.ngrok-free.app/api/notifications/list - 200 null application/json; charset=utf-8 108.01ms
2025-02-02 23:56:28.626 +03:00 [INF] Request starting HTTP/1.1 POST http://07ca-46-152-255-232.ngrok-free.app/api/notifications/list - application/json; charset=utf-8 47
2025-02-02 23:56:28.632 +03:00 [INF] Executing endpoint 'NayifatAPI.Controllers.NotificationsController.GetNotifications (NayifatAPI)'
2025-02-02 23:56:28.633 +03:00 [INF] Route matched with {action = "GetNotifications", controller = "Notifications"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetNotifications(NayifatAPI.Controllers.GetNotificationsRequest) on controller NayifatAPI.Controllers.NotificationsController (NayifatAPI).
2025-02-02 23:56:28.635 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@__providedApiKey_0='?' (Size = 255)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [a].[Key], [a].[CreatedAt], [a].[Description], [a].[ExpiresAt], [a].[IsActive], [a].[LastUsedAt]
FROM [ApiKeys] AS [a]
WHERE [a].[Key] = @__providedApiKey_0 AND [a].[IsActive] = CAST(1 AS bit)
2025-02-02 23:56:28.638 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@__request_NationalId_0='?' (Size = 450)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [u].[national_id], [u].[last_updated], [u].[notifications]
FROM [user_notifications] AS [u]
WHERE [u].[national_id] = @__request_NationalId_0
2025-02-02 23:56:28.641 +03:00 [INF] Executed DbCommand (0ms) [Parameters=[@__Parse_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [n].[Id], [n].[additional_data], [n].[Body], [n].[body_ar], [n].[body_en], [n].[created_at], [n].[expiry_at], [n].[Route], [n].[target_criteria], [n].[Title], [n].[title_ar], [n].[title_en]
FROM [notification_templates] AS [n]
WHERE [n].[Id] = @__Parse_0
2025-02-02 23:56:28.644 +03:00 [INF] Executed DbCommand (0ms) [Parameters=[@__Parse_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [n].[Id], [n].[additional_data], [n].[Body], [n].[body_ar], [n].[body_en], [n].[created_at], [n].[expiry_at], [n].[Route], [n].[target_criteria], [n].[Title], [n].[title_ar], [n].[title_en]
FROM [notification_templates] AS [n]
WHERE [n].[Id] = @__Parse_0
2025-02-02 23:56:28.652 +03:00 [INF] Executed DbCommand (6ms) [Parameters=[@p0='?' (Size = 4000), @p1='?' (DbType = DateTime2), @p2='?' (Size = 4000), @p3='?' (Size = 4000), @p4='?' (Size = 4000), @p5='?' (Size = 450), @p6='?' (Size = 4000), @p7='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SET IMPLICIT_TRANSACTIONS OFF;
SET NOCOUNT ON;
INSERT INTO [AuthLogs] ([AuthType], [CreatedAt], [DeviceId], [FailureReason], [IpAddress], [NationalId], [Status], [UserAgent])
OUTPUT INSERTED.[Id]
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7);
2025-02-02 23:56:28.654 +03:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType10`2[[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Object, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-02-02 23:56:28.655 +03:00 [INF] Executed action NayifatAPI.Controllers.NotificationsController.GetNotifications (NayifatAPI) in 21.3507ms
2025-02-02 23:56:28.656 +03:00 [INF] Executed endpoint 'NayifatAPI.Controllers.NotificationsController.GetNotifications (NayifatAPI)'
2025-02-02 23:56:28.657 +03:00 [INF] Request finished HTTP/1.1 POST http://07ca-46-152-255-232.ngrok-free.app/api/notifications/list - 200 null application/json; charset=utf-8 30.6038ms
2025-02-02 23:56:35.035 +03:00 [INF] Request starting HTTP/1.1 POST http://07ca-46-152-255-232.ngrok-free.app/api/auth/signin - application/json; charset=utf-8 65
2025-02-02 23:56:35.040 +03:00 [INF] Executing endpoint 'NayifatAPI.Controllers.AuthController.SignIn (NayifatAPI)'
2025-02-02 23:56:35.041 +03:00 [INF] Route matched with {action = "SignIn", controller = "Auth"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] SignIn(NayifatAPI.Controllers.SignInRequest) on controller NayifatAPI.Controllers.AuthController (NayifatAPI).
2025-02-02 23:56:35.044 +03:00 [INF] Executed DbCommand (0ms) [Parameters=[@__providedApiKey_0='?' (Size = 255)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [a].[Key], [a].[CreatedAt], [a].[Description], [a].[ExpiresAt], [a].[IsActive], [a].[LastUsedAt]
FROM [ApiKeys] AS [a]
WHERE [a].[Key] = @__providedApiKey_0 AND [a].[IsActive] = CAST(1 AS bit)
2025-02-02 23:56:35.047 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@__request_NationalId_0='?' (Size = 450)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [c].[NationalId], [c].[AddNo], [c].[BuildingNo], [c].[City], [c].[Consent], [c].[ConsentDate], [c].[DateOfBirth], [c].[Dependents], [c].[District], [c].[Email], [c].[Employer], [c].[FamilyNameAr], [c].[FamilyNameEn], [c].[FirstNameAr], [c].[FirstNameEn], [c].[Iban], [c].[IdExpiryDate], [c].[Los], [c].[Mpin], [c].[MpinEnabled], [c].[NafathStatus], [c].[NafathTimestamp], [c].[Password], [c].[Phone], [c].[RegistrationDate], [c].[SalaryCustomer], [c].[SalaryDakhli], [c].[SecondNameAr], [c].[SecondNameEn], [c].[Sector], [c].[Street], [c].[ThirdNameAr], [c].[ThirdNameEn], [c].[Zipcode]
FROM [Customers] AS [c]
WHERE [c].[NationalId] = @__request_NationalId_0
2025-02-02 23:56:35.050 +03:00 [INF] Executing ObjectResult, writing value of type '<>f__AnonymousType13`3[[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Object, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-02-02 23:56:35.052 +03:00 [INF] Executed action NayifatAPI.Controllers.AuthController.SignIn (NayifatAPI) in 9.5041ms
2025-02-02 23:56:35.053 +03:00 [INF] Executed endpoint 'NayifatAPI.Controllers.AuthController.SignIn (NayifatAPI)'
2025-02-02 23:56:35.054 +03:00 [INF] Request finished HTTP/1.1 POST http://07ca-46-152-255-232.ngrok-free.app/api/auth/signin - 401 null application/json; charset=utf-8 18.1323ms
2025-02-02 23:56:59.812 +03:00 [INF] Request starting HTTP/1.1 POST http://07ca-46-152-255-232.ngrok-free.app/api/auth/signin - application/json; charset=utf-8 71
2025-02-02 23:56:59.819 +03:00 [INF] Executing endpoint 'NayifatAPI.Controllers.AuthController.SignIn (NayifatAPI)'
2025-02-02 23:56:59.820 +03:00 [INF] Route matched with {action = "SignIn", controller = "Auth"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] SignIn(NayifatAPI.Controllers.SignInRequest) on controller NayifatAPI.Controllers.AuthController (NayifatAPI).
2025-02-02 23:56:59.825 +03:00 [INF] Executed DbCommand (3ms) [Parameters=[@__providedApiKey_0='?' (Size = 255)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [a].[Key], [a].[CreatedAt], [a].[Description], [a].[ExpiresAt], [a].[IsActive], [a].[LastUsedAt]
FROM [ApiKeys] AS [a]
WHERE [a].[Key] = @__providedApiKey_0 AND [a].[IsActive] = CAST(1 AS bit)
2025-02-02 23:56:59.831 +03:00 [INF] Executed DbCommand (2ms) [Parameters=[@__request_NationalId_0='?' (Size = 450)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [c].[NationalId], [c].[AddNo], [c].[BuildingNo], [c].[City], [c].[Consent], [c].[ConsentDate], [c].[DateOfBirth], [c].[Dependents], [c].[District], [c].[Email], [c].[Employer], [c].[FamilyNameAr], [c].[FamilyNameEn], [c].[FirstNameAr], [c].[FirstNameEn], [c].[Iban], [c].[IdExpiryDate], [c].[Los], [c].[Mpin], [c].[MpinEnabled], [c].[NafathStatus], [c].[NafathTimestamp], [c].[Password], [c].[Phone], [c].[RegistrationDate], [c].[SalaryCustomer], [c].[SalaryDakhli], [c].[SecondNameAr], [c].[SecondNameEn], [c].[Sector], [c].[Street], [c].[ThirdNameAr], [c].[ThirdNameEn], [c].[Zipcode]
FROM [Customers] AS [c]
WHERE [c].[NationalId] = @__request_NationalId_0
2025-02-02 23:56:59.884 +03:00 [INF] Starting password verification for NationalId: 1064448614
2025-02-02 23:57:00.254 +03:00 [INF] Password verification result for NationalId 1064448614: Failed
2025-02-02 23:57:00.362 +03:00 [INF] Executed DbCommand (76ms) [Parameters=[@p0='?' (Size = 4000), @p1='?' (DbType = DateTime2), @p2='?' (Size = 4000), @p3='?' (Size = 4000), @p4='?' (Size = 4000), @p5='?' (Size = 450), @p6='?' (Size = 4000), @p7='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SET IMPLICIT_TRANSACTIONS OFF;
SET NOCOUNT ON;
INSERT INTO [AuthLogs] ([AuthType], [CreatedAt], [DeviceId], [FailureReason], [IpAddress], [NationalId], [Status], [UserAgent])
OUTPUT INSERTED.[Id]
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7);
2025-02-02 23:57:00.368 +03:00 [INF] Executing ObjectResult, writing value of type '<>f__AnonymousType13`3[[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Object, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-02-02 23:57:00.369 +03:00 [INF] Executed action NayifatAPI.Controllers.AuthController.SignIn (NayifatAPI) in 547.9546ms
2025-02-02 23:57:00.370 +03:00 [INF] Executed endpoint 'NayifatAPI.Controllers.AuthController.SignIn (NayifatAPI)'
2025-02-02 23:57:00.371 +03:00 [INF] Request finished HTTP/1.1 POST http://07ca-46-152-255-232.ngrok-free.app/api/auth/signin - 401 null application/json; charset=utf-8 558.3725ms
2025-02-02 23:57:50.035 +03:00 [INF] Request starting HTTP/1.1 POST http://07ca-46-152-255-232.ngrok-free.app/api/auth/signin - application/json; charset=utf-8 71
2025-02-02 23:57:50.039 +03:00 [INF] Executing endpoint 'NayifatAPI.Controllers.AuthController.SignIn (NayifatAPI)'
2025-02-02 23:57:50.040 +03:00 [INF] Route matched with {action = "SignIn", controller = "Auth"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] SignIn(NayifatAPI.Controllers.SignInRequest) on controller NayifatAPI.Controllers.AuthController (NayifatAPI).
2025-02-02 23:57:50.045 +03:00 [INF] Executed DbCommand (3ms) [Parameters=[@__providedApiKey_0='?' (Size = 255)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [a].[Key], [a].[CreatedAt], [a].[Description], [a].[ExpiresAt], [a].[IsActive], [a].[LastUsedAt]
FROM [ApiKeys] AS [a]
WHERE [a].[Key] = @__providedApiKey_0 AND [a].[IsActive] = CAST(1 AS bit)
2025-02-02 23:57:50.051 +03:00 [INF] Executed DbCommand (2ms) [Parameters=[@__request_NationalId_0='?' (Size = 450)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [c].[NationalId], [c].[AddNo], [c].[BuildingNo], [c].[City], [c].[Consent], [c].[ConsentDate], [c].[DateOfBirth], [c].[Dependents], [c].[District], [c].[Email], [c].[Employer], [c].[FamilyNameAr], [c].[FamilyNameEn], [c].[FirstNameAr], [c].[FirstNameEn], [c].[Iban], [c].[IdExpiryDate], [c].[Los], [c].[Mpin], [c].[MpinEnabled], [c].[NafathStatus], [c].[NafathTimestamp], [c].[Password], [c].[Phone], [c].[RegistrationDate], [c].[SalaryCustomer], [c].[SalaryDakhli], [c].[SecondNameAr], [c].[SecondNameEn], [c].[Sector], [c].[Street], [c].[ThirdNameAr], [c].[ThirdNameEn], [c].[Zipcode]
FROM [Customers] AS [c]
WHERE [c].[NationalId] = @__request_NationalId_0
2025-02-02 23:57:50.054 +03:00 [INF] Starting password verification for NationalId: 1064448614
2025-02-02 23:57:50.217 +03:00 [INF] Password verification result for NationalId 1064448614: Failed
2025-02-02 23:57:50.234 +03:00 [INF] Executed DbCommand (9ms) [Parameters=[@p0='?' (Size = 4000), @p1='?' (DbType = DateTime2), @p2='?' (Size = 4000), @p3='?' (Size = 4000), @p4='?' (Size = 4000), @p5='?' (Size = 450), @p6='?' (Size = 4000), @p7='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SET IMPLICIT_TRANSACTIONS OFF;
SET NOCOUNT ON;
INSERT INTO [AuthLogs] ([AuthType], [CreatedAt], [DeviceId], [FailureReason], [IpAddress], [NationalId], [Status], [UserAgent])
OUTPUT INSERTED.[Id]
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7);
2025-02-02 23:57:50.238 +03:00 [INF] Executing ObjectResult, writing value of type '<>f__AnonymousType13`3[[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Object, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-02-02 23:57:50.239 +03:00 [INF] Executed action NayifatAPI.Controllers.AuthController.SignIn (NayifatAPI) in 198.5484ms
2025-02-02 23:57:50.240 +03:00 [INF] Executed endpoint 'NayifatAPI.Controllers.AuthController.SignIn (NayifatAPI)'
2025-02-02 23:57:50.241 +03:00 [INF] Request finished HTTP/1.1 POST http://07ca-46-152-255-232.ngrok-free.app/api/auth/signin - 401 null application/json; charset=utf-8 206.3449ms
2025-02-02 23:58:35.873 +03:00 [INF] Request starting HTTP/1.1 POST http://07ca-46-152-255-232.ngrok-free.app/api/notifications/list - application/json; charset=utf-8 47
2025-02-02 23:58:35.878 +03:00 [INF] Executing endpoint 'NayifatAPI.Controllers.NotificationsController.GetNotifications (NayifatAPI)'
2025-02-02 23:58:35.879 +03:00 [INF] Route matched with {action = "GetNotifications", controller = "Notifications"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetNotifications(NayifatAPI.Controllers.GetNotificationsRequest) on controller NayifatAPI.Controllers.NotificationsController (NayifatAPI).
2025-02-02 23:58:35.885 +03:00 [INF] Executed DbCommand (3ms) [Parameters=[@__providedApiKey_0='?' (Size = 255)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [a].[Key], [a].[CreatedAt], [a].[Description], [a].[ExpiresAt], [a].[IsActive], [a].[LastUsedAt]
FROM [ApiKeys] AS [a]
WHERE [a].[Key] = @__providedApiKey_0 AND [a].[IsActive] = CAST(1 AS bit)
2025-02-02 23:58:35.891 +03:00 [INF] Executed DbCommand (2ms) [Parameters=[@__request_NationalId_0='?' (Size = 450)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [u].[national_id], [u].[last_updated], [u].[notifications]
FROM [user_notifications] AS [u]
WHERE [u].[national_id] = @__request_NationalId_0
2025-02-02 23:58:35.895 +03:00 [INF] Executed DbCommand (2ms) [Parameters=[@__Parse_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [n].[Id], [n].[additional_data], [n].[Body], [n].[body_ar], [n].[body_en], [n].[created_at], [n].[expiry_at], [n].[Route], [n].[target_criteria], [n].[Title], [n].[title_ar], [n].[title_en]
FROM [notification_templates] AS [n]
WHERE [n].[Id] = @__Parse_0
2025-02-02 23:58:35.897 +03:00 [INF] Executed DbCommand (0ms) [Parameters=[@__Parse_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [n].[Id], [n].[additional_data], [n].[Body], [n].[body_ar], [n].[body_en], [n].[created_at], [n].[expiry_at], [n].[Route], [n].[target_criteria], [n].[Title], [n].[title_ar], [n].[title_en]
FROM [notification_templates] AS [n]
WHERE [n].[Id] = @__Parse_0
2025-02-02 23:58:35.908 +03:00 [INF] Executed DbCommand (8ms) [Parameters=[@p0='?' (Size = 4000), @p1='?' (DbType = DateTime2), @p2='?' (Size = 4000), @p3='?' (Size = 4000), @p4='?' (Size = 4000), @p5='?' (Size = 450), @p6='?' (Size = 4000), @p7='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SET IMPLICIT_TRANSACTIONS OFF;
SET NOCOUNT ON;
INSERT INTO [AuthLogs] ([AuthType], [CreatedAt], [DeviceId], [FailureReason], [IpAddress], [NationalId], [Status], [UserAgent])
OUTPUT INSERTED.[Id]
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7);
2025-02-02 23:58:35.910 +03:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType10`2[[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Object, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-02-02 23:58:35.911 +03:00 [INF] Executed action NayifatAPI.Controllers.NotificationsController.GetNotifications (NayifatAPI) in 30.2827ms
2025-02-02 23:58:35.912 +03:00 [INF] Executed endpoint 'NayifatAPI.Controllers.NotificationsController.GetNotifications (NayifatAPI)'
2025-02-02 23:58:35.913 +03:00 [INF] Request finished HTTP/1.1 POST http://07ca-46-152-255-232.ngrok-free.app/api/notifications/list - 200 null application/json; charset=utf-8 39.1935ms
2025-02-02 23:58:51.160 +03:00 [INF] Request starting HTTP/1.1 POST http://07ca-46-152-255-232.ngrok-free.app/api/notifications/list - application/json; charset=utf-8 47
2025-02-02 23:58:51.163 +03:00 [INF] Executing endpoint 'NayifatAPI.Controllers.NotificationsController.GetNotifications (NayifatAPI)'
2025-02-02 23:58:51.164 +03:00 [INF] Route matched with {action = "GetNotifications", controller = "Notifications"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetNotifications(NayifatAPI.Controllers.GetNotificationsRequest) on controller NayifatAPI.Controllers.NotificationsController (NayifatAPI).
2025-02-02 23:58:51.168 +03:00 [INF] Executed DbCommand (2ms) [Parameters=[@__providedApiKey_0='?' (Size = 255)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [a].[Key], [a].[CreatedAt], [a].[Description], [a].[ExpiresAt], [a].[IsActive], [a].[LastUsedAt]
FROM [ApiKeys] AS [a]
WHERE [a].[Key] = @__providedApiKey_0 AND [a].[IsActive] = CAST(1 AS bit)
2025-02-02 23:58:51.174 +03:00 [INF] Executed DbCommand (3ms) [Parameters=[@__request_NationalId_0='?' (Size = 450)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [u].[national_id], [u].[last_updated], [u].[notifications]
FROM [user_notifications] AS [u]
WHERE [u].[national_id] = @__request_NationalId_0
2025-02-02 23:58:51.178 +03:00 [INF] Executed DbCommand (2ms) [Parameters=[@__Parse_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [n].[Id], [n].[additional_data], [n].[Body], [n].[body_ar], [n].[body_en], [n].[created_at], [n].[expiry_at], [n].[Route], [n].[target_criteria], [n].[Title], [n].[title_ar], [n].[title_en]
FROM [notification_templates] AS [n]
WHERE [n].[Id] = @__Parse_0
2025-02-02 23:58:51.181 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@__Parse_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [n].[Id], [n].[additional_data], [n].[Body], [n].[body_ar], [n].[body_en], [n].[created_at], [n].[expiry_at], [n].[Route], [n].[target_criteria], [n].[Title], [n].[title_ar], [n].[title_en]
FROM [notification_templates] AS [n]
WHERE [n].[Id] = @__Parse_0
2025-02-02 23:58:51.277 +03:00 [INF] Executed DbCommand (92ms) [Parameters=[@p0='?' (Size = 4000), @p1='?' (DbType = DateTime2), @p2='?' (Size = 4000), @p3='?' (Size = 4000), @p4='?' (Size = 4000), @p5='?' (Size = 450), @p6='?' (Size = 4000), @p7='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SET IMPLICIT_TRANSACTIONS OFF;
SET NOCOUNT ON;
INSERT INTO [AuthLogs] ([AuthType], [CreatedAt], [DeviceId], [FailureReason], [IpAddress], [NationalId], [Status], [UserAgent])
OUTPUT INSERTED.[Id]
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7);
2025-02-02 23:58:51.281 +03:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType10`2[[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Object, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-02-02 23:58:51.282 +03:00 [INF] Executed action NayifatAPI.Controllers.NotificationsController.GetNotifications (NayifatAPI) in 117.1645ms
2025-02-02 23:58:51.284 +03:00 [INF] Executed endpoint 'NayifatAPI.Controllers.NotificationsController.GetNotifications (NayifatAPI)'
2025-02-02 23:58:51.285 +03:00 [INF] Request finished HTTP/1.1 POST http://07ca-46-152-255-232.ngrok-free.app/api/notifications/list - 200 null application/json; charset=utf-8 124.4658ms
2025-02-02 23:59:05.694 +03:00 [INF] Request starting HTTP/1.1 POST http://07ca-46-152-255-232.ngrok-free.app/api/auth/signin - application/json; charset=utf-8 80
2025-02-02 23:59:05.697 +03:00 [INF] Executing endpoint 'NayifatAPI.Controllers.AuthController.SignIn (NayifatAPI)'
2025-02-02 23:59:05.698 +03:00 [INF] Route matched with {action = "SignIn", controller = "Auth"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] SignIn(NayifatAPI.Controllers.SignInRequest) on controller NayifatAPI.Controllers.AuthController (NayifatAPI).
2025-02-02 23:59:05.703 +03:00 [INF] Executed DbCommand (3ms) [Parameters=[@__providedApiKey_0='?' (Size = 255)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [a].[Key], [a].[CreatedAt], [a].[Description], [a].[ExpiresAt], [a].[IsActive], [a].[LastUsedAt]
FROM [ApiKeys] AS [a]
WHERE [a].[Key] = @__providedApiKey_0 AND [a].[IsActive] = CAST(1 AS bit)
2025-02-02 23:59:05.708 +03:00 [INF] Executed DbCommand (2ms) [Parameters=[@__request_NationalId_0='?' (Size = 450)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [c].[NationalId], [c].[AddNo], [c].[BuildingNo], [c].[City], [c].[Consent], [c].[ConsentDate], [c].[DateOfBirth], [c].[Dependents], [c].[District], [c].[Email], [c].[Employer], [c].[FamilyNameAr], [c].[FamilyNameEn], [c].[FirstNameAr], [c].[FirstNameEn], [c].[Iban], [c].[IdExpiryDate], [c].[Los], [c].[Mpin], [c].[MpinEnabled], [c].[NafathStatus], [c].[NafathTimestamp], [c].[Password], [c].[Phone], [c].[RegistrationDate], [c].[SalaryCustomer], [c].[SalaryDakhli], [c].[SecondNameAr], [c].[SecondNameEn], [c].[Sector], [c].[Street], [c].[ThirdNameAr], [c].[ThirdNameEn], [c].[Zipcode]
FROM [Customers] AS [c]
WHERE [c].[NationalId] = @__request_NationalId_0
2025-02-02 23:59:05.710 +03:00 [INF] Starting password verification for NationalId: 1064448614
2025-02-02 23:59:05.879 +03:00 [INF] Password verification result for NationalId 1064448614: Failed
2025-02-02 23:59:05.891 +03:00 [INF] Executed DbCommand (10ms) [Parameters=[@p0='?' (Size = 4000), @p1='?' (DbType = DateTime2), @p2='?' (Size = 4000), @p3='?' (Size = 4000), @p4='?' (Size = 4000), @p5='?' (Size = 450), @p6='?' (Size = 4000), @p7='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SET IMPLICIT_TRANSACTIONS OFF;
SET NOCOUNT ON;
INSERT INTO [AuthLogs] ([AuthType], [CreatedAt], [DeviceId], [FailureReason], [IpAddress], [NationalId], [Status], [UserAgent])
OUTPUT INSERTED.[Id]
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7);
2025-02-02 23:59:05.894 +03:00 [INF] Executing ObjectResult, writing value of type '<>f__AnonymousType13`3[[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Object, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-02-02 23:59:05.895 +03:00 [INF] Executed action NayifatAPI.Controllers.AuthController.SignIn (NayifatAPI) in 195.9157ms
2025-02-02 23:59:05.897 +03:00 [INF] Executed endpoint 'NayifatAPI.Controllers.AuthController.SignIn (NayifatAPI)'
2025-02-02 23:59:05.898 +03:00 [INF] Request finished HTTP/1.1 POST http://07ca-46-152-255-232.ngrok-free.app/api/auth/signin - 401 null application/json; charset=utf-8 203.135ms
2025-02-02 23:59:23.748 +03:00 [INF] Request starting HTTP/1.1 POST http://07ca-46-152-255-232.ngrok-free.app/api/notifications/list - application/json; charset=utf-8 47
2025-02-02 23:59:23.754 +03:00 [INF] Executing endpoint 'NayifatAPI.Controllers.NotificationsController.GetNotifications (NayifatAPI)'
2025-02-02 23:59:23.754 +03:00 [INF] Route matched with {action = "GetNotifications", controller = "Notifications"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetNotifications(NayifatAPI.Controllers.GetNotificationsRequest) on controller NayifatAPI.Controllers.NotificationsController (NayifatAPI).
2025-02-02 23:59:23.760 +03:00 [INF] Executed DbCommand (3ms) [Parameters=[@__providedApiKey_0='?' (Size = 255)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [a].[Key], [a].[CreatedAt], [a].[Description], [a].[ExpiresAt], [a].[IsActive], [a].[LastUsedAt]
FROM [ApiKeys] AS [a]
WHERE [a].[Key] = @__providedApiKey_0 AND [a].[IsActive] = CAST(1 AS bit)
2025-02-02 23:59:23.764 +03:00 [INF] Executed DbCommand (2ms) [Parameters=[@__request_NationalId_0='?' (Size = 450)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [u].[national_id], [u].[last_updated], [u].[notifications]
FROM [user_notifications] AS [u]
WHERE [u].[national_id] = @__request_NationalId_0
2025-02-02 23:59:23.769 +03:00 [INF] Executed DbCommand (2ms) [Parameters=[@__Parse_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [n].[Id], [n].[additional_data], [n].[Body], [n].[body_ar], [n].[body_en], [n].[created_at], [n].[expiry_at], [n].[Route], [n].[target_criteria], [n].[Title], [n].[title_ar], [n].[title_en]
FROM [notification_templates] AS [n]
WHERE [n].[Id] = @__Parse_0
2025-02-02 23:59:23.771 +03:00 [INF] Executed DbCommand (0ms) [Parameters=[@__Parse_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [n].[Id], [n].[additional_data], [n].[Body], [n].[body_ar], [n].[body_en], [n].[created_at], [n].[expiry_at], [n].[Route], [n].[target_criteria], [n].[Title], [n].[title_ar], [n].[title_en]
FROM [notification_templates] AS [n]
WHERE [n].[Id] = @__Parse_0
2025-02-02 23:59:23.849 +03:00 [INF] Executed DbCommand (75ms) [Parameters=[@p0='?' (Size = 4000), @p1='?' (DbType = DateTime2), @p2='?' (Size = 4000), @p3='?' (Size = 4000), @p4='?' (Size = 4000), @p5='?' (Size = 450), @p6='?' (Size = 4000), @p7='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SET IMPLICIT_TRANSACTIONS OFF;
SET NOCOUNT ON;
INSERT INTO [AuthLogs] ([AuthType], [CreatedAt], [DeviceId], [FailureReason], [IpAddress], [NationalId], [Status], [UserAgent])
OUTPUT INSERTED.[Id]
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7);
2025-02-02 23:59:23.852 +03:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType10`2[[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Object, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-02-02 23:59:23.853 +03:00 [INF] Executed action NayifatAPI.Controllers.NotificationsController.GetNotifications (NayifatAPI) in 97.0967ms
2025-02-02 23:59:23.854 +03:00 [INF] Executed endpoint 'NayifatAPI.Controllers.NotificationsController.GetNotifications (NayifatAPI)'
2025-02-02 23:59:23.857 +03:00 [INF] Request finished HTTP/1.1 POST http://07ca-46-152-255-232.ngrok-free.app/api/notifications/list - 200 null application/json; charset=utf-8 108.4207ms
2025-02-02 23:59:24.933 +03:00 [INF] Request starting HTTP/1.1 POST http://07ca-46-152-255-232.ngrok-free.app/api/notifications/list - application/json; charset=utf-8 47
2025-02-02 23:59:24.940 +03:00 [INF] Executing endpoint 'NayifatAPI.Controllers.NotificationsController.GetNotifications (NayifatAPI)'
2025-02-02 23:59:24.941 +03:00 [INF] Route matched with {action = "GetNotifications", controller = "Notifications"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetNotifications(NayifatAPI.Controllers.GetNotificationsRequest) on controller NayifatAPI.Controllers.NotificationsController (NayifatAPI).
2025-02-02 23:59:24.943 +03:00 [INF] Executed DbCommand (0ms) [Parameters=[@__providedApiKey_0='?' (Size = 255)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [a].[Key], [a].[CreatedAt], [a].[Description], [a].[ExpiresAt], [a].[IsActive], [a].[LastUsedAt]
FROM [ApiKeys] AS [a]
WHERE [a].[Key] = @__providedApiKey_0 AND [a].[IsActive] = CAST(1 AS bit)
2025-02-02 23:59:24.945 +03:00 [INF] Executed DbCommand (0ms) [Parameters=[@__request_NationalId_0='?' (Size = 450)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [u].[national_id], [u].[last_updated], [u].[notifications]
FROM [user_notifications] AS [u]
WHERE [u].[national_id] = @__request_NationalId_0
2025-02-02 23:59:24.948 +03:00 [INF] Executed DbCommand (0ms) [Parameters=[@__Parse_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [n].[Id], [n].[additional_data], [n].[Body], [n].[body_ar], [n].[body_en], [n].[created_at], [n].[expiry_at], [n].[Route], [n].[target_criteria], [n].[Title], [n].[title_ar], [n].[title_en]
FROM [notification_templates] AS [n]
WHERE [n].[Id] = @__Parse_0
2025-02-02 23:59:24.950 +03:00 [INF] Executed DbCommand (0ms) [Parameters=[@__Parse_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [n].[Id], [n].[additional_data], [n].[Body], [n].[body_ar], [n].[body_en], [n].[created_at], [n].[expiry_at], [n].[Route], [n].[target_criteria], [n].[Title], [n].[title_ar], [n].[title_en]
FROM [notification_templates] AS [n]
WHERE [n].[Id] = @__Parse_0
2025-02-02 23:59:24.959 +03:00 [INF] Executed DbCommand (6ms) [Parameters=[@p0='?' (Size = 4000), @p1='?' (DbType = DateTime2), @p2='?' (Size = 4000), @p3='?' (Size = 4000), @p4='?' (Size = 4000), @p5='?' (Size = 450), @p6='?' (Size = 4000), @p7='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SET IMPLICIT_TRANSACTIONS OFF;
SET NOCOUNT ON;
INSERT INTO [AuthLogs] ([AuthType], [CreatedAt], [DeviceId], [FailureReason], [IpAddress], [NationalId], [Status], [UserAgent])
OUTPUT INSERTED.[Id]
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7);
2025-02-02 23:59:24.961 +03:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType10`2[[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Object, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-02-02 23:59:24.964 +03:00 [INF] Executed action NayifatAPI.Controllers.NotificationsController.GetNotifications (NayifatAPI) in 22.4129ms
2025-02-02 23:59:24.965 +03:00 [INF] Executed endpoint 'NayifatAPI.Controllers.NotificationsController.GetNotifications (NayifatAPI)'
2025-02-02 23:59:24.966 +03:00 [INF] Request finished HTTP/1.1 POST http://07ca-46-152-255-232.ngrok-free.app/api/notifications/list - 200 null application/json; charset=utf-8 32.9213ms
2025-02-02 23:59:32.633 +03:00 [INF] Request starting HTTP/1.1 POST http://07ca-46-152-255-232.ngrok-free.app/api/auth/signin - application/json; charset=utf-8 79
2025-02-02 23:59:32.640 +03:00 [INF] Executing endpoint 'NayifatAPI.Controllers.AuthController.SignIn (NayifatAPI)'
2025-02-02 23:59:32.641 +03:00 [INF] Route matched with {action = "SignIn", controller = "Auth"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] SignIn(NayifatAPI.Controllers.SignInRequest) on controller NayifatAPI.Controllers.AuthController (NayifatAPI).
2025-02-02 23:59:32.644 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@__providedApiKey_0='?' (Size = 255)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [a].[Key], [a].[CreatedAt], [a].[Description], [a].[ExpiresAt], [a].[IsActive], [a].[LastUsedAt]
FROM [ApiKeys] AS [a]
WHERE [a].[Key] = @__providedApiKey_0 AND [a].[IsActive] = CAST(1 AS bit)
2025-02-02 23:59:32.647 +03:00 [INF] Executed DbCommand (2ms) [Parameters=[@__request_NationalId_0='?' (Size = 450)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [c].[NationalId], [c].[AddNo], [c].[BuildingNo], [c].[City], [c].[Consent], [c].[ConsentDate], [c].[DateOfBirth], [c].[Dependents], [c].[District], [c].[Email], [c].[Employer], [c].[FamilyNameAr], [c].[FamilyNameEn], [c].[FirstNameAr], [c].[FirstNameEn], [c].[Iban], [c].[IdExpiryDate], [c].[Los], [c].[Mpin], [c].[MpinEnabled], [c].[NafathStatus], [c].[NafathTimestamp], [c].[Password], [c].[Phone], [c].[RegistrationDate], [c].[SalaryCustomer], [c].[SalaryDakhli], [c].[SecondNameAr], [c].[SecondNameEn], [c].[Sector], [c].[Street], [c].[ThirdNameAr], [c].[ThirdNameEn], [c].[Zipcode]
FROM [Customers] AS [c]
WHERE [c].[NationalId] = @__request_NationalId_0
2025-02-02 23:59:32.649 +03:00 [INF] Starting password verification for NationalId: 1064448614
2025-02-02 23:59:32.811 +03:00 [INF] Password verification result for NationalId 1064448614: Failed
2025-02-02 23:59:32.821 +03:00 [INF] Executed DbCommand (6ms) [Parameters=[@p0='?' (Size = 4000), @p1='?' (DbType = DateTime2), @p2='?' (Size = 4000), @p3='?' (Size = 4000), @p4='?' (Size = 4000), @p5='?' (Size = 450), @p6='?' (Size = 4000), @p7='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SET IMPLICIT_TRANSACTIONS OFF;
SET NOCOUNT ON;
INSERT INTO [AuthLogs] ([AuthType], [CreatedAt], [DeviceId], [FailureReason], [IpAddress], [NationalId], [Status], [UserAgent])
OUTPUT INSERTED.[Id]
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7);
2025-02-02 23:59:32.829 +03:00 [INF] Executing ObjectResult, writing value of type '<>f__AnonymousType13`3[[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Object, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-02-02 23:59:32.831 +03:00 [INF] Executed action NayifatAPI.Controllers.AuthController.SignIn (NayifatAPI) in 188.2332ms
2025-02-02 23:59:32.832 +03:00 [INF] Executed endpoint 'NayifatAPI.Controllers.AuthController.SignIn (NayifatAPI)'
2025-02-02 23:59:32.833 +03:00 [INF] Request finished HTTP/1.1 POST http://07ca-46-152-255-232.ngrok-free.app/api/auth/signin - 401 null application/json; charset=utf-8 199.9983ms
2025-02-02 23:59:43.931 +03:00 [INF] Request starting HTTP/1.1 POST http://07ca-46-152-255-232.ngrok-free.app/api/notifications/list - application/json; charset=utf-8 47
2025-02-02 23:59:43.936 +03:00 [INF] Executing endpoint 'NayifatAPI.Controllers.NotificationsController.GetNotifications (NayifatAPI)'
2025-02-02 23:59:43.937 +03:00 [INF] Route matched with {action = "GetNotifications", controller = "Notifications"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetNotifications(NayifatAPI.Controllers.GetNotificationsRequest) on controller NayifatAPI.Controllers.NotificationsController (NayifatAPI).
2025-02-02 23:59:43.940 +03:00 [INF] Executed DbCommand (0ms) [Parameters=[@__providedApiKey_0='?' (Size = 255)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [a].[Key], [a].[CreatedAt], [a].[Description], [a].[ExpiresAt], [a].[IsActive], [a].[LastUsedAt]
FROM [ApiKeys] AS [a]
WHERE [a].[Key] = @__providedApiKey_0 AND [a].[IsActive] = CAST(1 AS bit)
2025-02-02 23:59:43.943 +03:00 [INF] Executed DbCommand (0ms) [Parameters=[@__request_NationalId_0='?' (Size = 450)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [u].[national_id], [u].[last_updated], [u].[notifications]
FROM [user_notifications] AS [u]
WHERE [u].[national_id] = @__request_NationalId_0
2025-02-02 23:59:43.945 +03:00 [INF] Executed DbCommand (0ms) [Parameters=[@__Parse_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [n].[Id], [n].[additional_data], [n].[Body], [n].[body_ar], [n].[body_en], [n].[created_at], [n].[expiry_at], [n].[Route], [n].[target_criteria], [n].[Title], [n].[title_ar], [n].[title_en]
FROM [notification_templates] AS [n]
WHERE [n].[Id] = @__Parse_0
2025-02-02 23:59:43.947 +03:00 [INF] Executed DbCommand (0ms) [Parameters=[@__Parse_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [n].[Id], [n].[additional_data], [n].[Body], [n].[body_ar], [n].[body_en], [n].[created_at], [n].[expiry_at], [n].[Route], [n].[target_criteria], [n].[Title], [n].[title_ar], [n].[title_en]
FROM [notification_templates] AS [n]
WHERE [n].[Id] = @__Parse_0
2025-02-02 23:59:44.023 +03:00 [INF] Executed DbCommand (74ms) [Parameters=[@p0='?' (Size = 4000), @p1='?' (DbType = DateTime2), @p2='?' (Size = 4000), @p3='?' (Size = 4000), @p4='?' (Size = 4000), @p5='?' (Size = 450), @p6='?' (Size = 4000), @p7='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SET IMPLICIT_TRANSACTIONS OFF;
SET NOCOUNT ON;
INSERT INTO [AuthLogs] ([AuthType], [CreatedAt], [DeviceId], [FailureReason], [IpAddress], [NationalId], [Status], [UserAgent])
OUTPUT INSERTED.[Id]
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7);
2025-02-02 23:59:44.028 +03:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType10`2[[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Object, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-02-02 23:59:44.030 +03:00 [INF] Executed action NayifatAPI.Controllers.NotificationsController.GetNotifications (NayifatAPI) in 92.0152ms
2025-02-02 23:59:44.031 +03:00 [INF] Executed endpoint 'NayifatAPI.Controllers.NotificationsController.GetNotifications (NayifatAPI)'
2025-02-02 23:59:44.033 +03:00 [INF] Request finished HTTP/1.1 POST http://07ca-46-152-255-232.ngrok-free.app/api/notifications/list - 200 null application/json; charset=utf-8 101.5047ms
