2025-02-01 00:00:46.405 +03:00 [INF] Request starting HTTP/1.1 POST http://localhost:5264/api/notifications/send - application/json 296
2025-02-01 00:00:46.413 +03:00 [INF] Executing endpoint 'NayifatAPI.Controllers.NotificationsController.SendNotification (NayifatAPI)'
2025-02-01 00:00:46.414 +03:00 [INF] Route matched with {action = "SendNotification", controller = "Notifications"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] SendNotification(NayifatAPI.Controllers.SendNotificationRequest) on controller NayifatAPI.Controllers.NotificationsController (NayifatAPI).
2025-02-01 00:00:46.428 +03:00 [INF] Executed DbCommand (5ms) [Parameters=[@__providedApiKey_0='?' (Size = 255)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [a].[Key], [a].[CreatedAt], [a].[Description], [a].[ExpiresAt], [a].[IsActive], [a].[LastUsedAt]
FROM [ApiKeys] AS [a]
WHERE [a].[Key] = @__providedApiKey_0 AND [a].[IsActive] = CAST(1 AS bit)
2025-02-01 00:00:46.432 +03:00 [INF] Received notification request: {"Title":null,"TitleEn":"Test Notification","TitleAr":"إشعار تجريبي","Filters":{"Customers.SalaryCustomer":{"ValueKind":"Object","$type":"JsonElement"}},"NationalId":null,"NationalIds":null}
2025-02-01 00:00:46.442 +03:00 [INF] Starting GetTargetUsers with request type: Filtered Users
2025-02-01 00:00:46.442 +03:00 [INF] Processing filter: SalaryCustomer > 10000
2025-02-01 00:00:46.444 +03:00 [INF] Applied SalaryCustomer filter: > 10000
2025-02-01 00:00:46.444 +03:00 [INF] Added filter group for customers.SalaryCustomer
2025-02-01 00:00:46.446 +03:00 [INF] Executing filter query with operation: AND
2025-02-01 00:00:46.451 +03:00 [INF] Executed DbCommand (2ms) [Parameters=[@__value_0='?' (Precision = 18) (Scale = 2) (DbType = Decimal)], CommandType='"Text"', CommandTimeout='30']
SELECT [c].[NationalId]
FROM [Customers] AS [c]
WHERE [c].[SalaryCustomer] > @__value_0
2025-02-01 00:00:46.458 +03:00 [INF] Found 4 users after applying filters
2025-02-01 00:00:46.460 +03:00 [INF] Target users query completed. Found 4 users
2025-02-01 00:00:46.461 +03:00 [INF] Found 4 target users for notification
2025-02-01 00:00:46.475 +03:00 [INF] Executed DbCommand (12ms) [Parameters=[@p0='?' (Size = 4000), @p1='?' (Size = 8000) (DbType = AnsiString), @p2='?' (Size = 8000) (DbType = AnsiString), @p3='?' (Size = 8000) (DbType = AnsiString), @p4='?' (DbType = DateTime2), @p5='?' (DbType = DateTime2), @p6='?' (Size = 255), @p7='?' (Size = 4000), @p8='?' (Size = 255), @p9='?' (Size = 255), @p10='?' (Size = 255)], CommandType='"Text"', CommandTimeout='30']
SET IMPLICIT_TRANSACTIONS OFF;
SET NOCOUNT ON;
INSERT INTO [notification_templates] ([additional_data], [Body], [body_ar], [body_en], [created_at], [expiry_at], [Route], [target_criteria], [Title], [title_ar], [title_en])
OUTPUT INSERTED.[Id]
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7, @p8, @p9, @p10);
2025-02-01 00:00:46.484 +03:00 [INF] Created notification template with ID: 1
2025-02-01 00:00:46.498 +03:00 [INF] Executed DbCommand (13ms) [Parameters=[@p0='?' (Size = 4000), @p1='?' (DbType = DateTime2), @p2='?' (Size = 4000), @p3='?' (Size = 4000), @p4='?' (Size = 4000), @p5='?' (Size = 450), @p6='?' (Size = 4000), @p7='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SET IMPLICIT_TRANSACTIONS OFF;
SET NOCOUNT ON;
INSERT INTO [AuthLogs] ([AuthType], [CreatedAt], [DeviceId], [FailureReason], [IpAddress], [NationalId], [Status], [UserAgent])
OUTPUT INSERTED.[Id]
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7);
2025-02-01 00:00:46.515 +03:00 [INF] Executed DbCommand (3ms) [Parameters=[@__userId_0='?' (Size = 450)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [u].[national_id], [u].[last_updated], [u].[notifications]
FROM [user_notifications] AS [u]
WHERE [u].[national_id] = @__userId_0
2025-02-01 00:00:46.524 +03:00 [INF] Processing notification for user 1012345678. Existing notification record: false
2025-02-01 00:00:46.528 +03:00 [INF] Current notifications count for user 1012345678: 0
2025-02-01 00:00:46.534 +03:00 [INF] Serialized new notifications for user 1012345678. Length: 140
2025-02-01 00:00:46.548 +03:00 [INF] Executed DbCommand (6ms) [Parameters=[@p0='?' (Size = 4000), @p1='?' (Size = 4000), @p2='?' (DbType = DateTime2)], CommandType='"Text"', CommandTimeout='30']
INSERT INTO user_notifications (national_id, notifications, last_updated) VALUES (@p0, @p1, @p2)
2025-02-01 00:00:46.559 +03:00 [INF] Created new UserNotification entry for user: 1012345678
2025-02-01 00:00:46.564 +03:00 [INF] Executed DbCommand (3ms) [Parameters=[@__userId_0='?' (Size = 450)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [u].[national_id], [u].[last_updated], [u].[notifications]
FROM [user_notifications] AS [u]
WHERE [u].[national_id] = @__userId_0
2025-02-01 00:00:46.567 +03:00 [INF] Processing notification for user 1023456789. Existing notification record: false
2025-02-01 00:00:46.569 +03:00 [INF] Current notifications count for user 1023456789: 0
2025-02-01 00:00:46.579 +03:00 [INF] Serialized new notifications for user 1023456789. Length: 140
2025-02-01 00:00:46.584 +03:00 [INF] Executed DbCommand (3ms) [Parameters=[@p0='?' (Size = 4000), @p1='?' (Size = 4000), @p2='?' (DbType = DateTime2)], CommandType='"Text"', CommandTimeout='30']
INSERT INTO user_notifications (national_id, notifications, last_updated) VALUES (@p0, @p1, @p2)
2025-02-01 00:00:46.587 +03:00 [INF] Created new UserNotification entry for user: 1023456789
2025-02-01 00:00:46.594 +03:00 [INF] Executed DbCommand (3ms) [Parameters=[@__userId_0='?' (Size = 450)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [u].[national_id], [u].[last_updated], [u].[notifications]
FROM [user_notifications] AS [u]
WHERE [u].[national_id] = @__userId_0
2025-02-01 00:00:46.597 +03:00 [INF] Processing notification for user 1034567890. Existing notification record: false
2025-02-01 00:00:46.598 +03:00 [INF] Current notifications count for user 1034567890: 0
2025-02-01 00:00:46.599 +03:00 [INF] Serialized new notifications for user 1034567890. Length: 140
2025-02-01 00:00:46.604 +03:00 [INF] Executed DbCommand (3ms) [Parameters=[@p0='?' (Size = 4000), @p1='?' (Size = 4000), @p2='?' (DbType = DateTime2)], CommandType='"Text"', CommandTimeout='30']
INSERT INTO user_notifications (national_id, notifications, last_updated) VALUES (@p0, @p1, @p2)
2025-02-01 00:00:46.611 +03:00 [INF] Created new UserNotification entry for user: 1034567890
2025-02-01 00:00:46.617 +03:00 [INF] Executed DbCommand (3ms) [Parameters=[@__userId_0='?' (Size = 450)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [u].[national_id], [u].[last_updated], [u].[notifications]
FROM [user_notifications] AS [u]
WHERE [u].[national_id] = @__userId_0
2025-02-01 00:00:46.619 +03:00 [INF] Processing notification for user 1056789012. Existing notification record: false
2025-02-01 00:00:46.627 +03:00 [INF] Current notifications count for user 1056789012: 0
2025-02-01 00:00:46.630 +03:00 [INF] Serialized new notifications for user 1056789012. Length: 140
2025-02-01 00:00:46.641 +03:00 [INF] Executed DbCommand (9ms) [Parameters=[@p0='?' (Size = 4000), @p1='?' (Size = 4000), @p2='?' (DbType = DateTime2)], CommandType='"Text"', CommandTimeout='30']
INSERT INTO user_notifications (national_id, notifications, last_updated) VALUES (@p0, @p1, @p2)
2025-02-01 00:00:46.643 +03:00 [INF] Created new UserNotification entry for user: 1056789012
2025-02-01 00:00:46.651 +03:00 [INF] Executed DbCommand (5ms) [Parameters=[@p0='?' (Size = 4000), @p1='?' (DbType = DateTime2), @p2='?' (Size = 4000), @p3='?' (Size = 4000), @p4='?' (Size = 4000), @p5='?' (Size = 450), @p6='?' (Size = 4000), @p7='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SET IMPLICIT_TRANSACTIONS OFF;
SET NOCOUNT ON;
INSERT INTO [AuthLogs] ([AuthType], [CreatedAt], [DeviceId], [FailureReason], [IpAddress], [NationalId], [Status], [UserAgent])
OUTPUT INSERTED.[Id]
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7);
2025-02-01 00:00:46.662 +03:00 [INF] Successfully sent notifications. Template: 1, Success: 4, Total: 4
2025-02-01 00:00:46.664 +03:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType9`2[[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Object, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-02-01 00:00:46.666 +03:00 [INF] Executed action NayifatAPI.Controllers.NotificationsController.SendNotification (NayifatAPI) in 247.1681ms
2025-02-01 00:00:46.674 +03:00 [INF] Executed endpoint 'NayifatAPI.Controllers.NotificationsController.SendNotification (NayifatAPI)'
2025-02-01 00:00:46.677 +03:00 [INF] Request finished HTTP/1.1 POST http://localhost:5264/api/notifications/send - 200 null application/json; charset=utf-8 272.143ms
2025-02-01 00:01:14.523 +03:00 [INF] Application is shutting down...
2025-02-01 00:01:30.740 +03:00 [INF] Starting web application
2025-02-01 00:01:30.831 +03:00 [INF] Now listening on: http://localhost:5264
2025-02-01 00:01:30.835 +03:00 [INF] Application started. Press Ctrl+C to shut down.
2025-02-01 00:01:30.836 +03:00 [INF] Hosting environment: Development
2025-02-01 00:01:30.837 +03:00 [INF] Content root path: C:\Users\yamta\StudioProjects\nayifat_app_2025_new\NayifatAPI
2025-02-01 00:01:49.686 +03:00 [INF] Request starting HTTP/1.1 POST http://localhost:5264/api/notifications/send - application/json 302
2025-02-01 00:01:49.811 +03:00 [WRN] Failed to determine the https port for redirect.
2025-02-01 00:01:49.821 +03:00 [INF] Executing endpoint 'NayifatAPI.Controllers.NotificationsController.SendNotification (NayifatAPI)'
2025-02-01 00:01:49.879 +03:00 [INF] Route matched with {action = "SendNotification", controller = "Notifications"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] SendNotification(NayifatAPI.Controllers.SendNotificationRequest) on controller NayifatAPI.Controllers.NotificationsController (NayifatAPI).
2025-02-01 00:01:51.902 +03:00 [INF] Executed DbCommand (43ms) [Parameters=[@__providedApiKey_0='?' (Size = 255)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [a].[Key], [a].[CreatedAt], [a].[Description], [a].[ExpiresAt], [a].[IsActive], [a].[LastUsedAt]
FROM [ApiKeys] AS [a]
WHERE [a].[Key] = @__providedApiKey_0 AND [a].[IsActive] = CAST(1 AS bit)
2025-02-01 00:01:52.046 +03:00 [INF] Received notification request: {"Title":null,"TitleEn":"Test Notification","TitleAr":"إشعار تجريبي","Filters":{"Customers.SalaryCustomer":{"ValueKind":"Object","$type":"JsonElement"}},"NationalId":null,"NationalIds":null}
2025-02-01 00:01:52.072 +03:00 [INF] Starting GetTargetUsers with request type: Filtered Users
2025-02-01 00:01:52.097 +03:00 [INF] Applied SalaryCustomer BETWEEN filter: 5000 AND 15000
2025-02-01 00:01:52.101 +03:00 [WRN] No valid filters were applied
2025-02-01 00:01:52.103 +03:00 [INF] Target users query completed. Found 0 users
2025-02-01 00:01:52.106 +03:00 [WRN] No target users found. Filters: {"Customers.SalaryCustomer":{"ValueKind":"Object","$type":"JsonElement"}}
2025-02-01 00:01:52.117 +03:00 [INF] Executing ObjectResult, writing value of type '<>f__AnonymousType11`2[[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-02-01 00:01:52.145 +03:00 [INF] Executed action NayifatAPI.Controllers.NotificationsController.SendNotification (NayifatAPI) in 2252.0793ms
2025-02-01 00:01:52.148 +03:00 [INF] Executed endpoint 'NayifatAPI.Controllers.NotificationsController.SendNotification (NayifatAPI)'
2025-02-01 00:01:52.164 +03:00 [INF] Request finished HTTP/1.1 POST http://localhost:5264/api/notifications/send - 400 null application/json; charset=utf-8 2481.4643ms
2025-02-01 00:03:20.029 +03:00 [INF] Request starting HTTP/1.1 POST http://localhost:5264/api/notifications/send - application/json 279
2025-02-01 00:03:20.037 +03:00 [INF] Executing endpoint 'NayifatAPI.Controllers.NotificationsController.SendNotification (NayifatAPI)'
2025-02-01 00:03:20.038 +03:00 [INF] Route matched with {action = "SendNotification", controller = "Notifications"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] SendNotification(NayifatAPI.Controllers.SendNotificationRequest) on controller NayifatAPI.Controllers.NotificationsController (NayifatAPI).
2025-02-01 00:03:20.087 +03:00 [INF] Executed DbCommand (7ms) [Parameters=[@__providedApiKey_0='?' (Size = 255)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [a].[Key], [a].[CreatedAt], [a].[Description], [a].[ExpiresAt], [a].[IsActive], [a].[LastUsedAt]
FROM [ApiKeys] AS [a]
WHERE [a].[Key] = @__providedApiKey_0 AND [a].[IsActive] = CAST(1 AS bit)
2025-02-01 00:03:20.092 +03:00 [INF] Received notification request: {"Title":null,"TitleEn":"Test Notification","TitleAr":"إشعار تجريبي","Filters":{"Customers.Employer":{"ValueKind":"Object","$type":"JsonElement"}},"NationalId":null,"NationalIds":null}
2025-02-01 00:03:20.098 +03:00 [INF] Starting GetTargetUsers with request type: Filtered Users
2025-02-01 00:03:20.100 +03:00 [INF] Processing filter: Employer LIKE a
2025-02-01 00:03:20.104 +03:00 [INF] Applied Employer filter: LIKE a
2025-02-01 00:03:20.105 +03:00 [INF] Added filter group for customers.Employer
2025-02-01 00:03:20.107 +03:00 [INF] Executing filter query with operation: AND
2025-02-01 00:03:20.245 +03:00 [INF] Executed DbCommand (25ms) [Parameters=[@__Format_1='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SELECT [c].[NationalId]
FROM [Customers] AS [c]
WHERE [c].[Employer] LIKE @__Format_1
2025-02-01 00:03:20.273 +03:00 [INF] Found 5 users after applying filters
2025-02-01 00:03:20.275 +03:00 [INF] Target users query completed. Found 5 users
2025-02-01 00:03:20.276 +03:00 [INF] Found 5 target users for notification
2025-02-01 00:03:20.537 +03:00 [INF] Executed DbCommand (12ms) [Parameters=[@p0='?' (Size = 4000), @p1='?' (Size = 8000) (DbType = AnsiString), @p2='?' (Size = 8000) (DbType = AnsiString), @p3='?' (Size = 8000) (DbType = AnsiString), @p4='?' (DbType = DateTime2), @p5='?' (DbType = DateTime2), @p6='?' (Size = 255), @p7='?' (Size = 4000), @p8='?' (Size = 255), @p9='?' (Size = 255), @p10='?' (Size = 255)], CommandType='"Text"', CommandTimeout='30']
SET IMPLICIT_TRANSACTIONS OFF;
SET NOCOUNT ON;
INSERT INTO [notification_templates] ([additional_data], [Body], [body_ar], [body_en], [created_at], [expiry_at], [Route], [target_criteria], [Title], [title_ar], [title_en])
OUTPUT INSERTED.[Id]
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7, @p8, @p9, @p10);
2025-02-01 00:03:20.602 +03:00 [INF] Created notification template with ID: 2
2025-02-01 00:03:20.702 +03:00 [INF] Executed DbCommand (11ms) [Parameters=[@p0='?' (Size = 4000), @p1='?' (DbType = DateTime2), @p2='?' (Size = 4000), @p3='?' (Size = 4000), @p4='?' (Size = 4000), @p5='?' (Size = 450), @p6='?' (Size = 4000), @p7='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SET IMPLICIT_TRANSACTIONS OFF;
SET NOCOUNT ON;
INSERT INTO [AuthLogs] ([AuthType], [CreatedAt], [DeviceId], [FailureReason], [IpAddress], [NationalId], [Status], [UserAgent])
OUTPUT INSERTED.[Id]
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7);
2025-02-01 00:03:20.732 +03:00 [INF] Executed DbCommand (2ms) [Parameters=[@__userId_0='?' (Size = 450)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [u].[national_id], [u].[last_updated], [u].[notifications]
FROM [user_notifications] AS [u]
WHERE [u].[national_id] = @__userId_0
2025-02-01 00:03:20.755 +03:00 [INF] Processing notification for user 1012345678. Existing notification record: true
2025-02-01 00:03:20.758 +03:00 [INF] Current notifications count for user 1012345678: 1
2025-02-01 00:03:20.776 +03:00 [INF] Serialized new notifications for user 1012345678. Length: 279
2025-02-01 00:03:20.809 +03:00 [INF] Executed DbCommand (26ms) [Parameters=[@p0='?' (Size = 4000), @p1='?' (DbType = DateTime2), @p2='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
UPDATE user_notifications SET notifications = @p0, last_updated = @p1 WHERE national_id = @p2
2025-02-01 00:03:20.812 +03:00 [INF] Updated existing UserNotification for user: 1012345678
2025-02-01 00:03:20.814 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@__userId_0='?' (Size = 450)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [u].[national_id], [u].[last_updated], [u].[notifications]
FROM [user_notifications] AS [u]
WHERE [u].[national_id] = @__userId_0
2025-02-01 00:03:20.820 +03:00 [INF] Processing notification for user 1023456789. Existing notification record: true
2025-02-01 00:03:20.822 +03:00 [INF] Current notifications count for user 1023456789: 1
2025-02-01 00:03:20.824 +03:00 [INF] Serialized new notifications for user 1023456789. Length: 279
2025-02-01 00:03:20.827 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@p0='?' (Size = 4000), @p1='?' (DbType = DateTime2), @p2='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
UPDATE user_notifications SET notifications = @p0, last_updated = @p1 WHERE national_id = @p2
2025-02-01 00:03:20.828 +03:00 [INF] Updated existing UserNotification for user: 1023456789
2025-02-01 00:03:20.831 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@__userId_0='?' (Size = 450)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [u].[national_id], [u].[last_updated], [u].[notifications]
FROM [user_notifications] AS [u]
WHERE [u].[national_id] = @__userId_0
2025-02-01 00:03:20.837 +03:00 [INF] Processing notification for user 1034567890. Existing notification record: true
2025-02-01 00:03:20.839 +03:00 [INF] Current notifications count for user 1034567890: 1
2025-02-01 00:03:20.841 +03:00 [INF] Serialized new notifications for user 1034567890. Length: 279
2025-02-01 00:03:20.844 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@p0='?' (Size = 4000), @p1='?' (DbType = DateTime2), @p2='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
UPDATE user_notifications SET notifications = @p0, last_updated = @p1 WHERE national_id = @p2
2025-02-01 00:03:20.847 +03:00 [INF] Updated existing UserNotification for user: 1034567890
2025-02-01 00:03:20.849 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@__userId_0='?' (Size = 450)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [u].[national_id], [u].[last_updated], [u].[notifications]
FROM [user_notifications] AS [u]
WHERE [u].[national_id] = @__userId_0
2025-02-01 00:03:20.855 +03:00 [INF] Processing notification for user 1045678901. Existing notification record: false
2025-02-01 00:03:20.858 +03:00 [INF] Current notifications count for user 1045678901: 0
2025-02-01 00:03:20.859 +03:00 [INF] Serialized new notifications for user 1045678901. Length: 140
2025-02-01 00:03:20.863 +03:00 [INF] Executed DbCommand (3ms) [Parameters=[@p0='?' (Size = 4000), @p1='?' (Size = 4000), @p2='?' (DbType = DateTime2)], CommandType='"Text"', CommandTimeout='30']
INSERT INTO user_notifications (national_id, notifications, last_updated) VALUES (@p0, @p1, @p2)
2025-02-01 00:03:20.866 +03:00 [INF] Created new UserNotification entry for user: 1045678901
2025-02-01 00:03:20.872 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@__userId_0='?' (Size = 450)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [u].[national_id], [u].[last_updated], [u].[notifications]
FROM [user_notifications] AS [u]
WHERE [u].[national_id] = @__userId_0
2025-02-01 00:03:20.875 +03:00 [INF] Processing notification for user 1056789012. Existing notification record: true
2025-02-01 00:03:20.876 +03:00 [INF] Current notifications count for user 1056789012: 1
2025-02-01 00:03:20.878 +03:00 [INF] Serialized new notifications for user 1056789012. Length: 279
2025-02-01 00:03:20.881 +03:00 [INF] Executed DbCommand (2ms) [Parameters=[@p0='?' (Size = 4000), @p1='?' (DbType = DateTime2), @p2='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
UPDATE user_notifications SET notifications = @p0, last_updated = @p1 WHERE national_id = @p2
2025-02-01 00:03:20.888 +03:00 [INF] Updated existing UserNotification for user: 1056789012
2025-02-01 00:03:20.895 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@p0='?' (Size = 4000), @p1='?' (DbType = DateTime2), @p2='?' (Size = 4000), @p3='?' (Size = 4000), @p4='?' (Size = 4000), @p5='?' (Size = 450), @p6='?' (Size = 4000), @p7='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SET IMPLICIT_TRANSACTIONS OFF;
SET NOCOUNT ON;
INSERT INTO [AuthLogs] ([AuthType], [CreatedAt], [DeviceId], [FailureReason], [IpAddress], [NationalId], [Status], [UserAgent])
OUTPUT INSERTED.[Id]
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7);
2025-02-01 00:03:20.899 +03:00 [INF] Successfully sent notifications. Template: 2, Success: 5, Total: 5
2025-02-01 00:03:20.909 +03:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType9`2[[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Object, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-02-01 00:03:20.920 +03:00 [INF] Executed action NayifatAPI.Controllers.NotificationsController.SendNotification (NayifatAPI) in 879.2662ms
2025-02-01 00:03:20.923 +03:00 [INF] Executed endpoint 'NayifatAPI.Controllers.NotificationsController.SendNotification (NayifatAPI)'
2025-02-01 00:03:20.927 +03:00 [INF] Request finished HTTP/1.1 POST http://localhost:5264/api/notifications/send - 200 null application/json; charset=utf-8 897.739ms
2025-02-01 00:03:36.858 +03:00 [INF] Request starting HTTP/1.1 POST http://localhost:5264/api/notifications/send - application/json 302
2025-02-01 00:03:36.863 +03:00 [INF] Executing endpoint 'NayifatAPI.Controllers.NotificationsController.SendNotification (NayifatAPI)'
2025-02-01 00:03:36.867 +03:00 [INF] Route matched with {action = "SendNotification", controller = "Notifications"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] SendNotification(NayifatAPI.Controllers.SendNotificationRequest) on controller NayifatAPI.Controllers.NotificationsController (NayifatAPI).
2025-02-01 00:03:37.042 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@__providedApiKey_0='?' (Size = 255)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [a].[Key], [a].[CreatedAt], [a].[Description], [a].[ExpiresAt], [a].[IsActive], [a].[LastUsedAt]
FROM [ApiKeys] AS [a]
WHERE [a].[Key] = @__providedApiKey_0 AND [a].[IsActive] = CAST(1 AS bit)
2025-02-01 00:03:37.047 +03:00 [INF] Received notification request: {"Title":null,"TitleEn":"Test Notification","TitleAr":"إشعار تجريبي","Filters":{"Customers.SalaryCustomer":{"ValueKind":"Object","$type":"JsonElement"}},"NationalId":null,"NationalIds":null}
2025-02-01 00:03:37.051 +03:00 [INF] Starting GetTargetUsers with request type: Filtered Users
2025-02-01 00:03:37.052 +03:00 [INF] Applied SalaryCustomer BETWEEN filter: 5000 AND 15000
2025-02-01 00:03:37.053 +03:00 [WRN] No valid filters were applied
2025-02-01 00:03:37.054 +03:00 [INF] Target users query completed. Found 0 users
2025-02-01 00:03:37.055 +03:00 [WRN] No target users found. Filters: {"Customers.SalaryCustomer":{"ValueKind":"Object","$type":"JsonElement"}}
2025-02-01 00:03:37.057 +03:00 [INF] Executing ObjectResult, writing value of type '<>f__AnonymousType11`2[[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-02-01 00:03:37.059 +03:00 [INF] Executed action NayifatAPI.Controllers.NotificationsController.SendNotification (NayifatAPI) in 174.3378ms
2025-02-01 00:03:37.060 +03:00 [INF] Executed endpoint 'NayifatAPI.Controllers.NotificationsController.SendNotification (NayifatAPI)'
2025-02-01 00:03:37.062 +03:00 [INF] Request finished HTTP/1.1 POST http://localhost:5264/api/notifications/send - 400 null application/json; charset=utf-8 203.5555ms
2025-02-01 00:05:34.403 +03:00 [INF] Request starting HTTP/1.1 POST http://localhost:5264/api/notifications/send - application/json 362
2025-02-01 00:05:34.407 +03:00 [INF] Executing endpoint 'NayifatAPI.Controllers.NotificationsController.SendNotification (NayifatAPI)'
2025-02-01 00:05:34.409 +03:00 [INF] Route matched with {action = "SendNotification", controller = "Notifications"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] SendNotification(NayifatAPI.Controllers.SendNotificationRequest) on controller NayifatAPI.Controllers.NotificationsController (NayifatAPI).
2025-02-01 00:05:34.417 +03:00 [INF] Executed DbCommand (5ms) [Parameters=[@__providedApiKey_0='?' (Size = 255)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [a].[Key], [a].[CreatedAt], [a].[Description], [a].[ExpiresAt], [a].[IsActive], [a].[LastUsedAt]
FROM [ApiKeys] AS [a]
WHERE [a].[Key] = @__providedApiKey_0 AND [a].[IsActive] = CAST(1 AS bit)
2025-02-01 00:05:34.420 +03:00 [INF] Received notification request: {"Title":null,"TitleEn":"Test Notification","TitleAr":"إشعار تجريبي","Filters":{"Customers.City":{"ValueKind":"Object","$type":"JsonElement"},"Customers.District":{"ValueKind":"Object","$type":"JsonElement"}},"NationalId":null,"NationalIds":null}
2025-02-01 00:05:34.426 +03:00 [INF] Starting GetTargetUsers with request type: Filtered Users
2025-02-01 00:05:34.427 +03:00 [INF] Processing filter: City LIKE Ri
2025-02-01 00:05:34.428 +03:00 [INF] Applied City filter: LIKE Ri
2025-02-01 00:05:34.429 +03:00 [INF] Added filter group for customers.City
2025-02-01 00:05:34.430 +03:00 [INF] Processing filter: District LIKE o
2025-02-01 00:05:34.431 +03:00 [WRN] Unknown field name in filter: District
2025-02-01 00:05:34.432 +03:00 [INF] Executing filter query with operation: AND
2025-02-01 00:05:34.442 +03:00 [INF] Executed DbCommand (3ms) [Parameters=[@__Format_1='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SELECT [c].[NationalId]
FROM [Customers] AS [c]
WHERE [c].[City] LIKE @__Format_1
2025-02-01 00:05:34.445 +03:00 [INF] Found 2 users after applying filters
2025-02-01 00:05:34.446 +03:00 [INF] Target users query completed. Found 2 users
2025-02-01 00:05:34.448 +03:00 [INF] Found 2 target users for notification
2025-02-01 00:05:34.463 +03:00 [INF] Executed DbCommand (12ms) [Parameters=[@p0='?' (Size = 4000), @p1='?' (Size = 8000) (DbType = AnsiString), @p2='?' (Size = 8000) (DbType = AnsiString), @p3='?' (Size = 8000) (DbType = AnsiString), @p4='?' (DbType = DateTime2), @p5='?' (DbType = DateTime2), @p6='?' (Size = 255), @p7='?' (Size = 4000), @p8='?' (Size = 255), @p9='?' (Size = 255), @p10='?' (Size = 255)], CommandType='"Text"', CommandTimeout='30']
SET IMPLICIT_TRANSACTIONS OFF;
SET NOCOUNT ON;
INSERT INTO [notification_templates] ([additional_data], [Body], [body_ar], [body_en], [created_at], [expiry_at], [Route], [target_criteria], [Title], [title_ar], [title_en])
OUTPUT INSERTED.[Id]
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7, @p8, @p9, @p10);
2025-02-01 00:05:34.467 +03:00 [INF] Created notification template with ID: 3
2025-02-01 00:05:34.476 +03:00 [INF] Executed DbCommand (4ms) [Parameters=[@p0='?' (Size = 4000), @p1='?' (DbType = DateTime2), @p2='?' (Size = 4000), @p3='?' (Size = 4000), @p4='?' (Size = 4000), @p5='?' (Size = 450), @p6='?' (Size = 4000), @p7='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SET IMPLICIT_TRANSACTIONS OFF;
SET NOCOUNT ON;
INSERT INTO [AuthLogs] ([AuthType], [CreatedAt], [DeviceId], [FailureReason], [IpAddress], [NationalId], [Status], [UserAgent])
OUTPUT INSERTED.[Id]
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7);
2025-02-01 00:05:34.481 +03:00 [INF] Executed DbCommand (2ms) [Parameters=[@__userId_0='?' (Size = 450)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [u].[national_id], [u].[last_updated], [u].[notifications]
FROM [user_notifications] AS [u]
WHERE [u].[national_id] = @__userId_0
2025-02-01 00:05:34.485 +03:00 [INF] Processing notification for user 1012345678. Existing notification record: true
2025-02-01 00:05:34.487 +03:00 [INF] Current notifications count for user 1012345678: 2
2025-02-01 00:05:34.489 +03:00 [INF] Serialized new notifications for user 1012345678. Length: 418
2025-02-01 00:05:34.499 +03:00 [INF] Executed DbCommand (6ms) [Parameters=[@p0='?' (Size = 4000), @p1='?' (DbType = DateTime2), @p2='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
UPDATE user_notifications SET notifications = @p0, last_updated = @p1 WHERE national_id = @p2
2025-02-01 00:05:34.501 +03:00 [INF] Updated existing UserNotification for user: 1012345678
2025-02-01 00:05:34.507 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@__userId_0='?' (Size = 450)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [u].[national_id], [u].[last_updated], [u].[notifications]
FROM [user_notifications] AS [u]
WHERE [u].[national_id] = @__userId_0
2025-02-01 00:05:34.510 +03:00 [INF] Processing notification for user 1045678901. Existing notification record: true
2025-02-01 00:05:34.511 +03:00 [INF] Current notifications count for user 1045678901: 1
2025-02-01 00:05:34.512 +03:00 [INF] Serialized new notifications for user 1045678901. Length: 279
2025-02-01 00:05:34.514 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@p0='?' (Size = 4000), @p1='?' (DbType = DateTime2), @p2='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
UPDATE user_notifications SET notifications = @p0, last_updated = @p1 WHERE national_id = @p2
2025-02-01 00:05:34.516 +03:00 [INF] Updated existing UserNotification for user: 1045678901
2025-02-01 00:05:34.519 +03:00 [INF] Executed DbCommand (2ms) [Parameters=[@p0='?' (Size = 4000), @p1='?' (DbType = DateTime2), @p2='?' (Size = 4000), @p3='?' (Size = 4000), @p4='?' (Size = 4000), @p5='?' (Size = 450), @p6='?' (Size = 4000), @p7='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SET IMPLICIT_TRANSACTIONS OFF;
SET NOCOUNT ON;
INSERT INTO [AuthLogs] ([AuthType], [CreatedAt], [DeviceId], [FailureReason], [IpAddress], [NationalId], [Status], [UserAgent])
OUTPUT INSERTED.[Id]
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7);
2025-02-01 00:05:34.523 +03:00 [INF] Successfully sent notifications. Template: 3, Success: 2, Total: 2
2025-02-01 00:05:34.525 +03:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType9`2[[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Object, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-02-01 00:05:34.526 +03:00 [INF] Executed action NayifatAPI.Controllers.NotificationsController.SendNotification (NayifatAPI) in 116.19ms
2025-02-01 00:05:34.528 +03:00 [INF] Executed endpoint 'NayifatAPI.Controllers.NotificationsController.SendNotification (NayifatAPI)'
2025-02-01 00:05:34.529 +03:00 [INF] Request finished HTTP/1.1 POST http://localhost:5264/api/notifications/send - 200 null application/json; charset=utf-8 125.8505ms
2025-02-01 00:06:25.109 +03:00 [INF] Application is shutting down...
2025-02-01 00:06:39.176 +03:00 [INF] Starting web application
2025-02-01 00:06:39.299 +03:00 [INF] Now listening on: http://localhost:5264
2025-02-01 00:06:39.305 +03:00 [INF] Application started. Press Ctrl+C to shut down.
2025-02-01 00:06:39.306 +03:00 [INF] Hosting environment: Development
2025-02-01 00:06:39.306 +03:00 [INF] Content root path: C:\Users\yamta\StudioProjects\nayifat_app_2025_new\NayifatAPI
2025-02-01 00:07:03.117 +03:00 [INF] Request starting HTTP/1.1 POST http://localhost:5264/api/notifications/send - application/json 298
2025-02-01 00:07:03.218 +03:00 [WRN] Failed to determine the https port for redirect.
2025-02-01 00:07:03.225 +03:00 [INF] Executing endpoint 'NayifatAPI.Controllers.NotificationsController.SendNotification (NayifatAPI)'
2025-02-01 00:07:03.272 +03:00 [INF] Route matched with {action = "SendNotification", controller = "Notifications"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] SendNotification(NayifatAPI.Controllers.SendNotificationRequest) on controller NayifatAPI.Controllers.NotificationsController (NayifatAPI).
2025-02-01 00:07:05.866 +03:00 [INF] Executed DbCommand (33ms) [Parameters=[@__providedApiKey_0='?' (Size = 255)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [a].[Key], [a].[CreatedAt], [a].[Description], [a].[ExpiresAt], [a].[IsActive], [a].[LastUsedAt]
FROM [ApiKeys] AS [a]
WHERE [a].[Key] = @__providedApiKey_0 AND [a].[IsActive] = CAST(1 AS bit)
2025-02-01 00:07:06.005 +03:00 [INF] Received notification request: {"Title":null,"TitleEn":"Test Notification","TitleAr":"إشعار تجريبي","Filters":{"Customers.SalaryCustomer":{"ValueKind":"Object","$type":"JsonElement"}},"NationalId":null,"NationalIds":null}
2025-02-01 00:07:06.024 +03:00 [INF] Starting GetTargetUsers with request type: Filtered Users
2025-02-01 00:07:06.044 +03:00 [INF] Applied SalaryCustomer BETWEEN filter: 5000 AND 15000
2025-02-01 00:07:06.055 +03:00 [ERR] Error applying filter: Customers.SalaryCustomer = {
      "operator": "BETWEEN",
      "value": [5000, 15000]
    }
System.InvalidOperationException: The requested operation requires an element of type 'String', but the target element has type 'Array'.
   at System.Text.Json.ThrowHelper.ThrowJsonElementWrongTypeException(JsonTokenType expectedType, JsonTokenType actualType)
   at System.Text.Json.JsonDocument.GetString(Int32 index, JsonTokenType expectedType)
   at NayifatAPI.Controllers.NotificationsController.GetTargetUsers(SendNotificationRequest request) in C:\Users\yamta\StudioProjects\nayifat_app_2025_new\NayifatAPI\Controllers\NotificationsController.cs:line 740
2025-02-01 00:07:06.089 +03:00 [WRN] No valid filters were applied
2025-02-01 00:07:06.091 +03:00 [INF] Target users query completed. Found 0 users
2025-02-01 00:07:06.093 +03:00 [WRN] No target users found. Filters: {"Customers.SalaryCustomer":{"ValueKind":"Object","$type":"JsonElement"}}
2025-02-01 00:07:06.105 +03:00 [INF] Executing ObjectResult, writing value of type '<>f__AnonymousType11`2[[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-02-01 00:07:06.135 +03:00 [INF] Executed action NayifatAPI.Controllers.NotificationsController.SendNotification (NayifatAPI) in 2852.4756ms
2025-02-01 00:07:06.138 +03:00 [INF] Executed endpoint 'NayifatAPI.Controllers.NotificationsController.SendNotification (NayifatAPI)'
2025-02-01 00:07:06.153 +03:00 [INF] Request finished HTTP/1.1 POST http://localhost:5264/api/notifications/send - 400 null application/json; charset=utf-8 3040.0587ms
2025-02-01 00:07:31.936 +03:00 [INF] Request starting HTTP/1.1 POST http://localhost:5264/api/notifications/send - application/json 298
2025-02-01 00:07:31.943 +03:00 [INF] Executing endpoint 'NayifatAPI.Controllers.NotificationsController.SendNotification (NayifatAPI)'
2025-02-01 00:07:31.944 +03:00 [INF] Route matched with {action = "SendNotification", controller = "Notifications"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] SendNotification(NayifatAPI.Controllers.SendNotificationRequest) on controller NayifatAPI.Controllers.NotificationsController (NayifatAPI).
2025-02-01 00:07:31.987 +03:00 [INF] Executed DbCommand (4ms) [Parameters=[@__providedApiKey_0='?' (Size = 255)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [a].[Key], [a].[CreatedAt], [a].[Description], [a].[ExpiresAt], [a].[IsActive], [a].[LastUsedAt]
FROM [ApiKeys] AS [a]
WHERE [a].[Key] = @__providedApiKey_0 AND [a].[IsActive] = CAST(1 AS bit)
2025-02-01 00:07:31.990 +03:00 [INF] Received notification request: {"Title":null,"TitleEn":"Test Notification","TitleAr":"إشعار تجريبي","Filters":{"Customers.SalaryCustomer":{"ValueKind":"Object","$type":"JsonElement"}},"NationalId":null,"NationalIds":null}
2025-02-01 00:07:31.998 +03:00 [INF] Starting GetTargetUsers with request type: Filtered Users
2025-02-01 00:07:31.999 +03:00 [INF] Applied SalaryCustomer BETWEEN filter: 5000 AND 15000
2025-02-01 00:07:32.000 +03:00 [ERR] Error applying filter: Customers.SalaryCustomer = {
      "operator": "BETWEEN",
      "value": [5000, 15000]
    }
System.InvalidOperationException: The requested operation requires an element of type 'String', but the target element has type 'Array'.
   at System.Text.Json.ThrowHelper.ThrowJsonElementWrongTypeException(JsonTokenType expectedType, JsonTokenType actualType)
   at System.Text.Json.JsonDocument.GetString(Int32 index, JsonTokenType expectedType)
   at NayifatAPI.Controllers.NotificationsController.GetTargetUsers(SendNotificationRequest request) in C:\Users\yamta\StudioProjects\nayifat_app_2025_new\NayifatAPI\Controllers\NotificationsController.cs:line 740
2025-02-01 00:07:32.003 +03:00 [WRN] No valid filters were applied
2025-02-01 00:07:32.003 +03:00 [INF] Target users query completed. Found 0 users
2025-02-01 00:07:32.004 +03:00 [WRN] No target users found. Filters: {"Customers.SalaryCustomer":{"ValueKind":"Object","$type":"JsonElement"}}
2025-02-01 00:07:32.005 +03:00 [INF] Executing ObjectResult, writing value of type '<>f__AnonymousType11`2[[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-02-01 00:07:32.007 +03:00 [INF] Executed action NayifatAPI.Controllers.NotificationsController.SendNotification (NayifatAPI) in 60.8755ms
2025-02-01 00:07:32.011 +03:00 [INF] Executed endpoint 'NayifatAPI.Controllers.NotificationsController.SendNotification (NayifatAPI)'
2025-02-01 00:07:32.012 +03:00 [INF] Request finished HTTP/1.1 POST http://localhost:5264/api/notifications/send - 400 null application/json; charset=utf-8 75.5356ms
2025-02-01 00:08:07.800 +03:00 [INF] Application is shutting down...
2025-02-01 00:08:21.374 +03:00 [INF] Starting web application
2025-02-01 00:08:21.495 +03:00 [INF] Now listening on: http://localhost:5264
2025-02-01 00:08:21.501 +03:00 [INF] Application started. Press Ctrl+C to shut down.
2025-02-01 00:08:21.502 +03:00 [INF] Hosting environment: Development
2025-02-01 00:08:21.503 +03:00 [INF] Content root path: C:\Users\yamta\StudioProjects\nayifat_app_2025_new\NayifatAPI
2025-02-01 00:08:31.714 +03:00 [INF] Request starting HTTP/1.1 POST http://localhost:5264/api/notifications/send - application/json 298
2025-02-01 00:08:31.785 +03:00 [WRN] Failed to determine the https port for redirect.
2025-02-01 00:08:31.792 +03:00 [INF] Executing endpoint 'NayifatAPI.Controllers.NotificationsController.SendNotification (NayifatAPI)'
2025-02-01 00:08:31.830 +03:00 [INF] Route matched with {action = "SendNotification", controller = "Notifications"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] SendNotification(NayifatAPI.Controllers.SendNotificationRequest) on controller NayifatAPI.Controllers.NotificationsController (NayifatAPI).
2025-02-01 00:08:34.105 +03:00 [INF] Executed DbCommand (64ms) [Parameters=[@__providedApiKey_0='?' (Size = 255)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [a].[Key], [a].[CreatedAt], [a].[Description], [a].[ExpiresAt], [a].[IsActive], [a].[LastUsedAt]
FROM [ApiKeys] AS [a]
WHERE [a].[Key] = @__providedApiKey_0 AND [a].[IsActive] = CAST(1 AS bit)
2025-02-01 00:08:34.262 +03:00 [INF] Received notification request: {"Title":null,"TitleEn":"Test Notification","TitleAr":"إشعار تجريبي","Filters":{"Customers.SalaryCustomer":{"ValueKind":"Object","$type":"JsonElement"}},"NationalId":null,"NationalIds":null}
2025-02-01 00:08:34.289 +03:00 [INF] Starting GetTargetUsers with request type: Filtered Users
2025-02-01 00:08:34.307 +03:00 [INF] Applied SalaryCustomer BETWEEN filter: 5000 AND 15000
2025-02-01 00:08:34.315 +03:00 [ERR] Error applying filter: Customers.SalaryCustomer = {
      "operator": "BETWEEN",
      "value": [5000, 15000]
    }
System.InvalidOperationException: The requested operation requires an element of type 'String', but the target element has type 'Array'.
   at System.Text.Json.ThrowHelper.ThrowJsonElementWrongTypeException(JsonTokenType expectedType, JsonTokenType actualType)
   at System.Text.Json.JsonDocument.GetString(Int32 index, JsonTokenType expectedType)
   at NayifatAPI.Controllers.NotificationsController.GetTargetUsers(SendNotificationRequest request) in C:\Users\yamta\StudioProjects\nayifat_app_2025_new\NayifatAPI\Controllers\NotificationsController.cs:line 740
2025-02-01 00:08:34.354 +03:00 [WRN] No valid filters were applied
2025-02-01 00:08:34.356 +03:00 [INF] Target users query completed. Found 0 users
2025-02-01 00:08:34.358 +03:00 [WRN] No target users found. Filters: {"Customers.SalaryCustomer":{"ValueKind":"Object","$type":"JsonElement"}}
2025-02-01 00:08:34.372 +03:00 [INF] Executing ObjectResult, writing value of type '<>f__AnonymousType11`2[[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-02-01 00:08:34.404 +03:00 [INF] Executed action NayifatAPI.Controllers.NotificationsController.SendNotification (NayifatAPI) in 2566.0991ms
2025-02-01 00:08:34.408 +03:00 [INF] Executed endpoint 'NayifatAPI.Controllers.NotificationsController.SendNotification (NayifatAPI)'
2025-02-01 00:08:34.438 +03:00 [INF] Request finished HTTP/1.1 POST http://localhost:5264/api/notifications/send - 400 null application/json; charset=utf-8 2725.7198ms
2025-02-01 00:08:50.657 +03:00 [INF] Request starting HTTP/1.1 POST http://localhost:5264/api/notifications/send - application/json 298
2025-02-01 00:08:50.665 +03:00 [INF] Executing endpoint 'NayifatAPI.Controllers.NotificationsController.SendNotification (NayifatAPI)'
2025-02-01 00:08:50.667 +03:00 [INF] Route matched with {action = "SendNotification", controller = "Notifications"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] SendNotification(NayifatAPI.Controllers.SendNotificationRequest) on controller NayifatAPI.Controllers.NotificationsController (NayifatAPI).
2025-02-01 00:08:50.727 +03:00 [INF] Executed DbCommand (9ms) [Parameters=[@__providedApiKey_0='?' (Size = 255)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [a].[Key], [a].[CreatedAt], [a].[Description], [a].[ExpiresAt], [a].[IsActive], [a].[LastUsedAt]
FROM [ApiKeys] AS [a]
WHERE [a].[Key] = @__providedApiKey_0 AND [a].[IsActive] = CAST(1 AS bit)
2025-02-01 00:08:50.732 +03:00 [INF] Received notification request: {"Title":null,"TitleEn":"Test Notification","TitleAr":"إشعار تجريبي","Filters":{"Customers.SalaryCustomer":{"ValueKind":"Object","$type":"JsonElement"}},"NationalId":null,"NationalIds":null}
2025-02-01 00:08:50.741 +03:00 [INF] Starting GetTargetUsers with request type: Filtered Users
2025-02-01 00:08:50.743 +03:00 [INF] Applied SalaryCustomer BETWEEN filter: 5000 AND 15000
2025-02-01 00:08:50.745 +03:00 [ERR] Error applying filter: Customers.SalaryCustomer = {
      "operator": "BETWEEN",
      "value": [5000, 15000]
    }
System.InvalidOperationException: The requested operation requires an element of type 'String', but the target element has type 'Array'.
   at System.Text.Json.ThrowHelper.ThrowJsonElementWrongTypeException(JsonTokenType expectedType, JsonTokenType actualType)
   at System.Text.Json.JsonDocument.GetString(Int32 index, JsonTokenType expectedType)
   at NayifatAPI.Controllers.NotificationsController.GetTargetUsers(SendNotificationRequest request) in C:\Users\yamta\StudioProjects\nayifat_app_2025_new\NayifatAPI\Controllers\NotificationsController.cs:line 740
2025-02-01 00:08:50.749 +03:00 [WRN] No valid filters were applied
2025-02-01 00:08:50.750 +03:00 [INF] Target users query completed. Found 0 users
2025-02-01 00:08:50.752 +03:00 [WRN] No target users found. Filters: {"Customers.SalaryCustomer":{"ValueKind":"Object","$type":"JsonElement"}}
2025-02-01 00:08:50.757 +03:00 [INF] Executing ObjectResult, writing value of type '<>f__AnonymousType11`2[[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-02-01 00:08:50.761 +03:00 [INF] Executed action NayifatAPI.Controllers.NotificationsController.SendNotification (NayifatAPI) in 92.316ms
2025-02-01 00:08:50.763 +03:00 [INF] Executed endpoint 'NayifatAPI.Controllers.NotificationsController.SendNotification (NayifatAPI)'
2025-02-01 00:08:50.765 +03:00 [INF] Request finished HTTP/1.1 POST http://localhost:5264/api/notifications/send - 400 null application/json; charset=utf-8 107.8477ms
2025-02-01 00:09:54.758 +03:00 [INF] Application is shutting down...
2025-02-01 00:10:06.177 +03:00 [INF] Starting web application
2025-02-01 00:10:06.289 +03:00 [INF] Now listening on: http://localhost:5264
2025-02-01 00:10:06.296 +03:00 [INF] Application started. Press Ctrl+C to shut down.
2025-02-01 00:10:06.297 +03:00 [INF] Hosting environment: Development
2025-02-01 00:10:06.298 +03:00 [INF] Content root path: C:\Users\yamta\StudioProjects\nayifat_app_2025_new\NayifatAPI
2025-02-01 00:10:52.485 +03:00 [INF] Request starting HTTP/1.1 POST http://localhost:5264/api/notifications/send - application/json 298
2025-02-01 00:10:52.551 +03:00 [WRN] Failed to determine the https port for redirect.
2025-02-01 00:10:52.557 +03:00 [INF] Executing endpoint 'NayifatAPI.Controllers.NotificationsController.SendNotification (NayifatAPI)'
2025-02-01 00:10:52.588 +03:00 [INF] Route matched with {action = "SendNotification", controller = "Notifications"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] SendNotification(NayifatAPI.Controllers.SendNotificationRequest) on controller NayifatAPI.Controllers.NotificationsController (NayifatAPI).
2025-02-01 00:10:54.495 +03:00 [INF] Executed DbCommand (36ms) [Parameters=[@__providedApiKey_0='?' (Size = 255)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [a].[Key], [a].[CreatedAt], [a].[Description], [a].[ExpiresAt], [a].[IsActive], [a].[LastUsedAt]
FROM [ApiKeys] AS [a]
WHERE [a].[Key] = @__providedApiKey_0 AND [a].[IsActive] = CAST(1 AS bit)
2025-02-01 00:10:54.604 +03:00 [INF] Received notification request: {"Title":null,"TitleEn":"Test Notification","TitleAr":"إشعار تجريبي","Filters":{"Customers.SalaryCustomer":{"ValueKind":"Object","$type":"JsonElement"}},"NationalId":null,"NationalIds":null}
2025-02-01 00:10:54.632 +03:00 [INF] Starting GetTargetUsers with request type: Filtered Users
2025-02-01 00:10:54.652 +03:00 [INF] Applied SalaryCustomer BETWEEN filter: 5000 AND 15000
2025-02-01 00:10:54.657 +03:00 [WRN] No valid filters were applied
2025-02-01 00:10:54.658 +03:00 [INF] Target users query completed. Found 0 users
2025-02-01 00:10:54.662 +03:00 [WRN] No target users found. Filters: {"Customers.SalaryCustomer":{"ValueKind":"Object","$type":"JsonElement"}}
2025-02-01 00:10:54.672 +03:00 [INF] Executing ObjectResult, writing value of type '<>f__AnonymousType11`2[[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-02-01 00:10:54.703 +03:00 [INF] Executed action NayifatAPI.Controllers.NotificationsController.SendNotification (NayifatAPI) in 2106.0506ms
2025-02-01 00:10:54.707 +03:00 [INF] Executed endpoint 'NayifatAPI.Controllers.NotificationsController.SendNotification (NayifatAPI)'
2025-02-01 00:10:54.730 +03:00 [INF] Request finished HTTP/1.1 POST http://localhost:5264/api/notifications/send - 400 null application/json; charset=utf-8 2244.7171ms
2025-02-01 00:12:41.662 +03:00 [INF] Application is shutting down...
2025-02-01 00:14:49.149 +03:00 [INF] Starting web application
2025-02-01 00:14:49.278 +03:00 [INF] Now listening on: http://localhost:5264
2025-02-01 00:14:49.287 +03:00 [INF] Application started. Press Ctrl+C to shut down.
2025-02-01 00:14:49.289 +03:00 [INF] Hosting environment: Development
2025-02-01 00:14:49.291 +03:00 [INF] Content root path: C:\Users\yamta\StudioProjects\nayifat_app_2025_new\NayifatAPI
2025-02-01 00:15:29.040 +03:00 [INF] Request starting HTTP/1.1 POST http://localhost:5264/api/notifications/send - application/json 298
2025-02-01 00:15:29.089 +03:00 [WRN] Failed to determine the https port for redirect.
2025-02-01 00:15:29.100 +03:00 [INF] Executing endpoint 'NayifatAPI.Controllers.NotificationsController.SendNotification (NayifatAPI)'
2025-02-01 00:15:29.123 +03:00 [INF] Route matched with {action = "SendNotification", controller = "Notifications"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] SendNotification(NayifatAPI.Controllers.SendNotificationRequest) on controller NayifatAPI.Controllers.NotificationsController (NayifatAPI).
2025-02-01 00:15:30.623 +03:00 [INF] Executed DbCommand (31ms) [Parameters=[@__providedApiKey_0='?' (Size = 255)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [a].[Key], [a].[CreatedAt], [a].[Description], [a].[ExpiresAt], [a].[IsActive], [a].[LastUsedAt]
FROM [ApiKeys] AS [a]
WHERE [a].[Key] = @__providedApiKey_0 AND [a].[IsActive] = CAST(1 AS bit)
2025-02-01 00:15:30.709 +03:00 [INF] Received notification request: {"Title":null,"TitleEn":"Test Notification","TitleAr":"إشعار تجريبي","Filters":{"Customers.SalaryCustomer":{"ValueKind":"Object","$type":"JsonElement"}},"NationalId":null,"NationalIds":null}
2025-02-01 00:15:30.724 +03:00 [INF] Starting GetTargetUsers with request type: Filtered Users
2025-02-01 00:15:30.736 +03:00 [INF] Applied SalaryCustomer BETWEEN filter: 5000 AND 15000
2025-02-01 00:15:30.740 +03:00 [INF] Added filter group for field SalaryCustomer
2025-02-01 00:15:30.741 +03:00 [INF] Executing filter query with operation: AND
2025-02-01 00:15:30.806 +03:00 [INF] Executed DbCommand (14ms) [Parameters=[@__value_0='?' (Precision = 18) (Scale = 2) (DbType = Decimal), @__value2_Value_1='?' (Precision = 18) (Scale = 2) (DbType = Decimal)], CommandType='"Text"', CommandTimeout='30']
SELECT [c].[NationalId]
FROM [Customers] AS [c]
WHERE [c].[SalaryCustomer] >= @__value_0 AND [c].[SalaryCustomer] <= @__value2_Value_1
2025-02-01 00:15:30.818 +03:00 [INF] Found 3 users after applying filters
2025-02-01 00:15:30.819 +03:00 [INF] Target users query completed. Found 3 users
2025-02-01 00:15:30.820 +03:00 [INF] Found 3 target users for notification
2025-02-01 00:15:30.992 +03:00 [INF] Executed DbCommand (11ms) [Parameters=[@p0='?' (Size = 4000), @p1='?' (Size = 8000) (DbType = AnsiString), @p2='?' (Size = 8000) (DbType = AnsiString), @p3='?' (Size = 8000) (DbType = AnsiString), @p4='?' (DbType = DateTime2), @p5='?' (DbType = DateTime2), @p6='?' (Size = 255), @p7='?' (Size = 4000), @p8='?' (Size = 255), @p9='?' (Size = 255), @p10='?' (Size = 255)], CommandType='"Text"', CommandTimeout='30']
SET IMPLICIT_TRANSACTIONS OFF;
SET NOCOUNT ON;
INSERT INTO [notification_templates] ([additional_data], [Body], [body_ar], [body_en], [created_at], [expiry_at], [Route], [target_criteria], [Title], [title_ar], [title_en])
OUTPUT INSERTED.[Id]
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7, @p8, @p9, @p10);
2025-02-01 00:15:31.026 +03:00 [INF] Created notification template with ID: 1
2025-02-01 00:15:31.088 +03:00 [INF] Executed DbCommand (12ms) [Parameters=[@p0='?' (Size = 4000), @p1='?' (DbType = DateTime2), @p2='?' (Size = 4000), @p3='?' (Size = 4000), @p4='?' (Size = 4000), @p5='?' (Size = 450), @p6='?' (Size = 4000), @p7='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SET IMPLICIT_TRANSACTIONS OFF;
SET NOCOUNT ON;
INSERT INTO [AuthLogs] ([AuthType], [CreatedAt], [DeviceId], [FailureReason], [IpAddress], [NationalId], [Status], [UserAgent])
OUTPUT INSERTED.[Id]
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7);
2025-02-01 00:15:31.109 +03:00 [INF] Executed DbCommand (3ms) [Parameters=[@__userId_0='?' (Size = 450)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [u].[national_id], [u].[last_updated], [u].[notifications]
FROM [user_notifications] AS [u]
WHERE [u].[national_id] = @__userId_0
2025-02-01 00:15:31.116 +03:00 [INF] Processing notification for user 1012345678. Existing notification record: false
2025-02-01 00:15:31.117 +03:00 [INF] Current notifications count for user 1012345678: 0
2025-02-01 00:15:31.129 +03:00 [INF] Serialized new notifications for user 1012345678. Length: 140
2025-02-01 00:15:31.156 +03:00 [INF] Executed DbCommand (17ms) [Parameters=[@p0='?' (Size = 4000), @p1='?' (Size = 4000), @p2='?' (DbType = DateTime2)], CommandType='"Text"', CommandTimeout='30']
INSERT INTO user_notifications (national_id, notifications, last_updated) VALUES (@p0, @p1, @p2)
2025-02-01 00:15:31.158 +03:00 [INF] Created new UserNotification entry for user: 1012345678
2025-02-01 00:15:31.165 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@__userId_0='?' (Size = 450)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [u].[national_id], [u].[last_updated], [u].[notifications]
FROM [user_notifications] AS [u]
WHERE [u].[national_id] = @__userId_0
2025-02-01 00:15:31.168 +03:00 [INF] Processing notification for user 1023456789. Existing notification record: false
2025-02-01 00:15:31.169 +03:00 [INF] Current notifications count for user 1023456789: 0
2025-02-01 00:15:31.170 +03:00 [INF] Serialized new notifications for user 1023456789. Length: 140
2025-02-01 00:15:31.172 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@p0='?' (Size = 4000), @p1='?' (Size = 4000), @p2='?' (DbType = DateTime2)], CommandType='"Text"', CommandTimeout='30']
INSERT INTO user_notifications (national_id, notifications, last_updated) VALUES (@p0, @p1, @p2)
2025-02-01 00:15:31.174 +03:00 [INF] Created new UserNotification entry for user: 1023456789
2025-02-01 00:15:31.175 +03:00 [INF] Executed DbCommand (0ms) [Parameters=[@__userId_0='?' (Size = 450)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [u].[national_id], [u].[last_updated], [u].[notifications]
FROM [user_notifications] AS [u]
WHERE [u].[national_id] = @__userId_0
2025-02-01 00:15:31.181 +03:00 [INF] Processing notification for user 1045678901. Existing notification record: false
2025-02-01 00:15:31.182 +03:00 [INF] Current notifications count for user 1045678901: 0
2025-02-01 00:15:31.183 +03:00 [INF] Serialized new notifications for user 1045678901. Length: 140
2025-02-01 00:15:31.185 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@p0='?' (Size = 4000), @p1='?' (Size = 4000), @p2='?' (DbType = DateTime2)], CommandType='"Text"', CommandTimeout='30']
INSERT INTO user_notifications (national_id, notifications, last_updated) VALUES (@p0, @p1, @p2)
2025-02-01 00:15:31.186 +03:00 [INF] Created new UserNotification entry for user: 1045678901
2025-02-01 00:15:31.190 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@p0='?' (Size = 4000), @p1='?' (DbType = DateTime2), @p2='?' (Size = 4000), @p3='?' (Size = 4000), @p4='?' (Size = 4000), @p5='?' (Size = 450), @p6='?' (Size = 4000), @p7='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SET IMPLICIT_TRANSACTIONS OFF;
SET NOCOUNT ON;
INSERT INTO [AuthLogs] ([AuthType], [CreatedAt], [DeviceId], [FailureReason], [IpAddress], [NationalId], [Status], [UserAgent])
OUTPUT INSERTED.[Id]
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7);
2025-02-01 00:15:31.192 +03:00 [INF] Successfully sent notifications. Template: 1, Success: 3, Total: 3
2025-02-01 00:15:31.202 +03:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType9`2[[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Object, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-02-01 00:15:31.220 +03:00 [INF] Executed action NayifatAPI.Controllers.NotificationsController.SendNotification (NayifatAPI) in 2088.9213ms
2025-02-01 00:15:31.222 +03:00 [INF] Executed endpoint 'NayifatAPI.Controllers.NotificationsController.SendNotification (NayifatAPI)'
2025-02-01 00:15:31.237 +03:00 [INF] Request finished HTTP/1.1 POST http://localhost:5264/api/notifications/send - 200 null application/json; charset=utf-8 2197.7294ms
2025-02-01 00:16:41.028 +03:00 [INF] Request starting HTTP/1.1 POST http://localhost:5264/api/notifications/send - application/json 275
2025-02-01 00:16:41.035 +03:00 [INF] Executing endpoint 'NayifatAPI.Controllers.NotificationsController.SendNotification (NayifatAPI)'
2025-02-01 00:16:41.056 +03:00 [INF] Route matched with {action = "SendNotification", controller = "Notifications"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] SendNotification(NayifatAPI.Controllers.SendNotificationRequest) on controller NayifatAPI.Controllers.NotificationsController (NayifatAPI).
2025-02-01 00:16:41.131 +03:00 [INF] Executed DbCommand (14ms) [Parameters=[@__providedApiKey_0='?' (Size = 255)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [a].[Key], [a].[CreatedAt], [a].[Description], [a].[ExpiresAt], [a].[IsActive], [a].[LastUsedAt]
FROM [ApiKeys] AS [a]
WHERE [a].[Key] = @__providedApiKey_0 AND [a].[IsActive] = CAST(1 AS bit)
2025-02-01 00:16:41.135 +03:00 [INF] Received notification request: {"Title":null,"TitleEn":"Test Notification","TitleAr":"إشعار تجريبي","Filters":{"Customers.Ciy":{"ValueKind":"Object","$type":"JsonElement"}},"NationalId":null,"NationalIds":null}
2025-02-01 00:16:41.143 +03:00 [INF] Starting GetTargetUsers with request type: Filtered Users
2025-02-01 00:16:41.145 +03:00 [INF] Processing filter: Ciy LIKE Ri
2025-02-01 00:16:41.147 +03:00 [WRN] Unknown field name in filter: Ciy
2025-02-01 00:16:41.149 +03:00 [WRN] No valid filters were applied
2025-02-01 00:16:41.151 +03:00 [INF] Target users query completed. Found 0 users
2025-02-01 00:16:41.153 +03:00 [WRN] No target users found. Filters: {"Customers.Ciy":{"ValueKind":"Object","$type":"JsonElement"}}
2025-02-01 00:16:41.159 +03:00 [INF] Executing ObjectResult, writing value of type '<>f__AnonymousType11`2[[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-02-01 00:16:41.201 +03:00 [INF] Executed action NayifatAPI.Controllers.NotificationsController.SendNotification (NayifatAPI) in 142.1569ms
2025-02-01 00:16:41.408 +03:00 [INF] Executed endpoint 'NayifatAPI.Controllers.NotificationsController.SendNotification (NayifatAPI)'
2025-02-01 00:16:41.413 +03:00 [INF] Request finished HTTP/1.1 POST http://localhost:5264/api/notifications/send - 400 null application/json; charset=utf-8 385.2469ms
2025-02-01 00:16:48.954 +03:00 [INF] Request starting HTTP/1.1 POST http://localhost:5264/api/notifications/send - application/json 276
2025-02-01 00:16:48.956 +03:00 [INF] Executing endpoint 'NayifatAPI.Controllers.NotificationsController.SendNotification (NayifatAPI)'
2025-02-01 00:16:48.957 +03:00 [INF] Route matched with {action = "SendNotification", controller = "Notifications"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] SendNotification(NayifatAPI.Controllers.SendNotificationRequest) on controller NayifatAPI.Controllers.NotificationsController (NayifatAPI).
2025-02-01 00:16:49.032 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@__providedApiKey_0='?' (Size = 255)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [a].[Key], [a].[CreatedAt], [a].[Description], [a].[ExpiresAt], [a].[IsActive], [a].[LastUsedAt]
FROM [ApiKeys] AS [a]
WHERE [a].[Key] = @__providedApiKey_0 AND [a].[IsActive] = CAST(1 AS bit)
2025-02-01 00:16:49.034 +03:00 [INF] Received notification request: {"Title":null,"TitleEn":"Test Notification","TitleAr":"إشعار تجريبي","Filters":{"Customers.City":{"ValueKind":"Object","$type":"JsonElement"}},"NationalId":null,"NationalIds":null}
2025-02-01 00:16:49.038 +03:00 [INF] Starting GetTargetUsers with request type: Filtered Users
2025-02-01 00:16:49.039 +03:00 [INF] Processing filter: City LIKE Ri
2025-02-01 00:16:49.043 +03:00 [INF] Applied City filter: LIKE Ri
2025-02-01 00:16:49.044 +03:00 [INF] Added filter group for customers.City
2025-02-01 00:16:49.045 +03:00 [INF] Executing filter query with operation: AND
2025-02-01 00:16:49.083 +03:00 [INF] Executed DbCommand (2ms) [Parameters=[@__Format_1='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SELECT [c].[NationalId]
FROM [Customers] AS [c]
WHERE [c].[City] LIKE @__Format_1
2025-02-01 00:16:49.086 +03:00 [INF] Found 2 users after applying filters
2025-02-01 00:16:49.087 +03:00 [INF] Target users query completed. Found 2 users
2025-02-01 00:16:49.088 +03:00 [INF] Found 2 target users for notification
2025-02-01 00:16:49.169 +03:00 [INF] Executed DbCommand (79ms) [Parameters=[@p0='?' (Size = 4000), @p1='?' (Size = 8000) (DbType = AnsiString), @p2='?' (Size = 8000) (DbType = AnsiString), @p3='?' (Size = 8000) (DbType = AnsiString), @p4='?' (DbType = DateTime2), @p5='?' (DbType = DateTime2), @p6='?' (Size = 255), @p7='?' (Size = 4000), @p8='?' (Size = 255), @p9='?' (Size = 255), @p10='?' (Size = 255)], CommandType='"Text"', CommandTimeout='30']
SET IMPLICIT_TRANSACTIONS OFF;
SET NOCOUNT ON;
INSERT INTO [notification_templates] ([additional_data], [Body], [body_ar], [body_en], [created_at], [expiry_at], [Route], [target_criteria], [Title], [title_ar], [title_en])
OUTPUT INSERTED.[Id]
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7, @p8, @p9, @p10);
2025-02-01 00:16:49.172 +03:00 [INF] Created notification template with ID: 2
2025-02-01 00:16:49.177 +03:00 [INF] Executed DbCommand (3ms) [Parameters=[@p0='?' (Size = 4000), @p1='?' (DbType = DateTime2), @p2='?' (Size = 4000), @p3='?' (Size = 4000), @p4='?' (Size = 4000), @p5='?' (Size = 450), @p6='?' (Size = 4000), @p7='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SET IMPLICIT_TRANSACTIONS OFF;
SET NOCOUNT ON;
INSERT INTO [AuthLogs] ([AuthType], [CreatedAt], [DeviceId], [FailureReason], [IpAddress], [NationalId], [Status], [UserAgent])
OUTPUT INSERTED.[Id]
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7);
2025-02-01 00:16:49.181 +03:00 [INF] Executed DbCommand (2ms) [Parameters=[@__userId_0='?' (Size = 450)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [u].[national_id], [u].[last_updated], [u].[notifications]
FROM [user_notifications] AS [u]
WHERE [u].[national_id] = @__userId_0
2025-02-01 00:16:49.193 +03:00 [INF] Processing notification for user 1012345678. Existing notification record: true
2025-02-01 00:16:49.195 +03:00 [INF] Current notifications count for user 1012345678: 1
2025-02-01 00:16:49.196 +03:00 [INF] Serialized new notifications for user 1012345678. Length: 279
2025-02-01 00:16:49.203 +03:00 [INF] Executed DbCommand (5ms) [Parameters=[@p0='?' (Size = 4000), @p1='?' (DbType = DateTime2), @p2='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
UPDATE user_notifications SET notifications = @p0, last_updated = @p1 WHERE national_id = @p2
2025-02-01 00:16:49.206 +03:00 [INF] Updated existing UserNotification for user: 1012345678
2025-02-01 00:16:49.207 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@__userId_0='?' (Size = 450)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [u].[national_id], [u].[last_updated], [u].[notifications]
FROM [user_notifications] AS [u]
WHERE [u].[national_id] = @__userId_0
2025-02-01 00:16:49.210 +03:00 [INF] Processing notification for user 1045678901. Existing notification record: true
2025-02-01 00:16:49.210 +03:00 [INF] Current notifications count for user 1045678901: 1
2025-02-01 00:16:49.211 +03:00 [INF] Serialized new notifications for user 1045678901. Length: 279
2025-02-01 00:16:49.214 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@p0='?' (Size = 4000), @p1='?' (DbType = DateTime2), @p2='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
UPDATE user_notifications SET notifications = @p0, last_updated = @p1 WHERE national_id = @p2
2025-02-01 00:16:49.217 +03:00 [INF] Updated existing UserNotification for user: 1045678901
2025-02-01 00:16:49.230 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@p0='?' (Size = 4000), @p1='?' (DbType = DateTime2), @p2='?' (Size = 4000), @p3='?' (Size = 4000), @p4='?' (Size = 4000), @p5='?' (Size = 450), @p6='?' (Size = 4000), @p7='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SET IMPLICIT_TRANSACTIONS OFF;
SET NOCOUNT ON;
INSERT INTO [AuthLogs] ([AuthType], [CreatedAt], [DeviceId], [FailureReason], [IpAddress], [NationalId], [Status], [UserAgent])
OUTPUT INSERTED.[Id]
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7);
2025-02-01 00:16:49.234 +03:00 [INF] Successfully sent notifications. Template: 2, Success: 2, Total: 2
2025-02-01 00:16:49.236 +03:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType9`2[[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Object, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-02-01 00:16:49.238 +03:00 [INF] Executed action NayifatAPI.Controllers.NotificationsController.SendNotification (NayifatAPI) in 279.7192ms
2025-02-01 00:16:49.243 +03:00 [INF] Executed endpoint 'NayifatAPI.Controllers.NotificationsController.SendNotification (NayifatAPI)'
2025-02-01 00:16:49.245 +03:00 [INF] Request finished HTTP/1.1 POST http://localhost:5264/api/notifications/send - 200 null application/json; charset=utf-8 291.7144ms
2025-02-01 00:18:03.221 +03:00 [INF] Request starting HTTP/1.1 POST http://localhost:5264/api/notifications/send - application/json 380
2025-02-01 00:18:03.224 +03:00 [INF] Executing endpoint 'NayifatAPI.Controllers.NotificationsController.SendNotification (NayifatAPI)'
2025-02-01 00:18:03.225 +03:00 [INF] Route matched with {action = "SendNotification", controller = "Notifications"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] SendNotification(NayifatAPI.Controllers.SendNotificationRequest) on controller NayifatAPI.Controllers.NotificationsController (NayifatAPI).
2025-02-01 00:18:03.231 +03:00 [INF] Executed DbCommand (2ms) [Parameters=[@__providedApiKey_0='?' (Size = 255)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [a].[Key], [a].[CreatedAt], [a].[Description], [a].[ExpiresAt], [a].[IsActive], [a].[LastUsedAt]
FROM [ApiKeys] AS [a]
WHERE [a].[Key] = @__providedApiKey_0 AND [a].[IsActive] = CAST(1 AS bit)
2025-02-01 00:18:03.233 +03:00 [INF] Received notification request: {"Title":null,"TitleEn":"Test Notification","TitleAr":"إشعار تجريبي","Filters":{"Customers.SalaryCustomer":{"ValueKind":"Object","$type":"JsonElement"},"Customers.City":{"ValueKind":"Object","$type":"JsonElement"}},"NationalId":null,"NationalIds":null}
2025-02-01 00:18:03.239 +03:00 [INF] Starting GetTargetUsers with request type: Filtered Users
2025-02-01 00:18:03.240 +03:00 [INF] Applied SalaryCustomer BETWEEN filter: 5000 AND 10000
2025-02-01 00:18:03.240 +03:00 [INF] Added filter group for field SalaryCustomer
2025-02-01 00:18:03.242 +03:00 [INF] Processing filter: City LIKE Riy
2025-02-01 00:18:03.244 +03:00 [INF] Applied City filter: LIKE Riy
2025-02-01 00:18:03.245 +03:00 [INF] Added filter group for customers.City
2025-02-01 00:18:03.250 +03:00 [INF] Executing filter query with operation: AND
2025-02-01 00:18:03.378 +03:00 [ERR] Failed executing DbCommand (83ms) [Parameters=[@__value_0='?' (Precision = 18) (Scale = 2) (DbType = Decimal), @__value2_Value_1='?' (Precision = 18) (Scale = 2) (DbType = Decimal), @__Format_3='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SELECT [t].[NationalId]
FROM (
    SELECT [c].[NationalId], [c].[AddNo], [c].[BuildingNo], [c].[City], [c].[Consent], [c].[ConsentDate], [c].[DateOfBirth], [c].[Dependents], [c].[District], [c].[Email], [c].[Employer], [c].[EmployerName], [c].[EmploymentStatus], [c].[FamilyNameAr], [c].[FamilyNameEn], [c].[FirstNameAr], [c].[FirstNameEn], [c].[Iban], [c].[IdExpiryDate], [c].[Language], [c].[Los], [c].[Mpin], [c].[MpinEnabled], [c].[NafathStatus], [c].[NafathTimestamp], [c].[Password], [c].[Phone], [c].[RegistrationDate], [c].[Salary], [c].[SalaryCustomer], [c].[SalaryDakhli], [c].[SecondNameAr], [c].[SecondNameEn], [c].[Sector], [c].[Street], [c].[ThirdNameAr], [c].[ThirdNameEn], [c].[Zipcode]
    FROM [Customers] AS [c]
    WHERE [c].[SalaryCustomer] >= @__value_0 AND [c].[SalaryCustomer] <= @__value2_Value_1
    INTERSECT
    SELECT [c0].[NationalId], [c0].[AddNo], [c0].[BuildingNo], [c0].[City], [c0].[Consent], [c0].[ConsentDate], [c0].[DateOfBirth], [c0].[Dependents], [c0].[District], [c0].[Email], [c0].[Employer], [c0].[EmployerName], [c0].[EmploymentStatus], [c0].[FamilyNameAr], [c0].[FamilyNameEn], [c0].[FirstNameAr], [c0].[FirstNameEn], [c0].[Iban], [c0].[IdExpiryDate], [c0].[Language], [c0].[Los], [c0].[Mpin], [c0].[MpinEnabled], [c0].[NafathStatus], [c0].[NafathTimestamp], [c0].[Password], [c0].[Phone], [c0].[RegistrationDate], [c0].[Salary], [c0].[SalaryCustomer], [c0].[SalaryDakhli], [c0].[SecondNameAr], [c0].[SecondNameEn], [c0].[Sector], [c0].[Street], [c0].[ThirdNameAr], [c0].[ThirdNameEn], [c0].[Zipcode]
    FROM [Customers] AS [c0]
    WHERE [c0].[City] LIKE @__Format_3
) AS [t]
2025-02-01 00:18:03.421 +03:00 [ERR] An exception occurred while iterating over the results of a query for context type 'NayifatAPI.Data.ApplicationDbContext'.
Microsoft.Data.SqlClient.SqlException (0x80131904): Invalid column name 'EmployerName'.
Invalid column name 'EmploymentStatus'.
Invalid column name 'Language'.
Invalid column name 'Salary'.
Invalid column name 'EmployerName'.
Invalid column name 'EmploymentStatus'.
Invalid column name 'Language'.
Invalid column name 'Salary'.
   at Microsoft.Data.SqlClient.SqlCommand.<>c.<ExecuteDbDataReaderAsync>b__209_0(Task`1 result)
   at System.Threading.Tasks.ContinuationResultTaskFromResultTask`2.InnerInvoke()
   at System.Threading.ExecutionContext.RunInternal(ExecutionContext executionContext, ContextCallback callback, Object state)
--- End of stack trace from previous location ---
   at System.Threading.ExecutionContext.RunInternal(ExecutionContext executionContext, ContextCallback callback, Object state)
   at System.Threading.Tasks.Task.ExecuteWithThreadLocal(Task& currentTaskSlot, Thread threadPoolThread)
--- End of stack trace from previous location ---
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Query.Internal.SingleQueryingEnumerable`1.AsyncEnumerator.InitializeReaderAsync(AsyncEnumerator enumerator, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Storage.Internal.SqlServerExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Query.Internal.SingleQueryingEnumerable`1.AsyncEnumerator.MoveNextAsync()
ClientConnectionId:83cdeb88-0860-40d7-9749-15ea8f5f188d
Error Number:207,State:1,Class:16
Microsoft.Data.SqlClient.SqlException (0x80131904): Invalid column name 'EmployerName'.
Invalid column name 'EmploymentStatus'.
Invalid column name 'Language'.
Invalid column name 'Salary'.
Invalid column name 'EmployerName'.
Invalid column name 'EmploymentStatus'.
Invalid column name 'Language'.
Invalid column name 'Salary'.
   at Microsoft.Data.SqlClient.SqlCommand.<>c.<ExecuteDbDataReaderAsync>b__209_0(Task`1 result)
   at System.Threading.Tasks.ContinuationResultTaskFromResultTask`2.InnerInvoke()
   at System.Threading.ExecutionContext.RunInternal(ExecutionContext executionContext, ContextCallback callback, Object state)
--- End of stack trace from previous location ---
   at System.Threading.ExecutionContext.RunInternal(ExecutionContext executionContext, ContextCallback callback, Object state)
   at System.Threading.Tasks.Task.ExecuteWithThreadLocal(Task& currentTaskSlot, Thread threadPoolThread)
--- End of stack trace from previous location ---
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Query.Internal.SingleQueryingEnumerable`1.AsyncEnumerator.InitializeReaderAsync(AsyncEnumerator enumerator, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Storage.Internal.SqlServerExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Query.Internal.SingleQueryingEnumerable`1.AsyncEnumerator.MoveNextAsync()
ClientConnectionId:83cdeb88-0860-40d7-9749-15ea8f5f188d
Error Number:207,State:1,Class:16
2025-02-01 00:18:03.436 +03:00 [ERR] Error in SendNotification
Microsoft.Data.SqlClient.SqlException (0x80131904): Invalid column name 'EmployerName'.
Invalid column name 'EmploymentStatus'.
Invalid column name 'Language'.
Invalid column name 'Salary'.
Invalid column name 'EmployerName'.
Invalid column name 'EmploymentStatus'.
Invalid column name 'Language'.
Invalid column name 'Salary'.
   at Microsoft.Data.SqlClient.SqlCommand.<>c.<ExecuteDbDataReaderAsync>b__209_0(Task`1 result)
   at System.Threading.Tasks.ContinuationResultTaskFromResultTask`2.InnerInvoke()
   at System.Threading.ExecutionContext.RunInternal(ExecutionContext executionContext, ContextCallback callback, Object state)
--- End of stack trace from previous location ---
   at System.Threading.ExecutionContext.RunInternal(ExecutionContext executionContext, ContextCallback callback, Object state)
   at System.Threading.Tasks.Task.ExecuteWithThreadLocal(Task& currentTaskSlot, Thread threadPoolThread)
--- End of stack trace from previous location ---
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Query.Internal.SingleQueryingEnumerable`1.AsyncEnumerator.InitializeReaderAsync(AsyncEnumerator enumerator, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Storage.Internal.SqlServerExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Query.Internal.SingleQueryingEnumerable`1.AsyncEnumerator.MoveNextAsync()
   at Microsoft.EntityFrameworkCore.EntityFrameworkQueryableExtensions.ToListAsync[TSource](IQueryable`1 source, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.EntityFrameworkQueryableExtensions.ToListAsync[TSource](IQueryable`1 source, CancellationToken cancellationToken)
   at NayifatAPI.Controllers.NotificationsController.GetTargetUsers(SendNotificationRequest request) in C:\Users\yamta\StudioProjects\nayifat_app_2025_new\NayifatAPI\Controllers\NotificationsController.cs:line 894
   at NayifatAPI.Controllers.NotificationsController.SendNotification(SendNotificationRequest request) in C:\Users\yamta\StudioProjects\nayifat_app_2025_new\NayifatAPI\Controllers\NotificationsController.cs:line 203
ClientConnectionId:83cdeb88-0860-40d7-9749-15ea8f5f188d
Error Number:207,State:1,Class:16
2025-02-01 00:18:03.467 +03:00 [INF] Executing ObjectResult, writing value of type '<>f__AnonymousType11`2[[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-02-01 00:18:03.469 +03:00 [INF] Executed action NayifatAPI.Controllers.NotificationsController.SendNotification (NayifatAPI) in 242.2422ms
2025-02-01 00:18:03.470 +03:00 [INF] Executed endpoint 'NayifatAPI.Controllers.NotificationsController.SendNotification (NayifatAPI)'
2025-02-01 00:18:03.471 +03:00 [INF] Request finished HTTP/1.1 POST http://localhost:5264/api/notifications/send - 500 null application/json; charset=utf-8 250.4235ms
2025-02-01 00:18:22.381 +03:00 [INF] Request starting HTTP/1.1 POST http://localhost:5264/api/notifications/send - application/json 380
2025-02-01 00:18:22.384 +03:00 [INF] Executing endpoint 'NayifatAPI.Controllers.NotificationsController.SendNotification (NayifatAPI)'
2025-02-01 00:18:22.385 +03:00 [INF] Route matched with {action = "SendNotification", controller = "Notifications"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] SendNotification(NayifatAPI.Controllers.SendNotificationRequest) on controller NayifatAPI.Controllers.NotificationsController (NayifatAPI).
2025-02-01 00:18:22.395 +03:00 [INF] Executed DbCommand (3ms) [Parameters=[@__providedApiKey_0='?' (Size = 255)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [a].[Key], [a].[CreatedAt], [a].[Description], [a].[ExpiresAt], [a].[IsActive], [a].[LastUsedAt]
FROM [ApiKeys] AS [a]
WHERE [a].[Key] = @__providedApiKey_0 AND [a].[IsActive] = CAST(1 AS bit)
2025-02-01 00:18:22.397 +03:00 [INF] Received notification request: {"Title":null,"TitleEn":"Test Notification","TitleAr":"إشعار تجريبي","Filters":{"Customers.SalaryCustomer":{"ValueKind":"Object","$type":"JsonElement"},"Customers.City":{"ValueKind":"Object","$type":"JsonElement"}},"NationalId":null,"NationalIds":null}
2025-02-01 00:18:22.405 +03:00 [INF] Starting GetTargetUsers with request type: Filtered Users
2025-02-01 00:18:22.406 +03:00 [INF] Applied SalaryCustomer BETWEEN filter: 5000 AND 10000
2025-02-01 00:18:22.407 +03:00 [INF] Added filter group for field SalaryCustomer
2025-02-01 00:18:22.408 +03:00 [INF] Processing filter: City LIKE Riy
2025-02-01 00:18:22.409 +03:00 [INF] Applied City filter: LIKE Riy
2025-02-01 00:18:22.410 +03:00 [INF] Added filter group for customers.City
2025-02-01 00:18:22.411 +03:00 [INF] Executing filter query with operation: AND
2025-02-01 00:18:22.417 +03:00 [ERR] Failed executing DbCommand (3ms) [Parameters=[@__value_0='?' (Precision = 18) (Scale = 2) (DbType = Decimal), @__value2_Value_1='?' (Precision = 18) (Scale = 2) (DbType = Decimal), @__Format_3='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SELECT [t].[NationalId]
FROM (
    SELECT [c].[NationalId], [c].[AddNo], [c].[BuildingNo], [c].[City], [c].[Consent], [c].[ConsentDate], [c].[DateOfBirth], [c].[Dependents], [c].[District], [c].[Email], [c].[Employer], [c].[EmployerName], [c].[EmploymentStatus], [c].[FamilyNameAr], [c].[FamilyNameEn], [c].[FirstNameAr], [c].[FirstNameEn], [c].[Iban], [c].[IdExpiryDate], [c].[Language], [c].[Los], [c].[Mpin], [c].[MpinEnabled], [c].[NafathStatus], [c].[NafathTimestamp], [c].[Password], [c].[Phone], [c].[RegistrationDate], [c].[Salary], [c].[SalaryCustomer], [c].[SalaryDakhli], [c].[SecondNameAr], [c].[SecondNameEn], [c].[Sector], [c].[Street], [c].[ThirdNameAr], [c].[ThirdNameEn], [c].[Zipcode]
    FROM [Customers] AS [c]
    WHERE [c].[SalaryCustomer] >= @__value_0 AND [c].[SalaryCustomer] <= @__value2_Value_1
    INTERSECT
    SELECT [c0].[NationalId], [c0].[AddNo], [c0].[BuildingNo], [c0].[City], [c0].[Consent], [c0].[ConsentDate], [c0].[DateOfBirth], [c0].[Dependents], [c0].[District], [c0].[Email], [c0].[Employer], [c0].[EmployerName], [c0].[EmploymentStatus], [c0].[FamilyNameAr], [c0].[FamilyNameEn], [c0].[FirstNameAr], [c0].[FirstNameEn], [c0].[Iban], [c0].[IdExpiryDate], [c0].[Language], [c0].[Los], [c0].[Mpin], [c0].[MpinEnabled], [c0].[NafathStatus], [c0].[NafathTimestamp], [c0].[Password], [c0].[Phone], [c0].[RegistrationDate], [c0].[Salary], [c0].[SalaryCustomer], [c0].[SalaryDakhli], [c0].[SecondNameAr], [c0].[SecondNameEn], [c0].[Sector], [c0].[Street], [c0].[ThirdNameAr], [c0].[ThirdNameEn], [c0].[Zipcode]
    FROM [Customers] AS [c0]
    WHERE [c0].[City] LIKE @__Format_3
) AS [t]
2025-02-01 00:18:22.426 +03:00 [ERR] An exception occurred while iterating over the results of a query for context type 'NayifatAPI.Data.ApplicationDbContext'.
Microsoft.Data.SqlClient.SqlException (0x80131904): Invalid column name 'EmployerName'.
Invalid column name 'EmploymentStatus'.
Invalid column name 'Language'.
Invalid column name 'Salary'.
Invalid column name 'EmployerName'.
Invalid column name 'EmploymentStatus'.
Invalid column name 'Language'.
Invalid column name 'Salary'.
   at Microsoft.Data.SqlClient.SqlCommand.<>c.<ExecuteDbDataReaderAsync>b__209_0(Task`1 result)
   at System.Threading.Tasks.ContinuationResultTaskFromResultTask`2.InnerInvoke()
   at System.Threading.ExecutionContext.RunInternal(ExecutionContext executionContext, ContextCallback callback, Object state)
--- End of stack trace from previous location ---
   at System.Threading.ExecutionContext.RunInternal(ExecutionContext executionContext, ContextCallback callback, Object state)
   at System.Threading.Tasks.Task.ExecuteWithThreadLocal(Task& currentTaskSlot, Thread threadPoolThread)
--- End of stack trace from previous location ---
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Query.Internal.SingleQueryingEnumerable`1.AsyncEnumerator.InitializeReaderAsync(AsyncEnumerator enumerator, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Storage.Internal.SqlServerExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Query.Internal.SingleQueryingEnumerable`1.AsyncEnumerator.MoveNextAsync()
ClientConnectionId:83cdeb88-0860-40d7-9749-15ea8f5f188d
Error Number:207,State:1,Class:16
Microsoft.Data.SqlClient.SqlException (0x80131904): Invalid column name 'EmployerName'.
Invalid column name 'EmploymentStatus'.
Invalid column name 'Language'.
Invalid column name 'Salary'.
Invalid column name 'EmployerName'.
Invalid column name 'EmploymentStatus'.
Invalid column name 'Language'.
Invalid column name 'Salary'.
   at Microsoft.Data.SqlClient.SqlCommand.<>c.<ExecuteDbDataReaderAsync>b__209_0(Task`1 result)
   at System.Threading.Tasks.ContinuationResultTaskFromResultTask`2.InnerInvoke()
   at System.Threading.ExecutionContext.RunInternal(ExecutionContext executionContext, ContextCallback callback, Object state)
--- End of stack trace from previous location ---
   at System.Threading.ExecutionContext.RunInternal(ExecutionContext executionContext, ContextCallback callback, Object state)
   at System.Threading.Tasks.Task.ExecuteWithThreadLocal(Task& currentTaskSlot, Thread threadPoolThread)
--- End of stack trace from previous location ---
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Query.Internal.SingleQueryingEnumerable`1.AsyncEnumerator.InitializeReaderAsync(AsyncEnumerator enumerator, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Storage.Internal.SqlServerExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Query.Internal.SingleQueryingEnumerable`1.AsyncEnumerator.MoveNextAsync()
ClientConnectionId:83cdeb88-0860-40d7-9749-15ea8f5f188d
Error Number:207,State:1,Class:16
2025-02-01 00:18:22.434 +03:00 [ERR] Error in SendNotification
Microsoft.Data.SqlClient.SqlException (0x80131904): Invalid column name 'EmployerName'.
Invalid column name 'EmploymentStatus'.
Invalid column name 'Language'.
Invalid column name 'Salary'.
Invalid column name 'EmployerName'.
Invalid column name 'EmploymentStatus'.
Invalid column name 'Language'.
Invalid column name 'Salary'.
   at Microsoft.Data.SqlClient.SqlCommand.<>c.<ExecuteDbDataReaderAsync>b__209_0(Task`1 result)
   at System.Threading.Tasks.ContinuationResultTaskFromResultTask`2.InnerInvoke()
   at System.Threading.ExecutionContext.RunInternal(ExecutionContext executionContext, ContextCallback callback, Object state)
--- End of stack trace from previous location ---
   at System.Threading.ExecutionContext.RunInternal(ExecutionContext executionContext, ContextCallback callback, Object state)
   at System.Threading.Tasks.Task.ExecuteWithThreadLocal(Task& currentTaskSlot, Thread threadPoolThread)
--- End of stack trace from previous location ---
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Query.Internal.SingleQueryingEnumerable`1.AsyncEnumerator.InitializeReaderAsync(AsyncEnumerator enumerator, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Storage.Internal.SqlServerExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Query.Internal.SingleQueryingEnumerable`1.AsyncEnumerator.MoveNextAsync()
   at Microsoft.EntityFrameworkCore.EntityFrameworkQueryableExtensions.ToListAsync[TSource](IQueryable`1 source, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.EntityFrameworkQueryableExtensions.ToListAsync[TSource](IQueryable`1 source, CancellationToken cancellationToken)
   at NayifatAPI.Controllers.NotificationsController.GetTargetUsers(SendNotificationRequest request) in C:\Users\yamta\StudioProjects\nayifat_app_2025_new\NayifatAPI\Controllers\NotificationsController.cs:line 894
   at NayifatAPI.Controllers.NotificationsController.SendNotification(SendNotificationRequest request) in C:\Users\yamta\StudioProjects\nayifat_app_2025_new\NayifatAPI\Controllers\NotificationsController.cs:line 203
ClientConnectionId:83cdeb88-0860-40d7-9749-15ea8f5f188d
Error Number:207,State:1,Class:16
2025-02-01 00:18:22.448 +03:00 [INF] Executing ObjectResult, writing value of type '<>f__AnonymousType11`2[[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-02-01 00:18:22.449 +03:00 [INF] Executed action NayifatAPI.Controllers.NotificationsController.SendNotification (NayifatAPI) in 59.3793ms
2025-02-01 00:18:22.450 +03:00 [INF] Executed endpoint 'NayifatAPI.Controllers.NotificationsController.SendNotification (NayifatAPI)'
2025-02-01 00:18:22.451 +03:00 [INF] Request finished HTTP/1.1 POST http://localhost:5264/api/notifications/send - 500 null application/json; charset=utf-8 69.7609ms
2025-02-01 00:19:40.727 +03:00 [INF] Application is shutting down...
2025-02-01 00:21:30.762 +03:00 [INF] Starting web application
2025-02-01 00:21:30.844 +03:00 [INF] Now listening on: http://localhost:5264
2025-02-01 00:21:30.848 +03:00 [INF] Application started. Press Ctrl+C to shut down.
2025-02-01 00:21:30.849 +03:00 [INF] Hosting environment: Development
2025-02-01 00:21:30.849 +03:00 [INF] Content root path: C:\Users\yamta\StudioProjects\nayifat_app_2025_new\NayifatAPI
2025-02-01 00:21:35.019 +03:00 [INF] Request starting HTTP/1.1 POST http://localhost:5264/api/notifications/send - application/json 380
2025-02-01 00:21:35.078 +03:00 [WRN] Failed to determine the https port for redirect.
2025-02-01 00:21:35.085 +03:00 [INF] Executing endpoint 'NayifatAPI.Controllers.NotificationsController.SendNotification (NayifatAPI)'
2025-02-01 00:21:35.112 +03:00 [INF] Route matched with {action = "SendNotification", controller = "Notifications"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] SendNotification(NayifatAPI.Controllers.SendNotificationRequest) on controller NayifatAPI.Controllers.NotificationsController (NayifatAPI).
2025-02-01 00:21:38.987 +03:00 [INF] Executed DbCommand (213ms) [Parameters=[@__providedApiKey_0='?' (Size = 255)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [a].[Key], [a].[CreatedAt], [a].[Description], [a].[ExpiresAt], [a].[IsActive], [a].[LastUsedAt]
FROM [ApiKeys] AS [a]
WHERE [a].[Key] = @__providedApiKey_0 AND [a].[IsActive] = CAST(1 AS bit)
2025-02-01 00:21:39.370 +03:00 [INF] Received notification request: {"Title":null,"TitleEn":"Test Notification","TitleAr":"إشعار تجريبي","Filters":{"Customers.SalaryCustomer":{"ValueKind":"Object","$type":"JsonElement"},"Customers.City":{"ValueKind":"Object","$type":"JsonElement"}},"NationalId":null,"NationalIds":null}
2025-02-01 00:21:39.403 +03:00 [INF] Starting GetTargetUsers with request type: Filtered Users
2025-02-01 00:21:39.433 +03:00 [INF] Applied SalaryCustomer BETWEEN filter: 5000 AND 10000
2025-02-01 00:21:39.437 +03:00 [INF] Added filter group for field SalaryCustomer
2025-02-01 00:21:39.440 +03:00 [INF] Processing filter: City LIKE Riy
2025-02-01 00:21:39.448 +03:00 [INF] Applied City filter: LIKE Riy
2025-02-01 00:21:39.450 +03:00 [INF] Added filter group for customers.City
2025-02-01 00:21:39.452 +03:00 [INF] Executing filter query with operation: AND
2025-02-01 00:21:39.615 +03:00 [ERR] Failed executing DbCommand (33ms) [Parameters=[@__value_0='?' (Precision = 18) (Scale = 2) (DbType = Decimal), @__value2_Value_1='?' (Precision = 18) (Scale = 2) (DbType = Decimal), @__Format_3='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SELECT [t].[NationalId]
FROM (
    SELECT [c].[NationalId], [c].[AddNo], [c].[BuildingNo], [c].[City], [c].[Consent], [c].[ConsentDate], [c].[DateOfBirth], [c].[Dependents], [c].[District], [c].[Email], [c].[Employer], [c].[EmployerName], [c].[EmploymentStatus], [c].[FamilyNameAr], [c].[FamilyNameEn], [c].[FirstNameAr], [c].[FirstNameEn], [c].[Iban], [c].[IdExpiryDate], [c].[Language], [c].[Los], [c].[Mpin], [c].[MpinEnabled], [c].[NafathStatus], [c].[NafathTimestamp], [c].[Password], [c].[Phone], [c].[RegistrationDate], [c].[Salary], [c].[SalaryCustomer], [c].[SalaryDakhli], [c].[SecondNameAr], [c].[SecondNameEn], [c].[Sector], [c].[Street], [c].[ThirdNameAr], [c].[ThirdNameEn], [c].[Zipcode]
    FROM [Customers] AS [c]
    WHERE [c].[SalaryCustomer] >= @__value_0 AND [c].[SalaryCustomer] <= @__value2_Value_1
    INTERSECT
    SELECT [c0].[NationalId], [c0].[AddNo], [c0].[BuildingNo], [c0].[City], [c0].[Consent], [c0].[ConsentDate], [c0].[DateOfBirth], [c0].[Dependents], [c0].[District], [c0].[Email], [c0].[Employer], [c0].[EmployerName], [c0].[EmploymentStatus], [c0].[FamilyNameAr], [c0].[FamilyNameEn], [c0].[FirstNameAr], [c0].[FirstNameEn], [c0].[Iban], [c0].[IdExpiryDate], [c0].[Language], [c0].[Los], [c0].[Mpin], [c0].[MpinEnabled], [c0].[NafathStatus], [c0].[NafathTimestamp], [c0].[Password], [c0].[Phone], [c0].[RegistrationDate], [c0].[Salary], [c0].[SalaryCustomer], [c0].[SalaryDakhli], [c0].[SecondNameAr], [c0].[SecondNameEn], [c0].[Sector], [c0].[Street], [c0].[ThirdNameAr], [c0].[ThirdNameEn], [c0].[Zipcode]
    FROM [Customers] AS [c0]
    WHERE [c0].[City] LIKE @__Format_3
) AS [t]
2025-02-01 00:21:39.666 +03:00 [ERR] An exception occurred while iterating over the results of a query for context type 'NayifatAPI.Data.ApplicationDbContext'.
Microsoft.Data.SqlClient.SqlException (0x80131904): Invalid column name 'EmployerName'.
Invalid column name 'EmploymentStatus'.
Invalid column name 'Language'.
Invalid column name 'Salary'.
Invalid column name 'EmployerName'.
Invalid column name 'EmploymentStatus'.
Invalid column name 'Language'.
Invalid column name 'Salary'.
   at Microsoft.Data.SqlClient.SqlCommand.<>c.<ExecuteDbDataReaderAsync>b__209_0(Task`1 result)
   at System.Threading.Tasks.ContinuationResultTaskFromResultTask`2.InnerInvoke()
   at System.Threading.ExecutionContext.RunInternal(ExecutionContext executionContext, ContextCallback callback, Object state)
--- End of stack trace from previous location ---
   at System.Threading.ExecutionContext.RunInternal(ExecutionContext executionContext, ContextCallback callback, Object state)
   at System.Threading.Tasks.Task.ExecuteWithThreadLocal(Task& currentTaskSlot, Thread threadPoolThread)
--- End of stack trace from previous location ---
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Query.Internal.SingleQueryingEnumerable`1.AsyncEnumerator.InitializeReaderAsync(AsyncEnumerator enumerator, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Storage.Internal.SqlServerExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Query.Internal.SingleQueryingEnumerable`1.AsyncEnumerator.MoveNextAsync()
ClientConnectionId:235ddd2f-cdfc-4107-bd62-3d0366f5515b
Error Number:207,State:1,Class:16
Microsoft.Data.SqlClient.SqlException (0x80131904): Invalid column name 'EmployerName'.
Invalid column name 'EmploymentStatus'.
Invalid column name 'Language'.
Invalid column name 'Salary'.
Invalid column name 'EmployerName'.
Invalid column name 'EmploymentStatus'.
Invalid column name 'Language'.
Invalid column name 'Salary'.
   at Microsoft.Data.SqlClient.SqlCommand.<>c.<ExecuteDbDataReaderAsync>b__209_0(Task`1 result)
   at System.Threading.Tasks.ContinuationResultTaskFromResultTask`2.InnerInvoke()
   at System.Threading.ExecutionContext.RunInternal(ExecutionContext executionContext, ContextCallback callback, Object state)
--- End of stack trace from previous location ---
   at System.Threading.ExecutionContext.RunInternal(ExecutionContext executionContext, ContextCallback callback, Object state)
   at System.Threading.Tasks.Task.ExecuteWithThreadLocal(Task& currentTaskSlot, Thread threadPoolThread)
--- End of stack trace from previous location ---
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Query.Internal.SingleQueryingEnumerable`1.AsyncEnumerator.InitializeReaderAsync(AsyncEnumerator enumerator, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Storage.Internal.SqlServerExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Query.Internal.SingleQueryingEnumerable`1.AsyncEnumerator.MoveNextAsync()
ClientConnectionId:235ddd2f-cdfc-4107-bd62-3d0366f5515b
Error Number:207,State:1,Class:16
2025-02-01 00:21:39.687 +03:00 [ERR] Error in SendNotification
Microsoft.Data.SqlClient.SqlException (0x80131904): Invalid column name 'EmployerName'.
Invalid column name 'EmploymentStatus'.
Invalid column name 'Language'.
Invalid column name 'Salary'.
Invalid column name 'EmployerName'.
Invalid column name 'EmploymentStatus'.
Invalid column name 'Language'.
Invalid column name 'Salary'.
   at Microsoft.Data.SqlClient.SqlCommand.<>c.<ExecuteDbDataReaderAsync>b__209_0(Task`1 result)
   at System.Threading.Tasks.ContinuationResultTaskFromResultTask`2.InnerInvoke()
   at System.Threading.ExecutionContext.RunInternal(ExecutionContext executionContext, ContextCallback callback, Object state)
--- End of stack trace from previous location ---
   at System.Threading.ExecutionContext.RunInternal(ExecutionContext executionContext, ContextCallback callback, Object state)
   at System.Threading.Tasks.Task.ExecuteWithThreadLocal(Task& currentTaskSlot, Thread threadPoolThread)
--- End of stack trace from previous location ---
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Query.Internal.SingleQueryingEnumerable`1.AsyncEnumerator.InitializeReaderAsync(AsyncEnumerator enumerator, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Storage.Internal.SqlServerExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Query.Internal.SingleQueryingEnumerable`1.AsyncEnumerator.MoveNextAsync()
   at Microsoft.EntityFrameworkCore.EntityFrameworkQueryableExtensions.ToListAsync[TSource](IQueryable`1 source, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.EntityFrameworkQueryableExtensions.ToListAsync[TSource](IQueryable`1 source, CancellationToken cancellationToken)
   at NayifatAPI.Controllers.NotificationsController.GetTargetUsers(SendNotificationRequest request) in C:\Users\yamta\StudioProjects\nayifat_app_2025_new\NayifatAPI\Controllers\NotificationsController.cs:line 894
   at NayifatAPI.Controllers.NotificationsController.SendNotification(SendNotificationRequest request) in C:\Users\yamta\StudioProjects\nayifat_app_2025_new\NayifatAPI\Controllers\NotificationsController.cs:line 203
ClientConnectionId:235ddd2f-cdfc-4107-bd62-3d0366f5515b
Error Number:207,State:1,Class:16
2025-02-01 00:21:39.732 +03:00 [INF] Executing ObjectResult, writing value of type '<>f__AnonymousType11`2[[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-02-01 00:21:39.752 +03:00 [INF] Executed action NayifatAPI.Controllers.NotificationsController.SendNotification (NayifatAPI) in 4633.2514ms
2025-02-01 00:21:39.755 +03:00 [INF] Executed endpoint 'NayifatAPI.Controllers.NotificationsController.SendNotification (NayifatAPI)'
2025-02-01 00:21:39.768 +03:00 [INF] Request finished HTTP/1.1 POST http://localhost:5264/api/notifications/send - 500 null application/json; charset=utf-8 4750.112ms
2025-02-01 00:22:04.193 +03:00 [INF] Request starting HTTP/1.1 POST http://localhost:5264/api/notifications/send - application/json 298
2025-02-01 00:22:04.201 +03:00 [INF] Executing endpoint 'NayifatAPI.Controllers.NotificationsController.SendNotification (NayifatAPI)'
2025-02-01 00:22:04.203 +03:00 [INF] Route matched with {action = "SendNotification", controller = "Notifications"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] SendNotification(NayifatAPI.Controllers.SendNotificationRequest) on controller NayifatAPI.Controllers.NotificationsController (NayifatAPI).
2025-02-01 00:22:04.246 +03:00 [INF] Executed DbCommand (3ms) [Parameters=[@__providedApiKey_0='?' (Size = 255)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [a].[Key], [a].[CreatedAt], [a].[Description], [a].[ExpiresAt], [a].[IsActive], [a].[LastUsedAt]
FROM [ApiKeys] AS [a]
WHERE [a].[Key] = @__providedApiKey_0 AND [a].[IsActive] = CAST(1 AS bit)
2025-02-01 00:22:04.258 +03:00 [INF] Received notification request: {"Title":null,"TitleEn":"Test Notification","TitleAr":"إشعار تجريبي","Filters":{"Customers.SalaryCustomer":{"ValueKind":"Object","$type":"JsonElement"}},"NationalId":null,"NationalIds":null}
2025-02-01 00:22:04.263 +03:00 [INF] Starting GetTargetUsers with request type: Filtered Users
2025-02-01 00:22:04.266 +03:00 [INF] Applied SalaryCustomer BETWEEN filter: 5000 AND 10000
2025-02-01 00:22:04.268 +03:00 [INF] Added filter group for field SalaryCustomer
2025-02-01 00:22:04.269 +03:00 [INF] Executing filter query with operation: AND
2025-02-01 00:22:04.282 +03:00 [INF] Executed DbCommand (3ms) [Parameters=[@__value_0='?' (Precision = 18) (Scale = 2) (DbType = Decimal), @__value2_Value_1='?' (Precision = 18) (Scale = 2) (DbType = Decimal)], CommandType='"Text"', CommandTimeout='30']
SELECT [c].[NationalId]
FROM [Customers] AS [c]
WHERE [c].[SalaryCustomer] >= @__value_0 AND [c].[SalaryCustomer] <= @__value2_Value_1
2025-02-01 00:22:04.298 +03:00 [INF] Found 1 users after applying filters
2025-02-01 00:22:04.302 +03:00 [INF] Target users query completed. Found 1 users
2025-02-01 00:22:04.304 +03:00 [INF] Found 1 target users for notification
2025-02-01 00:22:04.611 +03:00 [INF] Executed DbCommand (82ms) [Parameters=[@p0='?' (Size = 4000), @p1='?' (Size = 8000) (DbType = AnsiString), @p2='?' (Size = 8000) (DbType = AnsiString), @p3='?' (Size = 8000) (DbType = AnsiString), @p4='?' (DbType = DateTime2), @p5='?' (DbType = DateTime2), @p6='?' (Size = 255), @p7='?' (Size = 4000), @p8='?' (Size = 255), @p9='?' (Size = 255), @p10='?' (Size = 255)], CommandType='"Text"', CommandTimeout='30']
SET IMPLICIT_TRANSACTIONS OFF;
SET NOCOUNT ON;
INSERT INTO [notification_templates] ([additional_data], [Body], [body_ar], [body_en], [created_at], [expiry_at], [Route], [target_criteria], [Title], [title_ar], [title_en])
OUTPUT INSERTED.[Id]
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7, @p8, @p9, @p10);
2025-02-01 00:22:04.674 +03:00 [INF] Created notification template with ID: 1
2025-02-01 00:22:04.835 +03:00 [INF] Executed DbCommand (66ms) [Parameters=[@p0='?' (Size = 4000), @p1='?' (DbType = DateTime2), @p2='?' (Size = 4000), @p3='?' (Size = 4000), @p4='?' (Size = 4000), @p5='?' (Size = 450), @p6='?' (Size = 4000), @p7='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SET IMPLICIT_TRANSACTIONS OFF;
SET NOCOUNT ON;
INSERT INTO [AuthLogs] ([AuthType], [CreatedAt], [DeviceId], [FailureReason], [IpAddress], [NationalId], [Status], [UserAgent])
OUTPUT INSERTED.[Id]
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7);
2025-02-01 00:22:04.872 +03:00 [INF] Executed DbCommand (3ms) [Parameters=[@__userId_0='?' (Size = 450)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [u].[national_id], [u].[last_updated], [u].[notifications]
FROM [user_notifications] AS [u]
WHERE [u].[national_id] = @__userId_0
2025-02-01 00:22:04.879 +03:00 [INF] Processing notification for user 1045678901. Existing notification record: false
2025-02-01 00:22:04.881 +03:00 [INF] Current notifications count for user 1045678901: 0
2025-02-01 00:22:04.905 +03:00 [INF] Serialized new notifications for user 1045678901. Length: 140
2025-02-01 00:22:04.941 +03:00 [INF] Executed DbCommand (21ms) [Parameters=[@p0='?' (Size = 4000), @p1='?' (Size = 4000), @p2='?' (DbType = DateTime2)], CommandType='"Text"', CommandTimeout='30']
INSERT INTO user_notifications (national_id, notifications, last_updated) VALUES (@p0, @p1, @p2)
2025-02-01 00:22:04.944 +03:00 [INF] Created new UserNotification entry for user: 1045678901
2025-02-01 00:22:04.951 +03:00 [INF] Executed DbCommand (3ms) [Parameters=[@p0='?' (Size = 4000), @p1='?' (DbType = DateTime2), @p2='?' (Size = 4000), @p3='?' (Size = 4000), @p4='?' (Size = 4000), @p5='?' (Size = 450), @p6='?' (Size = 4000), @p7='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SET IMPLICIT_TRANSACTIONS OFF;
SET NOCOUNT ON;
INSERT INTO [AuthLogs] ([AuthType], [CreatedAt], [DeviceId], [FailureReason], [IpAddress], [NationalId], [Status], [UserAgent])
OUTPUT INSERTED.[Id]
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7);
2025-02-01 00:22:04.955 +03:00 [INF] Successfully sent notifications. Template: 1, Success: 1, Total: 1
2025-02-01 00:22:04.957 +03:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType9`2[[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Object, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-02-01 00:22:04.964 +03:00 [INF] Executed action NayifatAPI.Controllers.NotificationsController.SendNotification (NayifatAPI) in 759.1555ms
2025-02-01 00:22:04.969 +03:00 [INF] Executed endpoint 'NayifatAPI.Controllers.NotificationsController.SendNotification (NayifatAPI)'
2025-02-01 00:22:04.972 +03:00 [INF] Request finished HTTP/1.1 POST http://localhost:5264/api/notifications/send - 200 null application/json; charset=utf-8 778.4802ms
2025-02-01 00:22:25.349 +03:00 [INF] Request starting HTTP/1.1 POST http://localhost:5264/api/notifications/send - application/json 277
2025-02-01 00:22:25.508 +03:00 [INF] Executing endpoint 'NayifatAPI.Controllers.NotificationsController.SendNotification (NayifatAPI)'
2025-02-01 00:22:25.807 +03:00 [INF] Route matched with {action = "SendNotification", controller = "Notifications"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] SendNotification(NayifatAPI.Controllers.SendNotificationRequest) on controller NayifatAPI.Controllers.NotificationsController (NayifatAPI).
2025-02-01 00:22:26.177 +03:00 [INF] Executed DbCommand (2ms) [Parameters=[@__providedApiKey_0='?' (Size = 255)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [a].[Key], [a].[CreatedAt], [a].[Description], [a].[ExpiresAt], [a].[IsActive], [a].[LastUsedAt]
FROM [ApiKeys] AS [a]
WHERE [a].[Key] = @__providedApiKey_0 AND [a].[IsActive] = CAST(1 AS bit)
2025-02-01 00:22:26.181 +03:00 [INF] Received notification request: {"Title":null,"TitleEn":"Test Notification","TitleAr":"إشعار تجريبي","Filters":{"Customers.City":{"ValueKind":"Object","$type":"JsonElement"}},"NationalId":null,"NationalIds":null}
2025-02-01 00:22:26.186 +03:00 [INF] Starting GetTargetUsers with request type: Filtered Users
2025-02-01 00:22:26.187 +03:00 [INF] Processing filter: City = Riyadh
2025-02-01 00:22:26.188 +03:00 [INF] Applied City filter: = Riyadh
2025-02-01 00:22:26.189 +03:00 [INF] Added filter group for customers.City
2025-02-01 00:22:26.190 +03:00 [INF] Executing filter query with operation: AND
2025-02-01 00:22:26.689 +03:00 [INF] Executed DbCommand (101ms) [Parameters=[@__value_0='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SELECT [c].[NationalId]
FROM [Customers] AS [c]
WHERE [c].[City] = @__value_0
2025-02-01 00:22:26.925 +03:00 [INF] Found 2 users after applying filters
2025-02-01 00:22:26.932 +03:00 [INF] Target users query completed. Found 2 users
2025-02-01 00:22:26.934 +03:00 [INF] Found 2 target users for notification
2025-02-01 00:22:27.014 +03:00 [INF] Executed DbCommand (75ms) [Parameters=[@p0='?' (Size = 4000), @p1='?' (Size = 8000) (DbType = AnsiString), @p2='?' (Size = 8000) (DbType = AnsiString), @p3='?' (Size = 8000) (DbType = AnsiString), @p4='?' (DbType = DateTime2), @p5='?' (DbType = DateTime2), @p6='?' (Size = 255), @p7='?' (Size = 4000), @p8='?' (Size = 255), @p9='?' (Size = 255), @p10='?' (Size = 255)], CommandType='"Text"', CommandTimeout='30']
SET IMPLICIT_TRANSACTIONS OFF;
SET NOCOUNT ON;
INSERT INTO [notification_templates] ([additional_data], [Body], [body_ar], [body_en], [created_at], [expiry_at], [Route], [target_criteria], [Title], [title_ar], [title_en])
OUTPUT INSERTED.[Id]
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7, @p8, @p9, @p10);
2025-02-01 00:22:27.319 +03:00 [INF] Created notification template with ID: 2
2025-02-01 00:22:27.416 +03:00 [INF] Executed DbCommand (94ms) [Parameters=[@p0='?' (Size = 4000), @p1='?' (DbType = DateTime2), @p2='?' (Size = 4000), @p3='?' (Size = 4000), @p4='?' (Size = 4000), @p5='?' (Size = 450), @p6='?' (Size = 4000), @p7='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SET IMPLICIT_TRANSACTIONS OFF;
SET NOCOUNT ON;
INSERT INTO [AuthLogs] ([AuthType], [CreatedAt], [DeviceId], [FailureReason], [IpAddress], [NationalId], [Status], [UserAgent])
OUTPUT INSERTED.[Id]
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7);
2025-02-01 00:22:27.682 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@__userId_0='?' (Size = 450)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [u].[national_id], [u].[last_updated], [u].[notifications]
FROM [user_notifications] AS [u]
WHERE [u].[national_id] = @__userId_0
2025-02-01 00:22:27.696 +03:00 [INF] Processing notification for user 1012345678. Existing notification record: false
2025-02-01 00:22:27.706 +03:00 [INF] Current notifications count for user 1012345678: 0
2025-02-01 00:22:27.747 +03:00 [INF] Serialized new notifications for user 1012345678. Length: 140
2025-02-01 00:22:27.869 +03:00 [INF] Executed DbCommand (10ms) [Parameters=[@p0='?' (Size = 4000), @p1='?' (Size = 4000), @p2='?' (DbType = DateTime2)], CommandType='"Text"', CommandTimeout='30']
INSERT INTO user_notifications (national_id, notifications, last_updated) VALUES (@p0, @p1, @p2)
2025-02-01 00:22:27.876 +03:00 [INF] Created new UserNotification entry for user: 1012345678
2025-02-01 00:22:27.881 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@__userId_0='?' (Size = 450)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [u].[national_id], [u].[last_updated], [u].[notifications]
FROM [user_notifications] AS [u]
WHERE [u].[national_id] = @__userId_0
2025-02-01 00:22:27.899 +03:00 [INF] Processing notification for user 1045678901. Existing notification record: true
2025-02-01 00:22:27.900 +03:00 [INF] Current notifications count for user 1045678901: 1
2025-02-01 00:22:27.902 +03:00 [INF] Serialized new notifications for user 1045678901. Length: 279
2025-02-01 00:22:27.908 +03:00 [INF] Executed DbCommand (5ms) [Parameters=[@p0='?' (Size = 4000), @p1='?' (DbType = DateTime2), @p2='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
UPDATE user_notifications SET notifications = @p0, last_updated = @p1 WHERE national_id = @p2
2025-02-01 00:22:27.910 +03:00 [INF] Updated existing UserNotification for user: 1045678901
2025-02-01 00:22:27.920 +03:00 [INF] Executed DbCommand (2ms) [Parameters=[@p0='?' (Size = 4000), @p1='?' (DbType = DateTime2), @p2='?' (Size = 4000), @p3='?' (Size = 4000), @p4='?' (Size = 4000), @p5='?' (Size = 450), @p6='?' (Size = 4000), @p7='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SET IMPLICIT_TRANSACTIONS OFF;
SET NOCOUNT ON;
INSERT INTO [AuthLogs] ([AuthType], [CreatedAt], [DeviceId], [FailureReason], [IpAddress], [NationalId], [Status], [UserAgent])
OUTPUT INSERTED.[Id]
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7);
2025-02-01 00:22:27.923 +03:00 [INF] Successfully sent notifications. Template: 2, Success: 2, Total: 2
2025-02-01 00:22:27.924 +03:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType9`2[[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Object, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-02-01 00:22:27.925 +03:00 [INF] Executed action NayifatAPI.Controllers.NotificationsController.SendNotification (NayifatAPI) in 2116.4887ms
2025-02-01 00:22:27.930 +03:00 [INF] Executed endpoint 'NayifatAPI.Controllers.NotificationsController.SendNotification (NayifatAPI)'
2025-02-01 00:22:27.933 +03:00 [INF] Request finished HTTP/1.1 POST http://localhost:5264/api/notifications/send - 200 null application/json; charset=utf-8 2584.3729ms
2025-02-01 00:22:45.184 +03:00 [INF] Request starting HTTP/1.1 POST http://localhost:5264/api/notifications/send - application/json 279
2025-02-01 00:22:45.187 +03:00 [INF] Executing endpoint 'NayifatAPI.Controllers.NotificationsController.SendNotification (NayifatAPI)'
2025-02-01 00:22:45.187 +03:00 [INF] Route matched with {action = "SendNotification", controller = "Notifications"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] SendNotification(NayifatAPI.Controllers.SendNotificationRequest) on controller NayifatAPI.Controllers.NotificationsController (NayifatAPI).
2025-02-01 00:22:45.193 +03:00 [INF] Executed DbCommand (2ms) [Parameters=[@__providedApiKey_0='?' (Size = 255)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [a].[Key], [a].[CreatedAt], [a].[Description], [a].[ExpiresAt], [a].[IsActive], [a].[LastUsedAt]
FROM [ApiKeys] AS [a]
WHERE [a].[Key] = @__providedApiKey_0 AND [a].[IsActive] = CAST(1 AS bit)
2025-02-01 00:22:45.196 +03:00 [INF] Received notification request: {"Title":null,"TitleEn":"Test Notification","TitleAr":"إشعار تجريبي","Filters":{"Customers.District":{"ValueKind":"Object","$type":"JsonElement"}},"NationalId":null,"NationalIds":null}
2025-02-01 00:22:45.199 +03:00 [INF] Starting GetTargetUsers with request type: Filtered Users
2025-02-01 00:22:45.200 +03:00 [INF] Processing filter: District LIKE o
2025-02-01 00:22:45.201 +03:00 [WRN] Unknown field name in filter: District
2025-02-01 00:22:45.201 +03:00 [WRN] No valid filters were applied
2025-02-01 00:22:45.202 +03:00 [INF] Target users query completed. Found 0 users
2025-02-01 00:22:45.202 +03:00 [WRN] No target users found. Filters: {"Customers.District":{"ValueKind":"Object","$type":"JsonElement"}}
2025-02-01 00:22:45.204 +03:00 [INF] Executing ObjectResult, writing value of type '<>f__AnonymousType11`2[[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-02-01 00:22:45.205 +03:00 [INF] Executed action NayifatAPI.Controllers.NotificationsController.SendNotification (NayifatAPI) in 16.2316ms
2025-02-01 00:22:45.205 +03:00 [INF] Executed endpoint 'NayifatAPI.Controllers.NotificationsController.SendNotification (NayifatAPI)'
2025-02-01 00:22:45.207 +03:00 [INF] Request finished HTTP/1.1 POST http://localhost:5264/api/notifications/send - 400 null application/json; charset=utf-8 22.1732ms
2025-02-01 00:22:52.874 +03:00 [INF] Request starting HTTP/1.1 POST http://localhost:5264/api/notifications/send - application/json 279
2025-02-01 00:22:52.992 +03:00 [INF] Executing endpoint 'NayifatAPI.Controllers.NotificationsController.SendNotification (NayifatAPI)'
2025-02-01 00:22:52.994 +03:00 [INF] Route matched with {action = "SendNotification", controller = "Notifications"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] SendNotification(NayifatAPI.Controllers.SendNotificationRequest) on controller NayifatAPI.Controllers.NotificationsController (NayifatAPI).
2025-02-01 00:22:53.006 +03:00 [INF] Executed DbCommand (5ms) [Parameters=[@__providedApiKey_0='?' (Size = 255)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [a].[Key], [a].[CreatedAt], [a].[Description], [a].[ExpiresAt], [a].[IsActive], [a].[LastUsedAt]
FROM [ApiKeys] AS [a]
WHERE [a].[Key] = @__providedApiKey_0 AND [a].[IsActive] = CAST(1 AS bit)
2025-02-01 00:22:53.008 +03:00 [INF] Received notification request: {"Title":null,"TitleEn":"Test Notification","TitleAr":"إشعار تجريبي","Filters":{"Customers.District":{"ValueKind":"Object","$type":"JsonElement"}},"NationalId":null,"NationalIds":null}
2025-02-01 00:22:53.266 +03:00 [INF] Starting GetTargetUsers with request type: Filtered Users
2025-02-01 00:22:53.268 +03:00 [INF] Processing filter: District LIKE O
2025-02-01 00:22:53.278 +03:00 [WRN] Unknown field name in filter: District
2025-02-01 00:22:53.279 +03:00 [WRN] No valid filters were applied
2025-02-01 00:22:53.282 +03:00 [INF] Target users query completed. Found 0 users
2025-02-01 00:22:53.283 +03:00 [WRN] No target users found. Filters: {"Customers.District":{"ValueKind":"Object","$type":"JsonElement"}}
2025-02-01 00:22:53.285 +03:00 [INF] Executing ObjectResult, writing value of type '<>f__AnonymousType11`2[[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-02-01 00:22:53.292 +03:00 [INF] Executed action NayifatAPI.Controllers.NotificationsController.SendNotification (NayifatAPI) in 293.799ms
2025-02-01 00:22:53.294 +03:00 [INF] Executed endpoint 'NayifatAPI.Controllers.NotificationsController.SendNotification (NayifatAPI)'
2025-02-01 00:22:53.296 +03:00 [INF] Request finished HTTP/1.1 POST http://localhost:5264/api/notifications/send - 400 null application/json; charset=utf-8 421.7689ms
2025-02-01 00:23:29.371 +03:00 [INF] Request starting HTTP/1.1 POST http://localhost:5264/api/notifications/send - application/json 281
2025-02-01 00:23:29.372 +03:00 [INF] Executing endpoint 'NayifatAPI.Controllers.NotificationsController.SendNotification (NayifatAPI)'
2025-02-01 00:23:29.373 +03:00 [INF] Route matched with {action = "SendNotification", controller = "Notifications"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] SendNotification(NayifatAPI.Controllers.SendNotificationRequest) on controller NayifatAPI.Controllers.NotificationsController (NayifatAPI).
2025-02-01 00:23:29.380 +03:00 [INF] Executed DbCommand (3ms) [Parameters=[@__providedApiKey_0='?' (Size = 255)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [a].[Key], [a].[CreatedAt], [a].[Description], [a].[ExpiresAt], [a].[IsActive], [a].[LastUsedAt]
FROM [ApiKeys] AS [a]
WHERE [a].[Key] = @__providedApiKey_0 AND [a].[IsActive] = CAST(1 AS bit)
2025-02-01 00:23:29.383 +03:00 [INF] Received notification request: {"Title":null,"TitleEn":"Test Notification","TitleAr":"إشعار تجريبي","Filters":{"Customers.District":{"ValueKind":"Object","$type":"JsonElement"}},"NationalId":null,"NationalIds":null}
2025-02-01 00:23:29.390 +03:00 [INF] Starting GetTargetUsers with request type: Filtered Users
2025-02-01 00:23:29.391 +03:00 [INF] Processing filter: District LIKE aya
2025-02-01 00:23:29.393 +03:00 [WRN] Unknown field name in filter: District
2025-02-01 00:23:29.399 +03:00 [WRN] No valid filters were applied
2025-02-01 00:23:29.403 +03:00 [INF] Target users query completed. Found 0 users
2025-02-01 00:23:29.405 +03:00 [WRN] No target users found. Filters: {"Customers.District":{"ValueKind":"Object","$type":"JsonElement"}}
2025-02-01 00:23:29.408 +03:00 [INF] Executing ObjectResult, writing value of type '<>f__AnonymousType11`2[[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-02-01 00:23:29.410 +03:00 [INF] Executed action NayifatAPI.Controllers.NotificationsController.SendNotification (NayifatAPI) in 35.4788ms
2025-02-01 00:23:29.416 +03:00 [INF] Executed endpoint 'NayifatAPI.Controllers.NotificationsController.SendNotification (NayifatAPI)'
2025-02-01 00:23:29.420 +03:00 [INF] Request finished HTTP/1.1 POST http://localhost:5264/api/notifications/send - 400 null application/json; charset=utf-8 49.7007ms
2025-02-01 00:23:50.374 +03:00 [INF] Request starting HTTP/1.1 POST http://localhost:5264/api/notifications/send - application/json 278
2025-02-01 00:23:50.379 +03:00 [INF] Executing endpoint 'NayifatAPI.Controllers.NotificationsController.SendNotification (NayifatAPI)'
2025-02-01 00:23:50.380 +03:00 [INF] Route matched with {action = "SendNotification", controller = "Notifications"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] SendNotification(NayifatAPI.Controllers.SendNotificationRequest) on controller NayifatAPI.Controllers.NotificationsController (NayifatAPI).
2025-02-01 00:23:50.387 +03:00 [INF] Executed DbCommand (3ms) [Parameters=[@__providedApiKey_0='?' (Size = 255)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [a].[Key], [a].[CreatedAt], [a].[Description], [a].[ExpiresAt], [a].[IsActive], [a].[LastUsedAt]
FROM [ApiKeys] AS [a]
WHERE [a].[Key] = @__providedApiKey_0 AND [a].[IsActive] = CAST(1 AS bit)
2025-02-01 00:23:50.389 +03:00 [INF] Received notification request: {"Title":null,"TitleEn":"Test Notification","TitleAr":"إشعار تجريبي","Filters":{"Customers.Street":{"ValueKind":"Object","$type":"JsonElement"}},"NationalId":null,"NationalIds":null}
2025-02-01 00:23:50.397 +03:00 [INF] Starting GetTargetUsers with request type: Filtered Users
2025-02-01 00:23:50.398 +03:00 [INF] Processing filter: Street LIKE ah
2025-02-01 00:23:50.399 +03:00 [WRN] Unknown field name in filter: Street
2025-02-01 00:23:50.400 +03:00 [WRN] No valid filters were applied
2025-02-01 00:23:50.400 +03:00 [INF] Target users query completed. Found 0 users
2025-02-01 00:23:50.401 +03:00 [WRN] No target users found. Filters: {"Customers.Street":{"ValueKind":"Object","$type":"JsonElement"}}
2025-02-01 00:23:50.403 +03:00 [INF] Executing ObjectResult, writing value of type '<>f__AnonymousType11`2[[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-02-01 00:23:50.404 +03:00 [INF] Executed action NayifatAPI.Controllers.NotificationsController.SendNotification (NayifatAPI) in 22.0829ms
2025-02-01 00:23:50.406 +03:00 [INF] Executed endpoint 'NayifatAPI.Controllers.NotificationsController.SendNotification (NayifatAPI)'
2025-02-01 00:23:50.407 +03:00 [INF] Request finished HTTP/1.1 POST http://localhost:5264/api/notifications/send - 400 null application/json; charset=utf-8 32.6513ms
2025-02-01 00:24:23.466 +03:00 [INF] Request starting HTTP/1.1 POST http://localhost:5264/api/notifications/send - application/json 424
2025-02-01 00:24:23.468 +03:00 [INF] Executing endpoint 'NayifatAPI.Controllers.NotificationsController.SendNotification (NayifatAPI)'
2025-02-01 00:24:23.469 +03:00 [INF] Route matched with {action = "SendNotification", controller = "Notifications"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] SendNotification(NayifatAPI.Controllers.SendNotificationRequest) on controller NayifatAPI.Controllers.NotificationsController (NayifatAPI).
2025-02-01 00:24:23.474 +03:00 [INF] Executed DbCommand (2ms) [Parameters=[@__providedApiKey_0='?' (Size = 255)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [a].[Key], [a].[CreatedAt], [a].[Description], [a].[ExpiresAt], [a].[IsActive], [a].[LastUsedAt]
FROM [ApiKeys] AS [a]
WHERE [a].[Key] = @__providedApiKey_0 AND [a].[IsActive] = CAST(1 AS bit)
2025-02-01 00:24:23.476 +03:00 [INF] Received notification request: {"Title":null,"TitleEn":"Test Notification","TitleAr":"إشعار تجريبي","Filters":{"filter_operation":{"ValueKind":"String","$type":"JsonElement"},"Customers.SalaryCustomer":{"ValueKind":"Object","$type":"JsonElement"},"Customers.City":{"ValueKind":"Object","$type":"JsonElement"}},"NationalId":null,"NationalIds":null}
2025-02-01 00:24:23.481 +03:00 [INF] Starting GetTargetUsers with request type: Filtered Users
2025-02-01 00:24:23.482 +03:00 [INF] Applied SalaryCustomer BETWEEN filter: 5000 AND 15000
2025-02-01 00:24:23.485 +03:00 [INF] Added filter group for field SalaryCustomer
2025-02-01 00:24:23.488 +03:00 [ERR] Error applying filter: Customers.City = {
      "operator": "IN",
      "value": ["Riyadh", "Jeddah"]
    }
System.InvalidOperationException: The requested operation requires an element of type 'String', but the target element has type 'Array'.
   at System.Text.Json.ThrowHelper.ThrowJsonElementWrongTypeException(JsonTokenType expectedType, JsonTokenType actualType)
   at System.Text.Json.JsonDocument.GetString(Int32 index, JsonTokenType expectedType)
   at NayifatAPI.Controllers.NotificationsController.GetTargetUsers(SendNotificationRequest request) in C:\Users\yamta\StudioProjects\nayifat_app_2025_new\NayifatAPI\Controllers\NotificationsController.cs:line 752
2025-02-01 00:24:23.491 +03:00 [INF] Executing filter query with operation: OR
2025-02-01 00:24:23.497 +03:00 [INF] Executed DbCommand (4ms) [Parameters=[@__value_0='?' (Precision = 18) (Scale = 2) (DbType = Decimal), @__value2_Value_1='?' (Precision = 18) (Scale = 2) (DbType = Decimal)], CommandType='"Text"', CommandTimeout='30']
SELECT [c].[NationalId]
FROM [Customers] AS [c]
WHERE [c].[SalaryCustomer] >= @__value_0 AND [c].[SalaryCustomer] <= @__value2_Value_1
2025-02-01 00:24:23.501 +03:00 [INF] Found 3 users after applying filters
2025-02-01 00:24:23.502 +03:00 [INF] Target users query completed. Found 3 users
2025-02-01 00:24:23.504 +03:00 [INF] Found 3 target users for notification
2025-02-01 00:24:23.583 +03:00 [INF] Executed DbCommand (75ms) [Parameters=[@p0='?' (Size = 4000), @p1='?' (Size = 8000) (DbType = AnsiString), @p2='?' (Size = 8000) (DbType = AnsiString), @p3='?' (Size = 8000) (DbType = AnsiString), @p4='?' (DbType = DateTime2), @p5='?' (DbType = DateTime2), @p6='?' (Size = 255), @p7='?' (Size = 4000), @p8='?' (Size = 255), @p9='?' (Size = 255), @p10='?' (Size = 255)], CommandType='"Text"', CommandTimeout='30']
SET IMPLICIT_TRANSACTIONS OFF;
SET NOCOUNT ON;
INSERT INTO [notification_templates] ([additional_data], [Body], [body_ar], [body_en], [created_at], [expiry_at], [Route], [target_criteria], [Title], [title_ar], [title_en])
OUTPUT INSERTED.[Id]
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7, @p8, @p9, @p10);
2025-02-01 00:24:23.586 +03:00 [INF] Created notification template with ID: 3
2025-02-01 00:24:23.591 +03:00 [INF] Executed DbCommand (3ms) [Parameters=[@p0='?' (Size = 4000), @p1='?' (DbType = DateTime2), @p2='?' (Size = 4000), @p3='?' (Size = 4000), @p4='?' (Size = 4000), @p5='?' (Size = 450), @p6='?' (Size = 4000), @p7='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SET IMPLICIT_TRANSACTIONS OFF;
SET NOCOUNT ON;
INSERT INTO [AuthLogs] ([AuthType], [CreatedAt], [DeviceId], [FailureReason], [IpAddress], [NationalId], [Status], [UserAgent])
OUTPUT INSERTED.[Id]
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7);
2025-02-01 00:24:23.595 +03:00 [INF] Executed DbCommand (2ms) [Parameters=[@__userId_0='?' (Size = 450)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [u].[national_id], [u].[last_updated], [u].[notifications]
FROM [user_notifications] AS [u]
WHERE [u].[national_id] = @__userId_0
2025-02-01 00:24:23.597 +03:00 [INF] Processing notification for user 1012345678. Existing notification record: true
2025-02-01 00:24:23.597 +03:00 [INF] Current notifications count for user 1012345678: 1
2025-02-01 00:24:23.598 +03:00 [INF] Serialized new notifications for user 1012345678. Length: 279
2025-02-01 00:24:23.615 +03:00 [INF] Executed DbCommand (4ms) [Parameters=[@p0='?' (Size = 4000), @p1='?' (DbType = DateTime2), @p2='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
UPDATE user_notifications SET notifications = @p0, last_updated = @p1 WHERE national_id = @p2
2025-02-01 00:24:23.617 +03:00 [INF] Updated existing UserNotification for user: 1012345678
2025-02-01 00:24:23.620 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@__userId_0='?' (Size = 450)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [u].[national_id], [u].[last_updated], [u].[notifications]
FROM [user_notifications] AS [u]
WHERE [u].[national_id] = @__userId_0
2025-02-01 00:24:23.622 +03:00 [INF] Processing notification for user 1023456789. Existing notification record: false
2025-02-01 00:24:23.623 +03:00 [INF] Current notifications count for user 1023456789: 0
2025-02-01 00:24:23.624 +03:00 [INF] Serialized new notifications for user 1023456789. Length: 140
2025-02-01 00:24:23.627 +03:00 [INF] Executed DbCommand (2ms) [Parameters=[@p0='?' (Size = 4000), @p1='?' (Size = 4000), @p2='?' (DbType = DateTime2)], CommandType='"Text"', CommandTimeout='30']
INSERT INTO user_notifications (national_id, notifications, last_updated) VALUES (@p0, @p1, @p2)
2025-02-01 00:24:23.628 +03:00 [INF] Created new UserNotification entry for user: 1023456789
2025-02-01 00:24:23.629 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@__userId_0='?' (Size = 450)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [u].[national_id], [u].[last_updated], [u].[notifications]
FROM [user_notifications] AS [u]
WHERE [u].[national_id] = @__userId_0
2025-02-01 00:24:23.631 +03:00 [INF] Processing notification for user 1045678901. Existing notification record: true
2025-02-01 00:24:23.631 +03:00 [INF] Current notifications count for user 1045678901: 2
2025-02-01 00:24:23.632 +03:00 [INF] Serialized new notifications for user 1045678901. Length: 418
2025-02-01 00:24:23.638 +03:00 [INF] Executed DbCommand (3ms) [Parameters=[@p0='?' (Size = 4000), @p1='?' (DbType = DateTime2), @p2='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
UPDATE user_notifications SET notifications = @p0, last_updated = @p1 WHERE national_id = @p2
2025-02-01 00:24:23.640 +03:00 [INF] Updated existing UserNotification for user: 1045678901
2025-02-01 00:24:23.642 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@p0='?' (Size = 4000), @p1='?' (DbType = DateTime2), @p2='?' (Size = 4000), @p3='?' (Size = 4000), @p4='?' (Size = 4000), @p5='?' (Size = 450), @p6='?' (Size = 4000), @p7='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SET IMPLICIT_TRANSACTIONS OFF;
SET NOCOUNT ON;
INSERT INTO [AuthLogs] ([AuthType], [CreatedAt], [DeviceId], [FailureReason], [IpAddress], [NationalId], [Status], [UserAgent])
OUTPUT INSERTED.[Id]
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7);
2025-02-01 00:24:23.645 +03:00 [INF] Successfully sent notifications. Template: 3, Success: 3, Total: 3
2025-02-01 00:24:23.646 +03:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType9`2[[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Object, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-02-01 00:24:23.647 +03:00 [INF] Executed action NayifatAPI.Controllers.NotificationsController.SendNotification (NayifatAPI) in 176.8622ms
2025-02-01 00:24:23.648 +03:00 [INF] Executed endpoint 'NayifatAPI.Controllers.NotificationsController.SendNotification (NayifatAPI)'
2025-02-01 00:24:23.649 +03:00 [INF] Request finished HTTP/1.1 POST http://localhost:5264/api/notifications/send - 200 null application/json; charset=utf-8 183.0514ms
2025-02-01 00:24:41.271 +03:00 [INF] Request starting HTTP/1.1 POST http://localhost:5264/api/notifications/send - application/json 425
2025-02-01 00:24:41.309 +03:00 [INF] Executing endpoint 'NayifatAPI.Controllers.NotificationsController.SendNotification (NayifatAPI)'
2025-02-01 00:24:41.310 +03:00 [INF] Route matched with {action = "SendNotification", controller = "Notifications"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] SendNotification(NayifatAPI.Controllers.SendNotificationRequest) on controller NayifatAPI.Controllers.NotificationsController (NayifatAPI).
2025-02-01 00:24:41.316 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@__providedApiKey_0='?' (Size = 255)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [a].[Key], [a].[CreatedAt], [a].[Description], [a].[ExpiresAt], [a].[IsActive], [a].[LastUsedAt]
FROM [ApiKeys] AS [a]
WHERE [a].[Key] = @__providedApiKey_0 AND [a].[IsActive] = CAST(1 AS bit)
2025-02-01 00:24:41.318 +03:00 [INF] Received notification request: {"Title":null,"TitleEn":"Test Notification","TitleAr":"إشعار تجريبي","Filters":{"filter_operation":{"ValueKind":"String","$type":"JsonElement"},"Customers.SalaryCustomer":{"ValueKind":"Object","$type":"JsonElement"},"Customers.City":{"ValueKind":"Object","$type":"JsonElement"}},"NationalId":null,"NationalIds":null}
2025-02-01 00:24:41.708 +03:00 [INF] Starting GetTargetUsers with request type: Filtered Users
2025-02-01 00:24:41.754 +03:00 [INF] Applied SalaryCustomer BETWEEN filter: 5000 AND 10000
2025-02-01 00:24:41.755 +03:00 [INF] Added filter group for field SalaryCustomer
2025-02-01 00:24:41.756 +03:00 [ERR] Error applying filter: Customers.City = {
      "operator": "IN",
      "value": ["Riyadh", "Jeddah"]
    }
System.InvalidOperationException: The requested operation requires an element of type 'String', but the target element has type 'Array'.
   at System.Text.Json.ThrowHelper.ThrowJsonElementWrongTypeException(JsonTokenType expectedType, JsonTokenType actualType)
   at System.Text.Json.JsonDocument.GetString(Int32 index, JsonTokenType expectedType)
   at NayifatAPI.Controllers.NotificationsController.GetTargetUsers(SendNotificationRequest request) in C:\Users\yamta\StudioProjects\nayifat_app_2025_new\NayifatAPI\Controllers\NotificationsController.cs:line 752
2025-02-01 00:24:41.758 +03:00 [INF] Executing filter query with operation: AND
2025-02-01 00:24:41.760 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@__value_0='?' (Precision = 18) (Scale = 2) (DbType = Decimal), @__value2_Value_1='?' (Precision = 18) (Scale = 2) (DbType = Decimal)], CommandType='"Text"', CommandTimeout='30']
SELECT [c].[NationalId]
FROM [Customers] AS [c]
WHERE [c].[SalaryCustomer] >= @__value_0 AND [c].[SalaryCustomer] <= @__value2_Value_1
2025-02-01 00:24:41.765 +03:00 [INF] Found 1 users after applying filters
2025-02-01 00:24:41.766 +03:00 [INF] Target users query completed. Found 1 users
2025-02-01 00:24:41.768 +03:00 [INF] Found 1 target users for notification
2025-02-01 00:24:41.854 +03:00 [INF] Executed DbCommand (84ms) [Parameters=[@p0='?' (Size = 4000), @p1='?' (Size = 8000) (DbType = AnsiString), @p2='?' (Size = 8000) (DbType = AnsiString), @p3='?' (Size = 8000) (DbType = AnsiString), @p4='?' (DbType = DateTime2), @p5='?' (DbType = DateTime2), @p6='?' (Size = 255), @p7='?' (Size = 4000), @p8='?' (Size = 255), @p9='?' (Size = 255), @p10='?' (Size = 255)], CommandType='"Text"', CommandTimeout='30']
SET IMPLICIT_TRANSACTIONS OFF;
SET NOCOUNT ON;
INSERT INTO [notification_templates] ([additional_data], [Body], [body_ar], [body_en], [created_at], [expiry_at], [Route], [target_criteria], [Title], [title_ar], [title_en])
OUTPUT INSERTED.[Id]
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7, @p8, @p9, @p10);
2025-02-01 00:24:42.068 +03:00 [INF] Created notification template with ID: 4
2025-02-01 00:24:42.606 +03:00 [INF] Executed DbCommand (530ms) [Parameters=[@p0='?' (Size = 4000), @p1='?' (DbType = DateTime2), @p2='?' (Size = 4000), @p3='?' (Size = 4000), @p4='?' (Size = 4000), @p5='?' (Size = 450), @p6='?' (Size = 4000), @p7='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SET IMPLICIT_TRANSACTIONS OFF;
SET NOCOUNT ON;
INSERT INTO [AuthLogs] ([AuthType], [CreatedAt], [DeviceId], [FailureReason], [IpAddress], [NationalId], [Status], [UserAgent])
OUTPUT INSERTED.[Id]
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7);
2025-02-01 00:24:42.785 +03:00 [INF] Executed DbCommand (17ms) [Parameters=[@__userId_0='?' (Size = 450)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [u].[national_id], [u].[last_updated], [u].[notifications]
FROM [user_notifications] AS [u]
WHERE [u].[national_id] = @__userId_0
2025-02-01 00:24:42.927 +03:00 [INF] Processing notification for user 1045678901. Existing notification record: true
2025-02-01 00:24:42.928 +03:00 [INF] Current notifications count for user 1045678901: 3
2025-02-01 00:24:42.931 +03:00 [INF] Serialized new notifications for user 1045678901. Length: 556
2025-02-01 00:24:42.954 +03:00 [INF] Executed DbCommand (20ms) [Parameters=[@p0='?' (Size = 4000), @p1='?' (DbType = DateTime2), @p2='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
UPDATE user_notifications SET notifications = @p0, last_updated = @p1 WHERE national_id = @p2
2025-02-01 00:24:42.968 +03:00 [INF] Updated existing UserNotification for user: 1045678901
2025-02-01 00:24:42.973 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@p0='?' (Size = 4000), @p1='?' (DbType = DateTime2), @p2='?' (Size = 4000), @p3='?' (Size = 4000), @p4='?' (Size = 4000), @p5='?' (Size = 450), @p6='?' (Size = 4000), @p7='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SET IMPLICIT_TRANSACTIONS OFF;
SET NOCOUNT ON;
INSERT INTO [AuthLogs] ([AuthType], [CreatedAt], [DeviceId], [FailureReason], [IpAddress], [NationalId], [Status], [UserAgent])
OUTPUT INSERTED.[Id]
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7);
2025-02-01 00:24:43.191 +03:00 [INF] Successfully sent notifications. Template: 4, Success: 1, Total: 1
2025-02-01 00:24:43.369 +03:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType9`2[[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Object, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-02-01 00:24:43.371 +03:00 [INF] Executed action NayifatAPI.Controllers.NotificationsController.SendNotification (NayifatAPI) in 2057.7927ms
2025-02-01 00:24:43.372 +03:00 [INF] Executed endpoint 'NayifatAPI.Controllers.NotificationsController.SendNotification (NayifatAPI)'
2025-02-01 00:24:43.373 +03:00 [INF] Request finished HTTP/1.1 POST http://localhost:5264/api/notifications/send - 200 null application/json; charset=utf-8 2102.0065ms
2025-02-01 00:25:08.387 +03:00 [INF] Request starting HTTP/1.1 POST http://localhost:5264/api/notifications/send - application/json 424
2025-02-01 00:25:08.390 +03:00 [INF] Executing endpoint 'NayifatAPI.Controllers.NotificationsController.SendNotification (NayifatAPI)'
2025-02-01 00:25:08.391 +03:00 [INF] Route matched with {action = "SendNotification", controller = "Notifications"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] SendNotification(NayifatAPI.Controllers.SendNotificationRequest) on controller NayifatAPI.Controllers.NotificationsController (NayifatAPI).
2025-02-01 00:25:08.396 +03:00 [INF] Executed DbCommand (3ms) [Parameters=[@__providedApiKey_0='?' (Size = 255)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [a].[Key], [a].[CreatedAt], [a].[Description], [a].[ExpiresAt], [a].[IsActive], [a].[LastUsedAt]
FROM [ApiKeys] AS [a]
WHERE [a].[Key] = @__providedApiKey_0 AND [a].[IsActive] = CAST(1 AS bit)
2025-02-01 00:25:08.398 +03:00 [INF] Received notification request: {"Title":null,"TitleEn":"Test Notification","TitleAr":"إشعار تجريبي","Filters":{"filter_operation":{"ValueKind":"String","$type":"JsonElement"},"Customers.SalaryCustomer":{"ValueKind":"Object","$type":"JsonElement"},"Customers.City":{"ValueKind":"Object","$type":"JsonElement"}},"NationalId":null,"NationalIds":null}
2025-02-01 00:25:08.405 +03:00 [INF] Starting GetTargetUsers with request type: Filtered Users
2025-02-01 00:25:08.407 +03:00 [INF] Applied SalaryCustomer BETWEEN filter: 5000 AND 7000
2025-02-01 00:25:08.409 +03:00 [INF] Added filter group for field SalaryCustomer
2025-02-01 00:25:08.410 +03:00 [ERR] Error applying filter: Customers.City = {
      "operator": "IN",
      "value": ["Riyadh", "Jeddah"]
    }
System.InvalidOperationException: The requested operation requires an element of type 'String', but the target element has type 'Array'.
   at System.Text.Json.ThrowHelper.ThrowJsonElementWrongTypeException(JsonTokenType expectedType, JsonTokenType actualType)
   at System.Text.Json.JsonDocument.GetString(Int32 index, JsonTokenType expectedType)
   at NayifatAPI.Controllers.NotificationsController.GetTargetUsers(SendNotificationRequest request) in C:\Users\yamta\StudioProjects\nayifat_app_2025_new\NayifatAPI\Controllers\NotificationsController.cs:line 752
2025-02-01 00:25:08.412 +03:00 [INF] Executing filter query with operation: AND
2025-02-01 00:25:08.417 +03:00 [INF] Executed DbCommand (3ms) [Parameters=[@__value_0='?' (Precision = 18) (Scale = 2) (DbType = Decimal), @__value2_Value_1='?' (Precision = 18) (Scale = 2) (DbType = Decimal)], CommandType='"Text"', CommandTimeout='30']
SELECT [c].[NationalId]
FROM [Customers] AS [c]
WHERE [c].[SalaryCustomer] >= @__value_0 AND [c].[SalaryCustomer] <= @__value2_Value_1
2025-02-01 00:25:08.419 +03:00 [INF] Found 0 users after applying filters
2025-02-01 00:25:08.419 +03:00 [INF] Target users query completed. Found 0 users
2025-02-01 00:25:08.420 +03:00 [WRN] No target users found. Filters: {"filter_operation":{"ValueKind":"String","$type":"JsonElement"},"Customers.SalaryCustomer":{"ValueKind":"Object","$type":"JsonElement"},"Customers.City":{"ValueKind":"Object","$type":"JsonElement"}}
2025-02-01 00:25:08.434 +03:00 [INF] Executing ObjectResult, writing value of type '<>f__AnonymousType11`2[[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-02-01 00:25:08.436 +03:00 [INF] Executed action NayifatAPI.Controllers.NotificationsController.SendNotification (NayifatAPI) in 43.3744ms
2025-02-01 00:25:08.437 +03:00 [INF] Executed endpoint 'NayifatAPI.Controllers.NotificationsController.SendNotification (NayifatAPI)'
2025-02-01 00:25:08.438 +03:00 [INF] Request finished HTTP/1.1 POST http://localhost:5264/api/notifications/send - 400 null application/json; charset=utf-8 50.9695ms
2025-02-01 00:26:56.008 +03:00 [INF] Request starting HTTP/1.1 POST http://localhost:5264/api/notifications/send - application/json 415
2025-02-01 00:26:56.011 +03:00 [INF] Executing endpoint 'NayifatAPI.Controllers.NotificationsController.SendNotification (NayifatAPI)'
2025-02-01 00:26:56.012 +03:00 [INF] Route matched with {action = "SendNotification", controller = "Notifications"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] SendNotification(NayifatAPI.Controllers.SendNotificationRequest) on controller NayifatAPI.Controllers.NotificationsController (NayifatAPI).
2025-02-01 00:26:56.017 +03:00 [INF] Executed DbCommand (2ms) [Parameters=[@__providedApiKey_0='?' (Size = 255)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [a].[Key], [a].[CreatedAt], [a].[Description], [a].[ExpiresAt], [a].[IsActive], [a].[LastUsedAt]
FROM [ApiKeys] AS [a]
WHERE [a].[Key] = @__providedApiKey_0 AND [a].[IsActive] = CAST(1 AS bit)
2025-02-01 00:26:56.019 +03:00 [INF] Received notification request: {"Title":null,"TitleEn":"Test Notification","TitleAr":"إشعار تجريبي","Filters":{"filter_operation":{"ValueKind":"String","$type":"JsonElement"},"Customers.SalaryCustomer":{"ValueKind":"Object","$type":"JsonElement"},"Customers.City":{"ValueKind":"Object","$type":"JsonElement"}},"NationalId":null,"NationalIds":null}
2025-02-01 00:26:56.025 +03:00 [INF] Starting GetTargetUsers with request type: Filtered Users
2025-02-01 00:26:56.026 +03:00 [INF] Applied SalaryCustomer BETWEEN filter: 5000 AND 15000
2025-02-01 00:26:56.027 +03:00 [INF] Added filter group for field SalaryCustomer
2025-02-01 00:26:56.029 +03:00 [INF] Processing filter: City NOT LIKE Ri
2025-02-01 00:26:56.031 +03:00 [INF] Applied City filter: NOT LIKE Ri
2025-02-01 00:26:56.032 +03:00 [INF] Added filter group for customers.City
2025-02-01 00:26:56.033 +03:00 [INF] Executing filter query with operation: AND
2025-02-01 00:26:56.042 +03:00 [ERR] Failed executing DbCommand (3ms) [Parameters=[@__value_0='?' (Precision = 18) (Scale = 2) (DbType = Decimal), @__value2_Value_1='?' (Precision = 18) (Scale = 2) (DbType = Decimal)], CommandType='"Text"', CommandTimeout='30']
SELECT [t].[NationalId]
FROM (
    SELECT [c].[NationalId], [c].[AddNo], [c].[BuildingNo], [c].[City], [c].[Consent], [c].[ConsentDate], [c].[DateOfBirth], [c].[Dependents], [c].[District], [c].[Email], [c].[Employer], [c].[EmployerName], [c].[EmploymentStatus], [c].[FamilyNameAr], [c].[FamilyNameEn], [c].[FirstNameAr], [c].[FirstNameEn], [c].[Iban], [c].[IdExpiryDate], [c].[Language], [c].[Los], [c].[Mpin], [c].[MpinEnabled], [c].[NafathStatus], [c].[NafathTimestamp], [c].[Password], [c].[Phone], [c].[RegistrationDate], [c].[Salary], [c].[SalaryCustomer], [c].[SalaryDakhli], [c].[SecondNameAr], [c].[SecondNameEn], [c].[Sector], [c].[Street], [c].[ThirdNameAr], [c].[ThirdNameEn], [c].[Zipcode]
    FROM [Customers] AS [c]
    WHERE [c].[SalaryCustomer] >= @__value_0 AND [c].[SalaryCustomer] <= @__value2_Value_1
    INTERSECT
    SELECT [c0].[NationalId], [c0].[AddNo], [c0].[BuildingNo], [c0].[City], [c0].[Consent], [c0].[ConsentDate], [c0].[DateOfBirth], [c0].[Dependents], [c0].[District], [c0].[Email], [c0].[Employer], [c0].[EmployerName], [c0].[EmploymentStatus], [c0].[FamilyNameAr], [c0].[FamilyNameEn], [c0].[FirstNameAr], [c0].[FirstNameEn], [c0].[Iban], [c0].[IdExpiryDate], [c0].[Language], [c0].[Los], [c0].[Mpin], [c0].[MpinEnabled], [c0].[NafathStatus], [c0].[NafathTimestamp], [c0].[Password], [c0].[Phone], [c0].[RegistrationDate], [c0].[Salary], [c0].[SalaryCustomer], [c0].[SalaryDakhli], [c0].[SecondNameAr], [c0].[SecondNameEn], [c0].[Sector], [c0].[Street], [c0].[ThirdNameAr], [c0].[ThirdNameEn], [c0].[Zipcode]
    FROM [Customers] AS [c0]
) AS [t]
2025-02-01 00:26:56.051 +03:00 [ERR] An exception occurred while iterating over the results of a query for context type 'NayifatAPI.Data.ApplicationDbContext'.
Microsoft.Data.SqlClient.SqlException (0x80131904): Invalid column name 'EmployerName'.
Invalid column name 'EmploymentStatus'.
Invalid column name 'Language'.
Invalid column name 'Salary'.
Invalid column name 'EmployerName'.
Invalid column name 'EmploymentStatus'.
Invalid column name 'Language'.
Invalid column name 'Salary'.
   at Microsoft.Data.SqlClient.SqlCommand.<>c.<ExecuteDbDataReaderAsync>b__209_0(Task`1 result)
   at System.Threading.Tasks.ContinuationResultTaskFromResultTask`2.InnerInvoke()
   at System.Threading.ExecutionContext.RunInternal(ExecutionContext executionContext, ContextCallback callback, Object state)
--- End of stack trace from previous location ---
   at System.Threading.ExecutionContext.RunInternal(ExecutionContext executionContext, ContextCallback callback, Object state)
   at System.Threading.Tasks.Task.ExecuteWithThreadLocal(Task& currentTaskSlot, Thread threadPoolThread)
--- End of stack trace from previous location ---
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Query.Internal.SingleQueryingEnumerable`1.AsyncEnumerator.InitializeReaderAsync(AsyncEnumerator enumerator, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Storage.Internal.SqlServerExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Query.Internal.SingleQueryingEnumerable`1.AsyncEnumerator.MoveNextAsync()
ClientConnectionId:235ddd2f-cdfc-4107-bd62-3d0366f5515b
Error Number:207,State:1,Class:16
Microsoft.Data.SqlClient.SqlException (0x80131904): Invalid column name 'EmployerName'.
Invalid column name 'EmploymentStatus'.
Invalid column name 'Language'.
Invalid column name 'Salary'.
Invalid column name 'EmployerName'.
Invalid column name 'EmploymentStatus'.
Invalid column name 'Language'.
Invalid column name 'Salary'.
   at Microsoft.Data.SqlClient.SqlCommand.<>c.<ExecuteDbDataReaderAsync>b__209_0(Task`1 result)
   at System.Threading.Tasks.ContinuationResultTaskFromResultTask`2.InnerInvoke()
   at System.Threading.ExecutionContext.RunInternal(ExecutionContext executionContext, ContextCallback callback, Object state)
--- End of stack trace from previous location ---
   at System.Threading.ExecutionContext.RunInternal(ExecutionContext executionContext, ContextCallback callback, Object state)
   at System.Threading.Tasks.Task.ExecuteWithThreadLocal(Task& currentTaskSlot, Thread threadPoolThread)
--- End of stack trace from previous location ---
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Query.Internal.SingleQueryingEnumerable`1.AsyncEnumerator.InitializeReaderAsync(AsyncEnumerator enumerator, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Storage.Internal.SqlServerExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Query.Internal.SingleQueryingEnumerable`1.AsyncEnumerator.MoveNextAsync()
ClientConnectionId:235ddd2f-cdfc-4107-bd62-3d0366f5515b
Error Number:207,State:1,Class:16
2025-02-01 00:26:56.061 +03:00 [ERR] Error in SendNotification
Microsoft.Data.SqlClient.SqlException (0x80131904): Invalid column name 'EmployerName'.
Invalid column name 'EmploymentStatus'.
Invalid column name 'Language'.
Invalid column name 'Salary'.
Invalid column name 'EmployerName'.
Invalid column name 'EmploymentStatus'.
Invalid column name 'Language'.
Invalid column name 'Salary'.
   at Microsoft.Data.SqlClient.SqlCommand.<>c.<ExecuteDbDataReaderAsync>b__209_0(Task`1 result)
   at System.Threading.Tasks.ContinuationResultTaskFromResultTask`2.InnerInvoke()
   at System.Threading.ExecutionContext.RunInternal(ExecutionContext executionContext, ContextCallback callback, Object state)
--- End of stack trace from previous location ---
   at System.Threading.ExecutionContext.RunInternal(ExecutionContext executionContext, ContextCallback callback, Object state)
   at System.Threading.Tasks.Task.ExecuteWithThreadLocal(Task& currentTaskSlot, Thread threadPoolThread)
--- End of stack trace from previous location ---
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Query.Internal.SingleQueryingEnumerable`1.AsyncEnumerator.InitializeReaderAsync(AsyncEnumerator enumerator, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Storage.Internal.SqlServerExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Query.Internal.SingleQueryingEnumerable`1.AsyncEnumerator.MoveNextAsync()
   at Microsoft.EntityFrameworkCore.EntityFrameworkQueryableExtensions.ToListAsync[TSource](IQueryable`1 source, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.EntityFrameworkQueryableExtensions.ToListAsync[TSource](IQueryable`1 source, CancellationToken cancellationToken)
   at NayifatAPI.Controllers.NotificationsController.GetTargetUsers(SendNotificationRequest request) in C:\Users\yamta\StudioProjects\nayifat_app_2025_new\NayifatAPI\Controllers\NotificationsController.cs:line 894
   at NayifatAPI.Controllers.NotificationsController.SendNotification(SendNotificationRequest request) in C:\Users\yamta\StudioProjects\nayifat_app_2025_new\NayifatAPI\Controllers\NotificationsController.cs:line 203
ClientConnectionId:235ddd2f-cdfc-4107-bd62-3d0366f5515b
Error Number:207,State:1,Class:16
2025-02-01 00:26:56.074 +03:00 [INF] Executing ObjectResult, writing value of type '<>f__AnonymousType11`2[[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-02-01 00:26:56.076 +03:00 [INF] Executed action NayifatAPI.Controllers.NotificationsController.SendNotification (NayifatAPI) in 62.156ms
2025-02-01 00:26:56.077 +03:00 [INF] Executed endpoint 'NayifatAPI.Controllers.NotificationsController.SendNotification (NayifatAPI)'
2025-02-01 00:26:56.079 +03:00 [INF] Request finished HTTP/1.1 POST http://localhost:5264/api/notifications/send - 500 null application/json; charset=utf-8 70.5449ms
2025-02-01 00:27:50.994 +03:00 [INF] Request starting HTTP/1.1 POST http://localhost:5264/api/notifications/send - application/json 276
2025-02-01 00:27:50.997 +03:00 [INF] Executing endpoint 'NayifatAPI.Controllers.NotificationsController.SendNotification (NayifatAPI)'
2025-02-01 00:27:50.998 +03:00 [INF] Route matched with {action = "SendNotification", controller = "Notifications"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] SendNotification(NayifatAPI.Controllers.SendNotificationRequest) on controller NayifatAPI.Controllers.NotificationsController (NayifatAPI).
2025-02-01 00:27:51.006 +03:00 [INF] Executed DbCommand (2ms) [Parameters=[@__providedApiKey_0='?' (Size = 255)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [a].[Key], [a].[CreatedAt], [a].[Description], [a].[ExpiresAt], [a].[IsActive], [a].[LastUsedAt]
FROM [ApiKeys] AS [a]
WHERE [a].[Key] = @__providedApiKey_0 AND [a].[IsActive] = CAST(1 AS bit)
2025-02-01 00:27:51.008 +03:00 [INF] Received notification request: {"Title":null,"TitleEn":"Test Notification","TitleAr":"إشعار تجريبي","Filters":{"Customers.City":{"ValueKind":"Object","$type":"JsonElement"}},"NationalId":null,"NationalIds":null}
2025-02-01 00:27:51.013 +03:00 [INF] Starting GetTargetUsers with request type: Filtered Users
2025-02-01 00:27:51.013 +03:00 [INF] Processing filter: City LIKE Ri
2025-02-01 00:27:51.014 +03:00 [INF] Applied City filter: LIKE Ri
2025-02-01 00:27:51.015 +03:00 [INF] Added filter group for customers.City
2025-02-01 00:27:51.016 +03:00 [INF] Executing filter query with operation: AND
2025-02-01 00:27:51.027 +03:00 [INF] Executed DbCommand (2ms) [Parameters=[@__Format_1='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SELECT [c].[NationalId]
FROM [Customers] AS [c]
WHERE [c].[City] LIKE @__Format_1
2025-02-01 00:27:51.030 +03:00 [INF] Found 2 users after applying filters
2025-02-01 00:27:51.031 +03:00 [INF] Target users query completed. Found 2 users
2025-02-01 00:27:51.034 +03:00 [INF] Found 2 target users for notification
2025-02-01 00:27:51.117 +03:00 [INF] Executed DbCommand (79ms) [Parameters=[@p0='?' (Size = 4000), @p1='?' (Size = 8000) (DbType = AnsiString), @p2='?' (Size = 8000) (DbType = AnsiString), @p3='?' (Size = 8000) (DbType = AnsiString), @p4='?' (DbType = DateTime2), @p5='?' (DbType = DateTime2), @p6='?' (Size = 255), @p7='?' (Size = 4000), @p8='?' (Size = 255), @p9='?' (Size = 255), @p10='?' (Size = 255)], CommandType='"Text"', CommandTimeout='30']
SET IMPLICIT_TRANSACTIONS OFF;
SET NOCOUNT ON;
INSERT INTO [notification_templates] ([additional_data], [Body], [body_ar], [body_en], [created_at], [expiry_at], [Route], [target_criteria], [Title], [title_ar], [title_en])
OUTPUT INSERTED.[Id]
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7, @p8, @p9, @p10);
2025-02-01 00:27:51.122 +03:00 [INF] Created notification template with ID: 5
2025-02-01 00:27:51.127 +03:00 [INF] Executed DbCommand (4ms) [Parameters=[@p0='?' (Size = 4000), @p1='?' (DbType = DateTime2), @p2='?' (Size = 4000), @p3='?' (Size = 4000), @p4='?' (Size = 4000), @p5='?' (Size = 450), @p6='?' (Size = 4000), @p7='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SET IMPLICIT_TRANSACTIONS OFF;
SET NOCOUNT ON;
INSERT INTO [AuthLogs] ([AuthType], [CreatedAt], [DeviceId], [FailureReason], [IpAddress], [NationalId], [Status], [UserAgent])
OUTPUT INSERTED.[Id]
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7);
2025-02-01 00:27:51.134 +03:00 [INF] Executed DbCommand (4ms) [Parameters=[@__userId_0='?' (Size = 450)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [u].[national_id], [u].[last_updated], [u].[notifications]
FROM [user_notifications] AS [u]
WHERE [u].[national_id] = @__userId_0
2025-02-01 00:27:51.137 +03:00 [INF] Processing notification for user 1012345678. Existing notification record: true
2025-02-01 00:27:51.138 +03:00 [INF] Current notifications count for user 1012345678: 2
2025-02-01 00:27:51.139 +03:00 [INF] Serialized new notifications for user 1012345678. Length: 418
2025-02-01 00:27:51.147 +03:00 [INF] Executed DbCommand (6ms) [Parameters=[@p0='?' (Size = 4000), @p1='?' (DbType = DateTime2), @p2='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
UPDATE user_notifications SET notifications = @p0, last_updated = @p1 WHERE national_id = @p2
2025-02-01 00:27:51.149 +03:00 [INF] Updated existing UserNotification for user: 1012345678
2025-02-01 00:27:51.155 +03:00 [INF] Executed DbCommand (3ms) [Parameters=[@__userId_0='?' (Size = 450)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [u].[national_id], [u].[last_updated], [u].[notifications]
FROM [user_notifications] AS [u]
WHERE [u].[national_id] = @__userId_0
2025-02-01 00:27:51.157 +03:00 [INF] Processing notification for user 1045678901. Existing notification record: true
2025-02-01 00:27:51.158 +03:00 [INF] Current notifications count for user 1045678901: 4
2025-02-01 00:27:51.159 +03:00 [INF] Serialized new notifications for user 1045678901. Length: 695
2025-02-01 00:27:51.161 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@p0='?' (Size = 4000), @p1='?' (DbType = DateTime2), @p2='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
UPDATE user_notifications SET notifications = @p0, last_updated = @p1 WHERE national_id = @p2
2025-02-01 00:27:51.163 +03:00 [INF] Updated existing UserNotification for user: 1045678901
2025-02-01 00:27:51.166 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@p0='?' (Size = 4000), @p1='?' (DbType = DateTime2), @p2='?' (Size = 4000), @p3='?' (Size = 4000), @p4='?' (Size = 4000), @p5='?' (Size = 450), @p6='?' (Size = 4000), @p7='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SET IMPLICIT_TRANSACTIONS OFF;
SET NOCOUNT ON;
INSERT INTO [AuthLogs] ([AuthType], [CreatedAt], [DeviceId], [FailureReason], [IpAddress], [NationalId], [Status], [UserAgent])
OUTPUT INSERTED.[Id]
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7);
2025-02-01 00:27:51.173 +03:00 [INF] Successfully sent notifications. Template: 5, Success: 2, Total: 2
2025-02-01 00:27:51.174 +03:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType9`2[[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Object, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-02-01 00:27:51.176 +03:00 [INF] Executed action NayifatAPI.Controllers.NotificationsController.SendNotification (NayifatAPI) in 175.1916ms
2025-02-01 00:27:51.178 +03:00 [INF] Executed endpoint 'NayifatAPI.Controllers.NotificationsController.SendNotification (NayifatAPI)'
2025-02-01 00:27:51.179 +03:00 [INF] Request finished HTTP/1.1 POST http://localhost:5264/api/notifications/send - 200 null application/json; charset=utf-8 184.6965ms
2025-02-01 00:28:03.597 +03:00 [INF] Request starting HTTP/1.1 POST http://localhost:5264/api/notifications/send - application/json 280
2025-02-01 00:28:03.599 +03:00 [INF] Executing endpoint 'NayifatAPI.Controllers.NotificationsController.SendNotification (NayifatAPI)'
2025-02-01 00:28:03.600 +03:00 [INF] Route matched with {action = "SendNotification", controller = "Notifications"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] SendNotification(NayifatAPI.Controllers.SendNotificationRequest) on controller NayifatAPI.Controllers.NotificationsController (NayifatAPI).
2025-02-01 00:28:03.603 +03:00 [INF] Executed DbCommand (0ms) [Parameters=[@__providedApiKey_0='?' (Size = 255)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [a].[Key], [a].[CreatedAt], [a].[Description], [a].[ExpiresAt], [a].[IsActive], [a].[LastUsedAt]
FROM [ApiKeys] AS [a]
WHERE [a].[Key] = @__providedApiKey_0 AND [a].[IsActive] = CAST(1 AS bit)
2025-02-01 00:28:03.605 +03:00 [INF] Received notification request: {"Title":null,"TitleEn":"Test Notification","TitleAr":"إشعار تجريبي","Filters":{"Customers.District":{"ValueKind":"Object","$type":"JsonElement"}},"NationalId":null,"NationalIds":null}
2025-02-01 00:28:03.610 +03:00 [INF] Starting GetTargetUsers with request type: Filtered Users
2025-02-01 00:28:03.610 +03:00 [INF] Processing filter: District LIKE ol
2025-02-01 00:28:03.612 +03:00 [WRN] Unknown field name in filter: District
2025-02-01 00:28:03.612 +03:00 [WRN] No valid filters were applied
2025-02-01 00:28:03.613 +03:00 [INF] Target users query completed. Found 0 users
2025-02-01 00:28:03.614 +03:00 [WRN] No target users found. Filters: {"Customers.District":{"ValueKind":"Object","$type":"JsonElement"}}
2025-02-01 00:28:03.617 +03:00 [INF] Executing ObjectResult, writing value of type '<>f__AnonymousType11`2[[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-02-01 00:28:03.618 +03:00 [INF] Executed action NayifatAPI.Controllers.NotificationsController.SendNotification (NayifatAPI) in 16.4752ms
2025-02-01 00:28:03.619 +03:00 [INF] Executed endpoint 'NayifatAPI.Controllers.NotificationsController.SendNotification (NayifatAPI)'
2025-02-01 00:28:03.620 +03:00 [INF] Request finished HTTP/1.1 POST http://localhost:5264/api/notifications/send - 400 null application/json; charset=utf-8 23.171ms
2025-02-01 00:28:21.317 +03:00 [INF] Request starting HTTP/1.1 POST http://localhost:5264/api/notifications/send - application/json 287
2025-02-01 00:28:21.320 +03:00 [INF] Executing endpoint 'NayifatAPI.Controllers.NotificationsController.SendNotification (NayifatAPI)'
2025-02-01 00:28:21.321 +03:00 [INF] Route matched with {action = "SendNotification", controller = "Notifications"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] SendNotification(NayifatAPI.Controllers.SendNotificationRequest) on controller NayifatAPI.Controllers.NotificationsController (NayifatAPI).
2025-02-01 00:28:21.326 +03:00 [INF] Executed DbCommand (3ms) [Parameters=[@__providedApiKey_0='?' (Size = 255)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [a].[Key], [a].[CreatedAt], [a].[Description], [a].[ExpiresAt], [a].[IsActive], [a].[LastUsedAt]
FROM [ApiKeys] AS [a]
WHERE [a].[Key] = @__providedApiKey_0 AND [a].[IsActive] = CAST(1 AS bit)
2025-02-01 00:28:21.330 +03:00 [INF] Received notification request: {"Title":null,"TitleEn":"Test Notification","TitleAr":"إشعار تجريبي","Filters":{"Customers.District":{"ValueKind":"Object","$type":"JsonElement"}},"NationalId":null,"NationalIds":null}
2025-02-01 00:28:21.334 +03:00 [INF] Starting GetTargetUsers with request type: Filtered Users
2025-02-01 00:28:21.335 +03:00 [INF] Processing filter: District = Al-Sulimania
2025-02-01 00:28:21.336 +03:00 [WRN] Unknown field name in filter: District
2025-02-01 00:28:21.336 +03:00 [WRN] No valid filters were applied
2025-02-01 00:28:21.337 +03:00 [INF] Target users query completed. Found 0 users
2025-02-01 00:28:21.337 +03:00 [WRN] No target users found. Filters: {"Customers.District":{"ValueKind":"Object","$type":"JsonElement"}}
2025-02-01 00:28:21.339 +03:00 [INF] Executing ObjectResult, writing value of type '<>f__AnonymousType11`2[[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-02-01 00:28:21.341 +03:00 [INF] Executed action NayifatAPI.Controllers.NotificationsController.SendNotification (NayifatAPI) in 19.2267ms
2025-02-01 00:28:21.343 +03:00 [INF] Executed endpoint 'NayifatAPI.Controllers.NotificationsController.SendNotification (NayifatAPI)'
2025-02-01 00:28:21.345 +03:00 [INF] Request finished HTTP/1.1 POST http://localhost:5264/api/notifications/send - 400 null application/json; charset=utf-8 27.9309ms
2025-02-01 00:28:52.333 +03:00 [INF] Request starting HTTP/1.1 POST http://localhost:5264/api/notifications/send - application/json 287
2025-02-01 00:28:52.334 +03:00 [INF] Executing endpoint 'NayifatAPI.Controllers.NotificationsController.SendNotification (NayifatAPI)'
2025-02-01 00:28:52.335 +03:00 [INF] Route matched with {action = "SendNotification", controller = "Notifications"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] SendNotification(NayifatAPI.Controllers.SendNotificationRequest) on controller NayifatAPI.Controllers.NotificationsController (NayifatAPI).
2025-02-01 00:28:52.343 +03:00 [INF] Executed DbCommand (4ms) [Parameters=[@__providedApiKey_0='?' (Size = 255)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [a].[Key], [a].[CreatedAt], [a].[Description], [a].[ExpiresAt], [a].[IsActive], [a].[LastUsedAt]
FROM [ApiKeys] AS [a]
WHERE [a].[Key] = @__providedApiKey_0 AND [a].[IsActive] = CAST(1 AS bit)
2025-02-01 00:28:52.346 +03:00 [INF] Received notification request: {"Title":null,"TitleEn":"Test Notification","TitleAr":"إشعار تجريبي","Filters":{"Customers.District":{"ValueKind":"Object","$type":"JsonElement"}},"NationalId":null,"NationalIds":null}
2025-02-01 00:28:52.350 +03:00 [INF] Starting GetTargetUsers with request type: Filtered Users
2025-02-01 00:28:52.351 +03:00 [INF] Processing filter: District = Al-Sulimania
2025-02-01 00:28:52.352 +03:00 [WRN] Unknown field name in filter: District
2025-02-01 00:28:52.352 +03:00 [WRN] No valid filters were applied
2025-02-01 00:28:52.353 +03:00 [INF] Target users query completed. Found 0 users
2025-02-01 00:28:52.354 +03:00 [WRN] No target users found. Filters: {"Customers.District":{"ValueKind":"Object","$type":"JsonElement"}}
2025-02-01 00:28:52.358 +03:00 [INF] Executing ObjectResult, writing value of type '<>f__AnonymousType11`2[[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-02-01 00:28:52.359 +03:00 [INF] Executed action NayifatAPI.Controllers.NotificationsController.SendNotification (NayifatAPI) in 22.2183ms
2025-02-01 00:28:52.361 +03:00 [INF] Executed endpoint 'NayifatAPI.Controllers.NotificationsController.SendNotification (NayifatAPI)'
2025-02-01 00:28:52.364 +03:00 [INF] Request finished HTTP/1.1 POST http://localhost:5264/api/notifications/send - 400 null application/json; charset=utf-8 31.1703ms
2025-02-01 00:29:01.749 +03:00 [INF] Request starting HTTP/1.1 POST http://localhost:5264/api/notifications/send - application/json 290
2025-02-01 00:29:01.751 +03:00 [INF] Executing endpoint 'NayifatAPI.Controllers.NotificationsController.SendNotification (NayifatAPI)'
2025-02-01 00:29:01.752 +03:00 [INF] Route matched with {action = "SendNotification", controller = "Notifications"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] SendNotification(NayifatAPI.Controllers.SendNotificationRequest) on controller NayifatAPI.Controllers.NotificationsController (NayifatAPI).
2025-02-01 00:29:01.755 +03:00 [INF] Executed DbCommand (0ms) [Parameters=[@__providedApiKey_0='?' (Size = 255)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [a].[Key], [a].[CreatedAt], [a].[Description], [a].[ExpiresAt], [a].[IsActive], [a].[LastUsedAt]
FROM [ApiKeys] AS [a]
WHERE [a].[Key] = @__providedApiKey_0 AND [a].[IsActive] = CAST(1 AS bit)
2025-02-01 00:29:01.758 +03:00 [INF] Received notification request: {"Title":null,"TitleEn":"Test Notification","TitleAr":"إشعار تجريبي","Filters":{"Customers.District":{"ValueKind":"Object","$type":"JsonElement"}},"NationalId":null,"NationalIds":null}
2025-02-01 00:29:01.761 +03:00 [INF] Starting GetTargetUsers with request type: Filtered Users
2025-02-01 00:29:01.762 +03:00 [INF] Processing filter: District LIKE Al-Sulimania
2025-02-01 00:29:01.764 +03:00 [WRN] Unknown field name in filter: District
2025-02-01 00:29:01.765 +03:00 [WRN] No valid filters were applied
2025-02-01 00:29:01.766 +03:00 [INF] Target users query completed. Found 0 users
2025-02-01 00:29:01.767 +03:00 [WRN] No target users found. Filters: {"Customers.District":{"ValueKind":"Object","$type":"JsonElement"}}
2025-02-01 00:29:01.769 +03:00 [INF] Executing ObjectResult, writing value of type '<>f__AnonymousType11`2[[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-02-01 00:29:01.772 +03:00 [INF] Executed action NayifatAPI.Controllers.NotificationsController.SendNotification (NayifatAPI) in 18.6436ms
2025-02-01 00:29:01.773 +03:00 [INF] Executed endpoint 'NayifatAPI.Controllers.NotificationsController.SendNotification (NayifatAPI)'
2025-02-01 00:29:01.775 +03:00 [INF] Request finished HTTP/1.1 POST http://localhost:5264/api/notifications/send - 400 null application/json; charset=utf-8 25.7307ms
2025-02-01 00:29:44.007 +03:00 [INF] Application is shutting down...
2025-02-01 00:30:07.810 +03:00 [INF] Starting web application
2025-02-01 00:30:07.906 +03:00 [INF] Now listening on: http://localhost:5264
2025-02-01 00:30:07.911 +03:00 [INF] Application started. Press Ctrl+C to shut down.
2025-02-01 00:30:07.912 +03:00 [INF] Hosting environment: Development
2025-02-01 00:30:07.912 +03:00 [INF] Content root path: C:\Users\yamta\StudioProjects\nayifat_app_2025_new\NayifatAPI
2025-02-01 00:30:14.741 +03:00 [INF] Request starting HTTP/1.1 POST http://localhost:5264/api/notifications/send - application/json 290
2025-02-01 00:30:14.935 +03:00 [WRN] Failed to determine the https port for redirect.
2025-02-01 00:30:14.941 +03:00 [INF] Executing endpoint 'NayifatAPI.Controllers.NotificationsController.SendNotification (NayifatAPI)'
2025-02-01 00:30:14.988 +03:00 [INF] Route matched with {action = "SendNotification", controller = "Notifications"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] SendNotification(NayifatAPI.Controllers.SendNotificationRequest) on controller NayifatAPI.Controllers.NotificationsController (NayifatAPI).
2025-02-01 00:30:16.924 +03:00 [INF] Executed DbCommand (32ms) [Parameters=[@__providedApiKey_0='?' (Size = 255)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [a].[Key], [a].[CreatedAt], [a].[Description], [a].[ExpiresAt], [a].[IsActive], [a].[LastUsedAt]
FROM [ApiKeys] AS [a]
WHERE [a].[Key] = @__providedApiKey_0 AND [a].[IsActive] = CAST(1 AS bit)
2025-02-01 00:30:17.026 +03:00 [INF] Received notification request: {"Title":null,"TitleEn":"Test Notification","TitleAr":"إشعار تجريبي","Filters":{"Customers.District":{"ValueKind":"Object","$type":"JsonElement"}},"NationalId":null,"NationalIds":null}
2025-02-01 00:30:17.046 +03:00 [INF] Starting GetTargetUsers with request type: Filtered Users
2025-02-01 00:30:17.054 +03:00 [INF] Processing filter: District LIKE Al-Sulimania
2025-02-01 00:30:17.056 +03:00 [WRN] Unknown field name in filter: District
2025-02-01 00:30:17.058 +03:00 [WRN] No valid filters were applied
2025-02-01 00:30:17.059 +03:00 [INF] Target users query completed. Found 0 users
2025-02-01 00:30:17.060 +03:00 [WRN] No target users found. Filters: {"Customers.District":{"ValueKind":"Object","$type":"JsonElement"}}
2025-02-01 00:30:17.073 +03:00 [INF] Executing ObjectResult, writing value of type '<>f__AnonymousType11`2[[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-02-01 00:30:17.097 +03:00 [INF] Executed action NayifatAPI.Controllers.NotificationsController.SendNotification (NayifatAPI) in 2103.0809ms
2025-02-01 00:30:17.105 +03:00 [INF] Executed endpoint 'NayifatAPI.Controllers.NotificationsController.SendNotification (NayifatAPI)'
2025-02-01 00:30:17.122 +03:00 [INF] Request finished HTTP/1.1 POST http://localhost:5264/api/notifications/send - 400 null application/json; charset=utf-8 2382.5152ms
2025-02-01 00:30:28.822 +03:00 [INF] Request starting HTTP/1.1 POST http://localhost:5264/api/notifications/send - application/json 277
2025-02-01 00:30:28.827 +03:00 [INF] Executing endpoint 'NayifatAPI.Controllers.NotificationsController.SendNotification (NayifatAPI)'
2025-02-01 00:30:28.828 +03:00 [INF] Route matched with {action = "SendNotification", controller = "Notifications"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] SendNotification(NayifatAPI.Controllers.SendNotificationRequest) on controller NayifatAPI.Controllers.NotificationsController (NayifatAPI).
2025-02-01 00:30:28.881 +03:00 [INF] Executed DbCommand (6ms) [Parameters=[@__providedApiKey_0='?' (Size = 255)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [a].[Key], [a].[CreatedAt], [a].[Description], [a].[ExpiresAt], [a].[IsActive], [a].[LastUsedAt]
FROM [ApiKeys] AS [a]
WHERE [a].[Key] = @__providedApiKey_0 AND [a].[IsActive] = CAST(1 AS bit)
2025-02-01 00:30:28.887 +03:00 [INF] Received notification request: {"Title":null,"TitleEn":"Test Notification","TitleAr":"إشعار تجريبي","Filters":{"Customers.City":{"ValueKind":"Object","$type":"JsonElement"}},"NationalId":null,"NationalIds":null}
2025-02-01 00:30:28.898 +03:00 [INF] Starting GetTargetUsers with request type: Filtered Users
2025-02-01 00:30:28.900 +03:00 [INF] Processing filter: City LIKE jed
2025-02-01 00:30:28.905 +03:00 [INF] Applied City filter: LIKE jed
2025-02-01 00:30:28.907 +03:00 [INF] Added filter group for customers.City
2025-02-01 00:30:28.909 +03:00 [INF] Executing filter query with operation: AND
2025-02-01 00:30:28.993 +03:00 [INF] Executed DbCommand (15ms) [Parameters=[@__Format_1='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SELECT [c].[NationalId]
FROM [Customers] AS [c]
WHERE [c].[City] LIKE @__Format_1
2025-02-01 00:30:29.008 +03:00 [INF] Found 1 users after applying filters
2025-02-01 00:30:29.009 +03:00 [INF] Target users query completed. Found 1 users
2025-02-01 00:30:29.011 +03:00 [INF] Found 1 target users for notification
2025-02-01 00:30:29.266 +03:00 [INF] Executed DbCommand (80ms) [Parameters=[@p0='?' (Size = 4000), @p1='?' (Size = 8000) (DbType = AnsiString), @p2='?' (Size = 8000) (DbType = AnsiString), @p3='?' (Size = 8000) (DbType = AnsiString), @p4='?' (DbType = DateTime2), @p5='?' (DbType = DateTime2), @p6='?' (Size = 255), @p7='?' (Size = 4000), @p8='?' (Size = 255), @p9='?' (Size = 255), @p10='?' (Size = 255)], CommandType='"Text"', CommandTimeout='30']
SET IMPLICIT_TRANSACTIONS OFF;
SET NOCOUNT ON;
INSERT INTO [notification_templates] ([additional_data], [Body], [body_ar], [body_en], [created_at], [expiry_at], [Route], [target_criteria], [Title], [title_ar], [title_en])
OUTPUT INSERTED.[Id]
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7, @p8, @p9, @p10);
2025-02-01 00:30:29.290 +03:00 [INF] Created notification template with ID: 6
2025-02-01 00:30:29.358 +03:00 [INF] Executed DbCommand (10ms) [Parameters=[@p0='?' (Size = 4000), @p1='?' (DbType = DateTime2), @p2='?' (Size = 4000), @p3='?' (Size = 4000), @p4='?' (Size = 4000), @p5='?' (Size = 450), @p6='?' (Size = 4000), @p7='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SET IMPLICIT_TRANSACTIONS OFF;
SET NOCOUNT ON;
INSERT INTO [AuthLogs] ([AuthType], [CreatedAt], [DeviceId], [FailureReason], [IpAddress], [NationalId], [Status], [UserAgent])
OUTPUT INSERTED.[Id]
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7);
2025-02-01 00:30:29.379 +03:00 [INF] Executed DbCommand (3ms) [Parameters=[@__userId_0='?' (Size = 450)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [u].[national_id], [u].[last_updated], [u].[notifications]
FROM [user_notifications] AS [u]
WHERE [u].[national_id] = @__userId_0
2025-02-01 00:30:29.393 +03:00 [INF] Processing notification for user 1023456789. Existing notification record: true
2025-02-01 00:30:29.396 +03:00 [INF] Current notifications count for user 1023456789: 1
2025-02-01 00:30:29.408 +03:00 [INF] Serialized new notifications for user 1023456789. Length: 274
2025-02-01 00:30:29.441 +03:00 [INF] Executed DbCommand (21ms) [Parameters=[@p0='?' (Size = 4000), @p1='?' (DbType = DateTime2), @p2='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
UPDATE user_notifications SET notifications = @p0, last_updated = @p1 WHERE national_id = @p2
2025-02-01 00:30:29.444 +03:00 [INF] Updated existing UserNotification for user: 1023456789
2025-02-01 00:30:29.454 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@p0='?' (Size = 4000), @p1='?' (DbType = DateTime2), @p2='?' (Size = 4000), @p3='?' (Size = 4000), @p4='?' (Size = 4000), @p5='?' (Size = 450), @p6='?' (Size = 4000), @p7='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SET IMPLICIT_TRANSACTIONS OFF;
SET NOCOUNT ON;
INSERT INTO [AuthLogs] ([AuthType], [CreatedAt], [DeviceId], [FailureReason], [IpAddress], [NationalId], [Status], [UserAgent])
OUTPUT INSERTED.[Id]
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7);
2025-02-01 00:30:29.456 +03:00 [INF] Successfully sent notifications. Template: 6, Success: 1, Total: 1
2025-02-01 00:30:29.459 +03:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType9`2[[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Object, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-02-01 00:30:29.466 +03:00 [INF] Executed action NayifatAPI.Controllers.NotificationsController.SendNotification (NayifatAPI) in 635.6208ms
2025-02-01 00:30:29.468 +03:00 [INF] Executed endpoint 'NayifatAPI.Controllers.NotificationsController.SendNotification (NayifatAPI)'
2025-02-01 00:30:29.471 +03:00 [INF] Request finished HTTP/1.1 POST http://localhost:5264/api/notifications/send - 200 null application/json; charset=utf-8 648.278ms
2025-02-01 00:30:41.735 +03:00 [INF] Request starting HTTP/1.1 POST http://localhost:5264/api/notifications/send - application/json 281
2025-02-01 00:30:41.770 +03:00 [INF] Executing endpoint 'NayifatAPI.Controllers.NotificationsController.SendNotification (NayifatAPI)'
2025-02-01 00:30:41.968 +03:00 [INF] Route matched with {action = "SendNotification", controller = "Notifications"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] SendNotification(NayifatAPI.Controllers.SendNotificationRequest) on controller NayifatAPI.Controllers.NotificationsController (NayifatAPI).
2025-02-01 00:30:42.112 +03:00 [INF] Executed DbCommand (5ms) [Parameters=[@__providedApiKey_0='?' (Size = 255)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [a].[Key], [a].[CreatedAt], [a].[Description], [a].[ExpiresAt], [a].[IsActive], [a].[LastUsedAt]
FROM [ApiKeys] AS [a]
WHERE [a].[Key] = @__providedApiKey_0 AND [a].[IsActive] = CAST(1 AS bit)
2025-02-01 00:30:42.116 +03:00 [INF] Received notification request: {"Title":null,"TitleEn":"Test Notification","TitleAr":"إشعار تجريبي","Filters":{"Customers.City":{"ValueKind":"Object","$type":"JsonElement"}},"NationalId":null,"NationalIds":null}
2025-02-01 00:30:42.122 +03:00 [INF] Starting GetTargetUsers with request type: Filtered Users
2025-02-01 00:30:42.123 +03:00 [INF] Processing filter: City NOT LIKE jed
2025-02-01 00:30:42.125 +03:00 [INF] Applied City filter: NOT LIKE jed
2025-02-01 00:30:42.130 +03:00 [INF] Added filter group for customers.City
2025-02-01 00:30:42.135 +03:00 [INF] Executing filter query with operation: AND
2025-02-01 00:30:42.172 +03:00 [INF] Executed DbCommand (14ms) [Parameters=[@__Format_1='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SELECT [c].[NationalId]
FROM [Customers] AS [c]
WHERE [c].[City] NOT LIKE @__Format_1 OR [c].[City] IS NULL
2025-02-01 00:30:42.180 +03:00 [INF] Found 5 users after applying filters
2025-02-01 00:30:42.186 +03:00 [INF] Target users query completed. Found 5 users
2025-02-01 00:30:42.187 +03:00 [INF] Found 5 target users for notification
2025-02-01 00:30:42.276 +03:00 [INF] Executed DbCommand (86ms) [Parameters=[@p0='?' (Size = 4000), @p1='?' (Size = 8000) (DbType = AnsiString), @p2='?' (Size = 8000) (DbType = AnsiString), @p3='?' (Size = 8000) (DbType = AnsiString), @p4='?' (DbType = DateTime2), @p5='?' (DbType = DateTime2), @p6='?' (Size = 255), @p7='?' (Size = 4000), @p8='?' (Size = 255), @p9='?' (Size = 255), @p10='?' (Size = 255)], CommandType='"Text"', CommandTimeout='30']
SET IMPLICIT_TRANSACTIONS OFF;
SET NOCOUNT ON;
INSERT INTO [notification_templates] ([additional_data], [Body], [body_ar], [body_en], [created_at], [expiry_at], [Route], [target_criteria], [Title], [title_ar], [title_en])
OUTPUT INSERTED.[Id]
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7, @p8, @p9, @p10);
2025-02-01 00:30:42.281 +03:00 [INF] Created notification template with ID: 7
2025-02-01 00:30:42.287 +03:00 [INF] Executed DbCommand (4ms) [Parameters=[@p0='?' (Size = 4000), @p1='?' (DbType = DateTime2), @p2='?' (Size = 4000), @p3='?' (Size = 4000), @p4='?' (Size = 4000), @p5='?' (Size = 450), @p6='?' (Size = 4000), @p7='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SET IMPLICIT_TRANSACTIONS OFF;
SET NOCOUNT ON;
INSERT INTO [AuthLogs] ([AuthType], [CreatedAt], [DeviceId], [FailureReason], [IpAddress], [NationalId], [Status], [UserAgent])
OUTPUT INSERTED.[Id]
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7);
2025-02-01 00:30:42.296 +03:00 [INF] Executed DbCommand (5ms) [Parameters=[@__userId_0='?' (Size = 450)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [u].[national_id], [u].[last_updated], [u].[notifications]
FROM [user_notifications] AS [u]
WHERE [u].[national_id] = @__userId_0
2025-02-01 00:30:42.300 +03:00 [INF] Processing notification for user 1012345678. Existing notification record: true
2025-02-01 00:30:42.301 +03:00 [INF] Current notifications count for user 1012345678: 3
2025-02-01 00:30:42.303 +03:00 [INF] Serialized new notifications for user 1012345678. Length: 557
2025-02-01 00:30:42.318 +03:00 [INF] Executed DbCommand (12ms) [Parameters=[@p0='?' (Size = 4000), @p1='?' (DbType = DateTime2), @p2='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
UPDATE user_notifications SET notifications = @p0, last_updated = @p1 WHERE national_id = @p2
2025-02-01 00:30:42.321 +03:00 [INF] Updated existing UserNotification for user: 1012345678
2025-02-01 00:30:42.326 +03:00 [INF] Executed DbCommand (3ms) [Parameters=[@__userId_0='?' (Size = 450)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [u].[national_id], [u].[last_updated], [u].[notifications]
FROM [user_notifications] AS [u]
WHERE [u].[national_id] = @__userId_0
2025-02-01 00:30:42.331 +03:00 [INF] Processing notification for user 1034567890. Existing notification record: false
2025-02-01 00:30:42.335 +03:00 [INF] Current notifications count for user 1034567890: 0
2025-02-01 00:30:42.336 +03:00 [INF] Serialized new notifications for user 1034567890. Length: 140
2025-02-01 00:30:42.342 +03:00 [INF] Executed DbCommand (4ms) [Parameters=[@p0='?' (Size = 4000), @p1='?' (Size = 4000), @p2='?' (DbType = DateTime2)], CommandType='"Text"', CommandTimeout='30']
INSERT INTO user_notifications (national_id, notifications, last_updated) VALUES (@p0, @p1, @p2)
2025-02-01 00:30:42.347 +03:00 [INF] Created new UserNotification entry for user: 1034567890
2025-02-01 00:30:42.353 +03:00 [INF] Executed DbCommand (4ms) [Parameters=[@__userId_0='?' (Size = 450)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [u].[national_id], [u].[last_updated], [u].[notifications]
FROM [user_notifications] AS [u]
WHERE [u].[national_id] = @__userId_0
2025-02-01 00:30:42.356 +03:00 [INF] Processing notification for user 1045678901. Existing notification record: true
2025-02-01 00:30:42.357 +03:00 [INF] Current notifications count for user 1045678901: 5
2025-02-01 00:30:42.358 +03:00 [INF] Serialized new notifications for user 1045678901. Length: 834
2025-02-01 00:30:42.369 +03:00 [INF] Executed DbCommand (7ms) [Parameters=[@p0='?' (Size = 4000), @p1='?' (DbType = DateTime2), @p2='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
UPDATE user_notifications SET notifications = @p0, last_updated = @p1 WHERE national_id = @p2
2025-02-01 00:30:42.371 +03:00 [INF] Updated existing UserNotification for user: 1045678901
2025-02-01 00:30:42.382 +03:00 [INF] Executed DbCommand (9ms) [Parameters=[@__userId_0='?' (Size = 450)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [u].[national_id], [u].[last_updated], [u].[notifications]
FROM [user_notifications] AS [u]
WHERE [u].[national_id] = @__userId_0
2025-02-01 00:30:42.387 +03:00 [INF] Processing notification for user 1056789012. Existing notification record: false
2025-02-01 00:30:42.388 +03:00 [INF] Current notifications count for user 1056789012: 0
2025-02-01 00:30:42.389 +03:00 [INF] Serialized new notifications for user 1056789012. Length: 140
2025-02-01 00:30:42.395 +03:00 [INF] Executed DbCommand (4ms) [Parameters=[@p0='?' (Size = 4000), @p1='?' (Size = 4000), @p2='?' (DbType = DateTime2)], CommandType='"Text"', CommandTimeout='30']
INSERT INTO user_notifications (national_id, notifications, last_updated) VALUES (@p0, @p1, @p2)
2025-02-01 00:30:42.398 +03:00 [INF] Created new UserNotification entry for user: 1056789012
2025-02-01 00:30:42.403 +03:00 [INF] Executed DbCommand (2ms) [Parameters=[@__userId_0='?' (Size = 450)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [u].[national_id], [u].[last_updated], [u].[notifications]
FROM [user_notifications] AS [u]
WHERE [u].[national_id] = @__userId_0
2025-02-01 00:30:42.405 +03:00 [INF] Processing notification for user 1234567890. Existing notification record: false
2025-02-01 00:30:42.406 +03:00 [INF] Current notifications count for user 1234567890: 0
2025-02-01 00:30:42.407 +03:00 [INF] Serialized new notifications for user 1234567890. Length: 140
2025-02-01 00:30:42.409 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@p0='?' (Size = 4000), @p1='?' (Size = 4000), @p2='?' (DbType = DateTime2)], CommandType='"Text"', CommandTimeout='30']
INSERT INTO user_notifications (national_id, notifications, last_updated) VALUES (@p0, @p1, @p2)
2025-02-01 00:30:42.415 +03:00 [INF] Created new UserNotification entry for user: 1234567890
2025-02-01 00:30:42.422 +03:00 [INF] Executed DbCommand (3ms) [Parameters=[@p0='?' (Size = 4000), @p1='?' (DbType = DateTime2), @p2='?' (Size = 4000), @p3='?' (Size = 4000), @p4='?' (Size = 4000), @p5='?' (Size = 450), @p6='?' (Size = 4000), @p7='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SET IMPLICIT_TRANSACTIONS OFF;
SET NOCOUNT ON;
INSERT INTO [AuthLogs] ([AuthType], [CreatedAt], [DeviceId], [FailureReason], [IpAddress], [NationalId], [Status], [UserAgent])
OUTPUT INSERTED.[Id]
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7);
2025-02-01 00:30:42.426 +03:00 [INF] Successfully sent notifications. Template: 7, Success: 5, Total: 5
2025-02-01 00:30:42.429 +03:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType9`2[[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Object, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-02-01 00:30:42.431 +03:00 [INF] Executed action NayifatAPI.Controllers.NotificationsController.SendNotification (NayifatAPI) in 456.2273ms
2025-02-01 00:30:42.435 +03:00 [INF] Executed endpoint 'NayifatAPI.Controllers.NotificationsController.SendNotification (NayifatAPI)'
2025-02-01 00:30:42.436 +03:00 [INF] Request finished HTTP/1.1 POST http://localhost:5264/api/notifications/send - 200 null application/json; charset=utf-8 701.8058ms
2025-02-01 00:33:02.930 +03:00 [INF] Application is shutting down...
2025-02-01 00:33:15.518 +03:00 [INF] Starting web application
2025-02-01 00:33:15.661 +03:00 [INF] Now listening on: http://localhost:5264
2025-02-01 00:33:15.667 +03:00 [INF] Application started. Press Ctrl+C to shut down.
2025-02-01 00:33:15.668 +03:00 [INF] Hosting environment: Development
2025-02-01 00:33:15.669 +03:00 [INF] Content root path: C:\Users\yamta\StudioProjects\nayifat_app_2025_new\NayifatAPI
2025-02-01 00:33:24.682 +03:00 [INF] Request starting HTTP/1.1 POST http://localhost:5264/api/notifications/send - application/json 281
2025-02-01 00:33:24.728 +03:00 [WRN] Failed to determine the https port for redirect.
2025-02-01 00:33:24.733 +03:00 [INF] Executing endpoint 'NayifatAPI.Controllers.NotificationsController.SendNotification (NayifatAPI)'
2025-02-01 00:33:24.768 +03:00 [INF] Route matched with {action = "SendNotification", controller = "Notifications"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] SendNotification(NayifatAPI.Controllers.SendNotificationRequest) on controller NayifatAPI.Controllers.NotificationsController (NayifatAPI).
2025-02-01 00:33:26.265 +03:00 [INF] Executed DbCommand (54ms) [Parameters=[@__providedApiKey_0='?' (Size = 255)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [a].[Key], [a].[CreatedAt], [a].[Description], [a].[ExpiresAt], [a].[IsActive], [a].[LastUsedAt]
FROM [ApiKeys] AS [a]
WHERE [a].[Key] = @__providedApiKey_0 AND [a].[IsActive] = CAST(1 AS bit)
2025-02-01 00:33:26.426 +03:00 [INF] Received notification request: {"Title":null,"TitleEn":"Test Notification","TitleAr":"إشعار تجريبي","Filters":{"Customers.City":{"ValueKind":"Object","$type":"JsonElement"}},"NationalId":null,"NationalIds":null}
2025-02-01 00:33:26.944 +03:00 [INF] Starting GetTargetUsers with request type: Filtered Users
2025-02-01 00:33:27.752 +03:00 [INF] Processing filter: City NOT LIKE jed
2025-02-01 00:33:27.996 +03:00 [INF] Applied City string filter: NOT LIKE jed
2025-02-01 00:33:28.000 +03:00 [INF] Added filter group for customers.City
2025-02-01 00:33:28.007 +03:00 [INF] Executing filter query with operation: AND
2025-02-01 00:33:29.042 +03:00 [INF] Executed DbCommand (190ms) [Parameters=[@__Format_1='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SELECT [c].[NationalId]
FROM [Customers] AS [c]
WHERE [c].[City] NOT LIKE @__Format_1 OR [c].[City] IS NULL
2025-02-01 00:33:29.319 +03:00 [INF] Found 5 users after applying filters
2025-02-01 00:33:29.326 +03:00 [INF] Target users query completed. Found 5 users
2025-02-01 00:33:29.330 +03:00 [INF] Found 5 target users for notification
2025-02-01 00:33:29.847 +03:00 [INF] Executed DbCommand (49ms) [Parameters=[@p0='?' (Size = 4000), @p1='?' (Size = 8000) (DbType = AnsiString), @p2='?' (Size = 8000) (DbType = AnsiString), @p3='?' (Size = 8000) (DbType = AnsiString), @p4='?' (DbType = DateTime2), @p5='?' (DbType = DateTime2), @p6='?' (Size = 255), @p7='?' (Size = 4000), @p8='?' (Size = 255), @p9='?' (Size = 255), @p10='?' (Size = 255)], CommandType='"Text"', CommandTimeout='30']
SET IMPLICIT_TRANSACTIONS OFF;
SET NOCOUNT ON;
INSERT INTO [notification_templates] ([additional_data], [Body], [body_ar], [body_en], [created_at], [expiry_at], [Route], [target_criteria], [Title], [title_ar], [title_en])
OUTPUT INSERTED.[Id]
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7, @p8, @p9, @p10);
2025-02-01 00:33:30.080 +03:00 [INF] Created notification template with ID: 8
2025-02-01 00:33:30.285 +03:00 [INF] Executed DbCommand (16ms) [Parameters=[@p0='?' (Size = 4000), @p1='?' (DbType = DateTime2), @p2='?' (Size = 4000), @p3='?' (Size = 4000), @p4='?' (Size = 4000), @p5='?' (Size = 450), @p6='?' (Size = 4000), @p7='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SET IMPLICIT_TRANSACTIONS OFF;
SET NOCOUNT ON;
INSERT INTO [AuthLogs] ([AuthType], [CreatedAt], [DeviceId], [FailureReason], [IpAddress], [NationalId], [Status], [UserAgent])
OUTPUT INSERTED.[Id]
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7);
2025-02-01 00:33:30.340 +03:00 [INF] Executed DbCommand (12ms) [Parameters=[@__userId_0='?' (Size = 450)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [u].[national_id], [u].[last_updated], [u].[notifications]
FROM [user_notifications] AS [u]
WHERE [u].[national_id] = @__userId_0
2025-02-01 00:33:30.373 +03:00 [INF] Processing notification for user 1012345678. Existing notification record: true
2025-02-01 00:33:30.376 +03:00 [INF] Current notifications count for user 1012345678: 4
2025-02-01 00:33:30.396 +03:00 [INF] Serialized new notifications for user 1012345678. Length: 695
2025-02-01 00:33:30.436 +03:00 [INF] Executed DbCommand (25ms) [Parameters=[@p0='?' (Size = 4000), @p1='?' (DbType = DateTime2), @p2='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
UPDATE user_notifications SET notifications = @p0, last_updated = @p1 WHERE national_id = @p2
2025-02-01 00:33:30.444 +03:00 [INF] Updated existing UserNotification for user: 1012345678
2025-02-01 00:33:30.448 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@__userId_0='?' (Size = 450)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [u].[national_id], [u].[last_updated], [u].[notifications]
FROM [user_notifications] AS [u]
WHERE [u].[national_id] = @__userId_0
2025-02-01 00:33:30.451 +03:00 [INF] Processing notification for user 1034567890. Existing notification record: true
2025-02-01 00:33:30.457 +03:00 [INF] Current notifications count for user 1034567890: 1
2025-02-01 00:33:30.459 +03:00 [INF] Serialized new notifications for user 1034567890. Length: 278
2025-02-01 00:33:30.462 +03:00 [INF] Executed DbCommand (2ms) [Parameters=[@p0='?' (Size = 4000), @p1='?' (DbType = DateTime2), @p2='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
UPDATE user_notifications SET notifications = @p0, last_updated = @p1 WHERE national_id = @p2
2025-02-01 00:33:30.465 +03:00 [INF] Updated existing UserNotification for user: 1034567890
2025-02-01 00:33:30.467 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@__userId_0='?' (Size = 450)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [u].[national_id], [u].[last_updated], [u].[notifications]
FROM [user_notifications] AS [u]
WHERE [u].[national_id] = @__userId_0
2025-02-01 00:33:30.475 +03:00 [INF] Processing notification for user 1045678901. Existing notification record: true
2025-02-01 00:33:30.477 +03:00 [INF] Current notifications count for user 1045678901: 6
2025-02-01 00:33:30.478 +03:00 [INF] Serialized new notifications for user 1045678901. Length: 972
2025-02-01 00:33:30.481 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@p0='?' (Size = 4000), @p1='?' (DbType = DateTime2), @p2='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
UPDATE user_notifications SET notifications = @p0, last_updated = @p1 WHERE national_id = @p2
2025-02-01 00:33:30.483 +03:00 [INF] Updated existing UserNotification for user: 1045678901
2025-02-01 00:33:30.485 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@__userId_0='?' (Size = 450)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [u].[national_id], [u].[last_updated], [u].[notifications]
FROM [user_notifications] AS [u]
WHERE [u].[national_id] = @__userId_0
2025-02-01 00:33:30.494 +03:00 [INF] Processing notification for user 1056789012. Existing notification record: true
2025-02-01 00:33:30.495 +03:00 [INF] Current notifications count for user 1056789012: 1
2025-02-01 00:33:30.496 +03:00 [INF] Serialized new notifications for user 1056789012. Length: 278
2025-02-01 00:33:30.499 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@p0='?' (Size = 4000), @p1='?' (DbType = DateTime2), @p2='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
UPDATE user_notifications SET notifications = @p0, last_updated = @p1 WHERE national_id = @p2
2025-02-01 00:33:30.502 +03:00 [INF] Updated existing UserNotification for user: 1056789012
2025-02-01 00:33:30.508 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@__userId_0='?' (Size = 450)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [u].[national_id], [u].[last_updated], [u].[notifications]
FROM [user_notifications] AS [u]
WHERE [u].[national_id] = @__userId_0
2025-02-01 00:33:30.511 +03:00 [INF] Processing notification for user 1234567890. Existing notification record: true
2025-02-01 00:33:30.512 +03:00 [INF] Current notifications count for user 1234567890: 1
2025-02-01 00:33:30.513 +03:00 [INF] Serialized new notifications for user 1234567890. Length: 278
2025-02-01 00:33:30.516 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@p0='?' (Size = 4000), @p1='?' (DbType = DateTime2), @p2='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
UPDATE user_notifications SET notifications = @p0, last_updated = @p1 WHERE national_id = @p2
2025-02-01 00:33:30.518 +03:00 [INF] Updated existing UserNotification for user: 1234567890
2025-02-01 00:33:30.530 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@p0='?' (Size = 4000), @p1='?' (DbType = DateTime2), @p2='?' (Size = 4000), @p3='?' (Size = 4000), @p4='?' (Size = 4000), @p5='?' (Size = 450), @p6='?' (Size = 4000), @p7='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SET IMPLICIT_TRANSACTIONS OFF;
SET NOCOUNT ON;
INSERT INTO [AuthLogs] ([AuthType], [CreatedAt], [DeviceId], [FailureReason], [IpAddress], [NationalId], [Status], [UserAgent])
OUTPUT INSERTED.[Id]
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7);
2025-02-01 00:33:30.533 +03:00 [INF] Successfully sent notifications. Template: 8, Success: 5, Total: 5
2025-02-01 00:33:30.546 +03:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType9`2[[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Object, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-02-01 00:33:30.575 +03:00 [INF] Executed action NayifatAPI.Controllers.NotificationsController.SendNotification (NayifatAPI) in 5797.2867ms
2025-02-01 00:33:30.581 +03:00 [INF] Executed endpoint 'NayifatAPI.Controllers.NotificationsController.SendNotification (NayifatAPI)'
2025-02-01 00:33:30.600 +03:00 [INF] Request finished HTTP/1.1 POST http://localhost:5264/api/notifications/send - 200 null application/json; charset=utf-8 5919.0377ms
2025-02-01 00:33:56.117 +03:00 [INF] Request starting HTTP/1.1 POST http://localhost:5264/api/notifications/send - application/json 279
2025-02-01 00:33:56.160 +03:00 [INF] Executing endpoint 'NayifatAPI.Controllers.NotificationsController.SendNotification (NayifatAPI)'
2025-02-01 00:33:56.291 +03:00 [INF] Route matched with {action = "SendNotification", controller = "Notifications"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] SendNotification(NayifatAPI.Controllers.SendNotificationRequest) on controller NayifatAPI.Controllers.NotificationsController (NayifatAPI).
2025-02-01 00:33:56.401 +03:00 [INF] Executed DbCommand (42ms) [Parameters=[@__providedApiKey_0='?' (Size = 255)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [a].[Key], [a].[CreatedAt], [a].[Description], [a].[ExpiresAt], [a].[IsActive], [a].[LastUsedAt]
FROM [ApiKeys] AS [a]
WHERE [a].[Key] = @__providedApiKey_0 AND [a].[IsActive] = CAST(1 AS bit)
2025-02-01 00:33:56.420 +03:00 [INF] Received notification request: {"Title":null,"TitleEn":"Test Notification","TitleAr":"إشعار تجريبي","Filters":{"Customers.District":{"ValueKind":"Object","$type":"JsonElement"}},"NationalId":null,"NationalIds":null}
2025-02-01 00:33:56.427 +03:00 [INF] Starting GetTargetUsers with request type: Filtered Users
2025-02-01 00:33:56.428 +03:00 [INF] Processing filter: District LIKE o
2025-02-01 00:33:56.431 +03:00 [INF] Applied District string filter: LIKE o
2025-02-01 00:33:56.434 +03:00 [INF] Added filter group for customers.District
2025-02-01 00:33:56.437 +03:00 [INF] Executing filter query with operation: AND
2025-02-01 00:33:56.529 +03:00 [INF] Executed DbCommand (84ms) [Parameters=[@__Format_1='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SELECT [c].[NationalId]
FROM [Customers] AS [c]
WHERE [c].[District] LIKE @__Format_1
2025-02-01 00:33:56.536 +03:00 [INF] Found 1 users after applying filters
2025-02-01 00:33:56.538 +03:00 [INF] Target users query completed. Found 1 users
2025-02-01 00:33:56.539 +03:00 [INF] Found 1 target users for notification
2025-02-01 00:33:56.546 +03:00 [INF] Executed DbCommand (4ms) [Parameters=[@p0='?' (Size = 4000), @p1='?' (Size = 8000) (DbType = AnsiString), @p2='?' (Size = 8000) (DbType = AnsiString), @p3='?' (Size = 8000) (DbType = AnsiString), @p4='?' (DbType = DateTime2), @p5='?' (DbType = DateTime2), @p6='?' (Size = 255), @p7='?' (Size = 4000), @p8='?' (Size = 255), @p9='?' (Size = 255), @p10='?' (Size = 255)], CommandType='"Text"', CommandTimeout='30']
SET IMPLICIT_TRANSACTIONS OFF;
SET NOCOUNT ON;
INSERT INTO [notification_templates] ([additional_data], [Body], [body_ar], [body_en], [created_at], [expiry_at], [Route], [target_criteria], [Title], [title_ar], [title_en])
OUTPUT INSERTED.[Id]
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7, @p8, @p9, @p10);
2025-02-01 00:33:56.841 +03:00 [INF] Created notification template with ID: 9
2025-02-01 00:33:56.918 +03:00 [INF] Executed DbCommand (74ms) [Parameters=[@p0='?' (Size = 4000), @p1='?' (DbType = DateTime2), @p2='?' (Size = 4000), @p3='?' (Size = 4000), @p4='?' (Size = 4000), @p5='?' (Size = 450), @p6='?' (Size = 4000), @p7='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SET IMPLICIT_TRANSACTIONS OFF;
SET NOCOUNT ON;
INSERT INTO [AuthLogs] ([AuthType], [CreatedAt], [DeviceId], [FailureReason], [IpAddress], [NationalId], [Status], [UserAgent])
OUTPUT INSERTED.[Id]
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7);
2025-02-01 00:33:56.988 +03:00 [INF] Executed DbCommand (60ms) [Parameters=[@__userId_0='?' (Size = 450)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [u].[national_id], [u].[last_updated], [u].[notifications]
FROM [user_notifications] AS [u]
WHERE [u].[national_id] = @__userId_0
2025-02-01 00:33:57.405 +03:00 [INF] Processing notification for user 1012345678. Existing notification record: true
2025-02-01 00:33:57.409 +03:00 [INF] Current notifications count for user 1012345678: 5
2025-02-01 00:33:57.478 +03:00 [INF] Serialized new notifications for user 1012345678. Length: 834
2025-02-01 00:33:57.754 +03:00 [INF] Executed DbCommand (100ms) [Parameters=[@p0='?' (Size = 4000), @p1='?' (DbType = DateTime2), @p2='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
UPDATE user_notifications SET notifications = @p0, last_updated = @p1 WHERE national_id = @p2
2025-02-01 00:33:57.808 +03:00 [INF] Updated existing UserNotification for user: 1012345678
2025-02-01 00:33:57.902 +03:00 [INF] Executed DbCommand (92ms) [Parameters=[@p0='?' (Size = 4000), @p1='?' (DbType = DateTime2), @p2='?' (Size = 4000), @p3='?' (Size = 4000), @p4='?' (Size = 4000), @p5='?' (Size = 450), @p6='?' (Size = 4000), @p7='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SET IMPLICIT_TRANSACTIONS OFF;
SET NOCOUNT ON;
INSERT INTO [AuthLogs] ([AuthType], [CreatedAt], [DeviceId], [FailureReason], [IpAddress], [NationalId], [Status], [UserAgent])
OUTPUT INSERTED.[Id]
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7);
2025-02-01 00:33:58.228 +03:00 [INF] Successfully sent notifications. Template: 9, Success: 1, Total: 1
2025-02-01 00:33:58.232 +03:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType9`2[[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Object, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-02-01 00:33:58.236 +03:00 [INF] Executed action NayifatAPI.Controllers.NotificationsController.SendNotification (NayifatAPI) in 1932.127ms
2025-02-01 00:33:58.241 +03:00 [INF] Executed endpoint 'NayifatAPI.Controllers.NotificationsController.SendNotification (NayifatAPI)'
2025-02-01 00:33:58.242 +03:00 [INF] Request finished HTTP/1.1 POST http://localhost:5264/api/notifications/send - 200 null application/json; charset=utf-8 2126.0283ms
2025-02-01 00:34:27.346 +03:00 [INF] Request starting HTTP/1.1 POST http://localhost:5264/api/notifications/send - application/json 279
2025-02-01 00:34:27.350 +03:00 [INF] Executing endpoint 'NayifatAPI.Controllers.NotificationsController.SendNotification (NayifatAPI)'
2025-02-01 00:34:27.351 +03:00 [INF] Route matched with {action = "SendNotification", controller = "Notifications"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] SendNotification(NayifatAPI.Controllers.SendNotificationRequest) on controller NayifatAPI.Controllers.NotificationsController (NayifatAPI).
2025-02-01 00:34:27.465 +03:00 [INF] Executed DbCommand (3ms) [Parameters=[@__providedApiKey_0='?' (Size = 255)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [a].[Key], [a].[CreatedAt], [a].[Description], [a].[ExpiresAt], [a].[IsActive], [a].[LastUsedAt]
FROM [ApiKeys] AS [a]
WHERE [a].[Key] = @__providedApiKey_0 AND [a].[IsActive] = CAST(1 AS bit)
2025-02-01 00:34:27.467 +03:00 [INF] Received notification request: {"Title":null,"TitleEn":"Test Notification","TitleAr":"إشعار تجريبي","Filters":{"Customers.District":{"ValueKind":"Object","$type":"JsonElement"}},"NationalId":null,"NationalIds":null}
2025-02-01 00:34:27.471 +03:00 [INF] Starting GetTargetUsers with request type: Filtered Users
2025-02-01 00:34:27.471 +03:00 [INF] Processing filter: District LIKE o
2025-02-01 00:34:27.473 +03:00 [INF] Applied District string filter: LIKE o
2025-02-01 00:34:27.475 +03:00 [INF] Added filter group for customers.District
2025-02-01 00:34:27.476 +03:00 [INF] Executing filter query with operation: AND
2025-02-01 00:34:27.480 +03:00 [INF] Executed DbCommand (2ms) [Parameters=[@__Format_1='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SELECT [c].[NationalId]
FROM [Customers] AS [c]
WHERE [c].[District] LIKE @__Format_1
2025-02-01 00:34:27.482 +03:00 [INF] Found 1 users after applying filters
2025-02-01 00:34:27.482 +03:00 [INF] Target users query completed. Found 1 users
2025-02-01 00:34:27.483 +03:00 [INF] Found 1 target users for notification
2025-02-01 00:34:27.560 +03:00 [INF] Executed DbCommand (76ms) [Parameters=[@p0='?' (Size = 4000), @p1='?' (Size = 8000) (DbType = AnsiString), @p2='?' (Size = 8000) (DbType = AnsiString), @p3='?' (Size = 8000) (DbType = AnsiString), @p4='?' (DbType = DateTime2), @p5='?' (DbType = DateTime2), @p6='?' (Size = 255), @p7='?' (Size = 4000), @p8='?' (Size = 255), @p9='?' (Size = 255), @p10='?' (Size = 255)], CommandType='"Text"', CommandTimeout='30']
SET IMPLICIT_TRANSACTIONS OFF;
SET NOCOUNT ON;
INSERT INTO [notification_templates] ([additional_data], [Body], [body_ar], [body_en], [created_at], [expiry_at], [Route], [target_criteria], [Title], [title_ar], [title_en])
OUTPUT INSERTED.[Id]
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7, @p8, @p9, @p10);
2025-02-01 00:34:27.564 +03:00 [INF] Created notification template with ID: 1
2025-02-01 00:34:27.572 +03:00 [INF] Executed DbCommand (6ms) [Parameters=[@p0='?' (Size = 4000), @p1='?' (DbType = DateTime2), @p2='?' (Size = 4000), @p3='?' (Size = 4000), @p4='?' (Size = 4000), @p5='?' (Size = 450), @p6='?' (Size = 4000), @p7='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SET IMPLICIT_TRANSACTIONS OFF;
SET NOCOUNT ON;
INSERT INTO [AuthLogs] ([AuthType], [CreatedAt], [DeviceId], [FailureReason], [IpAddress], [NationalId], [Status], [UserAgent])
OUTPUT INSERTED.[Id]
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7);
2025-02-01 00:34:27.580 +03:00 [INF] Executed DbCommand (2ms) [Parameters=[@__userId_0='?' (Size = 450)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [u].[national_id], [u].[last_updated], [u].[notifications]
FROM [user_notifications] AS [u]
WHERE [u].[national_id] = @__userId_0
2025-02-01 00:34:27.583 +03:00 [INF] Processing notification for user 1012345678. Existing notification record: false
2025-02-01 00:34:27.584 +03:00 [INF] Current notifications count for user 1012345678: 0
2025-02-01 00:34:27.585 +03:00 [INF] Serialized new notifications for user 1012345678. Length: 140
2025-02-01 00:34:27.607 +03:00 [INF] Executed DbCommand (4ms) [Parameters=[@p0='?' (Size = 4000), @p1='?' (Size = 4000), @p2='?' (DbType = DateTime2)], CommandType='"Text"', CommandTimeout='30']
INSERT INTO user_notifications (national_id, notifications, last_updated) VALUES (@p0, @p1, @p2)
2025-02-01 00:34:27.612 +03:00 [INF] Created new UserNotification entry for user: 1012345678
2025-02-01 00:34:27.615 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@p0='?' (Size = 4000), @p1='?' (DbType = DateTime2), @p2='?' (Size = 4000), @p3='?' (Size = 4000), @p4='?' (Size = 4000), @p5='?' (Size = 450), @p6='?' (Size = 4000), @p7='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SET IMPLICIT_TRANSACTIONS OFF;
SET NOCOUNT ON;
INSERT INTO [AuthLogs] ([AuthType], [CreatedAt], [DeviceId], [FailureReason], [IpAddress], [NationalId], [Status], [UserAgent])
OUTPUT INSERTED.[Id]
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7);
2025-02-01 00:34:27.618 +03:00 [INF] Successfully sent notifications. Template: 1, Success: 1, Total: 1
2025-02-01 00:34:27.619 +03:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType9`2[[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Object, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-02-01 00:34:27.621 +03:00 [INF] Executed action NayifatAPI.Controllers.NotificationsController.SendNotification (NayifatAPI) in 268.3071ms
2025-02-01 00:34:27.625 +03:00 [INF] Executed endpoint 'NayifatAPI.Controllers.NotificationsController.SendNotification (NayifatAPI)'
2025-02-01 00:34:27.627 +03:00 [INF] Request finished HTTP/1.1 POST http://localhost:5264/api/notifications/send - 200 null application/json; charset=utf-8 280.6414ms
2025-02-01 00:35:44.083 +03:00 [INF] Request starting HTTP/1.1 POST http://localhost:5264/api/notifications/send - application/json 298
2025-02-01 00:35:44.087 +03:00 [INF] Executing endpoint 'NayifatAPI.Controllers.NotificationsController.SendNotification (NayifatAPI)'
2025-02-01 00:35:44.088 +03:00 [INF] Route matched with {action = "SendNotification", controller = "Notifications"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] SendNotification(NayifatAPI.Controllers.SendNotificationRequest) on controller NayifatAPI.Controllers.NotificationsController (NayifatAPI).
2025-02-01 00:35:44.093 +03:00 [INF] Executed DbCommand (2ms) [Parameters=[@__providedApiKey_0='?' (Size = 255)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [a].[Key], [a].[CreatedAt], [a].[Description], [a].[ExpiresAt], [a].[IsActive], [a].[LastUsedAt]
FROM [ApiKeys] AS [a]
WHERE [a].[Key] = @__providedApiKey_0 AND [a].[IsActive] = CAST(1 AS bit)
2025-02-01 00:35:44.096 +03:00 [INF] Received notification request: {"Title":null,"TitleEn":"Test Notification","TitleAr":"إشعار تجريبي","Filters":{"Customers.SalaryCustomer":{"ValueKind":"Object","$type":"JsonElement"}},"NationalId":null,"NationalIds":null}
2025-02-01 00:35:44.101 +03:00 [INF] Starting GetTargetUsers with request type: Filtered Users
2025-02-01 00:35:44.108 +03:00 [INF] Applied SalaryCustomer BETWEEN filter: 5000 AND 15000
2025-02-01 00:35:44.111 +03:00 [INF] Added filter group for field SalaryCustomer
2025-02-01 00:35:44.217 +03:00 [INF] Executing filter query with operation: AND
2025-02-01 00:35:44.243 +03:00 [INF] Executed DbCommand (4ms) [Parameters=[@__value_0='?' (Precision = 18) (Scale = 2) (DbType = Decimal), @__value2_Value_1='?' (Precision = 18) (Scale = 2) (DbType = Decimal)], CommandType='"Text"', CommandTimeout='30']
SELECT [c].[NationalId]
FROM [Customers] AS [c]
WHERE [c].[SalaryCustomer] >= @__value_0 AND [c].[SalaryCustomer] <= @__value2_Value_1
2025-02-01 00:35:44.245 +03:00 [INF] Found 3 users after applying filters
2025-02-01 00:35:44.246 +03:00 [INF] Target users query completed. Found 3 users
2025-02-01 00:35:44.247 +03:00 [INF] Found 3 target users for notification
2025-02-01 00:35:44.276 +03:00 [INF] Executed DbCommand (10ms) [Parameters=[@p0='?' (Size = 4000), @p1='?' (Size = 8000) (DbType = AnsiString), @p2='?' (Size = 8000) (DbType = AnsiString), @p3='?' (Size = 8000) (DbType = AnsiString), @p4='?' (DbType = DateTime2), @p5='?' (DbType = DateTime2), @p6='?' (Size = 255), @p7='?' (Size = 4000), @p8='?' (Size = 255), @p9='?' (Size = 255), @p10='?' (Size = 255)], CommandType='"Text"', CommandTimeout='30']
SET IMPLICIT_TRANSACTIONS OFF;
SET NOCOUNT ON;
INSERT INTO [notification_templates] ([additional_data], [Body], [body_ar], [body_en], [created_at], [expiry_at], [Route], [target_criteria], [Title], [title_ar], [title_en])
OUTPUT INSERTED.[Id]
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7, @p8, @p9, @p10);
2025-02-01 00:35:44.279 +03:00 [INF] Created notification template with ID: 2
2025-02-01 00:35:44.283 +03:00 [INF] Executed DbCommand (3ms) [Parameters=[@p0='?' (Size = 4000), @p1='?' (DbType = DateTime2), @p2='?' (Size = 4000), @p3='?' (Size = 4000), @p4='?' (Size = 4000), @p5='?' (Size = 450), @p6='?' (Size = 4000), @p7='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SET IMPLICIT_TRANSACTIONS OFF;
SET NOCOUNT ON;
INSERT INTO [AuthLogs] ([AuthType], [CreatedAt], [DeviceId], [FailureReason], [IpAddress], [NationalId], [Status], [UserAgent])
OUTPUT INSERTED.[Id]
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7);
2025-02-01 00:35:44.292 +03:00 [INF] Executed DbCommand (6ms) [Parameters=[@__userId_0='?' (Size = 450)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [u].[national_id], [u].[last_updated], [u].[notifications]
FROM [user_notifications] AS [u]
WHERE [u].[national_id] = @__userId_0
2025-02-01 00:35:44.294 +03:00 [INF] Processing notification for user 1012345678. Existing notification record: true
2025-02-01 00:35:44.295 +03:00 [INF] Current notifications count for user 1012345678: 1
2025-02-01 00:35:44.296 +03:00 [INF] Serialized new notifications for user 1012345678. Length: 279
2025-02-01 00:35:44.302 +03:00 [INF] Executed DbCommand (5ms) [Parameters=[@p0='?' (Size = 4000), @p1='?' (DbType = DateTime2), @p2='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
UPDATE user_notifications SET notifications = @p0, last_updated = @p1 WHERE national_id = @p2
2025-02-01 00:35:44.308 +03:00 [INF] Updated existing UserNotification for user: 1012345678
2025-02-01 00:35:44.310 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@__userId_0='?' (Size = 450)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [u].[national_id], [u].[last_updated], [u].[notifications]
FROM [user_notifications] AS [u]
WHERE [u].[national_id] = @__userId_0
2025-02-01 00:35:44.312 +03:00 [INF] Processing notification for user 1023456789. Existing notification record: false
2025-02-01 00:35:44.313 +03:00 [INF] Current notifications count for user 1023456789: 0
2025-02-01 00:35:44.314 +03:00 [INF] Serialized new notifications for user 1023456789. Length: 140
2025-02-01 00:35:44.316 +03:00 [INF] Executed DbCommand (2ms) [Parameters=[@p0='?' (Size = 4000), @p1='?' (Size = 4000), @p2='?' (DbType = DateTime2)], CommandType='"Text"', CommandTimeout='30']
INSERT INTO user_notifications (national_id, notifications, last_updated) VALUES (@p0, @p1, @p2)
2025-02-01 00:35:44.318 +03:00 [INF] Created new UserNotification entry for user: 1023456789
2025-02-01 00:35:44.320 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@__userId_0='?' (Size = 450)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [u].[national_id], [u].[last_updated], [u].[notifications]
FROM [user_notifications] AS [u]
WHERE [u].[national_id] = @__userId_0
2025-02-01 00:35:44.326 +03:00 [INF] Processing notification for user 1045678901. Existing notification record: false
2025-02-01 00:35:44.326 +03:00 [INF] Current notifications count for user 1045678901: 0
2025-02-01 00:35:44.327 +03:00 [INF] Serialized new notifications for user 1045678901. Length: 140
2025-02-01 00:35:44.330 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@p0='?' (Size = 4000), @p1='?' (Size = 4000), @p2='?' (DbType = DateTime2)], CommandType='"Text"', CommandTimeout='30']
INSERT INTO user_notifications (national_id, notifications, last_updated) VALUES (@p0, @p1, @p2)
2025-02-01 00:35:44.332 +03:00 [INF] Created new UserNotification entry for user: 1045678901
2025-02-01 00:35:44.334 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@p0='?' (Size = 4000), @p1='?' (DbType = DateTime2), @p2='?' (Size = 4000), @p3='?' (Size = 4000), @p4='?' (Size = 4000), @p5='?' (Size = 450), @p6='?' (Size = 4000), @p7='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SET IMPLICIT_TRANSACTIONS OFF;
SET NOCOUNT ON;
INSERT INTO [AuthLogs] ([AuthType], [CreatedAt], [DeviceId], [FailureReason], [IpAddress], [NationalId], [Status], [UserAgent])
OUTPUT INSERTED.[Id]
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7);
2025-02-01 00:35:44.336 +03:00 [INF] Successfully sent notifications. Template: 2, Success: 3, Total: 3
2025-02-01 00:35:44.337 +03:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType9`2[[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Object, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-02-01 00:35:44.342 +03:00 [INF] Executed action NayifatAPI.Controllers.NotificationsController.SendNotification (NayifatAPI) in 252.2377ms
2025-02-01 00:35:44.344 +03:00 [INF] Executed endpoint 'NayifatAPI.Controllers.NotificationsController.SendNotification (NayifatAPI)'
2025-02-01 00:35:44.345 +03:00 [INF] Request finished HTTP/1.1 POST http://localhost:5264/api/notifications/send - 200 null application/json; charset=utf-8 261.665ms
2025-02-01 00:38:22.001 +03:00 [INF] Application is shutting down...
2025-02-01 00:38:30.932 +03:00 [INF] Starting web application
2025-02-01 00:38:31.186 +03:00 [INF] Now listening on: http://localhost:5264
2025-02-01 00:38:31.245 +03:00 [INF] Application started. Press Ctrl+C to shut down.
2025-02-01 00:38:31.248 +03:00 [INF] Hosting environment: Development
2025-02-01 00:38:31.250 +03:00 [INF] Content root path: C:\Users\yamta\StudioProjects\nayifat_app_2025_new\NayifatAPI
2025-02-01 00:38:42.348 +03:00 [INF] Request starting HTTP/1.1 POST http://localhost:5264/api/notifications/send - application/json 298
2025-02-01 00:38:42.420 +03:00 [WRN] Failed to determine the https port for redirect.
2025-02-01 00:38:42.425 +03:00 [INF] Executing endpoint 'NayifatAPI.Controllers.NotificationsController.SendNotification (NayifatAPI)'
2025-02-01 00:38:42.459 +03:00 [INF] Route matched with {action = "SendNotification", controller = "Notifications"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] SendNotification(NayifatAPI.Controllers.SendNotificationRequest) on controller NayifatAPI.Controllers.NotificationsController (NayifatAPI).
2025-02-01 00:38:44.881 +03:00 [INF] Executed DbCommand (33ms) [Parameters=[@__providedApiKey_0='?' (Size = 255)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [a].[Key], [a].[CreatedAt], [a].[Description], [a].[ExpiresAt], [a].[IsActive], [a].[LastUsedAt]
FROM [ApiKeys] AS [a]
WHERE [a].[Key] = @__providedApiKey_0 AND [a].[IsActive] = CAST(1 AS bit)
2025-02-01 00:38:45.034 +03:00 [INF] Received notification request: {"Title":null,"TitleEn":"Test Notification","TitleAr":"إشعار تجريبي","Filters":{"Customers.SalaryCustomer":{"ValueKind":"Object","$type":"JsonElement"}},"NationalId":null,"NationalIds":null}
2025-02-01 00:38:45.057 +03:00 [INF] Starting GetTargetUsers with request type: Filtered Users
2025-02-01 00:38:45.070 +03:00 [INF] Processing filter for table: customers, field: SalaryCustomer
2025-02-01 00:38:45.086 +03:00 [INF] Applied SalaryCustomer BETWEEN filter: 5000 AND 15000
2025-02-01 00:38:45.088 +03:00 [INF] Added filter group for field SalaryCustomer
2025-02-01 00:38:45.090 +03:00 [INF] Executing filter query with operation: AND
2025-02-01 00:38:45.169 +03:00 [INF] Executed DbCommand (17ms) [Parameters=[@__value_0='?' (Precision = 18) (Scale = 2) (DbType = Decimal), @__value2_Value_1='?' (Precision = 18) (Scale = 2) (DbType = Decimal)], CommandType='"Text"', CommandTimeout='30']
SELECT [c].[NationalId]
FROM [Customers] AS [c]
WHERE [c].[SalaryCustomer] >= @__value_0 AND [c].[SalaryCustomer] <= @__value2_Value_1
2025-02-01 00:38:45.182 +03:00 [INF] Found 3 users after applying filters
2025-02-01 00:38:45.183 +03:00 [INF] Target users query completed. Found 3 users
2025-02-01 00:38:45.184 +03:00 [INF] Found 3 target users for notification
2025-02-01 00:38:45.471 +03:00 [INF] Executed DbCommand (81ms) [Parameters=[@p0='?' (Size = 4000), @p1='?' (Size = 8000) (DbType = AnsiString), @p2='?' (Size = 8000) (DbType = AnsiString), @p3='?' (Size = 8000) (DbType = AnsiString), @p4='?' (DbType = DateTime2), @p5='?' (DbType = DateTime2), @p6='?' (Size = 255), @p7='?' (Size = 4000), @p8='?' (Size = 255), @p9='?' (Size = 255), @p10='?' (Size = 255)], CommandType='"Text"', CommandTimeout='30']
SET IMPLICIT_TRANSACTIONS OFF;
SET NOCOUNT ON;
INSERT INTO [notification_templates] ([additional_data], [Body], [body_ar], [body_en], [created_at], [expiry_at], [Route], [target_criteria], [Title], [title_ar], [title_en])
OUTPUT INSERTED.[Id]
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7, @p8, @p9, @p10);
2025-02-01 00:38:45.520 +03:00 [INF] Created notification template with ID: 1
2025-02-01 00:38:45.640 +03:00 [INF] Executed DbCommand (9ms) [Parameters=[@p0='?' (Size = 4000), @p1='?' (DbType = DateTime2), @p2='?' (Size = 4000), @p3='?' (Size = 4000), @p4='?' (Size = 4000), @p5='?' (Size = 450), @p6='?' (Size = 4000), @p7='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SET IMPLICIT_TRANSACTIONS OFF;
SET NOCOUNT ON;
INSERT INTO [AuthLogs] ([AuthType], [CreatedAt], [DeviceId], [FailureReason], [IpAddress], [NationalId], [Status], [UserAgent])
OUTPUT INSERTED.[Id]
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7);
2025-02-01 00:38:45.674 +03:00 [INF] Executed DbCommand (3ms) [Parameters=[@__userId_0='?' (Size = 450)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [u].[national_id], [u].[last_updated], [u].[notifications]
FROM [user_notifications] AS [u]
WHERE [u].[national_id] = @__userId_0
2025-02-01 00:38:45.681 +03:00 [INF] Processing notification for user 1012345678. Existing notification record: false
2025-02-01 00:38:45.684 +03:00 [INF] Current notifications count for user 1012345678: 0
2025-02-01 00:38:45.710 +03:00 [INF] Serialized new notifications for user 1012345678. Length: 140
2025-02-01 00:38:45.748 +03:00 [INF] Executed DbCommand (23ms) [Parameters=[@p0='?' (Size = 4000), @p1='?' (Size = 4000), @p2='?' (DbType = DateTime2)], CommandType='"Text"', CommandTimeout='30']
INSERT INTO user_notifications (national_id, notifications, last_updated) VALUES (@p0, @p1, @p2)
2025-02-01 00:38:45.752 +03:00 [INF] Created new UserNotification entry for user: 1012345678
2025-02-01 00:38:45.757 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@__userId_0='?' (Size = 450)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [u].[national_id], [u].[last_updated], [u].[notifications]
FROM [user_notifications] AS [u]
WHERE [u].[national_id] = @__userId_0
2025-02-01 00:38:45.761 +03:00 [INF] Processing notification for user 1023456789. Existing notification record: false
2025-02-01 00:38:45.764 +03:00 [INF] Current notifications count for user 1023456789: 0
2025-02-01 00:38:45.767 +03:00 [INF] Serialized new notifications for user 1023456789. Length: 140
2025-02-01 00:38:45.771 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@p0='?' (Size = 4000), @p1='?' (Size = 4000), @p2='?' (DbType = DateTime2)], CommandType='"Text"', CommandTimeout='30']
INSERT INTO user_notifications (national_id, notifications, last_updated) VALUES (@p0, @p1, @p2)
2025-02-01 00:38:45.775 +03:00 [INF] Created new UserNotification entry for user: 1023456789
2025-02-01 00:38:45.782 +03:00 [INF] Executed DbCommand (5ms) [Parameters=[@__userId_0='?' (Size = 450)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [u].[national_id], [u].[last_updated], [u].[notifications]
FROM [user_notifications] AS [u]
WHERE [u].[national_id] = @__userId_0
2025-02-01 00:38:45.785 +03:00 [INF] Processing notification for user 1045678901. Existing notification record: false
2025-02-01 00:38:45.786 +03:00 [INF] Current notifications count for user 1045678901: 0
2025-02-01 00:38:45.788 +03:00 [INF] Serialized new notifications for user 1045678901. Length: 140
2025-02-01 00:38:45.791 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@p0='?' (Size = 4000), @p1='?' (Size = 4000), @p2='?' (DbType = DateTime2)], CommandType='"Text"', CommandTimeout='30']
INSERT INTO user_notifications (national_id, notifications, last_updated) VALUES (@p0, @p1, @p2)
2025-02-01 00:38:45.793 +03:00 [INF] Created new UserNotification entry for user: 1045678901
2025-02-01 00:38:45.800 +03:00 [INF] Executed DbCommand (2ms) [Parameters=[@p0='?' (Size = 4000), @p1='?' (DbType = DateTime2), @p2='?' (Size = 4000), @p3='?' (Size = 4000), @p4='?' (Size = 4000), @p5='?' (Size = 450), @p6='?' (Size = 4000), @p7='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SET IMPLICIT_TRANSACTIONS OFF;
SET NOCOUNT ON;
INSERT INTO [AuthLogs] ([AuthType], [CreatedAt], [DeviceId], [FailureReason], [IpAddress], [NationalId], [Status], [UserAgent])
OUTPUT INSERTED.[Id]
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7);
2025-02-01 00:38:45.804 +03:00 [INF] Successfully sent notifications. Template: 1, Success: 3, Total: 3
2025-02-01 00:38:45.820 +03:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType9`2[[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Object, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-02-01 00:38:45.847 +03:00 [INF] Executed action NayifatAPI.Controllers.NotificationsController.SendNotification (NayifatAPI) in 3379.7234ms
2025-02-01 00:38:45.851 +03:00 [INF] Executed endpoint 'NayifatAPI.Controllers.NotificationsController.SendNotification (NayifatAPI)'
2025-02-01 00:38:45.864 +03:00 [INF] Request finished HTTP/1.1 POST http://localhost:5264/api/notifications/send - 200 null application/json; charset=utf-8 3519.4025ms
2025-02-01 00:42:05.173 +03:00 [INF] Application is shutting down...
2025-02-01 00:42:17.210 +03:00 [INF] Starting web application
2025-02-01 00:42:17.328 +03:00 [INF] Now listening on: http://localhost:5264
2025-02-01 00:42:17.334 +03:00 [INF] Application started. Press Ctrl+C to shut down.
2025-02-01 00:42:17.335 +03:00 [INF] Hosting environment: Development
2025-02-01 00:42:17.336 +03:00 [INF] Content root path: C:\Users\yamta\StudioProjects\nayifat_app_2025_new\NayifatAPI
2025-02-01 00:42:21.419 +03:00 [INF] Request starting HTTP/1.1 POST http://localhost:5264/api/notifications/send - application/json 298
2025-02-01 00:42:21.478 +03:00 [WRN] Failed to determine the https port for redirect.
2025-02-01 00:42:21.482 +03:00 [INF] Executing endpoint 'NayifatAPI.Controllers.NotificationsController.SendNotification (NayifatAPI)'
2025-02-01 00:42:21.501 +03:00 [INF] Route matched with {action = "SendNotification", controller = "Notifications"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] SendNotification(NayifatAPI.Controllers.SendNotificationRequest) on controller NayifatAPI.Controllers.NotificationsController (NayifatAPI).
2025-02-01 00:42:25.175 +03:00 [INF] Executed DbCommand (136ms) [Parameters=[@__providedApiKey_0='?' (Size = 255)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [a].[Key], [a].[CreatedAt], [a].[Description], [a].[ExpiresAt], [a].[IsActive], [a].[LastUsedAt]
FROM [ApiKeys] AS [a]
WHERE [a].[Key] = @__providedApiKey_0 AND [a].[IsActive] = CAST(1 AS bit)
2025-02-01 00:42:25.690 +03:00 [INF] Received notification request: {"Title":null,"TitleEn":"Test Notification","TitleAr":"إشعار تجريبي","Filters":{"Customers.SalaryCustomer":{"ValueKind":"Object","$type":"JsonElement"}},"NationalId":null,"NationalIds":null}
2025-02-01 00:42:26.089 +03:00 [INF] Starting GetTargetUsers with request type: Filtered Users
2025-02-01 00:42:26.097 +03:00 [INF] Processing filter for table: customers, field: SalaryCustomer
2025-02-01 00:42:26.106 +03:00 [INF] Applied SalaryCustomer BETWEEN filter: 5000 AND 15000
2025-02-01 00:42:26.113 +03:00 [INF] Added filter group for field SalaryCustomer
2025-02-01 00:42:26.116 +03:00 [INF] Executing filter query with operation: AND
2025-02-01 00:42:26.201 +03:00 [INF] Executed DbCommand (17ms) [Parameters=[@__value_0='?' (Precision = 18) (Scale = 2) (DbType = Decimal), @__value2_Value_1='?' (Precision = 18) (Scale = 2) (DbType = Decimal)], CommandType='"Text"', CommandTimeout='30']
SELECT [c].[NationalId]
FROM [Customers] AS [c]
WHERE [c].[SalaryCustomer] >= @__value_0 AND [c].[SalaryCustomer] <= @__value2_Value_1
2025-02-01 00:42:26.222 +03:00 [INF] Found 3 users after applying filters
2025-02-01 00:42:26.223 +03:00 [INF] Target users query completed. Found 3 users
2025-02-01 00:42:26.224 +03:00 [INF] Found 3 target users for notification
2025-02-01 00:42:26.544 +03:00 [INF] Executed DbCommand (79ms) [Parameters=[@p0='?' (Size = 4000), @p1='?' (Size = 8000) (DbType = AnsiString), @p2='?' (Size = 8000) (DbType = AnsiString), @p3='?' (Size = 8000) (DbType = AnsiString), @p4='?' (DbType = DateTime2), @p5='?' (DbType = DateTime2), @p6='?' (Size = 255), @p7='?' (Size = 4000), @p8='?' (Size = 255), @p9='?' (Size = 255), @p10='?' (Size = 255)], CommandType='"Text"', CommandTimeout='30']
SET IMPLICIT_TRANSACTIONS OFF;
SET NOCOUNT ON;
INSERT INTO [notification_templates] ([additional_data], [Body], [body_ar], [body_en], [created_at], [expiry_at], [Route], [target_criteria], [Title], [title_ar], [title_en])
OUTPUT INSERTED.[Id]
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7, @p8, @p9, @p10);
2025-02-01 00:42:26.599 +03:00 [INF] Created notification template with ID: 2
2025-02-01 00:42:26.737 +03:00 [INF] Executed DbCommand (81ms) [Parameters=[@p0='?' (Size = 4000), @p1='?' (DbType = DateTime2), @p2='?' (Size = 4000), @p3='?' (Size = 4000), @p4='?' (Size = 4000), @p5='?' (Size = 450), @p6='?' (Size = 4000), @p7='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SET IMPLICIT_TRANSACTIONS OFF;
SET NOCOUNT ON;
INSERT INTO [AuthLogs] ([AuthType], [CreatedAt], [DeviceId], [FailureReason], [IpAddress], [NationalId], [Status], [UserAgent])
OUTPUT INSERTED.[Id]
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7);
2025-02-01 00:42:26.771 +03:00 [INF] Executed DbCommand (3ms) [Parameters=[@__userId_0='?' (Size = 450)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [u].[national_id], [u].[last_updated], [u].[notifications]
FROM [user_notifications] AS [u]
WHERE [u].[national_id] = @__userId_0
2025-02-01 00:42:26.792 +03:00 [INF] Processing notification for user 1012345678. Existing notification record: true
2025-02-01 00:42:26.797 +03:00 [INF] Current notifications count for user 1012345678: 1
2025-02-01 00:42:26.822 +03:00 [INF] Serialized new notifications for user 1012345678. Length: 279
2025-02-01 00:42:26.866 +03:00 [INF] Executed DbCommand (29ms) [Parameters=[@p0='?' (Size = 4000), @p1='?' (DbType = DateTime2), @p2='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
UPDATE user_notifications SET notifications = @p0, last_updated = @p1 WHERE national_id = @p2
2025-02-01 00:42:26.871 +03:00 [INF] Updated existing UserNotification for user: 1012345678
2025-02-01 00:42:26.880 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@__userId_0='?' (Size = 450)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [u].[national_id], [u].[last_updated], [u].[notifications]
FROM [user_notifications] AS [u]
WHERE [u].[national_id] = @__userId_0
2025-02-01 00:42:26.883 +03:00 [INF] Processing notification for user 1023456789. Existing notification record: true
2025-02-01 00:42:26.884 +03:00 [INF] Current notifications count for user 1023456789: 1
2025-02-01 00:42:26.885 +03:00 [INF] Serialized new notifications for user 1023456789. Length: 279
2025-02-01 00:42:26.888 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@p0='?' (Size = 4000), @p1='?' (DbType = DateTime2), @p2='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
UPDATE user_notifications SET notifications = @p0, last_updated = @p1 WHERE national_id = @p2
2025-02-01 00:42:26.892 +03:00 [INF] Updated existing UserNotification for user: 1023456789
2025-02-01 00:42:26.897 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@__userId_0='?' (Size = 450)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [u].[national_id], [u].[last_updated], [u].[notifications]
FROM [user_notifications] AS [u]
WHERE [u].[national_id] = @__userId_0
2025-02-01 00:42:26.901 +03:00 [INF] Processing notification for user 1045678901. Existing notification record: true
2025-02-01 00:42:26.902 +03:00 [INF] Current notifications count for user 1045678901: 1
2025-02-01 00:42:26.904 +03:00 [INF] Serialized new notifications for user 1045678901. Length: 279
2025-02-01 00:42:26.907 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@p0='?' (Size = 4000), @p1='?' (DbType = DateTime2), @p2='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
UPDATE user_notifications SET notifications = @p0, last_updated = @p1 WHERE national_id = @p2
2025-02-01 00:42:26.912 +03:00 [INF] Updated existing UserNotification for user: 1045678901
2025-02-01 00:42:26.923 +03:00 [INF] Executed DbCommand (2ms) [Parameters=[@p0='?' (Size = 4000), @p1='?' (DbType = DateTime2), @p2='?' (Size = 4000), @p3='?' (Size = 4000), @p4='?' (Size = 4000), @p5='?' (Size = 450), @p6='?' (Size = 4000), @p7='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SET IMPLICIT_TRANSACTIONS OFF;
SET NOCOUNT ON;
INSERT INTO [AuthLogs] ([AuthType], [CreatedAt], [DeviceId], [FailureReason], [IpAddress], [NationalId], [Status], [UserAgent])
OUTPUT INSERTED.[Id]
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7);
2025-02-01 00:42:26.930 +03:00 [INF] Successfully sent notifications. Template: 2, Success: 3, Total: 3
2025-02-01 00:42:26.943 +03:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType9`2[[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Object, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-02-01 00:42:26.973 +03:00 [INF] Executed action NayifatAPI.Controllers.NotificationsController.SendNotification (NayifatAPI) in 5464.3695ms
2025-02-01 00:42:26.977 +03:00 [INF] Executed endpoint 'NayifatAPI.Controllers.NotificationsController.SendNotification (NayifatAPI)'
2025-02-01 00:42:26.991 +03:00 [INF] Request finished HTTP/1.1 POST http://localhost:5264/api/notifications/send - 200 null application/json; charset=utf-8 5573.173ms
2025-02-01 00:44:43.648 +03:00 [INF] Application is shutting down...
2025-02-01 00:46:00.902 +03:00 [INF] Executed DbCommand (15ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT 1
2025-02-01 00:46:00.959 +03:00 [INF] Executed DbCommand (10ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT OBJECT_ID(N'[__EFMigrationsHistory]');
2025-02-01 00:46:00.963 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT 1
2025-02-01 00:46:00.965 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT OBJECT_ID(N'[__EFMigrationsHistory]');
2025-02-01 00:46:00.980 +03:00 [INF] Executed DbCommand (2ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT [MigrationId], [ProductVersion]
FROM [__EFMigrationsHistory]
ORDER BY [MigrationId];
2025-02-01 00:46:00.997 +03:00 [INF] Applying migration '20250131214538_FixArabicBodyEncoding'.
2025-02-01 00:46:01.167 +03:00 [ERR] Failed executing DbCommand (81ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
ALTER TABLE [User_Notifications] DROP CONSTRAINT [FK_User_Notifications_Customers_NationalId];
2025-02-01 00:46:19.466 +03:00 [INF] Executed DbCommand (23ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT 1
2025-02-01 00:46:19.549 +03:00 [INF] Executed DbCommand (17ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT OBJECT_ID(N'[__EFMigrationsHistory]');
2025-02-01 00:46:19.567 +03:00 [INF] Executed DbCommand (4ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT [MigrationId], [ProductVersion]
FROM [__EFMigrationsHistory]
ORDER BY [MigrationId];
2025-02-01 00:47:58.094 +03:00 [INF] Starting web application
2025-02-01 00:47:58.200 +03:00 [INF] Now listening on: http://localhost:5264
2025-02-01 00:47:58.205 +03:00 [INF] Application started. Press Ctrl+C to shut down.
2025-02-01 00:47:58.206 +03:00 [INF] Hosting environment: Development
2025-02-01 00:47:58.206 +03:00 [INF] Content root path: C:\Users\yamta\StudioProjects\nayifat_app_2025_new\NayifatAPI
2025-02-01 00:48:22.423 +03:00 [INF] Request starting HTTP/1.1 POST http://localhost:5264/api/notifications/send - application/json 298
2025-02-01 00:48:22.609 +03:00 [WRN] Failed to determine the https port for redirect.
2025-02-01 00:48:22.738 +03:00 [INF] Executing endpoint 'NayifatAPI.Controllers.NotificationsController.SendNotification (NayifatAPI)'
2025-02-01 00:48:22.793 +03:00 [INF] Route matched with {action = "SendNotification", controller = "Notifications"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] SendNotification(NayifatAPI.Controllers.SendNotificationRequest) on controller NayifatAPI.Controllers.NotificationsController (NayifatAPI).
2025-02-01 00:48:26.054 +03:00 [INF] Executed DbCommand (27ms) [Parameters=[@__providedApiKey_0='?' (Size = 255)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [a].[Key], [a].[CreatedAt], [a].[Description], [a].[ExpiresAt], [a].[IsActive], [a].[LastUsedAt]
FROM [ApiKeys] AS [a]
WHERE [a].[Key] = @__providedApiKey_0 AND [a].[IsActive] = CAST(1 AS bit)
2025-02-01 00:48:26.146 +03:00 [INF] Received notification request: {"Title":null,"TitleEn":"Test Notification","TitleAr":"إشعار تجريبي","Filters":{"Customers.SalaryCustomer":{"ValueKind":"Object","$type":"JsonElement"}},"NationalId":null,"NationalIds":null}
2025-02-01 00:48:26.162 +03:00 [INF] Starting GetTargetUsers with request type: Filtered Users
2025-02-01 00:48:26.169 +03:00 [INF] Processing filter for table: customers, field: SalaryCustomer
2025-02-01 00:48:26.179 +03:00 [INF] Applied SalaryCustomer BETWEEN filter: 5000 AND 15000
2025-02-01 00:48:26.182 +03:00 [INF] Added filter group for field SalaryCustomer
2025-02-01 00:48:26.183 +03:00 [INF] Executing filter query with operation: AND
2025-02-01 00:48:26.256 +03:00 [INF] Executed DbCommand (16ms) [Parameters=[@__value_0='?' (Precision = 18) (Scale = 2) (DbType = Decimal), @__value2_Value_1='?' (Precision = 18) (Scale = 2) (DbType = Decimal)], CommandType='"Text"', CommandTimeout='30']
SELECT [c].[NationalId]
FROM [Customers] AS [c]
WHERE [c].[SalaryCustomer] >= @__value_0 AND [c].[SalaryCustomer] <= @__value2_Value_1
2025-02-01 00:48:26.268 +03:00 [INF] Found 3 users after applying filters
2025-02-01 00:48:26.270 +03:00 [INF] Target users query completed. Found 3 users
2025-02-01 00:48:26.271 +03:00 [INF] Found 3 target users for notification
2025-02-01 00:48:26.434 +03:00 [INF] Executed DbCommand (13ms) [Parameters=[@p0='?' (Size = 4000), @p1='?' (Size = 8000) (DbType = AnsiString), @p2='?' (Size = 4000), @p3='?' (Size = 8000) (DbType = AnsiString), @p4='?' (DbType = DateTime2), @p5='?' (DbType = DateTime2), @p6='?' (Size = 255), @p7='?' (Size = 4000), @p8='?' (Size = 255), @p9='?' (Size = 255), @p10='?' (Size = 255)], CommandType='"Text"', CommandTimeout='30']
SET IMPLICIT_TRANSACTIONS OFF;
SET NOCOUNT ON;
INSERT INTO [notification_templates] ([additional_data], [Body], [body_ar], [body_en], [created_at], [expiry_at], [Route], [target_criteria], [Title], [title_ar], [title_en])
OUTPUT INSERTED.[Id]
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7, @p8, @p9, @p10);
2025-02-01 00:48:26.465 +03:00 [INF] Created notification template with ID: 3
2025-02-01 00:48:26.534 +03:00 [INF] Executed DbCommand (10ms) [Parameters=[@p0='?' (Size = 4000), @p1='?' (DbType = DateTime2), @p2='?' (Size = 4000), @p3='?' (Size = 4000), @p4='?' (Size = 4000), @p5='?' (Size = 450), @p6='?' (Size = 4000), @p7='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SET IMPLICIT_TRANSACTIONS OFF;
SET NOCOUNT ON;
INSERT INTO [AuthLogs] ([AuthType], [CreatedAt], [DeviceId], [FailureReason], [IpAddress], [NationalId], [Status], [UserAgent])
OUTPUT INSERTED.[Id]
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7);
2025-02-01 00:48:26.554 +03:00 [INF] Executed DbCommand (2ms) [Parameters=[@__userId_0='?' (Size = 450)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [u].[national_id], [u].[last_updated], [u].[notifications]
FROM [user_notifications] AS [u]
WHERE [u].[national_id] = @__userId_0
2025-02-01 00:48:26.566 +03:00 [INF] Processing notification for user 1012345678. Existing notification record: true
2025-02-01 00:48:26.568 +03:00 [INF] Current notifications count for user 1012345678: 2
2025-02-01 00:48:26.585 +03:00 [INF] Serialized new notifications for user 1012345678. Length: 417
2025-02-01 00:48:26.615 +03:00 [INF] Executed DbCommand (19ms) [Parameters=[@p0='?' (Size = 4000), @p1='?' (DbType = DateTime2), @p2='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
UPDATE user_notifications SET notifications = @p0, last_updated = @p1 WHERE national_id = @p2
2025-02-01 00:48:26.617 +03:00 [INF] Updated existing UserNotification for user: 1012345678
2025-02-01 00:48:26.621 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@__userId_0='?' (Size = 450)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [u].[national_id], [u].[last_updated], [u].[notifications]
FROM [user_notifications] AS [u]
WHERE [u].[national_id] = @__userId_0
2025-02-01 00:48:26.624 +03:00 [INF] Processing notification for user 1023456789. Existing notification record: true
2025-02-01 00:48:26.627 +03:00 [INF] Current notifications count for user 1023456789: 2
2025-02-01 00:48:26.628 +03:00 [INF] Serialized new notifications for user 1023456789. Length: 417
2025-02-01 00:48:26.631 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@p0='?' (Size = 4000), @p1='?' (DbType = DateTime2), @p2='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
UPDATE user_notifications SET notifications = @p0, last_updated = @p1 WHERE national_id = @p2
2025-02-01 00:48:26.633 +03:00 [INF] Updated existing UserNotification for user: 1023456789
2025-02-01 00:48:26.635 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@__userId_0='?' (Size = 450)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [u].[national_id], [u].[last_updated], [u].[notifications]
FROM [user_notifications] AS [u]
WHERE [u].[national_id] = @__userId_0
2025-02-01 00:48:26.637 +03:00 [INF] Processing notification for user 1045678901. Existing notification record: true
2025-02-01 00:48:26.639 +03:00 [INF] Current notifications count for user 1045678901: 2
2025-02-01 00:48:26.643 +03:00 [INF] Serialized new notifications for user 1045678901. Length: 417
2025-02-01 00:48:26.645 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@p0='?' (Size = 4000), @p1='?' (DbType = DateTime2), @p2='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
UPDATE user_notifications SET notifications = @p0, last_updated = @p1 WHERE national_id = @p2
2025-02-01 00:48:26.648 +03:00 [INF] Updated existing UserNotification for user: 1045678901
2025-02-01 00:48:26.653 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@p0='?' (Size = 4000), @p1='?' (DbType = DateTime2), @p2='?' (Size = 4000), @p3='?' (Size = 4000), @p4='?' (Size = 4000), @p5='?' (Size = 450), @p6='?' (Size = 4000), @p7='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SET IMPLICIT_TRANSACTIONS OFF;
SET NOCOUNT ON;
INSERT INTO [AuthLogs] ([AuthType], [CreatedAt], [DeviceId], [FailureReason], [IpAddress], [NationalId], [Status], [UserAgent])
OUTPUT INSERTED.[Id]
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7);
2025-02-01 00:48:26.659 +03:00 [INF] Successfully sent notifications. Template: 3, Success: 3, Total: 3
2025-02-01 00:48:26.666 +03:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType9`2[[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Object, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-02-01 00:48:26.689 +03:00 [INF] Executed action NayifatAPI.Controllers.NotificationsController.SendNotification (NayifatAPI) in 3880.413ms
2025-02-01 00:48:26.695 +03:00 [INF] Executed endpoint 'NayifatAPI.Controllers.NotificationsController.SendNotification (NayifatAPI)'
2025-02-01 00:48:26.706 +03:00 [INF] Request finished HTTP/1.1 POST http://localhost:5264/api/notifications/send - 200 null application/json; charset=utf-8 4285.298ms
2025-02-01 01:01:41.376 +03:00 [INF] Request starting HTTP/1.1 POST http://localhost:5264/api/notifications/send - application/json 206
2025-02-01 01:01:41.383 +03:00 [INF] Executing endpoint 'NayifatAPI.Controllers.NotificationsController.SendNotification (NayifatAPI)'
2025-02-01 01:01:41.385 +03:00 [INF] Route matched with {action = "SendNotification", controller = "Notifications"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] SendNotification(NayifatAPI.Controllers.SendNotificationRequest) on controller NayifatAPI.Controllers.NotificationsController (NayifatAPI).
2025-02-01 01:01:41.437 +03:00 [INF] Executed DbCommand (6ms) [Parameters=[@__providedApiKey_0='?' (Size = 255)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [a].[Key], [a].[CreatedAt], [a].[Description], [a].[ExpiresAt], [a].[IsActive], [a].[LastUsedAt]
FROM [ApiKeys] AS [a]
WHERE [a].[Key] = @__providedApiKey_0 AND [a].[IsActive] = CAST(1 AS bit)
2025-02-01 01:01:41.443 +03:00 [INF] Received notification request: {"Title":null,"TitleEn":"Test Notification","TitleAr":"إشعار تجريبي","Filters":null,"NationalId":"1023456789","NationalIds":null}
2025-02-01 01:01:41.447 +03:00 [INF] Starting GetTargetUsers with request type: Single User
2025-02-01 01:01:41.462 +03:00 [INF] Executed DbCommand (3ms) [Parameters=[@__request_NationalId_0='?' (Size = 450)], CommandType='"Text"', CommandTimeout='30']
SELECT [c].[NationalId]
FROM [Customers] AS [c]
WHERE [c].[NationalId] = @__request_NationalId_0
2025-02-01 01:01:41.467 +03:00 [INF] Found 1 users matching national ID 1023456789
2025-02-01 01:01:41.469 +03:00 [INF] Target users query completed. Found 1 users
2025-02-01 01:01:41.472 +03:00 [INF] Found 1 target users for notification
2025-02-01 01:01:41.484 +03:00 [INF] Executed DbCommand (10ms) [Parameters=[@p0='?' (Size = 4000), @p1='?' (Size = 8000) (DbType = AnsiString), @p2='?' (Size = 4000), @p3='?' (Size = 8000) (DbType = AnsiString), @p4='?' (DbType = DateTime2), @p5='?' (DbType = DateTime2), @p6='?' (Size = 255), @p7='?' (Size = 4000), @p8='?' (Size = 255), @p9='?' (Size = 255), @p10='?' (Size = 255)], CommandType='"Text"', CommandTimeout='30']
SET IMPLICIT_TRANSACTIONS OFF;
SET NOCOUNT ON;
INSERT INTO [notification_templates] ([additional_data], [Body], [body_ar], [body_en], [created_at], [expiry_at], [Route], [target_criteria], [Title], [title_ar], [title_en])
OUTPUT INSERTED.[Id]
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7, @p8, @p9, @p10);
2025-02-01 01:01:41.492 +03:00 [INF] Created notification template with ID: 1
2025-02-01 01:01:41.500 +03:00 [INF] Executed DbCommand (5ms) [Parameters=[@p0='?' (Size = 4000), @p1='?' (DbType = DateTime2), @p2='?' (Size = 4000), @p3='?' (Size = 4000), @p4='?' (Size = 4000), @p5='?' (Size = 450), @p6='?' (Size = 4000), @p7='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SET IMPLICIT_TRANSACTIONS OFF;
SET NOCOUNT ON;
INSERT INTO [AuthLogs] ([AuthType], [CreatedAt], [DeviceId], [FailureReason], [IpAddress], [NationalId], [Status], [UserAgent])
OUTPUT INSERTED.[Id]
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7);
2025-02-01 01:01:41.514 +03:00 [INF] Executed DbCommand (5ms) [Parameters=[@__userId_0='?' (Size = 450)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [u].[national_id], [u].[last_updated], [u].[notifications]
FROM [user_notifications] AS [u]
WHERE [u].[national_id] = @__userId_0
2025-02-01 01:01:41.517 +03:00 [INF] Processing notification for user 1023456789. Existing notification record: false
2025-02-01 01:01:41.519 +03:00 [INF] Current notifications count for user 1023456789: 0
2025-02-01 01:01:41.523 +03:00 [INF] Serialized new notifications for user 1023456789. Length: 139
2025-02-01 01:01:41.532 +03:00 [INF] Executed DbCommand (3ms) [Parameters=[@p0='?' (Size = 4000), @p1='?' (Size = 4000), @p2='?' (DbType = DateTime2)], CommandType='"Text"', CommandTimeout='30']
INSERT INTO user_notifications (national_id, notifications, last_updated) VALUES (@p0, @p1, @p2)
2025-02-01 01:01:41.537 +03:00 [INF] Created new UserNotification entry for user: 1023456789
2025-02-01 01:01:41.541 +03:00 [INF] Executed DbCommand (2ms) [Parameters=[@p0='?' (Size = 4000), @p1='?' (DbType = DateTime2), @p2='?' (Size = 4000), @p3='?' (Size = 4000), @p4='?' (Size = 4000), @p5='?' (Size = 450), @p6='?' (Size = 4000), @p7='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SET IMPLICIT_TRANSACTIONS OFF;
SET NOCOUNT ON;
INSERT INTO [AuthLogs] ([AuthType], [CreatedAt], [DeviceId], [FailureReason], [IpAddress], [NationalId], [Status], [UserAgent])
OUTPUT INSERTED.[Id]
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7);
2025-02-01 01:01:41.546 +03:00 [INF] Successfully sent notifications. Template: 1, Success: 1, Total: 1
2025-02-01 01:01:41.548 +03:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType9`2[[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Object, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-02-01 01:01:41.556 +03:00 [INF] Executed action NayifatAPI.Controllers.NotificationsController.SendNotification (NayifatAPI) in 168.1833ms
2025-02-01 01:01:41.557 +03:00 [INF] Executed endpoint 'NayifatAPI.Controllers.NotificationsController.SendNotification (NayifatAPI)'
2025-02-01 01:01:41.559 +03:00 [INF] Request finished HTTP/1.1 POST http://localhost:5264/api/notifications/send - 200 null application/json; charset=utf-8 182.9082ms
2025-02-01 01:01:58.772 +03:00 [INF] Request starting HTTP/1.1 POST http://localhost:5264/api/notifications/list - application/json 62
2025-02-01 01:01:58.779 +03:00 [INF] Executing endpoint 'NayifatAPI.Controllers.NotificationsController.GetNotifications (NayifatAPI)'
2025-02-01 01:01:58.791 +03:00 [INF] Route matched with {action = "GetNotifications", controller = "Notifications"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetNotifications(NayifatAPI.Controllers.GetNotificationsRequest) on controller NayifatAPI.Controllers.NotificationsController (NayifatAPI).
2025-02-01 01:01:58.936 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@__providedApiKey_0='?' (Size = 255)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [a].[Key], [a].[CreatedAt], [a].[Description], [a].[ExpiresAt], [a].[IsActive], [a].[LastUsedAt]
FROM [ApiKeys] AS [a]
WHERE [a].[Key] = @__providedApiKey_0 AND [a].[IsActive] = CAST(1 AS bit)
2025-02-01 01:01:58.950 +03:00 [INF] Executed DbCommand (3ms) [Parameters=[@__request_NationalId_0='?' (Size = 450)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [u].[national_id], [u].[last_updated], [u].[notifications]
FROM [user_notifications] AS [u]
WHERE [u].[national_id] = @__request_NationalId_0
2025-02-01 01:01:59.065 +03:00 [INF] Executed DbCommand (80ms) [Parameters=[@__Parse_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [n].[Id], [n].[additional_data], [n].[Body], [n].[body_ar], [n].[body_en], [n].[created_at], [n].[expiry_at], [n].[Route], [n].[target_criteria], [n].[Title], [n].[title_ar], [n].[title_en]
FROM [notification_templates] AS [n]
WHERE [n].[Id] = @__Parse_0
2025-02-01 01:01:59.916 +03:00 [INF] Executed DbCommand (792ms) [Parameters=[@p0='?' (Size = 4000), @p1='?' (DbType = DateTime2), @p2='?' (Size = 4000), @p3='?' (Size = 4000), @p4='?' (Size = 4000), @p5='?' (Size = 450), @p6='?' (Size = 4000), @p7='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SET IMPLICIT_TRANSACTIONS OFF;
SET NOCOUNT ON;
INSERT INTO [AuthLogs] ([AuthType], [CreatedAt], [DeviceId], [FailureReason], [IpAddress], [NationalId], [Status], [UserAgent])
OUTPUT INSERTED.[Id]
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7);
2025-02-01 01:01:59.920 +03:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType9`2[[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Object, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-02-01 01:01:59.935 +03:00 [INF] Executed action NayifatAPI.Controllers.NotificationsController.GetNotifications (NayifatAPI) in 1141.3902ms
2025-02-01 01:01:59.937 +03:00 [INF] Executed endpoint 'NayifatAPI.Controllers.NotificationsController.GetNotifications (NayifatAPI)'
2025-02-01 01:01:59.938 +03:00 [INF] Request finished HTTP/1.1 POST http://localhost:5264/api/notifications/list - 200 null application/json; charset=utf-8 1165.8428ms
2025-02-01 01:11:49.587 +03:00 [INF] Request starting HTTP/1.1 POST http://localhost:5264/api/notifications/list - application/json 62
2025-02-01 01:11:49.590 +03:00 [INF] Executing endpoint 'NayifatAPI.Controllers.NotificationsController.GetNotifications (NayifatAPI)'
2025-02-01 01:11:49.591 +03:00 [INF] Route matched with {action = "GetNotifications", controller = "Notifications"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetNotifications(NayifatAPI.Controllers.GetNotificationsRequest) on controller NayifatAPI.Controllers.NotificationsController (NayifatAPI).
2025-02-01 01:11:49.604 +03:00 [INF] Executed DbCommand (4ms) [Parameters=[@__providedApiKey_0='?' (Size = 255)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [a].[Key], [a].[CreatedAt], [a].[Description], [a].[ExpiresAt], [a].[IsActive], [a].[LastUsedAt]
FROM [ApiKeys] AS [a]
WHERE [a].[Key] = @__providedApiKey_0 AND [a].[IsActive] = CAST(1 AS bit)
2025-02-01 01:11:49.611 +03:00 [INF] Executed DbCommand (3ms) [Parameters=[@__request_NationalId_0='?' (Size = 450)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [u].[national_id], [u].[last_updated], [u].[notifications]
FROM [user_notifications] AS [u]
WHERE [u].[national_id] = @__request_NationalId_0
2025-02-01 01:11:49.616 +03:00 [INF] Executed DbCommand (2ms) [Parameters=[@__Parse_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [n].[Id], [n].[additional_data], [n].[Body], [n].[body_ar], [n].[body_en], [n].[created_at], [n].[expiry_at], [n].[Route], [n].[target_criteria], [n].[Title], [n].[title_ar], [n].[title_en]
FROM [notification_templates] AS [n]
WHERE [n].[Id] = @__Parse_0
2025-02-01 01:11:49.700 +03:00 [INF] Executed DbCommand (78ms) [Parameters=[@p0='?' (Size = 4000), @p1='?' (DbType = DateTime2), @p2='?' (Size = 4000), @p3='?' (Size = 4000), @p4='?' (Size = 4000), @p5='?' (Size = 450), @p6='?' (Size = 4000), @p7='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SET IMPLICIT_TRANSACTIONS OFF;
SET NOCOUNT ON;
INSERT INTO [AuthLogs] ([AuthType], [CreatedAt], [DeviceId], [FailureReason], [IpAddress], [NationalId], [Status], [UserAgent])
OUTPUT INSERTED.[Id]
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7);
2025-02-01 01:11:49.704 +03:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType9`2[[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Object, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-02-01 01:11:49.706 +03:00 [INF] Executed action NayifatAPI.Controllers.NotificationsController.GetNotifications (NayifatAPI) in 112.9854ms
2025-02-01 01:11:49.708 +03:00 [INF] Executed endpoint 'NayifatAPI.Controllers.NotificationsController.GetNotifications (NayifatAPI)'
2025-02-01 01:11:49.709 +03:00 [INF] Request finished HTTP/1.1 POST http://localhost:5264/api/notifications/list - 200 null application/json; charset=utf-8 121.292ms
2025-02-01 01:11:59.800 +03:00 [INF] Request starting HTTP/1.1 POST http://localhost:5264/api/notifications/list - application/json 61
2025-02-01 01:11:59.907 +03:00 [INF] Executing endpoint 'NayifatAPI.Controllers.NotificationsController.GetNotifications (NayifatAPI)'
2025-02-01 01:11:59.909 +03:00 [INF] Route matched with {action = "GetNotifications", controller = "Notifications"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetNotifications(NayifatAPI.Controllers.GetNotificationsRequest) on controller NayifatAPI.Controllers.NotificationsController (NayifatAPI).
2025-02-01 01:11:59.914 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@__providedApiKey_0='?' (Size = 255)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [a].[Key], [a].[CreatedAt], [a].[Description], [a].[ExpiresAt], [a].[IsActive], [a].[LastUsedAt]
FROM [ApiKeys] AS [a]
WHERE [a].[Key] = @__providedApiKey_0 AND [a].[IsActive] = CAST(1 AS bit)
2025-02-01 01:12:00.122 +03:00 [INF] Executed DbCommand (124ms) [Parameters=[@__request_NationalId_0='?' (Size = 450)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [u].[national_id], [u].[last_updated], [u].[notifications]
FROM [user_notifications] AS [u]
WHERE [u].[national_id] = @__request_NationalId_0
2025-02-01 01:12:00.196 +03:00 [INF] Executed DbCommand (46ms) [Parameters=[@__Parse_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [n].[Id], [n].[additional_data], [n].[Body], [n].[body_ar], [n].[body_en], [n].[created_at], [n].[expiry_at], [n].[Route], [n].[target_criteria], [n].[Title], [n].[title_ar], [n].[title_en]
FROM [notification_templates] AS [n]
WHERE [n].[Id] = @__Parse_0
2025-02-01 01:12:00.605 +03:00 [INF] Executed DbCommand (309ms) [Parameters=[@p0='?' (Size = 4000), @p1='?' (DbType = DateTime2), @p2='?' (Size = 4000), @p3='?' (Size = 4000), @p4='?' (Size = 4000), @p5='?' (Size = 450), @p6='?' (Size = 4000), @p7='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SET IMPLICIT_TRANSACTIONS OFF;
SET NOCOUNT ON;
INSERT INTO [AuthLogs] ([AuthType], [CreatedAt], [DeviceId], [FailureReason], [IpAddress], [NationalId], [Status], [UserAgent])
OUTPUT INSERTED.[Id]
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7);
2025-02-01 01:12:01.033 +03:00 [INF] Executed DbCommand (282ms) [Parameters=[@p0='?' (Size = 4000), @p1='?' (DbType = DateTime2), @p2='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
UPDATE user_notifications SET notifications = @p0, last_updated = @p1 WHERE national_id = @p2
2025-02-01 01:12:01.283 +03:00 [INF] Executed DbCommand (183ms) [Parameters=[@p0='?' (Size = 4000), @p1='?' (DbType = DateTime2), @p2='?' (Size = 4000), @p3='?' (Size = 4000), @p4='?' (Size = 4000), @p5='?' (Size = 450), @p6='?' (Size = 4000), @p7='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SET IMPLICIT_TRANSACTIONS OFF;
SET NOCOUNT ON;
INSERT INTO [AuthLogs] ([AuthType], [CreatedAt], [DeviceId], [FailureReason], [IpAddress], [NationalId], [Status], [UserAgent])
OUTPUT INSERTED.[Id]
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7);
2025-02-01 01:12:01.307 +03:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType9`2[[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Object, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-02-01 01:12:01.309 +03:00 [INF] Executed action NayifatAPI.Controllers.NotificationsController.GetNotifications (NayifatAPI) in 1398.0167ms
2025-02-01 01:12:01.313 +03:00 [INF] Executed endpoint 'NayifatAPI.Controllers.NotificationsController.GetNotifications (NayifatAPI)'
2025-02-01 01:12:01.315 +03:00 [INF] Request finished HTTP/1.1 POST http://localhost:5264/api/notifications/list - 200 null application/json; charset=utf-8 1515.0634ms
2025-02-01 01:12:04.829 +03:00 [INF] Request starting HTTP/1.1 POST http://localhost:5264/api/notifications/list - application/json 61
2025-02-01 01:12:04.831 +03:00 [INF] Executing endpoint 'NayifatAPI.Controllers.NotificationsController.GetNotifications (NayifatAPI)'
2025-02-01 01:12:04.833 +03:00 [INF] Route matched with {action = "GetNotifications", controller = "Notifications"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetNotifications(NayifatAPI.Controllers.GetNotificationsRequest) on controller NayifatAPI.Controllers.NotificationsController (NayifatAPI).
2025-02-01 01:12:04.838 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@__providedApiKey_0='?' (Size = 255)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [a].[Key], [a].[CreatedAt], [a].[Description], [a].[ExpiresAt], [a].[IsActive], [a].[LastUsedAt]
FROM [ApiKeys] AS [a]
WHERE [a].[Key] = @__providedApiKey_0 AND [a].[IsActive] = CAST(1 AS bit)
2025-02-01 01:12:04.842 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@__request_NationalId_0='?' (Size = 450)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [u].[national_id], [u].[last_updated], [u].[notifications]
FROM [user_notifications] AS [u]
WHERE [u].[national_id] = @__request_NationalId_0
2025-02-01 01:12:04.846 +03:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType9`2[[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Object, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-02-01 01:12:04.849 +03:00 [INF] Executed action NayifatAPI.Controllers.NotificationsController.GetNotifications (NayifatAPI) in 14.1231ms
2025-02-01 01:12:04.852 +03:00 [INF] Executed endpoint 'NayifatAPI.Controllers.NotificationsController.GetNotifications (NayifatAPI)'
2025-02-01 01:12:04.854 +03:00 [INF] Request finished HTTP/1.1 POST http://localhost:5264/api/notifications/list - 200 null application/json; charset=utf-8 25.0355ms
2025-02-01 01:12:17.529 +03:00 [INF] Request starting HTTP/1.1 POST http://localhost:5264/api/notifications/send - application/json 206
2025-02-01 01:12:17.531 +03:00 [INF] Executing endpoint 'NayifatAPI.Controllers.NotificationsController.SendNotification (NayifatAPI)'
2025-02-01 01:12:17.532 +03:00 [INF] Route matched with {action = "SendNotification", controller = "Notifications"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] SendNotification(NayifatAPI.Controllers.SendNotificationRequest) on controller NayifatAPI.Controllers.NotificationsController (NayifatAPI).
2025-02-01 01:12:17.537 +03:00 [INF] Executed DbCommand (3ms) [Parameters=[@__providedApiKey_0='?' (Size = 255)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [a].[Key], [a].[CreatedAt], [a].[Description], [a].[ExpiresAt], [a].[IsActive], [a].[LastUsedAt]
FROM [ApiKeys] AS [a]
WHERE [a].[Key] = @__providedApiKey_0 AND [a].[IsActive] = CAST(1 AS bit)
2025-02-01 01:12:17.539 +03:00 [INF] Received notification request: {"Title":null,"TitleEn":"Test Notification","TitleAr":"إشعار تجريبي","Filters":null,"NationalId":"1023456789","NationalIds":null}
2025-02-01 01:12:17.541 +03:00 [INF] Starting GetTargetUsers with request type: Single User
2025-02-01 01:12:17.545 +03:00 [INF] Executed DbCommand (3ms) [Parameters=[@__request_NationalId_0='?' (Size = 450)], CommandType='"Text"', CommandTimeout='30']
SELECT [c].[NationalId]
FROM [Customers] AS [c]
WHERE [c].[NationalId] = @__request_NationalId_0
2025-02-01 01:12:17.548 +03:00 [INF] Found 1 users matching national ID 1023456789
2025-02-01 01:12:17.549 +03:00 [INF] Target users query completed. Found 1 users
2025-02-01 01:12:17.550 +03:00 [INF] Found 1 target users for notification
2025-02-01 01:12:17.631 +03:00 [INF] Executed DbCommand (79ms) [Parameters=[@p0='?' (Size = 4000), @p1='?' (Size = 8000) (DbType = AnsiString), @p2='?' (Size = 4000), @p3='?' (Size = 8000) (DbType = AnsiString), @p4='?' (DbType = DateTime2), @p5='?' (DbType = DateTime2), @p6='?' (Size = 255), @p7='?' (Size = 4000), @p8='?' (Size = 255), @p9='?' (Size = 255), @p10='?' (Size = 255)], CommandType='"Text"', CommandTimeout='30']
SET IMPLICIT_TRANSACTIONS OFF;
SET NOCOUNT ON;
INSERT INTO [notification_templates] ([additional_data], [Body], [body_ar], [body_en], [created_at], [expiry_at], [Route], [target_criteria], [Title], [title_ar], [title_en])
OUTPUT INSERTED.[Id]
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7, @p8, @p9, @p10);
2025-02-01 01:12:17.634 +03:00 [INF] Created notification template with ID: 2
2025-02-01 01:12:17.639 +03:00 [INF] Executed DbCommand (3ms) [Parameters=[@p0='?' (Size = 4000), @p1='?' (DbType = DateTime2), @p2='?' (Size = 4000), @p3='?' (Size = 4000), @p4='?' (Size = 4000), @p5='?' (Size = 450), @p6='?' (Size = 4000), @p7='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SET IMPLICIT_TRANSACTIONS OFF;
SET NOCOUNT ON;
INSERT INTO [AuthLogs] ([AuthType], [CreatedAt], [DeviceId], [FailureReason], [IpAddress], [NationalId], [Status], [UserAgent])
OUTPUT INSERTED.[Id]
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7);
2025-02-01 01:12:17.644 +03:00 [INF] Executed DbCommand (2ms) [Parameters=[@__userId_0='?' (Size = 450)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [u].[national_id], [u].[last_updated], [u].[notifications]
FROM [user_notifications] AS [u]
WHERE [u].[national_id] = @__userId_0
2025-02-01 01:12:17.645 +03:00 [INF] Processing notification for user 1023456789. Existing notification record: true
2025-02-01 01:12:17.646 +03:00 [INF] Current notifications count for user 1023456789: 1
2025-02-01 01:12:17.647 +03:00 [INF] Serialized new notifications for user 1023456789. Length: 302
2025-02-01 01:12:17.655 +03:00 [INF] Executed DbCommand (6ms) [Parameters=[@p0='?' (Size = 4000), @p1='?' (DbType = DateTime2), @p2='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
UPDATE user_notifications SET notifications = @p0, last_updated = @p1 WHERE national_id = @p2
2025-02-01 01:12:17.656 +03:00 [INF] Updated existing UserNotification for user: 1023456789
2025-02-01 01:12:17.659 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@p0='?' (Size = 4000), @p1='?' (DbType = DateTime2), @p2='?' (Size = 4000), @p3='?' (Size = 4000), @p4='?' (Size = 4000), @p5='?' (Size = 450), @p6='?' (Size = 4000), @p7='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SET IMPLICIT_TRANSACTIONS OFF;
SET NOCOUNT ON;
INSERT INTO [AuthLogs] ([AuthType], [CreatedAt], [DeviceId], [FailureReason], [IpAddress], [NationalId], [Status], [UserAgent])
OUTPUT INSERTED.[Id]
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7);
2025-02-01 01:12:17.663 +03:00 [INF] Successfully sent notifications. Template: 2, Success: 1, Total: 1
2025-02-01 01:12:17.664 +03:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType9`2[[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Object, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-02-01 01:12:17.665 +03:00 [INF] Executed action NayifatAPI.Controllers.NotificationsController.SendNotification (NayifatAPI) in 132.3935ms
2025-02-01 01:12:17.668 +03:00 [INF] Executed endpoint 'NayifatAPI.Controllers.NotificationsController.SendNotification (NayifatAPI)'
2025-02-01 01:12:17.669 +03:00 [INF] Request finished HTTP/1.1 POST http://localhost:5264/api/notifications/send - 200 null application/json; charset=utf-8 139.5588ms
2025-02-01 01:12:28.241 +03:00 [INF] Request starting HTTP/1.1 POST http://localhost:5264/api/notifications/list - application/json 62
2025-02-01 01:12:28.708 +03:00 [INF] Executing endpoint 'NayifatAPI.Controllers.NotificationsController.GetNotifications (NayifatAPI)'
2025-02-01 01:12:29.120 +03:00 [INF] Route matched with {action = "GetNotifications", controller = "Notifications"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetNotifications(NayifatAPI.Controllers.GetNotificationsRequest) on controller NayifatAPI.Controllers.NotificationsController (NayifatAPI).
2025-02-01 01:12:29.134 +03:00 [INF] Executed DbCommand (8ms) [Parameters=[@__providedApiKey_0='?' (Size = 255)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [a].[Key], [a].[CreatedAt], [a].[Description], [a].[ExpiresAt], [a].[IsActive], [a].[LastUsedAt]
FROM [ApiKeys] AS [a]
WHERE [a].[Key] = @__providedApiKey_0 AND [a].[IsActive] = CAST(1 AS bit)
2025-02-01 01:12:29.140 +03:00 [INF] Executed DbCommand (3ms) [Parameters=[@__request_NationalId_0='?' (Size = 450)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [u].[national_id], [u].[last_updated], [u].[notifications]
FROM [user_notifications] AS [u]
WHERE [u].[national_id] = @__request_NationalId_0
2025-02-01 01:12:29.148 +03:00 [INF] Executed DbCommand (4ms) [Parameters=[@__Parse_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [n].[Id], [n].[additional_data], [n].[Body], [n].[body_ar], [n].[body_en], [n].[created_at], [n].[expiry_at], [n].[Route], [n].[target_criteria], [n].[Title], [n].[title_ar], [n].[title_en]
FROM [notification_templates] AS [n]
WHERE [n].[Id] = @__Parse_0
2025-02-01 01:12:29.323 +03:00 [INF] Executed DbCommand (167ms) [Parameters=[@p0='?' (Size = 4000), @p1='?' (DbType = DateTime2), @p2='?' (Size = 4000), @p3='?' (Size = 4000), @p4='?' (Size = 4000), @p5='?' (Size = 450), @p6='?' (Size = 4000), @p7='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SET IMPLICIT_TRANSACTIONS OFF;
SET NOCOUNT ON;
INSERT INTO [AuthLogs] ([AuthType], [CreatedAt], [DeviceId], [FailureReason], [IpAddress], [NationalId], [Status], [UserAgent])
OUTPUT INSERTED.[Id]
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7);
2025-02-01 01:12:29.337 +03:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType9`2[[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Object, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-02-01 01:12:29.341 +03:00 [INF] Executed action NayifatAPI.Controllers.NotificationsController.GetNotifications (NayifatAPI) in 218.1226ms
2025-02-01 01:12:29.390 +03:00 [INF] Executed endpoint 'NayifatAPI.Controllers.NotificationsController.GetNotifications (NayifatAPI)'
2025-02-01 01:12:29.418 +03:00 [INF] Request finished HTTP/1.1 POST http://localhost:5264/api/notifications/list - 200 null application/json; charset=utf-8 1176.5717ms
2025-02-01 01:12:48.260 +03:00 [INF] Application is shutting down...
2025-02-01 01:13:10.881 +03:00 [INF] Starting web application
2025-02-01 01:13:11.074 +03:00 [INF] Now listening on: http://localhost:5264
2025-02-01 01:13:11.081 +03:00 [INF] Application started. Press Ctrl+C to shut down.
2025-02-01 01:13:11.083 +03:00 [INF] Hosting environment: Development
2025-02-01 01:13:11.092 +03:00 [INF] Content root path: C:\Users\yamta\StudioProjects\nayifat_app_2025_new\NayifatAPI
2025-02-01 01:13:28.670 +03:00 [INF] Request starting HTTP/1.1 POST http://localhost:5264/api/notifications/list - application/json 61
2025-02-01 01:13:28.750 +03:00 [WRN] Failed to determine the https port for redirect.
2025-02-01 01:13:28.755 +03:00 [INF] Executing endpoint 'NayifatAPI.Controllers.NotificationsController.GetNotifications (NayifatAPI)'
2025-02-01 01:13:28.786 +03:00 [INF] Route matched with {action = "GetNotifications", controller = "Notifications"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetNotifications(NayifatAPI.Controllers.GetNotificationsRequest) on controller NayifatAPI.Controllers.NotificationsController (NayifatAPI).
2025-02-01 01:13:31.621 +03:00 [INF] Executed DbCommand (62ms) [Parameters=[@__providedApiKey_0='?' (Size = 255)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [a].[Key], [a].[CreatedAt], [a].[Description], [a].[ExpiresAt], [a].[IsActive], [a].[LastUsedAt]
FROM [ApiKeys] AS [a]
WHERE [a].[Key] = @__providedApiKey_0 AND [a].[IsActive] = CAST(1 AS bit)
2025-02-01 01:13:31.848 +03:00 [INF] Executed DbCommand (23ms) [Parameters=[@__request_NationalId_0='?' (Size = 450)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [u].[national_id], [u].[last_updated], [u].[notifications]
FROM [user_notifications] AS [u]
WHERE [u].[national_id] = @__request_NationalId_0
2025-02-01 01:13:31.962 +03:00 [INF] Executed DbCommand (6ms) [Parameters=[@__Parse_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [n].[Id], [n].[additional_data], [n].[Body], [n].[body_ar], [n].[body_en], [n].[created_at], [n].[expiry_at], [n].[Route], [n].[target_criteria], [n].[Title], [n].[title_ar], [n].[title_en]
FROM [notification_templates] AS [n]
WHERE [n].[Id] = @__Parse_0
2025-02-01 01:13:32.431 +03:00 [INF] Executed DbCommand (13ms) [Parameters=[@p0='?' (Size = 4000), @p1='?' (DbType = DateTime2), @p2='?' (Size = 4000), @p3='?' (Size = 4000), @p4='?' (Size = 4000), @p5='?' (Size = 450), @p6='?' (Size = 4000), @p7='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SET IMPLICIT_TRANSACTIONS OFF;
SET NOCOUNT ON;
INSERT INTO [AuthLogs] ([AuthType], [CreatedAt], [DeviceId], [FailureReason], [IpAddress], [NationalId], [Status], [UserAgent])
OUTPUT INSERTED.[Id]
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7);
2025-02-01 01:13:32.581 +03:00 [INF] Executed DbCommand (27ms) [Parameters=[@p0='?' (Size = 4000), @p1='?' (DbType = DateTime2), @p2='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
UPDATE user_notifications SET notifications = @p0, last_updated = @p1 WHERE national_id = @p2
2025-02-01 01:13:32.630 +03:00 [INF] Executed DbCommand (19ms) [Parameters=[@p0='?' (Size = 4000), @p1='?' (DbType = DateTime2), @p2='?' (Size = 4000), @p3='?' (Size = 4000), @p4='?' (Size = 4000), @p5='?' (Size = 450), @p6='?' (Size = 4000), @p7='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SET IMPLICIT_TRANSACTIONS OFF;
SET NOCOUNT ON;
INSERT INTO [AuthLogs] ([AuthType], [CreatedAt], [DeviceId], [FailureReason], [IpAddress], [NationalId], [Status], [UserAgent])
OUTPUT INSERTED.[Id]
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7);
2025-02-01 01:13:33.096 +03:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType9`2[[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Object, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-02-01 01:13:33.691 +03:00 [INF] Executed action NayifatAPI.Controllers.NotificationsController.GetNotifications (NayifatAPI) in 4894.5895ms
2025-02-01 01:13:33.701 +03:00 [INF] Executed endpoint 'NayifatAPI.Controllers.NotificationsController.GetNotifications (NayifatAPI)'
2025-02-01 01:13:34.188 +03:00 [INF] Request finished HTTP/1.1 POST http://localhost:5264/api/notifications/list - 200 null application/json; charset=utf-8 5519.1496ms
2025-02-01 01:13:43.994 +03:00 [INF] Request starting HTTP/1.1 POST http://localhost:5264/api/notifications/list - application/json 61
2025-02-01 01:13:44.000 +03:00 [INF] Executing endpoint 'NayifatAPI.Controllers.NotificationsController.GetNotifications (NayifatAPI)'
2025-02-01 01:13:44.002 +03:00 [INF] Route matched with {action = "GetNotifications", controller = "Notifications"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetNotifications(NayifatAPI.Controllers.GetNotificationsRequest) on controller NayifatAPI.Controllers.NotificationsController (NayifatAPI).
2025-02-01 01:13:44.045 +03:00 [INF] Executed DbCommand (5ms) [Parameters=[@__providedApiKey_0='?' (Size = 255)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [a].[Key], [a].[CreatedAt], [a].[Description], [a].[ExpiresAt], [a].[IsActive], [a].[LastUsedAt]
FROM [ApiKeys] AS [a]
WHERE [a].[Key] = @__providedApiKey_0 AND [a].[IsActive] = CAST(1 AS bit)
2025-02-01 01:13:44.054 +03:00 [INF] Executed DbCommand (3ms) [Parameters=[@__request_NationalId_0='?' (Size = 450)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [u].[national_id], [u].[last_updated], [u].[notifications]
FROM [user_notifications] AS [u]
WHERE [u].[national_id] = @__request_NationalId_0
2025-02-01 01:13:44.058 +03:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType9`2[[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Object, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-02-01 01:13:44.060 +03:00 [INF] Executed action NayifatAPI.Controllers.NotificationsController.GetNotifications (NayifatAPI) in 56.2687ms
2025-02-01 01:13:44.066 +03:00 [INF] Executed endpoint 'NayifatAPI.Controllers.NotificationsController.GetNotifications (NayifatAPI)'
2025-02-01 01:13:44.067 +03:00 [INF] Request finished HTTP/1.1 POST http://localhost:5264/api/notifications/list - 200 null application/json; charset=utf-8 73.876ms
2025-02-01 01:13:47.935 +03:00 [INF] Request starting HTTP/1.1 POST http://localhost:5264/api/notifications/send - application/json 206
2025-02-01 01:13:47.986 +03:00 [INF] Executing endpoint 'NayifatAPI.Controllers.NotificationsController.SendNotification (NayifatAPI)'
2025-02-01 01:13:48.009 +03:00 [INF] Route matched with {action = "SendNotification", controller = "Notifications"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] SendNotification(NayifatAPI.Controllers.SendNotificationRequest) on controller NayifatAPI.Controllers.NotificationsController (NayifatAPI).
2025-02-01 01:13:48.258 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@__providedApiKey_0='?' (Size = 255)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [a].[Key], [a].[CreatedAt], [a].[Description], [a].[ExpiresAt], [a].[IsActive], [a].[LastUsedAt]
FROM [ApiKeys] AS [a]
WHERE [a].[Key] = @__providedApiKey_0 AND [a].[IsActive] = CAST(1 AS bit)
2025-02-01 01:13:48.271 +03:00 [INF] Received notification request: {"Title":null,"TitleEn":"Test Notification","TitleAr":"إشعار تجريبي","Filters":null,"NationalId":"1023456789","NationalIds":null}
2025-02-01 01:13:48.405 +03:00 [INF] Starting GetTargetUsers with request type: Single User
2025-02-01 01:13:48.455 +03:00 [INF] Executed DbCommand (4ms) [Parameters=[@__request_NationalId_0='?' (Size = 450)], CommandType='"Text"', CommandTimeout='30']
SELECT [c].[NationalId]
FROM [Customers] AS [c]
WHERE [c].[NationalId] = @__request_NationalId_0
2025-02-01 01:13:48.476 +03:00 [INF] Found 1 users matching national ID 1023456789
2025-02-01 01:13:48.482 +03:00 [INF] Target users query completed. Found 1 users
2025-02-01 01:13:48.484 +03:00 [INF] Found 1 target users for notification
2025-02-01 01:13:48.597 +03:00 [INF] Executed DbCommand (87ms) [Parameters=[@p0='?' (Size = 4000), @p1='?' (Size = 8000) (DbType = AnsiString), @p2='?' (Size = 4000), @p3='?' (Size = 8000) (DbType = AnsiString), @p4='?' (DbType = DateTime2), @p5='?' (DbType = DateTime2), @p6='?' (Size = 255), @p7='?' (Size = 4000), @p8='?' (Size = 255), @p9='?' (Size = 255), @p10='?' (Size = 255)], CommandType='"Text"', CommandTimeout='30']
SET IMPLICIT_TRANSACTIONS OFF;
SET NOCOUNT ON;
INSERT INTO [notification_templates] ([additional_data], [Body], [body_ar], [body_en], [created_at], [expiry_at], [Route], [target_criteria], [Title], [title_ar], [title_en])
OUTPUT INSERTED.[Id]
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7, @p8, @p9, @p10);
2025-02-01 01:13:48.628 +03:00 [INF] Created notification template with ID: 3
2025-02-01 01:13:48.648 +03:00 [INF] Executed DbCommand (6ms) [Parameters=[@p0='?' (Size = 4000), @p1='?' (DbType = DateTime2), @p2='?' (Size = 4000), @p3='?' (Size = 4000), @p4='?' (Size = 4000), @p5='?' (Size = 450), @p6='?' (Size = 4000), @p7='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SET IMPLICIT_TRANSACTIONS OFF;
SET NOCOUNT ON;
INSERT INTO [AuthLogs] ([AuthType], [CreatedAt], [DeviceId], [FailureReason], [IpAddress], [NationalId], [Status], [UserAgent])
OUTPUT INSERTED.[Id]
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7);
2025-02-01 01:13:48.714 +03:00 [INF] Executed DbCommand (38ms) [Parameters=[@__userId_0='?' (Size = 450)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [u].[national_id], [u].[last_updated], [u].[notifications]
FROM [user_notifications] AS [u]
WHERE [u].[national_id] = @__userId_0
2025-02-01 01:13:48.734 +03:00 [INF] Processing notification for user 1023456789. Existing notification record: true
2025-02-01 01:13:48.763 +03:00 [INF] Current notifications count for user 1023456789: 2
2025-02-01 01:13:48.798 +03:00 [INF] Serialized new notifications for user 1023456789. Length: 462
2025-02-01 01:13:50.178 +03:00 [INF] Executed DbCommand (1,365ms) [Parameters=[@p0='?' (Size = 4000), @p1='?' (DbType = DateTime2), @p2='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
UPDATE user_notifications SET notifications = @p0, last_updated = @p1 WHERE national_id = @p2
2025-02-01 01:13:50.186 +03:00 [INF] Updated existing UserNotification for user: 1023456789
2025-02-01 01:13:50.200 +03:00 [INF] Executed DbCommand (9ms) [Parameters=[@p0='?' (Size = 4000), @p1='?' (DbType = DateTime2), @p2='?' (Size = 4000), @p3='?' (Size = 4000), @p4='?' (Size = 4000), @p5='?' (Size = 450), @p6='?' (Size = 4000), @p7='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SET IMPLICIT_TRANSACTIONS OFF;
SET NOCOUNT ON;
INSERT INTO [AuthLogs] ([AuthType], [CreatedAt], [DeviceId], [FailureReason], [IpAddress], [NationalId], [Status], [UserAgent])
OUTPUT INSERTED.[Id]
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7);
2025-02-01 01:13:50.208 +03:00 [INF] Successfully sent notifications. Template: 3, Success: 1, Total: 1
2025-02-01 01:13:50.210 +03:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType9`2[[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Object, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-02-01 01:13:50.268 +03:00 [INF] Executed action NayifatAPI.Controllers.NotificationsController.SendNotification (NayifatAPI) in 2198.9115ms
2025-02-01 01:13:50.646 +03:00 [INF] Executed endpoint 'NayifatAPI.Controllers.NotificationsController.SendNotification (NayifatAPI)'
2025-02-01 01:13:50.654 +03:00 [INF] Request finished HTTP/1.1 POST http://localhost:5264/api/notifications/send - 200 null application/json; charset=utf-8 2718.0985ms
2025-02-01 01:13:58.991 +03:00 [INF] Request starting HTTP/1.1 POST http://localhost:5264/api/notifications/list - application/json 62
2025-02-01 01:13:58.993 +03:00 [INF] Executing endpoint 'NayifatAPI.Controllers.NotificationsController.GetNotifications (NayifatAPI)'
2025-02-01 01:13:58.995 +03:00 [INF] Route matched with {action = "GetNotifications", controller = "Notifications"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetNotifications(NayifatAPI.Controllers.GetNotificationsRequest) on controller NayifatAPI.Controllers.NotificationsController (NayifatAPI).
2025-02-01 01:13:59.000 +03:00 [INF] Executed DbCommand (0ms) [Parameters=[@__providedApiKey_0='?' (Size = 255)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [a].[Key], [a].[CreatedAt], [a].[Description], [a].[ExpiresAt], [a].[IsActive], [a].[LastUsedAt]
FROM [ApiKeys] AS [a]
WHERE [a].[Key] = @__providedApiKey_0 AND [a].[IsActive] = CAST(1 AS bit)
2025-02-01 01:13:59.003 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@__request_NationalId_0='?' (Size = 450)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [u].[national_id], [u].[last_updated], [u].[notifications]
FROM [user_notifications] AS [u]
WHERE [u].[national_id] = @__request_NationalId_0
2025-02-01 01:13:59.011 +03:00 [INF] Executed DbCommand (2ms) [Parameters=[@__Parse_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [n].[Id], [n].[additional_data], [n].[Body], [n].[body_ar], [n].[body_en], [n].[created_at], [n].[expiry_at], [n].[Route], [n].[target_criteria], [n].[Title], [n].[title_ar], [n].[title_en]
FROM [notification_templates] AS [n]
WHERE [n].[Id] = @__Parse_0
2025-02-01 01:13:59.021 +03:00 [INF] Executed DbCommand (7ms) [Parameters=[@p0='?' (Size = 4000), @p1='?' (DbType = DateTime2), @p2='?' (Size = 4000), @p3='?' (Size = 4000), @p4='?' (Size = 4000), @p5='?' (Size = 450), @p6='?' (Size = 4000), @p7='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SET IMPLICIT_TRANSACTIONS OFF;
SET NOCOUNT ON;
INSERT INTO [AuthLogs] ([AuthType], [CreatedAt], [DeviceId], [FailureReason], [IpAddress], [NationalId], [Status], [UserAgent])
OUTPUT INSERTED.[Id]
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7);
2025-02-01 01:13:59.025 +03:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType9`2[[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Object, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-02-01 01:13:59.027 +03:00 [INF] Executed action NayifatAPI.Controllers.NotificationsController.GetNotifications (NayifatAPI) in 30.1776ms
2025-02-01 01:13:59.030 +03:00 [INF] Executed endpoint 'NayifatAPI.Controllers.NotificationsController.GetNotifications (NayifatAPI)'
2025-02-01 01:13:59.033 +03:00 [INF] Request finished HTTP/1.1 POST http://localhost:5264/api/notifications/list - 200 null application/json; charset=utf-8 42.252ms
2025-02-01 02:26:22.170 +03:00 [INF] Request starting HTTP/1.1 POST http://localhost:5264/api/loan-application/initial - application/json 90
2025-02-01 02:26:22.181 +03:00 [INF] Request finished HTTP/1.1 POST http://localhost:5264/api/loan-application/initial - 404 0 null 10.5397ms
2025-02-01 02:26:22.211 +03:00 [INF] Request reached the end of the middleware pipeline without being handled by application code. Request path: POST http://localhost:5264/api/loan-application/initial, Response status code: 404
2025-02-01 02:26:29.942 +03:00 [INF] Application is shutting down...
2025-02-01 02:28:17.669 +03:00 [INF] Starting web application
2025-02-01 02:28:17.804 +03:00 [INF] Now listening on: http://localhost:5264
2025-02-01 02:28:17.812 +03:00 [INF] Application started. Press Ctrl+C to shut down.
2025-02-01 02:28:17.813 +03:00 [INF] Hosting environment: Development
2025-02-01 02:28:17.814 +03:00 [INF] Content root path: C:\Users\yamta\StudioProjects\nayifat_app_2025_new\NayifatAPI
2025-02-01 02:28:25.999 +03:00 [INF] Request starting HTTP/1.1 POST http://localhost:5264/api/loan-application/initial - application/json 90
2025-02-01 02:28:27.931 +03:00 [WRN] Failed to determine the https port for redirect.
2025-02-01 02:28:27.944 +03:00 [INF] Executing endpoint 'NayifatAPI.Controllers.LoanApplicationController.CreateInitialApplication (NayifatAPI)'
2025-02-01 02:28:28.026 +03:00 [INF] Route matched with {action = "CreateInitialApplication", controller = "LoanApplication"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] CreateInitialApplication(NayifatAPI.Controllers.InitialLoanApplicationRequest) on controller NayifatAPI.Controllers.LoanApplicationController (NayifatAPI).
2025-02-01 02:28:30.832 +03:00 [INF] Executed DbCommand (41ms) [Parameters=[@__providedApiKey_0='?' (Size = 255)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [a].[Key], [a].[CreatedAt], [a].[Description], [a].[ExpiresAt], [a].[IsActive], [a].[LastUsedAt]
FROM [ApiKeys] AS [a]
WHERE [a].[Key] = @__providedApiKey_0 AND [a].[IsActive] = CAST(1 AS bit)
2025-02-01 02:28:31.108 +03:00 [ERR] Failed executing DbCommand (33ms) [Parameters=[@__p_0='?' (Size = 450)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [c].[NationalId], [c].[AddNo], [c].[BuildingNo], [c].[City], [c].[Consent], [c].[ConsentDate], [c].[DateOfBirth], [c].[Dependents], [c].[District], [c].[Email], [c].[Employer], [c].[EmployerName], [c].[EmploymentStatus], [c].[FamilyNameAr], [c].[FamilyNameEn], [c].[FirstNameAr], [c].[FirstNameEn], [c].[Iban], [c].[IdExpiryDate], [c].[Language], [c].[Los], [c].[Mpin], [c].[MpinEnabled], [c].[NafathStatus], [c].[NafathTimestamp], [c].[Password], [c].[Phone], [c].[RegistrationDate], [c].[Salary], [c].[SalaryCustomer], [c].[SalaryDakhli], [c].[SecondNameAr], [c].[SecondNameEn], [c].[Sector], [c].[Street], [c].[ThirdNameAr], [c].[ThirdNameEn], [c].[Zipcode]
FROM [Customers] AS [c]
WHERE [c].[NationalId] = @__p_0
2025-02-01 02:28:31.161 +03:00 [ERR] An exception occurred while iterating over the results of a query for context type 'NayifatAPI.Data.ApplicationDbContext'.
Microsoft.Data.SqlClient.SqlException (0x80131904): Invalid column name 'EmployerName'.
Invalid column name 'EmploymentStatus'.
Invalid column name 'Language'.
Invalid column name 'Salary'.
   at Microsoft.Data.SqlClient.SqlCommand.<>c.<ExecuteDbDataReaderAsync>b__209_0(Task`1 result)
   at System.Threading.Tasks.ContinuationResultTaskFromResultTask`2.InnerInvoke()
   at System.Threading.ExecutionContext.RunInternal(ExecutionContext executionContext, ContextCallback callback, Object state)
--- End of stack trace from previous location ---
   at System.Threading.ExecutionContext.RunInternal(ExecutionContext executionContext, ContextCallback callback, Object state)
   at System.Threading.Tasks.Task.ExecuteWithThreadLocal(Task& currentTaskSlot, Thread threadPoolThread)
--- End of stack trace from previous location ---
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Query.Internal.SingleQueryingEnumerable`1.AsyncEnumerator.InitializeReaderAsync(AsyncEnumerator enumerator, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Storage.Internal.SqlServerExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Query.Internal.SingleQueryingEnumerable`1.AsyncEnumerator.MoveNextAsync()
ClientConnectionId:f790a72c-c294-4aa5-ae7d-eda2dba70312
Error Number:207,State:1,Class:16
Microsoft.Data.SqlClient.SqlException (0x80131904): Invalid column name 'EmployerName'.
Invalid column name 'EmploymentStatus'.
Invalid column name 'Language'.
Invalid column name 'Salary'.
   at Microsoft.Data.SqlClient.SqlCommand.<>c.<ExecuteDbDataReaderAsync>b__209_0(Task`1 result)
   at System.Threading.Tasks.ContinuationResultTaskFromResultTask`2.InnerInvoke()
   at System.Threading.ExecutionContext.RunInternal(ExecutionContext executionContext, ContextCallback callback, Object state)
--- End of stack trace from previous location ---
   at System.Threading.ExecutionContext.RunInternal(ExecutionContext executionContext, ContextCallback callback, Object state)
   at System.Threading.Tasks.Task.ExecuteWithThreadLocal(Task& currentTaskSlot, Thread threadPoolThread)
--- End of stack trace from previous location ---
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Query.Internal.SingleQueryingEnumerable`1.AsyncEnumerator.InitializeReaderAsync(AsyncEnumerator enumerator, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Storage.Internal.SqlServerExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Query.Internal.SingleQueryingEnumerable`1.AsyncEnumerator.MoveNextAsync()
ClientConnectionId:f790a72c-c294-4aa5-ae7d-eda2dba70312
Error Number:207,State:1,Class:16
2025-02-01 02:28:31.201 +03:00 [ERR] Error creating initial loan application for National ID: 1234567890
Microsoft.Data.SqlClient.SqlException (0x80131904): Invalid column name 'EmployerName'.
Invalid column name 'EmploymentStatus'.
Invalid column name 'Language'.
Invalid column name 'Salary'.
   at Microsoft.Data.SqlClient.SqlCommand.<>c.<ExecuteDbDataReaderAsync>b__209_0(Task`1 result)
   at System.Threading.Tasks.ContinuationResultTaskFromResultTask`2.InnerInvoke()
   at System.Threading.ExecutionContext.RunInternal(ExecutionContext executionContext, ContextCallback callback, Object state)
--- End of stack trace from previous location ---
   at System.Threading.ExecutionContext.RunInternal(ExecutionContext executionContext, ContextCallback callback, Object state)
   at System.Threading.Tasks.Task.ExecuteWithThreadLocal(Task& currentTaskSlot, Thread threadPoolThread)
--- End of stack trace from previous location ---
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Query.Internal.SingleQueryingEnumerable`1.AsyncEnumerator.InitializeReaderAsync(AsyncEnumerator enumerator, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Storage.Internal.SqlServerExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Query.Internal.SingleQueryingEnumerable`1.AsyncEnumerator.MoveNextAsync()
   at Microsoft.EntityFrameworkCore.Query.ShapedQueryCompilingExpressionVisitor.SingleOrDefaultAsync[TSource](IAsyncEnumerable`1 asyncEnumerable, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Query.ShapedQueryCompilingExpressionVisitor.SingleOrDefaultAsync[TSource](IAsyncEnumerable`1 asyncEnumerable, CancellationToken cancellationToken)
   at NayifatAPI.Controllers.LoanApplicationController.CreateInitialApplication(InitialLoanApplicationRequest request) in C:\Users\yamta\StudioProjects\nayifat_app_2025_new\NayifatAPI\Controllers\LoanApplicationController.cs:line 52
   at NayifatAPI.Controllers.LoanApplicationController.CreateInitialApplication(InitialLoanApplicationRequest request) in C:\Users\yamta\StudioProjects\nayifat_app_2025_new\NayifatAPI\Controllers\LoanApplicationController.cs:line 126
   at NayifatAPI.Controllers.LoanApplicationController.CreateInitialApplication(InitialLoanApplicationRequest request) in C:\Users\yamta\StudioProjects\nayifat_app_2025_new\NayifatAPI\Controllers\LoanApplicationController.cs:line 127
ClientConnectionId:f790a72c-c294-4aa5-ae7d-eda2dba70312
Error Number:207,State:1,Class:16
2025-02-01 02:28:31.263 +03:00 [INF] Executing ObjectResult, writing value of type '<>f__AnonymousType11`2[[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-02-01 02:28:31.293 +03:00 [INF] Executed action NayifatAPI.Controllers.LoanApplicationController.CreateInitialApplication (NayifatAPI) in 2824.4261ms
2025-02-01 02:28:31.296 +03:00 [INF] Executed endpoint 'NayifatAPI.Controllers.LoanApplicationController.CreateInitialApplication (NayifatAPI)'
2025-02-01 02:28:31.342 +03:00 [INF] Request finished HTTP/1.1 POST http://localhost:5264/api/loan-application/initial - 500 null application/json; charset=utf-8 5334.3612ms
2025-02-01 02:31:32.005 +03:00 [INF] Application is shutting down...
2025-02-01 02:31:45.112 +03:00 [INF] Starting web application
2025-02-01 02:31:45.262 +03:00 [INF] Now listening on: http://localhost:5264
2025-02-01 02:31:45.268 +03:00 [INF] Application started. Press Ctrl+C to shut down.
2025-02-01 02:31:45.269 +03:00 [INF] Hosting environment: Development
2025-02-01 02:31:45.270 +03:00 [INF] Content root path: C:\Users\yamta\StudioProjects\nayifat_app_2025_new\NayifatAPI
2025-02-01 02:31:51.424 +03:00 [INF] Request starting HTTP/1.1 POST http://localhost:5264/api/loan-application/initial - application/json 90
2025-02-01 02:31:51.482 +03:00 [WRN] Failed to determine the https port for redirect.
2025-02-01 02:31:51.487 +03:00 [INF] Executing endpoint 'NayifatAPI.Controllers.LoanApplicationController.CreateInitialApplication (NayifatAPI)'
2025-02-01 02:31:51.525 +03:00 [INF] Route matched with {action = "CreateInitialApplication", controller = "LoanApplication"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] CreateInitialApplication(NayifatAPI.Controllers.InitialLoanApplicationRequest) on controller NayifatAPI.Controllers.LoanApplicationController (NayifatAPI).
2025-02-01 02:31:53.258 +03:00 [INF] Executed DbCommand (107ms) [Parameters=[@__providedApiKey_0='?' (Size = 255)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [a].[Key], [a].[CreatedAt], [a].[Description], [a].[ExpiresAt], [a].[IsActive], [a].[LastUsedAt]
FROM [ApiKeys] AS [a]
WHERE [a].[Key] = @__providedApiKey_0 AND [a].[IsActive] = CAST(1 AS bit)
2025-02-01 02:31:53.467 +03:00 [INF] Executed DbCommand (42ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [l].[application_no]
FROM [loan_application_details] AS [l]
ORDER BY [l].[application_no] DESC
2025-02-01 02:31:53.854 +03:00 [WRN] Savepoints are disabled because Multiple Active Result Sets (MARS) is enabled. If 'SaveChanges' fails, then the transaction cannot be automatically rolled back to a known clean state. Instead, the transaction should be rolled back by the application before retrying 'SaveChanges'. See https://go.microsoft.com/fwlink/?linkid=2149338 for more information and examples. To identify the code which triggers this warning, call 'ConfigureWarnings(w => w.Throw(SqlServerEventId.SavepointsDisabledBecauseOfMARS))'.
2025-02-01 02:31:53.916 +03:00 [ERR] Failed executing DbCommand (39ms) [Parameters=[@p0='?' (Precision = 15) (Scale = 2) (DbType = Decimal), @p1='?' (DbType = Int32), @p2='?' (DbType = DateTime2), @p3='?' (Size = 4000), @p4='?' (Precision = 5) (Scale = 2) (DbType = Decimal), @p5='?' (Size = 450), @p6='?' (Size = 255), @p7='?' (Size = 4000), @p8='?' (Size = 4000), @p9='?' (Size = 4000), @p10='?' (Size = 50), @p11='?' (DbType = DateTime2), @p12='?' (DbType = Int32), @p13='?' (DbType = DateTime2)], CommandType='"Text"', CommandTimeout='30']
SET IMPLICIT_TRANSACTIONS OFF;
SET NOCOUNT ON;
INSERT INTO [loan_application_details] ([loan_amount], [application_no], [created_at], [customerDecision], [interest_rate], [national_id], [note], [noteUser], [loan_purpose], [remarks], [status], [status_date], [loan_tenure], [updated_at])
OUTPUT INSERTED.[loan_id]
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7, @p8, @p9, @p10, @p11, @p12, @p13);
2025-02-01 02:31:54.033 +03:00 [ERR] An exception occurred in the database while saving changes for context type 'NayifatAPI.Data.ApplicationDbContext'.
Microsoft.EntityFrameworkCore.DbUpdateException: An error occurred while saving the entity changes. See the inner exception for details.
 ---> Microsoft.Data.SqlClient.SqlException (0x80131904): Invalid column name 'created_at'.
Invalid column name 'updated_at'.
   at Microsoft.Data.SqlClient.SqlCommand.<>c.<ExecuteDbDataReaderAsync>b__209_0(Task`1 result)
   at System.Threading.Tasks.ContinuationResultTaskFromResultTask`2.InnerInvoke()
   at System.Threading.ExecutionContext.RunInternal(ExecutionContext executionContext, ContextCallback callback, Object state)
--- End of stack trace from previous location ---
   at System.Threading.ExecutionContext.RunInternal(ExecutionContext executionContext, ContextCallback callback, Object state)
   at System.Threading.Tasks.Task.ExecuteWithThreadLocal(Task& currentTaskSlot, Thread threadPoolThread)
--- End of stack trace from previous location ---
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
ClientConnectionId:369c1510-f4a9-4305-8a64-d571c73db31c
Error Number:207,State:1,Class:16
   --- End of inner exception stack trace ---
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Update.Internal.SqlServerModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(IList`1 entriesToSave, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(StateManager stateManager, Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Storage.Internal.SqlServerExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
Microsoft.EntityFrameworkCore.DbUpdateException: An error occurred while saving the entity changes. See the inner exception for details.
 ---> Microsoft.Data.SqlClient.SqlException (0x80131904): Invalid column name 'created_at'.
Invalid column name 'updated_at'.
   at Microsoft.Data.SqlClient.SqlCommand.<>c.<ExecuteDbDataReaderAsync>b__209_0(Task`1 result)
   at System.Threading.Tasks.ContinuationResultTaskFromResultTask`2.InnerInvoke()
   at System.Threading.ExecutionContext.RunInternal(ExecutionContext executionContext, ContextCallback callback, Object state)
--- End of stack trace from previous location ---
   at System.Threading.ExecutionContext.RunInternal(ExecutionContext executionContext, ContextCallback callback, Object state)
   at System.Threading.Tasks.Task.ExecuteWithThreadLocal(Task& currentTaskSlot, Thread threadPoolThread)
--- End of stack trace from previous location ---
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
ClientConnectionId:369c1510-f4a9-4305-8a64-d571c73db31c
Error Number:207,State:1,Class:16
   --- End of inner exception stack trace ---
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Update.Internal.SqlServerModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(IList`1 entriesToSave, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(StateManager stateManager, Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Storage.Internal.SqlServerExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
2025-02-01 02:31:55.081 +03:00 [ERR] Error creating initial loan application for National ID: 1234567890
Microsoft.EntityFrameworkCore.DbUpdateException: An error occurred while saving the entity changes. See the inner exception for details.
 ---> Microsoft.Data.SqlClient.SqlException (0x80131904): Invalid column name 'created_at'.
Invalid column name 'updated_at'.
   at Microsoft.Data.SqlClient.SqlCommand.<>c.<ExecuteDbDataReaderAsync>b__209_0(Task`1 result)
   at System.Threading.Tasks.ContinuationResultTaskFromResultTask`2.InnerInvoke()
   at System.Threading.ExecutionContext.RunInternal(ExecutionContext executionContext, ContextCallback callback, Object state)
--- End of stack trace from previous location ---
   at System.Threading.ExecutionContext.RunInternal(ExecutionContext executionContext, ContextCallback callback, Object state)
   at System.Threading.Tasks.Task.ExecuteWithThreadLocal(Task& currentTaskSlot, Thread threadPoolThread)
--- End of stack trace from previous location ---
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
ClientConnectionId:369c1510-f4a9-4305-8a64-d571c73db31c
Error Number:207,State:1,Class:16
   --- End of inner exception stack trace ---
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Update.Internal.SqlServerModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(IList`1 entriesToSave, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(StateManager stateManager, Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Storage.Internal.SqlServerExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at NayifatAPI.Controllers.LoanApplicationController.CreateInitialApplication(InitialLoanApplicationRequest request) in C:\Users\yamta\StudioProjects\nayifat_app_2025_new\NayifatAPI\Controllers\LoanApplicationController.cs:line 72
   at NayifatAPI.Controllers.LoanApplicationController.CreateInitialApplication(InitialLoanApplicationRequest request) in C:\Users\yamta\StudioProjects\nayifat_app_2025_new\NayifatAPI\Controllers\LoanApplicationController.cs:line 92
   at NayifatAPI.Controllers.LoanApplicationController.CreateInitialApplication(InitialLoanApplicationRequest request) in C:\Users\yamta\StudioProjects\nayifat_app_2025_new\NayifatAPI\Controllers\LoanApplicationController.cs:line 93
2025-02-01 02:31:55.306 +03:00 [INF] Executing ObjectResult, writing value of type '<>f__AnonymousType11`2[[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-02-01 02:31:55.525 +03:00 [INF] Executed action NayifatAPI.Controllers.LoanApplicationController.CreateInitialApplication (NayifatAPI) in 3989.3772ms
2025-02-01 02:31:55.644 +03:00 [INF] Executed endpoint 'NayifatAPI.Controllers.LoanApplicationController.CreateInitialApplication (NayifatAPI)'
2025-02-01 02:31:55.737 +03:00 [INF] Request finished HTTP/1.1 POST http://localhost:5264/api/loan-application/initial - 500 null application/json; charset=utf-8 4313.4733ms
2025-02-01 02:33:05.900 +03:00 [INF] Application is shutting down...
2025-02-01 02:33:25.976 +03:00 [INF] Starting web application
2025-02-01 02:33:26.156 +03:00 [INF] Now listening on: http://localhost:5264
2025-02-01 02:33:26.162 +03:00 [INF] Application started. Press Ctrl+C to shut down.
2025-02-01 02:33:26.164 +03:00 [INF] Hosting environment: Development
2025-02-01 02:33:26.165 +03:00 [INF] Content root path: C:\Users\yamta\StudioProjects\nayifat_app_2025_new\NayifatAPI
2025-02-01 02:33:33.993 +03:00 [INF] Request starting HTTP/1.1 POST http://localhost:5264/api/loan-application/initial - application/json 90
2025-02-01 02:33:35.121 +03:00 [WRN] Failed to determine the https port for redirect.
2025-02-01 02:33:35.835 +03:00 [INF] Executing endpoint 'NayifatAPI.Controllers.LoanApplicationController.CreateInitialApplication (NayifatAPI)'
2025-02-01 02:33:36.111 +03:00 [INF] Route matched with {action = "CreateInitialApplication", controller = "LoanApplication"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] CreateInitialApplication(NayifatAPI.Controllers.InitialLoanApplicationRequest) on controller NayifatAPI.Controllers.LoanApplicationController (NayifatAPI).
2025-02-01 02:33:38.780 +03:00 [INF] Executed DbCommand (57ms) [Parameters=[@__providedApiKey_0='?' (Size = 255)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [a].[Key], [a].[CreatedAt], [a].[Description], [a].[ExpiresAt], [a].[IsActive], [a].[LastUsedAt]
FROM [ApiKeys] AS [a]
WHERE [a].[Key] = @__providedApiKey_0 AND [a].[IsActive] = CAST(1 AS bit)
2025-02-01 02:33:38.991 +03:00 [INF] Executed DbCommand (25ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [l].[application_no]
FROM [loan_application_details] AS [l]
ORDER BY [l].[application_no] DESC
2025-02-01 02:33:39.303 +03:00 [WRN] Savepoints are disabled because Multiple Active Result Sets (MARS) is enabled. If 'SaveChanges' fails, then the transaction cannot be automatically rolled back to a known clean state. Instead, the transaction should be rolled back by the application before retrying 'SaveChanges'. See https://go.microsoft.com/fwlink/?linkid=2149338 for more information and examples. To identify the code which triggers this warning, call 'ConfigureWarnings(w => w.Throw(SqlServerEventId.SavepointsDisabledBecauseOfMARS))'.
2025-02-01 02:33:39.321 +03:00 [ERR] Failed executing DbCommand (10ms) [Parameters=[@p0='?' (Precision = 18) (Scale = 2) (DbType = Decimal), @p1='?' (DbType = Int32), @p2='?' (Precision = 5) (Scale = 2) (DbType = Decimal), @p3='?' (DbType = DateTime2), @p4='?' (Precision = 18) (Scale = 2) (DbType = Decimal), @p5='?' (Size = 450), @p6='?' (Size = 50), @p7='?' (DbType = DateTime2), @p8='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SET IMPLICIT_TRANSACTIONS OFF;
SET NOCOUNT ON;
INSERT INTO [loan_application_details] ([loan_amount], [application_no], [interest_rate], [last_updated], [monthly_payment], [national_id], [status], [status_date], [tenure])
OUTPUT INSERTED.[loan_id]
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7, @p8);
2025-02-01 02:33:39.356 +03:00 [ERR] An exception occurred in the database while saving changes for context type 'NayifatAPI.Data.ApplicationDbContext'.
Microsoft.EntityFrameworkCore.DbUpdateException: An error occurred while saving the entity changes. See the inner exception for details.
 ---> Microsoft.Data.SqlClient.SqlException (0x80131904): Invalid column name 'last_updated'.
Invalid column name 'monthly_payment'.
Invalid column name 'tenure'.
   at Microsoft.Data.SqlClient.SqlCommand.<>c.<ExecuteDbDataReaderAsync>b__209_0(Task`1 result)
   at System.Threading.Tasks.ContinuationResultTaskFromResultTask`2.InnerInvoke()
   at System.Threading.ExecutionContext.RunInternal(ExecutionContext executionContext, ContextCallback callback, Object state)
--- End of stack trace from previous location ---
   at System.Threading.ExecutionContext.RunInternal(ExecutionContext executionContext, ContextCallback callback, Object state)
   at System.Threading.Tasks.Task.ExecuteWithThreadLocal(Task& currentTaskSlot, Thread threadPoolThread)
--- End of stack trace from previous location ---
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
ClientConnectionId:f3c421a3-1502-4885-b6b8-389e26ef04ab
Error Number:207,State:1,Class:16
   --- End of inner exception stack trace ---
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Update.Internal.SqlServerModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(IList`1 entriesToSave, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(StateManager stateManager, Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Storage.Internal.SqlServerExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
Microsoft.EntityFrameworkCore.DbUpdateException: An error occurred while saving the entity changes. See the inner exception for details.
 ---> Microsoft.Data.SqlClient.SqlException (0x80131904): Invalid column name 'last_updated'.
Invalid column name 'monthly_payment'.
Invalid column name 'tenure'.
   at Microsoft.Data.SqlClient.SqlCommand.<>c.<ExecuteDbDataReaderAsync>b__209_0(Task`1 result)
   at System.Threading.Tasks.ContinuationResultTaskFromResultTask`2.InnerInvoke()
   at System.Threading.ExecutionContext.RunInternal(ExecutionContext executionContext, ContextCallback callback, Object state)
--- End of stack trace from previous location ---
   at System.Threading.ExecutionContext.RunInternal(ExecutionContext executionContext, ContextCallback callback, Object state)
   at System.Threading.Tasks.Task.ExecuteWithThreadLocal(Task& currentTaskSlot, Thread threadPoolThread)
--- End of stack trace from previous location ---
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
ClientConnectionId:f3c421a3-1502-4885-b6b8-389e26ef04ab
Error Number:207,State:1,Class:16
   --- End of inner exception stack trace ---
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Update.Internal.SqlServerModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(IList`1 entriesToSave, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(StateManager stateManager, Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Storage.Internal.SqlServerExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
2025-02-01 02:33:39.402 +03:00 [ERR] Error creating initial loan application for National ID: 1234567890
Microsoft.EntityFrameworkCore.DbUpdateException: An error occurred while saving the entity changes. See the inner exception for details.
 ---> Microsoft.Data.SqlClient.SqlException (0x80131904): Invalid column name 'last_updated'.
Invalid column name 'monthly_payment'.
Invalid column name 'tenure'.
   at Microsoft.Data.SqlClient.SqlCommand.<>c.<ExecuteDbDataReaderAsync>b__209_0(Task`1 result)
   at System.Threading.Tasks.ContinuationResultTaskFromResultTask`2.InnerInvoke()
   at System.Threading.ExecutionContext.RunInternal(ExecutionContext executionContext, ContextCallback callback, Object state)
--- End of stack trace from previous location ---
   at System.Threading.ExecutionContext.RunInternal(ExecutionContext executionContext, ContextCallback callback, Object state)
   at System.Threading.Tasks.Task.ExecuteWithThreadLocal(Task& currentTaskSlot, Thread threadPoolThread)
--- End of stack trace from previous location ---
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
ClientConnectionId:f3c421a3-1502-4885-b6b8-389e26ef04ab
Error Number:207,State:1,Class:16
   --- End of inner exception stack trace ---
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Update.Internal.SqlServerModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(IList`1 entriesToSave, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(StateManager stateManager, Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Storage.Internal.SqlServerExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at NayifatAPI.Controllers.LoanApplicationController.CreateInitialApplication(InitialLoanApplicationRequest request) in C:\Users\yamta\StudioProjects\nayifat_app_2025_new\NayifatAPI\Controllers\LoanApplicationController.cs:line 72
   at NayifatAPI.Controllers.LoanApplicationController.CreateInitialApplication(InitialLoanApplicationRequest request) in C:\Users\yamta\StudioProjects\nayifat_app_2025_new\NayifatAPI\Controllers\LoanApplicationController.cs:line 92
   at NayifatAPI.Controllers.LoanApplicationController.CreateInitialApplication(InitialLoanApplicationRequest request) in C:\Users\yamta\StudioProjects\nayifat_app_2025_new\NayifatAPI\Controllers\LoanApplicationController.cs:line 93
2025-02-01 02:33:39.441 +03:00 [INF] Executing ObjectResult, writing value of type '<>f__AnonymousType11`2[[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-02-01 02:33:39.481 +03:00 [INF] Executed action NayifatAPI.Controllers.LoanApplicationController.CreateInitialApplication (NayifatAPI) in 3179.428ms
2025-02-01 02:33:39.487 +03:00 [INF] Executed endpoint 'NayifatAPI.Controllers.LoanApplicationController.CreateInitialApplication (NayifatAPI)'
2025-02-01 02:33:39.505 +03:00 [INF] Request finished HTTP/1.1 POST http://localhost:5264/api/loan-application/initial - 500 null application/json; charset=utf-8 5515.3062ms
2025-02-01 02:36:29.166 +03:00 [INF] Request starting HTTP/1.1 POST http://localhost:5264/api/loan-application/initial - application/json 90
2025-02-01 02:36:29.209 +03:00 [INF] Executing endpoint 'NayifatAPI.Controllers.LoanApplicationController.CreateInitialApplication (NayifatAPI)'
2025-02-01 02:36:29.667 +03:00 [INF] Route matched with {action = "CreateInitialApplication", controller = "LoanApplication"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] CreateInitialApplication(NayifatAPI.Controllers.InitialLoanApplicationRequest) on controller NayifatAPI.Controllers.LoanApplicationController (NayifatAPI).
2025-02-01 02:36:29.761 +03:00 [INF] Executed DbCommand (28ms) [Parameters=[@__providedApiKey_0='?' (Size = 255)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [a].[Key], [a].[CreatedAt], [a].[Description], [a].[ExpiresAt], [a].[IsActive], [a].[LastUsedAt]
FROM [ApiKeys] AS [a]
WHERE [a].[Key] = @__providedApiKey_0 AND [a].[IsActive] = CAST(1 AS bit)
2025-02-01 02:36:29.827 +03:00 [INF] Executed DbCommand (17ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [l].[application_no]
FROM [loan_application_details] AS [l]
ORDER BY [l].[application_no] DESC
2025-02-01 02:36:29.903 +03:00 [WRN] Savepoints are disabled because Multiple Active Result Sets (MARS) is enabled. If 'SaveChanges' fails, then the transaction cannot be automatically rolled back to a known clean state. Instead, the transaction should be rolled back by the application before retrying 'SaveChanges'. See https://go.microsoft.com/fwlink/?linkid=2149338 for more information and examples. To identify the code which triggers this warning, call 'ConfigureWarnings(w => w.Throw(SqlServerEventId.SavepointsDisabledBecauseOfMARS))'.
2025-02-01 02:36:29.950 +03:00 [ERR] Failed executing DbCommand (2ms) [Parameters=[@p0='?' (Precision = 18) (Scale = 2) (DbType = Decimal), @p1='?' (DbType = Int32), @p2='?' (Precision = 5) (Scale = 2) (DbType = Decimal), @p3='?' (DbType = DateTime2), @p4='?' (Precision = 18) (Scale = 2) (DbType = Decimal), @p5='?' (Size = 450), @p6='?' (Size = 50), @p7='?' (DbType = DateTime2), @p8='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SET IMPLICIT_TRANSACTIONS OFF;
SET NOCOUNT ON;
INSERT INTO [loan_application_details] ([loan_amount], [application_no], [interest_rate], [last_updated], [monthly_payment], [national_id], [status], [status_date], [tenure])
OUTPUT INSERTED.[loan_id]
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7, @p8);
2025-02-01 02:36:30.121 +03:00 [ERR] An exception occurred in the database while saving changes for context type 'NayifatAPI.Data.ApplicationDbContext'.
Microsoft.EntityFrameworkCore.DbUpdateException: An error occurred while saving the entity changes. See the inner exception for details.
 ---> Microsoft.Data.SqlClient.SqlException (0x80131904): Invalid column name 'last_updated'.
Invalid column name 'monthly_payment'.
Invalid column name 'tenure'.
   at Microsoft.Data.SqlClient.SqlCommand.<>c.<ExecuteDbDataReaderAsync>b__209_0(Task`1 result)
   at System.Threading.Tasks.ContinuationResultTaskFromResultTask`2.InnerInvoke()
   at System.Threading.ExecutionContext.RunInternal(ExecutionContext executionContext, ContextCallback callback, Object state)
--- End of stack trace from previous location ---
   at System.Threading.ExecutionContext.RunInternal(ExecutionContext executionContext, ContextCallback callback, Object state)
   at System.Threading.Tasks.Task.ExecuteWithThreadLocal(Task& currentTaskSlot, Thread threadPoolThread)
--- End of stack trace from previous location ---
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
ClientConnectionId:f3c421a3-1502-4885-b6b8-389e26ef04ab
Error Number:207,State:1,Class:16
   --- End of inner exception stack trace ---
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Update.Internal.SqlServerModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(IList`1 entriesToSave, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(StateManager stateManager, Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Storage.Internal.SqlServerExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
Microsoft.EntityFrameworkCore.DbUpdateException: An error occurred while saving the entity changes. See the inner exception for details.
 ---> Microsoft.Data.SqlClient.SqlException (0x80131904): Invalid column name 'last_updated'.
Invalid column name 'monthly_payment'.
Invalid column name 'tenure'.
   at Microsoft.Data.SqlClient.SqlCommand.<>c.<ExecuteDbDataReaderAsync>b__209_0(Task`1 result)
   at System.Threading.Tasks.ContinuationResultTaskFromResultTask`2.InnerInvoke()
   at System.Threading.ExecutionContext.RunInternal(ExecutionContext executionContext, ContextCallback callback, Object state)
--- End of stack trace from previous location ---
   at System.Threading.ExecutionContext.RunInternal(ExecutionContext executionContext, ContextCallback callback, Object state)
   at System.Threading.Tasks.Task.ExecuteWithThreadLocal(Task& currentTaskSlot, Thread threadPoolThread)
--- End of stack trace from previous location ---
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
ClientConnectionId:f3c421a3-1502-4885-b6b8-389e26ef04ab
Error Number:207,State:1,Class:16
   --- End of inner exception stack trace ---
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Update.Internal.SqlServerModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(IList`1 entriesToSave, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(StateManager stateManager, Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Storage.Internal.SqlServerExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
2025-02-01 02:36:30.606 +03:00 [ERR] Error creating initial loan application for National ID: 1234567890
Microsoft.EntityFrameworkCore.DbUpdateException: An error occurred while saving the entity changes. See the inner exception for details.
 ---> Microsoft.Data.SqlClient.SqlException (0x80131904): Invalid column name 'last_updated'.
Invalid column name 'monthly_payment'.
Invalid column name 'tenure'.
   at Microsoft.Data.SqlClient.SqlCommand.<>c.<ExecuteDbDataReaderAsync>b__209_0(Task`1 result)
   at System.Threading.Tasks.ContinuationResultTaskFromResultTask`2.InnerInvoke()
   at System.Threading.ExecutionContext.RunInternal(ExecutionContext executionContext, ContextCallback callback, Object state)
--- End of stack trace from previous location ---
   at System.Threading.ExecutionContext.RunInternal(ExecutionContext executionContext, ContextCallback callback, Object state)
   at System.Threading.Tasks.Task.ExecuteWithThreadLocal(Task& currentTaskSlot, Thread threadPoolThread)
--- End of stack trace from previous location ---
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
ClientConnectionId:f3c421a3-1502-4885-b6b8-389e26ef04ab
Error Number:207,State:1,Class:16
   --- End of inner exception stack trace ---
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Update.Internal.SqlServerModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(IList`1 entriesToSave, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(StateManager stateManager, Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Storage.Internal.SqlServerExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at NayifatAPI.Controllers.LoanApplicationController.CreateInitialApplication(InitialLoanApplicationRequest request) in C:\Users\yamta\StudioProjects\nayifat_app_2025_new\NayifatAPI\Controllers\LoanApplicationController.cs:line 72
   at NayifatAPI.Controllers.LoanApplicationController.CreateInitialApplication(InitialLoanApplicationRequest request) in C:\Users\yamta\StudioProjects\nayifat_app_2025_new\NayifatAPI\Controllers\LoanApplicationController.cs:line 92
   at NayifatAPI.Controllers.LoanApplicationController.CreateInitialApplication(InitialLoanApplicationRequest request) in C:\Users\yamta\StudioProjects\nayifat_app_2025_new\NayifatAPI\Controllers\LoanApplicationController.cs:line 93
2025-02-01 02:36:30.636 +03:00 [INF] Executing ObjectResult, writing value of type '<>f__AnonymousType11`2[[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-02-01 02:36:30.641 +03:00 [INF] Executed action NayifatAPI.Controllers.LoanApplicationController.CreateInitialApplication (NayifatAPI) in 971.3583ms
2025-02-01 02:36:30.642 +03:00 [INF] Executed endpoint 'NayifatAPI.Controllers.LoanApplicationController.CreateInitialApplication (NayifatAPI)'
2025-02-01 02:36:30.646 +03:00 [INF] Request finished HTTP/1.1 POST http://localhost:5264/api/loan-application/initial - 500 null application/json; charset=utf-8 1479.5323ms
2025-02-01 02:40:41.712 +03:00 [INF] Request starting HTTP/1.1 POST http://localhost:5264/api/loan-application/initial - application/json 90
2025-02-01 02:40:41.716 +03:00 [INF] Executing endpoint 'NayifatAPI.Controllers.LoanApplicationController.CreateInitialApplication (NayifatAPI)'
2025-02-01 02:40:41.717 +03:00 [INF] Route matched with {action = "CreateInitialApplication", controller = "LoanApplication"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] CreateInitialApplication(NayifatAPI.Controllers.InitialLoanApplicationRequest) on controller NayifatAPI.Controllers.LoanApplicationController (NayifatAPI).
2025-02-01 02:40:41.832 +03:00 [INF] Executed DbCommand (7ms) [Parameters=[@__providedApiKey_0='?' (Size = 255)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [a].[Key], [a].[CreatedAt], [a].[Description], [a].[ExpiresAt], [a].[IsActive], [a].[LastUsedAt]
FROM [ApiKeys] AS [a]
WHERE [a].[Key] = @__providedApiKey_0 AND [a].[IsActive] = CAST(1 AS bit)
2025-02-01 02:40:41.848 +03:00 [INF] Executed DbCommand (2ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [l].[application_no]
FROM [loan_application_details] AS [l]
ORDER BY [l].[application_no] DESC
2025-02-01 02:40:41.851 +03:00 [WRN] Savepoints are disabled because Multiple Active Result Sets (MARS) is enabled. If 'SaveChanges' fails, then the transaction cannot be automatically rolled back to a known clean state. Instead, the transaction should be rolled back by the application before retrying 'SaveChanges'. See https://go.microsoft.com/fwlink/?linkid=2149338 for more information and examples. To identify the code which triggers this warning, call 'ConfigureWarnings(w => w.Throw(SqlServerEventId.SavepointsDisabledBecauseOfMARS))'.
2025-02-01 02:40:41.854 +03:00 [ERR] Failed executing DbCommand (2ms) [Parameters=[@p0='?' (Precision = 18) (Scale = 2) (DbType = Decimal), @p1='?' (DbType = Int32), @p2='?' (Precision = 5) (Scale = 2) (DbType = Decimal), @p3='?' (DbType = DateTime2), @p4='?' (Precision = 18) (Scale = 2) (DbType = Decimal), @p5='?' (Size = 450), @p6='?' (Size = 50), @p7='?' (DbType = DateTime2), @p8='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SET IMPLICIT_TRANSACTIONS OFF;
SET NOCOUNT ON;
INSERT INTO [loan_application_details] ([loan_amount], [application_no], [interest_rate], [last_updated], [monthly_payment], [national_id], [status], [status_date], [tenure])
OUTPUT INSERTED.[loan_id]
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7, @p8);
2025-02-01 02:40:41.860 +03:00 [ERR] An exception occurred in the database while saving changes for context type 'NayifatAPI.Data.ApplicationDbContext'.
Microsoft.EntityFrameworkCore.DbUpdateException: An error occurred while saving the entity changes. See the inner exception for details.
 ---> Microsoft.Data.SqlClient.SqlException (0x80131904): Invalid column name 'last_updated'.
Invalid column name 'monthly_payment'.
Invalid column name 'tenure'.
   at Microsoft.Data.SqlClient.SqlCommand.<>c.<ExecuteDbDataReaderAsync>b__209_0(Task`1 result)
   at System.Threading.Tasks.ContinuationResultTaskFromResultTask`2.InnerInvoke()
   at System.Threading.ExecutionContext.RunInternal(ExecutionContext executionContext, ContextCallback callback, Object state)
--- End of stack trace from previous location ---
   at System.Threading.ExecutionContext.RunInternal(ExecutionContext executionContext, ContextCallback callback, Object state)
   at System.Threading.Tasks.Task.ExecuteWithThreadLocal(Task& currentTaskSlot, Thread threadPoolThread)
--- End of stack trace from previous location ---
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
ClientConnectionId:161a0650-d5ad-4bf9-8740-27ec0006cf2f
Error Number:207,State:1,Class:16
   --- End of inner exception stack trace ---
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Update.Internal.SqlServerModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(IList`1 entriesToSave, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(StateManager stateManager, Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Storage.Internal.SqlServerExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
Microsoft.EntityFrameworkCore.DbUpdateException: An error occurred while saving the entity changes. See the inner exception for details.
 ---> Microsoft.Data.SqlClient.SqlException (0x80131904): Invalid column name 'last_updated'.
Invalid column name 'monthly_payment'.
Invalid column name 'tenure'.
   at Microsoft.Data.SqlClient.SqlCommand.<>c.<ExecuteDbDataReaderAsync>b__209_0(Task`1 result)
   at System.Threading.Tasks.ContinuationResultTaskFromResultTask`2.InnerInvoke()
   at System.Threading.ExecutionContext.RunInternal(ExecutionContext executionContext, ContextCallback callback, Object state)
--- End of stack trace from previous location ---
   at System.Threading.ExecutionContext.RunInternal(ExecutionContext executionContext, ContextCallback callback, Object state)
   at System.Threading.Tasks.Task.ExecuteWithThreadLocal(Task& currentTaskSlot, Thread threadPoolThread)
--- End of stack trace from previous location ---
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
ClientConnectionId:161a0650-d5ad-4bf9-8740-27ec0006cf2f
Error Number:207,State:1,Class:16
   --- End of inner exception stack trace ---
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Update.Internal.SqlServerModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(IList`1 entriesToSave, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(StateManager stateManager, Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Storage.Internal.SqlServerExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
2025-02-01 02:40:41.872 +03:00 [ERR] Error creating initial loan application for National ID: 1234567890
Microsoft.EntityFrameworkCore.DbUpdateException: An error occurred while saving the entity changes. See the inner exception for details.
 ---> Microsoft.Data.SqlClient.SqlException (0x80131904): Invalid column name 'last_updated'.
Invalid column name 'monthly_payment'.
Invalid column name 'tenure'.
   at Microsoft.Data.SqlClient.SqlCommand.<>c.<ExecuteDbDataReaderAsync>b__209_0(Task`1 result)
   at System.Threading.Tasks.ContinuationResultTaskFromResultTask`2.InnerInvoke()
   at System.Threading.ExecutionContext.RunInternal(ExecutionContext executionContext, ContextCallback callback, Object state)
--- End of stack trace from previous location ---
   at System.Threading.ExecutionContext.RunInternal(ExecutionContext executionContext, ContextCallback callback, Object state)
   at System.Threading.Tasks.Task.ExecuteWithThreadLocal(Task& currentTaskSlot, Thread threadPoolThread)
--- End of stack trace from previous location ---
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
ClientConnectionId:161a0650-d5ad-4bf9-8740-27ec0006cf2f
Error Number:207,State:1,Class:16
   --- End of inner exception stack trace ---
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Update.Internal.SqlServerModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(IList`1 entriesToSave, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(StateManager stateManager, Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Storage.Internal.SqlServerExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at NayifatAPI.Controllers.LoanApplicationController.CreateInitialApplication(InitialLoanApplicationRequest request) in C:\Users\yamta\StudioProjects\nayifat_app_2025_new\NayifatAPI\Controllers\LoanApplicationController.cs:line 72
   at NayifatAPI.Controllers.LoanApplicationController.CreateInitialApplication(InitialLoanApplicationRequest request) in C:\Users\yamta\StudioProjects\nayifat_app_2025_new\NayifatAPI\Controllers\LoanApplicationController.cs:line 92
   at NayifatAPI.Controllers.LoanApplicationController.CreateInitialApplication(InitialLoanApplicationRequest request) in C:\Users\yamta\StudioProjects\nayifat_app_2025_new\NayifatAPI\Controllers\LoanApplicationController.cs:line 93
2025-02-01 02:40:41.885 +03:00 [INF] Executing ObjectResult, writing value of type '<>f__AnonymousType11`2[[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-02-01 02:40:41.886 +03:00 [INF] Executed action NayifatAPI.Controllers.LoanApplicationController.CreateInitialApplication (NayifatAPI) in 166.7028ms
2025-02-01 02:40:41.888 +03:00 [INF] Executed endpoint 'NayifatAPI.Controllers.LoanApplicationController.CreateInitialApplication (NayifatAPI)'
2025-02-01 02:40:41.889 +03:00 [INF] Request finished HTTP/1.1 POST http://localhost:5264/api/loan-application/initial - 500 null application/json; charset=utf-8 176.7661ms
2025-02-01 02:40:52.844 +03:00 [INF] Request starting HTTP/1.1 POST http://localhost:5264/api/loan-application/initial - application/json 90
2025-02-01 02:40:52.847 +03:00 [INF] Executing endpoint 'NayifatAPI.Controllers.LoanApplicationController.CreateInitialApplication (NayifatAPI)'
2025-02-01 02:40:52.848 +03:00 [INF] Route matched with {action = "CreateInitialApplication", controller = "LoanApplication"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] CreateInitialApplication(NayifatAPI.Controllers.InitialLoanApplicationRequest) on controller NayifatAPI.Controllers.LoanApplicationController (NayifatAPI).
2025-02-01 02:40:52.851 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@__providedApiKey_0='?' (Size = 255)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [a].[Key], [a].[CreatedAt], [a].[Description], [a].[ExpiresAt], [a].[IsActive], [a].[LastUsedAt]
FROM [ApiKeys] AS [a]
WHERE [a].[Key] = @__providedApiKey_0 AND [a].[IsActive] = CAST(1 AS bit)
2025-02-01 02:40:52.855 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [l].[application_no]
FROM [loan_application_details] AS [l]
ORDER BY [l].[application_no] DESC
2025-02-01 02:40:52.858 +03:00 [WRN] Savepoints are disabled because Multiple Active Result Sets (MARS) is enabled. If 'SaveChanges' fails, then the transaction cannot be automatically rolled back to a known clean state. Instead, the transaction should be rolled back by the application before retrying 'SaveChanges'. See https://go.microsoft.com/fwlink/?linkid=2149338 for more information and examples. To identify the code which triggers this warning, call 'ConfigureWarnings(w => w.Throw(SqlServerEventId.SavepointsDisabledBecauseOfMARS))'.
2025-02-01 02:40:52.861 +03:00 [ERR] Failed executing DbCommand (1ms) [Parameters=[@p0='?' (Precision = 18) (Scale = 2) (DbType = Decimal), @p1='?' (DbType = Int32), @p2='?' (Precision = 5) (Scale = 2) (DbType = Decimal), @p3='?' (DbType = DateTime2), @p4='?' (Precision = 18) (Scale = 2) (DbType = Decimal), @p5='?' (Size = 450), @p6='?' (Size = 50), @p7='?' (DbType = DateTime2), @p8='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SET IMPLICIT_TRANSACTIONS OFF;
SET NOCOUNT ON;
INSERT INTO [loan_application_details] ([loan_amount], [application_no], [interest_rate], [last_updated], [monthly_payment], [national_id], [status], [status_date], [tenure])
OUTPUT INSERTED.[loan_id]
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7, @p8);
2025-02-01 02:40:52.866 +03:00 [ERR] An exception occurred in the database while saving changes for context type 'NayifatAPI.Data.ApplicationDbContext'.
Microsoft.EntityFrameworkCore.DbUpdateException: An error occurred while saving the entity changes. See the inner exception for details.
 ---> Microsoft.Data.SqlClient.SqlException (0x80131904): Invalid column name 'last_updated'.
Invalid column name 'monthly_payment'.
Invalid column name 'tenure'.
   at Microsoft.Data.SqlClient.SqlCommand.<>c.<ExecuteDbDataReaderAsync>b__209_0(Task`1 result)
   at System.Threading.Tasks.ContinuationResultTaskFromResultTask`2.InnerInvoke()
   at System.Threading.ExecutionContext.RunInternal(ExecutionContext executionContext, ContextCallback callback, Object state)
--- End of stack trace from previous location ---
   at System.Threading.ExecutionContext.RunInternal(ExecutionContext executionContext, ContextCallback callback, Object state)
   at System.Threading.Tasks.Task.ExecuteWithThreadLocal(Task& currentTaskSlot, Thread threadPoolThread)
--- End of stack trace from previous location ---
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
ClientConnectionId:161a0650-d5ad-4bf9-8740-27ec0006cf2f
Error Number:207,State:1,Class:16
   --- End of inner exception stack trace ---
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Update.Internal.SqlServerModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(IList`1 entriesToSave, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(StateManager stateManager, Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Storage.Internal.SqlServerExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
Microsoft.EntityFrameworkCore.DbUpdateException: An error occurred while saving the entity changes. See the inner exception for details.
 ---> Microsoft.Data.SqlClient.SqlException (0x80131904): Invalid column name 'last_updated'.
Invalid column name 'monthly_payment'.
Invalid column name 'tenure'.
   at Microsoft.Data.SqlClient.SqlCommand.<>c.<ExecuteDbDataReaderAsync>b__209_0(Task`1 result)
   at System.Threading.Tasks.ContinuationResultTaskFromResultTask`2.InnerInvoke()
   at System.Threading.ExecutionContext.RunInternal(ExecutionContext executionContext, ContextCallback callback, Object state)
--- End of stack trace from previous location ---
   at System.Threading.ExecutionContext.RunInternal(ExecutionContext executionContext, ContextCallback callback, Object state)
   at System.Threading.Tasks.Task.ExecuteWithThreadLocal(Task& currentTaskSlot, Thread threadPoolThread)
--- End of stack trace from previous location ---
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
ClientConnectionId:161a0650-d5ad-4bf9-8740-27ec0006cf2f
Error Number:207,State:1,Class:16
   --- End of inner exception stack trace ---
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Update.Internal.SqlServerModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(IList`1 entriesToSave, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(StateManager stateManager, Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Storage.Internal.SqlServerExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
2025-02-01 02:40:52.880 +03:00 [ERR] Error creating initial loan application for National ID: 1234567890
Microsoft.EntityFrameworkCore.DbUpdateException: An error occurred while saving the entity changes. See the inner exception for details.
 ---> Microsoft.Data.SqlClient.SqlException (0x80131904): Invalid column name 'last_updated'.
Invalid column name 'monthly_payment'.
Invalid column name 'tenure'.
   at Microsoft.Data.SqlClient.SqlCommand.<>c.<ExecuteDbDataReaderAsync>b__209_0(Task`1 result)
   at System.Threading.Tasks.ContinuationResultTaskFromResultTask`2.InnerInvoke()
   at System.Threading.ExecutionContext.RunInternal(ExecutionContext executionContext, ContextCallback callback, Object state)
--- End of stack trace from previous location ---
   at System.Threading.ExecutionContext.RunInternal(ExecutionContext executionContext, ContextCallback callback, Object state)
   at System.Threading.Tasks.Task.ExecuteWithThreadLocal(Task& currentTaskSlot, Thread threadPoolThread)
--- End of stack trace from previous location ---
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
ClientConnectionId:161a0650-d5ad-4bf9-8740-27ec0006cf2f
Error Number:207,State:1,Class:16
   --- End of inner exception stack trace ---
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Update.Internal.SqlServerModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(IList`1 entriesToSave, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(StateManager stateManager, Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Storage.Internal.SqlServerExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at NayifatAPI.Controllers.LoanApplicationController.CreateInitialApplication(InitialLoanApplicationRequest request) in C:\Users\yamta\StudioProjects\nayifat_app_2025_new\NayifatAPI\Controllers\LoanApplicationController.cs:line 72
   at NayifatAPI.Controllers.LoanApplicationController.CreateInitialApplication(InitialLoanApplicationRequest request) in C:\Users\yamta\StudioProjects\nayifat_app_2025_new\NayifatAPI\Controllers\LoanApplicationController.cs:line 92
   at NayifatAPI.Controllers.LoanApplicationController.CreateInitialApplication(InitialLoanApplicationRequest request) in C:\Users\yamta\StudioProjects\nayifat_app_2025_new\NayifatAPI\Controllers\LoanApplicationController.cs:line 93
2025-02-01 02:40:52.889 +03:00 [INF] Executing ObjectResult, writing value of type '<>f__AnonymousType11`2[[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-02-01 02:40:52.896 +03:00 [INF] Executed action NayifatAPI.Controllers.LoanApplicationController.CreateInitialApplication (NayifatAPI) in 45.8013ms
2025-02-01 02:40:52.897 +03:00 [INF] Executed endpoint 'NayifatAPI.Controllers.LoanApplicationController.CreateInitialApplication (NayifatAPI)'
2025-02-01 02:40:52.898 +03:00 [INF] Request finished HTTP/1.1 POST http://localhost:5264/api/loan-application/initial - 500 null application/json; charset=utf-8 54.5607ms
2025-02-01 02:41:42.098 +03:00 [INF] Application is shutting down...
2025-02-01 02:41:55.502 +03:00 [INF] Starting web application
2025-02-01 02:41:55.721 +03:00 [INF] Now listening on: http://localhost:5264
2025-02-01 02:41:55.729 +03:00 [INF] Application started. Press Ctrl+C to shut down.
2025-02-01 02:41:55.731 +03:00 [INF] Hosting environment: Development
2025-02-01 02:41:55.732 +03:00 [INF] Content root path: C:\Users\yamta\StudioProjects\nayifat_app_2025_new\NayifatAPI
2025-02-01 02:42:06.379 +03:00 [INF] Request starting HTTP/1.1 POST http://localhost:5264/api/loan-application/initial - application/json 90
2025-02-01 02:42:06.585 +03:00 [WRN] Failed to determine the https port for redirect.
2025-02-01 02:42:06.752 +03:00 [INF] Executing endpoint 'NayifatAPI.Controllers.LoanApplicationController.CreateInitialApplication (NayifatAPI)'
2025-02-01 02:42:06.920 +03:00 [INF] Route matched with {action = "CreateInitialApplication", controller = "LoanApplication"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] CreateInitialApplication(NayifatAPI.Controllers.InitialLoanApplicationRequest) on controller NayifatAPI.Controllers.LoanApplicationController (NayifatAPI).
2025-02-01 02:42:10.090 +03:00 [INF] Executed DbCommand (36ms) [Parameters=[@__providedApiKey_0='?' (Size = 255)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [a].[Key], [a].[CreatedAt], [a].[Description], [a].[ExpiresAt], [a].[IsActive], [a].[LastUsedAt]
FROM [ApiKeys] AS [a]
WHERE [a].[Key] = @__providedApiKey_0 AND [a].[IsActive] = CAST(1 AS bit)
2025-02-01 02:42:10.234 +03:00 [INF] Executed DbCommand (16ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [l].[application_no]
FROM [loan_application_details] AS [l]
ORDER BY [l].[application_no] DESC
2025-02-01 02:42:10.447 +03:00 [WRN] Savepoints are disabled because Multiple Active Result Sets (MARS) is enabled. If 'SaveChanges' fails, then the transaction cannot be automatically rolled back to a known clean state. Instead, the transaction should be rolled back by the application before retrying 'SaveChanges'. See https://go.microsoft.com/fwlink/?linkid=2149338 for more information and examples. To identify the code which triggers this warning, call 'ConfigureWarnings(w => w.Throw(SqlServerEventId.SavepointsDisabledBecauseOfMARS))'.
2025-02-01 02:42:10.534 +03:00 [INF] Executed DbCommand (80ms) [Parameters=[@p0='?' (Precision = 18) (Scale = 2) (DbType = Decimal), @p1='?' (DbType = Int32), @p2='?' (Size = 4000), @p3='?' (Precision = 5) (Scale = 2) (DbType = Decimal), @p4='?' (Size = 450), @p5='?' (Size = 4000), @p6='?' (Size = 4000), @p7='?' (Size = 4000), @p8='?' (Size = 4000), @p9='?' (Size = 50), @p10='?' (DbType = DateTime2), @p11='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SET IMPLICIT_TRANSACTIONS OFF;
SET NOCOUNT ON;
INSERT INTO [loan_application_details] ([loan_amount], [application_no], [customerDecision], [interest_rate], [national_id], [note], [noteUser], [loan_purpose], [remarks], [status], [status_date], [loan_tenure])
OUTPUT INSERTED.[loan_id]
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7, @p8, @p9, @p10, @p11);
2025-02-01 02:42:10.600 +03:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType9`2[[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Object, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-02-01 02:42:10.636 +03:00 [INF] Executed action NayifatAPI.Controllers.LoanApplicationController.CreateInitialApplication (NayifatAPI) in 2828.8059ms
2025-02-01 02:42:10.641 +03:00 [INF] Executed endpoint 'NayifatAPI.Controllers.LoanApplicationController.CreateInitialApplication (NayifatAPI)'
2025-02-01 02:42:10.655 +03:00 [INF] Request finished HTTP/1.1 POST http://localhost:5264/api/loan-application/initial - 200 null application/json; charset=utf-8 4284.051ms
2025-02-01 02:43:56.661 +03:00 [INF] Request starting HTTP/1.1 POST http://localhost:5264/api/loan-application/initial - application/json 139
2025-02-01 02:43:56.668 +03:00 [INF] Executing endpoint 'NayifatAPI.Controllers.LoanApplicationController.CreateInitialApplication (NayifatAPI)'
2025-02-01 02:43:56.670 +03:00 [INF] Route matched with {action = "CreateInitialApplication", controller = "LoanApplication"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] CreateInitialApplication(NayifatAPI.Controllers.InitialLoanApplicationRequest) on controller NayifatAPI.Controllers.LoanApplicationController (NayifatAPI).
2025-02-01 02:43:56.709 +03:00 [INF] Executed DbCommand (2ms) [Parameters=[@__providedApiKey_0='?' (Size = 255)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [a].[Key], [a].[CreatedAt], [a].[Description], [a].[ExpiresAt], [a].[IsActive], [a].[LastUsedAt]
FROM [ApiKeys] AS [a]
WHERE [a].[Key] = @__providedApiKey_0 AND [a].[IsActive] = CAST(1 AS bit)
2025-02-01 02:43:56.720 +03:00 [INF] Executed DbCommand (2ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [l].[application_no]
FROM [loan_application_details] AS [l]
ORDER BY [l].[application_no] DESC
2025-02-01 02:43:56.724 +03:00 [WRN] Savepoints are disabled because Multiple Active Result Sets (MARS) is enabled. If 'SaveChanges' fails, then the transaction cannot be automatically rolled back to a known clean state. Instead, the transaction should be rolled back by the application before retrying 'SaveChanges'. See https://go.microsoft.com/fwlink/?linkid=2149338 for more information and examples. To identify the code which triggers this warning, call 'ConfigureWarnings(w => w.Throw(SqlServerEventId.SavepointsDisabledBecauseOfMARS))'.
2025-02-01 02:43:56.731 +03:00 [INF] Executed DbCommand (4ms) [Parameters=[@p0='?' (Precision = 18) (Scale = 2) (DbType = Decimal), @p1='?' (DbType = Int32), @p2='?' (Size = 4000), @p3='?' (Precision = 5) (Scale = 2) (DbType = Decimal), @p4='?' (Size = 450), @p5='?' (Size = 4000), @p6='?' (Size = 4000), @p7='?' (Size = 4000), @p8='?' (Size = 4000), @p9='?' (Size = 50), @p10='?' (DbType = DateTime2), @p11='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SET IMPLICIT_TRANSACTIONS OFF;
SET NOCOUNT ON;
INSERT INTO [loan_application_details] ([loan_amount], [application_no], [customerDecision], [interest_rate], [national_id], [note], [noteUser], [loan_purpose], [remarks], [status], [status_date], [loan_tenure])
OUTPUT INSERTED.[loan_id]
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7, @p8, @p9, @p10, @p11);
2025-02-01 02:43:56.811 +03:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType9`2[[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Object, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-02-01 02:43:56.816 +03:00 [INF] Executed action NayifatAPI.Controllers.LoanApplicationController.CreateInitialApplication (NayifatAPI) in 142.8256ms
2025-02-01 02:43:56.817 +03:00 [INF] Executed endpoint 'NayifatAPI.Controllers.LoanApplicationController.CreateInitialApplication (NayifatAPI)'
2025-02-01 02:43:56.819 +03:00 [INF] Request finished HTTP/1.1 POST http://localhost:5264/api/loan-application/initial - 200 null application/json; charset=utf-8 157.9978ms
2025-02-01 02:44:04.356 +03:00 [INF] Request starting HTTP/1.1 POST http://localhost:5264/api/loan-application/initial - application/json 139
2025-02-01 02:44:04.361 +03:00 [INF] Executing endpoint 'NayifatAPI.Controllers.LoanApplicationController.CreateInitialApplication (NayifatAPI)'
2025-02-01 02:44:04.362 +03:00 [INF] Route matched with {action = "CreateInitialApplication", controller = "LoanApplication"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] CreateInitialApplication(NayifatAPI.Controllers.InitialLoanApplicationRequest) on controller NayifatAPI.Controllers.LoanApplicationController (NayifatAPI).
2025-02-01 02:44:04.481 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@__providedApiKey_0='?' (Size = 255)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [a].[Key], [a].[CreatedAt], [a].[Description], [a].[ExpiresAt], [a].[IsActive], [a].[LastUsedAt]
FROM [ApiKeys] AS [a]
WHERE [a].[Key] = @__providedApiKey_0 AND [a].[IsActive] = CAST(1 AS bit)
2025-02-01 02:44:04.507 +03:00 [INF] Executed DbCommand (6ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [l].[application_no]
FROM [loan_application_details] AS [l]
ORDER BY [l].[application_no] DESC
2025-02-01 02:44:04.510 +03:00 [WRN] Savepoints are disabled because Multiple Active Result Sets (MARS) is enabled. If 'SaveChanges' fails, then the transaction cannot be automatically rolled back to a known clean state. Instead, the transaction should be rolled back by the application before retrying 'SaveChanges'. See https://go.microsoft.com/fwlink/?linkid=2149338 for more information and examples. To identify the code which triggers this warning, call 'ConfigureWarnings(w => w.Throw(SqlServerEventId.SavepointsDisabledBecauseOfMARS))'.
2025-02-01 02:44:04.515 +03:00 [INF] Executed DbCommand (3ms) [Parameters=[@p0='?' (Precision = 18) (Scale = 2) (DbType = Decimal), @p1='?' (DbType = Int32), @p2='?' (Size = 4000), @p3='?' (Precision = 5) (Scale = 2) (DbType = Decimal), @p4='?' (Size = 450), @p5='?' (Size = 4000), @p6='?' (Size = 4000), @p7='?' (Size = 4000), @p8='?' (Size = 4000), @p9='?' (Size = 50), @p10='?' (DbType = DateTime2), @p11='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SET IMPLICIT_TRANSACTIONS OFF;
SET NOCOUNT ON;
INSERT INTO [loan_application_details] ([loan_amount], [application_no], [customerDecision], [interest_rate], [national_id], [note], [noteUser], [loan_purpose], [remarks], [status], [status_date], [loan_tenure])
OUTPUT INSERTED.[loan_id]
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7, @p8, @p9, @p10, @p11);
2025-02-01 02:44:04.520 +03:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType9`2[[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Object, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-02-01 02:44:04.522 +03:00 [INF] Executed action NayifatAPI.Controllers.LoanApplicationController.CreateInitialApplication (NayifatAPI) in 158.3687ms
2025-02-01 02:44:04.524 +03:00 [INF] Executed endpoint 'NayifatAPI.Controllers.LoanApplicationController.CreateInitialApplication (NayifatAPI)'
2025-02-01 02:44:04.526 +03:00 [INF] Request finished HTTP/1.1 POST http://localhost:5264/api/loan-application/initial - 200 null application/json; charset=utf-8 169.9451ms
2025-02-01 02:45:13.262 +03:00 [INF] Request starting HTTP/1.1 POST http://localhost:5264/api/loan-application/initial - application/json 139
2025-02-01 02:45:13.264 +03:00 [INF] Executing endpoint 'NayifatAPI.Controllers.LoanApplicationController.CreateInitialApplication (NayifatAPI)'
2025-02-01 02:45:13.265 +03:00 [INF] Route matched with {action = "CreateInitialApplication", controller = "LoanApplication"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] CreateInitialApplication(NayifatAPI.Controllers.InitialLoanApplicationRequest) on controller NayifatAPI.Controllers.LoanApplicationController (NayifatAPI).
2025-02-01 02:45:13.277 +03:00 [INF] Executed DbCommand (5ms) [Parameters=[@__providedApiKey_0='?' (Size = 255)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [a].[Key], [a].[CreatedAt], [a].[Description], [a].[ExpiresAt], [a].[IsActive], [a].[LastUsedAt]
FROM [ApiKeys] AS [a]
WHERE [a].[Key] = @__providedApiKey_0 AND [a].[IsActive] = CAST(1 AS bit)
2025-02-01 02:45:13.285 +03:00 [INF] Executed DbCommand (2ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [l].[application_no]
FROM [loan_application_details] AS [l]
ORDER BY [l].[application_no] DESC
2025-02-01 02:45:13.287 +03:00 [WRN] Savepoints are disabled because Multiple Active Result Sets (MARS) is enabled. If 'SaveChanges' fails, then the transaction cannot be automatically rolled back to a known clean state. Instead, the transaction should be rolled back by the application before retrying 'SaveChanges'. See https://go.microsoft.com/fwlink/?linkid=2149338 for more information and examples. To identify the code which triggers this warning, call 'ConfigureWarnings(w => w.Throw(SqlServerEventId.SavepointsDisabledBecauseOfMARS))'.
2025-02-01 02:45:13.292 +03:00 [INF] Executed DbCommand (3ms) [Parameters=[@p0='?' (Precision = 18) (Scale = 2) (DbType = Decimal), @p1='?' (DbType = Int32), @p2='?' (Size = 4000), @p3='?' (Precision = 5) (Scale = 2) (DbType = Decimal), @p4='?' (Size = 450), @p5='?' (Size = 4000), @p6='?' (Size = 4000), @p7='?' (Size = 4000), @p8='?' (Size = 4000), @p9='?' (Size = 50), @p10='?' (DbType = DateTime2), @p11='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SET IMPLICIT_TRANSACTIONS OFF;
SET NOCOUNT ON;
INSERT INTO [loan_application_details] ([loan_amount], [application_no], [customerDecision], [interest_rate], [national_id], [note], [noteUser], [loan_purpose], [remarks], [status], [status_date], [loan_tenure])
OUTPUT INSERTED.[loan_id]
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7, @p8, @p9, @p10, @p11);
2025-02-01 02:45:13.302 +03:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType9`2[[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Object, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-02-01 02:45:13.303 +03:00 [INF] Executed action NayifatAPI.Controllers.LoanApplicationController.CreateInitialApplication (NayifatAPI) in 36.5514ms
2025-02-01 02:45:13.305 +03:00 [INF] Executed endpoint 'NayifatAPI.Controllers.LoanApplicationController.CreateInitialApplication (NayifatAPI)'
2025-02-01 02:45:13.306 +03:00 [INF] Request finished HTTP/1.1 POST http://localhost:5264/api/loan-application/initial - 200 null application/json; charset=utf-8 44.6914ms
2025-02-01 02:46:37.297 +03:00 [INF] Application is shutting down...
2025-02-01 02:46:51.649 +03:00 [INF] Starting web application
2025-02-01 02:46:51.788 +03:00 [INF] Now listening on: http://localhost:5264
2025-02-01 02:46:51.795 +03:00 [INF] Application started. Press Ctrl+C to shut down.
2025-02-01 02:46:51.796 +03:00 [INF] Hosting environment: Development
2025-02-01 02:46:51.797 +03:00 [INF] Content root path: C:\Users\yamta\StudioProjects\nayifat_app_2025_new\NayifatAPI
2025-02-01 02:47:09.637 +03:00 [INF] Request starting HTTP/1.1 POST http://localhost:5264/api/loan-application/initial - application/json 139
2025-02-01 02:47:09.690 +03:00 [WRN] Failed to determine the https port for redirect.
2025-02-01 02:47:09.697 +03:00 [INF] Executing endpoint 'NayifatAPI.Controllers.LoanApplicationController.CreateInitialApplication (NayifatAPI)'
2025-02-01 02:47:09.729 +03:00 [INF] Route matched with {action = "CreateInitialApplication", controller = "LoanApplication"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] CreateInitialApplication(NayifatAPI.Controllers.InitialLoanApplicationRequest) on controller NayifatAPI.Controllers.LoanApplicationController (NayifatAPI).
2025-02-01 02:47:11.593 +03:00 [INF] Executed DbCommand (59ms) [Parameters=[@__providedApiKey_0='?' (Size = 255)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [a].[Key], [a].[CreatedAt], [a].[Description], [a].[ExpiresAt], [a].[IsActive], [a].[LastUsedAt]
FROM [ApiKeys] AS [a]
WHERE [a].[Key] = @__providedApiKey_0 AND [a].[IsActive] = CAST(1 AS bit)
2025-02-01 02:47:11.954 +03:00 [INF] Executed DbCommand (136ms) [Parameters=[@__request_NationalId_0='?' (Size = 450)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [l].[loan_id], [l].[loan_amount], [l].[application_no], [l].[customerDecision], [l].[interest_rate], [l].[national_id], [l].[note], [l].[noteUser], [l].[loan_purpose], [l].[remarks], [l].[status], [l].[status_date], [l].[loan_tenure]
FROM [loan_application_details] AS [l]
WHERE [l].[national_id] = @__request_NationalId_0 AND [l].[status] = N'pending'
2025-02-01 02:47:12.821 +03:00 [INF] Executing ObjectResult, writing value of type '<>f__AnonymousType11`2[[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-02-01 02:47:13.159 +03:00 [INF] Executed action NayifatAPI.Controllers.LoanApplicationController.CreateInitialApplication (NayifatAPI) in 3408.5408ms
2025-02-01 02:47:13.516 +03:00 [INF] Executed endpoint 'NayifatAPI.Controllers.LoanApplicationController.CreateInitialApplication (NayifatAPI)'
2025-02-01 02:47:13.527 +03:00 [INF] Request finished HTTP/1.1 POST http://localhost:5264/api/loan-application/initial - 400 null application/json; charset=utf-8 3892.2158ms
2025-02-01 02:47:21.300 +03:00 [INF] Request starting HTTP/1.1 POST http://localhost:5264/api/loan-application/initial - application/json 139
2025-02-01 02:47:21.306 +03:00 [INF] Executing endpoint 'NayifatAPI.Controllers.LoanApplicationController.CreateInitialApplication (NayifatAPI)'
2025-02-01 02:47:21.308 +03:00 [INF] Route matched with {action = "CreateInitialApplication", controller = "LoanApplication"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] CreateInitialApplication(NayifatAPI.Controllers.InitialLoanApplicationRequest) on controller NayifatAPI.Controllers.LoanApplicationController (NayifatAPI).
2025-02-01 02:47:21.342 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@__providedApiKey_0='?' (Size = 255)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [a].[Key], [a].[CreatedAt], [a].[Description], [a].[ExpiresAt], [a].[IsActive], [a].[LastUsedAt]
FROM [ApiKeys] AS [a]
WHERE [a].[Key] = @__providedApiKey_0 AND [a].[IsActive] = CAST(1 AS bit)
2025-02-01 02:47:21.350 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@__request_NationalId_0='?' (Size = 450)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [l].[loan_id], [l].[loan_amount], [l].[application_no], [l].[customerDecision], [l].[interest_rate], [l].[national_id], [l].[note], [l].[noteUser], [l].[loan_purpose], [l].[remarks], [l].[status], [l].[status_date], [l].[loan_tenure]
FROM [loan_application_details] AS [l]
WHERE [l].[national_id] = @__request_NationalId_0 AND [l].[status] = N'pending'
2025-02-01 02:47:21.407 +03:00 [INF] Executed DbCommand (3ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [l].[application_no]
FROM [loan_application_details] AS [l]
ORDER BY [l].[application_no] DESC
2025-02-01 02:47:21.631 +03:00 [WRN] Savepoints are disabled because Multiple Active Result Sets (MARS) is enabled. If 'SaveChanges' fails, then the transaction cannot be automatically rolled back to a known clean state. Instead, the transaction should be rolled back by the application before retrying 'SaveChanges'. See https://go.microsoft.com/fwlink/?linkid=2149338 for more information and examples. To identify the code which triggers this warning, call 'ConfigureWarnings(w => w.Throw(SqlServerEventId.SavepointsDisabledBecauseOfMARS))'.
2025-02-01 02:47:21.643 +03:00 [INF] Executed DbCommand (5ms) [Parameters=[@p0='?' (Precision = 18) (Scale = 2) (DbType = Decimal), @p1='?' (DbType = Int32), @p2='?' (Size = 4000), @p3='?' (Precision = 5) (Scale = 2) (DbType = Decimal), @p4='?' (Size = 450), @p5='?' (Size = 4000), @p6='?' (Size = 4000), @p7='?' (Size = 4000), @p8='?' (Size = 4000), @p9='?' (Size = 50), @p10='?' (DbType = DateTime2), @p11='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SET IMPLICIT_TRANSACTIONS OFF;
SET NOCOUNT ON;
INSERT INTO [loan_application_details] ([loan_amount], [application_no], [customerDecision], [interest_rate], [national_id], [note], [noteUser], [loan_purpose], [remarks], [status], [status_date], [loan_tenure])
OUTPUT INSERTED.[loan_id]
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7, @p8, @p9, @p10, @p11);
2025-02-01 02:47:21.707 +03:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType9`2[[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Object, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-02-01 02:47:21.738 +03:00 [INF] Executed action NayifatAPI.Controllers.LoanApplicationController.CreateInitialApplication (NayifatAPI) in 428.6017ms
2025-02-01 02:47:21.741 +03:00 [INF] Executed endpoint 'NayifatAPI.Controllers.LoanApplicationController.CreateInitialApplication (NayifatAPI)'
2025-02-01 02:47:21.743 +03:00 [INF] Request finished HTTP/1.1 POST http://localhost:5264/api/loan-application/initial - 200 null application/json; charset=utf-8 442.8346ms
2025-02-01 02:49:42.136 +03:00 [INF] Request starting HTTP/1.1 POST http://localhost:5264/api/card-application/initial - application/json 139
2025-02-01 02:49:42.152 +03:00 [INF] Request finished HTTP/1.1 POST http://localhost:5264/api/card-application/initial - 404 0 null 16.6736ms
2025-02-01 02:49:42.161 +03:00 [INF] Request reached the end of the middleware pipeline without being handled by application code. Request path: POST http://localhost:5264/api/card-application/initial, Response status code: 404
2025-02-01 02:49:48.060 +03:00 [INF] Application is shutting down...
2025-02-01 02:50:01.624 +03:00 [INF] Starting web application
2025-02-01 02:50:01.716 +03:00 [INF] Now listening on: http://localhost:5264
2025-02-01 02:50:01.720 +03:00 [INF] Application started. Press Ctrl+C to shut down.
2025-02-01 02:50:01.721 +03:00 [INF] Hosting environment: Development
2025-02-01 02:50:01.722 +03:00 [INF] Content root path: C:\Users\yamta\StudioProjects\nayifat_app_2025_new\NayifatAPI
2025-02-01 02:50:07.966 +03:00 [INF] Request starting HTTP/1.1 POST http://localhost:5264/api/card-application/initial - application/json 139
2025-02-01 02:50:08.062 +03:00 [WRN] Failed to determine the https port for redirect.
2025-02-01 02:50:08.069 +03:00 [INF] Executing endpoint 'NayifatAPI.Controllers.CardApplicationController.CreateInitialApplication (NayifatAPI)'
2025-02-01 02:50:08.165 +03:00 [INF] Route matched with {action = "CreateInitialApplication", controller = "CardApplication"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] CreateInitialApplication(NayifatAPI.Controllers.InitialCardApplicationRequest) on controller NayifatAPI.Controllers.CardApplicationController (NayifatAPI).
2025-02-01 02:50:11.051 +03:00 [INF] Executed DbCommand (65ms) [Parameters=[@__providedApiKey_0='?' (Size = 255)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [a].[Key], [a].[CreatedAt], [a].[Description], [a].[ExpiresAt], [a].[IsActive], [a].[LastUsedAt]
FROM [ApiKeys] AS [a]
WHERE [a].[Key] = @__providedApiKey_0 AND [a].[IsActive] = CAST(1 AS bit)
2025-02-01 02:50:11.263 +03:00 [INF] Executed DbCommand (23ms) [Parameters=[@__request_NationalId_0='?' (Size = 450)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [c].[card_id], [c].[application_no], [c].[card_limit], [c].[card_type], [c].[national_id], [c].[note], [c].[noteUser], [c].[remarks], [c].[status], [c].[status_date]
FROM [card_application_details] AS [c]
WHERE [c].[national_id] = @__request_NationalId_0 AND [c].[status] = N'pending'
2025-02-01 02:50:11.348 +03:00 [INF] Executed DbCommand (3ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [c].[application_no]
FROM [card_application_details] AS [c]
ORDER BY [c].[application_no] DESC
2025-02-01 02:50:11.590 +03:00 [WRN] Savepoints are disabled because Multiple Active Result Sets (MARS) is enabled. If 'SaveChanges' fails, then the transaction cannot be automatically rolled back to a known clean state. Instead, the transaction should be rolled back by the application before retrying 'SaveChanges'. See https://go.microsoft.com/fwlink/?linkid=2149338 for more information and examples. To identify the code which triggers this warning, call 'ConfigureWarnings(w => w.Throw(SqlServerEventId.SavepointsDisabledBecauseOfMARS))'.
2025-02-01 02:50:11.604 +03:00 [INF] Executed DbCommand (6ms) [Parameters=[@p0='?' (DbType = Int32), @p1='?' (Precision = 18) (Scale = 2) (DbType = Decimal), @p2='?' (Size = 50), @p3='?' (Size = 450), @p4='?' (Size = 4000), @p5='?' (Size = 4000), @p6='?' (Size = 4000), @p7='?' (Size = 50), @p8='?' (DbType = DateTime2)], CommandType='"Text"', CommandTimeout='30']
SET IMPLICIT_TRANSACTIONS OFF;
SET NOCOUNT ON;
INSERT INTO [card_application_details] ([application_no], [card_limit], [card_type], [national_id], [note], [noteUser], [remarks], [status], [status_date])
OUTPUT INSERTED.[card_id]
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7, @p8);
2025-02-01 02:50:11.678 +03:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType9`2[[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Object, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-02-01 02:50:11.729 +03:00 [INF] Executed action NayifatAPI.Controllers.CardApplicationController.CreateInitialApplication (NayifatAPI) in 3553.8878ms
2025-02-01 02:50:11.736 +03:00 [INF] Executed endpoint 'NayifatAPI.Controllers.CardApplicationController.CreateInitialApplication (NayifatAPI)'
2025-02-01 02:50:11.761 +03:00 [INF] Request finished HTTP/1.1 POST http://localhost:5264/api/card-application/initial - 200 null application/json; charset=utf-8 3794.7016ms
2025-02-01 02:50:17.226 +03:00 [INF] Request starting HTTP/1.1 POST http://localhost:5264/api/card-application/initial - application/json 139
2025-02-01 02:50:17.247 +03:00 [INF] Executing endpoint 'NayifatAPI.Controllers.CardApplicationController.CreateInitialApplication (NayifatAPI)'
2025-02-01 02:50:17.250 +03:00 [INF] Route matched with {action = "CreateInitialApplication", controller = "CardApplication"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] CreateInitialApplication(NayifatAPI.Controllers.InitialCardApplicationRequest) on controller NayifatAPI.Controllers.CardApplicationController (NayifatAPI).
2025-02-01 02:50:17.302 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@__providedApiKey_0='?' (Size = 255)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [a].[Key], [a].[CreatedAt], [a].[Description], [a].[ExpiresAt], [a].[IsActive], [a].[LastUsedAt]
FROM [ApiKeys] AS [a]
WHERE [a].[Key] = @__providedApiKey_0 AND [a].[IsActive] = CAST(1 AS bit)
2025-02-01 02:50:17.310 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@__request_NationalId_0='?' (Size = 450)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [c].[card_id], [c].[application_no], [c].[card_limit], [c].[card_type], [c].[national_id], [c].[note], [c].[noteUser], [c].[remarks], [c].[status], [c].[status_date]
FROM [card_application_details] AS [c]
WHERE [c].[national_id] = @__request_NationalId_0 AND [c].[status] = N'pending'
2025-02-01 02:50:17.320 +03:00 [INF] Executing ObjectResult, writing value of type '<>f__AnonymousType11`2[[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-02-01 02:50:17.328 +03:00 [INF] Executed action NayifatAPI.Controllers.CardApplicationController.CreateInitialApplication (NayifatAPI) in 74.7042ms
2025-02-01 02:50:17.331 +03:00 [INF] Executed endpoint 'NayifatAPI.Controllers.CardApplicationController.CreateInitialApplication (NayifatAPI)'
2025-02-01 02:50:17.335 +03:00 [INF] Request finished HTTP/1.1 POST http://localhost:5264/api/card-application/initial - 400 null application/json; charset=utf-8 107.9732ms
2025-02-01 02:50:32.114 +03:00 [INF] Application is shutting down...
2025-02-01 02:51:09.167 +03:00 [INF] Starting web application
2025-02-01 02:51:09.299 +03:00 [INF] Now listening on: http://localhost:5264
2025-02-01 02:51:09.305 +03:00 [INF] Application started. Press Ctrl+C to shut down.
2025-02-01 02:51:09.306 +03:00 [INF] Hosting environment: Development
2025-02-01 02:51:09.307 +03:00 [INF] Content root path: C:\Users\yamta\StudioProjects\nayifat_app_2025_new\NayifatAPI
2025-02-01 02:51:26.491 +03:00 [INF] Request starting HTTP/1.1 POST http://localhost:5264/api/card-application/initial - application/json 139
2025-02-01 02:51:26.560 +03:00 [WRN] Failed to determine the https port for redirect.
2025-02-01 02:51:26.569 +03:00 [INF] Executing endpoint 'NayifatAPI.Controllers.CardApplicationController.CreateInitialApplication (NayifatAPI)'
2025-02-01 02:51:26.609 +03:00 [INF] Route matched with {action = "CreateInitialApplication", controller = "CardApplication"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] CreateInitialApplication(NayifatAPI.Controllers.InitialCardApplicationRequest) on controller NayifatAPI.Controllers.CardApplicationController (NayifatAPI).
2025-02-01 02:51:29.048 +03:00 [INF] Executed DbCommand (45ms) [Parameters=[@__providedApiKey_0='?' (Size = 255)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [a].[Key], [a].[CreatedAt], [a].[Description], [a].[ExpiresAt], [a].[IsActive], [a].[LastUsedAt]
FROM [ApiKeys] AS [a]
WHERE [a].[Key] = @__providedApiKey_0 AND [a].[IsActive] = CAST(1 AS bit)
2025-02-01 02:51:29.269 +03:00 [INF] Executed DbCommand (31ms) [Parameters=[@__request_NationalId_0='?' (Size = 450)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [c].[card_id], [c].[application_no], [c].[card_limit], [c].[card_type], [c].[national_id], [c].[note], [c].[noteUser], [c].[remarks], [c].[status], [c].[status_date]
FROM [card_application_details] AS [c]
WHERE [c].[national_id] = @__request_NationalId_0 AND [c].[status] = N'pending'
2025-02-01 02:51:29.354 +03:00 [INF] Executing ObjectResult, writing value of type '<>f__AnonymousType11`2[[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-02-01 02:51:29.378 +03:00 [INF] Executed action NayifatAPI.Controllers.CardApplicationController.CreateInitialApplication (NayifatAPI) in 2759.1806ms
2025-02-01 02:51:29.382 +03:00 [INF] Executed endpoint 'NayifatAPI.Controllers.CardApplicationController.CreateInitialApplication (NayifatAPI)'
2025-02-01 02:51:29.400 +03:00 [INF] Request finished HTTP/1.1 POST http://localhost:5264/api/card-application/initial - 400 null application/json; charset=utf-8 2910.7758ms
2025-02-01 02:51:58.916 +03:00 [INF] Request starting HTTP/1.1 POST http://localhost:5264/api/card-application/update - application/json 254
2025-02-01 02:51:58.923 +03:00 [INF] Executing endpoint 'NayifatAPI.Controllers.CardApplicationController.UpdateCardApplication (NayifatAPI)'
2025-02-01 02:51:58.933 +03:00 [INF] Route matched with {action = "UpdateCardApplication", controller = "CardApplication"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] UpdateCardApplication(NayifatAPI.Controllers.UpdateCardApplicationRequest) on controller NayifatAPI.Controllers.CardApplicationController (NayifatAPI).
2025-02-01 02:51:58.999 +03:00 [INF] Executed DbCommand (0ms) [Parameters=[@__providedApiKey_0='?' (Size = 255)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [a].[Key], [a].[CreatedAt], [a].[Description], [a].[ExpiresAt], [a].[IsActive], [a].[LastUsedAt]
FROM [ApiKeys] AS [a]
WHERE [a].[Key] = @__providedApiKey_0 AND [a].[IsActive] = CAST(1 AS bit)
2025-02-01 02:51:59.152 +03:00 [INF] Executed DbCommand (108ms) [Parameters=[@__request_NationalId_0='?' (Size = 450), @__request_ApplicationNo_1='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [c].[card_id], [c].[application_no], [c].[card_limit], [c].[card_type], [c].[national_id], [c].[note], [c].[noteUser], [c].[remarks], [c].[status], [c].[status_date]
FROM [card_application_details] AS [c]
WHERE [c].[national_id] = @__request_NationalId_0 AND [c].[application_no] = @__request_ApplicationNo_1
2025-02-01 02:51:59.162 +03:00 [INF] Executing ObjectResult, writing value of type '<>f__AnonymousType11`2[[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-02-01 02:51:59.171 +03:00 [INF] Executed action NayifatAPI.Controllers.CardApplicationController.UpdateCardApplication (NayifatAPI) in 234.7377ms
2025-02-01 02:51:59.173 +03:00 [INF] Executed endpoint 'NayifatAPI.Controllers.CardApplicationController.UpdateCardApplication (NayifatAPI)'
2025-02-01 02:51:59.176 +03:00 [INF] Request finished HTTP/1.1 POST http://localhost:5264/api/card-application/update - 404 null application/json; charset=utf-8 260.3751ms
2025-02-01 02:52:08.506 +03:00 [INF] Request starting HTTP/1.1 POST http://localhost:5264/api/card-application/update - application/json 254
2025-02-01 02:52:08.511 +03:00 [INF] Executing endpoint 'NayifatAPI.Controllers.CardApplicationController.UpdateCardApplication (NayifatAPI)'
2025-02-01 02:52:08.513 +03:00 [INF] Route matched with {action = "UpdateCardApplication", controller = "CardApplication"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] UpdateCardApplication(NayifatAPI.Controllers.UpdateCardApplicationRequest) on controller NayifatAPI.Controllers.CardApplicationController (NayifatAPI).
2025-02-01 02:52:08.616 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@__providedApiKey_0='?' (Size = 255)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [a].[Key], [a].[CreatedAt], [a].[Description], [a].[ExpiresAt], [a].[IsActive], [a].[LastUsedAt]
FROM [ApiKeys] AS [a]
WHERE [a].[Key] = @__providedApiKey_0 AND [a].[IsActive] = CAST(1 AS bit)
2025-02-01 02:52:08.626 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@__request_NationalId_0='?' (Size = 450), @__request_ApplicationNo_1='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [c].[card_id], [c].[application_no], [c].[card_limit], [c].[card_type], [c].[national_id], [c].[note], [c].[noteUser], [c].[remarks], [c].[status], [c].[status_date]
FROM [card_application_details] AS [c]
WHERE [c].[national_id] = @__request_NationalId_0 AND [c].[application_no] = @__request_ApplicationNo_1
2025-02-01 02:52:08.781 +03:00 [WRN] Savepoints are disabled because Multiple Active Result Sets (MARS) is enabled. If 'SaveChanges' fails, then the transaction cannot be automatically rolled back to a known clean state. Instead, the transaction should be rolled back by the application before retrying 'SaveChanges'. See https://go.microsoft.com/fwlink/?linkid=2149338 for more information and examples. To identify the code which triggers this warning, call 'ConfigureWarnings(w => w.Throw(SqlServerEventId.SavepointsDisabledBecauseOfMARS))'.
2025-02-01 02:52:08.799 +03:00 [INF] Executed DbCommand (13ms) [Parameters=[@p7='?' (DbType = Int32), @p0='?' (Precision = 18) (Scale = 2) (DbType = Decimal), @p1='?' (Size = 50), @p2='?' (Size = 4000), @p3='?' (Size = 4000), @p4='?' (Size = 4000), @p5='?' (Size = 50), @p6='?' (DbType = DateTime2)], CommandType='"Text"', CommandTimeout='30']
SET IMPLICIT_TRANSACTIONS OFF;
SET NOCOUNT ON;
UPDATE [card_application_details] SET [card_limit] = @p0, [card_type] = @p1, [note] = @p2, [noteUser] = @p3, [remarks] = @p4, [status] = @p5, [status_date] = @p6
OUTPUT 1
WHERE [card_id] = @p7;
2025-02-01 02:52:08.837 +03:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType9`2[[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Object, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-02-01 02:52:08.865 +03:00 [INF] Executed action NayifatAPI.Controllers.CardApplicationController.UpdateCardApplication (NayifatAPI) in 349.5074ms
2025-02-01 02:52:08.867 +03:00 [INF] Executed endpoint 'NayifatAPI.Controllers.CardApplicationController.UpdateCardApplication (NayifatAPI)'
2025-02-01 02:52:08.869 +03:00 [INF] Request finished HTTP/1.1 POST http://localhost:5264/api/card-application/update - 200 null application/json; charset=utf-8 362.1477ms
2025-02-01 02:52:32.719 +03:00 [INF] Request starting HTTP/1.1 POST http://localhost:5264/api/loan-application/update - application/json 254
2025-02-01 02:52:32.762 +03:00 [INF] Executing endpoint 'NayifatAPI.Controllers.LoanApplicationController.UpdateLoanApplication (NayifatAPI)'
2025-02-01 02:52:32.886 +03:00 [INF] Route matched with {action = "UpdateLoanApplication", controller = "LoanApplication"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] UpdateLoanApplication(NayifatAPI.Controllers.UpdateLoanApplicationRequest) on controller NayifatAPI.Controllers.LoanApplicationController (NayifatAPI).
2025-02-01 02:52:33.024 +03:00 [INF] Executing BadRequestObjectResult, writing value of type 'Microsoft.AspNetCore.Mvc.ValidationProblemDetails'.
2025-02-01 02:52:33.074 +03:00 [INF] Executed action NayifatAPI.Controllers.LoanApplicationController.UpdateLoanApplication (NayifatAPI) in 83.2528ms
2025-02-01 02:52:33.078 +03:00 [INF] Executed endpoint 'NayifatAPI.Controllers.LoanApplicationController.UpdateLoanApplication (NayifatAPI)'
2025-02-01 02:52:33.113 +03:00 [INF] Request finished HTTP/1.1 POST http://localhost:5264/api/loan-application/update - 400 null application/problem+json; charset=utf-8 394.3548ms
2025-02-01 02:53:11.895 +03:00 [INF] Request starting HTTP/1.1 POST http://localhost:5264/api/loan-application/update - application/json 343
2025-02-01 02:53:11.898 +03:00 [INF] Executing endpoint 'NayifatAPI.Controllers.LoanApplicationController.UpdateLoanApplication (NayifatAPI)'
2025-02-01 02:53:11.899 +03:00 [INF] Route matched with {action = "UpdateLoanApplication", controller = "LoanApplication"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] UpdateLoanApplication(NayifatAPI.Controllers.UpdateLoanApplicationRequest) on controller NayifatAPI.Controllers.LoanApplicationController (NayifatAPI).
2025-02-01 02:53:11.915 +03:00 [INF] Executed DbCommand (5ms) [Parameters=[@__providedApiKey_0='?' (Size = 255)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [a].[Key], [a].[CreatedAt], [a].[Description], [a].[ExpiresAt], [a].[IsActive], [a].[LastUsedAt]
FROM [ApiKeys] AS [a]
WHERE [a].[Key] = @__providedApiKey_0 AND [a].[IsActive] = CAST(1 AS bit)
2025-02-01 02:53:11.972 +03:00 [ERR] Failed executing DbCommand (6ms) [Parameters=[@__p_0='?' (Size = 450)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [c].[NationalId], [c].[AddNo], [c].[BuildingNo], [c].[City], [c].[Consent], [c].[ConsentDate], [c].[DateOfBirth], [c].[Dependents], [c].[District], [c].[Email], [c].[Employer], [c].[EmployerName], [c].[EmploymentStatus], [c].[FamilyNameAr], [c].[FamilyNameEn], [c].[FirstNameAr], [c].[FirstNameEn], [c].[Iban], [c].[IdExpiryDate], [c].[Language], [c].[Los], [c].[Mpin], [c].[MpinEnabled], [c].[NafathStatus], [c].[NafathTimestamp], [c].[Password], [c].[Phone], [c].[RegistrationDate], [c].[Salary], [c].[SalaryCustomer], [c].[SalaryDakhli], [c].[SecondNameAr], [c].[SecondNameEn], [c].[Sector], [c].[Street], [c].[ThirdNameAr], [c].[ThirdNameEn], [c].[Zipcode]
FROM [Customers] AS [c]
WHERE [c].[NationalId] = @__p_0
2025-02-01 02:53:11.991 +03:00 [ERR] An exception occurred while iterating over the results of a query for context type 'NayifatAPI.Data.ApplicationDbContext'.
Microsoft.Data.SqlClient.SqlException (0x80131904): Invalid column name 'EmployerName'.
Invalid column name 'EmploymentStatus'.
Invalid column name 'Language'.
Invalid column name 'Salary'.
   at Microsoft.Data.SqlClient.SqlCommand.<>c.<ExecuteDbDataReaderAsync>b__209_0(Task`1 result)
   at System.Threading.Tasks.ContinuationResultTaskFromResultTask`2.InnerInvoke()
   at System.Threading.ExecutionContext.RunInternal(ExecutionContext executionContext, ContextCallback callback, Object state)
--- End of stack trace from previous location ---
   at System.Threading.ExecutionContext.RunInternal(ExecutionContext executionContext, ContextCallback callback, Object state)
   at System.Threading.Tasks.Task.ExecuteWithThreadLocal(Task& currentTaskSlot, Thread threadPoolThread)
--- End of stack trace from previous location ---
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Query.Internal.SingleQueryingEnumerable`1.AsyncEnumerator.InitializeReaderAsync(AsyncEnumerator enumerator, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Storage.Internal.SqlServerExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Query.Internal.SingleQueryingEnumerable`1.AsyncEnumerator.MoveNextAsync()
ClientConnectionId:13412fa3-03ba-4cc8-a3e3-f80ca4e7b201
Error Number:207,State:1,Class:16
Microsoft.Data.SqlClient.SqlException (0x80131904): Invalid column name 'EmployerName'.
Invalid column name 'EmploymentStatus'.
Invalid column name 'Language'.
Invalid column name 'Salary'.
   at Microsoft.Data.SqlClient.SqlCommand.<>c.<ExecuteDbDataReaderAsync>b__209_0(Task`1 result)
   at System.Threading.Tasks.ContinuationResultTaskFromResultTask`2.InnerInvoke()
   at System.Threading.ExecutionContext.RunInternal(ExecutionContext executionContext, ContextCallback callback, Object state)
--- End of stack trace from previous location ---
   at System.Threading.ExecutionContext.RunInternal(ExecutionContext executionContext, ContextCallback callback, Object state)
   at System.Threading.Tasks.Task.ExecuteWithThreadLocal(Task& currentTaskSlot, Thread threadPoolThread)
--- End of stack trace from previous location ---
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Query.Internal.SingleQueryingEnumerable`1.AsyncEnumerator.InitializeReaderAsync(AsyncEnumerator enumerator, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Storage.Internal.SqlServerExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Query.Internal.SingleQueryingEnumerable`1.AsyncEnumerator.MoveNextAsync()
ClientConnectionId:13412fa3-03ba-4cc8-a3e3-f80ca4e7b201
Error Number:207,State:1,Class:16
2025-02-01 02:53:12.005 +03:00 [ERR] Error updating loan application for National ID: 1234567890
Microsoft.Data.SqlClient.SqlException (0x80131904): Invalid column name 'EmployerName'.
Invalid column name 'EmploymentStatus'.
Invalid column name 'Language'.
Invalid column name 'Salary'.
   at Microsoft.Data.SqlClient.SqlCommand.<>c.<ExecuteDbDataReaderAsync>b__209_0(Task`1 result)
   at System.Threading.Tasks.ContinuationResultTaskFromResultTask`2.InnerInvoke()
   at System.Threading.ExecutionContext.RunInternal(ExecutionContext executionContext, ContextCallback callback, Object state)
--- End of stack trace from previous location ---
   at System.Threading.ExecutionContext.RunInternal(ExecutionContext executionContext, ContextCallback callback, Object state)
   at System.Threading.Tasks.Task.ExecuteWithThreadLocal(Task& currentTaskSlot, Thread threadPoolThread)
--- End of stack trace from previous location ---
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Query.Internal.SingleQueryingEnumerable`1.AsyncEnumerator.InitializeReaderAsync(AsyncEnumerator enumerator, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Storage.Internal.SqlServerExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Query.Internal.SingleQueryingEnumerable`1.AsyncEnumerator.MoveNextAsync()
   at Microsoft.EntityFrameworkCore.Query.ShapedQueryCompilingExpressionVisitor.SingleOrDefaultAsync[TSource](IAsyncEnumerable`1 asyncEnumerable, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Query.ShapedQueryCompilingExpressionVisitor.SingleOrDefaultAsync[TSource](IAsyncEnumerable`1 asyncEnumerable, CancellationToken cancellationToken)
   at NayifatAPI.Controllers.LoanApplicationController.UpdateLoanApplication(UpdateLoanApplicationRequest request) in C:\Users\yamta\StudioProjects\nayifat_app_2025_new\NayifatAPI\Controllers\LoanApplicationController.cs:line 147
   at NayifatAPI.Controllers.LoanApplicationController.UpdateLoanApplication(UpdateLoanApplicationRequest request) in C:\Users\yamta\StudioProjects\nayifat_app_2025_new\NayifatAPI\Controllers\LoanApplicationController.cs:line 204
   at NayifatAPI.Controllers.LoanApplicationController.UpdateLoanApplication(UpdateLoanApplicationRequest request) in C:\Users\yamta\StudioProjects\nayifat_app_2025_new\NayifatAPI\Controllers\LoanApplicationController.cs:line 205
ClientConnectionId:13412fa3-03ba-4cc8-a3e3-f80ca4e7b201
Error Number:207,State:1,Class:16
2025-02-01 02:53:12.028 +03:00 [INF] Executing ObjectResult, writing value of type '<>f__AnonymousType11`2[[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-02-01 02:53:12.030 +03:00 [INF] Executed action NayifatAPI.Controllers.LoanApplicationController.UpdateLoanApplication (NayifatAPI) in 130.0579ms
2025-02-01 02:53:12.032 +03:00 [INF] Executed endpoint 'NayifatAPI.Controllers.LoanApplicationController.UpdateLoanApplication (NayifatAPI)'
2025-02-01 02:53:12.034 +03:00 [INF] Request finished HTTP/1.1 POST http://localhost:5264/api/loan-application/update - 500 null application/json; charset=utf-8 139.0928ms
2025-02-01 02:53:30.388 +03:00 [INF] Request starting HTTP/1.1 POST http://localhost:5264/api/loan-application/update - application/json 343
2025-02-01 02:53:30.600 +03:00 [INF] Executing endpoint 'NayifatAPI.Controllers.LoanApplicationController.UpdateLoanApplication (NayifatAPI)'
2025-02-01 02:53:30.602 +03:00 [INF] Route matched with {action = "UpdateLoanApplication", controller = "LoanApplication"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] UpdateLoanApplication(NayifatAPI.Controllers.UpdateLoanApplicationRequest) on controller NayifatAPI.Controllers.LoanApplicationController (NayifatAPI).
2025-02-01 02:53:30.631 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@__providedApiKey_0='?' (Size = 255)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [a].[Key], [a].[CreatedAt], [a].[Description], [a].[ExpiresAt], [a].[IsActive], [a].[LastUsedAt]
FROM [ApiKeys] AS [a]
WHERE [a].[Key] = @__providedApiKey_0 AND [a].[IsActive] = CAST(1 AS bit)
2025-02-01 02:53:30.642 +03:00 [ERR] Failed executing DbCommand (4ms) [Parameters=[@__p_0='?' (Size = 450)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [c].[NationalId], [c].[AddNo], [c].[BuildingNo], [c].[City], [c].[Consent], [c].[ConsentDate], [c].[DateOfBirth], [c].[Dependents], [c].[District], [c].[Email], [c].[Employer], [c].[EmployerName], [c].[EmploymentStatus], [c].[FamilyNameAr], [c].[FamilyNameEn], [c].[FirstNameAr], [c].[FirstNameEn], [c].[Iban], [c].[IdExpiryDate], [c].[Language], [c].[Los], [c].[Mpin], [c].[MpinEnabled], [c].[NafathStatus], [c].[NafathTimestamp], [c].[Password], [c].[Phone], [c].[RegistrationDate], [c].[Salary], [c].[SalaryCustomer], [c].[SalaryDakhli], [c].[SecondNameAr], [c].[SecondNameEn], [c].[Sector], [c].[Street], [c].[ThirdNameAr], [c].[ThirdNameEn], [c].[Zipcode]
FROM [Customers] AS [c]
WHERE [c].[NationalId] = @__p_0
2025-02-01 02:53:30.708 +03:00 [ERR] An exception occurred while iterating over the results of a query for context type 'NayifatAPI.Data.ApplicationDbContext'.
Microsoft.Data.SqlClient.SqlException (0x80131904): Invalid column name 'EmployerName'.
Invalid column name 'EmploymentStatus'.
Invalid column name 'Language'.
Invalid column name 'Salary'.
   at Microsoft.Data.SqlClient.SqlCommand.<>c.<ExecuteDbDataReaderAsync>b__209_0(Task`1 result)
   at System.Threading.Tasks.ContinuationResultTaskFromResultTask`2.InnerInvoke()
   at System.Threading.ExecutionContext.RunInternal(ExecutionContext executionContext, ContextCallback callback, Object state)
--- End of stack trace from previous location ---
   at System.Threading.ExecutionContext.RunInternal(ExecutionContext executionContext, ContextCallback callback, Object state)
   at System.Threading.Tasks.Task.ExecuteWithThreadLocal(Task& currentTaskSlot, Thread threadPoolThread)
--- End of stack trace from previous location ---
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Query.Internal.SingleQueryingEnumerable`1.AsyncEnumerator.InitializeReaderAsync(AsyncEnumerator enumerator, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Storage.Internal.SqlServerExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Query.Internal.SingleQueryingEnumerable`1.AsyncEnumerator.MoveNextAsync()
ClientConnectionId:13412fa3-03ba-4cc8-a3e3-f80ca4e7b201
Error Number:207,State:1,Class:16
Microsoft.Data.SqlClient.SqlException (0x80131904): Invalid column name 'EmployerName'.
Invalid column name 'EmploymentStatus'.
Invalid column name 'Language'.
Invalid column name 'Salary'.
   at Microsoft.Data.SqlClient.SqlCommand.<>c.<ExecuteDbDataReaderAsync>b__209_0(Task`1 result)
   at System.Threading.Tasks.ContinuationResultTaskFromResultTask`2.InnerInvoke()
   at System.Threading.ExecutionContext.RunInternal(ExecutionContext executionContext, ContextCallback callback, Object state)
--- End of stack trace from previous location ---
   at System.Threading.ExecutionContext.RunInternal(ExecutionContext executionContext, ContextCallback callback, Object state)
   at System.Threading.Tasks.Task.ExecuteWithThreadLocal(Task& currentTaskSlot, Thread threadPoolThread)
--- End of stack trace from previous location ---
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Query.Internal.SingleQueryingEnumerable`1.AsyncEnumerator.InitializeReaderAsync(AsyncEnumerator enumerator, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Storage.Internal.SqlServerExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Query.Internal.SingleQueryingEnumerable`1.AsyncEnumerator.MoveNextAsync()
ClientConnectionId:13412fa3-03ba-4cc8-a3e3-f80ca4e7b201
Error Number:207,State:1,Class:16
2025-02-01 02:53:30.956 +03:00 [ERR] Error updating loan application for National ID: 1234567892
Microsoft.Data.SqlClient.SqlException (0x80131904): Invalid column name 'EmployerName'.
Invalid column name 'EmploymentStatus'.
Invalid column name 'Language'.
Invalid column name 'Salary'.
   at Microsoft.Data.SqlClient.SqlCommand.<>c.<ExecuteDbDataReaderAsync>b__209_0(Task`1 result)
   at System.Threading.Tasks.ContinuationResultTaskFromResultTask`2.InnerInvoke()
   at System.Threading.ExecutionContext.RunInternal(ExecutionContext executionContext, ContextCallback callback, Object state)
--- End of stack trace from previous location ---
   at System.Threading.ExecutionContext.RunInternal(ExecutionContext executionContext, ContextCallback callback, Object state)
   at System.Threading.Tasks.Task.ExecuteWithThreadLocal(Task& currentTaskSlot, Thread threadPoolThread)
--- End of stack trace from previous location ---
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Query.Internal.SingleQueryingEnumerable`1.AsyncEnumerator.InitializeReaderAsync(AsyncEnumerator enumerator, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Storage.Internal.SqlServerExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Query.Internal.SingleQueryingEnumerable`1.AsyncEnumerator.MoveNextAsync()
   at Microsoft.EntityFrameworkCore.Query.ShapedQueryCompilingExpressionVisitor.SingleOrDefaultAsync[TSource](IAsyncEnumerable`1 asyncEnumerable, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Query.ShapedQueryCompilingExpressionVisitor.SingleOrDefaultAsync[TSource](IAsyncEnumerable`1 asyncEnumerable, CancellationToken cancellationToken)
   at NayifatAPI.Controllers.LoanApplicationController.UpdateLoanApplication(UpdateLoanApplicationRequest request) in C:\Users\yamta\StudioProjects\nayifat_app_2025_new\NayifatAPI\Controllers\LoanApplicationController.cs:line 147
   at NayifatAPI.Controllers.LoanApplicationController.UpdateLoanApplication(UpdateLoanApplicationRequest request) in C:\Users\yamta\StudioProjects\nayifat_app_2025_new\NayifatAPI\Controllers\LoanApplicationController.cs:line 204
   at NayifatAPI.Controllers.LoanApplicationController.UpdateLoanApplication(UpdateLoanApplicationRequest request) in C:\Users\yamta\StudioProjects\nayifat_app_2025_new\NayifatAPI\Controllers\LoanApplicationController.cs:line 205
ClientConnectionId:13412fa3-03ba-4cc8-a3e3-f80ca4e7b201
Error Number:207,State:1,Class:16
2025-02-01 02:53:31.004 +03:00 [INF] Executing ObjectResult, writing value of type '<>f__AnonymousType11`2[[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-02-01 02:53:31.010 +03:00 [INF] Executed action NayifatAPI.Controllers.LoanApplicationController.UpdateLoanApplication (NayifatAPI) in 384.3358ms
2025-02-01 02:53:31.018 +03:00 [INF] Executed endpoint 'NayifatAPI.Controllers.LoanApplicationController.UpdateLoanApplication (NayifatAPI)'
2025-02-01 02:53:31.020 +03:00 [INF] Request finished HTTP/1.1 POST http://localhost:5264/api/loan-application/update - 500 null application/json; charset=utf-8 631.043ms
2025-02-01 02:53:45.675 +03:00 [INF] Request starting HTTP/1.1 POST http://localhost:5264/api/loan-application/update - application/json 343
2025-02-01 02:53:45.927 +03:00 [INF] Executing endpoint 'NayifatAPI.Controllers.LoanApplicationController.UpdateLoanApplication (NayifatAPI)'
2025-02-01 02:53:45.928 +03:00 [INF] Route matched with {action = "UpdateLoanApplication", controller = "LoanApplication"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] UpdateLoanApplication(NayifatAPI.Controllers.UpdateLoanApplicationRequest) on controller NayifatAPI.Controllers.LoanApplicationController (NayifatAPI).
2025-02-01 02:53:45.938 +03:00 [INF] Executed DbCommand (4ms) [Parameters=[@__providedApiKey_0='?' (Size = 255)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [a].[Key], [a].[CreatedAt], [a].[Description], [a].[ExpiresAt], [a].[IsActive], [a].[LastUsedAt]
FROM [ApiKeys] AS [a]
WHERE [a].[Key] = @__providedApiKey_0 AND [a].[IsActive] = CAST(1 AS bit)
2025-02-01 02:53:46.020 +03:00 [ERR] Failed executing DbCommand (76ms) [Parameters=[@__p_0='?' (Size = 450)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [c].[NationalId], [c].[AddNo], [c].[BuildingNo], [c].[City], [c].[Consent], [c].[ConsentDate], [c].[DateOfBirth], [c].[Dependents], [c].[District], [c].[Email], [c].[Employer], [c].[EmployerName], [c].[EmploymentStatus], [c].[FamilyNameAr], [c].[FamilyNameEn], [c].[FirstNameAr], [c].[FirstNameEn], [c].[Iban], [c].[IdExpiryDate], [c].[Language], [c].[Los], [c].[Mpin], [c].[MpinEnabled], [c].[NafathStatus], [c].[NafathTimestamp], [c].[Password], [c].[Phone], [c].[RegistrationDate], [c].[Salary], [c].[SalaryCustomer], [c].[SalaryDakhli], [c].[SecondNameAr], [c].[SecondNameEn], [c].[Sector], [c].[Street], [c].[ThirdNameAr], [c].[ThirdNameEn], [c].[Zipcode]
FROM [Customers] AS [c]
WHERE [c].[NationalId] = @__p_0
2025-02-01 02:53:47.036 +03:00 [ERR] An exception occurred while iterating over the results of a query for context type 'NayifatAPI.Data.ApplicationDbContext'.
Microsoft.Data.SqlClient.SqlException (0x80131904): Invalid column name 'EmployerName'.
Invalid column name 'EmploymentStatus'.
Invalid column name 'Language'.
Invalid column name 'Salary'.
   at Microsoft.Data.SqlClient.SqlCommand.<>c.<ExecuteDbDataReaderAsync>b__209_0(Task`1 result)
   at System.Threading.Tasks.ContinuationResultTaskFromResultTask`2.InnerInvoke()
   at System.Threading.ExecutionContext.RunInternal(ExecutionContext executionContext, ContextCallback callback, Object state)
--- End of stack trace from previous location ---
   at System.Threading.ExecutionContext.RunInternal(ExecutionContext executionContext, ContextCallback callback, Object state)
   at System.Threading.Tasks.Task.ExecuteWithThreadLocal(Task& currentTaskSlot, Thread threadPoolThread)
--- End of stack trace from previous location ---
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Query.Internal.SingleQueryingEnumerable`1.AsyncEnumerator.InitializeReaderAsync(AsyncEnumerator enumerator, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Storage.Internal.SqlServerExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Query.Internal.SingleQueryingEnumerable`1.AsyncEnumerator.MoveNextAsync()
ClientConnectionId:13412fa3-03ba-4cc8-a3e3-f80ca4e7b201
Error Number:207,State:1,Class:16
Microsoft.Data.SqlClient.SqlException (0x80131904): Invalid column name 'EmployerName'.
Invalid column name 'EmploymentStatus'.
Invalid column name 'Language'.
Invalid column name 'Salary'.
   at Microsoft.Data.SqlClient.SqlCommand.<>c.<ExecuteDbDataReaderAsync>b__209_0(Task`1 result)
   at System.Threading.Tasks.ContinuationResultTaskFromResultTask`2.InnerInvoke()
   at System.Threading.ExecutionContext.RunInternal(ExecutionContext executionContext, ContextCallback callback, Object state)
--- End of stack trace from previous location ---
   at System.Threading.ExecutionContext.RunInternal(ExecutionContext executionContext, ContextCallback callback, Object state)
   at System.Threading.Tasks.Task.ExecuteWithThreadLocal(Task& currentTaskSlot, Thread threadPoolThread)
--- End of stack trace from previous location ---
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Query.Internal.SingleQueryingEnumerable`1.AsyncEnumerator.InitializeReaderAsync(AsyncEnumerator enumerator, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Storage.Internal.SqlServerExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Query.Internal.SingleQueryingEnumerable`1.AsyncEnumerator.MoveNextAsync()
ClientConnectionId:13412fa3-03ba-4cc8-a3e3-f80ca4e7b201
Error Number:207,State:1,Class:16
2025-02-01 02:53:47.288 +03:00 [ERR] Error updating loan application for National ID: 1234567892
Microsoft.Data.SqlClient.SqlException (0x80131904): Invalid column name 'EmployerName'.
Invalid column name 'EmploymentStatus'.
Invalid column name 'Language'.
Invalid column name 'Salary'.
   at Microsoft.Data.SqlClient.SqlCommand.<>c.<ExecuteDbDataReaderAsync>b__209_0(Task`1 result)
   at System.Threading.Tasks.ContinuationResultTaskFromResultTask`2.InnerInvoke()
   at System.Threading.ExecutionContext.RunInternal(ExecutionContext executionContext, ContextCallback callback, Object state)
--- End of stack trace from previous location ---
   at System.Threading.ExecutionContext.RunInternal(ExecutionContext executionContext, ContextCallback callback, Object state)
   at System.Threading.Tasks.Task.ExecuteWithThreadLocal(Task& currentTaskSlot, Thread threadPoolThread)
--- End of stack trace from previous location ---
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Query.Internal.SingleQueryingEnumerable`1.AsyncEnumerator.InitializeReaderAsync(AsyncEnumerator enumerator, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Storage.Internal.SqlServerExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Query.Internal.SingleQueryingEnumerable`1.AsyncEnumerator.MoveNextAsync()
   at Microsoft.EntityFrameworkCore.Query.ShapedQueryCompilingExpressionVisitor.SingleOrDefaultAsync[TSource](IAsyncEnumerable`1 asyncEnumerable, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Query.ShapedQueryCompilingExpressionVisitor.SingleOrDefaultAsync[TSource](IAsyncEnumerable`1 asyncEnumerable, CancellationToken cancellationToken)
   at NayifatAPI.Controllers.LoanApplicationController.UpdateLoanApplication(UpdateLoanApplicationRequest request) in C:\Users\yamta\StudioProjects\nayifat_app_2025_new\NayifatAPI\Controllers\LoanApplicationController.cs:line 147
   at NayifatAPI.Controllers.LoanApplicationController.UpdateLoanApplication(UpdateLoanApplicationRequest request) in C:\Users\yamta\StudioProjects\nayifat_app_2025_new\NayifatAPI\Controllers\LoanApplicationController.cs:line 204
   at NayifatAPI.Controllers.LoanApplicationController.UpdateLoanApplication(UpdateLoanApplicationRequest request) in C:\Users\yamta\StudioProjects\nayifat_app_2025_new\NayifatAPI\Controllers\LoanApplicationController.cs:line 205
ClientConnectionId:13412fa3-03ba-4cc8-a3e3-f80ca4e7b201
Error Number:207,State:1,Class:16
2025-02-01 02:53:47.305 +03:00 [INF] Executing ObjectResult, writing value of type '<>f__AnonymousType11`2[[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-02-01 02:53:47.313 +03:00 [INF] Executed action NayifatAPI.Controllers.LoanApplicationController.UpdateLoanApplication (NayifatAPI) in 1383.0285ms
2025-02-01 02:53:47.315 +03:00 [INF] Executed endpoint 'NayifatAPI.Controllers.LoanApplicationController.UpdateLoanApplication (NayifatAPI)'
2025-02-01 02:53:47.316 +03:00 [INF] Request finished HTTP/1.1 POST http://localhost:5264/api/loan-application/update - 500 null application/json; charset=utf-8 1641.3574ms
2025-02-01 02:54:37.374 +03:00 [INF] Request starting HTTP/1.1 POST http://localhost:5264/api/loan-application/update - application/json 350
2025-02-01 02:54:37.376 +03:00 [INF] Executing endpoint 'NayifatAPI.Controllers.LoanApplicationController.UpdateLoanApplication (NayifatAPI)'
2025-02-01 02:54:37.377 +03:00 [INF] Route matched with {action = "UpdateLoanApplication", controller = "LoanApplication"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] UpdateLoanApplication(NayifatAPI.Controllers.UpdateLoanApplicationRequest) on controller NayifatAPI.Controllers.LoanApplicationController (NayifatAPI).
2025-02-01 02:54:37.382 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@__providedApiKey_0='?' (Size = 255)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [a].[Key], [a].[CreatedAt], [a].[Description], [a].[ExpiresAt], [a].[IsActive], [a].[LastUsedAt]
FROM [ApiKeys] AS [a]
WHERE [a].[Key] = @__providedApiKey_0 AND [a].[IsActive] = CAST(1 AS bit)
2025-02-01 02:54:37.387 +03:00 [ERR] Failed executing DbCommand (1ms) [Parameters=[@__p_0='?' (Size = 450)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [c].[NationalId], [c].[AddNo], [c].[BuildingNo], [c].[City], [c].[Consent], [c].[ConsentDate], [c].[DateOfBirth], [c].[Dependents], [c].[District], [c].[Email], [c].[Employer], [c].[EmployerName], [c].[EmploymentStatus], [c].[FamilyNameAr], [c].[FamilyNameEn], [c].[FirstNameAr], [c].[FirstNameEn], [c].[Iban], [c].[IdExpiryDate], [c].[Language], [c].[Los], [c].[Mpin], [c].[MpinEnabled], [c].[NafathStatus], [c].[NafathTimestamp], [c].[Password], [c].[Phone], [c].[RegistrationDate], [c].[Salary], [c].[SalaryCustomer], [c].[SalaryDakhli], [c].[SecondNameAr], [c].[SecondNameEn], [c].[Sector], [c].[Street], [c].[ThirdNameAr], [c].[ThirdNameEn], [c].[Zipcode]
FROM [Customers] AS [c]
WHERE [c].[NationalId] = @__p_0
2025-02-01 02:54:37.391 +03:00 [ERR] An exception occurred while iterating over the results of a query for context type 'NayifatAPI.Data.ApplicationDbContext'.
Microsoft.Data.SqlClient.SqlException (0x80131904): Invalid column name 'EmployerName'.
Invalid column name 'EmploymentStatus'.
Invalid column name 'Language'.
Invalid column name 'Salary'.
   at Microsoft.Data.SqlClient.SqlCommand.<>c.<ExecuteDbDataReaderAsync>b__209_0(Task`1 result)
   at System.Threading.Tasks.ContinuationResultTaskFromResultTask`2.InnerInvoke()
   at System.Threading.ExecutionContext.RunInternal(ExecutionContext executionContext, ContextCallback callback, Object state)
--- End of stack trace from previous location ---
   at System.Threading.ExecutionContext.RunInternal(ExecutionContext executionContext, ContextCallback callback, Object state)
   at System.Threading.Tasks.Task.ExecuteWithThreadLocal(Task& currentTaskSlot, Thread threadPoolThread)
--- End of stack trace from previous location ---
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Query.Internal.SingleQueryingEnumerable`1.AsyncEnumerator.InitializeReaderAsync(AsyncEnumerator enumerator, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Storage.Internal.SqlServerExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Query.Internal.SingleQueryingEnumerable`1.AsyncEnumerator.MoveNextAsync()
ClientConnectionId:13412fa3-03ba-4cc8-a3e3-f80ca4e7b201
Error Number:207,State:1,Class:16
Microsoft.Data.SqlClient.SqlException (0x80131904): Invalid column name 'EmployerName'.
Invalid column name 'EmploymentStatus'.
Invalid column name 'Language'.
Invalid column name 'Salary'.
   at Microsoft.Data.SqlClient.SqlCommand.<>c.<ExecuteDbDataReaderAsync>b__209_0(Task`1 result)
   at System.Threading.Tasks.ContinuationResultTaskFromResultTask`2.InnerInvoke()
   at System.Threading.ExecutionContext.RunInternal(ExecutionContext executionContext, ContextCallback callback, Object state)
--- End of stack trace from previous location ---
   at System.Threading.ExecutionContext.RunInternal(ExecutionContext executionContext, ContextCallback callback, Object state)
   at System.Threading.Tasks.Task.ExecuteWithThreadLocal(Task& currentTaskSlot, Thread threadPoolThread)
--- End of stack trace from previous location ---
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Query.Internal.SingleQueryingEnumerable`1.AsyncEnumerator.InitializeReaderAsync(AsyncEnumerator enumerator, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Storage.Internal.SqlServerExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Query.Internal.SingleQueryingEnumerable`1.AsyncEnumerator.MoveNextAsync()
ClientConnectionId:13412fa3-03ba-4cc8-a3e3-f80ca4e7b201
Error Number:207,State:1,Class:16
2025-02-01 02:54:37.404 +03:00 [ERR] Error updating loan application for National ID: 1234567890
Microsoft.Data.SqlClient.SqlException (0x80131904): Invalid column name 'EmployerName'.
Invalid column name 'EmploymentStatus'.
Invalid column name 'Language'.
Invalid column name 'Salary'.
   at Microsoft.Data.SqlClient.SqlCommand.<>c.<ExecuteDbDataReaderAsync>b__209_0(Task`1 result)
   at System.Threading.Tasks.ContinuationResultTaskFromResultTask`2.InnerInvoke()
   at System.Threading.ExecutionContext.RunInternal(ExecutionContext executionContext, ContextCallback callback, Object state)
--- End of stack trace from previous location ---
   at System.Threading.ExecutionContext.RunInternal(ExecutionContext executionContext, ContextCallback callback, Object state)
   at System.Threading.Tasks.Task.ExecuteWithThreadLocal(Task& currentTaskSlot, Thread threadPoolThread)
--- End of stack trace from previous location ---
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Query.Internal.SingleQueryingEnumerable`1.AsyncEnumerator.InitializeReaderAsync(AsyncEnumerator enumerator, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Storage.Internal.SqlServerExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Query.Internal.SingleQueryingEnumerable`1.AsyncEnumerator.MoveNextAsync()
   at Microsoft.EntityFrameworkCore.Query.ShapedQueryCompilingExpressionVisitor.SingleOrDefaultAsync[TSource](IAsyncEnumerable`1 asyncEnumerable, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Query.ShapedQueryCompilingExpressionVisitor.SingleOrDefaultAsync[TSource](IAsyncEnumerable`1 asyncEnumerable, CancellationToken cancellationToken)
   at NayifatAPI.Controllers.LoanApplicationController.UpdateLoanApplication(UpdateLoanApplicationRequest request) in C:\Users\yamta\StudioProjects\nayifat_app_2025_new\NayifatAPI\Controllers\LoanApplicationController.cs:line 147
   at NayifatAPI.Controllers.LoanApplicationController.UpdateLoanApplication(UpdateLoanApplicationRequest request) in C:\Users\yamta\StudioProjects\nayifat_app_2025_new\NayifatAPI\Controllers\LoanApplicationController.cs:line 204
   at NayifatAPI.Controllers.LoanApplicationController.UpdateLoanApplication(UpdateLoanApplicationRequest request) in C:\Users\yamta\StudioProjects\nayifat_app_2025_new\NayifatAPI\Controllers\LoanApplicationController.cs:line 205
ClientConnectionId:13412fa3-03ba-4cc8-a3e3-f80ca4e7b201
Error Number:207,State:1,Class:16
2025-02-01 02:54:37.417 +03:00 [INF] Executing ObjectResult, writing value of type '<>f__AnonymousType11`2[[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-02-01 02:54:37.420 +03:00 [INF] Executed action NayifatAPI.Controllers.LoanApplicationController.UpdateLoanApplication (NayifatAPI) in 40.0472ms
2025-02-01 02:54:37.422 +03:00 [INF] Executed endpoint 'NayifatAPI.Controllers.LoanApplicationController.UpdateLoanApplication (NayifatAPI)'
2025-02-01 02:54:37.427 +03:00 [INF] Request finished HTTP/1.1 POST http://localhost:5264/api/loan-application/update - 500 null application/json; charset=utf-8 51.2657ms
2025-02-01 02:54:45.112 +03:00 [INF] Request starting HTTP/1.1 POST http://localhost:5264/api/loan-application/update - application/json 350
2025-02-01 02:54:45.143 +03:00 [INF] Executing endpoint 'NayifatAPI.Controllers.LoanApplicationController.UpdateLoanApplication (NayifatAPI)'
2025-02-01 02:54:45.157 +03:00 [INF] Route matched with {action = "UpdateLoanApplication", controller = "LoanApplication"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] UpdateLoanApplication(NayifatAPI.Controllers.UpdateLoanApplicationRequest) on controller NayifatAPI.Controllers.LoanApplicationController (NayifatAPI).
2025-02-01 02:54:45.172 +03:00 [INF] Executed DbCommand (5ms) [Parameters=[@__providedApiKey_0='?' (Size = 255)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [a].[Key], [a].[CreatedAt], [a].[Description], [a].[ExpiresAt], [a].[IsActive], [a].[LastUsedAt]
FROM [ApiKeys] AS [a]
WHERE [a].[Key] = @__providedApiKey_0 AND [a].[IsActive] = CAST(1 AS bit)
2025-02-01 02:54:45.184 +03:00 [ERR] Failed executing DbCommand (3ms) [Parameters=[@__p_0='?' (Size = 450)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [c].[NationalId], [c].[AddNo], [c].[BuildingNo], [c].[City], [c].[Consent], [c].[ConsentDate], [c].[DateOfBirth], [c].[Dependents], [c].[District], [c].[Email], [c].[Employer], [c].[EmployerName], [c].[EmploymentStatus], [c].[FamilyNameAr], [c].[FamilyNameEn], [c].[FirstNameAr], [c].[FirstNameEn], [c].[Iban], [c].[IdExpiryDate], [c].[Language], [c].[Los], [c].[Mpin], [c].[MpinEnabled], [c].[NafathStatus], [c].[NafathTimestamp], [c].[Password], [c].[Phone], [c].[RegistrationDate], [c].[Salary], [c].[SalaryCustomer], [c].[SalaryDakhli], [c].[SecondNameAr], [c].[SecondNameEn], [c].[Sector], [c].[Street], [c].[ThirdNameAr], [c].[ThirdNameEn], [c].[Zipcode]
FROM [Customers] AS [c]
WHERE [c].[NationalId] = @__p_0
2025-02-01 02:54:45.189 +03:00 [ERR] An exception occurred while iterating over the results of a query for context type 'NayifatAPI.Data.ApplicationDbContext'.
Microsoft.Data.SqlClient.SqlException (0x80131904): Invalid column name 'EmployerName'.
Invalid column name 'EmploymentStatus'.
Invalid column name 'Language'.
Invalid column name 'Salary'.
   at Microsoft.Data.SqlClient.SqlCommand.<>c.<ExecuteDbDataReaderAsync>b__209_0(Task`1 result)
   at System.Threading.Tasks.ContinuationResultTaskFromResultTask`2.InnerInvoke()
   at System.Threading.ExecutionContext.RunInternal(ExecutionContext executionContext, ContextCallback callback, Object state)
--- End of stack trace from previous location ---
   at System.Threading.ExecutionContext.RunInternal(ExecutionContext executionContext, ContextCallback callback, Object state)
   at System.Threading.Tasks.Task.ExecuteWithThreadLocal(Task& currentTaskSlot, Thread threadPoolThread)
--- End of stack trace from previous location ---
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Query.Internal.SingleQueryingEnumerable`1.AsyncEnumerator.InitializeReaderAsync(AsyncEnumerator enumerator, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Storage.Internal.SqlServerExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Query.Internal.SingleQueryingEnumerable`1.AsyncEnumerator.MoveNextAsync()
ClientConnectionId:13412fa3-03ba-4cc8-a3e3-f80ca4e7b201
Error Number:207,State:1,Class:16
Microsoft.Data.SqlClient.SqlException (0x80131904): Invalid column name 'EmployerName'.
Invalid column name 'EmploymentStatus'.
Invalid column name 'Language'.
Invalid column name 'Salary'.
   at Microsoft.Data.SqlClient.SqlCommand.<>c.<ExecuteDbDataReaderAsync>b__209_0(Task`1 result)
   at System.Threading.Tasks.ContinuationResultTaskFromResultTask`2.InnerInvoke()
   at System.Threading.ExecutionContext.RunInternal(ExecutionContext executionContext, ContextCallback callback, Object state)
--- End of stack trace from previous location ---
   at System.Threading.ExecutionContext.RunInternal(ExecutionContext executionContext, ContextCallback callback, Object state)
   at System.Threading.Tasks.Task.ExecuteWithThreadLocal(Task& currentTaskSlot, Thread threadPoolThread)
--- End of stack trace from previous location ---
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Query.Internal.SingleQueryingEnumerable`1.AsyncEnumerator.InitializeReaderAsync(AsyncEnumerator enumerator, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Storage.Internal.SqlServerExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Query.Internal.SingleQueryingEnumerable`1.AsyncEnumerator.MoveNextAsync()
ClientConnectionId:13412fa3-03ba-4cc8-a3e3-f80ca4e7b201
Error Number:207,State:1,Class:16
2025-02-01 02:54:45.203 +03:00 [ERR] Error updating loan application for National ID: 1234567890
Microsoft.Data.SqlClient.SqlException (0x80131904): Invalid column name 'EmployerName'.
Invalid column name 'EmploymentStatus'.
Invalid column name 'Language'.
Invalid column name 'Salary'.
   at Microsoft.Data.SqlClient.SqlCommand.<>c.<ExecuteDbDataReaderAsync>b__209_0(Task`1 result)
   at System.Threading.Tasks.ContinuationResultTaskFromResultTask`2.InnerInvoke()
   at System.Threading.ExecutionContext.RunInternal(ExecutionContext executionContext, ContextCallback callback, Object state)
--- End of stack trace from previous location ---
   at System.Threading.ExecutionContext.RunInternal(ExecutionContext executionContext, ContextCallback callback, Object state)
   at System.Threading.Tasks.Task.ExecuteWithThreadLocal(Task& currentTaskSlot, Thread threadPoolThread)
--- End of stack trace from previous location ---
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Query.Internal.SingleQueryingEnumerable`1.AsyncEnumerator.InitializeReaderAsync(AsyncEnumerator enumerator, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Storage.Internal.SqlServerExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Query.Internal.SingleQueryingEnumerable`1.AsyncEnumerator.MoveNextAsync()
   at Microsoft.EntityFrameworkCore.Query.ShapedQueryCompilingExpressionVisitor.SingleOrDefaultAsync[TSource](IAsyncEnumerable`1 asyncEnumerable, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Query.ShapedQueryCompilingExpressionVisitor.SingleOrDefaultAsync[TSource](IAsyncEnumerable`1 asyncEnumerable, CancellationToken cancellationToken)
   at NayifatAPI.Controllers.LoanApplicationController.UpdateLoanApplication(UpdateLoanApplicationRequest request) in C:\Users\yamta\StudioProjects\nayifat_app_2025_new\NayifatAPI\Controllers\LoanApplicationController.cs:line 147
   at NayifatAPI.Controllers.LoanApplicationController.UpdateLoanApplication(UpdateLoanApplicationRequest request) in C:\Users\yamta\StudioProjects\nayifat_app_2025_new\NayifatAPI\Controllers\LoanApplicationController.cs:line 204
   at NayifatAPI.Controllers.LoanApplicationController.UpdateLoanApplication(UpdateLoanApplicationRequest request) in C:\Users\yamta\StudioProjects\nayifat_app_2025_new\NayifatAPI\Controllers\LoanApplicationController.cs:line 205
ClientConnectionId:13412fa3-03ba-4cc8-a3e3-f80ca4e7b201
Error Number:207,State:1,Class:16
2025-02-01 02:54:45.215 +03:00 [INF] Executing ObjectResult, writing value of type '<>f__AnonymousType11`2[[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-02-01 02:54:45.217 +03:00 [INF] Executed action NayifatAPI.Controllers.LoanApplicationController.UpdateLoanApplication (NayifatAPI) in 52.0319ms
2025-02-01 02:54:45.220 +03:00 [INF] Executed endpoint 'NayifatAPI.Controllers.LoanApplicationController.UpdateLoanApplication (NayifatAPI)'
2025-02-01 02:54:45.222 +03:00 [INF] Request finished HTTP/1.1 POST http://localhost:5264/api/loan-application/update - 500 null application/json; charset=utf-8 109.9771ms
2025-02-01 02:56:43.941 +03:00 [INF] Request starting HTTP/1.1 POST http://localhost:5264/api/loan-application/initial - application/json 139
2025-02-01 02:56:43.943 +03:00 [INF] Executing endpoint 'NayifatAPI.Controllers.LoanApplicationController.CreateInitialApplication (NayifatAPI)'
2025-02-01 02:56:43.950 +03:00 [INF] Route matched with {action = "CreateInitialApplication", controller = "LoanApplication"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] CreateInitialApplication(NayifatAPI.Controllers.InitialLoanApplicationRequest) on controller NayifatAPI.Controllers.LoanApplicationController (NayifatAPI).
2025-02-01 02:56:43.967 +03:00 [INF] Executed DbCommand (7ms) [Parameters=[@__providedApiKey_0='?' (Size = 255)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [a].[Key], [a].[CreatedAt], [a].[Description], [a].[ExpiresAt], [a].[IsActive], [a].[LastUsedAt]
FROM [ApiKeys] AS [a]
WHERE [a].[Key] = @__providedApiKey_0 AND [a].[IsActive] = CAST(1 AS bit)
2025-02-01 02:56:43.981 +03:00 [INF] Executed DbCommand (4ms) [Parameters=[@__request_NationalId_0='?' (Size = 450)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [l].[loan_id], [l].[loan_amount], [l].[application_no], [l].[customerDecision], [l].[interest_rate], [l].[national_id], [l].[note], [l].[noteUser], [l].[loan_purpose], [l].[remarks], [l].[status], [l].[status_date], [l].[loan_tenure]
FROM [loan_application_details] AS [l]
WHERE [l].[national_id] = @__request_NationalId_0 AND [l].[status] = N'pending'
2025-02-01 02:56:44.016 +03:00 [INF] Executing ObjectResult, writing value of type '<>f__AnonymousType11`2[[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-02-01 02:56:44.018 +03:00 [INF] Executed action NayifatAPI.Controllers.LoanApplicationController.CreateInitialApplication (NayifatAPI) in 65.7202ms
2025-02-01 02:56:44.019 +03:00 [INF] Executed endpoint 'NayifatAPI.Controllers.LoanApplicationController.CreateInitialApplication (NayifatAPI)'
2025-02-01 02:56:44.019 +03:00 [INF] Request finished HTTP/1.1 POST http://localhost:5264/api/loan-application/initial - 400 null application/json; charset=utf-8 78.6569ms
2025-02-01 02:56:49.304 +03:00 [INF] Request starting HTTP/1.1 POST http://localhost:5264/api/loan-application/initial - application/json 139
2025-02-01 02:56:49.306 +03:00 [INF] Executing endpoint 'NayifatAPI.Controllers.LoanApplicationController.CreateInitialApplication (NayifatAPI)'
2025-02-01 02:56:49.308 +03:00 [INF] Route matched with {action = "CreateInitialApplication", controller = "LoanApplication"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] CreateInitialApplication(NayifatAPI.Controllers.InitialLoanApplicationRequest) on controller NayifatAPI.Controllers.LoanApplicationController (NayifatAPI).
2025-02-01 02:56:49.315 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@__providedApiKey_0='?' (Size = 255)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [a].[Key], [a].[CreatedAt], [a].[Description], [a].[ExpiresAt], [a].[IsActive], [a].[LastUsedAt]
FROM [ApiKeys] AS [a]
WHERE [a].[Key] = @__providedApiKey_0 AND [a].[IsActive] = CAST(1 AS bit)
2025-02-01 02:56:49.319 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@__request_NationalId_0='?' (Size = 450)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [l].[loan_id], [l].[loan_amount], [l].[application_no], [l].[customerDecision], [l].[interest_rate], [l].[national_id], [l].[note], [l].[noteUser], [l].[loan_purpose], [l].[remarks], [l].[status], [l].[status_date], [l].[loan_tenure]
FROM [loan_application_details] AS [l]
WHERE [l].[national_id] = @__request_NationalId_0 AND [l].[status] = N'pending'
2025-02-01 02:56:49.357 +03:00 [INF] Executed DbCommand (5ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [l].[application_no]
FROM [loan_application_details] AS [l]
ORDER BY [l].[application_no] DESC
2025-02-01 02:56:49.436 +03:00 [WRN] Savepoints are disabled because Multiple Active Result Sets (MARS) is enabled. If 'SaveChanges' fails, then the transaction cannot be automatically rolled back to a known clean state. Instead, the transaction should be rolled back by the application before retrying 'SaveChanges'. See https://go.microsoft.com/fwlink/?linkid=2149338 for more information and examples. To identify the code which triggers this warning, call 'ConfigureWarnings(w => w.Throw(SqlServerEventId.SavepointsDisabledBecauseOfMARS))'.
2025-02-01 02:56:49.440 +03:00 [INF] Executed DbCommand (3ms) [Parameters=[@p0='?' (Precision = 18) (Scale = 2) (DbType = Decimal), @p1='?' (DbType = Int32), @p2='?' (Size = 4000), @p3='?' (Precision = 5) (Scale = 2) (DbType = Decimal), @p4='?' (Size = 450), @p5='?' (Size = 4000), @p6='?' (Size = 4000), @p7='?' (Size = 4000), @p8='?' (Size = 4000), @p9='?' (Size = 50), @p10='?' (DbType = DateTime2), @p11='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SET IMPLICIT_TRANSACTIONS OFF;
SET NOCOUNT ON;
INSERT INTO [loan_application_details] ([loan_amount], [application_no], [customerDecision], [interest_rate], [national_id], [note], [noteUser], [loan_purpose], [remarks], [status], [status_date], [loan_tenure])
OUTPUT INSERTED.[loan_id]
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7, @p8, @p9, @p10, @p11);
2025-02-01 02:56:49.535 +03:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType9`2[[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Object, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-02-01 02:56:49.541 +03:00 [INF] Executed action NayifatAPI.Controllers.LoanApplicationController.CreateInitialApplication (NayifatAPI) in 231.6132ms
2025-02-01 02:56:49.543 +03:00 [INF] Executed endpoint 'NayifatAPI.Controllers.LoanApplicationController.CreateInitialApplication (NayifatAPI)'
2025-02-01 02:56:49.544 +03:00 [INF] Request finished HTTP/1.1 POST http://localhost:5264/api/loan-application/initial - 200 null application/json; charset=utf-8 240.0854ms
2025-02-01 02:57:11.669 +03:00 [INF] Request starting HTTP/1.1 POST http://localhost:5264/api/loan-application/update - application/json 350
2025-02-01 02:57:11.673 +03:00 [INF] Executing endpoint 'NayifatAPI.Controllers.LoanApplicationController.UpdateLoanApplication (NayifatAPI)'
2025-02-01 02:57:11.674 +03:00 [INF] Route matched with {action = "UpdateLoanApplication", controller = "LoanApplication"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] UpdateLoanApplication(NayifatAPI.Controllers.UpdateLoanApplicationRequest) on controller NayifatAPI.Controllers.LoanApplicationController (NayifatAPI).
2025-02-01 02:57:11.682 +03:00 [INF] Executed DbCommand (4ms) [Parameters=[@__providedApiKey_0='?' (Size = 255)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [a].[Key], [a].[CreatedAt], [a].[Description], [a].[ExpiresAt], [a].[IsActive], [a].[LastUsedAt]
FROM [ApiKeys] AS [a]
WHERE [a].[Key] = @__providedApiKey_0 AND [a].[IsActive] = CAST(1 AS bit)
2025-02-01 02:57:11.692 +03:00 [ERR] Failed executing DbCommand (4ms) [Parameters=[@__p_0='?' (Size = 450)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [c].[NationalId], [c].[AddNo], [c].[BuildingNo], [c].[City], [c].[Consent], [c].[ConsentDate], [c].[DateOfBirth], [c].[Dependents], [c].[District], [c].[Email], [c].[Employer], [c].[EmployerName], [c].[EmploymentStatus], [c].[FamilyNameAr], [c].[FamilyNameEn], [c].[FirstNameAr], [c].[FirstNameEn], [c].[Iban], [c].[IdExpiryDate], [c].[Language], [c].[Los], [c].[Mpin], [c].[MpinEnabled], [c].[NafathStatus], [c].[NafathTimestamp], [c].[Password], [c].[Phone], [c].[RegistrationDate], [c].[Salary], [c].[SalaryCustomer], [c].[SalaryDakhli], [c].[SecondNameAr], [c].[SecondNameEn], [c].[Sector], [c].[Street], [c].[ThirdNameAr], [c].[ThirdNameEn], [c].[Zipcode]
FROM [Customers] AS [c]
WHERE [c].[NationalId] = @__p_0
2025-02-01 02:57:11.698 +03:00 [ERR] An exception occurred while iterating over the results of a query for context type 'NayifatAPI.Data.ApplicationDbContext'.
Microsoft.Data.SqlClient.SqlException (0x80131904): Invalid column name 'EmployerName'.
Invalid column name 'EmploymentStatus'.
Invalid column name 'Language'.
Invalid column name 'Salary'.
   at Microsoft.Data.SqlClient.SqlCommand.<>c.<ExecuteDbDataReaderAsync>b__209_0(Task`1 result)
   at System.Threading.Tasks.ContinuationResultTaskFromResultTask`2.InnerInvoke()
   at System.Threading.ExecutionContext.RunInternal(ExecutionContext executionContext, ContextCallback callback, Object state)
--- End of stack trace from previous location ---
   at System.Threading.ExecutionContext.RunInternal(ExecutionContext executionContext, ContextCallback callback, Object state)
   at System.Threading.Tasks.Task.ExecuteWithThreadLocal(Task& currentTaskSlot, Thread threadPoolThread)
--- End of stack trace from previous location ---
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Query.Internal.SingleQueryingEnumerable`1.AsyncEnumerator.InitializeReaderAsync(AsyncEnumerator enumerator, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Storage.Internal.SqlServerExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Query.Internal.SingleQueryingEnumerable`1.AsyncEnumerator.MoveNextAsync()
ClientConnectionId:13412fa3-03ba-4cc8-a3e3-f80ca4e7b201
Error Number:207,State:1,Class:16
Microsoft.Data.SqlClient.SqlException (0x80131904): Invalid column name 'EmployerName'.
Invalid column name 'EmploymentStatus'.
Invalid column name 'Language'.
Invalid column name 'Salary'.
   at Microsoft.Data.SqlClient.SqlCommand.<>c.<ExecuteDbDataReaderAsync>b__209_0(Task`1 result)
   at System.Threading.Tasks.ContinuationResultTaskFromResultTask`2.InnerInvoke()
   at System.Threading.ExecutionContext.RunInternal(ExecutionContext executionContext, ContextCallback callback, Object state)
--- End of stack trace from previous location ---
   at System.Threading.ExecutionContext.RunInternal(ExecutionContext executionContext, ContextCallback callback, Object state)
   at System.Threading.Tasks.Task.ExecuteWithThreadLocal(Task& currentTaskSlot, Thread threadPoolThread)
--- End of stack trace from previous location ---
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Query.Internal.SingleQueryingEnumerable`1.AsyncEnumerator.InitializeReaderAsync(AsyncEnumerator enumerator, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Storage.Internal.SqlServerExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Query.Internal.SingleQueryingEnumerable`1.AsyncEnumerator.MoveNextAsync()
ClientConnectionId:13412fa3-03ba-4cc8-a3e3-f80ca4e7b201
Error Number:207,State:1,Class:16
2025-02-01 02:57:11.713 +03:00 [ERR] Error updating loan application for National ID: 1234567893
Microsoft.Data.SqlClient.SqlException (0x80131904): Invalid column name 'EmployerName'.
Invalid column name 'EmploymentStatus'.
Invalid column name 'Language'.
Invalid column name 'Salary'.
   at Microsoft.Data.SqlClient.SqlCommand.<>c.<ExecuteDbDataReaderAsync>b__209_0(Task`1 result)
   at System.Threading.Tasks.ContinuationResultTaskFromResultTask`2.InnerInvoke()
   at System.Threading.ExecutionContext.RunInternal(ExecutionContext executionContext, ContextCallback callback, Object state)
--- End of stack trace from previous location ---
   at System.Threading.ExecutionContext.RunInternal(ExecutionContext executionContext, ContextCallback callback, Object state)
   at System.Threading.Tasks.Task.ExecuteWithThreadLocal(Task& currentTaskSlot, Thread threadPoolThread)
--- End of stack trace from previous location ---
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Query.Internal.SingleQueryingEnumerable`1.AsyncEnumerator.InitializeReaderAsync(AsyncEnumerator enumerator, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Storage.Internal.SqlServerExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Query.Internal.SingleQueryingEnumerable`1.AsyncEnumerator.MoveNextAsync()
   at Microsoft.EntityFrameworkCore.Query.ShapedQueryCompilingExpressionVisitor.SingleOrDefaultAsync[TSource](IAsyncEnumerable`1 asyncEnumerable, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Query.ShapedQueryCompilingExpressionVisitor.SingleOrDefaultAsync[TSource](IAsyncEnumerable`1 asyncEnumerable, CancellationToken cancellationToken)
   at NayifatAPI.Controllers.LoanApplicationController.UpdateLoanApplication(UpdateLoanApplicationRequest request) in C:\Users\yamta\StudioProjects\nayifat_app_2025_new\NayifatAPI\Controllers\LoanApplicationController.cs:line 147
   at NayifatAPI.Controllers.LoanApplicationController.UpdateLoanApplication(UpdateLoanApplicationRequest request) in C:\Users\yamta\StudioProjects\nayifat_app_2025_new\NayifatAPI\Controllers\LoanApplicationController.cs:line 204
   at NayifatAPI.Controllers.LoanApplicationController.UpdateLoanApplication(UpdateLoanApplicationRequest request) in C:\Users\yamta\StudioProjects\nayifat_app_2025_new\NayifatAPI\Controllers\LoanApplicationController.cs:line 205
ClientConnectionId:13412fa3-03ba-4cc8-a3e3-f80ca4e7b201
Error Number:207,State:1,Class:16
2025-02-01 02:57:11.724 +03:00 [INF] Executing ObjectResult, writing value of type '<>f__AnonymousType11`2[[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-02-01 02:57:11.730 +03:00 [INF] Executed action NayifatAPI.Controllers.LoanApplicationController.UpdateLoanApplication (NayifatAPI) in 53.6295ms
2025-02-01 02:57:11.732 +03:00 [INF] Executed endpoint 'NayifatAPI.Controllers.LoanApplicationController.UpdateLoanApplication (NayifatAPI)'
2025-02-01 02:57:11.734 +03:00 [INF] Request finished HTTP/1.1 POST http://localhost:5264/api/loan-application/update - 500 null application/json; charset=utf-8 64.8052ms
2025-02-01 02:57:25.709 +03:00 [INF] Application is shutting down...
2025-02-01 02:57:37.250 +03:00 [INF] Starting web application
2025-02-01 02:57:37.404 +03:00 [INF] Now listening on: http://localhost:5264
2025-02-01 02:57:37.411 +03:00 [INF] Application started. Press Ctrl+C to shut down.
2025-02-01 02:57:37.412 +03:00 [INF] Hosting environment: Development
2025-02-01 02:57:37.413 +03:00 [INF] Content root path: C:\Users\yamta\StudioProjects\nayifat_app_2025_new\NayifatAPI
2025-02-01 02:57:44.830 +03:00 [INF] Request starting HTTP/1.1 POST http://localhost:5264/api/loan-application/update - application/json 350
2025-02-01 02:57:44.877 +03:00 [WRN] Failed to determine the https port for redirect.
2025-02-01 02:57:44.881 +03:00 [INF] Executing endpoint 'NayifatAPI.Controllers.LoanApplicationController.UpdateLoanApplication (NayifatAPI)'
2025-02-01 02:57:44.910 +03:00 [INF] Route matched with {action = "UpdateLoanApplication", controller = "LoanApplication"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] UpdateLoanApplication(NayifatAPI.Controllers.UpdateLoanApplicationRequest) on controller NayifatAPI.Controllers.LoanApplicationController (NayifatAPI).
2025-02-01 02:57:47.175 +03:00 [INF] Executed DbCommand (54ms) [Parameters=[@__providedApiKey_0='?' (Size = 255)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [a].[Key], [a].[CreatedAt], [a].[Description], [a].[ExpiresAt], [a].[IsActive], [a].[LastUsedAt]
FROM [ApiKeys] AS [a]
WHERE [a].[Key] = @__providedApiKey_0 AND [a].[IsActive] = CAST(1 AS bit)
2025-02-01 02:57:47.479 +03:00 [INF] Executed DbCommand (97ms) [Parameters=[@__request_NationalId_0='?' (Size = 450), @__request_ApplicationNo_1='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [l].[loan_id], [l].[loan_amount], [l].[application_no], [l].[customerDecision], [l].[interest_rate], [l].[national_id], [l].[note], [l].[noteUser], [l].[loan_purpose], [l].[remarks], [l].[status], [l].[status_date], [l].[loan_tenure]
FROM [loan_application_details] AS [l]
WHERE [l].[national_id] = @__request_NationalId_0 AND [l].[application_no] = @__request_ApplicationNo_1
2025-02-01 02:57:47.510 +03:00 [INF] Executing ObjectResult, writing value of type '<>f__AnonymousType11`2[[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-02-01 02:57:47.532 +03:00 [INF] Executed action NayifatAPI.Controllers.LoanApplicationController.UpdateLoanApplication (NayifatAPI) in 2616.8683ms
2025-02-01 02:57:47.540 +03:00 [INF] Executed endpoint 'NayifatAPI.Controllers.LoanApplicationController.UpdateLoanApplication (NayifatAPI)'
2025-02-01 02:57:47.553 +03:00 [INF] Request finished HTTP/1.1 POST http://localhost:5264/api/loan-application/update - 404 null application/json; charset=utf-8 2720.9974ms
2025-02-01 02:57:54.088 +03:00 [INF] Request starting HTTP/1.1 POST http://localhost:5264/api/loan-application/update - application/json 350
2025-02-01 02:57:54.099 +03:00 [INF] Executing endpoint 'NayifatAPI.Controllers.LoanApplicationController.UpdateLoanApplication (NayifatAPI)'
2025-02-01 02:57:54.100 +03:00 [INF] Route matched with {action = "UpdateLoanApplication", controller = "LoanApplication"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] UpdateLoanApplication(NayifatAPI.Controllers.UpdateLoanApplicationRequest) on controller NayifatAPI.Controllers.LoanApplicationController (NayifatAPI).
2025-02-01 02:57:54.144 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@__providedApiKey_0='?' (Size = 255)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [a].[Key], [a].[CreatedAt], [a].[Description], [a].[ExpiresAt], [a].[IsActive], [a].[LastUsedAt]
FROM [ApiKeys] AS [a]
WHERE [a].[Key] = @__providedApiKey_0 AND [a].[IsActive] = CAST(1 AS bit)
2025-02-01 02:57:54.160 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@__request_NationalId_0='?' (Size = 450), @__request_ApplicationNo_1='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [l].[loan_id], [l].[loan_amount], [l].[application_no], [l].[customerDecision], [l].[interest_rate], [l].[national_id], [l].[note], [l].[noteUser], [l].[loan_purpose], [l].[remarks], [l].[status], [l].[status_date], [l].[loan_tenure]
FROM [loan_application_details] AS [l]
WHERE [l].[national_id] = @__request_NationalId_0 AND [l].[application_no] = @__request_ApplicationNo_1
2025-02-01 02:57:54.403 +03:00 [WRN] Savepoints are disabled because Multiple Active Result Sets (MARS) is enabled. If 'SaveChanges' fails, then the transaction cannot be automatically rolled back to a known clean state. Instead, the transaction should be rolled back by the application before retrying 'SaveChanges'. See https://go.microsoft.com/fwlink/?linkid=2149338 for more information and examples. To identify the code which triggers this warning, call 'ConfigureWarnings(w => w.Throw(SqlServerEventId.SavepointsDisabledBecauseOfMARS))'.
2025-02-01 02:57:54.425 +03:00 [INF] Executed DbCommand (16ms) [Parameters=[@p10='?' (DbType = Int32), @p0='?' (Precision = 18) (Scale = 2) (DbType = Decimal), @p1='?' (Size = 4000), @p2='?' (Precision = 5) (Scale = 2) (DbType = Decimal), @p3='?' (Size = 4000), @p4='?' (Size = 4000), @p5='?' (Size = 4000), @p6='?' (Size = 4000), @p7='?' (Size = 50), @p8='?' (DbType = DateTime2), @p9='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SET IMPLICIT_TRANSACTIONS OFF;
SET NOCOUNT ON;
UPDATE [loan_application_details] SET [loan_amount] = @p0, [customerDecision] = @p1, [interest_rate] = @p2, [note] = @p3, [noteUser] = @p4, [loan_purpose] = @p5, [remarks] = @p6, [status] = @p7, [status_date] = @p8, [loan_tenure] = @p9
OUTPUT 1
WHERE [loan_id] = @p10;
2025-02-01 02:57:54.477 +03:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType9`2[[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Object, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-02-01 02:57:54.511 +03:00 [INF] Executed action NayifatAPI.Controllers.LoanApplicationController.UpdateLoanApplication (NayifatAPI) in 408.8626ms
2025-02-01 02:57:54.513 +03:00 [INF] Executed endpoint 'NayifatAPI.Controllers.LoanApplicationController.UpdateLoanApplication (NayifatAPI)'
2025-02-01 02:57:54.519 +03:00 [INF] Request finished HTTP/1.1 POST http://localhost:5264/api/loan-application/update - 200 null application/json; charset=utf-8 431.4515ms
2025-02-01 02:58:01.626 +03:00 [INF] Request starting HTTP/1.1 POST http://localhost:5264/api/loan-application/update - application/json 350
2025-02-01 02:58:01.632 +03:00 [INF] Executing endpoint 'NayifatAPI.Controllers.LoanApplicationController.UpdateLoanApplication (NayifatAPI)'
2025-02-01 02:58:01.634 +03:00 [INF] Route matched with {action = "UpdateLoanApplication", controller = "LoanApplication"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] UpdateLoanApplication(NayifatAPI.Controllers.UpdateLoanApplicationRequest) on controller NayifatAPI.Controllers.LoanApplicationController (NayifatAPI).
2025-02-01 02:58:01.744 +03:00 [INF] Executed DbCommand (4ms) [Parameters=[@__providedApiKey_0='?' (Size = 255)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [a].[Key], [a].[CreatedAt], [a].[Description], [a].[ExpiresAt], [a].[IsActive], [a].[LastUsedAt]
FROM [ApiKeys] AS [a]
WHERE [a].[Key] = @__providedApiKey_0 AND [a].[IsActive] = CAST(1 AS bit)
2025-02-01 02:58:01.761 +03:00 [INF] Executed DbCommand (3ms) [Parameters=[@__request_NationalId_0='?' (Size = 450), @__request_ApplicationNo_1='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [l].[loan_id], [l].[loan_amount], [l].[application_no], [l].[customerDecision], [l].[interest_rate], [l].[national_id], [l].[note], [l].[noteUser], [l].[loan_purpose], [l].[remarks], [l].[status], [l].[status_date], [l].[loan_tenure]
FROM [loan_application_details] AS [l]
WHERE [l].[national_id] = @__request_NationalId_0 AND [l].[application_no] = @__request_ApplicationNo_1
2025-02-01 02:58:01.772 +03:00 [WRN] Savepoints are disabled because Multiple Active Result Sets (MARS) is enabled. If 'SaveChanges' fails, then the transaction cannot be automatically rolled back to a known clean state. Instead, the transaction should be rolled back by the application before retrying 'SaveChanges'. See https://go.microsoft.com/fwlink/?linkid=2149338 for more information and examples. To identify the code which triggers this warning, call 'ConfigureWarnings(w => w.Throw(SqlServerEventId.SavepointsDisabledBecauseOfMARS))'.
2025-02-01 02:58:01.778 +03:00 [INF] Executed DbCommand (4ms) [Parameters=[@p1='?' (DbType = Int32), @p0='?' (DbType = DateTime2)], CommandType='"Text"', CommandTimeout='30']
SET IMPLICIT_TRANSACTIONS OFF;
SET NOCOUNT ON;
UPDATE [loan_application_details] SET [status_date] = @p0
OUTPUT 1
WHERE [loan_id] = @p1;
2025-02-01 02:58:01.788 +03:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType9`2[[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Object, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-02-01 02:58:01.791 +03:00 [INF] Executed action NayifatAPI.Controllers.LoanApplicationController.UpdateLoanApplication (NayifatAPI) in 154.6947ms
2025-02-01 02:58:01.792 +03:00 [INF] Executed endpoint 'NayifatAPI.Controllers.LoanApplicationController.UpdateLoanApplication (NayifatAPI)'
2025-02-01 02:58:01.794 +03:00 [INF] Request finished HTTP/1.1 POST http://localhost:5264/api/loan-application/update - 200 null application/json; charset=utf-8 167.979ms
2025-02-01 09:59:49.772 +03:00 [INF] Request starting HTTP/1.1 GET http://187e-51-252-155-185.ngrok-free.app/ - null null
2025-02-01 09:59:49.785 +03:00 [INF] Request finished HTTP/1.1 GET http://187e-51-252-155-185.ngrok-free.app/ - 301 0 null 13.2901ms
2025-02-01 09:59:50.362 +03:00 [INF] Request starting HTTP/1.1 GET http://187e-51-252-155-185.ngrok-free.app/index.html - null null
2025-02-01 09:59:50.479 +03:00 [INF] Request finished HTTP/1.1 GET http://187e-51-252-155-185.ngrok-free.app/index.html - 200 null text/html;charset=utf-8 117.171ms
2025-02-01 10:00:27.386 +03:00 [INF] Request starting HTTP/1.1 POST http://187e-51-252-155-185.ngrok-free.app/api/notifications/list - application/json; charset=utf-8 48
2025-02-01 10:00:27.390 +03:00 [INF] Executing endpoint 'NayifatAPI.Controllers.NotificationsController.GetNotifications (NayifatAPI)'
2025-02-01 10:00:27.396 +03:00 [INF] Route matched with {action = "GetNotifications", controller = "Notifications"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetNotifications(NayifatAPI.Controllers.GetNotificationsRequest) on controller NayifatAPI.Controllers.NotificationsController (NayifatAPI).
2025-02-01 10:00:27.409 +03:00 [INF] Executing BadRequestObjectResult, writing value of type 'Microsoft.AspNetCore.Mvc.ValidationProblemDetails'.
2025-02-01 10:00:27.423 +03:00 [INF] Executed action NayifatAPI.Controllers.NotificationsController.GetNotifications (NayifatAPI) in 25.9466ms
2025-02-01 10:00:27.424 +03:00 [INF] Executed endpoint 'NayifatAPI.Controllers.NotificationsController.GetNotifications (NayifatAPI)'
2025-02-01 10:00:27.425 +03:00 [INF] Request finished HTTP/1.1 POST http://187e-51-252-155-185.ngrok-free.app/api/notifications/list - 400 null application/problem+json; charset=utf-8 38.8748ms
2025-02-01 10:00:51.042 +03:00 [INF] Request starting HTTP/1.1 POST http://187e-51-252-155-185.ngrok-free.app/api/user/register - application/json; charset=utf-8 46
2025-02-01 10:00:51.046 +03:00 [INF] Request finished HTTP/1.1 POST http://187e-51-252-155-185.ngrok-free.app/api/user/register - 404 0 null 3.4843ms
2025-02-01 10:00:51.051 +03:00 [INF] Request reached the end of the middleware pipeline without being handled by application code. Request path: POST http://187e-51-252-155-185.ngrok-free.app/api/user/register, Response status code: 404
2025-02-01 10:01:53.070 +03:00 [INF] Request starting HTTP/1.1 POST http://187e-51-252-155-185.ngrok-free.app/api/user/register - application/x-www-form-urlencoded; charset=utf-8 38
2025-02-01 10:01:53.073 +03:00 [INF] Request finished HTTP/1.1 POST http://187e-51-252-155-185.ngrok-free.app/api/user/register - 404 0 null 2.783ms
2025-02-01 10:01:53.076 +03:00 [INF] Request reached the end of the middleware pipeline without being handled by application code. Request path: POST http://187e-51-252-155-185.ngrok-free.app/api/user/register, Response status code: 404
2025-02-01 10:04:35.998 +03:00 [INF] Request starting HTTP/1.1 POST http://187e-51-252-155-185.ngrok-free.app/api/user/register - application/x-www-form-urlencoded; charset=utf-8 38
2025-02-01 10:04:36.000 +03:00 [INF] Request finished HTTP/1.1 POST http://187e-51-252-155-185.ngrok-free.app/api/user/register - 404 0 null 2.8609ms
2025-02-01 10:04:36.003 +03:00 [INF] Request reached the end of the middleware pipeline without being handled by application code. Request path: POST http://187e-51-252-155-185.ngrok-free.app/api/user/register, Response status code: 404
2025-02-01 10:05:29.676 +03:00 [INF] Request starting HTTP/1.1 POST http://187e-51-252-155-185.ngrok-free.app/api/notifications/list - application/json; charset=utf-8 48
2025-02-01 10:05:29.679 +03:00 [INF] Executing endpoint 'NayifatAPI.Controllers.NotificationsController.GetNotifications (NayifatAPI)'
2025-02-01 10:05:29.680 +03:00 [INF] Route matched with {action = "GetNotifications", controller = "Notifications"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetNotifications(NayifatAPI.Controllers.GetNotificationsRequest) on controller NayifatAPI.Controllers.NotificationsController (NayifatAPI).
2025-02-01 10:05:29.685 +03:00 [INF] Executing BadRequestObjectResult, writing value of type 'Microsoft.AspNetCore.Mvc.ValidationProblemDetails'.
2025-02-01 10:05:29.687 +03:00 [INF] Executed action NayifatAPI.Controllers.NotificationsController.GetNotifications (NayifatAPI) in 4.0591ms
2025-02-01 10:05:29.689 +03:00 [INF] Executed endpoint 'NayifatAPI.Controllers.NotificationsController.GetNotifications (NayifatAPI)'
2025-02-01 10:05:29.690 +03:00 [INF] Request finished HTTP/1.1 POST http://187e-51-252-155-185.ngrok-free.app/api/notifications/list - 400 null application/problem+json; charset=utf-8 13.7538ms
2025-02-01 10:06:10.683 +03:00 [INF] Request starting HTTP/1.1 POST http://187e-51-252-155-185.ngrok-free.app/api/notifications/list - application/json; charset=utf-8 48
2025-02-01 10:06:10.688 +03:00 [INF] Executing endpoint 'NayifatAPI.Controllers.NotificationsController.GetNotifications (NayifatAPI)'
2025-02-01 10:06:10.689 +03:00 [INF] Route matched with {action = "GetNotifications", controller = "Notifications"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetNotifications(NayifatAPI.Controllers.GetNotificationsRequest) on controller NayifatAPI.Controllers.NotificationsController (NayifatAPI).
2025-02-01 10:06:10.693 +03:00 [INF] Executing BadRequestObjectResult, writing value of type 'Microsoft.AspNetCore.Mvc.ValidationProblemDetails'.
2025-02-01 10:06:10.694 +03:00 [INF] Executed action NayifatAPI.Controllers.NotificationsController.GetNotifications (NayifatAPI) in 3.1642ms
2025-02-01 10:06:10.696 +03:00 [INF] Executed endpoint 'NayifatAPI.Controllers.NotificationsController.GetNotifications (NayifatAPI)'
2025-02-01 10:06:10.697 +03:00 [INF] Request finished HTTP/1.1 POST http://187e-51-252-155-185.ngrok-free.app/api/notifications/list - 400 null application/problem+json; charset=utf-8 13.6075ms
2025-02-01 10:06:29.373 +03:00 [INF] Request starting HTTP/1.1 POST http://187e-51-252-155-185.ngrok-free.app/api/auth/register - application/json; charset=utf-8 46
2025-02-01 10:06:29.376 +03:00 [INF] Request finished HTTP/1.1 POST http://187e-51-252-155-185.ngrok-free.app/api/auth/register - 404 0 null 3.2311ms
2025-02-01 10:06:29.380 +03:00 [INF] Request reached the end of the middleware pipeline without being handled by application code. Request path: POST http://187e-51-252-155-185.ngrok-free.app/api/auth/register, Response status code: 404
2025-02-01 10:06:37.062 +03:00 [INF] Request starting HTTP/1.1 POST http://187e-51-252-155-185.ngrok-free.app/api/auth/register - application/json; charset=utf-8 46
2025-02-01 10:06:37.064 +03:00 [INF] Request finished HTTP/1.1 POST http://187e-51-252-155-185.ngrok-free.app/api/auth/register - 404 0 null 2.7941ms
2025-02-01 10:06:37.067 +03:00 [INF] Request reached the end of the middleware pipeline without being handled by application code. Request path: POST http://187e-51-252-155-185.ngrok-free.app/api/auth/register, Response status code: 404
2025-02-01 10:08:59.298 +03:00 [INF] Request starting HTTP/1.1 POST http://187e-51-252-155-185.ngrok-free.app/api/notifications/list - application/json; charset=utf-8 48
2025-02-01 10:08:59.300 +03:00 [INF] Executing endpoint 'NayifatAPI.Controllers.NotificationsController.GetNotifications (NayifatAPI)'
2025-02-01 10:08:59.301 +03:00 [INF] Route matched with {action = "GetNotifications", controller = "Notifications"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetNotifications(NayifatAPI.Controllers.GetNotificationsRequest) on controller NayifatAPI.Controllers.NotificationsController (NayifatAPI).
2025-02-01 10:08:59.304 +03:00 [INF] Executing BadRequestObjectResult, writing value of type 'Microsoft.AspNetCore.Mvc.ValidationProblemDetails'.
2025-02-01 10:08:59.304 +03:00 [INF] Executed action NayifatAPI.Controllers.NotificationsController.GetNotifications (NayifatAPI) in 1.8508ms
2025-02-01 10:08:59.306 +03:00 [INF] Executed endpoint 'NayifatAPI.Controllers.NotificationsController.GetNotifications (NayifatAPI)'
2025-02-01 10:08:59.307 +03:00 [INF] Request finished HTTP/1.1 POST http://187e-51-252-155-185.ngrok-free.app/api/notifications/list - 400 null application/problem+json; charset=utf-8 8.7713ms
2025-02-01 10:09:20.374 +03:00 [INF] Request starting HTTP/1.1 POST http://187e-51-252-155-185.ngrok-free.app/api/auth/check - application/json; charset=utf-8 28
2025-02-01 10:09:20.376 +03:00 [INF] Request finished HTTP/1.1 POST http://187e-51-252-155-185.ngrok-free.app/api/auth/check - 404 0 null 2.5988ms
2025-02-01 10:09:20.379 +03:00 [INF] Request reached the end of the middleware pipeline without being handled by application code. Request path: POST http://187e-51-252-155-185.ngrok-free.app/api/auth/check, Response status code: 404
2025-02-01 10:09:26.485 +03:00 [INF] Request starting HTTP/1.1 POST http://187e-51-252-155-185.ngrok-free.app/api/auth/check - application/json; charset=utf-8 28
2025-02-01 10:09:26.488 +03:00 [INF] Request finished HTTP/1.1 POST http://187e-51-252-155-185.ngrok-free.app/api/auth/check - 404 0 null 2.0513ms
2025-02-01 10:09:26.490 +03:00 [INF] Request reached the end of the middleware pipeline without being handled by application code. Request path: POST http://187e-51-252-155-185.ngrok-free.app/api/auth/check, Response status code: 404
2025-02-01 10:15:17.903 +03:00 [INF] Request starting HTTP/1.1 GET http://187e-51-252-155-185.ngrok-free.app/ - null null
2025-02-01 10:15:17.907 +03:00 [INF] Request finished HTTP/1.1 GET http://187e-51-252-155-185.ngrok-free.app/ - 301 0 null 4.5622ms
2025-02-01 10:15:18.163 +03:00 [INF] Request starting HTTP/1.1 GET http://187e-51-252-155-185.ngrok-free.app/index.html - null null
2025-02-01 10:15:18.166 +03:00 [INF] Request finished HTTP/1.1 GET http://187e-51-252-155-185.ngrok-free.app/index.html - 200 null text/html;charset=utf-8 2.7845ms
2025-02-01 10:15:18.447 +03:00 [INF] Request starting HTTP/1.1 GET http://187e-51-252-155-185.ngrok-free.app/swagger-ui.css - null null
2025-02-01 10:15:18.449 +03:00 [INF] Request starting HTTP/1.1 GET http://187e-51-252-155-185.ngrok-free.app/swagger-ui-bundle.js - null null
2025-02-01 10:15:18.450 +03:00 [INF] Request starting HTTP/1.1 GET http://187e-51-252-155-185.ngrok-free.app/swagger-ui-standalone-preset.js - null null
2025-02-01 10:15:18.478 +03:00 [INF] Sending file. Request path: '/swagger-ui-standalone-preset.js'. Physical path: 'N/A'
2025-02-01 10:15:18.478 +03:00 [INF] Sending file. Request path: '/swagger-ui.css'. Physical path: 'N/A'
2025-02-01 10:15:18.479 +03:00 [INF] Request finished HTTP/1.1 GET http://187e-51-252-155-185.ngrok-free.app/swagger-ui-standalone-preset.js - 200 230280 text/javascript 29.0382ms
2025-02-01 10:15:18.483 +03:00 [INF] Request finished HTTP/1.1 GET http://187e-51-252-155-185.ngrok-free.app/swagger-ui.css - 200 152034 text/css 35.3595ms
2025-02-01 10:15:19.245 +03:00 [INF] Sending file. Request path: '/swagger-ui-bundle.js'. Physical path: 'N/A'
2025-02-01 10:15:19.270 +03:00 [INF] Request finished HTTP/1.1 GET http://187e-51-252-155-185.ngrok-free.app/swagger-ui-bundle.js - 200 1456926 text/javascript 820.4293ms
2025-02-01 10:15:24.813 +03:00 [INF] Request starting HTTP/1.1 GET http://187e-51-252-155-185.ngrok-free.app/swagger/v1/swagger.json - null null
2025-02-01 10:15:24.832 +03:00 [INF] Request starting HTTP/1.1 GET http://187e-51-252-155-185.ngrok-free.app/favicon-32x32.png - null null
2025-02-01 10:15:24.841 +03:00 [INF] Sending file. Request path: '/favicon-32x32.png'. Physical path: 'N/A'
2025-02-01 10:15:24.844 +03:00 [INF] Request finished HTTP/1.1 GET http://187e-51-252-155-185.ngrok-free.app/favicon-32x32.png - 200 628 image/png 11.6745ms
2025-02-01 10:15:25.046 +03:00 [INF] Request finished HTTP/1.1 GET http://187e-51-252-155-185.ngrok-free.app/swagger/v1/swagger.json - 200 null application/json;charset=utf-8 233.6864ms
2025-02-01 10:18:08.438 +03:00 [INF] Request starting HTTP/1.1 POST http://187e-51-252-155-185.ngrok-free.app/api/notifications/list - application/json; charset=utf-8 48
2025-02-01 10:18:08.443 +03:00 [INF] Executing endpoint 'NayifatAPI.Controllers.NotificationsController.GetNotifications (NayifatAPI)'
2025-02-01 10:18:08.445 +03:00 [INF] Route matched with {action = "GetNotifications", controller = "Notifications"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetNotifications(NayifatAPI.Controllers.GetNotificationsRequest) on controller NayifatAPI.Controllers.NotificationsController (NayifatAPI).
2025-02-01 10:18:08.449 +03:00 [INF] Executing BadRequestObjectResult, writing value of type 'Microsoft.AspNetCore.Mvc.ValidationProblemDetails'.
2025-02-01 10:18:08.450 +03:00 [INF] Executed action NayifatAPI.Controllers.NotificationsController.GetNotifications (NayifatAPI) in 2.7121ms
2025-02-01 10:18:08.451 +03:00 [INF] Executed endpoint 'NayifatAPI.Controllers.NotificationsController.GetNotifications (NayifatAPI)'
2025-02-01 10:18:08.452 +03:00 [INF] Request finished HTTP/1.1 POST http://187e-51-252-155-185.ngrok-free.app/api/notifications/list - 400 null application/problem+json; charset=utf-8 14.2115ms
2025-02-01 10:21:36.798 +03:00 [INF] Request starting HTTP/1.1 POST http://187e-51-252-155-185.ngrok-free.app/api/notifications/list - application/json; charset=utf-8 48
2025-02-01 10:21:36.800 +03:00 [INF] Executing endpoint 'NayifatAPI.Controllers.NotificationsController.GetNotifications (NayifatAPI)'
2025-02-01 10:21:36.801 +03:00 [INF] Route matched with {action = "GetNotifications", controller = "Notifications"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetNotifications(NayifatAPI.Controllers.GetNotificationsRequest) on controller NayifatAPI.Controllers.NotificationsController (NayifatAPI).
2025-02-01 10:21:36.804 +03:00 [INF] Executing BadRequestObjectResult, writing value of type 'Microsoft.AspNetCore.Mvc.ValidationProblemDetails'.
2025-02-01 10:21:36.805 +03:00 [INF] Executed action NayifatAPI.Controllers.NotificationsController.GetNotifications (NayifatAPI) in 1.8817ms
2025-02-01 10:21:36.806 +03:00 [INF] Executed endpoint 'NayifatAPI.Controllers.NotificationsController.GetNotifications (NayifatAPI)'
2025-02-01 10:21:36.807 +03:00 [INF] Request finished HTTP/1.1 POST http://187e-51-252-155-185.ngrok-free.app/api/notifications/list - 400 null application/problem+json; charset=utf-8 8.8857ms
2025-02-01 10:21:54.769 +03:00 [INF] Request starting HTTP/1.1 POST http://187e-51-252-155-185.ngrok-free.app/api/auth/registration/check - application/json; charset=utf-8 27
2025-02-01 10:21:54.771 +03:00 [INF] Request finished HTTP/1.1 POST http://187e-51-252-155-185.ngrok-free.app/api/auth/registration/check - 404 0 null 2.7087ms
2025-02-01 10:21:54.773 +03:00 [INF] Request reached the end of the middleware pipeline without being handled by application code. Request path: POST http://187e-51-252-155-185.ngrok-free.app/api/auth/registration/check, Response status code: 404
2025-02-01 10:22:01.260 +03:00 [INF] Request starting HTTP/1.1 POST http://187e-51-252-155-185.ngrok-free.app/api/auth/registration/check - application/json; charset=utf-8 27
2025-02-01 10:22:01.262 +03:00 [INF] Request finished HTTP/1.1 POST http://187e-51-252-155-185.ngrok-free.app/api/auth/registration/check - 404 0 null 1.9303ms
2025-02-01 10:22:01.264 +03:00 [INF] Request reached the end of the middleware pipeline without being handled by application code. Request path: POST http://187e-51-252-155-185.ngrok-free.app/api/auth/registration/check, Response status code: 404
2025-02-01 10:25:31.512 +03:00 [INF] Request starting HTTP/1.1 POST http://187e-51-252-155-185.ngrok-free.app/api/auth/registration/check - application/json, 28
2025-02-01 10:25:31.516 +03:00 [INF] Request finished HTTP/1.1 POST http://187e-51-252-155-185.ngrok-free.app/api/auth/registration/check - 404 0 null 3.749ms
2025-02-01 10:25:31.519 +03:00 [INF] Request reached the end of the middleware pipeline without being handled by application code. Request path: POST http://187e-51-252-155-185.ngrok-free.app/api/auth/registration/check, Response status code: 404
2025-02-01 10:26:05.103 +03:00 [INF] Request starting HTTP/1.1 POST http://187e-51-252-155-185.ngrok-free.app/api/auth/registration/check - application/json, 40
2025-02-01 10:26:05.105 +03:00 [INF] Request finished HTTP/1.1 POST http://187e-51-252-155-185.ngrok-free.app/api/auth/registration/check - 404 0 null 2.1864ms
2025-02-01 10:26:05.107 +03:00 [INF] Request reached the end of the middleware pipeline without being handled by application code. Request path: POST http://187e-51-252-155-185.ngrok-free.app/api/auth/registration/check, Response status code: 404
2025-02-01 10:26:23.091 +03:00 [INF] Request starting HTTP/1.1 POST http://187e-51-252-155-185.ngrok-free.app/api/auth/registration/check - application/json, 40
2025-02-01 10:26:23.902 +03:00 [INF] Request finished HTTP/1.1 POST http://187e-51-252-155-185.ngrok-free.app/api/auth/registration/check - 404 0 null 810.944ms
2025-02-01 10:26:23.905 +03:00 [INF] Request reached the end of the middleware pipeline without being handled by application code. Request path: POST http://187e-51-252-155-185.ngrok-free.app/api/auth/registration/check, Response status code: 404
2025-02-01 10:26:38.149 +03:00 [INF] Request starting HTTP/1.1 POST http://187e-51-252-155-185.ngrok-free.app/api/notifications/list - application/json; charset=utf-8 48
2025-02-01 10:26:38.213 +03:00 [INF] Executing endpoint 'NayifatAPI.Controllers.NotificationsController.GetNotifications (NayifatAPI)'
2025-02-01 10:26:38.215 +03:00 [INF] Route matched with {action = "GetNotifications", controller = "Notifications"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetNotifications(NayifatAPI.Controllers.GetNotificationsRequest) on controller NayifatAPI.Controllers.NotificationsController (NayifatAPI).
2025-02-01 10:26:38.613 +03:00 [INF] Executing BadRequestObjectResult, writing value of type 'Microsoft.AspNetCore.Mvc.ValidationProblemDetails'.
2025-02-01 10:26:38.799 +03:00 [INF] Executed action NayifatAPI.Controllers.NotificationsController.GetNotifications (NayifatAPI) in 231.6981ms
2025-02-01 10:26:38.801 +03:00 [INF] Executed endpoint 'NayifatAPI.Controllers.NotificationsController.GetNotifications (NayifatAPI)'
2025-02-01 10:26:38.836 +03:00 [INF] Request finished HTTP/1.1 POST http://187e-51-252-155-185.ngrok-free.app/api/notifications/list - 400 null application/problem+json; charset=utf-8 686.9576ms
2025-02-01 10:26:58.591 +03:00 [INF] Request starting HTTP/1.1 POST http://187e-51-252-155-185.ngrok-free.app/api/auth/registration/check - application/json; charset=utf-8 27
2025-02-01 10:26:58.593 +03:00 [INF] Request finished HTTP/1.1 POST http://187e-51-252-155-185.ngrok-free.app/api/auth/registration/check - 404 0 null 2.3448ms
2025-02-01 10:26:58.595 +03:00 [INF] Request reached the end of the middleware pipeline without being handled by application code. Request path: POST http://187e-51-252-155-185.ngrok-free.app/api/auth/registration/check, Response status code: 404
2025-02-01 10:35:12.781 +03:00 [INF] Request starting HTTP/1.1 POST http://187e-51-252-155-185.ngrok-free.app/api/auth/registration/check - application/json, 36
2025-02-01 10:35:12.783 +03:00 [INF] Request finished HTTP/1.1 POST http://187e-51-252-155-185.ngrok-free.app/api/auth/registration/check - 404 0 null 2.3927ms
2025-02-01 10:35:12.787 +03:00 [INF] Request reached the end of the middleware pipeline without being handled by application code. Request path: POST http://187e-51-252-155-185.ngrok-free.app/api/auth/registration/check, Response status code: 404
2025-02-01 10:43:15.973 +03:00 [INF] Request starting HTTP/1.1 POST http://187e-51-252-155-185.ngrok-free.app/api/Registration/register - application/json, 60
2025-02-01 10:43:16.115 +03:00 [INF] Executing endpoint 'NayifatAPI.Controllers.RegistrationController.Register (NayifatAPI)'
2025-02-01 10:43:16.123 +03:00 [INF] Route matched with {action = "Register", controller = "Registration"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] Register(NayifatAPI.Controllers.UserRegistrationRequest) on controller NayifatAPI.Controllers.RegistrationController (NayifatAPI).
2025-02-01 10:43:16.141 +03:00 [INF] Executing BadRequestObjectResult, writing value of type 'Microsoft.AspNetCore.Mvc.ValidationProblemDetails'.
2025-02-01 10:43:16.143 +03:00 [INF] Executed action NayifatAPI.Controllers.RegistrationController.Register (NayifatAPI) in 17.5328ms
2025-02-01 10:43:16.144 +03:00 [INF] Executed endpoint 'NayifatAPI.Controllers.RegistrationController.Register (NayifatAPI)'
2025-02-01 10:43:16.146 +03:00 [INF] Request finished HTTP/1.1 POST http://187e-51-252-155-185.ngrok-free.app/api/Registration/register - 400 null application/problem+json; charset=utf-8 172.9422ms
2025-02-01 10:43:39.555 +03:00 [INF] Request starting HTTP/1.1 POST http://187e-51-252-155-185.ngrok-free.app/api/notifications/list - application/json; charset=utf-8 48
2025-02-01 10:43:39.557 +03:00 [INF] Executing endpoint 'NayifatAPI.Controllers.NotificationsController.GetNotifications (NayifatAPI)'
2025-02-01 10:43:39.558 +03:00 [INF] Route matched with {action = "GetNotifications", controller = "Notifications"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetNotifications(NayifatAPI.Controllers.GetNotificationsRequest) on controller NayifatAPI.Controllers.NotificationsController (NayifatAPI).
2025-02-01 10:43:39.561 +03:00 [INF] Executing BadRequestObjectResult, writing value of type 'Microsoft.AspNetCore.Mvc.ValidationProblemDetails'.
2025-02-01 10:43:39.562 +03:00 [INF] Executed action NayifatAPI.Controllers.NotificationsController.GetNotifications (NayifatAPI) in 2.3869ms
2025-02-01 10:43:39.565 +03:00 [INF] Executed endpoint 'NayifatAPI.Controllers.NotificationsController.GetNotifications (NayifatAPI)'
2025-02-01 10:43:39.566 +03:00 [INF] Request finished HTTP/1.1 POST http://187e-51-252-155-185.ngrok-free.app/api/notifications/list - 400 null application/problem+json; charset=utf-8 11.2379ms
2025-02-01 10:43:49.572 +03:00 [INF] Request starting HTTP/1.1 POST http://187e-51-252-155-185.ngrok-free.app/api/Registration/register - application/json, 245
2025-02-01 10:43:49.576 +03:00 [INF] Executing endpoint 'NayifatAPI.Controllers.RegistrationController.Register (NayifatAPI)'
2025-02-01 10:43:49.578 +03:00 [INF] Route matched with {action = "Register", controller = "Registration"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] Register(NayifatAPI.Controllers.UserRegistrationRequest) on controller NayifatAPI.Controllers.RegistrationController (NayifatAPI).
2025-02-01 10:43:49.584 +03:00 [INF] Executing BadRequestObjectResult, writing value of type 'Microsoft.AspNetCore.Mvc.ValidationProblemDetails'.
2025-02-01 10:43:49.586 +03:00 [INF] Executed action NayifatAPI.Controllers.RegistrationController.Register (NayifatAPI) in 5.9696ms
2025-02-01 10:43:49.588 +03:00 [INF] Executed endpoint 'NayifatAPI.Controllers.RegistrationController.Register (NayifatAPI)'
2025-02-01 10:43:49.590 +03:00 [INF] Request finished HTTP/1.1 POST http://187e-51-252-155-185.ngrok-free.app/api/Registration/register - 400 null application/problem+json; charset=utf-8 17.9284ms
2025-02-01 10:47:48.028 +03:00 [INF] Application is shutting down...
2025-02-01 10:51:39.889 +03:00 [INF] Starting web application
2025-02-01 10:51:39.985 +03:00 [INF] Now listening on: http://localhost:5264
2025-02-01 10:51:39.989 +03:00 [INF] Application started. Press Ctrl+C to shut down.
2025-02-01 10:51:39.990 +03:00 [INF] Hosting environment: Development
2025-02-01 10:51:39.991 +03:00 [INF] Content root path: C:\Users\yamta\StudioProjects\nayifat_app_2025_new\NayifatAPI
2025-02-01 10:51:59.926 +03:00 [INF] Request starting HTTP/1.1 POST http://187e-51-252-155-185.ngrok-free.app/api/Registration/register - application/json, 245
2025-02-01 10:51:59.981 +03:00 [WRN] Failed to determine the https port for redirect.
2025-02-01 10:51:59.986 +03:00 [INF] Executing endpoint 'NayifatAPI.Controllers.RegistrationController.Register (NayifatAPI)'
2025-02-01 10:52:00.022 +03:00 [INF] Route matched with {action = "Register", controller = "Registration"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] Register(System.Object) on controller NayifatAPI.Controllers.RegistrationController (NayifatAPI).
2025-02-01 10:52:02.416 +03:00 [INF] Executed DbCommand (133ms) [Parameters=[@__providedApiKey_0='?' (Size = 255)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [a].[Key], [a].[CreatedAt], [a].[Description], [a].[ExpiresAt], [a].[IsActive], [a].[LastUsedAt]
FROM [ApiKeys] AS [a]
WHERE [a].[Key] = @__providedApiKey_0 AND [a].[IsActive] = CAST(1 AS bit)
2025-02-01 10:52:02.457 +03:00 [INF] Executing ObjectResult, writing value of type '<>f__AnonymousType11`2[[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-02-01 10:52:02.501 +03:00 [INF] Executed action NayifatAPI.Controllers.RegistrationController.Register (NayifatAPI) in 2468.5487ms
2025-02-01 10:52:02.504 +03:00 [INF] Executed endpoint 'NayifatAPI.Controllers.RegistrationController.Register (NayifatAPI)'
2025-02-01 10:52:02.520 +03:00 [INF] Request finished HTTP/1.1 POST http://187e-51-252-155-185.ngrok-free.app/api/Registration/register - 401 null application/json; charset=utf-8 2595.2632ms
2025-02-01 10:52:33.690 +03:00 [INF] Request starting HTTP/1.1 POST http://187e-51-252-155-185.ngrok-free.app/api/Registration/register - application/json, 245
2025-02-01 10:52:33.696 +03:00 [INF] Executing endpoint 'NayifatAPI.Controllers.RegistrationController.Register (NayifatAPI)'
2025-02-01 10:52:33.697 +03:00 [INF] Route matched with {action = "Register", controller = "Registration"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] Register(System.Object) on controller NayifatAPI.Controllers.RegistrationController (NayifatAPI).
2025-02-01 10:52:33.809 +03:00 [INF] Executed DbCommand (8ms) [Parameters=[@__providedApiKey_0='?' (Size = 255)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [a].[Key], [a].[CreatedAt], [a].[Description], [a].[ExpiresAt], [a].[IsActive], [a].[LastUsedAt]
FROM [ApiKeys] AS [a]
WHERE [a].[Key] = @__providedApiKey_0 AND [a].[IsActive] = CAST(1 AS bit)
2025-02-01 10:52:33.813 +03:00 [INF] Executing ObjectResult, writing value of type '<>f__AnonymousType11`2[[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-02-01 10:52:33.816 +03:00 [INF] Executed action NayifatAPI.Controllers.RegistrationController.Register (NayifatAPI) in 106.5976ms
2025-02-01 10:52:33.818 +03:00 [INF] Executed endpoint 'NayifatAPI.Controllers.RegistrationController.Register (NayifatAPI)'
2025-02-01 10:52:33.819 +03:00 [INF] Request finished HTTP/1.1 POST http://187e-51-252-155-185.ngrok-free.app/api/Registration/register - 401 null application/json; charset=utf-8 129.025ms
2025-02-01 10:52:42.375 +03:00 [INF] Request starting HTTP/1.1 POST http://187e-51-252-155-185.ngrok-free.app/api/Registration/register - application/json, 245
2025-02-01 10:52:42.379 +03:00 [INF] Executing endpoint 'NayifatAPI.Controllers.RegistrationController.Register (NayifatAPI)'
2025-02-01 10:52:42.380 +03:00 [INF] Route matched with {action = "Register", controller = "Registration"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] Register(System.Object) on controller NayifatAPI.Controllers.RegistrationController (NayifatAPI).
2025-02-01 10:52:42.388 +03:00 [INF] Executing ObjectResult, writing value of type '<>f__AnonymousType11`2[[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-02-01 10:52:42.390 +03:00 [INF] Executed action NayifatAPI.Controllers.RegistrationController.Register (NayifatAPI) in 6.104ms
2025-02-01 10:52:42.391 +03:00 [INF] Executed endpoint 'NayifatAPI.Controllers.RegistrationController.Register (NayifatAPI)'
2025-02-01 10:52:42.392 +03:00 [INF] Request finished HTTP/1.1 POST http://187e-51-252-155-185.ngrok-free.app/api/Registration/register - 401 null application/json; charset=utf-8 17.4232ms
2025-02-01 10:54:18.176 +03:00 [INF] Request starting HTTP/1.1 POST http://187e-51-252-155-185.ngrok-free.app/api/Registration/register - application/json, 245
2025-02-01 10:54:18.286 +03:00 [INF] Executing endpoint 'NayifatAPI.Controllers.RegistrationController.Register (NayifatAPI)'
2025-02-01 10:54:18.287 +03:00 [INF] Route matched with {action = "Register", controller = "Registration"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] Register(System.Object) on controller NayifatAPI.Controllers.RegistrationController (NayifatAPI).
2025-02-01 10:54:18.873 +03:00 [INF] Executed DbCommand (33ms) [Parameters=[@__providedApiKey_0='?' (Size = 255)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [a].[Key], [a].[CreatedAt], [a].[Description], [a].[ExpiresAt], [a].[IsActive], [a].[LastUsedAt]
FROM [ApiKeys] AS [a]
WHERE [a].[Key] = @__providedApiKey_0 AND [a].[IsActive] = CAST(1 AS bit)
2025-02-01 10:54:18.876 +03:00 [INF] Executing ObjectResult, writing value of type '<>f__AnonymousType11`2[[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-02-01 10:54:18.880 +03:00 [INF] Executed action NayifatAPI.Controllers.RegistrationController.Register (NayifatAPI) in 213.5931ms
2025-02-01 10:54:18.882 +03:00 [INF] Executed endpoint 'NayifatAPI.Controllers.RegistrationController.Register (NayifatAPI)'
2025-02-01 10:54:18.883 +03:00 [INF] Request finished HTTP/1.1 POST http://187e-51-252-155-185.ngrok-free.app/api/Registration/register - 401 null application/json; charset=utf-8 709.6157ms
2025-02-01 10:55:59.267 +03:00 [INF] Request starting HTTP/1.1 POST http://localhost:5264/api/loan-application/update - application/json 350
2025-02-01 10:55:59.269 +03:00 [INF] Executing endpoint 'NayifatAPI.Controllers.LoanApplicationController.UpdateLoanApplication (NayifatAPI)'
2025-02-01 10:55:59.279 +03:00 [INF] Route matched with {action = "UpdateLoanApplication", controller = "LoanApplication"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] UpdateLoanApplication(NayifatAPI.Controllers.UpdateLoanApplicationRequest) on controller NayifatAPI.Controllers.LoanApplicationController (NayifatAPI).
2025-02-01 10:55:59.351 +03:00 [INF] Executed DbCommand (4ms) [Parameters=[@__providedApiKey_0='?' (Size = 255)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [a].[Key], [a].[CreatedAt], [a].[Description], [a].[ExpiresAt], [a].[IsActive], [a].[LastUsedAt]
FROM [ApiKeys] AS [a]
WHERE [a].[Key] = @__providedApiKey_0 AND [a].[IsActive] = CAST(1 AS bit)
2025-02-01 10:55:59.510 +03:00 [INF] Executed DbCommand (26ms) [Parameters=[@__request_NationalId_0='?' (Size = 450), @__request_ApplicationNo_1='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [l].[loan_id], [l].[loan_amount], [l].[application_no], [l].[customerDecision], [l].[interest_rate], [l].[national_id], [l].[note], [l].[noteUser], [l].[loan_purpose], [l].[remarks], [l].[status], [l].[status_date], [l].[loan_tenure]
FROM [loan_application_details] AS [l]
WHERE [l].[national_id] = @__request_NationalId_0 AND [l].[application_no] = @__request_ApplicationNo_1
2025-02-01 10:55:59.762 +03:00 [WRN] Savepoints are disabled because Multiple Active Result Sets (MARS) is enabled. If 'SaveChanges' fails, then the transaction cannot be automatically rolled back to a known clean state. Instead, the transaction should be rolled back by the application before retrying 'SaveChanges'. See https://go.microsoft.com/fwlink/?linkid=2149338 for more information and examples. To identify the code which triggers this warning, call 'ConfigureWarnings(w => w.Throw(SqlServerEventId.SavepointsDisabledBecauseOfMARS))'.
2025-02-01 10:55:59.781 +03:00 [INF] Executed DbCommand (14ms) [Parameters=[@p1='?' (DbType = Int32), @p0='?' (DbType = DateTime2)], CommandType='"Text"', CommandTimeout='30']
SET IMPLICIT_TRANSACTIONS OFF;
SET NOCOUNT ON;
UPDATE [loan_application_details] SET [status_date] = @p0
OUTPUT 1
WHERE [loan_id] = @p1;
2025-02-01 10:55:59.829 +03:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType9`2[[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Object, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-02-01 10:55:59.864 +03:00 [INF] Executed action NayifatAPI.Controllers.LoanApplicationController.UpdateLoanApplication (NayifatAPI) in 583.5614ms
2025-02-01 10:55:59.867 +03:00 [INF] Executed endpoint 'NayifatAPI.Controllers.LoanApplicationController.UpdateLoanApplication (NayifatAPI)'
2025-02-01 10:55:59.871 +03:00 [INF] Request finished HTTP/1.1 POST http://localhost:5264/api/loan-application/update - 200 null application/json; charset=utf-8 604.459ms
2025-02-01 10:56:59.921 +03:00 [INF] Request starting HTTP/1.1 POST http://187e-51-252-155-185.ngrok-free.app/api/Registration/register - application/json 245
2025-02-01 10:56:59.926 +03:00 [INF] Executing endpoint 'NayifatAPI.Controllers.RegistrationController.Register (NayifatAPI)'
2025-02-01 10:56:59.927 +03:00 [INF] Route matched with {action = "Register", controller = "Registration"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] Register(System.Object) on controller NayifatAPI.Controllers.RegistrationController (NayifatAPI).
2025-02-01 10:56:59.937 +03:00 [INF] Executed DbCommand (5ms) [Parameters=[@__providedApiKey_0='?' (Size = 255)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [a].[Key], [a].[CreatedAt], [a].[Description], [a].[ExpiresAt], [a].[IsActive], [a].[LastUsedAt]
FROM [ApiKeys] AS [a]
WHERE [a].[Key] = @__providedApiKey_0 AND [a].[IsActive] = CAST(1 AS bit)
2025-02-01 10:56:59.950 +03:00 [ERR] Error during registration for National ID: null
System.Text.Json.JsonException: JSON deserialization for type 'NayifatAPI.Controllers.IdCheckRequest' was missing required properties, including the following: NationalId, DeviceInfo
   at System.Text.Json.ThrowHelper.ThrowJsonException_JsonRequiredPropertyMissing(JsonTypeInfo parent, BitArray requiredPropertiesSet)
   at System.Text.Json.Serialization.Converters.ObjectDefaultConverter`1.OnTryRead(Utf8JsonReader& reader, Type typeToConvert, JsonSerializerOptions options, ReadStack& state, T& value)
   at System.Text.Json.Serialization.JsonConverter`1.TryRead(Utf8JsonReader& reader, Type typeToConvert, JsonSerializerOptions options, ReadStack& state, T& value, Boolean& isPopulatedValue)
   at System.Text.Json.Serialization.JsonConverter`1.ReadCore(Utf8JsonReader& reader, JsonSerializerOptions options, ReadStack& state)
   at System.Text.Json.JsonSerializer.ReadFromSpan[TValue](ReadOnlySpan`1 utf8Json, JsonTypeInfo`1 jsonTypeInfo, Nullable`1 actualByteCount)
   at System.Text.Json.JsonSerializer.ReadFromSpan[TValue](ReadOnlySpan`1 json, JsonTypeInfo`1 jsonTypeInfo)
   at System.Text.Json.JsonSerializer.Deserialize[TValue](String json, JsonSerializerOptions options)
   at NayifatAPI.Controllers.RegistrationController.Register(Object request) in C:\Users\yamta\StudioProjects\nayifat_app_2025_new\NayifatAPI\Controllers\RegistrationController.cs:line 47
2025-02-01 10:56:59.976 +03:00 [INF] Executing ObjectResult, writing value of type '<>f__AnonymousType11`2[[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-02-01 10:56:59.981 +03:00 [INF] Executed action NayifatAPI.Controllers.RegistrationController.Register (NayifatAPI) in 50.916ms
2025-02-01 10:56:59.982 +03:00 [INF] Executed endpoint 'NayifatAPI.Controllers.RegistrationController.Register (NayifatAPI)'
2025-02-01 10:56:59.984 +03:00 [INF] Request finished HTTP/1.1 POST http://187e-51-252-155-185.ngrok-free.app/api/Registration/register - 500 null application/json; charset=utf-8 62.9419ms
2025-02-01 10:57:09.182 +03:00 [INF] Request starting HTTP/1.1 POST http://187e-51-252-155-185.ngrok-free.app/api/Registration/register - application/json 245
2025-02-01 10:57:09.186 +03:00 [INF] Executing endpoint 'NayifatAPI.Controllers.RegistrationController.Register (NayifatAPI)'
2025-02-01 10:57:09.188 +03:00 [INF] Route matched with {action = "Register", controller = "Registration"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] Register(System.Object) on controller NayifatAPI.Controllers.RegistrationController (NayifatAPI).
2025-02-01 10:57:09.193 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@__providedApiKey_0='?' (Size = 255)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [a].[Key], [a].[CreatedAt], [a].[Description], [a].[ExpiresAt], [a].[IsActive], [a].[LastUsedAt]
FROM [ApiKeys] AS [a]
WHERE [a].[Key] = @__providedApiKey_0 AND [a].[IsActive] = CAST(1 AS bit)
2025-02-01 10:57:09.196 +03:00 [ERR] Error during registration for National ID: null
System.Text.Json.JsonException: JSON deserialization for type 'NayifatAPI.Controllers.IdCheckRequest' was missing required properties, including the following: NationalId, DeviceInfo
   at System.Text.Json.ThrowHelper.ThrowJsonException_JsonRequiredPropertyMissing(JsonTypeInfo parent, BitArray requiredPropertiesSet)
   at System.Text.Json.Serialization.Converters.ObjectDefaultConverter`1.OnTryRead(Utf8JsonReader& reader, Type typeToConvert, JsonSerializerOptions options, ReadStack& state, T& value)
   at System.Text.Json.Serialization.JsonConverter`1.TryRead(Utf8JsonReader& reader, Type typeToConvert, JsonSerializerOptions options, ReadStack& state, T& value, Boolean& isPopulatedValue)
   at System.Text.Json.Serialization.JsonConverter`1.ReadCore(Utf8JsonReader& reader, JsonSerializerOptions options, ReadStack& state)
   at System.Text.Json.JsonSerializer.ReadFromSpan[TValue](ReadOnlySpan`1 utf8Json, JsonTypeInfo`1 jsonTypeInfo, Nullable`1 actualByteCount)
   at System.Text.Json.JsonSerializer.ReadFromSpan[TValue](ReadOnlySpan`1 json, JsonTypeInfo`1 jsonTypeInfo)
   at System.Text.Json.JsonSerializer.Deserialize[TValue](String json, JsonSerializerOptions options)
   at NayifatAPI.Controllers.RegistrationController.Register(Object request) in C:\Users\yamta\StudioProjects\nayifat_app_2025_new\NayifatAPI\Controllers\RegistrationController.cs:line 47
2025-02-01 10:57:09.202 +03:00 [INF] Executing ObjectResult, writing value of type '<>f__AnonymousType11`2[[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-02-01 10:57:09.204 +03:00 [INF] Executed action NayifatAPI.Controllers.RegistrationController.Register (NayifatAPI) in 14.3817ms
2025-02-01 10:57:09.206 +03:00 [INF] Executed endpoint 'NayifatAPI.Controllers.RegistrationController.Register (NayifatAPI)'
2025-02-01 10:57:09.208 +03:00 [INF] Request finished HTTP/1.1 POST http://187e-51-252-155-185.ngrok-free.app/api/Registration/register - 500 null application/json; charset=utf-8 25.4196ms
2025-02-01 10:58:49.952 +03:00 [INF] Request starting HTTP/1.1 POST http://187e-51-252-155-185.ngrok-free.app/api/notifications/list - application/json; charset=utf-8 48
2025-02-01 10:58:49.954 +03:00 [INF] Executing endpoint 'NayifatAPI.Controllers.NotificationsController.GetNotifications (NayifatAPI)'
2025-02-01 10:58:49.963 +03:00 [INF] Route matched with {action = "GetNotifications", controller = "Notifications"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetNotifications(NayifatAPI.Controllers.GetNotificationsRequest) on controller NayifatAPI.Controllers.NotificationsController (NayifatAPI).
2025-02-01 10:58:49.971 +03:00 [INF] Executing BadRequestObjectResult, writing value of type 'Microsoft.AspNetCore.Mvc.ValidationProblemDetails'.
2025-02-01 10:58:49.990 +03:00 [INF] Executed action NayifatAPI.Controllers.NotificationsController.GetNotifications (NayifatAPI) in 25.0623ms
2025-02-01 10:58:49.991 +03:00 [INF] Executed endpoint 'NayifatAPI.Controllers.NotificationsController.GetNotifications (NayifatAPI)'
2025-02-01 10:58:49.992 +03:00 [INF] Request finished HTTP/1.1 POST http://187e-51-252-155-185.ngrok-free.app/api/notifications/list - 400 null application/problem+json; charset=utf-8 40.9457ms
2025-02-01 10:59:33.733 +03:00 [INF] Request starting HTTP/1.1 POST http://187e-51-252-155-185.ngrok-free.app/api/Registration/register - application/json 245
2025-02-01 10:59:33.736 +03:00 [INF] Executing endpoint 'NayifatAPI.Controllers.RegistrationController.Register (NayifatAPI)'
2025-02-01 10:59:33.739 +03:00 [INF] Route matched with {action = "Register", controller = "Registration"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] Register(System.Object) on controller NayifatAPI.Controllers.RegistrationController (NayifatAPI).
2025-02-01 10:59:33.746 +03:00 [INF] Executed DbCommand (3ms) [Parameters=[@__providedApiKey_0='?' (Size = 255)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [a].[Key], [a].[CreatedAt], [a].[Description], [a].[ExpiresAt], [a].[IsActive], [a].[LastUsedAt]
FROM [ApiKeys] AS [a]
WHERE [a].[Key] = @__providedApiKey_0 AND [a].[IsActive] = CAST(1 AS bit)
2025-02-01 10:59:33.750 +03:00 [ERR] Error during registration for National ID: null
System.Text.Json.JsonException: JSON deserialization for type 'NayifatAPI.Controllers.IdCheckRequest' was missing required properties, including the following: NationalId, DeviceInfo
   at System.Text.Json.ThrowHelper.ThrowJsonException_JsonRequiredPropertyMissing(JsonTypeInfo parent, BitArray requiredPropertiesSet)
   at System.Text.Json.Serialization.Converters.ObjectDefaultConverter`1.OnTryRead(Utf8JsonReader& reader, Type typeToConvert, JsonSerializerOptions options, ReadStack& state, T& value)
   at System.Text.Json.Serialization.JsonConverter`1.TryRead(Utf8JsonReader& reader, Type typeToConvert, JsonSerializerOptions options, ReadStack& state, T& value, Boolean& isPopulatedValue)
   at System.Text.Json.Serialization.JsonConverter`1.ReadCore(Utf8JsonReader& reader, JsonSerializerOptions options, ReadStack& state)
   at System.Text.Json.JsonSerializer.ReadFromSpan[TValue](ReadOnlySpan`1 utf8Json, JsonTypeInfo`1 jsonTypeInfo, Nullable`1 actualByteCount)
   at System.Text.Json.JsonSerializer.ReadFromSpan[TValue](ReadOnlySpan`1 json, JsonTypeInfo`1 jsonTypeInfo)
   at System.Text.Json.JsonSerializer.Deserialize[TValue](String json, JsonSerializerOptions options)
   at NayifatAPI.Controllers.RegistrationController.Register(Object request) in C:\Users\yamta\StudioProjects\nayifat_app_2025_new\NayifatAPI\Controllers\RegistrationController.cs:line 47
2025-02-01 10:59:33.756 +03:00 [INF] Executing ObjectResult, writing value of type '<>f__AnonymousType11`2[[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-02-01 10:59:33.758 +03:00 [INF] Executed action NayifatAPI.Controllers.RegistrationController.Register (NayifatAPI) in 16.5495ms
2025-02-01 10:59:33.759 +03:00 [INF] Executed endpoint 'NayifatAPI.Controllers.RegistrationController.Register (NayifatAPI)'
2025-02-01 10:59:33.760 +03:00 [INF] Request finished HTTP/1.1 POST http://187e-51-252-155-185.ngrok-free.app/api/Registration/register - 500 null application/json; charset=utf-8 27.0454ms
2025-02-01 10:59:51.828 +03:00 [INF] Request starting HTTP/1.1 POST http://187e-51-252-155-185.ngrok-free.app/api/Registration/register - application/json 245
2025-02-01 10:59:51.833 +03:00 [INF] Executing endpoint 'NayifatAPI.Controllers.RegistrationController.Register (NayifatAPI)'
2025-02-01 10:59:51.835 +03:00 [INF] Route matched with {action = "Register", controller = "Registration"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] Register(System.Object) on controller NayifatAPI.Controllers.RegistrationController (NayifatAPI).
2025-02-01 10:59:51.858 +03:00 [INF] Executed DbCommand (16ms) [Parameters=[@__providedApiKey_0='?' (Size = 255)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [a].[Key], [a].[CreatedAt], [a].[Description], [a].[ExpiresAt], [a].[IsActive], [a].[LastUsedAt]
FROM [ApiKeys] AS [a]
WHERE [a].[Key] = @__providedApiKey_0 AND [a].[IsActive] = CAST(1 AS bit)
2025-02-01 10:59:51.860 +03:00 [ERR] Error during registration for National ID: null
System.Text.Json.JsonException: JSON deserialization for type 'NayifatAPI.Controllers.IdCheckRequest' was missing required properties, including the following: NationalId, DeviceInfo
   at System.Text.Json.ThrowHelper.ThrowJsonException_JsonRequiredPropertyMissing(JsonTypeInfo parent, BitArray requiredPropertiesSet)
   at System.Text.Json.Serialization.Converters.ObjectDefaultConverter`1.OnTryRead(Utf8JsonReader& reader, Type typeToConvert, JsonSerializerOptions options, ReadStack& state, T& value)
   at System.Text.Json.Serialization.JsonConverter`1.TryRead(Utf8JsonReader& reader, Type typeToConvert, JsonSerializerOptions options, ReadStack& state, T& value, Boolean& isPopulatedValue)
   at System.Text.Json.Serialization.JsonConverter`1.ReadCore(Utf8JsonReader& reader, JsonSerializerOptions options, ReadStack& state)
   at System.Text.Json.JsonSerializer.ReadFromSpan[TValue](ReadOnlySpan`1 utf8Json, JsonTypeInfo`1 jsonTypeInfo, Nullable`1 actualByteCount)
   at System.Text.Json.JsonSerializer.ReadFromSpan[TValue](ReadOnlySpan`1 json, JsonTypeInfo`1 jsonTypeInfo)
   at System.Text.Json.JsonSerializer.Deserialize[TValue](String json, JsonSerializerOptions options)
   at NayifatAPI.Controllers.RegistrationController.Register(Object request) in C:\Users\yamta\StudioProjects\nayifat_app_2025_new\NayifatAPI\Controllers\RegistrationController.cs:line 47
2025-02-01 10:59:51.864 +03:00 [INF] Executing ObjectResult, writing value of type '<>f__AnonymousType11`2[[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-02-01 10:59:51.956 +03:00 [INF] Executed action NayifatAPI.Controllers.RegistrationController.Register (NayifatAPI) in 118.2367ms
2025-02-01 10:59:51.958 +03:00 [INF] Executed endpoint 'NayifatAPI.Controllers.RegistrationController.Register (NayifatAPI)'
2025-02-01 10:59:51.976 +03:00 [INF] Request finished HTTP/1.1 POST http://187e-51-252-155-185.ngrok-free.app/api/Registration/register - 500 null application/json; charset=utf-8 148.7174ms
2025-02-01 11:01:19.170 +03:00 [INF] Request starting HTTP/1.1 POST http://187e-51-252-155-185.ngrok-free.app/api/Registration/register - application/json 244
2025-02-01 11:01:19.172 +03:00 [INF] Executing endpoint 'NayifatAPI.Controllers.RegistrationController.Register (NayifatAPI)'
2025-02-01 11:01:19.174 +03:00 [INF] Route matched with {action = "Register", controller = "Registration"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] Register(System.Object) on controller NayifatAPI.Controllers.RegistrationController (NayifatAPI).
2025-02-01 11:01:19.259 +03:00 [INF] Executed DbCommand (80ms) [Parameters=[@__providedApiKey_0='?' (Size = 255)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [a].[Key], [a].[CreatedAt], [a].[Description], [a].[ExpiresAt], [a].[IsActive], [a].[LastUsedAt]
FROM [ApiKeys] AS [a]
WHERE [a].[Key] = @__providedApiKey_0 AND [a].[IsActive] = CAST(1 AS bit)
2025-02-01 11:01:19.366 +03:00 [INF] Executed DbCommand (83ms) [Parameters=[@__idCheckRequest_NationalId_0='?' (Size = 450)], CommandType='"Text"', CommandTimeout='30']
SELECT CASE
    WHEN EXISTS (
        SELECT 1
        FROM [Customers] AS [c]
        WHERE [c].[NationalId] = @__idCheckRequest_NationalId_0) THEN CAST(1 AS bit)
    ELSE CAST(0 AS bit)
END
2025-02-01 11:01:19.372 +03:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType9`2[[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Object, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-02-01 11:01:19.376 +03:00 [INF] Executed action NayifatAPI.Controllers.RegistrationController.Register (NayifatAPI) in 199.9725ms
2025-02-01 11:01:19.377 +03:00 [INF] Executed endpoint 'NayifatAPI.Controllers.RegistrationController.Register (NayifatAPI)'
2025-02-01 11:01:19.379 +03:00 [INF] Request finished HTTP/1.1 POST http://187e-51-252-155-185.ngrok-free.app/api/Registration/register - 200 null application/json; charset=utf-8 209.664ms
2025-02-01 11:01:55.636 +03:00 [INF] Application is shutting down...
2025-02-01 11:02:09.563 +03:00 [INF] Starting web application
2025-02-01 11:02:09.658 +03:00 [INF] Now listening on: http://localhost:5264
2025-02-01 11:02:09.664 +03:00 [INF] Application started. Press Ctrl+C to shut down.
2025-02-01 11:02:09.665 +03:00 [INF] Hosting environment: Development
2025-02-01 11:02:09.665 +03:00 [INF] Content root path: C:\Users\yamta\StudioProjects\nayifat_app_2025_new\NayifatAPI
2025-02-01 11:02:32.719 +03:00 [INF] Request starting HTTP/1.1 GET http://187e-51-252-155-185.ngrok-free.app/index.html - null null
2025-02-01 11:02:32.811 +03:00 [INF] Request finished HTTP/1.1 GET http://187e-51-252-155-185.ngrok-free.app/index.html - 200 null text/html;charset=utf-8 92.4126ms
2025-02-01 11:02:33.714 +03:00 [INF] Request starting HTTP/1.1 GET http://187e-51-252-155-185.ngrok-free.app/swagger/v1/swagger.json - null null
2025-02-01 11:02:33.822 +03:00 [INF] Request finished HTTP/1.1 GET http://187e-51-252-155-185.ngrok-free.app/swagger/v1/swagger.json - 200 null application/json;charset=utf-8 108.0716ms
2025-02-01 11:11:09.069 +03:00 [INF] Request starting HTTP/1.1 POST http://187e-51-252-155-185.ngrok-free.app/api/notifications/list - application/json; charset=utf-8 48
2025-02-01 11:11:09.077 +03:00 [WRN] Failed to determine the https port for redirect.
2025-02-01 11:11:09.081 +03:00 [INF] Executing endpoint 'NayifatAPI.Controllers.NotificationsController.GetNotifications (NayifatAPI)'
2025-02-01 11:11:09.104 +03:00 [INF] Route matched with {action = "GetNotifications", controller = "Notifications"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetNotifications(NayifatAPI.Controllers.GetNotificationsRequest) on controller NayifatAPI.Controllers.NotificationsController (NayifatAPI).
2025-02-01 11:11:09.205 +03:00 [INF] Executing BadRequestObjectResult, writing value of type 'Microsoft.AspNetCore.Mvc.ValidationProblemDetails'.
2025-02-01 11:11:09.225 +03:00 [INF] Executed action NayifatAPI.Controllers.NotificationsController.GetNotifications (NayifatAPI) in 115.271ms
2025-02-01 11:11:09.227 +03:00 [INF] Executed endpoint 'NayifatAPI.Controllers.NotificationsController.GetNotifications (NayifatAPI)'
2025-02-01 11:11:09.231 +03:00 [INF] Request finished HTTP/1.1 POST http://187e-51-252-155-185.ngrok-free.app/api/notifications/list - 400 null application/problem+json; charset=utf-8 162.0434ms
2025-02-01 11:16:10.639 +03:00 [INF] Request starting HTTP/1.1 POST http://187e-51-252-155-185.ngrok-free.app/api/notifications/list - application/json; charset=utf-8 48
2025-02-01 11:16:10.645 +03:00 [INF] Executing endpoint 'NayifatAPI.Controllers.NotificationsController.GetNotifications (NayifatAPI)'
2025-02-01 11:16:10.647 +03:00 [INF] Route matched with {action = "GetNotifications", controller = "Notifications"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetNotifications(NayifatAPI.Controllers.GetNotificationsRequest) on controller NayifatAPI.Controllers.NotificationsController (NayifatAPI).
2025-02-01 11:16:10.657 +03:00 [INF] Executing BadRequestObjectResult, writing value of type 'Microsoft.AspNetCore.Mvc.ValidationProblemDetails'.
2025-02-01 11:16:10.660 +03:00 [INF] Executed action NayifatAPI.Controllers.NotificationsController.GetNotifications (NayifatAPI) in 9.2027ms
2025-02-01 11:16:10.662 +03:00 [INF] Executed endpoint 'NayifatAPI.Controllers.NotificationsController.GetNotifications (NayifatAPI)'
2025-02-01 11:16:10.664 +03:00 [INF] Request finished HTTP/1.1 POST http://187e-51-252-155-185.ngrok-free.app/api/notifications/list - 400 null application/problem+json; charset=utf-8 25.6ms
2025-02-01 11:21:10.656 +03:00 [INF] Request starting HTTP/1.1 POST http://187e-51-252-155-185.ngrok-free.app/api/notifications/list - application/json; charset=utf-8 48
2025-02-01 11:21:10.681 +03:00 [INF] Executing endpoint 'NayifatAPI.Controllers.NotificationsController.GetNotifications (NayifatAPI)'
2025-02-01 11:21:10.721 +03:00 [INF] Route matched with {action = "GetNotifications", controller = "Notifications"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetNotifications(NayifatAPI.Controllers.GetNotificationsRequest) on controller NayifatAPI.Controllers.NotificationsController (NayifatAPI).
2025-02-01 11:21:10.739 +03:00 [INF] Executing BadRequestObjectResult, writing value of type 'Microsoft.AspNetCore.Mvc.ValidationProblemDetails'.
2025-02-01 11:21:10.777 +03:00 [INF] Executed action NayifatAPI.Controllers.NotificationsController.GetNotifications (NayifatAPI) in 43.8452ms
2025-02-01 11:21:10.805 +03:00 [INF] Executed endpoint 'NayifatAPI.Controllers.NotificationsController.GetNotifications (NayifatAPI)'
2025-02-01 11:21:10.807 +03:00 [INF] Request finished HTTP/1.1 POST http://187e-51-252-155-185.ngrok-free.app/api/notifications/list - 400 null application/problem+json; charset=utf-8 150.8614ms
2025-02-01 11:23:29.226 +03:00 [INF] Request starting HTTP/1.1 POST http://187e-51-252-155-185.ngrok-free.app/api/notifications/list - application/json; charset=utf-8 48
2025-02-01 11:23:29.230 +03:00 [INF] Executing endpoint 'NayifatAPI.Controllers.NotificationsController.GetNotifications (NayifatAPI)'
2025-02-01 11:23:29.231 +03:00 [INF] Route matched with {action = "GetNotifications", controller = "Notifications"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetNotifications(NayifatAPI.Controllers.GetNotificationsRequest) on controller NayifatAPI.Controllers.NotificationsController (NayifatAPI).
2025-02-01 11:23:29.234 +03:00 [INF] Executing BadRequestObjectResult, writing value of type 'Microsoft.AspNetCore.Mvc.ValidationProblemDetails'.
2025-02-01 11:23:29.235 +03:00 [INF] Executed action NayifatAPI.Controllers.NotificationsController.GetNotifications (NayifatAPI) in 2.4078ms
2025-02-01 11:23:29.237 +03:00 [INF] Executed endpoint 'NayifatAPI.Controllers.NotificationsController.GetNotifications (NayifatAPI)'
2025-02-01 11:23:29.238 +03:00 [INF] Request finished HTTP/1.1 POST http://187e-51-252-155-185.ngrok-free.app/api/notifications/list - 400 null application/problem+json; charset=utf-8 11.6635ms
2025-02-01 11:24:48.002 +03:00 [INF] Request starting HTTP/1.1 POST http://187e-51-252-155-185.ngrok-free.app/api/Registration/register - application/json; charset=utf-8 153
2025-02-01 11:24:48.004 +03:00 [INF] Executing endpoint 'NayifatAPI.Controllers.RegistrationController.Register (NayifatAPI)'
2025-02-01 11:24:48.009 +03:00 [INF] Route matched with {action = "Register", controller = "Registration"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] Register(System.Object) on controller NayifatAPI.Controllers.RegistrationController (NayifatAPI).
2025-02-01 11:24:49.601 +03:00 [INF] Executed DbCommand (111ms) [Parameters=[@__providedApiKey_0='?' (Size = 255)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [a].[Key], [a].[CreatedAt], [a].[Description], [a].[ExpiresAt], [a].[IsActive], [a].[LastUsedAt]
FROM [ApiKeys] AS [a]
WHERE [a].[Key] = @__providedApiKey_0 AND [a].[IsActive] = CAST(1 AS bit)
2025-02-01 11:24:50.016 +03:00 [INF] Executed DbCommand (301ms) [Parameters=[@__idCheckRequest_NationalId_0='?' (Size = 450)], CommandType='"Text"', CommandTimeout='30']
SELECT CASE
    WHEN EXISTS (
        SELECT 1
        FROM [Customers] AS [c]
        WHERE [c].[NationalId] = @__idCheckRequest_NationalId_0) THEN CAST(1 AS bit)
    ELSE CAST(0 AS bit)
END
2025-02-01 11:24:50.027 +03:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType9`2[[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Object, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-02-01 11:24:50.033 +03:00 [INF] Executed action NayifatAPI.Controllers.RegistrationController.Register (NayifatAPI) in 2022.4428ms
2025-02-01 11:24:50.035 +03:00 [INF] Executed endpoint 'NayifatAPI.Controllers.RegistrationController.Register (NayifatAPI)'
2025-02-01 11:24:50.046 +03:00 [INF] Request finished HTTP/1.1 POST http://187e-51-252-155-185.ngrok-free.app/api/Registration/register - 200 null application/json; charset=utf-8 2043.1952ms
2025-02-01 11:24:51.152 +03:00 [INF] Request starting HTTP/1.1 POST http://187e-51-252-155-185.ngrok-free.app/api/nafath/create - application/json; charset=utf-8 27
2025-02-01 11:24:51.154 +03:00 [INF] Request finished HTTP/1.1 POST http://187e-51-252-155-185.ngrok-free.app/api/nafath/create - 404 0 null 1.9624ms
2025-02-01 11:24:51.157 +03:00 [INF] Request reached the end of the middleware pipeline without being handled by application code. Request path: POST http://187e-51-252-155-185.ngrok-free.app/api/nafath/create, Response status code: 404
2025-02-01 11:28:30.430 +03:00 [INF] Request starting HTTP/1.1 POST http://187e-51-252-155-185.ngrok-free.app/api/notifications/list - application/json; charset=utf-8 48
2025-02-01 11:28:30.433 +03:00 [INF] Executing endpoint 'NayifatAPI.Controllers.NotificationsController.GetNotifications (NayifatAPI)'
2025-02-01 11:28:30.434 +03:00 [INF] Route matched with {action = "GetNotifications", controller = "Notifications"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetNotifications(NayifatAPI.Controllers.GetNotificationsRequest) on controller NayifatAPI.Controllers.NotificationsController (NayifatAPI).
2025-02-01 11:28:30.437 +03:00 [INF] Executing BadRequestObjectResult, writing value of type 'Microsoft.AspNetCore.Mvc.ValidationProblemDetails'.
2025-02-01 11:28:30.438 +03:00 [INF] Executed action NayifatAPI.Controllers.NotificationsController.GetNotifications (NayifatAPI) in 2.4873ms
2025-02-01 11:28:30.441 +03:00 [INF] Executed endpoint 'NayifatAPI.Controllers.NotificationsController.GetNotifications (NayifatAPI)'
2025-02-01 11:28:30.442 +03:00 [INF] Request finished HTTP/1.1 POST http://187e-51-252-155-185.ngrok-free.app/api/notifications/list - 400 null application/problem+json; charset=utf-8 11.1368ms
2025-02-01 11:28:30.504 +03:00 [INF] Request starting HTTP/1.1 POST http://187e-51-252-155-185.ngrok-free.app/api/Registration/register - application/json; charset=utf-8 153
2025-02-01 11:28:30.508 +03:00 [INF] Executing endpoint 'NayifatAPI.Controllers.RegistrationController.Register (NayifatAPI)'
2025-02-01 11:28:30.509 +03:00 [INF] Route matched with {action = "Register", controller = "Registration"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] Register(System.Object) on controller NayifatAPI.Controllers.RegistrationController (NayifatAPI).
2025-02-01 11:28:30.537 +03:00 [INF] Executed DbCommand (10ms) [Parameters=[@__providedApiKey_0='?' (Size = 255)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [a].[Key], [a].[CreatedAt], [a].[Description], [a].[ExpiresAt], [a].[IsActive], [a].[LastUsedAt]
FROM [ApiKeys] AS [a]
WHERE [a].[Key] = @__providedApiKey_0 AND [a].[IsActive] = CAST(1 AS bit)
2025-02-01 11:28:30.636 +03:00 [INF] Executed DbCommand (94ms) [Parameters=[@__idCheckRequest_NationalId_0='?' (Size = 450)], CommandType='"Text"', CommandTimeout='30']
SELECT CASE
    WHEN EXISTS (
        SELECT 1
        FROM [Customers] AS [c]
        WHERE [c].[NationalId] = @__idCheckRequest_NationalId_0) THEN CAST(1 AS bit)
    ELSE CAST(0 AS bit)
END
2025-02-01 11:28:30.640 +03:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType9`2[[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Object, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-02-01 11:28:30.642 +03:00 [INF] Executed action NayifatAPI.Controllers.RegistrationController.Register (NayifatAPI) in 132.0414ms
2025-02-01 11:28:30.644 +03:00 [INF] Executed endpoint 'NayifatAPI.Controllers.RegistrationController.Register (NayifatAPI)'
2025-02-01 11:28:30.645 +03:00 [INF] Request finished HTTP/1.1 POST http://187e-51-252-155-185.ngrok-free.app/api/Registration/register - 200 null application/json; charset=utf-8 140.7619ms
2025-02-01 11:28:31.713 +03:00 [INF] Request starting HTTP/1.1 POST http://187e-51-252-155-185.ngrok-free.app/api/nafath/create - application/json; charset=utf-8 27
2025-02-01 11:28:31.963 +03:00 [INF] Request finished HTTP/1.1 POST http://187e-51-252-155-185.ngrok-free.app/api/nafath/create - 404 0 null 250.2651ms
2025-02-01 11:28:31.969 +03:00 [INF] Request reached the end of the middleware pipeline without being handled by application code. Request path: POST http://187e-51-252-155-185.ngrok-free.app/api/nafath/create, Response status code: 404
2025-02-01 11:28:56.928 +03:00 [INF] Request starting HTTP/1.1 POST http://187e-51-252-155-185.ngrok-free.app/api/Registration/register - application/json; charset=utf-8 153
2025-02-01 11:28:56.931 +03:00 [INF] Executing endpoint 'NayifatAPI.Controllers.RegistrationController.Register (NayifatAPI)'
2025-02-01 11:28:56.931 +03:00 [INF] Route matched with {action = "Register", controller = "Registration"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] Register(System.Object) on controller NayifatAPI.Controllers.RegistrationController (NayifatAPI).
2025-02-01 11:28:56.982 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@__providedApiKey_0='?' (Size = 255)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [a].[Key], [a].[CreatedAt], [a].[Description], [a].[ExpiresAt], [a].[IsActive], [a].[LastUsedAt]
FROM [ApiKeys] AS [a]
WHERE [a].[Key] = @__providedApiKey_0 AND [a].[IsActive] = CAST(1 AS bit)
2025-02-01 11:28:56.987 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@__idCheckRequest_NationalId_0='?' (Size = 450)], CommandType='"Text"', CommandTimeout='30']
SELECT CASE
    WHEN EXISTS (
        SELECT 1
        FROM [Customers] AS [c]
        WHERE [c].[NationalId] = @__idCheckRequest_NationalId_0) THEN CAST(1 AS bit)
    ELSE CAST(0 AS bit)
END
2025-02-01 11:28:56.988 +03:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType9`2[[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Object, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-02-01 11:28:56.989 +03:00 [INF] Executed action NayifatAPI.Controllers.RegistrationController.Register (NayifatAPI) in 56.8963ms
2025-02-01 11:28:56.990 +03:00 [INF] Executed endpoint 'NayifatAPI.Controllers.RegistrationController.Register (NayifatAPI)'
2025-02-01 11:28:56.991 +03:00 [INF] Request finished HTTP/1.1 POST http://187e-51-252-155-185.ngrok-free.app/api/Registration/register - 200 null application/json; charset=utf-8 63.1097ms
2025-02-01 11:28:57.989 +03:00 [INF] Request starting HTTP/1.1 POST http://187e-51-252-155-185.ngrok-free.app/api/nafath/create - application/json; charset=utf-8 27
2025-02-01 11:28:57.992 +03:00 [INF] Request finished HTTP/1.1 POST http://187e-51-252-155-185.ngrok-free.app/api/nafath/create - 404 0 null 2.9023ms
2025-02-01 11:28:57.994 +03:00 [INF] Request reached the end of the middleware pipeline without being handled by application code. Request path: POST http://187e-51-252-155-185.ngrok-free.app/api/nafath/create, Response status code: 404
2025-02-01 11:30:42.703 +03:00 [INF] Request starting HTTP/1.1 POST http://187e-51-252-155-185.ngrok-free.app/api/Registration/register - application/json; charset=utf-8 153
2025-02-01 11:30:42.706 +03:00 [INF] Executing endpoint 'NayifatAPI.Controllers.RegistrationController.Register (NayifatAPI)'
2025-02-01 11:30:42.708 +03:00 [INF] Route matched with {action = "Register", controller = "Registration"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] Register(System.Object) on controller NayifatAPI.Controllers.RegistrationController (NayifatAPI).
2025-02-01 11:30:42.714 +03:00 [INF] Executed DbCommand (3ms) [Parameters=[@__providedApiKey_0='?' (Size = 255)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [a].[Key], [a].[CreatedAt], [a].[Description], [a].[ExpiresAt], [a].[IsActive], [a].[LastUsedAt]
FROM [ApiKeys] AS [a]
WHERE [a].[Key] = @__providedApiKey_0 AND [a].[IsActive] = CAST(1 AS bit)
2025-02-01 11:30:42.719 +03:00 [INF] Executed DbCommand (2ms) [Parameters=[@__idCheckRequest_NationalId_0='?' (Size = 450)], CommandType='"Text"', CommandTimeout='30']
SELECT CASE
    WHEN EXISTS (
        SELECT 1
        FROM [Customers] AS [c]
        WHERE [c].[NationalId] = @__idCheckRequest_NationalId_0) THEN CAST(1 AS bit)
    ELSE CAST(0 AS bit)
END
2025-02-01 11:30:42.721 +03:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType9`2[[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Object, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-02-01 11:30:42.722 +03:00 [INF] Executed action NayifatAPI.Controllers.RegistrationController.Register (NayifatAPI) in 12.0163ms
2025-02-01 11:30:42.722 +03:00 [INF] Executed endpoint 'NayifatAPI.Controllers.RegistrationController.Register (NayifatAPI)'
2025-02-01 11:30:42.723 +03:00 [INF] Request finished HTTP/1.1 POST http://187e-51-252-155-185.ngrok-free.app/api/Registration/register - 200 null application/json; charset=utf-8 19.7786ms
2025-02-01 11:33:30.376 +03:00 [INF] Request starting HTTP/1.1 POST http://187e-51-252-155-185.ngrok-free.app/api/notifications/list - application/json; charset=utf-8 48
2025-02-01 11:33:30.379 +03:00 [INF] Executing endpoint 'NayifatAPI.Controllers.NotificationsController.GetNotifications (NayifatAPI)'
2025-02-01 11:33:30.380 +03:00 [INF] Route matched with {action = "GetNotifications", controller = "Notifications"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetNotifications(NayifatAPI.Controllers.GetNotificationsRequest) on controller NayifatAPI.Controllers.NotificationsController (NayifatAPI).
2025-02-01 11:33:30.382 +03:00 [INF] Executing BadRequestObjectResult, writing value of type 'Microsoft.AspNetCore.Mvc.ValidationProblemDetails'.
2025-02-01 11:33:30.383 +03:00 [INF] Executed action NayifatAPI.Controllers.NotificationsController.GetNotifications (NayifatAPI) in 2.2248ms
2025-02-01 11:33:30.387 +03:00 [INF] Executed endpoint 'NayifatAPI.Controllers.NotificationsController.GetNotifications (NayifatAPI)'
2025-02-01 11:33:30.388 +03:00 [INF] Request finished HTTP/1.1 POST http://187e-51-252-155-185.ngrok-free.app/api/notifications/list - 400 null application/problem+json; charset=utf-8 11.696ms
2025-02-01 11:34:58.649 +03:00 [INF] Request starting HTTP/1.1 POST http://187e-51-252-155-185.ngrok-free.app/api/notifications/list - application/json; charset=utf-8 48
2025-02-01 11:34:58.920 +03:00 [INF] Executing endpoint 'NayifatAPI.Controllers.NotificationsController.GetNotifications (NayifatAPI)'
2025-02-01 11:34:58.921 +03:00 [INF] Route matched with {action = "GetNotifications", controller = "Notifications"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetNotifications(NayifatAPI.Controllers.GetNotificationsRequest) on controller NayifatAPI.Controllers.NotificationsController (NayifatAPI).
2025-02-01 11:34:58.924 +03:00 [INF] Executing BadRequestObjectResult, writing value of type 'Microsoft.AspNetCore.Mvc.ValidationProblemDetails'.
2025-02-01 11:34:58.925 +03:00 [INF] Executed action NayifatAPI.Controllers.NotificationsController.GetNotifications (NayifatAPI) in 1.9957ms
2025-02-01 11:34:58.926 +03:00 [INF] Executed endpoint 'NayifatAPI.Controllers.NotificationsController.GetNotifications (NayifatAPI)'
2025-02-01 11:34:58.927 +03:00 [INF] Request finished HTTP/1.1 POST http://187e-51-252-155-185.ngrok-free.app/api/notifications/list - 400 null application/problem+json; charset=utf-8 278.0213ms
2025-02-01 11:35:36.539 +03:00 [INF] Request starting HTTP/1.1 POST http://187e-51-252-155-185.ngrok-free.app/api/Registration/register - application/json; charset=utf-8 153
2025-02-01 11:35:36.542 +03:00 [INF] Executing endpoint 'NayifatAPI.Controllers.RegistrationController.Register (NayifatAPI)'
2025-02-01 11:35:36.543 +03:00 [INF] Route matched with {action = "Register", controller = "Registration"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] Register(System.Object) on controller NayifatAPI.Controllers.RegistrationController (NayifatAPI).
2025-02-01 11:35:36.552 +03:00 [INF] Executed DbCommand (2ms) [Parameters=[@__providedApiKey_0='?' (Size = 255)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [a].[Key], [a].[CreatedAt], [a].[Description], [a].[ExpiresAt], [a].[IsActive], [a].[LastUsedAt]
FROM [ApiKeys] AS [a]
WHERE [a].[Key] = @__providedApiKey_0 AND [a].[IsActive] = CAST(1 AS bit)
2025-02-01 11:35:36.558 +03:00 [INF] Executed DbCommand (2ms) [Parameters=[@__idCheckRequest_NationalId_0='?' (Size = 450)], CommandType='"Text"', CommandTimeout='30']
SELECT CASE
    WHEN EXISTS (
        SELECT 1
        FROM [Customers] AS [c]
        WHERE [c].[NationalId] = @__idCheckRequest_NationalId_0) THEN CAST(1 AS bit)
    ELSE CAST(0 AS bit)
END
2025-02-01 11:35:36.560 +03:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType9`2[[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Object, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-02-01 11:35:36.561 +03:00 [INF] Executed action NayifatAPI.Controllers.RegistrationController.Register (NayifatAPI) in 17.6424ms
2025-02-01 11:35:36.562 +03:00 [INF] Executed endpoint 'NayifatAPI.Controllers.RegistrationController.Register (NayifatAPI)'
2025-02-01 11:35:36.563 +03:00 [INF] Request finished HTTP/1.1 POST http://187e-51-252-155-185.ngrok-free.app/api/Registration/register - 200 null application/json; charset=utf-8 23.5264ms
2025-02-01 11:36:02.422 +03:00 [INF] Request starting HTTP/1.1 POST http://187e-51-252-155-185.ngrok-free.app/api/Registration/government-data - application/json; charset=utf-8 27
2025-02-01 11:36:02.424 +03:00 [INF] Request finished HTTP/1.1 POST http://187e-51-252-155-185.ngrok-free.app/api/Registration/government-data - 404 0 null 2.6962ms
2025-02-01 11:36:02.426 +03:00 [INF] Request reached the end of the middleware pipeline without being handled by application code. Request path: POST http://187e-51-252-155-185.ngrok-free.app/api/Registration/government-data, Response status code: 404
2025-02-01 11:37:44.785 +03:00 [INF] Request starting HTTP/1.1 POST http://187e-51-252-155-185.ngrok-free.app/api/notifications/list - application/json; charset=utf-8 48
2025-02-01 11:37:44.788 +03:00 [INF] Executing endpoint 'NayifatAPI.Controllers.NotificationsController.GetNotifications (NayifatAPI)'
2025-02-01 11:37:44.789 +03:00 [INF] Route matched with {action = "GetNotifications", controller = "Notifications"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetNotifications(NayifatAPI.Controllers.GetNotificationsRequest) on controller NayifatAPI.Controllers.NotificationsController (NayifatAPI).
2025-02-01 11:37:44.791 +03:00 [INF] Executing BadRequestObjectResult, writing value of type 'Microsoft.AspNetCore.Mvc.ValidationProblemDetails'.
2025-02-01 11:37:44.793 +03:00 [INF] Executed action NayifatAPI.Controllers.NotificationsController.GetNotifications (NayifatAPI) in 2.7982ms
2025-02-01 11:37:44.794 +03:00 [INF] Executed endpoint 'NayifatAPI.Controllers.NotificationsController.GetNotifications (NayifatAPI)'
2025-02-01 11:37:44.795 +03:00 [INF] Request finished HTTP/1.1 POST http://187e-51-252-155-185.ngrok-free.app/api/notifications/list - 400 null application/problem+json; charset=utf-8 10.0611ms
2025-02-01 11:38:09.708 +03:00 [INF] Request starting HTTP/1.1 POST http://187e-51-252-155-185.ngrok-free.app/api/Registration/register - application/json; charset=utf-8 153
2025-02-01 11:38:09.711 +03:00 [INF] Executing endpoint 'NayifatAPI.Controllers.RegistrationController.Register (NayifatAPI)'
2025-02-01 11:38:09.712 +03:00 [INF] Route matched with {action = "Register", controller = "Registration"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] Register(System.Object) on controller NayifatAPI.Controllers.RegistrationController (NayifatAPI).
2025-02-01 11:38:09.718 +03:00 [INF] Executed DbCommand (3ms) [Parameters=[@__providedApiKey_0='?' (Size = 255)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [a].[Key], [a].[CreatedAt], [a].[Description], [a].[ExpiresAt], [a].[IsActive], [a].[LastUsedAt]
FROM [ApiKeys] AS [a]
WHERE [a].[Key] = @__providedApiKey_0 AND [a].[IsActive] = CAST(1 AS bit)
2025-02-01 11:38:09.723 +03:00 [INF] Executed DbCommand (3ms) [Parameters=[@__idCheckRequest_NationalId_0='?' (Size = 450)], CommandType='"Text"', CommandTimeout='30']
SELECT CASE
    WHEN EXISTS (
        SELECT 1
        FROM [Customers] AS [c]
        WHERE [c].[NationalId] = @__idCheckRequest_NationalId_0) THEN CAST(1 AS bit)
    ELSE CAST(0 AS bit)
END
2025-02-01 11:38:09.725 +03:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType9`2[[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Object, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-02-01 11:38:09.727 +03:00 [INF] Executed action NayifatAPI.Controllers.RegistrationController.Register (NayifatAPI) in 13.4539ms
2025-02-01 11:38:09.728 +03:00 [INF] Executed endpoint 'NayifatAPI.Controllers.RegistrationController.Register (NayifatAPI)'
2025-02-01 11:38:09.729 +03:00 [INF] Request finished HTTP/1.1 POST http://187e-51-252-155-185.ngrok-free.app/api/Registration/register - 200 null application/json; charset=utf-8 21.3728ms
2025-02-01 11:38:28.471 +03:00 [INF] Request starting HTTP/1.1 POST http://187e-51-252-155-185.ngrok-free.app/api/Registration/yakeen - application/json; charset=utf-8 68
2025-02-01 11:38:28.474 +03:00 [INF] Request finished HTTP/1.1 POST http://187e-51-252-155-185.ngrok-free.app/api/Registration/yakeen - 404 0 null 3.2748ms
2025-02-01 11:38:28.477 +03:00 [INF] Request reached the end of the middleware pipeline without being handled by application code. Request path: POST http://187e-51-252-155-185.ngrok-free.app/api/Registration/yakeen, Response status code: 404
2025-02-01 11:42:47.151 +03:00 [INF] Request starting HTTP/1.1 POST http://187e-51-252-155-185.ngrok-free.app/api/notifications/list - application/json; charset=utf-8 48
2025-02-01 11:42:47.212 +03:00 [INF] Executing endpoint 'NayifatAPI.Controllers.NotificationsController.GetNotifications (NayifatAPI)'
2025-02-01 11:42:47.237 +03:00 [INF] Route matched with {action = "GetNotifications", controller = "Notifications"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetNotifications(NayifatAPI.Controllers.GetNotificationsRequest) on controller NayifatAPI.Controllers.NotificationsController (NayifatAPI).
2025-02-01 11:42:47.248 +03:00 [INF] Executing BadRequestObjectResult, writing value of type 'Microsoft.AspNetCore.Mvc.ValidationProblemDetails'.
2025-02-01 11:42:47.403 +03:00 [INF] Executed action NayifatAPI.Controllers.NotificationsController.GetNotifications (NayifatAPI) in 160.6066ms
2025-02-01 11:42:47.664 +03:00 [INF] Executed endpoint 'NayifatAPI.Controllers.NotificationsController.GetNotifications (NayifatAPI)'
2025-02-01 11:42:47.666 +03:00 [INF] Request finished HTTP/1.1 POST http://187e-51-252-155-185.ngrok-free.app/api/notifications/list - 400 null application/problem+json; charset=utf-8 514.9016ms
2025-02-01 11:43:18.410 +03:00 [INF] Request starting HTTP/1.1 POST http://187e-51-252-155-185.ngrok-free.app/api/notifications/list - application/json; charset=utf-8 48
2025-02-01 11:43:18.416 +03:00 [INF] Executing endpoint 'NayifatAPI.Controllers.NotificationsController.GetNotifications (NayifatAPI)'
2025-02-01 11:43:18.417 +03:00 [INF] Route matched with {action = "GetNotifications", controller = "Notifications"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetNotifications(NayifatAPI.Controllers.GetNotificationsRequest) on controller NayifatAPI.Controllers.NotificationsController (NayifatAPI).
2025-02-01 11:43:18.419 +03:00 [INF] Executing BadRequestObjectResult, writing value of type 'Microsoft.AspNetCore.Mvc.ValidationProblemDetails'.
2025-02-01 11:43:18.420 +03:00 [INF] Executed action NayifatAPI.Controllers.NotificationsController.GetNotifications (NayifatAPI) in 1.9949ms
2025-02-01 11:43:18.421 +03:00 [INF] Executed endpoint 'NayifatAPI.Controllers.NotificationsController.GetNotifications (NayifatAPI)'
2025-02-01 11:43:18.422 +03:00 [INF] Request finished HTTP/1.1 POST http://187e-51-252-155-185.ngrok-free.app/api/notifications/list - 400 null application/problem+json; charset=utf-8 11.3582ms
2025-02-01 11:43:34.349 +03:00 [INF] Request starting HTTP/1.1 POST http://187e-51-252-155-185.ngrok-free.app/api/Registration/register - application/json; charset=utf-8 153
2025-02-01 11:43:34.353 +03:00 [INF] Executing endpoint 'NayifatAPI.Controllers.RegistrationController.Register (NayifatAPI)'
2025-02-01 11:43:34.353 +03:00 [INF] Route matched with {action = "Register", controller = "Registration"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] Register(System.Object) on controller NayifatAPI.Controllers.RegistrationController (NayifatAPI).
2025-02-01 11:43:34.366 +03:00 [INF] Executed DbCommand (2ms) [Parameters=[@__providedApiKey_0='?' (Size = 255)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [a].[Key], [a].[CreatedAt], [a].[Description], [a].[ExpiresAt], [a].[IsActive], [a].[LastUsedAt]
FROM [ApiKeys] AS [a]
WHERE [a].[Key] = @__providedApiKey_0 AND [a].[IsActive] = CAST(1 AS bit)
2025-02-01 11:43:34.371 +03:00 [INF] Executed DbCommand (2ms) [Parameters=[@__idCheckRequest_NationalId_0='?' (Size = 450)], CommandType='"Text"', CommandTimeout='30']
SELECT CASE
    WHEN EXISTS (
        SELECT 1
        FROM [Customers] AS [c]
        WHERE [c].[NationalId] = @__idCheckRequest_NationalId_0) THEN CAST(1 AS bit)
    ELSE CAST(0 AS bit)
END
2025-02-01 11:43:34.372 +03:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType9`2[[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Object, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-02-01 11:43:34.373 +03:00 [INF] Executed action NayifatAPI.Controllers.RegistrationController.Register (NayifatAPI) in 18.9094ms
2025-02-01 11:43:34.375 +03:00 [INF] Executed endpoint 'NayifatAPI.Controllers.RegistrationController.Register (NayifatAPI)'
2025-02-01 11:43:34.376 +03:00 [INF] Request finished HTTP/1.1 POST http://187e-51-252-155-185.ngrok-free.app/api/Registration/register - 200 null application/json; charset=utf-8 26.7257ms
2025-02-01 11:43:59.653 +03:00 [INF] Request starting HTTP/1.1 POST http://187e-51-252-155-185.ngrok-free.app/api/Yakeen/getCitizenInfo/json - application/json; charset=utf-8 83
2025-02-01 11:43:59.656 +03:00 [INF] Executing endpoint 'NayifatAPI.Controllers.YakeenController.GetCitizenInfo (NayifatAPI)'
2025-02-01 11:43:59.660 +03:00 [INF] Route matched with {action = "GetCitizenInfo", controller = "Yakeen"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.ActionResult`1[NayifatAPI.Models.YakeenCitizenInfo]] GetCitizenInfo(CitizenInfoRequest) on controller NayifatAPI.Controllers.YakeenController (NayifatAPI).
2025-02-01 11:43:59.765 +03:00 [INF] Executed DbCommand (84ms) [Parameters=[@__request_IqamaNumber_0='?' (Size = 50)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [y].[Id], [y].[DateOfBirth], [y].[DateOfBirthHijri], [y].[EnglishFirstName], [y].[EnglishLastName], [y].[EnglishSecondName], [y].[EnglishThirdName], [y].[FamilyName], [y].[FatherName], [y].[FirstName], [y].[Gender], [y].[GenderFieldSpecified], [y].[GrandFatherName], [y].[HifizaIssuePlace], [y].[HifizaNumber], [y].[IdExpiryDate], [y].[IdIssueDate], [y].[IdIssuePlace], [y].[IdVersionNumber], [y].[IqamaNumber], [y].[LogIdField], [y].[NumberOfVehiclesReg], [y].[OccupationCode], [y].[SocialStatusDetailedDesc], [y].[SubtribeName], [y].[TotalNumberOfCurrentDependents]
FROM [YakeenCitizenInfo] AS [y]
WHERE [y].[IqamaNumber] = @__request_IqamaNumber_0
2025-02-01 11:43:59.806 +03:00 [INF] Executing OkObjectResult, writing value of type 'NayifatAPI.Models.YakeenCitizenInfo'.
2025-02-01 11:43:59.812 +03:00 [INF] Executed action NayifatAPI.Controllers.YakeenController.GetCitizenInfo (NayifatAPI) in 150.0555ms
2025-02-01 11:43:59.813 +03:00 [INF] Executed endpoint 'NayifatAPI.Controllers.YakeenController.GetCitizenInfo (NayifatAPI)'
2025-02-01 11:43:59.814 +03:00 [INF] Request finished HTTP/1.1 POST http://187e-51-252-155-185.ngrok-free.app/api/Yakeen/getCitizenInfo/json - 200 null application/json; charset=utf-8 160.6429ms
2025-02-01 11:46:00.099 +03:00 [INF] Request starting HTTP/1.1 POST http://187e-51-252-155-185.ngrok-free.app/api/notifications/list - application/json; charset=utf-8 48
2025-02-01 11:46:00.102 +03:00 [INF] Executing endpoint 'NayifatAPI.Controllers.NotificationsController.GetNotifications (NayifatAPI)'
2025-02-01 11:46:00.103 +03:00 [INF] Route matched with {action = "GetNotifications", controller = "Notifications"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetNotifications(NayifatAPI.Controllers.GetNotificationsRequest) on controller NayifatAPI.Controllers.NotificationsController (NayifatAPI).
2025-02-01 11:46:00.105 +03:00 [INF] Executing BadRequestObjectResult, writing value of type 'Microsoft.AspNetCore.Mvc.ValidationProblemDetails'.
2025-02-01 11:46:00.106 +03:00 [INF] Executed action NayifatAPI.Controllers.NotificationsController.GetNotifications (NayifatAPI) in 2.1574ms
2025-02-01 11:46:00.133 +03:00 [INF] Executed endpoint 'NayifatAPI.Controllers.NotificationsController.GetNotifications (NayifatAPI)'
2025-02-01 11:46:00.406 +03:00 [INF] Request finished HTTP/1.1 POST http://187e-51-252-155-185.ngrok-free.app/api/notifications/list - 400 null application/problem+json; charset=utf-8 306.0827ms
2025-02-01 11:48:20.921 +03:00 [INF] Request starting HTTP/1.1 POST http://187e-51-252-155-185.ngrok-free.app/api/notifications/list - application/json; charset=utf-8 48
2025-02-01 11:48:20.925 +03:00 [INF] Executing endpoint 'NayifatAPI.Controllers.NotificationsController.GetNotifications (NayifatAPI)'
2025-02-01 11:48:20.927 +03:00 [INF] Route matched with {action = "GetNotifications", controller = "Notifications"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetNotifications(NayifatAPI.Controllers.GetNotificationsRequest) on controller NayifatAPI.Controllers.NotificationsController (NayifatAPI).
2025-02-01 11:48:20.930 +03:00 [INF] Executing BadRequestObjectResult, writing value of type 'Microsoft.AspNetCore.Mvc.ValidationProblemDetails'.
2025-02-01 11:48:20.932 +03:00 [INF] Executed action NayifatAPI.Controllers.NotificationsController.GetNotifications (NayifatAPI) in 3.0689ms
2025-02-01 11:48:20.934 +03:00 [INF] Executed endpoint 'NayifatAPI.Controllers.NotificationsController.GetNotifications (NayifatAPI)'
2025-02-01 11:48:20.935 +03:00 [INF] Request finished HTTP/1.1 POST http://187e-51-252-155-185.ngrok-free.app/api/notifications/list - 400 null application/problem+json; charset=utf-8 14.4318ms
2025-02-01 11:50:41.314 +03:00 [INF] Request starting HTTP/1.1 POST http://187e-51-252-155-185.ngrok-free.app/api/Registration/register - application/json; charset=utf-8 153
2025-02-01 11:50:41.459 +03:00 [INF] Executing endpoint 'NayifatAPI.Controllers.RegistrationController.Register (NayifatAPI)'
2025-02-01 11:50:41.461 +03:00 [INF] Route matched with {action = "Register", controller = "Registration"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] Register(System.Object) on controller NayifatAPI.Controllers.RegistrationController (NayifatAPI).
2025-02-01 11:50:41.565 +03:00 [INF] Executed DbCommand (97ms) [Parameters=[@__providedApiKey_0='?' (Size = 255)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [a].[Key], [a].[CreatedAt], [a].[Description], [a].[ExpiresAt], [a].[IsActive], [a].[LastUsedAt]
FROM [ApiKeys] AS [a]
WHERE [a].[Key] = @__providedApiKey_0 AND [a].[IsActive] = CAST(1 AS bit)
2025-02-01 11:50:41.755 +03:00 [INF] Executed DbCommand (186ms) [Parameters=[@__idCheckRequest_NationalId_0='?' (Size = 450)], CommandType='"Text"', CommandTimeout='30']
SELECT CASE
    WHEN EXISTS (
        SELECT 1
        FROM [Customers] AS [c]
        WHERE [c].[NationalId] = @__idCheckRequest_NationalId_0) THEN CAST(1 AS bit)
    ELSE CAST(0 AS bit)
END
2025-02-01 11:50:41.761 +03:00 [INF] Executing ObjectResult, writing value of type '<>f__AnonymousType11`2[[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-02-01 11:50:41.765 +03:00 [INF] Executed action NayifatAPI.Controllers.RegistrationController.Register (NayifatAPI) in 302.9426ms
2025-02-01 11:50:41.981 +03:00 [INF] Executed endpoint 'NayifatAPI.Controllers.RegistrationController.Register (NayifatAPI)'
2025-02-01 11:50:41.983 +03:00 [INF] Request finished HTTP/1.1 POST http://187e-51-252-155-185.ngrok-free.app/api/Registration/register - 400 null application/json; charset=utf-8 669.427ms
2025-02-01 11:50:50.209 +03:00 [INF] Request starting HTTP/1.1 POST http://187e-51-252-155-185.ngrok-free.app/api/notifications/list - application/json; charset=utf-8 48
2025-02-01 11:50:50.214 +03:00 [INF] Executing endpoint 'NayifatAPI.Controllers.NotificationsController.GetNotifications (NayifatAPI)'
2025-02-01 11:50:50.215 +03:00 [INF] Route matched with {action = "GetNotifications", controller = "Notifications"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetNotifications(NayifatAPI.Controllers.GetNotificationsRequest) on controller NayifatAPI.Controllers.NotificationsController (NayifatAPI).
2025-02-01 11:50:50.218 +03:00 [INF] Executing BadRequestObjectResult, writing value of type 'Microsoft.AspNetCore.Mvc.ValidationProblemDetails'.
2025-02-01 11:50:50.219 +03:00 [INF] Executed action NayifatAPI.Controllers.NotificationsController.GetNotifications (NayifatAPI) in 1.8326ms
2025-02-01 11:50:50.221 +03:00 [INF] Executed endpoint 'NayifatAPI.Controllers.NotificationsController.GetNotifications (NayifatAPI)'
2025-02-01 11:50:50.223 +03:00 [INF] Request finished HTTP/1.1 POST http://187e-51-252-155-185.ngrok-free.app/api/notifications/list - 400 null application/problem+json; charset=utf-8 14.0291ms
2025-02-01 11:51:01.125 +03:00 [INF] Request starting HTTP/1.1 POST http://187e-51-252-155-185.ngrok-free.app/api/notifications/list - application/json; charset=utf-8 48
2025-02-01 11:51:01.127 +03:00 [INF] Executing endpoint 'NayifatAPI.Controllers.NotificationsController.GetNotifications (NayifatAPI)'
2025-02-01 11:51:01.128 +03:00 [INF] Route matched with {action = "GetNotifications", controller = "Notifications"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GetNotifications(NayifatAPI.Controllers.GetNotificationsRequest) on controller NayifatAPI.Controllers.NotificationsController (NayifatAPI).
2025-02-01 11:51:01.130 +03:00 [INF] Executing BadRequestObjectResult, writing value of type 'Microsoft.AspNetCore.Mvc.ValidationProblemDetails'.
2025-02-01 11:51:01.131 +03:00 [INF] Executed action NayifatAPI.Controllers.NotificationsController.GetNotifications (NayifatAPI) in 1.6782ms
2025-02-01 11:51:01.132 +03:00 [INF] Executed endpoint 'NayifatAPI.Controllers.NotificationsController.GetNotifications (NayifatAPI)'
2025-02-01 11:51:01.133 +03:00 [INF] Request finished HTTP/1.1 POST http://187e-51-252-155-185.ngrok-free.app/api/notifications/list - 400 null application/problem+json; charset=utf-8 7.5137ms
2025-02-01 13:29:32.350 +03:00 [INF] Request starting HTTP/1.1 POST http://187e-51-252-155-185.ngrok-free.app/api/Registration/register/check - application/json; charset=utf-8 28
2025-02-01 13:29:32.364 +03:00 [INF] Request finished HTTP/1.1 POST http://187e-51-252-155-185.ngrok-free.app/api/Registration/register/check - 404 0 null 13.8774ms
2025-02-01 13:29:32.368 +03:00 [INF] Request reached the end of the middleware pipeline without being handled by application code. Request path: POST http://187e-51-252-155-185.ngrok-free.app/api/Registration/register/check, Response status code: 404
2025-02-01 13:29:59.443 +03:00 [INF] Request starting HTTP/1.1 POST http://187e-51-252-155-185.ngrok-free.app/api/Registration/register/check - application/json; charset=utf-8 28
2025-02-01 13:29:59.447 +03:00 [INF] Request finished HTTP/1.1 POST http://187e-51-252-155-185.ngrok-free.app/api/Registration/register/check - 404 0 null 4.1473ms
2025-02-01 13:29:59.468 +03:00 [INF] Request reached the end of the middleware pipeline without being handled by application code. Request path: POST http://187e-51-252-155-185.ngrok-free.app/api/Registration/register/check, Response status code: 404
2025-02-01 13:30:11.177 +03:00 [INF] Request starting HTTP/1.1 POST http://187e-51-252-155-185.ngrok-free.app/api/Registration/register/check - application/json; charset=utf-8 28
2025-02-01 13:30:15.167 +03:00 [INF] Request finished HTTP/1.1 POST http://187e-51-252-155-185.ngrok-free.app/api/Registration/register/check - 404 0 null 3990.3409ms
2025-02-01 13:30:15.177 +03:00 [INF] Request reached the end of the middleware pipeline without being handled by application code. Request path: POST http://187e-51-252-155-185.ngrok-free.app/api/Registration/register/check, Response status code: 404
2025-02-01 15:06:23.135 +03:00 [INF] Request starting HTTP/1.1 POST http://187e-51-252-155-185.ngrok-free.app/api/auth/auth/validate-identity - application/json; charset=utf-8 39
2025-02-01 15:06:23.144 +03:00 [INF] Request finished HTTP/1.1 POST http://187e-51-252-155-185.ngrok-free.app/api/auth/auth/validate-identity - 404 0 null 9.1158ms
2025-02-01 15:06:23.150 +03:00 [INF] Request reached the end of the middleware pipeline without being handled by application code. Request path: POST http://187e-51-252-155-185.ngrok-free.app/api/auth/auth/validate-identity, Response status code: 404
2025-02-01 15:15:44.398 +03:00 [INF] Request starting HTTP/1.1 POST http://187e-51-252-155-185.ngrok-free.app/api/api/registration/register - application/json; charset=utf-8 44
2025-02-01 15:15:44.402 +03:00 [INF] Request finished HTTP/1.1 POST http://187e-51-252-155-185.ngrok-free.app/api/api/registration/register - 404 0 null 4.0503ms
2025-02-01 15:15:44.405 +03:00 [INF] Request reached the end of the middleware pipeline without being handled by application code. Request path: POST http://187e-51-252-155-185.ngrok-free.app/api/api/registration/register, Response status code: 404
2025-02-01 15:21:49.492 +03:00 [INF] Request starting HTTP/1.1 POST http://187e-51-252-155-185.ngrok-free.app/api/Registration/register - application/json; charset=utf-8 44
2025-02-01 15:21:49.498 +03:00 [INF] Executing endpoint 'NayifatAPI.Controllers.RegistrationController.Register (NayifatAPI)'
2025-02-01 15:21:49.501 +03:00 [INF] Route matched with {action = "Register", controller = "Registration"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] Register(System.Object) on controller NayifatAPI.Controllers.RegistrationController (NayifatAPI).
2025-02-01 15:21:49.540 +03:00 [INF] Executed DbCommand (18ms) [Parameters=[@__providedApiKey_0='?' (Size = 255)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [a].[Key], [a].[CreatedAt], [a].[Description], [a].[ExpiresAt], [a].[IsActive], [a].[LastUsedAt]
FROM [ApiKeys] AS [a]
WHERE [a].[Key] = @__providedApiKey_0 AND [a].[IsActive] = CAST(1 AS bit)
2025-02-01 15:21:49.546 +03:00 [ERR] Error during registration for National ID: null
System.Text.Json.JsonException: JSON deserialization for type 'NayifatAPI.Controllers.IdCheckRequest' was missing required properties, including the following: DeviceInfo
   at System.Text.Json.ThrowHelper.ThrowJsonException_JsonRequiredPropertyMissing(JsonTypeInfo parent, BitArray requiredPropertiesSet)
   at System.Text.Json.Serialization.Converters.ObjectDefaultConverter`1.OnTryRead(Utf8JsonReader& reader, Type typeToConvert, JsonSerializerOptions options, ReadStack& state, T& value)
   at System.Text.Json.Serialization.JsonConverter`1.TryRead(Utf8JsonReader& reader, Type typeToConvert, JsonSerializerOptions options, ReadStack& state, T& value, Boolean& isPopulatedValue)
   at System.Text.Json.Serialization.JsonConverter`1.ReadCore(Utf8JsonReader& reader, JsonSerializerOptions options, ReadStack& state)
   at System.Text.Json.JsonSerializer.ReadFromSpan[TValue](ReadOnlySpan`1 utf8Json, JsonTypeInfo`1 jsonTypeInfo, Nullable`1 actualByteCount)
   at System.Text.Json.JsonSerializer.ReadFromSpan[TValue](ReadOnlySpan`1 json, JsonTypeInfo`1 jsonTypeInfo)
   at System.Text.Json.JsonSerializer.Deserialize[TValue](String json, JsonSerializerOptions options)
   at NayifatAPI.Controllers.RegistrationController.Register(Object request) in C:\Users\yamta\StudioProjects\nayifat_app_2025_new\NayifatAPI\Controllers\RegistrationController.cs:line 52
2025-02-01 15:21:49.577 +03:00 [INF] Executing ObjectResult, writing value of type '<>f__AnonymousType11`2[[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-02-01 15:21:49.579 +03:00 [INF] Executed action NayifatAPI.Controllers.RegistrationController.Register (NayifatAPI) in 76.112ms
2025-02-01 15:21:49.580 +03:00 [INF] Executed endpoint 'NayifatAPI.Controllers.RegistrationController.Register (NayifatAPI)'
2025-02-01 15:21:49.581 +03:00 [INF] Request finished HTTP/1.1 POST http://187e-51-252-155-185.ngrok-free.app/api/Registration/register - 500 null application/json; charset=utf-8 88.2767ms
2025-02-01 15:42:04.102 +03:00 [INF] Request starting HTTP/1.1 POST http://187e-51-252-155-185.ngrok-free.app/api/Registration/register - application/json; charset=utf-8 153
2025-02-01 15:42:04.105 +03:00 [INF] Executing endpoint 'NayifatAPI.Controllers.RegistrationController.Register (NayifatAPI)'
2025-02-01 15:42:04.109 +03:00 [INF] Route matched with {action = "Register", controller = "Registration"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] Register(System.Object) on controller NayifatAPI.Controllers.RegistrationController (NayifatAPI).
2025-02-01 15:42:04.204 +03:00 [INF] Executed DbCommand (81ms) [Parameters=[@__providedApiKey_0='?' (Size = 255)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [a].[Key], [a].[CreatedAt], [a].[Description], [a].[ExpiresAt], [a].[IsActive], [a].[LastUsedAt]
FROM [ApiKeys] AS [a]
WHERE [a].[Key] = @__providedApiKey_0 AND [a].[IsActive] = CAST(1 AS bit)
2025-02-01 15:42:04.221 +03:00 [INF] Executed DbCommand (13ms) [Parameters=[@__idCheckRequest_NationalId_0='?' (Size = 450)], CommandType='"Text"', CommandTimeout='30']
SELECT CASE
    WHEN EXISTS (
        SELECT 1
        FROM [Customers] AS [c]
        WHERE [c].[NationalId] = @__idCheckRequest_NationalId_0) THEN CAST(1 AS bit)
    ELSE CAST(0 AS bit)
END
2025-02-01 15:42:04.225 +03:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType9`2[[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Object, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-02-01 15:42:04.227 +03:00 [INF] Executed action NayifatAPI.Controllers.RegistrationController.Register (NayifatAPI) in 111.2128ms
2025-02-01 15:42:04.229 +03:00 [INF] Executed endpoint 'NayifatAPI.Controllers.RegistrationController.Register (NayifatAPI)'
2025-02-01 15:42:04.230 +03:00 [INF] Request finished HTTP/1.1 POST http://187e-51-252-155-185.ngrok-free.app/api/Registration/register - 200 null application/json; charset=utf-8 127.8581ms
2025-02-01 15:42:05.248 +03:00 [INF] Request starting HTTP/1.1 POST http://187e-51-252-155-185.ngrok-free.app/api/auth/otp/generate - application/x-www-form-urlencoded; charset=utf-8 22
2025-02-01 15:42:05.251 +03:00 [INF] Executing endpoint 'NayifatAPI.Controllers.AuthController.GenerateOtp (NayifatAPI)'
2025-02-01 15:42:05.259 +03:00 [INF] Route matched with {action = "GenerateOtp", controller = "Auth"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GenerateOtp(NayifatAPI.Controllers.OtpGenerateRequest) on controller NayifatAPI.Controllers.AuthController (NayifatAPI).
2025-02-01 15:42:05.276 +03:00 [INF] Executing ObjectResult, writing value of type 'Microsoft.AspNetCore.Mvc.ProblemDetails'.
2025-02-01 15:42:05.279 +03:00 [INF] Executed action NayifatAPI.Controllers.AuthController.GenerateOtp (NayifatAPI) in 18.6315ms
2025-02-01 15:42:05.281 +03:00 [INF] Executed endpoint 'NayifatAPI.Controllers.AuthController.GenerateOtp (NayifatAPI)'
2025-02-01 15:42:05.281 +03:00 [INF] Request finished HTTP/1.1 POST http://187e-51-252-155-185.ngrok-free.app/api/auth/otp/generate - 415 null application/problem+json; charset=utf-8 33.8015ms
2025-02-01 17:26:38.698 +03:00 [INF] Request starting HTTP/1.1 POST http://187e-51-252-155-185.ngrok-free.app/api/Registration/register - application/json; charset=utf-8 153
2025-02-01 17:26:38.700 +03:00 [INF] Executing endpoint 'NayifatAPI.Controllers.RegistrationController.Register (NayifatAPI)'
2025-02-01 17:26:38.701 +03:00 [INF] Route matched with {action = "Register", controller = "Registration"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] Register(System.Object) on controller NayifatAPI.Controllers.RegistrationController (NayifatAPI).
2025-02-01 17:26:38.797 +03:00 [INF] Executed DbCommand (81ms) [Parameters=[@__providedApiKey_0='?' (Size = 255)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [a].[Key], [a].[CreatedAt], [a].[Description], [a].[ExpiresAt], [a].[IsActive], [a].[LastUsedAt]
FROM [ApiKeys] AS [a]
WHERE [a].[Key] = @__providedApiKey_0 AND [a].[IsActive] = CAST(1 AS bit)
2025-02-01 17:26:38.807 +03:00 [INF] Executed DbCommand (4ms) [Parameters=[@__idCheckRequest_NationalId_0='?' (Size = 450)], CommandType='"Text"', CommandTimeout='30']
SELECT CASE
    WHEN EXISTS (
        SELECT 1
        FROM [Customers] AS [c]
        WHERE [c].[NationalId] = @__idCheckRequest_NationalId_0) THEN CAST(1 AS bit)
    ELSE CAST(0 AS bit)
END
2025-02-01 17:26:38.809 +03:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType9`2[[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Object, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-02-01 17:26:38.810 +03:00 [INF] Executed action NayifatAPI.Controllers.RegistrationController.Register (NayifatAPI) in 105.7005ms
2025-02-01 17:26:38.811 +03:00 [INF] Executed endpoint 'NayifatAPI.Controllers.RegistrationController.Register (NayifatAPI)'
2025-02-01 17:26:38.811 +03:00 [INF] Request finished HTTP/1.1 POST http://187e-51-252-155-185.ngrok-free.app/api/Registration/register - 200 null application/json; charset=utf-8 113.1891ms
2025-02-01 17:26:39.449 +03:00 [INF] Request starting HTTP/1.1 POST http://187e-51-252-155-185.ngrok-free.app/api/auth/otp/generate - application/x-www-form-urlencoded; charset=utf-8 22
2025-02-01 17:26:39.451 +03:00 [INF] Executing endpoint 'NayifatAPI.Controllers.AuthController.GenerateOtp (NayifatAPI)'
2025-02-01 17:26:39.452 +03:00 [INF] Route matched with {action = "GenerateOtp", controller = "Auth"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] GenerateOtp(NayifatAPI.Controllers.OtpGenerateRequest) on controller NayifatAPI.Controllers.AuthController (NayifatAPI).
2025-02-01 17:26:39.455 +03:00 [INF] Executing ObjectResult, writing value of type 'Microsoft.AspNetCore.Mvc.ProblemDetails'.
2025-02-01 17:26:39.456 +03:00 [INF] Executed action NayifatAPI.Controllers.AuthController.GenerateOtp (NayifatAPI) in 2.7821ms
2025-02-01 17:26:39.457 +03:00 [INF] Executed endpoint 'NayifatAPI.Controllers.AuthController.GenerateOtp (NayifatAPI)'
2025-02-01 17:26:39.458 +03:00 [INF] Request finished HTTP/1.1 POST http://187e-51-252-155-185.ngrok-free.app/api/auth/otp/generate - 415 null application/problem+json; charset=utf-8 9.2597ms
2025-02-01 17:38:23.333 +03:00 [INF] Request starting HTTP/1.1 POST http://187e-51-252-155-185.ngrok-free.app/api/Registration/register - application/json; charset=utf-8 153
2025-02-01 17:38:23.336 +03:00 [INF] Executing endpoint 'NayifatAPI.Controllers.RegistrationController.Register (NayifatAPI)'
2025-02-01 17:38:23.337 +03:00 [INF] Route matched with {action = "Register", controller = "Registration"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] Register(System.Object) on controller NayifatAPI.Controllers.RegistrationController (NayifatAPI).
2025-02-01 17:38:23.345 +03:00 [INF] Executed DbCommand (2ms) [Parameters=[@__providedApiKey_0='?' (Size = 255)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [a].[Key], [a].[CreatedAt], [a].[Description], [a].[ExpiresAt], [a].[IsActive], [a].[LastUsedAt]
FROM [ApiKeys] AS [a]
WHERE [a].[Key] = @__providedApiKey_0 AND [a].[IsActive] = CAST(1 AS bit)
2025-02-01 17:38:23.349 +03:00 [INF] Executed DbCommand (2ms) [Parameters=[@__idCheckRequest_NationalId_0='?' (Size = 450)], CommandType='"Text"', CommandTimeout='30']
SELECT CASE
    WHEN EXISTS (
        SELECT 1
        FROM [Customers] AS [c]
        WHERE [c].[NationalId] = @__idCheckRequest_NationalId_0) THEN CAST(1 AS bit)
    ELSE CAST(0 AS bit)
END
2025-02-01 17:38:23.352 +03:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType9`2[[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Object, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-02-01 17:38:23.353 +03:00 [INF] Executed action NayifatAPI.Controllers.RegistrationController.Register (NayifatAPI) in 14.7346ms
2025-02-01 17:38:23.353 +03:00 [INF] Executed endpoint 'NayifatAPI.Controllers.RegistrationController.Register (NayifatAPI)'
2025-02-01 17:38:23.354 +03:00 [INF] Request finished HTTP/1.1 POST http://187e-51-252-155-185.ngrok-free.app/api/Registration/register - 200 null application/json; charset=utf-8 20.7541ms
2025-02-01 17:40:41.553 +03:00 [INF] Request starting HTTP/1.1 POST http://187e-51-252-155-185.ngrok-free.app/api/Registration/register - application/json; charset=utf-8 153
2025-02-01 17:40:41.559 +03:00 [INF] Executing endpoint 'NayifatAPI.Controllers.RegistrationController.Register (NayifatAPI)'
2025-02-01 17:40:41.561 +03:00 [INF] Route matched with {action = "Register", controller = "Registration"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] Register(System.Object) on controller NayifatAPI.Controllers.RegistrationController (NayifatAPI).
2025-02-01 17:40:41.568 +03:00 [INF] Executed DbCommand (2ms) [Parameters=[@__providedApiKey_0='?' (Size = 255)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [a].[Key], [a].[CreatedAt], [a].[Description], [a].[ExpiresAt], [a].[IsActive], [a].[LastUsedAt]
FROM [ApiKeys] AS [a]
WHERE [a].[Key] = @__providedApiKey_0 AND [a].[IsActive] = CAST(1 AS bit)
2025-02-01 17:40:41.577 +03:00 [INF] Executed DbCommand (5ms) [Parameters=[@__idCheckRequest_NationalId_0='?' (Size = 450)], CommandType='"Text"', CommandTimeout='30']
SELECT CASE
    WHEN EXISTS (
        SELECT 1
        FROM [Customers] AS [c]
        WHERE [c].[NationalId] = @__idCheckRequest_NationalId_0) THEN CAST(1 AS bit)
    ELSE CAST(0 AS bit)
END
2025-02-01 17:40:41.579 +03:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType9`2[[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Object, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-02-01 17:40:41.580 +03:00 [INF] Executed action NayifatAPI.Controllers.RegistrationController.Register (NayifatAPI) in 17.3394ms
2025-02-01 17:40:41.581 +03:00 [INF] Executed endpoint 'NayifatAPI.Controllers.RegistrationController.Register (NayifatAPI)'
2025-02-01 17:40:41.582 +03:00 [INF] Request finished HTTP/1.1 POST http://187e-51-252-155-185.ngrok-free.app/api/Registration/register - 200 null application/json; charset=utf-8 29.583ms
2025-02-01 17:43:28.428 +03:00 [INF] Request starting HTTP/1.1 GET http://187e-51-252-155-185.ngrok-free.app/ - null null
2025-02-01 17:43:28.437 +03:00 [INF] Request finished HTTP/1.1 GET http://187e-51-252-155-185.ngrok-free.app/ - 301 0 null 8.3037ms
2025-02-01 17:43:28.992 +03:00 [INF] Request starting HTTP/1.1 GET http://187e-51-252-155-185.ngrok-free.app/index.html - null null
2025-02-01 17:43:28.999 +03:00 [INF] Request finished HTTP/1.1 GET http://187e-51-252-155-185.ngrok-free.app/index.html - 200 null text/html;charset=utf-8 7.0444ms
2025-02-01 17:45:46.021 +03:00 [INF] Request starting HTTP/1.1 POST http://187e-51-252-155-185.ngrok-free.app/api/Registration/register - application/json; charset=utf-8 153
2025-02-01 17:45:46.023 +03:00 [INF] Executing endpoint 'NayifatAPI.Controllers.RegistrationController.Register (NayifatAPI)'
2025-02-01 17:45:46.024 +03:00 [INF] Route matched with {action = "Register", controller = "Registration"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] Register(System.Object) on controller NayifatAPI.Controllers.RegistrationController (NayifatAPI).
2025-02-01 17:45:46.032 +03:00 [INF] Executed DbCommand (2ms) [Parameters=[@__providedApiKey_0='?' (Size = 255)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [a].[Key], [a].[CreatedAt], [a].[Description], [a].[ExpiresAt], [a].[IsActive], [a].[LastUsedAt]
FROM [ApiKeys] AS [a]
WHERE [a].[Key] = @__providedApiKey_0 AND [a].[IsActive] = CAST(1 AS bit)
2025-02-01 17:45:46.036 +03:00 [INF] Executed DbCommand (2ms) [Parameters=[@__idCheckRequest_NationalId_0='?' (Size = 450)], CommandType='"Text"', CommandTimeout='30']
SELECT CASE
    WHEN EXISTS (
        SELECT 1
        FROM [Customers] AS [c]
        WHERE [c].[NationalId] = @__idCheckRequest_NationalId_0) THEN CAST(1 AS bit)
    ELSE CAST(0 AS bit)
END
2025-02-01 17:45:46.038 +03:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType9`2[[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Object, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-02-01 17:45:46.039 +03:00 [INF] Executed action NayifatAPI.Controllers.RegistrationController.Register (NayifatAPI) in 13.3714ms
2025-02-01 17:45:46.040 +03:00 [INF] Executed endpoint 'NayifatAPI.Controllers.RegistrationController.Register (NayifatAPI)'
2025-02-01 17:45:46.041 +03:00 [INF] Request finished HTTP/1.1 POST http://187e-51-252-155-185.ngrok-free.app/api/Registration/register - 200 null application/json; charset=utf-8 20.1791ms
2025-02-01 17:48:23.272 +03:00 [INF] Request starting HTTP/1.1 POST http://187e-51-252-155-185.ngrok-free.app/api/Registration/register - application/json; charset=utf-8 153
2025-02-01 17:48:23.279 +03:00 [INF] Executing endpoint 'NayifatAPI.Controllers.RegistrationController.Register (NayifatAPI)'
2025-02-01 17:48:23.280 +03:00 [INF] Route matched with {action = "Register", controller = "Registration"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] Register(System.Object) on controller NayifatAPI.Controllers.RegistrationController (NayifatAPI).
2025-02-01 17:48:23.285 +03:00 [INF] Executed DbCommand (2ms) [Parameters=[@__providedApiKey_0='?' (Size = 255)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [a].[Key], [a].[CreatedAt], [a].[Description], [a].[ExpiresAt], [a].[IsActive], [a].[LastUsedAt]
FROM [ApiKeys] AS [a]
WHERE [a].[Key] = @__providedApiKey_0 AND [a].[IsActive] = CAST(1 AS bit)
2025-02-01 17:48:23.293 +03:00 [INF] Executed DbCommand (2ms) [Parameters=[@__idCheckRequest_NationalId_0='?' (Size = 450)], CommandType='"Text"', CommandTimeout='30']
SELECT CASE
    WHEN EXISTS (
        SELECT 1
        FROM [Customers] AS [c]
        WHERE [c].[NationalId] = @__idCheckRequest_NationalId_0) THEN CAST(1 AS bit)
    ELSE CAST(0 AS bit)
END
2025-02-01 17:48:23.294 +03:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType9`2[[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Object, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-02-01 17:48:23.295 +03:00 [INF] Executed action NayifatAPI.Controllers.RegistrationController.Register (NayifatAPI) in 14.2363ms
2025-02-01 17:48:23.296 +03:00 [INF] Executed endpoint 'NayifatAPI.Controllers.RegistrationController.Register (NayifatAPI)'
2025-02-01 17:48:23.297 +03:00 [INF] Request finished HTTP/1.1 POST http://187e-51-252-155-185.ngrok-free.app/api/Registration/register - 200 null application/json; charset=utf-8 24.6545ms
2025-02-01 17:51:43.875 +03:00 [INF] Request starting HTTP/1.1 POST http://187e-51-252-155-185.ngrok-free.app/api/Registration/register - application/json; charset=utf-8 153
2025-02-01 17:51:43.878 +03:00 [INF] Executing endpoint 'NayifatAPI.Controllers.RegistrationController.Register (NayifatAPI)'
2025-02-01 17:51:43.881 +03:00 [INF] Route matched with {action = "Register", controller = "Registration"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] Register(System.Object) on controller NayifatAPI.Controllers.RegistrationController (NayifatAPI).
2025-02-01 17:51:43.887 +03:00 [INF] Executed DbCommand (2ms) [Parameters=[@__providedApiKey_0='?' (Size = 255)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [a].[Key], [a].[CreatedAt], [a].[Description], [a].[ExpiresAt], [a].[IsActive], [a].[LastUsedAt]
FROM [ApiKeys] AS [a]
WHERE [a].[Key] = @__providedApiKey_0 AND [a].[IsActive] = CAST(1 AS bit)
2025-02-01 17:51:43.892 +03:00 [INF] Executed DbCommand (2ms) [Parameters=[@__idCheckRequest_NationalId_0='?' (Size = 450)], CommandType='"Text"', CommandTimeout='30']
SELECT CASE
    WHEN EXISTS (
        SELECT 1
        FROM [Customers] AS [c]
        WHERE [c].[NationalId] = @__idCheckRequest_NationalId_0) THEN CAST(1 AS bit)
    ELSE CAST(0 AS bit)
END
2025-02-01 17:51:43.894 +03:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType9`2[[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Object, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-02-01 17:51:43.895 +03:00 [INF] Executed action NayifatAPI.Controllers.RegistrationController.Register (NayifatAPI) in 12.4714ms
2025-02-01 17:51:43.896 +03:00 [INF] Executed endpoint 'NayifatAPI.Controllers.RegistrationController.Register (NayifatAPI)'
2025-02-01 17:51:43.897 +03:00 [INF] Request finished HTTP/1.1 POST http://187e-51-252-155-185.ngrok-free.app/api/Registration/register - 200 null application/json; charset=utf-8 22.3083ms
2025-02-01 17:55:09.358 +03:00 [INF] Request starting HTTP/1.1 POST http://187e-51-252-155-185.ngrok-free.app/api/Registration/register - application/json; charset=utf-8 153
2025-02-01 17:55:09.359 +03:00 [INF] Executing endpoint 'NayifatAPI.Controllers.RegistrationController.Register (NayifatAPI)'
2025-02-01 17:55:09.360 +03:00 [INF] Route matched with {action = "Register", controller = "Registration"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] Register(System.Object) on controller NayifatAPI.Controllers.RegistrationController (NayifatAPI).
2025-02-01 17:55:09.365 +03:00 [INF] Executed DbCommand (2ms) [Parameters=[@__providedApiKey_0='?' (Size = 255)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [a].[Key], [a].[CreatedAt], [a].[Description], [a].[ExpiresAt], [a].[IsActive], [a].[LastUsedAt]
FROM [ApiKeys] AS [a]
WHERE [a].[Key] = @__providedApiKey_0 AND [a].[IsActive] = CAST(1 AS bit)
2025-02-01 17:55:09.369 +03:00 [INF] Executed DbCommand (2ms) [Parameters=[@__idCheckRequest_NationalId_0='?' (Size = 450)], CommandType='"Text"', CommandTimeout='30']
SELECT CASE
    WHEN EXISTS (
        SELECT 1
        FROM [Customers] AS [c]
        WHERE [c].[NationalId] = @__idCheckRequest_NationalId_0) THEN CAST(1 AS bit)
    ELSE CAST(0 AS bit)
END
2025-02-01 17:55:09.371 +03:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType9`2[[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Object, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-02-01 17:55:09.372 +03:00 [INF] Executed action NayifatAPI.Controllers.RegistrationController.Register (NayifatAPI) in 11.3242ms
2025-02-01 17:55:09.374 +03:00 [INF] Executed endpoint 'NayifatAPI.Controllers.RegistrationController.Register (NayifatAPI)'
2025-02-01 17:55:09.374 +03:00 [INF] Request finished HTTP/1.1 POST http://187e-51-252-155-185.ngrok-free.app/api/Registration/register - 200 null application/json; charset=utf-8 16.6393ms
2025-02-01 17:58:11.112 +03:00 [INF] Request starting HTTP/1.1 POST http://187e-51-252-155-185.ngrok-free.app/api/Registration/register - application/json; charset=utf-8 153
2025-02-01 17:58:11.117 +03:00 [INF] Executing endpoint 'NayifatAPI.Controllers.RegistrationController.Register (NayifatAPI)'
2025-02-01 17:58:11.119 +03:00 [INF] Route matched with {action = "Register", controller = "Registration"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] Register(System.Object) on controller NayifatAPI.Controllers.RegistrationController (NayifatAPI).
2025-02-01 17:58:11.126 +03:00 [INF] Executed DbCommand (3ms) [Parameters=[@__providedApiKey_0='?' (Size = 255)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [a].[Key], [a].[CreatedAt], [a].[Description], [a].[ExpiresAt], [a].[IsActive], [a].[LastUsedAt]
FROM [ApiKeys] AS [a]
WHERE [a].[Key] = @__providedApiKey_0 AND [a].[IsActive] = CAST(1 AS bit)
2025-02-01 17:58:11.135 +03:00 [INF] Executed DbCommand (3ms) [Parameters=[@__idCheckRequest_NationalId_0='?' (Size = 450)], CommandType='"Text"', CommandTimeout='30']
SELECT CASE
    WHEN EXISTS (
        SELECT 1
        FROM [Customers] AS [c]
        WHERE [c].[NationalId] = @__idCheckRequest_NationalId_0) THEN CAST(1 AS bit)
    ELSE CAST(0 AS bit)
END
2025-02-01 17:58:11.137 +03:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType9`2[[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Object, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-02-01 17:58:11.139 +03:00 [INF] Executed action NayifatAPI.Controllers.RegistrationController.Register (NayifatAPI) in 17.9275ms
2025-02-01 17:58:11.141 +03:00 [INF] Executed endpoint 'NayifatAPI.Controllers.RegistrationController.Register (NayifatAPI)'
2025-02-01 17:58:11.144 +03:00 [INF] Request finished HTTP/1.1 POST http://187e-51-252-155-185.ngrok-free.app/api/Registration/register - 200 null application/json; charset=utf-8 31.5991ms
2025-02-01 17:59:06.049 +03:00 [INF] Request starting HTTP/1.1 POST http://187e-51-252-155-185.ngrok-free.app/api/proxy/forward?url=https://icreditdept.com/api/testasp/test_local_generate_otp.php - application/json 89
2025-02-01 17:59:06.052 +03:00 [INF] Executing endpoint 'NayifatAPI.Controllers.ProxyController.ForwardRequest (NayifatAPI)'
2025-02-01 17:59:06.061 +03:00 [INF] Route matched with {action = "ForwardRequest", controller = "Proxy"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] ForwardRequest() on controller NayifatAPI.Controllers.ProxyController (NayifatAPI).
2025-02-01 17:59:06.092 +03:00 [INF] Start processing HTTP request POST https://icreditdept.com/api/testasp/test_local_generate_otp.php
2025-02-01 17:59:06.095 +03:00 [INF] Sending HTTP request POST https://icreditdept.com/api/testasp/test_local_generate_otp.php
2025-02-01 17:59:09.408 +03:00 [INF] Received HTTP response headers after 3306.6954ms - 200
2025-02-01 17:59:09.412 +03:00 [INF] End processing HTTP request after 3321.2453ms - 200
2025-02-01 17:59:09.422 +03:00 [INF] Raw response length: 200
2025-02-01 17:59:09.424 +03:00 [INF] Response content: {"success":true,"errors":[],"result":{"nationalId":"1064448614","otp":296460,"expiryDate":"2025-02-01 18:04:09","successMsg":"Success","errCode":0,"errMsg":null},"type":"N","message":null,"code":null}
2025-02-01 17:59:09.429 +03:00 [INF] Executing ContentResult with HTTP Response ContentType of application/json
2025-02-01 17:59:09.433 +03:00 [INF] Executed action NayifatAPI.Controllers.ProxyController.ForwardRequest (NayifatAPI) in 3369.9411ms
2025-02-01 17:59:09.437 +03:00 [INF] Executed endpoint 'NayifatAPI.Controllers.ProxyController.ForwardRequest (NayifatAPI)'
2025-02-01 17:59:09.439 +03:00 [INF] Request finished HTTP/1.1 POST http://187e-51-252-155-185.ngrok-free.app/api/proxy/forward?url=https://icreditdept.com/api/testasp/test_local_generate_otp.php - 200 200 application/json 3389.7856ms
2025-02-01 18:02:46.467 +03:00 [INF] Request starting HTTP/1.1 POST http://187e-51-252-155-185.ngrok-free.app/api/Registration/register - application/json; charset=utf-8 153
2025-02-01 18:02:46.473 +03:00 [INF] Executing endpoint 'NayifatAPI.Controllers.RegistrationController.Register (NayifatAPI)'
2025-02-01 18:02:46.474 +03:00 [INF] Route matched with {action = "Register", controller = "Registration"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] Register(System.Object) on controller NayifatAPI.Controllers.RegistrationController (NayifatAPI).
2025-02-01 18:02:46.558 +03:00 [INF] Executed DbCommand (78ms) [Parameters=[@__providedApiKey_0='?' (Size = 255)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [a].[Key], [a].[CreatedAt], [a].[Description], [a].[ExpiresAt], [a].[IsActive], [a].[LastUsedAt]
FROM [ApiKeys] AS [a]
WHERE [a].[Key] = @__providedApiKey_0 AND [a].[IsActive] = CAST(1 AS bit)
2025-02-01 18:02:46.566 +03:00 [INF] Executed DbCommand (2ms) [Parameters=[@__idCheckRequest_NationalId_0='?' (Size = 450)], CommandType='"Text"', CommandTimeout='30']
SELECT CASE
    WHEN EXISTS (
        SELECT 1
        FROM [Customers] AS [c]
        WHERE [c].[NationalId] = @__idCheckRequest_NationalId_0) THEN CAST(1 AS bit)
    ELSE CAST(0 AS bit)
END
2025-02-01 18:02:46.568 +03:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType9`2[[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Object, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-02-01 18:02:46.569 +03:00 [INF] Executed action NayifatAPI.Controllers.RegistrationController.Register (NayifatAPI) in 94.0442ms
2025-02-01 18:02:46.570 +03:00 [INF] Executed endpoint 'NayifatAPI.Controllers.RegistrationController.Register (NayifatAPI)'
2025-02-01 18:02:46.571 +03:00 [INF] Request finished HTTP/1.1 POST http://187e-51-252-155-185.ngrok-free.app/api/Registration/register - 200 null application/json; charset=utf-8 103.7702ms
2025-02-01 18:04:41.859 +03:00 [INF] Request starting HTTP/1.1 POST http://187e-51-252-155-185.ngrok-free.app/api/Registration/register - application/json; charset=utf-8 153
2025-02-01 18:04:41.863 +03:00 [INF] Executing endpoint 'NayifatAPI.Controllers.RegistrationController.Register (NayifatAPI)'
2025-02-01 18:04:41.864 +03:00 [INF] Route matched with {action = "Register", controller = "Registration"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] Register(System.Object) on controller NayifatAPI.Controllers.RegistrationController (NayifatAPI).
2025-02-01 18:04:41.868 +03:00 [INF] Executed DbCommand (2ms) [Parameters=[@__providedApiKey_0='?' (Size = 255)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [a].[Key], [a].[CreatedAt], [a].[Description], [a].[ExpiresAt], [a].[IsActive], [a].[LastUsedAt]
FROM [ApiKeys] AS [a]
WHERE [a].[Key] = @__providedApiKey_0 AND [a].[IsActive] = CAST(1 AS bit)
2025-02-01 18:04:41.873 +03:00 [INF] Executed DbCommand (2ms) [Parameters=[@__idCheckRequest_NationalId_0='?' (Size = 450)], CommandType='"Text"', CommandTimeout='30']
SELECT CASE
    WHEN EXISTS (
        SELECT 1
        FROM [Customers] AS [c]
        WHERE [c].[NationalId] = @__idCheckRequest_NationalId_0) THEN CAST(1 AS bit)
    ELSE CAST(0 AS bit)
END
2025-02-01 18:04:41.875 +03:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType9`2[[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Object, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-02-01 18:04:41.876 +03:00 [INF] Executed action NayifatAPI.Controllers.RegistrationController.Register (NayifatAPI) in 10.3795ms
2025-02-01 18:04:41.876 +03:00 [INF] Executed endpoint 'NayifatAPI.Controllers.RegistrationController.Register (NayifatAPI)'
2025-02-01 18:04:41.877 +03:00 [INF] Request finished HTTP/1.1 POST http://187e-51-252-155-185.ngrok-free.app/api/Registration/register - 200 null application/json; charset=utf-8 18.224ms
2025-02-01 18:04:42.563 +03:00 [INF] Request starting HTTP/1.1 POST http://187e-51-252-155-185.ngrok-free.app/api/proxy/forward?url=https://icreditdept.com/api/testasp/test_local_generate_otp.php - application/json; charset=utf-8 89
2025-02-01 18:04:42.569 +03:00 [INF] Executing endpoint 'NayifatAPI.Controllers.ProxyController.ForwardRequest (NayifatAPI)'
2025-02-01 18:04:42.570 +03:00 [INF] Route matched with {action = "ForwardRequest", controller = "Proxy"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] ForwardRequest() on controller NayifatAPI.Controllers.ProxyController (NayifatAPI).
2025-02-01 18:04:42.572 +03:00 [INF] Start processing HTTP request POST https://icreditdept.com/api/testasp/test_local_generate_otp.php
2025-02-01 18:04:42.572 +03:00 [INF] Sending HTTP request POST https://icreditdept.com/api/testasp/test_local_generate_otp.php
2025-02-01 18:04:43.907 +03:00 [INF] Received HTTP response headers after 1333.7525ms - 200
2025-02-01 18:04:43.909 +03:00 [INF] End processing HTTP request after 1337.0148ms - 200
2025-02-01 18:04:43.910 +03:00 [INF] Raw response length: 200
2025-02-01 18:04:43.911 +03:00 [INF] Response content: {"success":true,"errors":[],"result":{"nationalId":"1064448614","otp":733692,"expiryDate":"2025-02-01 18:09:44","successMsg":"Success","errCode":0,"errMsg":null},"type":"N","message":null,"code":null}
2025-02-01 18:04:43.912 +03:00 [INF] Executing ContentResult with HTTP Response ContentType of application/json
2025-02-01 18:04:43.912 +03:00 [INF] Executed action NayifatAPI.Controllers.ProxyController.ForwardRequest (NayifatAPI) in 1341.6798ms
2025-02-01 18:04:43.913 +03:00 [INF] Executed endpoint 'NayifatAPI.Controllers.ProxyController.ForwardRequest (NayifatAPI)'
2025-02-01 18:04:43.914 +03:00 [INF] Request finished HTTP/1.1 POST http://187e-51-252-155-185.ngrok-free.app/api/proxy/forward?url=https://icreditdept.com/api/testasp/test_local_generate_otp.php - 200 200 application/json 1351.1814ms
2025-02-01 18:06:44.294 +03:00 [INF] Request starting HTTP/1.1 POST http://187e-51-252-155-185.ngrok-free.app/api/Registration/register - application/json; charset=utf-8 153
2025-02-01 18:06:44.297 +03:00 [INF] Executing endpoint 'NayifatAPI.Controllers.RegistrationController.Register (NayifatAPI)'
2025-02-01 18:06:44.301 +03:00 [INF] Route matched with {action = "Register", controller = "Registration"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] Register(System.Object) on controller NayifatAPI.Controllers.RegistrationController (NayifatAPI).
2025-02-01 18:06:44.306 +03:00 [INF] Executed DbCommand (2ms) [Parameters=[@__providedApiKey_0='?' (Size = 255)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [a].[Key], [a].[CreatedAt], [a].[Description], [a].[ExpiresAt], [a].[IsActive], [a].[LastUsedAt]
FROM [ApiKeys] AS [a]
WHERE [a].[Key] = @__providedApiKey_0 AND [a].[IsActive] = CAST(1 AS bit)
2025-02-01 18:06:44.310 +03:00 [INF] Executed DbCommand (2ms) [Parameters=[@__idCheckRequest_NationalId_0='?' (Size = 450)], CommandType='"Text"', CommandTimeout='30']
SELECT CASE
    WHEN EXISTS (
        SELECT 1
        FROM [Customers] AS [c]
        WHERE [c].[NationalId] = @__idCheckRequest_NationalId_0) THEN CAST(1 AS bit)
    ELSE CAST(0 AS bit)
END
2025-02-01 18:06:44.311 +03:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType9`2[[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Object, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-02-01 18:06:44.312 +03:00 [INF] Executed action NayifatAPI.Controllers.RegistrationController.Register (NayifatAPI) in 10.0766ms
2025-02-01 18:06:44.313 +03:00 [INF] Executed endpoint 'NayifatAPI.Controllers.RegistrationController.Register (NayifatAPI)'
2025-02-01 18:06:44.314 +03:00 [INF] Request finished HTTP/1.1 POST http://187e-51-252-155-185.ngrok-free.app/api/Registration/register - 200 null application/json; charset=utf-8 19.4458ms
2025-02-01 18:06:45.097 +03:00 [INF] Request starting HTTP/1.1 POST http://187e-51-252-155-185.ngrok-free.app/api/proxy/forward?url=https://icreditdept.com/api/testasp/test_local_generate_otp.php - application/json; charset=utf-8 89
2025-02-01 18:06:45.099 +03:00 [INF] Executing endpoint 'NayifatAPI.Controllers.ProxyController.ForwardRequest (NayifatAPI)'
2025-02-01 18:06:45.100 +03:00 [INF] Route matched with {action = "ForwardRequest", controller = "Proxy"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] ForwardRequest() on controller NayifatAPI.Controllers.ProxyController (NayifatAPI).
2025-02-01 18:06:45.102 +03:00 [INF] Start processing HTTP request POST https://icreditdept.com/api/testasp/test_local_generate_otp.php
2025-02-01 18:06:45.103 +03:00 [INF] Sending HTTP request POST https://icreditdept.com/api/testasp/test_local_generate_otp.php
2025-02-01 18:06:45.883 +03:00 [INF] Received HTTP response headers after 778.8255ms - 200
2025-02-01 18:06:45.886 +03:00 [INF] End processing HTTP request after 783.315ms - 200
2025-02-01 18:06:45.889 +03:00 [INF] Raw response length: 200
2025-02-01 18:06:45.892 +03:00 [INF] Response content: {"success":true,"errors":[],"result":{"nationalId":"1064448614","otp":732391,"expiryDate":"2025-02-01 18:11:46","successMsg":"Success","errCode":0,"errMsg":null},"type":"N","message":null,"code":null}
2025-02-01 18:06:45.893 +03:00 [INF] Executing ContentResult with HTTP Response ContentType of application/json
2025-02-01 18:06:45.894 +03:00 [INF] Executed action NayifatAPI.Controllers.ProxyController.ForwardRequest (NayifatAPI) in 792.5105ms
2025-02-01 18:06:45.895 +03:00 [INF] Executed endpoint 'NayifatAPI.Controllers.ProxyController.ForwardRequest (NayifatAPI)'
2025-02-01 18:06:45.896 +03:00 [INF] Request finished HTTP/1.1 POST http://187e-51-252-155-185.ngrok-free.app/api/proxy/forward?url=https://icreditdept.com/api/testasp/test_local_generate_otp.php - 200 200 application/json 798.2972ms
2025-02-01 18:07:55.116 +03:00 [INF] Request starting HTTP/1.1 POST http://187e-51-252-155-185.ngrok-free.app/api/proxy/forward?url=https://icreditdept.com/api/testasp/test_local_verify_otp.php - application/json; charset=utf-8 53
2025-02-01 18:07:55.120 +03:00 [INF] Executing endpoint 'NayifatAPI.Controllers.ProxyController.ForwardRequest (NayifatAPI)'
2025-02-01 18:07:55.121 +03:00 [INF] Route matched with {action = "ForwardRequest", controller = "Proxy"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] ForwardRequest() on controller NayifatAPI.Controllers.ProxyController (NayifatAPI).
2025-02-01 18:07:55.122 +03:00 [INF] Start processing HTTP request POST https://icreditdept.com/api/testasp/test_local_verify_otp.php
2025-02-01 18:07:55.123 +03:00 [INF] Sending HTTP request POST https://icreditdept.com/api/testasp/test_local_verify_otp.php
2025-02-01 18:07:55.539 +03:00 [INF] Received HTTP response headers after 415.1057ms - 200
2025-02-01 18:07:55.542 +03:00 [INF] End processing HTTP request after 419.5019ms - 200
2025-02-01 18:07:55.543 +03:00 [INF] Raw response length: 202
2025-02-01 18:07:55.544 +03:00 [INF] Response content: {"success":true,"errors":[],"result":{"nationalId":"1064448614","otp":"732391","verifiedFlag":true,"successMsg":"Verified successfully.","errCode":0,"errMsg":null},"type":"N","message":null,"code":null}
2025-02-01 18:07:55.545 +03:00 [INF] Executing ContentResult with HTTP Response ContentType of application/json
2025-02-01 18:07:55.545 +03:00 [INF] Executed action NayifatAPI.Controllers.ProxyController.ForwardRequest (NayifatAPI) in 423.236ms
2025-02-01 18:07:55.546 +03:00 [INF] Executed endpoint 'NayifatAPI.Controllers.ProxyController.ForwardRequest (NayifatAPI)'
2025-02-01 18:07:55.547 +03:00 [INF] Request finished HTTP/1.1 POST http://187e-51-252-155-185.ngrok-free.app/api/proxy/forward?url=https://icreditdept.com/api/testasp/test_local_verify_otp.php - 200 202 application/json 430.862ms
2025-02-01 18:07:56.822 +03:00 [INF] Request starting HTTP/1.1 POST http://187e-51-252-155-185.ngrok-free.app/api/Yakeen/getCitizenInfo/json - application/json; charset=utf-8 88
2025-02-01 18:07:56.826 +03:00 [INF] Executing endpoint 'NayifatAPI.Controllers.YakeenController.GetCitizenInfo (NayifatAPI)'
2025-02-01 18:07:56.827 +03:00 [INF] Route matched with {action = "GetCitizenInfo", controller = "Yakeen"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.ActionResult`1[NayifatAPI.Models.YakeenCitizenInfo]] GetCitizenInfo(CitizenInfoRequest) on controller NayifatAPI.Controllers.YakeenController (NayifatAPI).
2025-02-01 18:07:57.018 +03:00 [INF] Executed DbCommand (188ms) [Parameters=[@__request_IqamaNumber_0='?' (Size = 50)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [y].[Id], [y].[DateOfBirth], [y].[DateOfBirthHijri], [y].[EnglishFirstName], [y].[EnglishLastName], [y].[EnglishSecondName], [y].[EnglishThirdName], [y].[FamilyName], [y].[FatherName], [y].[FirstName], [y].[Gender], [y].[GenderFieldSpecified], [y].[GrandFatherName], [y].[HifizaIssuePlace], [y].[HifizaNumber], [y].[IdExpiryDate], [y].[IdIssueDate], [y].[IdIssuePlace], [y].[IdVersionNumber], [y].[IqamaNumber], [y].[LogIdField], [y].[NumberOfVehiclesReg], [y].[OccupationCode], [y].[SocialStatusDetailedDesc], [y].[SubtribeName], [y].[TotalNumberOfCurrentDependents]
FROM [YakeenCitizenInfo] AS [y]
WHERE [y].[IqamaNumber] = @__request_IqamaNumber_0
2025-02-01 18:07:57.023 +03:00 [INF] Executing OkObjectResult, writing value of type 'NayifatAPI.Models.YakeenCitizenInfo'.
2025-02-01 18:07:57.024 +03:00 [INF] Executed action NayifatAPI.Controllers.YakeenController.GetCitizenInfo (NayifatAPI) in 196.3053ms
2025-02-01 18:07:57.025 +03:00 [INF] Executed endpoint 'NayifatAPI.Controllers.YakeenController.GetCitizenInfo (NayifatAPI)'
2025-02-01 18:07:57.026 +03:00 [INF] Request finished HTTP/1.1 POST http://187e-51-252-155-185.ngrok-free.app/api/Yakeen/getCitizenInfo/json - 200 null application/json; charset=utf-8 204.3667ms
2025-02-01 18:18:37.588 +03:00 [INF] Request starting HTTP/1.1 POST http://187e-51-252-155-185.ngrok-free.app/api/Registration/register - application/json; charset=utf-8 153
2025-02-01 18:18:37.590 +03:00 [INF] Executing endpoint 'NayifatAPI.Controllers.RegistrationController.Register (NayifatAPI)'
2025-02-01 18:18:37.590 +03:00 [INF] Route matched with {action = "Register", controller = "Registration"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] Register(System.Object) on controller NayifatAPI.Controllers.RegistrationController (NayifatAPI).
2025-02-01 18:18:37.599 +03:00 [INF] Executed DbCommand (2ms) [Parameters=[@__providedApiKey_0='?' (Size = 255)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [a].[Key], [a].[CreatedAt], [a].[Description], [a].[ExpiresAt], [a].[IsActive], [a].[LastUsedAt]
FROM [ApiKeys] AS [a]
WHERE [a].[Key] = @__providedApiKey_0 AND [a].[IsActive] = CAST(1 AS bit)
2025-02-01 18:18:37.604 +03:00 [INF] Executed DbCommand (2ms) [Parameters=[@__idCheckRequest_NationalId_0='?' (Size = 450)], CommandType='"Text"', CommandTimeout='30']
SELECT CASE
    WHEN EXISTS (
        SELECT 1
        FROM [Customers] AS [c]
        WHERE [c].[NationalId] = @__idCheckRequest_NationalId_0) THEN CAST(1 AS bit)
    ELSE CAST(0 AS bit)
END
2025-02-01 18:18:37.605 +03:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType9`2[[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Object, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-02-01 18:18:37.606 +03:00 [INF] Executed action NayifatAPI.Controllers.RegistrationController.Register (NayifatAPI) in 14.8626ms
2025-02-01 18:18:37.607 +03:00 [INF] Executed endpoint 'NayifatAPI.Controllers.RegistrationController.Register (NayifatAPI)'
2025-02-01 18:18:37.608 +03:00 [INF] Request finished HTTP/1.1 POST http://187e-51-252-155-185.ngrok-free.app/api/Registration/register - 200 null application/json; charset=utf-8 20.2021ms
2025-02-01 18:18:38.412 +03:00 [INF] Request starting HTTP/1.1 POST http://187e-51-252-155-185.ngrok-free.app/api/proxy/forward?url=https://icreditdept.com/api/testasp/test_local_generate_otp.php - application/json; charset=utf-8 89
2025-02-01 18:18:38.418 +03:00 [INF] Executing endpoint 'NayifatAPI.Controllers.ProxyController.ForwardRequest (NayifatAPI)'
2025-02-01 18:18:38.419 +03:00 [INF] Route matched with {action = "ForwardRequest", controller = "Proxy"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] ForwardRequest() on controller NayifatAPI.Controllers.ProxyController (NayifatAPI).
2025-02-01 18:18:38.562 +03:00 [INF] Start processing HTTP request POST https://icreditdept.com/api/testasp/test_local_generate_otp.php
2025-02-01 18:18:38.565 +03:00 [INF] Sending HTTP request POST https://icreditdept.com/api/testasp/test_local_generate_otp.php
2025-02-01 18:18:39.858 +03:00 [INF] Received HTTP response headers after 1288.2391ms - 200
2025-02-01 18:18:39.862 +03:00 [INF] End processing HTTP request after 1300.3713ms - 200
2025-02-01 18:18:39.863 +03:00 [INF] Raw response length: 200
2025-02-01 18:18:39.863 +03:00 [INF] Response content: {"success":true,"errors":[],"result":{"nationalId":"1064448614","otp":609200,"expiryDate":"2025-02-01 18:23:40","successMsg":"Success","errCode":0,"errMsg":null},"type":"N","message":null,"code":null}
2025-02-01 18:18:39.865 +03:00 [INF] Executing ContentResult with HTTP Response ContentType of application/json
2025-02-01 18:18:39.866 +03:00 [INF] Executed action NayifatAPI.Controllers.ProxyController.ForwardRequest (NayifatAPI) in 1446.1179ms
2025-02-01 18:18:39.867 +03:00 [INF] Executed endpoint 'NayifatAPI.Controllers.ProxyController.ForwardRequest (NayifatAPI)'
2025-02-01 18:18:39.868 +03:00 [INF] Request finished HTTP/1.1 POST http://187e-51-252-155-185.ngrok-free.app/api/proxy/forward?url=https://icreditdept.com/api/testasp/test_local_generate_otp.php - 200 200 application/json 1456.1522ms
2025-02-01 18:19:06.990 +03:00 [INF] Request starting HTTP/1.1 POST http://187e-51-252-155-185.ngrok-free.app/api/proxy/forward?url=https://icreditdept.com/api/testasp/test_local_verify_otp.php - application/json; charset=utf-8 53
2025-02-01 18:19:06.994 +03:00 [INF] Executing endpoint 'NayifatAPI.Controllers.ProxyController.ForwardRequest (NayifatAPI)'
2025-02-01 18:19:06.994 +03:00 [INF] Route matched with {action = "ForwardRequest", controller = "Proxy"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] ForwardRequest() on controller NayifatAPI.Controllers.ProxyController (NayifatAPI).
2025-02-01 18:19:06.996 +03:00 [INF] Start processing HTTP request POST https://icreditdept.com/api/testasp/test_local_verify_otp.php
2025-02-01 18:19:06.996 +03:00 [INF] Sending HTTP request POST https://icreditdept.com/api/testasp/test_local_verify_otp.php
2025-02-01 18:19:07.414 +03:00 [INF] Received HTTP response headers after 417.326ms - 200
2025-02-01 18:19:07.419 +03:00 [INF] End processing HTTP request after 423.0834ms - 200
2025-02-01 18:19:07.420 +03:00 [INF] Raw response length: 202
2025-02-01 18:19:07.420 +03:00 [INF] Response content: {"success":true,"errors":[],"result":{"nationalId":"1064448614","otp":"609200","verifiedFlag":true,"successMsg":"Verified successfully.","errCode":0,"errMsg":null},"type":"N","message":null,"code":null}
2025-02-01 18:19:07.421 +03:00 [INF] Executing ContentResult with HTTP Response ContentType of application/json
2025-02-01 18:19:07.422 +03:00 [INF] Executed action NayifatAPI.Controllers.ProxyController.ForwardRequest (NayifatAPI) in 426.7084ms
2025-02-01 18:19:07.423 +03:00 [INF] Executed endpoint 'NayifatAPI.Controllers.ProxyController.ForwardRequest (NayifatAPI)'
2025-02-01 18:19:07.424 +03:00 [INF] Request finished HTTP/1.1 POST http://187e-51-252-155-185.ngrok-free.app/api/proxy/forward?url=https://icreditdept.com/api/testasp/test_local_verify_otp.php - 200 202 application/json 434.1385ms
2025-02-01 18:19:08.342 +03:00 [INF] Request starting HTTP/1.1 POST http://187e-51-252-155-185.ngrok-free.app/api/Yakeen/getCitizenInfo/json - application/json; charset=utf-8 88
2025-02-01 18:19:08.344 +03:00 [INF] Executing endpoint 'NayifatAPI.Controllers.YakeenController.GetCitizenInfo (NayifatAPI)'
2025-02-01 18:19:08.344 +03:00 [INF] Route matched with {action = "GetCitizenInfo", controller = "Yakeen"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.ActionResult`1[NayifatAPI.Models.YakeenCitizenInfo]] GetCitizenInfo(CitizenInfoRequest) on controller NayifatAPI.Controllers.YakeenController (NayifatAPI).
2025-02-01 18:19:08.425 +03:00 [INF] Executed DbCommand (79ms) [Parameters=[@__request_IqamaNumber_0='?' (Size = 50)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [y].[Id], [y].[DateOfBirth], [y].[DateOfBirthHijri], [y].[EnglishFirstName], [y].[EnglishLastName], [y].[EnglishSecondName], [y].[EnglishThirdName], [y].[FamilyName], [y].[FatherName], [y].[FirstName], [y].[Gender], [y].[GenderFieldSpecified], [y].[GrandFatherName], [y].[HifizaIssuePlace], [y].[HifizaNumber], [y].[IdExpiryDate], [y].[IdIssueDate], [y].[IdIssuePlace], [y].[IdVersionNumber], [y].[IqamaNumber], [y].[LogIdField], [y].[NumberOfVehiclesReg], [y].[OccupationCode], [y].[SocialStatusDetailedDesc], [y].[SubtribeName], [y].[TotalNumberOfCurrentDependents]
FROM [YakeenCitizenInfo] AS [y]
WHERE [y].[IqamaNumber] = @__request_IqamaNumber_0
2025-02-01 18:19:08.429 +03:00 [INF] Executing OkObjectResult, writing value of type 'NayifatAPI.Models.YakeenCitizenInfo'.
2025-02-01 18:19:08.429 +03:00 [INF] Executed action NayifatAPI.Controllers.YakeenController.GetCitizenInfo (NayifatAPI) in 83.9947ms
2025-02-01 18:19:08.430 +03:00 [INF] Executed endpoint 'NayifatAPI.Controllers.YakeenController.GetCitizenInfo (NayifatAPI)'
2025-02-01 18:19:08.431 +03:00 [INF] Request finished HTTP/1.1 POST http://187e-51-252-155-185.ngrok-free.app/api/Yakeen/getCitizenInfo/json - 200 null application/json; charset=utf-8 88.8804ms
2025-02-01 18:31:17.879 +03:00 [INF] Request starting HTTP/1.1 POST http://187e-51-252-155-185.ngrok-free.app/api/Registration/register - application/json; charset=utf-8 153
2025-02-01 18:31:17.894 +03:00 [INF] Executing endpoint 'NayifatAPI.Controllers.RegistrationController.Register (NayifatAPI)'
2025-02-01 18:31:17.895 +03:00 [INF] Route matched with {action = "Register", controller = "Registration"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] Register(System.Object) on controller NayifatAPI.Controllers.RegistrationController (NayifatAPI).
2025-02-01 18:31:17.910 +03:00 [INF] Executed DbCommand (3ms) [Parameters=[@__providedApiKey_0='?' (Size = 255)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [a].[Key], [a].[CreatedAt], [a].[Description], [a].[ExpiresAt], [a].[IsActive], [a].[LastUsedAt]
FROM [ApiKeys] AS [a]
WHERE [a].[Key] = @__providedApiKey_0 AND [a].[IsActive] = CAST(1 AS bit)
2025-02-01 18:31:17.918 +03:00 [INF] Executed DbCommand (4ms) [Parameters=[@__idCheckRequest_NationalId_0='?' (Size = 450)], CommandType='"Text"', CommandTimeout='30']
SELECT CASE
    WHEN EXISTS (
        SELECT 1
        FROM [Customers] AS [c]
        WHERE [c].[NationalId] = @__idCheckRequest_NationalId_0) THEN CAST(1 AS bit)
    ELSE CAST(0 AS bit)
END
2025-02-01 18:31:17.921 +03:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType9`2[[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Object, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-02-01 18:31:17.922 +03:00 [INF] Executed action NayifatAPI.Controllers.RegistrationController.Register (NayifatAPI) in 23.3674ms
2025-02-01 18:31:17.923 +03:00 [INF] Executed endpoint 'NayifatAPI.Controllers.RegistrationController.Register (NayifatAPI)'
2025-02-01 18:31:17.924 +03:00 [INF] Request finished HTTP/1.1 POST http://187e-51-252-155-185.ngrok-free.app/api/Registration/register - 200 null application/json; charset=utf-8 45.3105ms
2025-02-01 18:35:10.172 +03:00 [INF] Request starting HTTP/1.1 POST http://187e-51-252-155-185.ngrok-free.app/api/Registration/register - application/json; charset=utf-8 153
2025-02-01 18:35:10.175 +03:00 [INF] Executing endpoint 'NayifatAPI.Controllers.RegistrationController.Register (NayifatAPI)'
2025-02-01 18:35:10.176 +03:00 [INF] Route matched with {action = "Register", controller = "Registration"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] Register(System.Object) on controller NayifatAPI.Controllers.RegistrationController (NayifatAPI).
2025-02-01 18:35:10.181 +03:00 [INF] Executed DbCommand (3ms) [Parameters=[@__providedApiKey_0='?' (Size = 255)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [a].[Key], [a].[CreatedAt], [a].[Description], [a].[ExpiresAt], [a].[IsActive], [a].[LastUsedAt]
FROM [ApiKeys] AS [a]
WHERE [a].[Key] = @__providedApiKey_0 AND [a].[IsActive] = CAST(1 AS bit)
2025-02-01 18:35:10.188 +03:00 [INF] Executed DbCommand (3ms) [Parameters=[@__idCheckRequest_NationalId_0='?' (Size = 450)], CommandType='"Text"', CommandTimeout='30']
SELECT CASE
    WHEN EXISTS (
        SELECT 1
        FROM [Customers] AS [c]
        WHERE [c].[NationalId] = @__idCheckRequest_NationalId_0) THEN CAST(1 AS bit)
    ELSE CAST(0 AS bit)
END
2025-02-01 18:35:10.189 +03:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType9`2[[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Object, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-02-01 18:35:10.191 +03:00 [INF] Executed action NayifatAPI.Controllers.RegistrationController.Register (NayifatAPI) in 14.2559ms
2025-02-01 18:35:10.192 +03:00 [INF] Executed endpoint 'NayifatAPI.Controllers.RegistrationController.Register (NayifatAPI)'
2025-02-01 18:35:10.193 +03:00 [INF] Request finished HTTP/1.1 POST http://187e-51-252-155-185.ngrok-free.app/api/Registration/register - 200 null application/json; charset=utf-8 20.7628ms
2025-02-01 18:35:11.064 +03:00 [INF] Request starting HTTP/1.1 POST http://187e-51-252-155-185.ngrok-free.app/api/proxy/forward?url=https://icreditdept.com/api/testasp/test_local_generate_otp.php - application/json; charset=utf-8 89
2025-02-01 18:35:11.067 +03:00 [INF] Executing endpoint 'NayifatAPI.Controllers.ProxyController.ForwardRequest (NayifatAPI)'
2025-02-01 18:35:11.068 +03:00 [INF] Route matched with {action = "ForwardRequest", controller = "Proxy"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] ForwardRequest() on controller NayifatAPI.Controllers.ProxyController (NayifatAPI).
2025-02-01 18:35:11.070 +03:00 [INF] Start processing HTTP request POST https://icreditdept.com/api/testasp/test_local_generate_otp.php
2025-02-01 18:35:11.070 +03:00 [INF] Sending HTTP request POST https://icreditdept.com/api/testasp/test_local_generate_otp.php
2025-02-01 18:35:12.328 +03:00 [INF] Received HTTP response headers after 1257.1314ms - 200
2025-02-01 18:35:12.329 +03:00 [INF] End processing HTTP request after 1259.7249ms - 200
2025-02-01 18:35:12.330 +03:00 [INF] Raw response length: 200
2025-02-01 18:35:12.331 +03:00 [INF] Response content: {"success":true,"errors":[],"result":{"nationalId":"1064448614","otp":987436,"expiryDate":"2025-02-01 18:40:12","successMsg":"Success","errCode":0,"errMsg":null},"type":"N","message":null,"code":null}
2025-02-01 18:35:12.332 +03:00 [INF] Executing ContentResult with HTTP Response ContentType of application/json
2025-02-01 18:35:12.333 +03:00 [INF] Executed action NayifatAPI.Controllers.ProxyController.ForwardRequest (NayifatAPI) in 1263.2822ms
2025-02-01 18:35:12.334 +03:00 [INF] Executed endpoint 'NayifatAPI.Controllers.ProxyController.ForwardRequest (NayifatAPI)'
2025-02-01 18:35:12.335 +03:00 [INF] Request finished HTTP/1.1 POST http://187e-51-252-155-185.ngrok-free.app/api/proxy/forward?url=https://icreditdept.com/api/testasp/test_local_generate_otp.php - 200 200 application/json 1270.9639ms
2025-02-01 18:35:38.329 +03:00 [INF] Request starting HTTP/1.1 POST http://187e-51-252-155-185.ngrok-free.app/api/proxy/forward?url=https://icreditdept.com/api/testasp/test_local_verify_otp.php - application/json; charset=utf-8 53
2025-02-01 18:35:38.333 +03:00 [INF] Executing endpoint 'NayifatAPI.Controllers.ProxyController.ForwardRequest (NayifatAPI)'
2025-02-01 18:35:38.334 +03:00 [INF] Route matched with {action = "ForwardRequest", controller = "Proxy"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] ForwardRequest() on controller NayifatAPI.Controllers.ProxyController (NayifatAPI).
2025-02-01 18:35:38.338 +03:00 [INF] Start processing HTTP request POST https://icreditdept.com/api/testasp/test_local_verify_otp.php
2025-02-01 18:35:38.339 +03:00 [INF] Sending HTTP request POST https://icreditdept.com/api/testasp/test_local_verify_otp.php
2025-02-01 18:35:38.767 +03:00 [INF] Received HTTP response headers after 426.3942ms - 200
2025-02-01 18:35:38.772 +03:00 [INF] End processing HTTP request after 433.8732ms - 200
2025-02-01 18:35:38.775 +03:00 [INF] Raw response length: 202
2025-02-01 18:35:38.776 +03:00 [INF] Response content: {"success":true,"errors":[],"result":{"nationalId":"1064448614","otp":"987436","verifiedFlag":true,"successMsg":"Verified successfully.","errCode":0,"errMsg":null},"type":"N","message":null,"code":null}
2025-02-01 18:35:38.777 +03:00 [INF] Executing ContentResult with HTTP Response ContentType of application/json
2025-02-01 18:35:38.777 +03:00 [INF] Executed action NayifatAPI.Controllers.ProxyController.ForwardRequest (NayifatAPI) in 439.4189ms
2025-02-01 18:35:38.779 +03:00 [INF] Executed endpoint 'NayifatAPI.Controllers.ProxyController.ForwardRequest (NayifatAPI)'
2025-02-01 18:35:38.779 +03:00 [INF] Request finished HTTP/1.1 POST http://187e-51-252-155-185.ngrok-free.app/api/proxy/forward?url=https://icreditdept.com/api/testasp/test_local_verify_otp.php - 200 202 application/json 450.1093ms
2025-02-01 18:35:40.006 +03:00 [INF] Request starting HTTP/1.1 POST http://187e-51-252-155-185.ngrok-free.app/api/Yakeen/getCitizenInfo/json - application/json; charset=utf-8 88
2025-02-01 18:35:40.010 +03:00 [INF] Executing endpoint 'NayifatAPI.Controllers.YakeenController.GetCitizenInfo (NayifatAPI)'
2025-02-01 18:35:40.010 +03:00 [INF] Route matched with {action = "GetCitizenInfo", controller = "Yakeen"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.ActionResult`1[NayifatAPI.Models.YakeenCitizenInfo]] GetCitizenInfo(CitizenInfoRequest) on controller NayifatAPI.Controllers.YakeenController (NayifatAPI).
2025-02-01 18:35:40.021 +03:00 [INF] Executed DbCommand (9ms) [Parameters=[@__request_IqamaNumber_0='?' (Size = 50)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [y].[Id], [y].[DateOfBirth], [y].[DateOfBirthHijri], [y].[EnglishFirstName], [y].[EnglishLastName], [y].[EnglishSecondName], [y].[EnglishThirdName], [y].[FamilyName], [y].[FatherName], [y].[FirstName], [y].[Gender], [y].[GenderFieldSpecified], [y].[GrandFatherName], [y].[HifizaIssuePlace], [y].[HifizaNumber], [y].[IdExpiryDate], [y].[IdIssueDate], [y].[IdIssuePlace], [y].[IdVersionNumber], [y].[IqamaNumber], [y].[LogIdField], [y].[NumberOfVehiclesReg], [y].[OccupationCode], [y].[SocialStatusDetailedDesc], [y].[SubtribeName], [y].[TotalNumberOfCurrentDependents]
FROM [YakeenCitizenInfo] AS [y]
WHERE [y].[IqamaNumber] = @__request_IqamaNumber_0
2025-02-01 18:35:40.024 +03:00 [INF] Executing OkObjectResult, writing value of type 'NayifatAPI.Models.YakeenCitizenInfo'.
2025-02-01 18:35:40.024 +03:00 [INF] Executed action NayifatAPI.Controllers.YakeenController.GetCitizenInfo (NayifatAPI) in 13.0409ms
2025-02-01 18:35:40.025 +03:00 [INF] Executed endpoint 'NayifatAPI.Controllers.YakeenController.GetCitizenInfo (NayifatAPI)'
2025-02-01 18:35:40.026 +03:00 [INF] Request finished HTTP/1.1 POST http://187e-51-252-155-185.ngrok-free.app/api/Yakeen/getCitizenInfo/json - 200 null application/json; charset=utf-8 20.4376ms
2025-02-01 18:49:51.923 +03:00 [INF] Request starting HTTP/1.1 POST http://187e-51-252-155-185.ngrok-free.app/api/Registration/register - application/json; charset=utf-8 153
2025-02-01 18:49:51.925 +03:00 [INF] Executing endpoint 'NayifatAPI.Controllers.RegistrationController.Register (NayifatAPI)'
2025-02-01 18:49:51.925 +03:00 [INF] Route matched with {action = "Register", controller = "Registration"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] Register(System.Object) on controller NayifatAPI.Controllers.RegistrationController (NayifatAPI).
2025-02-01 18:49:51.941 +03:00 [INF] Executed DbCommand (3ms) [Parameters=[@__providedApiKey_0='?' (Size = 255)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [a].[Key], [a].[CreatedAt], [a].[Description], [a].[ExpiresAt], [a].[IsActive], [a].[LastUsedAt]
FROM [ApiKeys] AS [a]
WHERE [a].[Key] = @__providedApiKey_0 AND [a].[IsActive] = CAST(1 AS bit)
2025-02-01 18:49:51.946 +03:00 [INF] Executed DbCommand (2ms) [Parameters=[@__idCheckRequest_NationalId_0='?' (Size = 450)], CommandType='"Text"', CommandTimeout='30']
SELECT CASE
    WHEN EXISTS (
        SELECT 1
        FROM [Customers] AS [c]
        WHERE [c].[NationalId] = @__idCheckRequest_NationalId_0) THEN CAST(1 AS bit)
    ELSE CAST(0 AS bit)
END
2025-02-01 18:49:51.948 +03:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType9`2[[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Object, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-02-01 18:49:51.949 +03:00 [INF] Executed action NayifatAPI.Controllers.RegistrationController.Register (NayifatAPI) in 18.2501ms
2025-02-01 18:49:51.950 +03:00 [INF] Executed endpoint 'NayifatAPI.Controllers.RegistrationController.Register (NayifatAPI)'
2025-02-01 18:49:51.950 +03:00 [INF] Request finished HTTP/1.1 POST http://187e-51-252-155-185.ngrok-free.app/api/Registration/register - 200 null application/json; charset=utf-8 27.8594ms
2025-02-01 18:49:53.013 +03:00 [INF] Request starting HTTP/1.1 POST http://187e-51-252-155-185.ngrok-free.app/api/proxy/forward?url=https://icreditdept.com/api/testasp/test_local_generate_otp.php - application/json; charset=utf-8 89
2025-02-01 18:49:53.015 +03:00 [INF] Executing endpoint 'NayifatAPI.Controllers.ProxyController.ForwardRequest (NayifatAPI)'
2025-02-01 18:49:53.016 +03:00 [INF] Route matched with {action = "ForwardRequest", controller = "Proxy"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] ForwardRequest() on controller NayifatAPI.Controllers.ProxyController (NayifatAPI).
2025-02-01 18:49:53.018 +03:00 [INF] Start processing HTTP request POST https://icreditdept.com/api/testasp/test_local_generate_otp.php
2025-02-01 18:49:53.019 +03:00 [INF] Sending HTTP request POST https://icreditdept.com/api/testasp/test_local_generate_otp.php
2025-02-01 18:49:54.272 +03:00 [INF] Received HTTP response headers after 1252.1509ms - 200
2025-02-01 18:49:54.275 +03:00 [INF] End processing HTTP request after 1256.8769ms - 200
2025-02-01 18:49:54.276 +03:00 [INF] Raw response length: 200
2025-02-01 18:49:54.276 +03:00 [INF] Response content: {"success":true,"errors":[],"result":{"nationalId":"1064448614","otp":216999,"expiryDate":"2025-02-01 18:54:54","successMsg":"Success","errCode":0,"errMsg":null},"type":"N","message":null,"code":null}
2025-02-01 18:49:54.277 +03:00 [INF] Executing ContentResult with HTTP Response ContentType of application/json
2025-02-01 18:49:54.277 +03:00 [INF] Executed action NayifatAPI.Controllers.ProxyController.ForwardRequest (NayifatAPI) in 1260.0507ms
2025-02-01 18:49:54.278 +03:00 [INF] Executed endpoint 'NayifatAPI.Controllers.ProxyController.ForwardRequest (NayifatAPI)'
2025-02-01 18:49:54.279 +03:00 [INF] Request finished HTTP/1.1 POST http://187e-51-252-155-185.ngrok-free.app/api/proxy/forward?url=https://icreditdept.com/api/testasp/test_local_generate_otp.php - 200 200 application/json 1265.3097ms
2025-02-01 18:50:20.609 +03:00 [INF] Request starting HTTP/1.1 POST http://187e-51-252-155-185.ngrok-free.app/api/proxy/forward?url=https://icreditdept.com/api/testasp/test_local_verify_otp.php - application/json; charset=utf-8 53
2025-02-01 18:50:20.611 +03:00 [INF] Executing endpoint 'NayifatAPI.Controllers.ProxyController.ForwardRequest (NayifatAPI)'
2025-02-01 18:50:20.612 +03:00 [INF] Route matched with {action = "ForwardRequest", controller = "Proxy"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] ForwardRequest() on controller NayifatAPI.Controllers.ProxyController (NayifatAPI).
2025-02-01 18:50:20.614 +03:00 [INF] Start processing HTTP request POST https://icreditdept.com/api/testasp/test_local_verify_otp.php
2025-02-01 18:50:20.615 +03:00 [INF] Sending HTTP request POST https://icreditdept.com/api/testasp/test_local_verify_otp.php
2025-02-01 18:50:21.037 +03:00 [INF] Received HTTP response headers after 421.5596ms - 200
2025-02-01 18:50:21.040 +03:00 [INF] End processing HTTP request after 426.6937ms - 200
2025-02-01 18:50:21.041 +03:00 [INF] Raw response length: 202
2025-02-01 18:50:21.042 +03:00 [INF] Response content: {"success":true,"errors":[],"result":{"nationalId":"1064448614","otp":"216999","verifiedFlag":true,"successMsg":"Verified successfully.","errCode":0,"errMsg":null},"type":"N","message":null,"code":null}
2025-02-01 18:50:21.043 +03:00 [INF] Executing ContentResult with HTTP Response ContentType of application/json
2025-02-01 18:50:21.046 +03:00 [INF] Executed action NayifatAPI.Controllers.ProxyController.ForwardRequest (NayifatAPI) in 433.0532ms
2025-02-01 18:50:21.048 +03:00 [INF] Executed endpoint 'NayifatAPI.Controllers.ProxyController.ForwardRequest (NayifatAPI)'
2025-02-01 18:50:21.048 +03:00 [INF] Request finished HTTP/1.1 POST http://187e-51-252-155-185.ngrok-free.app/api/proxy/forward?url=https://icreditdept.com/api/testasp/test_local_verify_otp.php - 200 202 application/json 439.5369ms
2025-02-01 18:50:22.505 +03:00 [INF] Request starting HTTP/1.1 POST http://187e-51-252-155-185.ngrok-free.app/api/Yakeen/getCitizenInfo/json - application/json; charset=utf-8 88
2025-02-01 18:50:22.509 +03:00 [INF] Executing endpoint 'NayifatAPI.Controllers.YakeenController.GetCitizenInfo (NayifatAPI)'
2025-02-01 18:50:22.509 +03:00 [INF] Route matched with {action = "GetCitizenInfo", controller = "Yakeen"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.ActionResult`1[NayifatAPI.Models.YakeenCitizenInfo]] GetCitizenInfo(CitizenInfoRequest) on controller NayifatAPI.Controllers.YakeenController (NayifatAPI).
2025-02-01 18:50:22.515 +03:00 [INF] Executed DbCommand (3ms) [Parameters=[@__request_IqamaNumber_0='?' (Size = 50)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [y].[Id], [y].[DateOfBirth], [y].[DateOfBirthHijri], [y].[EnglishFirstName], [y].[EnglishLastName], [y].[EnglishSecondName], [y].[EnglishThirdName], [y].[FamilyName], [y].[FatherName], [y].[FirstName], [y].[Gender], [y].[GenderFieldSpecified], [y].[GrandFatherName], [y].[HifizaIssuePlace], [y].[HifizaNumber], [y].[IdExpiryDate], [y].[IdIssueDate], [y].[IdIssuePlace], [y].[IdVersionNumber], [y].[IqamaNumber], [y].[LogIdField], [y].[NumberOfVehiclesReg], [y].[OccupationCode], [y].[SocialStatusDetailedDesc], [y].[SubtribeName], [y].[TotalNumberOfCurrentDependents]
FROM [YakeenCitizenInfo] AS [y]
WHERE [y].[IqamaNumber] = @__request_IqamaNumber_0
2025-02-01 18:50:22.517 +03:00 [INF] Executing OkObjectResult, writing value of type 'NayifatAPI.Models.YakeenCitizenInfo'.
2025-02-01 18:50:22.518 +03:00 [INF] Executed action NayifatAPI.Controllers.YakeenController.GetCitizenInfo (NayifatAPI) in 6.9327ms
2025-02-01 18:50:22.519 +03:00 [INF] Executed endpoint 'NayifatAPI.Controllers.YakeenController.GetCitizenInfo (NayifatAPI)'
2025-02-01 18:50:22.519 +03:00 [INF] Request finished HTTP/1.1 POST http://187e-51-252-155-185.ngrok-free.app/api/Yakeen/getCitizenInfo/json - 200 null application/json; charset=utf-8 14.5357ms
2025-02-01 19:37:07.073 +03:00 [INF] Request starting HTTP/1.1 POST http://187e-51-252-155-185.ngrok-free.app/api/Registration/register - application/json; charset=utf-8 153
2025-02-01 19:37:07.078 +03:00 [INF] Executing endpoint 'NayifatAPI.Controllers.RegistrationController.Register (NayifatAPI)'
2025-02-01 19:37:07.079 +03:00 [INF] Route matched with {action = "Register", controller = "Registration"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] Register(System.Object) on controller NayifatAPI.Controllers.RegistrationController (NayifatAPI).
2025-02-01 19:37:07.317 +03:00 [INF] Executed DbCommand (222ms) [Parameters=[@__providedApiKey_0='?' (Size = 255)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [a].[Key], [a].[CreatedAt], [a].[Description], [a].[ExpiresAt], [a].[IsActive], [a].[LastUsedAt]
FROM [ApiKeys] AS [a]
WHERE [a].[Key] = @__providedApiKey_0 AND [a].[IsActive] = CAST(1 AS bit)
2025-02-01 19:37:07.330 +03:00 [INF] Executed DbCommand (8ms) [Parameters=[@__idCheckRequest_NationalId_0='?' (Size = 450)], CommandType='"Text"', CommandTimeout='30']
SELECT CASE
    WHEN EXISTS (
        SELECT 1
        FROM [Customers] AS [c]
        WHERE [c].[NationalId] = @__idCheckRequest_NationalId_0) THEN CAST(1 AS bit)
    ELSE CAST(0 AS bit)
END
2025-02-01 19:37:07.335 +03:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType9`2[[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Object, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-02-01 19:37:07.337 +03:00 [INF] Executed action NayifatAPI.Controllers.RegistrationController.Register (NayifatAPI) in 255.0446ms
2025-02-01 19:37:07.340 +03:00 [INF] Executed endpoint 'NayifatAPI.Controllers.RegistrationController.Register (NayifatAPI)'
2025-02-01 19:37:07.343 +03:00 [INF] Request finished HTTP/1.1 POST http://187e-51-252-155-185.ngrok-free.app/api/Registration/register - 200 null application/json; charset=utf-8 269.7716ms
2025-02-01 19:37:08.064 +03:00 [INF] Request starting HTTP/1.1 POST http://187e-51-252-155-185.ngrok-free.app/api/proxy/forward?url=https://icreditdept.com/api/testasp/test_local_generate_otp.php - application/json; charset=utf-8 89
2025-02-01 19:37:08.069 +03:00 [INF] Executing endpoint 'NayifatAPI.Controllers.ProxyController.ForwardRequest (NayifatAPI)'
2025-02-01 19:37:08.071 +03:00 [INF] Route matched with {action = "ForwardRequest", controller = "Proxy"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] ForwardRequest() on controller NayifatAPI.Controllers.ProxyController (NayifatAPI).
2025-02-01 19:37:08.076 +03:00 [INF] Start processing HTTP request POST https://icreditdept.com/api/testasp/test_local_generate_otp.php
2025-02-01 19:37:08.079 +03:00 [INF] Sending HTTP request POST https://icreditdept.com/api/testasp/test_local_generate_otp.php
2025-02-01 19:37:08.899 +03:00 [INF] Received HTTP response headers after 817.456ms - 200
2025-02-01 19:37:08.901 +03:00 [INF] End processing HTTP request after 825.1812ms - 200
2025-02-01 19:37:08.902 +03:00 [INF] Raw response length: 200
2025-02-01 19:37:08.904 +03:00 [INF] Response content: {"success":true,"errors":[],"result":{"nationalId":"1064448614","otp":304279,"expiryDate":"2025-02-01 19:42:09","successMsg":"Success","errCode":0,"errMsg":null},"type":"N","message":null,"code":null}
2025-02-01 19:37:08.907 +03:00 [INF] Executing ContentResult with HTTP Response ContentType of application/json
2025-02-01 19:37:08.909 +03:00 [INF] Executed action NayifatAPI.Controllers.ProxyController.ForwardRequest (NayifatAPI) in 834.3769ms
2025-02-01 19:37:08.911 +03:00 [INF] Executed endpoint 'NayifatAPI.Controllers.ProxyController.ForwardRequest (NayifatAPI)'
2025-02-01 19:37:08.913 +03:00 [INF] Request finished HTTP/1.1 POST http://187e-51-252-155-185.ngrok-free.app/api/proxy/forward?url=https://icreditdept.com/api/testasp/test_local_generate_otp.php - 200 200 application/json 848.5429ms
2025-02-01 19:37:27.198 +03:00 [INF] Request starting HTTP/1.1 POST http://187e-51-252-155-185.ngrok-free.app/api/proxy/forward?url=https://icreditdept.com/api/testasp/test_local_verify_otp.php - application/json; charset=utf-8 53
2025-02-01 19:37:27.204 +03:00 [INF] Executing endpoint 'NayifatAPI.Controllers.ProxyController.ForwardRequest (NayifatAPI)'
2025-02-01 19:37:27.205 +03:00 [INF] Route matched with {action = "ForwardRequest", controller = "Proxy"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] ForwardRequest() on controller NayifatAPI.Controllers.ProxyController (NayifatAPI).
2025-02-01 19:37:27.207 +03:00 [INF] Start processing HTTP request POST https://icreditdept.com/api/testasp/test_local_verify_otp.php
2025-02-01 19:37:27.209 +03:00 [INF] Sending HTTP request POST https://icreditdept.com/api/testasp/test_local_verify_otp.php
2025-02-01 19:37:27.626 +03:00 [INF] Received HTTP response headers after 416.0168ms - 200
2025-02-01 19:37:27.629 +03:00 [INF] End processing HTTP request after 422.3415ms - 200
2025-02-01 19:37:27.633 +03:00 [INF] Raw response length: 202
2025-02-01 19:37:27.637 +03:00 [INF] Response content: {"success":true,"errors":[],"result":{"nationalId":"1064448614","otp":"304279","verifiedFlag":true,"successMsg":"Verified successfully.","errCode":0,"errMsg":null},"type":"N","message":null,"code":null}
2025-02-01 19:37:27.647 +03:00 [INF] Executing ContentResult with HTTP Response ContentType of application/json
2025-02-01 19:37:27.648 +03:00 [INF] Executed action NayifatAPI.Controllers.ProxyController.ForwardRequest (NayifatAPI) in 441.7357ms
2025-02-01 19:37:27.652 +03:00 [INF] Executed endpoint 'NayifatAPI.Controllers.ProxyController.ForwardRequest (NayifatAPI)'
2025-02-01 19:37:27.653 +03:00 [INF] Request finished HTTP/1.1 POST http://187e-51-252-155-185.ngrok-free.app/api/proxy/forward?url=https://icreditdept.com/api/testasp/test_local_verify_otp.php - 200 202 application/json 455.4165ms
2025-02-01 19:37:28.806 +03:00 [INF] Request starting HTTP/1.1 POST http://187e-51-252-155-185.ngrok-free.app/api/Yakeen/getCitizenInfo/json - application/json; charset=utf-8 88
2025-02-01 19:37:28.808 +03:00 [INF] Executing endpoint 'NayifatAPI.Controllers.YakeenController.GetCitizenInfo (NayifatAPI)'
2025-02-01 19:37:28.810 +03:00 [INF] Route matched with {action = "GetCitizenInfo", controller = "Yakeen"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.ActionResult`1[NayifatAPI.Models.YakeenCitizenInfo]] GetCitizenInfo(CitizenInfoRequest) on controller NayifatAPI.Controllers.YakeenController (NayifatAPI).
2025-02-01 19:37:28.907 +03:00 [INF] Executed DbCommand (89ms) [Parameters=[@__request_IqamaNumber_0='?' (Size = 50)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [y].[Id], [y].[DateOfBirth], [y].[DateOfBirthHijri], [y].[EnglishFirstName], [y].[EnglishLastName], [y].[EnglishSecondName], [y].[EnglishThirdName], [y].[FamilyName], [y].[FatherName], [y].[FirstName], [y].[Gender], [y].[GenderFieldSpecified], [y].[GrandFatherName], [y].[HifizaIssuePlace], [y].[HifizaNumber], [y].[IdExpiryDate], [y].[IdIssueDate], [y].[IdIssuePlace], [y].[IdVersionNumber], [y].[IqamaNumber], [y].[LogIdField], [y].[NumberOfVehiclesReg], [y].[OccupationCode], [y].[SocialStatusDetailedDesc], [y].[SubtribeName], [y].[TotalNumberOfCurrentDependents]
FROM [YakeenCitizenInfo] AS [y]
WHERE [y].[IqamaNumber] = @__request_IqamaNumber_0
2025-02-01 19:37:28.911 +03:00 [INF] Executing OkObjectResult, writing value of type 'NayifatAPI.Models.YakeenCitizenInfo'.
2025-02-01 19:37:28.913 +03:00 [INF] Executed action NayifatAPI.Controllers.YakeenController.GetCitizenInfo (NayifatAPI) in 99.8035ms
2025-02-01 19:37:28.915 +03:00 [INF] Executed endpoint 'NayifatAPI.Controllers.YakeenController.GetCitizenInfo (NayifatAPI)'
2025-02-01 19:37:28.917 +03:00 [INF] Request finished HTTP/1.1 POST http://187e-51-252-155-185.ngrok-free.app/api/Yakeen/getCitizenInfo/json - 200 null application/json; charset=utf-8 111.2937ms
2025-02-01 19:38:20.850 +03:00 [INF] Request starting HTTP/1.1 POST http://187e-51-252-155-185.ngrok-free.app/api/Registration/register - application/json; charset=utf-8 153
2025-02-01 19:38:20.855 +03:00 [INF] Executing endpoint 'NayifatAPI.Controllers.RegistrationController.Register (NayifatAPI)'
2025-02-01 19:38:20.859 +03:00 [INF] Route matched with {action = "Register", controller = "Registration"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] Register(System.Object) on controller NayifatAPI.Controllers.RegistrationController (NayifatAPI).
2025-02-01 19:38:20.882 +03:00 [INF] Executed DbCommand (5ms) [Parameters=[@__providedApiKey_0='?' (Size = 255)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [a].[Key], [a].[CreatedAt], [a].[Description], [a].[ExpiresAt], [a].[IsActive], [a].[LastUsedAt]
FROM [ApiKeys] AS [a]
WHERE [a].[Key] = @__providedApiKey_0 AND [a].[IsActive] = CAST(1 AS bit)
2025-02-01 19:38:20.907 +03:00 [INF] Executed DbCommand (7ms) [Parameters=[@__idCheckRequest_NationalId_0='?' (Size = 450)], CommandType='"Text"', CommandTimeout='30']
SELECT CASE
    WHEN EXISTS (
        SELECT 1
        FROM [Customers] AS [c]
        WHERE [c].[NationalId] = @__idCheckRequest_NationalId_0) THEN CAST(1 AS bit)
    ELSE CAST(0 AS bit)
END
2025-02-01 19:38:20.915 +03:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType9`2[[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Object, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-02-01 19:38:20.918 +03:00 [INF] Executed action NayifatAPI.Controllers.RegistrationController.Register (NayifatAPI) in 44.1466ms
2025-02-01 19:38:20.921 +03:00 [INF] Executed endpoint 'NayifatAPI.Controllers.RegistrationController.Register (NayifatAPI)'
2025-02-01 19:38:20.924 +03:00 [INF] Request finished HTTP/1.1 POST http://187e-51-252-155-185.ngrok-free.app/api/Registration/register - 200 null application/json; charset=utf-8 74.4584ms
2025-02-01 19:38:21.686 +03:00 [INF] Request starting HTTP/1.1 POST http://187e-51-252-155-185.ngrok-free.app/api/proxy/forward?url=https://icreditdept.com/api/testasp/test_local_generate_otp.php - application/json; charset=utf-8 89
2025-02-01 19:38:21.692 +03:00 [INF] Executing endpoint 'NayifatAPI.Controllers.ProxyController.ForwardRequest (NayifatAPI)'
2025-02-01 19:38:21.698 +03:00 [INF] Route matched with {action = "ForwardRequest", controller = "Proxy"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] ForwardRequest() on controller NayifatAPI.Controllers.ProxyController (NayifatAPI).
2025-02-01 19:38:21.807 +03:00 [INF] Start processing HTTP request POST https://icreditdept.com/api/testasp/test_local_generate_otp.php
2025-02-01 19:38:21.810 +03:00 [INF] Sending HTTP request POST https://icreditdept.com/api/testasp/test_local_generate_otp.php
2025-02-01 19:38:22.240 +03:00 [INF] Received HTTP response headers after 426.9063ms - 200
2025-02-01 19:38:22.244 +03:00 [INF] End processing HTTP request after 436.4706ms - 200
2025-02-01 19:38:22.249 +03:00 [INF] Raw response length: 200
2025-02-01 19:38:22.251 +03:00 [INF] Response content: {"success":true,"errors":[],"result":{"nationalId":"1112345678","otp":638705,"expiryDate":"2025-02-01 19:43:22","successMsg":"Success","errCode":0,"errMsg":null},"type":"N","message":null,"code":null}
2025-02-01 19:38:22.253 +03:00 [INF] Executing ContentResult with HTTP Response ContentType of application/json
2025-02-01 19:38:22.255 +03:00 [INF] Executed action NayifatAPI.Controllers.ProxyController.ForwardRequest (NayifatAPI) in 549.6142ms
2025-02-01 19:38:22.262 +03:00 [INF] Executed endpoint 'NayifatAPI.Controllers.ProxyController.ForwardRequest (NayifatAPI)'
2025-02-01 19:38:22.266 +03:00 [INF] Request finished HTTP/1.1 POST http://187e-51-252-155-185.ngrok-free.app/api/proxy/forward?url=https://icreditdept.com/api/testasp/test_local_generate_otp.php - 200 200 application/json 579.7241ms
2025-02-01 19:38:43.633 +03:00 [INF] Request starting HTTP/1.1 POST http://187e-51-252-155-185.ngrok-free.app/api/proxy/forward?url=https://icreditdept.com/api/testasp/test_local_verify_otp.php - application/json; charset=utf-8 53
2025-02-01 19:38:43.637 +03:00 [INF] Executing endpoint 'NayifatAPI.Controllers.ProxyController.ForwardRequest (NayifatAPI)'
2025-02-01 19:38:43.639 +03:00 [INF] Route matched with {action = "ForwardRequest", controller = "Proxy"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] ForwardRequest() on controller NayifatAPI.Controllers.ProxyController (NayifatAPI).
2025-02-01 19:38:43.641 +03:00 [INF] Start processing HTTP request POST https://icreditdept.com/api/testasp/test_local_verify_otp.php
2025-02-01 19:38:43.648 +03:00 [INF] Sending HTTP request POST https://icreditdept.com/api/testasp/test_local_verify_otp.php
2025-02-01 19:38:44.068 +03:00 [INF] Received HTTP response headers after 416.1799ms - 200
2025-02-01 19:38:44.071 +03:00 [INF] End processing HTTP request after 429.9538ms - 200
2025-02-01 19:38:44.074 +03:00 [INF] Raw response length: 202
2025-02-01 19:38:44.076 +03:00 [INF] Response content: {"success":true,"errors":[],"result":{"nationalId":"1112345678","otp":"638705","verifiedFlag":true,"successMsg":"Verified successfully.","errCode":0,"errMsg":null},"type":"N","message":null,"code":null}
2025-02-01 19:38:44.077 +03:00 [INF] Executing ContentResult with HTTP Response ContentType of application/json
2025-02-01 19:38:44.078 +03:00 [INF] Executed action NayifatAPI.Controllers.ProxyController.ForwardRequest (NayifatAPI) in 438.0442ms
2025-02-01 19:38:44.084 +03:00 [INF] Executed endpoint 'NayifatAPI.Controllers.ProxyController.ForwardRequest (NayifatAPI)'
2025-02-01 19:38:44.086 +03:00 [INF] Request finished HTTP/1.1 POST http://187e-51-252-155-185.ngrok-free.app/api/proxy/forward?url=https://icreditdept.com/api/testasp/test_local_verify_otp.php - 200 202 application/json 452.3456ms
2025-02-01 19:38:45.445 +03:00 [INF] Request starting HTTP/1.1 POST http://187e-51-252-155-185.ngrok-free.app/api/Yakeen/getCitizenInfo/json - application/json; charset=utf-8 88
2025-02-01 19:38:45.448 +03:00 [INF] Executing endpoint 'NayifatAPI.Controllers.YakeenController.GetCitizenInfo (NayifatAPI)'
2025-02-01 19:38:45.449 +03:00 [INF] Route matched with {action = "GetCitizenInfo", controller = "Yakeen"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.ActionResult`1[NayifatAPI.Models.YakeenCitizenInfo]] GetCitizenInfo(CitizenInfoRequest) on controller NayifatAPI.Controllers.YakeenController (NayifatAPI).
2025-02-01 19:38:45.458 +03:00 [INF] Executed DbCommand (3ms) [Parameters=[@__request_IqamaNumber_0='?' (Size = 50)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [y].[Id], [y].[DateOfBirth], [y].[DateOfBirthHijri], [y].[EnglishFirstName], [y].[EnglishLastName], [y].[EnglishSecondName], [y].[EnglishThirdName], [y].[FamilyName], [y].[FatherName], [y].[FirstName], [y].[Gender], [y].[GenderFieldSpecified], [y].[GrandFatherName], [y].[HifizaIssuePlace], [y].[HifizaNumber], [y].[IdExpiryDate], [y].[IdIssueDate], [y].[IdIssuePlace], [y].[IdVersionNumber], [y].[IqamaNumber], [y].[LogIdField], [y].[NumberOfVehiclesReg], [y].[OccupationCode], [y].[SocialStatusDetailedDesc], [y].[SubtribeName], [y].[TotalNumberOfCurrentDependents]
FROM [YakeenCitizenInfo] AS [y]
WHERE [y].[IqamaNumber] = @__request_IqamaNumber_0
2025-02-01 19:38:45.462 +03:00 [INF] Executing OkObjectResult, writing value of type 'NayifatAPI.Models.YakeenCitizenInfo'.
2025-02-01 19:38:45.464 +03:00 [INF] Executed action NayifatAPI.Controllers.YakeenController.GetCitizenInfo (NayifatAPI) in 13.2714ms
2025-02-01 19:38:45.467 +03:00 [INF] Executed endpoint 'NayifatAPI.Controllers.YakeenController.GetCitizenInfo (NayifatAPI)'
2025-02-01 19:38:45.472 +03:00 [INF] Request finished HTTP/1.1 POST http://187e-51-252-155-185.ngrok-free.app/api/Yakeen/getCitizenInfo/json - 200 null application/json; charset=utf-8 26.8322ms
2025-02-01 19:39:19.173 +03:00 [INF] Request starting HTTP/1.1 POST http://187e-51-252-155-185.ngrok-free.app/api/auth/set-password - application/json; charset=utf-8 50
2025-02-01 19:39:19.178 +03:00 [INF] Request finished HTTP/1.1 POST http://187e-51-252-155-185.ngrok-free.app/api/auth/set-password - 404 0 null 5.1371ms
2025-02-01 19:39:19.182 +03:00 [INF] Request reached the end of the middleware pipeline without being handled by application code. Request path: POST http://187e-51-252-155-185.ngrok-free.app/api/auth/set-password, Response status code: 404
2025-02-01 19:47:25.507 +03:00 [INF] Starting web application
2025-02-01 19:47:25.609 +03:00 [INF] Now listening on: http://localhost:5264
2025-02-01 19:47:25.618 +03:00 [INF] Application started. Press Ctrl+C to shut down.
2025-02-01 19:47:25.622 +03:00 [INF] Hosting environment: Development
2025-02-01 19:47:25.626 +03:00 [INF] Content root path: C:\Users\yamta\StudioProjects\nayifat_app_2025_new\nayifatapi
2025-02-01 19:49:12.630 +03:00 [INF] Application is shutting down...
2025-02-01 19:49:19.046 +03:00 [INF] Starting web application
2025-02-01 19:49:19.161 +03:00 [INF] Now listening on: http://localhost:5264
2025-02-01 19:49:19.166 +03:00 [INF] Application started. Press Ctrl+C to shut down.
2025-02-01 19:49:19.168 +03:00 [INF] Hosting environment: Development
2025-02-01 19:49:19.169 +03:00 [INF] Content root path: C:\Users\yamta\StudioProjects\nayifat_app_2025_new\nayifatapi
