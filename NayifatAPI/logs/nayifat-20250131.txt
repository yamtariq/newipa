2025-01-31 10:47:06.236 +03:00 [INF] Starting web application
2025-01-31 10:47:06.345 +03:00 [INF] Now listening on: http://localhost:5264
2025-01-31 10:47:06.351 +03:00 [INF] Application started. Press Ctrl+C to shut down.
2025-01-31 10:47:06.353 +03:00 [INF] Hosting environment: Development
2025-01-31 10:47:06.354 +03:00 [INF] Content root path: C:\Users\yamta\StudioProjects\nayifat_app_2025_new\nayifatapi
2025-01-31 11:34:44.768 +03:00 [INF] Request starting HTTP/1.1 GET http://localhost:5264/api/health - null null
2025-01-31 11:34:44.820 +03:00 [WRN] Failed to determine the https port for redirect.
2025-01-31 11:34:44.825 +03:00 [INF] Executing endpoint 'NayifatAPI.Controllers.HealthController.Get (NayifatAPI)'
2025-01-31 11:34:44.837 +03:00 [INF] Route matched with {action = "Get", controller = "Health"}. Executing controller action with signature Microsoft.AspNetCore.Mvc.IActionResult Get() on controller NayifatAPI.Controllers.HealthController (NayifatAPI).
2025-01-31 11:34:44.925 +03:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType21`1[[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-01-31 11:34:44.943 +03:00 [INF] Executed action NayifatAPI.Controllers.HealthController.Get (NayifatAPI) in 101.0205ms
2025-01-31 11:34:44.947 +03:00 [INF] Executed endpoint 'NayifatAPI.Controllers.HealthController.Get (NayifatAPI)'
2025-01-31 11:34:44.951 +03:00 [INF] Request finished HTTP/1.1 GET http://localhost:5264/api/health - 200 null application/json; charset=utf-8 184.5513ms
2025-01-31 11:38:58.879 +03:00 [INF] Request starting HTTP/1.1 GET http://localhost:5264/api/health - null null
2025-01-31 11:38:58.888 +03:00 [INF] Executing endpoint 'NayifatAPI.Controllers.HealthController.Get (NayifatAPI)'
2025-01-31 11:38:58.890 +03:00 [INF] Route matched with {action = "Get", controller = "Health"}. Executing controller action with signature Microsoft.AspNetCore.Mvc.IActionResult Get() on controller NayifatAPI.Controllers.HealthController (NayifatAPI).
2025-01-31 11:38:58.901 +03:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType21`1[[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-01-31 11:38:58.903 +03:00 [INF] Executed action NayifatAPI.Controllers.HealthController.Get (NayifatAPI) in 11.0675ms
2025-01-31 11:38:58.905 +03:00 [INF] Executed endpoint 'NayifatAPI.Controllers.HealthController.Get (NayifatAPI)'
2025-01-31 11:38:58.906 +03:00 [INF] Request finished HTTP/1.1 GET http://localhost:5264/api/health - 200 null application/json; charset=utf-8 28.4321ms
2025-01-31 11:39:29.808 +03:00 [INF] Request starting HTTP/1.1 POST http://localhost:5264/api/auth/signin - application/json 66
2025-01-31 11:39:29.812 +03:00 [INF] Executing endpoint 'NayifatAPI.Controllers.AuthController.SignIn (NayifatAPI)'
2025-01-31 11:39:29.826 +03:00 [INF] Route matched with {action = "SignIn", controller = "Auth"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] SignIn(NayifatAPI.Controllers.SignInRequest) on controller NayifatAPI.Controllers.AuthController (NayifatAPI).
2025-01-31 11:39:29.857 +03:00 [INF] Executing BadRequestObjectResult, writing value of type 'Microsoft.AspNetCore.Mvc.ValidationProblemDetails'.
2025-01-31 11:39:29.886 +03:00 [INF] Executed action NayifatAPI.Controllers.AuthController.SignIn (NayifatAPI) in 57.9841ms
2025-01-31 11:39:29.887 +03:00 [INF] Executed endpoint 'NayifatAPI.Controllers.AuthController.SignIn (NayifatAPI)'
2025-01-31 11:39:29.889 +03:00 [INF] Request finished HTTP/1.1 POST http://localhost:5264/api/auth/signin - 400 null application/problem+json; charset=utf-8 81.3839ms
2025-01-31 11:39:41.489 +03:00 [INF] Request starting HTTP/1.1 GET http://localhost:5264/api/content/fetch - null null
2025-01-31 11:39:41.491 +03:00 [INF] Executing endpoint '405 HTTP Method Not Supported'
2025-01-31 11:39:41.493 +03:00 [INF] Executed endpoint '405 HTTP Method Not Supported'
2025-01-31 11:39:41.494 +03:00 [INF] Request finished HTTP/1.1 GET http://localhost:5264/api/content/fetch - 405 0 null 5.4668ms
2025-01-31 11:58:09.944 +03:00 [INF] Request starting HTTP/1.1 POST http://localhost:5264/api/auth/signin - application/json 66
2025-01-31 11:58:10.237 +03:00 [INF] Executing endpoint 'NayifatAPI.Controllers.AuthController.SignIn (NayifatAPI)'
2025-01-31 11:58:10.238 +03:00 [INF] Route matched with {action = "SignIn", controller = "Auth"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] SignIn(NayifatAPI.Controllers.SignInRequest) on controller NayifatAPI.Controllers.AuthController (NayifatAPI).
2025-01-31 11:58:10.245 +03:00 [INF] Executing BadRequestObjectResult, writing value of type 'Microsoft.AspNetCore.Mvc.ValidationProblemDetails'.
2025-01-31 11:58:10.612 +03:00 [INF] Executed action NayifatAPI.Controllers.AuthController.SignIn (NayifatAPI) in 372.1723ms
2025-01-31 11:58:10.618 +03:00 [INF] Executed endpoint 'NayifatAPI.Controllers.AuthController.SignIn (NayifatAPI)'
2025-01-31 11:58:11.013 +03:00 [INF] Request finished HTTP/1.1 POST http://localhost:5264/api/auth/signin - 400 null application/problem+json; charset=utf-8 1068.282ms
2025-01-31 12:08:58.769 +03:00 [INF] Request starting HTTP/1.1 POST http://localhost:5264/api/auth/signin - application/json 66
2025-01-31 12:08:58.772 +03:00 [INF] Executing endpoint 'NayifatAPI.Controllers.AuthController.SignIn (NayifatAPI)'
2025-01-31 12:08:58.773 +03:00 [INF] Route matched with {action = "SignIn", controller = "Auth"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] SignIn(NayifatAPI.Controllers.SignInRequest) on controller NayifatAPI.Controllers.AuthController (NayifatAPI).
2025-01-31 12:08:58.786 +03:00 [INF] Executing BadRequestObjectResult, writing value of type 'Microsoft.AspNetCore.Mvc.ValidationProblemDetails'.
2025-01-31 12:08:58.788 +03:00 [INF] Executed action NayifatAPI.Controllers.AuthController.SignIn (NayifatAPI) in 13.9007ms
2025-01-31 12:08:58.789 +03:00 [INF] Executed endpoint 'NayifatAPI.Controllers.AuthController.SignIn (NayifatAPI)'
2025-01-31 12:08:58.792 +03:00 [INF] Request finished HTTP/1.1 POST http://localhost:5264/api/auth/signin - 400 null application/problem+json; charset=utf-8 23.0199ms
2025-01-31 12:11:51.279 +03:00 [INF] Request starting HTTP/1.1 POST http://localhost:5264/api/auth/signin - application/json 72
2025-01-31 12:11:51.283 +03:00 [INF] Executing endpoint 'NayifatAPI.Controllers.AuthController.SignIn (NayifatAPI)'
2025-01-31 12:11:51.284 +03:00 [INF] Route matched with {action = "SignIn", controller = "Auth"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] SignIn(NayifatAPI.Controllers.SignInRequest) on controller NayifatAPI.Controllers.AuthController (NayifatAPI).
2025-01-31 12:11:51.290 +03:00 [INF] Executing BadRequestObjectResult, writing value of type 'Microsoft.AspNetCore.Mvc.ValidationProblemDetails'.
2025-01-31 12:11:51.292 +03:00 [INF] Executed action NayifatAPI.Controllers.AuthController.SignIn (NayifatAPI) in 5.759ms
2025-01-31 12:11:51.295 +03:00 [INF] Executed endpoint 'NayifatAPI.Controllers.AuthController.SignIn (NayifatAPI)'
2025-01-31 12:11:51.297 +03:00 [INF] Request finished HTTP/1.1 POST http://localhost:5264/api/auth/signin - 400 null application/problem+json; charset=utf-8 17.9662ms
2025-01-31 12:12:53.130 +03:00 [INF] Request starting HTTP/1.1 POST http://localhost:5264/api/auth/signin - application/json 235
2025-01-31 12:12:53.132 +03:00 [INF] Executing endpoint 'NayifatAPI.Controllers.AuthController.SignIn (NayifatAPI)'
2025-01-31 12:12:53.134 +03:00 [INF] Route matched with {action = "SignIn", controller = "Auth"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] SignIn(NayifatAPI.Controllers.SignInRequest) on controller NayifatAPI.Controllers.AuthController (NayifatAPI).
2025-01-31 12:12:53.153 +03:00 [INF] Executing ObjectResult, writing value of type '<>f__AnonymousType11`2[[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-01-31 12:12:53.164 +03:00 [INF] Executed action NayifatAPI.Controllers.AuthController.SignIn (NayifatAPI) in 27.5676ms
2025-01-31 12:12:53.167 +03:00 [INF] Executed endpoint 'NayifatAPI.Controllers.AuthController.SignIn (NayifatAPI)'
2025-01-31 12:12:53.169 +03:00 [INF] Request finished HTTP/1.1 POST http://localhost:5264/api/auth/signin - 401 null application/json; charset=utf-8 38.8079ms
2025-01-31 12:14:14.765 +03:00 [INF] Request starting HTTP/1.1 POST http://localhost:5264/api/auth/signin - application/json 235
2025-01-31 12:14:14.884 +03:00 [INF] Executing endpoint 'NayifatAPI.Controllers.AuthController.SignIn (NayifatAPI)'
2025-01-31 12:14:14.885 +03:00 [INF] Route matched with {action = "SignIn", controller = "Auth"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] SignIn(NayifatAPI.Controllers.SignInRequest) on controller NayifatAPI.Controllers.AuthController (NayifatAPI).
2025-01-31 12:14:19.116 +03:00 [INF] Executed DbCommand (62ms) [Parameters=[@__providedApiKey_0='?' (Size = 255)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [a].[Key], [a].[CreatedAt], [a].[Description], [a].[ExpiresAt], [a].[IsActive], [a].[LastUsedAt]
FROM [ApiKeys] AS [a]
WHERE [a].[Key] = @__providedApiKey_0 AND [a].[IsActive] = CAST(1 AS bit)
2025-01-31 12:14:19.306 +03:00 [INF] Executed DbCommand (46ms) [Parameters=[@__request_NationalId_0='?' (Size = 450)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [c].[NationalId], [c].[AddNo], [c].[BuildingNo], [c].[City], [c].[Consent], [c].[ConsentDate], [c].[DateOfBirth], [c].[Dependents], [c].[District], [c].[Email], [c].[Employer], [c].[FamilyNameAr], [c].[FamilyNameEn], [c].[FirstNameAr], [c].[FirstNameEn], [c].[Iban], [c].[IdExpiryDate], [c].[Los], [c].[Mpin], [c].[MpinEnabled], [c].[NafathStatus], [c].[NafathTimestamp], [c].[Password], [c].[Phone], [c].[RegistrationDate], [c].[SalaryCustomer], [c].[SalaryDakhli], [c].[SecondNameAr], [c].[SecondNameEn], [c].[Sector], [c].[Street], [c].[ThirdNameAr], [c].[ThirdNameEn], [c].[Zipcode]
FROM [Customers] AS [c]
WHERE [c].[NationalId] = @__request_NationalId_0
2025-01-31 12:14:19.440 +03:00 [INF] Executed DbCommand (12ms) [Parameters=[@__request_NationalId_0='?' (Size = 450), @__request_DeviceId_1='?' (Size = 450)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [c].[Id], [c].[BiometricEnabled], [c].[BiometricToken], [c].[CreatedAt], [c].[DeviceId], [c].[LastUsedAt], [c].[Manufacturer], [c].[Model], [c].[NationalId], [c].[OsVersion], [c].[Platform], [c].[Status]
FROM [Customer_Devices] AS [c]
WHERE [c].[NationalId] = @__request_NationalId_0 AND [c].[DeviceId] = @__request_DeviceId_1 AND [c].[Status] = N'active'
2025-01-31 12:14:19.683 +03:00 [INF] Executed DbCommand (12ms) [Parameters=[@p0='?' (Size = 4000), @p1='?' (DbType = DateTime2), @p2='?' (Size = 4000), @p3='?' (Size = 4000), @p4='?' (Size = 4000), @p5='?' (Size = 450), @p6='?' (Size = 4000), @p7='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SET IMPLICIT_TRANSACTIONS OFF;
SET NOCOUNT ON;
INSERT INTO [AuthLogs] ([AuthType], [CreatedAt], [DeviceId], [FailureReason], [IpAddress], [NationalId], [Status], [UserAgent])
OUTPUT INSERTED.[Id]
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7);
2025-01-31 12:14:19.723 +03:00 [INF] Executing ObjectResult, writing value of type '<>f__AnonymousType12`3[[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Object, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-01-31 12:14:19.729 +03:00 [INF] Executed action NayifatAPI.Controllers.AuthController.SignIn (NayifatAPI) in 4840.5336ms
2025-01-31 12:14:19.730 +03:00 [INF] Executed endpoint 'NayifatAPI.Controllers.AuthController.SignIn (NayifatAPI)'
2025-01-31 12:14:19.742 +03:00 [INF] Request finished HTTP/1.1 POST http://localhost:5264/api/auth/signin - 401 null application/json; charset=utf-8 4976.6333ms
2025-01-31 12:18:53.210 +03:00 [INF] Request starting HTTP/1.1 POST http://localhost:5264/api/device - application/json 196
2025-01-31 12:18:53.212 +03:00 [INF] Executing endpoint 'NayifatAPI.Controllers.DeviceController.RegisterDevice (NayifatAPI)'
2025-01-31 12:18:53.222 +03:00 [INF] Route matched with {action = "RegisterDevice", controller = "Device"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] RegisterDevice(NayifatAPI.Controllers.RegisterDeviceRequest) on controller NayifatAPI.Controllers.DeviceController (NayifatAPI).
2025-01-31 12:18:53.239 +03:00 [INF] Executing ObjectResult, writing value of type '<>f__AnonymousType11`2[[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-01-31 12:18:53.242 +03:00 [INF] Executed action NayifatAPI.Controllers.DeviceController.RegisterDevice (NayifatAPI) in 18.2474ms
2025-01-31 12:18:53.244 +03:00 [INF] Executed endpoint 'NayifatAPI.Controllers.DeviceController.RegisterDevice (NayifatAPI)'
2025-01-31 12:18:53.247 +03:00 [INF] Request finished HTTP/1.1 POST http://localhost:5264/api/device - 401 null application/json; charset=utf-8 36.6526ms
2025-01-31 12:19:13.105 +03:00 [INF] Request starting HTTP/1.1 POST http://localhost:5264/api/device - application/json 196
2025-01-31 12:19:13.107 +03:00 [INF] Executing endpoint 'NayifatAPI.Controllers.DeviceController.RegisterDevice (NayifatAPI)'
2025-01-31 12:19:13.108 +03:00 [INF] Route matched with {action = "RegisterDevice", controller = "Device"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] RegisterDevice(NayifatAPI.Controllers.RegisterDeviceRequest) on controller NayifatAPI.Controllers.DeviceController (NayifatAPI).
2025-01-31 12:19:13.220 +03:00 [INF] Executed DbCommand (88ms) [Parameters=[@__providedApiKey_0='?' (Size = 255)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [a].[Key], [a].[CreatedAt], [a].[Description], [a].[ExpiresAt], [a].[IsActive], [a].[LastUsedAt]
FROM [ApiKeys] AS [a]
WHERE [a].[Key] = @__providedApiKey_0 AND [a].[IsActive] = CAST(1 AS bit)
2025-01-31 12:19:13.286 +03:00 [INF] Executed DbCommand (9ms) [Parameters=[@__p_0='?' (Size = 450)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [c].[NationalId], [c].[AddNo], [c].[BuildingNo], [c].[City], [c].[Consent], [c].[ConsentDate], [c].[DateOfBirth], [c].[Dependents], [c].[District], [c].[Email], [c].[Employer], [c].[FamilyNameAr], [c].[FamilyNameEn], [c].[FirstNameAr], [c].[FirstNameEn], [c].[Iban], [c].[IdExpiryDate], [c].[Los], [c].[Mpin], [c].[MpinEnabled], [c].[NafathStatus], [c].[NafathTimestamp], [c].[Password], [c].[Phone], [c].[RegistrationDate], [c].[SalaryCustomer], [c].[SalaryDakhli], [c].[SecondNameAr], [c].[SecondNameEn], [c].[Sector], [c].[Street], [c].[ThirdNameAr], [c].[ThirdNameEn], [c].[Zipcode]
FROM [Customers] AS [c]
WHERE [c].[NationalId] = @__p_0
2025-01-31 12:19:13.334 +03:00 [INF] Executed DbCommand (19ms) [Parameters=[@__request_NationalId_0='?' (Size = 450)], CommandType='"Text"', CommandTimeout='30']
UPDATE [c]
SET [c].[LastUsedAt] = GETUTCDATE(),
    [c].[Status] = N'disabled'
FROM [Customer_Devices] AS [c]
WHERE [c].[NationalId] = @__request_NationalId_0
2025-01-31 12:19:13.430 +03:00 [INF] Executed DbCommand (12ms) [Parameters=[@p0='?' (Size = 4000), @p1='?' (DbType = DateTime2), @p2='?' (Size = 4000), @p3='?' (Size = 4000), @p4='?' (Size = 4000), @p5='?' (Size = 450), @p6='?' (Size = 4000), @p7='?' (Size = 4000), @p8='?' (DbType = Boolean), @p9='?' (Size = 4000), @p10='?' (DbType = DateTime2), @p11='?' (Size = 450), @p12='?' (DbType = DateTime2), @p13='?' (Size = 4000), @p14='?' (Size = 4000), @p15='?' (Size = 450), @p16='?' (Size = 4000), @p17='?' (Size = 4000), @p18='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SET NOCOUNT ON;
INSERT INTO [AuthLogs] ([AuthType], [CreatedAt], [DeviceId], [FailureReason], [IpAddress], [NationalId], [Status], [UserAgent])
OUTPUT INSERTED.[Id]
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7);
INSERT INTO [Customer_Devices] ([BiometricEnabled], [BiometricToken], [CreatedAt], [DeviceId], [LastUsedAt], [Manufacturer], [Model], [NationalId], [OsVersion], [Platform], [Status])
OUTPUT INSERTED.[Id]
VALUES (@p8, @p9, @p10, @p11, @p12, @p13, @p14, @p15, @p16, @p17, @p18);
2025-01-31 12:19:13.451 +03:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType9`2[[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Object, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-01-31 12:19:13.455 +03:00 [INF] Executed action NayifatAPI.Controllers.DeviceController.RegisterDevice (NayifatAPI) in 345.3098ms
2025-01-31 12:19:13.456 +03:00 [INF] Executed endpoint 'NayifatAPI.Controllers.DeviceController.RegisterDevice (NayifatAPI)'
2025-01-31 12:19:13.461 +03:00 [INF] Request finished HTTP/1.1 POST http://localhost:5264/api/device - 200 null application/json; charset=utf-8 355.7621ms
2025-01-31 12:21:11.082 +03:00 [INF] Request starting HTTP/1.1 POST http://localhost:5264/api/auth/signin - application/json 235
2025-01-31 12:21:11.084 +03:00 [INF] Executing endpoint 'NayifatAPI.Controllers.AuthController.SignIn (NayifatAPI)'
2025-01-31 12:21:11.086 +03:00 [INF] Route matched with {action = "SignIn", controller = "Auth"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] SignIn(NayifatAPI.Controllers.SignInRequest) on controller NayifatAPI.Controllers.AuthController (NayifatAPI).
2025-01-31 12:21:11.191 +03:00 [INF] Executed DbCommand (17ms) [Parameters=[@__providedApiKey_0='?' (Size = 255)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [a].[Key], [a].[CreatedAt], [a].[Description], [a].[ExpiresAt], [a].[IsActive], [a].[LastUsedAt]
FROM [ApiKeys] AS [a]
WHERE [a].[Key] = @__providedApiKey_0 AND [a].[IsActive] = CAST(1 AS bit)
2025-01-31 12:21:11.199 +03:00 [INF] Executed DbCommand (4ms) [Parameters=[@__request_NationalId_0='?' (Size = 450)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [c].[NationalId], [c].[AddNo], [c].[BuildingNo], [c].[City], [c].[Consent], [c].[ConsentDate], [c].[DateOfBirth], [c].[Dependents], [c].[District], [c].[Email], [c].[Employer], [c].[FamilyNameAr], [c].[FamilyNameEn], [c].[FirstNameAr], [c].[FirstNameEn], [c].[Iban], [c].[IdExpiryDate], [c].[Los], [c].[Mpin], [c].[MpinEnabled], [c].[NafathStatus], [c].[NafathTimestamp], [c].[Password], [c].[Phone], [c].[RegistrationDate], [c].[SalaryCustomer], [c].[SalaryDakhli], [c].[SecondNameAr], [c].[SecondNameEn], [c].[Sector], [c].[Street], [c].[ThirdNameAr], [c].[ThirdNameEn], [c].[Zipcode]
FROM [Customers] AS [c]
WHERE [c].[NationalId] = @__request_NationalId_0
2025-01-31 12:21:11.209 +03:00 [INF] Executed DbCommand (6ms) [Parameters=[@__request_NationalId_0='?' (Size = 450), @__request_DeviceId_1='?' (Size = 450)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [c].[Id], [c].[BiometricEnabled], [c].[BiometricToken], [c].[CreatedAt], [c].[DeviceId], [c].[LastUsedAt], [c].[Manufacturer], [c].[Model], [c].[NationalId], [c].[OsVersion], [c].[Platform], [c].[Status]
FROM [Customer_Devices] AS [c]
WHERE [c].[NationalId] = @__request_NationalId_0 AND [c].[DeviceId] = @__request_DeviceId_1 AND [c].[Status] = N'active'
2025-01-31 12:21:11.226 +03:00 [INF] Executed DbCommand (4ms) [Parameters=[@p0='?' (Size = 4000), @p1='?' (DbType = DateTime2), @p2='?' (Size = 4000), @p3='?' (Size = 4000), @p4='?' (Size = 4000), @p5='?' (Size = 450), @p6='?' (Size = 4000), @p7='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SET IMPLICIT_TRANSACTIONS OFF;
SET NOCOUNT ON;
INSERT INTO [AuthLogs] ([AuthType], [CreatedAt], [DeviceId], [FailureReason], [IpAddress], [NationalId], [Status], [UserAgent])
OUTPUT INSERTED.[Id]
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7);
2025-01-31 12:21:11.238 +03:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType9`2[[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Object, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-01-31 12:21:11.241 +03:00 [INF] Executed action NayifatAPI.Controllers.AuthController.SignIn (NayifatAPI) in 152.6458ms
2025-01-31 12:21:11.243 +03:00 [INF] Executed endpoint 'NayifatAPI.Controllers.AuthController.SignIn (NayifatAPI)'
2025-01-31 12:21:11.244 +03:00 [INF] Request finished HTTP/1.1 POST http://localhost:5264/api/auth/signin - 200 null application/json; charset=utf-8 162.4655ms
2025-01-31 13:04:05.914 +03:00 [INF] Request starting HTTP/1.1 POST http://localhost:5264/api/proxy/forward - application/json 435
2025-01-31 13:04:05.958 +03:00 [INF] Executing endpoint 'NayifatAPI.Controllers.ProxyController.ForwardRequest (NayifatAPI)'
2025-01-31 13:04:05.971 +03:00 [INF] Route matched with {action = "ForwardRequest", controller = "Proxy"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] ForwardRequest(NayifatAPI.Controllers.ProxyRequest) on controller NayifatAPI.Controllers.ProxyController (NayifatAPI).
2025-01-31 13:04:06.096 +03:00 [INF] Executed DbCommand (93ms) [Parameters=[@__providedApiKey_0='?' (Size = 255)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [a].[Key], [a].[CreatedAt], [a].[Description], [a].[ExpiresAt], [a].[IsActive], [a].[LastUsedAt]
FROM [ApiKeys] AS [a]
WHERE [a].[Key] = @__providedApiKey_0 AND [a].[IsActive] = CAST(1 AS bit)
2025-01-31 13:04:06.226 +03:00 [INF] Start processing HTTP request POST http://localhost:5000/testasp/test_local_generate_otp.php
2025-01-31 13:04:06.229 +03:00 [INF] Sending HTTP request POST http://localhost:5000/testasp/test_local_generate_otp.php
2025-01-31 13:04:08.584 +03:00 [INF] Received HTTP response headers after 2350.7196ms - 404
2025-01-31 13:04:08.586 +03:00 [INF] End processing HTTP request after 2361.605ms - 404
2025-01-31 13:04:08.596 +03:00 [INF] Executing ContentResult with HTTP Response ContentType of text/html; charset=utf-8
2025-01-31 13:04:08.600 +03:00 [INF] Executed action NayifatAPI.Controllers.ProxyController.ForwardRequest (NayifatAPI) in 2626.002ms
2025-01-31 13:04:08.603 +03:00 [INF] Executed endpoint 'NayifatAPI.Controllers.ProxyController.ForwardRequest (NayifatAPI)'
2025-01-31 13:04:08.607 +03:00 [INF] Request finished HTTP/1.1 POST http://localhost:5264/api/proxy/forward - 200 207 text/html; charset=utf-8 2692.5533ms
2025-01-31 13:04:52.144 +03:00 [INF] Request starting HTTP/1.1 POST http://localhost:5264/api/proxy/forward - application/json 463
2025-01-31 13:04:52.147 +03:00 [INF] Executing endpoint 'NayifatAPI.Controllers.ProxyController.ForwardRequest (NayifatAPI)'
2025-01-31 13:04:52.149 +03:00 [INF] Route matched with {action = "ForwardRequest", controller = "Proxy"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] ForwardRequest(NayifatAPI.Controllers.ProxyRequest) on controller NayifatAPI.Controllers.ProxyController (NayifatAPI).
2025-01-31 13:04:52.178 +03:00 [INF] Executed DbCommand (24ms) [Parameters=[@__providedApiKey_0='?' (Size = 255)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [a].[Key], [a].[CreatedAt], [a].[Description], [a].[ExpiresAt], [a].[IsActive], [a].[LastUsedAt]
FROM [ApiKeys] AS [a]
WHERE [a].[Key] = @__providedApiKey_0 AND [a].[IsActive] = CAST(1 AS bit)
2025-01-31 13:04:52.182 +03:00 [INF] Start processing HTTP request POST http://localhost:5000/https://icreditdept.com/api/testasp/test_local_generate_otp.php
2025-01-31 13:04:52.183 +03:00 [INF] Sending HTTP request POST http://localhost:5000/https://icreditdept.com/api/testasp/test_local_generate_otp.php
2025-01-31 13:04:54.208 +03:00 [INF] Received HTTP response headers after 2023.5667ms - 404
2025-01-31 13:04:54.210 +03:00 [INF] End processing HTTP request after 2027.7697ms - 404
2025-01-31 13:04:54.212 +03:00 [INF] Executing ContentResult with HTTP Response ContentType of text/html; charset=utf-8
2025-01-31 13:04:54.215 +03:00 [INF] Executed action NayifatAPI.Controllers.ProxyController.ForwardRequest (NayifatAPI) in 2063.2767ms
2025-01-31 13:04:54.217 +03:00 [INF] Executed endpoint 'NayifatAPI.Controllers.ProxyController.ForwardRequest (NayifatAPI)'
2025-01-31 13:04:54.219 +03:00 [INF] Request finished HTTP/1.1 POST http://localhost:5264/api/proxy/forward - 200 207 text/html; charset=utf-8 2075.2136ms
2025-01-31 13:06:04.901 +03:00 [INF] Request starting HTTP/1.1 POST http://localhost:5264/api/proxy/forward - application/json 435
2025-01-31 13:06:04.906 +03:00 [INF] Executing endpoint 'NayifatAPI.Controllers.ProxyController.ForwardRequest (NayifatAPI)'
2025-01-31 13:06:04.907 +03:00 [INF] Route matched with {action = "ForwardRequest", controller = "Proxy"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] ForwardRequest(NayifatAPI.Controllers.ProxyRequest) on controller NayifatAPI.Controllers.ProxyController (NayifatAPI).
2025-01-31 13:06:05.007 +03:00 [INF] Executed DbCommand (92ms) [Parameters=[@__providedApiKey_0='?' (Size = 255)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [a].[Key], [a].[CreatedAt], [a].[Description], [a].[ExpiresAt], [a].[IsActive], [a].[LastUsedAt]
FROM [ApiKeys] AS [a]
WHERE [a].[Key] = @__providedApiKey_0 AND [a].[IsActive] = CAST(1 AS bit)
2025-01-31 13:06:05.009 +03:00 [INF] Start processing HTTP request POST https://icreditdept.com/api/testasp/test_local_generate_otp.php
2025-01-31 13:06:05.011 +03:00 [INF] Sending HTTP request POST https://icreditdept.com/api/testasp/test_local_generate_otp.php
2025-01-31 13:06:06.331 +03:00 [INF] Received HTTP response headers after 1319.2193ms - 200
2025-01-31 13:06:06.332 +03:00 [INF] End processing HTTP request after 1323.6089ms - 200
2025-01-31 13:06:06.337 +03:00 [WRN] Error parsing response content. Returning as plain text.
System.Text.Json.JsonException: '0x1F' is an invalid start of a value. Path: $ | LineNumber: 0 | BytePositionInLine: 0.
 ---> System.Text.Json.JsonReaderException: '0x1F' is an invalid start of a value. LineNumber: 0 | BytePositionInLine: 0.
   at System.Text.Json.ThrowHelper.ThrowJsonReaderException(Utf8JsonReader& json, ExceptionResource resource, Byte nextByte, ReadOnlySpan`1 bytes)
   at System.Text.Json.Utf8JsonReader.ConsumeValue(Byte marker)
   at System.Text.Json.Utf8JsonReader.ReadFirstToken(Byte first)
   at System.Text.Json.Utf8JsonReader.ReadSingleSegment()
   at System.Text.Json.Utf8JsonReader.Read()
   at System.Text.Json.Serialization.JsonConverter`1.ReadCore(Utf8JsonReader& reader, JsonSerializerOptions options, ReadStack& state)
   --- End of inner exception stack trace ---
   at System.Text.Json.ThrowHelper.ReThrowWithPath(ReadStack& state, JsonReaderException ex)
   at System.Text.Json.Serialization.JsonConverter`1.ReadCore(Utf8JsonReader& reader, JsonSerializerOptions options, ReadStack& state)
   at System.Text.Json.JsonSerializer.ReadFromSpan[TValue](ReadOnlySpan`1 utf8Json, JsonTypeInfo`1 jsonTypeInfo, Nullable`1 actualByteCount)
   at System.Text.Json.JsonSerializer.ReadFromSpan[TValue](ReadOnlySpan`1 json, JsonTypeInfo`1 jsonTypeInfo)
   at System.Text.Json.JsonSerializer.Deserialize[TValue](String json, JsonSerializerOptions options)
   at NayifatAPI.Controllers.ProxyController.ForwardRequest(ProxyRequest request) in C:\Users\yamta\StudioProjects\nayifat_app_2025_new\nayifatapi\Controllers\ProxyController.cs:line 111
2025-01-31 13:06:06.365 +03:00 [INF] Executing ContentResult with HTTP Response ContentType of text/plain; charset=utf-8
2025-01-31 13:06:06.366 +03:00 [INF] Executed action NayifatAPI.Controllers.ProxyController.ForwardRequest (NayifatAPI) in 1456.4225ms
2025-01-31 13:06:06.368 +03:00 [INF] Executed endpoint 'NayifatAPI.Controllers.ProxyController.ForwardRequest (NayifatAPI)'
2025-01-31 13:06:06.369 +03:00 [INF] Request finished HTTP/1.1 POST http://localhost:5264/api/proxy/forward - 200 311 text/plain; charset=utf-8 1468.2063ms
2025-01-31 13:08:10.899 +03:00 [INF] Request starting HTTP/1.1 POST http://localhost:5264/api/proxy/forward - application/json 503
2025-01-31 13:08:10.901 +03:00 [INF] Executing endpoint 'NayifatAPI.Controllers.ProxyController.ForwardRequest (NayifatAPI)'
2025-01-31 13:08:10.902 +03:00 [INF] Route matched with {action = "ForwardRequest", controller = "Proxy"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] ForwardRequest(NayifatAPI.Controllers.ProxyRequest) on controller NayifatAPI.Controllers.ProxyController (NayifatAPI).
2025-01-31 13:08:10.925 +03:00 [INF] Executed DbCommand (18ms) [Parameters=[@__providedApiKey_0='?' (Size = 255)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [a].[Key], [a].[CreatedAt], [a].[Description], [a].[ExpiresAt], [a].[IsActive], [a].[LastUsedAt]
FROM [ApiKeys] AS [a]
WHERE [a].[Key] = @__providedApiKey_0 AND [a].[IsActive] = CAST(1 AS bit)
2025-01-31 13:08:10.928 +03:00 [INF] Start processing HTTP request POST https://icreditdept.com/api/https://icreditdept.com/api/testasp/test_local_generate_otp.php
2025-01-31 13:08:10.930 +03:00 [INF] Sending HTTP request POST https://icreditdept.com/api/https://icreditdept.com/api/testasp/test_local_generate_otp.php
2025-01-31 13:08:11.586 +03:00 [INF] Received HTTP response headers after 654.8725ms - 200
2025-01-31 13:08:11.587 +03:00 [INF] End processing HTTP request after 658.3838ms - 200
2025-01-31 13:08:11.592 +03:00 [INF] Executing ContentResult with HTTP Response ContentType of text/html; charset=utf-8
2025-01-31 13:08:11.593 +03:00 [INF] Executed action NayifatAPI.Controllers.ProxyController.ForwardRequest (NayifatAPI) in 689.5566ms
2025-01-31 13:08:11.594 +03:00 [INF] Executed endpoint 'NayifatAPI.Controllers.ProxyController.ForwardRequest (NayifatAPI)'
2025-01-31 13:08:11.596 +03:00 [INF] Request finished HTTP/1.1 POST http://localhost:5264/api/proxy/forward - 200 929 text/html; charset=utf-8 696.7361ms
2025-01-31 13:09:22.127 +03:00 [INF] Request starting HTTP/1.1 POST http://localhost:5264/api/proxy/forward - application/json 231
2025-01-31 13:09:22.130 +03:00 [INF] Executing endpoint 'NayifatAPI.Controllers.ProxyController.ForwardRequest (NayifatAPI)'
2025-01-31 13:09:22.131 +03:00 [INF] Route matched with {action = "ForwardRequest", controller = "Proxy"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] ForwardRequest(NayifatAPI.Controllers.ProxyRequest) on controller NayifatAPI.Controllers.ProxyController (NayifatAPI).
2025-01-31 13:09:22.225 +03:00 [INF] Executed DbCommand (90ms) [Parameters=[@__providedApiKey_0='?' (Size = 255)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [a].[Key], [a].[CreatedAt], [a].[Description], [a].[ExpiresAt], [a].[IsActive], [a].[LastUsedAt]
FROM [ApiKeys] AS [a]
WHERE [a].[Key] = @__providedApiKey_0 AND [a].[IsActive] = CAST(1 AS bit)
2025-01-31 13:09:22.228 +03:00 [INF] Start processing HTTP request POST https://icreditdept.com/api/testasp/test_local_generate_otp.php
2025-01-31 13:09:22.229 +03:00 [INF] Sending HTTP request POST https://icreditdept.com/api/testasp/test_local_generate_otp.php
2025-01-31 13:09:22.651 +03:00 [INF] Received HTTP response headers after 420.6369ms - 200
2025-01-31 13:09:22.652 +03:00 [INF] End processing HTTP request after 424.2192ms - 200
2025-01-31 13:09:22.653 +03:00 [WRN] Error parsing response content. Returning as plain text.
System.Text.Json.JsonException: '0x1F' is an invalid start of a value. Path: $ | LineNumber: 0 | BytePositionInLine: 0.
 ---> System.Text.Json.JsonReaderException: '0x1F' is an invalid start of a value. LineNumber: 0 | BytePositionInLine: 0.
   at System.Text.Json.ThrowHelper.ThrowJsonReaderException(Utf8JsonReader& json, ExceptionResource resource, Byte nextByte, ReadOnlySpan`1 bytes)
   at System.Text.Json.Utf8JsonReader.ConsumeValue(Byte marker)
   at System.Text.Json.Utf8JsonReader.ReadFirstToken(Byte first)
   at System.Text.Json.Utf8JsonReader.ReadSingleSegment()
   at System.Text.Json.Utf8JsonReader.Read()
   at System.Text.Json.Serialization.JsonConverter`1.ReadCore(Utf8JsonReader& reader, JsonSerializerOptions options, ReadStack& state)
   --- End of inner exception stack trace ---
   at System.Text.Json.ThrowHelper.ReThrowWithPath(ReadStack& state, JsonReaderException ex)
   at System.Text.Json.Serialization.JsonConverter`1.ReadCore(Utf8JsonReader& reader, JsonSerializerOptions options, ReadStack& state)
   at System.Text.Json.JsonSerializer.ReadFromSpan[TValue](ReadOnlySpan`1 utf8Json, JsonTypeInfo`1 jsonTypeInfo, Nullable`1 actualByteCount)
   at System.Text.Json.JsonSerializer.ReadFromSpan[TValue](ReadOnlySpan`1 json, JsonTypeInfo`1 jsonTypeInfo)
   at System.Text.Json.JsonSerializer.Deserialize[TValue](String json, JsonSerializerOptions options)
   at NayifatAPI.Controllers.ProxyController.ForwardRequest(ProxyRequest request) in C:\Users\yamta\StudioProjects\nayifat_app_2025_new\nayifatapi\Controllers\ProxyController.cs:line 111
2025-01-31 13:09:22.665 +03:00 [INF] Executing ContentResult with HTTP Response ContentType of text/plain; charset=utf-8
2025-01-31 13:09:22.669 +03:00 [INF] Executed action NayifatAPI.Controllers.ProxyController.ForwardRequest (NayifatAPI) in 535.8799ms
2025-01-31 13:09:22.670 +03:00 [INF] Executed endpoint 'NayifatAPI.Controllers.ProxyController.ForwardRequest (NayifatAPI)'
2025-01-31 13:09:22.676 +03:00 [INF] Request finished HTTP/1.1 POST http://localhost:5264/api/proxy/forward - 200 295 text/plain; charset=utf-8 548.7979ms
2025-01-31 13:11:37.304 +03:00 [INF] Request starting HTTP/1.1 POST http://localhost:5264/api/proxy/otp/generate - application/json 107
2025-01-31 13:11:37.309 +03:00 [INF] Request finished HTTP/1.1 POST http://localhost:5264/api/proxy/otp/generate - 404 0 null 5.654ms
2025-01-31 13:11:37.313 +03:00 [INF] Request reached the end of the middleware pipeline without being handled by application code. Request path: POST http://localhost:5264/api/proxy/otp/generate, Response status code: 404
2025-01-31 13:11:50.848 +03:00 [INF] Request starting HTTP/1.1 POST http://localhost:5264/api/proxy/otp/generate - application/json 107
2025-01-31 13:11:50.850 +03:00 [INF] Request finished HTTP/1.1 POST http://localhost:5264/api/proxy/otp/generate - 404 0 null 2.0613ms
2025-01-31 13:11:50.853 +03:00 [INF] Request reached the end of the middleware pipeline without being handled by application code. Request path: POST http://localhost:5264/api/proxy/otp/generate, Response status code: 404
2025-01-31 13:12:31.023 +03:00 [INF] Request starting HTTP/1.1 POST http://localhost:5264/api/proxy/otp/generate - application/json 107
2025-01-31 13:12:31.025 +03:00 [INF] Request finished HTTP/1.1 POST http://localhost:5264/api/proxy/otp/generate - 404 0 null 1.7795ms
2025-01-31 13:12:31.029 +03:00 [INF] Request reached the end of the middleware pipeline without being handled by application code. Request path: POST http://localhost:5264/api/proxy/otp/generate, Response status code: 404
2025-01-31 13:14:36.401 +03:00 [INF] Request starting HTTP/1.1 POST http://localhost:5264/api/proxy/forward - application/json 308
2025-01-31 13:14:36.410 +03:00 [INF] Executing endpoint 'NayifatAPI.Controllers.ProxyController.ForwardRequest (NayifatAPI)'
2025-01-31 13:14:36.416 +03:00 [INF] Route matched with {action = "ForwardRequest", controller = "Proxy"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] ForwardRequest(NayifatAPI.Controllers.ProxyRequest) on controller NayifatAPI.Controllers.ProxyController (NayifatAPI).
2025-01-31 13:14:36.794 +03:00 [INF] Executing BadRequestObjectResult, writing value of type 'Microsoft.AspNetCore.Mvc.ValidationProblemDetails'.
2025-01-31 13:14:36.808 +03:00 [INF] Executed action NayifatAPI.Controllers.ProxyController.ForwardRequest (NayifatAPI) in 16.4389ms
2025-01-31 13:14:36.818 +03:00 [INF] Executed endpoint 'NayifatAPI.Controllers.ProxyController.ForwardRequest (NayifatAPI)'
2025-01-31 13:14:36.822 +03:00 [INF] Request finished HTTP/1.1 POST http://localhost:5264/api/proxy/forward - 400 null application/problem+json; charset=utf-8 420.8ms
2025-01-31 13:16:04.569 +03:00 [INF] Request starting HTTP/1.1 POST http://localhost:5264/api/proxy/forward - application/json 308
2025-01-31 13:16:04.571 +03:00 [INF] Executing endpoint 'NayifatAPI.Controllers.ProxyController.ForwardRequest (NayifatAPI)'
2025-01-31 13:16:04.572 +03:00 [INF] Route matched with {action = "ForwardRequest", controller = "Proxy"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] ForwardRequest(NayifatAPI.Controllers.ProxyRequest) on controller NayifatAPI.Controllers.ProxyController (NayifatAPI).
2025-01-31 13:16:04.574 +03:00 [INF] Executing BadRequestObjectResult, writing value of type 'Microsoft.AspNetCore.Mvc.ValidationProblemDetails'.
2025-01-31 13:16:04.577 +03:00 [INF] Executed action NayifatAPI.Controllers.ProxyController.ForwardRequest (NayifatAPI) in 3.4252ms
2025-01-31 13:16:04.580 +03:00 [INF] Executed endpoint 'NayifatAPI.Controllers.ProxyController.ForwardRequest (NayifatAPI)'
2025-01-31 13:16:04.581 +03:00 [INF] Request finished HTTP/1.1 POST http://localhost:5264/api/proxy/forward - 400 null application/problem+json; charset=utf-8 12.0456ms
2025-01-31 13:16:42.874 +03:00 [INF] Request starting HTTP/1.1 POST http://localhost:5264/api/proxy/forward - application/json 316
2025-01-31 13:16:42.876 +03:00 [INF] Executing endpoint 'NayifatAPI.Controllers.ProxyController.ForwardRequest (NayifatAPI)'
2025-01-31 13:16:42.878 +03:00 [INF] Route matched with {action = "ForwardRequest", controller = "Proxy"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] ForwardRequest(NayifatAPI.Controllers.ProxyRequest) on controller NayifatAPI.Controllers.ProxyController (NayifatAPI).
2025-01-31 13:16:42.982 +03:00 [INF] Executed DbCommand (17ms) [Parameters=[@__providedApiKey_0='?' (Size = 255)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [a].[Key], [a].[CreatedAt], [a].[Description], [a].[ExpiresAt], [a].[IsActive], [a].[LastUsedAt]
FROM [ApiKeys] AS [a]
WHERE [a].[Key] = @__providedApiKey_0 AND [a].[IsActive] = CAST(1 AS bit)
2025-01-31 13:16:42.986 +03:00 [INF] Start processing HTTP request POST https://icreditdept.com/api/https://icreditdept.com/api/testasp/test_local_generate_otp.php
2025-01-31 13:16:42.987 +03:00 [INF] Sending HTTP request POST https://icreditdept.com/api/https://icreditdept.com/api/testasp/test_local_generate_otp.php
2025-01-31 13:16:43.712 +03:00 [INF] Received HTTP response headers after 723.3547ms - 200
2025-01-31 13:16:43.713 +03:00 [INF] End processing HTTP request after 727.1064ms - 200
2025-01-31 13:16:43.714 +03:00 [INF] Executing ContentResult with HTTP Response ContentType of text/html; charset=utf-8
2025-01-31 13:16:43.715 +03:00 [INF] Executed action NayifatAPI.Controllers.ProxyController.ForwardRequest (NayifatAPI) in 834.6839ms
2025-01-31 13:16:43.716 +03:00 [INF] Executed endpoint 'NayifatAPI.Controllers.ProxyController.ForwardRequest (NayifatAPI)'
2025-01-31 13:16:43.718 +03:00 [INF] Request finished HTTP/1.1 POST http://localhost:5264/api/proxy/forward - 200 929 text/html; charset=utf-8 843.9051ms
2025-01-31 13:17:24.322 +03:00 [INF] Request starting HTTP/1.1 POST http://localhost:5264/api/proxy/forward - application/json 316
2025-01-31 13:17:24.326 +03:00 [INF] Executing endpoint 'NayifatAPI.Controllers.ProxyController.ForwardRequest (NayifatAPI)'
2025-01-31 13:17:24.327 +03:00 [INF] Route matched with {action = "ForwardRequest", controller = "Proxy"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] ForwardRequest(NayifatAPI.Controllers.ProxyRequest) on controller NayifatAPI.Controllers.ProxyController (NayifatAPI).
2025-01-31 13:17:24.330 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@__providedApiKey_0='?' (Size = 255)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [a].[Key], [a].[CreatedAt], [a].[Description], [a].[ExpiresAt], [a].[IsActive], [a].[LastUsedAt]
FROM [ApiKeys] AS [a]
WHERE [a].[Key] = @__providedApiKey_0 AND [a].[IsActive] = CAST(1 AS bit)
2025-01-31 13:17:24.333 +03:00 [INF] Start processing HTTP request POST https://icreditdept.com/api/https://icreditdept.com/api/testasp/test_local_generate_otp.php
2025-01-31 13:17:24.335 +03:00 [INF] Sending HTTP request POST https://icreditdept.com/api/https://icreditdept.com/api/testasp/test_local_generate_otp.php
2025-01-31 13:17:24.745 +03:00 [INF] Received HTTP response headers after 409.9127ms - 200
2025-01-31 13:17:24.748 +03:00 [INF] End processing HTTP request after 414.4188ms - 200
2025-01-31 13:17:24.749 +03:00 [INF] Executing ContentResult with HTTP Response ContentType of text/html; charset=utf-8
2025-01-31 13:17:24.750 +03:00 [INF] Executed action NayifatAPI.Controllers.ProxyController.ForwardRequest (NayifatAPI) in 422.0819ms
2025-01-31 13:17:24.751 +03:00 [INF] Executed endpoint 'NayifatAPI.Controllers.ProxyController.ForwardRequest (NayifatAPI)'
2025-01-31 13:17:24.752 +03:00 [INF] Request finished HTTP/1.1 POST http://localhost:5264/api/proxy/forward - 200 929 text/html; charset=utf-8 430.0856ms
2025-01-31 13:17:51.180 +03:00 [INF] Request starting HTTP/1.1 POST http://localhost:5264/api/proxy/forward - application/json 316
2025-01-31 13:17:51.181 +03:00 [INF] Executing endpoint 'NayifatAPI.Controllers.ProxyController.ForwardRequest (NayifatAPI)'
2025-01-31 13:17:51.182 +03:00 [INF] Route matched with {action = "ForwardRequest", controller = "Proxy"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] ForwardRequest(NayifatAPI.Controllers.ProxyRequest) on controller NayifatAPI.Controllers.ProxyController (NayifatAPI).
2025-01-31 13:17:51.276 +03:00 [INF] Executed DbCommand (89ms) [Parameters=[@__providedApiKey_0='?' (Size = 255)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [a].[Key], [a].[CreatedAt], [a].[Description], [a].[ExpiresAt], [a].[IsActive], [a].[LastUsedAt]
FROM [ApiKeys] AS [a]
WHERE [a].[Key] = @__providedApiKey_0 AND [a].[IsActive] = CAST(1 AS bit)
2025-01-31 13:17:51.277 +03:00 [INF] Start processing HTTP request POST https://icreditdept.com/api/https://icreditdept.com/api/testasp/test_local_generate_otp.php
2025-01-31 13:17:51.278 +03:00 [INF] Sending HTTP request POST https://icreditdept.com/api/https://icreditdept.com/api/testasp/test_local_generate_otp.php
2025-01-31 13:17:51.693 +03:00 [INF] Received HTTP response headers after 414.4324ms - 200
2025-01-31 13:17:51.695 +03:00 [INF] End processing HTTP request after 417.9282ms - 200
2025-01-31 13:17:51.696 +03:00 [INF] Executing ContentResult with HTTP Response ContentType of text/html; charset=utf-8
2025-01-31 13:17:51.697 +03:00 [INF] Executed action NayifatAPI.Controllers.ProxyController.ForwardRequest (NayifatAPI) in 513.6813ms
2025-01-31 13:17:51.698 +03:00 [INF] Executed endpoint 'NayifatAPI.Controllers.ProxyController.ForwardRequest (NayifatAPI)'
2025-01-31 13:17:51.699 +03:00 [INF] Request finished HTTP/1.1 POST http://localhost:5264/api/proxy/forward - 200 929 text/html; charset=utf-8 519.2318ms
2025-01-31 13:18:32.305 +03:00 [INF] Request starting HTTP/1.1 POST http://localhost:5264/api/proxy/forward - application/json 316
2025-01-31 13:18:32.311 +03:00 [INF] Executing endpoint 'NayifatAPI.Controllers.ProxyController.ForwardRequest (NayifatAPI)'
2025-01-31 13:18:32.313 +03:00 [INF] Route matched with {action = "ForwardRequest", controller = "Proxy"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] ForwardRequest(NayifatAPI.Controllers.ProxyRequest) on controller NayifatAPI.Controllers.ProxyController (NayifatAPI).
2025-01-31 13:18:32.317 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@__providedApiKey_0='?' (Size = 255)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [a].[Key], [a].[CreatedAt], [a].[Description], [a].[ExpiresAt], [a].[IsActive], [a].[LastUsedAt]
FROM [ApiKeys] AS [a]
WHERE [a].[Key] = @__providedApiKey_0 AND [a].[IsActive] = CAST(1 AS bit)
2025-01-31 13:18:32.320 +03:00 [INF] Start processing HTTP request POST https://icreditdept.com/api/https://icreditdept.com/api/testasp/test_local_generate_otp.php
2025-01-31 13:18:32.321 +03:00 [INF] Sending HTTP request POST https://icreditdept.com/api/https://icreditdept.com/api/testasp/test_local_generate_otp.php
2025-01-31 13:18:32.759 +03:00 [INF] Received HTTP response headers after 436.9412ms - 200
2025-01-31 13:18:32.761 +03:00 [INF] End processing HTTP request after 440.6767ms - 200
2025-01-31 13:18:32.762 +03:00 [INF] Executing ContentResult with HTTP Response ContentType of text/html; charset=utf-8
2025-01-31 13:18:32.763 +03:00 [INF] Executed action NayifatAPI.Controllers.ProxyController.ForwardRequest (NayifatAPI) in 448.6874ms
2025-01-31 13:18:32.764 +03:00 [INF] Executed endpoint 'NayifatAPI.Controllers.ProxyController.ForwardRequest (NayifatAPI)'
2025-01-31 13:18:32.765 +03:00 [INF] Request finished HTTP/1.1 POST http://localhost:5264/api/proxy/forward - 200 929 text/html; charset=utf-8 460.3475ms
2025-01-31 13:18:41.077 +03:00 [INF] Request starting HTTP/1.1 POST http://localhost:5264/api/proxy/forward - application/json 316
2025-01-31 13:18:41.079 +03:00 [INF] Executing endpoint 'NayifatAPI.Controllers.ProxyController.ForwardRequest (NayifatAPI)'
2025-01-31 13:18:41.079 +03:00 [INF] Route matched with {action = "ForwardRequest", controller = "Proxy"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] ForwardRequest(NayifatAPI.Controllers.ProxyRequest) on controller NayifatAPI.Controllers.ProxyController (NayifatAPI).
2025-01-31 13:18:41.083 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@__providedApiKey_0='?' (Size = 255)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [a].[Key], [a].[CreatedAt], [a].[Description], [a].[ExpiresAt], [a].[IsActive], [a].[LastUsedAt]
FROM [ApiKeys] AS [a]
WHERE [a].[Key] = @__providedApiKey_0 AND [a].[IsActive] = CAST(1 AS bit)
2025-01-31 13:18:41.085 +03:00 [INF] Start processing HTTP request POST https://icreditdept.com/api/https://icreditdept.com/api/testasp/test_local_generate_otp.php
2025-01-31 13:18:41.086 +03:00 [INF] Sending HTTP request POST https://icreditdept.com/api/https://icreditdept.com/api/testasp/test_local_generate_otp.php
2025-01-31 13:18:41.501 +03:00 [INF] Received HTTP response headers after 414.2538ms - 200
2025-01-31 13:18:41.503 +03:00 [INF] End processing HTTP request after 418.0008ms - 200
2025-01-31 13:18:41.507 +03:00 [INF] Executing ContentResult with HTTP Response ContentType of text/html; charset=utf-8
2025-01-31 13:18:41.510 +03:00 [INF] Executed action NayifatAPI.Controllers.ProxyController.ForwardRequest (NayifatAPI) in 428.8602ms
2025-01-31 13:18:41.512 +03:00 [INF] Executed endpoint 'NayifatAPI.Controllers.ProxyController.ForwardRequest (NayifatAPI)'
2025-01-31 13:18:41.513 +03:00 [INF] Request finished HTTP/1.1 POST http://localhost:5264/api/proxy/forward - 200 929 text/html; charset=utf-8 436.1803ms
2025-01-31 13:19:43.826 +03:00 [INF] Request starting HTTP/1.1 POST http://localhost:5264/api/proxy/forward - application/json 316
2025-01-31 13:19:43.830 +03:00 [INF] Executing endpoint 'NayifatAPI.Controllers.ProxyController.ForwardRequest (NayifatAPI)'
2025-01-31 13:19:43.831 +03:00 [INF] Route matched with {action = "ForwardRequest", controller = "Proxy"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] ForwardRequest(NayifatAPI.Controllers.ProxyRequest) on controller NayifatAPI.Controllers.ProxyController (NayifatAPI).
2025-01-31 13:19:43.923 +03:00 [INF] Executed DbCommand (89ms) [Parameters=[@__providedApiKey_0='?' (Size = 255)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [a].[Key], [a].[CreatedAt], [a].[Description], [a].[ExpiresAt], [a].[IsActive], [a].[LastUsedAt]
FROM [ApiKeys] AS [a]
WHERE [a].[Key] = @__providedApiKey_0 AND [a].[IsActive] = CAST(1 AS bit)
2025-01-31 13:19:43.928 +03:00 [INF] Start processing HTTP request POST https://icreditdept.com/api/https://icreditdept.com/api/testasp/test_local_generate_otp.php
2025-01-31 13:19:43.929 +03:00 [INF] Sending HTTP request POST https://icreditdept.com/api/https://icreditdept.com/api/testasp/test_local_generate_otp.php
2025-01-31 13:19:44.560 +03:00 [INF] Received HTTP response headers after 630.2476ms - 200
2025-01-31 13:19:44.562 +03:00 [INF] End processing HTTP request after 633.9257ms - 200
2025-01-31 13:19:44.564 +03:00 [INF] Executing ContentResult with HTTP Response ContentType of text/html; charset=utf-8
2025-01-31 13:19:44.565 +03:00 [INF] Executed action NayifatAPI.Controllers.ProxyController.ForwardRequest (NayifatAPI) in 732.4063ms
2025-01-31 13:19:44.565 +03:00 [INF] Executed endpoint 'NayifatAPI.Controllers.ProxyController.ForwardRequest (NayifatAPI)'
2025-01-31 13:19:44.566 +03:00 [INF] Request finished HTTP/1.1 POST http://localhost:5264/api/proxy/forward - 200 929 text/html; charset=utf-8 739.9667ms
2025-01-31 13:19:52.680 +03:00 [INF] Request starting HTTP/1.1 POST http://localhost:5264/api/proxy/forward - application/json 316
2025-01-31 13:19:52.682 +03:00 [INF] Executing endpoint 'NayifatAPI.Controllers.ProxyController.ForwardRequest (NayifatAPI)'
2025-01-31 13:19:52.683 +03:00 [INF] Route matched with {action = "ForwardRequest", controller = "Proxy"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] ForwardRequest(NayifatAPI.Controllers.ProxyRequest) on controller NayifatAPI.Controllers.ProxyController (NayifatAPI).
2025-01-31 13:19:52.836 +03:00 [INF] Executed DbCommand (148ms) [Parameters=[@__providedApiKey_0='?' (Size = 255)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [a].[Key], [a].[CreatedAt], [a].[Description], [a].[ExpiresAt], [a].[IsActive], [a].[LastUsedAt]
FROM [ApiKeys] AS [a]
WHERE [a].[Key] = @__providedApiKey_0 AND [a].[IsActive] = CAST(1 AS bit)
2025-01-31 13:19:52.844 +03:00 [INF] Start processing HTTP request POST https://icreditdept.com/api/https://icreditdept.com/api/testasp/test_local_generate_otp.php
2025-01-31 13:19:52.846 +03:00 [INF] Sending HTTP request POST https://icreditdept.com/api/https://icreditdept.com/api/testasp/test_local_generate_otp.php
2025-01-31 13:19:53.331 +03:00 [INF] Received HTTP response headers after 483.4648ms - 200
2025-01-31 13:19:53.380 +03:00 [INF] End processing HTTP request after 535.6179ms - 200
2025-01-31 13:19:53.381 +03:00 [INF] Executing ContentResult with HTTP Response ContentType of text/html; charset=utf-8
2025-01-31 13:19:53.383 +03:00 [INF] Executed action NayifatAPI.Controllers.ProxyController.ForwardRequest (NayifatAPI) in 697.4485ms
2025-01-31 13:19:53.384 +03:00 [INF] Executed endpoint 'NayifatAPI.Controllers.ProxyController.ForwardRequest (NayifatAPI)'
2025-01-31 13:19:53.386 +03:00 [INF] Request finished HTTP/1.1 POST http://localhost:5264/api/proxy/forward - 200 929 text/html; charset=utf-8 706.2276ms
2025-01-31 13:23:14.646 +03:00 [INF] Request starting HTTP/1.1 POST http://localhost:5264/api/proxy/forward?url=icreditdept.com/api/testasp/test_local_generate_otp.php - application/json 92
2025-01-31 13:23:14.649 +03:00 [INF] Executing endpoint 'NayifatAPI.Controllers.ProxyController.ForwardRequest (NayifatAPI)'
2025-01-31 13:23:14.650 +03:00 [INF] Route matched with {action = "ForwardRequest", controller = "Proxy"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] ForwardRequest(NayifatAPI.Controllers.ProxyRequest) on controller NayifatAPI.Controllers.ProxyController (NayifatAPI).
2025-01-31 13:23:14.660 +03:00 [INF] Executing BadRequestObjectResult, writing value of type 'Microsoft.AspNetCore.Mvc.ValidationProblemDetails'.
2025-01-31 13:23:14.661 +03:00 [INF] Executed action NayifatAPI.Controllers.ProxyController.ForwardRequest (NayifatAPI) in 9.8862ms
2025-01-31 13:23:14.662 +03:00 [INF] Executed endpoint 'NayifatAPI.Controllers.ProxyController.ForwardRequest (NayifatAPI)'
2025-01-31 13:23:14.664 +03:00 [INF] Request finished HTTP/1.1 POST http://localhost:5264/api/proxy/forward?url=icreditdept.com/api/testasp/test_local_generate_otp.php - 400 null application/problem+json; charset=utf-8 17.4177ms
2025-01-31 13:24:14.329 +03:00 [INF] Request starting HTTP/1.1 POST http://localhost:5264/api/proxy/forward - application/json 213
2025-01-31 13:24:14.332 +03:00 [INF] Executing endpoint 'NayifatAPI.Controllers.ProxyController.ForwardRequest (NayifatAPI)'
2025-01-31 13:24:14.333 +03:00 [INF] Route matched with {action = "ForwardRequest", controller = "Proxy"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] ForwardRequest(NayifatAPI.Controllers.ProxyRequest) on controller NayifatAPI.Controllers.ProxyController (NayifatAPI).
2025-01-31 13:24:14.356 +03:00 [INF] Executed DbCommand (18ms) [Parameters=[@__providedApiKey_0='?' (Size = 255)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [a].[Key], [a].[CreatedAt], [a].[Description], [a].[ExpiresAt], [a].[IsActive], [a].[LastUsedAt]
FROM [ApiKeys] AS [a]
WHERE [a].[Key] = @__providedApiKey_0 AND [a].[IsActive] = CAST(1 AS bit)
2025-01-31 13:24:14.359 +03:00 [INF] Start processing HTTP request POST https://icreditdept.com/api/https://icreditdept.com/api/testasp/test_local_generate_otp.php
2025-01-31 13:24:14.360 +03:00 [INF] Sending HTTP request POST https://icreditdept.com/api/https://icreditdept.com/api/testasp/test_local_generate_otp.php
2025-01-31 13:24:15.628 +03:00 [INF] Received HTTP response headers after 1265.5085ms - 200
2025-01-31 13:24:15.630 +03:00 [INF] End processing HTTP request after 1270.771ms - 200
2025-01-31 13:24:15.631 +03:00 [INF] Executing ContentResult with HTTP Response ContentType of text/html; charset=utf-8
2025-01-31 13:24:15.631 +03:00 [INF] Executed action NayifatAPI.Controllers.ProxyController.ForwardRequest (NayifatAPI) in 1296.9976ms
2025-01-31 13:24:15.633 +03:00 [INF] Executed endpoint 'NayifatAPI.Controllers.ProxyController.ForwardRequest (NayifatAPI)'
2025-01-31 13:24:15.634 +03:00 [INF] Request finished HTTP/1.1 POST http://localhost:5264/api/proxy/forward - 200 929 text/html; charset=utf-8 1304.8227ms
2025-01-31 13:26:13.588 +03:00 [INF] Request starting HTTP/1.1 POST http://localhost:5264/api/proxy/forward - application/json 236
2025-01-31 13:26:13.591 +03:00 [INF] Executing endpoint 'NayifatAPI.Controllers.ProxyController.ForwardRequest (NayifatAPI)'
2025-01-31 13:26:13.592 +03:00 [INF] Route matched with {action = "ForwardRequest", controller = "Proxy"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] ForwardRequest(NayifatAPI.Controllers.ProxyRequest) on controller NayifatAPI.Controllers.ProxyController (NayifatAPI).
2025-01-31 13:26:13.595 +03:00 [INF] Executing BadRequestObjectResult, writing value of type 'Microsoft.AspNetCore.Mvc.ValidationProblemDetails'.
2025-01-31 13:26:13.599 +03:00 [INF] Executed action NayifatAPI.Controllers.ProxyController.ForwardRequest (NayifatAPI) in 5.403ms
2025-01-31 13:26:13.601 +03:00 [INF] Executed endpoint 'NayifatAPI.Controllers.ProxyController.ForwardRequest (NayifatAPI)'
2025-01-31 13:26:13.603 +03:00 [INF] Request finished HTTP/1.1 POST http://localhost:5264/api/proxy/forward - 400 null application/problem+json; charset=utf-8 14.483ms
2025-01-31 13:26:32.511 +03:00 [INF] Request starting HTTP/1.1 POST http://localhost:5264/api/proxy/forward - application/json 237
2025-01-31 13:26:32.573 +03:00 [INF] Executing endpoint 'NayifatAPI.Controllers.ProxyController.ForwardRequest (NayifatAPI)'
2025-01-31 13:26:32.575 +03:00 [INF] Route matched with {action = "ForwardRequest", controller = "Proxy"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] ForwardRequest(NayifatAPI.Controllers.ProxyRequest) on controller NayifatAPI.Controllers.ProxyController (NayifatAPI).
2025-01-31 13:26:32.755 +03:00 [INF] Executed DbCommand (174ms) [Parameters=[@__providedApiKey_0='?' (Size = 255)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [a].[Key], [a].[CreatedAt], [a].[Description], [a].[ExpiresAt], [a].[IsActive], [a].[LastUsedAt]
FROM [ApiKeys] AS [a]
WHERE [a].[Key] = @__providedApiKey_0 AND [a].[IsActive] = CAST(1 AS bit)
2025-01-31 13:26:32.760 +03:00 [INF] Start processing HTTP request POST https://icreditdept.com/api/https://icreditdept.com/api/testasp/test_local_generate_otp.php
2025-01-31 13:26:33.069 +03:00 [INF] Sending HTTP request POST https://icreditdept.com/api/https://icreditdept.com/api/testasp/test_local_generate_otp.php
2025-01-31 13:26:33.750 +03:00 [INF] Received HTTP response headers after 679.2856ms - 200
2025-01-31 13:26:33.751 +03:00 [INF] End processing HTTP request after 991.5186ms - 200
2025-01-31 13:26:33.752 +03:00 [INF] Executing ContentResult with HTTP Response ContentType of text/html; charset=utf-8
2025-01-31 13:26:33.754 +03:00 [INF] Executed action NayifatAPI.Controllers.ProxyController.ForwardRequest (NayifatAPI) in 1175.127ms
2025-01-31 13:26:33.755 +03:00 [INF] Executed endpoint 'NayifatAPI.Controllers.ProxyController.ForwardRequest (NayifatAPI)'
2025-01-31 13:26:33.756 +03:00 [INF] Request finished HTTP/1.1 POST http://localhost:5264/api/proxy/forward - 200 929 text/html; charset=utf-8 1245.5495ms
2025-01-31 13:26:42.011 +03:00 [INF] Request starting HTTP/1.1 POST http://localhost:5264/api/proxy/forward - application/json 235
2025-01-31 13:26:42.013 +03:00 [INF] Executing endpoint 'NayifatAPI.Controllers.ProxyController.ForwardRequest (NayifatAPI)'
2025-01-31 13:26:42.014 +03:00 [INF] Route matched with {action = "ForwardRequest", controller = "Proxy"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] ForwardRequest(NayifatAPI.Controllers.ProxyRequest) on controller NayifatAPI.Controllers.ProxyController (NayifatAPI).
2025-01-31 13:26:42.021 +03:00 [INF] Executed DbCommand (3ms) [Parameters=[@__providedApiKey_0='?' (Size = 255)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [a].[Key], [a].[CreatedAt], [a].[Description], [a].[ExpiresAt], [a].[IsActive], [a].[LastUsedAt]
FROM [ApiKeys] AS [a]
WHERE [a].[Key] = @__providedApiKey_0 AND [a].[IsActive] = CAST(1 AS bit)
2025-01-31 13:26:42.023 +03:00 [INF] Start processing HTTP request POST https://icreditdept.com/api/https://icreditdept.com/api/testasp/test_local_generate_otp.php
2025-01-31 13:26:42.025 +03:00 [INF] Sending HTTP request POST https://icreditdept.com/api/https://icreditdept.com/api/testasp/test_local_generate_otp.php
2025-01-31 13:26:42.432 +03:00 [INF] Received HTTP response headers after 406.6959ms - 200
2025-01-31 13:26:42.434 +03:00 [INF] End processing HTTP request after 410.2002ms - 200
2025-01-31 13:26:42.435 +03:00 [INF] Executing ContentResult with HTTP Response ContentType of text/html; charset=utf-8
2025-01-31 13:26:42.437 +03:00 [INF] Executed action NayifatAPI.Controllers.ProxyController.ForwardRequest (NayifatAPI) in 419.7553ms
2025-01-31 13:26:42.438 +03:00 [INF] Executed endpoint 'NayifatAPI.Controllers.ProxyController.ForwardRequest (NayifatAPI)'
2025-01-31 13:26:42.444 +03:00 [INF] Request finished HTTP/1.1 POST http://localhost:5264/api/proxy/forward - 200 929 text/html; charset=utf-8 432.5708ms
2025-01-31 13:45:25.530 +03:00 [INF] Request starting HTTP/1.1 POST http://localhost:5264/api/proxy/forward?url=https://icreditdept.com/api/testasp/test_local_generate_otp.php - application/json 112
2025-01-31 13:45:25.532 +03:00 [INF] Executing endpoint 'NayifatAPI.Controllers.ProxyController.ForwardRequest (NayifatAPI)'
2025-01-31 13:45:25.533 +03:00 [INF] Route matched with {action = "ForwardRequest", controller = "Proxy"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] ForwardRequest(NayifatAPI.Controllers.ProxyRequest) on controller NayifatAPI.Controllers.ProxyController (NayifatAPI).
2025-01-31 13:45:25.536 +03:00 [INF] Executing BadRequestObjectResult, writing value of type 'Microsoft.AspNetCore.Mvc.ValidationProblemDetails'.
2025-01-31 13:45:25.537 +03:00 [INF] Executed action NayifatAPI.Controllers.ProxyController.ForwardRequest (NayifatAPI) in 2.1695ms
2025-01-31 13:45:25.538 +03:00 [INF] Executed endpoint 'NayifatAPI.Controllers.ProxyController.ForwardRequest (NayifatAPI)'
2025-01-31 13:45:25.539 +03:00 [INF] Request finished HTTP/1.1 POST http://localhost:5264/api/proxy/forward?url=https://icreditdept.com/api/testasp/test_local_generate_otp.php - 400 null application/problem+json; charset=utf-8 8.6981ms
2025-01-31 13:46:30.798 +03:00 [INF] Request starting HTTP/1.1 POST http://localhost:5264/api/proxy/forward?url=https://icreditdept.com/api/testasp/test_local_generate_otp.php - application/json 112
2025-01-31 13:46:30.799 +03:00 [INF] Executing endpoint 'NayifatAPI.Controllers.ProxyController.ForwardRequest (NayifatAPI)'
2025-01-31 13:46:30.800 +03:00 [INF] Route matched with {action = "ForwardRequest", controller = "Proxy"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] ForwardRequest(NayifatAPI.Controllers.ProxyRequest) on controller NayifatAPI.Controllers.ProxyController (NayifatAPI).
2025-01-31 13:46:30.802 +03:00 [INF] Executing BadRequestObjectResult, writing value of type 'Microsoft.AspNetCore.Mvc.ValidationProblemDetails'.
2025-01-31 13:46:30.803 +03:00 [INF] Executed action NayifatAPI.Controllers.ProxyController.ForwardRequest (NayifatAPI) in 1.4905ms
2025-01-31 13:46:30.803 +03:00 [INF] Executed endpoint 'NayifatAPI.Controllers.ProxyController.ForwardRequest (NayifatAPI)'
2025-01-31 13:46:30.804 +03:00 [INF] Request finished HTTP/1.1 POST http://localhost:5264/api/proxy/forward?url=https://icreditdept.com/api/testasp/test_local_generate_otp.php - 400 null application/problem+json; charset=utf-8 6.4489ms
2025-01-31 13:46:46.857 +03:00 [INF] Request starting HTTP/1.1 POST http://localhost:5264/api/proxy/forward?url=https://icreditdept.com/api/testasp/test_local_generate_otp.php - application/json 112
2025-01-31 13:46:46.860 +03:00 [INF] Executing endpoint 'NayifatAPI.Controllers.ProxyController.ForwardRequest (NayifatAPI)'
2025-01-31 13:46:46.861 +03:00 [INF] Route matched with {action = "ForwardRequest", controller = "Proxy"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] ForwardRequest(NayifatAPI.Controllers.ProxyRequest) on controller NayifatAPI.Controllers.ProxyController (NayifatAPI).
2025-01-31 13:46:46.864 +03:00 [INF] Executing BadRequestObjectResult, writing value of type 'Microsoft.AspNetCore.Mvc.ValidationProblemDetails'.
2025-01-31 13:46:46.865 +03:00 [INF] Executed action NayifatAPI.Controllers.ProxyController.ForwardRequest (NayifatAPI) in 2.5596ms
2025-01-31 13:46:46.866 +03:00 [INF] Executed endpoint 'NayifatAPI.Controllers.ProxyController.ForwardRequest (NayifatAPI)'
2025-01-31 13:46:46.867 +03:00 [INF] Request finished HTTP/1.1 POST http://localhost:5264/api/proxy/forward?url=https://icreditdept.com/api/testasp/test_local_generate_otp.php - 400 null application/problem+json; charset=utf-8 9.8358ms
2025-01-31 13:49:47.127 +03:00 [INF] Request starting HTTP/1.1 POST http://localhost:5264/api/proxy/forward?url=https://icreditdept.com/api/testasp/test_local_generate_otp.php - application/json 112
2025-01-31 13:49:47.129 +03:00 [INF] Executing endpoint 'NayifatAPI.Controllers.ProxyController.ForwardRequest (NayifatAPI)'
2025-01-31 13:49:47.130 +03:00 [INF] Route matched with {action = "ForwardRequest", controller = "Proxy"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] ForwardRequest(NayifatAPI.Controllers.ProxyRequest) on controller NayifatAPI.Controllers.ProxyController (NayifatAPI).
2025-01-31 13:49:47.132 +03:00 [INF] Executing BadRequestObjectResult, writing value of type 'Microsoft.AspNetCore.Mvc.ValidationProblemDetails'.
2025-01-31 13:49:47.133 +03:00 [INF] Executed action NayifatAPI.Controllers.ProxyController.ForwardRequest (NayifatAPI) in 1.9464ms
2025-01-31 13:49:47.134 +03:00 [INF] Executed endpoint 'NayifatAPI.Controllers.ProxyController.ForwardRequest (NayifatAPI)'
2025-01-31 13:49:47.136 +03:00 [INF] Request finished HTTP/1.1 POST http://localhost:5264/api/proxy/forward?url=https://icreditdept.com/api/testasp/test_local_generate_otp.php - 400 null application/problem+json; charset=utf-8 8.6377ms
2025-01-31 13:50:00.979 +03:00 [INF] Request starting HTTP/1.1 POST http://localhost:5264/api/proxy/forward?url=https://icreditdept.com/api/testasp/test_local_generate_otp.php - application/json 110
2025-01-31 13:50:00.980 +03:00 [INF] Executing endpoint 'NayifatAPI.Controllers.ProxyController.ForwardRequest (NayifatAPI)'
2025-01-31 13:50:00.982 +03:00 [INF] Route matched with {action = "ForwardRequest", controller = "Proxy"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] ForwardRequest(NayifatAPI.Controllers.ProxyRequest) on controller NayifatAPI.Controllers.ProxyController (NayifatAPI).
2025-01-31 13:50:00.985 +03:00 [INF] Executing BadRequestObjectResult, writing value of type 'Microsoft.AspNetCore.Mvc.ValidationProblemDetails'.
2025-01-31 13:50:00.986 +03:00 [INF] Executed action NayifatAPI.Controllers.ProxyController.ForwardRequest (NayifatAPI) in 2.174ms
2025-01-31 13:50:00.988 +03:00 [INF] Executed endpoint 'NayifatAPI.Controllers.ProxyController.ForwardRequest (NayifatAPI)'
2025-01-31 13:50:00.989 +03:00 [INF] Request finished HTTP/1.1 POST http://localhost:5264/api/proxy/forward?url=https://icreditdept.com/api/testasp/test_local_generate_otp.php - 400 null application/problem+json; charset=utf-8 10.2629ms
2025-01-31 13:51:36.344 +03:00 [INF] Request starting HTTP/1.1 POST http://localhost:5264/api/proxy/forward?url=https://icreditdept.com/api/testasp/test_local_generate_otp.php - application/json 115
2025-01-31 13:51:36.348 +03:00 [INF] Executing endpoint 'NayifatAPI.Controllers.ProxyController.ForwardRequest (NayifatAPI)'
2025-01-31 13:51:36.349 +03:00 [INF] Route matched with {action = "ForwardRequest", controller = "Proxy"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] ForwardRequest(NayifatAPI.Controllers.ProxyRequest) on controller NayifatAPI.Controllers.ProxyController (NayifatAPI).
2025-01-31 13:51:36.352 +03:00 [INF] Executing BadRequestObjectResult, writing value of type 'Microsoft.AspNetCore.Mvc.ValidationProblemDetails'.
2025-01-31 13:51:36.354 +03:00 [INF] Executed action NayifatAPI.Controllers.ProxyController.ForwardRequest (NayifatAPI) in 2.3779ms
2025-01-31 13:51:36.355 +03:00 [INF] Executed endpoint 'NayifatAPI.Controllers.ProxyController.ForwardRequest (NayifatAPI)'
2025-01-31 13:51:36.356 +03:00 [INF] Request finished HTTP/1.1 POST http://localhost:5264/api/proxy/forward?url=https://icreditdept.com/api/testasp/test_local_generate_otp.php - 400 null application/problem+json; charset=utf-8 11.9832ms
2025-01-31 13:51:58.652 +03:00 [INF] Request starting HTTP/1.1 POST http://localhost:5264/api/proxy/forward?url=https://icreditdept.com/api/testasp/test_local_generate_otp.php - application/json 115
2025-01-31 13:51:58.656 +03:00 [INF] Executing endpoint 'NayifatAPI.Controllers.ProxyController.ForwardRequest (NayifatAPI)'
2025-01-31 13:51:58.657 +03:00 [INF] Route matched with {action = "ForwardRequest", controller = "Proxy"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] ForwardRequest(NayifatAPI.Controllers.ProxyRequest) on controller NayifatAPI.Controllers.ProxyController (NayifatAPI).
2025-01-31 13:51:58.659 +03:00 [INF] Executing BadRequestObjectResult, writing value of type 'Microsoft.AspNetCore.Mvc.ValidationProblemDetails'.
2025-01-31 13:51:58.660 +03:00 [INF] Executed action NayifatAPI.Controllers.ProxyController.ForwardRequest (NayifatAPI) in 1.3375ms
2025-01-31 13:51:58.660 +03:00 [INF] Executed endpoint 'NayifatAPI.Controllers.ProxyController.ForwardRequest (NayifatAPI)'
2025-01-31 13:51:58.661 +03:00 [INF] Request finished HTTP/1.1 POST http://localhost:5264/api/proxy/forward?url=https://icreditdept.com/api/testasp/test_local_generate_otp.php - 400 null application/problem+json; charset=utf-8 9.6641ms
2025-01-31 13:55:31.456 +03:00 [INF] Request starting HTTP/1.1 POST http://localhost:5264/api/proxy/forward?url=https://icreditdept.com/api/testasp/test_local_generate_otp.php - application/json 115
2025-01-31 13:55:31.458 +03:00 [INF] Executing endpoint 'NayifatAPI.Controllers.ProxyController.ForwardRequest (NayifatAPI)'
2025-01-31 13:55:31.459 +03:00 [INF] Route matched with {action = "ForwardRequest", controller = "Proxy"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] ForwardRequest(NayifatAPI.Controllers.ProxyRequest) on controller NayifatAPI.Controllers.ProxyController (NayifatAPI).
2025-01-31 13:55:31.462 +03:00 [INF] Executing BadRequestObjectResult, writing value of type 'Microsoft.AspNetCore.Mvc.ValidationProblemDetails'.
2025-01-31 13:55:31.463 +03:00 [INF] Executed action NayifatAPI.Controllers.ProxyController.ForwardRequest (NayifatAPI) in 3.2611ms
2025-01-31 13:55:31.465 +03:00 [INF] Executed endpoint 'NayifatAPI.Controllers.ProxyController.ForwardRequest (NayifatAPI)'
2025-01-31 13:55:31.466 +03:00 [INF] Request finished HTTP/1.1 POST http://localhost:5264/api/proxy/forward?url=https://icreditdept.com/api/testasp/test_local_generate_otp.php - 400 null application/problem+json; charset=utf-8 10.3535ms
2025-01-31 13:56:31.174 +03:00 [INF] Request starting HTTP/1.1 POST http://localhost:5264/api/proxy/forward?url=https://icreditdept.com/api/testasp/test_local_generate_otp.php - application/json 115
2025-01-31 13:56:31.176 +03:00 [INF] Executing endpoint 'NayifatAPI.Controllers.ProxyController.ForwardRequest (NayifatAPI)'
2025-01-31 13:56:31.177 +03:00 [INF] Route matched with {action = "ForwardRequest", controller = "Proxy"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] ForwardRequest(NayifatAPI.Controllers.ProxyRequest) on controller NayifatAPI.Controllers.ProxyController (NayifatAPI).
2025-01-31 13:56:31.178 +03:00 [INF] Executing BadRequestObjectResult, writing value of type 'Microsoft.AspNetCore.Mvc.ValidationProblemDetails'.
2025-01-31 13:56:31.180 +03:00 [INF] Executed action NayifatAPI.Controllers.ProxyController.ForwardRequest (NayifatAPI) in 1.7652ms
2025-01-31 13:56:31.181 +03:00 [INF] Executed endpoint 'NayifatAPI.Controllers.ProxyController.ForwardRequest (NayifatAPI)'
2025-01-31 13:56:31.182 +03:00 [INF] Request finished HTTP/1.1 POST http://localhost:5264/api/proxy/forward?url=https://icreditdept.com/api/testasp/test_local_generate_otp.php - 400 null application/problem+json; charset=utf-8 8.4614ms
2025-01-31 13:57:26.639 +03:00 [INF] Request starting HTTP/1.1 POST http://localhost:5264/api/proxy/forward?url=https://icreditdept.com/api/testasp/test_local_generate_otp.php - application/json 115
2025-01-31 13:57:26.641 +03:00 [INF] Executing endpoint 'NayifatAPI.Controllers.ProxyController.ForwardRequest (NayifatAPI)'
2025-01-31 13:57:26.641 +03:00 [INF] Route matched with {action = "ForwardRequest", controller = "Proxy"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] ForwardRequest(NayifatAPI.Controllers.ProxyRequest) on controller NayifatAPI.Controllers.ProxyController (NayifatAPI).
2025-01-31 13:57:26.643 +03:00 [INF] Executing BadRequestObjectResult, writing value of type 'Microsoft.AspNetCore.Mvc.ValidationProblemDetails'.
2025-01-31 13:57:26.644 +03:00 [INF] Executed action NayifatAPI.Controllers.ProxyController.ForwardRequest (NayifatAPI) in 1.3938ms
2025-01-31 13:57:26.645 +03:00 [INF] Executed endpoint 'NayifatAPI.Controllers.ProxyController.ForwardRequest (NayifatAPI)'
2025-01-31 13:57:26.646 +03:00 [INF] Request finished HTTP/1.1 POST http://localhost:5264/api/proxy/forward?url=https://icreditdept.com/api/testasp/test_local_generate_otp.php - 400 null application/problem+json; charset=utf-8 7.0363ms
2025-01-31 13:57:43.452 +03:00 [INF] Request starting HTTP/1.1 POST http://localhost:5264/api/proxy/forward?url=https://icreditdept.com/api/testasp/test_local_generate_otp.php - application/json 115
2025-01-31 13:57:43.454 +03:00 [INF] Executing endpoint 'NayifatAPI.Controllers.ProxyController.ForwardRequest (NayifatAPI)'
2025-01-31 13:57:43.456 +03:00 [INF] Route matched with {action = "ForwardRequest", controller = "Proxy"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] ForwardRequest(NayifatAPI.Controllers.ProxyRequest) on controller NayifatAPI.Controllers.ProxyController (NayifatAPI).
2025-01-31 13:57:43.460 +03:00 [INF] Executing BadRequestObjectResult, writing value of type 'Microsoft.AspNetCore.Mvc.ValidationProblemDetails'.
2025-01-31 13:57:43.462 +03:00 [INF] Executed action NayifatAPI.Controllers.ProxyController.ForwardRequest (NayifatAPI) in 3.1125ms
2025-01-31 13:57:43.464 +03:00 [INF] Executed endpoint 'NayifatAPI.Controllers.ProxyController.ForwardRequest (NayifatAPI)'
2025-01-31 13:57:43.466 +03:00 [INF] Request finished HTTP/1.1 POST http://localhost:5264/api/proxy/forward?url=https://icreditdept.com/api/testasp/test_local_generate_otp.php - 400 null application/problem+json; charset=utf-8 13.8374ms
2025-01-31 13:58:07.981 +03:00 [INF] Request starting HTTP/1.1 POST http://localhost:5264/api/proxy/forward?url=https://icreditdept.com/api/testasp/test_local_generate_otp.php - application/json 115
2025-01-31 13:58:07.984 +03:00 [INF] Executing endpoint 'NayifatAPI.Controllers.ProxyController.ForwardRequest (NayifatAPI)'
2025-01-31 13:58:07.985 +03:00 [INF] Route matched with {action = "ForwardRequest", controller = "Proxy"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] ForwardRequest(NayifatAPI.Controllers.ProxyRequest) on controller NayifatAPI.Controllers.ProxyController (NayifatAPI).
2025-01-31 13:58:07.987 +03:00 [INF] Executing BadRequestObjectResult, writing value of type 'Microsoft.AspNetCore.Mvc.ValidationProblemDetails'.
2025-01-31 13:58:07.989 +03:00 [INF] Executed action NayifatAPI.Controllers.ProxyController.ForwardRequest (NayifatAPI) in 2.3367ms
2025-01-31 13:58:07.996 +03:00 [INF] Executed endpoint 'NayifatAPI.Controllers.ProxyController.ForwardRequest (NayifatAPI)'
2025-01-31 13:58:08.000 +03:00 [INF] Request finished HTTP/1.1 POST http://localhost:5264/api/proxy/forward?url=https://icreditdept.com/api/testasp/test_local_generate_otp.php - 400 null application/problem+json; charset=utf-8 19.0784ms
2025-01-31 13:59:00.851 +03:00 [INF] Request starting HTTP/1.1 POST http://localhost:5264/api/proxy/forward?url=https://icreditdept.com/api/testasp/test_local_generate_otp.php - application/json 115
2025-01-31 13:59:00.853 +03:00 [INF] Executing endpoint 'NayifatAPI.Controllers.ProxyController.ForwardRequest (NayifatAPI)'
2025-01-31 13:59:00.854 +03:00 [INF] Route matched with {action = "ForwardRequest", controller = "Proxy"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] ForwardRequest(NayifatAPI.Controllers.ProxyRequest) on controller NayifatAPI.Controllers.ProxyController (NayifatAPI).
2025-01-31 13:59:00.855 +03:00 [INF] Executing BadRequestObjectResult, writing value of type 'Microsoft.AspNetCore.Mvc.ValidationProblemDetails'.
2025-01-31 13:59:00.856 +03:00 [INF] Executed action NayifatAPI.Controllers.ProxyController.ForwardRequest (NayifatAPI) in 1.5602ms
2025-01-31 13:59:00.857 +03:00 [INF] Executed endpoint 'NayifatAPI.Controllers.ProxyController.ForwardRequest (NayifatAPI)'
2025-01-31 13:59:00.859 +03:00 [INF] Request finished HTTP/1.1 POST http://localhost:5264/api/proxy/forward?url=https://icreditdept.com/api/testasp/test_local_generate_otp.php - 400 null application/problem+json; charset=utf-8 7.6121ms
2025-01-31 14:00:49.959 +03:00 [INF] Application is shutting down...
2025-01-31 14:01:18.903 +03:00 [INF] Starting web application
2025-01-31 14:01:19.027 +03:00 [INF] Now listening on: http://localhost:5264
2025-01-31 14:01:19.033 +03:00 [INF] Application started. Press Ctrl+C to shut down.
2025-01-31 14:01:19.034 +03:00 [INF] Hosting environment: Development
2025-01-31 14:01:19.035 +03:00 [INF] Content root path: C:\Users\yamta\StudioProjects\nayifat_app_2025_new\NayifatAPI
2025-01-31 14:01:25.264 +03:00 [INF] Request starting HTTP/1.1 POST http://localhost:5264/api/proxy/forward?url=https://icreditdept.com/api/testasp/test_local_generate_otp.php - application/json 115
2025-01-31 14:01:25.322 +03:00 [WRN] Failed to determine the https port for redirect.
2025-01-31 14:01:25.328 +03:00 [INF] Executing endpoint 'NayifatAPI.Controllers.ProxyController.ForwardRequest (NayifatAPI)'
2025-01-31 14:01:25.350 +03:00 [INF] Route matched with {action = "ForwardRequest", controller = "Proxy"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] ForwardRequest(System.Object) on controller NayifatAPI.Controllers.ProxyController (NayifatAPI).
2025-01-31 14:01:27.571 +03:00 [INF] Executed DbCommand (909ms) [Parameters=[@__providedApiKey_0='?' (Size = 255)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [a].[Key], [a].[CreatedAt], [a].[Description], [a].[ExpiresAt], [a].[IsActive], [a].[LastUsedAt]
FROM [ApiKeys] AS [a]
WHERE [a].[Key] = @__providedApiKey_0 AND [a].[IsActive] = CAST(1 AS bit)
2025-01-31 14:01:27.595 +03:00 [INF] Executing ObjectResult, writing value of type '<>f__AnonymousType11`2[[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-01-31 14:01:27.633 +03:00 [INF] Executed action NayifatAPI.Controllers.ProxyController.ForwardRequest (NayifatAPI) in 2275.0721ms
2025-01-31 14:01:27.636 +03:00 [INF] Executed endpoint 'NayifatAPI.Controllers.ProxyController.ForwardRequest (NayifatAPI)'
2025-01-31 14:01:27.649 +03:00 [INF] Request finished HTTP/1.1 POST http://localhost:5264/api/proxy/forward?url=https://icreditdept.com/api/testasp/test_local_generate_otp.php - 401 null application/json; charset=utf-8 2384.9676ms
2025-01-31 14:01:40.861 +03:00 [INF] Request starting HTTP/1.1 POST http://localhost:5264/api/proxy/forward?url=https://icreditdept.com/api/testasp/test_local_generate_otp.php - application/json 115
2025-01-31 14:01:40.869 +03:00 [INF] Executing endpoint 'NayifatAPI.Controllers.ProxyController.ForwardRequest (NayifatAPI)'
2025-01-31 14:01:40.871 +03:00 [INF] Route matched with {action = "ForwardRequest", controller = "Proxy"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] ForwardRequest(System.Object) on controller NayifatAPI.Controllers.ProxyController (NayifatAPI).
2025-01-31 14:01:40.931 +03:00 [INF] Executed DbCommand (18ms) [Parameters=[@__providedApiKey_0='?' (Size = 255)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [a].[Key], [a].[CreatedAt], [a].[Description], [a].[ExpiresAt], [a].[IsActive], [a].[LastUsedAt]
FROM [ApiKeys] AS [a]
WHERE [a].[Key] = @__providedApiKey_0 AND [a].[IsActive] = CAST(1 AS bit)
2025-01-31 14:01:41.023 +03:00 [INF] Start processing HTTP request POST https://icreditdept.com/api/testasp/test_local_generate_otp.php
2025-01-31 14:01:41.026 +03:00 [INF] Sending HTTP request POST https://icreditdept.com/api/testasp/test_local_generate_otp.php
2025-01-31 14:01:41.933 +03:00 [INF] Received HTTP response headers after 902.3527ms - 200
2025-01-31 14:01:41.934 +03:00 [INF] End processing HTTP request after 914.0736ms - 200
2025-01-31 14:01:41.941 +03:00 [INF] Executing ContentResult with HTTP Response ContentType of application/json
2025-01-31 14:01:41.943 +03:00 [INF] Executed action NayifatAPI.Controllers.ProxyController.ForwardRequest (NayifatAPI) in 1069.2453ms
2025-01-31 14:01:41.945 +03:00 [INF] Executed endpoint 'NayifatAPI.Controllers.ProxyController.ForwardRequest (NayifatAPI)'
2025-01-31 14:01:41.949 +03:00 [INF] Request finished HTTP/1.1 POST http://localhost:5264/api/proxy/forward?url=https://icreditdept.com/api/testasp/test_local_generate_otp.php - 200 314 application/json 1087.4303ms
2025-01-31 14:02:36.677 +03:00 [INF] Starting web application
2025-01-31 14:02:36.786 +03:00 [INF] Now listening on: http://localhost:5264
2025-01-31 14:02:36.790 +03:00 [INF] Application started. Press Ctrl+C to shut down.
2025-01-31 14:02:36.791 +03:00 [INF] Hosting environment: Development
2025-01-31 14:02:36.792 +03:00 [INF] Content root path: C:\Users\yamta\StudioProjects\nayifat_app_2025_new\nayifatapi
2025-01-31 14:02:57.011 +03:00 [INF] Request starting HTTP/1.1 POST http://localhost:5264/api/proxy/forward?url=https://icreditdept.com/api/testasp/test_local_generate_otp.php - application/json 115
2025-01-31 14:02:57.080 +03:00 [WRN] Failed to determine the https port for redirect.
2025-01-31 14:02:57.085 +03:00 [INF] Executing endpoint 'NayifatAPI.Controllers.ProxyController.ForwardRequest (NayifatAPI)'
2025-01-31 14:02:57.103 +03:00 [INF] Route matched with {action = "ForwardRequest", controller = "Proxy"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] ForwardRequest(System.Object) on controller NayifatAPI.Controllers.ProxyController (NayifatAPI).
2025-01-31 14:02:58.657 +03:00 [INF] Executed DbCommand (39ms) [Parameters=[@__providedApiKey_0='?' (Size = 255)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [a].[Key], [a].[CreatedAt], [a].[Description], [a].[ExpiresAt], [a].[IsActive], [a].[LastUsedAt]
FROM [ApiKeys] AS [a]
WHERE [a].[Key] = @__providedApiKey_0 AND [a].[IsActive] = CAST(1 AS bit)
2025-01-31 14:02:58.747 +03:00 [INF] Start processing HTTP request POST https://icreditdept.com/api/testasp/test_local_generate_otp.php
2025-01-31 14:02:58.749 +03:00 [INF] Sending HTTP request POST https://icreditdept.com/api/testasp/test_local_generate_otp.php
2025-01-31 14:02:59.486 +03:00 [INF] Received HTTP response headers after 734.0929ms - 200
2025-01-31 14:02:59.491 +03:00 [INF] End processing HTTP request after 746.8553ms - 200
2025-01-31 14:02:59.495 +03:00 [INF] Executing ContentResult with HTTP Response ContentType of application/json
2025-01-31 14:02:59.500 +03:00 [INF] Executed action NayifatAPI.Controllers.ProxyController.ForwardRequest (NayifatAPI) in 2389.486ms
2025-01-31 14:02:59.501 +03:00 [INF] Executed endpoint 'NayifatAPI.Controllers.ProxyController.ForwardRequest (NayifatAPI)'
2025-01-31 14:02:59.512 +03:00 [INF] Request finished HTTP/1.1 POST http://localhost:5264/api/proxy/forward?url=https://icreditdept.com/api/testasp/test_local_generate_otp.php - 200 308 application/json 2504.5018ms
2025-01-31 14:04:00.805 +03:00 [INF] Application is shutting down...
2025-01-31 14:04:12.233 +03:00 [INF] Starting web application
2025-01-31 14:04:12.327 +03:00 [INF] Now listening on: http://localhost:5264
2025-01-31 14:04:12.332 +03:00 [INF] Application started. Press Ctrl+C to shut down.
2025-01-31 14:04:12.332 +03:00 [INF] Hosting environment: Development
2025-01-31 14:04:12.333 +03:00 [INF] Content root path: C:\Users\yamta\StudioProjects\nayifat_app_2025_new\NayifatAPI
2025-01-31 14:04:36.687 +03:00 [INF] Request starting HTTP/1.1 POST http://localhost:5264/api/proxy/forward?url=https://icreditdept.com/api/testasp/test_local_generate_otp.php - application/json 115
2025-01-31 14:04:36.726 +03:00 [WRN] Failed to determine the https port for redirect.
2025-01-31 14:04:36.730 +03:00 [INF] Executing endpoint 'NayifatAPI.Controllers.ProxyController.ForwardRequest (NayifatAPI)'
2025-01-31 14:04:36.753 +03:00 [INF] Route matched with {action = "ForwardRequest", controller = "Proxy"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] ForwardRequest(System.Object) on controller NayifatAPI.Controllers.ProxyController (NayifatAPI).
2025-01-31 14:04:38.039 +03:00 [INF] Executed DbCommand (39ms) [Parameters=[@__providedApiKey_0='?' (Size = 255)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [a].[Key], [a].[CreatedAt], [a].[Description], [a].[ExpiresAt], [a].[IsActive], [a].[LastUsedAt]
FROM [ApiKeys] AS [a]
WHERE [a].[Key] = @__providedApiKey_0 AND [a].[IsActive] = CAST(1 AS bit)
2025-01-31 14:04:38.126 +03:00 [INF] Start processing HTTP request POST https://icreditdept.com/api/testasp/test_local_generate_otp.php
2025-01-31 14:04:38.127 +03:00 [INF] Sending HTTP request POST https://icreditdept.com/api/testasp/test_local_generate_otp.php
2025-01-31 14:04:38.907 +03:00 [INF] Received HTTP response headers after 776.699ms - 200
2025-01-31 14:04:38.911 +03:00 [INF] End processing HTTP request after 787.3962ms - 200
2025-01-31 14:04:38.923 +03:00 [INF] Executing ContentResult with HTTP Response ContentType of application/json
2025-01-31 14:04:38.929 +03:00 [INF] Executed action NayifatAPI.Controllers.ProxyController.ForwardRequest (NayifatAPI) in 2170.7087ms
2025-01-31 14:04:38.933 +03:00 [INF] Executed endpoint 'NayifatAPI.Controllers.ProxyController.ForwardRequest (NayifatAPI)'
2025-01-31 14:04:38.944 +03:00 [INF] Request finished HTTP/1.1 POST http://localhost:5264/api/proxy/forward?url=https://icreditdept.com/api/testasp/test_local_generate_otp.php - 200 290 application/json 2258.8487ms
2025-01-31 14:06:28.807 +03:00 [INF] Application is shutting down...
2025-01-31 14:07:20.872 +03:00 [INF] Starting web application
2025-01-31 14:07:20.982 +03:00 [INF] Now listening on: http://localhost:5264
2025-01-31 14:07:20.987 +03:00 [INF] Application started. Press Ctrl+C to shut down.
2025-01-31 14:07:20.988 +03:00 [INF] Hosting environment: Development
2025-01-31 14:07:20.989 +03:00 [INF] Content root path: C:\Users\yamta\StudioProjects\nayifat_app_2025_new\NayifatAPI
2025-01-31 14:07:35.021 +03:00 [INF] Request starting HTTP/1.1 POST http://localhost:5264/api/proxy/forward?url=https://icreditdept.com/api/testasp/test_local_generate_otp.php - application/json 115
2025-01-31 14:07:35.058 +03:00 [WRN] Failed to determine the https port for redirect.
2025-01-31 14:07:35.062 +03:00 [INF] Executing endpoint 'NayifatAPI.Controllers.ProxyController.ForwardRequest (NayifatAPI)'
2025-01-31 14:07:35.084 +03:00 [INF] Route matched with {action = "ForwardRequest", controller = "Proxy"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] ForwardRequest(System.Object) on controller NayifatAPI.Controllers.ProxyController (NayifatAPI).
2025-01-31 14:07:36.352 +03:00 [INF] Executed DbCommand (118ms) [Parameters=[@__providedApiKey_0='?' (Size = 255)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [a].[Key], [a].[CreatedAt], [a].[Description], [a].[ExpiresAt], [a].[IsActive], [a].[LastUsedAt]
FROM [ApiKeys] AS [a]
WHERE [a].[Key] = @__providedApiKey_0 AND [a].[IsActive] = CAST(1 AS bit)
2025-01-31 14:07:36.440 +03:00 [INF] Start processing HTTP request POST https://icreditdept.com/api/testasp/test_local_generate_otp.php
2025-01-31 14:07:36.443 +03:00 [INF] Sending HTTP request POST https://icreditdept.com/api/testasp/test_local_generate_otp.php
2025-01-31 14:07:39.244 +03:00 [INF] Received HTTP response headers after 2795.9242ms - 200
2025-01-31 14:07:39.246 +03:00 [INF] End processing HTTP request after 2811.6026ms - 200
2025-01-31 14:07:39.255 +03:00 [INF] Executing ObjectResult, writing value of type '<>f__AnonymousType11`2[[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-01-31 14:07:39.274 +03:00 [INF] Executed action NayifatAPI.Controllers.ProxyController.ForwardRequest (NayifatAPI) in 4182.5707ms
2025-01-31 14:07:39.276 +03:00 [INF] Executed endpoint 'NayifatAPI.Controllers.ProxyController.ForwardRequest (NayifatAPI)'
2025-01-31 14:07:39.292 +03:00 [INF] Request finished HTTP/1.1 POST http://localhost:5264/api/proxy/forward?url=https://icreditdept.com/api/testasp/test_local_generate_otp.php - 500 null application/json; charset=utf-8 4272.1902ms
2025-01-31 14:07:56.120 +03:00 [INF] Request starting HTTP/1.1 POST http://localhost:5264/api/proxy/forward?url=https://icreditdept.com/api/testasp/test_local_generate_otp.php - application/json 115
2025-01-31 14:07:56.128 +03:00 [INF] Executing endpoint 'NayifatAPI.Controllers.ProxyController.ForwardRequest (NayifatAPI)'
2025-01-31 14:07:56.129 +03:00 [INF] Route matched with {action = "ForwardRequest", controller = "Proxy"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] ForwardRequest(System.Object) on controller NayifatAPI.Controllers.ProxyController (NayifatAPI).
2025-01-31 14:07:56.163 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@__providedApiKey_0='?' (Size = 255)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [a].[Key], [a].[CreatedAt], [a].[Description], [a].[ExpiresAt], [a].[IsActive], [a].[LastUsedAt]
FROM [ApiKeys] AS [a]
WHERE [a].[Key] = @__providedApiKey_0 AND [a].[IsActive] = CAST(1 AS bit)
2025-01-31 14:07:56.168 +03:00 [INF] Start processing HTTP request POST https://icreditdept.com/api/testasp/test_local_generate_otp.php
2025-01-31 14:07:56.170 +03:00 [INF] Sending HTTP request POST https://icreditdept.com/api/testasp/test_local_generate_otp.php
2025-01-31 14:07:58.001 +03:00 [INF] Received HTTP response headers after 1830.4007ms - 200
2025-01-31 14:07:58.009 +03:00 [INF] End processing HTTP request after 1840.8577ms - 200
2025-01-31 14:07:58.018 +03:00 [INF] Executing ObjectResult, writing value of type '<>f__AnonymousType11`2[[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-01-31 14:07:58.021 +03:00 [INF] Executed action NayifatAPI.Controllers.ProxyController.ForwardRequest (NayifatAPI) in 1890.1246ms
2025-01-31 14:07:58.022 +03:00 [INF] Executed endpoint 'NayifatAPI.Controllers.ProxyController.ForwardRequest (NayifatAPI)'
2025-01-31 14:07:58.023 +03:00 [INF] Request finished HTTP/1.1 POST http://localhost:5264/api/proxy/forward?url=https://icreditdept.com/api/testasp/test_local_generate_otp.php - 500 null application/json; charset=utf-8 1902.6333ms
2025-01-31 14:08:18.081 +03:00 [INF] Request starting HTTP/1.1 POST http://localhost:5264/api/proxy/forward?url=https://icreditdept.com/api/testasp/test_local_generate_otp.php - application/json 115
2025-01-31 14:08:18.085 +03:00 [INF] Executing endpoint 'NayifatAPI.Controllers.ProxyController.ForwardRequest (NayifatAPI)'
2025-01-31 14:08:18.086 +03:00 [INF] Route matched with {action = "ForwardRequest", controller = "Proxy"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] ForwardRequest(System.Object) on controller NayifatAPI.Controllers.ProxyController (NayifatAPI).
2025-01-31 14:08:18.888 +03:00 [INF] Executed DbCommand (728ms) [Parameters=[@__providedApiKey_0='?' (Size = 255)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [a].[Key], [a].[CreatedAt], [a].[Description], [a].[ExpiresAt], [a].[IsActive], [a].[LastUsedAt]
FROM [ApiKeys] AS [a]
WHERE [a].[Key] = @__providedApiKey_0 AND [a].[IsActive] = CAST(1 AS bit)
2025-01-31 14:08:18.890 +03:00 [INF] Start processing HTTP request POST https://icreditdept.com/api/testasp/test_local_generate_otp.php
2025-01-31 14:08:18.891 +03:00 [INF] Sending HTTP request POST https://icreditdept.com/api/testasp/test_local_generate_otp.php
2025-01-31 14:08:20.567 +03:00 [INF] Received HTTP response headers after 1674.9323ms - 200
2025-01-31 14:08:20.569 +03:00 [INF] End processing HTTP request after 1678.4349ms - 200
2025-01-31 14:08:20.570 +03:00 [INF] Executing ObjectResult, writing value of type '<>f__AnonymousType11`2[[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-01-31 14:08:20.572 +03:00 [INF] Executed action NayifatAPI.Controllers.ProxyController.ForwardRequest (NayifatAPI) in 2482.9507ms
2025-01-31 14:08:20.572 +03:00 [INF] Executed endpoint 'NayifatAPI.Controllers.ProxyController.ForwardRequest (NayifatAPI)'
2025-01-31 14:08:20.573 +03:00 [INF] Request finished HTTP/1.1 POST http://localhost:5264/api/proxy/forward?url=https://icreditdept.com/api/testasp/test_local_generate_otp.php - 500 null application/json; charset=utf-8 2492.3865ms
2025-01-31 14:09:05.032 +03:00 [INF] Application is shutting down...
2025-01-31 14:09:18.718 +03:00 [INF] Starting web application
2025-01-31 14:09:18.823 +03:00 [INF] Now listening on: http://localhost:5264
2025-01-31 14:09:18.831 +03:00 [INF] Application started. Press Ctrl+C to shut down.
2025-01-31 14:09:18.833 +03:00 [INF] Hosting environment: Development
2025-01-31 14:09:18.834 +03:00 [INF] Content root path: C:\Users\yamta\StudioProjects\nayifat_app_2025_new\NayifatAPI
2025-01-31 14:09:31.891 +03:00 [INF] Request starting HTTP/1.1 POST http://localhost:5264/api/proxy/forward?url=https://icreditdept.com/api/testasp/test_local_generate_otp.php - application/json 115
2025-01-31 14:09:31.952 +03:00 [WRN] Failed to determine the https port for redirect.
2025-01-31 14:09:31.960 +03:00 [INF] Executing endpoint 'NayifatAPI.Controllers.ProxyController.ForwardRequest (NayifatAPI)'
2025-01-31 14:09:32.008 +03:00 [INF] Route matched with {action = "ForwardRequest", controller = "Proxy"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] ForwardRequest(System.Object) on controller NayifatAPI.Controllers.ProxyController (NayifatAPI).
2025-01-31 14:09:33.605 +03:00 [INF] Executed DbCommand (111ms) [Parameters=[@__providedApiKey_0='?' (Size = 255)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [a].[Key], [a].[CreatedAt], [a].[Description], [a].[ExpiresAt], [a].[IsActive], [a].[LastUsedAt]
FROM [ApiKeys] AS [a]
WHERE [a].[Key] = @__providedApiKey_0 AND [a].[IsActive] = CAST(1 AS bit)
2025-01-31 14:09:33.703 +03:00 [INF] Start processing HTTP request POST https://icreditdept.com/api/testasp/test_local_generate_otp.php
2025-01-31 14:09:33.713 +03:00 [INF] Sending HTTP request POST https://icreditdept.com/api/testasp/test_local_generate_otp.php
2025-01-31 14:09:34.641 +03:00 [INF] Received HTTP response headers after 920.0927ms - 200
2025-01-31 14:09:34.648 +03:00 [INF] End processing HTTP request after 947.5103ms - 200
2025-01-31 14:09:34.656 +03:00 [INF] Executing ContentResult with HTTP Response ContentType of application/json
2025-01-31 14:09:34.667 +03:00 [INF] Executed action NayifatAPI.Controllers.ProxyController.ForwardRequest (NayifatAPI) in 2649.5824ms
2025-01-31 14:09:34.669 +03:00 [INF] Executed endpoint 'NayifatAPI.Controllers.ProxyController.ForwardRequest (NayifatAPI)'
2025-01-31 14:09:34.688 +03:00 [INF] Request finished HTTP/1.1 POST http://localhost:5264/api/proxy/forward?url=https://icreditdept.com/api/testasp/test_local_generate_otp.php - 200 274 application/json 2798.2598ms
2025-01-31 14:10:46.040 +03:00 [INF] Application is shutting down...
2025-01-31 14:11:32.148 +03:00 [INF] Starting web application
2025-01-31 14:11:32.294 +03:00 [INF] Now listening on: http://localhost:5264
2025-01-31 14:11:32.300 +03:00 [INF] Application started. Press Ctrl+C to shut down.
2025-01-31 14:11:32.302 +03:00 [INF] Hosting environment: Development
2025-01-31 14:11:32.303 +03:00 [INF] Content root path: C:\Users\yamta\StudioProjects\nayifat_app_2025_new\NayifatAPI
2025-01-31 14:11:37.327 +03:00 [INF] Request starting HTTP/1.1 POST http://localhost:5264/api/proxy/forward?url=https://icreditdept.com/api/testasp/test_local_generate_otp.php - application/json 115
2025-01-31 14:11:37.402 +03:00 [WRN] Failed to determine the https port for redirect.
2025-01-31 14:11:37.406 +03:00 [INF] Executing endpoint 'NayifatAPI.Controllers.ProxyController.ForwardRequest (NayifatAPI)'
2025-01-31 14:11:37.434 +03:00 [INF] Route matched with {action = "ForwardRequest", controller = "Proxy"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] ForwardRequest(System.Object) on controller NayifatAPI.Controllers.ProxyController (NayifatAPI).
2025-01-31 14:11:39.205 +03:00 [INF] Executed DbCommand (123ms) [Parameters=[@__providedApiKey_0='?' (Size = 255)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [a].[Key], [a].[CreatedAt], [a].[Description], [a].[ExpiresAt], [a].[IsActive], [a].[LastUsedAt]
FROM [ApiKeys] AS [a]
WHERE [a].[Key] = @__providedApiKey_0 AND [a].[IsActive] = CAST(1 AS bit)
2025-01-31 14:11:39.323 +03:00 [INF] Start processing HTTP request POST https://icreditdept.com/api/testasp/test_local_generate_otp.php
2025-01-31 14:11:39.327 +03:00 [INF] Sending HTTP request POST https://icreditdept.com/api/testasp/test_local_generate_otp.php
2025-01-31 14:11:40.706 +03:00 [INF] Received HTTP response headers after 1371.3404ms - 200
2025-01-31 14:11:40.711 +03:00 [INF] End processing HTTP request after 1389.8923ms - 200
2025-01-31 14:11:40.736 +03:00 [INF] Executed action NayifatAPI.Controllers.ProxyController.ForwardRequest (NayifatAPI) in 3291.7926ms
2025-01-31 14:11:40.743 +03:00 [INF] Executed endpoint 'NayifatAPI.Controllers.ProxyController.ForwardRequest (NayifatAPI)'
2025-01-31 14:11:40.776 +03:00 [INF] Request finished HTTP/1.1 POST http://localhost:5264/api/proxy/forward?url=https://icreditdept.com/api/testasp/test_local_generate_otp.php - 200 null application/json 3449.0024ms
2025-01-31 14:13:54.118 +03:00 [INF] Application is shutting down...
2025-01-31 14:14:39.248 +03:00 [INF] Starting web application
2025-01-31 14:14:39.381 +03:00 [INF] Now listening on: http://localhost:5264
2025-01-31 14:14:39.392 +03:00 [INF] Application started. Press Ctrl+C to shut down.
2025-01-31 14:14:39.393 +03:00 [INF] Hosting environment: Development
2025-01-31 14:14:39.394 +03:00 [INF] Content root path: C:\Users\yamta\StudioProjects\nayifat_app_2025_new\NayifatAPI
2025-01-31 14:15:48.815 +03:00 [INF] Request starting HTTP/1.1 POST http://localhost:5264/api/proxy/forward?url=https://icreditdept.com/api/testasp/test_local_generate_otp.php - application/json 115
2025-01-31 14:15:48.877 +03:00 [WRN] Failed to determine the https port for redirect.
2025-01-31 14:15:48.882 +03:00 [INF] Executing endpoint 'NayifatAPI.Controllers.ProxyController.ForwardRequest (NayifatAPI)'
2025-01-31 14:15:48.920 +03:00 [INF] Route matched with {action = "ForwardRequest", controller = "Proxy"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] ForwardRequest(System.Object) on controller NayifatAPI.Controllers.ProxyController (NayifatAPI).
2025-01-31 14:15:50.884 +03:00 [INF] Executed DbCommand (53ms) [Parameters=[@__providedApiKey_0='?' (Size = 255)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [a].[Key], [a].[CreatedAt], [a].[Description], [a].[ExpiresAt], [a].[IsActive], [a].[LastUsedAt]
FROM [ApiKeys] AS [a]
WHERE [a].[Key] = @__providedApiKey_0 AND [a].[IsActive] = CAST(1 AS bit)
2025-01-31 14:15:50.985 +03:00 [INF] Start processing HTTP request POST https://icreditdept.com/api/testasp/test_local_generate_otp.php
2025-01-31 14:15:50.993 +03:00 [INF] Sending HTTP request POST https://icreditdept.com/api/testasp/test_local_generate_otp.php
2025-01-31 14:15:51.927 +03:00 [INF] Received HTTP response headers after 928.5083ms - 200
2025-01-31 14:15:51.931 +03:00 [INF] End processing HTTP request after 949.682ms - 200
2025-01-31 14:15:51.946 +03:00 [INF] Executing FileStreamResult, sending file with download name '' ...
2025-01-31 14:15:51.963 +03:00 [INF] Executed action NayifatAPI.Controllers.ProxyController.ForwardRequest (NayifatAPI) in 3036.0204ms
2025-01-31 14:15:51.970 +03:00 [INF] Executed endpoint 'NayifatAPI.Controllers.ProxyController.ForwardRequest (NayifatAPI)'
2025-01-31 14:15:51.995 +03:00 [INF] Request finished HTTP/1.1 POST http://localhost:5264/api/proxy/forward?url=https://icreditdept.com/api/testasp/test_local_generate_otp.php - 200 169 application/json; charset=utf-8 3181.2834ms
2025-01-31 14:20:10.879 +03:00 [INF] Application is shutting down...
2025-01-31 14:20:32.910 +03:00 [INF] Starting web application
2025-01-31 14:20:33.055 +03:00 [INF] Now listening on: http://localhost:5264
2025-01-31 14:20:33.060 +03:00 [INF] Application started. Press Ctrl+C to shut down.
2025-01-31 14:20:33.061 +03:00 [INF] Hosting environment: Development
2025-01-31 14:20:33.062 +03:00 [INF] Content root path: C:\Users\yamta\StudioProjects\nayifat_app_2025_new\NayifatAPI
2025-01-31 14:21:26.361 +03:00 [INF] Request starting HTTP/1.1 POST http://localhost:5264/api/proxy/forward?url=https://icreditdept.com/api/testasp/test_local_generate_otp.php - application/json 115
2025-01-31 14:21:26.427 +03:00 [WRN] Failed to determine the https port for redirect.
2025-01-31 14:21:26.433 +03:00 [INF] Executing endpoint 'NayifatAPI.Controllers.ProxyController.ForwardRequest (NayifatAPI)'
2025-01-31 14:21:26.463 +03:00 [INF] Route matched with {action = "ForwardRequest", controller = "Proxy"}. Executing controller action with signature System.Threading.Tasks.Task`1[System.String] ForwardRequest(System.Object) on controller NayifatAPI.Controllers.ProxyController (NayifatAPI).
2025-01-31 14:21:28.067 +03:00 [INF] Executed DbCommand (67ms) [Parameters=[@__providedApiKey_0='?' (Size = 255)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [a].[Key], [a].[CreatedAt], [a].[Description], [a].[ExpiresAt], [a].[IsActive], [a].[LastUsedAt]
FROM [ApiKeys] AS [a]
WHERE [a].[Key] = @__providedApiKey_0 AND [a].[IsActive] = CAST(1 AS bit)
2025-01-31 14:21:28.182 +03:00 [INF] Start processing HTTP request POST https://icreditdept.com/api/testasp/test_local_generate_otp.php
2025-01-31 14:21:28.187 +03:00 [INF] Sending HTTP request POST https://icreditdept.com/api/testasp/test_local_generate_otp.php
2025-01-31 14:21:29.574 +03:00 [INF] Received HTTP response headers after 1378.0106ms - 200
2025-01-31 14:21:29.577 +03:00 [INF] End processing HTTP request after 1397.4219ms - 200
2025-01-31 14:21:29.583 +03:00 [INF] Executing ObjectResult, writing value of type 'System.String'.
2025-01-31 14:21:29.594 +03:00 [INF] Executed action NayifatAPI.Controllers.ProxyController.ForwardRequest (NayifatAPI) in 3118.8801ms
2025-01-31 14:21:29.596 +03:00 [INF] Executed endpoint 'NayifatAPI.Controllers.ProxyController.ForwardRequest (NayifatAPI)'
2025-01-31 14:21:29.616 +03:00 [INF] Request finished HTTP/1.1 POST http://localhost:5264/api/proxy/forward?url=https://icreditdept.com/api/testasp/test_local_generate_otp.php - 200 null text/plain; charset=utf-8 3257.5924ms
2025-01-31 14:22:42.793 +03:00 [INF] Application is shutting down...
2025-01-31 14:22:54.589 +03:00 [INF] Starting web application
2025-01-31 14:22:54.706 +03:00 [INF] Now listening on: http://localhost:5264
2025-01-31 14:22:54.713 +03:00 [INF] Application started. Press Ctrl+C to shut down.
2025-01-31 14:22:54.714 +03:00 [INF] Hosting environment: Development
2025-01-31 14:22:54.714 +03:00 [INF] Content root path: C:\Users\yamta\StudioProjects\nayifat_app_2025_new\NayifatAPI
2025-01-31 14:23:05.384 +03:00 [INF] Request starting HTTP/1.1 POST http://localhost:5264/api/proxy/forward?url=https://icreditdept.com/api/testasp/test_local_generate_otp.php - application/json 115
2025-01-31 14:23:05.462 +03:00 [WRN] Failed to determine the https port for redirect.
2025-01-31 14:23:05.469 +03:00 [INF] Executing endpoint 'NayifatAPI.Controllers.ProxyController.ForwardRequest (NayifatAPI)'
2025-01-31 14:23:05.495 +03:00 [INF] Route matched with {action = "ForwardRequest", controller = "Proxy"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] ForwardRequest(System.Object) on controller NayifatAPI.Controllers.ProxyController (NayifatAPI).
2025-01-31 14:23:09.611 +03:00 [INF] Executed DbCommand (2,471ms) [Parameters=[@__providedApiKey_0='?' (Size = 255)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [a].[Key], [a].[CreatedAt], [a].[Description], [a].[ExpiresAt], [a].[IsActive], [a].[LastUsedAt]
FROM [ApiKeys] AS [a]
WHERE [a].[Key] = @__providedApiKey_0 AND [a].[IsActive] = CAST(1 AS bit)
2025-01-31 14:23:09.792 +03:00 [INF] Start processing HTTP request POST https://icreditdept.com/api/testasp/test_local_generate_otp.php
2025-01-31 14:23:09.797 +03:00 [INF] Sending HTTP request POST https://icreditdept.com/api/testasp/test_local_generate_otp.php
2025-01-31 14:23:10.676 +03:00 [INF] Received HTTP response headers after 870.7719ms - 200
2025-01-31 14:23:10.685 +03:00 [INF] End processing HTTP request after 898.4063ms - 200
2025-01-31 14:23:10.740 +03:00 [ERR] Error in proxy: System.Text.Json.JsonException: '0x1F' is an invalid start of a value. Path: $ | LineNumber: 0 | BytePositionInLine: 0.
 ---> System.Text.Json.JsonReaderException: '0x1F' is an invalid start of a value. LineNumber: 0 | BytePositionInLine: 0.
   at System.Text.Json.ThrowHelper.ThrowJsonReaderException(Utf8JsonReader& json, ExceptionResource resource, Byte nextByte, ReadOnlySpan`1 bytes)
   at System.Text.Json.Utf8JsonReader.ConsumeValue(Byte marker)
   at System.Text.Json.Utf8JsonReader.ReadFirstToken(Byte first)
   at System.Text.Json.Utf8JsonReader.ReadSingleSegment()
   at System.Text.Json.Utf8JsonReader.Read()
   at System.Text.Json.Serialization.JsonConverter`1.ReadCore(Utf8JsonReader& reader, JsonSerializerOptions options, ReadStack& state)
   --- End of inner exception stack trace ---
   at System.Text.Json.ThrowHelper.ReThrowWithPath(ReadStack& state, JsonReaderException ex)
   at System.Text.Json.Serialization.JsonConverter`1.ReadCore(Utf8JsonReader& reader, JsonSerializerOptions options, ReadStack& state)
   at System.Text.Json.Serialization.Metadata.JsonTypeInfo`1.Deserialize(Utf8JsonReader& reader, ReadStack& state)
   at System.Text.Json.JsonSerializer.ReadFromSpan[TValue](ReadOnlySpan`1 utf8Json, JsonTypeInfo`1 jsonTypeInfo, Nullable`1 actualByteCount)
   at System.Text.Json.JsonSerializer.ReadFromSpan[TValue](ReadOnlySpan`1 json, JsonTypeInfo`1 jsonTypeInfo)
   at System.Text.Json.JsonSerializer.Deserialize[TValue](String json, JsonSerializerOptions options)
   at NayifatAPI.Controllers.ProxyController.ForwardRequest(Object body) in C:\Users\yamta\StudioProjects\nayifat_app_2025_new\NayifatAPI\Controllers\ProxyController.cs:line 75
2025-01-31 14:23:10.757 +03:00 [INF] Executing ObjectResult, writing value of type '<>f__AnonymousType28`2[[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-01-31 14:23:10.835 +03:00 [INF] Executed action NayifatAPI.Controllers.ProxyController.ForwardRequest (NayifatAPI) in 5285.6669ms
2025-01-31 14:23:11.025 +03:00 [INF] Executed endpoint 'NayifatAPI.Controllers.ProxyController.ForwardRequest (NayifatAPI)'
2025-01-31 14:23:11.051 +03:00 [INF] Request finished HTTP/1.1 POST http://localhost:5264/api/proxy/forward?url=https://icreditdept.com/api/testasp/test_local_generate_otp.php - 500 null application/json; charset=utf-8 5669.1455ms
2025-01-31 14:24:16.063 +03:00 [INF] Application is shutting down...
2025-01-31 14:25:22.814 +03:00 [INF] Starting web application
2025-01-31 14:25:22.957 +03:00 [INF] Now listening on: http://localhost:5264
2025-01-31 14:25:22.963 +03:00 [INF] Application started. Press Ctrl+C to shut down.
2025-01-31 14:25:22.965 +03:00 [INF] Hosting environment: Development
2025-01-31 14:25:22.967 +03:00 [INF] Content root path: C:\Users\yamta\StudioProjects\nayifat_app_2025_new\NayifatAPI
2025-01-31 14:25:57.555 +03:00 [INF] Request starting HTTP/1.1 POST http://localhost:5264/api/proxy/forward?url=https://icreditdept.com/api/testasp/test_local_generate_otp.php - application/json 115
2025-01-31 14:25:57.605 +03:00 [WRN] Failed to determine the https port for redirect.
2025-01-31 14:25:57.612 +03:00 [INF] Executing endpoint 'NayifatAPI.Controllers.ProxyController.ForwardRequest (NayifatAPI)'
2025-01-31 14:25:57.638 +03:00 [INF] Route matched with {action = "ForwardRequest", controller = "Proxy"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] ForwardRequest(System.Object) on controller NayifatAPI.Controllers.ProxyController (NayifatAPI).
2025-01-31 14:26:00.386 +03:00 [INF] Executed DbCommand (1,200ms) [Parameters=[@__providedApiKey_0='?' (Size = 255)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [a].[Key], [a].[CreatedAt], [a].[Description], [a].[ExpiresAt], [a].[IsActive], [a].[LastUsedAt]
FROM [ApiKeys] AS [a]
WHERE [a].[Key] = @__providedApiKey_0 AND [a].[IsActive] = CAST(1 AS bit)
2025-01-31 14:26:00.501 +03:00 [INF] Start processing HTTP request POST https://icreditdept.com/api/testasp/test_local_generate_otp.php
2025-01-31 14:26:00.508 +03:00 [INF] Sending HTTP request POST https://icreditdept.com/api/testasp/test_local_generate_otp.php
2025-01-31 14:26:01.846 +03:00 [INF] Received HTTP response headers after 1329.1091ms - 200
2025-01-31 14:26:01.852 +03:00 [INF] End processing HTTP request after 1353.0339ms - 200
2025-01-31 14:26:01.863 +03:00 [INF] Cleaned response:       -
0EEfB&idk7.tR\6BLJ`)cn.26%9"Azoq4 G!N J$qM	.c#$~]ga$8aF`3`FZ5   
2025-01-31 14:26:01.872 +03:00 [INF] Executing ContentResult with HTTP Response ContentType of application/json
2025-01-31 14:26:01.885 +03:00 [INF] Executed action NayifatAPI.Controllers.ProxyController.ForwardRequest (NayifatAPI) in 4236.7421ms
2025-01-31 14:26:01.892 +03:00 [INF] Executed endpoint 'NayifatAPI.Controllers.ProxyController.ForwardRequest (NayifatAPI)'
2025-01-31 14:26:01.927 +03:00 [INF] Request finished HTTP/1.1 POST http://localhost:5264/api/proxy/forward?url=https://icreditdept.com/api/testasp/test_local_generate_otp.php - 200 292 application/json 4372.7668ms
2025-01-31 14:30:54.659 +03:00 [INF] Application is shutting down...
2025-01-31 14:31:05.125 +03:00 [INF] Starting web application
2025-01-31 14:31:05.284 +03:00 [INF] Now listening on: http://localhost:5264
2025-01-31 14:31:05.293 +03:00 [INF] Application started. Press Ctrl+C to shut down.
2025-01-31 14:31:05.294 +03:00 [INF] Hosting environment: Development
2025-01-31 14:31:05.295 +03:00 [INF] Content root path: C:\Users\yamta\StudioProjects\nayifat_app_2025_new\NayifatAPI
2025-01-31 14:31:11.268 +03:00 [INF] Request starting HTTP/1.1 POST http://localhost:5264/api/proxy/forward?url=https://icreditdept.com/api/testasp/test_local_generate_otp.php - application/json 115
2025-01-31 14:31:11.369 +03:00 [WRN] Failed to determine the https port for redirect.
2025-01-31 14:31:11.375 +03:00 [INF] Executing endpoint 'NayifatAPI.Controllers.ProxyController.ForwardRequest (NayifatAPI)'
2025-01-31 14:31:11.404 +03:00 [INF] Route matched with {action = "ForwardRequest", controller = "Proxy"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] ForwardRequest() on controller NayifatAPI.Controllers.ProxyController (NayifatAPI).
2025-01-31 14:31:11.529 +03:00 [INF] Executing BadRequestObjectResult, writing value of type '<>f__AnonymousType28`2[[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-01-31 14:31:11.567 +03:00 [INF] Executed action NayifatAPI.Controllers.ProxyController.ForwardRequest (NayifatAPI) in 153.5502ms
2025-01-31 14:31:11.574 +03:00 [INF] Executed endpoint 'NayifatAPI.Controllers.ProxyController.ForwardRequest (NayifatAPI)'
2025-01-31 14:31:11.581 +03:00 [INF] Request finished HTTP/1.1 POST http://localhost:5264/api/proxy/forward?url=https://icreditdept.com/api/testasp/test_local_generate_otp.php - 400 null application/json; charset=utf-8 316.2756ms
2025-01-31 14:31:23.668 +03:00 [INF] Request starting HTTP/1.1 POST http://localhost:5264/api/proxy/forward?url=https://icreditdept.com/api/testasp/test_local_generate_otp.php - application/json 115
2025-01-31 14:31:23.678 +03:00 [INF] Executing endpoint 'NayifatAPI.Controllers.ProxyController.ForwardRequest (NayifatAPI)'
2025-01-31 14:31:23.684 +03:00 [INF] Route matched with {action = "ForwardRequest", controller = "Proxy"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] ForwardRequest() on controller NayifatAPI.Controllers.ProxyController (NayifatAPI).
2025-01-31 14:31:23.709 +03:00 [INF] Executing BadRequestObjectResult, writing value of type '<>f__AnonymousType28`2[[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-01-31 14:31:23.714 +03:00 [INF] Executed action NayifatAPI.Controllers.ProxyController.ForwardRequest (NayifatAPI) in 25.4813ms
2025-01-31 14:31:23.717 +03:00 [INF] Executed endpoint 'NayifatAPI.Controllers.ProxyController.ForwardRequest (NayifatAPI)'
2025-01-31 14:31:23.719 +03:00 [INF] Request finished HTTP/1.1 POST http://localhost:5264/api/proxy/forward?url=https://icreditdept.com/api/testasp/test_local_generate_otp.php - 400 null application/json; charset=utf-8 51.203ms
2025-01-31 14:31:37.362 +03:00 [INF] Request starting HTTP/1.1 POST http://localhost:5264/api/proxy/forward?url=https://icreditdept.com/api/testasp/test_local_generate_otp.php - application/json 115
2025-01-31 14:31:37.372 +03:00 [INF] Executing endpoint 'NayifatAPI.Controllers.ProxyController.ForwardRequest (NayifatAPI)'
2025-01-31 14:31:37.376 +03:00 [INF] Route matched with {action = "ForwardRequest", controller = "Proxy"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] ForwardRequest() on controller NayifatAPI.Controllers.ProxyController (NayifatAPI).
2025-01-31 14:31:37.384 +03:00 [INF] Executing BadRequestObjectResult, writing value of type '<>f__AnonymousType28`2[[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-01-31 14:31:37.389 +03:00 [INF] Executed action NayifatAPI.Controllers.ProxyController.ForwardRequest (NayifatAPI) in 8.3135ms
2025-01-31 14:31:37.395 +03:00 [INF] Executed endpoint 'NayifatAPI.Controllers.ProxyController.ForwardRequest (NayifatAPI)'
2025-01-31 14:31:37.399 +03:00 [INF] Request finished HTTP/1.1 POST http://localhost:5264/api/proxy/forward?url=https://icreditdept.com/api/testasp/test_local_generate_otp.php - 400 null application/json; charset=utf-8 36.8719ms
2025-01-31 14:32:13.411 +03:00 [INF] Request starting HTTP/1.1 POST http://localhost:5264/api/proxy/forward?url=https://icreditdept.com/api/testasp/test_local_generate_otp.php - application/json 115
2025-01-31 14:32:13.414 +03:00 [INF] Executing endpoint 'NayifatAPI.Controllers.ProxyController.ForwardRequest (NayifatAPI)'
2025-01-31 14:32:13.415 +03:00 [INF] Route matched with {action = "ForwardRequest", controller = "Proxy"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] ForwardRequest() on controller NayifatAPI.Controllers.ProxyController (NayifatAPI).
2025-01-31 14:32:13.420 +03:00 [INF] Executing BadRequestObjectResult, writing value of type '<>f__AnonymousType28`2[[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-01-31 14:32:13.424 +03:00 [INF] Executed action NayifatAPI.Controllers.ProxyController.ForwardRequest (NayifatAPI) in 4.1499ms
2025-01-31 14:32:13.427 +03:00 [INF] Executed endpoint 'NayifatAPI.Controllers.ProxyController.ForwardRequest (NayifatAPI)'
2025-01-31 14:32:13.429 +03:00 [INF] Request finished HTTP/1.1 POST http://localhost:5264/api/proxy/forward?url=https://icreditdept.com/api/testasp/test_local_generate_otp.php - 400 null application/json; charset=utf-8 17.3678ms
2025-01-31 14:32:17.648 +03:00 [INF] Application is shutting down...
2025-01-31 14:32:26.090 +03:00 [INF] Starting web application
2025-01-31 14:32:26.200 +03:00 [INF] Now listening on: http://localhost:5264
2025-01-31 14:32:26.207 +03:00 [INF] Application started. Press Ctrl+C to shut down.
2025-01-31 14:32:26.209 +03:00 [INF] Hosting environment: Development
2025-01-31 14:32:26.210 +03:00 [INF] Content root path: C:\Users\yamta\StudioProjects\nayifat_app_2025_new\NayifatAPI
2025-01-31 14:32:37.881 +03:00 [INF] Request starting HTTP/1.1 POST http://localhost:5264/api/proxy/forward?url=https://icreditdept.com/api/testasp/test_local_generate_otp.php - application/json 115
2025-01-31 14:32:37.944 +03:00 [WRN] Failed to determine the https port for redirect.
2025-01-31 14:32:37.951 +03:00 [INF] Executing endpoint 'NayifatAPI.Controllers.ProxyController.ForwardRequest (NayifatAPI)'
2025-01-31 14:32:37.971 +03:00 [INF] Route matched with {action = "ForwardRequest", controller = "Proxy"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] ForwardRequest() on controller NayifatAPI.Controllers.ProxyController (NayifatAPI).
2025-01-31 14:32:38.122 +03:00 [INF] Start processing HTTP request POST https://icreditdept.com/api/testasp/test_local_generate_otp.php
2025-01-31 14:32:38.130 +03:00 [INF] Sending HTTP request POST https://icreditdept.com/api/testasp/test_local_generate_otp.php
2025-01-31 14:32:39.084 +03:00 [INF] Received HTTP response headers after 948.832ms - 200
2025-01-31 14:32:39.090 +03:00 [INF] End processing HTTP request after 971.0288ms - 200
2025-01-31 14:32:39.100 +03:00 [INF] Proxy response:       -
0EEfB^}n\m(<Rw\9s7HeMJr,GL'hRN;m/(`q!T(1NyPv`R^I>wM3"}w]C a=E`F1{   
2025-01-31 14:32:39.106 +03:00 [INF] Executing ContentResult with HTTP Response ContentType of application/json
2025-01-31 14:32:39.119 +03:00 [INF] Executed action NayifatAPI.Controllers.ProxyController.ForwardRequest (NayifatAPI) in 1139.8206ms
2025-01-31 14:32:39.121 +03:00 [INF] Executed endpoint 'NayifatAPI.Controllers.ProxyController.ForwardRequest (NayifatAPI)'
2025-01-31 14:32:39.133 +03:00 [INF] Request finished HTTP/1.1 POST http://localhost:5264/api/proxy/forward?url=https://icreditdept.com/api/testasp/test_local_generate_otp.php - 200 282 application/json 1255.7748ms
2025-01-31 14:36:58.108 +03:00 [INF] Application is shutting down...
2025-01-31 14:37:06.009 +03:00 [INF] Starting web application
2025-01-31 14:37:06.084 +03:00 [INF] Now listening on: http://localhost:5264
2025-01-31 14:37:06.088 +03:00 [INF] Application started. Press Ctrl+C to shut down.
2025-01-31 14:37:06.089 +03:00 [INF] Hosting environment: Development
2025-01-31 14:37:06.090 +03:00 [INF] Content root path: C:\Users\yamta\StudioProjects\nayifat_app_2025_new\NayifatAPI
2025-01-31 14:37:18.524 +03:00 [INF] Request starting HTTP/1.1 POST http://localhost:5264/api/proxy/forward?url=https://icreditdept.com/api/testasp/test_local_generate_otp.php - application/json 115
2025-01-31 14:37:18.566 +03:00 [WRN] Failed to determine the https port for redirect.
2025-01-31 14:37:18.569 +03:00 [INF] Executing endpoint 'NayifatAPI.Controllers.ProxyController.ForwardRequest (NayifatAPI)'
2025-01-31 14:37:18.584 +03:00 [INF] Route matched with {action = "ForwardRequest", controller = "Proxy"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] ForwardRequest() on controller NayifatAPI.Controllers.ProxyController (NayifatAPI).
2025-01-31 14:37:18.713 +03:00 [INF] Start processing HTTP request POST https://icreditdept.com/api/testasp/test_local_generate_otp.php
2025-01-31 14:37:18.715 +03:00 [INF] Sending HTTP request POST https://icreditdept.com/api/testasp/test_local_generate_otp.php
2025-01-31 14:37:19.487 +03:00 [INF] Received HTTP response headers after 768.9804ms - 200
2025-01-31 14:37:19.491 +03:00 [INF] End processing HTTP request after 781.6549ms - 200
2025-01-31 14:37:19.497 +03:00 [INF] Proxy response:       -=0E9$MfAGqm(|}nrywE]gcN![O`cv	zd'.=4V=Z5<l%LrT\T	H6w!m|O/w!-f+F   
2025-01-31 14:37:19.500 +03:00 [INF] Executing ContentResult with HTTP Response ContentType of application/json
2025-01-31 14:37:19.506 +03:00 [INF] Executed action NayifatAPI.Controllers.ProxyController.ForwardRequest (NayifatAPI) in 915.3431ms
2025-01-31 14:37:19.507 +03:00 [INF] Executed endpoint 'NayifatAPI.Controllers.ProxyController.ForwardRequest (NayifatAPI)'
2025-01-31 14:37:19.516 +03:00 [INF] Request finished HTTP/1.1 POST http://localhost:5264/api/proxy/forward?url=https://icreditdept.com/api/testasp/test_local_generate_otp.php - 200 298 application/json 992.4343ms
2025-01-31 14:54:11.265 +03:00 [INF] Application is shutting down...
2025-01-31 14:54:26.523 +03:00 [INF] Starting web application
2025-01-31 14:54:26.641 +03:00 [INF] Now listening on: http://localhost:5264
2025-01-31 14:54:26.645 +03:00 [INF] Application started. Press Ctrl+C to shut down.
2025-01-31 14:54:26.647 +03:00 [INF] Hosting environment: Development
2025-01-31 14:54:26.647 +03:00 [INF] Content root path: C:\Users\yamta\StudioProjects\nayifat_app_2025_new\NayifatAPI
2025-01-31 14:54:37.338 +03:00 [INF] Request starting HTTP/1.1 POST http://localhost:5264/api/proxy/forward?url=https://icreditdept.com/api/testasp/test_local_generate_otp.php - application/json 115
2025-01-31 14:54:37.390 +03:00 [WRN] Failed to determine the https port for redirect.
2025-01-31 14:54:37.394 +03:00 [INF] Executing endpoint 'NayifatAPI.Controllers.ProxyController.ForwardRequest (NayifatAPI)'
2025-01-31 14:54:37.415 +03:00 [INF] Route matched with {action = "ForwardRequest", controller = "Proxy"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] ForwardRequest() on controller NayifatAPI.Controllers.ProxyController (NayifatAPI).
2025-01-31 14:54:37.540 +03:00 [INF] Start processing HTTP request POST https://icreditdept.com/api/testasp/test_local_generate_otp.php
2025-01-31 14:54:37.542 +03:00 [INF] Sending HTTP request POST https://icreditdept.com/api/testasp/test_local_generate_otp.php
2025-01-31 14:54:38.940 +03:00 [INF] Received HTTP response headers after 1395.6739ms - 200
2025-01-31 14:54:38.945 +03:00 [INF] End processing HTTP request after 1407.2756ms - 200
2025-01-31 14:54:38.951 +03:00 [INF] Raw response length: 200
2025-01-31 14:54:38.952 +03:00 [INF] Response content: {"success":true,"errors":[],"result":{"nationalId":"1012345678","otp":143038,"expiryDate":"2025-01-31 14:59:38","successMsg":"Success","errCode":0,"errMsg":null},"type":"N","message":null,"code":null}
2025-01-31 14:54:38.955 +03:00 [INF] Executing ContentResult with HTTP Response ContentType of application/json
2025-01-31 14:54:38.960 +03:00 [INF] Executed action NayifatAPI.Controllers.ProxyController.ForwardRequest (NayifatAPI) in 1539.2051ms
2025-01-31 14:54:38.967 +03:00 [INF] Executed endpoint 'NayifatAPI.Controllers.ProxyController.ForwardRequest (NayifatAPI)'
2025-01-31 14:54:38.974 +03:00 [INF] Request finished HTTP/1.1 POST http://localhost:5264/api/proxy/forward?url=https://icreditdept.com/api/testasp/test_local_generate_otp.php - 200 200 application/json 1637.1155ms
2025-01-31 14:57:05.021 +03:00 [INF] Request starting HTTP/1.1 POST http://localhost:5264/api/proxy/forward?url=https://icreditdept.com/api/testasp/test_local_verify_otp.php - application/json 72
2025-01-31 14:57:05.029 +03:00 [INF] Executing endpoint 'NayifatAPI.Controllers.ProxyController.ForwardRequest (NayifatAPI)'
2025-01-31 14:57:05.031 +03:00 [INF] Route matched with {action = "ForwardRequest", controller = "Proxy"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] ForwardRequest() on controller NayifatAPI.Controllers.ProxyController (NayifatAPI).
2025-01-31 14:57:05.045 +03:00 [INF] Start processing HTTP request POST https://icreditdept.com/api/testasp/test_local_verify_otp.php
2025-01-31 14:57:05.048 +03:00 [INF] Sending HTTP request POST https://icreditdept.com/api/testasp/test_local_verify_otp.php
2025-01-31 14:57:05.678 +03:00 [INF] Received HTTP response headers after 628.3968ms - 200
2025-01-31 14:57:05.679 +03:00 [INF] End processing HTTP request after 634.4905ms - 200
2025-01-31 14:57:05.681 +03:00 [INF] Raw response length: 43
2025-01-31 14:57:05.681 +03:00 [INF] Response content: {"success":false,"message":"Incorrect OTP"}
2025-01-31 14:57:05.682 +03:00 [INF] Executing ContentResult with HTTP Response ContentType of application/json
2025-01-31 14:57:05.683 +03:00 [INF] Executed action NayifatAPI.Controllers.ProxyController.ForwardRequest (NayifatAPI) in 650.9563ms
2025-01-31 14:57:05.684 +03:00 [INF] Executed endpoint 'NayifatAPI.Controllers.ProxyController.ForwardRequest (NayifatAPI)'
2025-01-31 14:57:05.686 +03:00 [INF] Request finished HTTP/1.1 POST http://localhost:5264/api/proxy/forward?url=https://icreditdept.com/api/testasp/test_local_verify_otp.php - 200 43 application/json 665.0346ms
2025-01-31 14:57:16.379 +03:00 [INF] Request starting HTTP/1.1 POST http://localhost:5264/api/proxy/forward?url=https://icreditdept.com/api/testasp/test_local_generate_otp.php - application/json 115
2025-01-31 14:57:16.383 +03:00 [INF] Executing endpoint 'NayifatAPI.Controllers.ProxyController.ForwardRequest (NayifatAPI)'
2025-01-31 14:57:16.384 +03:00 [INF] Route matched with {action = "ForwardRequest", controller = "Proxy"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] ForwardRequest() on controller NayifatAPI.Controllers.ProxyController (NayifatAPI).
2025-01-31 14:57:16.391 +03:00 [INF] Start processing HTTP request POST https://icreditdept.com/api/testasp/test_local_generate_otp.php
2025-01-31 14:57:16.396 +03:00 [INF] Sending HTTP request POST https://icreditdept.com/api/testasp/test_local_generate_otp.php
2025-01-31 14:57:16.851 +03:00 [INF] Received HTTP response headers after 453.5161ms - 200
2025-01-31 14:57:16.852 +03:00 [INF] End processing HTTP request after 461.2999ms - 200
2025-01-31 14:57:16.853 +03:00 [INF] Raw response length: 200
2025-01-31 14:57:16.854 +03:00 [INF] Response content: {"success":true,"errors":[],"result":{"nationalId":"1012345678","otp":243597,"expiryDate":"2025-01-31 15:02:16","successMsg":"Success","errCode":0,"errMsg":null},"type":"N","message":null,"code":null}
2025-01-31 14:57:16.855 +03:00 [INF] Executing ContentResult with HTTP Response ContentType of application/json
2025-01-31 14:57:16.856 +03:00 [INF] Executed action NayifatAPI.Controllers.ProxyController.ForwardRequest (NayifatAPI) in 470.3794ms
2025-01-31 14:57:16.858 +03:00 [INF] Executed endpoint 'NayifatAPI.Controllers.ProxyController.ForwardRequest (NayifatAPI)'
2025-01-31 14:57:16.860 +03:00 [INF] Request finished HTTP/1.1 POST http://localhost:5264/api/proxy/forward?url=https://icreditdept.com/api/testasp/test_local_generate_otp.php - 200 200 application/json 481.2526ms
2025-01-31 14:57:36.991 +03:00 [INF] Request starting HTTP/1.1 POST http://localhost:5264/api/proxy/forward?url=https://icreditdept.com/api/testasp/test_local_verify_otp.php - application/json 72
2025-01-31 14:57:36.993 +03:00 [INF] Executing endpoint 'NayifatAPI.Controllers.ProxyController.ForwardRequest (NayifatAPI)'
2025-01-31 14:57:36.995 +03:00 [INF] Route matched with {action = "ForwardRequest", controller = "Proxy"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] ForwardRequest() on controller NayifatAPI.Controllers.ProxyController (NayifatAPI).
2025-01-31 14:57:36.997 +03:00 [INF] Start processing HTTP request POST https://icreditdept.com/api/testasp/test_local_verify_otp.php
2025-01-31 14:57:36.998 +03:00 [INF] Sending HTTP request POST https://icreditdept.com/api/testasp/test_local_verify_otp.php
2025-01-31 14:57:37.437 +03:00 [INF] Received HTTP response headers after 437.5696ms - 200
2025-01-31 14:57:37.441 +03:00 [INF] End processing HTTP request after 443.5108ms - 200
2025-01-31 14:57:37.442 +03:00 [INF] Raw response length: 202
2025-01-31 14:57:37.443 +03:00 [INF] Response content: {"success":true,"errors":[],"result":{"nationalId":"1012345678","otp":"243597","verifiedFlag":true,"successMsg":"Verified successfully.","errCode":0,"errMsg":null},"type":"N","message":null,"code":null}
2025-01-31 14:57:37.446 +03:00 [INF] Executing ContentResult with HTTP Response ContentType of application/json
2025-01-31 14:57:37.448 +03:00 [INF] Executed action NayifatAPI.Controllers.ProxyController.ForwardRequest (NayifatAPI) in 451.077ms
2025-01-31 14:57:37.452 +03:00 [INF] Executed endpoint 'NayifatAPI.Controllers.ProxyController.ForwardRequest (NayifatAPI)'
2025-01-31 14:57:37.457 +03:00 [INF] Request finished HTTP/1.1 POST http://localhost:5264/api/proxy/forward?url=https://icreditdept.com/api/testasp/test_local_verify_otp.php - 200 202 application/json 465.9211ms
2025-01-31 14:59:52.674 +03:00 [INF] Request starting HTTP/1.1 POST http://localhost:5264/api/proxy/forward?url=https://icreditdept.com/api/testasp/test_local_verify_otp.php - application/json 72
2025-01-31 14:59:52.677 +03:00 [INF] Executing endpoint 'NayifatAPI.Controllers.ProxyController.ForwardRequest (NayifatAPI)'
2025-01-31 14:59:52.678 +03:00 [INF] Route matched with {action = "ForwardRequest", controller = "Proxy"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] ForwardRequest() on controller NayifatAPI.Controllers.ProxyController (NayifatAPI).
2025-01-31 14:59:52.679 +03:00 [INF] Start processing HTTP request POST https://icreditdept.com/api/testasp/test_local_verify_otp.php
2025-01-31 14:59:52.680 +03:00 [INF] Sending HTTP request POST https://icreditdept.com/api/testasp/test_local_verify_otp.php
2025-01-31 14:59:53.455 +03:00 [INF] Received HTTP response headers after 774.3175ms - 200
2025-01-31 14:59:53.456 +03:00 [INF] End processing HTTP request after 776.9455ms - 200
2025-01-31 14:59:53.457 +03:00 [INF] Raw response length: 43
2025-01-31 14:59:53.458 +03:00 [INF] Response content: {"success":false,"message":"Incorrect OTP"}
2025-01-31 14:59:53.458 +03:00 [INF] Executing ContentResult with HTTP Response ContentType of application/json
2025-01-31 14:59:53.459 +03:00 [INF] Executed action NayifatAPI.Controllers.ProxyController.ForwardRequest (NayifatAPI) in 780.4439ms
2025-01-31 14:59:53.460 +03:00 [INF] Executed endpoint 'NayifatAPI.Controllers.ProxyController.ForwardRequest (NayifatAPI)'
2025-01-31 14:59:53.461 +03:00 [INF] Request finished HTTP/1.1 POST http://localhost:5264/api/proxy/forward?url=https://icreditdept.com/api/testasp/test_local_verify_otp.php - 200 43 application/json 786.6608ms
2025-01-31 15:00:11.953 +03:00 [INF] Request starting HTTP/1.1 POST http://localhost:5264/api/proxy/forward?url=https://icreditdept.com/api/testasp/test_local_generate_otp.php - application/json 115
2025-01-31 15:00:11.956 +03:00 [INF] Executing endpoint 'NayifatAPI.Controllers.ProxyController.ForwardRequest (NayifatAPI)'
2025-01-31 15:00:11.957 +03:00 [INF] Route matched with {action = "ForwardRequest", controller = "Proxy"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] ForwardRequest() on controller NayifatAPI.Controllers.ProxyController (NayifatAPI).
2025-01-31 15:00:11.960 +03:00 [INF] Start processing HTTP request POST https://icreditdept.com/api/testasp/test_local_generate_otp.php
2025-01-31 15:00:11.961 +03:00 [INF] Sending HTTP request POST https://icreditdept.com/api/testasp/test_local_generate_otp.php
2025-01-31 15:00:12.393 +03:00 [INF] Received HTTP response headers after 431.5858ms - 200
2025-01-31 15:00:12.394 +03:00 [INF] End processing HTTP request after 434.3544ms - 200
2025-01-31 15:00:12.395 +03:00 [INF] Raw response length: 200
2025-01-31 15:00:12.395 +03:00 [INF] Response content: {"success":true,"errors":[],"result":{"nationalId":"1012345678","otp":656053,"expiryDate":"2025-01-31 15:05:12","successMsg":"Success","errCode":0,"errMsg":null},"type":"N","message":null,"code":null}
2025-01-31 15:00:12.402 +03:00 [INF] Executing ContentResult with HTTP Response ContentType of application/json
2025-01-31 15:00:12.404 +03:00 [INF] Executed action NayifatAPI.Controllers.ProxyController.ForwardRequest (NayifatAPI) in 444.4806ms
2025-01-31 15:00:12.407 +03:00 [INF] Executed endpoint 'NayifatAPI.Controllers.ProxyController.ForwardRequest (NayifatAPI)'
2025-01-31 15:00:12.409 +03:00 [INF] Request finished HTTP/1.1 POST http://localhost:5264/api/proxy/forward?url=https://icreditdept.com/api/testasp/test_local_generate_otp.php - 200 200 application/json 456.0171ms
2025-01-31 15:05:37.610 +03:00 [INF] Request starting HTTP/1.1 POST http://localhost:5264/api/auth/signin - application/json 62
2025-01-31 15:05:37.613 +03:00 [INF] Executing endpoint 'NayifatAPI.Controllers.AuthController.SignIn (NayifatAPI)'
2025-01-31 15:05:37.623 +03:00 [INF] Route matched with {action = "SignIn", controller = "Auth"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] SignIn(NayifatAPI.Controllers.SignInRequest) on controller NayifatAPI.Controllers.AuthController (NayifatAPI).
2025-01-31 15:05:37.673 +03:00 [INF] Executing BadRequestObjectResult, writing value of type 'Microsoft.AspNetCore.Mvc.ValidationProblemDetails'.
2025-01-31 15:05:37.719 +03:00 [INF] Executed action NayifatAPI.Controllers.AuthController.SignIn (NayifatAPI) in 92.6783ms
2025-01-31 15:05:37.721 +03:00 [INF] Executed endpoint 'NayifatAPI.Controllers.AuthController.SignIn (NayifatAPI)'
2025-01-31 15:05:37.723 +03:00 [INF] Request finished HTTP/1.1 POST http://localhost:5264/api/auth/signin - 400 null application/problem+json; charset=utf-8 113.4644ms
2025-01-31 15:05:48.974 +03:00 [INF] Request starting HTTP/1.1 POST http://localhost:5264/api/auth/signin - application/json 62
2025-01-31 15:05:48.977 +03:00 [INF] Executing endpoint 'NayifatAPI.Controllers.AuthController.SignIn (NayifatAPI)'
2025-01-31 15:05:48.978 +03:00 [INF] Route matched with {action = "SignIn", controller = "Auth"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] SignIn(NayifatAPI.Controllers.SignInRequest) on controller NayifatAPI.Controllers.AuthController (NayifatAPI).
2025-01-31 15:05:48.981 +03:00 [INF] Executing BadRequestObjectResult, writing value of type 'Microsoft.AspNetCore.Mvc.ValidationProblemDetails'.
2025-01-31 15:05:48.984 +03:00 [INF] Executed action NayifatAPI.Controllers.AuthController.SignIn (NayifatAPI) in 4.7198ms
2025-01-31 15:05:48.986 +03:00 [INF] Executed endpoint 'NayifatAPI.Controllers.AuthController.SignIn (NayifatAPI)'
2025-01-31 15:05:48.988 +03:00 [INF] Request finished HTTP/1.1 POST http://localhost:5264/api/auth/signin - 400 null application/problem+json; charset=utf-8 13.6745ms
2025-01-31 15:07:07.486 +03:00 [INF] Request starting HTTP/1.1 POST http://localhost:5264/api/auth/signin - application/json 123
2025-01-31 15:07:07.488 +03:00 [INF] Executing endpoint 'NayifatAPI.Controllers.AuthController.SignIn (NayifatAPI)'
2025-01-31 15:07:07.489 +03:00 [INF] Route matched with {action = "SignIn", controller = "Auth"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] SignIn(NayifatAPI.Controllers.SignInRequest) on controller NayifatAPI.Controllers.AuthController (NayifatAPI).
2025-01-31 15:07:07.492 +03:00 [INF] Executing BadRequestObjectResult, writing value of type 'Microsoft.AspNetCore.Mvc.ValidationProblemDetails'.
2025-01-31 15:07:07.493 +03:00 [INF] Executed action NayifatAPI.Controllers.AuthController.SignIn (NayifatAPI) in 1.8189ms
2025-01-31 15:07:07.494 +03:00 [INF] Executed endpoint 'NayifatAPI.Controllers.AuthController.SignIn (NayifatAPI)'
2025-01-31 15:07:07.495 +03:00 [INF] Request finished HTTP/1.1 POST http://localhost:5264/api/auth/signin - 400 null application/problem+json; charset=utf-8 9.1956ms
2025-01-31 15:11:37.771 +03:00 [INF] Request starting HTTP/1.1 POST http://localhost:5264/api/auth/signin - application/json 226
2025-01-31 15:11:37.780 +03:00 [INF] Executing endpoint 'NayifatAPI.Controllers.AuthController.SignIn (NayifatAPI)'
2025-01-31 15:11:37.782 +03:00 [INF] Route matched with {action = "SignIn", controller = "Auth"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] SignIn(NayifatAPI.Controllers.SignInRequest) on controller NayifatAPI.Controllers.AuthController (NayifatAPI).
2025-01-31 15:11:37.789 +03:00 [INF] Executing BadRequestObjectResult, writing value of type 'Microsoft.AspNetCore.Mvc.ValidationProblemDetails'.
2025-01-31 15:11:37.793 +03:00 [INF] Executed action NayifatAPI.Controllers.AuthController.SignIn (NayifatAPI) in 6.4252ms
2025-01-31 15:11:37.795 +03:00 [INF] Executed endpoint 'NayifatAPI.Controllers.AuthController.SignIn (NayifatAPI)'
2025-01-31 15:11:37.797 +03:00 [INF] Request finished HTTP/1.1 POST http://localhost:5264/api/auth/signin - 400 null application/problem+json; charset=utf-8 26.0225ms
2025-01-31 15:11:51.934 +03:00 [INF] Request starting HTTP/1.1 POST http://localhost:5264/api/auth/signin - application/json 226
2025-01-31 15:11:51.939 +03:00 [INF] Executing endpoint 'NayifatAPI.Controllers.AuthController.SignIn (NayifatAPI)'
2025-01-31 15:11:51.941 +03:00 [INF] Route matched with {action = "SignIn", controller = "Auth"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] SignIn(NayifatAPI.Controllers.SignInRequest) on controller NayifatAPI.Controllers.AuthController (NayifatAPI).
2025-01-31 15:11:51.948 +03:00 [INF] Executing BadRequestObjectResult, writing value of type 'Microsoft.AspNetCore.Mvc.ValidationProblemDetails'.
2025-01-31 15:11:51.952 +03:00 [INF] Executed action NayifatAPI.Controllers.AuthController.SignIn (NayifatAPI) in 6.6496ms
2025-01-31 15:11:51.957 +03:00 [INF] Executed endpoint 'NayifatAPI.Controllers.AuthController.SignIn (NayifatAPI)'
2025-01-31 15:11:51.967 +03:00 [INF] Request finished HTTP/1.1 POST http://localhost:5264/api/auth/signin - 400 null application/problem+json; charset=utf-8 33.2173ms
2025-01-31 15:12:19.964 +03:00 [INF] Request starting HTTP/1.1 POST http://localhost:5264/api/auth/signin - application/json 235
2025-01-31 15:12:19.969 +03:00 [INF] Executing endpoint 'NayifatAPI.Controllers.AuthController.SignIn (NayifatAPI)'
2025-01-31 15:12:19.971 +03:00 [INF] Route matched with {action = "SignIn", controller = "Auth"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] SignIn(NayifatAPI.Controllers.SignInRequest) on controller NayifatAPI.Controllers.AuthController (NayifatAPI).
2025-01-31 15:12:22.277 +03:00 [INF] Executed DbCommand (63ms) [Parameters=[@__providedApiKey_0='?' (Size = 255)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [a].[Key], [a].[CreatedAt], [a].[Description], [a].[ExpiresAt], [a].[IsActive], [a].[LastUsedAt]
FROM [ApiKeys] AS [a]
WHERE [a].[Key] = @__providedApiKey_0 AND [a].[IsActive] = CAST(1 AS bit)
2025-01-31 15:12:22.532 +03:00 [INF] Executed DbCommand (34ms) [Parameters=[@__request_NationalId_0='?' (Size = 450)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [c].[NationalId], [c].[AddNo], [c].[BuildingNo], [c].[City], [c].[Consent], [c].[ConsentDate], [c].[DateOfBirth], [c].[Dependents], [c].[District], [c].[Email], [c].[Employer], [c].[FamilyNameAr], [c].[FamilyNameEn], [c].[FirstNameAr], [c].[FirstNameEn], [c].[Iban], [c].[IdExpiryDate], [c].[Los], [c].[Mpin], [c].[MpinEnabled], [c].[NafathStatus], [c].[NafathTimestamp], [c].[Password], [c].[Phone], [c].[RegistrationDate], [c].[SalaryCustomer], [c].[SalaryDakhli], [c].[SecondNameAr], [c].[SecondNameEn], [c].[Sector], [c].[Street], [c].[ThirdNameAr], [c].[ThirdNameEn], [c].[Zipcode]
FROM [Customers] AS [c]
WHERE [c].[NationalId] = @__request_NationalId_0
2025-01-31 15:12:22.741 +03:00 [INF] Executed DbCommand (12ms) [Parameters=[@__request_NationalId_0='?' (Size = 450), @__request_DeviceId_1='?' (Size = 450)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [c].[Id], [c].[BiometricEnabled], [c].[BiometricToken], [c].[CreatedAt], [c].[DeviceId], [c].[LastUsedAt], [c].[Manufacturer], [c].[Model], [c].[NationalId], [c].[OsVersion], [c].[Platform], [c].[Status]
FROM [Customer_Devices] AS [c]
WHERE [c].[NationalId] = @__request_NationalId_0 AND [c].[DeviceId] = @__request_DeviceId_1 AND [c].[Status] = N'active'
2025-01-31 15:12:23.142 +03:00 [INF] Executed DbCommand (13ms) [Parameters=[@p0='?' (Size = 4000), @p1='?' (DbType = DateTime2), @p2='?' (Size = 4000), @p3='?' (Size = 4000), @p4='?' (Size = 4000), @p5='?' (Size = 450), @p6='?' (Size = 4000), @p7='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SET IMPLICIT_TRANSACTIONS OFF;
SET NOCOUNT ON;
INSERT INTO [AuthLogs] ([AuthType], [CreatedAt], [DeviceId], [FailureReason], [IpAddress], [NationalId], [Status], [UserAgent])
OUTPUT INSERTED.[Id]
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7);
2025-01-31 15:12:23.199 +03:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType9`2[[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Object, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-01-31 15:12:23.229 +03:00 [INF] Executed action NayifatAPI.Controllers.AuthController.SignIn (NayifatAPI) in 3252.9738ms
2025-01-31 15:12:23.233 +03:00 [INF] Executed endpoint 'NayifatAPI.Controllers.AuthController.SignIn (NayifatAPI)'
2025-01-31 15:12:23.250 +03:00 [INF] Request finished HTTP/1.1 POST http://localhost:5264/api/auth/signin - 200 null application/json; charset=utf-8 3285.9954ms
2025-01-31 15:13:06.820 +03:00 [INF] Request starting HTTP/1.1 POST http://localhost:5264/api/auth/signin - application/json 221
2025-01-31 15:13:06.829 +03:00 [INF] Executing endpoint 'NayifatAPI.Controllers.AuthController.SignIn (NayifatAPI)'
2025-01-31 15:13:06.831 +03:00 [INF] Route matched with {action = "SignIn", controller = "Auth"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] SignIn(NayifatAPI.Controllers.SignInRequest) on controller NayifatAPI.Controllers.AuthController (NayifatAPI).
2025-01-31 15:13:07.079 +03:00 [INF] Executed DbCommand (195ms) [Parameters=[@__providedApiKey_0='?' (Size = 255)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [a].[Key], [a].[CreatedAt], [a].[Description], [a].[ExpiresAt], [a].[IsActive], [a].[LastUsedAt]
FROM [ApiKeys] AS [a]
WHERE [a].[Key] = @__providedApiKey_0 AND [a].[IsActive] = CAST(1 AS bit)
2025-01-31 15:13:07.090 +03:00 [INF] Executed DbCommand (4ms) [Parameters=[@__request_NationalId_0='?' (Size = 450)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [c].[NationalId], [c].[AddNo], [c].[BuildingNo], [c].[City], [c].[Consent], [c].[ConsentDate], [c].[DateOfBirth], [c].[Dependents], [c].[District], [c].[Email], [c].[Employer], [c].[FamilyNameAr], [c].[FamilyNameEn], [c].[FirstNameAr], [c].[FirstNameEn], [c].[Iban], [c].[IdExpiryDate], [c].[Los], [c].[Mpin], [c].[MpinEnabled], [c].[NafathStatus], [c].[NafathTimestamp], [c].[Password], [c].[Phone], [c].[RegistrationDate], [c].[SalaryCustomer], [c].[SalaryDakhli], [c].[SecondNameAr], [c].[SecondNameEn], [c].[Sector], [c].[Street], [c].[ThirdNameAr], [c].[ThirdNameEn], [c].[Zipcode]
FROM [Customers] AS [c]
WHERE [c].[NationalId] = @__request_NationalId_0
2025-01-31 15:13:07.105 +03:00 [INF] Executed DbCommand (5ms) [Parameters=[@__request_NationalId_0='?' (Size = 450), @__request_DeviceId_1='?' (Size = 450)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [c].[Id], [c].[BiometricEnabled], [c].[BiometricToken], [c].[CreatedAt], [c].[DeviceId], [c].[LastUsedAt], [c].[Manufacturer], [c].[Model], [c].[NationalId], [c].[OsVersion], [c].[Platform], [c].[Status]
FROM [Customer_Devices] AS [c]
WHERE [c].[NationalId] = @__request_NationalId_0 AND [c].[DeviceId] = @__request_DeviceId_1 AND [c].[Status] = N'active'
2025-01-31 15:13:07.125 +03:00 [INF] Executed DbCommand (7ms) [Parameters=[@p0='?' (Size = 4000), @p1='?' (DbType = DateTime2), @p2='?' (Size = 4000), @p3='?' (Size = 4000), @p4='?' (Size = 4000), @p5='?' (Size = 450), @p6='?' (Size = 4000), @p7='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SET IMPLICIT_TRANSACTIONS OFF;
SET NOCOUNT ON;
INSERT INTO [AuthLogs] ([AuthType], [CreatedAt], [DeviceId], [FailureReason], [IpAddress], [NationalId], [Status], [UserAgent])
OUTPUT INSERTED.[Id]
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7);
2025-01-31 15:13:07.135 +03:00 [INF] Executing ObjectResult, writing value of type '<>f__AnonymousType12`3[[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Object, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-01-31 15:13:07.143 +03:00 [INF] Executed action NayifatAPI.Controllers.AuthController.SignIn (NayifatAPI) in 307.1954ms
2025-01-31 15:13:07.151 +03:00 [INF] Executed endpoint 'NayifatAPI.Controllers.AuthController.SignIn (NayifatAPI)'
2025-01-31 15:13:07.154 +03:00 [INF] Request finished HTTP/1.1 POST http://localhost:5264/api/auth/signin - 401 null application/json; charset=utf-8 333.9799ms
2025-01-31 15:13:16.797 +03:00 [INF] Request starting HTTP/1.1 POST http://localhost:5264/api/auth/signin - application/json 235
2025-01-31 15:13:16.801 +03:00 [INF] Executing endpoint 'NayifatAPI.Controllers.AuthController.SignIn (NayifatAPI)'
2025-01-31 15:13:16.804 +03:00 [INF] Route matched with {action = "SignIn", controller = "Auth"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] SignIn(NayifatAPI.Controllers.SignInRequest) on controller NayifatAPI.Controllers.AuthController (NayifatAPI).
2025-01-31 15:13:16.951 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@__providedApiKey_0='?' (Size = 255)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [a].[Key], [a].[CreatedAt], [a].[Description], [a].[ExpiresAt], [a].[IsActive], [a].[LastUsedAt]
FROM [ApiKeys] AS [a]
WHERE [a].[Key] = @__providedApiKey_0 AND [a].[IsActive] = CAST(1 AS bit)
2025-01-31 15:13:16.962 +03:00 [INF] Executed DbCommand (2ms) [Parameters=[@__request_NationalId_0='?' (Size = 450)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [c].[NationalId], [c].[AddNo], [c].[BuildingNo], [c].[City], [c].[Consent], [c].[ConsentDate], [c].[DateOfBirth], [c].[Dependents], [c].[District], [c].[Email], [c].[Employer], [c].[FamilyNameAr], [c].[FamilyNameEn], [c].[FirstNameAr], [c].[FirstNameEn], [c].[Iban], [c].[IdExpiryDate], [c].[Los], [c].[Mpin], [c].[MpinEnabled], [c].[NafathStatus], [c].[NafathTimestamp], [c].[Password], [c].[Phone], [c].[RegistrationDate], [c].[SalaryCustomer], [c].[SalaryDakhli], [c].[SecondNameAr], [c].[SecondNameEn], [c].[Sector], [c].[Street], [c].[ThirdNameAr], [c].[ThirdNameEn], [c].[Zipcode]
FROM [Customers] AS [c]
WHERE [c].[NationalId] = @__request_NationalId_0
2025-01-31 15:13:16.980 +03:00 [INF] Executed DbCommand (7ms) [Parameters=[@__request_NationalId_0='?' (Size = 450), @__request_DeviceId_1='?' (Size = 450)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [c].[Id], [c].[BiometricEnabled], [c].[BiometricToken], [c].[CreatedAt], [c].[DeviceId], [c].[LastUsedAt], [c].[Manufacturer], [c].[Model], [c].[NationalId], [c].[OsVersion], [c].[Platform], [c].[Status]
FROM [Customer_Devices] AS [c]
WHERE [c].[NationalId] = @__request_NationalId_0 AND [c].[DeviceId] = @__request_DeviceId_1 AND [c].[Status] = N'active'
2025-01-31 15:13:16.992 +03:00 [INF] Executed DbCommand (3ms) [Parameters=[@p0='?' (Size = 4000), @p1='?' (DbType = DateTime2), @p2='?' (Size = 4000), @p3='?' (Size = 4000), @p4='?' (Size = 4000), @p5='?' (Size = 450), @p6='?' (Size = 4000), @p7='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SET IMPLICIT_TRANSACTIONS OFF;
SET NOCOUNT ON;
INSERT INTO [AuthLogs] ([AuthType], [CreatedAt], [DeviceId], [FailureReason], [IpAddress], [NationalId], [Status], [UserAgent])
OUTPUT INSERTED.[Id]
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7);
2025-01-31 15:13:17.002 +03:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType9`2[[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Object, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-01-31 15:13:17.005 +03:00 [INF] Executed action NayifatAPI.Controllers.AuthController.SignIn (NayifatAPI) in 197.8856ms
2025-01-31 15:13:17.013 +03:00 [INF] Executed endpoint 'NayifatAPI.Controllers.AuthController.SignIn (NayifatAPI)'
2025-01-31 15:13:17.016 +03:00 [INF] Request finished HTTP/1.1 POST http://localhost:5264/api/auth/signin - 200 null application/json; charset=utf-8 219.4842ms
2025-01-31 20:27:45.941 +03:00 [INF] Starting web application
2025-01-31 20:27:46.065 +03:00 [INF] Now listening on: http://localhost:5264
2025-01-31 20:27:46.071 +03:00 [INF] Application started. Press Ctrl+C to shut down.
2025-01-31 20:27:46.072 +03:00 [INF] Hosting environment: Development
2025-01-31 20:27:46.073 +03:00 [INF] Content root path: C:\Users\yamta\StudioProjects\nayifat_app_2025_new\nayifatapi
2025-01-31 20:27:59.143 +03:00 [INF] Request starting HTTP/1.1 POST http://localhost:5264/api/auth/signin - application/json 235
2025-01-31 20:27:59.266 +03:00 [WRN] Failed to determine the https port for redirect.
2025-01-31 20:27:59.273 +03:00 [INF] Executing endpoint 'NayifatAPI.Controllers.AuthController.SignIn (NayifatAPI)'
2025-01-31 20:27:59.308 +03:00 [INF] Route matched with {action = "SignIn", controller = "Auth"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] SignIn(NayifatAPI.Controllers.SignInRequest) on controller NayifatAPI.Controllers.AuthController (NayifatAPI).
2025-01-31 20:28:02.187 +03:00 [INF] Executed DbCommand (77ms) [Parameters=[@__providedApiKey_0='?' (Size = 255)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [a].[Key], [a].[CreatedAt], [a].[Description], [a].[ExpiresAt], [a].[IsActive], [a].[LastUsedAt]
FROM [ApiKeys] AS [a]
WHERE [a].[Key] = @__providedApiKey_0 AND [a].[IsActive] = CAST(1 AS bit)
2025-01-31 20:28:02.515 +03:00 [INF] Executed DbCommand (85ms) [Parameters=[@__request_NationalId_0='?' (Size = 450)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [c].[NationalId], [c].[AddNo], [c].[BuildingNo], [c].[City], [c].[Consent], [c].[ConsentDate], [c].[DateOfBirth], [c].[Dependents], [c].[District], [c].[Email], [c].[Employer], [c].[FamilyNameAr], [c].[FamilyNameEn], [c].[FirstNameAr], [c].[FirstNameEn], [c].[Iban], [c].[IdExpiryDate], [c].[Los], [c].[Mpin], [c].[MpinEnabled], [c].[NafathStatus], [c].[NafathTimestamp], [c].[Password], [c].[Phone], [c].[RegistrationDate], [c].[SalaryCustomer], [c].[SalaryDakhli], [c].[SecondNameAr], [c].[SecondNameEn], [c].[Sector], [c].[Street], [c].[ThirdNameAr], [c].[ThirdNameEn], [c].[Zipcode]
FROM [Customers] AS [c]
WHERE [c].[NationalId] = @__request_NationalId_0
2025-01-31 20:28:02.899 +03:00 [INF] Executed DbCommand (30ms) [Parameters=[@__request_NationalId_0='?' (Size = 450), @__request_DeviceId_1='?' (Size = 450)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [c].[Id], [c].[BiometricEnabled], [c].[BiometricToken], [c].[CreatedAt], [c].[DeviceId], [c].[LastUsedAt], [c].[Manufacturer], [c].[Model], [c].[NationalId], [c].[OsVersion], [c].[Platform], [c].[Status]
FROM [Customer_Devices] AS [c]
WHERE [c].[NationalId] = @__request_NationalId_0 AND [c].[DeviceId] = @__request_DeviceId_1 AND [c].[Status] = N'active'
2025-01-31 20:28:04.288 +03:00 [INF] Executed DbCommand (13ms) [Parameters=[@p0='?' (Size = 4000), @p1='?' (DbType = DateTime2), @p2='?' (Size = 4000), @p3='?' (Size = 4000), @p4='?' (Size = 4000), @p5='?' (Size = 450), @p6='?' (Size = 4000), @p7='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SET IMPLICIT_TRANSACTIONS OFF;
SET NOCOUNT ON;
INSERT INTO [AuthLogs] ([AuthType], [CreatedAt], [DeviceId], [FailureReason], [IpAddress], [NationalId], [Status], [UserAgent])
OUTPUT INSERTED.[Id]
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7);
2025-01-31 20:28:04.346 +03:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType9`2[[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Object, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-01-31 20:28:04.385 +03:00 [INF] Executed action NayifatAPI.Controllers.AuthController.SignIn (NayifatAPI) in 5067.6932ms
2025-01-31 20:28:04.390 +03:00 [INF] Executed endpoint 'NayifatAPI.Controllers.AuthController.SignIn (NayifatAPI)'
2025-01-31 20:28:04.407 +03:00 [INF] Request finished HTTP/1.1 POST http://localhost:5264/api/auth/signin - 200 null application/json; charset=utf-8 5266.5106ms
2025-01-31 20:29:55.492 +03:00 [INF] Request starting HTTP/1.1 POST http://localhost:5264/api/auth/refresh - application/json 93
2025-01-31 20:29:55.517 +03:00 [INF] Executing endpoint 'NayifatAPI.Controllers.AuthController.RefreshToken (NayifatAPI)'
2025-01-31 20:29:55.860 +03:00 [INF] Route matched with {action = "RefreshToken", controller = "Auth"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] RefreshToken(NayifatAPI.Controllers.RefreshTokenRequest) on controller NayifatAPI.Controllers.AuthController (NayifatAPI).
2025-01-31 20:29:56.166 +03:00 [INF] Executing BadRequestObjectResult, writing value of type 'Microsoft.AspNetCore.Mvc.ValidationProblemDetails'.
2025-01-31 20:29:56.280 +03:00 [INF] Executed action NayifatAPI.Controllers.AuthController.RefreshToken (NayifatAPI) in 125.7935ms
2025-01-31 20:29:56.281 +03:00 [INF] Executed endpoint 'NayifatAPI.Controllers.AuthController.RefreshToken (NayifatAPI)'
2025-01-31 20:29:56.283 +03:00 [INF] Request finished HTTP/1.1 POST http://localhost:5264/api/auth/refresh - 400 null application/problem+json; charset=utf-8 791.1287ms
2025-01-31 20:30:18.794 +03:00 [INF] Request starting HTTP/1.1 POST http://localhost:5264/api/auth/refresh - application/json 93
2025-01-31 20:30:18.799 +03:00 [INF] Executing endpoint 'NayifatAPI.Controllers.AuthController.RefreshToken (NayifatAPI)'
2025-01-31 20:30:18.801 +03:00 [INF] Route matched with {action = "RefreshToken", controller = "Auth"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] RefreshToken(NayifatAPI.Controllers.RefreshTokenRequest) on controller NayifatAPI.Controllers.AuthController (NayifatAPI).
2025-01-31 20:30:18.806 +03:00 [INF] Executing BadRequestObjectResult, writing value of type 'Microsoft.AspNetCore.Mvc.ValidationProblemDetails'.
2025-01-31 20:30:18.809 +03:00 [INF] Executed action NayifatAPI.Controllers.AuthController.RefreshToken (NayifatAPI) in 6.4417ms
2025-01-31 20:30:18.812 +03:00 [INF] Executed endpoint 'NayifatAPI.Controllers.AuthController.RefreshToken (NayifatAPI)'
2025-01-31 20:30:18.814 +03:00 [INF] Request finished HTTP/1.1 POST http://localhost:5264/api/auth/refresh - 400 null application/problem+json; charset=utf-8 20.4757ms
2025-01-31 20:30:52.211 +03:00 [INF] Request starting HTTP/1.1 POST http://localhost:5264/api/auth/refresh - application/json 251
2025-01-31 20:30:52.213 +03:00 [INF] Executing endpoint 'NayifatAPI.Controllers.AuthController.RefreshToken (NayifatAPI)'
2025-01-31 20:30:52.214 +03:00 [INF] Route matched with {action = "RefreshToken", controller = "Auth"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] RefreshToken(NayifatAPI.Controllers.RefreshTokenRequest) on controller NayifatAPI.Controllers.AuthController (NayifatAPI).
2025-01-31 20:30:52.217 +03:00 [INF] Executing BadRequestObjectResult, writing value of type 'Microsoft.AspNetCore.Mvc.ValidationProblemDetails'.
2025-01-31 20:30:52.221 +03:00 [INF] Executed action NayifatAPI.Controllers.AuthController.RefreshToken (NayifatAPI) in 4.2604ms
2025-01-31 20:30:52.224 +03:00 [INF] Executed endpoint 'NayifatAPI.Controllers.AuthController.RefreshToken (NayifatAPI)'
2025-01-31 20:30:52.227 +03:00 [INF] Request finished HTTP/1.1 POST http://localhost:5264/api/auth/refresh - 400 null application/problem+json; charset=utf-8 15.4848ms
2025-01-31 20:32:33.443 +03:00 [INF] Request starting HTTP/1.1 POST http://localhost:5264/api/auth/refresh - application/json 125
2025-01-31 20:32:33.445 +03:00 [INF] Executing endpoint 'NayifatAPI.Controllers.AuthController.RefreshToken (NayifatAPI)'
2025-01-31 20:32:33.446 +03:00 [INF] Route matched with {action = "RefreshToken", controller = "Auth"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] RefreshToken(NayifatAPI.Controllers.RefreshTokenRequest) on controller NayifatAPI.Controllers.AuthController (NayifatAPI).
2025-01-31 20:32:33.497 +03:00 [INF] Executed DbCommand (6ms) [Parameters=[@__providedApiKey_0='?' (Size = 255)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [a].[Key], [a].[CreatedAt], [a].[Description], [a].[ExpiresAt], [a].[IsActive], [a].[LastUsedAt]
FROM [ApiKeys] AS [a]
WHERE [a].[Key] = @__providedApiKey_0 AND [a].[IsActive] = CAST(1 AS bit)
2025-01-31 20:32:33.502 +03:00 [INF] Executing ObjectResult, writing value of type '<>f__AnonymousType11`2[[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-01-31 20:32:33.506 +03:00 [INF] Executed action NayifatAPI.Controllers.AuthController.RefreshToken (NayifatAPI) in 58.3438ms
2025-01-31 20:32:33.507 +03:00 [INF] Executed endpoint 'NayifatAPI.Controllers.AuthController.RefreshToken (NayifatAPI)'
2025-01-31 20:32:33.510 +03:00 [INF] Request finished HTTP/1.1 POST http://localhost:5264/api/auth/refresh - 401 null application/json; charset=utf-8 67.3354ms
2025-01-31 20:33:07.965 +03:00 [INF] Request starting HTTP/1.1 POST http://localhost:5264/api/auth/refresh - application/json 125
2025-01-31 20:33:07.969 +03:00 [INF] Executing endpoint 'NayifatAPI.Controllers.AuthController.RefreshToken (NayifatAPI)'
2025-01-31 20:33:07.970 +03:00 [INF] Route matched with {action = "RefreshToken", controller = "Auth"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] RefreshToken(NayifatAPI.Controllers.RefreshTokenRequest) on controller NayifatAPI.Controllers.AuthController (NayifatAPI).
2025-01-31 20:33:08.067 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@__providedApiKey_0='?' (Size = 255)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [a].[Key], [a].[CreatedAt], [a].[Description], [a].[ExpiresAt], [a].[IsActive], [a].[LastUsedAt]
FROM [ApiKeys] AS [a]
WHERE [a].[Key] = @__providedApiKey_0 AND [a].[IsActive] = CAST(1 AS bit)
2025-01-31 20:33:08.154 +03:00 [INF] Executed DbCommand (76ms) [Parameters=[@p0='?' (Size = 4000), @p1='?' (DbType = DateTime2), @p2='?' (Size = 4000), @p3='?' (Size = 4000), @p4='?' (Size = 4000), @p5='?' (Size = 450), @p6='?' (Size = 4000), @p7='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SET IMPLICIT_TRANSACTIONS OFF;
SET NOCOUNT ON;
INSERT INTO [AuthLogs] ([AuthType], [CreatedAt], [DeviceId], [FailureReason], [IpAddress], [NationalId], [Status], [UserAgent])
OUTPUT INSERTED.[Id]
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7);
2025-01-31 20:33:08.159 +03:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType9`2[[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Object, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-01-31 20:33:08.163 +03:00 [INF] Executed action NayifatAPI.Controllers.AuthController.RefreshToken (NayifatAPI) in 190.0617ms
2025-01-31 20:33:08.165 +03:00 [INF] Executed endpoint 'NayifatAPI.Controllers.AuthController.RefreshToken (NayifatAPI)'
2025-01-31 20:33:08.170 +03:00 [INF] Request finished HTTP/1.1 POST http://localhost:5264/api/auth/refresh - 200 null application/json; charset=utf-8 204.4339ms
2025-01-31 20:58:18.590 +03:00 [INF] Request starting HTTP/1.1 POST http://localhost:5264/api/content/fetch - application/json 61
2025-01-31 20:58:18.593 +03:00 [INF] Executing endpoint 'NayifatAPI.Controllers.ContentController.MasterFetch (NayifatAPI)'
2025-01-31 20:58:18.598 +03:00 [INF] Route matched with {action = "MasterFetch", controller = "Content"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] MasterFetch(NayifatAPI.Controllers.MasterFetchRequest) on controller NayifatAPI.Controllers.ContentController (NayifatAPI).
2025-01-31 20:58:18.617 +03:00 [INF] Executed DbCommand (3ms) [Parameters=[@__providedApiKey_0='?' (Size = 255)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [a].[Key], [a].[CreatedAt], [a].[Description], [a].[ExpiresAt], [a].[IsActive], [a].[LastUsedAt]
FROM [ApiKeys] AS [a]
WHERE [a].[Key] = @__providedApiKey_0 AND [a].[IsActive] = CAST(1 AS bit)
2025-01-31 20:58:18.639 +03:00 [ERR] Failed executing DbCommand (5ms) [Parameters=[@__request_Page_0='?' (Size = 450), @__request_KeyName_1='?' (Size = 450)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [m].[Id], [m].[CreatedAt], [m].[IsActive], [m].[KeyName], [m].[Page], [m].[UpdatedAt], [m].[Value]
FROM [master_config] AS [m]
WHERE [m].[Page] = @__request_Page_0 AND [m].[KeyName] = @__request_KeyName_1 AND [m].[IsActive] = CAST(1 AS bit)
2025-01-31 20:58:18.667 +03:00 [ERR] An exception occurred while iterating over the results of a query for context type 'NayifatAPI.Data.ApplicationDbContext'.
Microsoft.Data.SqlClient.SqlException (0x80131904): Invalid column name 'KeyName'.
Invalid column name 'IsActive'.
Invalid column name 'Id'.
Invalid column name 'CreatedAt'.
Invalid column name 'IsActive'.
Invalid column name 'KeyName'.
Invalid column name 'UpdatedAt'.
   at Microsoft.Data.SqlClient.SqlCommand.<>c.<ExecuteDbDataReaderAsync>b__209_0(Task`1 result)
   at System.Threading.Tasks.ContinuationResultTaskFromResultTask`2.InnerInvoke()
   at System.Threading.ExecutionContext.RunInternal(ExecutionContext executionContext, ContextCallback callback, Object state)
--- End of stack trace from previous location ---
   at System.Threading.ExecutionContext.RunInternal(ExecutionContext executionContext, ContextCallback callback, Object state)
   at System.Threading.Tasks.Task.ExecuteWithThreadLocal(Task& currentTaskSlot, Thread threadPoolThread)
--- End of stack trace from previous location ---
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Query.Internal.SingleQueryingEnumerable`1.AsyncEnumerator.InitializeReaderAsync(AsyncEnumerator enumerator, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Storage.Internal.SqlServerExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Query.Internal.SingleQueryingEnumerable`1.AsyncEnumerator.MoveNextAsync()
ClientConnectionId:cb55027c-71eb-4d56-ae57-6581e55f78e5
Error Number:207,State:1,Class:16
Microsoft.Data.SqlClient.SqlException (0x80131904): Invalid column name 'KeyName'.
Invalid column name 'IsActive'.
Invalid column name 'Id'.
Invalid column name 'CreatedAt'.
Invalid column name 'IsActive'.
Invalid column name 'KeyName'.
Invalid column name 'UpdatedAt'.
   at Microsoft.Data.SqlClient.SqlCommand.<>c.<ExecuteDbDataReaderAsync>b__209_0(Task`1 result)
   at System.Threading.Tasks.ContinuationResultTaskFromResultTask`2.InnerInvoke()
   at System.Threading.ExecutionContext.RunInternal(ExecutionContext executionContext, ContextCallback callback, Object state)
--- End of stack trace from previous location ---
   at System.Threading.ExecutionContext.RunInternal(ExecutionContext executionContext, ContextCallback callback, Object state)
   at System.Threading.Tasks.Task.ExecuteWithThreadLocal(Task& currentTaskSlot, Thread threadPoolThread)
--- End of stack trace from previous location ---
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Query.Internal.SingleQueryingEnumerable`1.AsyncEnumerator.InitializeReaderAsync(AsyncEnumerator enumerator, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Storage.Internal.SqlServerExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Query.Internal.SingleQueryingEnumerable`1.AsyncEnumerator.MoveNextAsync()
ClientConnectionId:cb55027c-71eb-4d56-ae57-6581e55f78e5
Error Number:207,State:1,Class:16
2025-01-31 20:58:18.681 +03:00 [ERR] Error fetching content for page: home, key: slideshow_content
Microsoft.Data.SqlClient.SqlException (0x80131904): Invalid column name 'KeyName'.
Invalid column name 'IsActive'.
Invalid column name 'Id'.
Invalid column name 'CreatedAt'.
Invalid column name 'IsActive'.
Invalid column name 'KeyName'.
Invalid column name 'UpdatedAt'.
   at Microsoft.Data.SqlClient.SqlCommand.<>c.<ExecuteDbDataReaderAsync>b__209_0(Task`1 result)
   at System.Threading.Tasks.ContinuationResultTaskFromResultTask`2.InnerInvoke()
   at System.Threading.ExecutionContext.RunInternal(ExecutionContext executionContext, ContextCallback callback, Object state)
--- End of stack trace from previous location ---
   at System.Threading.ExecutionContext.RunInternal(ExecutionContext executionContext, ContextCallback callback, Object state)
   at System.Threading.Tasks.Task.ExecuteWithThreadLocal(Task& currentTaskSlot, Thread threadPoolThread)
--- End of stack trace from previous location ---
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Query.Internal.SingleQueryingEnumerable`1.AsyncEnumerator.InitializeReaderAsync(AsyncEnumerator enumerator, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Storage.Internal.SqlServerExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Query.Internal.SingleQueryingEnumerable`1.AsyncEnumerator.MoveNextAsync()
   at Microsoft.EntityFrameworkCore.Query.ShapedQueryCompilingExpressionVisitor.SingleOrDefaultAsync[TSource](IAsyncEnumerable`1 asyncEnumerable, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Query.ShapedQueryCompilingExpressionVisitor.SingleOrDefaultAsync[TSource](IAsyncEnumerable`1 asyncEnumerable, CancellationToken cancellationToken)
   at NayifatAPI.Controllers.ContentController.MasterFetch(MasterFetchRequest request) in C:\Users\yamta\StudioProjects\nayifat_app_2025_new\nayifatapi\Controllers\ContentController.cs:line 33
ClientConnectionId:cb55027c-71eb-4d56-ae57-6581e55f78e5
Error Number:207,State:1,Class:16
2025-01-31 20:58:18.701 +03:00 [INF] Executing ObjectResult, writing value of type '<>f__AnonymousType11`2[[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-01-31 20:58:18.702 +03:00 [INF] Executed action NayifatAPI.Controllers.ContentController.MasterFetch (NayifatAPI) in 102.0456ms
2025-01-31 20:58:18.704 +03:00 [INF] Executed endpoint 'NayifatAPI.Controllers.ContentController.MasterFetch (NayifatAPI)'
2025-01-31 20:58:18.706 +03:00 [INF] Request finished HTTP/1.1 POST http://localhost:5264/api/content/fetch - 500 null application/json; charset=utf-8 115.6033ms
2025-01-31 20:58:44.162 +03:00 [INF] Request starting HTTP/1.1 POST http://localhost:5264/api/content/fetch - application/json 61
2025-01-31 20:58:44.165 +03:00 [INF] Executing endpoint 'NayifatAPI.Controllers.ContentController.MasterFetch (NayifatAPI)'
2025-01-31 20:58:44.166 +03:00 [INF] Route matched with {action = "MasterFetch", controller = "Content"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] MasterFetch(NayifatAPI.Controllers.MasterFetchRequest) on controller NayifatAPI.Controllers.ContentController (NayifatAPI).
2025-01-31 20:58:44.177 +03:00 [INF] Executed DbCommand (4ms) [Parameters=[@__providedApiKey_0='?' (Size = 255)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [a].[Key], [a].[CreatedAt], [a].[Description], [a].[ExpiresAt], [a].[IsActive], [a].[LastUsedAt]
FROM [ApiKeys] AS [a]
WHERE [a].[Key] = @__providedApiKey_0 AND [a].[IsActive] = CAST(1 AS bit)
2025-01-31 20:58:44.182 +03:00 [ERR] Failed executing DbCommand (1ms) [Parameters=[@__request_Page_0='?' (Size = 450), @__request_KeyName_1='?' (Size = 450)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [m].[Id], [m].[CreatedAt], [m].[IsActive], [m].[KeyName], [m].[Page], [m].[UpdatedAt], [m].[Value]
FROM [master_config] AS [m]
WHERE [m].[Page] = @__request_Page_0 AND [m].[KeyName] = @__request_KeyName_1 AND [m].[IsActive] = CAST(1 AS bit)
2025-01-31 20:58:44.188 +03:00 [ERR] An exception occurred while iterating over the results of a query for context type 'NayifatAPI.Data.ApplicationDbContext'.
Microsoft.Data.SqlClient.SqlException (0x80131904): Invalid column name 'KeyName'.
Invalid column name 'IsActive'.
Invalid column name 'Id'.
Invalid column name 'CreatedAt'.
Invalid column name 'IsActive'.
Invalid column name 'KeyName'.
Invalid column name 'UpdatedAt'.
   at Microsoft.Data.SqlClient.SqlCommand.<>c.<ExecuteDbDataReaderAsync>b__209_0(Task`1 result)
   at System.Threading.Tasks.ContinuationResultTaskFromResultTask`2.InnerInvoke()
   at System.Threading.ExecutionContext.RunInternal(ExecutionContext executionContext, ContextCallback callback, Object state)
--- End of stack trace from previous location ---
   at System.Threading.ExecutionContext.RunInternal(ExecutionContext executionContext, ContextCallback callback, Object state)
   at System.Threading.Tasks.Task.ExecuteWithThreadLocal(Task& currentTaskSlot, Thread threadPoolThread)
--- End of stack trace from previous location ---
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Query.Internal.SingleQueryingEnumerable`1.AsyncEnumerator.InitializeReaderAsync(AsyncEnumerator enumerator, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Storage.Internal.SqlServerExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Query.Internal.SingleQueryingEnumerable`1.AsyncEnumerator.MoveNextAsync()
ClientConnectionId:cb55027c-71eb-4d56-ae57-6581e55f78e5
Error Number:207,State:1,Class:16
Microsoft.Data.SqlClient.SqlException (0x80131904): Invalid column name 'KeyName'.
Invalid column name 'IsActive'.
Invalid column name 'Id'.
Invalid column name 'CreatedAt'.
Invalid column name 'IsActive'.
Invalid column name 'KeyName'.
Invalid column name 'UpdatedAt'.
   at Microsoft.Data.SqlClient.SqlCommand.<>c.<ExecuteDbDataReaderAsync>b__209_0(Task`1 result)
   at System.Threading.Tasks.ContinuationResultTaskFromResultTask`2.InnerInvoke()
   at System.Threading.ExecutionContext.RunInternal(ExecutionContext executionContext, ContextCallback callback, Object state)
--- End of stack trace from previous location ---
   at System.Threading.ExecutionContext.RunInternal(ExecutionContext executionContext, ContextCallback callback, Object state)
   at System.Threading.Tasks.Task.ExecuteWithThreadLocal(Task& currentTaskSlot, Thread threadPoolThread)
--- End of stack trace from previous location ---
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Query.Internal.SingleQueryingEnumerable`1.AsyncEnumerator.InitializeReaderAsync(AsyncEnumerator enumerator, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Storage.Internal.SqlServerExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Query.Internal.SingleQueryingEnumerable`1.AsyncEnumerator.MoveNextAsync()
ClientConnectionId:cb55027c-71eb-4d56-ae57-6581e55f78e5
Error Number:207,State:1,Class:16
2025-01-31 20:58:44.200 +03:00 [ERR] Error fetching content for page: home, key: slideshow_content
Microsoft.Data.SqlClient.SqlException (0x80131904): Invalid column name 'KeyName'.
Invalid column name 'IsActive'.
Invalid column name 'Id'.
Invalid column name 'CreatedAt'.
Invalid column name 'IsActive'.
Invalid column name 'KeyName'.
Invalid column name 'UpdatedAt'.
   at Microsoft.Data.SqlClient.SqlCommand.<>c.<ExecuteDbDataReaderAsync>b__209_0(Task`1 result)
   at System.Threading.Tasks.ContinuationResultTaskFromResultTask`2.InnerInvoke()
   at System.Threading.ExecutionContext.RunInternal(ExecutionContext executionContext, ContextCallback callback, Object state)
--- End of stack trace from previous location ---
   at System.Threading.ExecutionContext.RunInternal(ExecutionContext executionContext, ContextCallback callback, Object state)
   at System.Threading.Tasks.Task.ExecuteWithThreadLocal(Task& currentTaskSlot, Thread threadPoolThread)
--- End of stack trace from previous location ---
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Query.Internal.SingleQueryingEnumerable`1.AsyncEnumerator.InitializeReaderAsync(AsyncEnumerator enumerator, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Storage.Internal.SqlServerExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Query.Internal.SingleQueryingEnumerable`1.AsyncEnumerator.MoveNextAsync()
   at Microsoft.EntityFrameworkCore.Query.ShapedQueryCompilingExpressionVisitor.SingleOrDefaultAsync[TSource](IAsyncEnumerable`1 asyncEnumerable, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Query.ShapedQueryCompilingExpressionVisitor.SingleOrDefaultAsync[TSource](IAsyncEnumerable`1 asyncEnumerable, CancellationToken cancellationToken)
   at NayifatAPI.Controllers.ContentController.MasterFetch(MasterFetchRequest request) in C:\Users\yamta\StudioProjects\nayifat_app_2025_new\nayifatapi\Controllers\ContentController.cs:line 33
ClientConnectionId:cb55027c-71eb-4d56-ae57-6581e55f78e5
Error Number:207,State:1,Class:16
2025-01-31 20:58:44.217 +03:00 [INF] Executing ObjectResult, writing value of type '<>f__AnonymousType11`2[[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-01-31 20:58:44.219 +03:00 [INF] Executed action NayifatAPI.Controllers.ContentController.MasterFetch (NayifatAPI) in 52.3816ms
2025-01-31 20:58:44.239 +03:00 [INF] Executed endpoint 'NayifatAPI.Controllers.ContentController.MasterFetch (NayifatAPI)'
2025-01-31 20:58:44.247 +03:00 [INF] Request finished HTTP/1.1 POST http://localhost:5264/api/content/fetch - 500 null application/json; charset=utf-8 84.8567ms
2025-01-31 20:59:13.827 +03:00 [INF] Application is shutting down...
2025-01-31 20:59:22.162 +03:00 [INF] Starting web application
2025-01-31 20:59:22.288 +03:00 [INF] Now listening on: http://localhost:5264
2025-01-31 20:59:22.293 +03:00 [INF] Application started. Press Ctrl+C to shut down.
2025-01-31 20:59:22.295 +03:00 [INF] Hosting environment: Development
2025-01-31 20:59:22.296 +03:00 [INF] Content root path: C:\Users\yamta\StudioProjects\nayifat_app_2025_new\nayifatapi
2025-01-31 20:59:33.363 +03:00 [INF] Request starting HTTP/1.1 POST http://localhost:5264/api/content/fetch - application/json 61
2025-01-31 20:59:33.449 +03:00 [WRN] Failed to determine the https port for redirect.
2025-01-31 20:59:33.466 +03:00 [INF] Executing endpoint 'NayifatAPI.Controllers.ContentController.MasterFetch (NayifatAPI)'
2025-01-31 20:59:33.500 +03:00 [INF] Route matched with {action = "MasterFetch", controller = "Content"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] MasterFetch(NayifatAPI.Controllers.MasterFetchRequest) on controller NayifatAPI.Controllers.ContentController (NayifatAPI).
2025-01-31 20:59:35.718 +03:00 [INF] Executed DbCommand (32ms) [Parameters=[@__providedApiKey_0='?' (Size = 255)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [a].[Key], [a].[CreatedAt], [a].[Description], [a].[ExpiresAt], [a].[IsActive], [a].[LastUsedAt]
FROM [ApiKeys] AS [a]
WHERE [a].[Key] = @__providedApiKey_0 AND [a].[IsActive] = CAST(1 AS bit)
2025-01-31 20:59:35.840 +03:00 [ERR] Failed executing DbCommand (19ms) [Parameters=[@__request_Page_0='?' (Size = 450), @__request_KeyName_1='?' (Size = 450)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [m].[Id], [m].[CreatedAt], [m].[IsActive], [m].[KeyName], [m].[Page], [m].[UpdatedAt], [m].[Value]
FROM [master_config] AS [m]
WHERE [m].[Page] = @__request_Page_0 AND [m].[KeyName] = @__request_KeyName_1 AND [m].[IsActive] = CAST(1 AS bit)
2025-01-31 20:59:35.867 +03:00 [ERR] An exception occurred while iterating over the results of a query for context type 'NayifatAPI.Data.ApplicationDbContext'.
Microsoft.Data.SqlClient.SqlException (0x80131904): Invalid column name 'KeyName'.
Invalid column name 'IsActive'.
Invalid column name 'Id'.
Invalid column name 'CreatedAt'.
Invalid column name 'IsActive'.
Invalid column name 'KeyName'.
Invalid column name 'UpdatedAt'.
   at Microsoft.Data.SqlClient.SqlCommand.<>c.<ExecuteDbDataReaderAsync>b__209_0(Task`1 result)
   at System.Threading.Tasks.ContinuationResultTaskFromResultTask`2.InnerInvoke()
   at System.Threading.ExecutionContext.RunInternal(ExecutionContext executionContext, ContextCallback callback, Object state)
--- End of stack trace from previous location ---
   at System.Threading.ExecutionContext.RunInternal(ExecutionContext executionContext, ContextCallback callback, Object state)
   at System.Threading.Tasks.Task.ExecuteWithThreadLocal(Task& currentTaskSlot, Thread threadPoolThread)
--- End of stack trace from previous location ---
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Query.Internal.SingleQueryingEnumerable`1.AsyncEnumerator.InitializeReaderAsync(AsyncEnumerator enumerator, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Storage.Internal.SqlServerExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Query.Internal.SingleQueryingEnumerable`1.AsyncEnumerator.MoveNextAsync()
ClientConnectionId:00f834c4-69cb-470a-8ad6-0c9946c573a3
Error Number:207,State:1,Class:16
Microsoft.Data.SqlClient.SqlException (0x80131904): Invalid column name 'KeyName'.
Invalid column name 'IsActive'.
Invalid column name 'Id'.
Invalid column name 'CreatedAt'.
Invalid column name 'IsActive'.
Invalid column name 'KeyName'.
Invalid column name 'UpdatedAt'.
   at Microsoft.Data.SqlClient.SqlCommand.<>c.<ExecuteDbDataReaderAsync>b__209_0(Task`1 result)
   at System.Threading.Tasks.ContinuationResultTaskFromResultTask`2.InnerInvoke()
   at System.Threading.ExecutionContext.RunInternal(ExecutionContext executionContext, ContextCallback callback, Object state)
--- End of stack trace from previous location ---
   at System.Threading.ExecutionContext.RunInternal(ExecutionContext executionContext, ContextCallback callback, Object state)
   at System.Threading.Tasks.Task.ExecuteWithThreadLocal(Task& currentTaskSlot, Thread threadPoolThread)
--- End of stack trace from previous location ---
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Query.Internal.SingleQueryingEnumerable`1.AsyncEnumerator.InitializeReaderAsync(AsyncEnumerator enumerator, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Storage.Internal.SqlServerExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Query.Internal.SingleQueryingEnumerable`1.AsyncEnumerator.MoveNextAsync()
ClientConnectionId:00f834c4-69cb-470a-8ad6-0c9946c573a3
Error Number:207,State:1,Class:16
2025-01-31 20:59:35.885 +03:00 [ERR] Error fetching content for page: home, key: slideshow_content
Microsoft.Data.SqlClient.SqlException (0x80131904): Invalid column name 'KeyName'.
Invalid column name 'IsActive'.
Invalid column name 'Id'.
Invalid column name 'CreatedAt'.
Invalid column name 'IsActive'.
Invalid column name 'KeyName'.
Invalid column name 'UpdatedAt'.
   at Microsoft.Data.SqlClient.SqlCommand.<>c.<ExecuteDbDataReaderAsync>b__209_0(Task`1 result)
   at System.Threading.Tasks.ContinuationResultTaskFromResultTask`2.InnerInvoke()
   at System.Threading.ExecutionContext.RunInternal(ExecutionContext executionContext, ContextCallback callback, Object state)
--- End of stack trace from previous location ---
   at System.Threading.ExecutionContext.RunInternal(ExecutionContext executionContext, ContextCallback callback, Object state)
   at System.Threading.Tasks.Task.ExecuteWithThreadLocal(Task& currentTaskSlot, Thread threadPoolThread)
--- End of stack trace from previous location ---
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Query.Internal.SingleQueryingEnumerable`1.AsyncEnumerator.InitializeReaderAsync(AsyncEnumerator enumerator, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Storage.Internal.SqlServerExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Query.Internal.SingleQueryingEnumerable`1.AsyncEnumerator.MoveNextAsync()
   at Microsoft.EntityFrameworkCore.Query.ShapedQueryCompilingExpressionVisitor.SingleOrDefaultAsync[TSource](IAsyncEnumerable`1 asyncEnumerable, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Query.ShapedQueryCompilingExpressionVisitor.SingleOrDefaultAsync[TSource](IAsyncEnumerable`1 asyncEnumerable, CancellationToken cancellationToken)
   at NayifatAPI.Controllers.ContentController.MasterFetch(MasterFetchRequest request) in C:\Users\yamta\StudioProjects\nayifat_app_2025_new\nayifatapi\Controllers\ContentController.cs:line 33
ClientConnectionId:00f834c4-69cb-470a-8ad6-0c9946c573a3
Error Number:207,State:1,Class:16
2025-01-31 20:59:35.908 +03:00 [INF] Executing ObjectResult, writing value of type '<>f__AnonymousType11`2[[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-01-31 20:59:35.934 +03:00 [INF] Executed action NayifatAPI.Controllers.ContentController.MasterFetch (NayifatAPI) in 2331.6689ms
2025-01-31 20:59:35.937 +03:00 [INF] Executed endpoint 'NayifatAPI.Controllers.ContentController.MasterFetch (NayifatAPI)'
2025-01-31 20:59:35.954 +03:00 [INF] Request finished HTTP/1.1 POST http://localhost:5264/api/content/fetch - 500 null application/json; charset=utf-8 2593.393ms
2025-01-31 21:01:37.080 +03:00 [INF] Request starting HTTP/1.1 POST http://localhost:5264/api/content/fetch - application/json 61
2025-01-31 21:01:37.086 +03:00 [INF] Executing endpoint 'NayifatAPI.Controllers.ContentController.MasterFetch (NayifatAPI)'
2025-01-31 21:01:37.087 +03:00 [INF] Route matched with {action = "MasterFetch", controller = "Content"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] MasterFetch(NayifatAPI.Controllers.MasterFetchRequest) on controller NayifatAPI.Controllers.ContentController (NayifatAPI).
2025-01-31 21:01:37.116 +03:00 [INF] Executed DbCommand (3ms) [Parameters=[@__providedApiKey_0='?' (Size = 255)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [a].[Key], [a].[CreatedAt], [a].[Description], [a].[ExpiresAt], [a].[IsActive], [a].[LastUsedAt]
FROM [ApiKeys] AS [a]
WHERE [a].[Key] = @__providedApiKey_0 AND [a].[IsActive] = CAST(1 AS bit)
2025-01-31 21:01:37.126 +03:00 [ERR] Failed executing DbCommand (5ms) [Parameters=[@__request_Page_0='?' (Size = 450), @__request_KeyName_1='?' (Size = 450)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [m].[Id], [m].[CreatedAt], [m].[IsActive], [m].[KeyName], [m].[Page], [m].[UpdatedAt], [m].[Value]
FROM [master_config] AS [m]
WHERE [m].[Page] = @__request_Page_0 AND [m].[KeyName] = @__request_KeyName_1 AND [m].[IsActive] = CAST(1 AS bit)
2025-01-31 21:01:37.131 +03:00 [ERR] An exception occurred while iterating over the results of a query for context type 'NayifatAPI.Data.ApplicationDbContext'.
Microsoft.Data.SqlClient.SqlException (0x80131904): Invalid column name 'KeyName'.
Invalid column name 'IsActive'.
Invalid column name 'Id'.
Invalid column name 'CreatedAt'.
Invalid column name 'IsActive'.
Invalid column name 'KeyName'.
Invalid column name 'UpdatedAt'.
   at Microsoft.Data.SqlClient.SqlCommand.<>c.<ExecuteDbDataReaderAsync>b__209_0(Task`1 result)
   at System.Threading.Tasks.ContinuationResultTaskFromResultTask`2.InnerInvoke()
   at System.Threading.ExecutionContext.RunInternal(ExecutionContext executionContext, ContextCallback callback, Object state)
--- End of stack trace from previous location ---
   at System.Threading.ExecutionContext.RunInternal(ExecutionContext executionContext, ContextCallback callback, Object state)
   at System.Threading.Tasks.Task.ExecuteWithThreadLocal(Task& currentTaskSlot, Thread threadPoolThread)
--- End of stack trace from previous location ---
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Query.Internal.SingleQueryingEnumerable`1.AsyncEnumerator.InitializeReaderAsync(AsyncEnumerator enumerator, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Storage.Internal.SqlServerExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Query.Internal.SingleQueryingEnumerable`1.AsyncEnumerator.MoveNextAsync()
ClientConnectionId:00f834c4-69cb-470a-8ad6-0c9946c573a3
Error Number:207,State:1,Class:16
Microsoft.Data.SqlClient.SqlException (0x80131904): Invalid column name 'KeyName'.
Invalid column name 'IsActive'.
Invalid column name 'Id'.
Invalid column name 'CreatedAt'.
Invalid column name 'IsActive'.
Invalid column name 'KeyName'.
Invalid column name 'UpdatedAt'.
   at Microsoft.Data.SqlClient.SqlCommand.<>c.<ExecuteDbDataReaderAsync>b__209_0(Task`1 result)
   at System.Threading.Tasks.ContinuationResultTaskFromResultTask`2.InnerInvoke()
   at System.Threading.ExecutionContext.RunInternal(ExecutionContext executionContext, ContextCallback callback, Object state)
--- End of stack trace from previous location ---
   at System.Threading.ExecutionContext.RunInternal(ExecutionContext executionContext, ContextCallback callback, Object state)
   at System.Threading.Tasks.Task.ExecuteWithThreadLocal(Task& currentTaskSlot, Thread threadPoolThread)
--- End of stack trace from previous location ---
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Query.Internal.SingleQueryingEnumerable`1.AsyncEnumerator.InitializeReaderAsync(AsyncEnumerator enumerator, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Storage.Internal.SqlServerExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Query.Internal.SingleQueryingEnumerable`1.AsyncEnumerator.MoveNextAsync()
ClientConnectionId:00f834c4-69cb-470a-8ad6-0c9946c573a3
Error Number:207,State:1,Class:16
2025-01-31 21:01:37.145 +03:00 [ERR] Error fetching content for page: home, key: slideshow_content
Microsoft.Data.SqlClient.SqlException (0x80131904): Invalid column name 'KeyName'.
Invalid column name 'IsActive'.
Invalid column name 'Id'.
Invalid column name 'CreatedAt'.
Invalid column name 'IsActive'.
Invalid column name 'KeyName'.
Invalid column name 'UpdatedAt'.
   at Microsoft.Data.SqlClient.SqlCommand.<>c.<ExecuteDbDataReaderAsync>b__209_0(Task`1 result)
   at System.Threading.Tasks.ContinuationResultTaskFromResultTask`2.InnerInvoke()
   at System.Threading.ExecutionContext.RunInternal(ExecutionContext executionContext, ContextCallback callback, Object state)
--- End of stack trace from previous location ---
   at System.Threading.ExecutionContext.RunInternal(ExecutionContext executionContext, ContextCallback callback, Object state)
   at System.Threading.Tasks.Task.ExecuteWithThreadLocal(Task& currentTaskSlot, Thread threadPoolThread)
--- End of stack trace from previous location ---
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Query.Internal.SingleQueryingEnumerable`1.AsyncEnumerator.InitializeReaderAsync(AsyncEnumerator enumerator, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Storage.Internal.SqlServerExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Query.Internal.SingleQueryingEnumerable`1.AsyncEnumerator.MoveNextAsync()
   at Microsoft.EntityFrameworkCore.Query.ShapedQueryCompilingExpressionVisitor.SingleOrDefaultAsync[TSource](IAsyncEnumerable`1 asyncEnumerable, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Query.ShapedQueryCompilingExpressionVisitor.SingleOrDefaultAsync[TSource](IAsyncEnumerable`1 asyncEnumerable, CancellationToken cancellationToken)
   at NayifatAPI.Controllers.ContentController.MasterFetch(MasterFetchRequest request) in C:\Users\yamta\StudioProjects\nayifat_app_2025_new\nayifatapi\Controllers\ContentController.cs:line 33
ClientConnectionId:00f834c4-69cb-470a-8ad6-0c9946c573a3
Error Number:207,State:1,Class:16
2025-01-31 21:01:37.156 +03:00 [INF] Executing ObjectResult, writing value of type '<>f__AnonymousType11`2[[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-01-31 21:01:37.159 +03:00 [INF] Executed action NayifatAPI.Controllers.ContentController.MasterFetch (NayifatAPI) in 69.838ms
2025-01-31 21:01:37.160 +03:00 [INF] Executed endpoint 'NayifatAPI.Controllers.ContentController.MasterFetch (NayifatAPI)'
2025-01-31 21:01:37.161 +03:00 [INF] Request finished HTTP/1.1 POST http://localhost:5264/api/content/fetch - 500 null application/json; charset=utf-8 80.6652ms
2025-01-31 21:01:49.987 +03:00 [INF] Application is shutting down...
2025-01-31 21:02:14.779 +03:00 [INF] Starting web application
2025-01-31 21:02:14.880 +03:00 [INF] Now listening on: http://localhost:5264
2025-01-31 21:02:14.884 +03:00 [INF] Application started. Press Ctrl+C to shut down.
2025-01-31 21:02:14.885 +03:00 [INF] Hosting environment: Development
2025-01-31 21:02:14.886 +03:00 [INF] Content root path: C:\Users\yamta\StudioProjects\nayifat_app_2025_new\nayifatapi
2025-01-31 21:02:20.129 +03:00 [INF] Request starting HTTP/1.1 POST http://localhost:5264/api/content/fetch - application/json 61
2025-01-31 21:02:20.220 +03:00 [WRN] Failed to determine the https port for redirect.
2025-01-31 21:02:20.263 +03:00 [INF] Executing endpoint 'NayifatAPI.Controllers.ContentController.MasterFetch (NayifatAPI)'
2025-01-31 21:02:20.643 +03:00 [INF] Route matched with {action = "MasterFetch", controller = "Content"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] MasterFetch(NayifatAPI.Controllers.MasterFetchRequest) on controller NayifatAPI.Controllers.ContentController (NayifatAPI).
2025-01-31 21:02:23.956 +03:00 [INF] Executed DbCommand (42ms) [Parameters=[@__providedApiKey_0='?' (Size = 255)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [a].[Key], [a].[CreatedAt], [a].[Description], [a].[ExpiresAt], [a].[IsActive], [a].[LastUsedAt]
FROM [ApiKeys] AS [a]
WHERE [a].[Key] = @__providedApiKey_0 AND [a].[IsActive] = CAST(1 AS bit)
2025-01-31 21:02:24.150 +03:00 [ERR] Failed executing DbCommand (18ms) [Parameters=[@__request_Page_0='?' (Size = 450), @__request_KeyName_1='?' (Size = 450)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [m].[config_id], [m].[CreatedAt], [m].[IsActive], [m].[key_name], [m].[last_updated], [m].[page], [m].[UpdatedAt], [m].[value]
FROM [master_config] AS [m]
WHERE [m].[page] = @__request_Page_0 AND [m].[key_name] = @__request_KeyName_1
2025-01-31 21:02:24.174 +03:00 [ERR] An exception occurred while iterating over the results of a query for context type 'NayifatAPI.Data.ApplicationDbContext'.
Microsoft.Data.SqlClient.SqlException (0x80131904): Invalid column name 'CreatedAt'.
Invalid column name 'IsActive'.
Invalid column name 'UpdatedAt'.
   at Microsoft.Data.SqlClient.SqlCommand.<>c.<ExecuteDbDataReaderAsync>b__209_0(Task`1 result)
   at System.Threading.Tasks.ContinuationResultTaskFromResultTask`2.InnerInvoke()
   at System.Threading.ExecutionContext.RunInternal(ExecutionContext executionContext, ContextCallback callback, Object state)
--- End of stack trace from previous location ---
   at System.Threading.ExecutionContext.RunInternal(ExecutionContext executionContext, ContextCallback callback, Object state)
   at System.Threading.Tasks.Task.ExecuteWithThreadLocal(Task& currentTaskSlot, Thread threadPoolThread)
--- End of stack trace from previous location ---
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Query.Internal.SingleQueryingEnumerable`1.AsyncEnumerator.InitializeReaderAsync(AsyncEnumerator enumerator, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Storage.Internal.SqlServerExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Query.Internal.SingleQueryingEnumerable`1.AsyncEnumerator.MoveNextAsync()
ClientConnectionId:c4cbe683-56c3-469a-aae2-17f7bd4dde78
Error Number:207,State:1,Class:16
Microsoft.Data.SqlClient.SqlException (0x80131904): Invalid column name 'CreatedAt'.
Invalid column name 'IsActive'.
Invalid column name 'UpdatedAt'.
   at Microsoft.Data.SqlClient.SqlCommand.<>c.<ExecuteDbDataReaderAsync>b__209_0(Task`1 result)
   at System.Threading.Tasks.ContinuationResultTaskFromResultTask`2.InnerInvoke()
   at System.Threading.ExecutionContext.RunInternal(ExecutionContext executionContext, ContextCallback callback, Object state)
--- End of stack trace from previous location ---
   at System.Threading.ExecutionContext.RunInternal(ExecutionContext executionContext, ContextCallback callback, Object state)
   at System.Threading.Tasks.Task.ExecuteWithThreadLocal(Task& currentTaskSlot, Thread threadPoolThread)
--- End of stack trace from previous location ---
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Query.Internal.SingleQueryingEnumerable`1.AsyncEnumerator.InitializeReaderAsync(AsyncEnumerator enumerator, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Storage.Internal.SqlServerExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Query.Internal.SingleQueryingEnumerable`1.AsyncEnumerator.MoveNextAsync()
ClientConnectionId:c4cbe683-56c3-469a-aae2-17f7bd4dde78
Error Number:207,State:1,Class:16
2025-01-31 21:02:24.190 +03:00 [ERR] Error fetching content for page: home, key: slideshow_content
Microsoft.Data.SqlClient.SqlException (0x80131904): Invalid column name 'CreatedAt'.
Invalid column name 'IsActive'.
Invalid column name 'UpdatedAt'.
   at Microsoft.Data.SqlClient.SqlCommand.<>c.<ExecuteDbDataReaderAsync>b__209_0(Task`1 result)
   at System.Threading.Tasks.ContinuationResultTaskFromResultTask`2.InnerInvoke()
   at System.Threading.ExecutionContext.RunInternal(ExecutionContext executionContext, ContextCallback callback, Object state)
--- End of stack trace from previous location ---
   at System.Threading.ExecutionContext.RunInternal(ExecutionContext executionContext, ContextCallback callback, Object state)
   at System.Threading.Tasks.Task.ExecuteWithThreadLocal(Task& currentTaskSlot, Thread threadPoolThread)
--- End of stack trace from previous location ---
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Query.Internal.SingleQueryingEnumerable`1.AsyncEnumerator.InitializeReaderAsync(AsyncEnumerator enumerator, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Storage.Internal.SqlServerExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Query.Internal.SingleQueryingEnumerable`1.AsyncEnumerator.MoveNextAsync()
   at Microsoft.EntityFrameworkCore.Query.ShapedQueryCompilingExpressionVisitor.SingleOrDefaultAsync[TSource](IAsyncEnumerable`1 asyncEnumerable, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Query.ShapedQueryCompilingExpressionVisitor.SingleOrDefaultAsync[TSource](IAsyncEnumerable`1 asyncEnumerable, CancellationToken cancellationToken)
   at NayifatAPI.Controllers.ContentController.MasterFetch(MasterFetchRequest request) in C:\Users\yamta\StudioProjects\nayifat_app_2025_new\nayifatapi\Controllers\ContentController.cs:line 33
ClientConnectionId:c4cbe683-56c3-469a-aae2-17f7bd4dde78
Error Number:207,State:1,Class:16
2025-01-31 21:02:24.234 +03:00 [INF] Executing ObjectResult, writing value of type '<>f__AnonymousType11`2[[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-01-31 21:02:24.264 +03:00 [INF] Executed action NayifatAPI.Controllers.ContentController.MasterFetch (NayifatAPI) in 3267.1694ms
2025-01-31 21:02:24.268 +03:00 [INF] Executed endpoint 'NayifatAPI.Controllers.ContentController.MasterFetch (NayifatAPI)'
2025-01-31 21:02:24.286 +03:00 [INF] Request finished HTTP/1.1 POST http://localhost:5264/api/content/fetch - 500 null application/json; charset=utf-8 4158.2484ms
2025-01-31 21:03:00.375 +03:00 [INF] Request starting HTTP/1.1 POST http://localhost:5264/api/content/fetch - application/json 61
2025-01-31 21:03:00.381 +03:00 [INF] Executing endpoint 'NayifatAPI.Controllers.ContentController.MasterFetch (NayifatAPI)'
2025-01-31 21:03:00.382 +03:00 [INF] Route matched with {action = "MasterFetch", controller = "Content"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] MasterFetch(NayifatAPI.Controllers.MasterFetchRequest) on controller NayifatAPI.Controllers.ContentController (NayifatAPI).
2025-01-31 21:03:00.407 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@__providedApiKey_0='?' (Size = 255)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [a].[Key], [a].[CreatedAt], [a].[Description], [a].[ExpiresAt], [a].[IsActive], [a].[LastUsedAt]
FROM [ApiKeys] AS [a]
WHERE [a].[Key] = @__providedApiKey_0 AND [a].[IsActive] = CAST(1 AS bit)
2025-01-31 21:03:00.417 +03:00 [ERR] Failed executing DbCommand (3ms) [Parameters=[@__request_Page_0='?' (Size = 450), @__request_KeyName_1='?' (Size = 450)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [m].[config_id], [m].[CreatedAt], [m].[IsActive], [m].[key_name], [m].[last_updated], [m].[page], [m].[UpdatedAt], [m].[value]
FROM [master_config] AS [m]
WHERE [m].[page] = @__request_Page_0 AND [m].[key_name] = @__request_KeyName_1
2025-01-31 21:03:00.423 +03:00 [ERR] An exception occurred while iterating over the results of a query for context type 'NayifatAPI.Data.ApplicationDbContext'.
Microsoft.Data.SqlClient.SqlException (0x80131904): Invalid column name 'CreatedAt'.
Invalid column name 'IsActive'.
Invalid column name 'UpdatedAt'.
   at Microsoft.Data.SqlClient.SqlCommand.<>c.<ExecuteDbDataReaderAsync>b__209_0(Task`1 result)
   at System.Threading.Tasks.ContinuationResultTaskFromResultTask`2.InnerInvoke()
   at System.Threading.ExecutionContext.RunInternal(ExecutionContext executionContext, ContextCallback callback, Object state)
--- End of stack trace from previous location ---
   at System.Threading.ExecutionContext.RunInternal(ExecutionContext executionContext, ContextCallback callback, Object state)
   at System.Threading.Tasks.Task.ExecuteWithThreadLocal(Task& currentTaskSlot, Thread threadPoolThread)
--- End of stack trace from previous location ---
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Query.Internal.SingleQueryingEnumerable`1.AsyncEnumerator.InitializeReaderAsync(AsyncEnumerator enumerator, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Storage.Internal.SqlServerExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Query.Internal.SingleQueryingEnumerable`1.AsyncEnumerator.MoveNextAsync()
ClientConnectionId:c4cbe683-56c3-469a-aae2-17f7bd4dde78
Error Number:207,State:1,Class:16
Microsoft.Data.SqlClient.SqlException (0x80131904): Invalid column name 'CreatedAt'.
Invalid column name 'IsActive'.
Invalid column name 'UpdatedAt'.
   at Microsoft.Data.SqlClient.SqlCommand.<>c.<ExecuteDbDataReaderAsync>b__209_0(Task`1 result)
   at System.Threading.Tasks.ContinuationResultTaskFromResultTask`2.InnerInvoke()
   at System.Threading.ExecutionContext.RunInternal(ExecutionContext executionContext, ContextCallback callback, Object state)
--- End of stack trace from previous location ---
   at System.Threading.ExecutionContext.RunInternal(ExecutionContext executionContext, ContextCallback callback, Object state)
   at System.Threading.Tasks.Task.ExecuteWithThreadLocal(Task& currentTaskSlot, Thread threadPoolThread)
--- End of stack trace from previous location ---
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Query.Internal.SingleQueryingEnumerable`1.AsyncEnumerator.InitializeReaderAsync(AsyncEnumerator enumerator, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Storage.Internal.SqlServerExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Query.Internal.SingleQueryingEnumerable`1.AsyncEnumerator.MoveNextAsync()
ClientConnectionId:c4cbe683-56c3-469a-aae2-17f7bd4dde78
Error Number:207,State:1,Class:16
2025-01-31 21:03:00.435 +03:00 [ERR] Error fetching content for page: home, key: slideshow_content
Microsoft.Data.SqlClient.SqlException (0x80131904): Invalid column name 'CreatedAt'.
Invalid column name 'IsActive'.
Invalid column name 'UpdatedAt'.
   at Microsoft.Data.SqlClient.SqlCommand.<>c.<ExecuteDbDataReaderAsync>b__209_0(Task`1 result)
   at System.Threading.Tasks.ContinuationResultTaskFromResultTask`2.InnerInvoke()
   at System.Threading.ExecutionContext.RunInternal(ExecutionContext executionContext, ContextCallback callback, Object state)
--- End of stack trace from previous location ---
   at System.Threading.ExecutionContext.RunInternal(ExecutionContext executionContext, ContextCallback callback, Object state)
   at System.Threading.Tasks.Task.ExecuteWithThreadLocal(Task& currentTaskSlot, Thread threadPoolThread)
--- End of stack trace from previous location ---
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Query.Internal.SingleQueryingEnumerable`1.AsyncEnumerator.InitializeReaderAsync(AsyncEnumerator enumerator, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Storage.Internal.SqlServerExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Query.Internal.SingleQueryingEnumerable`1.AsyncEnumerator.MoveNextAsync()
   at Microsoft.EntityFrameworkCore.Query.ShapedQueryCompilingExpressionVisitor.SingleOrDefaultAsync[TSource](IAsyncEnumerable`1 asyncEnumerable, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Query.ShapedQueryCompilingExpressionVisitor.SingleOrDefaultAsync[TSource](IAsyncEnumerable`1 asyncEnumerable, CancellationToken cancellationToken)
   at NayifatAPI.Controllers.ContentController.MasterFetch(MasterFetchRequest request) in C:\Users\yamta\StudioProjects\nayifat_app_2025_new\nayifatapi\Controllers\ContentController.cs:line 33
ClientConnectionId:c4cbe683-56c3-469a-aae2-17f7bd4dde78
Error Number:207,State:1,Class:16
2025-01-31 21:03:00.448 +03:00 [INF] Executing ObjectResult, writing value of type '<>f__AnonymousType11`2[[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-01-31 21:03:00.450 +03:00 [INF] Executed action NayifatAPI.Controllers.ContentController.MasterFetch (NayifatAPI) in 66.4594ms
2025-01-31 21:03:00.452 +03:00 [INF] Executed endpoint 'NayifatAPI.Controllers.ContentController.MasterFetch (NayifatAPI)'
2025-01-31 21:03:00.453 +03:00 [INF] Request finished HTTP/1.1 POST http://localhost:5264/api/content/fetch - 500 null application/json; charset=utf-8 78.3372ms
2025-01-31 21:05:50.912 +03:00 [INF] Starting web application
2025-01-31 21:05:51.271 +03:00 [INF] Now listening on: http://localhost:5264
2025-01-31 21:05:51.399 +03:00 [INF] Application started. Press Ctrl+C to shut down.
2025-01-31 21:05:51.401 +03:00 [INF] Hosting environment: Development
2025-01-31 21:05:51.403 +03:00 [INF] Content root path: C:\Users\yamta\StudioProjects\nayifat_app_2025_new\NayifatAPI
2025-01-31 21:06:01.691 +03:00 [INF] Request starting HTTP/1.1 POST http://localhost:5264/api/content/fetch - application/json 61
2025-01-31 21:06:01.738 +03:00 [WRN] Failed to determine the https port for redirect.
2025-01-31 21:06:01.741 +03:00 [INF] Executing endpoint 'NayifatAPI.Controllers.ContentController.MasterFetch (NayifatAPI)'
2025-01-31 21:06:01.765 +03:00 [INF] Route matched with {action = "MasterFetch", controller = "Content"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] MasterFetch(NayifatAPI.Controllers.MasterFetchRequest) on controller NayifatAPI.Controllers.ContentController (NayifatAPI).
2025-01-31 21:06:03.311 +03:00 [INF] Executed DbCommand (29ms) [Parameters=[@__providedApiKey_0='?' (Size = 255)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [a].[Key], [a].[CreatedAt], [a].[Description], [a].[ExpiresAt], [a].[IsActive], [a].[LastUsedAt]
FROM [ApiKeys] AS [a]
WHERE [a].[Key] = @__providedApiKey_0 AND [a].[IsActive] = CAST(1 AS bit)
2025-01-31 21:06:03.443 +03:00 [INF] Executed DbCommand (28ms) [Parameters=[@__request_Page_0='?' (Size = 450), @__request_KeyName_1='?' (Size = 450)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [m].[config_id], [m].[key_name], [m].[last_updated], [m].[page], [m].[value]
FROM [master_config] AS [m]
WHERE [m].[page] = @__request_Page_0 AND [m].[key_name] = @__request_KeyName_1
2025-01-31 21:06:03.491 +03:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType9`2[[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Object, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-01-31 21:06:03.508 +03:00 [INF] Executed action NayifatAPI.Controllers.ContentController.MasterFetch (NayifatAPI) in 1735.8061ms
2025-01-31 21:06:03.510 +03:00 [INF] Executed endpoint 'NayifatAPI.Controllers.ContentController.MasterFetch (NayifatAPI)'
2025-01-31 21:06:03.523 +03:00 [INF] Request finished HTTP/1.1 POST http://localhost:5264/api/content/fetch - 200 null application/json; charset=utf-8 1833.4966ms
2025-01-31 21:06:54.627 +03:00 [INF] Request starting HTTP/1.1 POST http://localhost:5264/api/content/fetch - application/json 64
2025-01-31 21:06:54.772 +03:00 [INF] Executing endpoint 'NayifatAPI.Controllers.ContentController.MasterFetch (NayifatAPI)'
2025-01-31 21:06:54.783 +03:00 [INF] Route matched with {action = "MasterFetch", controller = "Content"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] MasterFetch(NayifatAPI.Controllers.MasterFetchRequest) on controller NayifatAPI.Controllers.ContentController (NayifatAPI).
2025-01-31 21:06:54.832 +03:00 [INF] Executed DbCommand (4ms) [Parameters=[@__providedApiKey_0='?' (Size = 255)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [a].[Key], [a].[CreatedAt], [a].[Description], [a].[ExpiresAt], [a].[IsActive], [a].[LastUsedAt]
FROM [ApiKeys] AS [a]
WHERE [a].[Key] = @__providedApiKey_0 AND [a].[IsActive] = CAST(1 AS bit)
2025-01-31 21:06:54.843 +03:00 [INF] Executed DbCommand (4ms) [Parameters=[@__request_Page_0='?' (Size = 450), @__request_KeyName_1='?' (Size = 450)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [m].[config_id], [m].[key_name], [m].[last_updated], [m].[page], [m].[value]
FROM [master_config] AS [m]
WHERE [m].[page] = @__request_Page_0 AND [m].[key_name] = @__request_KeyName_1
2025-01-31 21:06:54.848 +03:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType9`2[[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Object, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-01-31 21:06:54.851 +03:00 [INF] Executed action NayifatAPI.Controllers.ContentController.MasterFetch (NayifatAPI) in 56.7527ms
2025-01-31 21:06:54.852 +03:00 [INF] Executed endpoint 'NayifatAPI.Controllers.ContentController.MasterFetch (NayifatAPI)'
2025-01-31 21:06:54.856 +03:00 [INF] Request finished HTTP/1.1 POST http://localhost:5264/api/content/fetch - 200 null application/json; charset=utf-8 229.522ms
2025-01-31 21:14:31.162 +03:00 [INF] Request starting HTTP/1.1 POST http://localhost:5264/api/content/fetch - application/json 64
2025-01-31 21:14:31.167 +03:00 [INF] Executing endpoint 'NayifatAPI.Controllers.ContentController.MasterFetch (NayifatAPI)'
2025-01-31 21:14:31.170 +03:00 [INF] Route matched with {action = "MasterFetch", controller = "Content"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] MasterFetch(NayifatAPI.Controllers.MasterFetchRequest) on controller NayifatAPI.Controllers.ContentController (NayifatAPI).
2025-01-31 21:14:31.295 +03:00 [INF] Executed DbCommand (4ms) [Parameters=[@__providedApiKey_0='?' (Size = 255)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [a].[Key], [a].[CreatedAt], [a].[Description], [a].[ExpiresAt], [a].[IsActive], [a].[LastUsedAt]
FROM [ApiKeys] AS [a]
WHERE [a].[Key] = @__providedApiKey_0 AND [a].[IsActive] = CAST(1 AS bit)
2025-01-31 21:14:31.306 +03:00 [INF] Executed DbCommand (6ms) [Parameters=[@__request_Page_0='?' (Size = 450), @__request_KeyName_1='?' (Size = 450)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [m].[config_id], [m].[key_name], [m].[last_updated], [m].[page], [m].[value]
FROM [master_config] AS [m]
WHERE [m].[page] = @__request_Page_0 AND [m].[key_name] = @__request_KeyName_1
2025-01-31 21:14:31.311 +03:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType9`2[[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Object, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-01-31 21:14:31.315 +03:00 [INF] Executed action NayifatAPI.Controllers.ContentController.MasterFetch (NayifatAPI) in 141.2174ms
2025-01-31 21:14:31.317 +03:00 [INF] Executed endpoint 'NayifatAPI.Controllers.ContentController.MasterFetch (NayifatAPI)'
2025-01-31 21:14:31.319 +03:00 [INF] Request finished HTTP/1.1 POST http://localhost:5264/api/content/fetch - 200 null application/json; charset=utf-8 157.0335ms
2025-01-31 21:14:48.118 +03:00 [INF] Request starting HTTP/1.1 POST http://localhost:5264/api/content/fetch - application/json 62
2025-01-31 21:14:48.120 +03:00 [INF] Executing endpoint 'NayifatAPI.Controllers.ContentController.MasterFetch (NayifatAPI)'
2025-01-31 21:14:48.121 +03:00 [INF] Route matched with {action = "MasterFetch", controller = "Content"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] MasterFetch(NayifatAPI.Controllers.MasterFetchRequest) on controller NayifatAPI.Controllers.ContentController (NayifatAPI).
2025-01-31 21:14:48.125 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@__providedApiKey_0='?' (Size = 255)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [a].[Key], [a].[CreatedAt], [a].[Description], [a].[ExpiresAt], [a].[IsActive], [a].[LastUsedAt]
FROM [ApiKeys] AS [a]
WHERE [a].[Key] = @__providedApiKey_0 AND [a].[IsActive] = CAST(1 AS bit)
2025-01-31 21:14:48.129 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@__request_Page_0='?' (Size = 450), @__request_KeyName_1='?' (Size = 450)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [m].[config_id], [m].[key_name], [m].[last_updated], [m].[page], [m].[value]
FROM [master_config] AS [m]
WHERE [m].[page] = @__request_Page_0 AND [m].[key_name] = @__request_KeyName_1
2025-01-31 21:14:48.133 +03:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType9`2[[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Object, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-01-31 21:14:48.135 +03:00 [INF] Executed action NayifatAPI.Controllers.ContentController.MasterFetch (NayifatAPI) in 12.9448ms
2025-01-31 21:14:48.136 +03:00 [INF] Executed endpoint 'NayifatAPI.Controllers.ContentController.MasterFetch (NayifatAPI)'
2025-01-31 21:14:48.137 +03:00 [INF] Request finished HTTP/1.1 POST http://localhost:5264/api/content/fetch - 200 null application/json; charset=utf-8 19.0495ms
2025-01-31 21:39:17.593 +03:00 [INF] Request starting HTTP/1.1 POST http://localhost:5264/api/auth/signin - application/json 226
2025-01-31 21:39:17.606 +03:00 [INF] Executing endpoint 'NayifatAPI.Controllers.AuthController.SignIn (NayifatAPI)'
2025-01-31 21:39:17.681 +03:00 [INF] Route matched with {action = "SignIn", controller = "Auth"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] SignIn(NayifatAPI.Controllers.SignInRequest) on controller NayifatAPI.Controllers.AuthController (NayifatAPI).
2025-01-31 21:39:17.720 +03:00 [INF] Executing BadRequestObjectResult, writing value of type 'Microsoft.AspNetCore.Mvc.ValidationProblemDetails'.
2025-01-31 21:39:17.806 +03:00 [INF] Executed action NayifatAPI.Controllers.AuthController.SignIn (NayifatAPI) in 121.2706ms
2025-01-31 21:39:17.812 +03:00 [INF] Executed endpoint 'NayifatAPI.Controllers.AuthController.SignIn (NayifatAPI)'
2025-01-31 21:39:17.815 +03:00 [INF] Request finished HTTP/1.1 POST http://localhost:5264/api/auth/signin - 400 null application/problem+json; charset=utf-8 222.2887ms
2025-01-31 21:44:35.873 +03:00 [INF] Request starting HTTP/1.1 POST http://localhost:5264/api/notifications/send - application/json 373
2025-01-31 21:44:35.881 +03:00 [INF] Request finished HTTP/1.1 POST http://localhost:5264/api/notifications/send - 404 0 null 7.5312ms
2025-01-31 21:44:35.885 +03:00 [INF] Request reached the end of the middleware pipeline without being handled by application code. Request path: POST http://localhost:5264/api/notifications/send, Response status code: 404
2025-01-31 21:44:43.726 +03:00 [INF] Request starting HTTP/1.1 POST http://localhost:5264/api/notifications/send - application/json 373
2025-01-31 21:44:43.730 +03:00 [INF] Request finished HTTP/1.1 POST http://localhost:5264/api/notifications/send - 404 0 null 3.7533ms
2025-01-31 21:44:43.734 +03:00 [INF] Request reached the end of the middleware pipeline without being handled by application code. Request path: POST http://localhost:5264/api/notifications/send, Response status code: 404
2025-01-31 21:45:32.144 +03:00 [INF] Application is shutting down...
2025-01-31 21:46:43.044 +03:00 [INF] Starting web application
2025-01-31 21:46:43.188 +03:00 [INF] Now listening on: http://localhost:5264
2025-01-31 21:46:43.193 +03:00 [INF] Application started. Press Ctrl+C to shut down.
2025-01-31 21:46:43.194 +03:00 [INF] Hosting environment: Development
2025-01-31 21:46:43.195 +03:00 [INF] Content root path: C:\Users\yamta\StudioProjects\nayifat_app_2025_new\NayifatAPI
2025-01-31 21:47:10.593 +03:00 [INF] Request starting HTTP/1.1 POST http://localhost:5264/api/notifications/send - application/json 373
2025-01-31 21:47:10.638 +03:00 [WRN] Failed to determine the https port for redirect.
2025-01-31 21:47:10.643 +03:00 [INF] Executing endpoint 'NayifatAPI.Controllers.NotificationsController.SendNotification (NayifatAPI)'
2025-01-31 21:47:10.673 +03:00 [INF] Route matched with {action = "SendNotification", controller = "Notifications"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] SendNotification(NayifatAPI.Controllers.SendNotificationRequest) on controller NayifatAPI.Controllers.NotificationsController (NayifatAPI).
2025-01-31 21:47:12.287 +03:00 [INF] Executed DbCommand (202ms) [Parameters=[@__providedApiKey_0='?' (Size = 255)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [a].[Key], [a].[CreatedAt], [a].[Description], [a].[ExpiresAt], [a].[IsActive], [a].[LastUsedAt]
FROM [ApiKeys] AS [a]
WHERE [a].[Key] = @__providedApiKey_0 AND [a].[IsActive] = CAST(1 AS bit)
2025-01-31 21:47:12.322 +03:00 [INF] Executing ObjectResult, writing value of type '<>f__AnonymousType11`2[[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-01-31 21:47:12.361 +03:00 [INF] Executed action NayifatAPI.Controllers.NotificationsController.SendNotification (NayifatAPI) in 1678.6597ms
2025-01-31 21:47:12.369 +03:00 [INF] Executed endpoint 'NayifatAPI.Controllers.NotificationsController.SendNotification (NayifatAPI)'
2025-01-31 21:47:12.388 +03:00 [INF] Request finished HTTP/1.1 POST http://localhost:5264/api/notifications/send - 401 null application/json; charset=utf-8 1795.6989ms
2025-01-31 21:47:38.961 +03:00 [INF] Request starting HTTP/1.1 POST http://localhost:5264/api/notifications/send - application/json 373
2025-01-31 21:47:38.968 +03:00 [INF] Executing endpoint 'NayifatAPI.Controllers.NotificationsController.SendNotification (NayifatAPI)'
2025-01-31 21:47:38.970 +03:00 [INF] Route matched with {action = "SendNotification", controller = "Notifications"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] SendNotification(NayifatAPI.Controllers.SendNotificationRequest) on controller NayifatAPI.Controllers.NotificationsController (NayifatAPI).
2025-01-31 21:47:39.007 +03:00 [INF] Executed DbCommand (2ms) [Parameters=[@__providedApiKey_0='?' (Size = 255)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [a].[Key], [a].[CreatedAt], [a].[Description], [a].[ExpiresAt], [a].[IsActive], [a].[LastUsedAt]
FROM [ApiKeys] AS [a]
WHERE [a].[Key] = @__providedApiKey_0 AND [a].[IsActive] = CAST(1 AS bit)
2025-01-31 21:47:39.084 +03:00 [INF] Executing ObjectResult, writing value of type '<>f__AnonymousType11`2[[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-01-31 21:47:39.086 +03:00 [INF] Executed action NayifatAPI.Controllers.NotificationsController.SendNotification (NayifatAPI) in 113.7732ms
2025-01-31 21:47:39.087 +03:00 [INF] Executed endpoint 'NayifatAPI.Controllers.NotificationsController.SendNotification (NayifatAPI)'
2025-01-31 21:47:39.089 +03:00 [INF] Request finished HTTP/1.1 POST http://localhost:5264/api/notifications/send - 400 null application/json; charset=utf-8 128.6023ms
2025-01-31 21:50:40.998 +03:00 [INF] Request starting HTTP/1.1 POST http://localhost:5264/api/notifications/send - application/json 364
2025-01-31 21:50:41.002 +03:00 [INF] Executing endpoint 'NayifatAPI.Controllers.NotificationsController.SendNotification (NayifatAPI)'
2025-01-31 21:50:41.003 +03:00 [INF] Route matched with {action = "SendNotification", controller = "Notifications"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] SendNotification(NayifatAPI.Controllers.SendNotificationRequest) on controller NayifatAPI.Controllers.NotificationsController (NayifatAPI).
2025-01-31 21:50:41.200 +03:00 [INF] Executed DbCommand (86ms) [Parameters=[@__providedApiKey_0='?' (Size = 255)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [a].[Key], [a].[CreatedAt], [a].[Description], [a].[ExpiresAt], [a].[IsActive], [a].[LastUsedAt]
FROM [ApiKeys] AS [a]
WHERE [a].[Key] = @__providedApiKey_0 AND [a].[IsActive] = CAST(1 AS bit)
2025-01-31 21:50:41.204 +03:00 [INF] Executing ObjectResult, writing value of type '<>f__AnonymousType11`2[[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-01-31 21:50:41.205 +03:00 [INF] Executed action NayifatAPI.Controllers.NotificationsController.SendNotification (NayifatAPI) in 200.7149ms
2025-01-31 21:50:41.208 +03:00 [INF] Executed endpoint 'NayifatAPI.Controllers.NotificationsController.SendNotification (NayifatAPI)'
2025-01-31 21:50:41.209 +03:00 [INF] Request finished HTTP/1.1 POST http://localhost:5264/api/notifications/send - 400 null application/json; charset=utf-8 211.4486ms
2025-01-31 21:51:32.294 +03:00 [INF] Request starting HTTP/1.1 POST http://localhost:5264/api/notifications/send - application/json 116
2025-01-31 21:51:32.456 +03:00 [INF] Executing endpoint 'NayifatAPI.Controllers.NotificationsController.SendNotification (NayifatAPI)'
2025-01-31 21:51:32.460 +03:00 [INF] Route matched with {action = "SendNotification", controller = "Notifications"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] SendNotification(NayifatAPI.Controllers.SendNotificationRequest) on controller NayifatAPI.Controllers.NotificationsController (NayifatAPI).
2025-01-31 21:51:34.356 +03:00 [INF] Executed DbCommand (1,888ms) [Parameters=[@__providedApiKey_0='?' (Size = 255)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [a].[Key], [a].[CreatedAt], [a].[Description], [a].[ExpiresAt], [a].[IsActive], [a].[LastUsedAt]
FROM [ApiKeys] AS [a]
WHERE [a].[Key] = @__providedApiKey_0 AND [a].[IsActive] = CAST(1 AS bit)
2025-01-31 21:51:34.364 +03:00 [INF] Executing ObjectResult, writing value of type '<>f__AnonymousType11`2[[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-01-31 21:51:34.369 +03:00 [INF] Executed action NayifatAPI.Controllers.NotificationsController.SendNotification (NayifatAPI) in 1907.0182ms
2025-01-31 21:51:34.370 +03:00 [INF] Executed endpoint 'NayifatAPI.Controllers.NotificationsController.SendNotification (NayifatAPI)'
2025-01-31 21:51:34.372 +03:00 [INF] Request finished HTTP/1.1 POST http://localhost:5264/api/notifications/send - 400 null application/json; charset=utf-8 2077.1522ms
2025-01-31 21:51:51.626 +03:00 [INF] Request starting HTTP/1.1 POST http://localhost:5264/api/notifications/send - application/json 116
2025-01-31 21:51:51.630 +03:00 [INF] Executing endpoint 'NayifatAPI.Controllers.NotificationsController.SendNotification (NayifatAPI)'
2025-01-31 21:51:51.631 +03:00 [INF] Route matched with {action = "SendNotification", controller = "Notifications"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] SendNotification(NayifatAPI.Controllers.SendNotificationRequest) on controller NayifatAPI.Controllers.NotificationsController (NayifatAPI).
2025-01-31 21:51:51.639 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@__providedApiKey_0='?' (Size = 255)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [a].[Key], [a].[CreatedAt], [a].[Description], [a].[ExpiresAt], [a].[IsActive], [a].[LastUsedAt]
FROM [ApiKeys] AS [a]
WHERE [a].[Key] = @__providedApiKey_0 AND [a].[IsActive] = CAST(1 AS bit)
2025-01-31 21:51:51.645 +03:00 [INF] Executing ObjectResult, writing value of type '<>f__AnonymousType11`2[[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-01-31 21:51:51.649 +03:00 [INF] Executed action NayifatAPI.Controllers.NotificationsController.SendNotification (NayifatAPI) in 14.3436ms
2025-01-31 21:51:51.652 +03:00 [INF] Executed endpoint 'NayifatAPI.Controllers.NotificationsController.SendNotification (NayifatAPI)'
2025-01-31 21:51:51.654 +03:00 [INF] Request finished HTTP/1.1 POST http://localhost:5264/api/notifications/send - 400 null application/json; charset=utf-8 28.1545ms
2025-01-31 21:52:07.685 +03:00 [INF] Request starting HTTP/1.1 POST http://localhost:5264/api/notifications/send - application/json 115
2025-01-31 21:52:07.689 +03:00 [INF] Executing endpoint 'NayifatAPI.Controllers.NotificationsController.SendNotification (NayifatAPI)'
2025-01-31 21:52:07.690 +03:00 [INF] Route matched with {action = "SendNotification", controller = "Notifications"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] SendNotification(NayifatAPI.Controllers.SendNotificationRequest) on controller NayifatAPI.Controllers.NotificationsController (NayifatAPI).
2025-01-31 21:52:07.695 +03:00 [INF] Executed DbCommand (0ms) [Parameters=[@__providedApiKey_0='?' (Size = 255)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [a].[Key], [a].[CreatedAt], [a].[Description], [a].[ExpiresAt], [a].[IsActive], [a].[LastUsedAt]
FROM [ApiKeys] AS [a]
WHERE [a].[Key] = @__providedApiKey_0 AND [a].[IsActive] = CAST(1 AS bit)
2025-01-31 21:52:07.764 +03:00 [INF] Executed DbCommand (19ms) [Parameters=[@__request_NationalId_0='?' (Size = 450)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [c].[NationalId]
FROM [Customers] AS [c]
WHERE [c].[NationalId] = @__request_NationalId_0
2025-01-31 21:52:08.102 +03:00 [INF] Executed DbCommand (91ms) [Parameters=[@p0='?' (Size = 4000), @p1='?' (Size = 8000) (DbType = AnsiString), @p2='?' (Size = 8000) (DbType = AnsiString), @p3='?' (Size = 8000) (DbType = AnsiString), @p4='?' (DbType = DateTime2), @p5='?' (DbType = DateTime2), @p6='?' (Size = 255), @p7='?' (Size = 4000), @p8='?' (Size = 255), @p9='?' (Size = 255), @p10='?' (Size = 255)], CommandType='"Text"', CommandTimeout='30']
SET IMPLICIT_TRANSACTIONS OFF;
SET NOCOUNT ON;
INSERT INTO [notification_templates] ([additional_data], [Body], [body_ar], [body_en], [created_at], [expiry_at], [Route], [target_criteria], [Title], [title_ar], [title_en])
OUTPUT INSERTED.[Id]
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7, @p8, @p9, @p10);
2025-01-31 21:52:08.220 +03:00 [INF] Executed DbCommand (14ms) [Parameters=[@p0='?' (Size = 4000), @p1='?' (DbType = DateTime2), @p2='?' (Size = 4000), @p3='?' (Size = 4000), @p4='?' (Size = 4000), @p5='?' (Size = 450), @p6='?' (Size = 4000), @p7='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SET IMPLICIT_TRANSACTIONS OFF;
SET NOCOUNT ON;
INSERT INTO [AuthLogs] ([AuthType], [CreatedAt], [DeviceId], [FailureReason], [IpAddress], [NationalId], [Status], [UserAgent])
OUTPUT INSERTED.[Id]
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7);
2025-01-31 21:52:08.271 +03:00 [ERR] An exception occurred in the database while saving changes for context type 'NayifatAPI.Data.ApplicationDbContext'.
Microsoft.EntityFrameworkCore.DbUpdateException: An error occurred while saving the entity changes. See the inner exception for details.
 ---> Microsoft.Data.SqlClient.SqlException (0x80131904): Cannot insert the value NULL into column 'NationalId', table 'NayifatApp.dbo.AuthLogs'; column does not allow nulls. INSERT fails.
   at Microsoft.Data.SqlClient.SqlConnection.OnError(SqlException exception, Boolean breakConnection, Action`1 wrapCloseInAction)
   at Microsoft.Data.SqlClient.SqlInternalConnection.OnError(SqlException exception, Boolean breakConnection, Action`1 wrapCloseInAction)
   at Microsoft.Data.SqlClient.TdsParser.ThrowExceptionAndWarning(TdsParserStateObject stateObj, Boolean callerHasConnectionLock, Boolean asyncClose)
   at Microsoft.Data.SqlClient.TdsParser.TryRun(RunBehavior runBehavior, SqlCommand cmdHandler, SqlDataReader dataStream, BulkCopySimpleResultSet bulkCopyHandler, TdsParserStateObject stateObj, Boolean& dataReady)
   at Microsoft.Data.SqlClient.SqlDataReader.TryHasMoreRows(Boolean& moreRows)
   at Microsoft.Data.SqlClient.SqlDataReader.TryReadInternal(Boolean setTimeout, Boolean& more)
   at Microsoft.Data.SqlClient.SqlDataReader.ReadAsyncExecute(Task task, Object state)
   at Microsoft.Data.SqlClient.SqlDataReader.InvokeAsyncCall[T](SqlDataReaderBaseAsyncCallContext`1 context)
--- End of stack trace from previous location ---
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeResultSetAsync(Int32 startCommandIndex, RelationalDataReader reader, CancellationToken cancellationToken)
ClientConnectionId:7d7bf686-8232-4142-9041-4f861ac2fc0b
Error Number:515,State:2,Class:16
   --- End of inner exception stack trace ---
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeResultSetAsync(Int32 startCommandIndex, RelationalDataReader reader, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeAsync(RelationalDataReader reader, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Update.Internal.SqlServerModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(IList`1 entriesToSave, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(StateManager stateManager, Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Storage.Internal.SqlServerExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
Microsoft.EntityFrameworkCore.DbUpdateException: An error occurred while saving the entity changes. See the inner exception for details.
 ---> Microsoft.Data.SqlClient.SqlException (0x80131904): Cannot insert the value NULL into column 'NationalId', table 'NayifatApp.dbo.AuthLogs'; column does not allow nulls. INSERT fails.
   at Microsoft.Data.SqlClient.SqlConnection.OnError(SqlException exception, Boolean breakConnection, Action`1 wrapCloseInAction)
   at Microsoft.Data.SqlClient.SqlInternalConnection.OnError(SqlException exception, Boolean breakConnection, Action`1 wrapCloseInAction)
   at Microsoft.Data.SqlClient.TdsParser.ThrowExceptionAndWarning(TdsParserStateObject stateObj, Boolean callerHasConnectionLock, Boolean asyncClose)
   at Microsoft.Data.SqlClient.TdsParser.TryRun(RunBehavior runBehavior, SqlCommand cmdHandler, SqlDataReader dataStream, BulkCopySimpleResultSet bulkCopyHandler, TdsParserStateObject stateObj, Boolean& dataReady)
   at Microsoft.Data.SqlClient.SqlDataReader.TryHasMoreRows(Boolean& moreRows)
   at Microsoft.Data.SqlClient.SqlDataReader.TryReadInternal(Boolean setTimeout, Boolean& more)
   at Microsoft.Data.SqlClient.SqlDataReader.ReadAsyncExecute(Task task, Object state)
   at Microsoft.Data.SqlClient.SqlDataReader.InvokeAsyncCall[T](SqlDataReaderBaseAsyncCallContext`1 context)
--- End of stack trace from previous location ---
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeResultSetAsync(Int32 startCommandIndex, RelationalDataReader reader, CancellationToken cancellationToken)
ClientConnectionId:7d7bf686-8232-4142-9041-4f861ac2fc0b
Error Number:515,State:2,Class:16
   --- End of inner exception stack trace ---
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeResultSetAsync(Int32 startCommandIndex, RelationalDataReader reader, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeAsync(RelationalDataReader reader, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Update.Internal.SqlServerModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(IList`1 entriesToSave, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(StateManager stateManager, Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Storage.Internal.SqlServerExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
2025-01-31 21:52:08.323 +03:00 [ERR] Error logging audit event. NationalId: null, Action: notification_sent, Details: {"template_id":1,"recipient_count":1,"target_criteria":null,"timestamp":"2025-01-31T18:52:07.7863395Z"}
Microsoft.EntityFrameworkCore.DbUpdateException: An error occurred while saving the entity changes. See the inner exception for details.
 ---> Microsoft.Data.SqlClient.SqlException (0x80131904): Cannot insert the value NULL into column 'NationalId', table 'NayifatApp.dbo.AuthLogs'; column does not allow nulls. INSERT fails.
   at Microsoft.Data.SqlClient.SqlConnection.OnError(SqlException exception, Boolean breakConnection, Action`1 wrapCloseInAction)
   at Microsoft.Data.SqlClient.SqlInternalConnection.OnError(SqlException exception, Boolean breakConnection, Action`1 wrapCloseInAction)
   at Microsoft.Data.SqlClient.TdsParser.ThrowExceptionAndWarning(TdsParserStateObject stateObj, Boolean callerHasConnectionLock, Boolean asyncClose)
   at Microsoft.Data.SqlClient.TdsParser.TryRun(RunBehavior runBehavior, SqlCommand cmdHandler, SqlDataReader dataStream, BulkCopySimpleResultSet bulkCopyHandler, TdsParserStateObject stateObj, Boolean& dataReady)
   at Microsoft.Data.SqlClient.SqlDataReader.TryHasMoreRows(Boolean& moreRows)
   at Microsoft.Data.SqlClient.SqlDataReader.TryReadInternal(Boolean setTimeout, Boolean& more)
   at Microsoft.Data.SqlClient.SqlDataReader.ReadAsyncExecute(Task task, Object state)
   at Microsoft.Data.SqlClient.SqlDataReader.InvokeAsyncCall[T](SqlDataReaderBaseAsyncCallContext`1 context)
--- End of stack trace from previous location ---
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeResultSetAsync(Int32 startCommandIndex, RelationalDataReader reader, CancellationToken cancellationToken)
ClientConnectionId:7d7bf686-8232-4142-9041-4f861ac2fc0b
Error Number:515,State:2,Class:16
   --- End of inner exception stack trace ---
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeResultSetAsync(Int32 startCommandIndex, RelationalDataReader reader, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeAsync(RelationalDataReader reader, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Update.Internal.SqlServerModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(IList`1 entriesToSave, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(StateManager stateManager, Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Storage.Internal.SqlServerExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at NayifatAPI.Services.AuditLogService.LogAsync(String nationalId, String action, Object details) in C:\Users\yamta\StudioProjects\nayifat_app_2025_new\NayifatAPI\Services\AuditLogService.cs:line 36
2025-01-31 21:52:08.385 +03:00 [INF] Executed DbCommand (12ms) [Parameters=[@__userId_0='?' (Size = 450)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [u].[national_id], [u].[last_updated], [u].[notifications]
FROM [user_notifications] AS [u]
WHERE [u].[national_id] = @__userId_0
2025-01-31 21:52:08.467 +03:00 [INF] Executed DbCommand (6ms) [Parameters=[@p0='?' (Size = 4000), @p1='?' (DbType = DateTime2), @p2='?' (Size = 4000), @p3='?' (Size = 4000), @p4='?' (Size = 4000), @p5='?' (Size = 450), @p6='?' (Size = 4000), @p7='?' (Size = 4000), @p8='?' (Size = 450), @p9='?' (DbType = DateTime2), @p10='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SET NOCOUNT ON;
INSERT INTO [AuthLogs] ([AuthType], [CreatedAt], [DeviceId], [FailureReason], [IpAddress], [NationalId], [Status], [UserAgent])
OUTPUT INSERTED.[Id]
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7);
INSERT INTO [user_notifications] ([national_id], [last_updated], [notifications])
VALUES (@p8, @p9, @p10);
2025-01-31 21:52:08.483 +03:00 [ERR] An exception occurred in the database while saving changes for context type 'NayifatAPI.Data.ApplicationDbContext'.
Microsoft.EntityFrameworkCore.DbUpdateException: An error occurred while saving the entity changes. See the inner exception for details.
 ---> Microsoft.Data.SqlClient.SqlException (0x80131904): Cannot insert the value NULL into column 'NationalId', table 'NayifatApp.dbo.AuthLogs'; column does not allow nulls. INSERT fails.
   at Microsoft.Data.SqlClient.SqlConnection.OnError(SqlException exception, Boolean breakConnection, Action`1 wrapCloseInAction)
   at Microsoft.Data.SqlClient.SqlInternalConnection.OnError(SqlException exception, Boolean breakConnection, Action`1 wrapCloseInAction)
   at Microsoft.Data.SqlClient.TdsParser.ThrowExceptionAndWarning(TdsParserStateObject stateObj, Boolean callerHasConnectionLock, Boolean asyncClose)
   at Microsoft.Data.SqlClient.TdsParser.TryRun(RunBehavior runBehavior, SqlCommand cmdHandler, SqlDataReader dataStream, BulkCopySimpleResultSet bulkCopyHandler, TdsParserStateObject stateObj, Boolean& dataReady)
   at Microsoft.Data.SqlClient.SqlDataReader.TryHasMoreRows(Boolean& moreRows)
   at Microsoft.Data.SqlClient.SqlDataReader.TryReadInternal(Boolean setTimeout, Boolean& more)
   at Microsoft.Data.SqlClient.SqlDataReader.ReadAsyncExecute(Task task, Object state)
   at Microsoft.Data.SqlClient.SqlDataReader.InvokeAsyncCall[T](SqlDataReaderBaseAsyncCallContext`1 context)
--- End of stack trace from previous location ---
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeResultSetAsync(Int32 startCommandIndex, RelationalDataReader reader, CancellationToken cancellationToken)
ClientConnectionId:7d7bf686-8232-4142-9041-4f861ac2fc0b
Error Number:515,State:2,Class:16
   --- End of inner exception stack trace ---
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeResultSetAsync(Int32 startCommandIndex, RelationalDataReader reader, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeAsync(RelationalDataReader reader, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Update.Internal.SqlServerModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(IList`1 entriesToSave, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(StateManager stateManager, Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Storage.Internal.SqlServerExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
Microsoft.EntityFrameworkCore.DbUpdateException: An error occurred while saving the entity changes. See the inner exception for details.
 ---> Microsoft.Data.SqlClient.SqlException (0x80131904): Cannot insert the value NULL into column 'NationalId', table 'NayifatApp.dbo.AuthLogs'; column does not allow nulls. INSERT fails.
   at Microsoft.Data.SqlClient.SqlConnection.OnError(SqlException exception, Boolean breakConnection, Action`1 wrapCloseInAction)
   at Microsoft.Data.SqlClient.SqlInternalConnection.OnError(SqlException exception, Boolean breakConnection, Action`1 wrapCloseInAction)
   at Microsoft.Data.SqlClient.TdsParser.ThrowExceptionAndWarning(TdsParserStateObject stateObj, Boolean callerHasConnectionLock, Boolean asyncClose)
   at Microsoft.Data.SqlClient.TdsParser.TryRun(RunBehavior runBehavior, SqlCommand cmdHandler, SqlDataReader dataStream, BulkCopySimpleResultSet bulkCopyHandler, TdsParserStateObject stateObj, Boolean& dataReady)
   at Microsoft.Data.SqlClient.SqlDataReader.TryHasMoreRows(Boolean& moreRows)
   at Microsoft.Data.SqlClient.SqlDataReader.TryReadInternal(Boolean setTimeout, Boolean& more)
   at Microsoft.Data.SqlClient.SqlDataReader.ReadAsyncExecute(Task task, Object state)
   at Microsoft.Data.SqlClient.SqlDataReader.InvokeAsyncCall[T](SqlDataReaderBaseAsyncCallContext`1 context)
--- End of stack trace from previous location ---
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeResultSetAsync(Int32 startCommandIndex, RelationalDataReader reader, CancellationToken cancellationToken)
ClientConnectionId:7d7bf686-8232-4142-9041-4f861ac2fc0b
Error Number:515,State:2,Class:16
   --- End of inner exception stack trace ---
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeResultSetAsync(Int32 startCommandIndex, RelationalDataReader reader, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeAsync(RelationalDataReader reader, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Update.Internal.SqlServerModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(IList`1 entriesToSave, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(StateManager stateManager, Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Storage.Internal.SqlServerExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
2025-01-31 21:52:08.508 +03:00 [ERR] Error saving notification for user 1012345678
Microsoft.EntityFrameworkCore.DbUpdateException: An error occurred while saving the entity changes. See the inner exception for details.
 ---> Microsoft.Data.SqlClient.SqlException (0x80131904): Cannot insert the value NULL into column 'NationalId', table 'NayifatApp.dbo.AuthLogs'; column does not allow nulls. INSERT fails.
   at Microsoft.Data.SqlClient.SqlConnection.OnError(SqlException exception, Boolean breakConnection, Action`1 wrapCloseInAction)
   at Microsoft.Data.SqlClient.SqlInternalConnection.OnError(SqlException exception, Boolean breakConnection, Action`1 wrapCloseInAction)
   at Microsoft.Data.SqlClient.TdsParser.ThrowExceptionAndWarning(TdsParserStateObject stateObj, Boolean callerHasConnectionLock, Boolean asyncClose)
   at Microsoft.Data.SqlClient.TdsParser.TryRun(RunBehavior runBehavior, SqlCommand cmdHandler, SqlDataReader dataStream, BulkCopySimpleResultSet bulkCopyHandler, TdsParserStateObject stateObj, Boolean& dataReady)
   at Microsoft.Data.SqlClient.SqlDataReader.TryHasMoreRows(Boolean& moreRows)
   at Microsoft.Data.SqlClient.SqlDataReader.TryReadInternal(Boolean setTimeout, Boolean& more)
   at Microsoft.Data.SqlClient.SqlDataReader.ReadAsyncExecute(Task task, Object state)
   at Microsoft.Data.SqlClient.SqlDataReader.InvokeAsyncCall[T](SqlDataReaderBaseAsyncCallContext`1 context)
--- End of stack trace from previous location ---
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeResultSetAsync(Int32 startCommandIndex, RelationalDataReader reader, CancellationToken cancellationToken)
ClientConnectionId:7d7bf686-8232-4142-9041-4f861ac2fc0b
Error Number:515,State:2,Class:16
   --- End of inner exception stack trace ---
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeResultSetAsync(Int32 startCommandIndex, RelationalDataReader reader, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeAsync(RelationalDataReader reader, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Update.Internal.SqlServerModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(IList`1 entriesToSave, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(StateManager stateManager, Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Storage.Internal.SqlServerExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at NayifatAPI.Controllers.NotificationsController.SendNotification(SendNotificationRequest request) in C:\Users\yamta\StudioProjects\nayifat_app_2025_new\NayifatAPI\Controllers\NotificationsController.cs:line 247
2025-01-31 21:52:08.528 +03:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType9`2[[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Object, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-01-31 21:52:08.538 +03:00 [INF] Executed action NayifatAPI.Controllers.NotificationsController.SendNotification (NayifatAPI) in 845.3443ms
2025-01-31 21:52:08.541 +03:00 [INF] Executed endpoint 'NayifatAPI.Controllers.NotificationsController.SendNotification (NayifatAPI)'
2025-01-31 21:52:08.547 +03:00 [INF] Request finished HTTP/1.1 POST http://localhost:5264/api/notifications/send - 200 null application/json; charset=utf-8 862.1657ms
2025-01-31 21:53:11.654 +03:00 [INF] Request starting HTTP/1.1 POST http://localhost:5264/api/notifications/send - application/json 363
2025-01-31 21:53:11.658 +03:00 [INF] Executing endpoint 'NayifatAPI.Controllers.NotificationsController.SendNotification (NayifatAPI)'
2025-01-31 21:53:11.659 +03:00 [INF] Route matched with {action = "SendNotification", controller = "Notifications"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] SendNotification(NayifatAPI.Controllers.SendNotificationRequest) on controller NayifatAPI.Controllers.NotificationsController (NayifatAPI).
2025-01-31 21:53:11.669 +03:00 [INF] Executed DbCommand (4ms) [Parameters=[@__providedApiKey_0='?' (Size = 255)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [a].[Key], [a].[CreatedAt], [a].[Description], [a].[ExpiresAt], [a].[IsActive], [a].[LastUsedAt]
FROM [ApiKeys] AS [a]
WHERE [a].[Key] = @__providedApiKey_0 AND [a].[IsActive] = CAST(1 AS bit)
2025-01-31 21:53:11.672 +03:00 [INF] Executing ObjectResult, writing value of type '<>f__AnonymousType11`2[[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-01-31 21:53:11.674 +03:00 [INF] Executed action NayifatAPI.Controllers.NotificationsController.SendNotification (NayifatAPI) in 11.8925ms
2025-01-31 21:53:11.675 +03:00 [INF] Executed endpoint 'NayifatAPI.Controllers.NotificationsController.SendNotification (NayifatAPI)'
2025-01-31 21:53:11.676 +03:00 [INF] Request finished HTTP/1.1 POST http://localhost:5264/api/notifications/send - 400 null application/json; charset=utf-8 22.254ms
2025-01-31 21:54:36.823 +03:00 [INF] Request starting HTTP/1.1 POST http://localhost:5264/api/notifications/send - application/json 363
2025-01-31 21:54:36.825 +03:00 [INF] Executing endpoint 'NayifatAPI.Controllers.NotificationsController.SendNotification (NayifatAPI)'
2025-01-31 21:54:36.827 +03:00 [INF] Route matched with {action = "SendNotification", controller = "Notifications"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] SendNotification(NayifatAPI.Controllers.SendNotificationRequest) on controller NayifatAPI.Controllers.NotificationsController (NayifatAPI).
2025-01-31 21:54:36.833 +03:00 [INF] Executed DbCommand (3ms) [Parameters=[@__providedApiKey_0='?' (Size = 255)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [a].[Key], [a].[CreatedAt], [a].[Description], [a].[ExpiresAt], [a].[IsActive], [a].[LastUsedAt]
FROM [ApiKeys] AS [a]
WHERE [a].[Key] = @__providedApiKey_0 AND [a].[IsActive] = CAST(1 AS bit)
2025-01-31 21:54:36.835 +03:00 [INF] Executing ObjectResult, writing value of type '<>f__AnonymousType11`2[[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-01-31 21:54:36.839 +03:00 [INF] Executed action NayifatAPI.Controllers.NotificationsController.SendNotification (NayifatAPI) in 10.5863ms
2025-01-31 21:54:36.841 +03:00 [INF] Executed endpoint 'NayifatAPI.Controllers.NotificationsController.SendNotification (NayifatAPI)'
2025-01-31 21:54:36.842 +03:00 [INF] Request finished HTTP/1.1 POST http://localhost:5264/api/notifications/send - 400 null application/json; charset=utf-8 18.6836ms
2025-01-31 21:55:56.778 +03:00 [INF] Application is shutting down...
2025-01-31 21:56:14.098 +03:00 [INF] Starting web application
2025-01-31 21:56:14.196 +03:00 [INF] Now listening on: http://localhost:5264
2025-01-31 21:56:14.201 +03:00 [INF] Application started. Press Ctrl+C to shut down.
2025-01-31 21:56:14.203 +03:00 [INF] Hosting environment: Development
2025-01-31 21:56:14.203 +03:00 [INF] Content root path: C:\Users\yamta\StudioProjects\nayifat_app_2025_new\NayifatAPI
2025-01-31 21:56:19.526 +03:00 [INF] Request starting HTTP/1.1 POST http://localhost:5264/api/notifications/send - application/json 363
2025-01-31 21:56:19.579 +03:00 [WRN] Failed to determine the https port for redirect.
2025-01-31 21:56:19.589 +03:00 [INF] Executing endpoint 'NayifatAPI.Controllers.NotificationsController.SendNotification (NayifatAPI)'
2025-01-31 21:56:19.619 +03:00 [INF] Route matched with {action = "SendNotification", controller = "Notifications"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] SendNotification(NayifatAPI.Controllers.SendNotificationRequest) on controller NayifatAPI.Controllers.NotificationsController (NayifatAPI).
2025-01-31 21:56:21.208 +03:00 [INF] Executed DbCommand (51ms) [Parameters=[@__providedApiKey_0='?' (Size = 255)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [a].[Key], [a].[CreatedAt], [a].[Description], [a].[ExpiresAt], [a].[IsActive], [a].[LastUsedAt]
FROM [ApiKeys] AS [a]
WHERE [a].[Key] = @__providedApiKey_0 AND [a].[IsActive] = CAST(1 AS bit)
2025-01-31 21:56:21.325 +03:00 [INF] Executing ObjectResult, writing value of type '<>f__AnonymousType11`2[[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-01-31 21:56:21.343 +03:00 [INF] Executed action NayifatAPI.Controllers.NotificationsController.SendNotification (NayifatAPI) in 1719.862ms
2025-01-31 21:56:21.346 +03:00 [INF] Executed endpoint 'NayifatAPI.Controllers.NotificationsController.SendNotification (NayifatAPI)'
2025-01-31 21:56:21.360 +03:00 [INF] Request finished HTTP/1.1 POST http://localhost:5264/api/notifications/send - 400 null application/json; charset=utf-8 1836.3179ms
2025-01-31 21:56:32.978 +03:00 [INF] Request starting HTTP/1.1 POST http://localhost:5264/api/notifications/send - application/json 363
2025-01-31 21:56:32.986 +03:00 [INF] Executing endpoint 'NayifatAPI.Controllers.NotificationsController.SendNotification (NayifatAPI)'
2025-01-31 21:56:32.988 +03:00 [INF] Route matched with {action = "SendNotification", controller = "Notifications"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] SendNotification(NayifatAPI.Controllers.SendNotificationRequest) on controller NayifatAPI.Controllers.NotificationsController (NayifatAPI).
2025-01-31 21:56:33.133 +03:00 [INF] Executed DbCommand (3ms) [Parameters=[@__providedApiKey_0='?' (Size = 255)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [a].[Key], [a].[CreatedAt], [a].[Description], [a].[ExpiresAt], [a].[IsActive], [a].[LastUsedAt]
FROM [ApiKeys] AS [a]
WHERE [a].[Key] = @__providedApiKey_0 AND [a].[IsActive] = CAST(1 AS bit)
2025-01-31 21:56:33.153 +03:00 [INF] Executing ObjectResult, writing value of type '<>f__AnonymousType11`2[[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-01-31 21:56:33.157 +03:00 [INF] Executed action NayifatAPI.Controllers.NotificationsController.SendNotification (NayifatAPI) in 166.8513ms
2025-01-31 21:56:33.159 +03:00 [INF] Executed endpoint 'NayifatAPI.Controllers.NotificationsController.SendNotification (NayifatAPI)'
2025-01-31 21:56:33.160 +03:00 [INF] Request finished HTTP/1.1 POST http://localhost:5264/api/notifications/send - 400 null application/json; charset=utf-8 182.4568ms
2025-01-31 21:58:58.829 +03:00 [INF] Application is shutting down...
2025-01-31 21:59:07.439 +03:00 [INF] Executed DbCommand (14ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT 1
2025-01-31 21:59:07.497 +03:00 [INF] Executed DbCommand (10ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT OBJECT_ID(N'[__EFMigrationsHistory]');
2025-01-31 21:59:07.503 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT 1
2025-01-31 21:59:07.509 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT OBJECT_ID(N'[__EFMigrationsHistory]');
2025-01-31 21:59:07.534 +03:00 [INF] Executed DbCommand (10ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT [MigrationId], [ProductVersion]
FROM [__EFMigrationsHistory]
ORDER BY [MigrationId];
2025-01-31 21:59:07.554 +03:00 [INF] Applying migration '20250130154447_AddYakeenCitizenAddress'.
2025-01-31 21:59:07.646 +03:00 [INF] Executed DbCommand (11ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
CREATE TABLE [YakeenCitizenAddress] (
    [Id] int NOT NULL IDENTITY,
    [IqamaNumber] nvarchar(50) NOT NULL,
    [DateOfBirthHijri] nvarchar(20) NOT NULL,
    [AddressLanguage] nvarchar(2) NOT NULL,
    [LogId] int NOT NULL,
    CONSTRAINT [PK_YakeenCitizenAddress] PRIMARY KEY ([Id])
);
2025-01-31 21:59:07.651 +03:00 [INF] Executed DbCommand (3ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
CREATE TABLE [CitizenAddressListItem] (
    [Id] int NOT NULL IDENTITY,
    [AdditionalNumber] int NOT NULL,
    [BuildingNumber] int NOT NULL,
    [City] nvarchar(100) NOT NULL,
    [District] nvarchar(100) NOT NULL,
    [IsPrimaryAddress] bit NOT NULL,
    [LocationCoordinates] nvarchar(100) NOT NULL,
    [PostCode] int NOT NULL,
    [StreetName] nvarchar(100) NOT NULL,
    [UnitNumber] int NOT NULL,
    [YakeenCitizenAddressId] int NOT NULL,
    CONSTRAINT [PK_CitizenAddressListItem] PRIMARY KEY ([Id]),
    CONSTRAINT [FK_CitizenAddressListItem_YakeenCitizenAddress_YakeenCitizenAddressId] FOREIGN KEY ([YakeenCitizenAddressId]) REFERENCES [YakeenCitizenAddress] ([Id]) ON DELETE CASCADE
);
2025-01-31 21:59:07.660 +03:00 [INF] Executed DbCommand (5ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
CREATE INDEX [IX_CitizenAddressListItem_YakeenCitizenAddressId] ON [CitizenAddressListItem] ([YakeenCitizenAddressId]);
2025-01-31 21:59:07.663 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
CREATE INDEX [IX_YakeenCitizenAddress_IqamaNumber] ON [YakeenCitizenAddress] ([IqamaNumber]);
2025-01-31 21:59:07.666 +03:00 [INF] Executed DbCommand (2ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
INSERT INTO [__EFMigrationsHistory] ([MigrationId], [ProductVersion])
VALUES (N'20250130154447_AddYakeenCitizenAddress', N'8.0.1');
2025-01-31 22:01:18.662 +03:00 [INF] Starting web application
2025-01-31 22:01:18.766 +03:00 [INF] Now listening on: http://localhost:5264
2025-01-31 22:01:18.771 +03:00 [INF] Application started. Press Ctrl+C to shut down.
2025-01-31 22:01:18.772 +03:00 [INF] Hosting environment: Development
2025-01-31 22:01:18.773 +03:00 [INF] Content root path: C:\Users\yamta\StudioProjects\nayifat_app_2025_new\NayifatAPI
2025-01-31 22:01:24.104 +03:00 [INF] Request starting HTTP/1.1 POST http://localhost:5264/api/notifications/send - application/json 363
2025-01-31 22:01:24.175 +03:00 [WRN] Failed to determine the https port for redirect.
2025-01-31 22:01:24.186 +03:00 [INF] Executing endpoint 'NayifatAPI.Controllers.NotificationsController.SendNotification (NayifatAPI)'
2025-01-31 22:01:24.233 +03:00 [INF] Route matched with {action = "SendNotification", controller = "Notifications"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] SendNotification(NayifatAPI.Controllers.SendNotificationRequest) on controller NayifatAPI.Controllers.NotificationsController (NayifatAPI).
2025-01-31 22:01:25.805 +03:00 [INF] Executed DbCommand (31ms) [Parameters=[@__providedApiKey_0='?' (Size = 255)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [a].[Key], [a].[CreatedAt], [a].[Description], [a].[ExpiresAt], [a].[IsActive], [a].[LastUsedAt]
FROM [ApiKeys] AS [a]
WHERE [a].[Key] = @__providedApiKey_0 AND [a].[IsActive] = CAST(1 AS bit)
2025-01-31 22:01:25.937 +03:00 [INF] Executed DbCommand (15ms) [Parameters=[@__request_NationalId_0='?' (Size = 450)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [c].[NationalId]
FROM [Customers] AS [c]
WHERE [c].[NationalId] = @__request_NationalId_0
2025-01-31 22:01:25.956 +03:00 [INF] Executing ObjectResult, writing value of type '<>f__AnonymousType11`2[[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-01-31 22:01:25.980 +03:00 [INF] Executed action NayifatAPI.Controllers.NotificationsController.SendNotification (NayifatAPI) in 1740.1382ms
2025-01-31 22:01:25.983 +03:00 [INF] Executed endpoint 'NayifatAPI.Controllers.NotificationsController.SendNotification (NayifatAPI)'
2025-01-31 22:01:25.997 +03:00 [INF] Request finished HTTP/1.1 POST http://localhost:5264/api/notifications/send - 400 null application/json; charset=utf-8 1893.9839ms
2025-01-31 22:04:27.900 +03:00 [INF] Application is shutting down...
2025-01-31 22:04:39.457 +03:00 [INF] Starting web application
2025-01-31 22:04:39.633 +03:00 [INF] Now listening on: http://localhost:5264
2025-01-31 22:04:39.640 +03:00 [INF] Application started. Press Ctrl+C to shut down.
2025-01-31 22:04:39.641 +03:00 [INF] Hosting environment: Development
2025-01-31 22:04:39.642 +03:00 [INF] Content root path: C:\Users\yamta\StudioProjects\nayifat_app_2025_new\NayifatAPI
2025-01-31 22:04:51.468 +03:00 [INF] Request starting HTTP/1.1 POST http://localhost:5264/api/notifications/send - application/json 363
2025-01-31 22:04:51.522 +03:00 [WRN] Failed to determine the https port for redirect.
2025-01-31 22:04:51.531 +03:00 [INF] Executing endpoint 'NayifatAPI.Controllers.NotificationsController.SendNotification (NayifatAPI)'
2025-01-31 22:04:51.573 +03:00 [INF] Route matched with {action = "SendNotification", controller = "Notifications"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] SendNotification(NayifatAPI.Controllers.SendNotificationRequest) on controller NayifatAPI.Controllers.NotificationsController (NayifatAPI).
2025-01-31 22:04:53.204 +03:00 [INF] Executed DbCommand (29ms) [Parameters=[@__providedApiKey_0='?' (Size = 255)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [a].[Key], [a].[CreatedAt], [a].[Description], [a].[ExpiresAt], [a].[IsActive], [a].[LastUsedAt]
FROM [ApiKeys] AS [a]
WHERE [a].[Key] = @__providedApiKey_0 AND [a].[IsActive] = CAST(1 AS bit)
2025-01-31 22:04:53.337 +03:00 [INF] Executed DbCommand (19ms) [Parameters=[@__request_NationalId_0='?' (Size = 450)], CommandType='"Text"', CommandTimeout='30']
SELECT [c].[NationalId]
FROM [Customers] AS [c]
WHERE [c].[NationalId] = @__request_NationalId_0
2025-01-31 22:04:53.355 +03:00 [INF] Executing ObjectResult, writing value of type '<>f__AnonymousType11`2[[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-01-31 22:04:53.382 +03:00 [INF] Executed action NayifatAPI.Controllers.NotificationsController.SendNotification (NayifatAPI) in 1802.0847ms
2025-01-31 22:04:53.385 +03:00 [INF] Executed endpoint 'NayifatAPI.Controllers.NotificationsController.SendNotification (NayifatAPI)'
2025-01-31 22:04:53.403 +03:00 [INF] Request finished HTTP/1.1 POST http://localhost:5264/api/notifications/send - 400 null application/json; charset=utf-8 1935.656ms
2025-01-31 22:09:13.846 +03:00 [INF] Application is shutting down...
2025-01-31 22:15:41.170 +03:00 [INF] Executed DbCommand (15ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT 1
2025-01-31 22:15:41.226 +03:00 [INF] Executed DbCommand (10ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT OBJECT_ID(N'[__EFMigrationsHistory]');
2025-01-31 22:15:41.229 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT 1
2025-01-31 22:15:41.231 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT OBJECT_ID(N'[__EFMigrationsHistory]');
2025-01-31 22:15:41.247 +03:00 [INF] Executed DbCommand (2ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT [MigrationId], [ProductVersion]
FROM [__EFMigrationsHistory]
ORDER BY [MigrationId];
2025-01-31 22:15:41.260 +03:00 [INF] No migrations were applied. The database is already up to date.
2025-01-31 22:24:48.410 +03:00 [INF] Starting web application
2025-01-31 22:24:48.543 +03:00 [INF] Now listening on: http://localhost:5264
2025-01-31 22:24:48.549 +03:00 [INF] Application started. Press Ctrl+C to shut down.
2025-01-31 22:24:48.550 +03:00 [INF] Hosting environment: Development
2025-01-31 22:24:48.551 +03:00 [INF] Content root path: C:\Users\yamta\StudioProjects\nayifat_app_2025_new\NayifatAPI
2025-01-31 22:26:04.462 +03:00 [INF] Request starting HTTP/1.1 POST http://localhost:5264/api/notifications/send - application/json 215
2025-01-31 22:26:04.536 +03:00 [WRN] Failed to determine the https port for redirect.
2025-01-31 22:26:04.542 +03:00 [INF] Executing endpoint 'NayifatAPI.Controllers.NotificationsController.SendNotification (NayifatAPI)'
2025-01-31 22:26:04.588 +03:00 [INF] Route matched with {action = "SendNotification", controller = "Notifications"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] SendNotification(NayifatAPI.Controllers.SendNotificationRequest) on controller NayifatAPI.Controllers.NotificationsController (NayifatAPI).
2025-01-31 22:26:06.898 +03:00 [INF] Executed DbCommand (40ms) [Parameters=[@__providedApiKey_0='?' (Size = 255)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [a].[Key], [a].[CreatedAt], [a].[Description], [a].[ExpiresAt], [a].[IsActive], [a].[LastUsedAt]
FROM [ApiKeys] AS [a]
WHERE [a].[Key] = @__providedApiKey_0 AND [a].[IsActive] = CAST(1 AS bit)
2025-01-31 22:26:07.054 +03:00 [WRN] No target users found for notification
2025-01-31 22:26:07.064 +03:00 [INF] Executing ObjectResult, writing value of type '<>f__AnonymousType11`2[[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-01-31 22:26:07.087 +03:00 [INF] Executed action NayifatAPI.Controllers.NotificationsController.SendNotification (NayifatAPI) in 2490.079ms
2025-01-31 22:26:07.093 +03:00 [INF] Executed endpoint 'NayifatAPI.Controllers.NotificationsController.SendNotification (NayifatAPI)'
2025-01-31 22:26:07.109 +03:00 [INF] Request finished HTTP/1.1 POST http://localhost:5264/api/notifications/send - 400 null application/json; charset=utf-8 2650.2009ms
2025-01-31 22:26:16.568 +03:00 [INF] Request starting HTTP/1.1 POST http://localhost:5264/api/notifications/send - application/json 215
2025-01-31 22:26:16.577 +03:00 [INF] Executing endpoint 'NayifatAPI.Controllers.NotificationsController.SendNotification (NayifatAPI)'
2025-01-31 22:26:16.578 +03:00 [INF] Route matched with {action = "SendNotification", controller = "Notifications"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] SendNotification(NayifatAPI.Controllers.SendNotificationRequest) on controller NayifatAPI.Controllers.NotificationsController (NayifatAPI).
2025-01-31 22:26:16.630 +03:00 [INF] Executed DbCommand (2ms) [Parameters=[@__providedApiKey_0='?' (Size = 255)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [a].[Key], [a].[CreatedAt], [a].[Description], [a].[ExpiresAt], [a].[IsActive], [a].[LastUsedAt]
FROM [ApiKeys] AS [a]
WHERE [a].[Key] = @__providedApiKey_0 AND [a].[IsActive] = CAST(1 AS bit)
2025-01-31 22:26:16.637 +03:00 [WRN] No target users found for notification
2025-01-31 22:26:16.640 +03:00 [INF] Executing ObjectResult, writing value of type '<>f__AnonymousType11`2[[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-01-31 22:26:16.643 +03:00 [INF] Executed action NayifatAPI.Controllers.NotificationsController.SendNotification (NayifatAPI) in 62.6893ms
2025-01-31 22:26:16.644 +03:00 [INF] Executed endpoint 'NayifatAPI.Controllers.NotificationsController.SendNotification (NayifatAPI)'
2025-01-31 22:26:16.646 +03:00 [INF] Request finished HTTP/1.1 POST http://localhost:5264/api/notifications/send - 400 null application/json; charset=utf-8 77.8916ms
2025-01-31 22:27:49.515 +03:00 [INF] Application is shutting down...
2025-01-31 22:28:03.274 +03:00 [INF] Starting web application
2025-01-31 22:28:03.369 +03:00 [INF] Now listening on: http://localhost:5264
2025-01-31 22:28:03.374 +03:00 [INF] Application started. Press Ctrl+C to shut down.
2025-01-31 22:28:03.375 +03:00 [INF] Hosting environment: Development
2025-01-31 22:28:03.375 +03:00 [INF] Content root path: C:\Users\yamta\StudioProjects\nayifat_app_2025_new\NayifatAPI
2025-01-31 22:28:09.351 +03:00 [INF] Request starting HTTP/1.1 POST http://localhost:5264/api/notifications/send - application/json 215
2025-01-31 22:28:09.509 +03:00 [WRN] Failed to determine the https port for redirect.
2025-01-31 22:28:09.816 +03:00 [INF] Executing endpoint 'NayifatAPI.Controllers.NotificationsController.SendNotification (NayifatAPI)'
2025-01-31 22:28:09.889 +03:00 [INF] Route matched with {action = "SendNotification", controller = "Notifications"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] SendNotification(NayifatAPI.Controllers.SendNotificationRequest) on controller NayifatAPI.Controllers.NotificationsController (NayifatAPI).
2025-01-31 22:28:13.336 +03:00 [INF] Executed DbCommand (53ms) [Parameters=[@__providedApiKey_0='?' (Size = 255)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [a].[Key], [a].[CreatedAt], [a].[Description], [a].[ExpiresAt], [a].[IsActive], [a].[LastUsedAt]
FROM [ApiKeys] AS [a]
WHERE [a].[Key] = @__providedApiKey_0 AND [a].[IsActive] = CAST(1 AS bit)
2025-01-31 22:28:13.480 +03:00 [INF] Received notification request: {"Title":null,"TitleEn":"Test Notification","TitleAr":" ","Filters":null,"NationalId":null,"NationalIds":null}
2025-01-31 22:28:13.506 +03:00 [INF] Starting GetTargetUsers with request type: Unknown
2025-01-31 22:28:13.508 +03:00 [INF] Target users query completed. Found 0 users
2025-01-31 22:28:13.510 +03:00 [WRN] No target users found. Filters: null
2025-01-31 22:28:13.520 +03:00 [INF] Executing ObjectResult, writing value of type '<>f__AnonymousType11`2[[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-01-31 22:28:13.552 +03:00 [INF] Executed action NayifatAPI.Controllers.NotificationsController.SendNotification (NayifatAPI) in 3323.4013ms
2025-01-31 22:28:13.555 +03:00 [INF] Executed endpoint 'NayifatAPI.Controllers.NotificationsController.SendNotification (NayifatAPI)'
2025-01-31 22:28:13.569 +03:00 [INF] Request finished HTTP/1.1 POST http://localhost:5264/api/notifications/send - 400 null application/json; charset=utf-8 4221.2667ms
2025-01-31 22:29:52.653 +03:00 [INF] Request starting HTTP/1.1 POST http://localhost:5264/api/notifications/send - application/json 216
2025-01-31 22:29:52.659 +03:00 [INF] Executing endpoint 'NayifatAPI.Controllers.NotificationsController.SendNotification (NayifatAPI)'
2025-01-31 22:29:52.661 +03:00 [INF] Route matched with {action = "SendNotification", controller = "Notifications"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] SendNotification(NayifatAPI.Controllers.SendNotificationRequest) on controller NayifatAPI.Controllers.NotificationsController (NayifatAPI).
2025-01-31 22:29:52.738 +03:00 [INF] Executed DbCommand (9ms) [Parameters=[@__providedApiKey_0='?' (Size = 255)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [a].[Key], [a].[CreatedAt], [a].[Description], [a].[ExpiresAt], [a].[IsActive], [a].[LastUsedAt]
FROM [ApiKeys] AS [a]
WHERE [a].[Key] = @__providedApiKey_0 AND [a].[IsActive] = CAST(1 AS bit)
2025-01-31 22:29:52.741 +03:00 [INF] Received notification request: {"Title":null,"TitleEn":"Test Notification","TitleAr":" ","Filters":null,"NationalId":"1012345678","NationalIds":null}
2025-01-31 22:29:52.745 +03:00 [INF] Starting GetTargetUsers with request type: Single User
2025-01-31 22:29:52.746 +03:00 [INF] Searching for single user with ID: 1012345678
2025-01-31 22:29:52.802 +03:00 [INF] Executed DbCommand (15ms) [Parameters=[@__request_NationalId_0='?' (Size = 450)], CommandType='"Text"', CommandTimeout='30']
SELECT [c].[NationalId]
FROM [Customers] AS [c]
WHERE [c].[NationalId] = @__request_NationalId_0
2025-01-31 22:29:52.822 +03:00 [INF] Target users query completed. Found 1 users
2025-01-31 22:29:52.823 +03:00 [INF] Found 1 target users for notification
2025-01-31 22:29:53.079 +03:00 [INF] Executed DbCommand (15ms) [Parameters=[@p0='?' (Size = 4000), @p1='?' (Size = 8000) (DbType = AnsiString), @p2='?' (Size = 8000) (DbType = AnsiString), @p3='?' (Size = 8000) (DbType = AnsiString), @p4='?' (DbType = DateTime2), @p5='?' (DbType = DateTime2), @p6='?' (Size = 255), @p7='?' (Size = 4000), @p8='?' (Size = 255), @p9='?' (Size = 255), @p10='?' (Size = 255)], CommandType='"Text"', CommandTimeout='30']
SET IMPLICIT_TRANSACTIONS OFF;
SET NOCOUNT ON;
INSERT INTO [notification_templates] ([additional_data], [Body], [body_ar], [body_en], [created_at], [expiry_at], [Route], [target_criteria], [Title], [title_ar], [title_en])
OUTPUT INSERTED.[Id]
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7, @p8, @p9, @p10);
2025-01-31 22:29:53.129 +03:00 [INF] Created notification template with ID: 2
2025-01-31 22:29:53.214 +03:00 [INF] Executed DbCommand (4ms) [Parameters=[@p0='?' (Size = 4000), @p1='?' (DbType = DateTime2), @p2='?' (Size = 4000), @p3='?' (Size = 4000), @p4='?' (Size = 4000), @p5='?' (Size = 450), @p6='?' (Size = 4000), @p7='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SET IMPLICIT_TRANSACTIONS OFF;
SET NOCOUNT ON;
INSERT INTO [AuthLogs] ([AuthType], [CreatedAt], [DeviceId], [FailureReason], [IpAddress], [NationalId], [Status], [UserAgent])
OUTPUT INSERTED.[Id]
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7);
2025-01-31 22:29:53.253 +03:00 [ERR] An exception occurred in the database while saving changes for context type 'NayifatAPI.Data.ApplicationDbContext'.
Microsoft.EntityFrameworkCore.DbUpdateException: An error occurred while saving the entity changes. See the inner exception for details.
 ---> Microsoft.Data.SqlClient.SqlException (0x80131904): Cannot insert the value NULL into column 'NationalId', table 'NayifatApp.dbo.AuthLogs'; column does not allow nulls. INSERT fails.
   at Microsoft.Data.SqlClient.SqlConnection.OnError(SqlException exception, Boolean breakConnection, Action`1 wrapCloseInAction)
   at Microsoft.Data.SqlClient.SqlInternalConnection.OnError(SqlException exception, Boolean breakConnection, Action`1 wrapCloseInAction)
   at Microsoft.Data.SqlClient.TdsParser.ThrowExceptionAndWarning(TdsParserStateObject stateObj, Boolean callerHasConnectionLock, Boolean asyncClose)
   at Microsoft.Data.SqlClient.TdsParser.TryRun(RunBehavior runBehavior, SqlCommand cmdHandler, SqlDataReader dataStream, BulkCopySimpleResultSet bulkCopyHandler, TdsParserStateObject stateObj, Boolean& dataReady)
   at Microsoft.Data.SqlClient.SqlDataReader.TryHasMoreRows(Boolean& moreRows)
   at Microsoft.Data.SqlClient.SqlDataReader.TryReadInternal(Boolean setTimeout, Boolean& more)
   at Microsoft.Data.SqlClient.SqlDataReader.ReadAsyncExecute(Task task, Object state)
   at Microsoft.Data.SqlClient.SqlDataReader.InvokeAsyncCall[T](SqlDataReaderBaseAsyncCallContext`1 context)
--- End of stack trace from previous location ---
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeResultSetAsync(Int32 startCommandIndex, RelationalDataReader reader, CancellationToken cancellationToken)
ClientConnectionId:0bbda166-284e-4a85-8840-74b6d5eced92
Error Number:515,State:2,Class:16
   --- End of inner exception stack trace ---
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeResultSetAsync(Int32 startCommandIndex, RelationalDataReader reader, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeAsync(RelationalDataReader reader, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Update.Internal.SqlServerModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(IList`1 entriesToSave, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(StateManager stateManager, Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Storage.Internal.SqlServerExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
Microsoft.EntityFrameworkCore.DbUpdateException: An error occurred while saving the entity changes. See the inner exception for details.
 ---> Microsoft.Data.SqlClient.SqlException (0x80131904): Cannot insert the value NULL into column 'NationalId', table 'NayifatApp.dbo.AuthLogs'; column does not allow nulls. INSERT fails.
   at Microsoft.Data.SqlClient.SqlConnection.OnError(SqlException exception, Boolean breakConnection, Action`1 wrapCloseInAction)
   at Microsoft.Data.SqlClient.SqlInternalConnection.OnError(SqlException exception, Boolean breakConnection, Action`1 wrapCloseInAction)
   at Microsoft.Data.SqlClient.TdsParser.ThrowExceptionAndWarning(TdsParserStateObject stateObj, Boolean callerHasConnectionLock, Boolean asyncClose)
   at Microsoft.Data.SqlClient.TdsParser.TryRun(RunBehavior runBehavior, SqlCommand cmdHandler, SqlDataReader dataStream, BulkCopySimpleResultSet bulkCopyHandler, TdsParserStateObject stateObj, Boolean& dataReady)
   at Microsoft.Data.SqlClient.SqlDataReader.TryHasMoreRows(Boolean& moreRows)
   at Microsoft.Data.SqlClient.SqlDataReader.TryReadInternal(Boolean setTimeout, Boolean& more)
   at Microsoft.Data.SqlClient.SqlDataReader.ReadAsyncExecute(Task task, Object state)
   at Microsoft.Data.SqlClient.SqlDataReader.InvokeAsyncCall[T](SqlDataReaderBaseAsyncCallContext`1 context)
--- End of stack trace from previous location ---
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeResultSetAsync(Int32 startCommandIndex, RelationalDataReader reader, CancellationToken cancellationToken)
ClientConnectionId:0bbda166-284e-4a85-8840-74b6d5eced92
Error Number:515,State:2,Class:16
   --- End of inner exception stack trace ---
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeResultSetAsync(Int32 startCommandIndex, RelationalDataReader reader, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeAsync(RelationalDataReader reader, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Update.Internal.SqlServerModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(IList`1 entriesToSave, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(StateManager stateManager, Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Storage.Internal.SqlServerExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
2025-01-31 22:29:53.298 +03:00 [ERR] Error logging audit event. NationalId: null, Action: notification_sent, Details: {"template_id":2,"recipient_count":1,"target_criteria":null,"timestamp":"2025-01-31T19:29:52.8247735Z"}
Microsoft.EntityFrameworkCore.DbUpdateException: An error occurred while saving the entity changes. See the inner exception for details.
 ---> Microsoft.Data.SqlClient.SqlException (0x80131904): Cannot insert the value NULL into column 'NationalId', table 'NayifatApp.dbo.AuthLogs'; column does not allow nulls. INSERT fails.
   at Microsoft.Data.SqlClient.SqlConnection.OnError(SqlException exception, Boolean breakConnection, Action`1 wrapCloseInAction)
   at Microsoft.Data.SqlClient.SqlInternalConnection.OnError(SqlException exception, Boolean breakConnection, Action`1 wrapCloseInAction)
   at Microsoft.Data.SqlClient.TdsParser.ThrowExceptionAndWarning(TdsParserStateObject stateObj, Boolean callerHasConnectionLock, Boolean asyncClose)
   at Microsoft.Data.SqlClient.TdsParser.TryRun(RunBehavior runBehavior, SqlCommand cmdHandler, SqlDataReader dataStream, BulkCopySimpleResultSet bulkCopyHandler, TdsParserStateObject stateObj, Boolean& dataReady)
   at Microsoft.Data.SqlClient.SqlDataReader.TryHasMoreRows(Boolean& moreRows)
   at Microsoft.Data.SqlClient.SqlDataReader.TryReadInternal(Boolean setTimeout, Boolean& more)
   at Microsoft.Data.SqlClient.SqlDataReader.ReadAsyncExecute(Task task, Object state)
   at Microsoft.Data.SqlClient.SqlDataReader.InvokeAsyncCall[T](SqlDataReaderBaseAsyncCallContext`1 context)
--- End of stack trace from previous location ---
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeResultSetAsync(Int32 startCommandIndex, RelationalDataReader reader, CancellationToken cancellationToken)
ClientConnectionId:0bbda166-284e-4a85-8840-74b6d5eced92
Error Number:515,State:2,Class:16
   --- End of inner exception stack trace ---
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeResultSetAsync(Int32 startCommandIndex, RelationalDataReader reader, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeAsync(RelationalDataReader reader, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Update.Internal.SqlServerModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(IList`1 entriesToSave, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(StateManager stateManager, Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Storage.Internal.SqlServerExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at NayifatAPI.Services.AuditLogService.LogAsync(String nationalId, String action, Object details) in C:\Users\yamta\StudioProjects\nayifat_app_2025_new\NayifatAPI\Services\AuditLogService.cs:line 36
2025-01-31 22:29:53.350 +03:00 [INF] Executed DbCommand (2ms) [Parameters=[@__userId_0='?' (Size = 450)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [u].[national_id], [u].[last_updated], [u].[notifications]
FROM [user_notifications] AS [u]
WHERE [u].[national_id] = @__userId_0
2025-01-31 22:29:53.377 +03:00 [INF] Created new notifications entry for user: 1012345678
2025-01-31 22:29:53.401 +03:00 [INF] Executed DbCommand (4ms) [Parameters=[@p0='?' (Size = 4000), @p1='?' (DbType = DateTime2), @p2='?' (Size = 4000), @p3='?' (Size = 4000), @p4='?' (Size = 4000), @p5='?' (Size = 450), @p6='?' (Size = 4000), @p7='?' (Size = 4000), @p8='?' (Size = 450), @p9='?' (DbType = DateTime2), @p10='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SET NOCOUNT ON;
INSERT INTO [AuthLogs] ([AuthType], [CreatedAt], [DeviceId], [FailureReason], [IpAddress], [NationalId], [Status], [UserAgent])
OUTPUT INSERTED.[Id]
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7);
INSERT INTO [user_notifications] ([national_id], [last_updated], [notifications])
VALUES (@p8, @p9, @p10);
2025-01-31 22:29:53.414 +03:00 [ERR] An exception occurred in the database while saving changes for context type 'NayifatAPI.Data.ApplicationDbContext'.
Microsoft.EntityFrameworkCore.DbUpdateException: An error occurred while saving the entity changes. See the inner exception for details.
 ---> Microsoft.Data.SqlClient.SqlException (0x80131904): Cannot insert the value NULL into column 'NationalId', table 'NayifatApp.dbo.AuthLogs'; column does not allow nulls. INSERT fails.
   at Microsoft.Data.SqlClient.SqlConnection.OnError(SqlException exception, Boolean breakConnection, Action`1 wrapCloseInAction)
   at Microsoft.Data.SqlClient.SqlInternalConnection.OnError(SqlException exception, Boolean breakConnection, Action`1 wrapCloseInAction)
   at Microsoft.Data.SqlClient.TdsParser.ThrowExceptionAndWarning(TdsParserStateObject stateObj, Boolean callerHasConnectionLock, Boolean asyncClose)
   at Microsoft.Data.SqlClient.TdsParser.TryRun(RunBehavior runBehavior, SqlCommand cmdHandler, SqlDataReader dataStream, BulkCopySimpleResultSet bulkCopyHandler, TdsParserStateObject stateObj, Boolean& dataReady)
   at Microsoft.Data.SqlClient.SqlDataReader.TryHasMoreRows(Boolean& moreRows)
   at Microsoft.Data.SqlClient.SqlDataReader.TryReadInternal(Boolean setTimeout, Boolean& more)
   at Microsoft.Data.SqlClient.SqlDataReader.ReadAsyncExecute(Task task, Object state)
   at Microsoft.Data.SqlClient.SqlDataReader.InvokeAsyncCall[T](SqlDataReaderBaseAsyncCallContext`1 context)
--- End of stack trace from previous location ---
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeResultSetAsync(Int32 startCommandIndex, RelationalDataReader reader, CancellationToken cancellationToken)
ClientConnectionId:0bbda166-284e-4a85-8840-74b6d5eced92
Error Number:515,State:2,Class:16
   --- End of inner exception stack trace ---
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeResultSetAsync(Int32 startCommandIndex, RelationalDataReader reader, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeAsync(RelationalDataReader reader, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Update.Internal.SqlServerModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(IList`1 entriesToSave, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(StateManager stateManager, Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Storage.Internal.SqlServerExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
Microsoft.EntityFrameworkCore.DbUpdateException: An error occurred while saving the entity changes. See the inner exception for details.
 ---> Microsoft.Data.SqlClient.SqlException (0x80131904): Cannot insert the value NULL into column 'NationalId', table 'NayifatApp.dbo.AuthLogs'; column does not allow nulls. INSERT fails.
   at Microsoft.Data.SqlClient.SqlConnection.OnError(SqlException exception, Boolean breakConnection, Action`1 wrapCloseInAction)
   at Microsoft.Data.SqlClient.SqlInternalConnection.OnError(SqlException exception, Boolean breakConnection, Action`1 wrapCloseInAction)
   at Microsoft.Data.SqlClient.TdsParser.ThrowExceptionAndWarning(TdsParserStateObject stateObj, Boolean callerHasConnectionLock, Boolean asyncClose)
   at Microsoft.Data.SqlClient.TdsParser.TryRun(RunBehavior runBehavior, SqlCommand cmdHandler, SqlDataReader dataStream, BulkCopySimpleResultSet bulkCopyHandler, TdsParserStateObject stateObj, Boolean& dataReady)
   at Microsoft.Data.SqlClient.SqlDataReader.TryHasMoreRows(Boolean& moreRows)
   at Microsoft.Data.SqlClient.SqlDataReader.TryReadInternal(Boolean setTimeout, Boolean& more)
   at Microsoft.Data.SqlClient.SqlDataReader.ReadAsyncExecute(Task task, Object state)
   at Microsoft.Data.SqlClient.SqlDataReader.InvokeAsyncCall[T](SqlDataReaderBaseAsyncCallContext`1 context)
--- End of stack trace from previous location ---
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeResultSetAsync(Int32 startCommandIndex, RelationalDataReader reader, CancellationToken cancellationToken)
ClientConnectionId:0bbda166-284e-4a85-8840-74b6d5eced92
Error Number:515,State:2,Class:16
   --- End of inner exception stack trace ---
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeResultSetAsync(Int32 startCommandIndex, RelationalDataReader reader, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeAsync(RelationalDataReader reader, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Update.Internal.SqlServerModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(IList`1 entriesToSave, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(StateManager stateManager, Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Storage.Internal.SqlServerExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
2025-01-31 22:29:53.429 +03:00 [ERR] Failed to save notification for user: 1012345678
Microsoft.EntityFrameworkCore.DbUpdateException: An error occurred while saving the entity changes. See the inner exception for details.
 ---> Microsoft.Data.SqlClient.SqlException (0x80131904): Cannot insert the value NULL into column 'NationalId', table 'NayifatApp.dbo.AuthLogs'; column does not allow nulls. INSERT fails.
   at Microsoft.Data.SqlClient.SqlConnection.OnError(SqlException exception, Boolean breakConnection, Action`1 wrapCloseInAction)
   at Microsoft.Data.SqlClient.SqlInternalConnection.OnError(SqlException exception, Boolean breakConnection, Action`1 wrapCloseInAction)
   at Microsoft.Data.SqlClient.TdsParser.ThrowExceptionAndWarning(TdsParserStateObject stateObj, Boolean callerHasConnectionLock, Boolean asyncClose)
   at Microsoft.Data.SqlClient.TdsParser.TryRun(RunBehavior runBehavior, SqlCommand cmdHandler, SqlDataReader dataStream, BulkCopySimpleResultSet bulkCopyHandler, TdsParserStateObject stateObj, Boolean& dataReady)
   at Microsoft.Data.SqlClient.SqlDataReader.TryHasMoreRows(Boolean& moreRows)
   at Microsoft.Data.SqlClient.SqlDataReader.TryReadInternal(Boolean setTimeout, Boolean& more)
   at Microsoft.Data.SqlClient.SqlDataReader.ReadAsyncExecute(Task task, Object state)
   at Microsoft.Data.SqlClient.SqlDataReader.InvokeAsyncCall[T](SqlDataReaderBaseAsyncCallContext`1 context)
--- End of stack trace from previous location ---
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeResultSetAsync(Int32 startCommandIndex, RelationalDataReader reader, CancellationToken cancellationToken)
ClientConnectionId:0bbda166-284e-4a85-8840-74b6d5eced92
Error Number:515,State:2,Class:16
   --- End of inner exception stack trace ---
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeResultSetAsync(Int32 startCommandIndex, RelationalDataReader reader, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeAsync(RelationalDataReader reader, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Update.Internal.SqlServerModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(IList`1 entriesToSave, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(StateManager stateManager, Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Storage.Internal.SqlServerExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at NayifatAPI.Controllers.NotificationsController.SendNotification(SendNotificationRequest request) in C:\Users\yamta\StudioProjects\nayifat_app_2025_new\NayifatAPI\Controllers\NotificationsController.cs:line 269
2025-01-31 22:29:53.444 +03:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType9`2[[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Object, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-01-31 22:29:53.451 +03:00 [INF] Executed action NayifatAPI.Controllers.NotificationsController.SendNotification (NayifatAPI) in 787.3611ms
2025-01-31 22:29:53.456 +03:00 [INF] Executed endpoint 'NayifatAPI.Controllers.NotificationsController.SendNotification (NayifatAPI)'
2025-01-31 22:29:53.459 +03:00 [INF] Request finished HTTP/1.1 POST http://localhost:5264/api/notifications/send - 200 null application/json; charset=utf-8 806.6234ms
2025-01-31 22:32:46.426 +03:00 [INF] Request starting HTTP/1.1 POST http://localhost:5264/api/notifications/send - application/json 216
2025-01-31 22:32:46.639 +03:00 [INF] Executing endpoint 'NayifatAPI.Controllers.NotificationsController.SendNotification (NayifatAPI)'
2025-01-31 22:32:46.640 +03:00 [INF] Route matched with {action = "SendNotification", controller = "Notifications"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] SendNotification(NayifatAPI.Controllers.SendNotificationRequest) on controller NayifatAPI.Controllers.NotificationsController (NayifatAPI).
2025-01-31 22:32:47.213 +03:00 [INF] Executed DbCommand (77ms) [Parameters=[@__providedApiKey_0='?' (Size = 255)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [a].[Key], [a].[CreatedAt], [a].[Description], [a].[ExpiresAt], [a].[IsActive], [a].[LastUsedAt]
FROM [ApiKeys] AS [a]
WHERE [a].[Key] = @__providedApiKey_0 AND [a].[IsActive] = CAST(1 AS bit)
2025-01-31 22:32:47.326 +03:00 [INF] Received notification request: {"Title":null,"TitleEn":"Test Notification","TitleAr":" ","Filters":null,"NationalId":"1012345678","NationalIds":null}
2025-01-31 22:32:47.332 +03:00 [INF] Starting GetTargetUsers with request type: Single User
2025-01-31 22:32:47.334 +03:00 [INF] Searching for single user with ID: 1012345678
2025-01-31 22:32:47.451 +03:00 [INF] Executed DbCommand (114ms) [Parameters=[@__request_NationalId_0='?' (Size = 450)], CommandType='"Text"', CommandTimeout='30']
SELECT [c].[NationalId]
FROM [Customers] AS [c]
WHERE [c].[NationalId] = @__request_NationalId_0
2025-01-31 22:32:47.688 +03:00 [INF] Target users query completed. Found 1 users
2025-01-31 22:32:47.689 +03:00 [INF] Found 1 target users for notification
2025-01-31 22:32:48.042 +03:00 [INF] Executed DbCommand (348ms) [Parameters=[@p0='?' (Size = 4000), @p1='?' (Size = 8000) (DbType = AnsiString), @p2='?' (Size = 8000) (DbType = AnsiString), @p3='?' (Size = 8000) (DbType = AnsiString), @p4='?' (DbType = DateTime2), @p5='?' (DbType = DateTime2), @p6='?' (Size = 255), @p7='?' (Size = 4000), @p8='?' (Size = 255), @p9='?' (Size = 255), @p10='?' (Size = 255)], CommandType='"Text"', CommandTimeout='30']
SET IMPLICIT_TRANSACTIONS OFF;
SET NOCOUNT ON;
INSERT INTO [notification_templates] ([additional_data], [Body], [body_ar], [body_en], [created_at], [expiry_at], [Route], [target_criteria], [Title], [title_ar], [title_en])
OUTPUT INSERTED.[Id]
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7, @p8, @p9, @p10);
2025-01-31 22:32:48.253 +03:00 [INF] Created notification template with ID: 1
2025-01-31 22:32:48.269 +03:00 [INF] Executed DbCommand (9ms) [Parameters=[@p0='?' (Size = 4000), @p1='?' (DbType = DateTime2), @p2='?' (Size = 4000), @p3='?' (Size = 4000), @p4='?' (Size = 4000), @p5='?' (Size = 450), @p6='?' (Size = 4000), @p7='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SET IMPLICIT_TRANSACTIONS OFF;
SET NOCOUNT ON;
INSERT INTO [AuthLogs] ([AuthType], [CreatedAt], [DeviceId], [FailureReason], [IpAddress], [NationalId], [Status], [UserAgent])
OUTPUT INSERTED.[Id]
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7);
2025-01-31 22:32:48.280 +03:00 [ERR] An exception occurred in the database while saving changes for context type 'NayifatAPI.Data.ApplicationDbContext'.
Microsoft.EntityFrameworkCore.DbUpdateException: An error occurred while saving the entity changes. See the inner exception for details.
 ---> Microsoft.Data.SqlClient.SqlException (0x80131904): Cannot insert the value NULL into column 'NationalId', table 'NayifatApp.dbo.AuthLogs'; column does not allow nulls. INSERT fails.
   at Microsoft.Data.SqlClient.SqlConnection.OnError(SqlException exception, Boolean breakConnection, Action`1 wrapCloseInAction)
   at Microsoft.Data.SqlClient.SqlInternalConnection.OnError(SqlException exception, Boolean breakConnection, Action`1 wrapCloseInAction)
   at Microsoft.Data.SqlClient.TdsParser.ThrowExceptionAndWarning(TdsParserStateObject stateObj, Boolean callerHasConnectionLock, Boolean asyncClose)
   at Microsoft.Data.SqlClient.TdsParser.TryRun(RunBehavior runBehavior, SqlCommand cmdHandler, SqlDataReader dataStream, BulkCopySimpleResultSet bulkCopyHandler, TdsParserStateObject stateObj, Boolean& dataReady)
   at Microsoft.Data.SqlClient.SqlDataReader.TryHasMoreRows(Boolean& moreRows)
   at Microsoft.Data.SqlClient.SqlDataReader.TryReadInternal(Boolean setTimeout, Boolean& more)
   at Microsoft.Data.SqlClient.SqlDataReader.ReadAsyncExecute(Task task, Object state)
   at Microsoft.Data.SqlClient.SqlDataReader.InvokeAsyncCall[T](SqlDataReaderBaseAsyncCallContext`1 context)
--- End of stack trace from previous location ---
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeResultSetAsync(Int32 startCommandIndex, RelationalDataReader reader, CancellationToken cancellationToken)
ClientConnectionId:0bbda166-284e-4a85-8840-74b6d5eced92
Error Number:515,State:2,Class:16
   --- End of inner exception stack trace ---
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeResultSetAsync(Int32 startCommandIndex, RelationalDataReader reader, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeAsync(RelationalDataReader reader, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Update.Internal.SqlServerModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(IList`1 entriesToSave, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(StateManager stateManager, Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Storage.Internal.SqlServerExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
Microsoft.EntityFrameworkCore.DbUpdateException: An error occurred while saving the entity changes. See the inner exception for details.
 ---> Microsoft.Data.SqlClient.SqlException (0x80131904): Cannot insert the value NULL into column 'NationalId', table 'NayifatApp.dbo.AuthLogs'; column does not allow nulls. INSERT fails.
   at Microsoft.Data.SqlClient.SqlConnection.OnError(SqlException exception, Boolean breakConnection, Action`1 wrapCloseInAction)
   at Microsoft.Data.SqlClient.SqlInternalConnection.OnError(SqlException exception, Boolean breakConnection, Action`1 wrapCloseInAction)
   at Microsoft.Data.SqlClient.TdsParser.ThrowExceptionAndWarning(TdsParserStateObject stateObj, Boolean callerHasConnectionLock, Boolean asyncClose)
   at Microsoft.Data.SqlClient.TdsParser.TryRun(RunBehavior runBehavior, SqlCommand cmdHandler, SqlDataReader dataStream, BulkCopySimpleResultSet bulkCopyHandler, TdsParserStateObject stateObj, Boolean& dataReady)
   at Microsoft.Data.SqlClient.SqlDataReader.TryHasMoreRows(Boolean& moreRows)
   at Microsoft.Data.SqlClient.SqlDataReader.TryReadInternal(Boolean setTimeout, Boolean& more)
   at Microsoft.Data.SqlClient.SqlDataReader.ReadAsyncExecute(Task task, Object state)
   at Microsoft.Data.SqlClient.SqlDataReader.InvokeAsyncCall[T](SqlDataReaderBaseAsyncCallContext`1 context)
--- End of stack trace from previous location ---
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeResultSetAsync(Int32 startCommandIndex, RelationalDataReader reader, CancellationToken cancellationToken)
ClientConnectionId:0bbda166-284e-4a85-8840-74b6d5eced92
Error Number:515,State:2,Class:16
   --- End of inner exception stack trace ---
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeResultSetAsync(Int32 startCommandIndex, RelationalDataReader reader, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeAsync(RelationalDataReader reader, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Update.Internal.SqlServerModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(IList`1 entriesToSave, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(StateManager stateManager, Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Storage.Internal.SqlServerExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
2025-01-31 22:32:48.315 +03:00 [ERR] Error logging audit event. NationalId: null, Action: notification_sent, Details: {"template_id":1,"recipient_count":1,"target_criteria":null,"timestamp":"2025-01-31T19:32:47.691497Z"}
Microsoft.EntityFrameworkCore.DbUpdateException: An error occurred while saving the entity changes. See the inner exception for details.
 ---> Microsoft.Data.SqlClient.SqlException (0x80131904): Cannot insert the value NULL into column 'NationalId', table 'NayifatApp.dbo.AuthLogs'; column does not allow nulls. INSERT fails.
   at Microsoft.Data.SqlClient.SqlConnection.OnError(SqlException exception, Boolean breakConnection, Action`1 wrapCloseInAction)
   at Microsoft.Data.SqlClient.SqlInternalConnection.OnError(SqlException exception, Boolean breakConnection, Action`1 wrapCloseInAction)
   at Microsoft.Data.SqlClient.TdsParser.ThrowExceptionAndWarning(TdsParserStateObject stateObj, Boolean callerHasConnectionLock, Boolean asyncClose)
   at Microsoft.Data.SqlClient.TdsParser.TryRun(RunBehavior runBehavior, SqlCommand cmdHandler, SqlDataReader dataStream, BulkCopySimpleResultSet bulkCopyHandler, TdsParserStateObject stateObj, Boolean& dataReady)
   at Microsoft.Data.SqlClient.SqlDataReader.TryHasMoreRows(Boolean& moreRows)
   at Microsoft.Data.SqlClient.SqlDataReader.TryReadInternal(Boolean setTimeout, Boolean& more)
   at Microsoft.Data.SqlClient.SqlDataReader.ReadAsyncExecute(Task task, Object state)
   at Microsoft.Data.SqlClient.SqlDataReader.InvokeAsyncCall[T](SqlDataReaderBaseAsyncCallContext`1 context)
--- End of stack trace from previous location ---
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeResultSetAsync(Int32 startCommandIndex, RelationalDataReader reader, CancellationToken cancellationToken)
ClientConnectionId:0bbda166-284e-4a85-8840-74b6d5eced92
Error Number:515,State:2,Class:16
   --- End of inner exception stack trace ---
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeResultSetAsync(Int32 startCommandIndex, RelationalDataReader reader, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeAsync(RelationalDataReader reader, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Update.Internal.SqlServerModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(IList`1 entriesToSave, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(StateManager stateManager, Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Storage.Internal.SqlServerExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at NayifatAPI.Services.AuditLogService.LogAsync(String nationalId, String action, Object details) in C:\Users\yamta\StudioProjects\nayifat_app_2025_new\NayifatAPI\Services\AuditLogService.cs:line 36
2025-01-31 22:32:48.339 +03:00 [INF] Executed DbCommand (2ms) [Parameters=[@__userId_0='?' (Size = 450)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [u].[national_id], [u].[last_updated], [u].[notifications]
FROM [user_notifications] AS [u]
WHERE [u].[national_id] = @__userId_0
2025-01-31 22:32:48.348 +03:00 [INF] Created new notifications entry for user: 1012345678
2025-01-31 22:32:48.358 +03:00 [INF] Executed DbCommand (5ms) [Parameters=[@p0='?' (Size = 4000), @p1='?' (DbType = DateTime2), @p2='?' (Size = 4000), @p3='?' (Size = 4000), @p4='?' (Size = 4000), @p5='?' (Size = 450), @p6='?' (Size = 4000), @p7='?' (Size = 4000), @p8='?' (Size = 450), @p9='?' (DbType = DateTime2), @p10='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SET NOCOUNT ON;
INSERT INTO [AuthLogs] ([AuthType], [CreatedAt], [DeviceId], [FailureReason], [IpAddress], [NationalId], [Status], [UserAgent])
OUTPUT INSERTED.[Id]
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7);
INSERT INTO [user_notifications] ([national_id], [last_updated], [notifications])
VALUES (@p8, @p9, @p10);
2025-01-31 22:32:48.369 +03:00 [ERR] An exception occurred in the database while saving changes for context type 'NayifatAPI.Data.ApplicationDbContext'.
Microsoft.EntityFrameworkCore.DbUpdateException: An error occurred while saving the entity changes. See the inner exception for details.
 ---> Microsoft.Data.SqlClient.SqlException (0x80131904): Cannot insert the value NULL into column 'NationalId', table 'NayifatApp.dbo.AuthLogs'; column does not allow nulls. INSERT fails.
   at Microsoft.Data.SqlClient.SqlConnection.OnError(SqlException exception, Boolean breakConnection, Action`1 wrapCloseInAction)
   at Microsoft.Data.SqlClient.SqlInternalConnection.OnError(SqlException exception, Boolean breakConnection, Action`1 wrapCloseInAction)
   at Microsoft.Data.SqlClient.TdsParser.ThrowExceptionAndWarning(TdsParserStateObject stateObj, Boolean callerHasConnectionLock, Boolean asyncClose)
   at Microsoft.Data.SqlClient.TdsParser.TryRun(RunBehavior runBehavior, SqlCommand cmdHandler, SqlDataReader dataStream, BulkCopySimpleResultSet bulkCopyHandler, TdsParserStateObject stateObj, Boolean& dataReady)
   at Microsoft.Data.SqlClient.SqlDataReader.TryHasMoreRows(Boolean& moreRows)
   at Microsoft.Data.SqlClient.SqlDataReader.TryReadInternal(Boolean setTimeout, Boolean& more)
   at Microsoft.Data.SqlClient.SqlDataReader.ReadAsyncExecute(Task task, Object state)
   at Microsoft.Data.SqlClient.SqlDataReader.InvokeAsyncCall[T](SqlDataReaderBaseAsyncCallContext`1 context)
--- End of stack trace from previous location ---
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeResultSetAsync(Int32 startCommandIndex, RelationalDataReader reader, CancellationToken cancellationToken)
ClientConnectionId:0bbda166-284e-4a85-8840-74b6d5eced92
Error Number:515,State:2,Class:16
   --- End of inner exception stack trace ---
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeResultSetAsync(Int32 startCommandIndex, RelationalDataReader reader, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeAsync(RelationalDataReader reader, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Update.Internal.SqlServerModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(IList`1 entriesToSave, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(StateManager stateManager, Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Storage.Internal.SqlServerExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
Microsoft.EntityFrameworkCore.DbUpdateException: An error occurred while saving the entity changes. See the inner exception for details.
 ---> Microsoft.Data.SqlClient.SqlException (0x80131904): Cannot insert the value NULL into column 'NationalId', table 'NayifatApp.dbo.AuthLogs'; column does not allow nulls. INSERT fails.
   at Microsoft.Data.SqlClient.SqlConnection.OnError(SqlException exception, Boolean breakConnection, Action`1 wrapCloseInAction)
   at Microsoft.Data.SqlClient.SqlInternalConnection.OnError(SqlException exception, Boolean breakConnection, Action`1 wrapCloseInAction)
   at Microsoft.Data.SqlClient.TdsParser.ThrowExceptionAndWarning(TdsParserStateObject stateObj, Boolean callerHasConnectionLock, Boolean asyncClose)
   at Microsoft.Data.SqlClient.TdsParser.TryRun(RunBehavior runBehavior, SqlCommand cmdHandler, SqlDataReader dataStream, BulkCopySimpleResultSet bulkCopyHandler, TdsParserStateObject stateObj, Boolean& dataReady)
   at Microsoft.Data.SqlClient.SqlDataReader.TryHasMoreRows(Boolean& moreRows)
   at Microsoft.Data.SqlClient.SqlDataReader.TryReadInternal(Boolean setTimeout, Boolean& more)
   at Microsoft.Data.SqlClient.SqlDataReader.ReadAsyncExecute(Task task, Object state)
   at Microsoft.Data.SqlClient.SqlDataReader.InvokeAsyncCall[T](SqlDataReaderBaseAsyncCallContext`1 context)
--- End of stack trace from previous location ---
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeResultSetAsync(Int32 startCommandIndex, RelationalDataReader reader, CancellationToken cancellationToken)
ClientConnectionId:0bbda166-284e-4a85-8840-74b6d5eced92
Error Number:515,State:2,Class:16
   --- End of inner exception stack trace ---
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeResultSetAsync(Int32 startCommandIndex, RelationalDataReader reader, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeAsync(RelationalDataReader reader, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Update.Internal.SqlServerModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(IList`1 entriesToSave, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(StateManager stateManager, Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Storage.Internal.SqlServerExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
2025-01-31 22:32:48.389 +03:00 [ERR] Failed to save notification for user: 1012345678
Microsoft.EntityFrameworkCore.DbUpdateException: An error occurred while saving the entity changes. See the inner exception for details.
 ---> Microsoft.Data.SqlClient.SqlException (0x80131904): Cannot insert the value NULL into column 'NationalId', table 'NayifatApp.dbo.AuthLogs'; column does not allow nulls. INSERT fails.
   at Microsoft.Data.SqlClient.SqlConnection.OnError(SqlException exception, Boolean breakConnection, Action`1 wrapCloseInAction)
   at Microsoft.Data.SqlClient.SqlInternalConnection.OnError(SqlException exception, Boolean breakConnection, Action`1 wrapCloseInAction)
   at Microsoft.Data.SqlClient.TdsParser.ThrowExceptionAndWarning(TdsParserStateObject stateObj, Boolean callerHasConnectionLock, Boolean asyncClose)
   at Microsoft.Data.SqlClient.TdsParser.TryRun(RunBehavior runBehavior, SqlCommand cmdHandler, SqlDataReader dataStream, BulkCopySimpleResultSet bulkCopyHandler, TdsParserStateObject stateObj, Boolean& dataReady)
   at Microsoft.Data.SqlClient.SqlDataReader.TryHasMoreRows(Boolean& moreRows)
   at Microsoft.Data.SqlClient.SqlDataReader.TryReadInternal(Boolean setTimeout, Boolean& more)
   at Microsoft.Data.SqlClient.SqlDataReader.ReadAsyncExecute(Task task, Object state)
   at Microsoft.Data.SqlClient.SqlDataReader.InvokeAsyncCall[T](SqlDataReaderBaseAsyncCallContext`1 context)
--- End of stack trace from previous location ---
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeResultSetAsync(Int32 startCommandIndex, RelationalDataReader reader, CancellationToken cancellationToken)
ClientConnectionId:0bbda166-284e-4a85-8840-74b6d5eced92
Error Number:515,State:2,Class:16
   --- End of inner exception stack trace ---
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeResultSetAsync(Int32 startCommandIndex, RelationalDataReader reader, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeAsync(RelationalDataReader reader, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Update.Internal.SqlServerModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(IList`1 entriesToSave, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(StateManager stateManager, Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Storage.Internal.SqlServerExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at NayifatAPI.Controllers.NotificationsController.SendNotification(SendNotificationRequest request) in C:\Users\yamta\StudioProjects\nayifat_app_2025_new\NayifatAPI\Controllers\NotificationsController.cs:line 269
2025-01-31 22:32:48.407 +03:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType9`2[[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Object, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-01-31 22:32:48.409 +03:00 [INF] Executed action NayifatAPI.Controllers.NotificationsController.SendNotification (NayifatAPI) in 1468.9618ms
2025-01-31 22:32:48.414 +03:00 [INF] Executed endpoint 'NayifatAPI.Controllers.NotificationsController.SendNotification (NayifatAPI)'
2025-01-31 22:32:48.416 +03:00 [INF] Request finished HTTP/1.1 POST http://localhost:5264/api/notifications/send - 200 null application/json; charset=utf-8 1990.2409ms
2025-01-31 22:34:19.934 +03:00 [INF] Application is shutting down...
2025-01-31 22:34:36.494 +03:00 [INF] Starting web application
2025-01-31 22:34:36.618 +03:00 [INF] Now listening on: http://localhost:5264
2025-01-31 22:34:36.623 +03:00 [INF] Application started. Press Ctrl+C to shut down.
2025-01-31 22:34:36.624 +03:00 [INF] Hosting environment: Development
2025-01-31 22:34:36.625 +03:00 [INF] Content root path: C:\Users\yamta\StudioProjects\nayifat_app_2025_new\NayifatAPI
2025-01-31 22:34:42.769 +03:00 [INF] Request starting HTTP/1.1 POST http://localhost:5264/api/notifications/send - application/json 216
2025-01-31 22:34:42.834 +03:00 [WRN] Failed to determine the https port for redirect.
2025-01-31 22:34:42.840 +03:00 [INF] Executing endpoint 'NayifatAPI.Controllers.NotificationsController.SendNotification (NayifatAPI)'
2025-01-31 22:34:42.879 +03:00 [INF] Route matched with {action = "SendNotification", controller = "Notifications"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] SendNotification(NayifatAPI.Controllers.SendNotificationRequest) on controller NayifatAPI.Controllers.NotificationsController (NayifatAPI).
2025-01-31 22:34:44.571 +03:00 [INF] Executed DbCommand (36ms) [Parameters=[@__providedApiKey_0='?' (Size = 255)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [a].[Key], [a].[CreatedAt], [a].[Description], [a].[ExpiresAt], [a].[IsActive], [a].[LastUsedAt]
FROM [ApiKeys] AS [a]
WHERE [a].[Key] = @__providedApiKey_0 AND [a].[IsActive] = CAST(1 AS bit)
2025-01-31 22:34:44.660 +03:00 [INF] Received notification request: {"Title":null,"TitleEn":"Test Notification","TitleAr":" ","Filters":null,"NationalId":"1012345678","NationalIds":null}
2025-01-31 22:34:44.674 +03:00 [INF] Starting GetTargetUsers with request type: Single User
2025-01-31 22:34:44.674 +03:00 [INF] Searching for single user with ID: 1012345678
2025-01-31 22:34:44.688 +03:00 [INF] Generated SQL Query: DECLARE @__request_NationalId_0 nvarchar(450) = N'1012345678';

SELECT [c].[NationalId], [c].[AddNo], [c].[BuildingNo], [c].[City], [c].[Consent], [c].[ConsentDate], [c].[DateOfBirth], [c].[Dependents], [c].[District], [c].[Email], [c].[Employer], [c].[EmployerName], [c].[EmploymentStatus], [c].[FamilyNameAr], [c].[FamilyNameEn], [c].[FirstNameAr], [c].[FirstNameEn], [c].[Iban], [c].[IdExpiryDate], [c].[Language], [c].[Los], [c].[Mpin], [c].[MpinEnabled], [c].[NafathStatus], [c].[NafathTimestamp], [c].[Password], [c].[Phone], [c].[RegistrationDate], [c].[Salary], [c].[SalaryCustomer], [c].[SalaryDakhli], [c].[SecondNameAr], [c].[SecondNameEn], [c].[Sector], [c].[Street], [c].[ThirdNameAr], [c].[ThirdNameEn], [c].[Zipcode]
FROM [Customers] AS [c]
WHERE [c].[NationalId] = @__request_NationalId_0
2025-01-31 22:34:44.778 +03:00 [INF] Executed DbCommand (23ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT COUNT(*)
FROM [Customers] AS [c]
2025-01-31 22:34:44.793 +03:00 [INF] Total customers in database: 6
2025-01-31 22:34:44.814 +03:00 [INF] Executed DbCommand (4ms) [Parameters=[@__request_NationalId_0='?' (Size = 450)], CommandType='"Text"', CommandTimeout='30']
SELECT [c].[NationalId]
FROM [Customers] AS [c]
WHERE [c].[NationalId] = @__request_NationalId_0
2025-01-31 22:34:44.821 +03:00 [INF] Found 1 users matching national ID 1012345678
2025-01-31 22:34:44.823 +03:00 [INF] Target users query completed. Found 1 users
2025-01-31 22:34:44.824 +03:00 [INF] Found 1 target users for notification
2025-01-31 22:34:45.047 +03:00 [INF] Executed DbCommand (77ms) [Parameters=[@p0='?' (Size = 4000), @p1='?' (Size = 8000) (DbType = AnsiString), @p2='?' (Size = 8000) (DbType = AnsiString), @p3='?' (Size = 8000) (DbType = AnsiString), @p4='?' (DbType = DateTime2), @p5='?' (DbType = DateTime2), @p6='?' (Size = 255), @p7='?' (Size = 4000), @p8='?' (Size = 255), @p9='?' (Size = 255), @p10='?' (Size = 255)], CommandType='"Text"', CommandTimeout='30']
SET IMPLICIT_TRANSACTIONS OFF;
SET NOCOUNT ON;
INSERT INTO [notification_templates] ([additional_data], [Body], [body_ar], [body_en], [created_at], [expiry_at], [Route], [target_criteria], [Title], [title_ar], [title_en])
OUTPUT INSERTED.[Id]
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7, @p8, @p9, @p10);
2025-01-31 22:34:45.078 +03:00 [INF] Created notification template with ID: 2
2025-01-31 22:34:45.135 +03:00 [INF] Executed DbCommand (5ms) [Parameters=[@p0='?' (Size = 4000), @p1='?' (DbType = DateTime2), @p2='?' (Size = 4000), @p3='?' (Size = 4000), @p4='?' (Size = 4000), @p5='?' (Size = 450), @p6='?' (Size = 4000), @p7='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SET IMPLICIT_TRANSACTIONS OFF;
SET NOCOUNT ON;
INSERT INTO [AuthLogs] ([AuthType], [CreatedAt], [DeviceId], [FailureReason], [IpAddress], [NationalId], [Status], [UserAgent])
OUTPUT INSERTED.[Id]
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7);
2025-01-31 22:34:45.157 +03:00 [ERR] An exception occurred in the database while saving changes for context type 'NayifatAPI.Data.ApplicationDbContext'.
Microsoft.EntityFrameworkCore.DbUpdateException: An error occurred while saving the entity changes. See the inner exception for details.
 ---> Microsoft.Data.SqlClient.SqlException (0x80131904): Cannot insert the value NULL into column 'NationalId', table 'NayifatApp.dbo.AuthLogs'; column does not allow nulls. INSERT fails.
   at Microsoft.Data.SqlClient.SqlConnection.OnError(SqlException exception, Boolean breakConnection, Action`1 wrapCloseInAction)
   at Microsoft.Data.SqlClient.SqlInternalConnection.OnError(SqlException exception, Boolean breakConnection, Action`1 wrapCloseInAction)
   at Microsoft.Data.SqlClient.TdsParser.ThrowExceptionAndWarning(TdsParserStateObject stateObj, Boolean callerHasConnectionLock, Boolean asyncClose)
   at Microsoft.Data.SqlClient.TdsParser.TryRun(RunBehavior runBehavior, SqlCommand cmdHandler, SqlDataReader dataStream, BulkCopySimpleResultSet bulkCopyHandler, TdsParserStateObject stateObj, Boolean& dataReady)
   at Microsoft.Data.SqlClient.SqlDataReader.TryHasMoreRows(Boolean& moreRows)
   at Microsoft.Data.SqlClient.SqlDataReader.TryReadInternal(Boolean setTimeout, Boolean& more)
   at Microsoft.Data.SqlClient.SqlDataReader.ReadAsyncExecute(Task task, Object state)
   at Microsoft.Data.SqlClient.SqlDataReader.InvokeAsyncCall[T](SqlDataReaderBaseAsyncCallContext`1 context)
--- End of stack trace from previous location ---
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeResultSetAsync(Int32 startCommandIndex, RelationalDataReader reader, CancellationToken cancellationToken)
ClientConnectionId:96c8faf9-d4ea-4849-afd3-a43420f95ef8
Error Number:515,State:2,Class:16
   --- End of inner exception stack trace ---
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeResultSetAsync(Int32 startCommandIndex, RelationalDataReader reader, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeAsync(RelationalDataReader reader, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Update.Internal.SqlServerModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(IList`1 entriesToSave, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(StateManager stateManager, Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Storage.Internal.SqlServerExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
Microsoft.EntityFrameworkCore.DbUpdateException: An error occurred while saving the entity changes. See the inner exception for details.
 ---> Microsoft.Data.SqlClient.SqlException (0x80131904): Cannot insert the value NULL into column 'NationalId', table 'NayifatApp.dbo.AuthLogs'; column does not allow nulls. INSERT fails.
   at Microsoft.Data.SqlClient.SqlConnection.OnError(SqlException exception, Boolean breakConnection, Action`1 wrapCloseInAction)
   at Microsoft.Data.SqlClient.SqlInternalConnection.OnError(SqlException exception, Boolean breakConnection, Action`1 wrapCloseInAction)
   at Microsoft.Data.SqlClient.TdsParser.ThrowExceptionAndWarning(TdsParserStateObject stateObj, Boolean callerHasConnectionLock, Boolean asyncClose)
   at Microsoft.Data.SqlClient.TdsParser.TryRun(RunBehavior runBehavior, SqlCommand cmdHandler, SqlDataReader dataStream, BulkCopySimpleResultSet bulkCopyHandler, TdsParserStateObject stateObj, Boolean& dataReady)
   at Microsoft.Data.SqlClient.SqlDataReader.TryHasMoreRows(Boolean& moreRows)
   at Microsoft.Data.SqlClient.SqlDataReader.TryReadInternal(Boolean setTimeout, Boolean& more)
   at Microsoft.Data.SqlClient.SqlDataReader.ReadAsyncExecute(Task task, Object state)
   at Microsoft.Data.SqlClient.SqlDataReader.InvokeAsyncCall[T](SqlDataReaderBaseAsyncCallContext`1 context)
--- End of stack trace from previous location ---
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeResultSetAsync(Int32 startCommandIndex, RelationalDataReader reader, CancellationToken cancellationToken)
ClientConnectionId:96c8faf9-d4ea-4849-afd3-a43420f95ef8
Error Number:515,State:2,Class:16
   --- End of inner exception stack trace ---
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeResultSetAsync(Int32 startCommandIndex, RelationalDataReader reader, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeAsync(RelationalDataReader reader, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Update.Internal.SqlServerModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(IList`1 entriesToSave, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(StateManager stateManager, Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Storage.Internal.SqlServerExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
2025-01-31 22:34:45.187 +03:00 [ERR] Error logging audit event. NationalId: null, Action: notification_sent, Details: {"template_id":2,"recipient_count":1,"target_criteria":null,"timestamp":"2025-01-31T19:34:44.8258448Z"}
Microsoft.EntityFrameworkCore.DbUpdateException: An error occurred while saving the entity changes. See the inner exception for details.
 ---> Microsoft.Data.SqlClient.SqlException (0x80131904): Cannot insert the value NULL into column 'NationalId', table 'NayifatApp.dbo.AuthLogs'; column does not allow nulls. INSERT fails.
   at Microsoft.Data.SqlClient.SqlConnection.OnError(SqlException exception, Boolean breakConnection, Action`1 wrapCloseInAction)
   at Microsoft.Data.SqlClient.SqlInternalConnection.OnError(SqlException exception, Boolean breakConnection, Action`1 wrapCloseInAction)
   at Microsoft.Data.SqlClient.TdsParser.ThrowExceptionAndWarning(TdsParserStateObject stateObj, Boolean callerHasConnectionLock, Boolean asyncClose)
   at Microsoft.Data.SqlClient.TdsParser.TryRun(RunBehavior runBehavior, SqlCommand cmdHandler, SqlDataReader dataStream, BulkCopySimpleResultSet bulkCopyHandler, TdsParserStateObject stateObj, Boolean& dataReady)
   at Microsoft.Data.SqlClient.SqlDataReader.TryHasMoreRows(Boolean& moreRows)
   at Microsoft.Data.SqlClient.SqlDataReader.TryReadInternal(Boolean setTimeout, Boolean& more)
   at Microsoft.Data.SqlClient.SqlDataReader.ReadAsyncExecute(Task task, Object state)
   at Microsoft.Data.SqlClient.SqlDataReader.InvokeAsyncCall[T](SqlDataReaderBaseAsyncCallContext`1 context)
--- End of stack trace from previous location ---
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeResultSetAsync(Int32 startCommandIndex, RelationalDataReader reader, CancellationToken cancellationToken)
ClientConnectionId:96c8faf9-d4ea-4849-afd3-a43420f95ef8
Error Number:515,State:2,Class:16
   --- End of inner exception stack trace ---
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeResultSetAsync(Int32 startCommandIndex, RelationalDataReader reader, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeAsync(RelationalDataReader reader, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Update.Internal.SqlServerModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(IList`1 entriesToSave, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(StateManager stateManager, Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Storage.Internal.SqlServerExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at NayifatAPI.Services.AuditLogService.LogAsync(String nationalId, String action, Object details) in C:\Users\yamta\StudioProjects\nayifat_app_2025_new\NayifatAPI\Services\AuditLogService.cs:line 36
2025-01-31 22:34:45.229 +03:00 [INF] Executed DbCommand (2ms) [Parameters=[@__userId_0='?' (Size = 450)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [u].[national_id], [u].[last_updated], [u].[notifications]
FROM [user_notifications] AS [u]
WHERE [u].[national_id] = @__userId_0
2025-01-31 22:34:45.248 +03:00 [INF] Created new notifications entry for user: 1012345678
2025-01-31 22:34:45.275 +03:00 [INF] Executed DbCommand (4ms) [Parameters=[@p0='?' (Size = 4000), @p1='?' (DbType = DateTime2), @p2='?' (Size = 4000), @p3='?' (Size = 4000), @p4='?' (Size = 4000), @p5='?' (Size = 450), @p6='?' (Size = 4000), @p7='?' (Size = 4000), @p8='?' (Size = 450), @p9='?' (DbType = DateTime2), @p10='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SET NOCOUNT ON;
INSERT INTO [AuthLogs] ([AuthType], [CreatedAt], [DeviceId], [FailureReason], [IpAddress], [NationalId], [Status], [UserAgent])
OUTPUT INSERTED.[Id]
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7);
INSERT INTO [user_notifications] ([national_id], [last_updated], [notifications])
VALUES (@p8, @p9, @p10);
2025-01-31 22:34:45.286 +03:00 [ERR] An exception occurred in the database while saving changes for context type 'NayifatAPI.Data.ApplicationDbContext'.
Microsoft.EntityFrameworkCore.DbUpdateException: An error occurred while saving the entity changes. See the inner exception for details.
 ---> Microsoft.Data.SqlClient.SqlException (0x80131904): Cannot insert the value NULL into column 'NationalId', table 'NayifatApp.dbo.AuthLogs'; column does not allow nulls. INSERT fails.
   at Microsoft.Data.SqlClient.SqlConnection.OnError(SqlException exception, Boolean breakConnection, Action`1 wrapCloseInAction)
   at Microsoft.Data.SqlClient.SqlInternalConnection.OnError(SqlException exception, Boolean breakConnection, Action`1 wrapCloseInAction)
   at Microsoft.Data.SqlClient.TdsParser.ThrowExceptionAndWarning(TdsParserStateObject stateObj, Boolean callerHasConnectionLock, Boolean asyncClose)
   at Microsoft.Data.SqlClient.TdsParser.TryRun(RunBehavior runBehavior, SqlCommand cmdHandler, SqlDataReader dataStream, BulkCopySimpleResultSet bulkCopyHandler, TdsParserStateObject stateObj, Boolean& dataReady)
   at Microsoft.Data.SqlClient.SqlDataReader.TryHasMoreRows(Boolean& moreRows)
   at Microsoft.Data.SqlClient.SqlDataReader.TryReadInternal(Boolean setTimeout, Boolean& more)
   at Microsoft.Data.SqlClient.SqlDataReader.ReadAsyncExecute(Task task, Object state)
   at Microsoft.Data.SqlClient.SqlDataReader.InvokeAsyncCall[T](SqlDataReaderBaseAsyncCallContext`1 context)
--- End of stack trace from previous location ---
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeResultSetAsync(Int32 startCommandIndex, RelationalDataReader reader, CancellationToken cancellationToken)
ClientConnectionId:96c8faf9-d4ea-4849-afd3-a43420f95ef8
Error Number:515,State:2,Class:16
   --- End of inner exception stack trace ---
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeResultSetAsync(Int32 startCommandIndex, RelationalDataReader reader, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeAsync(RelationalDataReader reader, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Update.Internal.SqlServerModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(IList`1 entriesToSave, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(StateManager stateManager, Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Storage.Internal.SqlServerExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
Microsoft.EntityFrameworkCore.DbUpdateException: An error occurred while saving the entity changes. See the inner exception for details.
 ---> Microsoft.Data.SqlClient.SqlException (0x80131904): Cannot insert the value NULL into column 'NationalId', table 'NayifatApp.dbo.AuthLogs'; column does not allow nulls. INSERT fails.
   at Microsoft.Data.SqlClient.SqlConnection.OnError(SqlException exception, Boolean breakConnection, Action`1 wrapCloseInAction)
   at Microsoft.Data.SqlClient.SqlInternalConnection.OnError(SqlException exception, Boolean breakConnection, Action`1 wrapCloseInAction)
   at Microsoft.Data.SqlClient.TdsParser.ThrowExceptionAndWarning(TdsParserStateObject stateObj, Boolean callerHasConnectionLock, Boolean asyncClose)
   at Microsoft.Data.SqlClient.TdsParser.TryRun(RunBehavior runBehavior, SqlCommand cmdHandler, SqlDataReader dataStream, BulkCopySimpleResultSet bulkCopyHandler, TdsParserStateObject stateObj, Boolean& dataReady)
   at Microsoft.Data.SqlClient.SqlDataReader.TryHasMoreRows(Boolean& moreRows)
   at Microsoft.Data.SqlClient.SqlDataReader.TryReadInternal(Boolean setTimeout, Boolean& more)
   at Microsoft.Data.SqlClient.SqlDataReader.ReadAsyncExecute(Task task, Object state)
   at Microsoft.Data.SqlClient.SqlDataReader.InvokeAsyncCall[T](SqlDataReaderBaseAsyncCallContext`1 context)
--- End of stack trace from previous location ---
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeResultSetAsync(Int32 startCommandIndex, RelationalDataReader reader, CancellationToken cancellationToken)
ClientConnectionId:96c8faf9-d4ea-4849-afd3-a43420f95ef8
Error Number:515,State:2,Class:16
   --- End of inner exception stack trace ---
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeResultSetAsync(Int32 startCommandIndex, RelationalDataReader reader, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeAsync(RelationalDataReader reader, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Update.Internal.SqlServerModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(IList`1 entriesToSave, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(StateManager stateManager, Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Storage.Internal.SqlServerExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
2025-01-31 22:34:45.301 +03:00 [ERR] Failed to save notification for user: 1012345678
Microsoft.EntityFrameworkCore.DbUpdateException: An error occurred while saving the entity changes. See the inner exception for details.
 ---> Microsoft.Data.SqlClient.SqlException (0x80131904): Cannot insert the value NULL into column 'NationalId', table 'NayifatApp.dbo.AuthLogs'; column does not allow nulls. INSERT fails.
   at Microsoft.Data.SqlClient.SqlConnection.OnError(SqlException exception, Boolean breakConnection, Action`1 wrapCloseInAction)
   at Microsoft.Data.SqlClient.SqlInternalConnection.OnError(SqlException exception, Boolean breakConnection, Action`1 wrapCloseInAction)
   at Microsoft.Data.SqlClient.TdsParser.ThrowExceptionAndWarning(TdsParserStateObject stateObj, Boolean callerHasConnectionLock, Boolean asyncClose)
   at Microsoft.Data.SqlClient.TdsParser.TryRun(RunBehavior runBehavior, SqlCommand cmdHandler, SqlDataReader dataStream, BulkCopySimpleResultSet bulkCopyHandler, TdsParserStateObject stateObj, Boolean& dataReady)
   at Microsoft.Data.SqlClient.SqlDataReader.TryHasMoreRows(Boolean& moreRows)
   at Microsoft.Data.SqlClient.SqlDataReader.TryReadInternal(Boolean setTimeout, Boolean& more)
   at Microsoft.Data.SqlClient.SqlDataReader.ReadAsyncExecute(Task task, Object state)
   at Microsoft.Data.SqlClient.SqlDataReader.InvokeAsyncCall[T](SqlDataReaderBaseAsyncCallContext`1 context)
--- End of stack trace from previous location ---
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeResultSetAsync(Int32 startCommandIndex, RelationalDataReader reader, CancellationToken cancellationToken)
ClientConnectionId:96c8faf9-d4ea-4849-afd3-a43420f95ef8
Error Number:515,State:2,Class:16
   --- End of inner exception stack trace ---
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeResultSetAsync(Int32 startCommandIndex, RelationalDataReader reader, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeAsync(RelationalDataReader reader, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Update.Internal.SqlServerModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(IList`1 entriesToSave, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(StateManager stateManager, Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Storage.Internal.SqlServerExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at NayifatAPI.Controllers.NotificationsController.SendNotification(SendNotificationRequest request) in C:\Users\yamta\StudioProjects\nayifat_app_2025_new\NayifatAPI\Controllers\NotificationsController.cs:line 269
2025-01-31 22:34:45.325 +03:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType9`2[[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Object, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-01-31 22:34:45.346 +03:00 [INF] Executed action NayifatAPI.Controllers.NotificationsController.SendNotification (NayifatAPI) in 2460.4285ms
2025-01-31 22:34:45.351 +03:00 [INF] Executed endpoint 'NayifatAPI.Controllers.NotificationsController.SendNotification (NayifatAPI)'
2025-01-31 22:34:45.370 +03:00 [INF] Request finished HTTP/1.1 POST http://localhost:5264/api/notifications/send - 200 null application/json; charset=utf-8 2603.5721ms
2025-01-31 22:35:37.384 +03:00 [INF] Application is shutting down...
2025-01-31 22:35:47.352 +03:00 [INF] Starting web application
2025-01-31 22:35:47.454 +03:00 [INF] Now listening on: http://localhost:5264
2025-01-31 22:35:47.458 +03:00 [INF] Application started. Press Ctrl+C to shut down.
2025-01-31 22:35:47.459 +03:00 [INF] Hosting environment: Development
2025-01-31 22:35:47.460 +03:00 [INF] Content root path: C:\Users\yamta\StudioProjects\nayifat_app_2025_new\NayifatAPI
2025-01-31 22:36:30.165 +03:00 [INF] Request starting HTTP/1.1 POST http://localhost:5264/api/notifications/send - application/json 216
2025-01-31 22:36:30.218 +03:00 [WRN] Failed to determine the https port for redirect.
2025-01-31 22:36:30.225 +03:00 [INF] Executing endpoint 'NayifatAPI.Controllers.NotificationsController.SendNotification (NayifatAPI)'
2025-01-31 22:36:30.256 +03:00 [INF] Route matched with {action = "SendNotification", controller = "Notifications"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] SendNotification(NayifatAPI.Controllers.SendNotificationRequest) on controller NayifatAPI.Controllers.NotificationsController (NayifatAPI).
2025-01-31 22:36:31.657 +03:00 [INF] Executed DbCommand (29ms) [Parameters=[@__providedApiKey_0='?' (Size = 255)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [a].[Key], [a].[CreatedAt], [a].[Description], [a].[ExpiresAt], [a].[IsActive], [a].[LastUsedAt]
FROM [ApiKeys] AS [a]
WHERE [a].[Key] = @__providedApiKey_0 AND [a].[IsActive] = CAST(1 AS bit)
2025-01-31 22:36:31.749 +03:00 [INF] Received notification request: {"Title":null,"TitleEn":"Test Notification","TitleAr":" ","Filters":null,"NationalId":"1012345678","NationalIds":null}
2025-01-31 22:36:31.763 +03:00 [INF] Starting GetTargetUsers with request type: Single User
2025-01-31 22:36:31.764 +03:00 [INF] Searching for single user with ID: 1012345678
2025-01-31 22:36:31.780 +03:00 [INF] Generated SQL Query: DECLARE @__request_NationalId_0 nvarchar(450) = N'1012345678';

SELECT [c].[NationalId], [c].[AddNo], [c].[BuildingNo], [c].[City], [c].[Consent], [c].[ConsentDate], [c].[DateOfBirth], [c].[Dependents], [c].[District], [c].[Email], [c].[Employer], [c].[EmployerName], [c].[EmploymentStatus], [c].[FamilyNameAr], [c].[FamilyNameEn], [c].[FirstNameAr], [c].[FirstNameEn], [c].[Iban], [c].[IdExpiryDate], [c].[Language], [c].[Los], [c].[Mpin], [c].[MpinEnabled], [c].[NafathStatus], [c].[NafathTimestamp], [c].[Password], [c].[Phone], [c].[RegistrationDate], [c].[Salary], [c].[SalaryCustomer], [c].[SalaryDakhli], [c].[SecondNameAr], [c].[SecondNameEn], [c].[Sector], [c].[Street], [c].[ThirdNameAr], [c].[ThirdNameEn], [c].[Zipcode]
FROM [Customers] AS [c]
WHERE [c].[NationalId] = @__request_NationalId_0
2025-01-31 22:36:31.862 +03:00 [INF] Executed DbCommand (14ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT COUNT(*)
FROM [Customers] AS [c]
2025-01-31 22:36:31.877 +03:00 [INF] Total customers in database: 6
2025-01-31 22:36:31.894 +03:00 [INF] Executed DbCommand (5ms) [Parameters=[@__request_NationalId_0='?' (Size = 450)], CommandType='"Text"', CommandTimeout='30']
SELECT [c].[NationalId]
FROM [Customers] AS [c]
WHERE [c].[NationalId] = @__request_NationalId_0
2025-01-31 22:36:31.900 +03:00 [INF] Found 1 users matching national ID 1012345678
2025-01-31 22:36:31.901 +03:00 [INF] Target users query completed. Found 1 users
2025-01-31 22:36:31.902 +03:00 [INF] Found 1 target users for notification
2025-01-31 22:36:32.112 +03:00 [INF] Executed DbCommand (79ms) [Parameters=[@p0='?' (Size = 4000), @p1='?' (Size = 8000) (DbType = AnsiString), @p2='?' (Size = 8000) (DbType = AnsiString), @p3='?' (Size = 8000) (DbType = AnsiString), @p4='?' (DbType = DateTime2), @p5='?' (DbType = DateTime2), @p6='?' (Size = 255), @p7='?' (Size = 4000), @p8='?' (Size = 255), @p9='?' (Size = 255), @p10='?' (Size = 255)], CommandType='"Text"', CommandTimeout='30']
SET IMPLICIT_TRANSACTIONS OFF;
SET NOCOUNT ON;
INSERT INTO [notification_templates] ([additional_data], [Body], [body_ar], [body_en], [created_at], [expiry_at], [Route], [target_criteria], [Title], [title_ar], [title_en])
OUTPUT INSERTED.[Id]
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7, @p8, @p9, @p10);
2025-01-31 22:36:32.138 +03:00 [INF] Created notification template with ID: 1
2025-01-31 22:36:32.240 +03:00 [INF] Executed DbCommand (11ms) [Parameters=[@p0='?' (Size = 4000), @p1='?' (DbType = DateTime2), @p2='?' (Size = 4000), @p3='?' (Size = 4000), @p4='?' (Size = 4000), @p5='?' (Size = 450), @p6='?' (Size = 4000), @p7='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SET IMPLICIT_TRANSACTIONS OFF;
SET NOCOUNT ON;
INSERT INTO [AuthLogs] ([AuthType], [CreatedAt], [DeviceId], [FailureReason], [IpAddress], [NationalId], [Status], [UserAgent])
OUTPUT INSERTED.[Id]
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7);
2025-01-31 22:36:32.267 +03:00 [INF] Executed DbCommand (4ms) [Parameters=[@__userId_0='?' (Size = 450)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [u].[national_id], [u].[last_updated], [u].[notifications]
FROM [user_notifications] AS [u]
WHERE [u].[national_id] = @__userId_0
2025-01-31 22:36:32.315 +03:00 [INF] Created new notifications entry for user: 1012345678
2025-01-31 22:36:32.332 +03:00 [INF] Executed DbCommand (10ms) [Parameters=[@p0='?' (Size = 450), @p1='?' (DbType = DateTime2), @p2='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SET IMPLICIT_TRANSACTIONS OFF;
SET NOCOUNT ON;
INSERT INTO [user_notifications] ([national_id], [last_updated], [notifications])
VALUES (@p0, @p1, @p2);
2025-01-31 22:36:32.338 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@p0='?' (Size = 4000), @p1='?' (DbType = DateTime2), @p2='?' (Size = 4000), @p3='?' (Size = 4000), @p4='?' (Size = 4000), @p5='?' (Size = 450), @p6='?' (Size = 4000), @p7='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SET IMPLICIT_TRANSACTIONS OFF;
SET NOCOUNT ON;
INSERT INTO [AuthLogs] ([AuthType], [CreatedAt], [DeviceId], [FailureReason], [IpAddress], [NationalId], [Status], [UserAgent])
OUTPUT INSERTED.[Id]
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7);
2025-01-31 22:36:32.345 +03:00 [INF] Successfully sent notifications. Template: 1, Success: 1, Total: 1
2025-01-31 22:36:32.353 +03:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType9`2[[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Object, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-01-31 22:36:32.383 +03:00 [INF] Executed action NayifatAPI.Controllers.NotificationsController.SendNotification (NayifatAPI) in 2118.5111ms
2025-01-31 22:36:32.386 +03:00 [INF] Executed endpoint 'NayifatAPI.Controllers.NotificationsController.SendNotification (NayifatAPI)'
2025-01-31 22:36:32.468 +03:00 [INF] Request finished HTTP/1.1 POST http://localhost:5264/api/notifications/send - 200 null application/json; charset=utf-8 2304.1113ms
2025-01-31 22:40:45.619 +03:00 [INF] Request starting HTTP/1.1 POST http://localhost:5264/api/notifications/send - application/json 234
2025-01-31 22:40:45.865 +03:00 [INF] Executing endpoint 'NayifatAPI.Controllers.NotificationsController.SendNotification (NayifatAPI)'
2025-01-31 22:40:45.870 +03:00 [INF] Route matched with {action = "SendNotification", controller = "Notifications"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] SendNotification(NayifatAPI.Controllers.SendNotificationRequest) on controller NayifatAPI.Controllers.NotificationsController (NayifatAPI).
2025-01-31 22:40:46.206 +03:00 [INF] Executed DbCommand (203ms) [Parameters=[@__providedApiKey_0='?' (Size = 255)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [a].[Key], [a].[CreatedAt], [a].[Description], [a].[ExpiresAt], [a].[IsActive], [a].[LastUsedAt]
FROM [ApiKeys] AS [a]
WHERE [a].[Key] = @__providedApiKey_0 AND [a].[IsActive] = CAST(1 AS bit)
2025-01-31 22:40:46.216 +03:00 [INF] Received notification request: {"Title":null,"TitleEn":"Test Notification","TitleAr":" ","Filters":{"City":{"ValueKind":"String","$type":"JsonElement"}},"NationalId":null,"NationalIds":null}
2025-01-31 22:40:46.603 +03:00 [INF] Starting GetTargetUsers with request type: Filtered Users
2025-01-31 22:40:46.606 +03:00 [INF] Applying filters: {"City":{"ValueKind":"String","$type":"JsonElement"}}
2025-01-31 22:40:46.608 +03:00 [INF] Using AND operation for filters
2025-01-31 22:40:47.072 +03:00 [INF] Processing filter: City with value: {"ValueKind":"String","$type":"JsonElement"}
2025-01-31 22:40:47.301 +03:00 [INF] Executed DbCommand (86ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT [c].[NationalId]
FROM [Customers] AS [c]
2025-01-31 22:40:47.592 +03:00 [INF] Target users query completed. Found 6 users
2025-01-31 22:40:47.595 +03:00 [INF] Found 6 target users for notification
2025-01-31 22:40:47.857 +03:00 [INF] Executed DbCommand (252ms) [Parameters=[@p0='?' (Size = 4000), @p1='?' (Size = 8000) (DbType = AnsiString), @p2='?' (Size = 8000) (DbType = AnsiString), @p3='?' (Size = 8000) (DbType = AnsiString), @p4='?' (DbType = DateTime2), @p5='?' (DbType = DateTime2), @p6='?' (Size = 255), @p7='?' (Size = 4000), @p8='?' (Size = 255), @p9='?' (Size = 255), @p10='?' (Size = 255)], CommandType='"Text"', CommandTimeout='30']
SET IMPLICIT_TRANSACTIONS OFF;
SET NOCOUNT ON;
INSERT INTO [notification_templates] ([additional_data], [Body], [body_ar], [body_en], [created_at], [expiry_at], [Route], [target_criteria], [Title], [title_ar], [title_en])
OUTPUT INSERTED.[Id]
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7, @p8, @p9, @p10);
2025-01-31 22:40:47.995 +03:00 [INF] Created notification template with ID: 1
2025-01-31 22:40:48.129 +03:00 [INF] Executed DbCommand (129ms) [Parameters=[@p0='?' (Size = 4000), @p1='?' (DbType = DateTime2), @p2='?' (Size = 4000), @p3='?' (Size = 4000), @p4='?' (Size = 4000), @p5='?' (Size = 450), @p6='?' (Size = 4000), @p7='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SET IMPLICIT_TRANSACTIONS OFF;
SET NOCOUNT ON;
INSERT INTO [AuthLogs] ([AuthType], [CreatedAt], [DeviceId], [FailureReason], [IpAddress], [NationalId], [Status], [UserAgent])
OUTPUT INSERTED.[Id]
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7);
2025-01-31 22:40:48.286 +03:00 [ERR] An exception occurred in the database while saving changes for context type 'NayifatAPI.Data.ApplicationDbContext'.
Microsoft.EntityFrameworkCore.DbUpdateException: An error occurred while saving the entity changes. See the inner exception for details.
 ---> Microsoft.Data.SqlClient.SqlException (0x80131904): Cannot insert the value NULL into column 'NationalId', table 'NayifatApp.dbo.AuthLogs'; column does not allow nulls. INSERT fails.
   at Microsoft.Data.SqlClient.SqlConnection.OnError(SqlException exception, Boolean breakConnection, Action`1 wrapCloseInAction)
   at Microsoft.Data.SqlClient.SqlInternalConnection.OnError(SqlException exception, Boolean breakConnection, Action`1 wrapCloseInAction)
   at Microsoft.Data.SqlClient.TdsParser.ThrowExceptionAndWarning(TdsParserStateObject stateObj, Boolean callerHasConnectionLock, Boolean asyncClose)
   at Microsoft.Data.SqlClient.TdsParser.TryRun(RunBehavior runBehavior, SqlCommand cmdHandler, SqlDataReader dataStream, BulkCopySimpleResultSet bulkCopyHandler, TdsParserStateObject stateObj, Boolean& dataReady)
   at Microsoft.Data.SqlClient.SqlDataReader.TryHasMoreRows(Boolean& moreRows)
   at Microsoft.Data.SqlClient.SqlDataReader.TryReadInternal(Boolean setTimeout, Boolean& more)
   at Microsoft.Data.SqlClient.SqlDataReader.ReadAsyncExecute(Task task, Object state)
   at Microsoft.Data.SqlClient.SqlDataReader.InvokeAsyncCall[T](SqlDataReaderBaseAsyncCallContext`1 context)
--- End of stack trace from previous location ---
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeResultSetAsync(Int32 startCommandIndex, RelationalDataReader reader, CancellationToken cancellationToken)
ClientConnectionId:3261c3ba-42e9-4ea9-8828-09b88768c3bd
Error Number:515,State:2,Class:16
   --- End of inner exception stack trace ---
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeResultSetAsync(Int32 startCommandIndex, RelationalDataReader reader, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeAsync(RelationalDataReader reader, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Update.Internal.SqlServerModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(IList`1 entriesToSave, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(StateManager stateManager, Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Storage.Internal.SqlServerExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
Microsoft.EntityFrameworkCore.DbUpdateException: An error occurred while saving the entity changes. See the inner exception for details.
 ---> Microsoft.Data.SqlClient.SqlException (0x80131904): Cannot insert the value NULL into column 'NationalId', table 'NayifatApp.dbo.AuthLogs'; column does not allow nulls. INSERT fails.
   at Microsoft.Data.SqlClient.SqlConnection.OnError(SqlException exception, Boolean breakConnection, Action`1 wrapCloseInAction)
   at Microsoft.Data.SqlClient.SqlInternalConnection.OnError(SqlException exception, Boolean breakConnection, Action`1 wrapCloseInAction)
   at Microsoft.Data.SqlClient.TdsParser.ThrowExceptionAndWarning(TdsParserStateObject stateObj, Boolean callerHasConnectionLock, Boolean asyncClose)
   at Microsoft.Data.SqlClient.TdsParser.TryRun(RunBehavior runBehavior, SqlCommand cmdHandler, SqlDataReader dataStream, BulkCopySimpleResultSet bulkCopyHandler, TdsParserStateObject stateObj, Boolean& dataReady)
   at Microsoft.Data.SqlClient.SqlDataReader.TryHasMoreRows(Boolean& moreRows)
   at Microsoft.Data.SqlClient.SqlDataReader.TryReadInternal(Boolean setTimeout, Boolean& more)
   at Microsoft.Data.SqlClient.SqlDataReader.ReadAsyncExecute(Task task, Object state)
   at Microsoft.Data.SqlClient.SqlDataReader.InvokeAsyncCall[T](SqlDataReaderBaseAsyncCallContext`1 context)
--- End of stack trace from previous location ---
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeResultSetAsync(Int32 startCommandIndex, RelationalDataReader reader, CancellationToken cancellationToken)
ClientConnectionId:3261c3ba-42e9-4ea9-8828-09b88768c3bd
Error Number:515,State:2,Class:16
   --- End of inner exception stack trace ---
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeResultSetAsync(Int32 startCommandIndex, RelationalDataReader reader, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeAsync(RelationalDataReader reader, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Update.Internal.SqlServerModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(IList`1 entriesToSave, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(StateManager stateManager, Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Storage.Internal.SqlServerExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
2025-01-31 22:40:48.311 +03:00 [ERR] Error logging audit event. NationalId: null, Action: notification_sent, Details: {"template_id":1,"recipient_count":6,"target_criteria":{"City":"Riyadh"},"timestamp":"2025-01-31T19:40:47.6030305Z"}
Microsoft.EntityFrameworkCore.DbUpdateException: An error occurred while saving the entity changes. See the inner exception for details.
 ---> Microsoft.Data.SqlClient.SqlException (0x80131904): Cannot insert the value NULL into column 'NationalId', table 'NayifatApp.dbo.AuthLogs'; column does not allow nulls. INSERT fails.
   at Microsoft.Data.SqlClient.SqlConnection.OnError(SqlException exception, Boolean breakConnection, Action`1 wrapCloseInAction)
   at Microsoft.Data.SqlClient.SqlInternalConnection.OnError(SqlException exception, Boolean breakConnection, Action`1 wrapCloseInAction)
   at Microsoft.Data.SqlClient.TdsParser.ThrowExceptionAndWarning(TdsParserStateObject stateObj, Boolean callerHasConnectionLock, Boolean asyncClose)
   at Microsoft.Data.SqlClient.TdsParser.TryRun(RunBehavior runBehavior, SqlCommand cmdHandler, SqlDataReader dataStream, BulkCopySimpleResultSet bulkCopyHandler, TdsParserStateObject stateObj, Boolean& dataReady)
   at Microsoft.Data.SqlClient.SqlDataReader.TryHasMoreRows(Boolean& moreRows)
   at Microsoft.Data.SqlClient.SqlDataReader.TryReadInternal(Boolean setTimeout, Boolean& more)
   at Microsoft.Data.SqlClient.SqlDataReader.ReadAsyncExecute(Task task, Object state)
   at Microsoft.Data.SqlClient.SqlDataReader.InvokeAsyncCall[T](SqlDataReaderBaseAsyncCallContext`1 context)
--- End of stack trace from previous location ---
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeResultSetAsync(Int32 startCommandIndex, RelationalDataReader reader, CancellationToken cancellationToken)
ClientConnectionId:3261c3ba-42e9-4ea9-8828-09b88768c3bd
Error Number:515,State:2,Class:16
   --- End of inner exception stack trace ---
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeResultSetAsync(Int32 startCommandIndex, RelationalDataReader reader, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeAsync(RelationalDataReader reader, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Update.Internal.SqlServerModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(IList`1 entriesToSave, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(StateManager stateManager, Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Storage.Internal.SqlServerExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at NayifatAPI.Services.AuditLogService.LogAsync(String nationalId, String action, Object details) in C:\Users\yamta\StudioProjects\nayifat_app_2025_new\NayifatAPI\Services\AuditLogService.cs:line 36
2025-01-31 22:40:48.357 +03:00 [INF] Executed DbCommand (13ms) [Parameters=[@__userId_0='?' (Size = 450)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [u].[national_id], [u].[last_updated], [u].[notifications]
FROM [user_notifications] AS [u]
WHERE [u].[national_id] = @__userId_0
2025-01-31 22:40:48.364 +03:00 [INF] Updated existing notifications for user: 1012345678
2025-01-31 22:40:48.401 +03:00 [ERR] Failed executing DbCommand (12ms) [Parameters=[@p0='?' (Size = 4000), @p1='?' (DbType = DateTime2), @p2='?' (Size = 4000), @p3='?' (Size = 4000), @p4='?' (Size = 4000), @p5='?' (Size = 450), @p6='?' (Size = 4000), @p7='?' (Size = 4000), @p10='?' (Size = 450), @p8='?' (DbType = DateTime2), @p9='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SET NOCOUNT ON;
INSERT INTO [AuthLogs] ([AuthType], [CreatedAt], [DeviceId], [FailureReason], [IpAddress], [NationalId], [Status], [UserAgent])
OUTPUT INSERTED.[Id]
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7);
UPDATE [user_notifications] SET [last_updated] = @p8, [notifications] = @p9
OUTPUT 1
WHERE [national_id] = @p10;
2025-01-31 22:40:48.417 +03:00 [ERR] An exception occurred in the database while saving changes for context type 'NayifatAPI.Data.ApplicationDbContext'.
Microsoft.EntityFrameworkCore.DbUpdateException: Could not save changes because the target table has database triggers. Please configure your table accordingly, see https://aka.ms/efcore-docs-sqlserver-save-changes-and-output-clause for more information.
 ---> Microsoft.Data.SqlClient.SqlException (0x80131904): The target table 'user_notifications' of the DML statement cannot have any enabled triggers if the statement contains an OUTPUT clause without INTO clause.
   at Microsoft.Data.SqlClient.SqlCommand.<>c.<ExecuteDbDataReaderAsync>b__209_0(Task`1 result)
   at System.Threading.Tasks.ContinuationResultTaskFromResultTask`2.InnerInvoke()
   at System.Threading.ExecutionContext.RunInternal(ExecutionContext executionContext, ContextCallback callback, Object state)
--- End of stack trace from previous location ---
   at System.Threading.ExecutionContext.RunInternal(ExecutionContext executionContext, ContextCallback callback, Object state)
   at System.Threading.Tasks.Task.ExecuteWithThreadLocal(Task& currentTaskSlot, Thread threadPoolThread)
--- End of stack trace from previous location ---
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
ClientConnectionId:3261c3ba-42e9-4ea9-8828-09b88768c3bd
Error Number:334,State:1,Class:16
   --- End of inner exception stack trace ---
   at Microsoft.EntityFrameworkCore.SqlServer.Update.Internal.SqlServerModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(IList`1 entriesToSave, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(StateManager stateManager, Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Storage.Internal.SqlServerExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
Microsoft.EntityFrameworkCore.DbUpdateException: Could not save changes because the target table has database triggers. Please configure your table accordingly, see https://aka.ms/efcore-docs-sqlserver-save-changes-and-output-clause for more information.
 ---> Microsoft.Data.SqlClient.SqlException (0x80131904): The target table 'user_notifications' of the DML statement cannot have any enabled triggers if the statement contains an OUTPUT clause without INTO clause.
   at Microsoft.Data.SqlClient.SqlCommand.<>c.<ExecuteDbDataReaderAsync>b__209_0(Task`1 result)
   at System.Threading.Tasks.ContinuationResultTaskFromResultTask`2.InnerInvoke()
   at System.Threading.ExecutionContext.RunInternal(ExecutionContext executionContext, ContextCallback callback, Object state)
--- End of stack trace from previous location ---
   at System.Threading.ExecutionContext.RunInternal(ExecutionContext executionContext, ContextCallback callback, Object state)
   at System.Threading.Tasks.Task.ExecuteWithThreadLocal(Task& currentTaskSlot, Thread threadPoolThread)
--- End of stack trace from previous location ---
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
ClientConnectionId:3261c3ba-42e9-4ea9-8828-09b88768c3bd
Error Number:334,State:1,Class:16
   --- End of inner exception stack trace ---
   at Microsoft.EntityFrameworkCore.SqlServer.Update.Internal.SqlServerModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(IList`1 entriesToSave, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(StateManager stateManager, Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Storage.Internal.SqlServerExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
2025-01-31 22:40:48.434 +03:00 [ERR] Failed to save notification for user: 1012345678
Microsoft.EntityFrameworkCore.DbUpdateException: Could not save changes because the target table has database triggers. Please configure your table accordingly, see https://aka.ms/efcore-docs-sqlserver-save-changes-and-output-clause for more information.
 ---> Microsoft.Data.SqlClient.SqlException (0x80131904): The target table 'user_notifications' of the DML statement cannot have any enabled triggers if the statement contains an OUTPUT clause without INTO clause.
   at Microsoft.Data.SqlClient.SqlCommand.<>c.<ExecuteDbDataReaderAsync>b__209_0(Task`1 result)
   at System.Threading.Tasks.ContinuationResultTaskFromResultTask`2.InnerInvoke()
   at System.Threading.ExecutionContext.RunInternal(ExecutionContext executionContext, ContextCallback callback, Object state)
--- End of stack trace from previous location ---
   at System.Threading.ExecutionContext.RunInternal(ExecutionContext executionContext, ContextCallback callback, Object state)
   at System.Threading.Tasks.Task.ExecuteWithThreadLocal(Task& currentTaskSlot, Thread threadPoolThread)
--- End of stack trace from previous location ---
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
ClientConnectionId:3261c3ba-42e9-4ea9-8828-09b88768c3bd
Error Number:334,State:1,Class:16
   --- End of inner exception stack trace ---
   at Microsoft.EntityFrameworkCore.SqlServer.Update.Internal.SqlServerModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(IList`1 entriesToSave, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(StateManager stateManager, Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Storage.Internal.SqlServerExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at NayifatAPI.Controllers.NotificationsController.SendNotification(SendNotificationRequest request) in C:\Users\yamta\StudioProjects\nayifat_app_2025_new\NayifatAPI\Controllers\NotificationsController.cs:line 269
2025-01-31 22:40:48.447 +03:00 [INF] Created new notifications entry for user: 1023456789
2025-01-31 22:40:48.455 +03:00 [ERR] Failed executing DbCommand (3ms) [Parameters=[@p0='?' (Size = 4000), @p1='?' (DbType = DateTime2), @p2='?' (Size = 4000), @p3='?' (Size = 4000), @p4='?' (Size = 4000), @p5='?' (Size = 450), @p6='?' (Size = 4000), @p7='?' (Size = 4000), @p10='?' (Size = 450), @p8='?' (DbType = DateTime2), @p9='?' (Size = 4000), @p11='?' (Size = 450), @p12='?' (DbType = DateTime2), @p13='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SET NOCOUNT ON;
INSERT INTO [AuthLogs] ([AuthType], [CreatedAt], [DeviceId], [FailureReason], [IpAddress], [NationalId], [Status], [UserAgent])
OUTPUT INSERTED.[Id]
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7);
UPDATE [user_notifications] SET [last_updated] = @p8, [notifications] = @p9
OUTPUT 1
WHERE [national_id] = @p10;
INSERT INTO [user_notifications] ([national_id], [last_updated], [notifications])
VALUES (@p11, @p12, @p13);
2025-01-31 22:40:48.460 +03:00 [ERR] An exception occurred in the database while saving changes for context type 'NayifatAPI.Data.ApplicationDbContext'.
Microsoft.EntityFrameworkCore.DbUpdateException: Could not save changes because the target table has database triggers. Please configure your table accordingly, see https://aka.ms/efcore-docs-sqlserver-save-changes-and-output-clause for more information.
 ---> Microsoft.Data.SqlClient.SqlException (0x80131904): The target table 'user_notifications' of the DML statement cannot have any enabled triggers if the statement contains an OUTPUT clause without INTO clause.
   at Microsoft.Data.SqlClient.SqlCommand.<>c.<ExecuteDbDataReaderAsync>b__209_0(Task`1 result)
   at System.Threading.Tasks.ContinuationResultTaskFromResultTask`2.InnerInvoke()
   at System.Threading.ExecutionContext.RunInternal(ExecutionContext executionContext, ContextCallback callback, Object state)
--- End of stack trace from previous location ---
   at System.Threading.ExecutionContext.RunInternal(ExecutionContext executionContext, ContextCallback callback, Object state)
   at System.Threading.Tasks.Task.ExecuteWithThreadLocal(Task& currentTaskSlot, Thread threadPoolThread)
--- End of stack trace from previous location ---
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
ClientConnectionId:3261c3ba-42e9-4ea9-8828-09b88768c3bd
Error Number:334,State:1,Class:16
   --- End of inner exception stack trace ---
   at Microsoft.EntityFrameworkCore.SqlServer.Update.Internal.SqlServerModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(IList`1 entriesToSave, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(StateManager stateManager, Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Storage.Internal.SqlServerExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
Microsoft.EntityFrameworkCore.DbUpdateException: Could not save changes because the target table has database triggers. Please configure your table accordingly, see https://aka.ms/efcore-docs-sqlserver-save-changes-and-output-clause for more information.
 ---> Microsoft.Data.SqlClient.SqlException (0x80131904): The target table 'user_notifications' of the DML statement cannot have any enabled triggers if the statement contains an OUTPUT clause without INTO clause.
   at Microsoft.Data.SqlClient.SqlCommand.<>c.<ExecuteDbDataReaderAsync>b__209_0(Task`1 result)
   at System.Threading.Tasks.ContinuationResultTaskFromResultTask`2.InnerInvoke()
   at System.Threading.ExecutionContext.RunInternal(ExecutionContext executionContext, ContextCallback callback, Object state)
--- End of stack trace from previous location ---
   at System.Threading.ExecutionContext.RunInternal(ExecutionContext executionContext, ContextCallback callback, Object state)
   at System.Threading.Tasks.Task.ExecuteWithThreadLocal(Task& currentTaskSlot, Thread threadPoolThread)
--- End of stack trace from previous location ---
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
ClientConnectionId:3261c3ba-42e9-4ea9-8828-09b88768c3bd
Error Number:334,State:1,Class:16
   --- End of inner exception stack trace ---
   at Microsoft.EntityFrameworkCore.SqlServer.Update.Internal.SqlServerModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(IList`1 entriesToSave, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(StateManager stateManager, Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Storage.Internal.SqlServerExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
2025-01-31 22:40:48.477 +03:00 [ERR] Failed to save notification for user: 1023456789
Microsoft.EntityFrameworkCore.DbUpdateException: Could not save changes because the target table has database triggers. Please configure your table accordingly, see https://aka.ms/efcore-docs-sqlserver-save-changes-and-output-clause for more information.
 ---> Microsoft.Data.SqlClient.SqlException (0x80131904): The target table 'user_notifications' of the DML statement cannot have any enabled triggers if the statement contains an OUTPUT clause without INTO clause.
   at Microsoft.Data.SqlClient.SqlCommand.<>c.<ExecuteDbDataReaderAsync>b__209_0(Task`1 result)
   at System.Threading.Tasks.ContinuationResultTaskFromResultTask`2.InnerInvoke()
   at System.Threading.ExecutionContext.RunInternal(ExecutionContext executionContext, ContextCallback callback, Object state)
--- End of stack trace from previous location ---
   at System.Threading.ExecutionContext.RunInternal(ExecutionContext executionContext, ContextCallback callback, Object state)
   at System.Threading.Tasks.Task.ExecuteWithThreadLocal(Task& currentTaskSlot, Thread threadPoolThread)
--- End of stack trace from previous location ---
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
ClientConnectionId:3261c3ba-42e9-4ea9-8828-09b88768c3bd
Error Number:334,State:1,Class:16
   --- End of inner exception stack trace ---
   at Microsoft.EntityFrameworkCore.SqlServer.Update.Internal.SqlServerModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(IList`1 entriesToSave, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(StateManager stateManager, Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Storage.Internal.SqlServerExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at NayifatAPI.Controllers.NotificationsController.SendNotification(SendNotificationRequest request) in C:\Users\yamta\StudioProjects\nayifat_app_2025_new\NayifatAPI\Controllers\NotificationsController.cs:line 269
2025-01-31 22:40:48.492 +03:00 [INF] Created new notifications entry for user: 1034567890
2025-01-31 22:40:48.505 +03:00 [ERR] Failed executing DbCommand (4ms) [Parameters=[@p0='?' (Size = 4000), @p1='?' (DbType = DateTime2), @p2='?' (Size = 4000), @p3='?' (Size = 4000), @p4='?' (Size = 4000), @p5='?' (Size = 450), @p6='?' (Size = 4000), @p7='?' (Size = 4000), @p10='?' (Size = 450), @p8='?' (DbType = DateTime2), @p9='?' (Size = 4000), @p11='?' (Size = 450), @p12='?' (DbType = DateTime2), @p13='?' (Size = 4000), @p14='?' (Size = 450), @p15='?' (DbType = DateTime2), @p16='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SET NOCOUNT ON;
INSERT INTO [AuthLogs] ([AuthType], [CreatedAt], [DeviceId], [FailureReason], [IpAddress], [NationalId], [Status], [UserAgent])
OUTPUT INSERTED.[Id]
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7);
UPDATE [user_notifications] SET [last_updated] = @p8, [notifications] = @p9
OUTPUT 1
WHERE [national_id] = @p10;
INSERT INTO [user_notifications] ([national_id], [last_updated], [notifications])
VALUES (@p11, @p12, @p13),
(@p14, @p15, @p16);
2025-01-31 22:40:48.510 +03:00 [ERR] An exception occurred in the database while saving changes for context type 'NayifatAPI.Data.ApplicationDbContext'.
Microsoft.EntityFrameworkCore.DbUpdateException: Could not save changes because the target table has database triggers. Please configure your table accordingly, see https://aka.ms/efcore-docs-sqlserver-save-changes-and-output-clause for more information.
 ---> Microsoft.Data.SqlClient.SqlException (0x80131904): The target table 'user_notifications' of the DML statement cannot have any enabled triggers if the statement contains an OUTPUT clause without INTO clause.
   at Microsoft.Data.SqlClient.SqlCommand.<>c.<ExecuteDbDataReaderAsync>b__209_0(Task`1 result)
   at System.Threading.Tasks.ContinuationResultTaskFromResultTask`2.InnerInvoke()
   at System.Threading.ExecutionContext.RunInternal(ExecutionContext executionContext, ContextCallback callback, Object state)
--- End of stack trace from previous location ---
   at System.Threading.ExecutionContext.RunInternal(ExecutionContext executionContext, ContextCallback callback, Object state)
   at System.Threading.Tasks.Task.ExecuteWithThreadLocal(Task& currentTaskSlot, Thread threadPoolThread)
--- End of stack trace from previous location ---
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
ClientConnectionId:3261c3ba-42e9-4ea9-8828-09b88768c3bd
Error Number:334,State:1,Class:16
   --- End of inner exception stack trace ---
   at Microsoft.EntityFrameworkCore.SqlServer.Update.Internal.SqlServerModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(IList`1 entriesToSave, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(StateManager stateManager, Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Storage.Internal.SqlServerExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
Microsoft.EntityFrameworkCore.DbUpdateException: Could not save changes because the target table has database triggers. Please configure your table accordingly, see https://aka.ms/efcore-docs-sqlserver-save-changes-and-output-clause for more information.
 ---> Microsoft.Data.SqlClient.SqlException (0x80131904): The target table 'user_notifications' of the DML statement cannot have any enabled triggers if the statement contains an OUTPUT clause without INTO clause.
   at Microsoft.Data.SqlClient.SqlCommand.<>c.<ExecuteDbDataReaderAsync>b__209_0(Task`1 result)
   at System.Threading.Tasks.ContinuationResultTaskFromResultTask`2.InnerInvoke()
   at System.Threading.ExecutionContext.RunInternal(ExecutionContext executionContext, ContextCallback callback, Object state)
--- End of stack trace from previous location ---
   at System.Threading.ExecutionContext.RunInternal(ExecutionContext executionContext, ContextCallback callback, Object state)
   at System.Threading.Tasks.Task.ExecuteWithThreadLocal(Task& currentTaskSlot, Thread threadPoolThread)
--- End of stack trace from previous location ---
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
ClientConnectionId:3261c3ba-42e9-4ea9-8828-09b88768c3bd
Error Number:334,State:1,Class:16
   --- End of inner exception stack trace ---
   at Microsoft.EntityFrameworkCore.SqlServer.Update.Internal.SqlServerModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(IList`1 entriesToSave, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(StateManager stateManager, Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Storage.Internal.SqlServerExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
2025-01-31 22:40:48.525 +03:00 [ERR] Failed to save notification for user: 1034567890
Microsoft.EntityFrameworkCore.DbUpdateException: Could not save changes because the target table has database triggers. Please configure your table accordingly, see https://aka.ms/efcore-docs-sqlserver-save-changes-and-output-clause for more information.
 ---> Microsoft.Data.SqlClient.SqlException (0x80131904): The target table 'user_notifications' of the DML statement cannot have any enabled triggers if the statement contains an OUTPUT clause without INTO clause.
   at Microsoft.Data.SqlClient.SqlCommand.<>c.<ExecuteDbDataReaderAsync>b__209_0(Task`1 result)
   at System.Threading.Tasks.ContinuationResultTaskFromResultTask`2.InnerInvoke()
   at System.Threading.ExecutionContext.RunInternal(ExecutionContext executionContext, ContextCallback callback, Object state)
--- End of stack trace from previous location ---
   at System.Threading.ExecutionContext.RunInternal(ExecutionContext executionContext, ContextCallback callback, Object state)
   at System.Threading.Tasks.Task.ExecuteWithThreadLocal(Task& currentTaskSlot, Thread threadPoolThread)
--- End of stack trace from previous location ---
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
ClientConnectionId:3261c3ba-42e9-4ea9-8828-09b88768c3bd
Error Number:334,State:1,Class:16
   --- End of inner exception stack trace ---
   at Microsoft.EntityFrameworkCore.SqlServer.Update.Internal.SqlServerModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(IList`1 entriesToSave, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(StateManager stateManager, Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Storage.Internal.SqlServerExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at NayifatAPI.Controllers.NotificationsController.SendNotification(SendNotificationRequest request) in C:\Users\yamta\StudioProjects\nayifat_app_2025_new\NayifatAPI\Controllers\NotificationsController.cs:line 269
2025-01-31 22:40:48.541 +03:00 [INF] Created new notifications entry for user: 1045678901
2025-01-31 22:40:48.565 +03:00 [ERR] Failed executing DbCommand (7ms) [Parameters=[@p0='?' (Size = 4000), @p1='?' (DbType = DateTime2), @p2='?' (Size = 4000), @p3='?' (Size = 4000), @p4='?' (Size = 4000), @p5='?' (Size = 450), @p6='?' (Size = 4000), @p7='?' (Size = 4000), @p10='?' (Size = 450), @p8='?' (DbType = DateTime2), @p9='?' (Size = 4000), @p11='?' (Size = 450), @p12='?' (DbType = DateTime2), @p13='?' (Size = 4000), @p14='?' (Size = 450), @p15='?' (DbType = DateTime2), @p16='?' (Size = 4000), @p17='?' (Size = 450), @p18='?' (DbType = DateTime2), @p19='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SET NOCOUNT ON;
INSERT INTO [AuthLogs] ([AuthType], [CreatedAt], [DeviceId], [FailureReason], [IpAddress], [NationalId], [Status], [UserAgent])
OUTPUT INSERTED.[Id]
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7);
UPDATE [user_notifications] SET [last_updated] = @p8, [notifications] = @p9
OUTPUT 1
WHERE [national_id] = @p10;
INSERT INTO [user_notifications] ([national_id], [last_updated], [notifications])
VALUES (@p11, @p12, @p13),
(@p14, @p15, @p16),
(@p17, @p18, @p19);
2025-01-31 22:40:48.574 +03:00 [ERR] An exception occurred in the database while saving changes for context type 'NayifatAPI.Data.ApplicationDbContext'.
Microsoft.EntityFrameworkCore.DbUpdateException: Could not save changes because the target table has database triggers. Please configure your table accordingly, see https://aka.ms/efcore-docs-sqlserver-save-changes-and-output-clause for more information.
 ---> Microsoft.Data.SqlClient.SqlException (0x80131904): The target table 'user_notifications' of the DML statement cannot have any enabled triggers if the statement contains an OUTPUT clause without INTO clause.
   at Microsoft.Data.SqlClient.SqlCommand.<>c.<ExecuteDbDataReaderAsync>b__209_0(Task`1 result)
   at System.Threading.Tasks.ContinuationResultTaskFromResultTask`2.InnerInvoke()
   at System.Threading.ExecutionContext.RunInternal(ExecutionContext executionContext, ContextCallback callback, Object state)
--- End of stack trace from previous location ---
   at System.Threading.ExecutionContext.RunInternal(ExecutionContext executionContext, ContextCallback callback, Object state)
   at System.Threading.Tasks.Task.ExecuteWithThreadLocal(Task& currentTaskSlot, Thread threadPoolThread)
--- End of stack trace from previous location ---
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
ClientConnectionId:3261c3ba-42e9-4ea9-8828-09b88768c3bd
Error Number:334,State:1,Class:16
   --- End of inner exception stack trace ---
   at Microsoft.EntityFrameworkCore.SqlServer.Update.Internal.SqlServerModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(IList`1 entriesToSave, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(StateManager stateManager, Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Storage.Internal.SqlServerExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
Microsoft.EntityFrameworkCore.DbUpdateException: Could not save changes because the target table has database triggers. Please configure your table accordingly, see https://aka.ms/efcore-docs-sqlserver-save-changes-and-output-clause for more information.
 ---> Microsoft.Data.SqlClient.SqlException (0x80131904): The target table 'user_notifications' of the DML statement cannot have any enabled triggers if the statement contains an OUTPUT clause without INTO clause.
   at Microsoft.Data.SqlClient.SqlCommand.<>c.<ExecuteDbDataReaderAsync>b__209_0(Task`1 result)
   at System.Threading.Tasks.ContinuationResultTaskFromResultTask`2.InnerInvoke()
   at System.Threading.ExecutionContext.RunInternal(ExecutionContext executionContext, ContextCallback callback, Object state)
--- End of stack trace from previous location ---
   at System.Threading.ExecutionContext.RunInternal(ExecutionContext executionContext, ContextCallback callback, Object state)
   at System.Threading.Tasks.Task.ExecuteWithThreadLocal(Task& currentTaskSlot, Thread threadPoolThread)
--- End of stack trace from previous location ---
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
ClientConnectionId:3261c3ba-42e9-4ea9-8828-09b88768c3bd
Error Number:334,State:1,Class:16
   --- End of inner exception stack trace ---
   at Microsoft.EntityFrameworkCore.SqlServer.Update.Internal.SqlServerModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(IList`1 entriesToSave, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(StateManager stateManager, Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Storage.Internal.SqlServerExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
2025-01-31 22:40:48.591 +03:00 [ERR] Failed to save notification for user: 1045678901
Microsoft.EntityFrameworkCore.DbUpdateException: Could not save changes because the target table has database triggers. Please configure your table accordingly, see https://aka.ms/efcore-docs-sqlserver-save-changes-and-output-clause for more information.
 ---> Microsoft.Data.SqlClient.SqlException (0x80131904): The target table 'user_notifications' of the DML statement cannot have any enabled triggers if the statement contains an OUTPUT clause without INTO clause.
   at Microsoft.Data.SqlClient.SqlCommand.<>c.<ExecuteDbDataReaderAsync>b__209_0(Task`1 result)
   at System.Threading.Tasks.ContinuationResultTaskFromResultTask`2.InnerInvoke()
   at System.Threading.ExecutionContext.RunInternal(ExecutionContext executionContext, ContextCallback callback, Object state)
--- End of stack trace from previous location ---
   at System.Threading.ExecutionContext.RunInternal(ExecutionContext executionContext, ContextCallback callback, Object state)
   at System.Threading.Tasks.Task.ExecuteWithThreadLocal(Task& currentTaskSlot, Thread threadPoolThread)
--- End of stack trace from previous location ---
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
ClientConnectionId:3261c3ba-42e9-4ea9-8828-09b88768c3bd
Error Number:334,State:1,Class:16
   --- End of inner exception stack trace ---
   at Microsoft.EntityFrameworkCore.SqlServer.Update.Internal.SqlServerModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(IList`1 entriesToSave, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(StateManager stateManager, Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Storage.Internal.SqlServerExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at NayifatAPI.Controllers.NotificationsController.SendNotification(SendNotificationRequest request) in C:\Users\yamta\StudioProjects\nayifat_app_2025_new\NayifatAPI\Controllers\NotificationsController.cs:line 269
2025-01-31 22:40:48.610 +03:00 [INF] Created new notifications entry for user: 1056789012
2025-01-31 22:40:48.620 +03:00 [ERR] Failed executing DbCommand (4ms) [Parameters=[@p0='?' (Size = 4000), @p1='?' (DbType = DateTime2), @p2='?' (Size = 4000), @p3='?' (Size = 4000), @p4='?' (Size = 4000), @p5='?' (Size = 450), @p6='?' (Size = 4000), @p7='?' (Size = 4000), @p10='?' (Size = 450), @p8='?' (DbType = DateTime2), @p9='?' (Size = 4000), @p11='?' (Size = 450), @p12='?' (DbType = DateTime2), @p13='?' (Size = 4000), @p14='?' (Size = 450), @p15='?' (DbType = DateTime2), @p16='?' (Size = 4000), @p17='?' (Size = 450), @p18='?' (DbType = DateTime2), @p19='?' (Size = 4000), @p20='?' (Size = 450), @p21='?' (DbType = DateTime2), @p22='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SET NOCOUNT ON;
INSERT INTO [AuthLogs] ([AuthType], [CreatedAt], [DeviceId], [FailureReason], [IpAddress], [NationalId], [Status], [UserAgent])
OUTPUT INSERTED.[Id]
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7);
UPDATE [user_notifications] SET [last_updated] = @p8, [notifications] = @p9
OUTPUT 1
WHERE [national_id] = @p10;
INSERT INTO [user_notifications] ([national_id], [last_updated], [notifications])
VALUES (@p11, @p12, @p13),
(@p14, @p15, @p16),
(@p17, @p18, @p19),
(@p20, @p21, @p22);
2025-01-31 22:40:48.625 +03:00 [ERR] An exception occurred in the database while saving changes for context type 'NayifatAPI.Data.ApplicationDbContext'.
Microsoft.EntityFrameworkCore.DbUpdateException: Could not save changes because the target table has database triggers. Please configure your table accordingly, see https://aka.ms/efcore-docs-sqlserver-save-changes-and-output-clause for more information.
 ---> Microsoft.Data.SqlClient.SqlException (0x80131904): The target table 'user_notifications' of the DML statement cannot have any enabled triggers if the statement contains an OUTPUT clause without INTO clause.
   at Microsoft.Data.SqlClient.SqlCommand.<>c.<ExecuteDbDataReaderAsync>b__209_0(Task`1 result)
   at System.Threading.Tasks.ContinuationResultTaskFromResultTask`2.InnerInvoke()
   at System.Threading.ExecutionContext.RunInternal(ExecutionContext executionContext, ContextCallback callback, Object state)
--- End of stack trace from previous location ---
   at System.Threading.ExecutionContext.RunInternal(ExecutionContext executionContext, ContextCallback callback, Object state)
   at System.Threading.Tasks.Task.ExecuteWithThreadLocal(Task& currentTaskSlot, Thread threadPoolThread)
--- End of stack trace from previous location ---
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
ClientConnectionId:3261c3ba-42e9-4ea9-8828-09b88768c3bd
Error Number:334,State:1,Class:16
   --- End of inner exception stack trace ---
   at Microsoft.EntityFrameworkCore.SqlServer.Update.Internal.SqlServerModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(IList`1 entriesToSave, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(StateManager stateManager, Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Storage.Internal.SqlServerExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
Microsoft.EntityFrameworkCore.DbUpdateException: Could not save changes because the target table has database triggers. Please configure your table accordingly, see https://aka.ms/efcore-docs-sqlserver-save-changes-and-output-clause for more information.
 ---> Microsoft.Data.SqlClient.SqlException (0x80131904): The target table 'user_notifications' of the DML statement cannot have any enabled triggers if the statement contains an OUTPUT clause without INTO clause.
   at Microsoft.Data.SqlClient.SqlCommand.<>c.<ExecuteDbDataReaderAsync>b__209_0(Task`1 result)
   at System.Threading.Tasks.ContinuationResultTaskFromResultTask`2.InnerInvoke()
   at System.Threading.ExecutionContext.RunInternal(ExecutionContext executionContext, ContextCallback callback, Object state)
--- End of stack trace from previous location ---
   at System.Threading.ExecutionContext.RunInternal(ExecutionContext executionContext, ContextCallback callback, Object state)
   at System.Threading.Tasks.Task.ExecuteWithThreadLocal(Task& currentTaskSlot, Thread threadPoolThread)
--- End of stack trace from previous location ---
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
ClientConnectionId:3261c3ba-42e9-4ea9-8828-09b88768c3bd
Error Number:334,State:1,Class:16
   --- End of inner exception stack trace ---
   at Microsoft.EntityFrameworkCore.SqlServer.Update.Internal.SqlServerModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(IList`1 entriesToSave, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(StateManager stateManager, Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Storage.Internal.SqlServerExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
2025-01-31 22:40:48.643 +03:00 [ERR] Failed to save notification for user: 1056789012
Microsoft.EntityFrameworkCore.DbUpdateException: Could not save changes because the target table has database triggers. Please configure your table accordingly, see https://aka.ms/efcore-docs-sqlserver-save-changes-and-output-clause for more information.
 ---> Microsoft.Data.SqlClient.SqlException (0x80131904): The target table 'user_notifications' of the DML statement cannot have any enabled triggers if the statement contains an OUTPUT clause without INTO clause.
   at Microsoft.Data.SqlClient.SqlCommand.<>c.<ExecuteDbDataReaderAsync>b__209_0(Task`1 result)
   at System.Threading.Tasks.ContinuationResultTaskFromResultTask`2.InnerInvoke()
   at System.Threading.ExecutionContext.RunInternal(ExecutionContext executionContext, ContextCallback callback, Object state)
--- End of stack trace from previous location ---
   at System.Threading.ExecutionContext.RunInternal(ExecutionContext executionContext, ContextCallback callback, Object state)
   at System.Threading.Tasks.Task.ExecuteWithThreadLocal(Task& currentTaskSlot, Thread threadPoolThread)
--- End of stack trace from previous location ---
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
ClientConnectionId:3261c3ba-42e9-4ea9-8828-09b88768c3bd
Error Number:334,State:1,Class:16
   --- End of inner exception stack trace ---
   at Microsoft.EntityFrameworkCore.SqlServer.Update.Internal.SqlServerModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(IList`1 entriesToSave, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(StateManager stateManager, Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Storage.Internal.SqlServerExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at NayifatAPI.Controllers.NotificationsController.SendNotification(SendNotificationRequest request) in C:\Users\yamta\StudioProjects\nayifat_app_2025_new\NayifatAPI\Controllers\NotificationsController.cs:line 269
2025-01-31 22:40:48.660 +03:00 [INF] Created new notifications entry for user: 1234567890
2025-01-31 22:40:48.683 +03:00 [ERR] Failed executing DbCommand (14ms) [Parameters=[@p0='?' (Size = 4000), @p1='?' (DbType = DateTime2), @p2='?' (Size = 4000), @p3='?' (Size = 4000), @p4='?' (Size = 4000), @p5='?' (Size = 450), @p6='?' (Size = 4000), @p7='?' (Size = 4000), @p10='?' (Size = 450), @p8='?' (DbType = DateTime2), @p9='?' (Size = 4000), @p11='?' (Size = 450), @p12='?' (DbType = DateTime2), @p13='?' (Size = 4000), @p14='?' (Size = 450), @p15='?' (DbType = DateTime2), @p16='?' (Size = 4000), @p17='?' (Size = 450), @p18='?' (DbType = DateTime2), @p19='?' (Size = 4000), @p20='?' (Size = 450), @p21='?' (DbType = DateTime2), @p22='?' (Size = 4000), @p23='?' (Size = 450), @p24='?' (DbType = DateTime2), @p25='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SET NOCOUNT ON;
INSERT INTO [AuthLogs] ([AuthType], [CreatedAt], [DeviceId], [FailureReason], [IpAddress], [NationalId], [Status], [UserAgent])
OUTPUT INSERTED.[Id]
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7);
UPDATE [user_notifications] SET [last_updated] = @p8, [notifications] = @p9
OUTPUT 1
WHERE [national_id] = @p10;
INSERT INTO [user_notifications] ([national_id], [last_updated], [notifications])
VALUES (@p11, @p12, @p13),
(@p14, @p15, @p16),
(@p17, @p18, @p19),
(@p20, @p21, @p22),
(@p23, @p24, @p25);
2025-01-31 22:40:48.690 +03:00 [ERR] An exception occurred in the database while saving changes for context type 'NayifatAPI.Data.ApplicationDbContext'.
Microsoft.EntityFrameworkCore.DbUpdateException: Could not save changes because the target table has database triggers. Please configure your table accordingly, see https://aka.ms/efcore-docs-sqlserver-save-changes-and-output-clause for more information.
 ---> Microsoft.Data.SqlClient.SqlException (0x80131904): The target table 'user_notifications' of the DML statement cannot have any enabled triggers if the statement contains an OUTPUT clause without INTO clause.
   at Microsoft.Data.SqlClient.SqlCommand.<>c.<ExecuteDbDataReaderAsync>b__209_0(Task`1 result)
   at System.Threading.Tasks.ContinuationResultTaskFromResultTask`2.InnerInvoke()
   at System.Threading.ExecutionContext.RunInternal(ExecutionContext executionContext, ContextCallback callback, Object state)
--- End of stack trace from previous location ---
   at System.Threading.ExecutionContext.RunInternal(ExecutionContext executionContext, ContextCallback callback, Object state)
   at System.Threading.Tasks.Task.ExecuteWithThreadLocal(Task& currentTaskSlot, Thread threadPoolThread)
--- End of stack trace from previous location ---
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
ClientConnectionId:3261c3ba-42e9-4ea9-8828-09b88768c3bd
Error Number:334,State:1,Class:16
   --- End of inner exception stack trace ---
   at Microsoft.EntityFrameworkCore.SqlServer.Update.Internal.SqlServerModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(IList`1 entriesToSave, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(StateManager stateManager, Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Storage.Internal.SqlServerExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
Microsoft.EntityFrameworkCore.DbUpdateException: Could not save changes because the target table has database triggers. Please configure your table accordingly, see https://aka.ms/efcore-docs-sqlserver-save-changes-and-output-clause for more information.
 ---> Microsoft.Data.SqlClient.SqlException (0x80131904): The target table 'user_notifications' of the DML statement cannot have any enabled triggers if the statement contains an OUTPUT clause without INTO clause.
   at Microsoft.Data.SqlClient.SqlCommand.<>c.<ExecuteDbDataReaderAsync>b__209_0(Task`1 result)
   at System.Threading.Tasks.ContinuationResultTaskFromResultTask`2.InnerInvoke()
   at System.Threading.ExecutionContext.RunInternal(ExecutionContext executionContext, ContextCallback callback, Object state)
--- End of stack trace from previous location ---
   at System.Threading.ExecutionContext.RunInternal(ExecutionContext executionContext, ContextCallback callback, Object state)
   at System.Threading.Tasks.Task.ExecuteWithThreadLocal(Task& currentTaskSlot, Thread threadPoolThread)
--- End of stack trace from previous location ---
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
ClientConnectionId:3261c3ba-42e9-4ea9-8828-09b88768c3bd
Error Number:334,State:1,Class:16
   --- End of inner exception stack trace ---
   at Microsoft.EntityFrameworkCore.SqlServer.Update.Internal.SqlServerModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(IList`1 entriesToSave, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(StateManager stateManager, Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Storage.Internal.SqlServerExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
2025-01-31 22:40:48.719 +03:00 [ERR] Failed to save notification for user: 1234567890
Microsoft.EntityFrameworkCore.DbUpdateException: Could not save changes because the target table has database triggers. Please configure your table accordingly, see https://aka.ms/efcore-docs-sqlserver-save-changes-and-output-clause for more information.
 ---> Microsoft.Data.SqlClient.SqlException (0x80131904): The target table 'user_notifications' of the DML statement cannot have any enabled triggers if the statement contains an OUTPUT clause without INTO clause.
   at Microsoft.Data.SqlClient.SqlCommand.<>c.<ExecuteDbDataReaderAsync>b__209_0(Task`1 result)
   at System.Threading.Tasks.ContinuationResultTaskFromResultTask`2.InnerInvoke()
   at System.Threading.ExecutionContext.RunInternal(ExecutionContext executionContext, ContextCallback callback, Object state)
--- End of stack trace from previous location ---
   at System.Threading.ExecutionContext.RunInternal(ExecutionContext executionContext, ContextCallback callback, Object state)
   at System.Threading.Tasks.Task.ExecuteWithThreadLocal(Task& currentTaskSlot, Thread threadPoolThread)
--- End of stack trace from previous location ---
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
ClientConnectionId:3261c3ba-42e9-4ea9-8828-09b88768c3bd
Error Number:334,State:1,Class:16
   --- End of inner exception stack trace ---
   at Microsoft.EntityFrameworkCore.SqlServer.Update.Internal.SqlServerModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(IList`1 entriesToSave, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(StateManager stateManager, Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Storage.Internal.SqlServerExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at NayifatAPI.Controllers.NotificationsController.SendNotification(SendNotificationRequest request) in C:\Users\yamta\StudioProjects\nayifat_app_2025_new\NayifatAPI\Controllers\NotificationsController.cs:line 269
2025-01-31 22:40:48.736 +03:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType9`2[[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Object, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-01-31 22:40:48.740 +03:00 [INF] Executed action NayifatAPI.Controllers.NotificationsController.SendNotification (NayifatAPI) in 2866.0598ms
2025-01-31 22:40:48.742 +03:00 [INF] Executed endpoint 'NayifatAPI.Controllers.NotificationsController.SendNotification (NayifatAPI)'
2025-01-31 22:40:48.745 +03:00 [INF] Request finished HTTP/1.1 POST http://localhost:5264/api/notifications/send - 200 null application/json; charset=utf-8 3125.7333ms
2025-01-31 22:43:46.299 +03:00 [INF] Request starting HTTP/1.1 POST http://localhost:5264/api/notifications/send - application/json 244
2025-01-31 22:43:46.708 +03:00 [INF] Executing endpoint 'NayifatAPI.Controllers.NotificationsController.SendNotification (NayifatAPI)'
2025-01-31 22:43:46.809 +03:00 [INF] Route matched with {action = "SendNotification", controller = "Notifications"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] SendNotification(NayifatAPI.Controllers.SendNotificationRequest) on controller NayifatAPI.Controllers.NotificationsController (NayifatAPI).
2025-01-31 22:43:46.993 +03:00 [INF] Executed DbCommand (19ms) [Parameters=[@__providedApiKey_0='?' (Size = 255)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [a].[Key], [a].[CreatedAt], [a].[Description], [a].[ExpiresAt], [a].[IsActive], [a].[LastUsedAt]
FROM [ApiKeys] AS [a]
WHERE [a].[Key] = @__providedApiKey_0 AND [a].[IsActive] = CAST(1 AS bit)
2025-01-31 22:43:47.048 +03:00 [INF] Received notification request: {"Title":null,"TitleEn":"Test Notification","TitleAr":" ","Filters":{"Customers.City":{"ValueKind":"String","$type":"JsonElement"}},"NationalId":null,"NationalIds":null}
2025-01-31 22:43:47.129 +03:00 [INF] Starting GetTargetUsers with request type: Filtered Users
2025-01-31 22:43:47.134 +03:00 [INF] Applying filters: {"Customers.City":{"ValueKind":"String","$type":"JsonElement"}}
2025-01-31 22:43:47.214 +03:00 [INF] Using AND operation for filters
2025-01-31 22:43:47.215 +03:00 [INF] Processing filter: Customers.City with value: {"ValueKind":"String","$type":"JsonElement"}
2025-01-31 22:43:47.273 +03:00 [INF] Executed DbCommand (45ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT [c].[NationalId]
FROM [Customers] AS [c]
2025-01-31 22:43:47.323 +03:00 [INF] Target users query completed. Found 6 users
2025-01-31 22:43:47.325 +03:00 [INF] Found 6 target users for notification
2025-01-31 22:43:47.414 +03:00 [INF] Executed DbCommand (86ms) [Parameters=[@p0='?' (Size = 4000), @p1='?' (Size = 8000) (DbType = AnsiString), @p2='?' (Size = 8000) (DbType = AnsiString), @p3='?' (Size = 8000) (DbType = AnsiString), @p4='?' (DbType = DateTime2), @p5='?' (DbType = DateTime2), @p6='?' (Size = 255), @p7='?' (Size = 4000), @p8='?' (Size = 255), @p9='?' (Size = 255), @p10='?' (Size = 255)], CommandType='"Text"', CommandTimeout='30']
SET IMPLICIT_TRANSACTIONS OFF;
SET NOCOUNT ON;
INSERT INTO [notification_templates] ([additional_data], [Body], [body_ar], [body_en], [created_at], [expiry_at], [Route], [target_criteria], [Title], [title_ar], [title_en])
OUTPUT INSERTED.[Id]
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7, @p8, @p9, @p10);
2025-01-31 22:43:47.480 +03:00 [INF] Created notification template with ID: 2
2025-01-31 22:43:47.564 +03:00 [INF] Executed DbCommand (29ms) [Parameters=[@p0='?' (Size = 4000), @p1='?' (DbType = DateTime2), @p2='?' (Size = 4000), @p3='?' (Size = 4000), @p4='?' (Size = 4000), @p5='?' (Size = 450), @p6='?' (Size = 4000), @p7='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SET IMPLICIT_TRANSACTIONS OFF;
SET NOCOUNT ON;
INSERT INTO [AuthLogs] ([AuthType], [CreatedAt], [DeviceId], [FailureReason], [IpAddress], [NationalId], [Status], [UserAgent])
OUTPUT INSERTED.[Id]
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7);
2025-01-31 22:43:47.649 +03:00 [ERR] An exception occurred in the database while saving changes for context type 'NayifatAPI.Data.ApplicationDbContext'.
Microsoft.EntityFrameworkCore.DbUpdateException: An error occurred while saving the entity changes. See the inner exception for details.
 ---> Microsoft.Data.SqlClient.SqlException (0x80131904): Cannot insert the value NULL into column 'NationalId', table 'NayifatApp.dbo.AuthLogs'; column does not allow nulls. INSERT fails.
   at Microsoft.Data.SqlClient.SqlConnection.OnError(SqlException exception, Boolean breakConnection, Action`1 wrapCloseInAction)
   at Microsoft.Data.SqlClient.SqlInternalConnection.OnError(SqlException exception, Boolean breakConnection, Action`1 wrapCloseInAction)
   at Microsoft.Data.SqlClient.TdsParser.ThrowExceptionAndWarning(TdsParserStateObject stateObj, Boolean callerHasConnectionLock, Boolean asyncClose)
   at Microsoft.Data.SqlClient.TdsParser.TryRun(RunBehavior runBehavior, SqlCommand cmdHandler, SqlDataReader dataStream, BulkCopySimpleResultSet bulkCopyHandler, TdsParserStateObject stateObj, Boolean& dataReady)
   at Microsoft.Data.SqlClient.SqlDataReader.TryHasMoreRows(Boolean& moreRows)
   at Microsoft.Data.SqlClient.SqlDataReader.TryReadInternal(Boolean setTimeout, Boolean& more)
   at Microsoft.Data.SqlClient.SqlDataReader.ReadAsyncExecute(Task task, Object state)
   at Microsoft.Data.SqlClient.SqlDataReader.InvokeAsyncCall[T](SqlDataReaderBaseAsyncCallContext`1 context)
--- End of stack trace from previous location ---
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeResultSetAsync(Int32 startCommandIndex, RelationalDataReader reader, CancellationToken cancellationToken)
ClientConnectionId:3261c3ba-42e9-4ea9-8828-09b88768c3bd
Error Number:515,State:2,Class:16
   --- End of inner exception stack trace ---
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeResultSetAsync(Int32 startCommandIndex, RelationalDataReader reader, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeAsync(RelationalDataReader reader, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Update.Internal.SqlServerModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(IList`1 entriesToSave, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(StateManager stateManager, Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Storage.Internal.SqlServerExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
Microsoft.EntityFrameworkCore.DbUpdateException: An error occurred while saving the entity changes. See the inner exception for details.
 ---> Microsoft.Data.SqlClient.SqlException (0x80131904): Cannot insert the value NULL into column 'NationalId', table 'NayifatApp.dbo.AuthLogs'; column does not allow nulls. INSERT fails.
   at Microsoft.Data.SqlClient.SqlConnection.OnError(SqlException exception, Boolean breakConnection, Action`1 wrapCloseInAction)
   at Microsoft.Data.SqlClient.SqlInternalConnection.OnError(SqlException exception, Boolean breakConnection, Action`1 wrapCloseInAction)
   at Microsoft.Data.SqlClient.TdsParser.ThrowExceptionAndWarning(TdsParserStateObject stateObj, Boolean callerHasConnectionLock, Boolean asyncClose)
   at Microsoft.Data.SqlClient.TdsParser.TryRun(RunBehavior runBehavior, SqlCommand cmdHandler, SqlDataReader dataStream, BulkCopySimpleResultSet bulkCopyHandler, TdsParserStateObject stateObj, Boolean& dataReady)
   at Microsoft.Data.SqlClient.SqlDataReader.TryHasMoreRows(Boolean& moreRows)
   at Microsoft.Data.SqlClient.SqlDataReader.TryReadInternal(Boolean setTimeout, Boolean& more)
   at Microsoft.Data.SqlClient.SqlDataReader.ReadAsyncExecute(Task task, Object state)
   at Microsoft.Data.SqlClient.SqlDataReader.InvokeAsyncCall[T](SqlDataReaderBaseAsyncCallContext`1 context)
--- End of stack trace from previous location ---
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeResultSetAsync(Int32 startCommandIndex, RelationalDataReader reader, CancellationToken cancellationToken)
ClientConnectionId:3261c3ba-42e9-4ea9-8828-09b88768c3bd
Error Number:515,State:2,Class:16
   --- End of inner exception stack trace ---
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeResultSetAsync(Int32 startCommandIndex, RelationalDataReader reader, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeAsync(RelationalDataReader reader, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Update.Internal.SqlServerModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(IList`1 entriesToSave, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(StateManager stateManager, Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Storage.Internal.SqlServerExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
2025-01-31 22:43:48.185 +03:00 [ERR] Error logging audit event. NationalId: null, Action: notification_sent, Details: {"template_id":2,"recipient_count":6,"target_criteria":{"Customers.City":"Riyadh"},"timestamp":"2025-01-31T19:43:47.3270002Z"}
Microsoft.EntityFrameworkCore.DbUpdateException: An error occurred while saving the entity changes. See the inner exception for details.
 ---> Microsoft.Data.SqlClient.SqlException (0x80131904): Cannot insert the value NULL into column 'NationalId', table 'NayifatApp.dbo.AuthLogs'; column does not allow nulls. INSERT fails.
   at Microsoft.Data.SqlClient.SqlConnection.OnError(SqlException exception, Boolean breakConnection, Action`1 wrapCloseInAction)
   at Microsoft.Data.SqlClient.SqlInternalConnection.OnError(SqlException exception, Boolean breakConnection, Action`1 wrapCloseInAction)
   at Microsoft.Data.SqlClient.TdsParser.ThrowExceptionAndWarning(TdsParserStateObject stateObj, Boolean callerHasConnectionLock, Boolean asyncClose)
   at Microsoft.Data.SqlClient.TdsParser.TryRun(RunBehavior runBehavior, SqlCommand cmdHandler, SqlDataReader dataStream, BulkCopySimpleResultSet bulkCopyHandler, TdsParserStateObject stateObj, Boolean& dataReady)
   at Microsoft.Data.SqlClient.SqlDataReader.TryHasMoreRows(Boolean& moreRows)
   at Microsoft.Data.SqlClient.SqlDataReader.TryReadInternal(Boolean setTimeout, Boolean& more)
   at Microsoft.Data.SqlClient.SqlDataReader.ReadAsyncExecute(Task task, Object state)
   at Microsoft.Data.SqlClient.SqlDataReader.InvokeAsyncCall[T](SqlDataReaderBaseAsyncCallContext`1 context)
--- End of stack trace from previous location ---
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeResultSetAsync(Int32 startCommandIndex, RelationalDataReader reader, CancellationToken cancellationToken)
ClientConnectionId:3261c3ba-42e9-4ea9-8828-09b88768c3bd
Error Number:515,State:2,Class:16
   --- End of inner exception stack trace ---
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeResultSetAsync(Int32 startCommandIndex, RelationalDataReader reader, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeAsync(RelationalDataReader reader, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Update.Internal.SqlServerModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(IList`1 entriesToSave, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(StateManager stateManager, Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Storage.Internal.SqlServerExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at NayifatAPI.Services.AuditLogService.LogAsync(String nationalId, String action, Object details) in C:\Users\yamta\StudioProjects\nayifat_app_2025_new\NayifatAPI\Services\AuditLogService.cs:line 36
2025-01-31 22:43:48.376 +03:00 [INF] Executed DbCommand (33ms) [Parameters=[@__userId_0='?' (Size = 450)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [u].[national_id], [u].[last_updated], [u].[notifications]
FROM [user_notifications] AS [u]
WHERE [u].[national_id] = @__userId_0
2025-01-31 22:43:48.429 +03:00 [INF] Updated existing notifications for user: 1012345678
2025-01-31 22:43:48.527 +03:00 [ERR] Failed executing DbCommand (28ms) [Parameters=[@p0='?' (Size = 4000), @p1='?' (DbType = DateTime2), @p2='?' (Size = 4000), @p3='?' (Size = 4000), @p4='?' (Size = 4000), @p5='?' (Size = 450), @p6='?' (Size = 4000), @p7='?' (Size = 4000), @p10='?' (Size = 450), @p8='?' (DbType = DateTime2), @p9='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SET NOCOUNT ON;
INSERT INTO [AuthLogs] ([AuthType], [CreatedAt], [DeviceId], [FailureReason], [IpAddress], [NationalId], [Status], [UserAgent])
OUTPUT INSERTED.[Id]
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7);
UPDATE [user_notifications] SET [last_updated] = @p8, [notifications] = @p9
OUTPUT 1
WHERE [national_id] = @p10;
2025-01-31 22:43:49.094 +03:00 [ERR] An exception occurred in the database while saving changes for context type 'NayifatAPI.Data.ApplicationDbContext'.
Microsoft.EntityFrameworkCore.DbUpdateException: Could not save changes because the target table has database triggers. Please configure your table accordingly, see https://aka.ms/efcore-docs-sqlserver-save-changes-and-output-clause for more information.
 ---> Microsoft.Data.SqlClient.SqlException (0x80131904): The target table 'user_notifications' of the DML statement cannot have any enabled triggers if the statement contains an OUTPUT clause without INTO clause.
   at Microsoft.Data.SqlClient.SqlCommand.<>c.<ExecuteDbDataReaderAsync>b__209_0(Task`1 result)
   at System.Threading.Tasks.ContinuationResultTaskFromResultTask`2.InnerInvoke()
   at System.Threading.ExecutionContext.RunInternal(ExecutionContext executionContext, ContextCallback callback, Object state)
--- End of stack trace from previous location ---
   at System.Threading.ExecutionContext.RunInternal(ExecutionContext executionContext, ContextCallback callback, Object state)
   at System.Threading.Tasks.Task.ExecuteWithThreadLocal(Task& currentTaskSlot, Thread threadPoolThread)
--- End of stack trace from previous location ---
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
ClientConnectionId:3261c3ba-42e9-4ea9-8828-09b88768c3bd
Error Number:334,State:1,Class:16
   --- End of inner exception stack trace ---
   at Microsoft.EntityFrameworkCore.SqlServer.Update.Internal.SqlServerModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(IList`1 entriesToSave, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(StateManager stateManager, Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Storage.Internal.SqlServerExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
Microsoft.EntityFrameworkCore.DbUpdateException: Could not save changes because the target table has database triggers. Please configure your table accordingly, see https://aka.ms/efcore-docs-sqlserver-save-changes-and-output-clause for more information.
 ---> Microsoft.Data.SqlClient.SqlException (0x80131904): The target table 'user_notifications' of the DML statement cannot have any enabled triggers if the statement contains an OUTPUT clause without INTO clause.
   at Microsoft.Data.SqlClient.SqlCommand.<>c.<ExecuteDbDataReaderAsync>b__209_0(Task`1 result)
   at System.Threading.Tasks.ContinuationResultTaskFromResultTask`2.InnerInvoke()
   at System.Threading.ExecutionContext.RunInternal(ExecutionContext executionContext, ContextCallback callback, Object state)
--- End of stack trace from previous location ---
   at System.Threading.ExecutionContext.RunInternal(ExecutionContext executionContext, ContextCallback callback, Object state)
   at System.Threading.Tasks.Task.ExecuteWithThreadLocal(Task& currentTaskSlot, Thread threadPoolThread)
--- End of stack trace from previous location ---
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
ClientConnectionId:3261c3ba-42e9-4ea9-8828-09b88768c3bd
Error Number:334,State:1,Class:16
   --- End of inner exception stack trace ---
   at Microsoft.EntityFrameworkCore.SqlServer.Update.Internal.SqlServerModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(IList`1 entriesToSave, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(StateManager stateManager, Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Storage.Internal.SqlServerExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
2025-01-31 22:43:49.240 +03:00 [ERR] Failed to save notification for user: 1012345678
Microsoft.EntityFrameworkCore.DbUpdateException: Could not save changes because the target table has database triggers. Please configure your table accordingly, see https://aka.ms/efcore-docs-sqlserver-save-changes-and-output-clause for more information.
 ---> Microsoft.Data.SqlClient.SqlException (0x80131904): The target table 'user_notifications' of the DML statement cannot have any enabled triggers if the statement contains an OUTPUT clause without INTO clause.
   at Microsoft.Data.SqlClient.SqlCommand.<>c.<ExecuteDbDataReaderAsync>b__209_0(Task`1 result)
   at System.Threading.Tasks.ContinuationResultTaskFromResultTask`2.InnerInvoke()
   at System.Threading.ExecutionContext.RunInternal(ExecutionContext executionContext, ContextCallback callback, Object state)
--- End of stack trace from previous location ---
   at System.Threading.ExecutionContext.RunInternal(ExecutionContext executionContext, ContextCallback callback, Object state)
   at System.Threading.Tasks.Task.ExecuteWithThreadLocal(Task& currentTaskSlot, Thread threadPoolThread)
--- End of stack trace from previous location ---
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
ClientConnectionId:3261c3ba-42e9-4ea9-8828-09b88768c3bd
Error Number:334,State:1,Class:16
   --- End of inner exception stack trace ---
   at Microsoft.EntityFrameworkCore.SqlServer.Update.Internal.SqlServerModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(IList`1 entriesToSave, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(StateManager stateManager, Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Storage.Internal.SqlServerExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at NayifatAPI.Controllers.NotificationsController.SendNotification(SendNotificationRequest request) in C:\Users\yamta\StudioProjects\nayifat_app_2025_new\NayifatAPI\Controllers\NotificationsController.cs:line 269
2025-01-31 22:43:49.631 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@__userId_0='?' (Size = 450)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [u].[national_id], [u].[last_updated], [u].[notifications]
FROM [user_notifications] AS [u]
WHERE [u].[national_id] = @__userId_0
2025-01-31 22:43:49.636 +03:00 [INF] Created new notifications entry for user: 1023456789
2025-01-31 22:43:49.647 +03:00 [ERR] Failed executing DbCommand (7ms) [Parameters=[@p0='?' (Size = 4000), @p1='?' (DbType = DateTime2), @p2='?' (Size = 4000), @p3='?' (Size = 4000), @p4='?' (Size = 4000), @p5='?' (Size = 450), @p6='?' (Size = 4000), @p7='?' (Size = 4000), @p10='?' (Size = 450), @p8='?' (DbType = DateTime2), @p9='?' (Size = 4000), @p11='?' (Size = 450), @p12='?' (DbType = DateTime2), @p13='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SET NOCOUNT ON;
INSERT INTO [AuthLogs] ([AuthType], [CreatedAt], [DeviceId], [FailureReason], [IpAddress], [NationalId], [Status], [UserAgent])
OUTPUT INSERTED.[Id]
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7);
UPDATE [user_notifications] SET [last_updated] = @p8, [notifications] = @p9
OUTPUT 1
WHERE [national_id] = @p10;
INSERT INTO [user_notifications] ([national_id], [last_updated], [notifications])
VALUES (@p11, @p12, @p13);
2025-01-31 22:43:49.766 +03:00 [ERR] An exception occurred in the database while saving changes for context type 'NayifatAPI.Data.ApplicationDbContext'.
Microsoft.EntityFrameworkCore.DbUpdateException: Could not save changes because the target table has database triggers. Please configure your table accordingly, see https://aka.ms/efcore-docs-sqlserver-save-changes-and-output-clause for more information.
 ---> Microsoft.Data.SqlClient.SqlException (0x80131904): The target table 'user_notifications' of the DML statement cannot have any enabled triggers if the statement contains an OUTPUT clause without INTO clause.
   at Microsoft.Data.SqlClient.SqlCommand.<>c.<ExecuteDbDataReaderAsync>b__209_0(Task`1 result)
   at System.Threading.Tasks.ContinuationResultTaskFromResultTask`2.InnerInvoke()
   at System.Threading.ExecutionContext.RunInternal(ExecutionContext executionContext, ContextCallback callback, Object state)
--- End of stack trace from previous location ---
   at System.Threading.ExecutionContext.RunInternal(ExecutionContext executionContext, ContextCallback callback, Object state)
   at System.Threading.Tasks.Task.ExecuteWithThreadLocal(Task& currentTaskSlot, Thread threadPoolThread)
--- End of stack trace from previous location ---
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
ClientConnectionId:3261c3ba-42e9-4ea9-8828-09b88768c3bd
Error Number:334,State:1,Class:16
   --- End of inner exception stack trace ---
   at Microsoft.EntityFrameworkCore.SqlServer.Update.Internal.SqlServerModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(IList`1 entriesToSave, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(StateManager stateManager, Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Storage.Internal.SqlServerExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
Microsoft.EntityFrameworkCore.DbUpdateException: Could not save changes because the target table has database triggers. Please configure your table accordingly, see https://aka.ms/efcore-docs-sqlserver-save-changes-and-output-clause for more information.
 ---> Microsoft.Data.SqlClient.SqlException (0x80131904): The target table 'user_notifications' of the DML statement cannot have any enabled triggers if the statement contains an OUTPUT clause without INTO clause.
   at Microsoft.Data.SqlClient.SqlCommand.<>c.<ExecuteDbDataReaderAsync>b__209_0(Task`1 result)
   at System.Threading.Tasks.ContinuationResultTaskFromResultTask`2.InnerInvoke()
   at System.Threading.ExecutionContext.RunInternal(ExecutionContext executionContext, ContextCallback callback, Object state)
--- End of stack trace from previous location ---
   at System.Threading.ExecutionContext.RunInternal(ExecutionContext executionContext, ContextCallback callback, Object state)
   at System.Threading.Tasks.Task.ExecuteWithThreadLocal(Task& currentTaskSlot, Thread threadPoolThread)
--- End of stack trace from previous location ---
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
ClientConnectionId:3261c3ba-42e9-4ea9-8828-09b88768c3bd
Error Number:334,State:1,Class:16
   --- End of inner exception stack trace ---
   at Microsoft.EntityFrameworkCore.SqlServer.Update.Internal.SqlServerModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(IList`1 entriesToSave, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(StateManager stateManager, Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Storage.Internal.SqlServerExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
2025-01-31 22:43:49.785 +03:00 [ERR] Failed to save notification for user: 1023456789
Microsoft.EntityFrameworkCore.DbUpdateException: Could not save changes because the target table has database triggers. Please configure your table accordingly, see https://aka.ms/efcore-docs-sqlserver-save-changes-and-output-clause for more information.
 ---> Microsoft.Data.SqlClient.SqlException (0x80131904): The target table 'user_notifications' of the DML statement cannot have any enabled triggers if the statement contains an OUTPUT clause without INTO clause.
   at Microsoft.Data.SqlClient.SqlCommand.<>c.<ExecuteDbDataReaderAsync>b__209_0(Task`1 result)
   at System.Threading.Tasks.ContinuationResultTaskFromResultTask`2.InnerInvoke()
   at System.Threading.ExecutionContext.RunInternal(ExecutionContext executionContext, ContextCallback callback, Object state)
--- End of stack trace from previous location ---
   at System.Threading.ExecutionContext.RunInternal(ExecutionContext executionContext, ContextCallback callback, Object state)
   at System.Threading.Tasks.Task.ExecuteWithThreadLocal(Task& currentTaskSlot, Thread threadPoolThread)
--- End of stack trace from previous location ---
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
ClientConnectionId:3261c3ba-42e9-4ea9-8828-09b88768c3bd
Error Number:334,State:1,Class:16
   --- End of inner exception stack trace ---
   at Microsoft.EntityFrameworkCore.SqlServer.Update.Internal.SqlServerModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(IList`1 entriesToSave, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(StateManager stateManager, Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Storage.Internal.SqlServerExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at NayifatAPI.Controllers.NotificationsController.SendNotification(SendNotificationRequest request) in C:\Users\yamta\StudioProjects\nayifat_app_2025_new\NayifatAPI\Controllers\NotificationsController.cs:line 269
2025-01-31 22:43:49.906 +03:00 [INF] Created new notifications entry for user: 1034567890
2025-01-31 22:43:50.053 +03:00 [ERR] Failed executing DbCommand (53ms) [Parameters=[@p0='?' (Size = 4000), @p1='?' (DbType = DateTime2), @p2='?' (Size = 4000), @p3='?' (Size = 4000), @p4='?' (Size = 4000), @p5='?' (Size = 450), @p6='?' (Size = 4000), @p7='?' (Size = 4000), @p10='?' (Size = 450), @p8='?' (DbType = DateTime2), @p9='?' (Size = 4000), @p11='?' (Size = 450), @p12='?' (DbType = DateTime2), @p13='?' (Size = 4000), @p14='?' (Size = 450), @p15='?' (DbType = DateTime2), @p16='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SET NOCOUNT ON;
INSERT INTO [AuthLogs] ([AuthType], [CreatedAt], [DeviceId], [FailureReason], [IpAddress], [NationalId], [Status], [UserAgent])
OUTPUT INSERTED.[Id]
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7);
UPDATE [user_notifications] SET [last_updated] = @p8, [notifications] = @p9
OUTPUT 1
WHERE [national_id] = @p10;
INSERT INTO [user_notifications] ([national_id], [last_updated], [notifications])
VALUES (@p11, @p12, @p13),
(@p14, @p15, @p16);
2025-01-31 22:43:50.177 +03:00 [ERR] An exception occurred in the database while saving changes for context type 'NayifatAPI.Data.ApplicationDbContext'.
Microsoft.EntityFrameworkCore.DbUpdateException: Could not save changes because the target table has database triggers. Please configure your table accordingly, see https://aka.ms/efcore-docs-sqlserver-save-changes-and-output-clause for more information.
 ---> Microsoft.Data.SqlClient.SqlException (0x80131904): The target table 'user_notifications' of the DML statement cannot have any enabled triggers if the statement contains an OUTPUT clause without INTO clause.
   at Microsoft.Data.SqlClient.SqlCommand.<>c.<ExecuteDbDataReaderAsync>b__209_0(Task`1 result)
   at System.Threading.Tasks.ContinuationResultTaskFromResultTask`2.InnerInvoke()
   at System.Threading.ExecutionContext.RunInternal(ExecutionContext executionContext, ContextCallback callback, Object state)
--- End of stack trace from previous location ---
   at System.Threading.ExecutionContext.RunInternal(ExecutionContext executionContext, ContextCallback callback, Object state)
   at System.Threading.Tasks.Task.ExecuteWithThreadLocal(Task& currentTaskSlot, Thread threadPoolThread)
--- End of stack trace from previous location ---
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
ClientConnectionId:3261c3ba-42e9-4ea9-8828-09b88768c3bd
Error Number:334,State:1,Class:16
   --- End of inner exception stack trace ---
   at Microsoft.EntityFrameworkCore.SqlServer.Update.Internal.SqlServerModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(IList`1 entriesToSave, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(StateManager stateManager, Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Storage.Internal.SqlServerExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
Microsoft.EntityFrameworkCore.DbUpdateException: Could not save changes because the target table has database triggers. Please configure your table accordingly, see https://aka.ms/efcore-docs-sqlserver-save-changes-and-output-clause for more information.
 ---> Microsoft.Data.SqlClient.SqlException (0x80131904): The target table 'user_notifications' of the DML statement cannot have any enabled triggers if the statement contains an OUTPUT clause without INTO clause.
   at Microsoft.Data.SqlClient.SqlCommand.<>c.<ExecuteDbDataReaderAsync>b__209_0(Task`1 result)
   at System.Threading.Tasks.ContinuationResultTaskFromResultTask`2.InnerInvoke()
   at System.Threading.ExecutionContext.RunInternal(ExecutionContext executionContext, ContextCallback callback, Object state)
--- End of stack trace from previous location ---
   at System.Threading.ExecutionContext.RunInternal(ExecutionContext executionContext, ContextCallback callback, Object state)
   at System.Threading.Tasks.Task.ExecuteWithThreadLocal(Task& currentTaskSlot, Thread threadPoolThread)
--- End of stack trace from previous location ---
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
ClientConnectionId:3261c3ba-42e9-4ea9-8828-09b88768c3bd
Error Number:334,State:1,Class:16
   --- End of inner exception stack trace ---
   at Microsoft.EntityFrameworkCore.SqlServer.Update.Internal.SqlServerModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(IList`1 entriesToSave, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(StateManager stateManager, Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Storage.Internal.SqlServerExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
2025-01-31 22:43:50.198 +03:00 [ERR] Failed to save notification for user: 1034567890
Microsoft.EntityFrameworkCore.DbUpdateException: Could not save changes because the target table has database triggers. Please configure your table accordingly, see https://aka.ms/efcore-docs-sqlserver-save-changes-and-output-clause for more information.
 ---> Microsoft.Data.SqlClient.SqlException (0x80131904): The target table 'user_notifications' of the DML statement cannot have any enabled triggers if the statement contains an OUTPUT clause without INTO clause.
   at Microsoft.Data.SqlClient.SqlCommand.<>c.<ExecuteDbDataReaderAsync>b__209_0(Task`1 result)
   at System.Threading.Tasks.ContinuationResultTaskFromResultTask`2.InnerInvoke()
   at System.Threading.ExecutionContext.RunInternal(ExecutionContext executionContext, ContextCallback callback, Object state)
--- End of stack trace from previous location ---
   at System.Threading.ExecutionContext.RunInternal(ExecutionContext executionContext, ContextCallback callback, Object state)
   at System.Threading.Tasks.Task.ExecuteWithThreadLocal(Task& currentTaskSlot, Thread threadPoolThread)
--- End of stack trace from previous location ---
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
ClientConnectionId:3261c3ba-42e9-4ea9-8828-09b88768c3bd
Error Number:334,State:1,Class:16
   --- End of inner exception stack trace ---
   at Microsoft.EntityFrameworkCore.SqlServer.Update.Internal.SqlServerModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(IList`1 entriesToSave, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(StateManager stateManager, Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Storage.Internal.SqlServerExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at NayifatAPI.Controllers.NotificationsController.SendNotification(SendNotificationRequest request) in C:\Users\yamta\StudioProjects\nayifat_app_2025_new\NayifatAPI\Controllers\NotificationsController.cs:line 269
2025-01-31 22:43:50.212 +03:00 [INF] Created new notifications entry for user: 1045678901
2025-01-31 22:43:50.219 +03:00 [ERR] Failed executing DbCommand (4ms) [Parameters=[@p0='?' (Size = 4000), @p1='?' (DbType = DateTime2), @p2='?' (Size = 4000), @p3='?' (Size = 4000), @p4='?' (Size = 4000), @p5='?' (Size = 450), @p6='?' (Size = 4000), @p7='?' (Size = 4000), @p10='?' (Size = 450), @p8='?' (DbType = DateTime2), @p9='?' (Size = 4000), @p11='?' (Size = 450), @p12='?' (DbType = DateTime2), @p13='?' (Size = 4000), @p14='?' (Size = 450), @p15='?' (DbType = DateTime2), @p16='?' (Size = 4000), @p17='?' (Size = 450), @p18='?' (DbType = DateTime2), @p19='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SET NOCOUNT ON;
INSERT INTO [AuthLogs] ([AuthType], [CreatedAt], [DeviceId], [FailureReason], [IpAddress], [NationalId], [Status], [UserAgent])
OUTPUT INSERTED.[Id]
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7);
UPDATE [user_notifications] SET [last_updated] = @p8, [notifications] = @p9
OUTPUT 1
WHERE [national_id] = @p10;
INSERT INTO [user_notifications] ([national_id], [last_updated], [notifications])
VALUES (@p11, @p12, @p13),
(@p14, @p15, @p16),
(@p17, @p18, @p19);
2025-01-31 22:43:50.225 +03:00 [ERR] An exception occurred in the database while saving changes for context type 'NayifatAPI.Data.ApplicationDbContext'.
Microsoft.EntityFrameworkCore.DbUpdateException: Could not save changes because the target table has database triggers. Please configure your table accordingly, see https://aka.ms/efcore-docs-sqlserver-save-changes-and-output-clause for more information.
 ---> Microsoft.Data.SqlClient.SqlException (0x80131904): The target table 'user_notifications' of the DML statement cannot have any enabled triggers if the statement contains an OUTPUT clause without INTO clause.
   at Microsoft.Data.SqlClient.SqlCommand.<>c.<ExecuteDbDataReaderAsync>b__209_0(Task`1 result)
   at System.Threading.Tasks.ContinuationResultTaskFromResultTask`2.InnerInvoke()
   at System.Threading.ExecutionContext.RunInternal(ExecutionContext executionContext, ContextCallback callback, Object state)
--- End of stack trace from previous location ---
   at System.Threading.ExecutionContext.RunInternal(ExecutionContext executionContext, ContextCallback callback, Object state)
   at System.Threading.Tasks.Task.ExecuteWithThreadLocal(Task& currentTaskSlot, Thread threadPoolThread)
--- End of stack trace from previous location ---
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
ClientConnectionId:3261c3ba-42e9-4ea9-8828-09b88768c3bd
Error Number:334,State:1,Class:16
   --- End of inner exception stack trace ---
   at Microsoft.EntityFrameworkCore.SqlServer.Update.Internal.SqlServerModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(IList`1 entriesToSave, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(StateManager stateManager, Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Storage.Internal.SqlServerExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
Microsoft.EntityFrameworkCore.DbUpdateException: Could not save changes because the target table has database triggers. Please configure your table accordingly, see https://aka.ms/efcore-docs-sqlserver-save-changes-and-output-clause for more information.
 ---> Microsoft.Data.SqlClient.SqlException (0x80131904): The target table 'user_notifications' of the DML statement cannot have any enabled triggers if the statement contains an OUTPUT clause without INTO clause.
   at Microsoft.Data.SqlClient.SqlCommand.<>c.<ExecuteDbDataReaderAsync>b__209_0(Task`1 result)
   at System.Threading.Tasks.ContinuationResultTaskFromResultTask`2.InnerInvoke()
   at System.Threading.ExecutionContext.RunInternal(ExecutionContext executionContext, ContextCallback callback, Object state)
--- End of stack trace from previous location ---
   at System.Threading.ExecutionContext.RunInternal(ExecutionContext executionContext, ContextCallback callback, Object state)
   at System.Threading.Tasks.Task.ExecuteWithThreadLocal(Task& currentTaskSlot, Thread threadPoolThread)
--- End of stack trace from previous location ---
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
ClientConnectionId:3261c3ba-42e9-4ea9-8828-09b88768c3bd
Error Number:334,State:1,Class:16
   --- End of inner exception stack trace ---
   at Microsoft.EntityFrameworkCore.SqlServer.Update.Internal.SqlServerModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(IList`1 entriesToSave, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(StateManager stateManager, Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Storage.Internal.SqlServerExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
2025-01-31 22:43:50.239 +03:00 [ERR] Failed to save notification for user: 1045678901
Microsoft.EntityFrameworkCore.DbUpdateException: Could not save changes because the target table has database triggers. Please configure your table accordingly, see https://aka.ms/efcore-docs-sqlserver-save-changes-and-output-clause for more information.
 ---> Microsoft.Data.SqlClient.SqlException (0x80131904): The target table 'user_notifications' of the DML statement cannot have any enabled triggers if the statement contains an OUTPUT clause without INTO clause.
   at Microsoft.Data.SqlClient.SqlCommand.<>c.<ExecuteDbDataReaderAsync>b__209_0(Task`1 result)
   at System.Threading.Tasks.ContinuationResultTaskFromResultTask`2.InnerInvoke()
   at System.Threading.ExecutionContext.RunInternal(ExecutionContext executionContext, ContextCallback callback, Object state)
--- End of stack trace from previous location ---
   at System.Threading.ExecutionContext.RunInternal(ExecutionContext executionContext, ContextCallback callback, Object state)
   at System.Threading.Tasks.Task.ExecuteWithThreadLocal(Task& currentTaskSlot, Thread threadPoolThread)
--- End of stack trace from previous location ---
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
ClientConnectionId:3261c3ba-42e9-4ea9-8828-09b88768c3bd
Error Number:334,State:1,Class:16
   --- End of inner exception stack trace ---
   at Microsoft.EntityFrameworkCore.SqlServer.Update.Internal.SqlServerModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(IList`1 entriesToSave, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(StateManager stateManager, Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Storage.Internal.SqlServerExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at NayifatAPI.Controllers.NotificationsController.SendNotification(SendNotificationRequest request) in C:\Users\yamta\StudioProjects\nayifat_app_2025_new\NayifatAPI\Controllers\NotificationsController.cs:line 269
2025-01-31 22:43:50.254 +03:00 [INF] Created new notifications entry for user: 1056789012
2025-01-31 22:43:50.261 +03:00 [ERR] Failed executing DbCommand (4ms) [Parameters=[@p0='?' (Size = 4000), @p1='?' (DbType = DateTime2), @p2='?' (Size = 4000), @p3='?' (Size = 4000), @p4='?' (Size = 4000), @p5='?' (Size = 450), @p6='?' (Size = 4000), @p7='?' (Size = 4000), @p10='?' (Size = 450), @p8='?' (DbType = DateTime2), @p9='?' (Size = 4000), @p11='?' (Size = 450), @p12='?' (DbType = DateTime2), @p13='?' (Size = 4000), @p14='?' (Size = 450), @p15='?' (DbType = DateTime2), @p16='?' (Size = 4000), @p17='?' (Size = 450), @p18='?' (DbType = DateTime2), @p19='?' (Size = 4000), @p20='?' (Size = 450), @p21='?' (DbType = DateTime2), @p22='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SET NOCOUNT ON;
INSERT INTO [AuthLogs] ([AuthType], [CreatedAt], [DeviceId], [FailureReason], [IpAddress], [NationalId], [Status], [UserAgent])
OUTPUT INSERTED.[Id]
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7);
UPDATE [user_notifications] SET [last_updated] = @p8, [notifications] = @p9
OUTPUT 1
WHERE [national_id] = @p10;
INSERT INTO [user_notifications] ([national_id], [last_updated], [notifications])
VALUES (@p11, @p12, @p13),
(@p14, @p15, @p16),
(@p17, @p18, @p19),
(@p20, @p21, @p22);
2025-01-31 22:43:50.266 +03:00 [ERR] An exception occurred in the database while saving changes for context type 'NayifatAPI.Data.ApplicationDbContext'.
Microsoft.EntityFrameworkCore.DbUpdateException: Could not save changes because the target table has database triggers. Please configure your table accordingly, see https://aka.ms/efcore-docs-sqlserver-save-changes-and-output-clause for more information.
 ---> Microsoft.Data.SqlClient.SqlException (0x80131904): The target table 'user_notifications' of the DML statement cannot have any enabled triggers if the statement contains an OUTPUT clause without INTO clause.
   at Microsoft.Data.SqlClient.SqlCommand.<>c.<ExecuteDbDataReaderAsync>b__209_0(Task`1 result)
   at System.Threading.Tasks.ContinuationResultTaskFromResultTask`2.InnerInvoke()
   at System.Threading.ExecutionContext.RunInternal(ExecutionContext executionContext, ContextCallback callback, Object state)
--- End of stack trace from previous location ---
   at System.Threading.ExecutionContext.RunInternal(ExecutionContext executionContext, ContextCallback callback, Object state)
   at System.Threading.Tasks.Task.ExecuteWithThreadLocal(Task& currentTaskSlot, Thread threadPoolThread)
--- End of stack trace from previous location ---
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
ClientConnectionId:3261c3ba-42e9-4ea9-8828-09b88768c3bd
Error Number:334,State:1,Class:16
   --- End of inner exception stack trace ---
   at Microsoft.EntityFrameworkCore.SqlServer.Update.Internal.SqlServerModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(IList`1 entriesToSave, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(StateManager stateManager, Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Storage.Internal.SqlServerExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
Microsoft.EntityFrameworkCore.DbUpdateException: Could not save changes because the target table has database triggers. Please configure your table accordingly, see https://aka.ms/efcore-docs-sqlserver-save-changes-and-output-clause for more information.
 ---> Microsoft.Data.SqlClient.SqlException (0x80131904): The target table 'user_notifications' of the DML statement cannot have any enabled triggers if the statement contains an OUTPUT clause without INTO clause.
   at Microsoft.Data.SqlClient.SqlCommand.<>c.<ExecuteDbDataReaderAsync>b__209_0(Task`1 result)
   at System.Threading.Tasks.ContinuationResultTaskFromResultTask`2.InnerInvoke()
   at System.Threading.ExecutionContext.RunInternal(ExecutionContext executionContext, ContextCallback callback, Object state)
--- End of stack trace from previous location ---
   at System.Threading.ExecutionContext.RunInternal(ExecutionContext executionContext, ContextCallback callback, Object state)
   at System.Threading.Tasks.Task.ExecuteWithThreadLocal(Task& currentTaskSlot, Thread threadPoolThread)
--- End of stack trace from previous location ---
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
ClientConnectionId:3261c3ba-42e9-4ea9-8828-09b88768c3bd
Error Number:334,State:1,Class:16
   --- End of inner exception stack trace ---
   at Microsoft.EntityFrameworkCore.SqlServer.Update.Internal.SqlServerModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(IList`1 entriesToSave, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(StateManager stateManager, Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Storage.Internal.SqlServerExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
2025-01-31 22:43:50.282 +03:00 [ERR] Failed to save notification for user: 1056789012
Microsoft.EntityFrameworkCore.DbUpdateException: Could not save changes because the target table has database triggers. Please configure your table accordingly, see https://aka.ms/efcore-docs-sqlserver-save-changes-and-output-clause for more information.
 ---> Microsoft.Data.SqlClient.SqlException (0x80131904): The target table 'user_notifications' of the DML statement cannot have any enabled triggers if the statement contains an OUTPUT clause without INTO clause.
   at Microsoft.Data.SqlClient.SqlCommand.<>c.<ExecuteDbDataReaderAsync>b__209_0(Task`1 result)
   at System.Threading.Tasks.ContinuationResultTaskFromResultTask`2.InnerInvoke()
   at System.Threading.ExecutionContext.RunInternal(ExecutionContext executionContext, ContextCallback callback, Object state)
--- End of stack trace from previous location ---
   at System.Threading.ExecutionContext.RunInternal(ExecutionContext executionContext, ContextCallback callback, Object state)
   at System.Threading.Tasks.Task.ExecuteWithThreadLocal(Task& currentTaskSlot, Thread threadPoolThread)
--- End of stack trace from previous location ---
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
ClientConnectionId:3261c3ba-42e9-4ea9-8828-09b88768c3bd
Error Number:334,State:1,Class:16
   --- End of inner exception stack trace ---
   at Microsoft.EntityFrameworkCore.SqlServer.Update.Internal.SqlServerModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(IList`1 entriesToSave, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(StateManager stateManager, Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Storage.Internal.SqlServerExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at NayifatAPI.Controllers.NotificationsController.SendNotification(SendNotificationRequest request) in C:\Users\yamta\StudioProjects\nayifat_app_2025_new\NayifatAPI\Controllers\NotificationsController.cs:line 269
2025-01-31 22:43:50.301 +03:00 [INF] Created new notifications entry for user: 1234567890
2025-01-31 22:43:50.309 +03:00 [ERR] Failed executing DbCommand (4ms) [Parameters=[@p0='?' (Size = 4000), @p1='?' (DbType = DateTime2), @p2='?' (Size = 4000), @p3='?' (Size = 4000), @p4='?' (Size = 4000), @p5='?' (Size = 450), @p6='?' (Size = 4000), @p7='?' (Size = 4000), @p10='?' (Size = 450), @p8='?' (DbType = DateTime2), @p9='?' (Size = 4000), @p11='?' (Size = 450), @p12='?' (DbType = DateTime2), @p13='?' (Size = 4000), @p14='?' (Size = 450), @p15='?' (DbType = DateTime2), @p16='?' (Size = 4000), @p17='?' (Size = 450), @p18='?' (DbType = DateTime2), @p19='?' (Size = 4000), @p20='?' (Size = 450), @p21='?' (DbType = DateTime2), @p22='?' (Size = 4000), @p23='?' (Size = 450), @p24='?' (DbType = DateTime2), @p25='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SET NOCOUNT ON;
INSERT INTO [AuthLogs] ([AuthType], [CreatedAt], [DeviceId], [FailureReason], [IpAddress], [NationalId], [Status], [UserAgent])
OUTPUT INSERTED.[Id]
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7);
UPDATE [user_notifications] SET [last_updated] = @p8, [notifications] = @p9
OUTPUT 1
WHERE [national_id] = @p10;
INSERT INTO [user_notifications] ([national_id], [last_updated], [notifications])
VALUES (@p11, @p12, @p13),
(@p14, @p15, @p16),
(@p17, @p18, @p19),
(@p20, @p21, @p22),
(@p23, @p24, @p25);
2025-01-31 22:43:50.315 +03:00 [ERR] An exception occurred in the database while saving changes for context type 'NayifatAPI.Data.ApplicationDbContext'.
Microsoft.EntityFrameworkCore.DbUpdateException: Could not save changes because the target table has database triggers. Please configure your table accordingly, see https://aka.ms/efcore-docs-sqlserver-save-changes-and-output-clause for more information.
 ---> Microsoft.Data.SqlClient.SqlException (0x80131904): The target table 'user_notifications' of the DML statement cannot have any enabled triggers if the statement contains an OUTPUT clause without INTO clause.
   at Microsoft.Data.SqlClient.SqlCommand.<>c.<ExecuteDbDataReaderAsync>b__209_0(Task`1 result)
   at System.Threading.Tasks.ContinuationResultTaskFromResultTask`2.InnerInvoke()
   at System.Threading.ExecutionContext.RunInternal(ExecutionContext executionContext, ContextCallback callback, Object state)
--- End of stack trace from previous location ---
   at System.Threading.ExecutionContext.RunInternal(ExecutionContext executionContext, ContextCallback callback, Object state)
   at System.Threading.Tasks.Task.ExecuteWithThreadLocal(Task& currentTaskSlot, Thread threadPoolThread)
--- End of stack trace from previous location ---
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
ClientConnectionId:3261c3ba-42e9-4ea9-8828-09b88768c3bd
Error Number:334,State:1,Class:16
   --- End of inner exception stack trace ---
   at Microsoft.EntityFrameworkCore.SqlServer.Update.Internal.SqlServerModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(IList`1 entriesToSave, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(StateManager stateManager, Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Storage.Internal.SqlServerExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
Microsoft.EntityFrameworkCore.DbUpdateException: Could not save changes because the target table has database triggers. Please configure your table accordingly, see https://aka.ms/efcore-docs-sqlserver-save-changes-and-output-clause for more information.
 ---> Microsoft.Data.SqlClient.SqlException (0x80131904): The target table 'user_notifications' of the DML statement cannot have any enabled triggers if the statement contains an OUTPUT clause without INTO clause.
   at Microsoft.Data.SqlClient.SqlCommand.<>c.<ExecuteDbDataReaderAsync>b__209_0(Task`1 result)
   at System.Threading.Tasks.ContinuationResultTaskFromResultTask`2.InnerInvoke()
   at System.Threading.ExecutionContext.RunInternal(ExecutionContext executionContext, ContextCallback callback, Object state)
--- End of stack trace from previous location ---
   at System.Threading.ExecutionContext.RunInternal(ExecutionContext executionContext, ContextCallback callback, Object state)
   at System.Threading.Tasks.Task.ExecuteWithThreadLocal(Task& currentTaskSlot, Thread threadPoolThread)
--- End of stack trace from previous location ---
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
ClientConnectionId:3261c3ba-42e9-4ea9-8828-09b88768c3bd
Error Number:334,State:1,Class:16
   --- End of inner exception stack trace ---
   at Microsoft.EntityFrameworkCore.SqlServer.Update.Internal.SqlServerModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(IList`1 entriesToSave, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(StateManager stateManager, Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Storage.Internal.SqlServerExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
2025-01-31 22:43:50.331 +03:00 [ERR] Failed to save notification for user: 1234567890
Microsoft.EntityFrameworkCore.DbUpdateException: Could not save changes because the target table has database triggers. Please configure your table accordingly, see https://aka.ms/efcore-docs-sqlserver-save-changes-and-output-clause for more information.
 ---> Microsoft.Data.SqlClient.SqlException (0x80131904): The target table 'user_notifications' of the DML statement cannot have any enabled triggers if the statement contains an OUTPUT clause without INTO clause.
   at Microsoft.Data.SqlClient.SqlCommand.<>c.<ExecuteDbDataReaderAsync>b__209_0(Task`1 result)
   at System.Threading.Tasks.ContinuationResultTaskFromResultTask`2.InnerInvoke()
   at System.Threading.ExecutionContext.RunInternal(ExecutionContext executionContext, ContextCallback callback, Object state)
--- End of stack trace from previous location ---
   at System.Threading.ExecutionContext.RunInternal(ExecutionContext executionContext, ContextCallback callback, Object state)
   at System.Threading.Tasks.Task.ExecuteWithThreadLocal(Task& currentTaskSlot, Thread threadPoolThread)
--- End of stack trace from previous location ---
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
ClientConnectionId:3261c3ba-42e9-4ea9-8828-09b88768c3bd
Error Number:334,State:1,Class:16
   --- End of inner exception stack trace ---
   at Microsoft.EntityFrameworkCore.SqlServer.Update.Internal.SqlServerModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(IList`1 entriesToSave, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(StateManager stateManager, Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Storage.Internal.SqlServerExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at NayifatAPI.Controllers.NotificationsController.SendNotification(SendNotificationRequest request) in C:\Users\yamta\StudioProjects\nayifat_app_2025_new\NayifatAPI\Controllers\NotificationsController.cs:line 269
2025-01-31 22:43:50.342 +03:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType9`2[[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Object, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-01-31 22:43:50.347 +03:00 [INF] Executed action NayifatAPI.Controllers.NotificationsController.SendNotification (NayifatAPI) in 3535.9575ms
2025-01-31 22:43:50.350 +03:00 [INF] Executed endpoint 'NayifatAPI.Controllers.NotificationsController.SendNotification (NayifatAPI)'
2025-01-31 22:43:50.352 +03:00 [INF] Request finished HTTP/1.1 POST http://localhost:5264/api/notifications/send - 200 null application/json; charset=utf-8 4052.7087ms
2025-01-31 22:45:26.709 +03:00 [INF] Application is shutting down...
2025-01-31 22:45:47.918 +03:00 [INF] Starting web application
2025-01-31 22:45:48.032 +03:00 [INF] Now listening on: http://localhost:5264
2025-01-31 22:45:48.037 +03:00 [INF] Application started. Press Ctrl+C to shut down.
2025-01-31 22:45:48.038 +03:00 [INF] Hosting environment: Development
2025-01-31 22:45:48.038 +03:00 [INF] Content root path: C:\Users\yamta\StudioProjects\nayifat_app_2025_new\NayifatAPI
2025-01-31 22:45:56.402 +03:00 [INF] Request starting HTTP/1.1 POST http://localhost:5264/api/notifications/send - application/json 244
2025-01-31 22:45:56.668 +03:00 [WRN] Failed to determine the https port for redirect.
2025-01-31 22:45:56.675 +03:00 [INF] Executing endpoint 'NayifatAPI.Controllers.NotificationsController.SendNotification (NayifatAPI)'
2025-01-31 22:45:56.713 +03:00 [INF] Route matched with {action = "SendNotification", controller = "Notifications"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] SendNotification(NayifatAPI.Controllers.SendNotificationRequest) on controller NayifatAPI.Controllers.NotificationsController (NayifatAPI).
2025-01-31 22:45:58.938 +03:00 [INF] Executed DbCommand (28ms) [Parameters=[@__providedApiKey_0='?' (Size = 255)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [a].[Key], [a].[CreatedAt], [a].[Description], [a].[ExpiresAt], [a].[IsActive], [a].[LastUsedAt]
FROM [ApiKeys] AS [a]
WHERE [a].[Key] = @__providedApiKey_0 AND [a].[IsActive] = CAST(1 AS bit)
2025-01-31 22:45:59.060 +03:00 [INF] Received notification request: {"Title":null,"TitleEn":"Test Notification","TitleAr":" ","Filters":{"Customers.City":{"ValueKind":"String","$type":"JsonElement"}},"NationalId":null,"NationalIds":null}
2025-01-31 22:45:59.085 +03:00 [INF] Starting GetTargetUsers with request type: Filtered Users
2025-01-31 22:45:59.088 +03:00 [INF] Applying filters: {"Customers.City":{"ValueKind":"String","$type":"JsonElement"}}
2025-01-31 22:45:59.094 +03:00 [INF] Using AND operation for filters
2025-01-31 22:45:59.097 +03:00 [INF] Processing filter: Customers.City with value: {"ValueKind":"String","$type":"JsonElement"}
2025-01-31 22:45:59.108 +03:00 [INF] Applied city filter: Riyadh
2025-01-31 22:45:59.152 +03:00 [INF] Final SQL Query: DECLARE @__ToString_0 nvarchar(4000) = N'Riyadh';

SELECT [c].[NationalId], [c].[AddNo], [c].[BuildingNo], [c].[City], [c].[Consent], [c].[ConsentDate], [c].[DateOfBirth], [c].[Dependents], [c].[District], [c].[Email], [c].[Employer], [c].[EmployerName], [c].[EmploymentStatus], [c].[FamilyNameAr], [c].[FamilyNameEn], [c].[FirstNameAr], [c].[FirstNameEn], [c].[Iban], [c].[IdExpiryDate], [c].[Language], [c].[Los], [c].[Mpin], [c].[MpinEnabled], [c].[NafathStatus], [c].[NafathTimestamp], [c].[Password], [c].[Phone], [c].[RegistrationDate], [c].[Salary], [c].[SalaryCustomer], [c].[SalaryDakhli], [c].[SecondNameAr], [c].[SecondNameEn], [c].[Sector], [c].[Street], [c].[ThirdNameAr], [c].[ThirdNameEn], [c].[Zipcode]
FROM [Customers] AS [c]
WHERE [c].[City] = @__ToString_0
2025-01-31 22:45:59.310 +03:00 [INF] Executed DbCommand (118ms) [Parameters=[@__ToString_0='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SELECT [c].[NationalId]
FROM [Customers] AS [c]
WHERE [c].[City] = @__ToString_0
2025-01-31 22:45:59.330 +03:00 [INF] Found 2 users after applying filters
2025-01-31 22:45:59.331 +03:00 [INF] Returning 2 distinct users
2025-01-31 22:45:59.332 +03:00 [INF] Target users query completed. Found 2 users
2025-01-31 22:45:59.333 +03:00 [INF] Found 2 target users for notification
2025-01-31 22:45:59.553 +03:00 [INF] Executed DbCommand (11ms) [Parameters=[@p0='?' (Size = 4000), @p1='?' (Size = 8000) (DbType = AnsiString), @p2='?' (Size = 8000) (DbType = AnsiString), @p3='?' (Size = 8000) (DbType = AnsiString), @p4='?' (DbType = DateTime2), @p5='?' (DbType = DateTime2), @p6='?' (Size = 255), @p7='?' (Size = 4000), @p8='?' (Size = 255), @p9='?' (Size = 255), @p10='?' (Size = 255)], CommandType='"Text"', CommandTimeout='30']
SET IMPLICIT_TRANSACTIONS OFF;
SET NOCOUNT ON;
INSERT INTO [notification_templates] ([additional_data], [Body], [body_ar], [body_en], [created_at], [expiry_at], [Route], [target_criteria], [Title], [title_ar], [title_en])
OUTPUT INSERTED.[Id]
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7, @p8, @p9, @p10);
2025-01-31 22:45:59.597 +03:00 [INF] Created notification template with ID: 3
2025-01-31 22:45:59.673 +03:00 [INF] Executed DbCommand (5ms) [Parameters=[@p0='?' (Size = 4000), @p1='?' (DbType = DateTime2), @p2='?' (Size = 4000), @p3='?' (Size = 4000), @p4='?' (Size = 4000), @p5='?' (Size = 450), @p6='?' (Size = 4000), @p7='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SET IMPLICIT_TRANSACTIONS OFF;
SET NOCOUNT ON;
INSERT INTO [AuthLogs] ([AuthType], [CreatedAt], [DeviceId], [FailureReason], [IpAddress], [NationalId], [Status], [UserAgent])
OUTPUT INSERTED.[Id]
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7);
2025-01-31 22:45:59.714 +03:00 [ERR] An exception occurred in the database while saving changes for context type 'NayifatAPI.Data.ApplicationDbContext'.
Microsoft.EntityFrameworkCore.DbUpdateException: An error occurred while saving the entity changes. See the inner exception for details.
 ---> Microsoft.Data.SqlClient.SqlException (0x80131904): Cannot insert the value NULL into column 'NationalId', table 'NayifatApp.dbo.AuthLogs'; column does not allow nulls. INSERT fails.
   at Microsoft.Data.SqlClient.SqlConnection.OnError(SqlException exception, Boolean breakConnection, Action`1 wrapCloseInAction)
   at Microsoft.Data.SqlClient.SqlInternalConnection.OnError(SqlException exception, Boolean breakConnection, Action`1 wrapCloseInAction)
   at Microsoft.Data.SqlClient.TdsParser.ThrowExceptionAndWarning(TdsParserStateObject stateObj, Boolean callerHasConnectionLock, Boolean asyncClose)
   at Microsoft.Data.SqlClient.TdsParser.TryRun(RunBehavior runBehavior, SqlCommand cmdHandler, SqlDataReader dataStream, BulkCopySimpleResultSet bulkCopyHandler, TdsParserStateObject stateObj, Boolean& dataReady)
   at Microsoft.Data.SqlClient.SqlDataReader.TryHasMoreRows(Boolean& moreRows)
   at Microsoft.Data.SqlClient.SqlDataReader.TryReadInternal(Boolean setTimeout, Boolean& more)
   at Microsoft.Data.SqlClient.SqlDataReader.ReadAsyncExecute(Task task, Object state)
   at Microsoft.Data.SqlClient.SqlDataReader.InvokeAsyncCall[T](SqlDataReaderBaseAsyncCallContext`1 context)
--- End of stack trace from previous location ---
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeResultSetAsync(Int32 startCommandIndex, RelationalDataReader reader, CancellationToken cancellationToken)
ClientConnectionId:14e679c4-643c-497b-b9b5-693f64e3dd00
Error Number:515,State:2,Class:16
   --- End of inner exception stack trace ---
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeResultSetAsync(Int32 startCommandIndex, RelationalDataReader reader, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeAsync(RelationalDataReader reader, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Update.Internal.SqlServerModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(IList`1 entriesToSave, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(StateManager stateManager, Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Storage.Internal.SqlServerExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
Microsoft.EntityFrameworkCore.DbUpdateException: An error occurred while saving the entity changes. See the inner exception for details.
 ---> Microsoft.Data.SqlClient.SqlException (0x80131904): Cannot insert the value NULL into column 'NationalId', table 'NayifatApp.dbo.AuthLogs'; column does not allow nulls. INSERT fails.
   at Microsoft.Data.SqlClient.SqlConnection.OnError(SqlException exception, Boolean breakConnection, Action`1 wrapCloseInAction)
   at Microsoft.Data.SqlClient.SqlInternalConnection.OnError(SqlException exception, Boolean breakConnection, Action`1 wrapCloseInAction)
   at Microsoft.Data.SqlClient.TdsParser.ThrowExceptionAndWarning(TdsParserStateObject stateObj, Boolean callerHasConnectionLock, Boolean asyncClose)
   at Microsoft.Data.SqlClient.TdsParser.TryRun(RunBehavior runBehavior, SqlCommand cmdHandler, SqlDataReader dataStream, BulkCopySimpleResultSet bulkCopyHandler, TdsParserStateObject stateObj, Boolean& dataReady)
   at Microsoft.Data.SqlClient.SqlDataReader.TryHasMoreRows(Boolean& moreRows)
   at Microsoft.Data.SqlClient.SqlDataReader.TryReadInternal(Boolean setTimeout, Boolean& more)
   at Microsoft.Data.SqlClient.SqlDataReader.ReadAsyncExecute(Task task, Object state)
   at Microsoft.Data.SqlClient.SqlDataReader.InvokeAsyncCall[T](SqlDataReaderBaseAsyncCallContext`1 context)
--- End of stack trace from previous location ---
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeResultSetAsync(Int32 startCommandIndex, RelationalDataReader reader, CancellationToken cancellationToken)
ClientConnectionId:14e679c4-643c-497b-b9b5-693f64e3dd00
Error Number:515,State:2,Class:16
   --- End of inner exception stack trace ---
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeResultSetAsync(Int32 startCommandIndex, RelationalDataReader reader, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeAsync(RelationalDataReader reader, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Update.Internal.SqlServerModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(IList`1 entriesToSave, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(StateManager stateManager, Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Storage.Internal.SqlServerExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
2025-01-31 22:45:59.768 +03:00 [ERR] Error logging audit event. NationalId: null, Action: notification_sent, Details: {"template_id":3,"recipient_count":2,"target_criteria":{"Customers.City":"Riyadh"},"timestamp":"2025-01-31T19:45:59.3444274Z"}
Microsoft.EntityFrameworkCore.DbUpdateException: An error occurred while saving the entity changes. See the inner exception for details.
 ---> Microsoft.Data.SqlClient.SqlException (0x80131904): Cannot insert the value NULL into column 'NationalId', table 'NayifatApp.dbo.AuthLogs'; column does not allow nulls. INSERT fails.
   at Microsoft.Data.SqlClient.SqlConnection.OnError(SqlException exception, Boolean breakConnection, Action`1 wrapCloseInAction)
   at Microsoft.Data.SqlClient.SqlInternalConnection.OnError(SqlException exception, Boolean breakConnection, Action`1 wrapCloseInAction)
   at Microsoft.Data.SqlClient.TdsParser.ThrowExceptionAndWarning(TdsParserStateObject stateObj, Boolean callerHasConnectionLock, Boolean asyncClose)
   at Microsoft.Data.SqlClient.TdsParser.TryRun(RunBehavior runBehavior, SqlCommand cmdHandler, SqlDataReader dataStream, BulkCopySimpleResultSet bulkCopyHandler, TdsParserStateObject stateObj, Boolean& dataReady)
   at Microsoft.Data.SqlClient.SqlDataReader.TryHasMoreRows(Boolean& moreRows)
   at Microsoft.Data.SqlClient.SqlDataReader.TryReadInternal(Boolean setTimeout, Boolean& more)
   at Microsoft.Data.SqlClient.SqlDataReader.ReadAsyncExecute(Task task, Object state)
   at Microsoft.Data.SqlClient.SqlDataReader.InvokeAsyncCall[T](SqlDataReaderBaseAsyncCallContext`1 context)
--- End of stack trace from previous location ---
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeResultSetAsync(Int32 startCommandIndex, RelationalDataReader reader, CancellationToken cancellationToken)
ClientConnectionId:14e679c4-643c-497b-b9b5-693f64e3dd00
Error Number:515,State:2,Class:16
   --- End of inner exception stack trace ---
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeResultSetAsync(Int32 startCommandIndex, RelationalDataReader reader, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeAsync(RelationalDataReader reader, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Update.Internal.SqlServerModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(IList`1 entriesToSave, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(StateManager stateManager, Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Storage.Internal.SqlServerExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at NayifatAPI.Services.AuditLogService.LogAsync(String nationalId, String action, Object details) in C:\Users\yamta\StudioProjects\nayifat_app_2025_new\NayifatAPI\Services\AuditLogService.cs:line 36
2025-01-31 22:45:59.820 +03:00 [INF] Executed DbCommand (3ms) [Parameters=[@__userId_0='?' (Size = 450)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [u].[national_id], [u].[last_updated], [u].[notifications]
FROM [user_notifications] AS [u]
WHERE [u].[national_id] = @__userId_0
2025-01-31 22:45:59.854 +03:00 [INF] Updated existing notifications for user: 1012345678
2025-01-31 22:45:59.896 +03:00 [ERR] Failed executing DbCommand (11ms) [Parameters=[@p0='?' (Size = 4000), @p1='?' (DbType = DateTime2), @p2='?' (Size = 4000), @p3='?' (Size = 4000), @p4='?' (Size = 4000), @p5='?' (Size = 450), @p6='?' (Size = 4000), @p7='?' (Size = 4000), @p10='?' (Size = 450), @p8='?' (DbType = DateTime2), @p9='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SET NOCOUNT ON;
INSERT INTO [AuthLogs] ([AuthType], [CreatedAt], [DeviceId], [FailureReason], [IpAddress], [NationalId], [Status], [UserAgent])
OUTPUT INSERTED.[Id]
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7);
UPDATE [user_notifications] SET [last_updated] = @p8, [notifications] = @p9
OUTPUT 1
WHERE [national_id] = @p10;
2025-01-31 22:45:59.913 +03:00 [ERR] An exception occurred in the database while saving changes for context type 'NayifatAPI.Data.ApplicationDbContext'.
Microsoft.EntityFrameworkCore.DbUpdateException: Could not save changes because the target table has database triggers. Please configure your table accordingly, see https://aka.ms/efcore-docs-sqlserver-save-changes-and-output-clause for more information.
 ---> Microsoft.Data.SqlClient.SqlException (0x80131904): The target table 'user_notifications' of the DML statement cannot have any enabled triggers if the statement contains an OUTPUT clause without INTO clause.
   at Microsoft.Data.SqlClient.SqlCommand.<>c.<ExecuteDbDataReaderAsync>b__209_0(Task`1 result)
   at System.Threading.Tasks.ContinuationResultTaskFromResultTask`2.InnerInvoke()
   at System.Threading.ExecutionContext.RunInternal(ExecutionContext executionContext, ContextCallback callback, Object state)
--- End of stack trace from previous location ---
   at System.Threading.ExecutionContext.RunInternal(ExecutionContext executionContext, ContextCallback callback, Object state)
   at System.Threading.Tasks.Task.ExecuteWithThreadLocal(Task& currentTaskSlot, Thread threadPoolThread)
--- End of stack trace from previous location ---
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
ClientConnectionId:14e679c4-643c-497b-b9b5-693f64e3dd00
Error Number:334,State:1,Class:16
   --- End of inner exception stack trace ---
   at Microsoft.EntityFrameworkCore.SqlServer.Update.Internal.SqlServerModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(IList`1 entriesToSave, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(StateManager stateManager, Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Storage.Internal.SqlServerExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
Microsoft.EntityFrameworkCore.DbUpdateException: Could not save changes because the target table has database triggers. Please configure your table accordingly, see https://aka.ms/efcore-docs-sqlserver-save-changes-and-output-clause for more information.
 ---> Microsoft.Data.SqlClient.SqlException (0x80131904): The target table 'user_notifications' of the DML statement cannot have any enabled triggers if the statement contains an OUTPUT clause without INTO clause.
   at Microsoft.Data.SqlClient.SqlCommand.<>c.<ExecuteDbDataReaderAsync>b__209_0(Task`1 result)
   at System.Threading.Tasks.ContinuationResultTaskFromResultTask`2.InnerInvoke()
   at System.Threading.ExecutionContext.RunInternal(ExecutionContext executionContext, ContextCallback callback, Object state)
--- End of stack trace from previous location ---
   at System.Threading.ExecutionContext.RunInternal(ExecutionContext executionContext, ContextCallback callback, Object state)
   at System.Threading.Tasks.Task.ExecuteWithThreadLocal(Task& currentTaskSlot, Thread threadPoolThread)
--- End of stack trace from previous location ---
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
ClientConnectionId:14e679c4-643c-497b-b9b5-693f64e3dd00
Error Number:334,State:1,Class:16
   --- End of inner exception stack trace ---
   at Microsoft.EntityFrameworkCore.SqlServer.Update.Internal.SqlServerModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(IList`1 entriesToSave, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(StateManager stateManager, Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Storage.Internal.SqlServerExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
2025-01-31 22:45:59.932 +03:00 [ERR] Failed to save notification for user: 1012345678
Microsoft.EntityFrameworkCore.DbUpdateException: Could not save changes because the target table has database triggers. Please configure your table accordingly, see https://aka.ms/efcore-docs-sqlserver-save-changes-and-output-clause for more information.
 ---> Microsoft.Data.SqlClient.SqlException (0x80131904): The target table 'user_notifications' of the DML statement cannot have any enabled triggers if the statement contains an OUTPUT clause without INTO clause.
   at Microsoft.Data.SqlClient.SqlCommand.<>c.<ExecuteDbDataReaderAsync>b__209_0(Task`1 result)
   at System.Threading.Tasks.ContinuationResultTaskFromResultTask`2.InnerInvoke()
   at System.Threading.ExecutionContext.RunInternal(ExecutionContext executionContext, ContextCallback callback, Object state)
--- End of stack trace from previous location ---
   at System.Threading.ExecutionContext.RunInternal(ExecutionContext executionContext, ContextCallback callback, Object state)
   at System.Threading.Tasks.Task.ExecuteWithThreadLocal(Task& currentTaskSlot, Thread threadPoolThread)
--- End of stack trace from previous location ---
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
ClientConnectionId:14e679c4-643c-497b-b9b5-693f64e3dd00
Error Number:334,State:1,Class:16
   --- End of inner exception stack trace ---
   at Microsoft.EntityFrameworkCore.SqlServer.Update.Internal.SqlServerModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(IList`1 entriesToSave, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(StateManager stateManager, Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Storage.Internal.SqlServerExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at NayifatAPI.Controllers.NotificationsController.SendNotification(SendNotificationRequest request) in C:\Users\yamta\StudioProjects\nayifat_app_2025_new\NayifatAPI\Controllers\NotificationsController.cs:line 269
2025-01-31 22:45:59.953 +03:00 [INF] Created new notifications entry for user: 1045678901
2025-01-31 22:45:59.970 +03:00 [ERR] Failed executing DbCommand (4ms) [Parameters=[@p0='?' (Size = 4000), @p1='?' (DbType = DateTime2), @p2='?' (Size = 4000), @p3='?' (Size = 4000), @p4='?' (Size = 4000), @p5='?' (Size = 450), @p6='?' (Size = 4000), @p7='?' (Size = 4000), @p10='?' (Size = 450), @p8='?' (DbType = DateTime2), @p9='?' (Size = 4000), @p11='?' (Size = 450), @p12='?' (DbType = DateTime2), @p13='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SET NOCOUNT ON;
INSERT INTO [AuthLogs] ([AuthType], [CreatedAt], [DeviceId], [FailureReason], [IpAddress], [NationalId], [Status], [UserAgent])
OUTPUT INSERTED.[Id]
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7);
UPDATE [user_notifications] SET [last_updated] = @p8, [notifications] = @p9
OUTPUT 1
WHERE [national_id] = @p10;
INSERT INTO [user_notifications] ([national_id], [last_updated], [notifications])
VALUES (@p11, @p12, @p13);
2025-01-31 22:45:59.978 +03:00 [ERR] An exception occurred in the database while saving changes for context type 'NayifatAPI.Data.ApplicationDbContext'.
Microsoft.EntityFrameworkCore.DbUpdateException: Could not save changes because the target table has database triggers. Please configure your table accordingly, see https://aka.ms/efcore-docs-sqlserver-save-changes-and-output-clause for more information.
 ---> Microsoft.Data.SqlClient.SqlException (0x80131904): The target table 'user_notifications' of the DML statement cannot have any enabled triggers if the statement contains an OUTPUT clause without INTO clause.
   at Microsoft.Data.SqlClient.SqlCommand.<>c.<ExecuteDbDataReaderAsync>b__209_0(Task`1 result)
   at System.Threading.Tasks.ContinuationResultTaskFromResultTask`2.InnerInvoke()
   at System.Threading.ExecutionContext.RunInternal(ExecutionContext executionContext, ContextCallback callback, Object state)
--- End of stack trace from previous location ---
   at System.Threading.ExecutionContext.RunInternal(ExecutionContext executionContext, ContextCallback callback, Object state)
   at System.Threading.Tasks.Task.ExecuteWithThreadLocal(Task& currentTaskSlot, Thread threadPoolThread)
--- End of stack trace from previous location ---
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
ClientConnectionId:14e679c4-643c-497b-b9b5-693f64e3dd00
Error Number:334,State:1,Class:16
   --- End of inner exception stack trace ---
   at Microsoft.EntityFrameworkCore.SqlServer.Update.Internal.SqlServerModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(IList`1 entriesToSave, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(StateManager stateManager, Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Storage.Internal.SqlServerExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
Microsoft.EntityFrameworkCore.DbUpdateException: Could not save changes because the target table has database triggers. Please configure your table accordingly, see https://aka.ms/efcore-docs-sqlserver-save-changes-and-output-clause for more information.
 ---> Microsoft.Data.SqlClient.SqlException (0x80131904): The target table 'user_notifications' of the DML statement cannot have any enabled triggers if the statement contains an OUTPUT clause without INTO clause.
   at Microsoft.Data.SqlClient.SqlCommand.<>c.<ExecuteDbDataReaderAsync>b__209_0(Task`1 result)
   at System.Threading.Tasks.ContinuationResultTaskFromResultTask`2.InnerInvoke()
   at System.Threading.ExecutionContext.RunInternal(ExecutionContext executionContext, ContextCallback callback, Object state)
--- End of stack trace from previous location ---
   at System.Threading.ExecutionContext.RunInternal(ExecutionContext executionContext, ContextCallback callback, Object state)
   at System.Threading.Tasks.Task.ExecuteWithThreadLocal(Task& currentTaskSlot, Thread threadPoolThread)
--- End of stack trace from previous location ---
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
ClientConnectionId:14e679c4-643c-497b-b9b5-693f64e3dd00
Error Number:334,State:1,Class:16
   --- End of inner exception stack trace ---
   at Microsoft.EntityFrameworkCore.SqlServer.Update.Internal.SqlServerModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(IList`1 entriesToSave, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(StateManager stateManager, Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Storage.Internal.SqlServerExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
2025-01-31 22:45:59.994 +03:00 [ERR] Failed to save notification for user: 1045678901
Microsoft.EntityFrameworkCore.DbUpdateException: Could not save changes because the target table has database triggers. Please configure your table accordingly, see https://aka.ms/efcore-docs-sqlserver-save-changes-and-output-clause for more information.
 ---> Microsoft.Data.SqlClient.SqlException (0x80131904): The target table 'user_notifications' of the DML statement cannot have any enabled triggers if the statement contains an OUTPUT clause without INTO clause.
   at Microsoft.Data.SqlClient.SqlCommand.<>c.<ExecuteDbDataReaderAsync>b__209_0(Task`1 result)
   at System.Threading.Tasks.ContinuationResultTaskFromResultTask`2.InnerInvoke()
   at System.Threading.ExecutionContext.RunInternal(ExecutionContext executionContext, ContextCallback callback, Object state)
--- End of stack trace from previous location ---
   at System.Threading.ExecutionContext.RunInternal(ExecutionContext executionContext, ContextCallback callback, Object state)
   at System.Threading.Tasks.Task.ExecuteWithThreadLocal(Task& currentTaskSlot, Thread threadPoolThread)
--- End of stack trace from previous location ---
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
ClientConnectionId:14e679c4-643c-497b-b9b5-693f64e3dd00
Error Number:334,State:1,Class:16
   --- End of inner exception stack trace ---
   at Microsoft.EntityFrameworkCore.SqlServer.Update.Internal.SqlServerModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(IList`1 entriesToSave, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(StateManager stateManager, Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Storage.Internal.SqlServerExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at NayifatAPI.Controllers.NotificationsController.SendNotification(SendNotificationRequest request) in C:\Users\yamta\StudioProjects\nayifat_app_2025_new\NayifatAPI\Controllers\NotificationsController.cs:line 269
2025-01-31 22:46:00.022 +03:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType9`2[[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Object, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-01-31 22:46:00.048 +03:00 [INF] Executed action NayifatAPI.Controllers.NotificationsController.SendNotification (NayifatAPI) in 3328.1055ms
2025-01-31 22:46:00.052 +03:00 [INF] Executed endpoint 'NayifatAPI.Controllers.NotificationsController.SendNotification (NayifatAPI)'
2025-01-31 22:46:00.068 +03:00 [INF] Request finished HTTP/1.1 POST http://localhost:5264/api/notifications/send - 200 null application/json; charset=utf-8 3679.7582ms
2025-01-31 22:47:18.135 +03:00 [INF] Application is shutting down...
2025-01-31 22:47:54.301 +03:00 [INF] Starting web application
2025-01-31 22:47:54.379 +03:00 [INF] Now listening on: http://localhost:5264
2025-01-31 22:47:54.383 +03:00 [INF] Application started. Press Ctrl+C to shut down.
2025-01-31 22:47:54.383 +03:00 [INF] Hosting environment: Development
2025-01-31 22:47:54.384 +03:00 [INF] Content root path: C:\Users\yamta\StudioProjects\nayifat_app_2025_new\NayifatAPI
2025-01-31 22:48:00.769 +03:00 [INF] Request starting HTTP/1.1 POST http://localhost:5264/api/notifications/send - application/json 244
2025-01-31 22:48:00.825 +03:00 [WRN] Failed to determine the https port for redirect.
2025-01-31 22:48:00.833 +03:00 [INF] Executing endpoint 'NayifatAPI.Controllers.NotificationsController.SendNotification (NayifatAPI)'
2025-01-31 22:48:00.864 +03:00 [INF] Route matched with {action = "SendNotification", controller = "Notifications"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] SendNotification(NayifatAPI.Controllers.SendNotificationRequest) on controller NayifatAPI.Controllers.NotificationsController (NayifatAPI).
2025-01-31 22:48:02.366 +03:00 [INF] Executed DbCommand (31ms) [Parameters=[@__providedApiKey_0='?' (Size = 255)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [a].[Key], [a].[CreatedAt], [a].[Description], [a].[ExpiresAt], [a].[IsActive], [a].[LastUsedAt]
FROM [ApiKeys] AS [a]
WHERE [a].[Key] = @__providedApiKey_0 AND [a].[IsActive] = CAST(1 AS bit)
2025-01-31 22:48:02.470 +03:00 [INF] Received notification request: {"Title":null,"TitleEn":"Test Notification","TitleAr":" ","Filters":{"Customers.City":{"ValueKind":"String","$type":"JsonElement"}},"NationalId":null,"NationalIds":null}
2025-01-31 22:48:02.486 +03:00 [INF] Starting GetTargetUsers with request type: Filtered Users
2025-01-31 22:48:02.488 +03:00 [INF] Applying filters: {"Customers.City":{"ValueKind":"String","$type":"JsonElement"}}
2025-01-31 22:48:02.489 +03:00 [INF] Using AND operation for filters
2025-01-31 22:48:02.491 +03:00 [INF] Processing filter: Customers.City with value: {"ValueKind":"String","$type":"JsonElement"}
2025-01-31 22:48:02.502 +03:00 [INF] Applied city filter: Riyadh
2025-01-31 22:48:02.525 +03:00 [INF] Final SQL Query: DECLARE @__ToString_0 nvarchar(4000) = N'Riyadh';

SELECT [c].[NationalId], [c].[AddNo], [c].[BuildingNo], [c].[City], [c].[Consent], [c].[ConsentDate], [c].[DateOfBirth], [c].[Dependents], [c].[District], [c].[Email], [c].[Employer], [c].[EmployerName], [c].[EmploymentStatus], [c].[FamilyNameAr], [c].[FamilyNameEn], [c].[FirstNameAr], [c].[FirstNameEn], [c].[Iban], [c].[IdExpiryDate], [c].[Language], [c].[Los], [c].[Mpin], [c].[MpinEnabled], [c].[NafathStatus], [c].[NafathTimestamp], [c].[Password], [c].[Phone], [c].[RegistrationDate], [c].[Salary], [c].[SalaryCustomer], [c].[SalaryDakhli], [c].[SecondNameAr], [c].[SecondNameEn], [c].[Sector], [c].[Street], [c].[ThirdNameAr], [c].[ThirdNameEn], [c].[Zipcode]
FROM [Customers] AS [c]
WHERE [c].[City] = @__ToString_0
2025-01-31 22:48:02.574 +03:00 [INF] Executed DbCommand (17ms) [Parameters=[@__ToString_0='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SELECT [c].[NationalId]
FROM [Customers] AS [c]
WHERE [c].[City] = @__ToString_0
2025-01-31 22:48:02.599 +03:00 [INF] Found 2 users after applying filters
2025-01-31 22:48:02.600 +03:00 [INF] Returning 2 distinct users
2025-01-31 22:48:02.601 +03:00 [INF] Target users query completed. Found 2 users
2025-01-31 22:48:02.602 +03:00 [INF] Found 2 target users for notification
2025-01-31 22:48:02.772 +03:00 [INF] Executed DbCommand (15ms) [Parameters=[@p0='?' (Size = 4000), @p1='?' (Size = 8000) (DbType = AnsiString), @p2='?' (Size = 8000) (DbType = AnsiString), @p3='?' (Size = 8000) (DbType = AnsiString), @p4='?' (DbType = DateTime2), @p5='?' (DbType = DateTime2), @p6='?' (Size = 255), @p7='?' (Size = 4000), @p8='?' (Size = 255), @p9='?' (Size = 255), @p10='?' (Size = 255)], CommandType='"Text"', CommandTimeout='30']
SET IMPLICIT_TRANSACTIONS OFF;
SET NOCOUNT ON;
INSERT INTO [notification_templates] ([additional_data], [Body], [body_ar], [body_en], [created_at], [expiry_at], [Route], [target_criteria], [Title], [title_ar], [title_en])
OUTPUT INSERTED.[Id]
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7, @p8, @p9, @p10);
2025-01-31 22:48:02.804 +03:00 [INF] Created notification template with ID: 4
2025-01-31 22:48:02.862 +03:00 [INF] Executed DbCommand (6ms) [Parameters=[@p0='?' (Size = 4000), @p1='?' (DbType = DateTime2), @p2='?' (Size = 4000), @p3='?' (Size = 4000), @p4='?' (Size = 4000), @p5='?' (Size = 450), @p6='?' (Size = 4000), @p7='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SET IMPLICIT_TRANSACTIONS OFF;
SET NOCOUNT ON;
INSERT INTO [AuthLogs] ([AuthType], [CreatedAt], [DeviceId], [FailureReason], [IpAddress], [NationalId], [Status], [UserAgent])
OUTPUT INSERTED.[Id]
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7);
2025-01-31 22:48:02.885 +03:00 [ERR] An exception occurred in the database while saving changes for context type 'NayifatAPI.Data.ApplicationDbContext'.
Microsoft.EntityFrameworkCore.DbUpdateException: An error occurred while saving the entity changes. See the inner exception for details.
 ---> Microsoft.Data.SqlClient.SqlException (0x80131904): Cannot insert the value NULL into column 'NationalId', table 'NayifatApp.dbo.AuthLogs'; column does not allow nulls. INSERT fails.
   at Microsoft.Data.SqlClient.SqlConnection.OnError(SqlException exception, Boolean breakConnection, Action`1 wrapCloseInAction)
   at Microsoft.Data.SqlClient.SqlInternalConnection.OnError(SqlException exception, Boolean breakConnection, Action`1 wrapCloseInAction)
   at Microsoft.Data.SqlClient.TdsParser.ThrowExceptionAndWarning(TdsParserStateObject stateObj, Boolean callerHasConnectionLock, Boolean asyncClose)
   at Microsoft.Data.SqlClient.TdsParser.TryRun(RunBehavior runBehavior, SqlCommand cmdHandler, SqlDataReader dataStream, BulkCopySimpleResultSet bulkCopyHandler, TdsParserStateObject stateObj, Boolean& dataReady)
   at Microsoft.Data.SqlClient.SqlDataReader.TryHasMoreRows(Boolean& moreRows)
   at Microsoft.Data.SqlClient.SqlDataReader.TryReadInternal(Boolean setTimeout, Boolean& more)
   at Microsoft.Data.SqlClient.SqlDataReader.ReadAsyncExecute(Task task, Object state)
   at Microsoft.Data.SqlClient.SqlDataReader.InvokeAsyncCall[T](SqlDataReaderBaseAsyncCallContext`1 context)
--- End of stack trace from previous location ---
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeResultSetAsync(Int32 startCommandIndex, RelationalDataReader reader, CancellationToken cancellationToken)
ClientConnectionId:de0109c5-0c19-4f47-86f4-496cca4f56ac
Error Number:515,State:2,Class:16
   --- End of inner exception stack trace ---
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeResultSetAsync(Int32 startCommandIndex, RelationalDataReader reader, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeAsync(RelationalDataReader reader, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Update.Internal.SqlServerModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(IList`1 entriesToSave, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(StateManager stateManager, Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Storage.Internal.SqlServerExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
Microsoft.EntityFrameworkCore.DbUpdateException: An error occurred while saving the entity changes. See the inner exception for details.
 ---> Microsoft.Data.SqlClient.SqlException (0x80131904): Cannot insert the value NULL into column 'NationalId', table 'NayifatApp.dbo.AuthLogs'; column does not allow nulls. INSERT fails.
   at Microsoft.Data.SqlClient.SqlConnection.OnError(SqlException exception, Boolean breakConnection, Action`1 wrapCloseInAction)
   at Microsoft.Data.SqlClient.SqlInternalConnection.OnError(SqlException exception, Boolean breakConnection, Action`1 wrapCloseInAction)
   at Microsoft.Data.SqlClient.TdsParser.ThrowExceptionAndWarning(TdsParserStateObject stateObj, Boolean callerHasConnectionLock, Boolean asyncClose)
   at Microsoft.Data.SqlClient.TdsParser.TryRun(RunBehavior runBehavior, SqlCommand cmdHandler, SqlDataReader dataStream, BulkCopySimpleResultSet bulkCopyHandler, TdsParserStateObject stateObj, Boolean& dataReady)
   at Microsoft.Data.SqlClient.SqlDataReader.TryHasMoreRows(Boolean& moreRows)
   at Microsoft.Data.SqlClient.SqlDataReader.TryReadInternal(Boolean setTimeout, Boolean& more)
   at Microsoft.Data.SqlClient.SqlDataReader.ReadAsyncExecute(Task task, Object state)
   at Microsoft.Data.SqlClient.SqlDataReader.InvokeAsyncCall[T](SqlDataReaderBaseAsyncCallContext`1 context)
--- End of stack trace from previous location ---
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeResultSetAsync(Int32 startCommandIndex, RelationalDataReader reader, CancellationToken cancellationToken)
ClientConnectionId:de0109c5-0c19-4f47-86f4-496cca4f56ac
Error Number:515,State:2,Class:16
   --- End of inner exception stack trace ---
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeResultSetAsync(Int32 startCommandIndex, RelationalDataReader reader, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeAsync(RelationalDataReader reader, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Update.Internal.SqlServerModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(IList`1 entriesToSave, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(StateManager stateManager, Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Storage.Internal.SqlServerExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
2025-01-31 22:48:02.915 +03:00 [ERR] Error logging audit event. NationalId: null, Action: notification_sent, Details: {"template_id":4,"recipient_count":2,"target_criteria":{"Customers.City":"Riyadh"},"timestamp":"2025-01-31T19:48:02.6086919Z"}
Microsoft.EntityFrameworkCore.DbUpdateException: An error occurred while saving the entity changes. See the inner exception for details.
 ---> Microsoft.Data.SqlClient.SqlException (0x80131904): Cannot insert the value NULL into column 'NationalId', table 'NayifatApp.dbo.AuthLogs'; column does not allow nulls. INSERT fails.
   at Microsoft.Data.SqlClient.SqlConnection.OnError(SqlException exception, Boolean breakConnection, Action`1 wrapCloseInAction)
   at Microsoft.Data.SqlClient.SqlInternalConnection.OnError(SqlException exception, Boolean breakConnection, Action`1 wrapCloseInAction)
   at Microsoft.Data.SqlClient.TdsParser.ThrowExceptionAndWarning(TdsParserStateObject stateObj, Boolean callerHasConnectionLock, Boolean asyncClose)
   at Microsoft.Data.SqlClient.TdsParser.TryRun(RunBehavior runBehavior, SqlCommand cmdHandler, SqlDataReader dataStream, BulkCopySimpleResultSet bulkCopyHandler, TdsParserStateObject stateObj, Boolean& dataReady)
   at Microsoft.Data.SqlClient.SqlDataReader.TryHasMoreRows(Boolean& moreRows)
   at Microsoft.Data.SqlClient.SqlDataReader.TryReadInternal(Boolean setTimeout, Boolean& more)
   at Microsoft.Data.SqlClient.SqlDataReader.ReadAsyncExecute(Task task, Object state)
   at Microsoft.Data.SqlClient.SqlDataReader.InvokeAsyncCall[T](SqlDataReaderBaseAsyncCallContext`1 context)
--- End of stack trace from previous location ---
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeResultSetAsync(Int32 startCommandIndex, RelationalDataReader reader, CancellationToken cancellationToken)
ClientConnectionId:de0109c5-0c19-4f47-86f4-496cca4f56ac
Error Number:515,State:2,Class:16
   --- End of inner exception stack trace ---
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeResultSetAsync(Int32 startCommandIndex, RelationalDataReader reader, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeAsync(RelationalDataReader reader, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Update.Internal.SqlServerModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(IList`1 entriesToSave, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(StateManager stateManager, Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Storage.Internal.SqlServerExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at NayifatAPI.Services.AuditLogService.LogAsync(String nationalId, String action, Object details) in C:\Users\yamta\StudioProjects\nayifat_app_2025_new\NayifatAPI\Services\AuditLogService.cs:line 36
2025-01-31 22:48:02.955 +03:00 [INF] Executed DbCommand (3ms) [Parameters=[@__userId_0='?' (Size = 450)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [u].[national_id], [u].[last_updated], [u].[notifications]
FROM [user_notifications] AS [u]
WHERE [u].[national_id] = @__userId_0
2025-01-31 22:48:02.970 +03:00 [INF] Processing notification for user 1012345678. Existing notification record: true
2025-01-31 22:48:02.972 +03:00 [INF] Current notifications count for user 1012345678: 1
2025-01-31 22:48:02.983 +03:00 [INF] Serialized new notifications for user 1012345678. Length: 278
2025-01-31 22:48:02.984 +03:00 [INF] Updated existing UserNotification for user: 1012345678
2025-01-31 22:48:03.016 +03:00 [ERR] Failed executing DbCommand (9ms) [Parameters=[@p0='?' (Size = 4000), @p1='?' (DbType = DateTime2), @p2='?' (Size = 4000), @p3='?' (Size = 4000), @p4='?' (Size = 4000), @p5='?' (Size = 450), @p6='?' (Size = 4000), @p7='?' (Size = 4000), @p10='?' (Size = 450), @p8='?' (DbType = DateTime2), @p9='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SET NOCOUNT ON;
INSERT INTO [AuthLogs] ([AuthType], [CreatedAt], [DeviceId], [FailureReason], [IpAddress], [NationalId], [Status], [UserAgent])
OUTPUT INSERTED.[Id]
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7);
UPDATE [user_notifications] SET [last_updated] = @p8, [notifications] = @p9
OUTPUT 1
WHERE [national_id] = @p10;
2025-01-31 22:48:03.030 +03:00 [ERR] An exception occurred in the database while saving changes for context type 'NayifatAPI.Data.ApplicationDbContext'.
Microsoft.EntityFrameworkCore.DbUpdateException: Could not save changes because the target table has database triggers. Please configure your table accordingly, see https://aka.ms/efcore-docs-sqlserver-save-changes-and-output-clause for more information.
 ---> Microsoft.Data.SqlClient.SqlException (0x80131904): The target table 'user_notifications' of the DML statement cannot have any enabled triggers if the statement contains an OUTPUT clause without INTO clause.
   at Microsoft.Data.SqlClient.SqlCommand.<>c.<ExecuteDbDataReaderAsync>b__209_0(Task`1 result)
   at System.Threading.Tasks.ContinuationResultTaskFromResultTask`2.InnerInvoke()
   at System.Threading.ExecutionContext.RunInternal(ExecutionContext executionContext, ContextCallback callback, Object state)
--- End of stack trace from previous location ---
   at System.Threading.ExecutionContext.RunInternal(ExecutionContext executionContext, ContextCallback callback, Object state)
   at System.Threading.Tasks.Task.ExecuteWithThreadLocal(Task& currentTaskSlot, Thread threadPoolThread)
--- End of stack trace from previous location ---
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
ClientConnectionId:de0109c5-0c19-4f47-86f4-496cca4f56ac
Error Number:334,State:1,Class:16
   --- End of inner exception stack trace ---
   at Microsoft.EntityFrameworkCore.SqlServer.Update.Internal.SqlServerModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(IList`1 entriesToSave, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(StateManager stateManager, Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Storage.Internal.SqlServerExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
Microsoft.EntityFrameworkCore.DbUpdateException: Could not save changes because the target table has database triggers. Please configure your table accordingly, see https://aka.ms/efcore-docs-sqlserver-save-changes-and-output-clause for more information.
 ---> Microsoft.Data.SqlClient.SqlException (0x80131904): The target table 'user_notifications' of the DML statement cannot have any enabled triggers if the statement contains an OUTPUT clause without INTO clause.
   at Microsoft.Data.SqlClient.SqlCommand.<>c.<ExecuteDbDataReaderAsync>b__209_0(Task`1 result)
   at System.Threading.Tasks.ContinuationResultTaskFromResultTask`2.InnerInvoke()
   at System.Threading.ExecutionContext.RunInternal(ExecutionContext executionContext, ContextCallback callback, Object state)
--- End of stack trace from previous location ---
   at System.Threading.ExecutionContext.RunInternal(ExecutionContext executionContext, ContextCallback callback, Object state)
   at System.Threading.Tasks.Task.ExecuteWithThreadLocal(Task& currentTaskSlot, Thread threadPoolThread)
--- End of stack trace from previous location ---
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
ClientConnectionId:de0109c5-0c19-4f47-86f4-496cca4f56ac
Error Number:334,State:1,Class:16
   --- End of inner exception stack trace ---
   at Microsoft.EntityFrameworkCore.SqlServer.Update.Internal.SqlServerModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(IList`1 entriesToSave, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(StateManager stateManager, Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Storage.Internal.SqlServerExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
2025-01-31 22:48:03.041 +03:00 [ERR] Failed to save changes for user 1012345678. Error: Could not save changes because the target table has database triggers. Please configure your table accordingly, see https://aka.ms/efcore-docs-sqlserver-save-changes-and-output-clause for more information.
Microsoft.EntityFrameworkCore.DbUpdateException: Could not save changes because the target table has database triggers. Please configure your table accordingly, see https://aka.ms/efcore-docs-sqlserver-save-changes-and-output-clause for more information.
 ---> Microsoft.Data.SqlClient.SqlException (0x80131904): The target table 'user_notifications' of the DML statement cannot have any enabled triggers if the statement contains an OUTPUT clause without INTO clause.
   at Microsoft.Data.SqlClient.SqlCommand.<>c.<ExecuteDbDataReaderAsync>b__209_0(Task`1 result)
   at System.Threading.Tasks.ContinuationResultTaskFromResultTask`2.InnerInvoke()
   at System.Threading.ExecutionContext.RunInternal(ExecutionContext executionContext, ContextCallback callback, Object state)
--- End of stack trace from previous location ---
   at System.Threading.ExecutionContext.RunInternal(ExecutionContext executionContext, ContextCallback callback, Object state)
   at System.Threading.Tasks.Task.ExecuteWithThreadLocal(Task& currentTaskSlot, Thread threadPoolThread)
--- End of stack trace from previous location ---
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
ClientConnectionId:de0109c5-0c19-4f47-86f4-496cca4f56ac
Error Number:334,State:1,Class:16
   --- End of inner exception stack trace ---
   at Microsoft.EntityFrameworkCore.SqlServer.Update.Internal.SqlServerModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(IList`1 entriesToSave, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(StateManager stateManager, Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Storage.Internal.SqlServerExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at NayifatAPI.Controllers.NotificationsController.SendNotification(SendNotificationRequest request) in C:\Users\yamta\StudioProjects\nayifat_app_2025_new\NayifatAPI\Controllers\NotificationsController.cs:line 281
2025-01-31 22:48:03.056 +03:00 [ERR] Failed to process notification for user: 1012345678. Error: Could not save changes because the target table has database triggers. Please configure your table accordingly, see https://aka.ms/efcore-docs-sqlserver-save-changes-and-output-clause for more information.
Microsoft.EntityFrameworkCore.DbUpdateException: Could not save changes because the target table has database triggers. Please configure your table accordingly, see https://aka.ms/efcore-docs-sqlserver-save-changes-and-output-clause for more information.
 ---> Microsoft.Data.SqlClient.SqlException (0x80131904): The target table 'user_notifications' of the DML statement cannot have any enabled triggers if the statement contains an OUTPUT clause without INTO clause.
   at Microsoft.Data.SqlClient.SqlCommand.<>c.<ExecuteDbDataReaderAsync>b__209_0(Task`1 result)
   at System.Threading.Tasks.ContinuationResultTaskFromResultTask`2.InnerInvoke()
   at System.Threading.ExecutionContext.RunInternal(ExecutionContext executionContext, ContextCallback callback, Object state)
--- End of stack trace from previous location ---
   at System.Threading.ExecutionContext.RunInternal(ExecutionContext executionContext, ContextCallback callback, Object state)
   at System.Threading.Tasks.Task.ExecuteWithThreadLocal(Task& currentTaskSlot, Thread threadPoolThread)
--- End of stack trace from previous location ---
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
ClientConnectionId:de0109c5-0c19-4f47-86f4-496cca4f56ac
Error Number:334,State:1,Class:16
   --- End of inner exception stack trace ---
   at Microsoft.EntityFrameworkCore.SqlServer.Update.Internal.SqlServerModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(IList`1 entriesToSave, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(StateManager stateManager, Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Storage.Internal.SqlServerExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at NayifatAPI.Controllers.NotificationsController.SendNotification(SendNotificationRequest request) in C:\Users\yamta\StudioProjects\nayifat_app_2025_new\NayifatAPI\Controllers\NotificationsController.cs:line 281
2025-01-31 22:48:03.073 +03:00 [INF] Processing notification for user 1045678901. Existing notification record: false
2025-01-31 22:48:03.074 +03:00 [INF] Current notifications count for user 1045678901: 0
2025-01-31 22:48:03.075 +03:00 [INF] Serialized new notifications for user 1045678901. Length: 139
2025-01-31 22:48:03.080 +03:00 [INF] Created new UserNotification entry for user: 1045678901
2025-01-31 22:48:03.090 +03:00 [ERR] Failed executing DbCommand (2ms) [Parameters=[@p0='?' (Size = 4000), @p1='?' (DbType = DateTime2), @p2='?' (Size = 4000), @p3='?' (Size = 4000), @p4='?' (Size = 4000), @p5='?' (Size = 450), @p6='?' (Size = 4000), @p7='?' (Size = 4000), @p10='?' (Size = 450), @p8='?' (DbType = DateTime2), @p9='?' (Size = 4000), @p11='?' (Size = 450), @p12='?' (DbType = DateTime2), @p13='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SET NOCOUNT ON;
INSERT INTO [AuthLogs] ([AuthType], [CreatedAt], [DeviceId], [FailureReason], [IpAddress], [NationalId], [Status], [UserAgent])
OUTPUT INSERTED.[Id]
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7);
UPDATE [user_notifications] SET [last_updated] = @p8, [notifications] = @p9
OUTPUT 1
WHERE [national_id] = @p10;
INSERT INTO [user_notifications] ([national_id], [last_updated], [notifications])
VALUES (@p11, @p12, @p13);
2025-01-31 22:48:03.097 +03:00 [ERR] An exception occurred in the database while saving changes for context type 'NayifatAPI.Data.ApplicationDbContext'.
Microsoft.EntityFrameworkCore.DbUpdateException: Could not save changes because the target table has database triggers. Please configure your table accordingly, see https://aka.ms/efcore-docs-sqlserver-save-changes-and-output-clause for more information.
 ---> Microsoft.Data.SqlClient.SqlException (0x80131904): The target table 'user_notifications' of the DML statement cannot have any enabled triggers if the statement contains an OUTPUT clause without INTO clause.
   at Microsoft.Data.SqlClient.SqlCommand.<>c.<ExecuteDbDataReaderAsync>b__209_0(Task`1 result)
   at System.Threading.Tasks.ContinuationResultTaskFromResultTask`2.InnerInvoke()
   at System.Threading.ExecutionContext.RunInternal(ExecutionContext executionContext, ContextCallback callback, Object state)
--- End of stack trace from previous location ---
   at System.Threading.ExecutionContext.RunInternal(ExecutionContext executionContext, ContextCallback callback, Object state)
   at System.Threading.Tasks.Task.ExecuteWithThreadLocal(Task& currentTaskSlot, Thread threadPoolThread)
--- End of stack trace from previous location ---
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
ClientConnectionId:de0109c5-0c19-4f47-86f4-496cca4f56ac
Error Number:334,State:1,Class:16
   --- End of inner exception stack trace ---
   at Microsoft.EntityFrameworkCore.SqlServer.Update.Internal.SqlServerModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(IList`1 entriesToSave, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(StateManager stateManager, Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Storage.Internal.SqlServerExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
Microsoft.EntityFrameworkCore.DbUpdateException: Could not save changes because the target table has database triggers. Please configure your table accordingly, see https://aka.ms/efcore-docs-sqlserver-save-changes-and-output-clause for more information.
 ---> Microsoft.Data.SqlClient.SqlException (0x80131904): The target table 'user_notifications' of the DML statement cannot have any enabled triggers if the statement contains an OUTPUT clause without INTO clause.
   at Microsoft.Data.SqlClient.SqlCommand.<>c.<ExecuteDbDataReaderAsync>b__209_0(Task`1 result)
   at System.Threading.Tasks.ContinuationResultTaskFromResultTask`2.InnerInvoke()
   at System.Threading.ExecutionContext.RunInternal(ExecutionContext executionContext, ContextCallback callback, Object state)
--- End of stack trace from previous location ---
   at System.Threading.ExecutionContext.RunInternal(ExecutionContext executionContext, ContextCallback callback, Object state)
   at System.Threading.Tasks.Task.ExecuteWithThreadLocal(Task& currentTaskSlot, Thread threadPoolThread)
--- End of stack trace from previous location ---
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
ClientConnectionId:de0109c5-0c19-4f47-86f4-496cca4f56ac
Error Number:334,State:1,Class:16
   --- End of inner exception stack trace ---
   at Microsoft.EntityFrameworkCore.SqlServer.Update.Internal.SqlServerModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(IList`1 entriesToSave, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(StateManager stateManager, Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Storage.Internal.SqlServerExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
2025-01-31 22:48:03.112 +03:00 [ERR] Failed to save changes for user 1045678901. Error: Could not save changes because the target table has database triggers. Please configure your table accordingly, see https://aka.ms/efcore-docs-sqlserver-save-changes-and-output-clause for more information.
Microsoft.EntityFrameworkCore.DbUpdateException: Could not save changes because the target table has database triggers. Please configure your table accordingly, see https://aka.ms/efcore-docs-sqlserver-save-changes-and-output-clause for more information.
 ---> Microsoft.Data.SqlClient.SqlException (0x80131904): The target table 'user_notifications' of the DML statement cannot have any enabled triggers if the statement contains an OUTPUT clause without INTO clause.
   at Microsoft.Data.SqlClient.SqlCommand.<>c.<ExecuteDbDataReaderAsync>b__209_0(Task`1 result)
   at System.Threading.Tasks.ContinuationResultTaskFromResultTask`2.InnerInvoke()
   at System.Threading.ExecutionContext.RunInternal(ExecutionContext executionContext, ContextCallback callback, Object state)
--- End of stack trace from previous location ---
   at System.Threading.ExecutionContext.RunInternal(ExecutionContext executionContext, ContextCallback callback, Object state)
   at System.Threading.Tasks.Task.ExecuteWithThreadLocal(Task& currentTaskSlot, Thread threadPoolThread)
--- End of stack trace from previous location ---
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
ClientConnectionId:de0109c5-0c19-4f47-86f4-496cca4f56ac
Error Number:334,State:1,Class:16
   --- End of inner exception stack trace ---
   at Microsoft.EntityFrameworkCore.SqlServer.Update.Internal.SqlServerModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(IList`1 entriesToSave, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(StateManager stateManager, Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Storage.Internal.SqlServerExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at NayifatAPI.Controllers.NotificationsController.SendNotification(SendNotificationRequest request) in C:\Users\yamta\StudioProjects\nayifat_app_2025_new\NayifatAPI\Controllers\NotificationsController.cs:line 281
2025-01-31 22:48:03.122 +03:00 [ERR] Failed to process notification for user: 1045678901. Error: Could not save changes because the target table has database triggers. Please configure your table accordingly, see https://aka.ms/efcore-docs-sqlserver-save-changes-and-output-clause for more information.
Microsoft.EntityFrameworkCore.DbUpdateException: Could not save changes because the target table has database triggers. Please configure your table accordingly, see https://aka.ms/efcore-docs-sqlserver-save-changes-and-output-clause for more information.
 ---> Microsoft.Data.SqlClient.SqlException (0x80131904): The target table 'user_notifications' of the DML statement cannot have any enabled triggers if the statement contains an OUTPUT clause without INTO clause.
   at Microsoft.Data.SqlClient.SqlCommand.<>c.<ExecuteDbDataReaderAsync>b__209_0(Task`1 result)
   at System.Threading.Tasks.ContinuationResultTaskFromResultTask`2.InnerInvoke()
   at System.Threading.ExecutionContext.RunInternal(ExecutionContext executionContext, ContextCallback callback, Object state)
--- End of stack trace from previous location ---
   at System.Threading.ExecutionContext.RunInternal(ExecutionContext executionContext, ContextCallback callback, Object state)
   at System.Threading.Tasks.Task.ExecuteWithThreadLocal(Task& currentTaskSlot, Thread threadPoolThread)
--- End of stack trace from previous location ---
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
ClientConnectionId:de0109c5-0c19-4f47-86f4-496cca4f56ac
Error Number:334,State:1,Class:16
   --- End of inner exception stack trace ---
   at Microsoft.EntityFrameworkCore.SqlServer.Update.Internal.SqlServerModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(IList`1 entriesToSave, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(StateManager stateManager, Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Storage.Internal.SqlServerExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at NayifatAPI.Controllers.NotificationsController.SendNotification(SendNotificationRequest request) in C:\Users\yamta\StudioProjects\nayifat_app_2025_new\NayifatAPI\Controllers\NotificationsController.cs:line 281
2025-01-31 22:48:03.138 +03:00 [ERR] Failed to send notifications to any users. Total targets: 2
2025-01-31 22:48:03.150 +03:00 [INF] Executing ObjectResult, writing value of type '<>f__AnonymousType11`2[[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-01-31 22:48:03.172 +03:00 [INF] Executed action NayifatAPI.Controllers.NotificationsController.SendNotification (NayifatAPI) in 2303.9449ms
2025-01-31 22:48:03.179 +03:00 [INF] Executed endpoint 'NayifatAPI.Controllers.NotificationsController.SendNotification (NayifatAPI)'
2025-01-31 22:48:03.198 +03:00 [INF] Request finished HTTP/1.1 POST http://localhost:5264/api/notifications/send - 500 null application/json; charset=utf-8 2430.2626ms
2025-01-31 22:49:10.151 +03:00 [INF] Application is shutting down...
2025-01-31 22:49:21.372 +03:00 [INF] Starting web application
2025-01-31 22:49:21.504 +03:00 [INF] Now listening on: http://localhost:5264
2025-01-31 22:49:21.511 +03:00 [INF] Application started. Press Ctrl+C to shut down.
2025-01-31 22:49:21.512 +03:00 [INF] Hosting environment: Development
2025-01-31 22:49:21.513 +03:00 [INF] Content root path: C:\Users\yamta\StudioProjects\nayifat_app_2025_new\NayifatAPI
2025-01-31 22:49:26.589 +03:00 [INF] Request starting HTTP/1.1 POST http://localhost:5264/api/notifications/send - application/json 244
2025-01-31 22:49:26.647 +03:00 [WRN] Failed to determine the https port for redirect.
2025-01-31 22:49:26.650 +03:00 [INF] Executing endpoint 'NayifatAPI.Controllers.NotificationsController.SendNotification (NayifatAPI)'
2025-01-31 22:49:26.678 +03:00 [INF] Route matched with {action = "SendNotification", controller = "Notifications"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] SendNotification(NayifatAPI.Controllers.SendNotificationRequest) on controller NayifatAPI.Controllers.NotificationsController (NayifatAPI).
2025-01-31 22:49:28.112 +03:00 [INF] Executed DbCommand (27ms) [Parameters=[@__providedApiKey_0='?' (Size = 255)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [a].[Key], [a].[CreatedAt], [a].[Description], [a].[ExpiresAt], [a].[IsActive], [a].[LastUsedAt]
FROM [ApiKeys] AS [a]
WHERE [a].[Key] = @__providedApiKey_0 AND [a].[IsActive] = CAST(1 AS bit)
2025-01-31 22:49:28.198 +03:00 [INF] Received notification request: {"Title":null,"TitleEn":"Test Notification","TitleAr":" ","Filters":{"Customers.City":{"ValueKind":"String","$type":"JsonElement"}},"NationalId":null,"NationalIds":null}
2025-01-31 22:49:28.213 +03:00 [INF] Starting GetTargetUsers with request type: Filtered Users
2025-01-31 22:49:28.214 +03:00 [INF] Applying filters: {"Customers.City":{"ValueKind":"String","$type":"JsonElement"}}
2025-01-31 22:49:28.216 +03:00 [INF] Using AND operation for filters
2025-01-31 22:49:28.217 +03:00 [INF] Processing filter: Customers.City with value: {"ValueKind":"String","$type":"JsonElement"}
2025-01-31 22:49:28.221 +03:00 [INF] Applied city filter: Riyadh
2025-01-31 22:49:28.251 +03:00 [INF] Final SQL Query: DECLARE @__ToString_0 nvarchar(4000) = N'Riyadh';

SELECT [c].[NationalId], [c].[AddNo], [c].[BuildingNo], [c].[City], [c].[Consent], [c].[ConsentDate], [c].[DateOfBirth], [c].[Dependents], [c].[District], [c].[Email], [c].[Employer], [c].[EmployerName], [c].[EmploymentStatus], [c].[FamilyNameAr], [c].[FamilyNameEn], [c].[FirstNameAr], [c].[FirstNameEn], [c].[Iban], [c].[IdExpiryDate], [c].[Language], [c].[Los], [c].[Mpin], [c].[MpinEnabled], [c].[NafathStatus], [c].[NafathTimestamp], [c].[Password], [c].[Phone], [c].[RegistrationDate], [c].[Salary], [c].[SalaryCustomer], [c].[SalaryDakhli], [c].[SecondNameAr], [c].[SecondNameEn], [c].[Sector], [c].[Street], [c].[ThirdNameAr], [c].[ThirdNameEn], [c].[Zipcode]
FROM [Customers] AS [c]
WHERE [c].[City] = @__ToString_0
2025-01-31 22:49:28.294 +03:00 [INF] Executed DbCommand (15ms) [Parameters=[@__ToString_0='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SELECT [c].[NationalId]
FROM [Customers] AS [c]
WHERE [c].[City] = @__ToString_0
2025-01-31 22:49:28.306 +03:00 [INF] Found 2 users after applying filters
2025-01-31 22:49:28.308 +03:00 [INF] Returning 2 distinct users
2025-01-31 22:49:28.310 +03:00 [INF] Target users query completed. Found 2 users
2025-01-31 22:49:28.311 +03:00 [INF] Found 2 target users for notification
2025-01-31 22:49:28.468 +03:00 [INF] Executed DbCommand (10ms) [Parameters=[@p0='?' (Size = 4000), @p1='?' (Size = 8000) (DbType = AnsiString), @p2='?' (Size = 8000) (DbType = AnsiString), @p3='?' (Size = 8000) (DbType = AnsiString), @p4='?' (DbType = DateTime2), @p5='?' (DbType = DateTime2), @p6='?' (Size = 255), @p7='?' (Size = 4000), @p8='?' (Size = 255), @p9='?' (Size = 255), @p10='?' (Size = 255)], CommandType='"Text"', CommandTimeout='30']
SET IMPLICIT_TRANSACTIONS OFF;
SET NOCOUNT ON;
INSERT INTO [notification_templates] ([additional_data], [Body], [body_ar], [body_en], [created_at], [expiry_at], [Route], [target_criteria], [Title], [title_ar], [title_en])
OUTPUT INSERTED.[Id]
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7, @p8, @p9, @p10);
2025-01-31 22:49:28.499 +03:00 [INF] Created notification template with ID: 5
2025-01-31 22:49:28.559 +03:00 [INF] Executed DbCommand (8ms) [Parameters=[@p0='?' (Size = 4000), @p1='?' (DbType = DateTime2), @p2='?' (Size = 4000), @p3='?' (Size = 4000), @p4='?' (Size = 4000), @p5='?' (Size = 450), @p6='?' (Size = 4000), @p7='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SET IMPLICIT_TRANSACTIONS OFF;
SET NOCOUNT ON;
INSERT INTO [AuthLogs] ([AuthType], [CreatedAt], [DeviceId], [FailureReason], [IpAddress], [NationalId], [Status], [UserAgent])
OUTPUT INSERTED.[Id]
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7);
2025-01-31 22:49:28.580 +03:00 [INF] Executed DbCommand (3ms) [Parameters=[@__userId_0='?' (Size = 450)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [u].[national_id], [u].[last_updated], [u].[notifications]
FROM [user_notifications] AS [u]
WHERE [u].[national_id] = @__userId_0
2025-01-31 22:49:28.594 +03:00 [INF] Processing notification for user 1012345678. Existing notification record: true
2025-01-31 22:49:28.597 +03:00 [INF] Current notifications count for user 1012345678: 1
2025-01-31 22:49:28.616 +03:00 [INF] Serialized new notifications for user 1012345678. Length: 279
2025-01-31 22:49:28.678 +03:00 [INF] Executed DbCommand (53ms) [Parameters=[@p0='?' (Size = 4000), @p1='?' (DbType = DateTime2), @p2='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
UPDATE user_notifications SET notifications = @p0, last_updated = @p1 WHERE national_id = @p2
2025-01-31 22:49:28.681 +03:00 [INF] Updated existing UserNotification for user: 1012345678
2025-01-31 22:49:28.685 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@__userId_0='?' (Size = 450)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [u].[national_id], [u].[last_updated], [u].[notifications]
FROM [user_notifications] AS [u]
WHERE [u].[national_id] = @__userId_0
2025-01-31 22:49:28.687 +03:00 [INF] Processing notification for user 1045678901. Existing notification record: false
2025-01-31 22:49:28.687 +03:00 [INF] Current notifications count for user 1045678901: 0
2025-01-31 22:49:28.691 +03:00 [INF] Serialized new notifications for user 1045678901. Length: 140
2025-01-31 22:49:28.695 +03:00 [INF] Executed DbCommand (2ms) [Parameters=[@p0='?' (Size = 4000), @p1='?' (Size = 4000), @p2='?' (DbType = DateTime2)], CommandType='"Text"', CommandTimeout='30']
INSERT INTO user_notifications (national_id, notifications, last_updated) VALUES (@p0, @p1, @p2)
2025-01-31 22:49:28.698 +03:00 [INF] Created new UserNotification entry for user: 1045678901
2025-01-31 22:49:28.705 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@p0='?' (Size = 4000), @p1='?' (DbType = DateTime2), @p2='?' (Size = 4000), @p3='?' (Size = 4000), @p4='?' (Size = 4000), @p5='?' (Size = 450), @p6='?' (Size = 4000), @p7='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SET IMPLICIT_TRANSACTIONS OFF;
SET NOCOUNT ON;
INSERT INTO [AuthLogs] ([AuthType], [CreatedAt], [DeviceId], [FailureReason], [IpAddress], [NationalId], [Status], [UserAgent])
OUTPUT INSERTED.[Id]
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7);
2025-01-31 22:49:28.711 +03:00 [INF] Successfully sent notifications. Template: 5, Success: 2, Total: 2
2025-01-31 22:49:28.717 +03:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType9`2[[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Object, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-01-31 22:49:28.745 +03:00 [INF] Executed action NayifatAPI.Controllers.NotificationsController.SendNotification (NayifatAPI) in 2054.8533ms
2025-01-31 22:49:28.747 +03:00 [INF] Executed endpoint 'NayifatAPI.Controllers.NotificationsController.SendNotification (NayifatAPI)'
2025-01-31 22:49:28.763 +03:00 [INF] Request finished HTTP/1.1 POST http://localhost:5264/api/notifications/send - 200 null application/json; charset=utf-8 2175.3433ms
2025-01-31 22:52:04.090 +03:00 [INF] Request starting HTTP/1.1 POST http://localhost:5264/api/notifications/send - application/json 216
2025-01-31 22:52:04.096 +03:00 [INF] Executing endpoint 'NayifatAPI.Controllers.NotificationsController.SendNotification (NayifatAPI)'
2025-01-31 22:52:04.098 +03:00 [INF] Route matched with {action = "SendNotification", controller = "Notifications"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] SendNotification(NayifatAPI.Controllers.SendNotificationRequest) on controller NayifatAPI.Controllers.NotificationsController (NayifatAPI).
2025-01-31 22:52:04.134 +03:00 [INF] Executed DbCommand (3ms) [Parameters=[@__providedApiKey_0='?' (Size = 255)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [a].[Key], [a].[CreatedAt], [a].[Description], [a].[ExpiresAt], [a].[IsActive], [a].[LastUsedAt]
FROM [ApiKeys] AS [a]
WHERE [a].[Key] = @__providedApiKey_0 AND [a].[IsActive] = CAST(1 AS bit)
2025-01-31 22:52:04.142 +03:00 [INF] Received notification request: {"Title":null,"TitleEn":"Test Notification","TitleAr":" ","Filters":null,"NationalId":"1234567890","NationalIds":null}
2025-01-31 22:52:04.145 +03:00 [INF] Starting GetTargetUsers with request type: Single User
2025-01-31 22:52:04.147 +03:00 [INF] Searching for single user with ID: 1234567890
2025-01-31 22:52:04.164 +03:00 [INF] Generated SQL Query: DECLARE @__request_NationalId_0 nvarchar(450) = N'1234567890';

SELECT [c].[NationalId], [c].[AddNo], [c].[BuildingNo], [c].[City], [c].[Consent], [c].[ConsentDate], [c].[DateOfBirth], [c].[Dependents], [c].[District], [c].[Email], [c].[Employer], [c].[EmployerName], [c].[EmploymentStatus], [c].[FamilyNameAr], [c].[FamilyNameEn], [c].[FirstNameAr], [c].[FirstNameEn], [c].[Iban], [c].[IdExpiryDate], [c].[Language], [c].[Los], [c].[Mpin], [c].[MpinEnabled], [c].[NafathStatus], [c].[NafathTimestamp], [c].[Password], [c].[Phone], [c].[RegistrationDate], [c].[Salary], [c].[SalaryCustomer], [c].[SalaryDakhli], [c].[SecondNameAr], [c].[SecondNameEn], [c].[Sector], [c].[Street], [c].[ThirdNameAr], [c].[ThirdNameEn], [c].[Zipcode]
FROM [Customers] AS [c]
WHERE [c].[NationalId] = @__request_NationalId_0
2025-01-31 22:52:04.176 +03:00 [INF] Executed DbCommand (3ms) [Parameters=[@__request_NationalId_0='?' (Size = 450)], CommandType='"Text"', CommandTimeout='30']
SELECT [c].[NationalId]
FROM [Customers] AS [c]
WHERE [c].[NationalId] = @__request_NationalId_0
2025-01-31 22:52:04.179 +03:00 [INF] Found 1 users matching national ID 1234567890
2025-01-31 22:52:04.180 +03:00 [INF] Returning 1 distinct users
2025-01-31 22:52:04.181 +03:00 [INF] Target users query completed. Found 1 users
2025-01-31 22:52:04.182 +03:00 [INF] Found 1 target users for notification
2025-01-31 22:52:04.268 +03:00 [INF] Executed DbCommand (83ms) [Parameters=[@p0='?' (Size = 4000), @p1='?' (Size = 8000) (DbType = AnsiString), @p2='?' (Size = 8000) (DbType = AnsiString), @p3='?' (Size = 8000) (DbType = AnsiString), @p4='?' (DbType = DateTime2), @p5='?' (DbType = DateTime2), @p6='?' (Size = 255), @p7='?' (Size = 4000), @p8='?' (Size = 255), @p9='?' (Size = 255), @p10='?' (Size = 255)], CommandType='"Text"', CommandTimeout='30']
SET IMPLICIT_TRANSACTIONS OFF;
SET NOCOUNT ON;
INSERT INTO [notification_templates] ([additional_data], [Body], [body_ar], [body_en], [created_at], [expiry_at], [Route], [target_criteria], [Title], [title_ar], [title_en])
OUTPUT INSERTED.[Id]
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7, @p8, @p9, @p10);
2025-01-31 22:52:04.272 +03:00 [INF] Created notification template with ID: 1
2025-01-31 22:52:04.276 +03:00 [INF] Executed DbCommand (2ms) [Parameters=[@p0='?' (Size = 4000), @p1='?' (DbType = DateTime2), @p2='?' (Size = 4000), @p3='?' (Size = 4000), @p4='?' (Size = 4000), @p5='?' (Size = 450), @p6='?' (Size = 4000), @p7='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SET IMPLICIT_TRANSACTIONS OFF;
SET NOCOUNT ON;
INSERT INTO [AuthLogs] ([AuthType], [CreatedAt], [DeviceId], [FailureReason], [IpAddress], [NationalId], [Status], [UserAgent])
OUTPUT INSERTED.[Id]
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7);
2025-01-31 22:52:04.283 +03:00 [INF] Executed DbCommand (4ms) [Parameters=[@__userId_0='?' (Size = 450)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [u].[national_id], [u].[last_updated], [u].[notifications]
FROM [user_notifications] AS [u]
WHERE [u].[national_id] = @__userId_0
2025-01-31 22:52:04.286 +03:00 [INF] Processing notification for user 1234567890. Existing notification record: false
2025-01-31 22:52:04.287 +03:00 [INF] Current notifications count for user 1234567890: 0
2025-01-31 22:52:04.288 +03:00 [INF] Serialized new notifications for user 1234567890. Length: 140
2025-01-31 22:52:04.293 +03:00 [INF] Executed DbCommand (2ms) [Parameters=[@p0='?' (Size = 4000), @p1='?' (Size = 4000), @p2='?' (DbType = DateTime2)], CommandType='"Text"', CommandTimeout='30']
INSERT INTO user_notifications (national_id, notifications, last_updated) VALUES (@p0, @p1, @p2)
2025-01-31 22:52:04.295 +03:00 [INF] Created new UserNotification entry for user: 1234567890
2025-01-31 22:52:04.300 +03:00 [INF] Executed DbCommand (2ms) [Parameters=[@p0='?' (Size = 4000), @p1='?' (DbType = DateTime2), @p2='?' (Size = 4000), @p3='?' (Size = 4000), @p4='?' (Size = 4000), @p5='?' (Size = 450), @p6='?' (Size = 4000), @p7='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SET IMPLICIT_TRANSACTIONS OFF;
SET NOCOUNT ON;
INSERT INTO [AuthLogs] ([AuthType], [CreatedAt], [DeviceId], [FailureReason], [IpAddress], [NationalId], [Status], [UserAgent])
OUTPUT INSERTED.[Id]
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7);
2025-01-31 22:52:04.305 +03:00 [INF] Successfully sent notifications. Template: 1, Success: 1, Total: 1
2025-01-31 22:52:04.307 +03:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType9`2[[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Object, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-01-31 22:52:04.310 +03:00 [INF] Executed action NayifatAPI.Controllers.NotificationsController.SendNotification (NayifatAPI) in 210.2559ms
2025-01-31 22:52:04.322 +03:00 [INF] Executed endpoint 'NayifatAPI.Controllers.NotificationsController.SendNotification (NayifatAPI)'
2025-01-31 22:52:04.323 +03:00 [INF] Request finished HTTP/1.1 POST http://localhost:5264/api/notifications/send - 200 null application/json; charset=utf-8 233.3661ms
2025-01-31 22:54:32.742 +03:00 [INF] Application is shutting down...
2025-01-31 22:54:41.015 +03:00 [INF] Starting web application
2025-01-31 22:54:41.106 +03:00 [INF] Now listening on: http://localhost:5264
2025-01-31 22:54:41.109 +03:00 [INF] Application started. Press Ctrl+C to shut down.
2025-01-31 22:54:41.110 +03:00 [INF] Hosting environment: Development
2025-01-31 22:54:41.111 +03:00 [INF] Content root path: C:\Users\yamta\StudioProjects\nayifat_app_2025_new\NayifatAPI
2025-01-31 22:56:06.390 +03:00 [INF] Request starting HTTP/1.1 POST http://localhost:5264/api/notifications/send - application/json 292
2025-01-31 22:56:06.440 +03:00 [WRN] Failed to determine the https port for redirect.
2025-01-31 22:56:06.446 +03:00 [INF] Executing endpoint 'NayifatAPI.Controllers.NotificationsController.SendNotification (NayifatAPI)'
2025-01-31 22:56:06.487 +03:00 [INF] Route matched with {action = "SendNotification", controller = "Notifications"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] SendNotification(NayifatAPI.Controllers.SendNotificationRequest) on controller NayifatAPI.Controllers.NotificationsController (NayifatAPI).
2025-01-31 22:56:06.820 +03:00 [INF] Executing BadRequestObjectResult, writing value of type 'Microsoft.AspNetCore.Mvc.ValidationProblemDetails'.
2025-01-31 22:56:06.879 +03:00 [INF] Executed action NayifatAPI.Controllers.NotificationsController.SendNotification (NayifatAPI) in 381.0138ms
2025-01-31 22:56:06.889 +03:00 [INF] Executed endpoint 'NayifatAPI.Controllers.NotificationsController.SendNotification (NayifatAPI)'
2025-01-31 22:56:06.906 +03:00 [INF] Request finished HTTP/1.1 POST http://localhost:5264/api/notifications/send - 400 null application/problem+json; charset=utf-8 518.1643ms
2025-01-31 22:57:02.314 +03:00 [INF] Request starting HTTP/1.1 POST http://localhost:5264/api/notifications/send - application/json 287
2025-01-31 22:57:02.320 +03:00 [INF] Executing endpoint 'NayifatAPI.Controllers.NotificationsController.SendNotification (NayifatAPI)'
2025-01-31 22:57:02.321 +03:00 [INF] Route matched with {action = "SendNotification", controller = "Notifications"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] SendNotification(NayifatAPI.Controllers.SendNotificationRequest) on controller NayifatAPI.Controllers.NotificationsController (NayifatAPI).
2025-01-31 22:57:07.096 +03:00 [INF] Executed DbCommand (49ms) [Parameters=[@__providedApiKey_0='?' (Size = 255)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [a].[Key], [a].[CreatedAt], [a].[Description], [a].[ExpiresAt], [a].[IsActive], [a].[LastUsedAt]
FROM [ApiKeys] AS [a]
WHERE [a].[Key] = @__providedApiKey_0 AND [a].[IsActive] = CAST(1 AS bit)
2025-01-31 22:57:07.243 +03:00 [INF] Received notification request: {"Title":null,"TitleEn":"Test Notification","TitleAr":" ","Filters":{"Customers.City":{"ValueKind":"Object","$type":"JsonElement"}},"NationalId":null,"NationalIds":null}
2025-01-31 22:57:07.275 +03:00 [INF] Starting GetTargetUsers with request type: Filtered Users
2025-01-31 22:57:07.277 +03:00 [INF] Applying filters: {"Customers.City":{"ValueKind":"Object","$type":"JsonElement"}}
2025-01-31 22:57:07.282 +03:00 [INF] Using AND operation for filters
2025-01-31 22:57:07.288 +03:00 [INF] Processing filter: Customers.City with value: {"ValueKind":"Object","$type":"JsonElement"}
2025-01-31 22:57:07.295 +03:00 [INF] Applied city filter: {
      "operator": "=",
      "value": "Riyadh"
    }
2025-01-31 22:57:07.332 +03:00 [INF] Final SQL Query: DECLARE @__ToString_0 nvarchar(4000) = CONCAT(CAST(N'{' AS nvarchar(max)), nchar(13), nchar(10), N'      "operator": "=",', nchar(13), nchar(10), N'      "value": "Riyadh"', nchar(13), nchar(10), N'    }');

SELECT [c].[NationalId], [c].[AddNo], [c].[BuildingNo], [c].[City], [c].[Consent], [c].[ConsentDate], [c].[DateOfBirth], [c].[Dependents], [c].[District], [c].[Email], [c].[Employer], [c].[EmployerName], [c].[EmploymentStatus], [c].[FamilyNameAr], [c].[FamilyNameEn], [c].[FirstNameAr], [c].[FirstNameEn], [c].[Iban], [c].[IdExpiryDate], [c].[Language], [c].[Los], [c].[Mpin], [c].[MpinEnabled], [c].[NafathStatus], [c].[NafathTimestamp], [c].[Password], [c].[Phone], [c].[RegistrationDate], [c].[Salary], [c].[SalaryCustomer], [c].[SalaryDakhli], [c].[SecondNameAr], [c].[SecondNameEn], [c].[Sector], [c].[Street], [c].[ThirdNameAr], [c].[ThirdNameEn], [c].[Zipcode]
FROM [Customers] AS [c]
WHERE [c].[City] = @__ToString_0
2025-01-31 22:57:07.404 +03:00 [INF] Executed DbCommand (27ms) [Parameters=[@__ToString_0='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SELECT [c].[NationalId]
FROM [Customers] AS [c]
WHERE [c].[City] = @__ToString_0
2025-01-31 22:57:07.421 +03:00 [INF] Found 0 users after applying filters
2025-01-31 22:57:07.423 +03:00 [WRN] No users found matching the filter criteria
2025-01-31 22:57:07.423 +03:00 [INF] Target users query completed. Found 0 users
2025-01-31 22:57:07.424 +03:00 [WRN] No target users found. Filters: {"Customers.City":{"ValueKind":"Object","$type":"JsonElement"}}
2025-01-31 22:57:07.429 +03:00 [INF] Executing ObjectResult, writing value of type '<>f__AnonymousType11`2[[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-01-31 22:57:07.454 +03:00 [INF] Executed action NayifatAPI.Controllers.NotificationsController.SendNotification (NayifatAPI) in 5130.5539ms
2025-01-31 22:57:07.456 +03:00 [INF] Executed endpoint 'NayifatAPI.Controllers.NotificationsController.SendNotification (NayifatAPI)'
2025-01-31 22:57:07.470 +03:00 [INF] Request finished HTTP/1.1 POST http://localhost:5264/api/notifications/send - 400 null application/json; charset=utf-8 5156.1049ms
2025-01-31 22:58:58.199 +03:00 [INF] Application is shutting down...
2025-01-31 23:14:09.908 +03:00 [INF] Starting web application
2025-01-31 23:14:10.008 +03:00 [INF] Now listening on: http://localhost:5264
2025-01-31 23:14:10.012 +03:00 [INF] Application started. Press Ctrl+C to shut down.
2025-01-31 23:14:10.013 +03:00 [INF] Hosting environment: Development
2025-01-31 23:14:10.014 +03:00 [INF] Content root path: C:\Users\yamta\StudioProjects\nayifat_app_2025_new\NayifatAPI
2025-01-31 23:14:21.239 +03:00 [INF] Request starting HTTP/1.1 POST http://localhost:5264/api/notifications/send - application/json 287
2025-01-31 23:14:21.299 +03:00 [WRN] Failed to determine the https port for redirect.
2025-01-31 23:14:21.308 +03:00 [INF] Executing endpoint 'NayifatAPI.Controllers.NotificationsController.SendNotification (NayifatAPI)'
2025-01-31 23:14:21.332 +03:00 [INF] Route matched with {action = "SendNotification", controller = "Notifications"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] SendNotification(NayifatAPI.Controllers.SendNotificationRequest) on controller NayifatAPI.Controllers.NotificationsController (NayifatAPI).
2025-01-31 23:14:22.926 +03:00 [INF] Executed DbCommand (103ms) [Parameters=[@__providedApiKey_0='?' (Size = 255)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [a].[Key], [a].[CreatedAt], [a].[Description], [a].[ExpiresAt], [a].[IsActive], [a].[LastUsedAt]
FROM [ApiKeys] AS [a]
WHERE [a].[Key] = @__providedApiKey_0 AND [a].[IsActive] = CAST(1 AS bit)
2025-01-31 23:14:23.022 +03:00 [INF] Received notification request: {"Title":null,"TitleEn":"Test Notification","TitleAr":" ","Filters":{"Customers.City":{"ValueKind":"Object","$type":"JsonElement"}},"NationalId":null,"NationalIds":null}
2025-01-31 23:14:23.039 +03:00 [INF] Starting GetTargetUsers with request type: Filtered Users
2025-01-31 23:14:23.109 +03:00 [ERR] Error in SendNotification
System.InvalidOperationException: Translation of 'EF.Property<string>(StructuralTypeShaperExpression: 
    NayifatAPI.Models.Customer
    ValueBufferExpression: 
        ProjectionBindingExpression: EmptyProjectionMember
    IsNullable: False
, "Customers.City")' failed. Either the query source is not an entity type, or the specified property does not exist on the entity type.
   at Microsoft.EntityFrameworkCore.Query.RelationalSqlTranslatingExpressionVisitor.VisitMethodCall(MethodCallExpression methodCallExpression)
   at Microsoft.EntityFrameworkCore.SqlServer.Query.Internal.SqlServerSqlTranslatingExpressionVisitor.VisitMethodCall(MethodCallExpression methodCallExpression)
   at Microsoft.EntityFrameworkCore.Query.RelationalSqlTranslatingExpressionVisitor.VisitBinary(BinaryExpression binaryExpression)
   at Microsoft.EntityFrameworkCore.SqlServer.Query.Internal.SqlServerSqlTranslatingExpressionVisitor.VisitBinary(BinaryExpression binaryExpression)
   at Microsoft.EntityFrameworkCore.Query.RelationalSqlTranslatingExpressionVisitor.TranslateInternal(Expression expression, Boolean applyDefaultTypeMapping)
   at Microsoft.EntityFrameworkCore.Query.RelationalSqlTranslatingExpressionVisitor.Translate(Expression expression, Boolean applyDefaultTypeMapping)
   at Microsoft.EntityFrameworkCore.Query.RelationalQueryableMethodTranslatingExpressionVisitor.TranslateExpression(Expression expression, Boolean applyDefaultTypeMapping)
   at Microsoft.EntityFrameworkCore.Query.RelationalQueryableMethodTranslatingExpressionVisitor.TranslateLambdaExpression(ShapedQueryExpression shapedQueryExpression, LambdaExpression lambdaExpression)
   at Microsoft.EntityFrameworkCore.Query.RelationalQueryableMethodTranslatingExpressionVisitor.TranslateWhere(ShapedQueryExpression source, LambdaExpression predicate)
   at Microsoft.EntityFrameworkCore.Query.QueryableMethodTranslatingExpressionVisitor.VisitMethodCall(MethodCallExpression methodCallExpression)
   at Microsoft.EntityFrameworkCore.Query.RelationalQueryableMethodTranslatingExpressionVisitor.VisitMethodCall(MethodCallExpression methodCallExpression)
   at Microsoft.EntityFrameworkCore.Query.QueryableMethodTranslatingExpressionVisitor.VisitMethodCall(MethodCallExpression methodCallExpression)
   at Microsoft.EntityFrameworkCore.Query.RelationalQueryableMethodTranslatingExpressionVisitor.VisitMethodCall(MethodCallExpression methodCallExpression)
   at Microsoft.EntityFrameworkCore.Query.QueryableMethodTranslatingExpressionVisitor.Translate(Expression expression)
   at Microsoft.EntityFrameworkCore.Query.RelationalQueryableMethodTranslatingExpressionVisitor.Translate(Expression expression)
   at Microsoft.EntityFrameworkCore.Query.QueryCompilationContext.CreateQueryExecutor[TResult](Expression query)
   at Microsoft.EntityFrameworkCore.Storage.Database.CompileQuery[TResult](Expression query, Boolean async)
   at Microsoft.EntityFrameworkCore.Query.Internal.QueryCompiler.CompileQueryCore[TResult](IDatabase database, Expression query, IModel model, Boolean async)
   at Microsoft.EntityFrameworkCore.Query.Internal.QueryCompiler.<>c__DisplayClass12_0`1.<ExecuteAsync>b__0()
   at Microsoft.EntityFrameworkCore.Query.Internal.CompiledQueryCache.GetOrAddQuery[TResult](Object cacheKey, Func`1 compiler)
   at Microsoft.EntityFrameworkCore.Query.Internal.QueryCompiler.ExecuteAsync[TResult](Expression query, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Query.Internal.EntityQueryProvider.ExecuteAsync[TResult](Expression expression, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Query.Internal.EntityQueryable`1.GetAsyncEnumerator(CancellationToken cancellationToken)
   at System.Runtime.CompilerServices.ConfiguredCancelableAsyncEnumerable`1.GetAsyncEnumerator()
   at Microsoft.EntityFrameworkCore.EntityFrameworkQueryableExtensions.ToListAsync[TSource](IQueryable`1 source, CancellationToken cancellationToken)
   at NayifatAPI.Controllers.NotificationsController.GetTargetUsers(SendNotificationRequest request) in C:\Users\yamta\StudioProjects\nayifat_app_2025_new\NayifatAPI\Controllers\NotificationsController.cs:line 528
   at NayifatAPI.Controllers.NotificationsController.SendNotification(SendNotificationRequest request) in C:\Users\yamta\StudioProjects\nayifat_app_2025_new\NayifatAPI\Controllers\NotificationsController.cs:line 181
2025-01-31 23:14:23.152 +03:00 [INF] Executing ObjectResult, writing value of type '<>f__AnonymousType11`2[[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-01-31 23:14:23.177 +03:00 [INF] Executed action NayifatAPI.Controllers.NotificationsController.SendNotification (NayifatAPI) in 1834.3618ms
2025-01-31 23:14:23.181 +03:00 [INF] Executed endpoint 'NayifatAPI.Controllers.NotificationsController.SendNotification (NayifatAPI)'
2025-01-31 23:14:23.312 +03:00 [INF] Request finished HTTP/1.1 POST http://localhost:5264/api/notifications/send - 500 null application/json; charset=utf-8 2074.2382ms
2025-01-31 23:20:27.081 +03:00 [INF] Application is shutting down...
2025-01-31 23:23:58.854 +03:00 [INF] Starting web application
2025-01-31 23:23:58.944 +03:00 [INF] Now listening on: http://localhost:5264
2025-01-31 23:23:58.950 +03:00 [INF] Application started. Press Ctrl+C to shut down.
2025-01-31 23:23:58.951 +03:00 [INF] Hosting environment: Development
2025-01-31 23:23:58.952 +03:00 [INF] Content root path: C:\Users\yamta\StudioProjects\nayifat_app_2025_new\NayifatAPI
2025-01-31 23:24:22.699 +03:00 [INF] Request starting HTTP/1.1 POST http://localhost:5264/api/notifications/send - application/json 287
2025-01-31 23:24:22.764 +03:00 [WRN] Failed to determine the https port for redirect.
2025-01-31 23:24:22.768 +03:00 [INF] Executing endpoint 'NayifatAPI.Controllers.NotificationsController.SendNotification (NayifatAPI)'
2025-01-31 23:24:22.800 +03:00 [INF] Route matched with {action = "SendNotification", controller = "Notifications"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] SendNotification(NayifatAPI.Controllers.SendNotificationRequest) on controller NayifatAPI.Controllers.NotificationsController (NayifatAPI).
2025-01-31 23:24:24.685 +03:00 [INF] Executed DbCommand (56ms) [Parameters=[@__providedApiKey_0='?' (Size = 255)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [a].[Key], [a].[CreatedAt], [a].[Description], [a].[ExpiresAt], [a].[IsActive], [a].[LastUsedAt]
FROM [ApiKeys] AS [a]
WHERE [a].[Key] = @__providedApiKey_0 AND [a].[IsActive] = CAST(1 AS bit)
2025-01-31 23:24:24.855 +03:00 [INF] Received notification request: {"Title":null,"TitleEn":"Test Notification","TitleAr":" ","Filters":{"Customers.City":{"ValueKind":"Object","$type":"JsonElement"}},"NationalId":null,"NationalIds":null}
2025-01-31 23:24:24.967 +03:00 [INF] Starting GetTargetUsers with request type: Filtered Users
2025-01-31 23:24:25.076 +03:00 [INF] Executed DbCommand (29ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT [c].[NationalId]
FROM [Customers] AS [c]
2025-01-31 23:24:25.128 +03:00 [INF] Found 6 users after applying filters
2025-01-31 23:24:25.151 +03:00 [INF] Target users query completed. Found 6 users
2025-01-31 23:24:25.162 +03:00 [INF] Found 6 target users for notification
2025-01-31 23:24:25.576 +03:00 [INF] Executed DbCommand (97ms) [Parameters=[@p0='?' (Size = 4000), @p1='?' (Size = 8000) (DbType = AnsiString), @p2='?' (Size = 8000) (DbType = AnsiString), @p3='?' (Size = 8000) (DbType = AnsiString), @p4='?' (DbType = DateTime2), @p5='?' (DbType = DateTime2), @p6='?' (Size = 255), @p7='?' (Size = 4000), @p8='?' (Size = 255), @p9='?' (Size = 255), @p10='?' (Size = 255)], CommandType='"Text"', CommandTimeout='30']
SET IMPLICIT_TRANSACTIONS OFF;
SET NOCOUNT ON;
INSERT INTO [notification_templates] ([additional_data], [Body], [body_ar], [body_en], [created_at], [expiry_at], [Route], [target_criteria], [Title], [title_ar], [title_en])
OUTPUT INSERTED.[Id]
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7, @p8, @p9, @p10);
2025-01-31 23:24:25.818 +03:00 [INF] Created notification template with ID: 2
2025-01-31 23:24:25.951 +03:00 [INF] Executed DbCommand (31ms) [Parameters=[@p0='?' (Size = 4000), @p1='?' (DbType = DateTime2), @p2='?' (Size = 4000), @p3='?' (Size = 4000), @p4='?' (Size = 4000), @p5='?' (Size = 450), @p6='?' (Size = 4000), @p7='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SET IMPLICIT_TRANSACTIONS OFF;
SET NOCOUNT ON;
INSERT INTO [AuthLogs] ([AuthType], [CreatedAt], [DeviceId], [FailureReason], [IpAddress], [NationalId], [Status], [UserAgent])
OUTPUT INSERTED.[Id]
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7);
2025-01-31 23:24:26.002 +03:00 [INF] Executed DbCommand (9ms) [Parameters=[@__userId_0='?' (Size = 450)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [u].[national_id], [u].[last_updated], [u].[notifications]
FROM [user_notifications] AS [u]
WHERE [u].[national_id] = @__userId_0
2025-01-31 23:24:26.044 +03:00 [INF] Processing notification for user 1012345678. Existing notification record: true
2025-01-31 23:24:26.071 +03:00 [INF] Current notifications count for user 1012345678: 2
2025-01-31 23:24:26.353 +03:00 [INF] Serialized new notifications for user 1012345678. Length: 418
2025-01-31 23:24:27.074 +03:00 [INF] Executed DbCommand (254ms) [Parameters=[@p0='?' (Size = 4000), @p1='?' (DbType = DateTime2), @p2='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
UPDATE user_notifications SET notifications = @p0, last_updated = @p1 WHERE national_id = @p2
2025-01-31 23:24:27.289 +03:00 [INF] Updated existing UserNotification for user: 1012345678
2025-01-31 23:24:27.325 +03:00 [INF] Executed DbCommand (17ms) [Parameters=[@__userId_0='?' (Size = 450)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [u].[national_id], [u].[last_updated], [u].[notifications]
FROM [user_notifications] AS [u]
WHERE [u].[national_id] = @__userId_0
2025-01-31 23:24:27.334 +03:00 [INF] Processing notification for user 1023456789. Existing notification record: false
2025-01-31 23:24:27.351 +03:00 [INF] Current notifications count for user 1023456789: 0
2025-01-31 23:24:27.355 +03:00 [INF] Serialized new notifications for user 1023456789. Length: 140
2025-01-31 23:24:27.403 +03:00 [INF] Executed DbCommand (37ms) [Parameters=[@p0='?' (Size = 4000), @p1='?' (Size = 4000), @p2='?' (DbType = DateTime2)], CommandType='"Text"', CommandTimeout='30']
INSERT INTO user_notifications (national_id, notifications, last_updated) VALUES (@p0, @p1, @p2)
2025-01-31 23:24:27.834 +03:00 [INF] Created new UserNotification entry for user: 1023456789
2025-01-31 23:24:27.862 +03:00 [INF] Executed DbCommand (26ms) [Parameters=[@__userId_0='?' (Size = 450)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [u].[national_id], [u].[last_updated], [u].[notifications]
FROM [user_notifications] AS [u]
WHERE [u].[national_id] = @__userId_0
2025-01-31 23:24:28.252 +03:00 [INF] Processing notification for user 1034567890. Existing notification record: false
2025-01-31 23:24:28.253 +03:00 [INF] Current notifications count for user 1034567890: 0
2025-01-31 23:24:28.255 +03:00 [INF] Serialized new notifications for user 1034567890. Length: 140
2025-01-31 23:24:28.270 +03:00 [INF] Executed DbCommand (10ms) [Parameters=[@p0='?' (Size = 4000), @p1='?' (Size = 4000), @p2='?' (DbType = DateTime2)], CommandType='"Text"', CommandTimeout='30']
INSERT INTO user_notifications (national_id, notifications, last_updated) VALUES (@p0, @p1, @p2)
2025-01-31 23:24:28.276 +03:00 [INF] Created new UserNotification entry for user: 1034567890
2025-01-31 23:24:28.283 +03:00 [INF] Executed DbCommand (5ms) [Parameters=[@__userId_0='?' (Size = 450)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [u].[national_id], [u].[last_updated], [u].[notifications]
FROM [user_notifications] AS [u]
WHERE [u].[national_id] = @__userId_0
2025-01-31 23:24:28.286 +03:00 [INF] Processing notification for user 1045678901. Existing notification record: true
2025-01-31 23:24:28.288 +03:00 [INF] Current notifications count for user 1045678901: 1
2025-01-31 23:24:28.294 +03:00 [INF] Serialized new notifications for user 1045678901. Length: 279
2025-01-31 23:24:28.306 +03:00 [INF] Executed DbCommand (10ms) [Parameters=[@p0='?' (Size = 4000), @p1='?' (DbType = DateTime2), @p2='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
UPDATE user_notifications SET notifications = @p0, last_updated = @p1 WHERE national_id = @p2
2025-01-31 23:24:28.311 +03:00 [INF] Updated existing UserNotification for user: 1045678901
2025-01-31 23:24:28.317 +03:00 [INF] Executed DbCommand (4ms) [Parameters=[@__userId_0='?' (Size = 450)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [u].[national_id], [u].[last_updated], [u].[notifications]
FROM [user_notifications] AS [u]
WHERE [u].[national_id] = @__userId_0
2025-01-31 23:24:28.320 +03:00 [INF] Processing notification for user 1056789012. Existing notification record: false
2025-01-31 23:24:28.321 +03:00 [INF] Current notifications count for user 1056789012: 0
2025-01-31 23:24:28.325 +03:00 [INF] Serialized new notifications for user 1056789012. Length: 140
2025-01-31 23:24:28.332 +03:00 [INF] Executed DbCommand (5ms) [Parameters=[@p0='?' (Size = 4000), @p1='?' (Size = 4000), @p2='?' (DbType = DateTime2)], CommandType='"Text"', CommandTimeout='30']
INSERT INTO user_notifications (national_id, notifications, last_updated) VALUES (@p0, @p1, @p2)
2025-01-31 23:24:28.335 +03:00 [INF] Created new UserNotification entry for user: 1056789012
2025-01-31 23:24:28.343 +03:00 [INF] Executed DbCommand (6ms) [Parameters=[@__userId_0='?' (Size = 450)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [u].[national_id], [u].[last_updated], [u].[notifications]
FROM [user_notifications] AS [u]
WHERE [u].[national_id] = @__userId_0
2025-01-31 23:24:28.348 +03:00 [INF] Processing notification for user 1234567890. Existing notification record: true
2025-01-31 23:24:28.350 +03:00 [INF] Current notifications count for user 1234567890: 1
2025-01-31 23:24:28.352 +03:00 [INF] Serialized new notifications for user 1234567890. Length: 279
2025-01-31 23:24:28.365 +03:00 [INF] Executed DbCommand (11ms) [Parameters=[@p0='?' (Size = 4000), @p1='?' (DbType = DateTime2), @p2='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
UPDATE user_notifications SET notifications = @p0, last_updated = @p1 WHERE national_id = @p2
2025-01-31 23:24:28.368 +03:00 [INF] Updated existing UserNotification for user: 1234567890
2025-01-31 23:24:28.383 +03:00 [INF] Executed DbCommand (6ms) [Parameters=[@p0='?' (Size = 4000), @p1='?' (DbType = DateTime2), @p2='?' (Size = 4000), @p3='?' (Size = 4000), @p4='?' (Size = 4000), @p5='?' (Size = 450), @p6='?' (Size = 4000), @p7='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SET IMPLICIT_TRANSACTIONS OFF;
SET NOCOUNT ON;
INSERT INTO [AuthLogs] ([AuthType], [CreatedAt], [DeviceId], [FailureReason], [IpAddress], [NationalId], [Status], [UserAgent])
OUTPUT INSERTED.[Id]
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7);
2025-01-31 23:24:28.387 +03:00 [INF] Successfully sent notifications. Template: 2, Success: 6, Total: 6
2025-01-31 23:24:28.401 +03:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType9`2[[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Object, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-01-31 23:24:28.421 +03:00 [INF] Executed action NayifatAPI.Controllers.NotificationsController.SendNotification (NayifatAPI) in 5616.763ms
2025-01-31 23:24:28.427 +03:00 [INF] Executed endpoint 'NayifatAPI.Controllers.NotificationsController.SendNotification (NayifatAPI)'
2025-01-31 23:24:28.445 +03:00 [INF] Request finished HTTP/1.1 POST http://localhost:5264/api/notifications/send - 200 null application/json; charset=utf-8 5746.9788ms
2025-01-31 23:25:47.136 +03:00 [INF] Request starting HTTP/1.1 POST http://localhost:5264/api/notifications/send - application/json 287
2025-01-31 23:25:47.143 +03:00 [INF] Executing endpoint 'NayifatAPI.Controllers.NotificationsController.SendNotification (NayifatAPI)'
2025-01-31 23:25:47.145 +03:00 [INF] Route matched with {action = "SendNotification", controller = "Notifications"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] SendNotification(NayifatAPI.Controllers.SendNotificationRequest) on controller NayifatAPI.Controllers.NotificationsController (NayifatAPI).
2025-01-31 23:25:47.185 +03:00 [INF] Executed DbCommand (4ms) [Parameters=[@__providedApiKey_0='?' (Size = 255)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [a].[Key], [a].[CreatedAt], [a].[Description], [a].[ExpiresAt], [a].[IsActive], [a].[LastUsedAt]
FROM [ApiKeys] AS [a]
WHERE [a].[Key] = @__providedApiKey_0 AND [a].[IsActive] = CAST(1 AS bit)
2025-01-31 23:25:47.190 +03:00 [INF] Received notification request: {"Title":null,"TitleEn":"Test Notification","TitleAr":" ","Filters":{"Customers.City":{"ValueKind":"Object","$type":"JsonElement"}},"NationalId":null,"NationalIds":null}
2025-01-31 23:25:47.195 +03:00 [INF] Starting GetTargetUsers with request type: Filtered Users
2025-01-31 23:25:47.199 +03:00 [INF] Executed DbCommand (2ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT [c].[NationalId]
FROM [Customers] AS [c]
2025-01-31 23:25:47.201 +03:00 [INF] Found 6 users after applying filters
2025-01-31 23:25:47.201 +03:00 [INF] Target users query completed. Found 6 users
2025-01-31 23:25:47.202 +03:00 [INF] Found 6 target users for notification
2025-01-31 23:25:47.283 +03:00 [INF] Executed DbCommand (77ms) [Parameters=[@p0='?' (Size = 4000), @p1='?' (Size = 8000) (DbType = AnsiString), @p2='?' (Size = 8000) (DbType = AnsiString), @p3='?' (Size = 8000) (DbType = AnsiString), @p4='?' (DbType = DateTime2), @p5='?' (DbType = DateTime2), @p6='?' (Size = 255), @p7='?' (Size = 4000), @p8='?' (Size = 255), @p9='?' (Size = 255), @p10='?' (Size = 255)], CommandType='"Text"', CommandTimeout='30']
SET IMPLICIT_TRANSACTIONS OFF;
SET NOCOUNT ON;
INSERT INTO [notification_templates] ([additional_data], [Body], [body_ar], [body_en], [created_at], [expiry_at], [Route], [target_criteria], [Title], [title_ar], [title_en])
OUTPUT INSERTED.[Id]
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7, @p8, @p9, @p10);
2025-01-31 23:25:47.288 +03:00 [INF] Created notification template with ID: 1
2025-01-31 23:25:47.295 +03:00 [INF] Executed DbCommand (4ms) [Parameters=[@p0='?' (Size = 4000), @p1='?' (DbType = DateTime2), @p2='?' (Size = 4000), @p3='?' (Size = 4000), @p4='?' (Size = 4000), @p5='?' (Size = 450), @p6='?' (Size = 4000), @p7='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SET IMPLICIT_TRANSACTIONS OFF;
SET NOCOUNT ON;
INSERT INTO [AuthLogs] ([AuthType], [CreatedAt], [DeviceId], [FailureReason], [IpAddress], [NationalId], [Status], [UserAgent])
OUTPUT INSERTED.[Id]
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7);
2025-01-31 23:25:47.300 +03:00 [INF] Executed DbCommand (2ms) [Parameters=[@__userId_0='?' (Size = 450)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [u].[national_id], [u].[last_updated], [u].[notifications]
FROM [user_notifications] AS [u]
WHERE [u].[national_id] = @__userId_0
2025-01-31 23:25:47.302 +03:00 [INF] Processing notification for user 1012345678. Existing notification record: false
2025-01-31 23:25:47.306 +03:00 [INF] Current notifications count for user 1012345678: 0
2025-01-31 23:25:47.307 +03:00 [INF] Serialized new notifications for user 1012345678. Length: 140
2025-01-31 23:25:47.314 +03:00 [INF] Executed DbCommand (4ms) [Parameters=[@p0='?' (Size = 4000), @p1='?' (Size = 4000), @p2='?' (DbType = DateTime2)], CommandType='"Text"', CommandTimeout='30']
INSERT INTO user_notifications (national_id, notifications, last_updated) VALUES (@p0, @p1, @p2)
2025-01-31 23:25:47.316 +03:00 [INF] Created new UserNotification entry for user: 1012345678
2025-01-31 23:25:47.318 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@__userId_0='?' (Size = 450)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [u].[national_id], [u].[last_updated], [u].[notifications]
FROM [user_notifications] AS [u]
WHERE [u].[national_id] = @__userId_0
2025-01-31 23:25:47.323 +03:00 [INF] Processing notification for user 1023456789. Existing notification record: false
2025-01-31 23:25:47.325 +03:00 [INF] Current notifications count for user 1023456789: 0
2025-01-31 23:25:47.326 +03:00 [INF] Serialized new notifications for user 1023456789. Length: 140
2025-01-31 23:25:47.329 +03:00 [INF] Executed DbCommand (2ms) [Parameters=[@p0='?' (Size = 4000), @p1='?' (Size = 4000), @p2='?' (DbType = DateTime2)], CommandType='"Text"', CommandTimeout='30']
INSERT INTO user_notifications (national_id, notifications, last_updated) VALUES (@p0, @p1, @p2)
2025-01-31 23:25:47.331 +03:00 [INF] Created new UserNotification entry for user: 1023456789
2025-01-31 23:25:47.333 +03:00 [INF] Executed DbCommand (0ms) [Parameters=[@__userId_0='?' (Size = 450)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [u].[national_id], [u].[last_updated], [u].[notifications]
FROM [user_notifications] AS [u]
WHERE [u].[national_id] = @__userId_0
2025-01-31 23:25:47.334 +03:00 [INF] Processing notification for user 1034567890. Existing notification record: false
2025-01-31 23:25:47.335 +03:00 [INF] Current notifications count for user 1034567890: 0
2025-01-31 23:25:47.335 +03:00 [INF] Serialized new notifications for user 1034567890. Length: 140
2025-01-31 23:25:47.341 +03:00 [INF] Executed DbCommand (2ms) [Parameters=[@p0='?' (Size = 4000), @p1='?' (Size = 4000), @p2='?' (DbType = DateTime2)], CommandType='"Text"', CommandTimeout='30']
INSERT INTO user_notifications (national_id, notifications, last_updated) VALUES (@p0, @p1, @p2)
2025-01-31 23:25:47.343 +03:00 [INF] Created new UserNotification entry for user: 1034567890
2025-01-31 23:25:47.344 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@__userId_0='?' (Size = 450)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [u].[national_id], [u].[last_updated], [u].[notifications]
FROM [user_notifications] AS [u]
WHERE [u].[national_id] = @__userId_0
2025-01-31 23:25:47.346 +03:00 [INF] Processing notification for user 1045678901. Existing notification record: false
2025-01-31 23:25:47.347 +03:00 [INF] Current notifications count for user 1045678901: 0
2025-01-31 23:25:47.348 +03:00 [INF] Serialized new notifications for user 1045678901. Length: 140
2025-01-31 23:25:47.350 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@p0='?' (Size = 4000), @p1='?' (Size = 4000), @p2='?' (DbType = DateTime2)], CommandType='"Text"', CommandTimeout='30']
INSERT INTO user_notifications (national_id, notifications, last_updated) VALUES (@p0, @p1, @p2)
2025-01-31 23:25:47.351 +03:00 [INF] Created new UserNotification entry for user: 1045678901
2025-01-31 23:25:47.353 +03:00 [INF] Executed DbCommand (0ms) [Parameters=[@__userId_0='?' (Size = 450)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [u].[national_id], [u].[last_updated], [u].[notifications]
FROM [user_notifications] AS [u]
WHERE [u].[national_id] = @__userId_0
2025-01-31 23:25:47.359 +03:00 [INF] Processing notification for user 1056789012. Existing notification record: false
2025-01-31 23:25:47.359 +03:00 [INF] Current notifications count for user 1056789012: 0
2025-01-31 23:25:47.360 +03:00 [INF] Serialized new notifications for user 1056789012. Length: 140
2025-01-31 23:25:47.363 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@p0='?' (Size = 4000), @p1='?' (Size = 4000), @p2='?' (DbType = DateTime2)], CommandType='"Text"', CommandTimeout='30']
INSERT INTO user_notifications (national_id, notifications, last_updated) VALUES (@p0, @p1, @p2)
2025-01-31 23:25:47.364 +03:00 [INF] Created new UserNotification entry for user: 1056789012
2025-01-31 23:25:47.366 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@__userId_0='?' (Size = 450)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [u].[national_id], [u].[last_updated], [u].[notifications]
FROM [user_notifications] AS [u]
WHERE [u].[national_id] = @__userId_0
2025-01-31 23:25:47.367 +03:00 [INF] Processing notification for user 1234567890. Existing notification record: false
2025-01-31 23:25:47.368 +03:00 [INF] Current notifications count for user 1234567890: 0
2025-01-31 23:25:47.369 +03:00 [INF] Serialized new notifications for user 1234567890. Length: 140
2025-01-31 23:25:47.374 +03:00 [INF] Executed DbCommand (3ms) [Parameters=[@p0='?' (Size = 4000), @p1='?' (Size = 4000), @p2='?' (DbType = DateTime2)], CommandType='"Text"', CommandTimeout='30']
INSERT INTO user_notifications (national_id, notifications, last_updated) VALUES (@p0, @p1, @p2)
2025-01-31 23:25:47.376 +03:00 [INF] Created new UserNotification entry for user: 1234567890
2025-01-31 23:25:47.382 +03:00 [INF] Executed DbCommand (4ms) [Parameters=[@p0='?' (Size = 4000), @p1='?' (DbType = DateTime2), @p2='?' (Size = 4000), @p3='?' (Size = 4000), @p4='?' (Size = 4000), @p5='?' (Size = 450), @p6='?' (Size = 4000), @p7='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SET IMPLICIT_TRANSACTIONS OFF;
SET NOCOUNT ON;
INSERT INTO [AuthLogs] ([AuthType], [CreatedAt], [DeviceId], [FailureReason], [IpAddress], [NationalId], [Status], [UserAgent])
OUTPUT INSERTED.[Id]
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7);
2025-01-31 23:25:47.383 +03:00 [INF] Successfully sent notifications. Template: 1, Success: 6, Total: 6
2025-01-31 23:25:47.385 +03:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType9`2[[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Object, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-01-31 23:25:47.386 +03:00 [INF] Executed action NayifatAPI.Controllers.NotificationsController.SendNotification (NayifatAPI) in 239.5228ms
2025-01-31 23:25:47.392 +03:00 [INF] Executed endpoint 'NayifatAPI.Controllers.NotificationsController.SendNotification (NayifatAPI)'
2025-01-31 23:25:47.394 +03:00 [INF] Request finished HTTP/1.1 POST http://localhost:5264/api/notifications/send - 200 null application/json; charset=utf-8 258.2013ms
2025-01-31 23:28:53.766 +03:00 [INF] Request starting HTTP/1.1 POST http://localhost:5264/api/notifications/send - application/json 216
2025-01-31 23:28:53.770 +03:00 [INF] Executing endpoint 'NayifatAPI.Controllers.NotificationsController.SendNotification (NayifatAPI)'
2025-01-31 23:28:53.773 +03:00 [INF] Route matched with {action = "SendNotification", controller = "Notifications"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] SendNotification(NayifatAPI.Controllers.SendNotificationRequest) on controller NayifatAPI.Controllers.NotificationsController (NayifatAPI).
2025-01-31 23:28:53.871 +03:00 [INF] Executed DbCommand (4ms) [Parameters=[@__providedApiKey_0='?' (Size = 255)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [a].[Key], [a].[CreatedAt], [a].[Description], [a].[ExpiresAt], [a].[IsActive], [a].[LastUsedAt]
FROM [ApiKeys] AS [a]
WHERE [a].[Key] = @__providedApiKey_0 AND [a].[IsActive] = CAST(1 AS bit)
2025-01-31 23:28:53.874 +03:00 [INF] Received notification request: {"Title":null,"TitleEn":"Test Notification","TitleAr":" ","Filters":null,"NationalId":"1056789012","NationalIds":null}
2025-01-31 23:28:53.879 +03:00 [INF] Starting GetTargetUsers with request type: Single User
2025-01-31 23:28:53.889 +03:00 [INF] Executed DbCommand (2ms) [Parameters=[@__request_NationalId_0='?' (Size = 450)], CommandType='"Text"', CommandTimeout='30']
SELECT [c].[NationalId]
FROM [Customers] AS [c]
WHERE [c].[NationalId] = @__request_NationalId_0
2025-01-31 23:28:53.892 +03:00 [INF] Found 1 users matching national ID 1056789012
2025-01-31 23:28:53.895 +03:00 [INF] Target users query completed. Found 1 users
2025-01-31 23:28:53.896 +03:00 [INF] Found 1 target users for notification
2025-01-31 23:28:53.974 +03:00 [INF] Executed DbCommand (76ms) [Parameters=[@p0='?' (Size = 4000), @p1='?' (Size = 8000) (DbType = AnsiString), @p2='?' (Size = 8000) (DbType = AnsiString), @p3='?' (Size = 8000) (DbType = AnsiString), @p4='?' (DbType = DateTime2), @p5='?' (DbType = DateTime2), @p6='?' (Size = 255), @p7='?' (Size = 4000), @p8='?' (Size = 255), @p9='?' (Size = 255), @p10='?' (Size = 255)], CommandType='"Text"', CommandTimeout='30']
SET IMPLICIT_TRANSACTIONS OFF;
SET NOCOUNT ON;
INSERT INTO [notification_templates] ([additional_data], [Body], [body_ar], [body_en], [created_at], [expiry_at], [Route], [target_criteria], [Title], [title_ar], [title_en])
OUTPUT INSERTED.[Id]
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7, @p8, @p9, @p10);
2025-01-31 23:28:53.979 +03:00 [INF] Created notification template with ID: 1
2025-01-31 23:28:53.984 +03:00 [INF] Executed DbCommand (3ms) [Parameters=[@p0='?' (Size = 4000), @p1='?' (DbType = DateTime2), @p2='?' (Size = 4000), @p3='?' (Size = 4000), @p4='?' (Size = 4000), @p5='?' (Size = 450), @p6='?' (Size = 4000), @p7='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SET IMPLICIT_TRANSACTIONS OFF;
SET NOCOUNT ON;
INSERT INTO [AuthLogs] ([AuthType], [CreatedAt], [DeviceId], [FailureReason], [IpAddress], [NationalId], [Status], [UserAgent])
OUTPUT INSERTED.[Id]
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7);
2025-01-31 23:28:53.989 +03:00 [INF] Executed DbCommand (2ms) [Parameters=[@__userId_0='?' (Size = 450)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [u].[national_id], [u].[last_updated], [u].[notifications]
FROM [user_notifications] AS [u]
WHERE [u].[national_id] = @__userId_0
2025-01-31 23:28:53.990 +03:00 [INF] Processing notification for user 1056789012. Existing notification record: false
2025-01-31 23:28:53.991 +03:00 [INF] Current notifications count for user 1056789012: 0
2025-01-31 23:28:53.993 +03:00 [INF] Serialized new notifications for user 1056789012. Length: 140
2025-01-31 23:28:54.008 +03:00 [INF] Executed DbCommand (2ms) [Parameters=[@p0='?' (Size = 4000), @p1='?' (Size = 4000), @p2='?' (DbType = DateTime2)], CommandType='"Text"', CommandTimeout='30']
INSERT INTO user_notifications (national_id, notifications, last_updated) VALUES (@p0, @p1, @p2)
2025-01-31 23:28:54.013 +03:00 [INF] Created new UserNotification entry for user: 1056789012
2025-01-31 23:28:54.017 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@p0='?' (Size = 4000), @p1='?' (DbType = DateTime2), @p2='?' (Size = 4000), @p3='?' (Size = 4000), @p4='?' (Size = 4000), @p5='?' (Size = 450), @p6='?' (Size = 4000), @p7='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SET IMPLICIT_TRANSACTIONS OFF;
SET NOCOUNT ON;
INSERT INTO [AuthLogs] ([AuthType], [CreatedAt], [DeviceId], [FailureReason], [IpAddress], [NationalId], [Status], [UserAgent])
OUTPUT INSERTED.[Id]
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7);
2025-01-31 23:28:54.020 +03:00 [INF] Successfully sent notifications. Template: 1, Success: 1, Total: 1
2025-01-31 23:28:54.021 +03:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType9`2[[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Object, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-01-31 23:28:54.022 +03:00 [INF] Executed action NayifatAPI.Controllers.NotificationsController.SendNotification (NayifatAPI) in 246.5447ms
2025-01-31 23:28:54.023 +03:00 [INF] Executed endpoint 'NayifatAPI.Controllers.NotificationsController.SendNotification (NayifatAPI)'
2025-01-31 23:28:54.024 +03:00 [INF] Request finished HTTP/1.1 POST http://localhost:5264/api/notifications/send - 200 null application/json; charset=utf-8 257.9209ms
2025-01-31 23:30:15.123 +03:00 [INF] Request starting HTTP/1.1 POST http://localhost:5264/api/notifications/send - application/json 285
2025-01-31 23:30:15.125 +03:00 [INF] Executing endpoint 'NayifatAPI.Controllers.NotificationsController.SendNotification (NayifatAPI)'
2025-01-31 23:30:15.126 +03:00 [INF] Route matched with {action = "SendNotification", controller = "Notifications"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] SendNotification(NayifatAPI.Controllers.SendNotificationRequest) on controller NayifatAPI.Controllers.NotificationsController (NayifatAPI).
2025-01-31 23:30:15.131 +03:00 [INF] Executed DbCommand (3ms) [Parameters=[@__providedApiKey_0='?' (Size = 255)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [a].[Key], [a].[CreatedAt], [a].[Description], [a].[ExpiresAt], [a].[IsActive], [a].[LastUsedAt]
FROM [ApiKeys] AS [a]
WHERE [a].[Key] = @__providedApiKey_0 AND [a].[IsActive] = CAST(1 AS bit)
2025-01-31 23:30:15.133 +03:00 [INF] Received notification request: {"Title":null,"TitleEn":"Test Notification","TitleAr":" ","Filters":{"Customers.City":{"ValueKind":"Object","$type":"JsonElement"}},"NationalId":null,"NationalIds":null}
2025-01-31 23:30:15.139 +03:00 [INF] Starting GetTargetUsers with request type: Filtered Users
2025-01-31 23:30:15.142 +03:00 [INF] Executed DbCommand (2ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT [c].[NationalId]
FROM [Customers] AS [c]
2025-01-31 23:30:15.144 +03:00 [INF] Found 6 users after applying filters
2025-01-31 23:30:15.145 +03:00 [INF] Target users query completed. Found 6 users
2025-01-31 23:30:15.146 +03:00 [INF] Found 6 target users for notification
2025-01-31 23:30:15.226 +03:00 [INF] Executed DbCommand (78ms) [Parameters=[@p0='?' (Size = 4000), @p1='?' (Size = 8000) (DbType = AnsiString), @p2='?' (Size = 8000) (DbType = AnsiString), @p3='?' (Size = 8000) (DbType = AnsiString), @p4='?' (DbType = DateTime2), @p5='?' (DbType = DateTime2), @p6='?' (Size = 255), @p7='?' (Size = 4000), @p8='?' (Size = 255), @p9='?' (Size = 255), @p10='?' (Size = 255)], CommandType='"Text"', CommandTimeout='30']
SET IMPLICIT_TRANSACTIONS OFF;
SET NOCOUNT ON;
INSERT INTO [notification_templates] ([additional_data], [Body], [body_ar], [body_en], [created_at], [expiry_at], [Route], [target_criteria], [Title], [title_ar], [title_en])
OUTPUT INSERTED.[Id]
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7, @p8, @p9, @p10);
2025-01-31 23:30:15.229 +03:00 [INF] Created notification template with ID: 2
2025-01-31 23:30:15.233 +03:00 [INF] Executed DbCommand (3ms) [Parameters=[@p0='?' (Size = 4000), @p1='?' (DbType = DateTime2), @p2='?' (Size = 4000), @p3='?' (Size = 4000), @p4='?' (Size = 4000), @p5='?' (Size = 450), @p6='?' (Size = 4000), @p7='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SET IMPLICIT_TRANSACTIONS OFF;
SET NOCOUNT ON;
INSERT INTO [AuthLogs] ([AuthType], [CreatedAt], [DeviceId], [FailureReason], [IpAddress], [NationalId], [Status], [UserAgent])
OUTPUT INSERTED.[Id]
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7);
2025-01-31 23:30:15.238 +03:00 [INF] Executed DbCommand (2ms) [Parameters=[@__userId_0='?' (Size = 450)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [u].[national_id], [u].[last_updated], [u].[notifications]
FROM [user_notifications] AS [u]
WHERE [u].[national_id] = @__userId_0
2025-01-31 23:30:15.244 +03:00 [INF] Processing notification for user 1012345678. Existing notification record: false
2025-01-31 23:30:15.245 +03:00 [INF] Current notifications count for user 1012345678: 0
2025-01-31 23:30:15.246 +03:00 [INF] Serialized new notifications for user 1012345678. Length: 140
2025-01-31 23:30:15.249 +03:00 [INF] Executed DbCommand (2ms) [Parameters=[@p0='?' (Size = 4000), @p1='?' (Size = 4000), @p2='?' (DbType = DateTime2)], CommandType='"Text"', CommandTimeout='30']
INSERT INTO user_notifications (national_id, notifications, last_updated) VALUES (@p0, @p1, @p2)
2025-01-31 23:30:15.251 +03:00 [INF] Created new UserNotification entry for user: 1012345678
2025-01-31 23:30:15.253 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@__userId_0='?' (Size = 450)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [u].[national_id], [u].[last_updated], [u].[notifications]
FROM [user_notifications] AS [u]
WHERE [u].[national_id] = @__userId_0
2025-01-31 23:30:15.255 +03:00 [INF] Processing notification for user 1023456789. Existing notification record: false
2025-01-31 23:30:15.257 +03:00 [INF] Current notifications count for user 1023456789: 0
2025-01-31 23:30:15.259 +03:00 [INF] Serialized new notifications for user 1023456789. Length: 140
2025-01-31 23:30:15.261 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@p0='?' (Size = 4000), @p1='?' (Size = 4000), @p2='?' (DbType = DateTime2)], CommandType='"Text"', CommandTimeout='30']
INSERT INTO user_notifications (national_id, notifications, last_updated) VALUES (@p0, @p1, @p2)
2025-01-31 23:30:15.264 +03:00 [INF] Created new UserNotification entry for user: 1023456789
2025-01-31 23:30:15.265 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@__userId_0='?' (Size = 450)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [u].[national_id], [u].[last_updated], [u].[notifications]
FROM [user_notifications] AS [u]
WHERE [u].[national_id] = @__userId_0
2025-01-31 23:30:15.267 +03:00 [INF] Processing notification for user 1034567890. Existing notification record: false
2025-01-31 23:30:15.268 +03:00 [INF] Current notifications count for user 1034567890: 0
2025-01-31 23:30:15.269 +03:00 [INF] Serialized new notifications for user 1034567890. Length: 140
2025-01-31 23:30:15.271 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@p0='?' (Size = 4000), @p1='?' (Size = 4000), @p2='?' (DbType = DateTime2)], CommandType='"Text"', CommandTimeout='30']
INSERT INTO user_notifications (national_id, notifications, last_updated) VALUES (@p0, @p1, @p2)
2025-01-31 23:30:15.274 +03:00 [INF] Created new UserNotification entry for user: 1034567890
2025-01-31 23:30:15.277 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@__userId_0='?' (Size = 450)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [u].[national_id], [u].[last_updated], [u].[notifications]
FROM [user_notifications] AS [u]
WHERE [u].[national_id] = @__userId_0
2025-01-31 23:30:15.280 +03:00 [INF] Processing notification for user 1045678901. Existing notification record: false
2025-01-31 23:30:15.281 +03:00 [INF] Current notifications count for user 1045678901: 0
2025-01-31 23:30:15.282 +03:00 [INF] Serialized new notifications for user 1045678901. Length: 140
2025-01-31 23:30:15.284 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@p0='?' (Size = 4000), @p1='?' (Size = 4000), @p2='?' (DbType = DateTime2)], CommandType='"Text"', CommandTimeout='30']
INSERT INTO user_notifications (national_id, notifications, last_updated) VALUES (@p0, @p1, @p2)
2025-01-31 23:30:15.285 +03:00 [INF] Created new UserNotification entry for user: 1045678901
2025-01-31 23:30:15.288 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@__userId_0='?' (Size = 450)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [u].[national_id], [u].[last_updated], [u].[notifications]
FROM [user_notifications] AS [u]
WHERE [u].[national_id] = @__userId_0
2025-01-31 23:30:15.291 +03:00 [INF] Processing notification for user 1056789012. Existing notification record: true
2025-01-31 23:30:15.293 +03:00 [INF] Current notifications count for user 1056789012: 1
2025-01-31 23:30:15.295 +03:00 [INF] Serialized new notifications for user 1056789012. Length: 279
2025-01-31 23:30:15.303 +03:00 [INF] Executed DbCommand (6ms) [Parameters=[@p0='?' (Size = 4000), @p1='?' (DbType = DateTime2), @p2='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
UPDATE user_notifications SET notifications = @p0, last_updated = @p1 WHERE national_id = @p2
2025-01-31 23:30:15.304 +03:00 [INF] Updated existing UserNotification for user: 1056789012
2025-01-31 23:30:15.307 +03:00 [INF] Executed DbCommand (2ms) [Parameters=[@__userId_0='?' (Size = 450)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [u].[national_id], [u].[last_updated], [u].[notifications]
FROM [user_notifications] AS [u]
WHERE [u].[national_id] = @__userId_0
2025-01-31 23:30:15.311 +03:00 [INF] Processing notification for user 1234567890. Existing notification record: false
2025-01-31 23:30:15.312 +03:00 [INF] Current notifications count for user 1234567890: 0
2025-01-31 23:30:15.313 +03:00 [INF] Serialized new notifications for user 1234567890. Length: 140
2025-01-31 23:30:15.315 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@p0='?' (Size = 4000), @p1='?' (Size = 4000), @p2='?' (DbType = DateTime2)], CommandType='"Text"', CommandTimeout='30']
INSERT INTO user_notifications (national_id, notifications, last_updated) VALUES (@p0, @p1, @p2)
2025-01-31 23:30:15.318 +03:00 [INF] Created new UserNotification entry for user: 1234567890
2025-01-31 23:30:15.320 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@p0='?' (Size = 4000), @p1='?' (DbType = DateTime2), @p2='?' (Size = 4000), @p3='?' (Size = 4000), @p4='?' (Size = 4000), @p5='?' (Size = 450), @p6='?' (Size = 4000), @p7='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SET IMPLICIT_TRANSACTIONS OFF;
SET NOCOUNT ON;
INSERT INTO [AuthLogs] ([AuthType], [CreatedAt], [DeviceId], [FailureReason], [IpAddress], [NationalId], [Status], [UserAgent])
OUTPUT INSERTED.[Id]
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7);
2025-01-31 23:30:15.325 +03:00 [INF] Successfully sent notifications. Template: 2, Success: 6, Total: 6
2025-01-31 23:30:15.327 +03:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType9`2[[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Object, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-01-31 23:30:15.328 +03:00 [INF] Executed action NayifatAPI.Controllers.NotificationsController.SendNotification (NayifatAPI) in 201.7486ms
2025-01-31 23:30:15.330 +03:00 [INF] Executed endpoint 'NayifatAPI.Controllers.NotificationsController.SendNotification (NayifatAPI)'
2025-01-31 23:30:15.333 +03:00 [INF] Request finished HTTP/1.1 POST http://localhost:5264/api/notifications/send - 200 null application/json; charset=utf-8 209.7355ms
2025-01-31 23:32:25.978 +03:00 [INF] Application is shutting down...
2025-01-31 23:32:38.021 +03:00 [INF] Starting web application
2025-01-31 23:32:38.140 +03:00 [INF] Now listening on: http://localhost:5264
2025-01-31 23:32:38.145 +03:00 [INF] Application started. Press Ctrl+C to shut down.
2025-01-31 23:32:38.146 +03:00 [INF] Hosting environment: Development
2025-01-31 23:32:38.147 +03:00 [INF] Content root path: C:\Users\yamta\StudioProjects\nayifat_app_2025_new\NayifatAPI
2025-01-31 23:32:45.612 +03:00 [INF] Request starting HTTP/1.1 POST http://localhost:5264/api/notifications/send - application/json 285
2025-01-31 23:32:45.720 +03:00 [WRN] Failed to determine the https port for redirect.
2025-01-31 23:32:45.732 +03:00 [INF] Executing endpoint 'NayifatAPI.Controllers.NotificationsController.SendNotification (NayifatAPI)'
2025-01-31 23:32:45.805 +03:00 [INF] Route matched with {action = "SendNotification", controller = "Notifications"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] SendNotification(NayifatAPI.Controllers.SendNotificationRequest) on controller NayifatAPI.Controllers.NotificationsController (NayifatAPI).
2025-01-31 23:32:48.499 +03:00 [INF] Executed DbCommand (48ms) [Parameters=[@__providedApiKey_0='?' (Size = 255)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [a].[Key], [a].[CreatedAt], [a].[Description], [a].[ExpiresAt], [a].[IsActive], [a].[LastUsedAt]
FROM [ApiKeys] AS [a]
WHERE [a].[Key] = @__providedApiKey_0 AND [a].[IsActive] = CAST(1 AS bit)
2025-01-31 23:32:48.646 +03:00 [INF] Received notification request: {"Title":null,"TitleEn":"Test Notification","TitleAr":" ","Filters":{"Customers.City":{"ValueKind":"Object","$type":"JsonElement"}},"NationalId":null,"NationalIds":null}
2025-01-31 23:32:48.674 +03:00 [INF] Starting GetTargetUsers with request type: Filtered Users
2025-01-31 23:32:48.684 +03:00 [WRN] No valid filters were applied
2025-01-31 23:32:48.685 +03:00 [INF] Target users query completed. Found 0 users
2025-01-31 23:32:48.690 +03:00 [WRN] No target users found. Filters: {"Customers.City":{"ValueKind":"Object","$type":"JsonElement"}}
2025-01-31 23:32:48.707 +03:00 [INF] Executing ObjectResult, writing value of type '<>f__AnonymousType11`2[[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-01-31 23:32:48.741 +03:00 [INF] Executed action NayifatAPI.Controllers.NotificationsController.SendNotification (NayifatAPI) in 2620.6568ms
2025-01-31 23:32:48.744 +03:00 [INF] Executed endpoint 'NayifatAPI.Controllers.NotificationsController.SendNotification (NayifatAPI)'
2025-01-31 23:32:48.762 +03:00 [INF] Request finished HTTP/1.1 POST http://localhost:5264/api/notifications/send - 400 null application/json; charset=utf-8 3155.2088ms
2025-01-31 23:33:03.934 +03:00 [INF] Request starting HTTP/1.1 POST http://localhost:5264/api/notifications/send - application/json 287
2025-01-31 23:33:03.942 +03:00 [INF] Executing endpoint 'NayifatAPI.Controllers.NotificationsController.SendNotification (NayifatAPI)'
2025-01-31 23:33:03.944 +03:00 [INF] Route matched with {action = "SendNotification", controller = "Notifications"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] SendNotification(NayifatAPI.Controllers.SendNotificationRequest) on controller NayifatAPI.Controllers.NotificationsController (NayifatAPI).
2025-01-31 23:33:03.999 +03:00 [INF] Executed DbCommand (3ms) [Parameters=[@__providedApiKey_0='?' (Size = 255)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [a].[Key], [a].[CreatedAt], [a].[Description], [a].[ExpiresAt], [a].[IsActive], [a].[LastUsedAt]
FROM [ApiKeys] AS [a]
WHERE [a].[Key] = @__providedApiKey_0 AND [a].[IsActive] = CAST(1 AS bit)
2025-01-31 23:33:04.007 +03:00 [INF] Received notification request: {"Title":null,"TitleEn":"Test Notification","TitleAr":" ","Filters":{"Customers.City":{"ValueKind":"Object","$type":"JsonElement"}},"NationalId":null,"NationalIds":null}
2025-01-31 23:33:04.012 +03:00 [INF] Starting GetTargetUsers with request type: Filtered Users
2025-01-31 23:33:04.013 +03:00 [WRN] No valid filters were applied
2025-01-31 23:33:04.013 +03:00 [INF] Target users query completed. Found 0 users
2025-01-31 23:33:04.014 +03:00 [WRN] No target users found. Filters: {"Customers.City":{"ValueKind":"Object","$type":"JsonElement"}}
2025-01-31 23:33:04.019 +03:00 [INF] Executing ObjectResult, writing value of type '<>f__AnonymousType11`2[[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-01-31 23:33:04.022 +03:00 [INF] Executed action NayifatAPI.Controllers.NotificationsController.SendNotification (NayifatAPI) in 76.0678ms
2025-01-31 23:33:04.023 +03:00 [INF] Executed endpoint 'NayifatAPI.Controllers.NotificationsController.SendNotification (NayifatAPI)'
2025-01-31 23:33:04.025 +03:00 [INF] Request finished HTTP/1.1 POST http://localhost:5264/api/notifications/send - 400 null application/json; charset=utf-8 91.0837ms
2025-01-31 23:33:20.220 +03:00 [INF] Request starting HTTP/1.1 POST http://localhost:5264/api/notifications/send - application/json 287
2025-01-31 23:33:20.225 +03:00 [INF] Executing endpoint 'NayifatAPI.Controllers.NotificationsController.SendNotification (NayifatAPI)'
2025-01-31 23:33:20.226 +03:00 [INF] Route matched with {action = "SendNotification", controller = "Notifications"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] SendNotification(NayifatAPI.Controllers.SendNotificationRequest) on controller NayifatAPI.Controllers.NotificationsController (NayifatAPI).
2025-01-31 23:33:20.375 +03:00 [INF] Executed DbCommand (4ms) [Parameters=[@__providedApiKey_0='?' (Size = 255)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [a].[Key], [a].[CreatedAt], [a].[Description], [a].[ExpiresAt], [a].[IsActive], [a].[LastUsedAt]
FROM [ApiKeys] AS [a]
WHERE [a].[Key] = @__providedApiKey_0 AND [a].[IsActive] = CAST(1 AS bit)
2025-01-31 23:33:20.382 +03:00 [INF] Received notification request: {"Title":null,"TitleEn":"Test Notification","TitleAr":" ","Filters":{"Customers.City":{"ValueKind":"Object","$type":"JsonElement"}},"NationalId":null,"NationalIds":null}
2025-01-31 23:33:20.388 +03:00 [INF] Starting GetTargetUsers with request type: Filtered Users
2025-01-31 23:33:20.389 +03:00 [WRN] No valid filters were applied
2025-01-31 23:33:20.389 +03:00 [INF] Target users query completed. Found 0 users
2025-01-31 23:33:20.390 +03:00 [WRN] No target users found. Filters: {"Customers.City":{"ValueKind":"Object","$type":"JsonElement"}}
2025-01-31 23:33:20.392 +03:00 [INF] Executing ObjectResult, writing value of type '<>f__AnonymousType11`2[[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-01-31 23:33:20.394 +03:00 [INF] Executed action NayifatAPI.Controllers.NotificationsController.SendNotification (NayifatAPI) in 165.3167ms
2025-01-31 23:33:20.397 +03:00 [INF] Executed endpoint 'NayifatAPI.Controllers.NotificationsController.SendNotification (NayifatAPI)'
2025-01-31 23:33:20.399 +03:00 [INF] Request finished HTTP/1.1 POST http://localhost:5264/api/notifications/send - 400 null application/json; charset=utf-8 179.8164ms
2025-01-31 23:34:56.723 +03:00 [INF] Application is shutting down...
2025-01-31 23:35:09.578 +03:00 [INF] Starting web application
2025-01-31 23:35:09.696 +03:00 [INF] Now listening on: http://localhost:5264
2025-01-31 23:35:09.703 +03:00 [INF] Application started. Press Ctrl+C to shut down.
2025-01-31 23:35:09.710 +03:00 [INF] Hosting environment: Development
2025-01-31 23:35:09.713 +03:00 [INF] Content root path: C:\Users\yamta\StudioProjects\nayifat_app_2025_new\NayifatAPI
2025-01-31 23:35:15.083 +03:00 [INF] Request starting HTTP/1.1 POST http://localhost:5264/api/notifications/send - application/json 287
2025-01-31 23:35:15.147 +03:00 [WRN] Failed to determine the https port for redirect.
2025-01-31 23:35:15.151 +03:00 [INF] Executing endpoint 'NayifatAPI.Controllers.NotificationsController.SendNotification (NayifatAPI)'
2025-01-31 23:35:15.190 +03:00 [INF] Route matched with {action = "SendNotification", controller = "Notifications"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] SendNotification(NayifatAPI.Controllers.SendNotificationRequest) on controller NayifatAPI.Controllers.NotificationsController (NayifatAPI).
2025-01-31 23:35:16.847 +03:00 [INF] Executed DbCommand (25ms) [Parameters=[@__providedApiKey_0='?' (Size = 255)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [a].[Key], [a].[CreatedAt], [a].[Description], [a].[ExpiresAt], [a].[IsActive], [a].[LastUsedAt]
FROM [ApiKeys] AS [a]
WHERE [a].[Key] = @__providedApiKey_0 AND [a].[IsActive] = CAST(1 AS bit)
2025-01-31 23:35:16.963 +03:00 [INF] Received notification request: {"Title":null,"TitleEn":"Test Notification","TitleAr":" ","Filters":{"Customers.City":{"ValueKind":"Object","$type":"JsonElement"}},"NationalId":null,"NationalIds":null}
2025-01-31 23:35:16.992 +03:00 [INF] Starting GetTargetUsers with request type: Filtered Users
2025-01-31 23:35:17.000 +03:00 [INF] Applied filter: City = {
      "operator": "=",
      "value": "Dammam"
    }
2025-01-31 23:35:17.005 +03:00 [INF] Executing filter query with operation: AND
2025-01-31 23:35:17.064 +03:00 [INF] Executed DbCommand (15ms) [Parameters=[@__strValue_0='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SELECT [c].[NationalId]
FROM [Customers] AS [c]
WHERE [c].[City] = @__strValue_0
2025-01-31 23:35:17.080 +03:00 [INF] Found 0 users after applying filters
2025-01-31 23:35:17.081 +03:00 [INF] Target users query completed. Found 0 users
2025-01-31 23:35:17.082 +03:00 [WRN] No target users found. Filters: {"Customers.City":{"ValueKind":"Object","$type":"JsonElement"}}
2025-01-31 23:35:17.094 +03:00 [INF] Executing ObjectResult, writing value of type '<>f__AnonymousType11`2[[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-01-31 23:35:17.115 +03:00 [INF] Executed action NayifatAPI.Controllers.NotificationsController.SendNotification (NayifatAPI) in 1917.4057ms
2025-01-31 23:35:17.122 +03:00 [INF] Executed endpoint 'NayifatAPI.Controllers.NotificationsController.SendNotification (NayifatAPI)'
2025-01-31 23:35:17.140 +03:00 [INF] Request finished HTTP/1.1 POST http://localhost:5264/api/notifications/send - 400 null application/json; charset=utf-8 2057.6449ms
2025-01-31 23:37:04.909 +03:00 [INF] Application is shutting down...
2025-01-31 23:37:15.932 +03:00 [INF] Starting web application
2025-01-31 23:37:16.071 +03:00 [INF] Now listening on: http://localhost:5264
2025-01-31 23:37:16.077 +03:00 [INF] Application started. Press Ctrl+C to shut down.
2025-01-31 23:37:16.078 +03:00 [INF] Hosting environment: Development
2025-01-31 23:37:16.079 +03:00 [INF] Content root path: C:\Users\yamta\StudioProjects\nayifat_app_2025_new\NayifatAPI
2025-01-31 23:37:21.862 +03:00 [INF] Request starting HTTP/1.1 POST http://localhost:5264/api/notifications/send - application/json 287
2025-01-31 23:37:22.042 +03:00 [WRN] Failed to determine the https port for redirect.
2025-01-31 23:37:22.049 +03:00 [INF] Executing endpoint 'NayifatAPI.Controllers.NotificationsController.SendNotification (NayifatAPI)'
2025-01-31 23:37:22.082 +03:00 [INF] Route matched with {action = "SendNotification", controller = "Notifications"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] SendNotification(NayifatAPI.Controllers.SendNotificationRequest) on controller NayifatAPI.Controllers.NotificationsController (NayifatAPI).
2025-01-31 23:37:23.750 +03:00 [INF] Executed DbCommand (36ms) [Parameters=[@__providedApiKey_0='?' (Size = 255)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [a].[Key], [a].[CreatedAt], [a].[Description], [a].[ExpiresAt], [a].[IsActive], [a].[LastUsedAt]
FROM [ApiKeys] AS [a]
WHERE [a].[Key] = @__providedApiKey_0 AND [a].[IsActive] = CAST(1 AS bit)
2025-01-31 23:37:23.836 +03:00 [INF] Received notification request: {"Title":null,"TitleEn":"Test Notification","TitleAr":" ","Filters":{"Customers.City":{"ValueKind":"Object","$type":"JsonElement"}},"NationalId":null,"NationalIds":null}
2025-01-31 23:37:23.854 +03:00 [INF] Starting GetTargetUsers with request type: Filtered Users
2025-01-31 23:37:23.865 +03:00 [INF] Applied simple City filter: {
      "operator": "=",
      "value": "Dammam"
    }
2025-01-31 23:37:23.866 +03:00 [INF] Added filter group for customers.City
2025-01-31 23:37:23.868 +03:00 [INF] Executing filter query with operation: AND
2025-01-31 23:37:23.927 +03:00 [INF] Executed DbCommand (16ms) [Parameters=[@__strValue_0='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SELECT [c].[NationalId]
FROM [Customers] AS [c]
WHERE [c].[City] = @__strValue_0
2025-01-31 23:37:23.955 +03:00 [INF] Found 0 users after applying filters
2025-01-31 23:37:23.958 +03:00 [INF] Target users query completed. Found 0 users
2025-01-31 23:37:23.960 +03:00 [WRN] No target users found. Filters: {"Customers.City":{"ValueKind":"Object","$type":"JsonElement"}}
2025-01-31 23:37:23.970 +03:00 [INF] Executing ObjectResult, writing value of type '<>f__AnonymousType11`2[[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-01-31 23:37:24.006 +03:00 [INF] Executed action NayifatAPI.Controllers.NotificationsController.SendNotification (NayifatAPI) in 1915.4389ms
2025-01-31 23:37:24.011 +03:00 [INF] Executed endpoint 'NayifatAPI.Controllers.NotificationsController.SendNotification (NayifatAPI)'
2025-01-31 23:37:24.031 +03:00 [INF] Request finished HTTP/1.1 POST http://localhost:5264/api/notifications/send - 400 null application/json; charset=utf-8 2178.1176ms
2025-01-31 23:37:37.358 +03:00 [INF] Request starting HTTP/1.1 POST http://localhost:5264/api/notifications/send - application/json 287
2025-01-31 23:37:37.368 +03:00 [INF] Executing endpoint 'NayifatAPI.Controllers.NotificationsController.SendNotification (NayifatAPI)'
2025-01-31 23:37:37.370 +03:00 [INF] Route matched with {action = "SendNotification", controller = "Notifications"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] SendNotification(NayifatAPI.Controllers.SendNotificationRequest) on controller NayifatAPI.Controllers.NotificationsController (NayifatAPI).
2025-01-31 23:37:37.427 +03:00 [INF] Executed DbCommand (3ms) [Parameters=[@__providedApiKey_0='?' (Size = 255)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [a].[Key], [a].[CreatedAt], [a].[Description], [a].[ExpiresAt], [a].[IsActive], [a].[LastUsedAt]
FROM [ApiKeys] AS [a]
WHERE [a].[Key] = @__providedApiKey_0 AND [a].[IsActive] = CAST(1 AS bit)
2025-01-31 23:37:37.437 +03:00 [INF] Received notification request: {"Title":null,"TitleEn":"Test Notification","TitleAr":" ","Filters":{"Customers.City":{"ValueKind":"Object","$type":"JsonElement"}},"NationalId":null,"NationalIds":null}
2025-01-31 23:37:37.445 +03:00 [INF] Starting GetTargetUsers with request type: Filtered Users
2025-01-31 23:37:37.445 +03:00 [INF] Applied simple City filter: {
      "operator": "=",
      "value": "Riyadh"
    }
2025-01-31 23:37:37.446 +03:00 [INF] Added filter group for customers.City
2025-01-31 23:37:37.447 +03:00 [INF] Executing filter query with operation: AND
2025-01-31 23:37:37.453 +03:00 [INF] Executed DbCommand (4ms) [Parameters=[@__strValue_0='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SELECT [c].[NationalId]
FROM [Customers] AS [c]
WHERE [c].[City] = @__strValue_0
2025-01-31 23:37:37.456 +03:00 [INF] Found 0 users after applying filters
2025-01-31 23:37:37.457 +03:00 [INF] Target users query completed. Found 0 users
2025-01-31 23:37:37.458 +03:00 [WRN] No target users found. Filters: {"Customers.City":{"ValueKind":"Object","$type":"JsonElement"}}
2025-01-31 23:37:37.461 +03:00 [INF] Executing ObjectResult, writing value of type '<>f__AnonymousType11`2[[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-01-31 23:37:37.463 +03:00 [INF] Executed action NayifatAPI.Controllers.NotificationsController.SendNotification (NayifatAPI) in 90.2491ms
2025-01-31 23:37:37.466 +03:00 [INF] Executed endpoint 'NayifatAPI.Controllers.NotificationsController.SendNotification (NayifatAPI)'
2025-01-31 23:37:37.468 +03:00 [INF] Request finished HTTP/1.1 POST http://localhost:5264/api/notifications/send - 400 null application/json; charset=utf-8 109.3288ms
2025-01-31 23:37:44.475 +03:00 [INF] Request starting HTTP/1.1 POST http://localhost:5264/api/notifications/send - application/json 287
2025-01-31 23:37:44.478 +03:00 [INF] Executing endpoint 'NayifatAPI.Controllers.NotificationsController.SendNotification (NayifatAPI)'
2025-01-31 23:37:44.480 +03:00 [INF] Route matched with {action = "SendNotification", controller = "Notifications"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] SendNotification(NayifatAPI.Controllers.SendNotificationRequest) on controller NayifatAPI.Controllers.NotificationsController (NayifatAPI).
2025-01-31 23:37:44.586 +03:00 [INF] Executed DbCommand (4ms) [Parameters=[@__providedApiKey_0='?' (Size = 255)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [a].[Key], [a].[CreatedAt], [a].[Description], [a].[ExpiresAt], [a].[IsActive], [a].[LastUsedAt]
FROM [ApiKeys] AS [a]
WHERE [a].[Key] = @__providedApiKey_0 AND [a].[IsActive] = CAST(1 AS bit)
2025-01-31 23:37:44.591 +03:00 [INF] Received notification request: {"Title":null,"TitleEn":"Test Notification","TitleAr":" ","Filters":{"Customers.City":{"ValueKind":"Object","$type":"JsonElement"}},"NationalId":null,"NationalIds":null}
2025-01-31 23:37:44.596 +03:00 [INF] Starting GetTargetUsers with request type: Filtered Users
2025-01-31 23:37:44.597 +03:00 [INF] Applied simple City filter: {
      "operator": "=",
      "value": "Riyadh"
    }
2025-01-31 23:37:44.598 +03:00 [INF] Added filter group for customers.City
2025-01-31 23:37:44.600 +03:00 [INF] Executing filter query with operation: AND
2025-01-31 23:37:44.606 +03:00 [INF] Executed DbCommand (3ms) [Parameters=[@__strValue_0='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SELECT [c].[NationalId]
FROM [Customers] AS [c]
WHERE [c].[City] = @__strValue_0
2025-01-31 23:37:44.608 +03:00 [INF] Found 0 users after applying filters
2025-01-31 23:37:44.609 +03:00 [INF] Target users query completed. Found 0 users
2025-01-31 23:37:44.610 +03:00 [WRN] No target users found. Filters: {"Customers.City":{"ValueKind":"Object","$type":"JsonElement"}}
2025-01-31 23:37:44.612 +03:00 [INF] Executing ObjectResult, writing value of type '<>f__AnonymousType11`2[[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.String, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-01-31 23:37:44.615 +03:00 [INF] Executed action NayifatAPI.Controllers.NotificationsController.SendNotification (NayifatAPI) in 132.7841ms
2025-01-31 23:37:44.618 +03:00 [INF] Executed endpoint 'NayifatAPI.Controllers.NotificationsController.SendNotification (NayifatAPI)'
2025-01-31 23:37:44.620 +03:00 [INF] Request finished HTTP/1.1 POST http://localhost:5264/api/notifications/send - 400 null application/json; charset=utf-8 145.1313ms
2025-01-31 23:38:55.860 +03:00 [INF] Application is shutting down...
2025-01-31 23:39:11.443 +03:00 [INF] Starting web application
2025-01-31 23:39:11.540 +03:00 [INF] Now listening on: http://localhost:5264
2025-01-31 23:39:11.545 +03:00 [INF] Application started. Press Ctrl+C to shut down.
2025-01-31 23:39:11.547 +03:00 [INF] Hosting environment: Development
2025-01-31 23:39:11.548 +03:00 [INF] Content root path: C:\Users\yamta\StudioProjects\nayifat_app_2025_new\NayifatAPI
2025-01-31 23:39:16.834 +03:00 [INF] Request starting HTTP/1.1 POST http://localhost:5264/api/notifications/send - application/json 287
2025-01-31 23:39:17.248 +03:00 [WRN] Failed to determine the https port for redirect.
2025-01-31 23:39:17.330 +03:00 [INF] Executing endpoint 'NayifatAPI.Controllers.NotificationsController.SendNotification (NayifatAPI)'
2025-01-31 23:39:17.493 +03:00 [INF] Route matched with {action = "SendNotification", controller = "Notifications"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] SendNotification(NayifatAPI.Controllers.SendNotificationRequest) on controller NayifatAPI.Controllers.NotificationsController (NayifatAPI).
2025-01-31 23:39:21.159 +03:00 [INF] Executed DbCommand (30ms) [Parameters=[@__providedApiKey_0='?' (Size = 255)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [a].[Key], [a].[CreatedAt], [a].[Description], [a].[ExpiresAt], [a].[IsActive], [a].[LastUsedAt]
FROM [ApiKeys] AS [a]
WHERE [a].[Key] = @__providedApiKey_0 AND [a].[IsActive] = CAST(1 AS bit)
2025-01-31 23:39:21.292 +03:00 [INF] Received notification request: {"Title":null,"TitleEn":"Test Notification","TitleAr":" ","Filters":{"Customers.City":{"ValueKind":"Object","$type":"JsonElement"}},"NationalId":null,"NationalIds":null}
2025-01-31 23:39:21.317 +03:00 [INF] Starting GetTargetUsers with request type: Filtered Users
2025-01-31 23:39:21.329 +03:00 [INF] Processing filter: City = Riyadh
2025-01-31 23:39:21.337 +03:00 [INF] Applied City filter: = Riyadh
2025-01-31 23:39:21.340 +03:00 [INF] Added filter group for customers.City
2025-01-31 23:39:21.344 +03:00 [INF] Executing filter query with operation: AND
2025-01-31 23:39:21.464 +03:00 [INF] Executed DbCommand (19ms) [Parameters=[@__value_0='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SELECT [c].[NationalId]
FROM [Customers] AS [c]
WHERE [c].[City] = @__value_0
2025-01-31 23:39:21.493 +03:00 [INF] Found 2 users after applying filters
2025-01-31 23:39:21.495 +03:00 [INF] Target users query completed. Found 2 users
2025-01-31 23:39:21.497 +03:00 [INF] Found 2 target users for notification
2025-01-31 23:39:21.793 +03:00 [INF] Executed DbCommand (81ms) [Parameters=[@p0='?' (Size = 4000), @p1='?' (Size = 8000) (DbType = AnsiString), @p2='?' (Size = 8000) (DbType = AnsiString), @p3='?' (Size = 8000) (DbType = AnsiString), @p4='?' (DbType = DateTime2), @p5='?' (DbType = DateTime2), @p6='?' (Size = 255), @p7='?' (Size = 4000), @p8='?' (Size = 255), @p9='?' (Size = 255), @p10='?' (Size = 255)], CommandType='"Text"', CommandTimeout='30']
SET IMPLICIT_TRANSACTIONS OFF;
SET NOCOUNT ON;
INSERT INTO [notification_templates] ([additional_data], [Body], [body_ar], [body_en], [created_at], [expiry_at], [Route], [target_criteria], [Title], [title_ar], [title_en])
OUTPUT INSERTED.[Id]
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7, @p8, @p9, @p10);
2025-01-31 23:39:21.833 +03:00 [INF] Created notification template with ID: 3
2025-01-31 23:39:21.915 +03:00 [INF] Executed DbCommand (9ms) [Parameters=[@p0='?' (Size = 4000), @p1='?' (DbType = DateTime2), @p2='?' (Size = 4000), @p3='?' (Size = 4000), @p4='?' (Size = 4000), @p5='?' (Size = 450), @p6='?' (Size = 4000), @p7='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SET IMPLICIT_TRANSACTIONS OFF;
SET NOCOUNT ON;
INSERT INTO [AuthLogs] ([AuthType], [CreatedAt], [DeviceId], [FailureReason], [IpAddress], [NationalId], [Status], [UserAgent])
OUTPUT INSERTED.[Id]
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7);
2025-01-31 23:39:21.936 +03:00 [INF] Executed DbCommand (4ms) [Parameters=[@__userId_0='?' (Size = 450)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [u].[national_id], [u].[last_updated], [u].[notifications]
FROM [user_notifications] AS [u]
WHERE [u].[national_id] = @__userId_0
2025-01-31 23:39:21.956 +03:00 [INF] Processing notification for user 1012345678. Existing notification record: true
2025-01-31 23:39:21.959 +03:00 [INF] Current notifications count for user 1012345678: 1
2025-01-31 23:39:21.989 +03:00 [INF] Serialized new notifications for user 1012345678. Length: 279
2025-01-31 23:39:22.033 +03:00 [INF] Executed DbCommand (28ms) [Parameters=[@p0='?' (Size = 4000), @p1='?' (DbType = DateTime2), @p2='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
UPDATE user_notifications SET notifications = @p0, last_updated = @p1 WHERE national_id = @p2
2025-01-31 23:39:22.040 +03:00 [INF] Updated existing UserNotification for user: 1012345678
2025-01-31 23:39:22.048 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@__userId_0='?' (Size = 450)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [u].[national_id], [u].[last_updated], [u].[notifications]
FROM [user_notifications] AS [u]
WHERE [u].[national_id] = @__userId_0
2025-01-31 23:39:22.053 +03:00 [INF] Processing notification for user 1045678901. Existing notification record: true
2025-01-31 23:39:22.054 +03:00 [INF] Current notifications count for user 1045678901: 1
2025-01-31 23:39:22.056 +03:00 [INF] Serialized new notifications for user 1045678901. Length: 279
2025-01-31 23:39:22.061 +03:00 [INF] Executed DbCommand (3ms) [Parameters=[@p0='?' (Size = 4000), @p1='?' (DbType = DateTime2), @p2='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
UPDATE user_notifications SET notifications = @p0, last_updated = @p1 WHERE national_id = @p2
2025-01-31 23:39:22.064 +03:00 [INF] Updated existing UserNotification for user: 1045678901
2025-01-31 23:39:22.075 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@p0='?' (Size = 4000), @p1='?' (DbType = DateTime2), @p2='?' (Size = 4000), @p3='?' (Size = 4000), @p4='?' (Size = 4000), @p5='?' (Size = 450), @p6='?' (Size = 4000), @p7='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SET IMPLICIT_TRANSACTIONS OFF;
SET NOCOUNT ON;
INSERT INTO [AuthLogs] ([AuthType], [CreatedAt], [DeviceId], [FailureReason], [IpAddress], [NationalId], [Status], [UserAgent])
OUTPUT INSERTED.[Id]
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7);
2025-01-31 23:39:22.081 +03:00 [INF] Successfully sent notifications. Template: 3, Success: 2, Total: 2
2025-01-31 23:39:22.092 +03:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType9`2[[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Object, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-01-31 23:39:22.120 +03:00 [INF] Executed action NayifatAPI.Controllers.NotificationsController.SendNotification (NayifatAPI) in 4253.7404ms
2025-01-31 23:39:22.124 +03:00 [INF] Executed endpoint 'NayifatAPI.Controllers.NotificationsController.SendNotification (NayifatAPI)'
2025-01-31 23:39:22.141 +03:00 [INF] Request finished HTTP/1.1 POST http://localhost:5264/api/notifications/send - 200 null application/json; charset=utf-8 5311.1279ms
2025-01-31 23:39:57.426 +03:00 [INF] Request starting HTTP/1.1 POST http://localhost:5264/api/notifications/send - application/json 285
2025-01-31 23:39:57.435 +03:00 [INF] Executing endpoint 'NayifatAPI.Controllers.NotificationsController.SendNotification (NayifatAPI)'
2025-01-31 23:39:57.437 +03:00 [INF] Route matched with {action = "SendNotification", controller = "Notifications"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] SendNotification(NayifatAPI.Controllers.SendNotificationRequest) on controller NayifatAPI.Controllers.NotificationsController (NayifatAPI).
2025-01-31 23:39:57.485 +03:00 [INF] Executed DbCommand (7ms) [Parameters=[@__providedApiKey_0='?' (Size = 255)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [a].[Key], [a].[CreatedAt], [a].[Description], [a].[ExpiresAt], [a].[IsActive], [a].[LastUsedAt]
FROM [ApiKeys] AS [a]
WHERE [a].[Key] = @__providedApiKey_0 AND [a].[IsActive] = CAST(1 AS bit)
2025-01-31 23:39:57.492 +03:00 [INF] Received notification request: {"Title":null,"TitleEn":"Test Notification","TitleAr":" ","Filters":{"Customers.City":{"ValueKind":"Object","$type":"JsonElement"}},"NationalId":null,"NationalIds":null}
2025-01-31 23:39:57.497 +03:00 [INF] Starting GetTargetUsers with request type: Filtered Users
2025-01-31 23:39:57.499 +03:00 [INF] Processing filter: City LIKE h
2025-01-31 23:39:57.503 +03:00 [INF] Applied City filter: LIKE h
2025-01-31 23:39:57.504 +03:00 [INF] Added filter group for customers.City
2025-01-31 23:39:57.506 +03:00 [INF] Executing filter query with operation: AND
2025-01-31 23:39:57.555 +03:00 [INF] Executed DbCommand (4ms) [Parameters=[@__Format_1='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SELECT [c].[NationalId]
FROM [Customers] AS [c]
WHERE [c].[City] LIKE @__Format_1
2025-01-31 23:39:57.557 +03:00 [INF] Found 3 users after applying filters
2025-01-31 23:39:57.558 +03:00 [INF] Target users query completed. Found 3 users
2025-01-31 23:39:57.560 +03:00 [INF] Found 3 target users for notification
2025-01-31 23:39:57.572 +03:00 [INF] Executed DbCommand (10ms) [Parameters=[@p0='?' (Size = 4000), @p1='?' (Size = 8000) (DbType = AnsiString), @p2='?' (Size = 8000) (DbType = AnsiString), @p3='?' (Size = 8000) (DbType = AnsiString), @p4='?' (DbType = DateTime2), @p5='?' (DbType = DateTime2), @p6='?' (Size = 255), @p7='?' (Size = 4000), @p8='?' (Size = 255), @p9='?' (Size = 255), @p10='?' (Size = 255)], CommandType='"Text"', CommandTimeout='30']
SET IMPLICIT_TRANSACTIONS OFF;
SET NOCOUNT ON;
INSERT INTO [notification_templates] ([additional_data], [Body], [body_ar], [body_en], [created_at], [expiry_at], [Route], [target_criteria], [Title], [title_ar], [title_en])
OUTPUT INSERTED.[Id]
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7, @p8, @p9, @p10);
2025-01-31 23:39:57.575 +03:00 [INF] Created notification template with ID: 1
2025-01-31 23:39:57.580 +03:00 [INF] Executed DbCommand (3ms) [Parameters=[@p0='?' (Size = 4000), @p1='?' (DbType = DateTime2), @p2='?' (Size = 4000), @p3='?' (Size = 4000), @p4='?' (Size = 4000), @p5='?' (Size = 450), @p6='?' (Size = 4000), @p7='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SET IMPLICIT_TRANSACTIONS OFF;
SET NOCOUNT ON;
INSERT INTO [AuthLogs] ([AuthType], [CreatedAt], [DeviceId], [FailureReason], [IpAddress], [NationalId], [Status], [UserAgent])
OUTPUT INSERTED.[Id]
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7);
2025-01-31 23:39:57.585 +03:00 [INF] Executed DbCommand (2ms) [Parameters=[@__userId_0='?' (Size = 450)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [u].[national_id], [u].[last_updated], [u].[notifications]
FROM [user_notifications] AS [u]
WHERE [u].[national_id] = @__userId_0
2025-01-31 23:39:57.588 +03:00 [INF] Processing notification for user 1012345678. Existing notification record: false
2025-01-31 23:39:57.589 +03:00 [INF] Current notifications count for user 1012345678: 0
2025-01-31 23:39:57.590 +03:00 [INF] Serialized new notifications for user 1012345678. Length: 139
2025-01-31 23:39:57.598 +03:00 [INF] Executed DbCommand (4ms) [Parameters=[@p0='?' (Size = 4000), @p1='?' (Size = 4000), @p2='?' (DbType = DateTime2)], CommandType='"Text"', CommandTimeout='30']
INSERT INTO user_notifications (national_id, notifications, last_updated) VALUES (@p0, @p1, @p2)
2025-01-31 23:39:57.603 +03:00 [INF] Created new UserNotification entry for user: 1012345678
2025-01-31 23:39:57.606 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@__userId_0='?' (Size = 450)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [u].[national_id], [u].[last_updated], [u].[notifications]
FROM [user_notifications] AS [u]
WHERE [u].[national_id] = @__userId_0
2025-01-31 23:39:57.609 +03:00 [INF] Processing notification for user 1023456789. Existing notification record: false
2025-01-31 23:39:57.610 +03:00 [INF] Current notifications count for user 1023456789: 0
2025-01-31 23:39:57.611 +03:00 [INF] Serialized new notifications for user 1023456789. Length: 139
2025-01-31 23:39:57.614 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@p0='?' (Size = 4000), @p1='?' (Size = 4000), @p2='?' (DbType = DateTime2)], CommandType='"Text"', CommandTimeout='30']
INSERT INTO user_notifications (national_id, notifications, last_updated) VALUES (@p0, @p1, @p2)
2025-01-31 23:39:57.618 +03:00 [INF] Created new UserNotification entry for user: 1023456789
2025-01-31 23:39:57.622 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@__userId_0='?' (Size = 450)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [u].[national_id], [u].[last_updated], [u].[notifications]
FROM [user_notifications] AS [u]
WHERE [u].[national_id] = @__userId_0
2025-01-31 23:39:57.625 +03:00 [INF] Processing notification for user 1045678901. Existing notification record: false
2025-01-31 23:39:57.626 +03:00 [INF] Current notifications count for user 1045678901: 0
2025-01-31 23:39:57.627 +03:00 [INF] Serialized new notifications for user 1045678901. Length: 139
2025-01-31 23:39:57.629 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@p0='?' (Size = 4000), @p1='?' (Size = 4000), @p2='?' (DbType = DateTime2)], CommandType='"Text"', CommandTimeout='30']
INSERT INTO user_notifications (national_id, notifications, last_updated) VALUES (@p0, @p1, @p2)
2025-01-31 23:39:57.633 +03:00 [INF] Created new UserNotification entry for user: 1045678901
2025-01-31 23:39:57.638 +03:00 [INF] Executed DbCommand (4ms) [Parameters=[@p0='?' (Size = 4000), @p1='?' (DbType = DateTime2), @p2='?' (Size = 4000), @p3='?' (Size = 4000), @p4='?' (Size = 4000), @p5='?' (Size = 450), @p6='?' (Size = 4000), @p7='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SET IMPLICIT_TRANSACTIONS OFF;
SET NOCOUNT ON;
INSERT INTO [AuthLogs] ([AuthType], [CreatedAt], [DeviceId], [FailureReason], [IpAddress], [NationalId], [Status], [UserAgent])
OUTPUT INSERTED.[Id]
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7);
2025-01-31 23:39:57.642 +03:00 [INF] Successfully sent notifications. Template: 1, Success: 3, Total: 3
2025-01-31 23:39:57.644 +03:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType9`2[[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Object, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-01-31 23:39:57.646 +03:00 [INF] Executed action NayifatAPI.Controllers.NotificationsController.SendNotification (NayifatAPI) in 207.3561ms
2025-01-31 23:39:57.648 +03:00 [INF] Executed endpoint 'NayifatAPI.Controllers.NotificationsController.SendNotification (NayifatAPI)'
2025-01-31 23:39:57.649 +03:00 [INF] Request finished HTTP/1.1 POST http://localhost:5264/api/notifications/send - 200 null application/json; charset=utf-8 223.5803ms
2025-01-31 23:42:14.785 +03:00 [INF] Request starting HTTP/1.1 POST http://localhost:5264/api/notifications/send - application/json 296
2025-01-31 23:42:14.789 +03:00 [INF] Executing endpoint 'NayifatAPI.Controllers.NotificationsController.SendNotification (NayifatAPI)'
2025-01-31 23:42:14.791 +03:00 [INF] Route matched with {action = "SendNotification", controller = "Notifications"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] SendNotification(NayifatAPI.Controllers.SendNotificationRequest) on controller NayifatAPI.Controllers.NotificationsController (NayifatAPI).
2025-01-31 23:42:14.899 +03:00 [INF] Executed DbCommand (3ms) [Parameters=[@__providedApiKey_0='?' (Size = 255)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [a].[Key], [a].[CreatedAt], [a].[Description], [a].[ExpiresAt], [a].[IsActive], [a].[LastUsedAt]
FROM [ApiKeys] AS [a]
WHERE [a].[Key] = @__providedApiKey_0 AND [a].[IsActive] = CAST(1 AS bit)
2025-01-31 23:42:14.901 +03:00 [INF] Received notification request: {"Title":null,"TitleEn":"Test Notification","TitleAr":" ","Filters":{"Customers.SalaryCustomer":{"ValueKind":"Object","$type":"JsonElement"}},"NationalId":null,"NationalIds":null}
2025-01-31 23:42:14.906 +03:00 [INF] Starting GetTargetUsers with request type: Filtered Users
2025-01-31 23:42:14.907 +03:00 [INF] Processing filter: SalaryCustomer > 15000
2025-01-31 23:42:14.912 +03:00 [INF] Applied SalaryCustomer filter: > 15000
2025-01-31 23:42:14.915 +03:00 [INF] Added filter group for customers.SalaryCustomer
2025-01-31 23:42:14.915 +03:00 [INF] Executing filter query with operation: AND
2025-01-31 23:42:15.007 +03:00 [INF] Executed DbCommand (83ms) [Parameters=[@__value_0='?' (Precision = 18) (Scale = 2) (DbType = Decimal)], CommandType='"Text"', CommandTimeout='30']
SELECT [c].[NationalId]
FROM [Customers] AS [c]
WHERE [c].[SalaryCustomer] > @__value_0
2025-01-31 23:42:15.010 +03:00 [INF] Found 2 users after applying filters
2025-01-31 23:42:15.011 +03:00 [INF] Target users query completed. Found 2 users
2025-01-31 23:42:15.012 +03:00 [INF] Found 2 target users for notification
2025-01-31 23:42:15.018 +03:00 [INF] Executed DbCommand (5ms) [Parameters=[@p0='?' (Size = 4000), @p1='?' (Size = 8000) (DbType = AnsiString), @p2='?' (Size = 8000) (DbType = AnsiString), @p3='?' (Size = 8000) (DbType = AnsiString), @p4='?' (DbType = DateTime2), @p5='?' (DbType = DateTime2), @p6='?' (Size = 255), @p7='?' (Size = 4000), @p8='?' (Size = 255), @p9='?' (Size = 255), @p10='?' (Size = 255)], CommandType='"Text"', CommandTimeout='30']
SET IMPLICIT_TRANSACTIONS OFF;
SET NOCOUNT ON;
INSERT INTO [notification_templates] ([additional_data], [Body], [body_ar], [body_en], [created_at], [expiry_at], [Route], [target_criteria], [Title], [title_ar], [title_en])
OUTPUT INSERTED.[Id]
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7, @p8, @p9, @p10);
2025-01-31 23:42:15.023 +03:00 [INF] Created notification template with ID: 2
2025-01-31 23:42:15.032 +03:00 [INF] Executed DbCommand (7ms) [Parameters=[@p0='?' (Size = 4000), @p1='?' (DbType = DateTime2), @p2='?' (Size = 4000), @p3='?' (Size = 4000), @p4='?' (Size = 4000), @p5='?' (Size = 450), @p6='?' (Size = 4000), @p7='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SET IMPLICIT_TRANSACTIONS OFF;
SET NOCOUNT ON;
INSERT INTO [AuthLogs] ([AuthType], [CreatedAt], [DeviceId], [FailureReason], [IpAddress], [NationalId], [Status], [UserAgent])
OUTPUT INSERTED.[Id]
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7);
2025-01-31 23:42:15.043 +03:00 [INF] Executed DbCommand (7ms) [Parameters=[@__userId_0='?' (Size = 450)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [u].[national_id], [u].[last_updated], [u].[notifications]
FROM [user_notifications] AS [u]
WHERE [u].[national_id] = @__userId_0
2025-01-31 23:42:15.046 +03:00 [INF] Processing notification for user 1034567890. Existing notification record: false
2025-01-31 23:42:15.047 +03:00 [INF] Current notifications count for user 1034567890: 0
2025-01-31 23:42:15.048 +03:00 [INF] Serialized new notifications for user 1034567890. Length: 140
2025-01-31 23:42:15.065 +03:00 [INF] Executed DbCommand (3ms) [Parameters=[@p0='?' (Size = 4000), @p1='?' (Size = 4000), @p2='?' (DbType = DateTime2)], CommandType='"Text"', CommandTimeout='30']
INSERT INTO user_notifications (national_id, notifications, last_updated) VALUES (@p0, @p1, @p2)
2025-01-31 23:42:15.067 +03:00 [INF] Created new UserNotification entry for user: 1034567890
2025-01-31 23:42:15.076 +03:00 [INF] Executed DbCommand (4ms) [Parameters=[@__userId_0='?' (Size = 450)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [u].[national_id], [u].[last_updated], [u].[notifications]
FROM [user_notifications] AS [u]
WHERE [u].[national_id] = @__userId_0
2025-01-31 23:42:15.078 +03:00 [INF] Processing notification for user 1056789012. Existing notification record: false
2025-01-31 23:42:15.079 +03:00 [INF] Current notifications count for user 1056789012: 0
2025-01-31 23:42:15.080 +03:00 [INF] Serialized new notifications for user 1056789012. Length: 140
2025-01-31 23:42:15.089 +03:00 [INF] Executed DbCommand (8ms) [Parameters=[@p0='?' (Size = 4000), @p1='?' (Size = 4000), @p2='?' (DbType = DateTime2)], CommandType='"Text"', CommandTimeout='30']
INSERT INTO user_notifications (national_id, notifications, last_updated) VALUES (@p0, @p1, @p2)
2025-01-31 23:42:15.092 +03:00 [INF] Created new UserNotification entry for user: 1056789012
2025-01-31 23:42:15.100 +03:00 [INF] Executed DbCommand (5ms) [Parameters=[@p0='?' (Size = 4000), @p1='?' (DbType = DateTime2), @p2='?' (Size = 4000), @p3='?' (Size = 4000), @p4='?' (Size = 4000), @p5='?' (Size = 450), @p6='?' (Size = 4000), @p7='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SET IMPLICIT_TRANSACTIONS OFF;
SET NOCOUNT ON;
INSERT INTO [AuthLogs] ([AuthType], [CreatedAt], [DeviceId], [FailureReason], [IpAddress], [NationalId], [Status], [UserAgent])
OUTPUT INSERTED.[Id]
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7);
2025-01-31 23:42:15.106 +03:00 [INF] Successfully sent notifications. Template: 2, Success: 2, Total: 2
2025-01-31 23:42:15.108 +03:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType9`2[[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Object, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-01-31 23:42:15.110 +03:00 [INF] Executed action NayifatAPI.Controllers.NotificationsController.SendNotification (NayifatAPI) in 317.2589ms
2025-01-31 23:42:15.113 +03:00 [INF] Executed endpoint 'NayifatAPI.Controllers.NotificationsController.SendNotification (NayifatAPI)'
2025-01-31 23:42:15.115 +03:00 [INF] Request finished HTTP/1.1 POST http://localhost:5264/api/notifications/send - 200 null application/json; charset=utf-8 329.8403ms
2025-01-31 23:43:22.091 +03:00 [INF] Request starting HTTP/1.1 POST http://localhost:5264/api/notifications/send - application/json 296
2025-01-31 23:43:23.070 +03:00 [INF] Executing endpoint 'NayifatAPI.Controllers.NotificationsController.SendNotification (NayifatAPI)'
2025-01-31 23:43:23.094 +03:00 [INF] Route matched with {action = "SendNotification", controller = "Notifications"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] SendNotification(NayifatAPI.Controllers.SendNotificationRequest) on controller NayifatAPI.Controllers.NotificationsController (NayifatAPI).
2025-01-31 23:43:23.109 +03:00 [INF] Executed DbCommand (8ms) [Parameters=[@__providedApiKey_0='?' (Size = 255)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [a].[Key], [a].[CreatedAt], [a].[Description], [a].[ExpiresAt], [a].[IsActive], [a].[LastUsedAt]
FROM [ApiKeys] AS [a]
WHERE [a].[Key] = @__providedApiKey_0 AND [a].[IsActive] = CAST(1 AS bit)
2025-01-31 23:43:23.112 +03:00 [INF] Received notification request: {"Title":null,"TitleEn":"Test Notification","TitleAr":" ","Filters":{"Customers.SalaryCustomer":{"ValueKind":"Object","$type":"JsonElement"}},"NationalId":null,"NationalIds":null}
2025-01-31 23:43:23.123 +03:00 [INF] Starting GetTargetUsers with request type: Filtered Users
2025-01-31 23:43:23.126 +03:00 [INF] Processing filter: SalaryCustomer < 16000
2025-01-31 23:43:23.128 +03:00 [INF] Applied SalaryCustomer filter: < 16000
2025-01-31 23:43:23.130 +03:00 [INF] Added filter group for customers.SalaryCustomer
2025-01-31 23:43:23.131 +03:00 [INF] Executing filter query with operation: AND
2025-01-31 23:43:23.146 +03:00 [INF] Executed DbCommand (5ms) [Parameters=[@__value_0='?' (Precision = 18) (Scale = 2) (DbType = Decimal)], CommandType='"Text"', CommandTimeout='30']
SELECT [c].[NationalId]
FROM [Customers] AS [c]
WHERE [c].[SalaryCustomer] < @__value_0
2025-01-31 23:43:23.149 +03:00 [INF] Found 3 users after applying filters
2025-01-31 23:43:23.150 +03:00 [INF] Target users query completed. Found 3 users
2025-01-31 23:43:23.160 +03:00 [INF] Found 3 target users for notification
2025-01-31 23:43:23.173 +03:00 [INF] Executed DbCommand (10ms) [Parameters=[@p0='?' (Size = 4000), @p1='?' (Size = 8000) (DbType = AnsiString), @p2='?' (Size = 8000) (DbType = AnsiString), @p3='?' (Size = 8000) (DbType = AnsiString), @p4='?' (DbType = DateTime2), @p5='?' (DbType = DateTime2), @p6='?' (Size = 255), @p7='?' (Size = 4000), @p8='?' (Size = 255), @p9='?' (Size = 255), @p10='?' (Size = 255)], CommandType='"Text"', CommandTimeout='30']
SET IMPLICIT_TRANSACTIONS OFF;
SET NOCOUNT ON;
INSERT INTO [notification_templates] ([additional_data], [Body], [body_ar], [body_en], [created_at], [expiry_at], [Route], [target_criteria], [Title], [title_ar], [title_en])
OUTPUT INSERTED.[Id]
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7, @p8, @p9, @p10);
2025-01-31 23:43:23.177 +03:00 [INF] Created notification template with ID: 3
2025-01-31 23:43:23.191 +03:00 [INF] Executed DbCommand (12ms) [Parameters=[@p0='?' (Size = 4000), @p1='?' (DbType = DateTime2), @p2='?' (Size = 4000), @p3='?' (Size = 4000), @p4='?' (Size = 4000), @p5='?' (Size = 450), @p6='?' (Size = 4000), @p7='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SET IMPLICIT_TRANSACTIONS OFF;
SET NOCOUNT ON;
INSERT INTO [AuthLogs] ([AuthType], [CreatedAt], [DeviceId], [FailureReason], [IpAddress], [NationalId], [Status], [UserAgent])
OUTPUT INSERTED.[Id]
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7);
2025-01-31 23:43:23.200 +03:00 [INF] Executed DbCommand (4ms) [Parameters=[@__userId_0='?' (Size = 450)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [u].[national_id], [u].[last_updated], [u].[notifications]
FROM [user_notifications] AS [u]
WHERE [u].[national_id] = @__userId_0
2025-01-31 23:43:23.209 +03:00 [INF] Processing notification for user 1012345678. Existing notification record: true
2025-01-31 23:43:23.213 +03:00 [INF] Current notifications count for user 1012345678: 1
2025-01-31 23:43:23.215 +03:00 [INF] Serialized new notifications for user 1012345678. Length: 278
2025-01-31 23:43:23.228 +03:00 [INF] Executed DbCommand (12ms) [Parameters=[@p0='?' (Size = 4000), @p1='?' (DbType = DateTime2), @p2='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
UPDATE user_notifications SET notifications = @p0, last_updated = @p1 WHERE national_id = @p2
2025-01-31 23:43:23.231 +03:00 [INF] Updated existing UserNotification for user: 1012345678
2025-01-31 23:43:23.236 +03:00 [INF] Executed DbCommand (2ms) [Parameters=[@__userId_0='?' (Size = 450)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [u].[national_id], [u].[last_updated], [u].[notifications]
FROM [user_notifications] AS [u]
WHERE [u].[national_id] = @__userId_0
2025-01-31 23:43:23.243 +03:00 [INF] Processing notification for user 1023456789. Existing notification record: true
2025-01-31 23:43:23.245 +03:00 [INF] Current notifications count for user 1023456789: 1
2025-01-31 23:43:23.246 +03:00 [INF] Serialized new notifications for user 1023456789. Length: 278
2025-01-31 23:43:23.261 +03:00 [INF] Executed DbCommand (13ms) [Parameters=[@p0='?' (Size = 4000), @p1='?' (DbType = DateTime2), @p2='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
UPDATE user_notifications SET notifications = @p0, last_updated = @p1 WHERE national_id = @p2
2025-01-31 23:43:23.263 +03:00 [INF] Updated existing UserNotification for user: 1023456789
2025-01-31 23:43:23.267 +03:00 [INF] Executed DbCommand (3ms) [Parameters=[@__userId_0='?' (Size = 450)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [u].[national_id], [u].[last_updated], [u].[notifications]
FROM [user_notifications] AS [u]
WHERE [u].[national_id] = @__userId_0
2025-01-31 23:43:23.277 +03:00 [INF] Processing notification for user 1045678901. Existing notification record: true
2025-01-31 23:43:23.278 +03:00 [INF] Current notifications count for user 1045678901: 1
2025-01-31 23:43:23.280 +03:00 [INF] Serialized new notifications for user 1045678901. Length: 278
2025-01-31 23:43:23.292 +03:00 [INF] Executed DbCommand (11ms) [Parameters=[@p0='?' (Size = 4000), @p1='?' (DbType = DateTime2), @p2='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
UPDATE user_notifications SET notifications = @p0, last_updated = @p1 WHERE national_id = @p2
2025-01-31 23:43:23.294 +03:00 [INF] Updated existing UserNotification for user: 1045678901
2025-01-31 23:43:23.300 +03:00 [INF] Executed DbCommand (4ms) [Parameters=[@p0='?' (Size = 4000), @p1='?' (DbType = DateTime2), @p2='?' (Size = 4000), @p3='?' (Size = 4000), @p4='?' (Size = 4000), @p5='?' (Size = 450), @p6='?' (Size = 4000), @p7='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SET IMPLICIT_TRANSACTIONS OFF;
SET NOCOUNT ON;
INSERT INTO [AuthLogs] ([AuthType], [CreatedAt], [DeviceId], [FailureReason], [IpAddress], [NationalId], [Status], [UserAgent])
OUTPUT INSERTED.[Id]
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7);
2025-01-31 23:43:23.308 +03:00 [INF] Successfully sent notifications. Template: 3, Success: 3, Total: 3
2025-01-31 23:43:23.310 +03:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType9`2[[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Object, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-01-31 23:43:23.311 +03:00 [INF] Executed action NayifatAPI.Controllers.NotificationsController.SendNotification (NayifatAPI) in 213.6276ms
2025-01-31 23:43:23.313 +03:00 [INF] Executed endpoint 'NayifatAPI.Controllers.NotificationsController.SendNotification (NayifatAPI)'
2025-01-31 23:43:23.314 +03:00 [INF] Request finished HTTP/1.1 POST http://localhost:5264/api/notifications/send - 200 null application/json; charset=utf-8 1223.3118ms
2025-01-31 23:47:02.360 +03:00 [INF] Request starting HTTP/1.1 POST http://localhost:5264/api/notifications/send - application/json 296
2025-01-31 23:47:02.362 +03:00 [INF] Executing endpoint 'NayifatAPI.Controllers.NotificationsController.SendNotification (NayifatAPI)'
2025-01-31 23:47:02.363 +03:00 [INF] Route matched with {action = "SendNotification", controller = "Notifications"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] SendNotification(NayifatAPI.Controllers.SendNotificationRequest) on controller NayifatAPI.Controllers.NotificationsController (NayifatAPI).
2025-01-31 23:47:02.367 +03:00 [INF] Executed DbCommand (2ms) [Parameters=[@__providedApiKey_0='?' (Size = 255)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [a].[Key], [a].[CreatedAt], [a].[Description], [a].[ExpiresAt], [a].[IsActive], [a].[LastUsedAt]
FROM [ApiKeys] AS [a]
WHERE [a].[Key] = @__providedApiKey_0 AND [a].[IsActive] = CAST(1 AS bit)
2025-01-31 23:47:02.369 +03:00 [INF] Received notification request: {"Title":null,"TitleEn":"Test Notification","TitleAr":" ","Filters":{"Customers.SalaryCustomer":{"ValueKind":"Object","$type":"JsonElement"}},"NationalId":null,"NationalIds":null}
2025-01-31 23:47:02.373 +03:00 [INF] Starting GetTargetUsers with request type: Filtered Users
2025-01-31 23:47:02.374 +03:00 [INF] Processing filter: SalaryCustomer < 16000
2025-01-31 23:47:02.375 +03:00 [INF] Applied SalaryCustomer filter: < 16000
2025-01-31 23:47:02.377 +03:00 [INF] Added filter group for customers.SalaryCustomer
2025-01-31 23:47:02.377 +03:00 [INF] Executing filter query with operation: AND
2025-01-31 23:47:02.381 +03:00 [INF] Executed DbCommand (2ms) [Parameters=[@__value_0='?' (Precision = 18) (Scale = 2) (DbType = Decimal)], CommandType='"Text"', CommandTimeout='30']
SELECT [c].[NationalId]
FROM [Customers] AS [c]
WHERE [c].[SalaryCustomer] < @__value_0
2025-01-31 23:47:02.384 +03:00 [INF] Found 3 users after applying filters
2025-01-31 23:47:02.386 +03:00 [INF] Target users query completed. Found 3 users
2025-01-31 23:47:02.387 +03:00 [INF] Found 3 target users for notification
2025-01-31 23:47:02.465 +03:00 [INF] Executed DbCommand (76ms) [Parameters=[@p0='?' (Size = 4000), @p1='?' (Size = 8000) (DbType = AnsiString), @p2='?' (Size = 8000) (DbType = AnsiString), @p3='?' (Size = 8000) (DbType = AnsiString), @p4='?' (DbType = DateTime2), @p5='?' (DbType = DateTime2), @p6='?' (Size = 255), @p7='?' (Size = 4000), @p8='?' (Size = 255), @p9='?' (Size = 255), @p10='?' (Size = 255)], CommandType='"Text"', CommandTimeout='30']
SET IMPLICIT_TRANSACTIONS OFF;
SET NOCOUNT ON;
INSERT INTO [notification_templates] ([additional_data], [Body], [body_ar], [body_en], [created_at], [expiry_at], [Route], [target_criteria], [Title], [title_ar], [title_en])
OUTPUT INSERTED.[Id]
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7, @p8, @p9, @p10);
2025-01-31 23:47:02.469 +03:00 [INF] Created notification template with ID: 1
2025-01-31 23:47:02.474 +03:00 [INF] Executed DbCommand (3ms) [Parameters=[@p0='?' (Size = 4000), @p1='?' (DbType = DateTime2), @p2='?' (Size = 4000), @p3='?' (Size = 4000), @p4='?' (Size = 4000), @p5='?' (Size = 450), @p6='?' (Size = 4000), @p7='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SET IMPLICIT_TRANSACTIONS OFF;
SET NOCOUNT ON;
INSERT INTO [AuthLogs] ([AuthType], [CreatedAt], [DeviceId], [FailureReason], [IpAddress], [NationalId], [Status], [UserAgent])
OUTPUT INSERTED.[Id]
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7);
2025-01-31 23:47:02.478 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@__userId_0='?' (Size = 450)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [u].[national_id], [u].[last_updated], [u].[notifications]
FROM [user_notifications] AS [u]
WHERE [u].[national_id] = @__userId_0
2025-01-31 23:47:02.479 +03:00 [INF] Processing notification for user 1012345678. Existing notification record: false
2025-01-31 23:47:02.480 +03:00 [INF] Current notifications count for user 1012345678: 0
2025-01-31 23:47:02.481 +03:00 [INF] Serialized new notifications for user 1012345678. Length: 140
2025-01-31 23:47:02.486 +03:00 [INF] Executed DbCommand (4ms) [Parameters=[@p0='?' (Size = 4000), @p1='?' (Size = 4000), @p2='?' (DbType = DateTime2)], CommandType='"Text"', CommandTimeout='30']
INSERT INTO user_notifications (national_id, notifications, last_updated) VALUES (@p0, @p1, @p2)
2025-01-31 23:47:02.488 +03:00 [INF] Created new UserNotification entry for user: 1012345678
2025-01-31 23:47:02.490 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@__userId_0='?' (Size = 450)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [u].[national_id], [u].[last_updated], [u].[notifications]
FROM [user_notifications] AS [u]
WHERE [u].[national_id] = @__userId_0
2025-01-31 23:47:02.492 +03:00 [INF] Processing notification for user 1023456789. Existing notification record: false
2025-01-31 23:47:02.493 +03:00 [INF] Current notifications count for user 1023456789: 0
2025-01-31 23:47:02.494 +03:00 [INF] Serialized new notifications for user 1023456789. Length: 140
2025-01-31 23:47:02.496 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@p0='?' (Size = 4000), @p1='?' (Size = 4000), @p2='?' (DbType = DateTime2)], CommandType='"Text"', CommandTimeout='30']
INSERT INTO user_notifications (national_id, notifications, last_updated) VALUES (@p0, @p1, @p2)
2025-01-31 23:47:02.497 +03:00 [INF] Created new UserNotification entry for user: 1023456789
2025-01-31 23:47:02.499 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@__userId_0='?' (Size = 450)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [u].[national_id], [u].[last_updated], [u].[notifications]
FROM [user_notifications] AS [u]
WHERE [u].[national_id] = @__userId_0
2025-01-31 23:47:02.501 +03:00 [INF] Processing notification for user 1045678901. Existing notification record: false
2025-01-31 23:47:02.501 +03:00 [INF] Current notifications count for user 1045678901: 0
2025-01-31 23:47:02.502 +03:00 [INF] Serialized new notifications for user 1045678901. Length: 140
2025-01-31 23:47:02.504 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@p0='?' (Size = 4000), @p1='?' (Size = 4000), @p2='?' (DbType = DateTime2)], CommandType='"Text"', CommandTimeout='30']
INSERT INTO user_notifications (national_id, notifications, last_updated) VALUES (@p0, @p1, @p2)
2025-01-31 23:47:02.506 +03:00 [INF] Created new UserNotification entry for user: 1045678901
2025-01-31 23:47:02.509 +03:00 [INF] Executed DbCommand (2ms) [Parameters=[@p0='?' (Size = 4000), @p1='?' (DbType = DateTime2), @p2='?' (Size = 4000), @p3='?' (Size = 4000), @p4='?' (Size = 4000), @p5='?' (Size = 450), @p6='?' (Size = 4000), @p7='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SET IMPLICIT_TRANSACTIONS OFF;
SET NOCOUNT ON;
INSERT INTO [AuthLogs] ([AuthType], [CreatedAt], [DeviceId], [FailureReason], [IpAddress], [NationalId], [Status], [UserAgent])
OUTPUT INSERTED.[Id]
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7);
2025-01-31 23:47:02.511 +03:00 [INF] Successfully sent notifications. Template: 1, Success: 3, Total: 3
2025-01-31 23:47:02.512 +03:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType9`2[[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Object, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-01-31 23:47:02.513 +03:00 [INF] Executed action NayifatAPI.Controllers.NotificationsController.SendNotification (NayifatAPI) in 149.3348ms
2025-01-31 23:47:02.514 +03:00 [INF] Executed endpoint 'NayifatAPI.Controllers.NotificationsController.SendNotification (NayifatAPI)'
2025-01-31 23:47:02.515 +03:00 [INF] Request finished HTTP/1.1 POST http://localhost:5264/api/notifications/send - 200 null application/json; charset=utf-8 155.1185ms
2025-01-31 23:47:10.190 +03:00 [INF] Request starting HTTP/1.1 POST http://localhost:5264/api/notifications/send - application/json 296
2025-01-31 23:47:10.193 +03:00 [INF] Executing endpoint 'NayifatAPI.Controllers.NotificationsController.SendNotification (NayifatAPI)'
2025-01-31 23:47:10.194 +03:00 [INF] Route matched with {action = "SendNotification", controller = "Notifications"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] SendNotification(NayifatAPI.Controllers.SendNotificationRequest) on controller NayifatAPI.Controllers.NotificationsController (NayifatAPI).
2025-01-31 23:47:10.197 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@__providedApiKey_0='?' (Size = 255)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [a].[Key], [a].[CreatedAt], [a].[Description], [a].[ExpiresAt], [a].[IsActive], [a].[LastUsedAt]
FROM [ApiKeys] AS [a]
WHERE [a].[Key] = @__providedApiKey_0 AND [a].[IsActive] = CAST(1 AS bit)
2025-01-31 23:47:10.199 +03:00 [INF] Received notification request: {"Title":null,"TitleEn":"Test Notification","TitleAr":" ","Filters":{"Customers.SalaryCustomer":{"ValueKind":"Object","$type":"JsonElement"}},"NationalId":null,"NationalIds":null}
2025-01-31 23:47:10.206 +03:00 [INF] Starting GetTargetUsers with request type: Filtered Users
2025-01-31 23:47:10.206 +03:00 [INF] Processing filter: SalaryCustomer < 10000
2025-01-31 23:47:10.207 +03:00 [INF] Applied SalaryCustomer filter: < 10000
2025-01-31 23:47:10.208 +03:00 [INF] Added filter group for customers.SalaryCustomer
2025-01-31 23:47:10.209 +03:00 [INF] Executing filter query with operation: AND
2025-01-31 23:47:10.211 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@__value_0='?' (Precision = 18) (Scale = 2) (DbType = Decimal)], CommandType='"Text"', CommandTimeout='30']
SELECT [c].[NationalId]
FROM [Customers] AS [c]
WHERE [c].[SalaryCustomer] < @__value_0
2025-01-31 23:47:10.214 +03:00 [INF] Found 1 users after applying filters
2025-01-31 23:47:10.216 +03:00 [INF] Target users query completed. Found 1 users
2025-01-31 23:47:10.218 +03:00 [INF] Found 1 target users for notification
2025-01-31 23:47:10.227 +03:00 [INF] Executed DbCommand (6ms) [Parameters=[@p0='?' (Size = 4000), @p1='?' (Size = 8000) (DbType = AnsiString), @p2='?' (Size = 8000) (DbType = AnsiString), @p3='?' (Size = 8000) (DbType = AnsiString), @p4='?' (DbType = DateTime2), @p5='?' (DbType = DateTime2), @p6='?' (Size = 255), @p7='?' (Size = 4000), @p8='?' (Size = 255), @p9='?' (Size = 255), @p10='?' (Size = 255)], CommandType='"Text"', CommandTimeout='30']
SET IMPLICIT_TRANSACTIONS OFF;
SET NOCOUNT ON;
INSERT INTO [notification_templates] ([additional_data], [Body], [body_ar], [body_en], [created_at], [expiry_at], [Route], [target_criteria], [Title], [title_ar], [title_en])
OUTPUT INSERTED.[Id]
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7, @p8, @p9, @p10);
2025-01-31 23:47:10.232 +03:00 [INF] Created notification template with ID: 2
2025-01-31 23:47:10.240 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@p0='?' (Size = 4000), @p1='?' (DbType = DateTime2), @p2='?' (Size = 4000), @p3='?' (Size = 4000), @p4='?' (Size = 4000), @p5='?' (Size = 450), @p6='?' (Size = 4000), @p7='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SET IMPLICIT_TRANSACTIONS OFF;
SET NOCOUNT ON;
INSERT INTO [AuthLogs] ([AuthType], [CreatedAt], [DeviceId], [FailureReason], [IpAddress], [NationalId], [Status], [UserAgent])
OUTPUT INSERTED.[Id]
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7);
2025-01-31 23:47:10.244 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@__userId_0='?' (Size = 450)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [u].[national_id], [u].[last_updated], [u].[notifications]
FROM [user_notifications] AS [u]
WHERE [u].[national_id] = @__userId_0
2025-01-31 23:47:10.245 +03:00 [INF] Processing notification for user 1045678901. Existing notification record: true
2025-01-31 23:47:10.246 +03:00 [INF] Current notifications count for user 1045678901: 1
2025-01-31 23:47:10.247 +03:00 [INF] Serialized new notifications for user 1045678901. Length: 279
2025-01-31 23:47:10.258 +03:00 [INF] Executed DbCommand (8ms) [Parameters=[@p0='?' (Size = 4000), @p1='?' (DbType = DateTime2), @p2='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
UPDATE user_notifications SET notifications = @p0, last_updated = @p1 WHERE national_id = @p2
2025-01-31 23:47:10.260 +03:00 [INF] Updated existing UserNotification for user: 1045678901
2025-01-31 23:47:10.262 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@p0='?' (Size = 4000), @p1='?' (DbType = DateTime2), @p2='?' (Size = 4000), @p3='?' (Size = 4000), @p4='?' (Size = 4000), @p5='?' (Size = 450), @p6='?' (Size = 4000), @p7='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SET IMPLICIT_TRANSACTIONS OFF;
SET NOCOUNT ON;
INSERT INTO [AuthLogs] ([AuthType], [CreatedAt], [DeviceId], [FailureReason], [IpAddress], [NationalId], [Status], [UserAgent])
OUTPUT INSERTED.[Id]
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7);
2025-01-31 23:47:10.265 +03:00 [INF] Successfully sent notifications. Template: 2, Success: 1, Total: 1
2025-01-31 23:47:10.267 +03:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType9`2[[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Object, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-01-31 23:47:10.269 +03:00 [INF] Executed action NayifatAPI.Controllers.NotificationsController.SendNotification (NayifatAPI) in 74.0054ms
2025-01-31 23:47:10.270 +03:00 [INF] Executed endpoint 'NayifatAPI.Controllers.NotificationsController.SendNotification (NayifatAPI)'
2025-01-31 23:47:10.271 +03:00 [INF] Request finished HTTP/1.1 POST http://localhost:5264/api/notifications/send - 200 null application/json; charset=utf-8 81.002ms
2025-01-31 23:47:48.352 +03:00 [INF] Request starting HTTP/1.1 POST http://localhost:5264/api/notifications/send - application/json 296
2025-01-31 23:47:48.354 +03:00 [INF] Executing endpoint 'NayifatAPI.Controllers.NotificationsController.SendNotification (NayifatAPI)'
2025-01-31 23:47:48.355 +03:00 [INF] Route matched with {action = "SendNotification", controller = "Notifications"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] SendNotification(NayifatAPI.Controllers.SendNotificationRequest) on controller NayifatAPI.Controllers.NotificationsController (NayifatAPI).
2025-01-31 23:47:48.364 +03:00 [INF] Executed DbCommand (5ms) [Parameters=[@__providedApiKey_0='?' (Size = 255)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [a].[Key], [a].[CreatedAt], [a].[Description], [a].[ExpiresAt], [a].[IsActive], [a].[LastUsedAt]
FROM [ApiKeys] AS [a]
WHERE [a].[Key] = @__providedApiKey_0 AND [a].[IsActive] = CAST(1 AS bit)
2025-01-31 23:47:48.367 +03:00 [INF] Received notification request: {"Title":null,"TitleEn":"Test Notification","TitleAr":" ","Filters":{"Customers.SalaryCustomer":{"ValueKind":"Object","$type":"JsonElement"}},"NationalId":null,"NationalIds":null}
2025-01-31 23:47:48.383 +03:00 [INF] Starting GetTargetUsers with request type: Filtered Users
2025-01-31 23:47:48.384 +03:00 [INF] Processing filter: SalaryCustomer < 10000
2025-01-31 23:47:48.385 +03:00 [INF] Applied SalaryCustomer filter: < 10000
2025-01-31 23:47:48.387 +03:00 [INF] Added filter group for customers.SalaryCustomer
2025-01-31 23:47:48.388 +03:00 [INF] Executing filter query with operation: AND
2025-01-31 23:47:48.401 +03:00 [INF] Executed DbCommand (5ms) [Parameters=[@__value_0='?' (Precision = 18) (Scale = 2) (DbType = Decimal)], CommandType='"Text"', CommandTimeout='30']
SELECT [c].[NationalId]
FROM [Customers] AS [c]
WHERE [c].[SalaryCustomer] < @__value_0
2025-01-31 23:47:48.404 +03:00 [INF] Found 1 users after applying filters
2025-01-31 23:47:48.406 +03:00 [INF] Target users query completed. Found 1 users
2025-01-31 23:47:48.411 +03:00 [INF] Found 1 target users for notification
2025-01-31 23:47:48.492 +03:00 [INF] Executed DbCommand (78ms) [Parameters=[@p0='?' (Size = 4000), @p1='?' (Size = 8000) (DbType = AnsiString), @p2='?' (Size = 8000) (DbType = AnsiString), @p3='?' (Size = 8000) (DbType = AnsiString), @p4='?' (DbType = DateTime2), @p5='?' (DbType = DateTime2), @p6='?' (Size = 255), @p7='?' (Size = 4000), @p8='?' (Size = 255), @p9='?' (Size = 255), @p10='?' (Size = 255)], CommandType='"Text"', CommandTimeout='30']
SET IMPLICIT_TRANSACTIONS OFF;
SET NOCOUNT ON;
INSERT INTO [notification_templates] ([additional_data], [Body], [body_ar], [body_en], [created_at], [expiry_at], [Route], [target_criteria], [Title], [title_ar], [title_en])
OUTPUT INSERTED.[Id]
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7, @p8, @p9, @p10);
2025-01-31 23:47:48.496 +03:00 [INF] Created notification template with ID: 1
2025-01-31 23:47:48.502 +03:00 [INF] Executed DbCommand (4ms) [Parameters=[@p0='?' (Size = 4000), @p1='?' (DbType = DateTime2), @p2='?' (Size = 4000), @p3='?' (Size = 4000), @p4='?' (Size = 4000), @p5='?' (Size = 450), @p6='?' (Size = 4000), @p7='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SET IMPLICIT_TRANSACTIONS OFF;
SET NOCOUNT ON;
INSERT INTO [AuthLogs] ([AuthType], [CreatedAt], [DeviceId], [FailureReason], [IpAddress], [NationalId], [Status], [UserAgent])
OUTPUT INSERTED.[Id]
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7);
2025-01-31 23:47:48.520 +03:00 [INF] Executed DbCommand (3ms) [Parameters=[@__userId_0='?' (Size = 450)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [u].[national_id], [u].[last_updated], [u].[notifications]
FROM [user_notifications] AS [u]
WHERE [u].[national_id] = @__userId_0
2025-01-31 23:47:48.529 +03:00 [INF] Processing notification for user 1045678901. Existing notification record: false
2025-01-31 23:47:48.530 +03:00 [INF] Current notifications count for user 1045678901: 0
2025-01-31 23:47:48.532 +03:00 [INF] Serialized new notifications for user 1045678901. Length: 140
2025-01-31 23:47:48.543 +03:00 [INF] Executed DbCommand (8ms) [Parameters=[@p0='?' (Size = 4000), @p1='?' (Size = 4000), @p2='?' (DbType = DateTime2)], CommandType='"Text"', CommandTimeout='30']
INSERT INTO user_notifications (national_id, notifications, last_updated) VALUES (@p0, @p1, @p2)
2025-01-31 23:47:48.550 +03:00 [INF] Created new UserNotification entry for user: 1045678901
2025-01-31 23:47:48.562 +03:00 [INF] Executed DbCommand (10ms) [Parameters=[@p0='?' (Size = 4000), @p1='?' (DbType = DateTime2), @p2='?' (Size = 4000), @p3='?' (Size = 4000), @p4='?' (Size = 4000), @p5='?' (Size = 450), @p6='?' (Size = 4000), @p7='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SET IMPLICIT_TRANSACTIONS OFF;
SET NOCOUNT ON;
INSERT INTO [AuthLogs] ([AuthType], [CreatedAt], [DeviceId], [FailureReason], [IpAddress], [NationalId], [Status], [UserAgent])
OUTPUT INSERTED.[Id]
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7);
2025-01-31 23:47:48.567 +03:00 [INF] Successfully sent notifications. Template: 1, Success: 1, Total: 1
2025-01-31 23:47:48.568 +03:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType9`2[[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Object, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-01-31 23:47:48.570 +03:00 [INF] Executed action NayifatAPI.Controllers.NotificationsController.SendNotification (NayifatAPI) in 213.3137ms
2025-01-31 23:47:48.575 +03:00 [INF] Executed endpoint 'NayifatAPI.Controllers.NotificationsController.SendNotification (NayifatAPI)'
2025-01-31 23:47:48.577 +03:00 [INF] Request finished HTTP/1.1 POST http://localhost:5264/api/notifications/send - 200 null application/json; charset=utf-8 225.1804ms
2025-01-31 23:51:44.890 +03:00 [INF] Request starting HTTP/1.1 POST http://localhost:5264/api/notifications/send - application/json 296
2025-01-31 23:51:44.893 +03:00 [INF] Executing endpoint 'NayifatAPI.Controllers.NotificationsController.SendNotification (NayifatAPI)'
2025-01-31 23:51:44.893 +03:00 [INF] Route matched with {action = "SendNotification", controller = "Notifications"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] SendNotification(NayifatAPI.Controllers.SendNotificationRequest) on controller NayifatAPI.Controllers.NotificationsController (NayifatAPI).
2025-01-31 23:51:44.901 +03:00 [INF] Executed DbCommand (3ms) [Parameters=[@__providedApiKey_0='?' (Size = 255)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [a].[Key], [a].[CreatedAt], [a].[Description], [a].[ExpiresAt], [a].[IsActive], [a].[LastUsedAt]
FROM [ApiKeys] AS [a]
WHERE [a].[Key] = @__providedApiKey_0 AND [a].[IsActive] = CAST(1 AS bit)
2025-01-31 23:51:44.903 +03:00 [INF] Received notification request: {"Title":null,"TitleEn":"Test Notification","TitleAr":" ","Filters":{"Customers.SalaryCustomer":{"ValueKind":"Object","$type":"JsonElement"}},"NationalId":null,"NationalIds":null}
2025-01-31 23:51:44.907 +03:00 [INF] Starting GetTargetUsers with request type: Filtered Users
2025-01-31 23:51:44.908 +03:00 [INF] Processing filter: SalaryCustomer < 10000
2025-01-31 23:51:44.909 +03:00 [INF] Applied SalaryCustomer filter: < 10000
2025-01-31 23:51:44.910 +03:00 [INF] Added filter group for customers.SalaryCustomer
2025-01-31 23:51:44.912 +03:00 [INF] Executing filter query with operation: AND
2025-01-31 23:51:44.918 +03:00 [INF] Executed DbCommand (4ms) [Parameters=[@__value_0='?' (Precision = 18) (Scale = 2) (DbType = Decimal)], CommandType='"Text"', CommandTimeout='30']
SELECT [c].[NationalId]
FROM [Customers] AS [c]
WHERE [c].[SalaryCustomer] < @__value_0
2025-01-31 23:51:44.920 +03:00 [INF] Found 1 users after applying filters
2025-01-31 23:51:44.921 +03:00 [INF] Target users query completed. Found 1 users
2025-01-31 23:51:44.922 +03:00 [INF] Found 1 target users for notification
2025-01-31 23:51:44.932 +03:00 [INF] Executed DbCommand (8ms) [Parameters=[@p0='?' (Size = 4000), @p1='?' (Size = 8000) (DbType = AnsiString), @p2='?' (Size = 8000) (DbType = AnsiString), @p3='?' (Size = 8000) (DbType = AnsiString), @p4='?' (DbType = DateTime2), @p5='?' (DbType = DateTime2), @p6='?' (Size = 255), @p7='?' (Size = 4000), @p8='?' (Size = 255), @p9='?' (Size = 255), @p10='?' (Size = 255)], CommandType='"Text"', CommandTimeout='30']
SET IMPLICIT_TRANSACTIONS OFF;
SET NOCOUNT ON;
INSERT INTO [notification_templates] ([additional_data], [Body], [body_ar], [body_en], [created_at], [expiry_at], [Route], [target_criteria], [Title], [title_ar], [title_en])
OUTPUT INSERTED.[Id]
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7, @p8, @p9, @p10);
2025-01-31 23:51:44.935 +03:00 [INF] Created notification template with ID: 1
2025-01-31 23:51:44.942 +03:00 [INF] Executed DbCommand (5ms) [Parameters=[@p0='?' (Size = 4000), @p1='?' (DbType = DateTime2), @p2='?' (Size = 4000), @p3='?' (Size = 4000), @p4='?' (Size = 4000), @p5='?' (Size = 450), @p6='?' (Size = 4000), @p7='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SET IMPLICIT_TRANSACTIONS OFF;
SET NOCOUNT ON;
INSERT INTO [AuthLogs] ([AuthType], [CreatedAt], [DeviceId], [FailureReason], [IpAddress], [NationalId], [Status], [UserAgent])
OUTPUT INSERTED.[Id]
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7);
2025-01-31 23:51:44.949 +03:00 [INF] Executed DbCommand (3ms) [Parameters=[@__userId_0='?' (Size = 450)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [u].[national_id], [u].[last_updated], [u].[notifications]
FROM [user_notifications] AS [u]
WHERE [u].[national_id] = @__userId_0
2025-01-31 23:51:44.952 +03:00 [INF] Processing notification for user 1045678901. Existing notification record: false
2025-01-31 23:51:44.953 +03:00 [INF] Current notifications count for user 1045678901: 0
2025-01-31 23:51:44.954 +03:00 [INF] Serialized new notifications for user 1045678901. Length: 140
2025-01-31 23:51:44.961 +03:00 [INF] Executed DbCommand (6ms) [Parameters=[@p0='?' (Size = 4000), @p1='?' (Size = 4000), @p2='?' (DbType = DateTime2)], CommandType='"Text"', CommandTimeout='30']
INSERT INTO user_notifications (national_id, notifications, last_updated) VALUES (@p0, @p1, @p2)
2025-01-31 23:51:44.964 +03:00 [INF] Created new UserNotification entry for user: 1045678901
2025-01-31 23:51:44.969 +03:00 [INF] Executed DbCommand (2ms) [Parameters=[@p0='?' (Size = 4000), @p1='?' (DbType = DateTime2), @p2='?' (Size = 4000), @p3='?' (Size = 4000), @p4='?' (Size = 4000), @p5='?' (Size = 450), @p6='?' (Size = 4000), @p7='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SET IMPLICIT_TRANSACTIONS OFF;
SET NOCOUNT ON;
INSERT INTO [AuthLogs] ([AuthType], [CreatedAt], [DeviceId], [FailureReason], [IpAddress], [NationalId], [Status], [UserAgent])
OUTPUT INSERTED.[Id]
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7);
2025-01-31 23:51:44.972 +03:00 [INF] Successfully sent notifications. Template: 1, Success: 1, Total: 1
2025-01-31 23:51:44.973 +03:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType9`2[[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Object, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-01-31 23:51:44.975 +03:00 [INF] Executed action NayifatAPI.Controllers.NotificationsController.SendNotification (NayifatAPI) in 80.0321ms
2025-01-31 23:51:44.977 +03:00 [INF] Executed endpoint 'NayifatAPI.Controllers.NotificationsController.SendNotification (NayifatAPI)'
2025-01-31 23:51:44.980 +03:00 [INF] Request finished HTTP/1.1 POST http://localhost:5264/api/notifications/send - 200 null application/json; charset=utf-8 90.3614ms
2025-01-31 23:55:24.445 +03:00 [INF] Request starting HTTP/1.1 POST http://localhost:5264/api/notifications/send - application/json 296
2025-01-31 23:55:24.448 +03:00 [INF] Executing endpoint 'NayifatAPI.Controllers.NotificationsController.SendNotification (NayifatAPI)'
2025-01-31 23:55:24.450 +03:00 [INF] Route matched with {action = "SendNotification", controller = "Notifications"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] SendNotification(NayifatAPI.Controllers.SendNotificationRequest) on controller NayifatAPI.Controllers.NotificationsController (NayifatAPI).
2025-01-31 23:55:24.459 +03:00 [INF] Executed DbCommand (2ms) [Parameters=[@__providedApiKey_0='?' (Size = 255)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [a].[Key], [a].[CreatedAt], [a].[Description], [a].[ExpiresAt], [a].[IsActive], [a].[LastUsedAt]
FROM [ApiKeys] AS [a]
WHERE [a].[Key] = @__providedApiKey_0 AND [a].[IsActive] = CAST(1 AS bit)
2025-01-31 23:55:24.463 +03:00 [INF] Received notification request: {"Title":null,"TitleEn":"Test Notification","TitleAr":" ","Filters":{"Customers.SalaryCustomer":{"ValueKind":"Object","$type":"JsonElement"}},"NationalId":null,"NationalIds":null}
2025-01-31 23:55:24.467 +03:00 [INF] Starting GetTargetUsers with request type: Filtered Users
2025-01-31 23:55:24.468 +03:00 [INF] Processing filter: SalaryCustomer < 10000
2025-01-31 23:55:24.469 +03:00 [INF] Applied SalaryCustomer filter: < 10000
2025-01-31 23:55:24.470 +03:00 [INF] Added filter group for customers.SalaryCustomer
2025-01-31 23:55:24.471 +03:00 [INF] Executing filter query with operation: AND
2025-01-31 23:55:24.474 +03:00 [INF] Executed DbCommand (2ms) [Parameters=[@__value_0='?' (Precision = 18) (Scale = 2) (DbType = Decimal)], CommandType='"Text"', CommandTimeout='30']
SELECT [c].[NationalId]
FROM [Customers] AS [c]
WHERE [c].[SalaryCustomer] < @__value_0
2025-01-31 23:55:24.476 +03:00 [INF] Found 1 users after applying filters
2025-01-31 23:55:24.477 +03:00 [INF] Target users query completed. Found 1 users
2025-01-31 23:55:24.478 +03:00 [INF] Found 1 target users for notification
2025-01-31 23:55:24.489 +03:00 [INF] Executed DbCommand (10ms) [Parameters=[@p0='?' (Size = 4000), @p1='?' (Size = 8000) (DbType = AnsiString), @p2='?' (Size = 8000) (DbType = AnsiString), @p3='?' (Size = 8000) (DbType = AnsiString), @p4='?' (DbType = DateTime2), @p5='?' (DbType = DateTime2), @p6='?' (Size = 255), @p7='?' (Size = 4000), @p8='?' (Size = 255), @p9='?' (Size = 255), @p10='?' (Size = 255)], CommandType='"Text"', CommandTimeout='30']
SET IMPLICIT_TRANSACTIONS OFF;
SET NOCOUNT ON;
INSERT INTO [notification_templates] ([additional_data], [Body], [body_ar], [body_en], [created_at], [expiry_at], [Route], [target_criteria], [Title], [title_ar], [title_en])
OUTPUT INSERTED.[Id]
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7, @p8, @p9, @p10);
2025-01-31 23:55:24.492 +03:00 [INF] Created notification template with ID: 1
2025-01-31 23:55:24.503 +03:00 [INF] Executed DbCommand (10ms) [Parameters=[@p0='?' (Size = 4000), @p1='?' (DbType = DateTime2), @p2='?' (Size = 4000), @p3='?' (Size = 4000), @p4='?' (Size = 4000), @p5='?' (Size = 450), @p6='?' (Size = 4000), @p7='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SET IMPLICIT_TRANSACTIONS OFF;
SET NOCOUNT ON;
INSERT INTO [AuthLogs] ([AuthType], [CreatedAt], [DeviceId], [FailureReason], [IpAddress], [NationalId], [Status], [UserAgent])
OUTPUT INSERTED.[Id]
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7);
2025-01-31 23:55:24.508 +03:00 [INF] Executed DbCommand (2ms) [Parameters=[@__userId_0='?' (Size = 450)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [u].[national_id], [u].[last_updated], [u].[notifications]
FROM [user_notifications] AS [u]
WHERE [u].[national_id] = @__userId_0
2025-01-31 23:55:24.510 +03:00 [INF] Processing notification for user 1045678901. Existing notification record: false
2025-01-31 23:55:24.511 +03:00 [INF] Current notifications count for user 1045678901: 0
2025-01-31 23:55:24.512 +03:00 [INF] Serialized new notifications for user 1045678901. Length: 139
2025-01-31 23:55:24.522 +03:00 [INF] Executed DbCommand (3ms) [Parameters=[@p0='?' (Size = 4000), @p1='?' (Size = 4000), @p2='?' (DbType = DateTime2)], CommandType='"Text"', CommandTimeout='30']
INSERT INTO user_notifications (national_id, notifications, last_updated) VALUES (@p0, @p1, @p2)
2025-01-31 23:55:24.524 +03:00 [INF] Created new UserNotification entry for user: 1045678901
2025-01-31 23:55:24.527 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@p0='?' (Size = 4000), @p1='?' (DbType = DateTime2), @p2='?' (Size = 4000), @p3='?' (Size = 4000), @p4='?' (Size = 4000), @p5='?' (Size = 450), @p6='?' (Size = 4000), @p7='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SET IMPLICIT_TRANSACTIONS OFF;
SET NOCOUNT ON;
INSERT INTO [AuthLogs] ([AuthType], [CreatedAt], [DeviceId], [FailureReason], [IpAddress], [NationalId], [Status], [UserAgent])
OUTPUT INSERTED.[Id]
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7);
2025-01-31 23:55:24.529 +03:00 [INF] Successfully sent notifications. Template: 1, Success: 1, Total: 1
2025-01-31 23:55:24.534 +03:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType9`2[[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Object, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-01-31 23:55:24.536 +03:00 [INF] Executed action NayifatAPI.Controllers.NotificationsController.SendNotification (NayifatAPI) in 84.9273ms
2025-01-31 23:55:24.537 +03:00 [INF] Executed endpoint 'NayifatAPI.Controllers.NotificationsController.SendNotification (NayifatAPI)'
2025-01-31 23:55:24.539 +03:00 [INF] Request finished HTTP/1.1 POST http://localhost:5264/api/notifications/send - 200 null application/json; charset=utf-8 93.2179ms
2025-01-31 23:59:40.217 +03:00 [INF] Request starting HTTP/1.1 POST http://localhost:5264/api/notifications/send - application/json 296
2025-01-31 23:59:40.219 +03:00 [INF] Executing endpoint 'NayifatAPI.Controllers.NotificationsController.SendNotification (NayifatAPI)'
2025-01-31 23:59:40.222 +03:00 [INF] Route matched with {action = "SendNotification", controller = "Notifications"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] SendNotification(NayifatAPI.Controllers.SendNotificationRequest) on controller NayifatAPI.Controllers.NotificationsController (NayifatAPI).
2025-01-31 23:59:40.232 +03:00 [INF] Executed DbCommand (3ms) [Parameters=[@__providedApiKey_0='?' (Size = 255)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [a].[Key], [a].[CreatedAt], [a].[Description], [a].[ExpiresAt], [a].[IsActive], [a].[LastUsedAt]
FROM [ApiKeys] AS [a]
WHERE [a].[Key] = @__providedApiKey_0 AND [a].[IsActive] = CAST(1 AS bit)
2025-01-31 23:59:40.235 +03:00 [INF] Received notification request: {"Title":null,"TitleEn":"Test Notification","TitleAr":" ","Filters":{"Customers.SalaryCustomer":{"ValueKind":"Object","$type":"JsonElement"}},"NationalId":null,"NationalIds":null}
2025-01-31 23:59:40.242 +03:00 [INF] Starting GetTargetUsers with request type: Filtered Users
2025-01-31 23:59:40.243 +03:00 [INF] Processing filter: SalaryCustomer < 10000
2025-01-31 23:59:40.245 +03:00 [INF] Applied SalaryCustomer filter: < 10000
2025-01-31 23:59:40.247 +03:00 [INF] Added filter group for customers.SalaryCustomer
2025-01-31 23:59:40.248 +03:00 [INF] Executing filter query with operation: AND
2025-01-31 23:59:40.256 +03:00 [INF] Executed DbCommand (4ms) [Parameters=[@__value_0='?' (Precision = 18) (Scale = 2) (DbType = Decimal)], CommandType='"Text"', CommandTimeout='30']
SELECT [c].[NationalId]
FROM [Customers] AS [c]
WHERE [c].[SalaryCustomer] < @__value_0
2025-01-31 23:59:40.259 +03:00 [INF] Found 1 users after applying filters
2025-01-31 23:59:40.260 +03:00 [INF] Target users query completed. Found 1 users
2025-01-31 23:59:40.261 +03:00 [INF] Found 1 target users for notification
2025-01-31 23:59:40.278 +03:00 [INF] Executed DbCommand (15ms) [Parameters=[@p0='?' (Size = 4000), @p1='?' (Size = 8000) (DbType = AnsiString), @p2='?' (Size = 8000) (DbType = AnsiString), @p3='?' (Size = 8000) (DbType = AnsiString), @p4='?' (DbType = DateTime2), @p5='?' (DbType = DateTime2), @p6='?' (Size = 255), @p7='?' (Size = 4000), @p8='?' (Size = 255), @p9='?' (Size = 255), @p10='?' (Size = 255)], CommandType='"Text"', CommandTimeout='30']
SET IMPLICIT_TRANSACTIONS OFF;
SET NOCOUNT ON;
INSERT INTO [notification_templates] ([additional_data], [Body], [body_ar], [body_en], [created_at], [expiry_at], [Route], [target_criteria], [Title], [title_ar], [title_en])
OUTPUT INSERTED.[Id]
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7, @p8, @p9, @p10);
2025-01-31 23:59:40.282 +03:00 [INF] Created notification template with ID: 1
2025-01-31 23:59:40.291 +03:00 [INF] Executed DbCommand (5ms) [Parameters=[@p0='?' (Size = 4000), @p1='?' (DbType = DateTime2), @p2='?' (Size = 4000), @p3='?' (Size = 4000), @p4='?' (Size = 4000), @p5='?' (Size = 450), @p6='?' (Size = 4000), @p7='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SET IMPLICIT_TRANSACTIONS OFF;
SET NOCOUNT ON;
INSERT INTO [AuthLogs] ([AuthType], [CreatedAt], [DeviceId], [FailureReason], [IpAddress], [NationalId], [Status], [UserAgent])
OUTPUT INSERTED.[Id]
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7);
2025-01-31 23:59:40.298 +03:00 [INF] Executed DbCommand (3ms) [Parameters=[@__userId_0='?' (Size = 450)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [u].[national_id], [u].[last_updated], [u].[notifications]
FROM [user_notifications] AS [u]
WHERE [u].[national_id] = @__userId_0
2025-01-31 23:59:40.304 +03:00 [INF] Processing notification for user 1045678901. Existing notification record: false
2025-01-31 23:59:40.305 +03:00 [INF] Current notifications count for user 1045678901: 0
2025-01-31 23:59:40.306 +03:00 [INF] Serialized new notifications for user 1045678901. Length: 140
2025-01-31 23:59:40.312 +03:00 [INF] Executed DbCommand (4ms) [Parameters=[@p0='?' (Size = 4000), @p1='?' (Size = 4000), @p2='?' (DbType = DateTime2)], CommandType='"Text"', CommandTimeout='30']
INSERT INTO user_notifications (national_id, notifications, last_updated) VALUES (@p0, @p1, @p2)
2025-01-31 23:59:40.315 +03:00 [INF] Created new UserNotification entry for user: 1045678901
2025-01-31 23:59:40.323 +03:00 [INF] Executed DbCommand (7ms) [Parameters=[@p0='?' (Size = 4000), @p1='?' (DbType = DateTime2), @p2='?' (Size = 4000), @p3='?' (Size = 4000), @p4='?' (Size = 4000), @p5='?' (Size = 450), @p6='?' (Size = 4000), @p7='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SET IMPLICIT_TRANSACTIONS OFF;
SET NOCOUNT ON;
INSERT INTO [AuthLogs] ([AuthType], [CreatedAt], [DeviceId], [FailureReason], [IpAddress], [NationalId], [Status], [UserAgent])
OUTPUT INSERTED.[Id]
VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7);
2025-01-31 23:59:40.326 +03:00 [INF] Successfully sent notifications. Template: 1, Success: 1, Total: 1
2025-01-31 23:59:40.328 +03:00 [INF] Executing OkObjectResult, writing value of type '<>f__AnonymousType9`2[[System.Boolean, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e],[System.Object, System.Private.CoreLib, Version=8.0.0.0, Culture=neutral, PublicKeyToken=7cec85d7bea7798e]]'.
2025-01-31 23:59:40.330 +03:00 [INF] Executed action NayifatAPI.Controllers.NotificationsController.SendNotification (NayifatAPI) in 102.9053ms
2025-01-31 23:59:40.331 +03:00 [INF] Executed endpoint 'NayifatAPI.Controllers.NotificationsController.SendNotification (NayifatAPI)'
2025-01-31 23:59:40.334 +03:00 [INF] Request finished HTTP/1.1 POST http://localhost:5264/api/notifications/send - 200 null application/json; charset=utf-8 117.3543ms
